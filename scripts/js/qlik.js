define("js/configloader",{load:function(e,t,n){t(["assets/require-config"],function(i){(i=i||t)([e],function(e){n(e)})})}}),define("apis/qlik-impl",["qvangular","client.utils/state","apis/qutil","apis/qglobal","apis/qapp","apis/qnavigation","apis/qlik-visual","apis/qtheme-global","assets/qlikui/custom-components","general.utils/qv-activate","general.utils/qv-swipe","general.utils/qv-longtapswipe","objects/object","client.views/current-selections/current-selections","client.views/odag-toolbar/odag-toolbar","core.utils/augment","angular-route","angular-animate","angular-sanitize"],function(e,t,n,i,r,o,s,a){"use strict";"false"!==(document.documentElement.getAttribute("qva-bootstrap")||document.body.getAttribute("qva-bootstrap"))&&!e.isBootstrapped&&e.bootstrap(document);var l,c,u=n.inClient();n.capabilityFlags.init(),u||(t.setState(t.States.analysis),t.setView(t.Views.sheet)),function(){var e=document.querySelectorAll("body > .qvobject, body > .qvplaceholder");return 0!==e.length&&(Array.prototype.forEach.call(e,function(e){if("absolute"!==e.style.position)return!1}),!0)}()&&(document.body.classList.add("absolute-position-mashup"),document.documentElement.classList.add("absolute-position-mashup")),l=new o(u),c=new a,s.init();var h={openApp:r.openApp,currApp:r.currApp,getGlobal:i.get,setOnError:function(e,t){r.setErrorCallback(e,t),i.setErrorCallback(e,t)},setLanguage:n.setLanguage,table:r.table,getAppList:i.getAppList,resize:n.resize,getExtensionList:n.getExtensionList,callRepository:n.callRepository,registerExtension:n.registerExtension,navigation:l,sessionApp:r.sessionApp,sessionAppFromApp:r.sessionAppFromApp,getThemeList:a.getThemeList,theme:c};return Object.defineProperty(h,"Promise",{get:function(){return n.Promise}}),define("qlik",h),requirejs.s.contexts.sense&&(requirejs.s.contexts._.defined.angular=requirejs.s.contexts.sense.defined.angular),h}),define("js/qlik",["js/configloader!apis/qlik-impl"],function(e){return e}),define("core.utils/class",[],function(){"use strict";var e=/xyz/.test(function(){})?/\b_super\b/:/.*/,t=function(){};return t.extend=function t(n,i){var r=this.prototype;"string"!=typeof n&&(i=n,n="Class");var o=Object.create(this.prototype);for(var s in i)o[s]="function"==typeof i[s]&&"function"==typeof r[s]&&e.test(i[s])?function(e,t){return function(){var n=this._super;this._super=r[e];var i=t.apply(this,arguments);return this._super=n,i}}(s,i[s]):i[s];if(!/^[_a-z][_a-z\d]*$/i.test(n))throw new Error("Invalid subclass name. Alphanumericals only.");var a=new Function("return (function "+n+"(){ typeof this.init === 'function' && this.init.apply(this, [].slice.call(arguments)) });")();return a.prototype=o,a.prototype.constructor=a,a.extend=t,a},t}),define("core.utils/deferred",["assets/qvangular/qvangular-core"],function(e){var t;return t=function(){return e.getService("$q").defer()},t.resolve=function(t){var n=e.getService("$q").defer();return n.resolve(t),n.promise},t.reject=function(){return e.getService("$q").reject.apply(null,arguments)},t.all=function(){return e.getService("$q").all.apply(null,arguments)},t.when=function(){return e.getService("$q").when.apply(null,arguments)},Object.defineProperty(t,"Promise",{get:function(){return e.getService("$q")}}),t}),define("objects.extension/view",["core.utils/class","core.utils/deferred"],function(e,t){"use strict";return e.extend({mounted:function(){},paint:function(){return t.resolve()},resize:function(e,t){return this.paint(e,t)},updateData:function(){return t.resolve()},beforeDestroy:function(){}})}),define("objects.extension/object-data-view",["angular","core.utils/deferred","pubsub"],function(e,t,n){"use strict";function i(e,t,n){this.app=e,this.model=t,this.toggled=!1,"string"==typeof n?this.sourceElement=document.getElementById(n):n[0]?this.sourceElement=n[0]:this.sourceElement=n,this.sourceClass="qv-view-original",this.tableClass="qv-view-data-table",this.QApp=requirejs("apis/qapp")}return i.prototype.show=function(){var n=this;return this.showIsAnimating?t.resolve(n.toggled):(this.showIsAnimating=!0,new n.QApp(n.app).visualization.create("table",n.model).then(function(e){var i=new t,r=n.sourceElement.parentElement;return n.qvis=e,n.originalObjectId=n.model.id,n.tableElement=document.createElement("div"),n.tableElement.classList.add(n.tableClass),r.insertBefore(n.tableElement,n.sourceElement),e.show(n.tableElement,{onRendered:function(){i.resolve()}}),i.promise}).then(function(){var i=new t;return n.sourceElement.classList.remove("chart-fade-in"),n.sourceElement.classList.add("chart-fade-out"),e.element(n.sourceElement).on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){e.element(n.sourceElement).off(),n.sourceElement.classList.add(n.sourceClass),n.tableElement.classList.add("table-fade-in"),n.toggled=!0,n.showIsAnimating=!1,i.resolve(n.toggled)}),i.promise}))},i.prototype.hide=function(){var i=this,r=new t;return this.hideIsAnimating?t.resolve(i.toggled):(this.hideIsAnimating=!0,i.tableElement.classList.remove("table-fade-in"),i.tableElement.classList.add("table-fade-out"),e.element(i.tableElement).on("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){i.sourceElement.classList.remove(i.sourceClass),n.publish("/ui/object/resize."+i.originalObjectId),i.sourceElement.classList.remove("chart-fade-out"),i.sourceElement.classList.add("chart-fade-in"),i.qvis.close(),i.tableElement.parentNode.removeChild(i.tableElement),i.toggled=!1,i.hideIsAnimating=!1,r.resolve(i.toggled)}),r.promise)},i.prototype.toggle=function(){return this.toggled?this.hide():this.show()},i}),define("objects.extension/base-view",["objects.extension/view","objects.extension/object-data-view","core.utils/deferred"],function(e,t,n){"use strict";return e.extend({init:function(e,t,n,i){this.$scope=e,this.$element=t,this.options=n,this.backendApi=i},prePaint:function(){},setFreeResize:function(e){this.options.freeResize=e},setBackendApi:function(e){this.backendApi=e},updateDerivedProperties:function(){return n.resolve(!1)},setInteractionState:function(e){this.options.interactionState=e},setDirection:function(e){this.options.direction=e},getContextMenu:function(){},getViewState:function(){return{}},getPreferredSize:function(){},toggleDataView:function(e){var n=this.backendApi.model;return this._dataView||(this._dataView=new t(n.app,n,e)),this._dataView.toggle()},destroy:function(){}})}),function(e){function t(e,t,n,i,r){this._listener=t,this._isOnce=n,this.context=i,this._signal=e,this._priority=r||0}function n(e,t){if("function"!=typeof e)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function i(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){i.prototype.dispatch.apply(e,arguments)}}t.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},i.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,n,i,r){var o,s=this._indexOfListener(e,i);if(-1!==s){if((o=this._bindings[s]).isOnce()!==n)throw new Error("You cannot add"+(n?"":"Once")+"() then add"+(n?"Once":"")+"() the same listener without removing the relationship first.")}else o=new t(this,e,n,i,r),this._addBinding(o);return this.memorize&&this._prevParams&&o.execute(this._prevParams),o},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){for(var n,i=this._bindings.length;i--;)if((n=this._bindings[i])._listener===e&&n.context===t)return i;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,i){return n(e,"add"),this._registerListener(e,!1,t,i)},addOnce:function(e,t,i){return n(e,"addOnce"),this._registerListener(e,!0,t,i)},remove:function(e,t){n(e,"remove");var i=this._indexOfListener(e,t);return-1!==i&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),e},removeAll:function(){for(var e=this._bindings.length;e--;)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,n=Array.prototype.slice.call(arguments),i=this._bindings.length;if(this.memorize&&(this._prevParams=n),i){t=this._bindings.slice(),this._shouldPropagate=!0;do{i--}while(t[i]&&this._shouldPropagate&&!1!==t[i].execute(n))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var r=i;r.Signal=i,"function"==typeof define&&define.amd?define("signals",[],function(){return r}):"undefined"!=typeof module&&module.exports?module.exports=r:e.signals=r}(this),function(){var e=function(e){function t(e,t){if(e.indexOf)return e.indexOf(t);for(var n=e.length;n--;)if(e[n]===t)return n;return-1}function n(e,n){var i=t(e,n);-1!==i&&e.splice(i,1)}function i(e,t){return"[object "+t+"]"===Object.prototype.toString.call(e)}function r(e){return i(e,"RegExp")}function o(e){return i(e,"Array")}function s(e){return"function"==typeof e}function a(e){return null===e||"null"===e?null:"true"===e||"false"!==e&&(e===f||"undefined"===e?f:""===e||isNaN(e)?e:parseFloat(e))}function l(e){for(var t=e.length,n=[];t--;)n[t]=a(e[t]);return n}function c(e,t){for(var n,i,r=(e||"").replace("?","").split("&"),o=r.length,s={};o--;)n=r[o].split("="),i=t?a(n[1]):n[1],s[n[0]]="string"==typeof i?decodeURIComponent(i):i;return s}function u(){this.bypassed=new e.Signal,this.routed=new e.Signal,this._routes=[],this._prevRoutes=[],this._piped=[],this.resetState()}function h(t,n,i,o){var s=r(t),a=o.patternLexer;this._router=o,this._pattern=t,this._paramsIds=s?null:a.getParamIds(t),this._optionalParamsIds=s?null:a.getOptionalParamsIds(t),this._matchRegexp=s?t:a.compilePattern(t,o.ignoreCase),this.matched=new e.Signal,this.switched=new e.Signal,n&&this.matched.add(n),this._priority=i||0}var d,p,f;return p=""===/t(.+)?/.exec("t")[1],u.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0,this._prevMatchedRequest=null,this._prevBypassedRequest=null},create:function(){return new u},addRoute:function(e,t,n){var i=new h(e,t,n,this);return this._sortedInsert(i),i},removeRoute:function(e){n(this._routes,e),e._destroy()},removeAllRoutes:function(){for(var e=this.getNumRoutes();e--;)this._routes[e]._destroy();this._routes.length=0},parse:function(e,t){if(e=e||"",t=t||[],this.ignoreState||e!==this._prevMatchedRequest&&e!==this._prevBypassedRequest){var n,i=this._getMatchedRoutes(e),r=0,o=i.length;if(o)for(this._prevMatchedRequest=e,this._notifyPrevRoutes(i,e),this._prevRoutes=i;r<o;)(n=i[r]).route.matched.dispatch.apply(n.route.matched,t.concat(n.params)),n.isFirst=!r,this.routed.dispatch.apply(this.routed,t.concat([e,n])),r+=1;else this._prevBypassedRequest=e,this.bypassed.dispatch.apply(this.bypassed,t.concat([e]));this._pipeParse(e,t)}},_notifyPrevRoutes:function(e,t){for(var n,i=0;n=this._prevRoutes[i++];)n.route.switched&&this._didSwitch(n.route,e)&&n.route.switched.dispatch(t)},_didSwitch:function(e,t){for(var n,i=0;n=t[i++];)if(n.route===e)return!1;return!0},_pipeParse:function(e,t){for(var n,i=0;n=this._piped[i++];)n.parse(e,t)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(e){var t=this._routes,n=t.length;do{--n}while(t[n]&&e._priority<=t[n]._priority);t.splice(n+1,0,e)},_getMatchedRoutes:function(e){for(var t,n=[],i=this._routes,r=i.length;(t=i[--r])&&((!n.length||this.greedy||t.greedy)&&t.match(e)&&n.push({route:t,params:t._getParamsArray(e)}),this.greedyEnabled||!n.length););return n},pipe:function(e){this._piped.push(e)},unpipe:function(e){n(this._piped,e)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},d=new u,d.VERSION="0.12.0",d.NORM_AS_ARRAY=function(e,t){return[t.vals_]},d.NORM_AS_OBJECT=function(e,t){return[t]},h.prototype={greedy:!1,rules:void 0,match:function(e){return e=e||"",this._matchRegexp.test(e)&&this._validateParams(e)},_validateParams:function(e){var t,n=this.rules,i=this._getParamsObject(e);for(t in n)if("normalize_"!==t&&n.hasOwnProperty(t)&&!this._isValidParam(e,t,i))return!1;return!0},_isValidParam:function(e,n,i){var a=this.rules[n],l=i[n],c=!1,u=0===n.indexOf("?");return null==l&&this._optionalParamsIds&&-1!==t(this._optionalParamsIds,n)?c=!0:r(a)?(u&&(l=i[n+"_"]),c=a.test(l)):o(a)?(u&&(l=i[n+"_"]),c=this._isValidArrayRule(a,l)):s(a)&&(c=a(l,e,i)),c},_isValidArrayRule:function(e,n){if(!this._router.ignoreCase)return-1!==t(e,n);"string"==typeof n&&(n=n.toLowerCase());for(var i,r=e.length;r--;)if(i=e[r],("string"==typeof i?i.toLowerCase():i)===n)return!0;return!1},_getParamsObject:function(e){for(var n,i,r=this._router.shouldTypecast,o=this._router.patternLexer.getParamValues(e,this._matchRegexp,r),s={},l=o.length;l--;)i=o[l],this._paramsIds&&(0===(n=this._paramsIds[l]).indexOf("?")&&i&&(s[n+"_"]=i,i=c(i,r),o[l]=i),p&&""===i&&-1!==t(this._optionalParamsIds,n)&&(i=void 0,o[l]=i),s[n]=i),s[l]=i;return s.request_=r?a(e):e,s.vals_=o,s},_getParamsArray:function(e){var t=this.rules?this.rules.normalize_:null;return t=t||this._router.normalizeFn,t&&s(t)?t(e,this._getParamsObject(e)):this._getParamsObject(e).vals_},interpolate:function(e){var t=this._router.patternLexer.interpolate(this._pattern,e);if(!this._validateParams(t))throw new Error("Generated string doesn't validate against `Route.rules`.");return t},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose(),this.switched.dispose(),this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},u.prototype.patternLexer=function(){function e(e,t){var n,i=[];for(e.lastIndex=0;n=e.exec(t);)i.push(n[1]);return i}function t(e,t,n){var i,r;for(r in s)s.hasOwnProperty(r)&&(i=s[r],e=e.replace(i[t],i[n]));return e}var n=/[\\.+*?\^$\[\](){}\/'#]/g,i=/^\/|\/$/g,r=/\/$/g,o=/(?:\{|:)([^}:]+)(?:\}|:)/g,s={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},a=1,c=2,u=3,h=a;return function(){var e,t;for(e in s)s.hasOwnProperty(e)&&((t=s[e]).id="__CR_"+e+"__",t.save="save"in t?t.save.replace("{{id}}",t.id):t.id,t.rRestore=new RegExp(t.id,"g"))}(),{strict:function(){h=c},loose:function(){h=a},legacy:function(){h=u},getParamIds:function(t){return e(o,t)},getOptionalParamsIds:function(t){return e(s.OP.rgx,t)},getParamValues:function(e,t,n){var i=t.exec(e);return i&&(i.shift(),n&&(i=l(i))),i},compilePattern:function(e,o){return(e=e||"")&&(h===a?e=e.replace(i,""):h===u&&(e=e.replace(r,"")),e=t(e=(e=t(e,"rgx","save")).replace(n,"\\$&"),"rRestore","res"),h===a&&(e="\\/?"+e)),h!==c&&(e+="\\/?"),new RegExp("^"+e+"$",o?"i":"")},interpolate:function(e,t){if("string"!=typeof e)throw new Error("Route pattern should be a string.");return s.OS.trail||(s.OS.trail=new RegExp("(?:"+s.OS.id+")+$")),e.replace(s.OS.rgx,s.OS.save).replace(o,function(e,n){var i;if(n="?"===n.substr(0,1)?n.substr(1):n,null!=t[n]){if("object"==typeof t[n]){var r=[];for(var o in t[n])r.push(encodeURI(o+"="+t[n][o]));i="?"+r.join("&")}else i=String(t[n]);if(-1===e.indexOf("*")&&-1!==i.indexOf("/"))throw new Error('Invalid value "'+i+'" for segment "'+e+'".')}else{if(-1!==e.indexOf("{"))throw new Error("The segment "+e+" is required.");i=""}return i}).replace(s.OS.trail,"").replace(s.OS.rRestore,"/")}}}(),d};"function"==typeof define&&define.amd?define("crossroads",["signals"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("signals")):window.crossroads=e(window.signals)}(),define("general.controllers/route-controller",["crossroads","util"],function(e,t){"use strict";function n(){g.forEach(function(e){e.dispose()}),m.forEach(function(e){r.addRoute(e)})}function i(){window.addEventListener("popstate",function(){var e=t.getParameterByName("app");o&&o!==e?location.href=location.href:r.parse()},!1)}{if(!location.pathname.match(/hub$/i)){location.hash&&history.replaceState(null,null,location.href.replace("#!/",""));var r={},o=t.getParameterByName("app"),s=t.getParameterByName("language"),a=t.getParameterByName("theme"),l=t.getParameterByName("debug"),c=t.getParameterByName("options"),u=t.getParameterByName("noData"),h=t.getParameterByName("feature"),d=t.getParameterByName("ttl"),p=[],f=[],m=[],g=[];return o&&p.push("app",o),s&&f.push("language",s),a&&f.push("theme",a),l&&f.push("debug",l),c&&f.push("options",c),u&&f.push("noData",!0),h&&f.push("feature",h),d&&f.push("ttl",d),r.isSuffixInUse=function(e){for(var t=0;t<f.length;t++)if(f[t]===e)return!0;return!1},r.removePartialSuffix=function(e){for(var t=!1,i=0;i<f.length;i++)if(f[i]===e){f.splice(i,2),t=!0;break}if(t){var o=location.href,s=new RegExp("/"+e+"/[^/]+","i");n(),s.test(o)&&(o=o.replace(s,""),r.setUrl(o))}return t},r.parse=function(t){e.parse(t||location.pathname)},r.addRoute=function(t){var n=this,i=t.pattern;m.push(t),t.isPartial&&("/"===i&&(i=""),i=n.buildUrl("replaceme").replace(location.protocol+"//"+location.host+"/","").replace("/replaceme",i));var r=e.addRoute(i,function(){n.lastRoute&&n.lastRoute!==t&&n.lastRoute.DeRoute.emit(),n.lastRoute=t,t.Route.emit.apply(t.Route,arguments)});g.push(r)},r.setUrl=function(e,n,i){n=!0,location.href.toLowerCase().indexOf("?x-")>-1&&(e=e.replace(/\?x-.+?=[^&]+/i,"").replace("&","?")),0!==e.indexOf(t.baseURI)?location.href=e:e!==location.href&&(history[n?"replaceState":"pushState"](null,null,e),i||r.parse())},r.start=function(){this.setUrl(location.href),i(),r.parse()},r.buildUrl=function(){var e=Array.apply(null,arguments),n="",i="";if(!0===e[0]?(n=e[1],e=e.slice(2)):e.unshift.apply(e,p),f.length&&e.push.apply(e,f),e=e.map(function(e){return encodeURIComponent(e).replace(/'/g,"%27")}),n){var r=new RegExp("([^/])/"+t.project+"/","i");i=t.baseURI.replace(r,"$1/"+n+"/")}else i=t.baseURI;return i+e.join("/").replace(/[\/]+/g,"/")},r.buildHubUrl=function(){return window.customHubUrl?window.customHubUrl:this.buildUrl(!0,"hub")},r}location.href=location.href+"/"}}),define("client.utils/state",["core.utils/notification","general.controllers/route-controller"],function(e,t){"use strict";var n,i,r,o,s,a,l={};return l.States={analysis:0,edit:1,play:2,editstory:3},l.Views={overview:0,sheet:1,story:2,object:3,masterObject:4,dataManager:7,dataSpaceScriptEditor:8,dataSpaceAssociations:9,dataSpaceDataModel:10},e.mixin(l),l.notification("StateChanged"),l.notification("SheetChanged"),l.notification("StoryChanged"),l.setState=function(e){e!==i&&(s=i,i=e,l.StateChanged.emit(n,i,a,s),n===l.Views.sheet||n===l.Views.object||n===l.Views.masterObject?t.setUrl(t.buildUrl("sheet",r.layout.qInfo.qId,"state",Object.keys(l.States)[e])):n===l.Views.story&&t.setUrl(t.buildUrl("story",r.layout.qInfo.qId,"state",Object.keys(l.States)[e],"slide",o)))},l.setView=function(e){e!==n&&(a=n,n=e,e===l.Views.overview&&(r=null),l.StateChanged.emit(n,i,a,s))},l.setSheet=function(e,t){var o=!1;e!==r&&(r=e,a=n,n=l.Views.sheet,l.SheetChanged.emit(e),o=!0),l.States[t]!==i&&(s=i,i=l.States[t]||l.States.analysis,o=!0),o&&l.StateChanged.emit(n,i,a,s)},l.setStory=function(e,t,c){var u=!1;e!==r&&(r=e,a=n,n=l.Views.story,l.StoryChanged.emit(e),u=!0),o=c,l.States[t]!==i&&(s=i,i=l.States[t]||l.States.editstory,u=!0),u&&l.StateChanged.emit(n,i,a,s)},l.isInAnalysisMode=function(){return i===l.States.analysis},l.isInEditMode=function(){return i===l.States.edit},l.inStoryPlayState=function(){return l.inStorytelling()&&i===l.States.play},l.inStorytelling=function(){return n===l.Views.story},l.inAppOverView=function(){return n===l.Views.overview},l.inDataManager=function(){return n===l.Views.dataManager},l.inDataSpaceScriptEditor=function(){return n===l.Views.dataSpaceScriptEditor},l.inDataSpaceDataModel=function(){return n===l.Views.dataSpaceDataModel},l.inSheetView=function(){return n===l.Views.sheet},l.inObjectView=function(){return n===l.Views.object},l.inMasterObjectView=function(){return n===l.Views.masterObject},l.getModel=function(){return l.model},Object.defineProperties(l,{state:{get:function(){return i}},view:{get:function(){return n}},model:{get:function(){return r},set:function(e){r=e}}}),l}),define("objects.picasso/derived-properties/hash/hash",["util"],function(e){"use strict";var t={generateHash:function(t){return e.hashFromString(JSON.stringify(t))},updateHash:function(e,n){e.qUndoExclude||(e.qUndoExclude={}),e.qUndoExclude.hashCode=t.generateHash(n)}};return t}),define("objects.picasso/derived-properties/hash/hash-builder",["util","core.utils/deferred"],function(e,t){"use strict";function n(e,n){var r=[];return e.qMeasures?(e.qMeasures.forEach(function(e){e.qLibraryId?r.push(i(e.qLibraryId,n)):r.push(t.resolve())}),t.all(r)):t.resolve(r)}function i(e,t){return t.getMeasure(e).then(function(e){return e.getProperties().then(function(e){return e.qMeasure.qDef})})}function r(e){return e.qDimensionInfo.map(function(e){return e.qGroupFieldDefs})}function o(e){return s(e).map(function(e){return e.qGroupPos})}function s(t){return e.getValue(t,"qDimensionInfo",[])}return{getDefaultHashDataForHyperCube:function(e,t,i){return n(e,i).then(function(e){return{drillLevel:o(t),dimensionExpressions:r(t),measureExpressions:e}})}}}),define("core.utils/json-patch",["jquery"],function(e){function t(e){return e&&(e=l({},{val:e}).val),e}function n(e,t){return d(e[t])||"$$"===t.substring(0,2)||"_"===t.substring(0,1)}function i(e,t){var n,i=t.substring(1).split("/").slice(0,-1);return i.forEach(function(t,r){r!==i.length&&(e=e[(n=+t)||t]=h(e[n||t])?isNaN(n)?{}:[]:e[t])}),e}function r(e){Object.keys(e).forEach(function(t){Object.getOwnPropertyDescriptor(e,t).configurable&&!n(e,t)&&delete e[t]})}function o(e,t){var n,i,r=!0;if(c(e)&&c(t))return Object.keys(e).length===Object.keys(t).length&&(Object.keys(e).forEach(function(n){if(!o(e[n],t[n]))return r=!1,!1}),r);if(u(e)&&u(t)){if(e.length!==t.length)return!1;for(n=0,i=e.length;n<i;n++)if(!o(e[n],t[n]))return!1;return!0}return e===t}function s(e,t,n){function i(e,t,n){if(e[n]&&h(e[n].qInfo))return null;if(e[n]&&e[n].qInfo.qId===t)return n;for(var i=0,r=e.length;i<r;i++)if(e[i]&&e[i].qInfo.qId===t)return i;return-1}var r,s,l=[],c=e.slice(),u=-1;if(o(t,c))return l;if(null===t[0]||!h(t[0])&&h(t[0].qInfo))return l.push({op:"replace",path:n,value:t}),l;for(r=c.length-1;r>=0;--r)-1===(u=i(t,c[r].qInfo&&c[r].qInfo.qId,r))?(l.push({op:"remove",path:n+"/"+r}),c.splice(r,1)):l=l.concat(a.generate(c[r],t[u],n+"/"+r));for(r=0,s=t.length;r<s;++r)-1===(u=i(c,t[r].qInfo&&t[r].qInfo.qId))?(l.push({op:"add",path:n+"/"+r,value:t[r]}),c.splice(r,0,t[r])):u!==r&&(l.push({op:"move",path:n+"/"+r,from:n+"/"+u}),c.splice(r,0,c.splice(u,1)[0]));return l}var a={},l=function(){return e.extend.apply(e,[!0].concat(Array.prototype.slice.call(arguments)))},c=e.isPlainObject,u=Array.isArray,h=function(e){return void 0===e},d=function(e){return"function"==typeof e};return a.generate=function(e,i,r){r=r||"";var l=[];return Object.keys(i).forEach(function(d){var p=t(i[d]),f=e[d],m=r+"/"+d;o(p,f)||n(i,d)||(h(f)?l.push({op:"add",path:m,value:p}):c(p)&&c(f)?l=l.concat(a.generate(f,p,m)):u(p)&&u(f)?l=l.concat(s(f,p,m)):l.push({op:"replace",path:r+"/"+d,value:p}))}),Object.keys(e).forEach(function(t){h(i[t])&&!n(e,t)&&l.push({op:"remove",path:r+"/"+t})}),l},a.apply=function(e,t){t.forEach(function(t){var n=i(e,t.path),o=t.path.split("/").splice(-1)[0],s=o&&isNaN(+o)?n[o]:n[+o]||n,a=t.from?t.from.split("/").splice(-1)[0]:null;if("add"===t.op||"replace"===t.op)if(u(n))"-"===o&&(o=n.length),n.splice(+o,"add"===t.op?0:1,t.value);else if(u(s)&&u(t.value)){var h=t.value.slice();s.length=0,s.push.apply(s,h)}else c(s)&&c(t.value)?(r(s),l(s,t.value)):n[o]=t.value;else if("move"===t.op){var d=i(e,t.from);u(n)?n.splice(+o,0,d.splice(+a,1)[0]):(n[o]=d[a],delete d[a])}else"remove"===t.op&&(u(n)?n.splice(+o,1):delete n[o])})},a.clone=function(e){return l({},e)},a.createPatch=function(e,t,n){var i={op:e.toLowerCase(),path:n};return"move"===i.op?i.from=t:void 0!==t&&(i.value=t),i},a.updateObject=function(e,t){Object.keys(e).length?a.apply(e,a.generate(e,t)):l(e,t)},a}),define("assets/client/soft-property-panel/soft-property-handler",["core.utils/class","util","core.utils/json-patch","core.utils/deferred"],function(e,t,n,i){return e.extend({init:function(e){this._model=e},setModel:function(e){this._model=e},saveSoftProperties:function(e,r){if(!this._model)return i.resolve(!1);var o=n.generate(e,r);return t.extend(!0,e,r),o&&o.length?(o=o.map(function(e){return{qOp:e.op,qValue:JSON.stringify(e.value),qPath:e.path}}),this._model.applyPatches(o,!0).then(function(){return!0})):i.resolve(!1)},mergeSoftPatches:function(){if(!this._model)return i.resolve();var e=this;return i.all({properties:this._model.getProperties(),effective:this._model.getEffectiveProperties()}).then(function(t){if(!t.properties.qExtendsId){var i=n.generate(t.properties,t.effective);n.apply(t.properties,i),e._model.setProperties(t.properties).then(function(){e._model.clearSoftPatches()})}})}})}),define("client.utils/hard-properties-checker",[],function(){"use strict";return{canModifyHardProperties:function(e,t,n){var i=e.Views&&e.Views.sheet;return!n.qHasSoftPatches&&!n.qExtendsId&&(e.view===i?e.model&&e.model.layout.permissions.update:t.app&&t.app.layout.permissions.update)}}}),define("objects.picasso/derived-properties/save/save",["assets/client/soft-property-panel/soft-property-handler","client.utils/hard-properties-checker"],function(e,t){"use strict";return{saveDerivedProperties:function(n,i,r,o,s){return t.canModifyHardProperties(s,n,i)?n.setProperties(r):new e(n).saveSoftProperties(o,r)}}}),define("objects.picasso/derived-properties/input-validator/input-validator",[],function(){"use strict";return{validate:function(e){if(!(e&&e.layout&&e.properties&&e.model&&e.hashData&&e.generateDerivedProperties))throw Error("Derived-properties: Missing input")}}}),define("objects.picasso/derived-properties/derived-properties",["util","client.utils/state","core.utils/deferred","objects.picasso/derived-properties/hash/hash","objects.picasso/derived-properties/hash/hash-builder","objects.picasso/derived-properties/save/save","objects.picasso/derived-properties/input-validator/input-validator"],function(e,t,n,i,r,o,s){"use strict";function a(){this._generationInProgress=!1}function l(e){s.validate(e);var t=e.properties,n=i.generateHash(e.hashData);return!(!t.qUndoExclude||t.qUndoExclude.hashCode!==n)}return a.prototype.isDerivedUpToDate=l,a.prototype.updateDerivedProperties=function(r){if(s.validate(r),this._generationInProgress)return n.resolve(!0);if(l(r)){var a=r.layout.qUndoExclude&&r.layout.qUndoExclude.hashCode===r.properties.qUndoExclude.hashCode;return n.resolve(!a)}var c=this,u=r.model,h=r.layout,d=r.properties,p=e.extend(!0,{},d);return this._generationInProgress=!0,i.updateHash(d,r.hashData),r.generateDerivedProperties(h,d).then(function(){return o.saveDerivedProperties(u,h,d,p,t).then(function(){return c._generationInProgress=!1,n.resolve(!0)})})},a.prototype.addDefaultHyperCubeHash=function(t,n,i,o){return r.getDefaultHashDataForHyperCube(t,n,i).then(function(t){return e.extend(!0,o,t)})},a}),define("general.utils/visualizations",[],function(){var e={};return{getType:function(t){return e[t]},getRegisteredNames:function(){return Object.keys(e)},getLibraryInfo:function(t){return e[t]?e[t].getLibraryInfo():null},getIconName:function(t){return e[t]?e[t].getIconName():null},getIconChar:function(t){return e[t]?e[t].getIconChar():null},registerType:function(t,n){e[t]=n}}}),define("objects.utils/chart-type-utils/chart-type-utils",["general.utils/visualizations"],function(e){function t(t){return e.getType(t)}return{getChartType:t,getExtensionType:function(e){return t(e).getExtensionType()},getInitialProperties:function(e){return t(e).getInitialProperties()}}}),define("objects.utils/chart-creation-service/chart-creation-service",["objects.utils/chart-type-utils/chart-type-utils","core.utils/deferred"],function(e,t){function n(e,t,n){return o(t,n).bind(t)(e)}function i(e,t,n){if(!e)throw new Error("No extension provided");var i=n||e.model;return r(e,t,n).then(function(e){return n.setFullPropertyTree(e).then(function(){return i})})}function r(n,i,r){if(!n)throw new Error("No extension provided");var o=r||n.model;return t.all([e.getExtensionType(i),e.getInitialProperties(i),o.getFullPropertyTree()]).then(function(e){var t,i=e[0],r=e[1],o=e[2];if(delete o.qProperty.qInfo.qId,n.exportProperties&&i.importProperties){var s;"boxplot"===n.type&&(s="boxplotDef"),t=i.importProperties(n.exportProperties(o,s),r,i)}else t={qProperty:r,qChildren:[]};return t})}function o(e,t){return t?e.createObject:e.createSessionObject}function s(e,t,n){if(!t||!e)throw new Error("Invalid inparameters: type or app missing");if(n)throw new Error("Persisted objects not implemented yet")}return{createInitialChart:function(t,i,r){return s(t,i,r),e.getInitialProperties(t).then(function(e){return n(e,i,r)})},createChart:n,convertChart:i,getPropertyTreeForConvertedChart:r,createConvertedChart:function(e,t,n,r){return s(t,n,r),(e.model.properties,r).then(function(n){return i(e,t,n)})}}}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("assets/external/swagger-client/swagger-client",[],t):"object"==typeof exports?exports.SwaggerClient=t():e.SwaggerClient=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=372)}([function(e,t){var n=e.exports={version:"2.5.1"};"number"==typeof __e&&(__e=n)},function(e,t,n){"use strict";function i(e){var t={};return null!==e&&Object.keys(e).forEach(function(n){e[n].forEach(function(e){t[String(e)]=n})}),t}var r=n(34),o=["kind","resolve","construct","instanceOf","predicate","represent","defaultStyle","styleAliases"],s=["scalar","sequence","mapping"];e.exports=function(e,t){if(t=t||{},Object.keys(t).forEach(function(t){if(-1===o.indexOf(t))throw new r('Unknown option "'+t+'" is met in definition of "'+e+'" YAML type.')}),this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(e){return e},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.defaultStyle=t.defaultStyle||null,this.styleAliases=i(t.styleAliases||null),-1===s.indexOf(this.kind))throw new r('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}},function(e,t,n){var i=n(75)("wks"),r=n(47),o=n(3).Symbol,s="function"==typeof o;(e.exports=function(e){return i[e]||(i[e]=s&&o[e]||(s?o:r)("Symbol."+e))}).store=i},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t,n){var i=n(3),r=n(0),o=n(18),s=n(16),a=function(e,t,n){var l,c,u,h=e&a.F,d=e&a.G,p=e&a.S,f=e&a.P,m=e&a.B,g=e&a.W,v=d?r:r[t]||(r[t]={}),y=v.prototype,b=d?i:p?i[t]:(i[t]||{}).prototype;d&&(n=t);for(l in n)(c=!h&&b&&void 0!==b[l])&&l in v||(u=c?b[l]:n[l],v[l]=d&&"function"!=typeof b[l]?n[l]:m&&c?o(u,i):g&&b[l]==u?function(e){var t=function(t,n,i){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,i)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(u):f&&"function"==typeof u?o(Function.call,u):u,f&&((v.virtual||(v.virtual={}))[l]=u,e&a.R&&y&&!y[l]&&s(y,l,u)))};a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,e.exports=a},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){var n=Array.isArray;e.exports=n},function(e,t,n){e.exports={default:n(178),__esModule:!0}},function(e,t,n){var i=n(5);e.exports=function(e){if(!i(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){var i=n(8),r=n(105),o=n(77),s=Object.defineProperty;t.f=n(11)?Object.defineProperty:function(e,t,n){if(i(e),t=o(t,!0),i(n),r)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var i=n(130),r="object"==typeof self&&self&&self.Object===Object&&self,o=i||r||Function("return this")();e.exports=o},function(e,t,n){e.exports=!n(14)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t,n){e.exports={default:n(175),__esModule:!0}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var i=n(9),r=n(29);e.exports=n(11)?function(e,t,n){return i.f(e,t,r(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var r=i(n(165)),o=i(n(164)),s="function"==typeof o.default&&"symbol"==typeof r.default?function(e){return typeof e}:function(e){return e&&"function"==typeof o.default&&e.constructor===o.default&&e!==o.default.prototype?"symbol":typeof e};t.default="function"==typeof o.default&&"symbol"===s(r.default)?function(e){return void 0===e?"undefined":s(e)}:function(e){return e&&"function"==typeof o.default&&e.constructor===o.default&&e!==o.default.prototype?"symbol":void 0===e?"undefined":s(e)}},function(e,t,n){var i=n(26);e.exports=function(e,t,n){if(i(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,r){return e.call(t,n,i,r)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){var i=n(272),r=n(304);e.exports=function(e,t){var n=r(e,t);return i(n)?n:void 0}},function(e,t,n){var i=n(259),r=n(274),o=n(37);e.exports=function(e){return o(e)?i(e):r(e)}},function(e,t){e.exports={}},function(e,t,n){var i=n(68),r=n(65);e.exports=function(e){return i(r(e))}},function(e,t,n){"use strict";function i(e){return void 0===e||null===e}e.exports.isNothing=i,e.exports.isObject=function(e){return"object"==typeof e&&null!==e},e.exports.toArray=function(e){return Array.isArray(e)?e:i(e)?[]:[e]},e.exports.repeat=function(e,t){var n,i="";for(n=0;n<t;n+=1)i+=e;return i},e.exports.isNegativeZero=function(e){return 0===e&&Number.NEGATIVE_INFINITY===1/e},e.exports.extend=function(e,t){var n,i,r,o;if(t)for(o=Object.keys(t),n=0,i=o.length;n<i;n+=1)r=o[n],e[r]=t[r];return e}},function(e,t,n){"use strict";function i(e,t,n){var r=[];return e.include.forEach(function(e){n=i(e,t,n)}),e[t].forEach(function(e){n.forEach(function(t,n){t.tag===e.tag&&t.kind===e.kind&&r.push(n)}),n.push(e)}),n.filter(function(e,t){return-1===r.indexOf(t)})}function r(){var e,t,n={scalar:{},sequence:{},mapping:{},fallback:{}};for(e=0,t=arguments.length;e<t;e+=1)arguments[e].forEach(function(e){n[e.kind][e.tag]=n.fallback[e.tag]=e});return n}function o(e){this.include=e.include||[],this.implicit=e.implicit||[],this.explicit=e.explicit||[],this.implicit.forEach(function(e){if(e.loadKind&&"scalar"!==e.loadKind)throw new a("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.")}),this.compiledImplicit=i(this,"implicit",[]),this.compiledExplicit=i(this,"explicit",[]),this.compiledTypeMap=r(this.compiledImplicit,this.compiledExplicit)}var s=n(23),a=n(34),l=n(1);o.DEFAULT=null,o.create=function(){var e,t;switch(arguments.length){case 1:e=o.DEFAULT,t=arguments[0];break;case 2:e=arguments[0],t=arguments[1];break;default:throw new a("Wrong number of arguments for Schema.create function")}if(e=s.toArray(e),t=s.toArray(t),!e.every(function(e){return e instanceof o}))throw new a("Specified list of super schemas (or a single Schema object) contains a non-Schema object.");if(!t.every(function(e){return e instanceof l}))throw new a("Specified list of YAML types (or a single Type object) contains a non-Type object.");return new o({include:e,explicit:t})},e.exports=o},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var i=n(113),r=n(67);e.exports=Object.keys||function(e){return i(e,r)}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var i=n(9).f,r=n(15),o=n(2)("toStringTag");e.exports=function(e,t,n){e&&!r(e=n?e:e.prototype,o)&&i(e,o,{configurable:!0,value:t})}},function(e,t,n){var i=n(65);e.exports=function(e){return Object(i(e))}},function(e,t,n){"use strict";var i=n(203)(!0);n(109)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=i(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){n(208);for(var i=n(3),r=n(16),o=n(21),s=n(2)("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),l=0;l<a.length;l++){var c=a[l],u=i[c],h=u&&u.prototype;h&&!h[s]&&r(h,s,c),o[c]=o.Array}},function(e,t,n){"use strict";function i(e,t){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=t,this.message=(this.reason||"(unknown reason)")+(this.mark?" "+this.mark.toString():""),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||""}(i.prototype=Object.create(Error.prototype)).constructor=i,i.prototype.toString=function(e){var t=this.name+": ";return t+=this.reason||"(unknown reason)",!e&&this.mark&&(t+=" "+this.mark.toString()),t},e.exports=i},function(e,t,n){"use strict";var i=n(24);e.exports=new i({include:[n(120)],implicit:[n(248),n(241)],explicit:[n(233),n(243),n(244),n(246)]})},function(e,t,n){var i=n(57),r=1/0;e.exports=function(e){if("string"==typeof e||i(e))return e;var t=e+"";return"0"==t&&1/e==-r?"-0":t}},function(e,t,n){var i=n(142),r=n(95);e.exports=function(e){return null!=e&&r(e.length)&&!i(e)}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return(e.operationId||"").replace(/\s/g,"").length?f(e.operationId):o(t,n)}function o(e,t){return""+p(t)+f(e)}function s(e,t){return p(t)+"-"+e}function a(e,t){return l(e,t,!0)||null}function l(e,t,n){if(!e||"object"!==(void 0===e?"undefined":(0,h.default)(e))||!e.paths||"object"!==(0,h.default)(e.paths))return null;var i=e.paths;for(var r in i)for(var o in i[r])if("PARAMETERS"!==o.toUpperCase()){var s=i[r][o];if(s&&"object"===(void 0===s?"undefined":(0,h.default)(s))){var a={spec:e,pathName:r,method:o.toUpperCase(),operation:s},l=t(a);if(n&&l)return a}}}Object.defineProperty(t,"__esModule",{value:!0});var c=i(n(59)),u=i(n(7)),h=i(n(17));t.isOAS3=function(e){var t=e.openapi;return!!t&&0===t.indexOf("3.0.0")},t.isSwagger2=function(e){var t=e.swagger;return!!t&&0===t.indexOf("2")},t.opId=r,t.idFromPathMethod=o,t.legacyIdFromPathMethod=s,t.getOperationRaw=function(e,t){return e&&e.paths?a(e,function(e){var n=e.pathName,i=e.method,o=e.operation;if(!o||"object"!==(void 0===o?"undefined":(0,h.default)(o)))return!1;var a=o.operationId;return[r(o,n,i),s(n,i),a].some(function(e){return e&&e===t})}):null},t.findOperation=a,t.eachOperation=l,t.normalizeSwagger=function(e){var t=e.spec,n=t.paths,i={};if(!n)return e;for(var o in n){var s=n[o];if((0,d.default)(s)){var a=s.parameters;for(var l in s)!function(e){var n=s[e];if(!(0,d.default)(n))return"continue";var l=r(n,o,e);if(l&&(i[l]?i[l].push(n):i[l]=[n],(0,u.default)(i).forEach(function(e){if(i[e].length>1)i[e].forEach(function(t,n){t.__originalOperationId=t.__originalOperationId||t.operationId,t.operationId=""+e+(n+1)});else if(void 0!==n.operationId){var t=i[e][0];t.__originalOperationId=t.__originalOperationId||n.operationId,t.operationId=e}})),"parameters"!==e){var h=[],p={};for(var f in t)"produces"!==f&&"consumes"!==f&&"security"!==f||(p[f]=t[f],h.push(p));if(a&&(p.parameters=a,h.push(p)),h.length){var m=!0,g=!1,v=void 0;try{for(var y,b=(0,c.default)(h);!(m=(y=b.next()).done);m=!0){var x=y.value;for(var q in x)if(n[q]){if("parameters"===q){var C=!0,S=!1,w=void 0;try{for(var _,D=(0,c.default)(x[q]);!(C=(_=D.next()).done);C=!0)!function(){var e=_.value;n[q].some(function(t){return t.name===e.name})||n[q].push(e)}()}catch(e){S=!0,w=e}finally{try{!C&&D.return&&D.return()}finally{if(S)throw w}}}}else n[q]=x[q]}}catch(e){g=!0,v=e}finally{try{!m&&b.return&&b.return()}finally{if(g)throw v}}}}}(l)}}return e};var d=i(n(12)),p=function(e){return String.prototype.toLowerCase.call(e)},f=function(e){return e.replace(/[^\w]/gi,"_")}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).loadSpec,i=void 0!==n&&n,r={ok:e.ok,url:e.url||t,status:e.status,statusText:e.statusText,headers:o(e.headers)},s=i||y(r.headers["content-type"]);return(s?e.text:e.blob||e.buffer).call(e).then(function(e){if(r.text=e,r.data=e,s)try{var t=m.default.safeLoad(e);r.body=t,r.obj=t}catch(e){r.parseError=e}return r})}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};return"function"==typeof e.forEach?(e.forEach(function(e,n){void 0!==t[n]?(t[n]=Array.isArray(t[n])?t[n]:[t[n]],t[n].push(e)):t[n]=e}),t):t}function s(e){return"undefined"!=typeof File?e instanceof File:null!==e&&"object"===(void 0===e?"undefined":(0,p.default)(e))&&"function"==typeof e.pipe}function a(e,t){var n=e.value,i=e.collectionFormat,r=e.allowEmptyValue,o={csv:",",ssv:"%20",tsv:"%09",pipes:"|"};if(void 0===n&&r)return"";if(s(n)||"boolean"==typeof n)return n;var a=encodeURIComponent;return t&&(a=(0,g.default)(n)?function(e){return e}:function(e){return(0,d.default)(e)}),n&&!Array.isArray(n)?a(n):Array.isArray(n)&&!i?n.map(a).join(","):"multi"===i?n.map(a):n.map(a).join(o[i])}function l(e){var t=(0,h.default)(e).reduce(function(t,n){var i=e[n],r=!!i.skipEncoding,o=r?n:encodeURIComponent(n),s=function(e){return e&&"object"===(void 0===e?"undefined":(0,p.default)(e))}(i)&&!Array.isArray(i);return t[o]=a(s?i:{value:i},r),t},{});return f.default.stringify(t,{encode:!1,indices:!1})||""}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.url,i=void 0===t?"":t,r=e.query,o=e.form;if(o){var c=(0,h.default)(o).some(function(e){return s(o[e].value)}),d=e.headers["content-type"]||e.headers["Content-Type"];if(c||/multipart\/form-data/i.test(d)){var p=n(227);e.body=new p,(0,h.default)(o).forEach(function(t){e.body.append(t,a(o[t],!0))})}else e.body=l(o);delete e.form}if(r){var m=i.split("?"),g=(0,u.default)(m,2),v=g[0],y=g[1],b="";if(y){var x=f.default.parse(y);(0,h.default)(r).forEach(function(e){return delete x[e]}),b=f.default.stringify(x,{encode:!0})}var q=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t.filter(function(e){return e}).join("&");return i?"?"+i:""}(b,l(r));e.url=v+q,delete e.query}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.shouldDownloadAsText=t.self=void 0;var u=i(n(168)),h=i(n(7)),d=i(n(60)),p=i(n(17));t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"object"===(void 0===e?"undefined":(0,p.default)(e))&&(t=e,e=t.url),t.headers=t.headers||{},v.mergeInQueryOrForm(t),t.requestInterceptor&&(t=t.requestInterceptor(t)||t),/multipart\/form-data/i.test(t.headers["content-type"]||t.headers["Content-Type"])&&(delete t.headers["content-type"],delete t.headers["Content-Type"]),(t.userFetch||fetch)(t.url,t).then(function(n){var i=v.serializeRes(n,e,t).then(function(e){return t.responseInterceptor&&(e=t.responseInterceptor(e)||e),e});if(!n.ok){var r=new Error(n.statusText);return r.statusCode=r.status=n.status,i.then(function(e){throw r.response=e,r},function(e){throw r.responseError=e,r})}return i})},t.serializeRes=r,t.serializeHeaders=o,t.encodeFormOrQuery=l,t.mergeInQueryOrForm=c,t.makeHttp=function(e,t,n){return n=n||function(e){return e},t=t||function(e){return e},function(i){return"string"==typeof i&&(i={url:i}),v.mergeInQueryOrForm(i),i=t(i),n(e(i))}},n(119);var f=i(n(362)),m=i(n(228)),g=i((i(n(55)),n(350))),v=t.self={serializeRes:r,mergeInQueryOrForm:c},y=t.shouldDownloadAsText=function(){return/json|xml|yaml|text/.test(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e){return Array.isArray(e)?e.length<1?"":"/"+e.map(function(e){return(e+"").replace(/~/g,"~0").replace(/\//g,"~1")}).join("/"):e}function o(e){return{op:"_get",path:e}}function s(e,t,n){return h(u(e.filter(g).map(function(e){return t(e.value,n,e.path)})||[]))}function a(e,t,n){return n=n||[],Array.isArray(e)?e.map(function(e,i){return a(e,t,n.concat(i))}):d(e)?(0,x.default)(e).map(function(i){return a(e[i],t,n.concat(i))}):t(e,n[n.length-1],n)}function l(e,t,n){var i=[];if((n=n||[]).length>0){var r=t(e,n[n.length-1],n);r&&(i=i.concat(r))}if(Array.isArray(e)){var o=e.map(function(e,i){return l(e,t,n.concat(i))});o&&(i=i.concat(o))}else if(d(e)){var s=(0,x.default)(e).map(function(i){return l(e[i],t,n.concat(i))});s&&(i=i.concat(s))}return i=u(i)}function c(e){return Array.isArray(e)?e:[e]}function u(e){var t;return(t=[]).concat.apply(t,(0,b.default)(e.map(function(e){return Array.isArray(e)?u(e):e})))}function h(e){return e.filter(function(e){return void 0!==e})}function d(e){return e&&"object"===(void 0===e?"undefined":(0,y.default)(e))}function p(e){return e&&"function"==typeof e}function f(e){if(v(e)){var t=e.op;return"add"===t||"remove"===t||"replace"===t}return!1}function m(e){return f(e)||v(e)&&"mutation"===e.type}function g(e){return m(e)&&("add"===e.op||"replace"===e.op||"merge"===e.op||"mergeDeep"===e.op)}function v(e){return e&&"object"===(void 0===e?"undefined":(0,y.default)(e))}Object.defineProperty(t,"__esModule",{value:!0});var y=i(n(17)),b=i(n(169)),x=i(n(7)),q=i(n(13)),C=i(n(224)),S=i(n(102)),w=i(n(222));t.default={add:function(e,t){return{op:"add",path:e,value:t}},replace:function(e,t,n){return{op:"replace",path:e,value:t,meta:n}},remove:function(e,t){return{op:"remove",path:e}},merge:function(e,t){return{type:"mutation",op:"merge",path:e,value:t}},mergeDeep:function(e,t){return{type:"mutation",op:"mergeDeep",path:e,value:t}},context:function(e,t){return{type:"context",path:e,value:t}},getIn:function(e,t){return t.reduce(function(e,t){return void 0!==t&&e?e[t]:e},e)},applyPatch:function(e,t,n){if(n=n||{},"merge"===(t=(0,q.default)({},t,{path:t.path&&r(t.path)})).op){var i=o(t.path);C.default.apply(e,[i]),(0,q.default)(i.value,t.value)}else if("mergeDeep"===t.op){var s=o(t.path);C.default.apply(e,[s]);var a=(0,q.default)({},s.value);(0,w.default)(s.value,t.value);for(var l in t.value)if(Object.prototype.hasOwnProperty.call(t.value,l)){var c=t.value[l];if(Array.isArray(c)){var u=a[l]||[];s.value[l]=u.concat(c)}}}else if(C.default.apply(e,[t]),n.allowMetaPatches&&t.meta&&g(t)&&(Array.isArray(t.value)||d(t.value))){var h=o(t.path);C.default.apply(e,[h]),(0,q.default)(h.value,t.meta)}return e},parentPathMatch:function(e,t){if(!Array.isArray(t))return!1;for(var n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0},flatten:u,fullyNormalizeArray:function(e){return h(u(c(e)))},normalizeArray:c,isPromise:function(e){return d(e)&&p(e.then)},forEachNew:function(e,t){try{return s(e,l,t)}catch(e){return e}},forEachNewPrimitive:function(e,t){try{return s(e,a,t)}catch(e){return e}},isJsonPatch:f,isContextPatch:function(e){return v(e)&&"context"===e.type},isPatch:v,isMutation:m,isAdditiveMutation:g,isGenerator:function(e){return S.default.isGeneratorFunction(e)},isFunction:p,isObject:d,isError:function(e){return e instanceof Error}}},function(e,t,n){"use strict";t.__esModule=!0;var i=function(e){return e&&e.__esModule?e:{default:e}}(n(13));t.default=i.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}},function(e,t,n){var i=n(18),r=n(108),o=n(106),s=n(8),a=n(46),l=n(80),c={},u={};(t=e.exports=function(e,t,n,h,d){var p,f,m,g,v=d?function(){return e}:l(e),y=i(n,h,t?2:1),b=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(o(v)){for(p=a(e.length);p>b;b++)if((g=t?y(s(f=e[b])[0],f[1]):y(e[b]))===c||g===u)return g}else for(m=v.call(e);!(f=m.next()).done;)if((g=r(m,y,f.value,t))===c||g===u)return g}).BREAK=c,t.RETURN=u},function(e,t){e.exports=!0},function(e,t,n){var i=n(47)("meta"),r=n(5),o=n(15),s=n(9).f,a=0,l=Object.isExtensible||function(){return!0},c=!n(14)(function(){return l(Object.preventExtensions({}))}),u=function(e){s(e,i,{value:{i:"O"+ ++a,w:{}}})},h=e.exports={KEY:i,NEED:!1,fastKey:function(e,t){if(!r(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,i)){if(!l(e))return"F";if(!t)return"E";u(e)}return e[i].i},getWeak:function(e,t){if(!o(e,i)){if(!l(e))return!0;if(!t)return!1;u(e)}return e[i].w},onFreeze:function(e){return c&&h.NEED&&l(e)&&!o(e,i)&&u(e),e}}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t,n){var i=n(76),r=Math.min;e.exports=function(e){return e>0?r(i(e),9007199254740991):0}},function(e,t){var n=0,i=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+i).toString(36))}},function(e,t,n){"use strict";var i=n(24);e.exports=i.DEFAULT=new i({include:[n(35)],explicit:[n(239),n(238),n(237)]})},function(e,t,n){function i(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}var r=n(318),o=n(319),s=n(320),a=n(321),l=n(322);i.prototype.clear=r,i.prototype.delete=o,i.prototype.get=s,i.prototype.has=a,i.prototype.set=l,e.exports=i},function(e,t,n){var i=n(10).Symbol;e.exports=i},function(e,t,n){var i=n(56);e.exports=function(e,t){for(var n=e.length;n--;)if(i(e[n][0],t))return n;return-1}},function(e,t,n){var i=n(316);e.exports=function(e,t){var n=e.__data__;return i(t)?n["string"==typeof t?"string":"hash"]:n.map}},function(e,t,n){var i=n(6),r=n(57),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;e.exports=function(e,t){if(i(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!r(e))||s.test(e)||!o.test(e)||null!=t&&e in Object(t)}},function(e,t,n){var i=n(19)(Object,"create");e.exports=i},function(e,t,n){var i=n(86),r=n(89),o=n(297),s=n(37),a=n(91),l=n(20),c=Object.prototype.hasOwnProperty,u=o(function(e,t){if(a(t)||s(t))r(t,l(t),e);else for(var n in t)c.call(t,n)&&i(e,n,t[n])});e.exports=u},function(e,t){e.exports=function(e,t){return e===t||e!==e&&t!==t}},function(e,t,n){var i=n(25),r="[object Symbol]",o=Object.prototype.toString;e.exports=function(e){return"symbol"==typeof e||i(e)&&o.call(e)==r}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){e.exports={default:n(172),__esModule:!0}},function(e,t,n){e.exports={default:n(174),__esModule:!0}},function(e,t,n){"use strict";(function(e){function i(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function r(e,t){if(i()<t)throw new RangeError("Invalid typed array length");return o.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=o.prototype):(null===e&&(e=new o(t)),e.length=t),e}function o(e,t,n){if(!(o.TYPED_ARRAY_SUPPORT||this instanceof o))return new o(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return c(this,e)}return s(this,e,t,n)}function s(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?d(e,t,n,i):"string"==typeof t?u(e,t,n):p(e,t)}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t,n,i){return a(t),t<=0?r(e,t):void 0!==n?"string"==typeof i?r(e,t).fill(n,i):r(e,t).fill(n):r(e,t)}function c(e,t){if(a(t),e=r(e,t<0?0:0|f(t)),!o.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function u(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!o.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|m(t,n),s=(e=r(e,i)).write(t,n);return s!==i&&(e=e.slice(0,s)),e}function h(e,t){var n=t.length<0?0:0|f(t.length);e=r(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function d(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i),o.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=o.prototype):e=h(e,t),e}function p(e,t){if(o.isBuffer(t)){var n=0|f(t.length);return 0===(e=r(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||X(t.length)?r(e,0):h(e,t);if("Buffer"===t.type&&Q(t.data))return h(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function f(e){if(e>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|e}function m(e,t){if(o.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return z(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return G(e).length;default:if(i)return z(e).length;t=(""+t).toLowerCase(),i=!0}}function g(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,t>>>=0,n<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return T(this,t,n);case"utf8":case"utf-8":return M(this,t,n);case"ascii":return E(this,t,n);case"latin1":case"binary":return I(this,t,n);case"base64":return D(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function v(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function y(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=o.from(t,i)),o.isBuffer(t))return 0===t.length?-1:b(e,t,n,i,r);if("number"==typeof t)return t&=255,o.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):b(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function b(e,t,n,i,r){function o(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}var s=1,a=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;s=2,a/=2,l/=2,n/=2}var c;if(r){var u=-1;for(c=n;c<a;c++)if(o(e,c)===o(t,-1===u?0:c-u)){if(-1===u&&(u=c),c-u+1===l)return u*s}else-1!==u&&(c-=c-u),u=-1}else for(n+l>a&&(n=a-l),c=n;c>=0;c--){for(var h=!0,d=0;d<l;d++)if(o(e,c+d)!==o(t,d)){h=!1;break}if(h)return c}return-1}function x(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");i>o/2&&(i=o/2);for(var s=0;s<i;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function q(e,t,n,i){return W(z(t,e.length-n),e,n,i)}function C(e,t,n,i){return W($(t),e,n,i)}function S(e,t,n,i){return C(e,t,n,i)}function w(e,t,n,i){return W(G(t),e,n,i)}function _(e,t,n,i){return W(U(t,e.length-n),e,n,i)}function D(e,t,n){return 0===t&&n===e.length?Y.fromByteArray(e):Y.fromByteArray(e.slice(t,n))}function M(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var o=e[r],s=null,a=o>239?4:o>223?3:o>191?2:1;if(r+a<=n){var l,c,u,h;switch(a){case 1:o<128&&(s=o);break;case 2:128==(192&(l=e[r+1]))&&(h=(31&o)<<6|63&l)>127&&(s=h);break;case 3:l=e[r+1],c=e[r+2],128==(192&l)&&128==(192&c)&&(h=(15&o)<<12|(63&l)<<6|63&c)>2047&&(h<55296||h>57343)&&(s=h);break;case 4:l=e[r+1],c=e[r+2],u=e[r+3],128==(192&l)&&128==(192&c)&&128==(192&u)&&(h=(15&o)<<18|(63&l)<<12|(63&c)<<6|63&u)>65535&&h<1114112&&(s=h)}}null===s?(s=65533,a=1):s>65535&&(s-=65536,i.push(s>>>10&1023|55296),s=56320|1023&s),i.push(s),r+=a}return A(i)}function A(e){var t=e.length;if(t<=Z)return String.fromCharCode.apply(String,e);for(var n="",i=0;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=Z));return n}function E(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function I(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function T(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",o=t;o<n;++o)r+=B(e[o]);return r}function L(e,t,n){for(var i=e.slice(t,n),r="",o=0;o<i.length;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function k(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,n,i,r,s){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<s)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function P(e,t,n,i){t<0&&(t=65535+t+1);for(var r=0,o=Math.min(e.length-n,2);r<o;++r)e[n+r]=(t&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function N(e,t,n,i){t<0&&(t=4294967295+t+1);for(var r=0,o=Math.min(e.length-n,4);r<o;++r)e[n+r]=t>>>8*(i?r:3-r)&255}function R(e,t,n,i,r,o){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function F(e,t,n,i,r){return r||R(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),K.write(e,t,n,i,23,4),n+4}function j(e,t,n,i,r){return r||R(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),K.write(e,t,n,i,52,8),n+8}function V(e){if((e=H(e).replace(J,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}function H(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function z(e,t){t=t||1/0;for(var n,i=e.length,r=null,o=[],s=0;s<i;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===i){(t-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function $(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function U(e,t){for(var n,i,r,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),i=n>>8,r=n%256,o.push(r),o.push(i);return o}function G(e){return Y.toByteArray(V(e))}function W(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function X(e){return e!==e}var Y=n(170),K=n(225),Q=n(226);t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,o.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=i(),o.poolSize=8192,o._augment=function(e){return e.__proto__=o.prototype,e},o.from=function(e,t,n){return s(null,e,t,n)},o.TYPED_ARRAY_SUPPORT&&(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0})),o.alloc=function(e,t,n){return l(null,e,t,n)},o.allocUnsafe=function(e){return c(null,e)},o.allocUnsafeSlow=function(e){return c(null,e)},o.isBuffer=function(e){return!(null==e||!e._isBuffer)},o.compare=function(e,t){if(!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,s=Math.min(n,i);r<s;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Q(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=o.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var s=e[n];if(!o.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(i,r),r+=s.length}return i},o.byteLength=m,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},o.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?M(this,0,e):g.apply(this,arguments)},o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},o.prototype.compare=function(e,t,n,i,r){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,r>>>=0,this===e)return 0;for(var s=r-i,a=n-t,l=Math.min(s,a),c=this.slice(i,r),u=e.slice(t,n),h=0;h<l;++h)if(c[h]!==u[h]){s=c[h],a=u[h];break}return s<a?-1:a<s?1:0},o.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},o.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},o.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},o.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return x(this,e,t,n);case"utf8":case"utf-8":return q(this,e,t,n);case"ascii":return C(this,e,t,n);case"latin1":case"binary":return S(this,e,t,n);case"base64":return w(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Z=4096;o.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var i;if(o.TYPED_ARRAY_SUPPORT)i=this.subarray(e,t),i.__proto__=o.prototype;else{var r=t-e;i=new o(r,void 0);for(var s=0;s<r;++s)i[s]=this[s+e]}return i},o.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i},o.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},o.prototype.readUInt8=function(e,t){return t||k(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return t||k(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return t||k(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return t||k(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,t){return t||k(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return r*=128,i>=r&&(i-=Math.pow(2,8*t)),i},o.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||k(e,t,this.length);for(var i=t,r=1,o=this[e+--i];i>0&&(r*=256);)o+=this[e+--i]*r;return r*=128,o>=r&&(o-=Math.pow(2,8*t)),o},o.prototype.readInt8=function(e,t){return t||k(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){t||k(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt16BE=function(e,t){t||k(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},o.prototype.readInt32LE=function(e,t){return t||k(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return t||k(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return t||k(e,4,this.length),K.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return t||k(e,4,this.length),K.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return t||k(e,8,this.length),K.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return t||k(e,8,this.length),K.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,n,i){e=+e,t|=0,n|=0,i||O(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,o=0;for(this[t]=255&e;++o<n&&(r*=256);)this[t+o]=e/r&255;return t+n},o.prototype.writeUIntBE=function(e,t,n,i){e=+e,t|=0,n|=0,i||O(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,o=1;for(this[t+r]=255&e;--r>=0&&(o*=256);)this[t+r]=e/o&255;return t+n},o.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,1,255,0),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):P(this,e,t,!0),t+2},o.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):P(this,e,t,!1),t+2},o.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):N(this,e,t,!0),t+4},o.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},o.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);O(this,e,t,n,r-1,-r)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},o.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);O(this,e,t,n,r-1,-r)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},o.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,1,127,-128),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):P(this,e,t,!0),t+2},o.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):P(this,e,t,!1),t+2},o.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):N(this,e,t,!0),t+4},o.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):N(this,e,t,!1),t+4},o.prototype.writeFloatLE=function(e,t,n){return F(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){return F(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},o.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r,s=i-n;if(this===e&&n<t&&t<i)for(r=s-1;r>=0;--r)e[r+t]=this[r+n];else if(s<1e3||!o.TYPED_ARRAY_SUPPORT)for(r=0;r<s;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s},o.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!o.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0);var s;if("number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var a=o.isBuffer(e)?e:z(new o(e,i).toString()),l=a.length;for(s=0;s<n-t;++s)this[s+t]=a[s%l]}return this};var J=/[^+\/0-9A-Za-z-_]/g}).call(t,n(97))},function(e,t){e.exports=function(e,t,n,i){if(!(e instanceof t)||void 0!==i&&i in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var i=n(18),r=n(68),o=n(31),s=n(46),a=n(186);e.exports=function(e,t){var n=1==e,l=2==e,c=3==e,u=4==e,h=6==e,d=5==e||h,p=t||a;return function(t,a,f){for(var m,g,v=o(t),y=r(v),b=i(a,f,3),x=s(y.length),q=0,C=n?p(t,x):l?p(t,0):void 0;x>q;q++)if((d||q in y)&&(m=y[q],g=b(m,q,v),e))if(n)C[q]=g;else if(g)switch(e){case 3:return!0;case 5:return m;case 6:return q;case 2:C.push(m)}else if(u)return!1;return h?-1:c||u?u:C}}},function(e,t,n){var i=n(27),r=n(2)("toStringTag"),o="Arguments"==i(function(){return arguments}()),s=function(e,t){try{return e[t]}catch(e){}};e.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=s(t=Object(e),r))?n:o?i(t):"Object"==(a=i(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var i=n(5),r=n(3).document,o=i(r)&&i(r.createElement);e.exports=function(e){return o?r.createElement(e):{}}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var i=n(27);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==i(e)?e.split(""):Object(e)}},function(e,t,n){"use strict";function i(e){var t,n;this.promise=new e(function(e,i){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=i}),this.resolve=r(t),this.reject=r(n)}var r=n(26);e.exports.f=function(e){return new i(e)}},function(e,t,n){var i=n(8),r=n(195),o=n(67),s=n(74)("IE_PROTO"),a=function(){},l=function(){var e,t=n(66)("iframe"),i=o.length;for(t.style.display="none",n(104).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),l=e.F;i--;)delete l.prototype[o[i]];return l()};e.exports=Object.create||function(e,t){var n;return null!==e?(a.prototype=i(e),n=new a,a.prototype=null,n[s]=e):n=l(),void 0===t?n:r(n,t)}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var i=n(16);e.exports=function(e,t,n){for(var r in t)n&&e[r]?e[r]=t[r]:i(e,r,t[r]);return e}},function(e,t,n){e.exports=n(16)},function(e,t,n){var i=n(75)("keys"),r=n(47);e.exports=function(e){return i[e]||(i[e]=r(e))}},function(e,t,n){var i=n(3),r=i["__core-js_shared__"]||(i["__core-js_shared__"]={});e.exports=function(e){return r[e]||(r[e]={})}},function(e,t){var n=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:n)(e)}},function(e,t,n){var i=n(5);e.exports=function(e,t){if(!i(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!i(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var i=n(3),r=n(0),o=n(43),s=n(79),a=n(9).f;e.exports=function(e){var t=r.Symbol||(r.Symbol=o?{}:i.Symbol||{});"_"==e.charAt(0)||e in t||a(t,e,{value:s.f(e)})}},function(e,t,n){t.f=n(2)},function(e,t,n){var i=n(64),r=n(2)("iterator"),o=n(21);e.exports=n(0).getIteratorMethod=function(e){if(void 0!=e)return e[r]||e["@@iterator"]||o[i(e)]}},function(e,t){},function(e,t,n){"use strict";var i=n(24);e.exports=new i({explicit:[n(247),n(245),n(240)]})},function(e,t,n){var i=n(19)(n(10),"Map");e.exports=i},function(e,t,n){function i(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}var r=n(323),o=n(324),s=n(325),a=n(326),l=n(327);i.prototype.clear=r,i.prototype.delete=o,i.prototype.get=s,i.prototype.has=a,i.prototype.set=l,e.exports=i},function(e,t,n){function i(e){var t=this.__data__=new r(e);this.size=t.size}var r=n(49),o=n(335),s=n(336),a=n(337),l=n(338),c=n(339);i.prototype.clear=o,i.prototype.delete=s,i.prototype.get=a,i.prototype.has=l,i.prototype.set=c,e.exports=i},function(e,t,n){var i=n(87),r=n(56),o=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){var s=e[t];o.call(e,t)&&r(s,n)&&(void 0!==n||t in e)||i(e,t,n)}},function(e,t){var n=Object.defineProperty;e.exports=function(e,t,i){"__proto__"==t&&n?n(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}},function(e,t,n){var i=n(122);e.exports=function(e){var t=new e.constructor(e.byteLength);return new i(t).set(new i(e)),t}},function(e,t,n){var i=n(86),r=n(87);e.exports=function(e,t,n,o){var s=!n;n||(n={});for(var a=-1,l=t.length;++a<l;){var c=t[a],u=o?o(n[c],e[c],c,n,e):void 0;void 0===u&&(u=e[c]),s?r(n,c,u):i(n,c,u)}return n}},function(e,t){var n=9007199254740991,i=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){return!!(t=null==t?n:t)&&("number"==typeof e||i.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},function(e,t){e.exports=function(e,t){return function(n){return e(t(n))}}},function(e,t){e.exports=function(e){return e}},function(e,t,n){var i=n(347),r="[object Arguments]",o=Object.prototype,s=o.hasOwnProperty,a=o.toString,l=o.propertyIsEnumerable;e.exports=function(e){return i(e)&&s.call(e,"callee")&&(!l.call(e,"callee")||a.call(e)==r)}},function(e,t){var n=9007199254740991;e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=n}},function(e,t,n){"use strict";function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function r(e,t,n){if(e&&s.isObject(e)&&e instanceof i)return e;var r=new i;return r.parse(e,t,n),r}var o=n(361),s=n(370);t.parse=r,t.resolve=function(e,t){return r(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?r(e,!1,!0).resolveObject(t):t},t.format=function(e){return s.isString(e)&&(e=r(e)),e instanceof i?e.format():i.prototype.format.call(e)},t.Url=i;var a=/^([a-z0-9.+-]+:)/i,l=/:[0-9]*$/,c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,u=["<",">",'"',"`"," ","\r","\n","\t"],h=["{","}","|","\\","^","`"].concat(u),d=["'"].concat(h),p=["%","/","?",";","#"].concat(d),f=["/","?","#"],m=/^[+a-z0-9A-Z_-]{0,63}$/,g=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,v={javascript:!0,"javascript:":!0},y={javascript:!0,"javascript:":!0},b={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},x=n(367);i.prototype.parse=function(e,t,n){if(!s.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var i=e.indexOf("?"),r=-1!==i&&i<e.indexOf("#")?"?":"#",l=e.split(r),u=/\\/g;l[0]=l[0].replace(u,"/");var h=e=l.join(r);if(h=h.trim(),!n&&1===e.split("#").length){var q=c.exec(h);if(q)return this.path=h,this.href=h,this.pathname=q[1],q[2]?(this.search=q[2],this.query=t?x.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var C=a.exec(h);if(C){var S=(C=C[0]).toLowerCase();this.protocol=S,h=h.substr(C.length)}if(n||C||h.match(/^\/\/[^@\/]+@[^@\/]+/)){var w="//"===h.substr(0,2);!w||C&&y[C]||(h=h.substr(2),this.slashes=!0)}if(!y[C]&&(w||C&&!b[C])){for(var _=-1,D=0;D<f.length;D++)-1!==(E=h.indexOf(f[D]))&&(-1===_||E<_)&&(_=E);var M,A;-1!==(A=-1===_?h.lastIndexOf("@"):h.lastIndexOf("@",_))&&(M=h.slice(0,A),h=h.slice(A+1),this.auth=decodeURIComponent(M)),_=-1;for(D=0;D<p.length;D++){var E=h.indexOf(p[D]);-1!==E&&(-1===_||E<_)&&(_=E)}-1===_&&(_=h.length),this.host=h.slice(0,_),h=h.slice(_),this.parseHost(),this.hostname=this.hostname||"";var I="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!I)for(var T=this.hostname.split(/\./),D=0,L=T.length;D<L;D++){var k=T[D];if(k&&!k.match(m)){for(var O="",P=0,N=k.length;P<N;P++)k.charCodeAt(P)>127?O+="x":O+=k[P];if(!O.match(m)){var R=T.slice(0,D),F=T.slice(D+1),j=k.match(g);j&&(R.push(j[1]),F.unshift(j[2])),F.length&&(h="/"+F.join(".")+h),this.hostname=R.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),I||(this.hostname=o.toASCII(this.hostname));var V=this.port?":"+this.port:"",H=this.hostname||"";this.host=H+V,this.href+=this.host,I&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==h[0]&&(h="/"+h))}if(!v[S])for(var D=0,L=d.length;D<L;D++){var B=d[D];if(-1!==h.indexOf(B)){var z=encodeURIComponent(B);z===B&&(z=escape(B)),h=h.split(B).join(z)}}var $=h.indexOf("#");-1!==$&&(this.hash=h.substr($),h=h.slice(0,$));var U=h.indexOf("?");if(-1!==U?(this.search=h.substr(U),this.query=h.substr(U+1),t&&(this.query=x.parse(this.query)),h=h.slice(0,U)):t&&(this.search="",this.query={}),h&&(this.pathname=h),b[S]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var V=this.pathname||"",G=this.search||"";this.path=V+G}return this.href=this.format(),this},i.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",i=this.hash||"",r=!1,o="";this.host?r=e+this.host:this.hostname&&(r=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&s.isObject(this.query)&&Object.keys(this.query).length&&(o=x.stringify(this.query));var a=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||b[t])&&!1!==r?(r="//"+(r||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):r||(r=""),i&&"#"!==i.charAt(0)&&(i="#"+i),a&&"?"!==a.charAt(0)&&(a="?"+a),n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),a=a.replace("#","%23"),t+r+n+a+i},i.prototype.resolve=function(e){return this.resolveObject(r(e,!1,!0)).format()},i.prototype.resolveObject=function(e){if(s.isString(e)){var t=new i;t.parse(e,!1,!0),e=t}for(var n=new i,r=Object.keys(this),o=0;o<r.length;o++){var a=r[o];n[a]=this[a]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),c=0;c<l.length;c++){var u=l[c];"protocol"!==u&&(n[u]=e[u])}return b[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!b[e.protocol]){for(var h=Object.keys(e),d=0;d<h.length;d++){var p=h[d];n[p]=e[p]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||y[e.protocol])n.pathname=e.pathname;else{for(S=(e.pathname||"").split("/");S.length&&!(e.host=S.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==S[0]&&S.unshift(""),S.length<2&&S.unshift(""),n.pathname=S.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var f=n.pathname||"",m=n.search||"";n.path=f+m}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var g=n.pathname&&"/"===n.pathname.charAt(0),v=e.host||e.pathname&&"/"===e.pathname.charAt(0),x=v||g||n.host&&e.pathname,q=x,C=n.pathname&&n.pathname.split("/")||[],S=e.pathname&&e.pathname.split("/")||[],w=n.protocol&&!b[n.protocol];if(w&&(n.hostname="",n.port=null,n.host&&(""===C[0]?C[0]=n.host:C.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===S[0]?S[0]=e.host:S.unshift(e.host)),e.host=null),x=x&&(""===S[0]||""===C[0])),v)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,C=S;else if(S.length)C||(C=[]),C.pop(),C=C.concat(S),n.search=e.search,n.query=e.query;else if(!s.isNullOrUndefined(e.search))return w&&(n.hostname=n.host=C.shift(),(I=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=I.shift(),n.host=n.hostname=I.shift())),n.search=e.search,n.query=e.query,s.isNull(n.pathname)&&s.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!C.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var _=C.slice(-1)[0],D=(n.host||e.host||C.length>1)&&("."===_||".."===_)||""===_,M=0,A=C.length;A>=0;A--)"."===(_=C[A])?C.splice(A,1):".."===_?(C.splice(A,1),M++):M&&(C.splice(A,1),M--);if(!x&&!q)for(;M--;M)C.unshift("..");!x||""===C[0]||C[0]&&"/"===C[0].charAt(0)||C.unshift(""),D&&"/"!==C.join("/").substr(-1)&&C.push("");var E=""===C[0]||C[0]&&"/"===C[0].charAt(0);if(w){n.hostname=n.host=E?"":C.length?C.shift():"";var I=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");I&&(n.auth=I.shift(),n.host=n.hostname=I.shift())}return(x=x||n.host&&C.length)&&!E&&C.unshift(""),C.length?n.pathname=C.join("/"):(n.pathname=null,n.path=null),s.isNull(n.pathname)&&s.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},i.prototype.parseHost=function(){var e=this.host,t=l.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){function n(){Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack;for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];this.message=n[0],t&&t.apply(this,n)}return n.prototype=new Error,n.prototype.name=e,n.prototype.constructor=n,n}},function(e,t,n){e.exports={default:n(179),__esModule:!0}},function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";t.__esModule=!0;var i=function(e){return e&&e.__esModule?e:{default:e}}(n(163));t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(e,r.key,r)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}()},function(e,t,n){e.exports=n(368)},function(e,t,n){(function(t){!function(){"use strict";e.exports=function(e){return(e instanceof t?e:new t(e.toString(),"binary")).toString("base64")}}()}).call(t,n(61).Buffer)},function(e,t,n){var i=n(3).document;e.exports=i&&i.documentElement},function(e,t,n){e.exports=!n(11)&&!n(14)(function(){return 7!=Object.defineProperty(n(66)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var i=n(21),r=n(2)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||o[r]===e)}},function(e,t,n){var i=n(27);e.exports=Array.isArray||function(e){return"Array"==i(e)}},function(e,t,n){var i=n(8);e.exports=function(e,t,n,r){try{return r?t(i(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&i(o.call(e)),t}}},function(e,t,n){"use strict";var i=n(43),r=n(4),o=n(73),s=n(16),a=n(15),l=n(21),c=n(192),u=n(30),h=n(198),d=n(2)("iterator"),p=!([].keys&&"next"in[].keys()),f=function(){return this};e.exports=function(e,t,n,m,g,v,y){c(n,t,m);var b,x,q,C=function(e){if(!p&&e in D)return D[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},S=t+" Iterator",w="values"==g,_=!1,D=e.prototype,M=D[d]||D["@@iterator"]||g&&D[g],A=M||C(g),E=g?w?C("entries"):A:void 0,I="Array"==t?D.entries||M:M;if(I&&(q=h(I.call(new e)))!==Object.prototype&&q.next&&(u(q,S,!0),i||a(q,d)||s(q,d,f)),w&&M&&"values"!==M.name&&(_=!0,A=function(){return M.call(this)}),i&&!y||!p&&!_&&D[d]||s(D,d,A),l[t]=A,l[S]=f,g)if(b={values:w?A:C("values"),keys:v?A:C("keys"),entries:E},y)for(x in b)x in D||o(D,x,b[x]);else r(r.P+r.F*(p||_),t,b);return b}},function(e,t,n){var i=n(2)("iterator"),r=!1;try{var o=[7][i]();o.return=function(){r=!0},Array.from(o,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!r)return!1;var n=!1;try{var o=[7],s=o[i]();s.next=function(){return{done:n=!0}},o[i]=function(){return s},e(o)}catch(e){}return n}},function(e,t,n){"use strict";var i=n(28),r=n(71),o=n(45),s=n(31),a=n(68),l=Object.assign;e.exports=!l||n(14)(function(){var e={},t={},n=Symbol(),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach(function(e){t[e]=e}),7!=l({},e)[n]||Object.keys(l({},t)).join("")!=i})?function(e,t){for(var n=s(e),l=arguments.length,c=1,u=r.f,h=o.f;l>c;)for(var d,p=a(arguments[c++]),f=u?i(p).concat(u(p)):i(p),m=f.length,g=0;m>g;)h.call(p,d=f[g++])&&(n[d]=p[d]);return n}:l},function(e,t,n){var i=n(113),r=n(67).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return i(e,r)}},function(e,t,n){var i=n(15),r=n(22),o=n(184)(!1),s=n(74)("IE_PROTO");e.exports=function(e,t){var n,a=r(e),l=0,c=[];for(n in a)n!=s&&i(a,n)&&c.push(n);for(;t.length>l;)i(a,n=t[l++])&&(~o(c,n)||c.push(n));return c}},function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,n){var i=n(8),r=n(5),o=n(69);e.exports=function(e,t){if(i(e),r(t)&&t.constructor===e)return t;var n=o.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){var i=n(8),r=n(26),o=n(2)("species");e.exports=function(e,t){var n,s=i(e).constructor;return void 0===s||void 0==(n=i(s)[o])?t:r(n)}},function(e,t,n){var i,r,o,s=n(18),a=n(191),l=n(104),c=n(66),u=n(3),h=u.process,d=u.setImmediate,p=u.clearImmediate,f=u.MessageChannel,m=u.Dispatch,g=0,v={},y=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},b=function(e){y.call(e.data)};d&&p||(d=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return v[++g]=function(){a("function"==typeof e?e:Function(e),t)},i(g),g},p=function(e){delete v[e]},"process"==n(27)(h)?i=function(e){h.nextTick(s(y,e,1))}:m&&m.now?i=function(e){m.now(s(y,e,1))}:f?(r=new f,o=r.port2,r.port1.onmessage=b,i=s(o.postMessage,o,1)):u.addEventListener&&"function"==typeof postMessage&&!u.importScripts?(i=function(e){u.postMessage(e+"","*")},u.addEventListener("message",b,!1)):i="onreadystatechange"in c("script")?function(e){l.appendChild(c("script")).onreadystatechange=function(){l.removeChild(this),y.call(e)}}:function(e){setTimeout(s(y,e,1),0)}),e.exports={set:d,clear:p}},function(e,t,n){var i=n(5);e.exports=function(e,t){if(!i(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},function(e,t,n){n(371),e.exports=self.fetch.bind(self)},function(e,t,n){"use strict";var i=n(24);e.exports=new i({include:[n(121)]})},function(e,t,n){"use strict";var i=n(24);e.exports=new i({include:[n(82)],implicit:[n(242),n(234),n(236),n(235)]})},function(e,t,n){var i=n(10).Uint8Array;e.exports=i},function(e,t){e.exports=function(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e}},function(e,t){e.exports=function(e,t,n,i){var r=-1,o=e?e.length:0;for(i&&o&&(n=e[++r]);++r<o;)n=t(n,e[r],r,e);return n}},function(e,t,n){var i=n(128),r=n(53),o=n(36);e.exports=function(e,t){for(var n=0,s=(t=r(t,e)?[t]:i(t)).length;null!=e&&n<s;)e=e[o(t[n++])];return n&&n==s?e:void 0}},function(e,t,n){function i(e,t,n,a,l){return e===t||(null==e||null==t||!o(e)&&!s(t)?e!==e&&t!==t:r(e,t,i,n,a,l))}var r=n(270),o=n(12),s=n(25);e.exports=i},function(e,t,n){var i=n(275),r=n(276),o=n(93),s=n(6),a=n(354);e.exports=function(e){return"function"==typeof e?e:null==e?o:"object"==typeof e?s(e)?r(e[0],e[1]):i(e):a(e)}},function(e,t,n){var i=n(6),r=n(340);e.exports=function(e){return i(e)?e:r(e)}},function(e,t,n){var i=n(253),r=n(261),o=n(286),s=1,a=2;e.exports=function(e,t,n,l,c,u){var h=c&a,d=e.length,p=t.length;if(d!=p&&!(h&&p>d))return!1;var f=u.get(e);if(f&&u.get(t))return f==t;var m=-1,g=!0,v=c&s?new i:void 0;for(u.set(e,t),u.set(t,e);++m<d;){var y=e[m],b=t[m];if(l)var x=h?l(b,y,m,t,e,u):l(y,b,m,e,t,u);if(void 0!==x){if(x)continue;g=!1;break}if(v){if(!r(t,function(e,t){if(!o(v,t)&&(y===e||n(y,e,l,c,u)))return v.push(t)})){g=!1;break}}else if(y!==b&&!n(y,b,l,c,u)){g=!1;break}}return u.delete(e),u.delete(t),g}},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(t,n(97))},function(e,t,n){var i=n(92)(Object.getPrototypeOf,Object);e.exports=i},function(e,t,n){var i=n(92),r=n(355),o=Object.getOwnPropertySymbols,s=o?i(o,Object):r;e.exports=s},function(e,t,n){var i=n(249),r=n(83),o=n(251),s=n(252),a=n(254),l=n(268),c=n(140),u=Object.prototype.toString,h=c(i),d=c(r),p=c(o),f=c(s),m=c(a),g=l;(i&&"[object DataView]"!=g(new i(new ArrayBuffer(1)))||r&&"[object Map]"!=g(new r)||o&&"[object Promise]"!=g(o.resolve())||s&&"[object Set]"!=g(new s)||a&&"[object WeakMap]"!=g(new a))&&(g=function(e){var t=u.call(e),n="[object Object]"==t?e.constructor:void 0,i=n?c(n):void 0;if(i)switch(i){case h:return"[object DataView]";case d:return"[object Map]";case p:return"[object Promise]";case f:return"[object Set]";case m:return"[object WeakMap]"}return t}),e.exports=g},function(e,t,n){var i=n(12);e.exports=function(e){return e===e&&!i(e)}},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach(function(e,i){n[++t]=[i,e]}),n}},function(e,t){e.exports=function(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}}},function(e,t,n){var i=n(257),r=Math.max;e.exports=function(e,t,n){return t=r(void 0===t?e.length-1:t,0),function(){for(var o=arguments,s=-1,a=r(o.length-t,0),l=Array(a);++s<a;)l[s]=o[t+s];s=-1;for(var c=Array(t+1);++s<t;)c[s]=o[s];return c[t]=n(l),i(e,this,c)}}},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}},function(e,t,n){var i=n(282),r=n(334)(i);e.exports=r},function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,n){var i=n(125);e.exports=function(e,t,n){var r=null==e?void 0:i(e,t);return void 0===r?n:r}},function(e,t,n){var i=n(12),r="[object Function]",o="[object GeneratorFunction]",s=Object.prototype.toString;e.exports=function(e){var t=i(e)?s.call(e):"";return t==r||t==o}},function(e,t,n){"use strict";var i=String.prototype.replace,r=/%20/g;e.exports={default:"RFC3986",formatters:{RFC1738:function(e){return i.call(e,r,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},function(e,t,n){"use strict";var i=Object.prototype.hasOwnProperty,r=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),o=function(e){for(var t;e.length;){var n=e.pop();if(t=n.obj[n.prop],Array.isArray(t)){for(var i=[],r=0;r<t.length;++r)void 0!==t[r]&&i.push(t[r]);n.obj[n.prop]=i}}return t};t.arrayToObject=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},i=0;i<e.length;++i)void 0!==e[i]&&(n[i]=e[i]);return n},t.merge=function(e,n,r){if(!n)return e;if("object"!=typeof n){if(Array.isArray(e))e.push(n);else{if("object"!=typeof e)return[e,n];(r.plainObjects||r.allowPrototypes||!i.call(Object.prototype,n))&&(e[n]=!0)}return e}if("object"!=typeof e)return[e].concat(n);var o=e;return Array.isArray(e)&&!Array.isArray(n)&&(o=t.arrayToObject(e,r)),Array.isArray(e)&&Array.isArray(n)?(n.forEach(function(n,o){i.call(e,o)?e[o]&&"object"==typeof e[o]?e[o]=t.merge(e[o],n,r):e.push(n):e[o]=n}),e):Object.keys(n).reduce(function(e,o){var s=n[o];return i.call(e,o)?e[o]=t.merge(e[o],s,r):e[o]=s,e},o)},t.assign=function(e,t){return Object.keys(t).reduce(function(e,n){return e[n]=t[n],e},e)},t.decode=function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}},t.encode=function(e){if(0===e.length)return e;for(var t="string"==typeof e?e:String(e),n="",i=0;i<t.length;++i){var o=t.charCodeAt(i);45===o||46===o||95===o||126===o||o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122?n+=t.charAt(i):o<128?n+=r[o]:o<2048?n+=r[192|o>>6]+r[128|63&o]:o<55296||o>=57344?n+=r[224|o>>12]+r[128|o>>6&63]+r[128|63&o]:(i+=1,o=65536+((1023&o)<<10|1023&t.charCodeAt(i)),n+=r[240|o>>18]+r[128|o>>12&63]+r[128|o>>6&63]+r[128|63&o])}return n},t.compact=function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],i=0;i<t.length;++i)for(var r=t[i],s=r.obj[r.prop],a=Object.keys(s),l=0;l<a.length;++l){var c=a[l],u=s[c];"object"==typeof u&&null!==u&&-1===n.indexOf(u)&&(t.push({obj:s,prop:c}),n.push(u))}return o(t)},t.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},t.isBuffer=function(e){return null!==e&&void 0!==e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e?n.url=e:n=e,!(this instanceof r))return new r(n);(0,s.default)(this,n);var i=this.resolve().then(function(){return t.disableInterfaces||(0,s.default)(t,r.makeApisTagOperation(t)),t});return i.client=this,i}var o=i(n(41)),s=i((i(n(341)),n(55))),a=i(n(96)),l=n(39),c=i(l),u=n(153),h=i(u),d=n(152),p=n(146),f=n(38);r.http=c.default,r.makeHttp=l.makeHttp.bind(null,r.http),r.resolve=h.default,r.execute=p.execute,r.serializeRes=l.serializeRes,r.serializeHeaders=l.serializeHeaders,r.clearCache=u.clearCache,r.parameterBuilders=p.PARAMETER_BUILDERS,r.makeApisTagOperation=d.makeApisTagOperation,r.buildRequest=p.buildRequest,r.helpers={opId:f.opId},e.exports=r,r.prototype={http:c.default,execute:function(e){return this.applyDefaults(),r.execute((0,o.default)({spec:this.spec,http:this.http.bind(this),securities:{authorized:this.authorizations}},e))},resolve:function(){var e=this;return r.resolve({spec:this.spec,url:this.url,allowMetaPatches:this.allowMetaPatches}).then(function(t){return e.originalSpec=e.spec,e.spec=t.spec,e.errors=t.errors,e})}},r.prototype.applyDefaults=function(){var e=this.spec,t=this.url;if(t&&0===t.indexOf("http")){var n=a.default.parse(t);e.host||(e.host=n.host),e.schemes||(e.schemes=[n.protocol.replace(":","")]),e.basePath||(e.basePath="/")}}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e){var t=e.spec,n=e.operationId,i=(e.securities,e.requestContentType,e.responseContentType),r=e.scheme,s=e.requestInterceptor,a=e.responseInterceptor,l=e.contextUrl,c=e.userFetch,u=(e.requestBody,e.server),d=e.serverVariables,p=e.parameters,f=e.parameterBuilders,m=(0,w.isOAS3)(t);f||(f=m?q.default:x.default);var g={url:o({spec:t,scheme:r,contextUrl:l,server:u,serverVariables:d}),credentials:"same-origin",headers:{}};if(s&&(g.requestInterceptor=s),a&&(g.responseInterceptor=a),c&&(g.userFetch=c),!n)return g;var y=(0,w.getOperationRaw)(t,n);if(!y)throw new D("Operation "+n+" not found");var b=y.operation,A=void 0===b?{}:b,E=y.method,I=y.pathName;g.url+=I,g.method=(""+E).toUpperCase(),p=p||{};var T=t.paths[I]||{};i&&(g.headers.accept=i);var L=[].concat(_(A.parameters)).concat(_(T.parameters));L.forEach(function(e){var n=f[e.in],i=void 0;if("body"===e.in&&e.schema&&e.schema.properties&&(i=p),void 0===(i=e&&e.name&&p[e.name])?i=e&&e.name&&p[e.in+"."+e.name]:M(e.name,L).length>1&&console.warn("Parameter '"+e.name+"' is ambiguous because the defined spec has more than one parameter with the name: '"+e.name+"' and the passed-in parameter values did not define an 'in' value."),void 0!==e.default&&void 0===i&&(i=e.default),void 0===i&&e.required&&!e.allowEmptyValue)throw new Error("Required parameter "+e.name+" is not provided");n&&n({req:g,parameter:e,value:i,operation:A,spec:t})});var k=(0,h.default)({},e,{operation:A});return g=m?(0,C.default)(k,g):(0,S.default)(k,g),(0,v.mergeInQueryOrForm)(g),g}function o(e){return(0,w.isOAS3)(e.spec)?s(e):c(e)}function s(e){var t=e.spec,n=e.server,i=e.contextUrl,r=e.serverVariables,o=void 0===r?{}:r,s=t.servers,c="",u=null;if(n){var h=s.map(function(e){return e.url});h.indexOf(n)>-1&&(c=n,u=s[h.indexOf(n)])}return!c&&s&&(c=s[0].url,u=s[0]),c.indexOf("{")>-1&&l(c).forEach(function(e){if(u.variables&&u.variables[e]){var t=u.variables[e],n=o[e]||t.default,i=new RegExp("{"+e+"}","g");c=c.replace(i,n)}}),a(c,i)}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=g.default.parse(e),i=g.default.parse(t),r=E(n.protocol)||E(i.protocol)||"",o=n.host||i.host,s=n.pathname||"";if(r&&o){var a=r+"://"+(o+s);return"/"===a[a.length-1]?a.slice(0,-1):a}return""}function l(e){for(var t=[],n=/{([^}]+)}/g,i=void 0;i=n.exec(e);)t.push(i[1]);return t}function c(e){var t=e.spec,n=e.scheme,i=e.contextUrl,r=void 0===i?"":i,o=g.default.parse(r),s=Array.isArray(t.schemes)?t.schemes[0]:null,a=n||s||E(o.protocol)||"http",l=t.host||o.host||"",c=t.basePath||"";if(a&&l){var u=a+"://"+(l+c);return"/"===u[u.length-1]?u.slice(0,-1):u}return""}Object.defineProperty(t,"__esModule",{value:!0}),t.self=void 0;var u=i(n(60)),h=i(n(41)),d=i(n(167)),p=i(n(13));t.execute=function(e){var t=e.http,n=e.fetch,i=e.spec,r=e.operationId,o=e.pathName,s=e.method,a=e.parameters,l=e.securities,c=(0,d.default)(e,["http","fetch","spec","operationId","pathName","method","parameters","securities"]);t=t||n||y.default,o&&s&&!r&&(r=(0,w.legacyIdFromPathMethod)(o,s));var p=A.buildRequest((0,h.default)({spec:i,operationId:r,parameters:a,securities:l},c));return p.body&&((0,f.default)(p.body)||(0,m.default)(p.body))&&(p.body=(0,u.default)(p.body)),t(p)},t.buildRequest=r,t.baseUrl=o;var f=i((i((i(n(55)),n(141))),n(349))),m=i(n(6)),g=i((i(n(103)),n(96))),v=n(39),y=i(v),b=i(n(98)),x=i(n(151)),q=i(n(148)),C=i(n(147)),S=i(n(150)),w=n(38),_=function(e){return Array.isArray(e)?e:[]},D=(0,b.default)("OperationNotFoundError",function(e,t,n){this.originalError=n,(0,p.default)(this,t||{})}),M=function(e,t){return t.filter(function(t){return t.name===e})},A=t.self={buildRequest:r},E=function(e){return e?e.replace(/\W/g,""):null}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(17)),o=i(n(7));t.default=function(e,t){var n=e.operation,i=e.requestBody,s=e.requestContentType,a=n.requestBody||{},l=(0,o.default)(a.content||{});if(i){var c=s&&l.indexOf(s)>-1;if(s&&c)t.headers["Content-Type"]=s;else if(!s){var u=l[0];u&&(t.headers["Content-Type"]=u,s=u)}}return i&&(s?l.indexOf(s)>-1&&("application/x-www-form-urlencoded"===s?"object"===(void 0===i?"undefined":(0,r.default)(i))?(t.form={},(0,o.default)(i).forEach(function(e){var n=i[e];t.form[e]={value:n}})):t.form=i:t.body=i):t.body=i),t}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(7)),o=i(n(17)),s=i(n(149));t.default={path:function(e){var t=e.req,n=e.value,i=e.parameter,r=i.name,o=i.style,a=i.explode,l=(0,s.default)({key:i.name,value:n,style:o||"simple",explode:a||!1,escape:!i.allowReserved});t.url=t.url.replace("{"+r+"}",l)},query:function(e){var t=e.req,n=e.value,i=e.parameter;if(t.query=t.query||{},!1===n&&(n="false"),0===n&&(n="0"),n){var a=void 0===n?"undefined":(0,o.default)(n);"deepObject"===i.style?(0,r.default)(n).forEach(function(e){var r=n[e];t.query[i.name+"["+e+"]"]={value:(0,s.default)({key:e,value:r,style:"deepObject",escape:!i.allowReserved}),skipEncoding:!0}}):"object"!==a||Array.isArray(n)||"form"!==i.style&&i.style||!i.explode&&void 0!==i.explode?t.query[i.name]={value:(0,s.default)({key:i.name,value:n,style:i.style||"form",explode:void 0===i.explode||i.explode,escape:!i.allowReserved}),skipEncoding:!0}:(0,r.default)(n).forEach(function(e){var r=n[e];t.query[e]={value:(0,s.default)({key:e,value:r,style:i.style||"form",escape:!i.allowReserved})}})}else if(i.allowEmptyValue){var l=i.name;t.query[l]=t.query[l]||{},t.query[l].allowEmptyValue=!0}},header:function(e){var t=e.req,n=e.parameter,i=e.value;t.headers=t.headers||{},void 0!==i&&(t.headers[n.name]=(0,s.default)({key:n.name,value:i,style:n.style||"simple",explode:void 0!==n.explode&&n.explode,escape:!n.allowReserved}))},cookie:function(e){var t=e.req,n=e.parameter,i=e.value;t.headers=t.headers||{};var r=void 0===i?"undefined":(0,o.default)(i);if("undefined"!==r){var a="object"===r&&!Array.isArray(i)&&n.explode?"":n.name+"=";t.headers.Cookie=a+(0,s.default)({key:n.name,value:i,escape:!1,style:n.style||"form",explode:void 0!==n.explode&&n.explode})}}}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e){var t=e.key,n=e.value,i=e.style,r=e.explode,o=e.escape;if("simple"===i)return n.join(",");if("label"===i)return"."+n.join(".");if("matrix"===i)return n.reduce(function(e,n){return!e||r?(e||"")+";"+t+"="+n:e+","+n},"");if("form"===i){var s=o?c(","):",",a=r?"&"+t+"=":s;return n.join(a)}if("spaceDelimited"===i){var l=r?t+"=":"";return n.join(""+c(" ")+l)}if("pipeDelimited"===i){var u=r?t+"=":"",h=o?c("|"):"|";return n.join(""+h+u)}}function o(e){var t=e.key,n=e.value,i=e.style,r=e.explode,o=(0,a.default)(n);return"simple"===i?o.reduce(function(e,t){var i=n[t],o=r?"=":",";return(e?e+",":"")+t+o+i},""):"label"===i?o.reduce(function(e,t){var i=n[t],o=r?"=":".";return(e?e+".":".")+t+o+i},""):"matrix"===i&&r?o.reduce(function(e,t){var i=n[t];return(e?e+";":";")+t+"="+i},""):"matrix"===i?o.reduce(function(e,i){var r=n[i];return(e?e+",":";"+t+"=")+i+","+r},""):"form"===i?o.reduce(function(e,t){var i=n[t];return(e?e+(r?"&":","):"")+t+(r?"=":",")+i},""):void 0}function s(e){var t=e.key,n=e.value,i=e.style;return e.explode,"simple"===i?n:"label"===i?"."+n:"matrix"===i?";"+t+"="+n:"form"===i?n:"deepObject"===i?n:void 0}Object.defineProperty(t,"__esModule",{value:!0});var a=i(n(7)),l=i(n(17));t.default=function(e){var t=e.value;return Array.isArray(t)?r(e):"object"===(void 0===t?"undefined":(0,l.default)(t))?o(e):s(e)};var c=function(e){return encodeURIComponent(e)}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e){var t=e.request,n=e.securities,i=void 0===n?{}:n,r=e.operation,l=void 0===r?{}:r,c=e.spec,u=(0,a.default)({},t),h=i.authorized,d=void 0===h?{}:h,p=i.specSecurity,f=void 0===p?[]:p,m=l.security||f,g=d&&!!(0,o.default)(d).length,v=c.securityDefinitions;return u.headers=u.headers||{},u.query=u.query||{},(0,o.default)(i).length&&g&&m&&(!Array.isArray(l.security)||l.security.length)?(m.forEach(function(e,t){for(var n in e){var i=d[n];if(i){var r=i.token,o=i.value||i,a=v[n],l=a.type,c=r&&r.access_token,h=r&&r.token_type;if(i)if("apiKey"===l){var p="query"===a.in?"query":"headers";u[p]=u[p]||{},u[p][a.name]=o}else"basic"===l?o.header?u.headers.authorization=o.header:(o.base64=(0,s.default)(o.username+":"+o.password),u.headers.authorization="Basic "+o.base64):"oauth2"===l&&c&&(u.headers.authorization=(h||"Bearer")+" "+c)}}}),u):t}Object.defineProperty(t,"__esModule",{value:!0});var o=i(n(7));t.default=function(e,t){var n=e.spec,i=e.operation,o=e.securities,s=e.requestContentType;return((t=r({request:t,securities:o,operation:i,spec:n})).body||t.form)&&(s?t.headers["Content-Type"]=s:Array.isArray(i.consumes)?t.headers["Content-Type"]=i.consumes[0]:Array.isArray(n.consumes)?t.headers["Content-Type"]=n.consumes[0]:i.parameters&&i.parameters.filter(function(e){return"file"===e.type}).length?t.headers["Content-Type"]="multipart/form-data":i.parameters&&i.parameters.filter(function(e){return"formData"===e.in}).length&&(t.headers["Content-Type"]="application/x-www-form-urlencoded")),t},t.applySecurities=r;var s=i(n(103)),a=i(n(55));i(n(39))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={body:function(e){var t=e.req,n=e.value;t.body=n},header:function(e){var t=e.req,n=e.parameter,i=e.value;t.headers=t.headers||{},void 0!==i&&(t.headers[n.name]=i)},query:function(e){var t=e.req,n=e.value,i=e.parameter;if(t.query=t.query||{},!1===n&&"boolean"===i.type&&(n="false"),0===n&&["number","integer"].indexOf(i.type)>-1&&(n="0"),n)t.query[i.name]={collectionFormat:i.collectionFormat,value:n};else if(i.allowEmptyValue){var r=i.name;t.query[r]=t.query[r]||{},t.query[r].allowEmptyValue=!0}},path:function(e){var t=e.req,n=e.value,i=e.parameter;t.url=t.url.replace("{"+i.name+"}",encodeURIComponent(n))},formData:function(e){var t=e.req,n=e.value,i=e.parameter;t.form=t.form||{},(n||i.allowEmptyValue)&&(t.form[i.name]={value:n,allowEmptyValue:i.allowEmptyValue,collectionFormat:i.collectionFormat})}}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){var n=t.pathName,i=t.method,r=t.operationId;return function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.execute((0,s.default)({spec:e.spec},(0,a.default)(e,"requestInterceptor","responseInterceptor","userFetch"),{pathName:n,method:i,parameters:t,operationId:r},o))}}}function o(e){var t=e.spec,n=e.cb,i=void 0===n?c:n,r=e.defaultTag,o=void 0===r?"default":r,s={},a={};return(0,l.eachOperation)(t,function(e){var n=e.pathName,r=e.method,c=e.operation;(c.tags?u(c.tags):[o]).forEach(function(e){if("string"==typeof e){var o=a[e]=a[e]||{},u=(0,l.opId)(c,n,r),h=i({spec:t,pathName:n,method:r,operation:c,operationId:u});if(s[u])s[u]++,o[""+u+s[u]]=h;else if(void 0!==o[u]){var d=s[u]||1;s[u]=d+1,o[""+u+s[u]]=h;var p=o[u];delete o[u],o[""+u+d]=p}else o[u]=h}})}),a}Object.defineProperty(t,"__esModule",{value:!0}),t.self=void 0;var s=i(n(41));t.makeExecute=r,t.makeApisTagOperationsOperationExecute=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=h.makeExecute(e),n=h.mapTagOperations({spec:e.spec,cb:t}),i={};for(var r in n){i[r]={operations:{}};for(var o in n[r])i[r].operations[o]={execute:n[r][o]}}return{apis:i}},t.makeApisTagOperation=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=h.makeExecute(e);return{apis:h.mapTagOperations({spec:e.spec,cb:t})}},t.mapTagOperations=o;var a=i(n(353)),l=n(38),c=function(){return null},u=function(e){return Array.isArray(e)?e:[e]},h=t.self={mapTagOperations:o,makeExecute:r}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e){return function(t){return e({url:t,loadSpec:!0,headers:{Accept:"application/json"},credentials:"same-origin"}).then(function(e){return e.body})}}Object.defineProperty(t,"__esModule",{value:!0}),t.makeFetchJSON=r,t.clearCache=function(){s.plugins.refs.clearCache()},t.default=function(e){function t(e){h&&(s.plugins.refs.docCache[h]=e),s.plugins.refs.fetchJSON=r(n);var t=[s.plugins.refs];return"function"==typeof g&&t.push(s.plugins.parameters),"function"==typeof m&&t.push(s.plugins.properties),"strict"!==d&&t.push(s.plugins.allOf),(0,a.default)({spec:e,context:{baseDoc:h},plugins:t,allowMetaPatches:f,parameterMacro:g,modelPropertyMacro:m}).then(l.normalizeSwagger)}var n=e.http,i=e.fetch,c=e.spec,u=e.url,h=e.baseDoc,d=e.mode,p=e.allowMetaPatches,f=void 0===p||p,m=e.modelPropertyMacro,g=e.parameterMacro;return h=h||u,n=i||n||o.default,c?t(c):r(n)(h).then(t)};var o=i(n(39)),s=n(154),a=i(s),l=n(38)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.plugins=t.SpecMap=void 0;var r=i(n(60)),o=i(n(99)),s=i(n(102)),a=i(n(7)),l=i(n(59)),c=i(n(162)),u=i(n(13)),h=i(n(100)),d=i(n(101));t.default=function(e){return new x(e).dispatch()};var p=i(n(343)),f=i(n(40)),m=i(n(159)),g=i(n(155)),v=i(n(157)),y=i(n(158)),b=i(n(156)),x=function(){function e(t){(0,h.default)(this,e),(0,u.default)(this,{spec:"",debugLevel:"info",plugins:[],pluginHistory:{},errors:[],mutations:[],promisedPatches:[],state:{},patches:[],context:{},contextTree:new b.default,showDebug:!1,allPatches:[],pluginProp:"specMap",libMethods:(0,u.default)((0,c.default)(this),f.default),allowMetaPatches:!1},t),this.get=this._get.bind(this),this.getContext=this._getContext.bind(this),this.hasRun=this._hasRun.bind(this),this.wrappedPlugins=this.plugins.map(this.wrapPlugin.bind(this)).filter(f.default.isFunction),this.patches.push(f.default.add([],this.spec)),this.patches.push(f.default.context([],this.context)),this.updatePatches(this.patches)}return(0,d.default)(e,[{key:"debug",value:function(e){if(this.debugLevel===e){for(var t,n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(t=console).log.apply(t,i)}}},{key:"verbose",value:function(e){if("verbose"===this.debugLevel){for(var t,n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(t=console).log.apply(t,["["+e+"]   "].concat(i))}}},{key:"wrapPlugin",value:function(e,t){var n=null,i=void 0;return e[this.pluginProp]?(n=e,i=e[this.pluginProp]):f.default.isFunction(e)?i=e:f.default.isObject(e)&&(i=function(e){return s.default.mark(function t(n,i){var r,o,c,u,h,d,p,m;return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:m=function t(n,o,c){var u,h,d,p,m,g,v,y,b,x,q,C;return s.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(f.default.isObject(n)){r.next=6;break}if(e.key!==o[o.length-1]){r.next=4;break}return r.next=4,e.plugin(n,e.key,o,i);case 4:r.next=41;break;case 6:u=o.length-1,h=o[u],d=o.indexOf("properties"),p="properties"===h&&u===d,m=!0,g=!1,v=void 0,r.prev=13,y=(0,l.default)((0,a.default)(n));case 15:if(m=(b=y.next()).done){r.next=27;break}if(x=b.value,q=n[x],C=o.concat(x),!f.default.isObject(q)){r.next=21;break}return r.delegateYield(t(q,C,c),"t0",21);case 21:if(p||x!==e.key){r.next=24;break}return r.next=24,e.plugin(q,x,C,i,c);case 24:m=!0,r.next=15;break;case 27:r.next=33;break;case 29:r.prev=29,r.t1=r.catch(13),g=!0,v=r.t1;case 33:r.prev=33,r.prev=34,!m&&y.return&&y.return();case 36:if(r.prev=36,!g){r.next=39;break}throw v;case 39:return r.finish(36);case 40:return r.finish(33);case 41:case"end":return r.stop()}},r,this,[[13,29,33,41],[34,,36,40]])},r=s.default.mark(m),o=!0,c=!1,u=void 0,t.prev=5,h=(0,l.default)(n.filter(f.default.isAdditiveMutation));case 7:if(o=(d=h.next()).done){t.next=13;break}return p=d.value,t.delegateYield(m(p.value,p.path,p),"t0",10);case 10:o=!0,t.next=7;break;case 13:t.next=19;break;case 15:t.prev=15,t.t1=t.catch(5),c=!0,u=t.t1;case 19:t.prev=19,t.prev=20,!o&&h.return&&h.return();case 22:if(t.prev=22,!c){t.next=25;break}throw u;case 25:return t.finish(22);case 26:return t.finish(19);case 27:case"end":return t.stop()}},t,this,[[5,15,19,27],[20,,22,26]])})}(e)),(0,u.default)(i.bind(n),{pluginName:e.name||t,isGenerator:f.default.isGenerator(i)})}},{key:"nextPlugin",value:function(){var e=this;return(0,p.default)(this.wrappedPlugins,function(t){return e.getMutationsForPlugin(t).length>0})}},{key:"nextPromisedPatch",value:function(){if(this.promisedPatches.length>0)return o.default.race(this.promisedPatches.map(function(e){return e.value}))}},{key:"getPluginHistory",value:function(e){var t=this.getPluginName(e);return this.pluginHistory[t]||[]}},{key:"getPluginRunCount",value:function(e){return this.getPluginHistory(e).length}},{key:"getPluginHistoryTip",value:function(e){var t=this.getPluginHistory(e);return t&&t[t.length-1]||{}}},{key:"getPluginMutationIndex",value:function(e){var t=this.getPluginHistoryTip(e).mutationIndex;return"number"!=typeof t?-1:t}},{key:"getPluginName",value:function(e){return e.pluginName}},{key:"updatePluginHistory",value:function(e,t){var n=this.getPluginName(e);(this.pluginHistory[n]=this.pluginHistory[n]||[]).push(t)}},{key:"updatePatches",value:function(e,t){var n=this;f.default.normalizeArray(e).forEach(function(e){if(e instanceof Error)n.errors.push(e);else try{if(!f.default.isObject(e))return void n.debug("updatePatches","Got a non-object patch",e);if(n.showDebug&&n.allPatches.push(e),f.default.isPromise(e.value))return n.promisedPatches.push(e),void n.promisedPatchThen(e);if(f.default.isContextPatch(e))return void n.setContext(e.path,e.value);if(f.default.isMutation(e))return void n.updateMutations(e)}catch(e){n.errors.push(e)}})}},{key:"updateMutations",value:function(e){f.default.applyPatch(this.state,e,{allowMetaPatches:this.allowMetaPatches})&&this.mutations.push(e)}},{key:"removePromisedPatch",value:function(e){var t=this.promisedPatches.indexOf(e);t<0?this.debug("Tried to remove a promisedPatch that isn't there!"):this.promisedPatches.splice(t,1)}},{key:"promisedPatchThen",value:function(e){var t=this;return e.value=e.value.then(function(n){var i=(0,u.default)({},e,{value:n});t.removePromisedPatch(e),t.updatePatches(i)}).catch(function(n){t.removePromisedPatch(e),t.updatePatches(n)})}},{key:"getMutations",value:function(e,t){return e=e||0,"number"!=typeof t&&(t=this.mutations.length),this.mutations.slice(e,t)}},{key:"getCurrentMutations",value:function(){return this.getMutationsForPlugin(this.getCurrentPlugin())}},{key:"getMutationsForPlugin",value:function(e){var t=this.getPluginMutationIndex(e);return this.getMutations(t+1)}},{key:"getCurrentPlugin",value:function(){return this.currentPlugin}},{key:"getPatchesOfType",value:function(e,t){return e.filter(t)}},{key:"getLib",value:function(){return this.libMethods}},{key:"_get",value:function(e){return f.default.getIn(this.state,e)}},{key:"_getContext",value:function(e){return this.contextTree.get(e)}},{key:"setContext",value:function(e,t){return this.contextTree.set(e,t)}},{key:"_hasRun",value:function(e){return this.getPluginRunCount(this.getCurrentPlugin())>(e||0)}},{key:"_clone",value:function(e){return JSON.parse((0,r.default)(e))}},{key:"dispatch",value:function(){function e(e){e&&(e=f.default.fullyNormalizeArray(e),n.updatePatches(e,i))}var t=this,n=this,i=this.nextPlugin();if(!i){var r=this.nextPromisedPatch();if(r)return r.then(function(){return t.dispatch()}).catch(function(){return t.dispatch()});var s={spec:this.state,errors:this.errors};return this.showDebug&&(s.patches=this.allPatches),o.default.resolve(s)}if(n.pluginCount=n.pluginCount||{},n.pluginCount[i]=(n.pluginCount[i]||0)+1,n.pluginCount[i]>100)return o.default.resolve({spec:n.state,errors:n.errors.concat(new Error("We've reached a hard limit of 100 plugin runs"))});if(i!==this.currentPlugin&&this.promisedPatches.length){var a=this.promisedPatches.map(function(e){return e.value});return o.default.all(a.map(function(e){return e.then(Function,Function)})).then(function(){return t.dispatch()})}return function(){n.currentPlugin=i;var t=n.getCurrentMutations(),r=n.mutations.length-1;try{if(i.isGenerator){var o=!0,s=!1,a=void 0;try{for(var h,d=(0,l.default)(i(t,n.getLib()));!(o=(h=d.next()).done);o=!0)e(h.value)}catch(e){s=!0,a=e}finally{try{!o&&d.return&&d.return()}finally{if(s)throw a}}}else e(i(t,n.getLib()))}catch(t){e([(0,u.default)((0,c.default)(t),{plugin:i})])}finally{n.updatePluginHistory(i,{mutationIndex:r})}return n.dispatch()}()}}]),e}(),q={refs:m.default,allOf:g.default,parameters:v.default,properties:y.default};t.SpecMap=x,t.plugins=q},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return e&&e.__esModule?e:{default:e}}(n(13));t.default={key:"allOf",plugin:function(e,t,n,r,o){if(!o.meta||!o.meta.$$ref){if(!Array.isArray(e)){var s=new TypeError("allOf must be an array");return s.fullPath=n,s}var a=n.slice(0,-1),l=!1,c=o.value;a.forEach(function(e){c=c[e]}),delete(c=(0,i.default)({},c)).allOf;var u=[r.replace(a,{})].concat(e.map(function(e,t){if(!r.isObject(e)){if(l)return null;l=!0;var i=new TypeError("Elements in allOf must be objects");return i.fullPath=n,i}return r.mergeDeep(a,e)}));return u.push(r.mergeDeep(a,c)),c.$$ref||u.push(r.remove([].concat(a,"$$ref"))),u}}}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){return o({children:{}},e,t)}function o(e,t,n){return e.value=t||{},e.protoValue=n?(0,a.default)({},n.protoValue,e.value):e.value,(0,s.default)(e.children).forEach(function(t){var n=e.children[t];e.children[t]=o(n,n.value,e)}),e}Object.defineProperty(t,"__esModule",{value:!0});var s=i(n(7)),a=i(n(41)),l=i(n(100)),c=i(n(101)),u=function(){function e(t){(0,l.default)(this,e),this.root=r(t||{})}return(0,c.default)(e,[{key:"set",value:function(e,t){var n=this.getParent(e,!0);if(n){var i=e[e.length-1],s=n.children;s[i]?o(s[i],t,n):s[i]=r(t,n)}else o(this.root,t,null)}},{key:"get",value:function(e){if((e=e||[]).length<1)return this.root.value;for(var t=this.root,n=void 0,i=void 0,r=0;r<e.length&&(i=e[r],(n=t.children)[i]);r++)t=n[i];return t&&t.protoValue}},{key:"getParent",value:function(e,t){return!e||e.length<1?null:e.length<2?this.root:e.slice(0,-1).reduce(function(e,n){if(!e)return e;var i=e.children;return!i[n]&&t&&(i[n]=r(null,e)),i[n]},this.root)}}]),e}();t.default=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(13)),o=i(n(40));t.default={key:"parameters",plugin:function(e,t,n,i,s){if(Array.isArray(e)&&e.length){var a=(0,r.default)([],e),l=n.slice(0,-1),c=(0,r.default)({},o.default.getIn(i.spec,l));return e.forEach(function(e,t){try{a[t].default=i.parameterMacro(c,e)}catch(e){var r=new Error(e);return r.fullPath=n,r}}),o.default.replace(n,a)}return o.default.replace(n,e)}}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(n(13)),o=i(n(40));t.default={key:"properties",plugin:function(e,t,n,i){var s=(0,r.default)({},e);for(var a in e)try{s[a].default=i.modelPropertyMacro(s[a])}catch(e){var l=new Error(e);return l.fullPath=n,l}return o.default.replace(n,s)}}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!D.test(e)){if(!t)throw new M("Tried to resolve a relative URL, without having a basePath. path: '"+e+"' basePath: '"+t+"'");return S.default.resolve(t,e)}return e}function o(e,t){return new M("Could not resolve reference because of: "+e.message,t,e)}function s(e){return(e+"").split("#")}function a(e,t){var n=A[e];if(n&&!w.default.isPromise(n))try{var i=c(t,n);return(0,q.default)(b.default.resolve(i),{__value:i})}catch(e){return b.default.reject(e)}return l(e).then(function(e){return c(t,e)})}function l(e){var t=A[e];return t?w.default.isPromise(t)?t:b.default.resolve(t):(A[e]=T.fetchJSON(e).then(function(t){return A[e]=t,t}),A[e])}function c(e,t){var n=u(e);if(n.length<1)return t;var i=w.default.getIn(t,n);if(void 0===i)throw new M("Could not resolve pointer: "+e+" does not exist in document",{pointer:e});return i}function u(e){if("string"!=typeof e)throw new TypeError("Expected a string, got a "+(void 0===e?"undefined":(0,v.default)(e)));return"/"===e[0]&&(e=e.substr(1)),""===e?[]:e.split("/").map(h)}function h(e){return"string"!=typeof e?e:e.replace(/~1/g,"/").replace(/~0/g,"~")}function d(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}function p(e){return 0===e.length?"":"/"+e.map(d).join("/")}function f(e,t){if(L(t))return!0;var n=e.charAt(t.length);return 0===e.indexOf(t)&&(!n||"/"===n||"#"===n)}function m(e,t,n,i){var r=E.get(i);r||(r={},E.set(i,r));var o=p(n),s=(t||"<specmap-base>")+"#"+e;if(t==i.contextTree.get([]).baseDoc&&f(o,e))return!0;var a="";if(n.some(function(e){return a=a+"/"+d(e),r[a]&&r[a].some(function(e){return f(e,s)||f(s,e)})}))return!0;r[o]=(r[o]||[]).concat(s)}function g(e,t){function n(e){return w.default.isObject(e)&&(i.indexOf(e)>=0||(0,y.default)(e).some(function(t){return n(e[t])}))}var i=[e];return t.path.reduce(function(e,t){return i.push(e[t]),e[t]},e),n(t.value)}Object.defineProperty(t,"__esModule",{value:!0});var v=i(n(17)),y=i(n(7)),b=i(n(99)),x=i(n(166)),q=i(n(13)),C=i(n(119)),S=i(n(96)),w=i(n(40)),_=i(n(98)),D=new RegExp("^([a-z]+://|//)","i"),M=(0,_.default)("JSONRefError",function(e,t,n){this.originalError=n,(0,q.default)(this,t||{})}),A={},E=new x.default,I={key:"$ref",plugin:function(e,t,n,i){var l=n.slice(0,-1),c=i.getContext(n).baseDoc;if("string"!=typeof e)return new M("$ref: must be a string (JSON-Ref)",{$ref:e,baseDoc:c,fullPath:n});var h=s(e),d=h[0],p=h[1]||"",f=void 0;try{f=c||d?r(d,c):null}catch(t){return o(t,{pointer:p,$ref:e,basePath:f,fullPath:n})}var v=void 0,y=void 0;if(!m(p,f,l,i)){if(null==f?(y=u(p),void 0===(v=i.get(y))&&(v=new M("Could not resolve reference: "+e,{pointer:p,$ref:e,baseDoc:c,fullPath:n}))):(v=a(f,p),v=null!=v.__value?v.__value:v.catch(function(t){throw o(t,{pointer:p,$ref:e,baseDoc:c,fullPath:n})})),v instanceof Error)return[w.default.remove(n),v];var b=w.default.replace(l,v,{$$ref:e});return f&&f!==c?[b,w.default.context(l,{baseDoc:f})]:g(i.state,b)?void 0:b}}},T=(0,q.default)(I,{docCache:A,absoluteify:r,clearCache:function(e){void 0!==e?delete A[e]:(0,y.default)(A).forEach(function(e){delete A[e]})},JSONRefError:M,wrapError:o,getDoc:l,split:s,extractFromDoc:a,fetchJSON:function(e){return(0,C.default)(e,{headers:{Accept:"application/json"},loadSpec:!0}).then(function(e){return e.json()})},extract:c,jsonPointerToArray:u,unescapeJsonPointerToken:h});t.default=T;var L=function(e){return!e||"/"===e||"#"===e}},function(e,t,n){e.exports={default:n(171),__esModule:!0}},function(e,t,n){e.exports={default:n(173),__esModule:!0}},function(e,t,n){e.exports={default:n(176),__esModule:!0}},function(e,t,n){e.exports={default:n(177),__esModule:!0}},function(e,t,n){e.exports={default:n(180),__esModule:!0}},function(e,t,n){e.exports={default:n(181),__esModule:!0}},function(e,t,n){e.exports={default:n(182),__esModule:!0}},function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){var n={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var r=i(n(161)),o=i(n(59));t.default=function(){function e(e,t){var n=[],i=!0,r=!1,s=void 0;try{for(var a,l=(0,o.default)(e);!(i=(a=l.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(r)throw s}}return n}return function(t,n){if(Array.isArray(t))return t;if((0,r.default)(Object(t)))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},function(e,t,n){"use strict";t.__esModule=!0;var i=function(e){return e&&e.__esModule?e:{default:e}}(n(160));t.default=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,i.default)(e)}},function(e,t,n){"use strict";function i(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function r(e){return s[e>>18&63]+s[e>>12&63]+s[e>>6&63]+s[63&e]}function o(e,t,n){for(var i,o=[],s=t;s<n;s+=3)i=(e[s]<<16)+(e[s+1]<<8)+e[s+2],o.push(r(i));return o.join("")}t.byteLength=function(e){return 3*e.length/4-i(e)},t.toByteArray=function(e){var t,n,r,o,s,c=e.length;o=i(e),s=new l(3*c/4-o),n=o>0?c-4:c;var u=0;for(t=0;t<n;t+=4)r=a[e.charCodeAt(t)]<<18|a[e.charCodeAt(t+1)]<<12|a[e.charCodeAt(t+2)]<<6|a[e.charCodeAt(t+3)],s[u++]=r>>16&255,s[u++]=r>>8&255,s[u++]=255&r;return 2===o?(r=a[e.charCodeAt(t)]<<2|a[e.charCodeAt(t+1)]>>4,s[u++]=255&r):1===o&&(r=a[e.charCodeAt(t)]<<10|a[e.charCodeAt(t+1)]<<4|a[e.charCodeAt(t+2)]>>2,s[u++]=r>>8&255,s[u++]=255&r),s},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,r="",a=[],l=0,c=n-i;l<c;l+=16383)a.push(o(e,l,l+16383>c?c:l+16383));return 1===i?(t=e[n-1],r+=s[t>>2],r+=s[t<<4&63],r+="=="):2===i&&(t=(e[n-2]<<8)+e[n-1],r+=s[t>>10],r+=s[t>>4&63],r+=s[t<<2&63],r+="="),a.push(r),a.join("")};for(var s=[],a=[],l="undefined"!=typeof Uint8Array?Uint8Array:Array,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=0,h=c.length;u<h;++u)s[u]=c[u],a[c.charCodeAt(u)]=u;a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},function(e,t,n){n(32),n(207),e.exports=n(0).Array.from},function(e,t,n){n(33),n(32),e.exports=n(205)},function(e,t,n){n(33),n(32),e.exports=n(206)},function(e,t,n){var i=n(0),r=i.JSON||(i.JSON={stringify:JSON.stringify});e.exports=function(e){return r.stringify.apply(r,arguments)}},function(e,t,n){n(209),e.exports=n(0).Object.assign},function(e,t,n){n(210);var i=n(0).Object;e.exports=function(e,t){return i.create(e,t)}},function(e,t,n){n(211);var i=n(0).Object;e.exports=function(e,t,n){return i.defineProperty(e,t,n)}},function(e,t,n){n(212),e.exports=n(0).Object.keys},function(e,t,n){n(81),n(32),n(33),n(213),n(216),n(217),e.exports=n(0).Promise},function(e,t,n){n(214),n(81),n(218),n(219),e.exports=n(0).Symbol},function(e,t,n){n(32),n(33),e.exports=n(79).f("iterator")},function(e,t,n){n(81),n(33),n(215),n(221),n(220),e.exports=n(0).WeakMap},function(e,t){e.exports=function(){}},function(e,t,n){var i=n(22),r=n(46),o=n(204);e.exports=function(e){return function(t,n,s){var a,l=i(t),c=r(l.length),u=o(s,c);if(e&&n!=n){for(;c>u;)if((a=l[u++])!=a)return!0}else for(;c>u;u++)if((e||u in l)&&l[u]===n)return e||u||0;return!e&&-1}}},function(e,t,n){var i=n(5),r=n(107),o=n(2)("species");e.exports=function(e){var t;return r(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!r(t.prototype)||(t=void 0),i(t)&&null===(t=t[o])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){var i=n(185);e.exports=function(e,t){return new(i(e))(t)}},function(e,t,n){"use strict";var i=n(72),r=n(44).getWeak,o=n(8),s=n(5),a=n(62),l=n(42),c=n(63),u=n(15),h=n(118),d=c(5),p=c(6),f=0,m=function(e){return e._l||(e._l=new g)},g=function(){this.a=[]},v=function(e,t){return d(e.a,function(e){return e[0]===t})};g.prototype={get:function(e){var t=v(this,e);if(t)return t[1]},has:function(e){return!!v(this,e)},set:function(e,t){var n=v(this,e);n?n[1]=t:this.a.push([e,t])},delete:function(e){var t=p(this.a,function(t){return t[0]===e});return~t&&this.a.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,n,o){var c=e(function(e,i){a(e,c,t,"_i"),e._t=t,e._i=f++,e._l=void 0,void 0!=i&&l(i,n,e[o],e)});return i(c.prototype,{delete:function(e){if(!s(e))return!1;var n=r(e);return!0===n?m(h(this,t)).delete(e):n&&u(n,this._i)&&delete n[this._i]},has:function(e){if(!s(e))return!1;var n=r(e);return!0===n?m(h(this,t)).has(e):n&&u(n,this._i)}}),c},def:function(e,t,n){var i=r(o(t),!0);return!0===i?m(e).set(t,n):i[e._i]=n,e},ufstore:m}},function(e,t,n){"use strict";var i=n(3),r=n(4),o=n(44),s=n(14),a=n(16),l=n(72),c=n(42),u=n(62),h=n(5),d=n(30),p=n(9).f,f=n(63)(0),m=n(11);e.exports=function(e,t,n,g,v,y){var b=i[e],x=b,q=v?"set":"add",C=x&&x.prototype,S={};return m&&"function"==typeof x&&(y||C.forEach&&!s(function(){(new x).entries().next()}))?(x=t(function(t,n){u(t,x,e,"_c"),t._c=new b,void 0!=n&&c(n,v,t[q],t)}),f("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in C&&(!y||"clear"!=e)&&a(x.prototype,e,function(n,i){if(u(this,x,e),!t&&y&&!h(n))return"get"==e&&void 0;var r=this._c[e](0===n?0:n,i);return t?this:r})}),y||p(x.prototype,"size",{get:function(){return this._c.size}})):(x=g.getConstructor(t,e,v,q),l(x.prototype,n),o.NEED=!0),d(x,e),S[e]=x,r(r.G+r.W+r.F,S),y||g.setStrong(x,e,v),x}},function(e,t,n){"use strict";var i=n(9),r=n(29);e.exports=function(e,t,n){t in e?i.f(e,t,r(0,n)):e[t]=n}},function(e,t,n){var i=n(28),r=n(71),o=n(45);e.exports=function(e){var t=i(e),n=r.f;if(n)for(var s,a=n(e),l=o.f,c=0;a.length>c;)l.call(e,s=a[c++])&&t.push(s);return t}},function(e,t){e.exports=function(e,t,n){var i=void 0===n;switch(t.length){case 0:return i?e():e.call(n);case 1:return i?e(t[0]):e.call(n,t[0]);case 2:return i?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){"use strict";var i=n(70),r=n(29),o=n(30),s={};n(16)(s,n(2)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=i(s,{next:r(1,n)}),o(e,t+" Iterator")}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){var i=n(3),r=n(117).set,o=i.MutationObserver||i.WebKitMutationObserver,s=i.process,a=i.Promise,l="process"==n(27)(s);e.exports=function(){var e,t,n,c=function(){var i,r;for(l&&(i=s.domain)&&i.exit();e;){r=e.fn,e=e.next;try{r()}catch(i){throw e?n():t=void 0,i}}t=void 0,i&&i.enter()};if(l)n=function(){s.nextTick(c)};else if(o){var u=!0,h=document.createTextNode("");new o(c).observe(h,{characterData:!0}),n=function(){h.data=u=!u}}else if(a&&a.resolve){var d=a.resolve();n=function(){d.then(c)}}else n=function(){r.call(i,c)};return function(i){var r={fn:i,next:void 0};t&&(t.next=r),e||(e=r,n()),t=r}}},function(e,t,n){var i=n(9),r=n(8),o=n(28);e.exports=n(11)?Object.defineProperties:function(e,t){r(e);for(var n,s=o(t),a=s.length,l=0;a>l;)i.f(e,n=s[l++],t[n]);return e}},function(e,t,n){var i=n(45),r=n(29),o=n(22),s=n(77),a=n(15),l=n(105),c=Object.getOwnPropertyDescriptor;t.f=n(11)?c:function(e,t){if(e=o(e),t=s(t,!0),l)try{return c(e,t)}catch(e){}if(a(e,t))return r(!i.f.call(e,t),e[t])}},function(e,t,n){var i=n(22),r=n(112).f,o={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],a=function(e){try{return r(e)}catch(e){return s.slice()}};e.exports.f=function(e){return s&&"[object Window]"==o.call(e)?a(e):r(i(e))}},function(e,t,n){var i=n(15),r=n(31),o=n(74)("IE_PROTO"),s=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=r(e),i(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},function(e,t,n){var i=n(4),r=n(0),o=n(14);e.exports=function(e,t){var n=(r.Object||{})[e]||Object[e],s={};s[e]=t(n),i(i.S+i.F*o(function(){n(1)}),"Object",s)}},function(e,t,n){"use strict";var i=n(4),r=n(26),o=n(18),s=n(42);e.exports=function(e){i(i.S,e,{from:function(e){var t,n,i,a,l=arguments[1];return r(this),(t=void 0!==l)&&r(l),void 0==e?new this:(n=[],t?(i=0,a=o(l,arguments[2],2),s(e,!1,function(e){n.push(a(e,i++))})):s(e,!1,n.push,n),new this(n))}})}},function(e,t,n){"use strict";var i=n(4);e.exports=function(e){i(i.S,e,{of:function(){for(var e=arguments.length,t=Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},function(e,t,n){"use strict";var i=n(3),r=n(0),o=n(9),s=n(11),a=n(2)("species");e.exports=function(e){var t="function"==typeof r[e]?r[e]:i[e];s&&t&&!t[a]&&o.f(t,a,{configurable:!0,get:function(){return this}})}},function(e,t,n){var i=n(76),r=n(65);e.exports=function(e){return function(t,n){var o,s,a=String(r(t)),l=i(n),c=a.length;return l<0||l>=c?e?"":void 0:(o=a.charCodeAt(l))<55296||o>56319||l+1===c||(s=a.charCodeAt(l+1))<56320||s>57343?e?a.charAt(l):o:e?a.slice(l,l+2):s-56320+(o-55296<<10)+65536}}},function(e,t,n){var i=n(76),r=Math.max,o=Math.min;e.exports=function(e,t){return(e=i(e))<0?r(e+t,0):o(e,t)}},function(e,t,n){var i=n(8),r=n(80);e.exports=n(0).getIterator=function(e){var t=r(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return i(t.call(e))}},function(e,t,n){var i=n(64),r=n(2)("iterator"),o=n(21);e.exports=n(0).isIterable=function(e){var t=Object(e);return void 0!==t[r]||"@@iterator"in t||o.hasOwnProperty(i(t))}},function(e,t,n){"use strict";var i=n(18),r=n(4),o=n(31),s=n(108),a=n(106),l=n(46),c=n(189),u=n(80);r(r.S+r.F*!n(110)(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,r,h,d=o(e),p="function"==typeof this?this:Array,f=arguments.length,m=f>1?arguments[1]:void 0,g=void 0!==m,v=0,y=u(d);if(g&&(m=i(m,f>2?arguments[2]:void 0,2)),void 0==y||p==Array&&a(y))for(t=l(d.length),n=new p(t);t>v;v++)c(n,v,g?m(d[v],v):d[v]);else for(h=y.call(d),n=new p;!(r=h.next()).done;v++)c(n,v,g?s(h,m,[r.value,v],!0):r.value);return n.length=v,n}})},function(e,t,n){"use strict";var i=n(183),r=n(193),o=n(21),s=n(22);e.exports=n(109)(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,r(1)):"keys"==t?r(0,n):"values"==t?r(0,e[n]):r(0,[n,e[n]])},"values"),o.Arguments=o.Array,i("keys"),i("values"),i("entries")},function(e,t,n){var i=n(4);i(i.S+i.F,"Object",{assign:n(111)})},function(e,t,n){var i=n(4);i(i.S,"Object",{create:n(70)})},function(e,t,n){var i=n(4);i(i.S+i.F*!n(11),"Object",{defineProperty:n(9).f})},function(e,t,n){var i=n(31),r=n(28);n(199)("keys",function(){return function(e){return r(i(e))}})},function(e,t,n){"use strict";var i,r,o,s,a=n(43),l=n(3),c=n(18),u=n(64),h=n(4),d=n(5),p=n(26),f=n(62),m=n(42),g=n(116),v=n(117).set,y=n(194)(),b=n(69),x=n(114),q=n(115),C=l.TypeError,S=l.process,w=l.Promise,_="process"==u(S),D=function(){},M=r=b.f,A=!!function(){try{var e=w.resolve(1),t=(e.constructor={})[n(2)("species")]=function(e){e(D,D)};return(_||"function"==typeof PromiseRejectionEvent)&&e.then(D)instanceof t}catch(e){}}(),E=function(e){var t;return!(!d(e)||"function"!=typeof(t=e.then))&&t},I=function(e,t){if(!e._n){e._n=!0;var n=e._c;y(function(){for(var i=e._v,r=1==e._s,o=0;n.length>o;)!function(t){var n,o,s=r?t.ok:t.fail,a=t.resolve,l=t.reject,c=t.domain;try{s?(r||(2==e._h&&k(e),e._h=1),!0===s?n=i:(c&&c.enter(),n=s(i),c&&c.exit()),n===t.promise?l(C("Promise-chain cycle")):(o=E(n))?o.call(n,a,l):a(n)):l(i)}catch(e){l(e)}}(n[o++]);e._c=[],e._n=!1,t&&!e._h&&T(e)})}},T=function(e){v.call(l,function(){var t,n,i,r=e._v,o=L(e);if(o&&(t=x(function(){_?S.emit("unhandledRejection",r,e):(n=l.onunhandledrejection)?n({promise:e,reason:r}):(i=l.console)&&i.error&&i.error("Unhandled promise rejection",r)}),e._h=_||L(e)?2:1),e._a=void 0,o&&t.e)throw t.v})},L=function(e){if(1==e._h)return!1;for(var t,n=e._a||e._c,i=0;n.length>i;)if((t=n[i++]).fail||!L(t.promise))return!1;return!0},k=function(e){v.call(l,function(){var t;_?S.emit("rejectionHandled",e):(t=l.onrejectionhandled)&&t({promise:e,reason:e._v})})},O=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),I(t,!0))},P=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw C("Promise can't be resolved itself");(t=E(e))?y(function(){var i={_w:n,_d:!1};try{t.call(e,c(P,i,1),c(O,i,1))}catch(e){O.call(i,e)}}):(n._v=e,n._s=1,I(n,!1))}catch(e){O.call({_w:n,_d:!1},e)}}};A||(w=function(e){f(this,w,"Promise","_h"),p(e),i.call(this);try{e(c(P,this,1),c(O,this,1))}catch(e){O.call(this,e)}},i=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},i.prototype=n(72)(w.prototype,{then:function(e,t){var n=M(g(this,w));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=_?S.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&I(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new i;this.promise=e,this.resolve=c(P,e,1),this.reject=c(O,e,1)},b.f=M=function(e){return e===w||e===s?new o(e):r(e)}),h(h.G+h.W+h.F*!A,{Promise:w}),n(30)(w,"Promise"),n(202)("Promise"),s=n(0).Promise,h(h.S+h.F*!A,"Promise",{reject:function(e){var t=M(this);return(0,t.reject)(e),t.promise}}),h(h.S+h.F*(a||!A),"Promise",{resolve:function(e){return q(a&&this===s?w:this,e)}}),h(h.S+h.F*!(A&&n(110)(function(e){w.all(e).catch(D)})),"Promise",{all:function(e){var t=this,n=M(t),i=n.resolve,r=n.reject,o=x(function(){var n=[],o=0,s=1;m(e,!1,function(e){var a=o++,l=!1;n.push(void 0),s++,t.resolve(e).then(function(e){l||(l=!0,n[a]=e,--s||i(n))},r)}),--s||i(n)});return o.e&&r(o.v),n.promise},race:function(e){var t=this,n=M(t),i=n.reject,r=x(function(){m(e,!1,function(e){t.resolve(e).then(n.resolve,i)})});return r.e&&i(r.v),n.promise}})},function(e,t,n){"use strict";var i=n(3),r=n(15),o=n(11),s=n(4),a=n(73),l=n(44).KEY,c=n(14),u=n(75),h=n(30),d=n(47),p=n(2),f=n(79),m=n(78),g=n(190),v=n(107),y=n(8),b=n(22),x=n(77),q=n(29),C=n(70),S=n(197),w=n(196),_=n(9),D=n(28),M=w.f,A=_.f,E=S.f,I=i.Symbol,T=i.JSON,L=T&&T.stringify,k=p("_hidden"),O=p("toPrimitive"),P={}.propertyIsEnumerable,N=u("symbol-registry"),R=u("symbols"),F=u("op-symbols"),j=Object.prototype,V="function"==typeof I,H=i.QObject,B=!H||!H.prototype||!H.prototype.findChild,z=o&&c(function(){return 7!=C(A({},"a",{get:function(){return A(this,"a",{value:7}).a}})).a})?function(e,t,n){var i=M(j,t);i&&delete j[t],A(e,t,n),i&&e!==j&&A(j,t,i)}:A,$=function(e){var t=R[e]=C(I.prototype);return t._k=e,t},U=V&&"symbol"==typeof I.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof I},G=function(e,t,n){return e===j&&G(F,t,n),y(e),t=x(t,!0),y(n),r(R,t)?(n.enumerable?(r(e,k)&&e[k][t]&&(e[k][t]=!1),n=C(n,{enumerable:q(0,!1)})):(r(e,k)||A(e,k,q(1,{})),e[k][t]=!0),z(e,t,n)):A(e,t,n)},W=function(e,t){y(e);for(var n,i=g(t=b(t)),r=0,o=i.length;o>r;)G(e,n=i[r++],t[n]);return e},X=function(e){var t=P.call(this,e=x(e,!0));return!(this===j&&r(R,e)&&!r(F,e))&&(!(t||!r(this,e)||!r(R,e)||r(this,k)&&this[k][e])||t)},Y=function(e,t){if(e=b(e),t=x(t,!0),e!==j||!r(R,t)||r(F,t)){var n=M(e,t);return!n||!r(R,t)||r(e,k)&&e[k][t]||(n.enumerable=!0),n}},K=function(e){for(var t,n=E(b(e)),i=[],o=0;n.length>o;)r(R,t=n[o++])||t==k||t==l||i.push(t);return i},Q=function(e){for(var t,n=e===j,i=E(n?F:b(e)),o=[],s=0;i.length>s;)!r(R,t=i[s++])||n&&!r(j,t)||o.push(R[t]);return o};V||(I=function(){if(this instanceof I)throw TypeError("Symbol is not a constructor!");var e=d(arguments.length>0?arguments[0]:void 0),t=function(n){this===j&&t.call(F,n),r(this,k)&&r(this[k],e)&&(this[k][e]=!1),z(this,e,q(1,n))};return o&&B&&z(j,e,{configurable:!0,set:t}),$(e)},a(I.prototype,"toString",function(){return this._k}),w.f=Y,_.f=G,n(112).f=S.f=K,n(45).f=X,n(71).f=Q,o&&!n(43)&&a(j,"propertyIsEnumerable",X,!0),f.f=function(e){return $(p(e))}),s(s.G+s.W+s.F*!V,{Symbol:I});for(var Z="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),J=0;Z.length>J;)p(Z[J++]);for(var ee=D(p.store),te=0;ee.length>te;)m(ee[te++]);s(s.S+s.F*!V,"Symbol",{for:function(e){return r(N,e+="")?N[e]:N[e]=I(e)},keyFor:function(e){if(!U(e))throw TypeError(e+" is not a symbol!");for(var t in N)if(N[t]===e)return t},useSetter:function(){B=!0},useSimple:function(){B=!1}}),s(s.S+s.F*!V,"Object",{create:function(e,t){return void 0===t?C(e):W(C(e),t)},defineProperty:G,defineProperties:W,getOwnPropertyDescriptor:Y,getOwnPropertyNames:K,getOwnPropertySymbols:Q}),T&&s(s.S+s.F*(!V||c(function(){var e=I();return"[null]"!=L([e])||"{}"!=L({a:e})||"{}"!=L(Object(e))})),"JSON",{stringify:function(e){if(void 0!==e&&!U(e)){for(var t,n,i=[e],r=1;arguments.length>r;)i.push(arguments[r++]);return"function"==typeof(t=i[1])&&(n=t),!n&&v(t)||(t=function(e,t){if(n&&(t=n.call(this,e,t)),!U(t))return t}),i[1]=t,L.apply(T,i)}}}),I.prototype[O]||n(16)(I.prototype,O,I.prototype.valueOf),h(I,"Symbol"),h(Math,"Math",!0),h(i.JSON,"JSON",!0)},function(e,t,n){"use strict";var i,r=n(63)(0),o=n(73),s=n(44),a=n(111),l=n(187),c=n(5),u=n(14),h=n(118),d=s.getWeak,p=Object.isExtensible,f=l.ufstore,m={},g=function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},v={get:function(e){if(c(e)){var t=d(e);return!0===t?f(h(this,"WeakMap")).get(e):t?t[this._i]:void 0}},set:function(e,t){return l.def(h(this,"WeakMap"),e,t)}},y=e.exports=n(188)("WeakMap",g,v,l,!0,!0);u(function(){return 7!=(new y).set((Object.freeze||Object)(m),7).get(m)})&&(i=l.getConstructor(g,"WeakMap"),a(i.prototype,v),s.NEED=!0,r(["delete","has","get","set"],function(e){var t=y.prototype,n=t[e];o(t,e,function(t,r){if(c(t)&&!p(t)){this._f||(this._f=new i);var o=this._f[e](t,r);return"set"==e?this:o}return n.call(this,t,r)})}))},function(e,t,n){"use strict";var i=n(4),r=n(0),o=n(3),s=n(116),a=n(115);i(i.P+i.R,"Promise",{finally:function(e){var t=s(this,r.Promise||o.Promise),n="function"==typeof e;return this.then(n?function(n){return a(t,e()).then(function(){return n})}:e,n?function(n){return a(t,e()).then(function(){throw n})}:e)}})},function(e,t,n){"use strict";var i=n(4),r=n(69),o=n(114);i(i.S,"Promise",{try:function(e){var t=r.f(this),n=o(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},function(e,t,n){n(78)("asyncIterator")},function(e,t,n){n(78)("observable")},function(e,t,n){n(200)("WeakMap")},function(e,t,n){n(201)("WeakMap")},function(e,t,n){"use strict";(function(t){function n(e){return e instanceof t||e instanceof Date||e instanceof RegExp}function i(e){if(e instanceof t){var n=new t(e.length);return e.copy(n),n}if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e);throw new Error("Unexpected situation")}function r(e){var t=[];return e.forEach(function(e,s){"object"==typeof e&&null!==e?Array.isArray(e)?t[s]=r(e):n(e)?t[s]=i(e):t[s]=o({},e):t[s]=e}),t}var o=e.exports=function(){if(arguments.length<1||"object"!=typeof arguments[0])return!1;if(arguments.length<2)return arguments[0];var e,t,s=arguments[0];return Array.prototype.slice.call(arguments,1).forEach(function(a){"object"!=typeof a||null===a||Array.isArray(a)||Object.keys(a).forEach(function(l){return t=s[l],(e=a[l])===s?void 0:"object"!=typeof e||null===e?void(s[l]=e):Array.isArray(e)?void(s[l]=r(e)):n(e)?void(s[l]=i(e)):"object"!=typeof t||null===t||Array.isArray(t)?void(s[l]=o({},e)):void(s[l]=o(t,e))})}),s}}).call(t,n(61).Buffer)},function(e,t,n){!function(t,n){e.exports=n()}(0,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(e,t,n){var i=null,a=function(e,t){n&&n(e,t),i&&i.visit(e,t)},l="function"==typeof n?a:null,c=!1;if(t){c="boolean"==typeof t.comment&&t.comment;var u="boolean"==typeof t.attachComment&&t.attachComment;(c||u)&&(i=new r.CommentHandler,i.attach=u,t.comment=!0,l=a)}var h=!1;t&&"string"==typeof t.sourceType&&(h="module"===t.sourceType);var d;d=t&&"boolean"==typeof t.jsx&&t.jsx?new o.JSXParser(e,t,l):new s.Parser(e,t,l);var p=h?d.parseModule():d.parseScript();return c&&i&&(p.comments=i.comments),d.config.tokens&&(p.tokens=d.tokens),d.config.tolerant&&(p.errors=d.errorHandler.errors),p}Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(3),s=n(8),a=n(15);t.parse=i,t.parseModule=function(e,t,n){var r=t||{};return r.sourceType="module",i(e,r,n)},t.parseScript=function(e,t,n){var r=t||{};return r.sourceType="script",i(e,r,n)},t.tokenize=function(e,t,n){var i,r=new a.Tokenizer(e,t);i=[];try{for(;;){var o=r.getNextToken();if(!o)break;n&&(o=n(o)),i.push(o)}}catch(e){r.errorHandler.tolerate(e)}return r.errorHandler.tolerant&&(i.errors=r.errors()),i};var l=n(2);t.Syntax=l.Syntax,t.version="4.0.0"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(){function e(){this.attach=!1,this.comments=[],this.stack=[],this.leading=[],this.trailing=[]}return e.prototype.insertInnerComments=function(e,t){if(e.type===i.Syntax.BlockStatement&&0===e.body.length){for(var n=[],r=this.leading.length-1;r>=0;--r){var o=this.leading[r];t.end.offset>=o.start&&(n.unshift(o.comment),this.leading.splice(r,1),this.trailing.splice(r,1))}n.length&&(e.innerComments=n)}},e.prototype.findTrailingComments=function(e){var t=[];if(this.trailing.length>0){for(var n=this.trailing.length-1;n>=0;--n){var i=this.trailing[n];i.start>=e.end.offset&&t.unshift(i.comment)}return this.trailing.length=0,t}var r=this.stack[this.stack.length-1];if(r&&r.node.trailingComments){var o=r.node.trailingComments[0];o&&o.range[0]>=e.end.offset&&(t=r.node.trailingComments,delete r.node.trailingComments)}return t},e.prototype.findLeadingComments=function(e){for(var t,n=[];this.stack.length>0&&((o=this.stack[this.stack.length-1])&&o.start>=e.start.offset);)t=o.node,this.stack.pop();if(t){for(r=(t.leadingComments?t.leadingComments.length:0)-1;r>=0;--r){var i=t.leadingComments[r];i.range[1]<=e.start.offset&&(n.unshift(i),t.leadingComments.splice(r,1))}return t.leadingComments&&0===t.leadingComments.length&&delete t.leadingComments,n}for(var r=this.leading.length-1;r>=0;--r){var o=this.leading[r];o.start<=e.start.offset&&(n.unshift(o.comment),this.leading.splice(r,1))}return n},e.prototype.visitNode=function(e,t){if(!(e.type===i.Syntax.Program&&e.body.length>0)){this.insertInnerComments(e,t);var n=this.findTrailingComments(t),r=this.findLeadingComments(t);r.length>0&&(e.leadingComments=r),n.length>0&&(e.trailingComments=n),this.stack.push({node:e,start:t.start.offset})}},e.prototype.visitComment=function(e,t){var n="L"===e.type[0]?"Line":"Block",i={type:n,value:e.value};if(e.range&&(i.range=e.range),e.loc&&(i.loc=e.loc),this.comments.push(i),this.attach){var r={comment:{type:n,value:e.value,range:[t.start.offset,t.end.offset]},start:t.start.offset};e.loc&&(r.comment.loc=e.loc),e.type=n,this.leading.push(r),this.trailing.push(r)}},e.prototype.visit=function(e,t){"LineComment"===e.type?this.visitComment(e,t):"BlockComment"===e.type?this.visitComment(e,t):this.attach&&this.visitNode(e,t)},e}();t.CommentHandler=r},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Syntax={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForOfStatement:"ForOfStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"}},function(e,t,n){"use strict";function i(e){var t;switch(e.type){case a.JSXSyntax.JSXIdentifier:t=e.name;break;case a.JSXSyntax.JSXNamespacedName:var n=e;t=i(n.namespace)+":"+i(n.name);break;case a.JSXSyntax.JSXMemberExpression:var r=e;t=i(r.object)+"."+i(r.property)}return t}var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),s=n(5),a=n(6),l=n(7),c=n(8),u=n(13),h=n(14);u.TokenName[100]="JSXIdentifier",u.TokenName[101]="JSXText";var d=function(e){function t(t,n,i){return e.call(this,t,n,i)||this}return r(t,e),t.prototype.parsePrimaryExpression=function(){return this.match("<")?this.parseJSXRoot():e.prototype.parsePrimaryExpression.call(this)},t.prototype.startJSX=function(){this.scanner.index=this.startMarker.index,this.scanner.lineNumber=this.startMarker.line,this.scanner.lineStart=this.startMarker.index-this.startMarker.column},t.prototype.finishJSX=function(){this.nextToken()},t.prototype.reenterJSX=function(){this.startJSX(),this.expectJSX("}"),this.config.tokens&&this.tokens.pop()},t.prototype.createJSXNode=function(){return this.collectComments(),{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},t.prototype.createJSXChildNode=function(){return{index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}},t.prototype.scanXHTMLEntity=function(e){for(var t="&",n=!0,i=!1,r=!1,s=!1;!this.scanner.eof()&&n&&!i;){var a=this.scanner.source[this.scanner.index];if(a===e)break;if(i=";"===a,t+=a,++this.scanner.index,!i)switch(t.length){case 2:r="#"===a;break;case 3:r&&(s="x"===a,n=s||o.Character.isDecimalDigit(a.charCodeAt(0)),r=r&&!s);break;default:n=(n=n&&!(r&&!o.Character.isDecimalDigit(a.charCodeAt(0))))&&!(s&&!o.Character.isHexDigit(a.charCodeAt(0)))}}if(n&&i&&t.length>2){var l=t.substr(1,t.length-2);r&&l.length>1?t=String.fromCharCode(parseInt(l.substr(1),10)):s&&l.length>2?t=String.fromCharCode(parseInt("0"+l.substr(1),16)):r||s||!h.XHTMLEntities[l]||(t=h.XHTMLEntities[l])}return t},t.prototype.lexJSX=function(){var e=this.scanner.source.charCodeAt(this.scanner.index);if(60===e||62===e||47===e||58===e||61===e||123===e||125===e)return{type:7,value:a=this.scanner.source[this.scanner.index++],lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index-1,end:this.scanner.index};if(34===e||39===e){for(var t=this.scanner.index,n=this.scanner.source[this.scanner.index++],i="";!this.scanner.eof()&&(l=this.scanner.source[this.scanner.index++])!==n;)i+="&"===l?this.scanXHTMLEntity(n):l;return{type:8,value:i,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}if(46===e){var r=this.scanner.source.charCodeAt(this.scanner.index+1),s=this.scanner.source.charCodeAt(this.scanner.index+2),a=46===r&&46===s?"...":".",t=this.scanner.index;return this.scanner.index+=a.length,{type:7,value:a,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}if(96===e)return{type:10,value:"",lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:this.scanner.index,end:this.scanner.index};if(o.Character.isIdentifierStart(e)&&92!==e){t=this.scanner.index;for(++this.scanner.index;!this.scanner.eof();){var l=this.scanner.source.charCodeAt(this.scanner.index);if(o.Character.isIdentifierPart(l)&&92!==l)++this.scanner.index;else{if(45!==l)break;++this.scanner.index}}return{type:100,value:this.scanner.source.slice(t,this.scanner.index),lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:t,end:this.scanner.index}}return this.scanner.lex()},t.prototype.nextJSXToken=function(){this.collectComments(),this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;var e=this.lexJSX();return this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.config.tokens&&this.tokens.push(this.convertToken(e)),e},t.prototype.nextJSXText=function(){this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart;for(var e=this.scanner.index,t="";!this.scanner.eof();){var n=this.scanner.source[this.scanner.index];if("{"===n||"<"===n)break;++this.scanner.index,t+=n,o.Character.isLineTerminator(n.charCodeAt(0))&&(++this.scanner.lineNumber,"\r"===n&&"\n"===this.scanner.source[this.scanner.index]&&++this.scanner.index,this.scanner.lineStart=this.scanner.index)}this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart;var i={type:101,value:t,lineNumber:this.scanner.lineNumber,lineStart:this.scanner.lineStart,start:e,end:this.scanner.index};return t.length>0&&this.config.tokens&&this.tokens.push(this.convertToken(i)),i},t.prototype.peekJSXToken=function(){var e=this.scanner.saveState();this.scanner.scanComments();var t=this.lexJSX();return this.scanner.restoreState(e),t},t.prototype.expectJSX=function(e){var t=this.nextJSXToken();7===t.type&&t.value===e||this.throwUnexpectedToken(t)},t.prototype.matchJSX=function(e){var t=this.peekJSXToken();return 7===t.type&&t.value===e},t.prototype.parseJSXIdentifier=function(){var e=this.createJSXNode(),t=this.nextJSXToken();return 100!==t.type&&this.throwUnexpectedToken(t),this.finalize(e,new s.JSXIdentifier(t.value))},t.prototype.parseJSXElementName=function(){var e=this.createJSXNode(),t=this.parseJSXIdentifier();if(this.matchJSX(":")){var n=t;this.expectJSX(":");var i=this.parseJSXIdentifier();t=this.finalize(e,new s.JSXNamespacedName(n,i))}else if(this.matchJSX("."))for(;this.matchJSX(".");){var r=t;this.expectJSX(".");var o=this.parseJSXIdentifier();t=this.finalize(e,new s.JSXMemberExpression(r,o))}return t},t.prototype.parseJSXAttributeName=function(){var e,t=this.createJSXNode(),n=this.parseJSXIdentifier();if(this.matchJSX(":")){var i=n;this.expectJSX(":");var r=this.parseJSXIdentifier();e=this.finalize(t,new s.JSXNamespacedName(i,r))}else e=n;return e},t.prototype.parseJSXStringLiteralAttribute=function(){var e=this.createJSXNode(),t=this.nextJSXToken();8!==t.type&&this.throwUnexpectedToken(t);var n=this.getTokenRaw(t);return this.finalize(e,new l.Literal(t.value,n))},t.prototype.parseJSXExpressionAttribute=function(){var e=this.createJSXNode();this.expectJSX("{"),this.finishJSX(),this.match("}")&&this.tolerateError("JSX attributes must only be assigned a non-empty expression");var t=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(e,new s.JSXExpressionContainer(t))},t.prototype.parseJSXAttributeValue=function(){return this.matchJSX("{")?this.parseJSXExpressionAttribute():this.matchJSX("<")?this.parseJSXElement():this.parseJSXStringLiteralAttribute()},t.prototype.parseJSXNameValueAttribute=function(){var e=this.createJSXNode(),t=this.parseJSXAttributeName(),n=null;return this.matchJSX("=")&&(this.expectJSX("="),n=this.parseJSXAttributeValue()),this.finalize(e,new s.JSXAttribute(t,n))},t.prototype.parseJSXSpreadAttribute=function(){var e=this.createJSXNode();this.expectJSX("{"),this.expectJSX("..."),this.finishJSX();var t=this.parseAssignmentExpression();return this.reenterJSX(),this.finalize(e,new s.JSXSpreadAttribute(t))},t.prototype.parseJSXAttributes=function(){for(var e=[];!this.matchJSX("/")&&!this.matchJSX(">");){var t=this.matchJSX("{")?this.parseJSXSpreadAttribute():this.parseJSXNameValueAttribute();e.push(t)}return e},t.prototype.parseJSXOpeningElement=function(){var e=this.createJSXNode();this.expectJSX("<");var t=this.parseJSXElementName(),n=this.parseJSXAttributes(),i=this.matchJSX("/");return i&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(e,new s.JSXOpeningElement(t,i,n))},t.prototype.parseJSXBoundaryElement=function(){var e=this.createJSXNode();if(this.expectJSX("<"),this.matchJSX("/")){this.expectJSX("/");var t=this.parseJSXElementName();return this.expectJSX(">"),this.finalize(e,new s.JSXClosingElement(t))}var n=this.parseJSXElementName(),i=this.parseJSXAttributes(),r=this.matchJSX("/");return r&&this.expectJSX("/"),this.expectJSX(">"),this.finalize(e,new s.JSXOpeningElement(n,r,i))},t.prototype.parseJSXEmptyExpression=function(){var e=this.createJSXChildNode();return this.collectComments(),this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.finalize(e,new s.JSXEmptyExpression)},t.prototype.parseJSXExpressionContainer=function(){var e=this.createJSXNode();this.expectJSX("{");var t;return this.matchJSX("}")?(t=this.parseJSXEmptyExpression(),this.expectJSX("}")):(this.finishJSX(),t=this.parseAssignmentExpression(),this.reenterJSX()),this.finalize(e,new s.JSXExpressionContainer(t))},t.prototype.parseJSXChildren=function(){for(var e=[];!this.scanner.eof();){var t=this.createJSXChildNode(),n=this.nextJSXText();if(n.start<n.end){var i=this.getTokenRaw(n),r=this.finalize(t,new s.JSXText(n.value,i));e.push(r)}if("{"!==this.scanner.source[this.scanner.index])break;var o=this.parseJSXExpressionContainer();e.push(o)}return e},t.prototype.parseComplexJSXElement=function(e){for(var t=[];!this.scanner.eof();){e.children=e.children.concat(this.parseJSXChildren());var n=this.createJSXChildNode(),r=this.parseJSXBoundaryElement();if(r.type===a.JSXSyntax.JSXOpeningElement){var o=r;if(o.selfClosing){c=this.finalize(n,new s.JSXElement(o,[],null));e.children.push(c)}else t.push(e),e={node:n,opening:o,closing:null,children:[]}}if(r.type===a.JSXSyntax.JSXClosingElement){e.closing=r;var l=i(e.opening.name);if(l!==i(e.closing.name)&&this.tolerateError("Expected corresponding JSX closing tag for %0",l),!(t.length>0))break;var c=this.finalize(e.node,new s.JSXElement(e.opening,e.children,e.closing));(e=t[t.length-1]).children.push(c),t.pop()}}return e},t.prototype.parseJSXElement=function(){var e=this.createJSXNode(),t=this.parseJSXOpeningElement(),n=[],i=null;if(!t.selfClosing){var r=this.parseComplexJSXElement({node:e,opening:t,closing:i,children:n});n=r.children,i=r.closing}return this.finalize(e,new s.JSXElement(t,n,i))},t.prototype.parseJSXRoot=function(){this.config.tokens&&this.tokens.pop(),this.startJSX();var e=this.parseJSXElement();return this.finishJSX(),e},t.prototype.isStartOfExpression=function(){return e.prototype.isStartOfExpression.call(this)||this.match("<")},t}(c.Parser);t.JSXParser=d},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFC-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AD\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};t.Character={fromCodePoint:function(e){return e<65536?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10))+String.fromCharCode(56320+(e-65536&1023))},isWhiteSpace:function(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0},isLineTerminator:function(e){return 10===e||13===e||8232===e||8233===e},isIdentifierStart:function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&n.NonAsciiIdentifierStart.test(t.Character.fromCodePoint(e))},isIdentifierPart:function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&n.NonAsciiIdentifierPart.test(t.Character.fromCodePoint(e))},isDecimalDigit:function(e){return e>=48&&e<=57},isHexDigit:function(e){return e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102},isOctalDigit:function(e){return e>=48&&e<=55}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),r=function(){return function(e){this.type=i.JSXSyntax.JSXClosingElement,this.name=e}}();t.JSXClosingElement=r;var o=function(){return function(e,t,n){this.type=i.JSXSyntax.JSXElement,this.openingElement=e,this.children=t,this.closingElement=n}}();t.JSXElement=o;var s=function(){return function(){this.type=i.JSXSyntax.JSXEmptyExpression}}();t.JSXEmptyExpression=s;var a=function(){return function(e){this.type=i.JSXSyntax.JSXExpressionContainer,this.expression=e}}();t.JSXExpressionContainer=a;var l=function(){return function(e){this.type=i.JSXSyntax.JSXIdentifier,this.name=e}}();t.JSXIdentifier=l;var c=function(){return function(e,t){this.type=i.JSXSyntax.JSXMemberExpression,this.object=e,this.property=t}}();t.JSXMemberExpression=c;var u=function(){return function(e,t){this.type=i.JSXSyntax.JSXAttribute,this.name=e,this.value=t}}();t.JSXAttribute=u;var h=function(){return function(e,t){this.type=i.JSXSyntax.JSXNamespacedName,this.namespace=e,this.name=t}}();t.JSXNamespacedName=h;var d=function(){return function(e,t,n){this.type=i.JSXSyntax.JSXOpeningElement,this.name=e,this.selfClosing=t,this.attributes=n}}();t.JSXOpeningElement=d;var p=function(){return function(e){this.type=i.JSXSyntax.JSXSpreadAttribute,this.argument=e}}();t.JSXSpreadAttribute=p;var f=function(){return function(e,t){this.type=i.JSXSyntax.JSXText,this.value=e,this.raw=t}}();t.JSXText=f},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JSXSyntax={JSXAttribute:"JSXAttribute",JSXClosingElement:"JSXClosingElement",JSXElement:"JSXElement",JSXEmptyExpression:"JSXEmptyExpression",JSXExpressionContainer:"JSXExpressionContainer",JSXIdentifier:"JSXIdentifier",JSXMemberExpression:"JSXMemberExpression",JSXNamespacedName:"JSXNamespacedName",JSXOpeningElement:"JSXOpeningElement",JSXSpreadAttribute:"JSXSpreadAttribute",JSXText:"JSXText"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=function(){return function(e){this.type=i.Syntax.ArrayExpression,this.elements=e}}();t.ArrayExpression=r;var o=function(){return function(e){this.type=i.Syntax.ArrayPattern,this.elements=e}}();t.ArrayPattern=o;var s=function(){return function(e,t,n){this.type=i.Syntax.ArrowFunctionExpression,this.id=null,this.params=e,this.body=t,this.generator=!1,this.expression=n,this.async=!1}}();t.ArrowFunctionExpression=s;var a=function(){return function(e,t,n){this.type=i.Syntax.AssignmentExpression,this.operator=e,this.left=t,this.right=n}}();t.AssignmentExpression=a;var l=function(){return function(e,t){this.type=i.Syntax.AssignmentPattern,this.left=e,this.right=t}}();t.AssignmentPattern=l;var c=function(){return function(e,t,n){this.type=i.Syntax.ArrowFunctionExpression,this.id=null,this.params=e,this.body=t,this.generator=!1,this.expression=n,this.async=!0}}();t.AsyncArrowFunctionExpression=c;var u=function(){return function(e,t,n){this.type=i.Syntax.FunctionDeclaration,this.id=e,this.params=t,this.body=n,this.generator=!1,this.expression=!1,this.async=!0}}();t.AsyncFunctionDeclaration=u;var h=function(){return function(e,t,n){this.type=i.Syntax.FunctionExpression,this.id=e,this.params=t,this.body=n,this.generator=!1,this.expression=!1,this.async=!0}}();t.AsyncFunctionExpression=h;var d=function(){return function(e){this.type=i.Syntax.AwaitExpression,this.argument=e}}();t.AwaitExpression=d;var p=function(){return function(e,t,n){var r="||"===e||"&&"===e;this.type=r?i.Syntax.LogicalExpression:i.Syntax.BinaryExpression,this.operator=e,this.left=t,this.right=n}}();t.BinaryExpression=p;var f=function(){return function(e){this.type=i.Syntax.BlockStatement,this.body=e}}();t.BlockStatement=f;var m=function(){return function(e){this.type=i.Syntax.BreakStatement,this.label=e}}();t.BreakStatement=m;var g=function(){return function(e,t){this.type=i.Syntax.CallExpression,this.callee=e,this.arguments=t}}();t.CallExpression=g;var v=function(){return function(e,t){this.type=i.Syntax.CatchClause,this.param=e,this.body=t}}();t.CatchClause=v;var y=function(){return function(e){this.type=i.Syntax.ClassBody,this.body=e}}();t.ClassBody=y;var b=function(){return function(e,t,n){this.type=i.Syntax.ClassDeclaration,this.id=e,this.superClass=t,this.body=n}}();t.ClassDeclaration=b;var x=function(){return function(e,t,n){this.type=i.Syntax.ClassExpression,this.id=e,this.superClass=t,this.body=n}}();t.ClassExpression=x;var q=function(){return function(e,t){this.type=i.Syntax.MemberExpression,this.computed=!0,this.object=e,this.property=t}}();t.ComputedMemberExpression=q;var C=function(){return function(e,t,n){this.type=i.Syntax.ConditionalExpression,this.test=e,this.consequent=t,this.alternate=n}}();t.ConditionalExpression=C;var S=function(){return function(e){this.type=i.Syntax.ContinueStatement,this.label=e}}();t.ContinueStatement=S;var w=function(){return function(){this.type=i.Syntax.DebuggerStatement}}();t.DebuggerStatement=w;var _=function(){return function(e,t){this.type=i.Syntax.ExpressionStatement,this.expression=e,this.directive=t}}();t.Directive=_;var D=function(){return function(e,t){this.type=i.Syntax.DoWhileStatement,this.body=e,this.test=t}}();t.DoWhileStatement=D;var M=function(){return function(){this.type=i.Syntax.EmptyStatement}}();t.EmptyStatement=M;var A=function(){return function(e){this.type=i.Syntax.ExportAllDeclaration,this.source=e}}();t.ExportAllDeclaration=A;var E=function(){return function(e){this.type=i.Syntax.ExportDefaultDeclaration,this.declaration=e}}();t.ExportDefaultDeclaration=E;var I=function(){return function(e,t,n){this.type=i.Syntax.ExportNamedDeclaration,this.declaration=e,this.specifiers=t,this.source=n}}();t.ExportNamedDeclaration=I;var T=function(){return function(e,t){this.type=i.Syntax.ExportSpecifier,this.exported=t,this.local=e}}();t.ExportSpecifier=T;var L=function(){return function(e){this.type=i.Syntax.ExpressionStatement,this.expression=e}}();t.ExpressionStatement=L;var k=function(){return function(e,t,n){this.type=i.Syntax.ForInStatement,this.left=e,this.right=t,this.body=n,this.each=!1}}();t.ForInStatement=k;var O=function(){return function(e,t,n){this.type=i.Syntax.ForOfStatement,this.left=e,this.right=t,this.body=n}}();t.ForOfStatement=O;var P=function(){return function(e,t,n,r){this.type=i.Syntax.ForStatement,this.init=e,this.test=t,this.update=n,this.body=r}}();t.ForStatement=P;var N=function(){return function(e,t,n,r){this.type=i.Syntax.FunctionDeclaration,this.id=e,this.params=t,this.body=n,this.generator=r,this.expression=!1,this.async=!1}}();t.FunctionDeclaration=N;var R=function(){return function(e,t,n,r){this.type=i.Syntax.FunctionExpression,this.id=e,this.params=t,this.body=n,this.generator=r,this.expression=!1,this.async=!1}}();t.FunctionExpression=R;var F=function(){return function(e){this.type=i.Syntax.Identifier,this.name=e}}();t.Identifier=F;var j=function(){return function(e,t,n){this.type=i.Syntax.IfStatement,this.test=e,this.consequent=t,this.alternate=n}}();t.IfStatement=j;var V=function(){return function(e,t){this.type=i.Syntax.ImportDeclaration,this.specifiers=e,this.source=t}}();t.ImportDeclaration=V;var H=function(){return function(e){this.type=i.Syntax.ImportDefaultSpecifier,this.local=e}}();t.ImportDefaultSpecifier=H;var B=function(){return function(e){this.type=i.Syntax.ImportNamespaceSpecifier,this.local=e}}();t.ImportNamespaceSpecifier=B;var z=function(){return function(e,t){this.type=i.Syntax.ImportSpecifier,this.local=e,this.imported=t}}();t.ImportSpecifier=z;var $=function(){return function(e,t){this.type=i.Syntax.LabeledStatement,this.label=e,this.body=t}}();t.LabeledStatement=$;var U=function(){return function(e,t){this.type=i.Syntax.Literal,this.value=e,this.raw=t}}();t.Literal=U;var G=function(){return function(e,t){this.type=i.Syntax.MetaProperty,this.meta=e,this.property=t}}();t.MetaProperty=G;var W=function(){return function(e,t,n,r,o){this.type=i.Syntax.MethodDefinition,this.key=e,this.computed=t,this.value=n,this.kind=r,this.static=o}}();t.MethodDefinition=W;var X=function(){return function(e){this.type=i.Syntax.Program,this.body=e,this.sourceType="module"}}();t.Module=X;var Y=function(){return function(e,t){this.type=i.Syntax.NewExpression,this.callee=e,this.arguments=t}}();t.NewExpression=Y;var K=function(){return function(e){this.type=i.Syntax.ObjectExpression,this.properties=e}}();t.ObjectExpression=K;var Q=function(){return function(e){this.type=i.Syntax.ObjectPattern,this.properties=e}}();t.ObjectPattern=Q;var Z=function(){return function(e,t,n,r,o,s){this.type=i.Syntax.Property,this.key=t,this.computed=n,this.value=r,this.kind=e,this.method=o,this.shorthand=s}}();t.Property=Z;var J=function(){return function(e,t,n,r){this.type=i.Syntax.Literal,this.value=e,this.raw=t,this.regex={pattern:n,flags:r}}}();t.RegexLiteral=J;var ee=function(){return function(e){this.type=i.Syntax.RestElement,this.argument=e}}();t.RestElement=ee;var te=function(){return function(e){this.type=i.Syntax.ReturnStatement,this.argument=e}}();t.ReturnStatement=te;var ne=function(){return function(e){this.type=i.Syntax.Program,this.body=e,this.sourceType="script"}}();t.Script=ne;var ie=function(){return function(e){this.type=i.Syntax.SequenceExpression,this.expressions=e}}();t.SequenceExpression=ie;var re=function(){return function(e){this.type=i.Syntax.SpreadElement,this.argument=e}}();t.SpreadElement=re;var oe=function(){return function(e,t){this.type=i.Syntax.MemberExpression,this.computed=!1,this.object=e,this.property=t}}();t.StaticMemberExpression=oe;var se=function(){return function(){this.type=i.Syntax.Super}}();t.Super=se;var ae=function(){return function(e,t){this.type=i.Syntax.SwitchCase,this.test=e,this.consequent=t}}();t.SwitchCase=ae;var le=function(){return function(e,t){this.type=i.Syntax.SwitchStatement,this.discriminant=e,this.cases=t}}();t.SwitchStatement=le;var ce=function(){return function(e,t){this.type=i.Syntax.TaggedTemplateExpression,this.tag=e,this.quasi=t}}();t.TaggedTemplateExpression=ce;var ue=function(){return function(e,t){this.type=i.Syntax.TemplateElement,this.value=e,this.tail=t}}();t.TemplateElement=ue;var he=function(){return function(e,t){this.type=i.Syntax.TemplateLiteral,this.quasis=e,this.expressions=t}}();t.TemplateLiteral=he;var de=function(){return function(){this.type=i.Syntax.ThisExpression}}();t.ThisExpression=de;var pe=function(){return function(e){this.type=i.Syntax.ThrowStatement,this.argument=e}}();t.ThrowStatement=pe;var fe=function(){return function(e,t,n){this.type=i.Syntax.TryStatement,this.block=e,this.handler=t,this.finalizer=n}}();t.TryStatement=fe;var me=function(){return function(e,t){this.type=i.Syntax.UnaryExpression,this.operator=e,this.argument=t,this.prefix=!0}}();t.UnaryExpression=me;var ge=function(){return function(e,t,n){this.type=i.Syntax.UpdateExpression,this.operator=e,this.argument=t,this.prefix=n}}();t.UpdateExpression=ge;var ve=function(){return function(e,t){this.type=i.Syntax.VariableDeclaration,this.declarations=e,this.kind=t}}();t.VariableDeclaration=ve;var ye=function(){return function(e,t){this.type=i.Syntax.VariableDeclarator,this.id=e,this.init=t}}();t.VariableDeclarator=ye;var be=function(){return function(e,t){this.type=i.Syntax.WhileStatement,this.test=e,this.body=t}}();t.WhileStatement=be;var xe=function(){return function(e,t){this.type=i.Syntax.WithStatement,this.object=e,this.body=t}}();t.WithStatement=xe;var qe=function(){return function(e,t){this.type=i.Syntax.YieldExpression,this.argument=e,this.delegate=t}}();t.YieldExpression=qe},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),r=n(10),o=n(11),s=n(7),a=n(12),l=n(2),c=n(13),u=function(){function e(e,t,n){void 0===t&&(t={}),this.config={range:"boolean"==typeof t.range&&t.range,loc:"boolean"==typeof t.loc&&t.loc,source:null,tokens:"boolean"==typeof t.tokens&&t.tokens,comment:"boolean"==typeof t.comment&&t.comment,tolerant:"boolean"==typeof t.tolerant&&t.tolerant},this.config.loc&&t.source&&null!==t.source&&(this.config.source=String(t.source)),this.delegate=n,this.errorHandler=new r.ErrorHandler,this.errorHandler.tolerant=this.config.tolerant,this.scanner=new a.Scanner(e,this.errorHandler),this.scanner.trackComment=this.config.comment,this.operatorPrecedence={")":0,";":0,",":0,"=":0,"]":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.lookahead={type:2,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0},this.hasLineTerminator=!1,this.context={isModule:!1,await:!1,allowIn:!0,allowStrictDirective:!0,allowYield:!0,firstCoverInitializedNameError:null,isAssignmentTarget:!1,isBindingElement:!1,inFunctionBody:!1,inIteration:!1,inSwitch:!1,labelSet:{},strict:!1},this.tokens=[],this.startMarker={index:0,line:this.scanner.lineNumber,column:0},this.lastMarker={index:0,line:this.scanner.lineNumber,column:0},this.nextToken(),this.lastMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}return e.prototype.throwError=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=Array.prototype.slice.call(arguments,1),o=e.replace(/%(\d)/g,function(e,t){return i.assert(t<r.length,"Message reference must be in range"),r[t]}),s=this.lastMarker.index,a=this.lastMarker.line,l=this.lastMarker.column+1;throw this.errorHandler.createError(s,a,l,o)},e.prototype.tolerateError=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=Array.prototype.slice.call(arguments,1),o=e.replace(/%(\d)/g,function(e,t){return i.assert(t<r.length,"Message reference must be in range"),r[t]}),s=this.lastMarker.index,a=this.scanner.lineNumber,l=this.lastMarker.column+1;this.errorHandler.tolerateError(s,a,l,o)},e.prototype.unexpectedTokenError=function(e,t){var n,i=t||o.Messages.UnexpectedToken;if(e?(t||(i=2===e.type?o.Messages.UnexpectedEOS:3===e.type?o.Messages.UnexpectedIdentifier:6===e.type?o.Messages.UnexpectedNumber:8===e.type?o.Messages.UnexpectedString:10===e.type?o.Messages.UnexpectedTemplate:o.Messages.UnexpectedToken,4===e.type&&(this.scanner.isFutureReservedWord(e.value)?i=o.Messages.UnexpectedReserved:this.context.strict&&this.scanner.isStrictModeReservedWord(e.value)&&(i=o.Messages.StrictReservedWord))),n=e.value):n="ILLEGAL",i=i.replace("%0",n),e&&"number"==typeof e.lineNumber){var r=e.start,s=e.lineNumber,a=this.lastMarker.index-this.lastMarker.column,l=e.start-a+1;return this.errorHandler.createError(r,s,l,i)}var r=this.lastMarker.index,s=this.lastMarker.line,l=this.lastMarker.column+1;return this.errorHandler.createError(r,s,l,i)},e.prototype.throwUnexpectedToken=function(e,t){throw this.unexpectedTokenError(e,t)},e.prototype.tolerateUnexpectedToken=function(e,t){this.errorHandler.tolerate(this.unexpectedTokenError(e,t))},e.prototype.collectComments=function(){if(this.config.comment){var e=this.scanner.scanComments();if(e.length>0&&this.delegate)for(var t=0;t<e.length;++t){var n=e[t],i=void 0;i={type:n.multiLine?"BlockComment":"LineComment",value:this.scanner.source.slice(n.slice[0],n.slice[1])},this.config.range&&(i.range=n.range),this.config.loc&&(i.loc=n.loc);var r={start:{line:n.loc.start.line,column:n.loc.start.column,offset:n.range[0]},end:{line:n.loc.end.line,column:n.loc.end.column,offset:n.range[1]}};this.delegate(i,r)}}else this.scanner.scanComments()},e.prototype.getTokenRaw=function(e){return this.scanner.source.slice(e.start,e.end)},e.prototype.convertToken=function(e){var t={type:c.TokenName[e.type],value:this.getTokenRaw(e)};if(this.config.range&&(t.range=[e.start,e.end]),this.config.loc&&(t.loc={start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}),9===e.type){var n=e.pattern,i=e.flags;t.regex={pattern:n,flags:i}}return t},e.prototype.nextToken=function(){var e=this.lookahead;this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.collectComments(),this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart);var t=this.scanner.lex();return this.hasLineTerminator=e.lineNumber!==t.lineNumber,t&&this.context.strict&&3===t.type&&this.scanner.isStrictModeReservedWord(t.value)&&(t.type=4),this.lookahead=t,this.config.tokens&&2!==t.type&&this.tokens.push(this.convertToken(t)),e},e.prototype.nextRegexToken=function(){this.collectComments();var e=this.scanner.scanRegExp();return this.config.tokens&&(this.tokens.pop(),this.tokens.push(this.convertToken(e))),this.lookahead=e,this.nextToken(),e},e.prototype.createNode=function(){return{index:this.startMarker.index,line:this.startMarker.line,column:this.startMarker.column}},e.prototype.startNode=function(e){return{index:e.start,line:e.lineNumber,column:e.start-e.lineStart}},e.prototype.finalize=function(e,t){if(this.config.range&&(t.range=[e.index,this.lastMarker.index]),this.config.loc&&(t.loc={start:{line:e.line,column:e.column},end:{line:this.lastMarker.line,column:this.lastMarker.column}},this.config.source&&(t.loc.source=this.config.source)),this.delegate){var n={start:{line:e.line,column:e.column,offset:e.index},end:{line:this.lastMarker.line,column:this.lastMarker.column,offset:this.lastMarker.index}};this.delegate(t,n)}return t},e.prototype.expect=function(e){var t=this.nextToken();7===t.type&&t.value===e||this.throwUnexpectedToken(t)},e.prototype.expectCommaSeparator=function(){if(this.config.tolerant){var e=this.lookahead;7===e.type&&","===e.value?this.nextToken():7===e.type&&";"===e.value?(this.nextToken(),this.tolerateUnexpectedToken(e)):this.tolerateUnexpectedToken(e,o.Messages.UnexpectedToken)}else this.expect(",")},e.prototype.expectKeyword=function(e){var t=this.nextToken();4===t.type&&t.value===e||this.throwUnexpectedToken(t)},e.prototype.match=function(e){return 7===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchKeyword=function(e){return 4===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchContextualKeyword=function(e){return 3===this.lookahead.type&&this.lookahead.value===e},e.prototype.matchAssign=function(){if(7!==this.lookahead.type)return!1;var e=this.lookahead.value;return"="===e||"*="===e||"**="===e||"/="===e||"%="===e||"+="===e||"-="===e||"<<="===e||">>="===e||">>>="===e||"&="===e||"^="===e||"|="===e},e.prototype.isolateCoverGrammar=function(e){var t=this.context.isBindingElement,n=this.context.isAssignmentTarget,i=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var r=e.call(this);return null!==this.context.firstCoverInitializedNameError&&this.throwUnexpectedToken(this.context.firstCoverInitializedNameError),this.context.isBindingElement=t,this.context.isAssignmentTarget=n,this.context.firstCoverInitializedNameError=i,r},e.prototype.inheritCoverGrammar=function(e){var t=this.context.isBindingElement,n=this.context.isAssignmentTarget,i=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;var r=e.call(this);return this.context.isBindingElement=this.context.isBindingElement&&t,this.context.isAssignmentTarget=this.context.isAssignmentTarget&&n,this.context.firstCoverInitializedNameError=i||this.context.firstCoverInitializedNameError,r},e.prototype.consumeSemicolon=function(){this.match(";")?this.nextToken():this.hasLineTerminator||(2===this.lookahead.type||this.match("}")||this.throwUnexpectedToken(this.lookahead),this.lastMarker.index=this.startMarker.index,this.lastMarker.line=this.startMarker.line,this.lastMarker.column=this.startMarker.column)},e.prototype.parsePrimaryExpression=function(){var e,t,n,i=this.createNode();switch(this.lookahead.type){case 3:(this.context.isModule||this.context.await)&&"await"===this.lookahead.value&&this.tolerateUnexpectedToken(this.lookahead),e=this.matchAsyncFunction()?this.parseFunctionExpression():this.finalize(i,new s.Identifier(this.nextToken().value));break;case 6:case 8:this.context.strict&&this.lookahead.octal&&this.tolerateUnexpectedToken(this.lookahead,o.Messages.StrictOctalLiteral),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),n=this.getTokenRaw(t),e=this.finalize(i,new s.Literal(t.value,n));break;case 1:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),n=this.getTokenRaw(t),e=this.finalize(i,new s.Literal("true"===t.value,n));break;case 5:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.nextToken(),n=this.getTokenRaw(t),e=this.finalize(i,new s.Literal(null,n));break;case 10:e=this.parseTemplateLiteral();break;case 7:switch(this.lookahead.value){case"(":this.context.isBindingElement=!1,e=this.inheritCoverGrammar(this.parseGroupExpression);break;case"[":e=this.inheritCoverGrammar(this.parseArrayInitializer);break;case"{":e=this.inheritCoverGrammar(this.parseObjectInitializer);break;case"/":case"/=":this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.scanner.index=this.startMarker.index,t=this.nextRegexToken(),n=this.getTokenRaw(t),e=this.finalize(i,new s.RegexLiteral(t.regex,n,t.pattern,t.flags));break;default:e=this.throwUnexpectedToken(this.nextToken())}break;case 4:!this.context.strict&&this.context.allowYield&&this.matchKeyword("yield")?e=this.parseIdentifierName():!this.context.strict&&this.matchKeyword("let")?e=this.finalize(i,new s.Identifier(this.nextToken().value)):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.matchKeyword("function")?e=this.parseFunctionExpression():this.matchKeyword("this")?(this.nextToken(),e=this.finalize(i,new s.ThisExpression)):e=this.matchKeyword("class")?this.parseClassExpression():this.throwUnexpectedToken(this.nextToken()));break;default:e=this.throwUnexpectedToken(this.nextToken())}return e},e.prototype.parseSpreadElement=function(){var e=this.createNode();this.expect("...");var t=this.inheritCoverGrammar(this.parseAssignmentExpression);return this.finalize(e,new s.SpreadElement(t))},e.prototype.parseArrayInitializer=function(){var e=this.createNode(),t=[];for(this.expect("[");!this.match("]");)if(this.match(","))this.nextToken(),t.push(null);else if(this.match("...")){var n=this.parseSpreadElement();this.match("]")||(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,this.expect(",")),t.push(n)}else t.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.match("]")||this.expect(",");return this.expect("]"),this.finalize(e,new s.ArrayExpression(t))},e.prototype.parsePropertyMethod=function(e){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var t=this.context.strict,n=this.context.allowStrictDirective;this.context.allowStrictDirective=e.simple;var i=this.isolateCoverGrammar(this.parseFunctionSourceElements);return this.context.strict&&e.firstRestricted&&this.tolerateUnexpectedToken(e.firstRestricted,e.message),this.context.strict&&e.stricted&&this.tolerateUnexpectedToken(e.stricted,e.message),this.context.strict=t,this.context.allowStrictDirective=n,i},e.prototype.parsePropertyMethodFunction=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!1;var n=this.parseFormalParameters(),i=this.parsePropertyMethod(n);return this.context.allowYield=t,this.finalize(e,new s.FunctionExpression(null,n.params,i,!1))},e.prototype.parsePropertyMethodAsyncFunction=function(){var e=this.createNode(),t=this.context.allowYield,n=this.context.await;this.context.allowYield=!1,this.context.await=!0;var i=this.parseFormalParameters(),r=this.parsePropertyMethod(i);return this.context.allowYield=t,this.context.await=n,this.finalize(e,new s.AsyncFunctionExpression(null,i.params,r))},e.prototype.parseObjectPropertyKey=function(){var e,t=this.createNode(),n=this.nextToken();switch(n.type){case 8:case 6:this.context.strict&&n.octal&&this.tolerateUnexpectedToken(n,o.Messages.StrictOctalLiteral);var i=this.getTokenRaw(n);e=this.finalize(t,new s.Literal(n.value,i));break;case 3:case 1:case 5:case 4:e=this.finalize(t,new s.Identifier(n.value));break;case 7:"["===n.value?(e=this.isolateCoverGrammar(this.parseAssignmentExpression),this.expect("]")):e=this.throwUnexpectedToken(n);break;default:e=this.throwUnexpectedToken(n)}return e},e.prototype.isPropertyKey=function(e,t){return e.type===l.Syntax.Identifier&&e.name===t||e.type===l.Syntax.Literal&&e.value===t},e.prototype.parseObjectProperty=function(e){var t,n=this.createNode(),i=this.lookahead,r=null,a=null,l=!1,c=!1,u=!1,h=!1;if(3===i.type){p=i.value;this.nextToken(),l=this.match("["),r=(h=!(this.hasLineTerminator||"async"!==p||this.match(":")||this.match("(")||this.match("*")))?this.parseObjectPropertyKey():this.finalize(n,new s.Identifier(p))}else this.match("*")?this.nextToken():(l=this.match("["),r=this.parseObjectPropertyKey());var d=this.qualifiedPropertyName(this.lookahead);if(3===i.type&&!h&&"get"===i.value&&d)t="get",l=this.match("["),r=this.parseObjectPropertyKey(),this.context.allowYield=!1,a=this.parseGetterMethod();else if(3===i.type&&!h&&"set"===i.value&&d)t="set",l=this.match("["),r=this.parseObjectPropertyKey(),a=this.parseSetterMethod();else if(7===i.type&&"*"===i.value&&d)t="init",l=this.match("["),r=this.parseObjectPropertyKey(),a=this.parseGeneratorMethod(),c=!0;else if(r||this.throwUnexpectedToken(this.lookahead),t="init",this.match(":")&&!h)!l&&this.isPropertyKey(r,"__proto__")&&(e.value&&this.tolerateError(o.Messages.DuplicateProtoProperty),e.value=!0),this.nextToken(),a=this.inheritCoverGrammar(this.parseAssignmentExpression);else if(this.match("("))a=h?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),c=!0;else if(3===i.type){var p=this.finalize(n,new s.Identifier(i.value));if(this.match("=")){this.context.firstCoverInitializedNameError=this.lookahead,this.nextToken(),u=!0;var f=this.isolateCoverGrammar(this.parseAssignmentExpression);a=this.finalize(n,new s.AssignmentPattern(p,f))}else u=!0,a=p}else this.throwUnexpectedToken(this.nextToken());return this.finalize(n,new s.Property(t,r,l,a,c,u))},e.prototype.parseObjectInitializer=function(){var e=this.createNode();this.expect("{");for(var t=[],n={value:!1};!this.match("}");)t.push(this.parseObjectProperty(n)),this.match("}")||this.expectCommaSeparator();return this.expect("}"),this.finalize(e,new s.ObjectExpression(t))},e.prototype.parseTemplateHead=function(){i.assert(this.lookahead.head,"Template literal must start with a template head");var e=this.createNode(),t=this.nextToken(),n=t.value,r=t.cooked;return this.finalize(e,new s.TemplateElement({raw:n,cooked:r},t.tail))},e.prototype.parseTemplateElement=function(){10!==this.lookahead.type&&this.throwUnexpectedToken();var e=this.createNode(),t=this.nextToken(),n=t.value,i=t.cooked;return this.finalize(e,new s.TemplateElement({raw:n,cooked:i},t.tail))},e.prototype.parseTemplateLiteral=function(){var e=this.createNode(),t=[],n=[],i=this.parseTemplateHead();for(n.push(i);!i.tail;)t.push(this.parseExpression()),i=this.parseTemplateElement(),n.push(i);return this.finalize(e,new s.TemplateLiteral(n,t))},e.prototype.reinterpretExpressionAsPattern=function(e){switch(e.type){case l.Syntax.Identifier:case l.Syntax.MemberExpression:case l.Syntax.RestElement:case l.Syntax.AssignmentPattern:break;case l.Syntax.SpreadElement:e.type=l.Syntax.RestElement,this.reinterpretExpressionAsPattern(e.argument);break;case l.Syntax.ArrayExpression:e.type=l.Syntax.ArrayPattern;for(t=0;t<e.elements.length;t++)null!==e.elements[t]&&this.reinterpretExpressionAsPattern(e.elements[t]);break;case l.Syntax.ObjectExpression:e.type=l.Syntax.ObjectPattern;for(var t=0;t<e.properties.length;t++)this.reinterpretExpressionAsPattern(e.properties[t].value);break;case l.Syntax.AssignmentExpression:e.type=l.Syntax.AssignmentPattern,delete e.operator,this.reinterpretExpressionAsPattern(e.left)}},e.prototype.parseGroupExpression=function(){var e;if(this.expect("("),this.match(")"))this.nextToken(),this.match("=>")||this.expect("=>"),e={type:"ArrowParameterPlaceHolder",params:[],async:!1};else{var t=this.lookahead,n=[];if(this.match("..."))e=this.parseRestElement(n),this.expect(")"),this.match("=>")||this.expect("=>"),e={type:"ArrowParameterPlaceHolder",params:[e],async:!1};else{var i=!1;if(this.context.isBindingElement=!0,e=this.inheritCoverGrammar(this.parseAssignmentExpression),this.match(",")){var r=[];for(this.context.isAssignmentTarget=!1,r.push(e);2!==this.lookahead.type&&this.match(",");){if(this.nextToken(),this.match(")")){this.nextToken();for(o=0;o<r.length;o++)this.reinterpretExpressionAsPattern(r[o]);i=!0,e={type:"ArrowParameterPlaceHolder",params:r,async:!1}}else if(this.match("...")){this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),r.push(this.parseRestElement(n)),this.expect(")"),this.match("=>")||this.expect("=>"),this.context.isBindingElement=!1;for(o=0;o<r.length;o++)this.reinterpretExpressionAsPattern(r[o]);i=!0,e={type:"ArrowParameterPlaceHolder",params:r,async:!1}}else r.push(this.inheritCoverGrammar(this.parseAssignmentExpression));if(i)break}i||(e=this.finalize(this.startNode(t),new s.SequenceExpression(r)))}if(!i){if(this.expect(")"),this.match("=>")&&(e.type===l.Syntax.Identifier&&"yield"===e.name&&(i=!0,e={type:"ArrowParameterPlaceHolder",params:[e],async:!1}),!i)){if(this.context.isBindingElement||this.throwUnexpectedToken(this.lookahead),e.type===l.Syntax.SequenceExpression)for(var o=0;o<e.expressions.length;o++)this.reinterpretExpressionAsPattern(e.expressions[o]);else this.reinterpretExpressionAsPattern(e);e={type:"ArrowParameterPlaceHolder",params:e.type===l.Syntax.SequenceExpression?e.expressions:[e],async:!1}}this.context.isBindingElement=!1}}}return e},e.prototype.parseArguments=function(){this.expect("(");var e=[];if(!this.match(")"))for(;;){var t=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAssignmentExpression);if(e.push(t),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),e},e.prototype.isIdentifierName=function(e){return 3===e.type||4===e.type||1===e.type||5===e.type},e.prototype.parseIdentifierName=function(){var e=this.createNode(),t=this.nextToken();return this.isIdentifierName(t)||this.throwUnexpectedToken(t),this.finalize(e,new s.Identifier(t.value))},e.prototype.parseNewExpression=function(){var e=this.createNode(),t=this.parseIdentifierName();i.assert("new"===t.name,"New expression must start with `new`");var n;if(this.match("."))if(this.nextToken(),3===this.lookahead.type&&this.context.inFunctionBody&&"target"===this.lookahead.value){var r=this.parseIdentifierName();n=new s.MetaProperty(t,r)}else this.throwUnexpectedToken(this.lookahead);else{var o=this.isolateCoverGrammar(this.parseLeftHandSideExpression),a=this.match("(")?this.parseArguments():[];n=new s.NewExpression(o,a),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return this.finalize(e,n)},e.prototype.parseAsyncArgument=function(){var e=this.parseAssignmentExpression();return this.context.firstCoverInitializedNameError=null,e},e.prototype.parseAsyncArguments=function(){this.expect("(");var e=[];if(!this.match(")"))for(;;){var t=this.match("...")?this.parseSpreadElement():this.isolateCoverGrammar(this.parseAsyncArgument);if(e.push(t),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),e},e.prototype.parseLeftHandSideExpressionAllowCall=function(){var e=this.lookahead,t=this.matchContextualKeyword("async"),n=this.context.allowIn;this.context.allowIn=!0;var i;for(this.matchKeyword("super")&&this.context.inFunctionBody?(i=this.createNode(),this.nextToken(),i=this.finalize(i,new s.Super),this.match("(")||this.match(".")||this.match("[")||this.throwUnexpectedToken(this.lookahead)):i=this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match(".")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");l=this.parseIdentifierName();i=this.finalize(this.startNode(e),new s.StaticMemberExpression(i,l))}else if(this.match("(")){var r=t&&e.lineNumber===this.lookahead.lineNumber;this.context.isBindingElement=!1,this.context.isAssignmentTarget=!1;var o=r?this.parseAsyncArguments():this.parseArguments();if(i=this.finalize(this.startNode(e),new s.CallExpression(i,o)),r&&this.match("=>")){for(var a=0;a<o.length;++a)this.reinterpretExpressionAsPattern(o[a]);i={type:"ArrowParameterPlaceHolder",params:o,async:!0}}}else if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");var l=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),i=this.finalize(this.startNode(e),new s.ComputedMemberExpression(i,l))}else{if(10!==this.lookahead.type||!this.lookahead.head)break;var c=this.parseTemplateLiteral();i=this.finalize(this.startNode(e),new s.TaggedTemplateExpression(i,c))}return this.context.allowIn=n,i},e.prototype.parseSuper=function(){var e=this.createNode();return this.expectKeyword("super"),this.match("[")||this.match(".")||this.throwUnexpectedToken(this.lookahead),this.finalize(e,new s.Super)},e.prototype.parseLeftHandSideExpression=function(){i.assert(this.context.allowIn,"callee of new expression always allow in keyword.");for(var e=this.startNode(this.lookahead),t=this.matchKeyword("super")&&this.context.inFunctionBody?this.parseSuper():this.inheritCoverGrammar(this.matchKeyword("new")?this.parseNewExpression:this.parsePrimaryExpression);;)if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");n=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),t=this.finalize(e,new s.ComputedMemberExpression(t,n))}else if(this.match(".")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");var n=this.parseIdentifierName();t=this.finalize(e,new s.StaticMemberExpression(t,n))}else{if(10!==this.lookahead.type||!this.lookahead.head)break;var r=this.parseTemplateLiteral();t=this.finalize(e,new s.TaggedTemplateExpression(t,r))}return t},e.prototype.parseUpdateExpression=function(){var e,t=this.lookahead;if(this.match("++")||this.match("--")){var n=this.startNode(t),i=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),this.context.strict&&e.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(e.name)&&this.tolerateError(o.Messages.StrictLHSPrefix),this.context.isAssignmentTarget||this.tolerateError(o.Messages.InvalidLHSInAssignment);a=!0;e=this.finalize(n,new s.UpdateExpression(i.value,e,a)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else if(e=this.inheritCoverGrammar(this.parseLeftHandSideExpressionAllowCall),!this.hasLineTerminator&&7===this.lookahead.type&&(this.match("++")||this.match("--"))){this.context.strict&&e.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(e.name)&&this.tolerateError(o.Messages.StrictLHSPostfix),this.context.isAssignmentTarget||this.tolerateError(o.Messages.InvalidLHSInAssignment),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var r=this.nextToken().value,a=!1;e=this.finalize(this.startNode(t),new s.UpdateExpression(r,e,a))}return e},e.prototype.parseAwaitExpression=function(){var e=this.createNode();this.nextToken();var t=this.parseUnaryExpression();return this.finalize(e,new s.AwaitExpression(t))},e.prototype.parseUnaryExpression=function(){var e;if(this.match("+")||this.match("-")||this.match("~")||this.match("!")||this.matchKeyword("delete")||this.matchKeyword("void")||this.matchKeyword("typeof")){var t=this.startNode(this.lookahead),n=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),e=this.finalize(t,new s.UnaryExpression(n.value,e)),this.context.strict&&"delete"===e.operator&&e.argument.type===l.Syntax.Identifier&&this.tolerateError(o.Messages.StrictDelete),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else e=this.context.await&&this.matchContextualKeyword("await")?this.parseAwaitExpression():this.parseUpdateExpression();return e},e.prototype.parseExponentiationExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseUnaryExpression);if(t.type!==l.Syntax.UnaryExpression&&this.match("**")){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var n=t,i=this.isolateCoverGrammar(this.parseExponentiationExpression);t=this.finalize(this.startNode(e),new s.BinaryExpression("**",n,i))}return t},e.prototype.binaryPrecedence=function(e){var t=e.value;return 7===e.type?this.operatorPrecedence[t]||0:4===e.type&&("instanceof"===t||this.context.allowIn&&"in"===t)?7:0},e.prototype.parseBinaryExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseExponentiationExpression),n=this.lookahead,i=this.binaryPrecedence(n);if(i>0){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;for(var r=[e,this.lookahead],o=t,a=this.isolateCoverGrammar(this.parseExponentiationExpression),l=[o,n.value,a],c=[i];!((i=this.binaryPrecedence(this.lookahead))<=0);){for(;l.length>2&&i<=c[c.length-1];){a=l.pop();d=l.pop();c.pop(),o=l.pop(),r.pop();h=this.startNode(r[r.length-1]);l.push(this.finalize(h,new s.BinaryExpression(d,o,a)))}l.push(this.nextToken().value),c.push(i),r.push(this.lookahead),l.push(this.isolateCoverGrammar(this.parseExponentiationExpression))}var u=l.length-1;for(t=l[u],r.pop();u>1;){var h=this.startNode(r.pop()),d=l[u-1];t=this.finalize(h,new s.BinaryExpression(d,l[u-2],t)),u-=2}}return t},e.prototype.parseConditionalExpression=function(){var e=this.lookahead,t=this.inheritCoverGrammar(this.parseBinaryExpression);if(this.match("?")){this.nextToken();var n=this.context.allowIn;this.context.allowIn=!0;var i=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowIn=n,this.expect(":");var r=this.isolateCoverGrammar(this.parseAssignmentExpression);t=this.finalize(this.startNode(e),new s.ConditionalExpression(t,i,r)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}return t},e.prototype.checkPatternParam=function(e,t){switch(t.type){case l.Syntax.Identifier:this.validateParam(e,t,t.name);break;case l.Syntax.RestElement:this.checkPatternParam(e,t.argument);break;case l.Syntax.AssignmentPattern:this.checkPatternParam(e,t.left);break;case l.Syntax.ArrayPattern:for(n=0;n<t.elements.length;n++)null!==t.elements[n]&&this.checkPatternParam(e,t.elements[n]);break;case l.Syntax.ObjectPattern:for(var n=0;n<t.properties.length;n++)this.checkPatternParam(e,t.properties[n].value)}e.simple=e.simple&&t instanceof s.Identifier},e.prototype.reinterpretAsCoverFormalsList=function(e){var t,n=[e],i=!1;switch(e.type){case l.Syntax.Identifier:break;case"ArrowParameterPlaceHolder":n=e.params,i=e.async;break;default:return null}t={simple:!0,paramSet:{}};for(r=0;r<n.length;++r)(s=n[r]).type===l.Syntax.AssignmentPattern?s.right.type===l.Syntax.YieldExpression&&(s.right.argument&&this.throwUnexpectedToken(this.lookahead),s.right.type=l.Syntax.Identifier,s.right.name="yield",delete s.right.argument,delete s.right.delegate):i&&s.type===l.Syntax.Identifier&&"await"===s.name&&this.throwUnexpectedToken(this.lookahead),this.checkPatternParam(t,s),n[r]=s;if(this.context.strict||!this.context.allowYield)for(var r=0;r<n.length;++r){var s=n[r];s.type===l.Syntax.YieldExpression&&this.throwUnexpectedToken(this.lookahead)}if(t.message===o.Messages.StrictParamDupe){var a=this.context.strict?t.stricted:t.firstRestricted;this.throwUnexpectedToken(a,t.message)}return{simple:t.simple,params:n,stricted:t.stricted,firstRestricted:t.firstRestricted,message:t.message}},e.prototype.parseAssignmentExpression=function(){var e;if(!this.context.allowYield&&this.matchKeyword("yield"))e=this.parseYieldExpression();else{var t=this.lookahead,n=t;if(e=this.parseConditionalExpression(),3===n.type&&n.lineNumber===this.lookahead.lineNumber&&"async"===n.value&&(3===this.lookahead.type||this.matchKeyword("yield"))){var i=this.parsePrimaryExpression();this.reinterpretExpressionAsPattern(i),e={type:"ArrowParameterPlaceHolder",params:[i],async:!0}}if("ArrowParameterPlaceHolder"===e.type||this.match("=>")){this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;var r=e.async,a=this.reinterpretAsCoverFormalsList(e);if(a){this.hasLineTerminator&&this.tolerateUnexpectedToken(this.lookahead),this.context.firstCoverInitializedNameError=null;var c=this.context.strict,u=this.context.allowStrictDirective;this.context.allowStrictDirective=a.simple;var h=this.context.allowYield,d=this.context.await;this.context.allowYield=!0,this.context.await=r;var p=this.startNode(t);this.expect("=>");var f=void 0;if(this.match("{")){var m=this.context.allowIn;this.context.allowIn=!0,f=this.parseFunctionSourceElements(),this.context.allowIn=m}else f=this.isolateCoverGrammar(this.parseAssignmentExpression);var g=f.type!==l.Syntax.BlockStatement;this.context.strict&&a.firstRestricted&&this.throwUnexpectedToken(a.firstRestricted,a.message),this.context.strict&&a.stricted&&this.tolerateUnexpectedToken(a.stricted,a.message),e=r?this.finalize(p,new s.AsyncArrowFunctionExpression(a.params,f,g)):this.finalize(p,new s.ArrowFunctionExpression(a.params,f,g)),this.context.strict=c,this.context.allowStrictDirective=u,this.context.allowYield=h,this.context.await=d}}else if(this.matchAssign()){if(this.context.isAssignmentTarget||this.tolerateError(o.Messages.InvalidLHSInAssignment),this.context.strict&&e.type===l.Syntax.Identifier){var v=e;this.scanner.isRestrictedWord(v.name)&&this.tolerateUnexpectedToken(n,o.Messages.StrictLHSAssignment),this.scanner.isStrictModeReservedWord(v.name)&&this.tolerateUnexpectedToken(n,o.Messages.StrictReservedWord)}this.match("=")?this.reinterpretExpressionAsPattern(e):(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1);var y=(n=this.nextToken()).value,b=this.isolateCoverGrammar(this.parseAssignmentExpression);e=this.finalize(this.startNode(t),new s.AssignmentExpression(y,e,b)),this.context.firstCoverInitializedNameError=null}}return e},e.prototype.parseExpression=function(){var e=this.lookahead,t=this.isolateCoverGrammar(this.parseAssignmentExpression);if(this.match(",")){var n=[];for(n.push(t);2!==this.lookahead.type&&this.match(",");)this.nextToken(),n.push(this.isolateCoverGrammar(this.parseAssignmentExpression));t=this.finalize(this.startNode(e),new s.SequenceExpression(n))}return t},e.prototype.parseStatementListItem=function(){var e;if(this.context.isAssignmentTarget=!0,this.context.isBindingElement=!0,4===this.lookahead.type)switch(this.lookahead.value){case"export":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,o.Messages.IllegalExportDeclaration),e=this.parseExportDeclaration();break;case"import":this.context.isModule||this.tolerateUnexpectedToken(this.lookahead,o.Messages.IllegalImportDeclaration),e=this.parseImportDeclaration();break;case"const":e=this.parseLexicalDeclaration({inFor:!1});break;case"function":e=this.parseFunctionDeclaration();break;case"class":e=this.parseClassDeclaration();break;case"let":e=this.isLexicalDeclaration()?this.parseLexicalDeclaration({inFor:!1}):this.parseStatement();break;default:e=this.parseStatement()}else e=this.parseStatement();return e},e.prototype.parseBlock=function(){var e=this.createNode();this.expect("{");for(var t=[];!this.match("}");)t.push(this.parseStatementListItem());return this.expect("}"),this.finalize(e,new s.BlockStatement(t))},e.prototype.parseLexicalBinding=function(e,t){var n=this.createNode(),i=[],r=this.parsePattern(i,e);this.context.strict&&r.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(r.name)&&this.tolerateError(o.Messages.StrictVarName);var a=null;return"const"===e?this.matchKeyword("in")||this.matchContextualKeyword("of")||(this.match("=")?(this.nextToken(),a=this.isolateCoverGrammar(this.parseAssignmentExpression)):this.throwError(o.Messages.DeclarationMissingInitializer,"const")):(!t.inFor&&r.type!==l.Syntax.Identifier||this.match("="))&&(this.expect("="),a=this.isolateCoverGrammar(this.parseAssignmentExpression)),this.finalize(n,new s.VariableDeclarator(r,a))},e.prototype.parseBindingList=function(e,t){for(var n=[this.parseLexicalBinding(e,t)];this.match(",");)this.nextToken(),n.push(this.parseLexicalBinding(e,t));return n},e.prototype.isLexicalDeclaration=function(){var e=this.scanner.saveState();this.scanner.scanComments();var t=this.scanner.lex();return this.scanner.restoreState(e),3===t.type||7===t.type&&"["===t.value||7===t.type&&"{"===t.value||4===t.type&&"let"===t.value||4===t.type&&"yield"===t.value},e.prototype.parseLexicalDeclaration=function(e){var t=this.createNode(),n=this.nextToken().value;i.assert("let"===n||"const"===n,"Lexical declaration must be either let or const");var r=this.parseBindingList(n,e);return this.consumeSemicolon(),this.finalize(t,new s.VariableDeclaration(r,n))},e.prototype.parseBindingRestElement=function(e,t){var n=this.createNode();this.expect("...");var i=this.parsePattern(e,t);return this.finalize(n,new s.RestElement(i))},e.prototype.parseArrayPattern=function(e,t){var n=this.createNode();this.expect("[");for(var i=[];!this.match("]");)if(this.match(","))this.nextToken(),i.push(null);else{if(this.match("...")){i.push(this.parseBindingRestElement(e,t));break}i.push(this.parsePatternWithDefault(e,t)),this.match("]")||this.expect(",")}return this.expect("]"),this.finalize(n,new s.ArrayPattern(i))},e.prototype.parsePropertyPattern=function(e,t){var n,i,r=this.createNode(),o=!1,a=!1;if(3===this.lookahead.type){var l=this.lookahead;n=this.parseVariableIdentifier();var c=this.finalize(r,new s.Identifier(l.value));if(this.match("=")){e.push(l),a=!0,this.nextToken();var u=this.parseAssignmentExpression();i=this.finalize(this.startNode(l),new s.AssignmentPattern(c,u))}else this.match(":")?(this.expect(":"),i=this.parsePatternWithDefault(e,t)):(e.push(l),a=!0,i=c)}else o=this.match("["),n=this.parseObjectPropertyKey(),this.expect(":"),i=this.parsePatternWithDefault(e,t);return this.finalize(r,new s.Property("init",n,o,i,!1,a))},e.prototype.parseObjectPattern=function(e,t){var n=this.createNode(),i=[];for(this.expect("{");!this.match("}");)i.push(this.parsePropertyPattern(e,t)),this.match("}")||this.expect(",");return this.expect("}"),this.finalize(n,new s.ObjectPattern(i))},e.prototype.parsePattern=function(e,t){var n;return this.match("[")?n=this.parseArrayPattern(e,t):this.match("{")?n=this.parseObjectPattern(e,t):(!this.matchKeyword("let")||"const"!==t&&"let"!==t||this.tolerateUnexpectedToken(this.lookahead,o.Messages.LetInLexicalBinding),e.push(this.lookahead),n=this.parseVariableIdentifier(t)),n},e.prototype.parsePatternWithDefault=function(e,t){var n=this.lookahead,i=this.parsePattern(e,t);if(this.match("=")){this.nextToken();var r=this.context.allowYield;this.context.allowYield=!0;var o=this.isolateCoverGrammar(this.parseAssignmentExpression);this.context.allowYield=r,i=this.finalize(this.startNode(n),new s.AssignmentPattern(i,o))}return i},e.prototype.parseVariableIdentifier=function(e){var t=this.createNode(),n=this.nextToken();return 4===n.type&&"yield"===n.value?this.context.strict?this.tolerateUnexpectedToken(n,o.Messages.StrictReservedWord):this.context.allowYield||this.throwUnexpectedToken(n):3!==n.type?this.context.strict&&4===n.type&&this.scanner.isStrictModeReservedWord(n.value)?this.tolerateUnexpectedToken(n,o.Messages.StrictReservedWord):(this.context.strict||"let"!==n.value||"var"!==e)&&this.throwUnexpectedToken(n):(this.context.isModule||this.context.await)&&3===n.type&&"await"===n.value&&this.tolerateUnexpectedToken(n),this.finalize(t,new s.Identifier(n.value))},e.prototype.parseVariableDeclaration=function(e){var t=this.createNode(),n=[],i=this.parsePattern(n,"var");this.context.strict&&i.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(i.name)&&this.tolerateError(o.Messages.StrictVarName);var r=null;return this.match("=")?(this.nextToken(),r=this.isolateCoverGrammar(this.parseAssignmentExpression)):i.type===l.Syntax.Identifier||e.inFor||this.expect("="),this.finalize(t,new s.VariableDeclarator(i,r))},e.prototype.parseVariableDeclarationList=function(e){var t={inFor:e.inFor},n=[];for(n.push(this.parseVariableDeclaration(t));this.match(",");)this.nextToken(),n.push(this.parseVariableDeclaration(t));return n},e.prototype.parseVariableStatement=function(){var e=this.createNode();this.expectKeyword("var");var t=this.parseVariableDeclarationList({inFor:!1});return this.consumeSemicolon(),this.finalize(e,new s.VariableDeclaration(t,"var"))},e.prototype.parseEmptyStatement=function(){var e=this.createNode();return this.expect(";"),this.finalize(e,new s.EmptyStatement)},e.prototype.parseExpressionStatement=function(){var e=this.createNode(),t=this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new s.ExpressionStatement(t))},e.prototype.parseIfClause=function(){return this.context.strict&&this.matchKeyword("function")&&this.tolerateError(o.Messages.StrictFunction),this.parseStatement()},e.prototype.parseIfStatement=function(){var e,t=this.createNode(),n=null;this.expectKeyword("if"),this.expect("(");var i=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new s.EmptyStatement)):(this.expect(")"),e=this.parseIfClause(),this.matchKeyword("else")&&(this.nextToken(),n=this.parseIfClause())),this.finalize(t,new s.IfStatement(i,e,n))},e.prototype.parseDoWhileStatement=function(){var e=this.createNode();this.expectKeyword("do");var t=this.context.inIteration;this.context.inIteration=!0;var n=this.parseStatement();this.context.inIteration=t,this.expectKeyword("while"),this.expect("(");var i=this.parseExpression();return!this.match(")")&&this.config.tolerant?this.tolerateUnexpectedToken(this.nextToken()):(this.expect(")"),this.match(";")&&this.nextToken()),this.finalize(e,new s.DoWhileStatement(n,i))},e.prototype.parseWhileStatement=function(){var e,t=this.createNode();this.expectKeyword("while"),this.expect("(");var n=this.parseExpression();if(!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new s.EmptyStatement);else{this.expect(")");var i=this.context.inIteration;this.context.inIteration=!0,e=this.parseStatement(),this.context.inIteration=i}return this.finalize(t,new s.WhileStatement(n,e))},e.prototype.parseForStatement=function(){var e,t,n=null,i=null,r=null,a=!0,c=this.createNode();if(this.expectKeyword("for"),this.expect("("),this.match(";"))this.nextToken();else if(this.matchKeyword("var")){n=this.createNode(),this.nextToken();f=this.context.allowIn;this.context.allowIn=!1;d=this.parseVariableDeclarationList({inFor:!0});if(this.context.allowIn=f,1===d.length&&this.matchKeyword("in")){var u=d[0];u.init&&(u.id.type===l.Syntax.ArrayPattern||u.id.type===l.Syntax.ObjectPattern||this.context.strict)&&this.tolerateError(o.Messages.ForInOfLoopInitializer,"for-in"),n=this.finalize(n,new s.VariableDeclaration(d,"var")),this.nextToken(),e=n,t=this.parseExpression(),n=null}else 1===d.length&&null===d[0].init&&this.matchContextualKeyword("of")?(n=this.finalize(n,new s.VariableDeclaration(d,"var")),this.nextToken(),e=n,t=this.parseAssignmentExpression(),n=null,a=!1):(n=this.finalize(n,new s.VariableDeclaration(d,"var")),this.expect(";"))}else if(this.matchKeyword("const")||this.matchKeyword("let")){n=this.createNode();var h=this.nextToken().value;if(this.context.strict||"in"!==this.lookahead.value){f=this.context.allowIn;this.context.allowIn=!1;var d=this.parseBindingList(h,{inFor:!0});this.context.allowIn=f,1===d.length&&null===d[0].init&&this.matchKeyword("in")?(n=this.finalize(n,new s.VariableDeclaration(d,h)),this.nextToken(),e=n,t=this.parseExpression(),n=null):1===d.length&&null===d[0].init&&this.matchContextualKeyword("of")?(n=this.finalize(n,new s.VariableDeclaration(d,h)),this.nextToken(),e=n,t=this.parseAssignmentExpression(),n=null,a=!1):(this.consumeSemicolon(),n=this.finalize(n,new s.VariableDeclaration(d,h)))}else n=this.finalize(n,new s.Identifier(h)),this.nextToken(),e=n,t=this.parseExpression(),n=null}else{var p=this.lookahead,f=this.context.allowIn;if(this.context.allowIn=!1,n=this.inheritCoverGrammar(this.parseAssignmentExpression),this.context.allowIn=f,this.matchKeyword("in"))this.context.isAssignmentTarget&&n.type!==l.Syntax.AssignmentExpression||this.tolerateError(o.Messages.InvalidLHSInForIn),this.nextToken(),this.reinterpretExpressionAsPattern(n),e=n,t=this.parseExpression(),n=null;else if(this.matchContextualKeyword("of"))this.context.isAssignmentTarget&&n.type!==l.Syntax.AssignmentExpression||this.tolerateError(o.Messages.InvalidLHSInForLoop),this.nextToken(),this.reinterpretExpressionAsPattern(n),e=n,t=this.parseAssignmentExpression(),n=null,a=!1;else{if(this.match(",")){for(var m=[n];this.match(",");)this.nextToken(),m.push(this.isolateCoverGrammar(this.parseAssignmentExpression));n=this.finalize(this.startNode(p),new s.SequenceExpression(m))}this.expect(";")}}void 0===e&&(this.match(";")||(i=this.parseExpression()),this.expect(";"),this.match(")")||(r=this.parseExpression()));var g;if(!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),g=this.finalize(this.createNode(),new s.EmptyStatement);else{this.expect(")");var v=this.context.inIteration;this.context.inIteration=!0,g=this.isolateCoverGrammar(this.parseStatement),this.context.inIteration=v}return void 0===e?this.finalize(c,new s.ForStatement(n,i,r,g)):a?this.finalize(c,new s.ForInStatement(e,t,g)):this.finalize(c,new s.ForOfStatement(e,t,g))},e.prototype.parseContinueStatement=function(){var e=this.createNode();this.expectKeyword("continue");var t=null;if(3===this.lookahead.type&&!this.hasLineTerminator){var n=this.parseVariableIdentifier();t=n;var i="$"+n.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,i)||this.throwError(o.Messages.UnknownLabel,n.name)}return this.consumeSemicolon(),null!==t||this.context.inIteration||this.throwError(o.Messages.IllegalContinue),this.finalize(e,new s.ContinueStatement(t))},e.prototype.parseBreakStatement=function(){var e=this.createNode();this.expectKeyword("break");var t=null;if(3===this.lookahead.type&&!this.hasLineTerminator){var n=this.parseVariableIdentifier(),i="$"+n.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,i)||this.throwError(o.Messages.UnknownLabel,n.name),t=n}return this.consumeSemicolon(),null!==t||this.context.inIteration||this.context.inSwitch||this.throwError(o.Messages.IllegalBreak),this.finalize(e,new s.BreakStatement(t))},e.prototype.parseReturnStatement=function(){this.context.inFunctionBody||this.tolerateError(o.Messages.IllegalReturn);var e=this.createNode();this.expectKeyword("return");var t=!this.match(";")&&!this.match("}")&&!this.hasLineTerminator&&2!==this.lookahead.type?this.parseExpression():null;return this.consumeSemicolon(),this.finalize(e,new s.ReturnStatement(t))},e.prototype.parseWithStatement=function(){this.context.strict&&this.tolerateError(o.Messages.StrictModeWith);var e,t=this.createNode();this.expectKeyword("with"),this.expect("(");var n=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),e=this.finalize(this.createNode(),new s.EmptyStatement)):(this.expect(")"),e=this.parseStatement()),this.finalize(t,new s.WithStatement(n,e))},e.prototype.parseSwitchCase=function(){var e,t=this.createNode();this.matchKeyword("default")?(this.nextToken(),e=null):(this.expectKeyword("case"),e=this.parseExpression()),this.expect(":");for(var n=[];!(this.match("}")||this.matchKeyword("default")||this.matchKeyword("case"));)n.push(this.parseStatementListItem());return this.finalize(t,new s.SwitchCase(e,n))},e.prototype.parseSwitchStatement=function(){var e=this.createNode();this.expectKeyword("switch"),this.expect("(");var t=this.parseExpression();this.expect(")");var n=this.context.inSwitch;this.context.inSwitch=!0;var i=[],r=!1;for(this.expect("{");!this.match("}");){var a=this.parseSwitchCase();null===a.test&&(r&&this.throwError(o.Messages.MultipleDefaultsInSwitch),r=!0),i.push(a)}return this.expect("}"),this.context.inSwitch=n,this.finalize(e,new s.SwitchStatement(t,i))},e.prototype.parseLabelledStatement=function(){var e,t=this.createNode(),n=this.parseExpression();if(n.type===l.Syntax.Identifier&&this.match(":")){this.nextToken();var i=n,r="$"+i.name;Object.prototype.hasOwnProperty.call(this.context.labelSet,r)&&this.throwError(o.Messages.Redeclaration,"Label",i.name),this.context.labelSet[r]=!0;var a=void 0;if(this.matchKeyword("class"))this.tolerateUnexpectedToken(this.lookahead),a=this.parseClassDeclaration();else if(this.matchKeyword("function")){var c=this.lookahead,u=this.parseFunctionDeclaration();this.context.strict?this.tolerateUnexpectedToken(c,o.Messages.StrictFunction):u.generator&&this.tolerateUnexpectedToken(c,o.Messages.GeneratorInLegacyContext),a=u}else a=this.parseStatement();delete this.context.labelSet[r],e=new s.LabeledStatement(i,a)}else this.consumeSemicolon(),e=new s.ExpressionStatement(n);return this.finalize(t,e)},e.prototype.parseThrowStatement=function(){var e=this.createNode();this.expectKeyword("throw"),this.hasLineTerminator&&this.throwError(o.Messages.NewlineAfterThrow);var t=this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new s.ThrowStatement(t))},e.prototype.parseCatchClause=function(){var e=this.createNode();this.expectKeyword("catch"),this.expect("("),this.match(")")&&this.throwUnexpectedToken(this.lookahead);for(var t=[],n=this.parsePattern(t),i={},r=0;r<t.length;r++){var a="$"+t[r].value;Object.prototype.hasOwnProperty.call(i,a)&&this.tolerateError(o.Messages.DuplicateBinding,t[r].value),i[a]=!0}this.context.strict&&n.type===l.Syntax.Identifier&&this.scanner.isRestrictedWord(n.name)&&this.tolerateError(o.Messages.StrictCatchVariable),this.expect(")");var c=this.parseBlock();return this.finalize(e,new s.CatchClause(n,c))},e.prototype.parseFinallyClause=function(){return this.expectKeyword("finally"),this.parseBlock()},e.prototype.parseTryStatement=function(){var e=this.createNode();this.expectKeyword("try");var t=this.parseBlock(),n=this.matchKeyword("catch")?this.parseCatchClause():null,i=this.matchKeyword("finally")?this.parseFinallyClause():null;return n||i||this.throwError(o.Messages.NoCatchOrFinally),this.finalize(e,new s.TryStatement(t,n,i))},e.prototype.parseDebuggerStatement=function(){var e=this.createNode();return this.expectKeyword("debugger"),this.consumeSemicolon(),this.finalize(e,new s.DebuggerStatement)},e.prototype.parseStatement=function(){var e;switch(this.lookahead.type){case 1:case 5:case 6:case 8:case 10:case 9:e=this.parseExpressionStatement();break;case 7:var t=this.lookahead.value;e="{"===t?this.parseBlock():"("===t?this.parseExpressionStatement():";"===t?this.parseEmptyStatement():this.parseExpressionStatement();break;case 3:e=this.matchAsyncFunction()?this.parseFunctionDeclaration():this.parseLabelledStatement();break;case 4:switch(this.lookahead.value){case"break":e=this.parseBreakStatement();break;case"continue":e=this.parseContinueStatement();break;case"debugger":e=this.parseDebuggerStatement();break;case"do":e=this.parseDoWhileStatement();break;case"for":e=this.parseForStatement();break;case"function":e=this.parseFunctionDeclaration();break;case"if":e=this.parseIfStatement();break;case"return":e=this.parseReturnStatement();break;case"switch":e=this.parseSwitchStatement();break;case"throw":e=this.parseThrowStatement();break;case"try":e=this.parseTryStatement();break;case"var":e=this.parseVariableStatement();break;case"while":e=this.parseWhileStatement();break;case"with":e=this.parseWithStatement();break;default:e=this.parseExpressionStatement()}break;default:e=this.throwUnexpectedToken(this.lookahead)}return e},e.prototype.parseFunctionSourceElements=function(){var e=this.createNode();this.expect("{");var t=this.parseDirectivePrologues(),n=this.context.labelSet,i=this.context.inIteration,r=this.context.inSwitch,o=this.context.inFunctionBody;for(this.context.labelSet={},this.context.inIteration=!1,this.context.inSwitch=!1,this.context.inFunctionBody=!0;2!==this.lookahead.type&&!this.match("}");)t.push(this.parseStatementListItem());return this.expect("}"),this.context.labelSet=n,this.context.inIteration=i,this.context.inSwitch=r,this.context.inFunctionBody=o,this.finalize(e,new s.BlockStatement(t))},e.prototype.validateParam=function(e,t,n){var i="$"+n;this.context.strict?(this.scanner.isRestrictedWord(n)&&(e.stricted=t,e.message=o.Messages.StrictParamName),Object.prototype.hasOwnProperty.call(e.paramSet,i)&&(e.stricted=t,e.message=o.Messages.StrictParamDupe)):e.firstRestricted||(this.scanner.isRestrictedWord(n)?(e.firstRestricted=t,e.message=o.Messages.StrictParamName):this.scanner.isStrictModeReservedWord(n)?(e.firstRestricted=t,e.message=o.Messages.StrictReservedWord):Object.prototype.hasOwnProperty.call(e.paramSet,i)&&(e.stricted=t,e.message=o.Messages.StrictParamDupe)),"function"==typeof Object.defineProperty?Object.defineProperty(e.paramSet,i,{value:!0,enumerable:!0,writable:!0,configurable:!0}):e.paramSet[i]=!0},e.prototype.parseRestElement=function(e){var t=this.createNode();this.expect("...");var n=this.parsePattern(e);return this.match("=")&&this.throwError(o.Messages.DefaultRestParameter),this.match(")")||this.throwError(o.Messages.ParameterAfterRestParameter),this.finalize(t,new s.RestElement(n))},e.prototype.parseFormalParameter=function(e){for(var t=[],n=this.match("...")?this.parseRestElement(t):this.parsePatternWithDefault(t),i=0;i<t.length;i++)this.validateParam(e,t[i],t[i].value);e.simple=e.simple&&n instanceof s.Identifier,e.params.push(n)},e.prototype.parseFormalParameters=function(e){var t;if(t={simple:!0,params:[],firstRestricted:e},this.expect("("),!this.match(")"))for(t.paramSet={};2!==this.lookahead.type&&(this.parseFormalParameter(t),!this.match(")"))&&(this.expect(","),!this.match(")")););return this.expect(")"),{simple:t.simple,params:t.params,stricted:t.stricted,firstRestricted:t.firstRestricted,message:t.message}},e.prototype.matchAsyncFunction=function(){var e=this.matchContextualKeyword("async");if(e){var t=this.scanner.saveState();this.scanner.scanComments();var n=this.scanner.lex();this.scanner.restoreState(t),e=t.lineNumber===n.lineNumber&&4===n.type&&"function"===n.value}return e},e.prototype.parseFunctionDeclaration=function(e){var t=this.createNode(),n=this.matchContextualKeyword("async");n&&this.nextToken(),this.expectKeyword("function");var i=!n&&this.match("*");i&&this.nextToken();var r,a=null,l=null;if(!e||!this.match("(")){var c=this.lookahead;a=this.parseVariableIdentifier(),this.context.strict?this.scanner.isRestrictedWord(c.value)&&this.tolerateUnexpectedToken(c,o.Messages.StrictFunctionName):this.scanner.isRestrictedWord(c.value)?(l=c,r=o.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(c.value)&&(l=c,r=o.Messages.StrictReservedWord)}var u=this.context.await,h=this.context.allowYield;this.context.await=n,this.context.allowYield=!i;var d=this.parseFormalParameters(l),p=d.params,f=d.stricted;l=d.firstRestricted,d.message&&(r=d.message);var m=this.context.strict,g=this.context.allowStrictDirective;this.context.allowStrictDirective=d.simple;var v=this.parseFunctionSourceElements();return this.context.strict&&l&&this.throwUnexpectedToken(l,r),this.context.strict&&f&&this.tolerateUnexpectedToken(f,r),this.context.strict=m,this.context.allowStrictDirective=g,this.context.await=u,this.context.allowYield=h,n?this.finalize(t,new s.AsyncFunctionDeclaration(a,p,v)):this.finalize(t,new s.FunctionDeclaration(a,p,v,i))},e.prototype.parseFunctionExpression=function(){var e=this.createNode(),t=this.matchContextualKeyword("async");t&&this.nextToken(),this.expectKeyword("function");var n=!t&&this.match("*");n&&this.nextToken();var i,r,a=null,l=this.context.await,c=this.context.allowYield;if(this.context.await=t,this.context.allowYield=!n,!this.match("(")){var u=this.lookahead;a=this.context.strict||n||!this.matchKeyword("yield")?this.parseVariableIdentifier():this.parseIdentifierName(),this.context.strict?this.scanner.isRestrictedWord(u.value)&&this.tolerateUnexpectedToken(u,o.Messages.StrictFunctionName):this.scanner.isRestrictedWord(u.value)?(r=u,i=o.Messages.StrictFunctionName):this.scanner.isStrictModeReservedWord(u.value)&&(r=u,i=o.Messages.StrictReservedWord)}var h=this.parseFormalParameters(r),d=h.params,p=h.stricted;r=h.firstRestricted,h.message&&(i=h.message);var f=this.context.strict,m=this.context.allowStrictDirective;this.context.allowStrictDirective=h.simple;var g=this.parseFunctionSourceElements();return this.context.strict&&r&&this.throwUnexpectedToken(r,i),this.context.strict&&p&&this.tolerateUnexpectedToken(p,i),this.context.strict=f,this.context.allowStrictDirective=m,this.context.await=l,this.context.allowYield=c,t?this.finalize(e,new s.AsyncFunctionExpression(a,d,g)):this.finalize(e,new s.FunctionExpression(a,d,g,n))},e.prototype.parseDirective=function(){var e=this.lookahead,t=this.createNode(),n=this.parseExpression(),i=n.type===l.Syntax.Literal?this.getTokenRaw(e).slice(1,-1):null;return this.consumeSemicolon(),this.finalize(t,i?new s.Directive(n,i):new s.ExpressionStatement(n))},e.prototype.parseDirectivePrologues=function(){for(var e=null,t=[];;){var n=this.lookahead;if(8!==n.type)break;var i=this.parseDirective();t.push(i);var r=i.directive;if("string"!=typeof r)break;"use strict"===r?(this.context.strict=!0,e&&this.tolerateUnexpectedToken(e,o.Messages.StrictOctalLiteral),this.context.allowStrictDirective||this.tolerateUnexpectedToken(n,o.Messages.IllegalLanguageModeDirective)):!e&&n.octal&&(e=n)}return t},e.prototype.qualifiedPropertyName=function(e){switch(e.type){case 3:case 8:case 1:case 5:case 6:case 4:return!0;case 7:return"["===e.value}return!1},e.prototype.parseGetterMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!1;var n=this.parseFormalParameters();n.params.length>0&&this.tolerateError(o.Messages.BadGetterArity);var i=this.parsePropertyMethod(n);return this.context.allowYield=t,this.finalize(e,new s.FunctionExpression(null,n.params,i,!1))},e.prototype.parseSetterMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!1;var n=this.parseFormalParameters();1!==n.params.length?this.tolerateError(o.Messages.BadSetterArity):n.params[0]instanceof s.RestElement&&this.tolerateError(o.Messages.BadSetterRestParameter);var i=this.parsePropertyMethod(n);return this.context.allowYield=t,this.finalize(e,new s.FunctionExpression(null,n.params,i,!1))},e.prototype.parseGeneratorMethod=function(){var e=this.createNode(),t=this.context.allowYield;this.context.allowYield=!0;var n=this.parseFormalParameters();this.context.allowYield=!1;var i=this.parsePropertyMethod(n);return this.context.allowYield=t,this.finalize(e,new s.FunctionExpression(null,n.params,i,!0))},e.prototype.isStartOfExpression=function(){var e=!0,t=this.lookahead.value;switch(this.lookahead.type){case 7:e="["===t||"("===t||"{"===t||"+"===t||"-"===t||"!"===t||"~"===t||"++"===t||"--"===t||"/"===t||"/="===t;break;case 4:e="class"===t||"delete"===t||"function"===t||"let"===t||"new"===t||"super"===t||"this"===t||"typeof"===t||"void"===t||"yield"===t}return e},e.prototype.parseYieldExpression=function(){var e=this.createNode();this.expectKeyword("yield");var t=null,n=!1;if(!this.hasLineTerminator){var i=this.context.allowYield;this.context.allowYield=!1,(n=this.match("*"))?(this.nextToken(),t=this.parseAssignmentExpression()):this.isStartOfExpression()&&(t=this.parseAssignmentExpression()),this.context.allowYield=i}return this.finalize(e,new s.YieldExpression(t,n))},e.prototype.parseClassElement=function(e){var t=this.lookahead,n=this.createNode(),i="",r=null,a=null,l=!1,c=!1,u=!1,h=!1;if(this.match("*"))this.nextToken();else if(l=this.match("["),"static"===(r=this.parseObjectPropertyKey()).name&&(this.qualifiedPropertyName(this.lookahead)||this.match("*"))&&(t=this.lookahead,u=!0,l=this.match("["),this.match("*")?this.nextToken():r=this.parseObjectPropertyKey()),3===t.type&&!this.hasLineTerminator&&"async"===t.value){var d=this.lookahead.value;":"!==d&&"("!==d&&"*"!==d&&(h=!0,t=this.lookahead,r=this.parseObjectPropertyKey(),3===t.type&&("get"===t.value||"set"===t.value?this.tolerateUnexpectedToken(t):"constructor"===t.value&&this.tolerateUnexpectedToken(t,o.Messages.ConstructorIsAsync)))}var p=this.qualifiedPropertyName(this.lookahead);return 3===t.type?"get"===t.value&&p?(i="get",l=this.match("["),r=this.parseObjectPropertyKey(),this.context.allowYield=!1,a=this.parseGetterMethod()):"set"===t.value&&p&&(i="set",l=this.match("["),r=this.parseObjectPropertyKey(),a=this.parseSetterMethod()):7===t.type&&"*"===t.value&&p&&(i="init",l=this.match("["),r=this.parseObjectPropertyKey(),a=this.parseGeneratorMethod(),c=!0),!i&&r&&this.match("(")&&(i="init",a=h?this.parsePropertyMethodAsyncFunction():this.parsePropertyMethodFunction(),c=!0),i||this.throwUnexpectedToken(this.lookahead),"init"===i&&(i="method"),l||(u&&this.isPropertyKey(r,"prototype")&&this.throwUnexpectedToken(t,o.Messages.StaticPrototype),!u&&this.isPropertyKey(r,"constructor")&&(("method"!==i||!c||a&&a.generator)&&this.throwUnexpectedToken(t,o.Messages.ConstructorSpecialMethod),e.value?this.throwUnexpectedToken(t,o.Messages.DuplicateConstructor):e.value=!0,i="constructor")),this.finalize(n,new s.MethodDefinition(r,l,a,i,u))},e.prototype.parseClassElementList=function(){var e=[],t={value:!1};for(this.expect("{");!this.match("}");)this.match(";")?this.nextToken():e.push(this.parseClassElement(t));return this.expect("}"),e},e.prototype.parseClassBody=function(){var e=this.createNode(),t=this.parseClassElementList();return this.finalize(e,new s.ClassBody(t))},e.prototype.parseClassDeclaration=function(e){var t=this.createNode(),n=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var i=e&&3!==this.lookahead.type?null:this.parseVariableIdentifier(),r=null;this.matchKeyword("extends")&&(this.nextToken(),r=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var o=this.parseClassBody();return this.context.strict=n,this.finalize(t,new s.ClassDeclaration(i,r,o))},e.prototype.parseClassExpression=function(){var e=this.createNode(),t=this.context.strict;this.context.strict=!0,this.expectKeyword("class");var n=3===this.lookahead.type?this.parseVariableIdentifier():null,i=null;this.matchKeyword("extends")&&(this.nextToken(),i=this.isolateCoverGrammar(this.parseLeftHandSideExpressionAllowCall));var r=this.parseClassBody();return this.context.strict=t,this.finalize(e,new s.ClassExpression(n,i,r))},e.prototype.parseModule=function(){this.context.strict=!0,this.context.isModule=!0;for(var e=this.createNode(),t=this.parseDirectivePrologues();2!==this.lookahead.type;)t.push(this.parseStatementListItem());return this.finalize(e,new s.Module(t))},e.prototype.parseScript=function(){for(var e=this.createNode(),t=this.parseDirectivePrologues();2!==this.lookahead.type;)t.push(this.parseStatementListItem());return this.finalize(e,new s.Script(t))},e.prototype.parseModuleSpecifier=function(){var e=this.createNode();8!==this.lookahead.type&&this.throwError(o.Messages.InvalidModuleSpecifier);var t=this.nextToken(),n=this.getTokenRaw(t);return this.finalize(e,new s.Literal(t.value,n))},e.prototype.parseImportSpecifier=function(){var e,t,n=this.createNode();return 3===this.lookahead.type?(e=this.parseVariableIdentifier(),t=e,this.matchContextualKeyword("as")&&(this.nextToken(),t=this.parseVariableIdentifier())):(e=this.parseIdentifierName(),t=e,this.matchContextualKeyword("as")?(this.nextToken(),t=this.parseVariableIdentifier()):this.throwUnexpectedToken(this.nextToken())),this.finalize(n,new s.ImportSpecifier(t,e))},e.prototype.parseNamedImports=function(){this.expect("{");for(var e=[];!this.match("}");)e.push(this.parseImportSpecifier()),this.match("}")||this.expect(",");return this.expect("}"),e},e.prototype.parseImportDefaultSpecifier=function(){var e=this.createNode(),t=this.parseIdentifierName();return this.finalize(e,new s.ImportDefaultSpecifier(t))},e.prototype.parseImportNamespaceSpecifier=function(){var e=this.createNode();this.expect("*"),this.matchContextualKeyword("as")||this.throwError(o.Messages.NoAsAfterImportNamespace),this.nextToken();var t=this.parseIdentifierName();return this.finalize(e,new s.ImportNamespaceSpecifier(t))},e.prototype.parseImportDeclaration=function(){this.context.inFunctionBody&&this.throwError(o.Messages.IllegalImportDeclaration);var e=this.createNode();this.expectKeyword("import");var t,n=[];if(8===this.lookahead.type)t=this.parseModuleSpecifier();else{if(this.match("{")?n=n.concat(this.parseNamedImports()):this.match("*")?n.push(this.parseImportNamespaceSpecifier()):this.isIdentifierName(this.lookahead)&&!this.matchKeyword("default")?(n.push(this.parseImportDefaultSpecifier()),this.match(",")&&(this.nextToken(),this.match("*")?n.push(this.parseImportNamespaceSpecifier()):this.match("{")?n=n.concat(this.parseNamedImports()):this.throwUnexpectedToken(this.lookahead))):this.throwUnexpectedToken(this.nextToken()),!this.matchContextualKeyword("from")){var i=this.lookahead.value?o.Messages.UnexpectedToken:o.Messages.MissingFromClause;this.throwError(i,this.lookahead.value)}this.nextToken(),t=this.parseModuleSpecifier()}return this.consumeSemicolon(),this.finalize(e,new s.ImportDeclaration(n,t))},e.prototype.parseExportSpecifier=function(){var e=this.createNode(),t=this.parseIdentifierName(),n=t;return this.matchContextualKeyword("as")&&(this.nextToken(),n=this.parseIdentifierName()),this.finalize(e,new s.ExportSpecifier(t,n))},e.prototype.parseExportDeclaration=function(){this.context.inFunctionBody&&this.throwError(o.Messages.IllegalExportDeclaration);var e=this.createNode();this.expectKeyword("export");var t;if(this.matchKeyword("default"))if(this.nextToken(),this.matchKeyword("function")){i=this.parseFunctionDeclaration(!0);t=this.finalize(e,new s.ExportDefaultDeclaration(i))}else if(this.matchKeyword("class")){i=this.parseClassDeclaration(!0);t=this.finalize(e,new s.ExportDefaultDeclaration(i))}else if(this.matchContextualKeyword("async")){i=this.matchAsyncFunction()?this.parseFunctionDeclaration(!0):this.parseAssignmentExpression();t=this.finalize(e,new s.ExportDefaultDeclaration(i))}else{this.matchContextualKeyword("from")&&this.throwError(o.Messages.UnexpectedToken,this.lookahead.value);i=this.match("{")?this.parseObjectInitializer():this.match("[")?this.parseArrayInitializer():this.parseAssignmentExpression();this.consumeSemicolon(),t=this.finalize(e,new s.ExportDefaultDeclaration(i))}else if(this.match("*")){if(this.nextToken(),!this.matchContextualKeyword("from")){c=this.lookahead.value?o.Messages.UnexpectedToken:o.Messages.MissingFromClause;this.throwError(c,this.lookahead.value)}this.nextToken();var n=this.parseModuleSpecifier();this.consumeSemicolon(),t=this.finalize(e,new s.ExportAllDeclaration(n))}else if(4===this.lookahead.type){i=void 0;switch(this.lookahead.value){case"let":case"const":i=this.parseLexicalDeclaration({inFor:!1});break;case"var":case"class":case"function":i=this.parseStatementListItem();break;default:this.throwUnexpectedToken(this.lookahead)}t=this.finalize(e,new s.ExportNamedDeclaration(i,[],null))}else if(this.matchAsyncFunction()){var i=this.parseFunctionDeclaration();t=this.finalize(e,new s.ExportNamedDeclaration(i,[],null))}else{var r=[],a=null,l=!1;for(this.expect("{");!this.match("}");)l=l||this.matchKeyword("default"),r.push(this.parseExportSpecifier()),this.match("}")||this.expect(",");if(this.expect("}"),this.matchContextualKeyword("from"))this.nextToken(),a=this.parseModuleSpecifier(),this.consumeSemicolon();else if(l){var c=this.lookahead.value?o.Messages.UnexpectedToken:o.Messages.MissingFromClause;this.throwError(c,this.lookahead.value)}else this.consumeSemicolon();t=this.finalize(e,new s.ExportNamedDeclaration(null,r,a))}return t},e}();t.Parser=u},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assert=function(e,t){if(!e)throw new Error("ASSERT: "+t)}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.errors=[],this.tolerant=!1}return e.prototype.recordError=function(e){this.errors.push(e)},e.prototype.tolerate=function(e){if(!this.tolerant)throw e;this.recordError(e)},e.prototype.constructError=function(e,t){var n=new Error(e);try{throw n}catch(e){Object.create&&Object.defineProperty&&(n=Object.create(e),Object.defineProperty(n,"column",{value:t}))}return n},e.prototype.createError=function(e,t,n,i){var r="Line "+t+": "+i,o=this.constructError(r,n);return o.index=e,o.lineNumber=t,o.description=i,o},e.prototype.throwError=function(e,t,n,i){throw this.createError(e,t,n,i)},e.prototype.tolerateError=function(e,t,n,i){var r=this.createError(e,t,n,i);if(!this.tolerant)throw r;this.recordError(r)},e}();t.ErrorHandler=n},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Messages={BadGetterArity:"Getter must not have any formal parameters",BadSetterArity:"Setter must have exactly one formal parameter",BadSetterRestParameter:"Setter function argument must not be a rest parameter",ConstructorIsAsync:"Class constructor may not be an async method",ConstructorSpecialMethod:"Class constructor may not be an accessor",DeclarationMissingInitializer:"Missing initializer in %0 declaration",DefaultRestParameter:"Unexpected token =",DuplicateBinding:"Duplicate binding %0",DuplicateConstructor:"A class may only have one constructor",DuplicateProtoProperty:"Duplicate __proto__ fields are not allowed in object literals",ForInOfLoopInitializer:"%0 loop variable declaration may not have an initializer",GeneratorInLegacyContext:"Generator declarations are not allowed in legacy contexts",IllegalBreak:"Illegal break statement",IllegalContinue:"Illegal continue statement",IllegalExportDeclaration:"Unexpected token",IllegalImportDeclaration:"Unexpected token",IllegalLanguageModeDirective:"Illegal 'use strict' directive in function with non-simple parameter list",IllegalReturn:"Illegal return statement",InvalidEscapedReservedWord:"Keyword must not contain escaped characters",InvalidHexEscapeSequence:"Invalid hexadecimal escape sequence",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",InvalidLHSInForLoop:"Invalid left-hand side in for-loop",InvalidModuleSpecifier:"Unexpected token",InvalidRegExp:"Invalid regular expression",LetInLexicalBinding:"let is disallowed as a lexically bound name",MissingFromClause:"Unexpected token",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NewlineAfterThrow:"Illegal newline after throw",NoAsAfterImportNamespace:"Unexpected token",NoCatchOrFinally:"Missing catch or finally after try",ParameterAfterRestParameter:"Rest parameter must be last formal parameter",Redeclaration:"%0 '%1' has already been declared",StaticPrototype:"Classes may not have static property named prototype",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictFunction:"In strict mode code, functions can only be declared at top level or inside a block",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictModeWith:"Strict mode code may not include a with statement",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",TemplateOctalLiteral:"Octal literals are not allowed in template strings.",UnexpectedEOS:"Unexpected end of input",UnexpectedIdentifier:"Unexpected identifier",UnexpectedNumber:"Unexpected number",UnexpectedReserved:"Unexpected reserved word",UnexpectedString:"Unexpected string",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedToken:"Unexpected token %0",UnexpectedTokenIllegal:"Unexpected token ILLEGAL",UnknownLabel:"Undefined label '%0'",UnterminatedRegExp:"Invalid regular expression: missing /"}},function(e,t,n){"use strict";function i(e){return"0123456789abcdef".indexOf(e.toLowerCase())}function r(e){return"01234567".indexOf(e)}Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),s=n(4),a=n(11),l=function(){function e(e,t){this.source=e,this.errorHandler=t,this.trackComment=!1,this.length=e.length,this.index=0,this.lineNumber=e.length>0?1:0,this.lineStart=0,this.curlyStack=[]}return e.prototype.saveState=function(){return{index:this.index,lineNumber:this.lineNumber,lineStart:this.lineStart}},e.prototype.restoreState=function(e){this.index=e.index,this.lineNumber=e.lineNumber,this.lineStart=e.lineStart},e.prototype.eof=function(){return this.index>=this.length},e.prototype.throwUnexpectedToken=function(e){return void 0===e&&(e=a.Messages.UnexpectedTokenIllegal),this.errorHandler.throwError(this.index,this.lineNumber,this.index-this.lineStart+1,e)},e.prototype.tolerateUnexpectedToken=function(e){void 0===e&&(e=a.Messages.UnexpectedTokenIllegal),this.errorHandler.tolerateError(this.index,this.lineNumber,this.index-this.lineStart+1,e)},e.prototype.skipSingleLineComment=function(e){var t,n,i=[];for(this.trackComment&&(i=[],t=this.index-e,n={start:{line:this.lineNumber,column:this.index-this.lineStart-e},end:{}});!this.eof();){var r=this.source.charCodeAt(this.index);if(++this.index,s.Character.isLineTerminator(r)){if(this.trackComment){n.end={line:this.lineNumber,column:this.index-this.lineStart-1};o={multiLine:!1,slice:[t+e,this.index-1],range:[t,this.index-1],loc:n};i.push(o)}return 13===r&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,i}}if(this.trackComment){n.end={line:this.lineNumber,column:this.index-this.lineStart};var o={multiLine:!1,slice:[t+e,this.index],range:[t,this.index],loc:n};i.push(o)}return i},e.prototype.skipMultiLineComment=function(){var e,t,n=[];for(this.trackComment&&(n=[],e=this.index-2,t={start:{line:this.lineNumber,column:this.index-this.lineStart-2},end:{}});!this.eof();){var i=this.source.charCodeAt(this.index);if(s.Character.isLineTerminator(i))13===i&&10===this.source.charCodeAt(this.index+1)&&++this.index,++this.lineNumber,++this.index,this.lineStart=this.index;else if(42===i){if(47===this.source.charCodeAt(this.index+1)){if(this.index+=2,this.trackComment){t.end={line:this.lineNumber,column:this.index-this.lineStart};r={multiLine:!0,slice:[e+2,this.index-2],range:[e,this.index],loc:t};n.push(r)}return n}++this.index}else++this.index}if(this.trackComment){t.end={line:this.lineNumber,column:this.index-this.lineStart};var r={multiLine:!0,slice:[e+2,this.index],range:[e,this.index],loc:t};n.push(r)}return this.tolerateUnexpectedToken(),n},e.prototype.scanComments=function(){var e;this.trackComment&&(e=[]);for(var t=0===this.index;!this.eof();){var n=this.source.charCodeAt(this.index);if(s.Character.isWhiteSpace(n))++this.index;else if(s.Character.isLineTerminator(n))++this.index,13===n&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,t=!0;else if(47===n)if(47===(n=this.source.charCodeAt(this.index+1))){this.index+=2;i=this.skipSingleLineComment(2);this.trackComment&&(e=e.concat(i)),t=!0}else{if(42!==n)break;this.index+=2;i=this.skipMultiLineComment();this.trackComment&&(e=e.concat(i))}else if(t&&45===n){if(45!==this.source.charCodeAt(this.index+1)||62!==this.source.charCodeAt(this.index+2))break;this.index+=3;i=this.skipSingleLineComment(3);this.trackComment&&(e=e.concat(i))}else{if(60!==n)break;if("!--"!==this.source.slice(this.index+1,this.index+4))break;this.index+=4;var i=this.skipSingleLineComment(4);this.trackComment&&(e=e.concat(i))}}return e},e.prototype.isFutureReservedWord=function(e){switch(e){case"enum":case"export":case"import":case"super":return!0;default:return!1}},e.prototype.isStrictModeReservedWord=function(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}},e.prototype.isRestrictedWord=function(e){return"eval"===e||"arguments"===e},e.prototype.isKeyword=function(e){switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}},e.prototype.codePointAt=function(e){var t=this.source.charCodeAt(e);if(t>=55296&&t<=56319){var n=this.source.charCodeAt(e+1);n>=56320&&n<=57343&&(t=1024*(t-55296)+n-56320+65536)}return t},e.prototype.scanHexEscape=function(e){for(var t="u"===e?4:2,n=0,r=0;r<t;++r){if(this.eof()||!s.Character.isHexDigit(this.source.charCodeAt(this.index)))return null;n=16*n+i(this.source[this.index++])}return String.fromCharCode(n)},e.prototype.scanUnicodeCodePointEscape=function(){var e=this.source[this.index],t=0;for("}"===e&&this.throwUnexpectedToken();!this.eof()&&(e=this.source[this.index++],s.Character.isHexDigit(e.charCodeAt(0)));)t=16*t+i(e);return(t>1114111||"}"!==e)&&this.throwUnexpectedToken(),s.Character.fromCodePoint(t)},e.prototype.getIdentifier=function(){for(var e=this.index++;!this.eof();){var t=this.source.charCodeAt(this.index);if(92===t)return this.index=e,this.getComplexIdentifier();if(t>=55296&&t<57343)return this.index=e,this.getComplexIdentifier();if(!s.Character.isIdentifierPart(t))break;++this.index}return this.source.slice(e,this.index)},e.prototype.getComplexIdentifier=function(){var e=this.codePointAt(this.index),t=s.Character.fromCodePoint(e);this.index+=t.length;var n;for(92===e&&(117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,n=this.scanUnicodeCodePointEscape()):null!==(n=this.scanHexEscape("u"))&&"\\"!==n&&s.Character.isIdentifierStart(n.charCodeAt(0))||this.throwUnexpectedToken(),t=n);!this.eof()&&(e=this.codePointAt(this.index),s.Character.isIdentifierPart(e));)n=s.Character.fromCodePoint(e),t+=n,this.index+=n.length,92===e&&(t=t.substr(0,t.length-1),117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,n=this.scanUnicodeCodePointEscape()):null!==(n=this.scanHexEscape("u"))&&"\\"!==n&&s.Character.isIdentifierPart(n.charCodeAt(0))||this.throwUnexpectedToken(),t+=n);return t},e.prototype.octalToDecimal=function(e){var t="0"!==e,n=r(e);return!this.eof()&&s.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(t=!0,n=8*n+r(this.source[this.index++]),"0123".indexOf(e)>=0&&!this.eof()&&s.Character.isOctalDigit(this.source.charCodeAt(this.index))&&(n=8*n+r(this.source[this.index++]))),{code:n,octal:t}},e.prototype.scanIdentifier=function(){var e,t=this.index,n=92===this.source.charCodeAt(t)?this.getComplexIdentifier():this.getIdentifier();if(3!=(e=1===n.length?3:this.isKeyword(n)?4:"null"===n?5:"true"===n||"false"===n?1:3)&&t+n.length!==this.index){var i=this.index;this.index=t,this.tolerateUnexpectedToken(a.Messages.InvalidEscapedReservedWord),this.index=i}return{type:e,value:n,lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}},e.prototype.scanPunctuator=function(){var e=this.index,t=this.source[this.index];switch(t){case"(":case"{":"{"===t&&this.curlyStack.push("{"),++this.index;break;case".":++this.index,"."===this.source[this.index]&&"."===this.source[this.index+1]&&(this.index+=2,t="...");break;case"}":++this.index,this.curlyStack.pop();break;case")":case";":case",":case"[":case"]":case":":case"?":case"~":++this.index;break;default:">>>="===(t=this.source.substr(this.index,4))?this.index+=4:"==="===(t=t.substr(0,3))||"!=="===t||">>>"===t||"<<="===t||">>="===t||"**="===t?this.index+=3:"&&"===(t=t.substr(0,2))||"||"===t||"=="===t||"!="===t||"+="===t||"-="===t||"*="===t||"/="===t||"++"===t||"--"===t||"<<"===t||">>"===t||"&="===t||"|="===t||"^="===t||"%="===t||"<="===t||">="===t||"=>"===t||"**"===t?this.index+=2:(t=this.source[this.index],"<>=!+-*%&|^/".indexOf(t)>=0&&++this.index)}return this.index===e&&this.throwUnexpectedToken(),{type:7,value:t,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanHexLiteral=function(e){for(var t="";!this.eof()&&s.Character.isHexDigit(this.source.charCodeAt(this.index));)t+=this.source[this.index++];return 0===t.length&&this.throwUnexpectedToken(),s.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseInt("0x"+t,16),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanBinaryLiteral=function(e){for(var t,n="";!this.eof()&&("0"===(t=this.source[this.index])||"1"===t);)n+=this.source[this.index++];return 0===n.length&&this.throwUnexpectedToken(),this.eof()||(t=this.source.charCodeAt(this.index),(s.Character.isIdentifierStart(t)||s.Character.isDecimalDigit(t))&&this.throwUnexpectedToken()),{type:6,value:parseInt(n,2),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanOctalLiteral=function(e,t){var n="",i=!1;for(s.Character.isOctalDigit(e.charCodeAt(0))?(i=!0,n="0"+this.source[this.index++]):++this.index;!this.eof()&&s.Character.isOctalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];return i||0!==n.length||this.throwUnexpectedToken(),(s.Character.isIdentifierStart(this.source.charCodeAt(this.index))||s.Character.isDecimalDigit(this.source.charCodeAt(this.index)))&&this.throwUnexpectedToken(),{type:6,value:parseInt(n,8),octal:i,lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}},e.prototype.isImplicitOctalLiteral=function(){for(var e=this.index+1;e<this.length;++e){var t=this.source[e];if("8"===t||"9"===t)return!1;if(!s.Character.isOctalDigit(t.charCodeAt(0)))return!0}return!0},e.prototype.scanNumericLiteral=function(){var e=this.index,t=this.source[e];o.assert(s.Character.isDecimalDigit(t.charCodeAt(0))||"."===t,"Numeric literal must start with a decimal digit or a decimal point");var n="";if("."!==t){if(n=this.source[this.index++],t=this.source[this.index],"0"===n){if("x"===t||"X"===t)return++this.index,this.scanHexLiteral(e);if("b"===t||"B"===t)return++this.index,this.scanBinaryLiteral(e);if("o"===t||"O"===t)return this.scanOctalLiteral(t,e);if(t&&s.Character.isOctalDigit(t.charCodeAt(0))&&this.isImplicitOctalLiteral())return this.scanOctalLiteral(t,e)}for(;s.Character.isDecimalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];t=this.source[this.index]}if("."===t){for(n+=this.source[this.index++];s.Character.isDecimalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];t=this.source[this.index]}if("e"===t||"E"===t)if(n+=this.source[this.index++],"+"!==(t=this.source[this.index])&&"-"!==t||(n+=this.source[this.index++]),s.Character.isDecimalDigit(this.source.charCodeAt(this.index)))for(;s.Character.isDecimalDigit(this.source.charCodeAt(this.index));)n+=this.source[this.index++];else this.throwUnexpectedToken();return s.Character.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:6,value:parseFloat(n),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanStringLiteral=function(){var e=this.index,t=this.source[e];o.assert("'"===t||'"'===t,"String literal must starts with a quote"),++this.index;for(var n=!1,i="";!this.eof();){var r=this.source[this.index++];if(r===t){t="";break}if("\\"===r)if((r=this.source[this.index++])&&s.Character.isLineTerminator(r.charCodeAt(0)))++this.lineNumber,"\r"===r&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(r){case"u":if("{"===this.source[this.index])++this.index,i+=this.scanUnicodeCodePointEscape();else{var l=this.scanHexEscape(r);null===l&&this.throwUnexpectedToken(),i+=l}break;case"x":var c=this.scanHexEscape(r);null===c&&this.throwUnexpectedToken(a.Messages.InvalidHexEscapeSequence),i+=c;break;case"n":i+="\n";break;case"r":i+="\r";break;case"t":i+="\t";break;case"b":i+="\b";break;case"f":i+="\f";break;case"v":i+="\v";break;case"8":case"9":i+=r,this.tolerateUnexpectedToken();break;default:if(r&&s.Character.isOctalDigit(r.charCodeAt(0))){var u=this.octalToDecimal(r);n=u.octal||n,i+=String.fromCharCode(u.code)}else i+=r}else{if(s.Character.isLineTerminator(r.charCodeAt(0)))break;i+=r}}return""!==t&&(this.index=e,this.throwUnexpectedToken()),{type:8,value:i,octal:n,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.scanTemplate=function(){var e="",t=!1,n=this.index,i="`"===this.source[n],r=!1,o=2;for(++this.index;!this.eof();){var l=this.source[this.index++];if("`"===l){o=1,r=!0,t=!0;break}if("$"===l){if("{"===this.source[this.index]){this.curlyStack.push("${"),++this.index,t=!0;break}e+=l}else if("\\"===l)if(l=this.source[this.index++],s.Character.isLineTerminator(l.charCodeAt(0)))++this.lineNumber,"\r"===l&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(l){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"u":if("{"===this.source[this.index])++this.index,e+=this.scanUnicodeCodePointEscape();else{var c=this.index,u=this.scanHexEscape(l);null!==u?e+=u:(this.index=c,e+=l)}break;case"x":var h=this.scanHexEscape(l);null===h&&this.throwUnexpectedToken(a.Messages.InvalidHexEscapeSequence),e+=h;break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:"0"===l?(s.Character.isDecimalDigit(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(a.Messages.TemplateOctalLiteral),e+="\0"):s.Character.isOctalDigit(l.charCodeAt(0))?this.throwUnexpectedToken(a.Messages.TemplateOctalLiteral):e+=l}else s.Character.isLineTerminator(l.charCodeAt(0))?(++this.lineNumber,"\r"===l&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index,e+="\n"):e+=l}return t||this.throwUnexpectedToken(),i||this.curlyStack.pop(),{type:10,value:this.source.slice(n+1,this.index-o),cooked:e,head:i,tail:r,lineNumber:this.lineNumber,lineStart:this.lineStart,start:n,end:this.index}},e.prototype.testRegExp=function(e,t){var n=e,i=this;t.indexOf("u")>=0&&(n=n.replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g,function(e,t,n){var r=parseInt(t||n,16);return r>1114111&&i.throwUnexpectedToken(a.Messages.InvalidRegExp),r<=65535?String.fromCharCode(r):""}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,""));try{RegExp(n)}catch(e){this.throwUnexpectedToken(a.Messages.InvalidRegExp)}try{return new RegExp(e,t)}catch(e){return null}},e.prototype.scanRegExpBody=function(){var e=this.source[this.index];o.assert("/"===e,"Regular expression literal must start with a slash");for(var t=this.source[this.index++],n=!1,i=!1;!this.eof();)if(e=this.source[this.index++],t+=e,"\\"===e)e=this.source[this.index++],s.Character.isLineTerminator(e.charCodeAt(0))&&this.throwUnexpectedToken(a.Messages.UnterminatedRegExp),t+=e;else if(s.Character.isLineTerminator(e.charCodeAt(0)))this.throwUnexpectedToken(a.Messages.UnterminatedRegExp);else if(n)"]"===e&&(n=!1);else{if("/"===e){i=!0;break}"["===e&&(n=!0)}return i||this.throwUnexpectedToken(a.Messages.UnterminatedRegExp),t.substr(1,t.length-2)},e.prototype.scanRegExpFlags=function(){for(var e="",t="";!this.eof();){var n=this.source[this.index];if(!s.Character.isIdentifierPart(n.charCodeAt(0)))break;if(++this.index,"\\"!==n||this.eof())t+=n,e+=n;else if("u"===(n=this.source[this.index])){var i=++this.index,r=this.scanHexEscape("u");if(null!==r)for(t+=r,e+="\\u";i<this.index;++i)e+=this.source[i];else this.index=i,t+="u",e+="\\u";this.tolerateUnexpectedToken()}else e+="\\",this.tolerateUnexpectedToken()}return t},e.prototype.scanRegExp=function(){var e=this.index,t=this.scanRegExpBody(),n=this.scanRegExpFlags();return{type:9,value:"",pattern:t,flags:n,regex:this.testRegExp(t,n),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}},e.prototype.lex=function(){if(this.eof())return{type:2,value:"",lineNumber:this.lineNumber,lineStart:this.lineStart,start:this.index,end:this.index};var e=this.source.charCodeAt(this.index);return s.Character.isIdentifierStart(e)?this.scanIdentifier():40===e||41===e||59===e?this.scanPunctuator():39===e||34===e?this.scanStringLiteral():46===e?s.Character.isDecimalDigit(this.source.charCodeAt(this.index+1))?this.scanNumericLiteral():this.scanPunctuator():s.Character.isDecimalDigit(e)?this.scanNumericLiteral():96===e||125===e&&"${"===this.curlyStack[this.curlyStack.length-1]?this.scanTemplate():e>=55296&&e<57343&&s.Character.isIdentifierStart(this.codePointAt(this.index))?this.scanIdentifier():this.scanPunctuator()},e}();t.Scanner=l},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenName={},t.TokenName[1]="Boolean",t.TokenName[2]="<end>",t.TokenName[3]="Identifier",t.TokenName[4]="Keyword",t.TokenName[5]="Null",t.TokenName[6]="Numeric",t.TokenName[7]="Punctuator",t.TokenName[8]="String",t.TokenName[9]="RegularExpression",t.TokenName[10]="Template"},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.XHTMLEntities={quot:'"',amp:"&",apos:"'",gt:">",nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",fnof:"",circ:"",tilde:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",bull:"",hellip:"",permil:"",prime:"",Prime:"",lsaquo:"",rsaquo:"",oline:"",frasl:"",euro:"",image:"",weierp:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",loz:"",spades:"",clubs:"",hearts:"",diams:"",lang:"",rang:""}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),r=n(12),o=n(13),s=function(){function e(){this.values=[],this.curly=this.paren=-1}return e.prototype.beforeFunctionExpression=function(e){return["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","**=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","**","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="].indexOf(e)>=0},e.prototype.isRegexStart=function(){var e=this.values[this.values.length-1],t=null!==e;switch(e){case"this":case"]":t=!1;break;case")":var n=this.values[this.paren-1];t="if"===n||"while"===n||"for"===n||"with"===n;break;case"}":if(t=!1,"function"===this.values[this.curly-3])t=!!(i=this.values[this.curly-4])&&!this.beforeFunctionExpression(i);else if("function"===this.values[this.curly-4]){var i=this.values[this.curly-5];t=!i||!this.beforeFunctionExpression(i)}}return t},e.prototype.push=function(e){7===e.type||4===e.type?("{"===e.value?this.curly=this.values.length:"("===e.value&&(this.paren=this.values.length),this.values.push(e.value)):this.values.push(null)},e}(),a=function(){function e(e,t){this.errorHandler=new i.ErrorHandler,this.errorHandler.tolerant=!!t&&"boolean"==typeof t.tolerant&&t.tolerant,this.scanner=new r.Scanner(e,this.errorHandler),this.scanner.trackComment=!!t&&"boolean"==typeof t.comment&&t.comment,this.trackRange=!!t&&"boolean"==typeof t.range&&t.range,this.trackLoc=!!t&&"boolean"==typeof t.loc&&t.loc,this.buffer=[],this.reader=new s}return e.prototype.errors=function(){return this.errorHandler.errors},e.prototype.getNextToken=function(){if(0===this.buffer.length){var e=this.scanner.scanComments();if(this.scanner.trackComment)for(var t=0;t<e.length;++t){var n=e[t],i=this.scanner.source.slice(n.slice[0],n.slice[1]),r={type:n.multiLine?"BlockComment":"LineComment",value:i};this.trackRange&&(r.range=n.range),this.trackLoc&&(r.loc=n.loc),this.buffer.push(r)}if(!this.scanner.eof()){var s=void 0;this.trackLoc&&(s={start:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},end:{}});var a="/"===this.scanner.source[this.scanner.index]&&this.reader.isRegexStart()?this.scanner.scanRegExp():this.scanner.lex();this.reader.push(a);var l={type:o.TokenName[a.type],value:this.scanner.source.slice(a.start,a.end)};if(this.trackRange&&(l.range=[a.start,a.end]),this.trackLoc&&(s.end={line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart},l.loc=s),9===a.type){var c=a.pattern,u=a.flags;l.regex={pattern:c,flags:u}}this.buffer.push(l)}}return this.buffer.shift()},e}();t.Tokenizer=a}])})},function(e,t){var n;if(function(e){function t(e,n){switch(typeof e){case"undefined":case"boolean":case"string":case"number":return e===n;case"object":if(null===e)return null===n;if(x(e)){if(!x(n)||e.length!==n.length)return!1;for(var i=0,r=e.length;i<r;i++)if(!t(e[i],n[i]))return!1;return!0}var o=p(n).length;if(p(e).length!==o)return!1;for(i=0;i<o;i++)if(!t(e[i],n[i]))return!1;return!0;default:return!1}}function n(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function i(e){for(var t=0,n=v.length;t<n;t++)if(v[t].obj===e)return v[t]}function r(e,t){for(var n=0,i=e.observers.length;n<i;n++)if(e.observers[n].callback===t)return e.observers[n].observer}function o(e,t){for(var n=0,i=e.observers.length;n<i;n++)if(e.observers[n].observer===t)return void e.observers.splice(n,1)}function s(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function a(e){for(var t,n=0,i=v.length;n<i;n++)if(v[n].obj===e.object){t=v[n];break}l(t.value,e.object,e.patches,""),e.patches.length&&u(t.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function l(e,t,i,r){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var o=p(t),a=p(e),c=!1,u=a.length-1;u>=0;u--){var h=e[f=a[u]];if(!t.hasOwnProperty(f)||void 0===t[f]&&void 0!==h&&!1===x(t))i.push({op:"remove",path:r+"/"+n(f)}),c=!0;else{var d=t[f];"object"==typeof h&&null!=h&&"object"==typeof d&&null!=d?l(h,d,i,r+"/"+n(f)):h!==d&&i.push({op:"replace",path:r+"/"+n(f),value:s(d)})}}if(c||o.length!=a.length)for(u=0;u<o.length;u++){var f=o[u];e.hasOwnProperty(f)||void 0===t[f]||i.push({op:"add",path:r+"/"+n(f),value:s(t[f])})}}}function c(e){for(var t,n=0,i=e.length;n<i;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function u(e,t,n){for(var i,r,o=[],s=0,a=t.length;s<a;){i=t[s],s++;for(var l=(i.path||"").split("/"),u=e,h=1,d=l.length,p=void 0;;){if(r=l[h],n&&void 0===p&&(void 0===u[r]?p=l.slice(0,h).join("/"):h==d-1&&(p=i.path),void 0!==p&&this.validator(i,s-1,e,p)),h++,void 0===r&&h>=d){o.push(g[i.op].call(i,u,r,e));break}if(x(u)){if("-"===r)r=u.length;else{if(n&&!c(r))throw new q("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s-1,i.path,i);r=parseInt(r,10)}if(h>=d){if(n&&"add"===i.op&&r>u.length)throw new q("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s-1,i.path,i);o.push(m[i.op].call(i,u,r,e));break}}else if(r&&-1!=r.indexOf("~")&&(r=r.replace(/~1/g,"/").replace(/~0/g,"~")),h>=d){o.push(f[i.op].call(i,u,r,e));break}u=u[r]}}return o}function h(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function d(e){if(void 0===e)return!0;if("array"==typeof e||"object"==typeof e)for(var t in e)if(d(e[t]))return!0;return!1}var p=function(e){if(x(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i);return t},f={add:function(e,t){e[t]=this.value},remove:function(e,t){var n=e[t];return delete e[t],n},replace:function(e,t){var n=e[t];return e[t]=this.value,n},move:function(e,t,n){var i={op:"_get",path:this.path};u(n,[i]);var r=void 0===i.value?void 0:JSON.parse(JSON.stringify(i.value)),o={op:"_get",path:this.from};return u(n,[o]),u(n,[{op:"remove",path:this.from}]),u(n,[{op:"add",path:this.path,value:o.value}]),r},copy:function(e,t,n){var i={op:"_get",path:this.from};u(n,[i]),u(n,[{op:"add",path:this.path,value:i.value}])},test:function(e,n){return t(e[n],this.value)},_get:function(e,t){this.value=e[t]}},m={add:function(e,t){return e.splice(t,0,this.value),t},remove:function(e,t){return e.splice(t,1)[0]},replace:function(e,t){var n=e[t];return e[t]=this.value,n},move:f.move,copy:f.copy,test:f.test,_get:f._get},g={add:function(e){g.remove.call(this,e);for(var t in this.value)this.value.hasOwnProperty(t)&&(e[t]=this.value[t])},remove:function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n],f.remove.call(this,e,n));return t},replace:function(e){var t=u(e,[{op:"remove",path:this.path}]);return u(e,[{op:"add",path:this.path,value:this.value}]),t[0]},move:f.move,copy:f.copy,test:function(e){return JSON.stringify(e)===JSON.stringify(this.value)},_get:function(e){this.value=e}},v=[],y=function(){return function(e){this.observers=[],this.obj=e}}(),b=function(){return function(e,t){this.callback=e,this.observer=t}}();e.unobserve=function(e,t){t.unobserve()},e.observe=function(e,t){var n,l=[],c=i(e);if(c?n=r(c,t):(c=new y(e),v.push(c)),n)return n;if(n={},c.value=s(e),t){n.callback=t,n.next=null;var u=function(){a(n)},h=function(){clearTimeout(n.next),n.next=setTimeout(u)};"undefined"!=typeof window&&(window.addEventListener?(window.addEventListener("mouseup",h),window.addEventListener("keyup",h),window.addEventListener("mousedown",h),window.addEventListener("keydown",h),window.addEventListener("change",h)):(document.documentElement.attachEvent("onmouseup",h),document.documentElement.attachEvent("onkeyup",h),document.documentElement.attachEvent("onmousedown",h),document.documentElement.attachEvent("onkeydown",h),document.documentElement.attachEvent("onchange",h)))}return n.patches=l,n.object=e,n.unobserve=function(){a(n),clearTimeout(n.next),o(c,n),"undefined"!=typeof window&&(window.removeEventListener?(window.removeEventListener("mouseup",h),window.removeEventListener("keyup",h),window.removeEventListener("mousedown",h),window.removeEventListener("keydown",h)):(document.documentElement.detachEvent("onmouseup",h),document.documentElement.detachEvent("onkeyup",h),document.documentElement.detachEvent("onmousedown",h),document.documentElement.detachEvent("onkeydown",h)))},c.observers.push(new b(t,n)),n},e.generate=a;var x;x=Array.isArray?Array.isArray:function(e){return e.push&&"number"==typeof e.length},e.apply=u,e.compare=function(e,t){var n=[];return l(e,t,n,""),n};var q=function(e){function t(t,n,i,r,o){e.call(this,t),this.message=t,this.name=n,this.index=i,this.operation=r,this.tree=o}return h(t,e),t}(Error);e.JsonPatchError=q,e.validator=function(t,n,i,r){if("object"!=typeof t||null===t||x(t))throw new q("Operation is not an object","OPERATION_NOT_AN_OBJECT",n,t,i);if(!f[t.op])throw new q("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",n,t,i);if("string"!=typeof t.path)throw new q("Operation `path` property is not a string","OPERATION_PATH_INVALID",n,t,i);if(0!==t.path.indexOf("/")&&t.path.length>0)throw new q('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",n,t,i);if(("move"===t.op||"copy"===t.op)&&"string"!=typeof t.from)throw new q("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",n,t,i);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&void 0===t.value)throw new q("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",n,t,i);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&d(t.value))throw new q("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",n,t,i);if(i)if("add"==t.op){var o=t.path.split("/").length,s=r.split("/").length;if(o!==s+1&&o!==s)throw new q("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",n,t,i)}else if("replace"===t.op||"remove"===t.op||"_get"===t.op){if(t.path!==r)throw new q("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",n,t,i)}else if("move"===t.op||"copy"===t.op){var a={op:"_get",path:t.from,value:void 0},l=e.validate([a],i);if(l&&"OPERATION_PATH_UNRESOLVABLE"===l.name)throw new q("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",n,t,i)}},e.validate=function(e,t){try{if(!x(e))throw new q("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)t=JSON.parse(JSON.stringify(t)),u.call(this,t,e,!0);else for(var n=0;n<e.length;n++)this.validator(e[n],n)}catch(e){if(e instanceof q)return e;throw e}}}(n||(n={})),void 0!==t)t.apply=n.apply,t.observe=n.observe,t.unobserve=n.unobserve,t.generate=n.generate,t.compare=n.compare,t.validate=n.validate,t.validator=n.validator,t.JsonPatchError=n.JsonPatchError;else var t={},i=!0;Object.defineProperty(t,"__esModule",{value:!0}),t.default=n,i&&(t=void 0)},function(e,t){t.read=function(e,t,n,i,r){var o,s,a=8*r-i-1,l=(1<<a)-1,c=l>>1,u=-7,h=n?r-1:0,d=n?-1:1,p=e[t+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+e[t+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=i;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,i),o-=c}return(p?-1:1)*s*Math.pow(2,o-i)},t.write=function(e,t,n,i,r,o){var s,a,l,c=8*o-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,p=i?0:o-1,f=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(t*l-1)*Math.pow(2,r),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;e[n+p]=255&a,p+=f,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;e[n+p]=255&s,p+=f,s/=256,c-=8);e[n+p-f]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){e.exports=FormData},function(e,t,n){"use strict";var i=n(229);e.exports=i},function(e,t,n){"use strict";function i(e){return function(){throw new Error("Function "+e+" is deprecated and cannot be used.")}}var r=n(231),o=n(230);e.exports.Type=n(1),e.exports.Schema=n(24),e.exports.FAILSAFE_SCHEMA=n(82),e.exports.JSON_SCHEMA=n(121),e.exports.CORE_SCHEMA=n(120),e.exports.DEFAULT_SAFE_SCHEMA=n(35),e.exports.DEFAULT_FULL_SCHEMA=n(48),e.exports.load=r.load,e.exports.loadAll=r.loadAll,e.exports.safeLoad=r.safeLoad,e.exports.safeLoadAll=r.safeLoadAll,e.exports.dump=o.dump,e.exports.safeDump=o.safeDump,e.exports.YAMLException=n(34),e.exports.MINIMAL_SCHEMA=n(82),e.exports.SAFE_SCHEMA=n(35),e.exports.DEFAULT_SCHEMA=n(48),e.exports.scan=i("scan"),e.exports.parse=i("parse"),e.exports.compose=i("compose"),e.exports.addConstructor=i("addConstructor")},function(e,t,n){"use strict";function i(e,t){var n,i,r,o,s,a,l;if(null===t)return{};for(n={},r=0,o=(i=Object.keys(t)).length;r<o;r+=1)s=i[r],a=String(t[s]),"!!"===s.slice(0,2)&&(s="tag:yaml.org,2002:"+s.slice(2)),(l=e.compiledTypeMap.fallback[s])&&O.call(l.styleAliases,a)&&(a=l.styleAliases[a]),n[s]=a;return n}function r(e){var t,n,i;if(t=e.toString(16).toUpperCase(),e<=255)n="x",i=2;else if(e<=65535)n="u",i=4;else{if(!(e<=4294967295))throw new I("code point within a string may not be greater than 0xFFFFFFFF");n="U",i=8}return"\\"+n+E.repeat("0",i-t.length)+t}function o(e){this.schema=e.schema||T,this.indent=Math.max(1,e.indent||2),this.skipInvalid=e.skipInvalid||!1,this.flowLevel=E.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=i(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function s(e,t){for(var n,i=E.repeat(" ",t),r=0,o=-1,s="",a=e.length;r<a;)-1===(o=e.indexOf("\n",r))?(n=e.slice(r),r=a):(n=e.slice(r,o+1),r=o+1),n.length&&"\n"!==n&&(s+=i),s+=n;return s}function a(e,t){return"\n"+E.repeat(" ",e.indent*t)}function l(e,t){var n,i;for(n=0,i=e.implicitTypes.length;n<i;n+=1)if(e.implicitTypes[n].resolve(t))return!0;return!1}function c(e){return e===R||e===P}function u(e){return 32<=e&&e<=126||161<=e&&e<=55295&&8232!==e&&8233!==e||57344<=e&&e<=65533&&65279!==e||65536<=e&&e<=1114111}function h(e){return u(e)&&65279!==e&&e!==U&&e!==Q&&e!==Z&&e!==ee&&e!==ne&&e!==W&&e!==V}function d(e){return u(e)&&65279!==e&&!c(e)&&e!==G&&e!==Y&&e!==W&&e!==U&&e!==Q&&e!==Z&&e!==ee&&e!==ne&&e!==V&&e!==B&&e!==$&&e!==F&&e!==te&&e!==X&&e!==z&&e!==j&&e!==H&&e!==K&&e!==J}function p(e,t,n,i,r){var o,s,a=!1,l=!1,p=-1!==i,f=-1,m=d(e.charCodeAt(0))&&!c(e.charCodeAt(e.length-1));if(t)for(o=0;o<e.length;o++){if(s=e.charCodeAt(o),!u(s))return ce;m=m&&h(s)}else{for(o=0;o<e.length;o++){if((s=e.charCodeAt(o))===N)a=!0,p&&(l=l||o-f-1>i&&" "!==e[f+1],f=o);else if(!u(s))return ce;m=m&&h(s)}l=l||p&&o-f-1>i&&" "!==e[f+1]}return a||l?" "===e[0]&&n>9?ce:l?le:ae:m&&!r(e)?oe:se}function f(e,t,n,i){e.dump=function(){if(0===t.length)return"''";if(!e.noCompatMode&&-1!==re.indexOf(t))return"'"+t+"'";var r=e.indent*Math.max(1,n),o=-1===e.lineWidth?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-r),a=i||e.flowLevel>-1&&n>=e.flowLevel;switch(p(t,a,e.indent,o,function(t){return l(e,t)})){case oe:return t;case se:return"'"+t.replace(/'/g,"''")+"'";case ae:return"|"+m(t,e.indent)+g(s(t,r));case le:return">"+m(t,e.indent)+g(s(v(t,o),r));case ce:return'"'+b(t)+'"';default:throw new I("impossible error: invalid scalar style")}}()}function m(e,t){var n=" "===e[0]?String(t):"",i="\n"===e[e.length-1];return n+(!i||"\n"!==e[e.length-2]&&"\n"!==e?i?"":"-":"+")+"\n"}function g(e){return"\n"===e[e.length-1]?e.slice(0,-1):e}function v(e,t){for(var n,i,r=/(\n+)([^\n]*)/g,o=function(){var n=e.indexOf("\n");return n=-1!==n?n:e.length,r.lastIndex=n,y(e.slice(0,n),t)}(),s="\n"===e[0]||" "===e[0];i=r.exec(e);){var a=i[1],l=i[2];n=" "===l[0],o+=a+(s||n||""===l?"":"\n")+y(l,t),s=n}return o}function y(e,t){if(""===e||" "===e[0])return e;for(var n,i,r=/ [^ ]/g,o=0,s=0,a=0,l="";n=r.exec(e);)(a=n.index)-o>t&&(i=s>o?s:a,l+="\n"+e.slice(o,i),o=i+1),s=a;return l+="\n",e.length-o>t&&s>o?l+=e.slice(o,s)+"\n"+e.slice(s+1):l+=e.slice(o),l.slice(1)}function b(e){for(var t,n,i,o="",s=0;s<e.length;s++)(t=e.charCodeAt(s))>=55296&&t<=56319&&(n=e.charCodeAt(s+1))>=56320&&n<=57343?(o+=r(1024*(t-55296)+n-56320+65536),s++):(i=ie[t],o+=!i&&u(t)?e[s]:i||r(t));return o}function x(e,t,n){var i,r,o="",s=e.tag;for(i=0,r=n.length;i<r;i+=1)_(e,t,n[i],!1,!1)&&(0!==i&&(o+=","+(e.condenseFlow?"":" ")),o+=e.dump);e.tag=s,e.dump="["+o+"]"}function q(e,t,n,i){var r,o,s="",l=e.tag;for(r=0,o=n.length;r<o;r+=1)_(e,t+1,n[r],!0,!0)&&(i&&0===r||(s+=a(e,t)),e.dump&&N===e.dump.charCodeAt(0)?s+="-":s+="- ",s+=e.dump);e.tag=l,e.dump=s||"[]"}function C(e,t,n){var i,r,o,s,a,l="",c=e.tag,u=Object.keys(n);for(i=0,r=u.length;i<r;i+=1)a=e.condenseFlow?'"':"",0!==i&&(a+=", "),o=u[i],s=n[o],_(e,t,o,!1,!1)&&(e.dump.length>1024&&(a+="? "),a+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),_(e,t,s,!1,!1)&&(a+=e.dump,l+=a));e.tag=c,e.dump="{"+l+"}"}function S(e,t,n,i){var r,o,s,l,c,u,h="",d=e.tag,p=Object.keys(n);if(!0===e.sortKeys)p.sort();else if("function"==typeof e.sortKeys)p.sort(e.sortKeys);else if(e.sortKeys)throw new I("sortKeys must be a boolean or a function");for(r=0,o=p.length;r<o;r+=1)u="",i&&0===r||(u+=a(e,t)),s=p[r],l=n[s],_(e,t+1,s,!0,!0,!0)&&((c=null!==e.tag&&"?"!==e.tag||e.dump&&e.dump.length>1024)&&(e.dump&&N===e.dump.charCodeAt(0)?u+="?":u+="? "),u+=e.dump,c&&(u+=a(e,t)),_(e,t+1,l,!0,c)&&(e.dump&&N===e.dump.charCodeAt(0)?u+=":":u+=": ",u+=e.dump,h+=u));e.tag=d,e.dump=h||"{}"}function w(e,t,n){var i,r,o,s,a,l;for(o=0,s=(r=n?e.explicitTypes:e.implicitTypes).length;o<s;o+=1)if(((a=r[o]).instanceOf||a.predicate)&&(!a.instanceOf||"object"==typeof t&&t instanceof a.instanceOf)&&(!a.predicate||a.predicate(t))){if(e.tag=n?a.tag:"?",a.represent){if(l=e.styleMap[a.tag]||a.defaultStyle,"[object Function]"===k.call(a.represent))i=a.represent(t,l);else{if(!O.call(a.represent,l))throw new I("!<"+a.tag+'> tag resolver accepts not "'+l+'" style');i=a.represent[l](t,l)}e.dump=i}return!0}return!1}function _(e,t,n,i,r,o){e.tag=null,e.dump=n,w(e,n,!1)||w(e,n,!0);var s=k.call(e.dump);i&&(i=e.flowLevel<0||e.flowLevel>t);var a,l,c="[object Object]"===s||"[object Array]"===s;if(c&&(a=e.duplicates.indexOf(n),l=-1!==a),(null!==e.tag&&"?"!==e.tag||l||2!==e.indent&&t>0)&&(r=!1),l&&e.usedDuplicates[a])e.dump="*ref_"+a;else{if(c&&l&&!e.usedDuplicates[a]&&(e.usedDuplicates[a]=!0),"[object Object]"===s)i&&0!==Object.keys(e.dump).length?(S(e,t,e.dump,r),l&&(e.dump="&ref_"+a+e.dump)):(C(e,t,e.dump),l&&(e.dump="&ref_"+a+" "+e.dump));else if("[object Array]"===s)i&&0!==e.dump.length?(q(e,t,e.dump,r),l&&(e.dump="&ref_"+a+e.dump)):(x(e,t,e.dump),l&&(e.dump="&ref_"+a+" "+e.dump));else{if("[object String]"!==s){if(e.skipInvalid)return!1;throw new I("unacceptable kind of an object to dump "+s)}"?"!==e.tag&&f(e,e.dump,t,o)}null!==e.tag&&"?"!==e.tag&&(e.dump="!<"+e.tag+"> "+e.dump)}return!0}function D(e,t){var n,i,r=[],o=[];for(M(e,r,o),n=0,i=o.length;n<i;n+=1)t.duplicates.push(r[o[n]]);t.usedDuplicates=new Array(i)}function M(e,t,n){var i,r,o;if(null!==e&&"object"==typeof e)if(-1!==(r=t.indexOf(e)))-1===n.indexOf(r)&&n.push(r);else if(t.push(e),Array.isArray(e))for(r=0,o=e.length;r<o;r+=1)M(e[r],t,n);else for(i=Object.keys(e),r=0,o=i.length;r<o;r+=1)M(e[i[r]],t,n)}function A(e,t){var n=new o(t=t||{});return n.noRefs||D(e,n),_(n,0,e,!0,!0)?n.dump+"\n":""}var E=n(23),I=n(34),T=n(48),L=n(35),k=Object.prototype.toString,O=Object.prototype.hasOwnProperty,P=9,N=10,R=32,F=33,j=34,V=35,H=37,B=38,z=39,$=42,U=44,G=45,W=58,X=62,Y=63,K=64,Q=91,Z=93,J=96,ee=123,te=124,ne=125,ie={};ie[0]="\\0",ie[7]="\\a",ie[8]="\\b",ie[9]="\\t",ie[10]="\\n",ie[11]="\\v",ie[12]="\\f",ie[13]="\\r",ie[27]="\\e",ie[34]='\\"',ie[92]="\\\\",ie[133]="\\N",ie[160]="\\_",ie[8232]="\\L",ie[8233]="\\P";var re=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],oe=1,se=2,ae=3,le=4,ce=5;e.exports.dump=A,e.exports.safeDump=function(e,t){return A(e,E.extend({schema:L},t))}},function(e,t,n){"use strict";function i(e){return 10===e||13===e}function r(e){return 9===e||32===e}function o(e){return 9===e||32===e||10===e||13===e}function s(e){return 44===e||91===e||93===e||123===e||125===e}function a(e){var t;return 48<=e&&e<=57?e-48:97<=(t=32|e)&&t<=102?t-97+10:-1}function l(e){return 120===e?2:117===e?4:85===e?8:0}function c(e){return 48<=e&&e<=57?e-48:-1}function u(e){return 48===e?"\0":97===e?"":98===e?"\b":116===e?"\t":9===e?"\t":110===e?"\n":118===e?"\v":102===e?"\f":114===e?"\r":101===e?"":32===e?" ":34===e?'"':47===e?"/":92===e?"\\":78===e?"":95===e?"":76===e?"\u2028":80===e?"\u2029":""}function h(e){return e<=65535?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10),56320+(e-65536&1023))}function d(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||B,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.documents=[]}function p(e,t){return new j(t,new V(e.filename,e.input,e.position,e.line,e.position-e.lineStart))}function f(e,t){throw p(e,t)}function m(e,t){e.onWarning&&e.onWarning.call(null,p(e,t))}function g(e,t,n,i){var r,o,s,a;if(t<n){if(a=e.input.slice(t,n),i)for(r=0,o=a.length;r<o;r+=1)9===(s=a.charCodeAt(r))||32<=s&&s<=1114111||f(e,"expected valid JSON character");else Q.test(a)&&f(e,"the stream contains non-printable characters");e.result+=a}}function v(e,t,n,i){var r,o,s,a;for(F.isObject(n)||f(e,"cannot merge mappings; the provided source object is unacceptable"),s=0,a=(r=Object.keys(n)).length;s<a;s+=1)o=r[s],z.call(t,o)||(t[o]=n[o],i[o]=!0)}function y(e,t,n,i,r,o,s,a){var l,c;if(r=String(r),null===t&&(t={}),"tag:yaml.org,2002:merge"===i)if(Array.isArray(o))for(l=0,c=o.length;l<c;l+=1)v(e,t,o[l],n);else v(e,t,o,n);else e.json||z.call(n,r)||!z.call(t,r)||(e.line=s||e.line,e.position=a||e.position,f(e,"duplicated mapping key")),t[r]=o,delete n[r];return t}function b(e){var t;10===(t=e.input.charCodeAt(e.position))?e.position++:13===t?(e.position++,10===e.input.charCodeAt(e.position)&&e.position++):f(e,"a line break is expected"),e.line+=1,e.lineStart=e.position}function x(e,t,n){for(var o=0,s=e.input.charCodeAt(e.position);0!==s;){for(;r(s);)s=e.input.charCodeAt(++e.position);if(t&&35===s)do{s=e.input.charCodeAt(++e.position)}while(10!==s&&13!==s&&0!==s);if(!i(s))break;for(b(e),s=e.input.charCodeAt(e.position),o++,e.lineIndent=0;32===s;)e.lineIndent++,s=e.input.charCodeAt(++e.position)}return-1!==n&&0!==o&&e.lineIndent<n&&m(e,"deficient indentation"),o}function q(e){var t,n=e.position;return!(45!==(t=e.input.charCodeAt(n))&&46!==t||t!==e.input.charCodeAt(n+1)||t!==e.input.charCodeAt(n+2)||(n+=3,0!==(t=e.input.charCodeAt(n))&&!o(t)))}function C(e,t){1===t?e.result+=" ":t>1&&(e.result+=F.repeat("\n",t-1))}function S(e,t,n){var a,l,c,u,h,d,p,f,m,v=e.kind,y=e.result;if(m=e.input.charCodeAt(e.position),o(m)||s(m)||35===m||38===m||42===m||33===m||124===m||62===m||39===m||34===m||37===m||64===m||96===m)return!1;if((63===m||45===m)&&(l=e.input.charCodeAt(e.position+1),o(l)||n&&s(l)))return!1;for(e.kind="scalar",e.result="",c=u=e.position,h=!1;0!==m;){if(58===m){if(l=e.input.charCodeAt(e.position+1),o(l)||n&&s(l))break}else if(35===m){if(a=e.input.charCodeAt(e.position-1),o(a))break}else{if(e.position===e.lineStart&&q(e)||n&&s(m))break;if(i(m)){if(d=e.line,p=e.lineStart,f=e.lineIndent,x(e,!1,-1),e.lineIndent>=t){h=!0,m=e.input.charCodeAt(e.position);continue}e.position=u,e.line=d,e.lineStart=p,e.lineIndent=f;break}}h&&(g(e,c,u,!1),C(e,e.line-d),c=u=e.position,h=!1),r(m)||(u=e.position+1),m=e.input.charCodeAt(++e.position)}return g(e,c,u,!1),!!e.result||(e.kind=v,e.result=y,!1)}function w(e,t){var n,r,o;if(39!==(n=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,r=o=e.position;0!==(n=e.input.charCodeAt(e.position));)if(39===n){if(g(e,r,e.position,!0),39!==(n=e.input.charCodeAt(++e.position)))return!0;r=e.position,e.position++,o=e.position}else i(n)?(g(e,r,o,!0),C(e,x(e,!1,t)),r=o=e.position):e.position===e.lineStart&&q(e)?f(e,"unexpected end of the document within a single quoted scalar"):(e.position++,o=e.position);f(e,"unexpected end of the stream within a single quoted scalar")}function _(e,t){var n,r,o,s,c,u;if(34!==(u=e.input.charCodeAt(e.position)))return!1;for(e.kind="scalar",e.result="",e.position++,n=r=e.position;0!==(u=e.input.charCodeAt(e.position));){if(34===u)return g(e,n,e.position,!0),e.position++,!0;if(92===u){if(g(e,n,e.position,!0),u=e.input.charCodeAt(++e.position),i(u))x(e,!1,t);else if(u<256&&ne[u])e.result+=ie[u],e.position++;else if((c=l(u))>0){for(o=c,s=0;o>0;o--)u=e.input.charCodeAt(++e.position),(c=a(u))>=0?s=(s<<4)+c:f(e,"expected hexadecimal character");e.result+=h(s),e.position++}else f(e,"unknown escape sequence");n=r=e.position}else i(u)?(g(e,n,r,!0),C(e,x(e,!1,t)),n=r=e.position):e.position===e.lineStart&&q(e)?f(e,"unexpected end of the document within a double quoted scalar"):(e.position++,r=e.position)}f(e,"unexpected end of the stream within a double quoted scalar")}function D(e,t){var n,i,r,s,a,l,c,u,h,d,p,m=!0,g=e.tag,v=e.anchor,b={};if(91===(p=e.input.charCodeAt(e.position)))s=93,c=!1,i=[];else{if(123!==p)return!1;s=125,c=!0,i={}}for(null!==e.anchor&&(e.anchorMap[e.anchor]=i),p=e.input.charCodeAt(++e.position);0!==p;){if(x(e,!0,t),(p=e.input.charCodeAt(e.position))===s)return e.position++,e.tag=g,e.anchor=v,e.kind=c?"mapping":"sequence",e.result=i,!0;m||f(e,"missed comma between flow collection entries"),h=u=d=null,a=l=!1,63===p&&(r=e.input.charCodeAt(e.position+1),o(r)&&(a=l=!0,e.position++,x(e,!0,t))),n=e.line,k(e,t,$,!1,!0),h=e.tag,u=e.result,x(e,!0,t),p=e.input.charCodeAt(e.position),!l&&e.line!==n||58!==p||(a=!0,p=e.input.charCodeAt(++e.position),x(e,!0,t),k(e,t,$,!1,!0),d=e.result),c?y(e,i,b,h,u,d):a?i.push(y(e,null,b,h,u,d)):i.push(u),x(e,!0,t),44===(p=e.input.charCodeAt(e.position))?(m=!0,p=e.input.charCodeAt(++e.position)):m=!1}f(e,"unexpected end of the stream within a flow collection")}function M(e,t){var n,o,s,a,l=X,u=!1,h=!1,d=t,p=0,m=!1;if(124===(a=e.input.charCodeAt(e.position)))o=!1;else{if(62!==a)return!1;o=!0}for(e.kind="scalar",e.result="";0!==a;)if(43===(a=e.input.charCodeAt(++e.position))||45===a)X===l?l=43===a?K:Y:f(e,"repeat of a chomping mode identifier");else{if(!((s=c(a))>=0))break;0===s?f(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):h?f(e,"repeat of an indentation width identifier"):(d=t+s-1,h=!0)}if(r(a)){do{a=e.input.charCodeAt(++e.position)}while(r(a));if(35===a)do{a=e.input.charCodeAt(++e.position)}while(!i(a)&&0!==a)}for(;0!==a;){for(b(e),e.lineIndent=0,a=e.input.charCodeAt(e.position);(!h||e.lineIndent<d)&&32===a;)e.lineIndent++,a=e.input.charCodeAt(++e.position);if(!h&&e.lineIndent>d&&(d=e.lineIndent),i(a))p++;else{if(e.lineIndent<d){l===K?e.result+=F.repeat("\n",u?1+p:p):l===X&&u&&(e.result+="\n");break}for(o?r(a)?(m=!0,e.result+=F.repeat("\n",u?1+p:p)):m?(m=!1,e.result+=F.repeat("\n",p+1)):0===p?u&&(e.result+=" "):e.result+=F.repeat("\n",p):e.result+=F.repeat("\n",u?1+p:p),u=!0,h=!0,p=0,n=e.position;!i(a)&&0!==a;)a=e.input.charCodeAt(++e.position);g(e,n,e.position,!1)}}return!0}function A(e,t){var n,i,r,s=e.tag,a=e.anchor,l=[],c=!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=l),r=e.input.charCodeAt(e.position);0!==r&&45===r&&(i=e.input.charCodeAt(e.position+1),o(i));)if(c=!0,e.position++,x(e,!0,-1)&&e.lineIndent<=t)l.push(null),r=e.input.charCodeAt(e.position);else if(n=e.line,k(e,t,G,!1,!0),l.push(e.result),x(e,!0,-1),r=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>t)&&0!==r)f(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break;return!!c&&(e.tag=s,e.anchor=a,e.kind="sequence",e.result=l,!0)}function E(e,t,n){var i,s,a,l,c,u=e.tag,h=e.anchor,d={},p={},m=null,g=null,v=null,b=!1,q=!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=d),c=e.input.charCodeAt(e.position);0!==c;){if(i=e.input.charCodeAt(e.position+1),a=e.line,l=e.position,63!==c&&58!==c||!o(i)){if(!k(e,n,U,!1,!0))break;if(e.line===a){for(c=e.input.charCodeAt(e.position);r(c);)c=e.input.charCodeAt(++e.position);if(58===c)c=e.input.charCodeAt(++e.position),o(c)||f(e,"a whitespace character is expected after the key-value separator within a block mapping"),b&&(y(e,d,p,m,g,null),m=g=v=null),q=!0,b=!1,s=!1,m=e.tag,g=e.result;else{if(!q)return e.tag=u,e.anchor=h,!0;f(e,"can not read an implicit mapping pair; a colon is missed")}}else{if(!q)return e.tag=u,e.anchor=h,!0;f(e,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===c?(b&&(y(e,d,p,m,g,null),m=g=v=null),q=!0,b=!0,s=!0):b?(b=!1,s=!0):f(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,c=i;if((e.line===a||e.lineIndent>t)&&(k(e,t,W,!0,s)&&(b?g=e.result:v=e.result),b||(y(e,d,p,m,g,v,a,l),m=g=v=null),x(e,!0,-1),c=e.input.charCodeAt(e.position)),e.lineIndent>t&&0!==c)f(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return b&&y(e,d,p,m,g,null),q&&(e.tag=u,e.anchor=h,e.kind="mapping",e.result=d),q}function I(e){var t,n,i,r,s=!1,a=!1;if(33!==(r=e.input.charCodeAt(e.position)))return!1;if(null!==e.tag&&f(e,"duplication of a tag property"),60===(r=e.input.charCodeAt(++e.position))?(s=!0,r=e.input.charCodeAt(++e.position)):33===r?(a=!0,n="!!",r=e.input.charCodeAt(++e.position)):n="!",t=e.position,s){do{r=e.input.charCodeAt(++e.position)}while(0!==r&&62!==r);e.position<e.length?(i=e.input.slice(t,e.position),r=e.input.charCodeAt(++e.position)):f(e,"unexpected end of the stream within a verbatim tag")}else{for(;0!==r&&!o(r);)33===r&&(a?f(e,"tag suffix cannot contain exclamation marks"):(n=e.input.slice(t-1,e.position+1),ee.test(n)||f(e,"named tag handle cannot contain such characters"),a=!0,t=e.position+1)),r=e.input.charCodeAt(++e.position);i=e.input.slice(t,e.position),J.test(i)&&f(e,"tag suffix cannot contain flow indicator characters")}return i&&!te.test(i)&&f(e,"tag name cannot contain such characters: "+i),s?e.tag=i:z.call(e.tagMap,n)?e.tag=e.tagMap[n]+i:"!"===n?e.tag="!"+i:"!!"===n?e.tag="tag:yaml.org,2002:"+i:f(e,'undeclared tag handle "'+n+'"'),!0}function T(e){var t,n;if(38!==(n=e.input.charCodeAt(e.position)))return!1;for(null!==e.anchor&&f(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),t=e.position;0!==n&&!o(n)&&!s(n);)n=e.input.charCodeAt(++e.position);return e.position===t&&f(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function L(e){var t,n,i;if(42!==(i=e.input.charCodeAt(e.position)))return!1;for(i=e.input.charCodeAt(++e.position),t=e.position;0!==i&&!o(i)&&!s(i);)i=e.input.charCodeAt(++e.position);return e.position===t&&f(e,"name of an alias node must contain at least one character"),n=e.input.slice(t,e.position),e.anchorMap.hasOwnProperty(n)||f(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],x(e,!0,-1),!0}function k(e,t,n,i,r){var o,s,a,l,c,u,h,d,p=1,m=!1,g=!1;if(null!==e.listener&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,o=s=a=W===n||G===n,i&&x(e,!0,-1)&&(m=!0,e.lineIndent>t?p=1:e.lineIndent===t?p=0:e.lineIndent<t&&(p=-1)),1===p)for(;I(e)||T(e);)x(e,!0,-1)?(m=!0,a=o,e.lineIndent>t?p=1:e.lineIndent===t?p=0:e.lineIndent<t&&(p=-1)):a=!1;if(a&&(a=m||r),1!==p&&W!==n||(h=$===n||U===n?t:t+1,d=e.position-e.lineStart,1===p?a&&(A(e,d)||E(e,d,h))||D(e,h)?g=!0:(s&&M(e,h)||w(e,h)||_(e,h)?g=!0:L(e)?(g=!0,null===e.tag&&null===e.anchor||f(e,"alias node should not have any properties")):S(e,h,$===n)&&(g=!0,null===e.tag&&(e.tag="?")),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):0===p&&(g=a&&A(e,d))),null!==e.tag&&"!"!==e.tag)if("?"===e.tag){for(l=0,c=e.implicitTypes.length;l<c;l+=1)if((u=e.implicitTypes[l]).resolve(e.result)){e.result=u.construct(e.result),e.tag=u.tag,null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);break}}else z.call(e.typeMap[e.kind||"fallback"],e.tag)?(u=e.typeMap[e.kind||"fallback"][e.tag],null!==e.result&&u.kind!==e.kind&&f(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+u.kind+'", not "'+e.kind+'"'),u.resolve(e.result)?(e.result=u.construct(e.result),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):f(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")):f(e,"unknown tag !<"+e.tag+">");return null!==e.listener&&e.listener("close",e),null!==e.tag||null!==e.anchor||g}function O(e){var t,n,s,a,l=e.position,c=!1;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap={},e.anchorMap={};0!==(a=e.input.charCodeAt(e.position))&&(x(e,!0,-1),a=e.input.charCodeAt(e.position),!(e.lineIndent>0||37!==a));){for(c=!0,a=e.input.charCodeAt(++e.position),t=e.position;0!==a&&!o(a);)a=e.input.charCodeAt(++e.position);for(s=[],(n=e.input.slice(t,e.position)).length<1&&f(e,"directive name must not be less than one character in length");0!==a;){for(;r(a);)a=e.input.charCodeAt(++e.position);if(35===a){do{a=e.input.charCodeAt(++e.position)}while(0!==a&&!i(a));break}if(i(a))break;for(t=e.position;0!==a&&!o(a);)a=e.input.charCodeAt(++e.position);s.push(e.input.slice(t,e.position))}0!==a&&b(e),z.call(oe,n)?oe[n](e,n,s):m(e,'unknown document directive "'+n+'"')}x(e,!0,-1),0===e.lineIndent&&45===e.input.charCodeAt(e.position)&&45===e.input.charCodeAt(e.position+1)&&45===e.input.charCodeAt(e.position+2)?(e.position+=3,x(e,!0,-1)):c&&f(e,"directives end mark is expected"),k(e,e.lineIndent-1,W,!1,!0),x(e,!0,-1),e.checkLineBreaks&&Z.test(e.input.slice(l,e.position))&&m(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&q(e)?46===e.input.charCodeAt(e.position)&&(e.position+=3,x(e,!0,-1)):e.position<e.length-1&&f(e,"end of the stream or a document separator is expected")}function P(e,t){e=String(e),t=t||{},0!==e.length&&(10!==e.charCodeAt(e.length-1)&&13!==e.charCodeAt(e.length-1)&&(e+="\n"),65279===e.charCodeAt(0)&&(e=e.slice(1)));var n=new d(e,t);for(n.input+="\0";32===n.input.charCodeAt(n.position);)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)O(n);return n.documents}function N(e,t,n){var i,r,o=P(e,n);if("function"!=typeof t)return o;for(i=0,r=o.length;i<r;i+=1)t(o[i])}function R(e,t){var n=P(e,t);if(0!==n.length){if(1===n.length)return n[0];throw new j("expected a single document in the stream, but found more")}}for(var F=n(23),j=n(34),V=n(232),H=n(35),B=n(48),z=Object.prototype.hasOwnProperty,$=1,U=2,G=3,W=4,X=1,Y=2,K=3,Q=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Z=/[\x85\u2028\u2029]/,J=/[,\[\]\{\}]/,ee=/^(?:!|!!|![a-z\-]+!)$/i,te=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i,ne=new Array(256),ie=new Array(256),re=0;re<256;re++)ne[re]=u(re)?1:0,ie[re]=u(re);var oe={YAML:function(e,t,n){var i,r,o;null!==e.version&&f(e,"duplication of %YAML directive"),1!==n.length&&f(e,"YAML directive accepts exactly one argument"),null===(i=/^([0-9]+)\.([0-9]+)$/.exec(n[0]))&&f(e,"ill-formed argument of the YAML directive"),r=parseInt(i[1],10),o=parseInt(i[2],10),1!==r&&f(e,"unacceptable YAML version of the document"),e.version=n[0],e.checkLineBreaks=o<2,1!==o&&2!==o&&m(e,"unsupported YAML version of the document")},TAG:function(e,t,n){var i,r;2!==n.length&&f(e,"TAG directive accepts exactly two arguments"),i=n[0],r=n[1],ee.test(i)||f(e,"ill-formed tag handle (first argument) of the TAG directive"),z.call(e.tagMap,i)&&f(e,'there is a previously declared suffix for "'+i+'" tag handle'),te.test(r)||f(e,"ill-formed tag prefix (second argument) of the TAG directive"),e.tagMap[i]=r}};e.exports.loadAll=N,e.exports.load=R,e.exports.safeLoadAll=function(e,t,n){if("function"!=typeof t)return N(e,F.extend({schema:H},n));N(e,t,F.extend({schema:H},n))},e.exports.safeLoad=function(e,t){return R(e,F.extend({schema:H},t))}},function(e,t,n){"use strict";function i(e,t,n,i,r){this.name=e,this.buffer=t,this.position=n,this.line=i,this.column=r}var r=n(23);i.prototype.getSnippet=function(e,t){var n,i,o,s,a;if(!this.buffer)return null;for(e=e||4,t=t||75,n="",i=this.position;i>0&&-1==="\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(i-1));)if(i-=1,this.position-i>t/2-1){n=" ... ",i+=5;break}for(o="",s=this.position;s<this.buffer.length&&-1==="\0\r\n\u2028\u2029".indexOf(this.buffer.charAt(s));)if((s+=1)-this.position>t/2-1){o=" ... ",s-=5;break}return a=this.buffer.slice(i,s),r.repeat(" ",e)+n+a+o+"\n"+r.repeat(" ",e+this.position-i+n.length)+"^"},i.prototype.toString=function(e){var t,n="";return this.name&&(n+='in "'+this.name+'" '),n+="at line "+(this.line+1)+", column "+(this.column+1),e||(t=this.getSnippet())&&(n+=":\n"+t),n},e.exports=i},function(e,t,n){"use strict";var i;try{i=n(61).Buffer}catch(e){}var r=n(1),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";e.exports=new r("tag:yaml.org,2002:binary",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,n,i=0,r=e.length,s=o;for(n=0;n<r;n++)if(!((t=s.indexOf(e.charAt(n)))>64)){if(t<0)return!1;i+=6}return i%8==0},construct:function(e){var t,n,r=e.replace(/[\r\n=]/g,""),s=r.length,a=o,l=0,c=[];for(t=0;t<s;t++)t%4==0&&t&&(c.push(l>>16&255),c.push(l>>8&255),c.push(255&l)),l=l<<6|a.indexOf(r.charAt(t));return 0==(n=s%4*6)?(c.push(l>>16&255),c.push(l>>8&255),c.push(255&l)):18===n?(c.push(l>>10&255),c.push(l>>2&255)):12===n&&c.push(l>>4&255),i?i.from?i.from(c):new i(c):c},predicate:function(e){return i&&i.isBuffer(e)},represent:function(e){var t,n,i="",r=0,s=e.length,a=o;for(t=0;t<s;t++)t%3==0&&t&&(i+=a[r>>18&63],i+=a[r>>12&63],i+=a[r>>6&63],i+=a[63&r]),r=(r<<8)+e[t];return 0==(n=s%3)?(i+=a[r>>18&63],i+=a[r>>12&63],i+=a[r>>6&63],i+=a[63&r]):2===n?(i+=a[r>>10&63],i+=a[r>>4&63],i+=a[r<<2&63],i+=a[64]):1===n&&(i+=a[r>>2&63],i+=a[r<<4&63],i+=a[64],i+=a[64]),i}})},function(e,t,n){"use strict";var i=n(1);e.exports=new i("tag:yaml.org,2002:bool",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t=e.length;return 4===t&&("true"===e||"True"===e||"TRUE"===e)||5===t&&("false"===e||"False"===e||"FALSE"===e)},construct:function(e){return"true"===e||"True"===e||"TRUE"===e},predicate:function(e){return"[object Boolean]"===Object.prototype.toString.call(e)},represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"})},function(e,t,n){"use strict";var i=n(23),r=n(1),o=new RegExp("^(?:[-+]?(?:0|[1-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),s=/^[-+]?[0-9]+e/;e.exports=new r("tag:yaml.org,2002:float",{kind:"scalar",resolve:function(e){return null!==e&&!(!o.test(e)||"_"===e[e.length-1])},construct:function(e){var t,n,i,r;return t=e.replace(/_/g,"").toLowerCase(),n="-"===t[0]?-1:1,r=[],"+-".indexOf(t[0])>=0&&(t=t.slice(1)),".inf"===t?1===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===t?NaN:t.indexOf(":")>=0?(t.split(":").forEach(function(e){r.unshift(parseFloat(e,10))}),t=0,i=1,r.forEach(function(e){t+=e*i,i*=60}),n*t):n*parseFloat(t,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&(e%1!=0||i.isNegativeZero(e))},represent:function(e,t){var n;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(i.isNegativeZero(e))return"-0.0";return n=e.toString(10),s.test(n)?n.replace("e",".e"):n},defaultStyle:"lowercase"})},function(e,t,n){"use strict";function i(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function r(e){return 48<=e&&e<=55}function o(e){return 48<=e&&e<=57}var s=n(23),a=n(1);e.exports=new a("tag:yaml.org,2002:int",{kind:"scalar",resolve:function(e){if(null===e)return!1;var t,n=e.length,s=0,a=!1;if(!n)return!1;if("-"!==(t=e[s])&&"+"!==t||(t=e[++s]),"0"===t){if(s+1===n)return!0;if("b"===(t=e[++s])){for(s++;s<n;s++)if("_"!==(t=e[s])){if("0"!==t&&"1"!==t)return!1;a=!0}return a&&"_"!==t}if("x"===t){for(s++;s<n;s++)if("_"!==(t=e[s])){if(!i(e.charCodeAt(s)))return!1;a=!0}return a&&"_"!==t}for(;s<n;s++)if("_"!==(t=e[s])){if(!r(e.charCodeAt(s)))return!1;a=!0}return a&&"_"!==t}if("_"===t)return!1;for(;s<n;s++)if("_"!==(t=e[s])){if(":"===t)break;if(!o(e.charCodeAt(s)))return!1;a=!0}return!(!a||"_"===t)&&(":"!==t||/^(:[0-5]?[0-9])+$/.test(e.slice(s)))},construct:function(e){var t,n,i=e,r=1,o=[];return-1!==i.indexOf("_")&&(i=i.replace(/_/g,"")),"-"!==(t=i[0])&&"+"!==t||("-"===t&&(r=-1),i=i.slice(1),t=i[0]),"0"===i?0:"0"===t?"b"===i[1]?r*parseInt(i.slice(2),2):"x"===i[1]?r*parseInt(i,16):r*parseInt(i,8):-1!==i.indexOf(":")?(i.split(":").forEach(function(e){o.unshift(parseInt(e,10))}),i=0,n=1,o.forEach(function(e){i+=e*n,n*=60}),r*i):r*parseInt(i,10)},predicate:function(e){return"[object Number]"===Object.prototype.toString.call(e)&&e%1==0&&!s.isNegativeZero(e)},represent:{binary:function(e){return"0b"+e.toString(2)},octal:function(e){return"0"+e.toString(8)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return"0x"+e.toString(16).toUpperCase()}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}})},function(e,t,n){"use strict";var i;try{i=n(223)}catch(e){"undefined"!=typeof window&&(i=window.esprima)}var r=n(1);e.exports=new r("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:function(e){if(null===e)return!1;try{var t="("+e+")",n=i.parse(t,{range:!0});return"Program"===n.type&&1===n.body.length&&"ExpressionStatement"===n.body[0].type&&"FunctionExpression"===n.body[0].expression.type}catch(e){return!1}},construct:function(e){var t,n="("+e+")",r=i.parse(n,{range:!0}),o=[];if("Program"!==r.type||1!==r.body.length||"ExpressionStatement"!==r.body[0].type||"FunctionExpression"!==r.body[0].expression.type)throw new Error("Failed to resolve function");return r.body[0].expression.params.forEach(function(e){o.push(e.name)}),t=r.body[0].expression.body.range,new Function(o,n.slice(t[0]+1,t[1]-1))},predicate:function(e){return"[object Function]"===Object.prototype.toString.call(e)},represent:function(e){return e.toString()}})},function(e,t,n){"use strict";var i=n(1);e.exports=new i("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:function(e){if(null===e)return!1;if(0===e.length)return!1;var t=e,n=/\/([gim]*)$/.exec(e),i="";if("/"===t[0]){if(n&&(i=n[1]),i.length>3)return!1;if("/"!==t[t.length-i.length-1])return!1}return!0},construct:function(e){var t=e,n=/\/([gim]*)$/.exec(e),i="";return"/"===t[0]&&(n&&(i=n[1]),t=t.slice(1,t.length-i.length-1)),new RegExp(t,i)},predicate:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},represent:function(e){var t="/"+e.source+"/";return e.global&&(t+="g"),e.multiline&&(t+="m"),e.ignoreCase&&(t+="i"),t}})},function(e,t,n){"use strict";var i=n(1);e.exports=new i("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:function(){return!0},construct:function(){},predicate:function(e){return void 0===e},represent:function(){return""}})},function(e,t,n){"use strict";var i=n(1);e.exports=new i("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return null!==e?e:{}}})},function(e,t,n){"use strict";var i=n(1);e.exports=new i("tag:yaml.org,2002:merge",{kind:"scalar",resolve:function(e){return"<<"===e||null===e}})},function(e,t,n){"use strict";var i=n(1);e.exports=new i("tag:yaml.org,2002:null",{kind:"scalar",resolve:function(e){if(null===e)return!0;var t=e.length;return 1===t&&"~"===e||4===t&&("null"===e||"Null"===e||"NULL"===e)},construct:function(){return null},predicate:function(e){return null===e},represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"})},function(e,t,n){"use strict";var i=n(1),r=Object.prototype.hasOwnProperty,o=Object.prototype.toString;e.exports=new i("tag:yaml.org,2002:omap",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,n,i,s,a,l=[],c=e;for(t=0,n=c.length;t<n;t+=1){if(i=c[t],a=!1,"[object Object]"!==o.call(i))return!1;for(s in i)if(r.call(i,s)){if(a)return!1;a=!0}if(!a)return!1;if(-1!==l.indexOf(s))return!1;l.push(s)}return!0},construct:function(e){return null!==e?e:[]}})},function(e,t,n){"use strict";var i=n(1),r=Object.prototype.toString;e.exports=new i("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:function(e){if(null===e)return!0;var t,n,i,o,s,a=e;for(s=new Array(a.length),t=0,n=a.length;t<n;t+=1){if(i=a[t],"[object Object]"!==r.call(i))return!1;if(1!==(o=Object.keys(i)).length)return!1;s[t]=[o[0],i[o[0]]]}return!0},construct:function(e){if(null===e)return[];var t,n,i,r,o,s=e;for(o=new Array(s.length),t=0,n=s.length;t<n;t+=1)i=s[t],r=Object.keys(i),o[t]=[r[0],i[r[0]]];return o}})},function(e,t,n){"use strict";var i=n(1);e.exports=new i("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return null!==e?e:[]}})},function(e,t,n){"use strict";var i=n(1),r=Object.prototype.hasOwnProperty;e.exports=new i("tag:yaml.org,2002:set",{kind:"mapping",resolve:function(e){if(null===e)return!0;var t,n=e;for(t in n)if(r.call(n,t)&&null!==n[t])return!1;return!0},construct:function(e){return null!==e?e:{}}})},function(e,t,n){"use strict";var i=n(1);e.exports=new i("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return null!==e?e:""}})},function(e,t,n){"use strict";var i=n(1),r=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),o=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");e.exports=new i("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:function(e){return null!==e&&(null!==r.exec(e)||null!==o.exec(e))},construct:function(e){var t,n,i,s,a,l,c,u,h,d,p=0,f=null;if(null===(t=r.exec(e))&&(t=o.exec(e)),null===t)throw new Error("Date resolve error");if(n=+t[1],i=+t[2]-1,s=+t[3],!t[4])return new Date(Date.UTC(n,i,s));if(a=+t[4],l=+t[5],c=+t[6],t[7]){for(p=t[7].slice(0,3);p.length<3;)p+="0";p=+p}return t[9]&&(u=+t[10],h=+(t[11]||0),f=6e4*(60*u+h),"-"===t[9]&&(f=-f)),d=new Date(Date.UTC(n,i,s,a,l,c,p)),f&&d.setTime(d.getTime()-f),d},instanceOf:Date,represent:function(e){return e.toISOString()}})},function(e,t,n){var i=n(19)(n(10),"DataView");e.exports=i},function(e,t,n){function i(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}var r=n(306),o=n(307),s=n(308),a=n(309),l=n(310);i.prototype.clear=r,i.prototype.delete=o,i.prototype.get=s,i.prototype.has=a,i.prototype.set=l,e.exports=i},function(e,t,n){var i=n(19)(n(10),"Promise");e.exports=i},function(e,t,n){var i=n(19)(n(10),"Set");e.exports=i},function(e,t,n){function i(e){var t=-1,n=e?e.length:0;for(this.__data__=new r;++t<n;)this.add(e[t])}var r=n(84),o=n(332),s=n(333);i.prototype.add=i.prototype.push=o,i.prototype.has=s,e.exports=i},function(e,t,n){var i=n(19)(n(10),"WeakMap");e.exports=i},function(e,t){e.exports=function(e,t){return e.set(t[0],t[1]),e}},function(e,t){e.exports=function(e,t){return e.add(t),e}},function(e,t){e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},function(e,t){e.exports=function(e,t){for(var n=-1,i=e?e.length:0;++n<i&&!1!==t(e[n],n,e););return e}},function(e,t,n){var i=n(283),r=n(94),o=n(6),s=n(90),a=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=o(e)||r(e)?i(e.length,String):[],l=n.length,c=!!l;for(var u in e)!t&&!a.call(e,u)||c&&("length"==u||s(u,l))||n.push(u);return n}},function(e,t){e.exports=function(e,t){for(var n=-1,i=e?e.length:0,r=Array(i);++n<i;)r[n]=t(e[n],n,e);return r}},function(e,t){e.exports=function(e,t){for(var n=-1,i=e?e.length:0;++n<i;)if(t(e[n],n,e))return!0;return!1}},function(e,t,n){var i=n(89),r=n(20);e.exports=function(e,t){return e&&i(t,r(t),e)}},function(e,t,n){function i(e,t,n,_,D,M,A){var E;if(_&&(E=M?_(e,D,M,A):_(e)),void 0!==E)return E;if(!y(e))return e;var I=g(e);if(I){if(E=p(e),!t)return c(e,E)}else{var T=d(e),L=T==q||T==C;if(v(e))return l(e,t);if(T==S||T==x||L&&!M){if(E=m(L?{}:e),!t)return u(e,a(E,e))}else{if(!w[T])return M?e:{};E=f(e,T,i,t)}}A||(A=new r);var k=A.get(e);if(k)return k;if(A.set(e,E),!I)var O=n?h(e):b(e);return o(O||e,function(r,o){O&&(o=r,r=e[o]),s(E,o,i(r,t,n,_,o,e,A))}),E}var r=n(85),o=n(258),s=n(86),a=n(262),l=n(287),c=n(294),u=n(295),h=n(302),d=n(133),p=n(311),f=n(312),m=n(313),g=n(6),v=n(348),y=n(12),b=n(20),x="[object Arguments]",q="[object Function]",C="[object GeneratorFunction]",S="[object Object]",w={};w[x]=w["[object Array]"]=w["[object ArrayBuffer]"]=w["[object DataView]"]=w["[object Boolean]"]=w["[object Date]"]=w["[object Float32Array]"]=w["[object Float64Array]"]=w["[object Int8Array]"]=w["[object Int16Array]"]=w["[object Int32Array]"]=w["[object Map]"]=w["[object Number]"]=w[S]=w["[object RegExp]"]=w["[object Set]"]=w["[object String]"]=w["[object Symbol]"]=w["[object Uint8Array]"]=w["[object Uint8ClampedArray]"]=w["[object Uint16Array]"]=w["[object Uint32Array]"]=!0,w["[object Error]"]=w[q]=w["[object WeakMap]"]=!1,e.exports=i},function(e,t,n){var i=n(12),r=Object.create,o=function(){function e(){}return function(t){if(!i(t))return{};if(r)return r(t);e.prototype=prototype;var n=new e;return e.prototype=void 0,n}}();e.exports=o},function(e,t){e.exports=function(e,t,n,i){for(var r=e.length,o=n+(i?1:-1);i?o--:++o<r;)if(t(e[o],o,e))return o;return-1}},function(e,t,n){function i(e,t,n,s,a){var l=-1,c=e.length;for(n||(n=o),a||(a=[]);++l<c;){var u=e[l];t>0&&n(u)?t>1?i(u,t-1,n,s,a):r(a,u):s||(a[a.length]=u)}return a}var r=n(123),o=n(314);e.exports=i},function(e,t,n){var i=n(123),r=n(6);e.exports=function(e,t,n){var o=t(e);return r(e)?o:i(o,n(e))}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t){e.exports=function(e,t){return null!=e&&t in Object(e)}},function(e,t,n){var i=n(85),r=n(129),o=n(299),s=n(300),a=n(133),l=n(6),c=n(351),u=2,h="[object Arguments]",d="[object Array]",p="[object Object]",f=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,m,g,v){var y=l(e),b=l(t),x=d,q=d;y||(x=a(e),x=x==h?p:x),b||(q=a(t),q=q==h?p:q);var C=x==p,S=q==p,w=x==q;if(w&&!C)return v||(v=new i),y||c(e)?r(e,t,n,m,g,v):o(e,t,x,n,m,g,v);if(!(g&u)){var _=C&&f.call(e,"__wrapped__"),D=S&&f.call(t,"__wrapped__");if(_||D){var M=_?e.value():e,A=D?t.value():t;return v||(v=new i),n(M,A,m,g,v)}}return!!w&&(v||(v=new i),s(e,t,n,m,g,v))}},function(e,t,n){var i=n(85),r=n(126),o=1,s=2;e.exports=function(e,t,n,a){var l=n.length,c=l,u=!a;if(null==e)return!c;for(e=Object(e);l--;){var h=n[l];if(u&&h[2]?h[1]!==e[h[0]]:!(h[0]in e))return!1}for(;++l<c;){var d=(h=n[l])[0],p=e[d],f=h[1];if(u&&h[2]){if(void 0===p&&!(d in e))return!1}else{var m=new i;if(a)var g=a(p,f,d,e,t,m);if(!(void 0===g?r(f,p,a,o|s,m):g))return!1}}return!0}},function(e,t,n){var i=n(142),r=n(317),o=n(12),s=n(140),a=/[\\^$.*+?()[\]{}|]/g,l=/^\[object .+?Constructor\]$/,c=Function.prototype,u=Object.prototype,h=c.toString,d=u.hasOwnProperty,p=RegExp("^"+h.call(d).replace(a,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||r(e))&&(i(e)?p:l).test(s(e))}},function(e,t,n){var i=n(95),r=n(25),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1;var s=Object.prototype.toString;e.exports=function(e){return r(e)&&i(e.length)&&!!o[s.call(e)]}},function(e,t,n){var i=n(91),r=n(330),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!i(e))return r(e);var t=[];for(var n in Object(e))o.call(e,n)&&"constructor"!=n&&t.push(n);return t}},function(e,t,n){var i=n(271),r=n(303),o=n(136);e.exports=function(e){var t=r(e);return 1==t.length&&t[0][2]?o(t[0][0],t[0][1]):function(n){return n===e||i(n,e,t)}}},function(e,t,n){var i=n(126),r=n(141),o=n(346),s=n(53),a=n(134),l=n(136),c=n(36),u=1,h=2;e.exports=function(e,t){return s(e)&&a(t)?l(c(e),t):function(n){var s=r(n,e);return void 0===s&&s===t?o(n,e):i(t,s,void 0,u|h)}}},function(e,t,n){var i=n(278);e.exports=function(e,t){return e=Object(e),i(e,t,function(t,n){return n in e})}},function(e,t,n){var i=n(87);e.exports=function(e,t,n){for(var r=-1,o=t.length,s={};++r<o;){var a=t[r],l=e[a];n(l,a)&&i(s,a,l)}return s}},function(e,t){e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},function(e,t,n){var i=n(125);e.exports=function(e){return function(t){return i(t,e)}}},function(e,t,n){var i=n(93),r=n(137),o=n(139);e.exports=function(e,t){return o(r(e,t,i),e+"")}},function(e,t,n){var i=n(342),r=n(93),o=n(329),s=o?function(e,t){return o(e,"toString",{configurable:!0,enumerable:!1,value:i(t),writable:!0})}:r;e.exports=s},function(e,t){e.exports=function(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}},function(e,t,n){var i=n(50),r=n(57),o=1/0,s=i?i.prototype:void 0,a=s?s.toString:void 0;e.exports=function(e){if("string"==typeof e)return e;if(r(e))return a?a.call(e):"";var t=e+"";return"0"==t&&1/e==-o?"-0":t}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,n){(function(e){var i=n(10),r="object"==typeof t&&t&&!t.nodeType&&t,o=r&&"object"==typeof e&&e&&!e.nodeType&&e,s=o&&o.exports===r?i.Buffer:void 0,a=s?s.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,i=a?a(n):new e.constructor(n);return e.copy(i),i}}).call(t,n(58)(e))},function(e,t,n){var i=n(88);e.exports=function(e,t){var n=t?i(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}},function(e,t,n){var i=n(255),r=n(124),o=n(135);e.exports=function(e,t,n){var s=t?n(o(e),!0):o(e);return r(s,i,new e.constructor)}},function(e,t){var n=/\w*$/;e.exports=function(e){var t=new e.constructor(e.source,n.exec(e));return t.lastIndex=e.lastIndex,t}},function(e,t,n){var i=n(256),r=n(124),o=n(138);e.exports=function(e,t,n){var s=t?n(o(e),!0):o(e);return r(s,i,new e.constructor)}},function(e,t,n){var i=n(50),r=i?i.prototype:void 0,o=r?r.valueOf:void 0;e.exports=function(e){return o?Object(o.call(e)):{}}},function(e,t,n){var i=n(88);e.exports=function(e,t){var n=t?i(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}},function(e,t){e.exports=function(e,t){var n=-1,i=e.length;for(t||(t=Array(i));++n<i;)t[n]=e[n];return t}},function(e,t,n){var i=n(89),r=n(132);e.exports=function(e,t){return i(e,r(e),t)}},function(e,t,n){var i=n(10)["__core-js_shared__"];e.exports=i},function(e,t,n){var i=n(281),r=n(315);e.exports=function(e){return i(function(t,n){var i=-1,o=n.length,s=o>1?n[o-1]:void 0,a=o>2?n[2]:void 0;for(s=e.length>3&&"function"==typeof s?(o--,s):void 0,a&&r(n[0],n[1],a)&&(s=o<3?void 0:s,o=1),t=Object(t);++i<o;){var l=n[i];l&&e(t,l,i,s)}return t})}},function(e,t,n){var i=n(127),r=n(37),o=n(20);e.exports=function(e){return function(t,n,s){var a=Object(t);if(!r(t)){var l=i(n,3);t=o(t),n=function(e){return l(a[e],e,a)}}var c=e(t,n,s);return c>-1?a[l?t[c]:c]:void 0}}},function(e,t,n){var i=n(50),r=n(122),o=n(56),s=n(129),a=n(135),l=n(138),c=1,u=2,h="[object Boolean]",d="[object Date]",p="[object Error]",f="[object Map]",m="[object Number]",g="[object RegExp]",v="[object Set]",y="[object String]",b="[object Symbol]",x="[object ArrayBuffer]",q="[object DataView]",C=i?i.prototype:void 0,S=C?C.valueOf:void 0;e.exports=function(e,t,n,i,C,w,_){switch(n){case q:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case x:return!(e.byteLength!=t.byteLength||!i(new r(e),new r(t)));case h:case d:case m:return o(+e,+t);case p:return e.name==t.name&&e.message==t.message;case g:case y:return e==t+"";case f:var D=a;case v:var M=w&u;if(D||(D=l),e.size!=t.size&&!M)return!1;var A=_.get(e);if(A)return A==t;w|=c,_.set(e,t);var E=s(D(e),D(t),i,C,w,_);return _.delete(e),E;case b:if(S)return S.call(e)==S.call(t)}return!1}},function(e,t,n){var i=n(20),r=2,o=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,s,a,l){var c=a&r,u=i(e),h=u.length;if(h!=i(t).length&&!c)return!1;for(var d=h;d--;){var p=u[d];if(!(c?p in t:o.call(t,p)))return!1}var f=l.get(e);if(f&&l.get(t))return f==t;var m=!0;l.set(e,t),l.set(t,e);for(var g=c;++d<h;){var v=e[p=u[d]],y=t[p];if(s)var b=c?s(y,v,p,t,e,l):s(v,y,p,e,t,l);if(!(void 0===b?v===y||n(v,y,s,a,l):b)){m=!1;break}g||(g="constructor"==p)}if(m&&!g){var x=e.constructor,q=t.constructor;x!=q&&"constructor"in e&&"constructor"in t&&!("function"==typeof x&&x instanceof x&&"function"==typeof q&&q instanceof q)&&(m=!1)}return l.delete(e),l.delete(t),m}},function(e,t,n){var i=n(345),r=n(137),o=n(139);e.exports=function(e){return o(r(e,void 0,i),e+"")}},function(e,t,n){var i=n(267),r=n(132),o=n(20);e.exports=function(e){return i(e,o,r)}},function(e,t,n){var i=n(134),r=n(20);e.exports=function(e){for(var t=r(e),n=t.length;n--;){var o=t[n],s=e[o];t[n]=[o,s,i(s)]}return t}},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,n){var i=n(128),r=n(94),o=n(6),s=n(90),a=n(53),l=n(95),c=n(36);e.exports=function(e,t,n){for(var u=-1,h=(t=a(t,e)?[t]:i(t)).length,d=!1;++u<h;){var p=c(t[u]);if(!(d=null!=e&&n(e,p)))break;e=e[p]}return d||++u!=h?d:!!(h=e?e.length:0)&&l(h)&&s(p,h)&&(o(e)||r(e))}},function(e,t,n){var i=n(54);e.exports=function(){this.__data__=i?i(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,n){var i=n(54),r="__lodash_hash_undefined__",o=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(i){var n=t[e];return n===r?void 0:n}return o.call(t,e)?t[e]:void 0}},function(e,t,n){var i=n(54),r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return i?void 0!==t[e]:r.call(t,e)}},function(e,t,n){var i=n(54),r="__lodash_hash_undefined__";e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=i&&void 0===t?r:t,this}},function(e,t){var n=Object.prototype.hasOwnProperty;e.exports=function(e){var t=e.length,i=e.constructor(t);return t&&"string"==typeof e[0]&&n.call(e,"index")&&(i.index=e.index,i.input=e.input),i}},function(e,t,n){var i=n(88),r=n(288),o=n(289),s=n(290),a=n(291),l=n(292),c=n(293),u="[object Boolean]",h="[object Date]",d="[object Map]",p="[object Number]",f="[object RegExp]",m="[object Set]",g="[object String]",v="[object Symbol]",y="[object ArrayBuffer]",b="[object DataView]",x="[object Float32Array]",q="[object Float64Array]",C="[object Int8Array]",S="[object Int16Array]",w="[object Int32Array]",_="[object Uint8Array]",D="[object Uint8ClampedArray]",M="[object Uint16Array]",A="[object Uint32Array]";e.exports=function(e,t,n,E){var I=e.constructor;switch(t){case y:return i(e);case u:case h:return new I(+e);case b:return r(e,E);case x:case q:case C:case S:case w:case _:case D:case M:case A:return c(e,E);case d:return o(e,E,n);case p:case g:return new I(e);case f:return s(e);case m:return a(e,E,n);case v:return l(e)}}},function(e,t,n){var i=n(264),r=n(131),o=n(91);e.exports=function(e){return"function"!=typeof e.constructor||o(e)?{}:i(r(e))}},function(e,t,n){var i=n(50),r=n(94),o=n(6),s=i?i.isConcatSpreadable:void 0;e.exports=function(e){return o(e)||r(e)||!!(s&&e&&e[s])}},function(e,t,n){var i=n(56),r=n(37),o=n(90),s=n(12);e.exports=function(e,t,n){if(!s(n))return!1;var a=typeof t;return!!("number"==a?r(n)&&o(t,n.length):"string"==a&&t in n)&&i(n[t],e)}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,n){var i=n(296),r=function(){var e=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();e.exports=function(e){return!!r&&r in e}},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,n){var i=n(51),r=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=i(t,e);return!(n<0||(n==t.length-1?t.pop():r.call(t,n,1),--this.size,0))}},function(e,t,n){var i=n(51);e.exports=function(e){var t=this.__data__,n=i(t,e);return n<0?void 0:t[n][1]}},function(e,t,n){var i=n(51);e.exports=function(e){return i(this.__data__,e)>-1}},function(e,t,n){var i=n(51);e.exports=function(e,t){var n=this.__data__,r=i(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}},function(e,t,n){var i=n(250),r=n(49),o=n(83);e.exports=function(){this.size=0,this.__data__={hash:new i,map:new(o||r),string:new i}}},function(e,t,n){var i=n(52);e.exports=function(e){var t=i(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t,n){var i=n(52);e.exports=function(e){return i(this,e).get(e)}},function(e,t,n){var i=n(52);e.exports=function(e){return i(this,e).has(e)}},function(e,t,n){var i=n(52);e.exports=function(e,t){var n=i(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}},function(e,t,n){var i=n(352),r=500;e.exports=function(e){var t=i(e,function(e){return n.size===r&&n.clear(),e}),n=t.cache;return t}},function(e,t,n){var i=n(19)(Object,"defineProperty");e.exports=i},function(e,t,n){var i=n(92)(Object.keys,Object);e.exports=i},function(e,t,n){(function(e){var i=n(130),r="object"==typeof t&&t&&!t.nodeType&&t,o=r&&"object"==typeof e&&e&&!e.nodeType&&e,s=o&&o.exports===r&&i.process,a=function(){try{return s&&s.binding("util")}catch(e){}}();e.exports=a}).call(t,n(58)(e))},function(e,t){var n="__lodash_hash_undefined__";e.exports=function(e){return this.__data__.set(e,n),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t){var n=500,i=16,r=Date.now;e.exports=function(e){var t=0,o=0;return function(){var s=r(),a=i-(s-o);if(o=s,a>0){if(++t>=n)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}},function(e,t,n){var i=n(49);e.exports=function(){this.__data__=new i,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,n){var i=n(49),r=n(83),o=n(84),s=200;e.exports=function(e,t){var n=this.__data__;if(n instanceof i){var a=n.__data__;if(!r||a.length<s-1)return a.push([e,t]),this.size=++n.size,this;n=this.__data__=new o(a)}return n.set(e,t),this.size=n.size,this}},function(e,t,n){var i=n(328),r=n(360),o=/^\./,s=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,a=/\\(\\)?/g,l=i(function(e){e=r(e);var t=[];return o.test(e)&&t.push(""),e.replace(s,function(e,n,i,r){t.push(i?r.replace(a,"$1"):n||e)}),t});e.exports=l},function(e,t,n){var i=n(263);e.exports=function(e){return i(e,!0,!0)}},function(e,t){e.exports=function(e){return function(){return e}}},function(e,t,n){var i=n(298)(n(344));e.exports=i},function(e,t,n){var i=n(265),r=n(127),o=n(358),s=Math.max;e.exports=function(e,t,n){var a=e?e.length:0;if(!a)return-1;var l=null==n?0:o(n);return l<0&&(l=s(a+l,0)),i(e,r(t,3),l)}},function(e,t,n){var i=n(266);e.exports=function(e){return(e?e.length:0)?i(e,1):[]}},function(e,t,n){var i=n(269),r=n(305);e.exports=function(e,t){return null!=e&&r(e,t,i)}},function(e,t,n){var i=n(37),r=n(25);e.exports=function(e){return r(e)&&i(e)}},function(e,t,n){(function(e){var i=n(10),r=n(356),o="object"==typeof t&&t&&!t.nodeType&&t,s=o&&"object"==typeof e&&e&&!e.nodeType&&e,a=s&&s.exports===o?i.Buffer:void 0,l=(a?a.isBuffer:void 0)||r;e.exports=l}).call(t,n(58)(e))},function(e,t,n){var i=n(131),r=n(25),o="[object Object]",s=Function.prototype,a=Object.prototype,l=s.toString,c=a.hasOwnProperty,u=l.call(Object),h=a.toString;e.exports=function(e){if(!r(e)||h.call(e)!=o)return!1;var t=i(e);if(null===t)return!0;var n=c.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&l.call(n)==u}},function(e,t,n){var i=n(6),r=n(25),o="[object String]",s=Object.prototype.toString;e.exports=function(e){return"string"==typeof e||!i(e)&&r(e)&&s.call(e)==o}},function(e,t,n){var i=n(273),r=n(285),o=n(331),s=o&&o.isTypedArray,a=s?r(s):i;e.exports=a},function(e,t,n){function i(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError(o);var n=function(){var i=arguments,r=t?t.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var s=e.apply(this,i);return n.cache=o.set(r,s)||o,s};return n.cache=new(i.Cache||r),n}var r=n(84),o="Expected a function";i.Cache=r,e.exports=i},function(e,t,n){var i=n(260),r=n(277),o=n(301),s=n(36),a=o(function(e,t){return null==e?{}:r(e,i(t,s))});e.exports=a},function(e,t,n){var i=n(279),r=n(280),o=n(53),s=n(36);e.exports=function(e){return o(e)?i(s(e)):r(e)}},function(e,t){e.exports=function(){return[]}},function(e,t){e.exports=function(){return!1}},function(e,t,n){var i=n(359),r=1/0,o=1.7976931348623157e308;e.exports=function(e){return e?(e=i(e))===r||e===-r?(e<0?-1:1)*o:e===e?e:0:0===e?e:0}},function(e,t,n){var i=n(357);e.exports=function(e){var t=i(e),n=t%1;return t===t?n?t-n:t:0}},function(e,t,n){var i=n(12),r=n(57),o=NaN,s=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(r(e))return o;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(s,"");var n=l.test(e);return n||c.test(e)?u(e.slice(2),n?2:8):a.test(e)?o:+e}},function(e,t,n){var i=n(284);e.exports=function(e){return null==e?"":i(e)}},function(e,t,n){(function(e,i){var r;!function(i){function o(e){throw RangeError(A[e])}function s(e,t){for(var n=e.length,i=[];n--;)i[n]=t(e[n]);return i}function a(e,t){var n=e.split("@"),i="";return n.length>1&&(i=n[0]+"@",e=n[1]),e=e.replace(M,"."),i+s(e.split("."),t).join(".")}function l(e){for(var t,n,i=[],r=0,o=e.length;r<o;)(t=e.charCodeAt(r++))>=55296&&t<=56319&&r<o?56320==(64512&(n=e.charCodeAt(r++)))?i.push(((1023&t)<<10)+(1023&n)+65536):(i.push(t),r--):i.push(t);return i}function c(e){return s(e,function(e){var t="";return e>65535&&(e-=65536,t+=T(e>>>10&1023|55296),e=56320|1023&e),t+=T(e)}).join("")}function u(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:v}function h(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function d(e,t,n){var i=0;for(e=n?I(e/q):e>>1,e+=I(e/t);e>E*b>>1;i+=v)e=I(e/E);return I(i+(E+1)*e/(e+x))}function p(e){var t,n,i,r,s,a,l,h,p,f,m=[],x=e.length,q=0,_=S,D=C;for((n=e.lastIndexOf(w))<0&&(n=0),i=0;i<n;++i)e.charCodeAt(i)>=128&&o("not-basic"),m.push(e.charCodeAt(i));for(r=n>0?n+1:0;r<x;){for(s=q,a=1,l=v;r>=x&&o("invalid-input"),((h=u(e.charCodeAt(r++)))>=v||h>I((g-q)/a))&&o("overflow"),q+=h*a,p=l<=D?y:l>=D+b?b:l-D,!(h<p);l+=v)f=v-p,a>I(g/f)&&o("overflow"),a*=f;D=d(q-s,t=m.length+1,0==s),I(q/t)>g-_&&o("overflow"),_+=I(q/t),q%=t,m.splice(q++,0,_)}return c(m)}function f(e){var t,n,i,r,s,a,c,u,p,f,m,x,q,_,D,M=[];for(x=(e=l(e)).length,t=S,n=0,s=C,a=0;a<x;++a)(m=e[a])<128&&M.push(T(m));for(i=r=M.length,r&&M.push(w);i<x;){for(c=g,a=0;a<x;++a)(m=e[a])>=t&&m<c&&(c=m);for(c-t>I((g-n)/(q=i+1))&&o("overflow"),n+=(c-t)*q,t=c,a=0;a<x;++a)if((m=e[a])<t&&++n>g&&o("overflow"),m==t){for(u=n,p=v;f=p<=s?y:p>=s+b?b:p-s,!(u<f);p+=v)D=u-f,_=v-f,M.push(T(h(f+D%_,0))),u=I(D/_);M.push(T(h(u,0))),s=d(n,q,i==r),n=0,++i}++n,++t}return M.join("")}"object"==typeof t&&t&&t.nodeType,"object"==typeof e&&e&&e.nodeType;var m,g=2147483647,v=36,y=1,b=26,x=38,q=700,C=72,S=128,w="-",_=/^xn--/,D=/[^\x20-\x7E]/,M=/[\x2E\u3002\uFF0E\uFF61]/g,A={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},E=v-y,I=Math.floor,T=String.fromCharCode;m={version:"1.3.2",ucs2:{decode:l,encode:c},decode:p,encode:f,toASCII:function(e){return a(e,function(e){return D.test(e)?"xn--"+f(e):e})},toUnicode:function(e){return a(e,function(e){return _.test(e)?p(e.slice(4).toLowerCase()):e})}},void 0!==(r=function(){return m}.call(t,n,t,e))&&(e.exports=r)}()}).call(t,n(58)(e),n(97))},function(e,t,n){"use strict";var i=n(364),r=n(363),o=n(143);e.exports={formats:o,parse:r,stringify:i}},function(e,t,n){"use strict";var i=n(144),r=Object.prototype.hasOwnProperty,o={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:i.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},s=function(e,t){for(var n={},i=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,s=t.parameterLimit===1/0?void 0:t.parameterLimit,a=i.split(t.delimiter,s),l=0;l<a.length;++l){var c,u,h=a[l],d=h.indexOf("]="),p=-1===d?h.indexOf("="):d+1;-1===p?(c=t.decoder(h,o.decoder),u=t.strictNullHandling?null:""):(c=t.decoder(h.slice(0,p),o.decoder),u=t.decoder(h.slice(p+1),o.decoder)),r.call(n,c)?n[c]=[].concat(n[c]).concat(u):n[c]=u}return n},a=function(e,t,n){for(var i=t,r=e.length-1;r>=0;--r){var o,s=e[r];if("[]"===s)o=[],o=o.concat(i);else{o=n.plainObjects?Object.create(null):{};var a="["===s.charAt(0)&&"]"===s.charAt(s.length-1)?s.slice(1,-1):s,l=parseInt(a,10);!isNaN(l)&&s!==a&&String(l)===a&&l>=0&&n.parseArrays&&l<=n.arrayLimit?(o=[],o[l]=i):o[a]=i}i=o}return i},l=function(e,t,n){if(e){var i=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,s=/(\[[^[\]]*])/.exec(i),l=s?i.slice(0,s.index):i,c=[];if(l){if(!n.plainObjects&&r.call(Object.prototype,l)&&!n.allowPrototypes)return;c.push(l)}for(var u=0;null!==(s=o.exec(i))&&u<n.depth;){if(u+=1,!n.plainObjects&&r.call(Object.prototype,s[1].slice(1,-1))&&!n.allowPrototypes)return;c.push(s[1])}return s&&c.push("["+i.slice(s.index)+"]"),a(c,t,n)}};e.exports=function(e,t){var n=t?i.assign({},t):{};if(null!==n.decoder&&void 0!==n.decoder&&"function"!=typeof n.decoder)throw new TypeError("Decoder has to be a function.");if(n.ignoreQueryPrefix=!0===n.ignoreQueryPrefix,n.delimiter="string"==typeof n.delimiter||i.isRegExp(n.delimiter)?n.delimiter:o.delimiter,n.depth="number"==typeof n.depth?n.depth:o.depth,n.arrayLimit="number"==typeof n.arrayLimit?n.arrayLimit:o.arrayLimit,n.parseArrays=!1!==n.parseArrays,n.decoder="function"==typeof n.decoder?n.decoder:o.decoder,n.allowDots="boolean"==typeof n.allowDots?n.allowDots:o.allowDots,n.plainObjects="boolean"==typeof n.plainObjects?n.plainObjects:o.plainObjects,n.allowPrototypes="boolean"==typeof n.allowPrototypes?n.allowPrototypes:o.allowPrototypes,n.parameterLimit="number"==typeof n.parameterLimit?n.parameterLimit:o.parameterLimit,n.strictNullHandling="boolean"==typeof n.strictNullHandling?n.strictNullHandling:o.strictNullHandling,""===e||null===e||void 0===e)return n.plainObjects?Object.create(null):{};for(var r="string"==typeof e?s(e,n):e,a=n.plainObjects?Object.create(null):{},c=Object.keys(r),u=0;u<c.length;++u){var h=c[u],d=l(h,r[h],n);a=i.merge(a,d,n)}return i.compact(a)}},function(e,t,n){"use strict";var i=n(144),r=n(143),o={brackets:function(e){return e+"[]"},indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},s=Date.prototype.toISOString,a={delimiter:"&",encode:!0,encoder:i.encode,encodeValuesOnly:!1,serializeDate:function(e){return s.call(e)},skipNulls:!1,strictNullHandling:!1},l=function e(t,n,r,o,s,l,c,u,h,d,p,f){var m=t;if("function"==typeof c)m=c(n,m);else if(m instanceof Date)m=d(m);else if(null===m){if(o)return l&&!f?l(n,a.encoder):n;m=""}if("string"==typeof m||"number"==typeof m||"boolean"==typeof m||i.isBuffer(m))return l?[p(f?n:l(n,a.encoder))+"="+p(l(m,a.encoder))]:[p(n)+"="+p(String(m))];var g=[];if(void 0===m)return g;var v;if(Array.isArray(c))v=c;else{var y=Object.keys(m);v=u?y.sort(u):y}for(var b=0;b<v.length;++b){var x=v[b];s&&null===m[x]||(g=Array.isArray(m)?g.concat(e(m[x],r(n,x),r,o,s,l,c,u,h,d,p,f)):g.concat(e(m[x],n+(h?"."+x:"["+x+"]"),r,o,s,l,c,u,h,d,p,f)))}return g};e.exports=function(e,t){var n=e,s=t?i.assign({},t):{};if(null!==s.encoder&&void 0!==s.encoder&&"function"!=typeof s.encoder)throw new TypeError("Encoder has to be a function.");var c=void 0===s.delimiter?a.delimiter:s.delimiter,u="boolean"==typeof s.strictNullHandling?s.strictNullHandling:a.strictNullHandling,h="boolean"==typeof s.skipNulls?s.skipNulls:a.skipNulls,d="boolean"==typeof s.encode?s.encode:a.encode,p="function"==typeof s.encoder?s.encoder:a.encoder,f="function"==typeof s.sort?s.sort:null,m=void 0!==s.allowDots&&s.allowDots,g="function"==typeof s.serializeDate?s.serializeDate:a.serializeDate,v="boolean"==typeof s.encodeValuesOnly?s.encodeValuesOnly:a.encodeValuesOnly;if(void 0===s.format)s.format=r.default;else if(!Object.prototype.hasOwnProperty.call(r.formatters,s.format))throw new TypeError("Unknown format option provided.");var y,b,x=r.formatters[s.format];"function"==typeof s.filter?(b=s.filter,n=b("",n)):Array.isArray(s.filter)&&(b=s.filter,y=b);var q=[];if("object"!=typeof n||null===n)return"";var C;C=s.arrayFormat in o?s.arrayFormat:"indices"in s?s.indices?"indices":"repeat":"indices";var S=o[C];y||(y=Object.keys(n)),f&&y.sort(f);for(var w=0;w<y.length;++w){var _=y[w];h&&null===n[_]||(q=q.concat(l(n[_],_,S,u,h,d?p:null,b,f,m,g,x,v)))}var D=q.join(c),M=!0===s.addQueryPrefix?"?":"";return D.length>0?M+D:""}},function(e,t,n){"use strict";function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,o){t=t||"&",n=n||"=";var s={};if("string"!=typeof e||0===e.length)return s;var a=/\+/g;e=e.split(t);var l=1e3;o&&"number"==typeof o.maxKeys&&(l=o.maxKeys);var c=e.length;l>0&&c>l&&(c=l);for(var u=0;u<c;++u){var h,d,p,f,m=e[u].replace(a,"%20"),g=m.indexOf(n);g>=0?(h=m.substr(0,g),d=m.substr(g+1)):(h=m,d=""),p=decodeURIComponent(h),f=decodeURIComponent(d),i(s,p)?r(s[p])?s[p].push(f):s[p]=[s[p],f]:s[p]=f}return s};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){"use strict";function i(e,t){if(e.map)return e.map(t);for(var n=[],i=0;i<e.length;i++)n.push(t(e[i],i));return n}var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,a){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?i(s(e),function(s){var a=encodeURIComponent(r(s))+n;return o(e[s])?i(e[s],function(e){return a+encodeURIComponent(r(e))}).join(t):a+encodeURIComponent(r(e[s]))}).join(t):a?encodeURIComponent(r(a))+n+encodeURIComponent(r(e)):""};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},s=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},function(e,t,n){"use strict";t.decode=t.parse=n(365),t.encode=t.stringify=n(366)},function(e,t,n){var i=function(){return this}()||Function("return this")(),r=i.regeneratorRuntime&&Object.getOwnPropertyNames(i).indexOf("regeneratorRuntime")>=0,o=r&&i.regeneratorRuntime;if(i.regeneratorRuntime=void 0,e.exports=n(369),r)i.regeneratorRuntime=o;else try{delete i.regeneratorRuntime}catch(e){i.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";function n(e,t,n,i){var o=t&&t.prototype instanceof r?t:r,s=Object.create(o.prototype),a=new p(i||[]);return s._invoke=c(e,n,a),s}function i(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function r(){}function o(){}function s(){}function a(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function l(e){function t(n,r,o,s){var a=i(e[n],e,r);if("throw"!==a.type){var l=a.arg,c=l.value;return c&&"object"==typeof c&&y.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,o,s)},function(e){t("throw",e,o,s)}):Promise.resolve(c).then(function(e){l.value=e,o(l)},s)}s(a.arg)}var n;this._invoke=function(e,i){function r(){return new Promise(function(n,r){t(e,i,n,r)})}return n=n?n.then(r,r):r()}}function c(e,t,n){var r=_;return function(o,s){if(r===M)throw new Error("Generator is already running");if(r===A){if("throw"===o)throw s;return m()}for(n.method=o,n.arg=s;;){var a=n.delegate;if(a){var l=u(a,n);if(l){if(l===E)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===_)throw r=A,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=M;var c=i(e,t,n);if("normal"===c.type){if(r=n.done?A:D,c.arg===E)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=A,n.method="throw",n.arg=c.arg)}}}function u(e,t){var n=e.iterator[t.method];if(n===g){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=g,u(e,t),"throw"===t.method))return E;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return E}var r=i(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,E;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=g),t.delegate=null,E):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,E)}function h(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function d(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function p(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(h,this),this.reset(!0)}function f(e){if(e){var t=e[x];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(y.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=g,t.done=!0,t};return i.next=i}}return{next:m}}function m(){return{value:g,done:!0}}var g,v=Object.prototype,y=v.hasOwnProperty,b="function"==typeof Symbol?Symbol:{},x=b.iterator||"@@iterator",q=b.asyncIterator||"@@asyncIterator",C=b.toStringTag||"@@toStringTag",S="object"==typeof e,w=t.regeneratorRuntime;if(w)S&&(e.exports=w);else{(w=t.regeneratorRuntime=S?e.exports:{}).wrap=n;var _="suspendedStart",D="suspendedYield",M="executing",A="completed",E={},I={};I[x]=function(){return this};var T=Object.getPrototypeOf,L=T&&T(T(f([])));L&&L!==v&&y.call(L,x)&&(I=L);var k=s.prototype=r.prototype=Object.create(I);o.prototype=k.constructor=s,s.constructor=o,s[C]=o.displayName="GeneratorFunction",w.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},w.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,C in e||(e[C]="GeneratorFunction")),e.prototype=Object.create(k),e},w.awrap=function(e){return{__await:e}},a(l.prototype),l.prototype[q]=function(){return this},w.AsyncIterator=l,w.async=function(e,t,i,r){var o=new l(n(e,t,i,r));return w.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},a(k),k[C]="Generator",k[x]=function(){return this},k.toString=function(){return"[object Generator]"},w.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},w.values=f,p.prototype={constructor:p,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.method="next",this.arg=g,this.tryEntries.forEach(d),!e)for(var t in this)"t"===t.charAt(0)&&y.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=g)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,i){return o.type="throw",o.arg=e,n.next=t,i&&(n.method="next",n.arg=g),!!i}if(this.done)throw e;for(var n=this,i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i],o=r.completion;if("root"===r.tryLoc)return t("end");if(r.tryLoc<=this.prev){var s=y.call(r,"catchLoc"),a=y.call(r,"finallyLoc");if(s&&a){if(this.prev<r.catchLoc)return t(r.catchLoc,!0);if(this.prev<r.finallyLoc)return t(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return t(r.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return t(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&y.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,E):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),E},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),d(n),E}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;d(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:f(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=g),E}}}}(function(){return this}()||Function("return this")())},function(e,t,n){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t){!function(e){"use strict";function t(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function n(e){return"string"!=typeof e&&(e=String(e)),e}function i(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return v.iterable&&(t[Symbol.iterator]=function(){return t}),t}function r(e){this.map={},e instanceof r?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function o(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function s(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function a(e){var t=new FileReader,n=s(t);return t.readAsArrayBuffer(e),n}function l(e){var t=new FileReader,n=s(t);return t.readAsText(e),n}function c(e){for(var t=new Uint8Array(e),n=new Array(t.length),i=0;i<t.length;i++)n[i]=String.fromCharCode(t[i]);return n.join("")}function u(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function h(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(v.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(v.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(v.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(v.arrayBuffer&&v.blob&&b(e))this._bodyArrayBuffer=u(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!v.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!x(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=u(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):v.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},v.blob&&(this.blob=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?o(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(a)}),this.text=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return l(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(c(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},v.formData&&(this.formData=function(){return this.text().then(f)}),this.json=function(){return this.text().then(JSON.parse)},this}function d(e){var t=e.toUpperCase();return q.indexOf(t)>-1?t:e}function p(e,t){var n=(t=t||{}).body;if(e instanceof p){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new r(e.headers)),this.method=e.method,this.mode=e.mode,n||null==e._bodyInit||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new r(t.headers)),this.method=d(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function f(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),i=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(i),decodeURIComponent(r))}}),t}function m(e){var t=new r;return e.split(/\r?\n/).forEach(function(e){var n=e.split(":"),i=n.shift().trim();if(i){var r=n.join(":").trim();t.append(i,r)}}),t}function g(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new r(t.headers),this.url=t.url||"",this._initBody(e)}if(!e.fetch){var v={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(v.arrayBuffer)var y=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],b=function(e){return e&&DataView.prototype.isPrototypeOf(e)},x=ArrayBuffer.isView||function(e){return e&&y.indexOf(Object.prototype.toString.call(e))>-1};r.prototype.append=function(e,i){e=t(e),i=n(i);var r=this.map[e];this.map[e]=r?r+","+i:i},r.prototype.delete=function(e){delete this.map[t(e)]},r.prototype.get=function(e){return e=t(e),this.has(e)?this.map[e]:null},r.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},r.prototype.set=function(e,i){this.map[t(e)]=n(i)},r.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},r.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),i(e)},r.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),i(e)},r.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),i(e)},v.iterable&&(r.prototype[Symbol.iterator]=r.prototype.entries);var q=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];p.prototype.clone=function(){return new p(this,{body:this._bodyInit})},h.call(p.prototype),h.call(g.prototype),g.prototype.clone=function(){return new g(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new r(this.headers),url:this.url})},g.error=function(){var e=new g(null,{status:0,statusText:""});return e.type="error",e};var C=[301,302,303,307,308];g.redirect=function(e,t){if(-1===C.indexOf(t))throw new RangeError("Invalid status code");return new g(null,{status:t,headers:{location:e}})},e.Headers=r,e.Request=p,e.Response=g,e.fetch=function(e,t){return new Promise(function(n,i){var r=new p(e,t),o=new XMLHttpRequest;o.onload=function(){var e={status:o.status,statusText:o.statusText,headers:m(o.getAllResponseHeaders()||"")};e.url="responseURL"in o?o.responseURL:e.headers.get("X-Request-URL");var t="response"in o?o.response:o.responseText;n(new g(t,e))},o.onerror=function(){i(new TypeError("Network request failed"))},o.ontimeout=function(){i(new TypeError("Network request failed"))},o.open(r.method,r.url,!0),"include"===r.credentials&&(o.withCredentials=!0),"responseType"in o&&v.blob&&(o.responseType="blob"),r.headers.forEach(function(e,t){o.setRequestHeader(t,e)}),o.send(void 0===r._bodyInit?null:r._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:this)},function(e,t,n){e.exports=n(145)}])}),define("general.utils/swagger-api",["util","qvangular","core.utils/deferred","assets/external/swagger-client/swagger-client"],function(e,t,n,i){function r(){if(!window.Promise){var e=t.getService("$q");window.Promise=function(t){return e(t)},window.Promise.reject=e.reject.bind(e),window.Promise.all=e.all.bind(e),window.Promise.resolve=e.when.bind(e),window.Promise.race=function(t){var n=e.defer();return t.forEach(function(e){e.then(function(e){n&&(n.resolve(e),n=null)}),e.catch(function(e){n&&(n.reject(e),n=null)})}),n.promise}}}var o={};return o.getApi=function(o,s,a,l,c,u){a=a||window.location.protocol.indexOf("https")>-1,l=l||window.location.hostname,c=c||window.location.port,u=u||e.basePath;var h=new n,d=(a?"https":"http")+"://"+l+(c?":"+c:"")+(u||"/")+o,p=d+"/"+s;return r(),t.getService("$http")({method:"GET",url:p,withCredentials:!0}).then(function(e){var t=e.data;t.basePath=u+o;new i(d,{scheme:a?"https":"http",spec:t,usePromise:!0,requestInterceptor:function(e){return e.credentials="include",e}}).then(function(e){h.resolve(e)},function(e){window.console.log("Failed to create api:"+e),h.reject(e)})}.bind(this),function(e){return h.reject(e)}),h.promise},o}),define("core.utils/authentication",["jquery"],function(e){"use strict";var t,n,i,r,o={},s=!1,a=e.Deferred();return o.parse=function(e){t=e.userId,n=e.userDirectory,s=e.mustAuthenticate,r=e.loginUri,i=e.logoutUri,!0===s&&e.loginUri&&(window.location.href=e.loginUri),a.resolve(this)},o.onDataReceived=a.promise(),Object.defineProperties(o,{userId:{get:function(){return t}},userDirectory:{get:function(){return n}},mustAuthenticate:{get:function(){return s}},loginUri:{get:function(){return r}},logoutUri:{get:function(){return i}}}),o}),define("text!autogenerated/qix/jsonspec.json",[],function(){return'{\n\t"structs": {\n\t\t"Field":{\n\t\t\t"GetCardinal": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetAndMode": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"SelectValues": {\n\t\t\t\t"In": [{ "Name": "qFieldValues","DefaultValue": [{"qText": "", "qIsNumeric": false, "qNumber": 0}] }, { "Name": "qToggleMode","DefaultValue": false, "Optional": true }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"Select": {\n\t\t\t\t"In": [{ "Name": "qMatch","DefaultValue": "" }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }, { "Name": "qExcludedValuesMode","DefaultValue": 0, "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"ToggleSelect": {\n\t\t\t\t"In": [{ "Name": "qMatch","DefaultValue": "" }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }, { "Name": "qExcludedValuesMode","DefaultValue": 0, "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"ClearAllButThis": {\n\t\t\t\t"In": [{ "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"SelectPossible": {\n\t\t\t\t"In": [{ "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"SelectExcluded": {\n\t\t\t\t"In": [{ "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"SelectAll": {\n\t\t\t\t"In": [{ "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"Lock": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"Unlock": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetNxProperties": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qProperties" }]\n\t\t\t},\n\t\t\t"SetNxProperties": {\n\t\t\t\t"In": [{ "Name": "qProperties","DefaultValue": {"qOneAndOnlyOne": false} }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"SetAndMode": {\n\t\t\t\t"In": [{ "Name": "qAndMode","DefaultValue": false }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"SelectAlternative": {\n\t\t\t\t"In": [{ "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"LowLevelSelect": {\n\t\t\t\t"In": [{ "Name": "qValues","DefaultValue": [0] }, { "Name": "qToggleMode","DefaultValue": false }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"Clear": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t}\n\t\t},\n\t\t"Variable":{\n\t\t\t"GetContent": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qContent" }]\n\t\t\t},\n\t\t\t"GetRawContent": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"SetContent": {\n\t\t\t\t"In": [{ "Name": "qContent","DefaultValue": "" }, { "Name": "qUpdateMRU","DefaultValue": false }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"ForceContent": {\n\t\t\t\t"In": [{ "Name": "qs","DefaultValue": "" }, { "Name": "qd","DefaultValue": 0 }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetNxProperties": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qProperties" }]\n\t\t\t},\n\t\t\t"SetNxProperties": {\n\t\t\t\t"In": [{ "Name": "qProperties","DefaultValue": {"qName": "", "qNumberPresentation": {"qType": 0, "qnDec": 0, "qUseThou": 0, "qFmt": "", "qDec": "", "qThou": ""}, "qIncludeInBookmark": false, "qUsePredefListedValues": false, "qPreDefinedList": [""]} }],\n\t\t\t\t"Out": []\n\t\t\t}\n\t\t},\n\t\t"GenericObject":{\n\t\t\t"GetLayout": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qLayout" }]\n\t\t\t},\n\t\t\t"GetListObjectData": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qPages","DefaultValue": [{"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}] }],\n\t\t\t\t"Out": [{ "Name": "qDataPages" }]\n\t\t\t},\n\t\t\t"GetHyperCubeData": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qPages","DefaultValue": [{"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}] }],\n\t\t\t\t"Out": [{ "Name": "qDataPages" }]\n\t\t\t},\n\t\t\t"GetHyperCubeReducedData": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qPages","DefaultValue": [{"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}] }, { "Name": "qZoomFactor","DefaultValue": 0 }, { "Name": "qReductionMode","DefaultValue": 0 }],\n\t\t\t\t"Out": [{ "Name": "qDataPages" }]\n\t\t\t},\n\t\t\t"GetHyperCubePivotData": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qPages","DefaultValue": [{"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}] }],\n\t\t\t\t"Out": [{ "Name": "qDataPages" }]\n\t\t\t},\n\t\t\t"GetHyperCubeStackData": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qPages","DefaultValue": [{"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}] }, { "Name": "qMaxNbrCells","DefaultValue": 0, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qDataPages" }]\n\t\t\t},\n\t\t\t"GetHyperCubeContinuousData": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qOptions","DefaultValue": {"qStart": 0, "qEnd": 0, "qNbrPoints": 0, "qMaxNbrTicks": 0, "qMaxNumberLines": 0} }, { "Name": "qReverseSort","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qDataPages" }, { "Name": "qAxisData" }]\n\t\t\t},\n\t\t\t"GetHyperCubeTreeData": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qNodeOptions","DefaultValue": {"qMaxNbrOfNodes": 0, "qTreeNodes": [{"qArea": {"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}, "qAllValues": false}], "qTreeLevels": {"qLeft": 0, "qDepth": 0}}, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qNodes" }]\n\t\t\t},\n\t\t\t"GetHyperCubeBinnedData": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qPages","DefaultValue": [{"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}] }, { "Name": "qViewport","DefaultValue": {"qWidth": 0, "qHeight": 0, "qZoomLevel": 0} }, { "Name": "qDataRanges","DefaultValue": [{"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}] }, { "Name": "qMaxNbrCells","DefaultValue": 0 }, { "Name": "qQueryLevel","DefaultValue": 0 }, { "Name": "qBinningMethod","DefaultValue": 0 }],\n\t\t\t\t"Out": [{ "Name": "qDataPages" }]\n\t\t\t},\n\t\t\t"ApplyPatches": {\n\t\t\t\t"In": [{ "Name": "qPatches","DefaultValue": [{"qOp": 0, "qPath": "", "qValue": ""}] }, { "Name": "qSoftPatch","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"ClearSoftPatches": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"SetProperties": {\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qExtendsId": "", "qMetaDef": {}} }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetProperties": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qProp" }]\n\t\t\t},\n\t\t\t"GetEffectiveProperties": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qProp" }]\n\t\t\t},\n\t\t\t"SetFullPropertyTree": {\n\t\t\t\t"In": [{ "Name": "qPropEntry","DefaultValue": {"qProperty": {"qInfo": {"qId": "", "qType": ""}, "qExtendsId": "", "qMetaDef": {}}, "qChildren": [], "qEmbeddedSnapshotRef": null} }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetFullPropertyTree": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qPropEntry" }]\n\t\t\t},\n\t\t\t"GetInfo": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\n\t\t\t},\n\t\t\t"ClearSelections": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qColIndices","DefaultValue": [0], "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"ExportData": {\n\t\t\t\t"In": [{ "Name": "qFileType","DefaultValue": 0 }, { "Name": "qPath","DefaultValue": "", "Optional": true }, { "Name": "qFileName","DefaultValue": "", "Optional": true }, { "Name": "qExportState","DefaultValue": 0, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qUrl" }, { "Name": "qWarnings" }]\n\t\t\t},\n\t\t\t"SelectListObjectValues": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qValues","DefaultValue": [0] }, { "Name": "qToggleMode","DefaultValue": false }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"SelectListObjectPossible": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"SelectListObjectExcluded": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"SelectListObjectAlternative": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"SelectListObjectAll": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"SelectListObjectContinuousRange": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qRanges","DefaultValue": [{"qMin": 0, "qMax": 0, "qMinInclEq": false, "qMaxInclEq": false}] }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"SearchListObjectFor": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qMatch","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"AbortListObjectSearch": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"AcceptListObjectSearch": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qToggleMode","DefaultValue": false }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"ExpandLeft": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qRow","DefaultValue": 0 }, { "Name": "qCol","DefaultValue": 0 }, { "Name": "qAll","DefaultValue": false }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"ExpandTop": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qRow","DefaultValue": 0 }, { "Name": "qCol","DefaultValue": 0 }, { "Name": "qAll","DefaultValue": false }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"CollapseLeft": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qRow","DefaultValue": 0 }, { "Name": "qCol","DefaultValue": 0 }, { "Name": "qAll","DefaultValue": false }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"CollapseTop": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qRow","DefaultValue": 0 }, { "Name": "qCol","DefaultValue": 0 }, { "Name": "qAll","DefaultValue": false }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"DrillUp": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qDimNo","DefaultValue": 0 }, { "Name": "qNbrSteps","DefaultValue": 0 }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"Lock": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qColIndices","DefaultValue": [0], "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"Unlock": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qColIndices","DefaultValue": [0], "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"SelectHyperCubeValues": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qDimNo","DefaultValue": 0 }, { "Name": "qValues","DefaultValue": [0] }, { "Name": "qToggleMode","DefaultValue": false }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"SelectHyperCubeCells": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qRowIndices","DefaultValue": [0] }, { "Name": "qColIndices","DefaultValue": [0] }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }, { "Name": "qDeselectOnlyOneSelected","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"SelectPivotCells": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qSelections","DefaultValue": [{"qType": 0, "qCol": 0, "qRow": 0}] }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }, { "Name": "qDeselectOnlyOneSelected","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"RangeSelectHyperCubeValues": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qRanges","DefaultValue": [{"qRange": {"qMin": 0, "qMax": 0, "qMinInclEq": false, "qMaxInclEq": false}, "qMeasureIx": 0}] }, { "Name": "qColumnsToSelect","DefaultValue": [0], "Optional": true }, { "Name": "qOrMode","DefaultValue": false, "Optional": true }, { "Name": "qDeselectOnlyOneSelected","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"MultiRangeSelectHyperCubeValues": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qRanges","DefaultValue": [{"qRanges": [{"qRange": {"qMin": 0, "qMax": 0, "qMinInclEq": false, "qMaxInclEq": false}, "qMeasureIx": 0}], "qColumnsToSelect": [0]}] }, { "Name": "qOrMode","DefaultValue": false, "Optional": true }, { "Name": "qDeselectOnlyOneSelected","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"MultiRangeSelectTreeDataValues": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qRanges","DefaultValue": [{"qRanges": [{"qRange": {"qMin": 0, "qMax": 0, "qMinInclEq": false, "qMaxInclEq": false}, "qMeasureIx": 0, "qDimensionIx": 0}]}] }, { "Name": "qOrMode","DefaultValue": false, "Optional": true }, { "Name": "qDeselectOnlyOneSelected","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"SelectHyperCubeContinuousRange": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }, { "Name": "qRanges","DefaultValue": [{"qRange": {"qMin": 0, "qMax": 0, "qMinInclEq": false, "qMaxInclEq": false}, "qDimIx": 0}] }, { "Name": "qSoftLock","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"GetChild": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetChildInfos": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qInfos" }]\n\t\t\t},\n\t\t\t"CreateChild": {\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qExtendsId": "", "qMetaDef": {}} }, { "Name": "qPropForThis","DefaultValue": null, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\n\t\t\t},\n\t\t\t"DestroyChild": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }, { "Name": "qPropForThis","DefaultValue": null, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"DestroyAllChildren": {\n\t\t\t\t"In": [{ "Name": "qPropForThis","DefaultValue": null, "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"SetChildArrayOrder": {\n\t\t\t\t"In": [{ "Name": "qIds","DefaultValue": [""] }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetLinkedObjects": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qItems" }]\n\t\t\t},\n\t\t\t"CopyFrom": {\n\t\t\t\t"In": [{ "Name": "qFromId","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"BeginSelections": {\n\t\t\t\t"In": [{ "Name": "qPaths","DefaultValue": [""] }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"EndSelections": {\n\t\t\t\t"In": [{ "Name": "qAccept","DefaultValue": false }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"ResetMadeSelections": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"EmbedSnapshotObject": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetSnapshotObject": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"Publish": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"UnPublish": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t}\n\t\t},\n\t\t"GenericDimension":{\n\t\t\t"GetLayout": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qLayout" }]\n\t\t\t},\n\t\t\t"ApplyPatches": {\n\t\t\t\t"In": [{ "Name": "qPatches","DefaultValue": [{"qOp": 0, "qPath": "", "qValue": ""}] }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"SetProperties": {\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qDim": {"qGrouping": 0, "qFieldDefs": [""], "qFieldLabels": [""], "qLabelExpression": ""}, "qMetaDef": {}} }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetProperties": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qProp" }]\n\t\t\t},\n\t\t\t"GetInfo": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\n\t\t\t},\n\t\t\t"GetDimension": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qDim" }]\n\t\t\t},\n\t\t\t"GetLinkedObjects": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qItems" }]\n\t\t\t},\n\t\t\t"Publish": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"UnPublish": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t}\n\t\t},\n\t\t"GenericBookmark":{\n\t\t\t"GetFieldValues": {\n\t\t\t\t"In": [{ "Name": "qField","DefaultValue": "" }, { "Name": "qGetExcludedValues","DefaultValue": false }, { "Name": "qDataPage","DefaultValue": {"qStartIndex": 0, "qEndIndex": 0} }],\n\t\t\t\t"Out": [{ "Name": "qFieldValues" }]\n\t\t\t},\n\t\t\t"GetLayout": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qLayout" }]\n\t\t\t},\n\t\t\t"ApplyPatches": {\n\t\t\t\t"In": [{ "Name": "qPatches","DefaultValue": [{"qOp": 0, "qPath": "", "qValue": ""}] }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"SetProperties": {\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qMetaDef": {}} }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetProperties": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qProp" }]\n\t\t\t},\n\t\t\t"GetInfo": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\n\t\t\t},\n\t\t\t"Apply": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"Publish": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"UnPublish": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t}\n\t\t},\n\t\t"GenericVariable":{\n\t\t\t"GetLayout": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qLayout" }]\n\t\t\t},\n\t\t\t"ApplyPatches": {\n\t\t\t\t"In": [{ "Name": "qPatches","DefaultValue": [{"qOp": 0, "qPath": "", "qValue": ""}] }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"SetProperties": {\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qMetaDef": {}, "qName": "", "qComment": "", "qNumberPresentation": {"qType": 0, "qnDec": 0, "qUseThou": 0, "qFmt": "", "qDec": "", "qThou": ""}, "qIncludeInBookmark": false, "qDefinition": ""} }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetProperties": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qProp" }]\n\t\t\t},\n\t\t\t"GetInfo": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\n\t\t\t},\n\t\t\t"SetStringValue": {\n\t\t\t\t"In": [{ "Name": "qVal","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"SetNumValue": {\n\t\t\t\t"In": [{ "Name": "qVal","DefaultValue": 0 }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"SetDualValue": {\n\t\t\t\t"In": [{ "Name": "qText","DefaultValue": "" }, { "Name": "qNum","DefaultValue": 0 }],\n\t\t\t\t"Out": []\n\t\t\t}\n\t\t},\n\t\t"GenericMeasure":{\n\t\t\t"GetLayout": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qLayout" }]\n\t\t\t},\n\t\t\t"ApplyPatches": {\n\t\t\t\t"In": [{ "Name": "qPatches","DefaultValue": [{"qOp": 0, "qPath": "", "qValue": ""}] }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"SetProperties": {\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qMeasure": {"qLabel": "", "qDef": "", "qGrouping": 0, "qExpressions": [""], "qActiveExpression": 0, "qLabelExpression": ""}, "qMetaDef": {}} }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetProperties": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qProp" }]\n\t\t\t},\n\t\t\t"GetInfo": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\n\t\t\t},\n\t\t\t"GetMeasure": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qMeasure" }]\n\t\t\t},\n\t\t\t"GetLinkedObjects": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qItems" }]\n\t\t\t},\n\t\t\t"Publish": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"UnPublish": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t}\n\t\t},\n\t\t"Doc":{\n\t\t\t"GetField": {\n\t\t\t\t"In": [{ "Name": "qFieldName","DefaultValue": "" }, { "Name": "qStateName","DefaultValue": "", "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetFieldDescription": {\n\t\t\t\t"In": [{ "Name": "qFieldName","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetVariable": {\n\t\t\t\t"In": [{ "Name": "qName","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetLooselyCoupledVector": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qv" }]\n\t\t\t},\n\t\t\t"SetLooselyCoupledVector": {\n\t\t\t\t"In": [{ "Name": "qv","DefaultValue": [0] }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"Evaluate": {\n\t\t\t\t"In": [{ "Name": "qExpression","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"EvaluateEx": {\n\t\t\t\t"In": [{ "Name": "qExpression","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qValue" }]\n\t\t\t},\n\t\t\t"ClearAll": {\n\t\t\t\t"In": [{ "Name": "qLockedAlso","DefaultValue": false, "Optional": true }, { "Name": "qStateName","DefaultValue": "", "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"LockAll": {\n\t\t\t\t"In": [{ "Name": "qStateName","DefaultValue": "", "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"UnlockAll": {\n\t\t\t\t"In": [{ "Name": "qStateName","DefaultValue": "", "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"Back": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"Forward": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"CreateVariable": {\n\t\t\t\t"In": [{ "Name": "qName","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"RemoveVariable": {\n\t\t\t\t"In": [{ "Name": "qName","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetLocaleInfo": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetTablesAndKeys": {\n\t\t\t\t"In": [{ "Name": "qWindowSize","DefaultValue": {"qcx": 0, "qcy": 0} }, { "Name": "qNullSize","DefaultValue": {"qcx": 0, "qcy": 0} }, { "Name": "qCellHeight","DefaultValue": 0 }, { "Name": "qSyntheticMode","DefaultValue": false }, { "Name": "qIncludeSysVars","DefaultValue": false }],\n\t\t\t\t"Out": [{ "Name": "qtr" }, { "Name": "qk" }]\n\t\t\t},\n\t\t\t"GetViewDlgSaveInfo": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"SetViewDlgSaveInfo": {\n\t\t\t\t"In": [{ "Name": "qInfo","DefaultValue": {"qPos": {"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}, "qCtlInfo": {"qInternalView": {"qTables": [{"qPos": {"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}, "qCaption": ""}], "qBroomPoints": [{"qPos": {"qx": 0, "qy": 0}, "qTable": "", "qFields": [""]}], "qConnectionPoints": [{"qPos": {"qx": 0, "qy": 0}, "qFields": [""]}], "qZoomFactor": 0}, "qSourceView": {"qTables": [{"qPos": {"qLeft": 0, "qTop": 0, "qWidth": 0, "qHeight": 0}, "qCaption": ""}], "qBroomPoints": [{"qPos": {"qx": 0, "qy": 0}, "qTable": "", "qFields": [""]}], "qConnectionPoints": [{"qPos": {"qx": 0, "qy": 0}, "qFields": [""]}], "qZoomFactor": 0}}, "qMode": 0} }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetEmptyScript": {\n\t\t\t\t"In": [{ "Name": "qLocalizedMainSection","DefaultValue": "", "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"DoReload": {\n\t\t\t\t"In": [{ "Name": "qMode","DefaultValue": 0, "Optional": true }, { "Name": "qPartial","DefaultValue": false, "Optional": true }, { "Name": "qDebug","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetScriptBreakpoints": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qBreakpoints" }]\n\t\t\t},\n\t\t\t"SetScriptBreakpoints": {\n\t\t\t\t"In": [{ "Name": "qBreakpoints","DefaultValue": [{"qbufferName": "", "qlineIx": 0, "qEnabled": false}] }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetScript": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qScript" }]\n\t\t\t},\n\t\t\t"GetTextMacros": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qMacros" }]\n\t\t\t},\n\t\t\t"SetFetchLimit": {\n\t\t\t\t"In": [{ "Name": "qLimit","DefaultValue": 0 }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"DoSave": {\n\t\t\t\t"In": [{ "Name": "qFileName","DefaultValue": "", "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetTableData": {\n\t\t\t\t"In": [{ "Name": "qOffset","DefaultValue": 0 }, { "Name": "qRows","DefaultValue": 0 }, { "Name": "qSyntheticMode","DefaultValue": false }, { "Name": "qTableName","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qData" }]\n\t\t\t},\n\t\t\t"GetAppLayout": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qLayout" }]\n\t\t\t},\n\t\t\t"SetAppProperties": {\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qTitle": "", "qLastReloadTime": "", "qMigrationHash": "", "qSavedInProductVersion": "", "qThumbnail": {"qUrl": ""}} }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetAppProperties": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qProp" }]\n\t\t\t},\n\t\t\t"GetLineage": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qLineage" }]\n\t\t\t},\n\t\t\t"CreateSessionObject": {\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qExtendsId": "", "qMetaDef": {}} }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"DestroySessionObject": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"CreateObject": {\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qExtendsId": "", "qMetaDef": {}} }],\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\n\t\t\t},\n\t\t\t"DestroyObject": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"GetObject": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetObjects": {\n\t\t\t\t"In": [{ "Name": "qOptions","DefaultValue": {"qTypes": [""], "qIncludeSessionObjects": false, "qData": {}} }],\n\t\t\t\t"Out": [{ "Name": "qList" }]\n\t\t\t},\n\t\t\t"GetBookmarks": {\n\t\t\t\t"In": [{ "Name": "qOptions","DefaultValue": {"qTypes": [""], "qData": {}} }],\n\t\t\t\t"Out": [{ "Name": "qList" }]\n\t\t\t},\n\t\t\t"CloneObject": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qCloneId" }]\n\t\t\t},\n\t\t\t"CreateDraft": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qDraftId" }]\n\t\t\t},\n\t\t\t"CommitDraft": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"DestroyDraft": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }, { "Name": "qSourceId","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"Undo": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"Redo": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"ClearUndoBuffer": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"CreateDimension": {\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qDim": {"qGrouping": 0, "qFieldDefs": [""], "qFieldLabels": [""], "qLabelExpression": ""}, "qMetaDef": {}} }],\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\n\t\t\t},\n\t\t\t"DestroyDimension": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"GetDimension": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"CloneDimension": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qCloneId" }]\n\t\t\t},\n\t\t\t"CreateMeasure": {\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qMeasure": {"qLabel": "", "qDef": "", "qGrouping": 0, "qExpressions": [""], "qActiveExpression": 0, "qLabelExpression": ""}, "qMetaDef": {}} }],\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\n\t\t\t},\n\t\t\t"DestroyMeasure": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"GetMeasure": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"CloneMeasure": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qCloneId" }]\n\t\t\t},\n\t\t\t"CreateSessionVariable": {\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qMetaDef": {}, "qName": "", "qComment": "", "qNumberPresentation": {"qType": 0, "qnDec": 0, "qUseThou": 0, "qFmt": "", "qDec": "", "qThou": ""}, "qIncludeInBookmark": false, "qDefinition": ""} }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"DestroySessionVariable": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"CreateVariableEx": {\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qMetaDef": {}, "qName": "", "qComment": "", "qNumberPresentation": {"qType": 0, "qnDec": 0, "qUseThou": 0, "qFmt": "", "qDec": "", "qThou": ""}, "qIncludeInBookmark": false, "qDefinition": ""} }],\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\n\t\t\t},\n\t\t\t"DestroyVariableById": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"DestroyVariableByName": {\n\t\t\t\t"In": [{ "Name": "qName","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"GetVariableById": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetVariableByName": {\n\t\t\t\t"In": [{ "Name": "qName","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"MigrateVariables": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"MigrateDerivedFields": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"CheckExpression": {\n\t\t\t\t"In": [{ "Name": "qExpr","DefaultValue": "" }, { "Name": "qLabels","DefaultValue": [""], "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qErrorMsg" }, { "Name": "qBadFieldNames" }, { "Name": "qDangerousFieldNames" }]\n\t\t\t},\n\t\t\t"CheckNumberOrExpression": {\n\t\t\t\t"In": [{ "Name": "qExpr","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qErrorMsg" }, { "Name": "qBadFieldNames" }]\n\t\t\t},\n\t\t\t"AddAlternateState": {\n\t\t\t\t"In": [{ "Name": "qStateName","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"RemoveAlternateState": {\n\t\t\t\t"In": [{ "Name": "qStateName","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"CreateBookmark": {\n\t\t\t\t"In": [{ "Name": "qProp","DefaultValue": {"qInfo": {"qId": "", "qType": ""}, "qMetaDef": {}} }],\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\n\t\t\t},\n\t\t\t"DestroyBookmark": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"GetBookmark": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"ApplyBookmark": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"CloneBookmark": {\n\t\t\t\t"In": [{ "Name": "qId","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qCloneId" }]\n\t\t\t},\n\t\t\t"AddFieldFromExpression": {\n\t\t\t\t"In": [{ "Name": "qName","DefaultValue": "" }, { "Name": "qExpr","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"GetFieldOnTheFlyByName": {\n\t\t\t\t"In": [{ "Name": "qReadableName","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qName" }]\n\t\t\t},\n\t\t\t"GetAllInfos": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qInfos" }]\n\t\t\t},\n\t\t\t"Resume": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"AbortModal": {\n\t\t\t\t"In": [{ "Name": "qAccept","DefaultValue": false }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"Publish": {\n\t\t\t\t"In": [{ "Name": "qStreamId","DefaultValue": "" }, { "Name": "qName","DefaultValue": "", "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"UnPublish": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetMatchingFields": {\n\t\t\t\t"In": [{ "Name": "qTags","DefaultValue": [""] }, { "Name": "qMatchingFieldMode","DefaultValue": 0, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qFieldNames" }]\n\t\t\t},\n\t\t\t"FindMatchingFields": {\n\t\t\t\t"In": [{ "Name": "qFieldName","DefaultValue": "" }, { "Name": "qTags","DefaultValue": [""] }],\n\t\t\t\t"Out": [{ "Name": "qFieldNames" }]\n\t\t\t},\n\t\t\t"Scramble": {\n\t\t\t\t"In": [{ "Name": "qFieldName","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"SaveObjects": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetAssociationScores": {\n\t\t\t\t"In": [{ "Name": "qTable1","DefaultValue": "" }, { "Name": "qTable2","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qScore" }]\n\t\t\t},\n\t\t\t"GetMediaList": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qList" }]\n\t\t\t},\n\t\t\t"GetContentLibraries": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qList" }]\n\t\t\t},\n\t\t\t"GetLibraryContent": {\n\t\t\t\t"In": [{ "Name": "qName","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qList" }]\n\t\t\t},\n\t\t\t"DoReloadEx": {\n\t\t\t\t"In": [{ "Name": "qParams","DefaultValue": {"qMode": 0, "qPartial": false, "qDebug": false}, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qResult" }]\n\t\t\t},\n\t\t\t"BackCount": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"ForwardCount": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"ExportReducedData": {\n\t\t\t\t"In": [{ "Name": "qOptions","DefaultValue": {"qBookmarkId": "", "qExpires": 0}, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qDownloadInfo" }]\n\t\t\t},\n\t\t\t"SetScript": {\n\t\t\t\t"In": [{ "Name": "qScript","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"CheckScriptSyntax": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qErrors" }]\n\t\t\t},\n\t\t\t"GetFavoriteVariables": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qNames" }]\n\t\t\t},\n\t\t\t"SetFavoriteVariables": {\n\t\t\t\t"In": [{ "Name": "qNames","DefaultValue": [""] }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetIncludeFileContent": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qContent" }]\n\t\t\t},\n\t\t\t"CreateConnection": {\n\t\t\t\t"In": [{ "Name": "qConnection","DefaultValue": {"qId": "", "qName": "", "qConnectionString": "", "qType": "", "qUserName": "", "qPassword": "", "qModifiedDate": "", "qMeta": {"qName": ""}, "qLogOn": 0} }],\n\t\t\t\t"Out": [{ "Name": "qConnectionId" }]\n\t\t\t},\n\t\t\t"ModifyConnection": {\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qConnection","DefaultValue": {"qId": "", "qName": "", "qConnectionString": "", "qType": "", "qUserName": "", "qPassword": "", "qModifiedDate": "", "qMeta": {"qName": ""}, "qLogOn": 0} }, { "Name": "qOverrideCredentials","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"DeleteConnection": {\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetConnection": {\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qConnection" }]\n\t\t\t},\n\t\t\t"GetConnections": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qConnections" }]\n\t\t\t},\n\t\t\t"GetDatabaseInfo": {\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qInfo" }]\n\t\t\t},\n\t\t\t"GetDatabases": {\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qDatabases" }]\n\t\t\t},\n\t\t\t"GetDatabaseOwners": {\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qDatabase","DefaultValue": "", "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qOwners" }]\n\t\t\t},\n\t\t\t"GetDatabaseTables": {\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qDatabase","DefaultValue": "", "Optional": true }, { "Name": "qOwner","DefaultValue": "", "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qTables" }]\n\t\t\t},\n\t\t\t"GetDatabaseTableFields": {\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qDatabase","DefaultValue": "", "Optional": true }, { "Name": "qOwner","DefaultValue": "", "Optional": true }, { "Name": "qTable","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qFields" }]\n\t\t\t},\n\t\t\t"GetDatabaseTablePreview": {\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qDatabase","DefaultValue": "", "Optional": true }, { "Name": "qOwner","DefaultValue": "", "Optional": true }, { "Name": "qTable","DefaultValue": "" }, { "Name": "qConditions","DefaultValue": {"qType": 0, "qWherePredicate": ""}, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qPreview" }, { "Name": "qRowCount" }]\n\t\t\t},\n\t\t\t"GetFolderItemsForConnection": {\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qRelativePath","DefaultValue": "", "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qFolderItems" }]\n\t\t\t},\n\t\t\t"GuessFileType": {\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qRelativePath","DefaultValue": "", "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qDataFormat" }]\n\t\t\t},\n\t\t\t"GetFileTables": {\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qRelativePath","DefaultValue": "", "Optional": true }, { "Name": "qDataFormat","DefaultValue": {"qType": 0, "qLabel": "", "qQuote": "", "qComment": "", "qDelimiter": {"qName": "", "qScriptCode": "", "qNumber": 0, "qIsMultiple": false}, "qCodePage": 0, "qHeaderSize": 0, "qRecordSize": 0, "qTabSize": 0, "qIgnoreEOF": false, "qFixedWidthDelimiters": ""} }],\n\t\t\t\t"Out": [{ "Name": "qTables" }]\n\t\t\t},\n\t\t\t"GetFileTableFields": {\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qRelativePath","DefaultValue": "", "Optional": true }, { "Name": "qDataFormat","DefaultValue": {"qType": 0, "qLabel": "", "qQuote": "", "qComment": "", "qDelimiter": {"qName": "", "qScriptCode": "", "qNumber": 0, "qIsMultiple": false}, "qCodePage": 0, "qHeaderSize": 0, "qRecordSize": 0, "qTabSize": 0, "qIgnoreEOF": false, "qFixedWidthDelimiters": ""} }, { "Name": "qTable","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qFields" }, { "Name": "qFormatSpec" }]\n\t\t\t},\n\t\t\t"GetFileTablePreview": {\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qRelativePath","DefaultValue": "", "Optional": true }, { "Name": "qDataFormat","DefaultValue": {"qType": 0, "qLabel": "", "qQuote": "", "qComment": "", "qDelimiter": {"qName": "", "qScriptCode": "", "qNumber": 0, "qIsMultiple": false}, "qCodePage": 0, "qHeaderSize": 0, "qRecordSize": 0, "qTabSize": 0, "qIgnoreEOF": false, "qFixedWidthDelimiters": ""} }, { "Name": "qTable","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qPreview" }, { "Name": "qFormatSpec" }]\n\t\t\t},\n\t\t\t"GetFileTablesEx": {\n\t\t\t\t"In": [{ "Name": "qConnectionId","DefaultValue": "" }, { "Name": "qRelativePath","DefaultValue": "", "Optional": true }, { "Name": "qDataFormat","DefaultValue": {"qType": 0, "qLabel": "", "qQuote": "", "qComment": "", "qDelimiter": {"qName": "", "qScriptCode": "", "qNumber": 0, "qIsMultiple": false}, "qCodePage": 0, "qHeaderSize": 0, "qRecordSize": 0, "qTabSize": 0, "qIgnoreEOF": false, "qFixedWidthDelimiters": ""} }],\n\t\t\t\t"Out": [{ "Name": "qTables" }]\n\t\t\t},\n\t\t\t"SendGenericCommandToCustomConnector": {\n\t\t\t\t"In": [{ "Name": "qProvider","DefaultValue": "" }, { "Name": "qCommand","DefaultValue": "" }, { "Name": "qMethod","DefaultValue": "" }, { "Name": "qParameters","DefaultValue": [""] }, { "Name": "qAppendConnection","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qResult" }]\n\t\t\t},\n\t\t\t"SearchSuggest": {\n\t\t\t\t"In": [{ "Name": "qOptions","DefaultValue": {"qSearchFields": [""], "qContext": 0, "qCharEncoding": 0, "qAttributes": [""]} }, { "Name": "qTerms","DefaultValue": [""] }],\n\t\t\t\t"Out": [{ "Name": "qResult" }]\n\t\t\t},\n\t\t\t"SearchAssociations": {\n\t\t\t\t"In": [{ "Name": "qOptions","DefaultValue": {"qSearchFields": [""], "qContext": 0, "qCharEncoding": 0, "qAttributes": [""]} }, { "Name": "qTerms","DefaultValue": [""] }, { "Name": "qPage","DefaultValue": {"qOffset": 0, "qCount": 0, "qMaxNbrFieldMatches": 0, "qGroupOptions": [{"qGroupType": 0, "qOffset": 0, "qCount": 0}], "qGroupItemOptions": [{"qGroupItemType": 0, "qOffset": 0, "qCount": 0}]} }],\n\t\t\t\t"Out": [{ "Name": "qResults" }]\n\t\t\t},\n\t\t\t"SelectAssociations": {\n\t\t\t\t"In": [{ "Name": "qOptions","DefaultValue": {"qSearchFields": [""], "qContext": 0, "qCharEncoding": 0, "qAttributes": [""]} }, { "Name": "qTerms","DefaultValue": [""] }, { "Name": "qMatchIx","DefaultValue": 0 }, { "Name": "qSoftLock","DefaultValue": null, "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"SearchResults": {\n\t\t\t\t"In": [{ "Name": "qOptions","DefaultValue": {"qSearchFields": [""], "qContext": 0, "qCharEncoding": 0, "qAttributes": [""]} }, { "Name": "qTerms","DefaultValue": [""] }, { "Name": "qPage","DefaultValue": {"qOffset": 0, "qCount": 0, "qMaxNbrFieldMatches": 0, "qGroupOptions": [{"qGroupType": 0, "qOffset": 0, "qCount": 0}], "qGroupItemOptions": [{"qGroupItemType": 0, "qOffset": 0, "qCount": 0}]} }],\n\t\t\t\t"Out": [{ "Name": "qResult" }]\n\t\t\t},\n\t\t\t"SearchObjects": {\n\t\t\t\t"In": [{ "Name": "qOptions","DefaultValue": {"qAttributes": [""], "qCharEncoding": 0} }, { "Name": "qTerms","DefaultValue": [""] }, { "Name": "qPage","DefaultValue": {"qOffset": 0, "qCount": 0, "qMaxNbrFieldMatches": 0, "qGroupOptions": [{"qGroupType": 0, "qOffset": 0, "qCount": 0}], "qGroupItemOptions": [{"qGroupItemType": 0, "qOffset": 0, "qCount": 0}]} }],\n\t\t\t\t"Out": [{ "Name": "qResult" }]\n\t\t\t},\n\t\t\t"GetScriptEx": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qScript" }]\n\t\t\t}\n\t\t},\n\t\t"Global":{\n\t\t\t"AbortRequest": {\n\t\t\t\t"In": [{ "Name": "qRequestId","DefaultValue": 0 }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"AbortAll": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetProgress": {\n\t\t\t\t"In": [{ "Name": "qRequestId","DefaultValue": 0 }],\n\t\t\t\t"Out": [{ "Name": "qProgressData" }]\n\t\t\t},\n\t\t\t"QvVersion": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"OSVersion": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"OSName": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"QTProduct": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetDocList": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qDocList" }]\n\t\t\t},\n\t\t\t"GetInteract": {\n\t\t\t\t"In": [{ "Name": "qRequestId","DefaultValue": 0 }],\n\t\t\t\t"Out": [{ "Name": "qDef" }]\n\t\t\t},\n\t\t\t"InteractDone": {\n\t\t\t\t"In": [{ "Name": "qRequestId","DefaultValue": 0 }, { "Name": "qDef","DefaultValue": {"qType": 0, "qTitle": "", "qMsg": "", "qButtons": 0, "qLine": "", "qOldLineNr": 0, "qNewLineNr": 0, "qPath": "", "qHidden": false, "qResult": 0, "qInput": ""} }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetAuthenticatedUser": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"CreateDocEx": {\n\t\t\t\t"In": [{ "Name": "qDocName","DefaultValue": "" }, { "Name": "qUserName","DefaultValue": "", "Optional": true }, { "Name": "qPassword","DefaultValue": "", "Optional": true }, { "Name": "qSerial","DefaultValue": "", "Optional": true }, { "Name": "qLocalizedScriptMainSection","DefaultValue": "", "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qDocId" }]\n\t\t\t},\n\t\t\t"GetActiveDoc": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"AllowCreateApp": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"CreateApp": {\n\t\t\t\t"In": [{ "Name": "qAppName","DefaultValue": "" }, { "Name": "qLocalizedScriptMainSection","DefaultValue": "", "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }, { "Name": "qAppId" }]\n\t\t\t},\n\t\t\t"DeleteApp": {\n\t\t\t\t"In": [{ "Name": "qAppId","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"IsDesktopMode": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetConfiguration": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qConfig" }]\n\t\t\t},\n\t\t\t"CancelRequest": {\n\t\t\t\t"In": [{ "Name": "qRequestId","DefaultValue": 0 }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"ShutdownProcess": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"ReloadExtensionList": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"ReplaceAppFromID": {\n\t\t\t\t"In": [{ "Name": "qTargetAppId","DefaultValue": "" }, { "Name": "qSrcAppID","DefaultValue": "" }, { "Name": "qIds","DefaultValue": [""] }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"CopyApp": {\n\t\t\t\t"In": [{ "Name": "qTargetAppId","DefaultValue": "" }, { "Name": "qSrcAppId","DefaultValue": "" }, { "Name": "qIds","DefaultValue": [""] }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"ImportApp": {\n\t\t\t\t"In": [{ "Name": "qAppId","DefaultValue": "" }, { "Name": "qSrcPath","DefaultValue": "" }, { "Name": "qIds","DefaultValue": [""] }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"ImportAppEx": {\n\t\t\t\t"In": [{ "Name": "qAppId","DefaultValue": "" }, { "Name": "qSrcPath","DefaultValue": "" }, { "Name": "qIds","DefaultValue": [""] }, { "Name": "qExcludeConnections","DefaultValue": false }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"ExportApp": {\n\t\t\t\t"In": [{ "Name": "qTargetPath","DefaultValue": "" }, { "Name": "qSrcAppId","DefaultValue": "" }, { "Name": "qIds","DefaultValue": [""] }],\n\t\t\t\t"Out": [{ "Name": "qSuccess" }]\n\t\t\t},\n\t\t\t"PublishApp": {\n\t\t\t\t"In": [{ "Name": "qAppId","DefaultValue": "" }, { "Name": "qName","DefaultValue": "" }, { "Name": "qStreamId","DefaultValue": "" }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"IsPersonalMode": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetUniqueID": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qUniqueID" }]\n\t\t\t},\n\t\t\t"OpenDoc": {\n\t\t\t\t"In": [{ "Name": "qDocName","DefaultValue": "" }, { "Name": "qUserName","DefaultValue": "", "Optional": true }, { "Name": "qPassword","DefaultValue": "", "Optional": true }, { "Name": "qSerial","DefaultValue": "", "Optional": true }, { "Name": "qNoData","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"CreateSessionApp": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qSessionAppId" }]\n\t\t\t},\n\t\t\t"CreateSessionAppFromApp": {\n\t\t\t\t"In": [{ "Name": "qSrcAppId","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qSessionAppId" }]\n\t\t\t},\n\t\t\t"ProductVersion": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetAppEntry": {\n\t\t\t\t"In": [{ "Name": "qAppID","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qEntry" }]\n\t\t\t},\n\t\t\t"ConfigureReload": {\n\t\t\t\t"In": [{ "Name": "qCancelOnScriptError","DefaultValue": false }, { "Name": "qUseErrorData","DefaultValue": false }, { "Name": "qInteractOnError","DefaultValue": false }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"CancelReload": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetBNF": {\n\t\t\t\t"In": [{ "Name": "qBnfType","DefaultValue": 0 }],\n\t\t\t\t"Out": [{ "Name": "qBnfDefs" }]\n\t\t\t},\n\t\t\t"GetFunctions": {\n\t\t\t\t"In": [{ "Name": "qGroup","DefaultValue": 0, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qFunctions" }]\n\t\t\t},\n\t\t\t"GetOdbcDsns": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qOdbcDsns" }]\n\t\t\t},\n\t\t\t"GetOleDbProviders": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qOleDbProviders" }]\n\t\t\t},\n\t\t\t"GetDatabasesFromConnectionString": {\n\t\t\t\t"In": [{ "Name": "qConnection","DefaultValue": {"qId": "", "qName": "", "qConnectionString": "", "qType": "", "qUserName": "", "qPassword": "", "qModifiedDate": "", "qMeta": {"qName": ""}, "qLogOn": 0} }],\n\t\t\t\t"Out": [{ "Name": "qDatabases" }]\n\t\t\t},\n\t\t\t"IsValidConnectionString": {\n\t\t\t\t"In": [{ "Name": "qConnection","DefaultValue": {"qId": "", "qName": "", "qConnectionString": "", "qType": "", "qUserName": "", "qPassword": "", "qModifiedDate": "", "qMeta": {"qName": ""}, "qLogOn": 0} }],\n\t\t\t\t"Out": []\n\t\t\t},\n\t\t\t"GetDefaultAppFolder": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qPath" }]\n\t\t\t},\n\t\t\t"GetMyDocumentsFolder": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qFolder" }]\n\t\t\t},\n\t\t\t"GetLogicalDriveStrings": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qDrives" }]\n\t\t\t},\n\t\t\t"GetFolderItemsForPath": {\n\t\t\t\t"In": [{ "Name": "qPath","DefaultValue": "" }],\n\t\t\t\t"Out": [{ "Name": "qFolderItems" }]\n\t\t\t},\n\t\t\t"GetSupportedCodePages": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qCodePages" }]\n\t\t\t},\n\t\t\t"GetCustomConnectors": {\n\t\t\t\t"In": [{ "Name": "qReloadList","DefaultValue": false, "Optional": true }],\n\t\t\t\t"Out": [{ "Name": "qConnectors" }]\n\t\t\t},\n\t\t\t"GetStreamList": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qStreamList" }]\n\t\t\t},\n\t\t\t"EngineVersion": {\n\t\t\t\t"In": [],\n\t\t\t\t"Out": [{ "Name": "qVersion" }]\n\t\t\t},\n\t\t\t"GetBaseBNF": {\n\t\t\t\t"In": [{ "Name": "qBnfType","DefaultValue": 0 }],\n\t\t\t\t"Out": [{ "Name": "qBnfDefs" }, { "Name": "qBnfHash" }]\n\t\t\t},\n\t\t\t"GetBaseBNFHash": {\n\t\t\t\t"In": [{ "Name": "qBnfType","DefaultValue": 0 }],\n\t\t\t\t"Out": [{ "Name": "qBnfHash" }]\n\t\t\t},\n\t\t\t"GetBaseBNFString": {\n\t\t\t\t"In": [{ "Name": "qBnfType","DefaultValue": 0 }],\n\t\t\t\t"Out": [{ "Name": "qBnfStr" }, { "Name": "qBnfHash" }]\n\t\t\t}\n\t\t}\n\t},\n\t"enums": {\n\t\t"LocalizedMessageCode": {\n\t\t\t"LOCMSG_SCRIPTEDITOR_EMPTY_MESSAGE": 0,\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_SAVING_STARTED": 1,\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_BYTES_LEFT": 2,\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_STORING_TABLES": 3,\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_ROWS_SO_FAR": 4,\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_CONNECTED": 5,\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_CONNECTING_TO": 6,\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_CONNECT_FAILED": 7,\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_ROWISH": 8,\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_COLUMNAR": 9,\n\t\t\t"LOCMSG_SCRIPTEDITOR_ERROR": 10,\n\t\t\t"LOCMSG_SCRIPTEDITOR_DONE": 11,\n\t\t\t"LOCMSG_SCRIPTEDITOR_LOAD_EXTERNAL_DATA": 12,\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_OLD_QVD_ISLOADING": 13,\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_QVC_LOADING": 14,\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_QVD_BUFFERED": 15,\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_QVC_PREPARING": 16,\n\t\t\t"LOCMSG_SCRIPTEDITOR_PROGRESS_QVC_APPENDING": 17,\n\t\t\t"LOCMSG_SCRIPTEDITOR_REMOVE_SYNTHETIC": 18,\n\t\t\t"LOCMSG_SCRIPTEDITOR_PENDING_LINKEDTABLE_FETCHING": 19,\n\t\t\t"LOCMSG_SCRIPTEDITOR_RELOAD": 20,\n\t\t\t"LOCMSG_SCRIPTEDITOR_LINES_FETCHED": 21,\n\t\t\t"LOCMSG_SCRIPTEDITOR_SEARCHINDEX_START": 22,\n\t\t\t"LOCMSG_SCRIPTEDITOR_SEARCHINDEX_FIELD": 23,\n\t\t\t"LOCMSG_SCRIPTEDITOR_SEARCHINDEX_SUCCESS": 24,\n\t\t\t"LOCMSG_SCRIPTEDITOR_SEARCHINDEX_FAILURE": 25,\n\t\t\t"LOCMSG_SCRIPTEDITOR_SEARCHINDEX_STARTABORT": 26,\n\t\t\t"LOCMSG_SCRIPTEDITOR_SEARCHINDEX_ENDABORT": 27,\n\t\t\t"LOCMSG_SCRIPTEDITOR_SEARCHINDEX_TIMEOUT": 28,\n\t\t\t"LOCMSG_SCRIPTEDITOR_SEARCHINDEX_OUTOFMEMORY": 29\n\t\t},\n\t\t"LocalizedErrorCode": {\n\t\t\t"LOCERR_INTERNAL_ERROR": -128,\n\t\t\t"LOCERR_GENERIC_UNKNOWN": -1,\n\t\t\t"LOCERR_GENERIC_OK": 0,\n\t\t\t"LOCERR_GENERIC_NOT_SET": 1,\n\t\t\t"LOCERR_GENERIC_NOT_FOUND": 2,\n\t\t\t"LOCERR_GENERIC_ALREADY_EXISTS": 3,\n\t\t\t"LOCERR_GENERIC_INVALID_PATH": 4,\n\t\t\t"LOCERR_GENERIC_ACCESS_DENIED": 5,\n\t\t\t"LOCERR_GENERIC_OUT_OF_MEMORY": 6,\n\t\t\t"LOCERR_GENERIC_NOT_INITIALIZED": 7,\n\t\t\t"LOCERR_GENERIC_INVALID_PARAMETERS": 8,\n\t\t\t"LOCERR_GENERIC_EMPTY_PARAMETERS": 9,\n\t\t\t"LOCERR_GENERIC_INTERNAL_ERROR": 10,\n\t\t\t"LOCERR_GENERIC_CORRUPT_DATA": 11,\n\t\t\t"LOCERR_GENERIC_MEMORY_INCONSISTENCY": 12,\n\t\t\t"LOCERR_GENERIC_INVISIBLE_OWNER_ABORT": 13,\n\t\t\t"LOCERR_GENERIC_PROHIBIT_VALIDATE": 14,\n\t\t\t"LOCERR_GENERIC_ABORTED": 15,\n\t\t\t"LOCERR_GENERIC_CONNECTION_LOST": 16,\n\t\t\t"LOCERR_GENERIC_UNSUPPORTED_IN_PRODUCT_VERSION": 17,\n\t\t\t"LOCERR_GENERIC_REST_CONNECTION_FAILURE": 18,\n\t\t\t"LOCERR_GENERIC_MEMORY_LIMIT_REACHED": 19,\n\t\t\t"LOCERR_HTTP_400": 400,\n\t\t\t"LOCERR_HTTP_401": 401,\n\t\t\t"LOCERR_HTTP_402": 402,\n\t\t\t"LOCERR_HTTP_403": 403,\n\t\t\t"LOCERR_HTTP_404": 404,\n\t\t\t"LOCERR_HTTP_405": 405,\n\t\t\t"LOCERR_HTTP_406": 406,\n\t\t\t"LOCERR_HTTP_407": 407,\n\t\t\t"LOCERR_HTTP_408": 408,\n\t\t\t"LOCERR_HTTP_409": 409,\n\t\t\t"LOCERR_HTTP_410": 410,\n\t\t\t"LOCERR_HTTP_411": 411,\n\t\t\t"LOCERR_HTTP_412": 412,\n\t\t\t"LOCERR_HTTP_413": 413,\n\t\t\t"LOCERR_HTTP_414": 414,\n\t\t\t"LOCERR_HTTP_415": 415,\n\t\t\t"LOCERR_HTTP_416": 416,\n\t\t\t"LOCERR_HTTP_417": 417,\n\t\t\t"LOCERR_HTTP_422": 422,\n\t\t\t"LOCERR_HTTP_429": 429,\n\t\t\t"LOCERR_HTTP_500": 500,\n\t\t\t"LOCERR_HTTP_501": 501,\n\t\t\t"LOCERR_HTTP_502": 502,\n\t\t\t"LOCERR_HTTP_503": 503,\n\t\t\t"LOCERR_HTTP_504": 504,\n\t\t\t"LOCERR_HTTP_505": 505,\n\t\t\t"LOCERR_HTTP_509": 509,\n\t\t\t"LOCERR_HTTP_COULD_NOT_RESOLVE_HOST": 700,\n\t\t\t"LOCERR_APP_ALREADY_EXISTS": 1000,\n\t\t\t"LOCERR_APP_INVALID_NAME": 1001,\n\t\t\t"LOCERR_APP_ALREADY_OPEN": 1002,\n\t\t\t"LOCERR_APP_NOT_FOUND": 1003,\n\t\t\t"LOCERR_APP_IMPORT_FAILED": 1004,\n\t\t\t"LOCERR_APP_SAVE_FAILED": 1005,\n\t\t\t"LOCERR_APP_CREATE_FAILED": 1006,\n\t\t\t"LOCERR_APP_INVALID": 1007,\n\t\t\t"LOCERR_APP_CONNECT_FAILED": 1008,\n\t\t\t"LOCERR_APP_ALREADY_OPEN_IN_DIFFERENT_MODE": 1009,\n\t\t\t"LOCERR_APP_MIGRATION_COULD_NOT_CONTACT_MIGRATION_SERVICE": 1010,\n\t\t\t"LOCERR_APP_MIGRATION_COULD_NOT_START_MIGRATION": 1011,\n\t\t\t"LOCERR_APP_MIGRATION_FAILURE": 1012,\n\t\t\t"LOCERR_APP_SCRIPT_MISSING": 1013,\n\t\t\t"LOCERR_APP_EXPORT_FAILED": 1014,\n\t\t\t"LOCERR_CONNECTION_ALREADY_EXISTS": 2000,\n\t\t\t"LOCERR_CONNECTION_NOT_FOUND": 2001,\n\t\t\t"LOCERR_CONNECTION_FAILED_TO_LOAD": 2002,\n\t\t\t"LOCERR_CONNECTION_FAILED_TO_IMPORT": 2003,\n\t\t\t"LOCERR_CONNECTION_NAME_IS_INVALID": 2004,\n\t\t\t"LOCERR_CONNECTOR_NO_FILE_STREAMING_SUPPORT": 2300,\n\t\t\t"LOCERR_CONNECTOR_FILESIZE_EXCEEDED_BUFFER_SIZE": 2301,\n\t\t\t"LOCERR_FILE_ACCESS_DENIED": 3000,\n\t\t\t"LOCERR_FILE_NAME_INVALID": 3001,\n\t\t\t"LOCERR_FILE_CORRUPT": 3002,\n\t\t\t"LOCERR_FILE_NOT_FOUND": 3003,\n\t\t\t"LOCERR_FILE_FORMAT_UNSUPPORTED": 3004,\n\t\t\t"LOCERR_FILE_OPENED_IN_UNSUPPORTED_MODE": 3005,\n\t\t\t"LOCERR_FILE_TABLE_NOT_FOUND": 3006,\n\t\t\t"LOCERR_USER_ACCESS_DENIED": 4000,\n\t\t\t"LOCERR_USER_IMPERSONATION_FAILED": 4001,\n\t\t\t"LOCERR_SERVER_OUT_OF_SESSION_AND_USER_CALS": 5000,\n\t\t\t"LOCERR_SERVER_OUT_OF_SESSION_CALS": 5001,\n\t\t\t"LOCERR_SERVER_OUT_OF_USAGE_CALS": 5002,\n\t\t\t"LOCERR_SERVER_OUT_OF_CALS": 5003,\n\t\t\t"LOCERR_SERVER_OUT_OF_NAMED_CALS": 5004,\n\t\t\t"LOCERR_SERVER_OFF_DUTY": 5005,\n\t\t\t"LOCERR_SERVER_BUSY": 5006,\n\t\t\t"LOCERR_SERVER_LICENSE_EXPIRED": 5007,\n\t\t\t"LOCERR_SERVER_AJAX_DISABLED": 5008,\n\t\t\t"LOCERR_HC_INVALID_OBJECT": 6000,\n\t\t\t"LOCERR_HC_RESULT_TOO_LARGE": 6001,\n\t\t\t"LOCERR_HC_INVALID_OBJECT_STATE": 6002,\n\t\t\t"LOCERR_HC_MODAL_OBJECT_ERROR": 6003,\n\t\t\t"LOCERR_CALC_INVALID_DEF": 7000,\n\t\t\t"LOCERR_CALC_NOT_IN_LIB": 7001,\n\t\t\t"LOCERR_CALC_HEAP_ERROR": 7002,\n\t\t\t"LOCERR_CALC_TOO_LARGE": 7003,\n\t\t\t"LOCERR_CALC_TIMEOUT": 7004,\n\t\t\t"LOCERR_CALC_EVAL_CONDITION_FAILED": 7005,\n\t\t\t"LOCERR_CALC_MIXED_LINKED_AGGREGATION": 7006,\n\t\t\t"LOCERR_CALC_MISSING_LINKED": 7007,\n\t\t\t"LOCERR_CALC_INVALID_COL_SORT": 7008,\n\t\t\t"LOCERR_CALC_PAGES_TOO_LARGE": 7009,\n\t\t\t"LOCERR_CALC_SEMANTIC_FIELD_NOT_ALLOWED": 7010,\n\t\t\t"LOCERR_CALC_VALIDATION_STATE_INVALID": 7011,\n\t\t\t"LOCERR_CALC_PIVOT_DIMENSIONS_ALREADY_EXISTS": 7012,\n\t\t\t"LOCERR_CALC_MISSING_LINKED_FIELD": 7013,\n\t\t\t"LOCERR_CALC_NOT_CALCULATED": 7014,\n\t\t\t"LOCERR_LAYOUT_EXTENDS_INVALID_ID": 8000,\n\t\t\t"LOCERR_LAYOUT_LINKED_OBJECT_NOT_FOUND": 8001,\n\t\t\t"LOCERR_LAYOUT_LINKED_OBJECT_INVALID": 8002,\n\t\t\t"LOCERR_PERSISTENCE_WRITE_FAILED": 9000,\n\t\t\t"LOCERR_PERSISTENCE_READ_FAILED": 9001,\n\t\t\t"LOCERR_PERSISTENCE_DELETE_FAILED": 9002,\n\t\t\t"LOCERR_PERSISTENCE_NOT_FOUND": 9003,\n\t\t\t"LOCERR_PERSISTENCE_UNSUPPORTED_VERSION": 9004,\n\t\t\t"LOCERR_PERSISTENCE_MIGRATION_FAILED_READ_ONLY": 9005,\n\t\t\t"LOCERR_PERSISTENCE_MIGRATION_CANCELLED": 9006,\n\t\t\t"LOCERR_PERSISTENCE_MIGRATION_BACKUP_FAILED": 9007,\n\t\t\t"LOCERR_PERSISTENCE_DISK_FULL": 9008,\n\t\t\t"LOCERR_PERSISTENCE_NOT_SUPPORTED_FOR_SESSION_APP": 9009,\n\t\t\t"LOCERR_PERSISTENCE_SYNC_SET_CHUNK_INVALID_PARAMETERS": 9510,\n\t\t\t"LOCERR_PERSISTENCE_SYNC_GET_CHUNK_INVALID_PARAMETERS": 9511,\n\t\t\t"LOCERR_SCRIPT_DATASOURCE_ACCESS_DENIED": 10000,\n\t\t\t"LOCERR_RELOAD_IN_PROGRESS": 11000,\n\t\t\t"LOCERR_RELOAD_TABLE_X_NOT_FOUND": 11001,\n\t\t\t"LOCERR_RELOAD_UNKNOWN_STATEMENT": 11002,\n\t\t\t"LOCERR_RELOAD_EXPECTED_SOMETHING_FOUND_UNKNOWN": 11003,\n\t\t\t"LOCERR_RELOAD_EXPECTED_NOTHING_FOUND_UNKNOWN": 11004,\n\t\t\t"LOCERR_RELOAD_EXPECTED_ONE_OF_1_TOKENS_FOUND_UNKNOWN": 11005,\n\t\t\t"LOCERR_RELOAD_EXPECTED_ONE_OF_2_TOKENS_FOUND_UNKNOWN": 11006,\n\t\t\t"LOCERR_RELOAD_EXPECTED_ONE_OF_3_TOKENS_FOUND_UNKNOWN": 11007,\n\t\t\t"LOCERR_RELOAD_EXPECTED_ONE_OF_4_TOKENS_FOUND_UNKNOWN": 11008,\n\t\t\t"LOCERR_RELOAD_EXPECTED_ONE_OF_5_TOKENS_FOUND_UNKNOWN": 11009,\n\t\t\t"LOCERR_RELOAD_EXPECTED_ONE_OF_6_TOKENS_FOUND_UNKNOWN": 11010,\n\t\t\t"LOCERR_RELOAD_EXPECTED_ONE_OF_7_TOKENS_FOUND_UNKNOWN": 11011,\n\t\t\t"LOCERR_RELOAD_EXPECTED_ONE_OF_8_OR_MORE_TOKENS_FOUND_UNKNOWN": 11012,\n\t\t\t"LOCERR_RELOAD_FIELD_X_NOT_FOUND": 11013,\n\t\t\t"LOCERR_RELOAD_MAPPING_TABLE_X_NOT_FOUND": 11014,\n\t\t\t"LOCERR_RELOAD_LIB_CONNECTION_X_NOT_FOUND": 11015,\n\t\t\t"LOCERR_RELOAD_NAME_ALREADY_TAKEN": 11016,\n\t\t\t"LOCERR_RELOAD_WRONG_FILE_FORMAT_DIF": 11017,\n\t\t\t"LOCERR_RELOAD_WRONG_FILE_FORMAT_BIFF": 11018,\n\t\t\t"LOCERR_RELOAD_WRONG_FILE_FORMAT_ENCRYPTED": 11019,\n\t\t\t"LOCERR_RELOAD_OPEN_FILE_ERROR": 11020,\n\t\t\t"LOCERR_RELOAD_AUTO_GENERATE_COUNT": 11021,\n\t\t\t"LOCERR_RELOAD_PE_ILLEGAL_PREFIX_COMB": 11022,\n\t\t\t"LOCERR_RELOAD_MATCHING_CONTROL_STATEMENT_ERROR": 11023,\n\t\t\t"LOCERR_RELOAD_MATCHING_LIBPATH_X_NOT_FOUND": 11024,\n\t\t\t"LOCERR_RELOAD_MATCHING_LIBPATH_X_INVALID": 11025,\n\t\t\t"LOCERR_RELOAD_MATCHING_LIBPATH_X_OUTSIDE": 11026,\n\t\t\t"LOCERR_RELOAD_NO_QUALIFIED_PATH_FOR_FILE": 11027,\n\t\t\t"LOCERR_RELOAD_MODE_STATEMENT_ONLY_FOR_LIB_PATHS": 11028,\n\t\t\t"LOCERR_RELOAD_INCONSISTENT_USE_OF_SEMANTIC_FIELDS": 11029,\n\t\t\t"LOCERR_RELOAD_NO_OPEN_DATABASE": 11030,\n\t\t\t"LOCERR_RELOAD_AGGREGATION_REQUIRED_BY_GROUP_BY": 11031,\n\t\t\t"LOCERR_RELOAD_CONNECT_MUST_USE_LIB_PREFIX_IN_THIS_MODE": 11032,\n\t\t\t"LOCERR_RELOAD_ODBC_CONNECT_FAILED": 11033,\n\t\t\t"LOCERR_RELOAD_OLEDB_CONNECT_FAILED": 11034,\n\t\t\t"LOCERR_RELOAD_CUSTOM_CONNECT_FAILED": 11035,\n\t\t\t"LOCERR_RELOAD_ODBC_READ_FAILED": 11036,\n\t\t\t"LOCERR_RELOAD_OLEDB_READ_FAILED": 11037,\n\t\t\t"LOCERR_RELOAD_CUSTOM_READ_FAILED": 11038,\n\t\t\t"LOCERR_RELOAD_BINARY_LOAD_PROHIBITED": 11039,\n\t\t\t"LOCERR_RELOAD_CONNECTOR_START_FAILED": 11040,\n\t\t\t"LOCERR_RELOAD_CONNECTOR_NOT_RESPONDING": 11041,\n\t\t\t"LOCERR_RELOAD_CONNECTOR_REPLY_ERROR": 11042,\n\t\t\t"LOCERR_RELOAD_CONNECTOR_CONNECT_ERROR": 11043,\n\t\t\t"LOCERR_RELOAD_CONNECTOR_NOT_FOUND_ERROR": 11044,\n\t\t\t"LOCERR_RELOAD_INPUT_FIELD_WITH_DUPLICATE_KEYS": 11045,\n\t\t\t"LOCERR_PERSONAL_NEW_VERSION_AVAILABLE": 12000,\n\t\t\t"LOCERR_PERSONAL_VERSION_EXPIRED": 12001,\n\t\t\t"LOCERR_PERSONAL_SECTION_ACCESS_DETECTED": 12002,\n\t\t\t"LOCERR_PERSONAL_APP_DELETION_FAILED": 12003,\n\t\t\t"LOCERR_USER_AUTHENTICATION_FAILURE": 12004,\n\t\t\t"LOCERR_EXPORT_OUT_OF_MEMORY": 13000,\n\t\t\t"LOCERR_EXPORT_NO_DATA": 13001,\n\t\t\t"LOCERR_SYNC_INVALID_OFFSET": 14000,\n\t\t\t"LOCERR_SEARCH_TIMEOUT": 15000,\n\t\t\t"LOCERR_DIRECT_DISCOVERY_LINKED_EXPRESSION_FAIL": 16000,\n\t\t\t"LOCERR_DIRECT_DISCOVERY_ROWCOUNT_OVERFLOW": 16001,\n\t\t\t"LOCERR_DIRECT_DISCOVERY_EMPTY_RESULT": 16002,\n\t\t\t"LOCERR_DIRECT_DISCOVERY_DB_CONNECTION_FAILED": 16003,\n\t\t\t"LOCERR_DIRECT_DISCOVERY_MEASURE_NOT_ALLOWED": 16004,\n\t\t\t"LOCERR_DIRECT_DISCOVERY_DETAIL_NOT_ALLOWED": 16005,\n\t\t\t"LOCERR_DIRECT_DISCOVERY_NOT_SYNTH_CIRCULAR_ALLOWED": 16006,\n\t\t\t"LOCERR_DIRECT_DISCOVERY_ONLY_ONE_DD_TABLE_ALLOWED": 16007,\n\t\t\t"LOCERR_DIRECT_DISCOVERY_DB_AUTHORIZATION_FAILED": 16008,\n\t\t\t"LOCERR_SMART_LOAD_TABLE_NOT_FOUND": 17000,\n\t\t\t"LOCERR_SMART_LOAD_TABLE_DUPLICATED": 17001,\n\t\t\t"LOCERR_VARIABLE_NO_NAME": 18000,\n\t\t\t"LOCERR_VARIABLE_DUPLICATE_NAME": 18001,\n\t\t\t"LOCERR_VARIABLE_INCONSISTENCY": 18002,\n\t\t\t"LOCERR_MEDIA_LIBRARY_LIST_FAILED": 19000,\n\t\t\t"LOCERR_MEDIA_LIBRARY_CONTENT_FAILED": 19001,\n\t\t\t"LOCERR_MEDIA_BUNDLING_FAILED": 19002,\n\t\t\t"LOCERR_MEDIA_UNBUNDLING_FAILED": 19003,\n\t\t\t"LOCERR_MEDIA_LIBRARY_NOT_FOUND": 19004,\n\t\t\t"LOCERR_FEATURE_DISABLED": 20000,\n\t\t\t"LOCERR_JSON_RPC_INVALID_REQUEST": -32600,\n\t\t\t"LOCERR_JSON_RPC_METHOD_NOT_FOUND": -32601,\n\t\t\t"LOCERR_JSON_RPC_INVALID_PARAMETERS": -32602,\n\t\t\t"LOCERR_JSON_RPC_INTERNAL_ERROR": -32603,\n\t\t\t"LOCERR_JSON_RPC_PARSE_ERROR": -32700,\n\t\t\t"LOCERR_MQ_SOCKET_CONNECT_FAILURE": 33000,\n\t\t\t"LOCERR_MQ_SOCKET_OPEN_FAILURE": 33001,\n\t\t\t"LOCERR_MQ_PROTOCOL_NO_RESPONE": 33002,\n\t\t\t"LOCERR_MQ_PROTOCOL_LIBRARY_EXCEPTION": 33003,\n\t\t\t"LOCERR_MQ_PROTOCOL_CONNECTION_CLOSED": 33004,\n\t\t\t"LOCERR_MQ_PROTOCOL_CHANNEL_CLOSED": 33005,\n\t\t\t"LOCERR_MQ_PROTOCOL_UNKNOWN_ERROR": 33006,\n\t\t\t"LOCERR_MQ_PROTOCOL_INVALID_STATUS": 33007,\n\t\t\t"LOCERR_EXTENGINE_GRPC_STATUS_OK": 22000,\n\t\t\t"LOCERR_EXTENGINE_GRPC_STATUS_CANCELLED": 22001,\n\t\t\t"LOCERR_EXTENGINE_GRPC_STATUS_UNKNOWN": 22002,\n\t\t\t"LOCERR_EXTENGINE_GRPC_STATUS_INVALID_ARGUMENT": 22003,\n\t\t\t"LOCERR_EXTENGINE_GRPC_STATUS_DEADLINE_EXCEEDED": 22004,\n\t\t\t"LOCERR_EXTENGINE_GRPC_STATUS_NOT_FOUND": 22005,\n\t\t\t"LOCERR_EXTENGINE_GRPC_STATUS_ALREADY_EXISTS": 22006,\n\t\t\t"LOCERR_EXTENGINE_GRPC_STATUS_PERMISSION_DENIED": 22007,\n\t\t\t"LOCERR_EXTENGINE_GRPC_STATUS_RESOURCE_EXHAUSTED": 22008,\n\t\t\t"LOCERR_EXTENGINE_GRPC_STATUS_FAILED_PRECONDITION": 22009,\n\t\t\t"LOCERR_EXTENGINE_GRPC_STATUS_ABORTED": 22010,\n\t\t\t"LOCERR_EXTENGINE_GRPC_STATUS_OUT_OF_RANGE": 22011,\n\t\t\t"LOCERR_EXTENGINE_GRPC_STATUS_UNIMPLEMENTED": 22012,\n\t\t\t"LOCERR_EXTENGINE_GRPC_STATUS_INTERNAL": 22013,\n\t\t\t"LOCERR_EXTENGINE_GRPC_STATUS_UNAVAILABLE": 22014,\n\t\t\t"LOCERR_EXTENGINE_GRPC_STATUS_DATA_LOSS": 22015,\n\t\t\t"LOCERR_EXTENGINE_GRPC_STATUS_UNAUTHENTICATED": 22016,\n\t\t\t"LOCERR_LXW_INVALID_OBJ": 23001,\n\t\t\t"LOCERR_LXW_INVALID_FILE": 23002,\n\t\t\t"LOCERR_LXW_INVALID_SHEET": 23003,\n\t\t\t"LOCERR_LXW_INVALID_EXPORT_RANGE": 23004,\n\t\t\t"LOCERR_LXW_ERROR": 23005,\n\t\t\t"LOCERR_LXW_ERROR_MEMORY_MALLOC_FAILED": 23006,\n\t\t\t"LOCERR_LXW_ERROR_CREATING_XLSX_FILE": 23007,\n\t\t\t"LOCERR_LXW_ERROR_CREATING_TMPFILE": 23008,\n\t\t\t"LOCERR_LXW_ERROR_ZIP_FILE_OPERATION": 23009,\n\t\t\t"LOCERR_LXW_ERROR_ZIP_FILE_ADD": 23010,\n\t\t\t"LOCERR_LXW_ERROR_ZIP_CLOSE": 23011,\n\t\t\t"LOCERR_LXW_ERROR_NULL_PARAMETER_IGNORED": 23012,\n\t\t\t"LOCERR_LXW_ERROR_MAX_STRING_LENGTH_EXCEEDED": 23013,\n\t\t\t"LOCERR_LXW_ERROR_255_STRING_LENGTH_EXCEEDED": 23014,\n\t\t\t"LOCERR_LXW_ERROR_SHARED_STRING_INDEX_NOT_FOUND": 23015,\n\t\t\t"LOCERR_LXW_ERROR_WORKSHEET_INDEX_OUT_OF_RANGE": 23016,\n\t\t\t"LOCERR_LXW_ERROR_WORKSHEET_MAX_NUMBER_URLS_EXCEEDED": 23017,\n\t\t\t"LOCERR_CURL_UNSUPPORTED_PROTOCOL": 30000,\n\t\t\t"LOCERR_CURL_COULDNT_RESOLVE_PROXY": 30001,\n\t\t\t"LOCERR_CURL_COULDNT_CONNECT": 30002,\n\t\t\t"LOCERR_CURL_REMOTE_ACCESS_DENIED": 30003,\n\t\t\t"LOCERR_CURL_FTP_ACCEPT_FAILED": 30004,\n\t\t\t"LOCERR_CURL_FTP_ACCEPT_TIMEOUT": 30005,\n\t\t\t"LOCERR_CURL_FTP_CANT_GET_HOST": 30006,\n\t\t\t"LOCERR_CURL_PARTIAL_FILE": 30007,\n\t\t\t"LOCERR_CURL_QUOTE_ERROR": 30008,\n\t\t\t"LOCERR_CURL_WRITE_ERROR": 30009,\n\t\t\t"LOCERR_CURL_UPLOAD_FAILED": 30010,\n\t\t\t"LOCERR_CURL_OUT_OF_MEMORY": 30011,\n\t\t\t"LOCERR_CURL_OPERATION_TIMEDOUT": 30012,\n\t\t\t"LOCERR_CURL_FTP_COULDNT_USE_REST": 30013,\n\t\t\t"LOCERR_CURL_HTTP_POST_ERROR": 30014,\n\t\t\t"LOCERR_CURL_SSL_CONNECT_ERROR": 30015,\n\t\t\t"LOCERR_CURL_FILE_COULDNT_READ_FILE": 30016,\n\t\t\t"LOCERR_CURL_LDAP_CANNOT_BIND": 30017,\n\t\t\t"LOCERR_CURL_LDAP_SEARCH_FAILED": 30018,\n\t\t\t"LOCERR_CURL_TOO_MANY_REDIRECTS": 30019,\n\t\t\t"LOCERR_CURL_PEER_FAILED_VERIFICATION": 30020,\n\t\t\t"LOCERR_CURL_GOT_NOTHING": 30021,\n\t\t\t"LOCERR_CURL_SSL_ENGINE_NOTFOUND": 30022,\n\t\t\t"LOCERR_CURL_SSL_ENGINE_SETFAILED": 30023,\n\t\t\t"LOCERR_CURL_SSL_CERTPROBLEM": 30024,\n\t\t\t"LOCERR_CURL_SSL_CIPHER": 30025,\n\t\t\t"LOCERR_CURL_SSL_CACERT": 30026,\n\t\t\t"LOCERR_CURL_BAD_CONTENT_ENCODING": 30027,\n\t\t\t"LOCERR_CURL_LDAP_INVALID_URL": 30028,\n\t\t\t"LOCERR_CURL_USE_SSL_FAILED": 30029,\n\t\t\t"LOCERR_CURL_SSL_ENGINE_INITFAILED": 30030,\n\t\t\t"LOCERR_CURL_LOGIN_DENIED": 30031,\n\t\t\t"LOCERR_CURL_TFTP_NOTFOUND": 30032,\n\t\t\t"LOCERR_CURL_TFTP_ILLEGAL": 30033,\n\t\t\t"LOCERR_CURL_SSH": 30034\n\t\t},\n\t\t"LocalizedWarningCode": {\n\t\t\t"LOCWARN_PERSONAL_RELOAD_REQUIRED": 0,\n\t\t\t"LOCWARN_PERSONAL_VERSION_EXPIRES_SOON": 1,\n\t\t\t"LOCWARN_EXPORT_DATA_TRUNCATED": 1000,\n\t\t\t"LOCWARN_COULD_NOT_OPEN_ALL_OBJECTS": 2000\n\t\t},\n\t\t"GrpType": {\n\t\t\t"GRP_NX_NONE": 0,\n\t\t\t"GRP_NX_HIEARCHY": 1,\n\t\t\t"GRP_NX_COLLECTION": 2\n\t\t},\n\t\t"ExportFileType": {\n\t\t\t"EXPORT_CSV_C": 0,\n\t\t\t"EXPORT_CSV_T": 1,\n\t\t\t"EXPORT_OOXML": 2\n\t\t},\n\t\t"ExportState": {\n\t\t\t"EXPORT_POSSIBLE": 0,\n\t\t\t"EXPORT_ALL": 1\n\t\t},\n\t\t"DimCellType": {\n\t\t\t"NX_DIM_CELL_VALUE": 0,\n\t\t\t"NX_DIM_CELL_EMPTY": 1,\n\t\t\t"NX_DIM_CELL_NORMAL": 2,\n\t\t\t"NX_DIM_CELL_TOTAL": 3,\n\t\t\t"NX_DIM_CELL_OTHER": 4,\n\t\t\t"NX_DIM_CELL_AGGR": 5,\n\t\t\t"NX_DIM_CELL_PSEUDO": 6,\n\t\t\t"NX_DIM_CELL_ROOT": 7,\n\t\t\t"NX_DIM_CELL_NULL": 8,\n\t\t\t"NX_DIM_CELL_GENERATED": 9\n\t\t},\n\t\t"StackElemType": {\n\t\t\t"NX_STACK_CELL_NORMAL": 0,\n\t\t\t"NX_STACK_CELL_TOTAL": 1,\n\t\t\t"NX_STACK_CELL_OTHER": 2,\n\t\t\t"NX_STACK_CELL_SUM": 3,\n\t\t\t"NX_STACK_CELL_VALUE": 4,\n\t\t\t"NX_STACK_CELL_PSEUDO": 5\n\t\t},\n\t\t"SortIndicatorType": {\n\t\t\t"NX_SORT_INDICATE_NONE": 0,\n\t\t\t"NX_SORT_INDICATE_ASC": 1,\n\t\t\t"NX_SORT_INDICATE_DESC": 2\n\t\t},\n\t\t"DimensionType": {\n\t\t\t"NX_DIMENSION_TYPE_DISCRETE": 0,\n\t\t\t"NX_DIMENSION_TYPE_NUMERIC": 1,\n\t\t\t"NX_DIMENSION_TYPE_TIME": 2\n\t\t},\n\t\t"FieldSelectionMode": {\n\t\t\t"SELECTION_MODE_NORMAL": 0,\n\t\t\t"SELECTION_MODE_AND": 1,\n\t\t\t"SELECTION_MODE_NOT": 2\n\t\t},\n\t\t"FrequencyMode": {\n\t\t\t"NX_FREQUENCY_NONE": 0,\n\t\t\t"NX_FREQUENCY_VALUE": 1,\n\t\t\t"NX_FREQUENCY_PERCENT": 2,\n\t\t\t"NX_FREQUENCY_RELATIVE": 3\n\t\t},\n\t\t"DataReductionMode": {\n\t\t\t"DATA_REDUCTION_NONE": 0,\n\t\t\t"DATA_REDUCTION_ONEDIM": 1,\n\t\t\t"DATA_REDUCTION_SCATTERED": 2,\n\t\t\t"DATA_REDUCTION_CLUSTERED": 3,\n\t\t\t"DATA_REDUCTION_STACKED": 4\n\t\t},\n\t\t"HypercubeMode": {\n\t\t\t"DATA_MODE_STRAIGHT": 0,\n\t\t\t"DATA_MODE_PIVOT": 1,\n\t\t\t"DATA_MODE_PIVOT_STACK": 2,\n\t\t\t"DATA_MODE_TREE": 3\n\t\t},\n\t\t"PatchOperationType": {\n\t\t\t"Add": 0,\n\t\t\t"Remove": 1,\n\t\t\t"Replace": 2\n\t\t},\n\t\t"SelectionCellType": {\n\t\t\t"NX_CELL_DATA": 0,\n\t\t\t"NX_CELL_TOP": 1,\n\t\t\t"NX_CELL_LEFT": 2\n\t\t},\n\t\t"MatchingFieldMode": {\n\t\t\t"MATCHINGFIELDMODE_MATCH_ALL": 0,\n\t\t\t"MATCHINGFIELDMODE_MATCH_ONE": 1\n\t\t},\n\t\t"SessionState": {\n\t\t\t"SESSION_CREATED": 0,\n\t\t\t"SESSION_ATTACHED": 1\n\t\t},\n\t\t"ReloadState": {\n\t\t\t"RELOAD_PAUSED": 0,\n\t\t\t"RELOAD_STARTED": 1,\n\t\t\t"RELOAD_ABORTED": 2\n\t\t},\n\t\t"QrsChangeType": {\n\t\t\t"QRS_CHANGE_UNDEFINED": 0,\n\t\t\t"QRS_CHANGE_ADD": 1,\n\t\t\t"QRS_CHANGE_UPDATE": 2,\n\t\t\t"QRS_CHANGE_DELETE": 3\n\t\t},\n\t\t"ExtEngineDataType": {\n\t\t\t"NX_EXT_DATATYPE_STRING": 0,\n\t\t\t"NX_EXT_DATATYPE_DOUBLE": 1,\n\t\t\t"NX_EXT_DATATYPE_BOTH": 2\n\t\t},\n\t\t"ExtEngineFunctionType": {\n\t\t\t"NX_EXT_FUNCTIONTYPE_SCALAR": 0,\n\t\t\t"NX_EXT_FUNCTIONTYPE_AGGR": 1,\n\t\t\t"NX_EXT_FUNCTIONTYPE_TENSOR": 2\n\t\t},\n\t\t"ExtEngineMsgType": {\n\t\t\t"NX_EXT_MSGTYPE_FUNCTION_CALL": 1,\n\t\t\t"NX_EXT_MSGTYPE_SCRIPT_CALL": 2,\n\t\t\t"NX_EXT_MSGTYPE_RETURN_VALUE": 3,\n\t\t\t"NX_EXT_MSGTYPE_RETURN_MULTIPLE": 4,\n\t\t\t"NX_EXT_MSGTYPE_RETURN_ERROR": 5\n\t\t}\n\t}\n}'}),define("autogenerated/qix/engine-api",["text!autogenerated/qix/jsonspec.json"],function(e){return JSON.parse(e)}),define("autogenerated/qix/engine-enums",["./engine-api"],function(e){var t=e.enums;for(var n in t)t["Nx"+n]=t[n];return t}),define("general.enums/qrs-enums",[],function(){"use strict";return{NxLocalizedErrorCode:{LOCERR_JSON_RPC_ENTITY_NOT_FOUND:-32001,LOCERR_JSON_RPC_ACCESS_DENIED:-32002,LOCERR_JSON_RPC_APP_DUPLICATION_FAILED:-32003}}}),define("core.utils/external-urls",["translator","autogenerated/product-info"],function(e,t){var n=t.externalUrls;return e.ready.then(function(){n.serverHelpBaseUrl=n.serverHelpBaseUrl.replace("{language}",e.language),n.personalHelpBaseUrl=n.personalHelpBaseUrl.replace("{language}",e.language)}),Object.defineProperty(n,"gettingStarted",{get:function(){return n.qlikWebPageUrl+"/"+e.language+"-sense-gettingstarted"}}),n}),define("core.utils/help-url",["core.utils/external-urls"],function(e){function t(){var e=location.pathname.split("/").slice(-2,-1)[0];location.pathname.toLowerCase().indexOf("/workbench/")>-1?e="workbench":location.pathname.toLowerCase().indexOf("/dev-hub/")>-1?e="dev-hub":"qmc"!==e.toLowerCase()&&(e="client"),i+=e+"/"}var n={},i=e.serverHelpBaseUrl;return n.setBaseUrl=function(n){i=n?e.personalHelpBaseUrl:e.serverHelpBaseUrl,t()},Object.defineProperty(n,"path",{get:function(){return i}}),t(),n}),define("core.utils/environment",["jquery","core.utils/deferred","qvangular","core.utils/help-url"],function(e,t,n,i){function r(e){var n=new t;return s?s.promise.then(function(t){return t[e]}):(n.reject(),n.promise)}var o={},s=null;return o.setup=function(e){if(!s){s=new t,o.sessionPromise=s.promise;var r=+new Date,a=n.getService("$http")({withCredentials:!0,method:"GET",url:requirejs.toUrl("autogenerated/product-info.json?_="+r)}).then(function(e){return e.data.composition&&"CloudSuite"===e.data.composition.deploymentType},function(){return!1}),l=e.rpc.send({method:"IsPersonalMode",handle:-1,params:[]});t.all({cloud:a,desktop:l}).then(function(e){var t=e.desktop.result.qReturn;n.$rootScope.isPersonalMode=t,i.setBaseUrl(t),s.resolve({isPersonalMode:t,isCloud:e.cloud})})}return s.promise},o.inClient=function(){return document.body.classList.contains("qv-client")&&!document.body.classList.contains("qw")},o.isDesktop=function(){return r("isPersonalMode")},o.isCloud=function(){return r("isCloud")},o.getTenantId=function(){return e("#appFrame").length?e("#appFrame").attr("tenantId"):window.parent&&window.parent.document&&e("#appFrame",window.parent.document).length?e("#appFrame",window.parent.document).attr("tenantId"):""},o}),function(){"use strict";define("xsrfplugin",["jquery"],function(e){function t(e){var t,n,i="";for(t=0;t<e;t++)i+=(n=Math.floor(62*Math.random()))<10?n:n>9&&n<36?String.fromCharCode(n+55):String.fromCharCode(n+61);return i}var n=!1;return{getRandomString:t,setupXsrfPlugin:function(){var i,r;n||(n=!0,i=t(16),r=e.ajax,e.extend({ajax:function(e){if(e.headers||(e.headers={}),e.headers["X-Qlik-XrfKey"]=i,"GET"===e.type)void 0===e.data&&(e.data={}),e.data.xrfkey=i;else if(e.url){var t=-1===e.url.indexOf("?")?"?":"&";e.url+=t+"xrfkey="+i}return r.call(this,e)}}))},resetHasBeenSetup:function(){n=!1}}})}(),define("general.services/content-api/content-api",["qvangular","core.utils/deferred","translator","xsrfplugin"],function(e,t,n,i){e.service("$contentApi",["$http",function(r){function o(e){e.headers||(e.headers={})}function s(e){e.params||(e.params={})}function a(e){var t=i.getRandomString(16);return e.headers["X-Qlik-XrfKey"]=t,e.params.xrfkey=t,e}function l(e){var t=requirejs.toUrl(""),n=t.indexOf("/resources");return n>-1&&(t=t.substring(0,n)),e.url=t+e.url,e}function c(e){var t=n.language;return t&&(e.headers["Accept-Language"]="pseudo"!==t?t:"qps-ploc"),e}function u(t){return o(t),s(t),e.$rootScope.isPersonalMode||a(t),l(t),c(t),r(t)}return{getExtensions:function(){var e=new t;return u({method:"GET",url:"/qrs/extension/schema"}).then(function(t){var n=t.data;e.resolve(n)}).catch(function(t){var n=t.data;e.reject(n)}),e.promise},request:u}}])}),define("general.services/sections-toggler/sections-toggler",["qvangular","core.utils/environment","core.utils/authentication","general.services/content-api/content-api"],function(e,t,n){var i=["HubSection_Home"],r=null;e.service("clientSections",["$contentApi",function(e){function o(){var e={};for(var t in i)e[i[t]]=!0;return e}return{get:function(s){function a(e){var t={};if(e.data||Array.isArray(e.data)){for(var n in i)e.data.indexOf(i[n])>-1&&(t[i[n]]=!0);return s(t)}}function l(){return(r||(r=e.request({method:"POST",url:"/qrs/systemrule/security/evaluatetransientresources",data:i,cache:!0}))).then(a).catch(a)}function c(){return"NONE"!==n.userDirectory?l():s(o())}var u=!!s;return s=s||function(){},t.sessionPromise?t.sessionPromise.then(function(e){return e.isPersonalMode||e.isCloud||!u?s(o()):n.onDataReceived.then(function(){return c()}).catch(function(){return s(o())})}).catch(function(){return s(o())}):s(o())}}}])}),define("general.controllers/error-handler-controller",["jquery","qvangular","translator","autogenerated/qix/engine-enums","general.enums/qrs-enums","general.controllers/route-controller","core.utils/external-urls","general.services/sections-toggler/sections-toggler"],function(e,t,n,i,r,o,s){"use strict";function a(){window.__private__notifyRefresh__?window.parent.postMessage("refresh","*"):t.getService("$timeout")(function(){location.reload(!0)})}function l(e){return e.code?n.get("ErrorCode."+e.code,e.parameter):n.get(e.message)}function c(e,t){return'<h2 class="inline-title">'+e+"</h2><span>"+t+"</span>"}function u(e,i){t.getService("qvAlertDialog").show({message:c(e,i),closeLabel:n.get("Common.Refresh"),closeOnEscape:!1}).closed.then(function(){f=!1,a()})}function h(e,i){var r=c(e,i);t.getService("qvAlertDialog").show({message:r,closeOnEscape:!0}).closed.then(function(){f=!1,t.$rootScope.$broadcast("errorHandlerClosed",r,{name:n.get("Common.Refresh"),callback:a})})}function d(e,i){var r=c(e,i);t.getService("qvConfirmDialog").show({message:r,okLabel:n.get("Common.Refresh"),cancelLabel:n.get("Common.Close"),closeOnEscape:!0}).closed.then(function(e){f=!1,e?a():t.$rootScope.$broadcast("errorHandlerClosed",r,{name:n.get("Common.Refresh"),callback:a})})}function p(e){f||t.getService("clientSections").get(function(i){e.code!==m.LOCERR_JSON_RPC_INVALID_PARAMETERS&&(f=!0,n.ready.then(function(){if("ErrorDialog.AppClosed"===e.message||e.method&&"OnEngineWebsocketFailed"===e.method||e.code===m.LOCERR_APP_NOT_FOUND||e.code===m.LOCERR_APP_CONNECT_FAILED)i.HubSection_Home?t.getService("qvConfirmDialog").show({message:c(n.get("ErrorDialog.Title"),l(e)),okLabel:n.get("Common.Refresh"),cancelLabel:n.get("ErrorDialog.GoToHub.Button"),closeOnEscape:!1}).closed.then(function(e){e?a():location.href=o.buildHubUrl()}):u(n.get("ErrorDialog.Title"),l(e));else if(e.code===m.LOCERR_SERVER_LICENSE_EXPIRED||e.code===m.LOCERR_SERVER_OUT_OF_SESSION_AND_USER_CALS||e.code===m.LOCERR_SERVER_OUT_OF_SESSION_CALS||e.code===m.LOCERR_SERVER_OUT_OF_USAGE_CALS||e.code===m.LOCERR_SERVER_OUT_OF_CALS||e.code===m.LOCERR_SERVER_OUT_OF_NAMED_CALS||e.code===m.LOCERR_GENERIC_CONNECTION_LOST)d(n.get("ErrorDialog.Title"),l(e));else if(e.code===m.LOCERR_PERSONAL_VERSION_EXPIRED){var r=n.get("Info.QlikView.Personal.Upgrade",["<a href='"+s.personalUpgradeUrl+"' target='_blank'>"+s.personalUpgradeBase+"</a>"]);u(n.get("ErrorCode.12001.Sense.Desktop.Expired"),r)}else"ProxyError.OnSessionTimedOut"===e.message?u(n.get("TimeoutDialog.Title"),l(e)):e.refreshButton?u(n.get("ErrorDialog.Title"),l(e)):h(n.get("ErrorDialog.Title"),l(e))}))})}var f=!1,m=e.extend({},i.NxLocalizedErrorCode,r.NxLocalizedErrorCode);return window.showDialog=p,{showDialog:p,isOpen:function(){return f}}}),define("general.controllers/warning-handler-controller",["jquery","qvangular","translator","autogenerated/qix/engine-enums","core.utils/external-urls"],function(e,t,n,i,r){"use strict";function o(e,t){for(var n=-1,i=0;i<e.length;i++)if(e[i].code===t){n=i;break}return n}function s(e,t){if(t.shown){var n=o(e,t.code);-1!==n&&e.splice(n,1)}else-1!==o(e,t.code)&&(t.shown=!0,t.interval?localStorage.setItem(t.id,Date.now()+t.interval):sessionStorage.setItem(t.id,!0))}function a(e,n){var i='<h2 class="inline-title">'+e+"</h2><span>"+n+"</span>";t.getService("qvAlertDialog").show({message:i,closeOnEscape:!0}).closed.then(function(){u.length&&t.getService("$timeout")(function(){l(u.shift())})})}function l(e){var t,i;void 0!==e.code&&e.code===c.LOCWARN_PERSONAL_VERSION_EXPIRES_SOON?(i=n.get("Info.QlikSenseDesktop.Upgrade.Expiring",["<a href='"+r.personalUpgradeUrl+"' target='_blank'>"+r.personalUpgradeBase+"</a>"]),t=n.get("Info.QlikSenseDesktop.Upgrade.Expiring.Title")):(t=n.get("WarningDialog.Title"),i=void 0!==e.code?n.get("WarningCode."+e.code):n.get(e.message)),a(t,i)}var c=i.LocalizedWarningCode,u=[],h={code:c.LOCWARN_PERSONAL_VERSION_EXPIRES_SOON,id:"ExpireWarningShown",shown:Date.now()<parseInt(localStorage.ExpireWarningShown,10),interval:864e5},d={code:c.LOCWARN_PERSONAL_RELOAD_REQUIRED,id:"HiddenScriptWarningShown",shown:sessionStorage.HiddenScriptWarningShown};return{showDialog:function(t){var i=e.extend(!0,[],t);if(s(i,h),s(i,d),i.length>0&&(u.push.apply(u,i),!(u.length>0))){var r=u[0];n.ready.then(function(){l(r)})}}}}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("enigma",t):e.enigma=t()}(this,function(){"use strict";function e(){e.init.call(this)}function t(e){return e.substring(0,1).toLowerCase()+e.substring(1)}function n(e,t){for(var n=arguments.length,i=Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return 1===i.length&&"object"===q(i[0])&&Object.keys(i[0]).every(function(e){return L.call(t,e)})&&(i=Object.keys(t).map(function(e){return i[0][e]||t[e]})),e.apply(this,i)}function i(e,t){var n=e.config.protocol.delta&&-1!==t.outKey&&t.outKey!==R;return n&&(t.delta=n),t}function r(e,t,n){return n.qHandle&&n.qType?e.getObjectApi({handle:n.qHandle,type:n.qType,id:n.qGenericId,genericType:n.qGenericType}):null===n.qHandle&&null===n.qType?e.config.Promise.reject(new Error("Object not found")):n}function o(e){return null!=e&&!Array.isArray(e)&&"object"===(void 0===e?"undefined":q(e))}function s(e){return void 0===e}function a(e){return"function"==typeof e}function l(e){return e?B({},{val:e}).val:e}function c(e,t){return a(e[t])||"$$"===t.substring(0,2)||"_"===t.substring(0,1)}function u(e,t){var n=t.substring(1).split("/").slice(0,-1),i=void 0;return n.forEach(function(t,r){if(r!==n.length){i=+t;var o=isNaN(i)?{}:[];e[i||t]=s(e[i||t])?o:e[t],e=e[i||t]}}),e}function h(e){Object.keys(e).forEach(function(t){Object.getOwnPropertyDescriptor(e,t).configurable&&!c(e,t)&&delete e[t]})}function d(e,t){var n=!0;if(o(e)&&o(t))return Object.keys(e).length===Object.keys(t).length&&(Object.keys(e).forEach(function(i){d(e[i],t[i])||(n=!1)}),n);if($(e)&&$(t)){if(e.length!==t.length)return!1;for(var i=0,r=e.length;i<r;i+=1)if(!d(e[i],t[i]))return!1;return!0}return e===t}function p(e,t,n){function i(e,t,n){if(e[n]&&s(e[n].qInfo))return null;if(e[n]&&e[n].qInfo.qId===t)return n;for(var i=0,r=e.length;i<r;i+=1)if(e[i]&&e[i].qInfo.qId===t)return i;return-1}var r=[],o=e.slice(),a=-1;if(d(t,o))return r;if(!s(t[0])&&s(t[0].qInfo))return r.push({op:"replace",path:n,value:t}),r;for(var l=o.length-1;l>=0;l-=1)-1===(a=i(t,o[l].qInfo&&o[l].qInfo.qId,l))?(r.push({op:"remove",path:n+"/"+l}),o.splice(l,1)):r=r.concat(z.generate(o[l],t[a],n+"/"+l));for(var c=0,u=t.length;c<u;c+=1)-1===(a=i(o,t[c].qInfo&&t[c].qInfo.qId))?(r.push({op:"add",path:n+"/"+c,value:t[c]}),o.splice(c,0,t[c])):a!==c&&(r.push({op:"move",path:n+"/"+c,from:n+"/"+a}),o.splice(c,0,o.splice(a,1)[0]));return r}function f(e,t,n){var i=n.delta,r=n.result;return i?(Object.keys(r).forEach(function(n){if(!Array.isArray(r[n]))throw new Error("Unexpected RPC response, expected array of patches");r[n]=X(e,t.handle,t.method+"-"+n,r[n])}),JSON.parse(JSON.stringify(n))):n}function m(e,t,n){if(void 0!==n.error){var i=n.error,r=new Error(i.message);return r.code=i.code,r.parameter=i.parameter,e.config.Promise.reject(r)}return n}function g(e,t,n){return"CreateSessionApp"===t.method||"CreateSessionAppFromApp"===t.method?n[Y].qGenericId=n[Y].qGenericId||n.qSessionAppId:"GetInteract"===t.method&&delete n[Y],hasOwnProperty.call(n,Y)?n[Y]:-1!==t.outKey?n[t.outKey]:n}function v(e,t,n){return n.result}var y={};y.isObject=function(e){return"object"==typeof e&&null!==e},y.isNumber=function(e){return"number"==typeof e},y.isUndefined=function(e){return void 0===e},y.isFunction=function(e){return"function"==typeof e};var b=e;e.EventEmitter=e,e.prototype._events=void 0,e.prototype._maxListeners=void 0,e.defaultMaxListeners=10,e.init=function(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0},e.prototype.setMaxListeners=function(e){if(!y.isNumber(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},e.prototype.emit=function(e){var t,n,i,r,o,s;if(this._events||(this._events={}),"error"===e&&!this._events.error)throw(t=arguments[1])instanceof Error?t:Error('Uncaught, unspecified "error" event.');if(n=this._events[e],y.isUndefined(n))return!1;if(y.isFunction(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,r=new Array(i-1),o=1;o<i;o++)r[o-1]=arguments[o];n.apply(this,r)}else if(y.isObject(n)){for(i=arguments.length,r=new Array(i-1),o=1;o<i;o++)r[o-1]=arguments[o];for(i=(s=n.slice()).length,o=0;o<i;o++)s[o].apply(this,r)}return!0},e.prototype.addListener=function(t,n){if(!y.isFunction(n))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,y.isFunction(n.listener)?n.listener:n),this._events[t]?y.isObject(this._events[t])?this._events[t].push(n):this._events[t]=[this._events[t],n]:this._events[t]=n,y.isObject(this._events[t])&&!this._events[t].warned){var i;(i=y.isUndefined(this._maxListeners)?e.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,y.isFunction(console.error)&&console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),y.isFunction(console.trace)&&console.trace())}return this},e.prototype.on=e.prototype.addListener,e.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!y.isFunction(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},e.prototype.removeListener=function(e,t){var n,i,r,o;if(!y.isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],r=n.length,i=-1,n===t||y.isFunction(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(y.isObject(n)){for(o=r;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){i=o;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},e.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],y.isFunction(n))this.removeListener(e,n);else if(Array.isArray(n))for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},e.prototype.listeners=function(e){return this._events&&this._events[e]?y.isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},e.listenerCount=function(e,t){return e._events&&e._events[t]?y.isFunction(e._events[t])?1:e._events[t].length:0};var x={mixin:function(e){Object.keys(b.prototype).forEach(function(t){e[t]=b.prototype[t]}),b.init(e)}},q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C=(function(){function e(e){this.value=e}function t(t){function n(r,o){try{var s=t[r](o),a=s.value;a instanceof e?Promise.resolve(a.value).then(function(e){n("next",e)},function(e){n("throw",e)}):i(s.done?"return":"normal",s.value)}catch(e){i("throw",e)}}function i(e,t){switch(e){case"return":r.resolve({value:t,done:!0});break;case"throw":r.reject(t);break;default:r.resolve({value:t,done:!1})}(r=r.next)?n(r.key,r.arg):o=null}var r,o;this._invoke=function(e,t){return new Promise(function(i,s){var a={key:e,arg:t,resolve:i,reject:s,next:null};o?o=o.next=a:(r=o=a,n(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),S=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},_=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var s=r.get;if(void 0!==s)return s.call(i)},D=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},M=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},A=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},E=0,I=function(){function e(t){C(this,e);var n=this;w(n,t),this.Promise=this.config.Promise,this.definition=this.config.definition,x.mixin(n),E+=1,n.id=E,n.rpc.on("socket-error",n.onRpcError.bind(n)),n.rpc.on("closed",n.onRpcClosed.bind(n)),n.rpc.on("message",n.onRpcMessage.bind(n)),n.rpc.on("notification",n.onRpcNotification.bind(n)),n.rpc.on("traffic",n.onRpcTraffic.bind(n)),n.on("closed",function(){return n.onSessionClosed()})}return S(e,[{key:"onRpcError",value:function(e){this.suspendResume.isSuspended||this.emit("socket-error",e)}},{key:"onRpcClosed",value:function(e){var t=this;this.suspendResume.isSuspended||1e3!==e.code&&4e3!==e.code&&(this.config.suspendOnClose?this.suspendResume.suspend().then(function(){return t.emit("suspended",{initiator:"network"})}):this.emit("closed",e))}},{key:"onRpcMessage",value:function(e){var t=this;this.suspendResume.isSuspended||(e.change&&e.change.forEach(function(e){return t.emitHandleChanged(e)}),e.close&&e.close.forEach(function(e){return t.emitHandleClosed(e)}))}},{key:"onRpcNotification",value:function(e){this.emit("notification:*",e.method,e.params),this.emit("notification:"+e.method,e.params)}},{key:"onRpcTraffic",value:function(e,t){this.emit("traffic:*",e,t),this.emit("traffic:"+e,t)}},{key:"onSessionClosed",value:function(){this.apis.getApis().forEach(function(e){e.api.emit("closed"),e.api.removeAllListeners()}),this.apis.clear()}},{key:"getObjectApi",value:function(e){var t=e.handle,n=e.id,i=e.type,r=e.genericType,o=this.apis.getApi(t);return o||(o=this.definition.generate(i).create(this,t,n,r),this.apis.add(t,o),o)}},{key:"open",value:function(){var e=this;if(!this.globalPromise){var t={handle:-1,id:"Global",type:"Global",genericType:"Global"};this.globalPromise=this.rpc.open().then(function(){return e.getObjectApi(t)}).then(function(t){return e.emit("opened"),t})}return this.globalPromise}},{key:"send",value:function(t){var n=this;if(this.suspendResume.isSuspended)return this.Promise.reject(new Error("Session suspended"));t.id=this.rpc.createRequestId();var i=this.intercept.executeRequests(this,this.Promise.resolve(t)).then(function(e){var i=w({},n.config.protocol,e);delete i.outKey;var r=n.rpc.send(i);return e.retry=function(){return n.send(t)},n.intercept.executeResponses(n,r,e)});return e.addToPromiseChain(i,"requestId",t.id),i}},{key:"suspend",value:function(){var e=this;return this.suspendResume.suspend().then(function(){return e.emit("suspended",{initiator:"manual"})})}},{key:"resume",value:function(e){var t=this;return this.suspendResume.resume(e).then(function(e){return t.emit("resumed"),e})}},{key:"close",value:function(){var e=this;return this.globalPromise=void 0,this.rpc.close().then(function(t){return e.emit("closed",t)})}},{key:"emitHandleChanged",value:function(e){var t=this.apis.getApi(e);t&&t.emit("changed")}},{key:"emitHandleClosed",value:function(e){var t=this.apis.getApi(e);t&&(t.emit("closed"),t.removeAllListeners())}}],[{key:"addToPromiseChain",value:function(t,n,i){t[n]=i;var r=t.then;t.then=function(){for(var t=arguments.length,o=Array(t),s=0;s<t;s++)o[s]=arguments[s];var a=r.apply(this,o);return e.addToPromiseChain(a,n,i),a}}}]),e}(),T=function(){function e(){C(this,e),this.entries={}}return S(e,[{key:"add",value:function(e,t){if(e+="",void 0!==this.entries[e])throw new Error("Entry already defined with key "+e);this.entries[e]=t}},{key:"set",value:function(e,t){e+="",this.entries[e]=t}},{key:"remove",value:function(e){delete this.entries[e]}},{key:"get",value:function(e){return this.entries[e]}},{key:"getAll",value:function(){var e=this;return Object.keys(this.entries).map(function(t){return{key:t,value:e.entries[t]}})}},{key:"getKey",value:function(e){var t=this;return Object.keys(this.entries).filter(function(n){return t.entries[n]===e})[0]}},{key:"clear",value:function(){this.entries={}}}]),e}(),L=Object.prototype.hasOwnProperty,k=function(){function e(t){C(this,e),this.config=t,this.Promise=t.Promise,this.schema=t.schema,this.mixins=new T,this.types=new T}return S(e,[{key:"registerMixin",value:function(e){var t=this,n=e.types,i=e.type,r=e.extend,o=e.override,s=e.init;Array.isArray(n)||(n=[n]),i&&n.push(i);var a={extend:r,override:o,init:s};n.forEach(function(e){var n=t.mixins.get(e);n?n.push(a):t.mixins.add(e,[a])})}},{key:"generate",value:function(e){var t=this.types.get(e);if(t)return t;if(!this.schema.structs[e])throw new Error(e+" not found");var n=this.generateApi(e,this.schema.structs[e]);return this.types.add(e,n),n}},{key:"generateApi",value:function(e,t){var n=Object.create({});return this.generateDefaultApi(n,t),this.mixinType(e,n),this.mixinNamedParamFacade(n,t),{create:function(t,i,r,o){var s=this,a=Object.create(n);x.mixin(a),Object.defineProperties(a,{session:{enumerable:!0,value:t},handle:{enumerable:!0,value:i,writable:!0},id:{enumerable:!0,value:r},type:{enumerable:!0,value:e},genericType:{enumerable:!0,value:o}});var l=this.mixins.get(e)||[];return o!==e&&(this.mixinType(o,a),l=l.concat(this.mixins.get(o)||[])),l.forEach(function(e){"function"==typeof e.init&&e.init({config:s.config,api:a})}),a}.bind(this),def:n}}},{key:"generateDefaultApi",value:function(e,n){Object.keys(n).forEach(function(i){var r=n[i].Out&&n[i].Out,o=1===r.length?r[0].Name:-1,s=t(i);e[s]=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.session.send({handle:this.handle,method:i,params:t,outKey:o})}})}},{key:"mixinType",value:function(e,t){var n=this.mixins.get(e);n&&n.forEach(function(n){var i=n.extend,r=void 0===i?{}:i,o=n.override,s=void 0===o?{}:o;Object.keys(s).forEach(function(n){if("function"!=typeof t[n]||"function"!=typeof s[n])throw new Error("No function to override. Type: "+e+" function: "+n);var i=t[n];t[n]=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return s[n].apply(this,[i.bind(this)].concat(t))}}),Object.keys(r).forEach(function(n){if("function"==typeof t[n]&&"function"==typeof r[n])throw new Error("Extend is not allowed for this mixin. Type: "+e+" function: "+n);t[n]=r[n]})})}},{key:"mixinNamedParamFacade",value:function(e,i){Object.keys(i).forEach(function(r){var o=t(r),s=e[o],a=i[r].In.reduce(function(e,t){return e[t.Name]=t.DefaultValue,e},{});e[o]=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return n.apply(this,[s,a].concat(t))}})}}]),e}(),O=function(){function e(t,n,i){C(this,e),x.mixin(this),this.id=t,this.resolve=n,this.reject=i}return S(e,[{key:"resolveWith",value:function(e){this.resolve(e),this.emit("resolved",this.id)}},{key:"rejectWith",value:function(e){this.reject(e),this.emit("rejected",this.id)}}]),e}(),P=function(){function e(t){C(this,e),w(this,t),x.mixin(this),this.resolvers={},this.requestId=0,this.openedPromise=void 0}return S(e,[{key:"open",value:function(){var e=this;if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this.openedPromise)return this.openedPromise;try{this.socket=this.createSocket(this.url)}catch(e){return this.Promise.reject(e)}return this.socket.onopen=this.onOpen.bind(this),this.socket.onclose=this.onClose.bind(this),this.socket.onerror=this.onError.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.openedPromise=new this.Promise(function(t,n){return e.registerResolver("opened",t,n)}),this.closedPromise=new this.Promise(function(t,n){return e.registerResolver("closed",t,n)}),this.openedPromise}},{key:"onOpen",value:function(){var e=this;this.resolvers.opened.resolveWith(function(){return e.closedPromise})}},{key:"onClose",value:function(e){this.emit("closed",e),this.resolvers.closed.resolveWith(e),this.rejectAllOutstandingResolvers({code:-1,message:"Socket closed"})}},{key:"close",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this.socket&&(this.socket.close(e,t),this.socket=null),this.closedPromise}},{key:"onError",value:function(e){this.resolvers.opened?this.resolvers.opened.rejectWith(e):this.emit("socket-error",e),this.rejectAllOutstandingResolvers({code:-1,message:"Socket error"})}},{key:"onMessage",value:function(e){var t=JSON.parse(e.data);this.emit("traffic","received",t),void 0!==t.id?(this.emit("message",t),this.resolvers[t.id].resolveWith(t)):this.emit(t.params?"notification":"message",t)}},{key:"rejectAllOutstandingResolvers",value:function(e){var t=this;Object.keys(this.resolvers).forEach(function(n){"opened"!==n&&"closed"!==n&&t.resolvers[n].rejectWith(e)})}},{key:"unregisterResolver",value:function(e){this.resolvers[e].removeAllListeners(),delete this.resolvers[e]}},{key:"registerResolver",value:function(e,t,n){var i=this,r=new O(e,t,n);this.resolvers[e]=r,r.on("resolved",function(e){return i.unregisterResolver(e)}),r.on("rejected",function(e){return i.unregisterResolver(e)})}},{key:"send",value:function(e){var t=this;return this.socket&&this.socket.readyState===this.socket.OPEN?(e.id||(e.id=this.createRequestId()),e.jsonrpc="2.0",new this.Promise(function(n,i){return t.socket.send(JSON.stringify(e)),t.emit("traffic","sent",e),t.registerResolver(e.id,n,i)})):this.Promise.reject(new Error("Not connected"))}},{key:"createRequestId",value:function(){return this.requestId+=1,this.requestId}}]),e}(),N=function(){function e(t){var n=this;C(this,e),w(this,t),this.isSuspended=!1,this.rpc.on("traffic",function(e,t){"sent"===e&&"OpenDoc"===t.method&&(n.openDocParams=t.params)})}return S(e,[{key:"restoreRpcConnection",value:function(e){var t=this;return this.reopen(5e3).then(function(n){return"SESSION_CREATED"===n&&e?t.Promise.reject(new Error("Not attached")):t.Promise.resolve()})}},{key:"restoreGlobal",value:function(e){var t=this.apis.getApisByType("Global").pop();return e.push(t.api),this.Promise.resolve()}},{key:"restoreDoc",value:function(e,t){var n=this,i=this.apis.getApisByType("Doc").pop();return i?this.rpc.send({method:"GetActiveDoc",handle:-1,params:[]}).then(function(e){return e.error&&n.openDocParams?n.rpc.send({method:"OpenDoc",handle:-1,params:n.openDocParams}):e}).then(function(r){if(r.error)return e.push(i.api),n.Promise.resolve();var o=r.result.qReturn.qHandle;return i.api.handle=o,t.push(i.api),n.Promise.resolve(i.api)}):this.Promise.resolve()}},{key:"restoreDocObjects",value:function(t,n,i){var r=this,o=[],s=this.apis.getApis().map(function(e){return e.api}).filter(function(e){return"Global"!==e.type&&"Doc"!==e.type});return t?(s.forEach(function(s){var a=e.buildGetMethodName(s.type);if(a){var l=r.rpc.send({method:a,handle:t.handle,params:[s.id]}).then(function(e){e.error||!e.result.qReturn.qHandle?n.push(s):(s.handle=e.result.qReturn.qHandle,i.push(s))});o.push(l)}else n.push(s)}),this.Promise.all(o)):(s.forEach(function(e){return n.push(e)}),this.Promise.resolve())}},{key:"suspend",value:function(){return this.isSuspended=!0,this.rpc.close(4e3)}},{key:"resume",value:function(e){var t=this,n=[],i=[];return this.restoreRpcConnection(e).then(function(){return t.restoreGlobal(n)}).then(function(){return t.restoreDoc(i,n)}).then(function(e){return t.restoreDocObjects(e,i,n)}).then(function(){t.isSuspended=!1,t.apis.clear(),i.forEach(function(e){e.emit("closed"),e.removeAllListeners()}),n.forEach(function(e){t.apis.add(e.handle,e),"Global"!==e.type&&e.emit("changed")})}).catch(function(e){return t.rpc.close().then(function(){return t.Promise.reject(e)})})}},{key:"reopen",value:function(e){var t=this,n=void 0,i=void 0,r=!1,o=new this.Promise(function(e){i=e}),s=function(e){"OnConnected"===e.method&&(clearTimeout(n),i(e.params.qSessionState),r=!0)};return this.rpc.on("notification",s),this.rpc.open(!0).then(function(){return r||(n=setTimeout(function(){return i("SESSION_CREATED")},e)),o}).then(function(e){return t.rpc.removeListener("notification",s),e}).catch(function(e){return t.rpc.removeListener("notification",s),t.Promise.reject(e)})}}],[{key:"buildGetMethodName",value:function(e){return"Field"===e||"Variable"===e?null:"GenericVariable"===e?"GetVariableById":e.replace("Generic","Get")}}]),e}(),R="qSuccess",F=Object.prototype.hasOwnProperty,j=Object.prototype.toString,V=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===j.call(e)},H=function(e){if(!e||"[object Object]"!==j.call(e))return!1;var t=F.call(e,"constructor"),n=e.constructor&&e.constructor.prototype&&F.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!n)return!1;var i;for(i in e);return void 0===i||F.call(e,i)},B=function e(){var t,n,i,r,o,s,a=arguments[0],l=1,c=arguments.length,u=!1;for("boolean"==typeof a&&(u=a,a=arguments[1]||{},l=2),(null==a||"object"!=typeof a&&"function"!=typeof a)&&(a={});l<c;++l)if(null!=(t=arguments[l]))for(n in t)i=a[n],a!==(r=t[n])&&(u&&r&&(H(r)||(o=V(r)))?(o?(o=!1,s=i&&V(i)?i:[]):s=i&&H(i)?i:{},a[n]=e(u,s,r)):void 0!==r&&(a[n]=r));return a}.bind(null,!0),z={},$=Array.isArray;z.generate=function(e,t,n){n=n||"";var i=[];return Object.keys(t).forEach(function(r){var a=l(t[r]),u=e[r],h=n+"/"+r;d(a,u)||c(t,r)||(s(u)?i.push({op:"add",path:h,value:a}):o(a)&&o(u)?i=i.concat(z.generate(u,a,h)):$(a)&&$(u)?i=i.concat(p(u,a,h)):i.push({op:"replace",path:n+"/"+r,value:a}))}),Object.keys(e).forEach(function(r){s(t[r])&&!c(e,r)&&i.push({op:"remove",path:n+"/"+r})}),i},z.apply=function(e,t){t.forEach(function(t){var n=u(e,t.path),i=t.path.split("/").splice(-1)[0],r=i&&isNaN(+i)?n[i]:n[+i]||n,s=t.from?t.from.split("/").splice(-1)[0]:null;if("/"===t.path&&(n=null,r=e),"add"===t.op||"replace"===t.op)if($(n))"-"===i&&(i=n.length),n.splice(+i,"add"===t.op?0:1,t.value);else if($(r)&&$(t.value)){var a,l=t.value.slice();r.length=0,(a=r).push.apply(a,A(l))}else if(o(r)&&o(t.value))h(r),B(r,t.value);else{if(!n)throw new Error("Patchee is not an object we can patch");n[i]=t.value}else if("move"===t.op){var c=u(e,t.from);$(n)?n.splice(+i,0,c.splice(+s,1)[0]):(n[i]=c[s],delete c[s])}else"remove"===t.op&&($(n)?n.splice(+i,1):delete n[i])})},z.clone=function(e){return B({},e)},z.createPatch=function(e,t,n){var i={op:e.toLowerCase(),path:n};return"move"===i.op?i.from=t:void 0!==t&&(i.value=t),i},z.updateObject=function(e,t){Object.keys(e).length?z.apply(e,z.generate(e,t)):B(e,t)};var U={},G=function(e){if(!U[e.id]){var t={};U[e.id]=t,e.on("traffic:received",function(e){return e.close&&e.close.forEach(function(e){return delete t[e]})}),e.on("closed",function(){return delete U[e.id]})}},W=function(e,t){G(e);var n=U[e.id];return n[t]||(n[t]=new T),n[t]},X=function(e,t,n,i){var r=W(e,t),o=r.get(n);return void 0===o&&(o=Array.isArray(i[0].value)?[]:{}),i.length&&("/"===i[0].path&&"object"!==q(i[0].value)?o=i[0].value:z.apply(o,i),r.set(n,o)),o};f.sessions=U;var Y="qReturn",K=function(){function e(t){C(this,e),w(this,t),this.request=[{onFulfilled:i}].concat(A(this.request||[])),this.response=[{onFulfilled:m},{onFulfilled:f},{onFulfilled:v},{onFulfilled:g}].concat(A(this.response||[]),[{onFulfilled:r}])}return S(e,[{key:"executeRequests",value:function(e,t){var n=this;return this.request.reduce(function(t,i){var r=i.onFulfilled&&i.onFulfilled.bind(n,e);return t.then(r)},t)}},{key:"executeResponses",value:function(e,t,n){var i=this;return this.response.reduce(function(t,r){return t.then(r.onFulfilled&&r.onFulfilled.bind(i,e,n),r.onRejected&&r.onRejected.bind(i,e,n))},t)}}]),e}(),Q=function(e){function t(){return C(this,t),M(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return D(t,T),S(t,[{key:"add",value:function(e,n){var i=this,r={api:n};return _(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,e.toString(),r),n.on("closed",function(){return i.remove(e)}),r}},{key:"getApi",value:function(e){var t=void 0!==e?this.get(e.toString()):void 0;return t&&t.api}},{key:"getApis",value:function(){return _(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getAll",this).call(this).map(function(e){return{handle:e.key,api:e.value.api}})}},{key:"getApisByType",value:function(e){return this.getApis().filter(function(t){return t.api.type===e})}}]),t}();return function(){function e(){C(this,e)}return S(e,null,[{key:"getSession",value:function(e){var t=e.createSocket,n=e.Promise,i=e.requestInterceptors,r=e.responseInterceptors,o=e.url,s=new Q,a=new K({apis:s,Promise:n,request:i,response:r}),l=new P({createSocket:t,Promise:n,url:o}),c=new N({apis:s,Promise:n,rpc:l});return new I({apis:s,config:e,intercept:a,rpc:l,suspendResume:c})}},{key:"create",value:function(t){return e.configureDefaults(t),t.mixins.forEach(function(e){t.definition.registerMixin(e)}),e.getSession(t)}},{key:"configureDefaults",value:function(e){if(!e)throw new Error("You need to supply a configuration.");if(!e.Promise&&"undefined"==typeof Promise)throw new Error("Your environment has no Promise implementation. You must provide a Promise implementation in the config.");"function"!=typeof e.createSocket&&"function"==typeof WebSocket&&(e.createSocket=function(e){return new WebSocket(e)}),void 0===e.suspendOnClose&&(e.suspendOnClose=!1),e.protocol=e.protocol||{},e.protocol.delta=void 0===e.protocol.delta||e.protocol.delta,e.Promise=e.Promise||Promise,e.mixins=e.mixins||[],e.definition=e.definition||new k(e)}}]),e}()}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("enigma-sense-utilities",t):e.senseUtilities=t()}(this,function(){"use strict";function e(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function t(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}function n(e,n,r,o){return n=n||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?i(a(e),function(o){var a=encodeURIComponent(t(o))+r;return s(e[o])?i(e[o],function(e){return a+encodeURIComponent(t(e))}).join(n):a+encodeURIComponent(t(e[o]))}).join(n):o?encodeURIComponent(t(o))+r+encodeURIComponent(t(e)):""}function i(e,t){if(e.map)return e.map(t);for(var n=[],i=0;i<e.length;i++)n.push(t(e[i],i));return n}function r(t,n,i,r){n=n||"&",i=i||"=";var o={};if("string"!=typeof t||0===t.length)return o;var a=/\+/g;t=t.split(n);var l=1e3;r&&"number"==typeof r.maxKeys&&(l=r.maxKeys);var c=t.length;l>0&&c>l&&(c=l);for(var u=0;u<c;++u){var h,d,p,f,m=t[u].replace(a,"%20"),g=m.indexOf(i);g>=0?(h=m.substr(0,g),d=m.substr(g+1)):(h=m,d=""),p=decodeURIComponent(h),f=decodeURIComponent(d),e(o,p)?s(o[p])?o[p].push(f):o[p]=[o[p],f]:o[p]=f}return o}function o(e){return e.replace(/(^[/]+)|([/]+$)/g,"")}var s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},a=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},l={encode:n,stringify:n,decode:r,parse:r},c=(function(){function e(e){this.value=e}function t(t){function n(r,o){try{var s=t[r](o),a=s.value;a instanceof e?Promise.resolve(a.value).then(function(e){n("next",e)},function(e){n("throw",e)}):i(s.done?"return":"normal",s.value)}catch(e){i("throw",e)}}function i(e,t){switch(e){case"return":r.resolve({value:t,done:!0});break;case"throw":r.reject(t);break;default:r.resolve({value:t,done:!1})}(r=r.next)?n(r.key,r.arg):o=null}var r,o;this._invoke=function(e,t){return new Promise(function(i,s){var a={key:e,arg:t,resolve:i,reject:s,next:null};o?o=o.next=a:(r=o=a,n(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();return function(){function e(){c(this,e)}return u(e,null,[{key:"configureDefaults",value:function(e){e.host||(e.host="localhost"),void 0===e.secure&&(e.secure=!0),e.appId||e.route||(e.route="app/engineData"),void 0===e.noData&&(e.noData=!1)}},{key:"buildUrl",value:function(t){e.configureDefaults(t);var n=t.secure,i=t.host,r=t.port,s=t.prefix,a=t.subpath,c=t.route,u=t.identity,h=t.urlParams,d=t.ttl,p=t.appId,f="";return f+=(n?"wss":"ws")+"://",f+=i||"localhost",r&&(f+=":"+r),s&&(f+="/"+o(s)),a&&(f+="/"+o(a)),c?f+="/"+o(c):p&&""!==p&&(f+="/app/"+encodeURIComponent(p)),u&&(f+="/identity/"+encodeURIComponent(u)),d&&(f+="/ttl/"+d),h&&(f+="?"+l.stringify(h)),f}}]),e}()}),define("core.models/mixins/base",[],function(){return{types:["Doc","GenericObject","GenericDimension","GenericMeasure","GenericBookmark","GenericVariable","Field"],init:function(e){var t=e.api;t.getAppLayout&&(t.session.app=t),t.app=t.session.app,t.enigmaModel=e.api,t.Promise=e.config.Promise}}}),define("core.models/mixins/doc/normalize",[],function(){"use strict";return{types:"Doc",extend:{getProperties:function(){return this.getAppProperties()},setProperties:function(e){return this.setAppProperties(e)},getLayout:function(){return this.getAppLayout()},getPublishableStreams:function(){return this.Promise.all([this.getLayout(),this.global.getStreamList()]).then(function(e){return e[1].filter(function(t){return e[0].stream?t.qId===e[0].stream.id&&-1!==t.privileges.indexOf("publish"):-1!==t.privileges.indexOf("publish")})})}},init:function(e){this.Promise=e.config.Promise;var t=e.api;t.waitForOpen=this.Promise.defer(),t.waitForOpen.resolve()}}}),define("core.models/mixins/doc/modal",["core.utils/deferred"],function(e){"use strict";return{types:"Doc",extend:{abortModalSelection:function(e){return e=void 0===e||e,this.setModalSelection(null),this.abortModal(e)},switchModalSelection:function(t,n,i){var r;return t=t||null,n=n||"",i=void 0===i||i,r=Array.isArray(n)?n:[n],this.isInModalSelection()&&this.modalSelectionObject.endSelections(i),t&&!t.isClosed?(this.setModalSelection(t),t.beginSelections(r)):(this.setModalSelection(null),e.resolve())},setModalSelection:function(e){this.modalSelectionObject=e},isInModalSelection:function(){return this.modalSelectionObject&&!this.modalSelectionObject.isClosed}}}}),define("core.models/mixins/doc/get-object-cache",["core.utils/deferred","autogenerated/qix/engine-enums"],function(e,t){"use strict";function n(n){return function(){var i=[].slice.call(arguments),r=this._getCache,o=i.splice(0,1)[0],s=n+i.join("");if(r[s])return r[s];var a=o.apply(this,i).then(function(e){return e.on("closed",function(){delete r[s]}),e}).catch(function(){return delete r[s],e.reject({error:{code:t.NxLocalizedErrorCode.LOCERR_GENERIC_NOT_FOUND}})});return r[s]=a,a}}var i=n("generic-get-"),r=n("variable-get-"),o=n("field-get-"),s={types:"Doc",override:{},init:function(e){e.api._getCache={}}};return["getObject","getBookmark","getDimension","getMeasure","getVariableById"].forEach(function(e){s.override[e]=i}),["getVariable","getVariableByName"].forEach(function(e){s.override[e]=r}),s.override.getField=o,s}),define("core.utils/permissions",[],function(){function e(e,t){return e.length||(e=["update","publish","export","exportdata","changeowner","delete"]),i&&(e=[]),t=t||{},t.update=-1!==e.indexOf("update"),t.publish=-1!==e.indexOf("publish"),t.export=-1!==e.indexOf("export"),t.exportData=-1!==e.indexOf("exportdata"),t.changeOwner=-1!==e.indexOf("changeowner"),t.remove=-1!==e.indexOf("delete"),t}function t(e,t){t=t||{};for(var n in t)delete t[n];return i?t:(e.forEach(function(e){e.canCreate&&(t["create"+e.resource[0].toUpperCase()+e.resource.substring(1)]=!0)}),t)}var n=[{resource:"sheet",canCreate:!0},{resource:"bookmark",canCreate:!0},{resource:"story",canCreate:!0},{resource:"searchhistory",canCreate:!0},{resource:"dimension",canCreate:!0},{resource:"measure",canCreate:!0},{resource:"masterobject",canCreate:!0}],i=!0;return{mapToLayout:function(r,o){var s={};return r.permissions||Object.defineProperty(r,"permissions",{configurable:!1,enumerable:!1,get:function(){return r&&(o&&(i=r.qReadOnly,t(r.create||n,s)),e(r.privileges||r.qMeta&&r.qMeta.privileges||[],s)),s}}),r},parse:e,parseCreate:t}}),define("core.models/mixins/lists/base",["core.utils/permissions"],function(e){"use strict";return{types:"Doc",override:{getContentLibraries:function(e){return e().then(function(e){return e.qItems})},getLibraryContent:function(e,t){return e(t).then(function(e){return e.qItems})}},extend:{getOrCreateSessionObject:function(e){var t=this,n=e.qInfo.qId;return t._listCache[n]||(t._listCache[n]=t.createSessionObject(e)),t._listCache[n]},getListData:function(e){return this.getListObject(e).then(function(e){return e.getLayout()})},getListObject:function(t){var n=this,i=Object.keys(t).filter(function(e){return-1!==e.indexOf("ListDef")})[0];if(!i)throw new Error("Invalid list definition");i&&(i=i.replace(/Def$/g,""));var r=t.qInfo.qId;return n._listCache[r]||n.getOrCreateSessionObject(t).then(function(t){var n=t.getLayout.bind(t);return t.getLayout=function(){return n().then(function(t){return t[i].qItems.forEach(function(t){"object"==typeof t&&e.mapToLayout(t)}),t[i].qItems})},t}),n._listCache[r]}},init:function(e){e.api._listCache={}}}}),define("core.models/mixins/lists/bookmarks",[],function(){"use strict";var e={qInfo:{qId:"BookmarkList",qType:"BookmarkList"},qBookmarkListDef:{qType:"bookmark",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",sheetId:"/sheetId",selectionFields:"/selectionFields",creationDate:"/creationDate"}}};return{types:"Doc",extend:{getBookmarkList:function(){return this.getListData(e)},getBookmarkListObject:function(){return this.getListObject(e)}}}}),define("core.models/mixins/lists/current-selections",[],function(){"use strict";var e={qInfo:{qId:"CurrentSelection",qType:"CurrentSelection"},qSelectionObjectDef:{}};return{types:["Doc"],extend:{getCurrentSelectionObject:function(){return this.getOrCreateSessionObject(e)}}}}),define("core.models/mixins/lists/current-selections-mixins",[],function(){"use strict";function e(e,t,n){return e.getField(t).then(function(e){return e[n]()})}return{types:["CurrentSelection"],extend:{clearField:function(t){return e(this.app,t,"clear")},lockField:function(t){return e(this.app,t,"lock")},unlockField:function(t){return e(this.app,t,"unlock")},clearAll:function(){return this.app.clearAll()},back:function(){return this.app.back()},forward:function(){return this.app.forward()}}}}),define("core.models/mixins/lists/dimensions",[],function(){"use strict";var e={qInfo:{qId:"DimensionList",qType:"DimensionList"},qDimensionListDef:{qType:"dimension",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags",grouping:"/qDim/qGrouping",info:"/qDimInfos",labelExpression:"/qDim/qLabelExpression"}}};return{types:"Doc",extend:{getDimensionList:function(){return this.getListData(e)},getDimensionListObject:function(){return this.getListObject(e)}}}}),define("core.models/mixins/lists/fields",[],function(){"use strict";var e={qInfo:{qId:"FieldList",qType:"FieldList"},qFieldListDef:{qShowSystem:!1,qShowHidden:!1,qShowSrcTables:!0,qShowSemantic:!0,qShowDerivedFields:!0}},t={qInfo:{qId:"FieldOnTheFlyList",qType:"FieldOnTheFlyList"},qFieldListDef:{qShowSystem:!1,qShowHidden:!1,qShowSrcTables:!0,qShowSemantic:!0,qShowDerivedFields:!0,qShowDefinitionOnly:!0}},n={qInfo:{qId:"FieldOnTheFlyWithHiddenList",qType:"FieldOnTheFlyWithHiddenList"},qFieldListDef:{qShowSystem:!1,qShowHidden:!0,qShowSrcTables:!0,qShowSemantic:!0,qShowDerivedFields:!0,qShowDefinitionOnly:!0}};return{types:"Doc",extend:{getFieldList:function(){return this.getListData(e)},getFieldListObject:function(){return this.getListObject(e)},getOnTheFlyListObject:function(){return this.getListObject(t)},getOnTheFlyWithHiddenListObject:function(){return this.getListObject(n)}}}}),define("core.models/mixins/lists/fields-mixins",[],function(){"use strict";return{types:["FieldList"],extend:{expand:function(){return this.getLayout().then(function(e){for(var t=[],n=0;n<e.length;++n){var i=e[n];if(t.push(i),i.qDerivedFieldData)for(var r=0;r<i.qDerivedFieldData.qDerivedFieldLists.length;++r)for(var o=i.qDerivedFieldData.qDerivedFieldLists[r],s=0;s<o.qFieldDefs.length;++s){var a=o.qFieldDefs[s];t.push({qName:a.qName,qSrcTables:i.qSrcTables,qTags:a.qTags,isDerived:!0,sourceField:i.qName,derivedDefinitionName:o.qDerivedDefinitionName})}}return t})}}}}),define("core.models/mixins/lists/master-objects",[],function(){"use strict";var e={qInfo:{qId:"MasterObjectList",qType:"MasterObjectList"},qAppObjectListDef:{qType:"masterobject",qData:{name:"/qMetaDef/title",labelExpression:"/labelExpression",visualization:"/visualization",tags:"/qMetaDef/tags"}}};return{types:"Doc",extend:{getMasterObjectList:function(){return this.getListData(e)},getMasterObjectListObject:function(){return this.getListObject(e)}}}}),define("core.models/mixins/lists/measures",[],function(){"use strict";var e={qInfo:{qId:"MeasureList",qType:"MeasureList"},qMeasureListDef:{qType:"measure",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags",labelExpression:"/qMeasure/qLabelExpression"}}};return{types:"Doc",extend:{getMeasureList:function(){return this.getListData(e)},getMeasureListObject:function(){return this.getListObject(e)}}}}),define("core.models/mixins/lists/odag-app-links",[],function(){"use strict";var e={qInfo:{qId:"ODAGAppLinkList",qType:"ODAGAppLinkList"},qAppObjectListDef:{qType:"odagapplink",qData:{odagLinkRef:"/qMetaDef/odagLinkRef",timestamp:"/qMetaDef/timestamp"}}};return{types:"Doc",extend:{getODAGAppLinkList:function(){return this.getListData(e)},getODAGAppLinkObject:function(){return this.getListObject(e)}}}}),define("core.models/mixins/lists/sheets",[],function(){"use strict";var e={qInfo:{qId:"SheetList",qType:"SheetList"},qAppObjectListDef:{qType:"sheet",qData:{title:"/qMetaDef/title",labelExpression:"/labelExpression",description:"/qMetaDef/description",descriptionExpression:"/descriptionExpression",thumbnail:"/thumbnail",cells:"/cells",rank:"/rank",columns:"/columns",rows:"/rows"}}};return{types:"Doc",extend:{getSheetList:function(){return this.getListData(e)},getSheetListObject:function(){return this.getListObject(e)}}}}),define("core.models/mixins/lists/snapshots",[],function(){"use strict";var e={qInfo:{qId:"SnapshotList",qType:"SnapshotList"},qBookmarkListDef:{qType:"snapshot",qData:{title:"/title",libraryTitle:"/qMetaDef/title",description:"/qMetaDef/description",sourceObjectId:"/sourceObjectId",visualizationType:"/visualizationType",timestamp:"/timestamp",snapshotData:"/snapshotData",isClone:"/isClone"}}};return{types:"Doc",extend:{getSnapshotListObject:function(){return this.getListObject(e)},getSnapshotList:function(){return this.getListData(e)}}}}),define("core.models/mixins/lists/stories",[],function(){"use strict";var e={qInfo:{qId:"StoryList",qType:"StoryList"},qAppObjectListDef:{qType:"story",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",thumbnail:"/thumbnail",rank:"/rank"}}};return{types:"Doc",extend:{getStoryList:function(){return this.getListData(e)},getStoryListObject:function(){return this.getListObject(e)}}}}),define("core.models/mixins/lists/undo-info",[],function(){"use strict";var e={qInfo:{qId:"UndoInfo",qType:"UndoInfo"},qUndoInfoDef:{},markers:[]};return{types:["Doc"],extend:{getUndoInfoObject:function(){return this.getOrCreateSessionObject(e)}}}}),define("core.models/mixins/lists/undo-info-mixins",["core.utils/deferred"],function(e){"use strict";function t(t){var n,i=r[r.length-1];return n=t(i?i:e.resolve()),r.push(n),n}function n(e){s&&(e.markers.length=0,s=!1)}var i=!0,r=[],o=null,s=!1;return{types:["UndoInfo"],extend:{undo:function(){function n(t){return t.then(function(){return o.getLayout().then(function(t){if(t.qUndoInfo.qUndoCount>0)return o.app.undo().then(function(){return o.getLayout().then(function(t){if(!(i=t.markers.length%2==0))return n(e.resolve());r.splice(0,1)})});(i=t.markers.length%2==0)||(s=!0),r.splice(0,1)})})}var o=this;return t(n)},redo:function(){function n(t){return t.then(function(){return o.getLayout().then(function(t){if(t.qUndoInfo.qRedoCount>0)return s=!1,o.app.redo().then(function(){return o.getLayout().then(function(){if(!(i=t.markers.length%2==0))return n(e.resolve());r.splice(0,1)})});r.splice(0,1)})})}var o=this;return t(n)},reset:function(){var e=this;return e.getLayout().then(function(t){if(t.qUndoInfo.qUndoCount||t.qUndoInfo.qRedoCount)return t.markers.length?e.getProperties().then(function(t){return t.markers.length=0,e.setProperties(t).then(function(){return e.app.clearUndoBuffer()})}):e.app.clearUndoBuffer()})},startGroup:function(){var t=this;return t.getLayout().then(function(r){return t.getProperties().then(function(a){return(i=a.markers.length%2==0)||s?(o=Date.now(),n(a),a.markers.push(r.qUndoInfo.qUndoCount+1),t.setProperties(a).then(function(){return e.resolve(o)})):e.resolve(o)})})},endGroup:function(t){if(!t)throw new Error("Must provide groupId to stop group.");var n=this;return n.getLayout().then(function(r){return n.getProperties().then(function(s){return(i=s.markers.length%2==0)||t!==o?e.resolve():(o=null,s.markers.push(r.qUndoInfo.qUndoCount+1),n.setProperties(s))})})}}}}),define("core.models/mixins/lists/variables",[],function(){"use strict";var e={qInfo:{qId:"VariableList",qType:"VariableList"},qVariableListDef:{qType:"variable",qShowReserved:!0,qShowConfig:!0,qData:{tags:"/tags"}}};return{types:"Doc",extend:{getVariableList:function(){return this.getListData(e)},getVariableListObject:function(){return this.getListObject(e)}}}}),define("core.models/mixins/generic/export-data",[],function(){return{types:"GenericObject",override:{exportData:function(e,t,n,i,r){return t=t||"OOXML",n=n||"",i=i||"",r=r||"P",e(t,n,i,r)}}}}),define("core.models/rpc-states",[],function(){return{VALID:1,INVALID:2,VALIDATING:3,CLOSED:5,CLOSING:6,CANCELLED:7}}),define("core.models/mixins/generic/state",["core.utils/notification","core.utils/json-patch","core.models/rpc-states","core.utils/permissions"],function(e,t,n,i){"use strict";return{types:["Doc","GenericObject","GenericDimension","GenericMeasure","GenericBookmark","GenericVariable"],extend:{setState:function(e){var t=this.state;this.state=e,t!==this.state&&(e===n.INVALID?this.Invalidated.emit():e===n.VALID?this.Validated.emit():e===n.VALIDATING?this.Validating.emit():e===n.CLOSED?this.Closed.emit():e===n.CLOSING?this.Closing.emit():e===n.CANCELLED&&this.Cancelled.emit())},markAsInvalid:function(){this.state=-99,this.setState(n.INVALID)},markAsCancelled:function(){this.setState(n.CANCELLED)},clearPending:function(){var e=this;for(var t in e.ongoingRequests)delete e.ongoingRequests[t]}},override:{getLayout:function(e){var i="GetLayout"+this.delta,r=this;if(r.isValid&&r.layout)return r.Promise.resolve(r.layout);if(r.isValidating||r.setState(n.VALIDATING),r.ongoingRequests[i])return r.ongoingRequests[i];var o=e().then(function(e){return r.isValid||t.updateObject(r.layout,e),r.ongoingRequests[i]===o&&(r.setState(n.VALID),delete r.ongoingRequests[i]),r.layout}).catch(function(e){return delete r.ongoingRequests[i],r.Promise.reject(e)});return r.ongoingRequests[i]=o,o},getProperties:function(e){var n="GetPropertiesfalse",i=this;if(i.isValid&&!i.needCacheProperties)return i.Promise.resolve(i.properties);if(i.ongoingRequests[n])return i.ongoingRequests[n];var r=e().then(function(e){var n=t.generate(i._properties,e);return i._properties=e,t.apply(i.properties,n),i.isValid&&(i.needCacheProperties=!1),i.properties});return i.ongoingRequests[n]=r,r.finally(function(){delete i.ongoingRequests[n]}),r},setProperties:function(e,n){var i=this;return e(n).then(function(){t.updateObject(i._properties,i.properties)})}},init:function(t){var r=t.api;e.mixin(r),r.notification("Validated"),r.notification("Invalidated"),r.notification("Validating"),r.notification("Closed"),r.notification("Closing"),r.notification("Cancelled"),r.setState(n.INVALID),r.layout={},r.properties={},r._properties={},r.needCacheProperties=!0,r.ongoingRequests={},i.mapToLayout(r.layout,!!r.getAppLayout),r.on("changed",function(){r.clearPending(),r.needCacheProperties=!0,r.setState(n.INVALID)}),r.on("closed",function(){for(var e in r.ongoingRequests)r.ongoingRequests[e].then&&r.ongoingRequests[e].then(null,function(e){e.isHandled=!0});r.setState(n.CLOSED)}),r.Cancelled.bind(function(){r.clearPending()}),Object.defineProperties(r,{isValid:{get:function(){return this.state===n.VALID}},isValidating:{get:function(){return this.state===n.VALIDATING}},isInvalid:{get:function(){return this.state===n.INVALID}},isClosed:{get:function(){return this.state===n.CLOSED}},isClosing:{get:function(){return this.state===n.CLOSING}},isCancelled:{get:function(){return this.state===n.CANCELLED}}})}}}),define("objects.utils/snapshot-utils",[],function(){return{isSnapshotData:function(e){return e&&!!e.sourceObjectId}}}),define("core.models/mixins/generic/migration",["objects.utils/snapshot-utils"],function(e){"use strict";function t(t,n){var i=e.isSnapshotData(n)?t.migrate.snapshot:t.migrate.properties;if("function"!=typeof i)throw new Error("migration function not a function: expected function, got "+typeof i);return i(n)}return{types:["Doc","GenericObject","GenericDimension","GenericMeasure","GenericBookmark","GenericVariable"],extend:{migrate:{properties:function(e){return e},snapshot:function(e){return e}}},override:{getProperties:function(e){var n=this;return e().then(function(e){return t(n,e)})},setProperties:function(e,n){return e(t(this,n))}}}}),define("core.models/mixins/generic/layout-observable",[],function(){"use strict";function e(e){this.getLayout=function(e){this.requestPromise=e.getLayout().then(function(t){this.requestPromise=null,e.isCancelled||this.fn(t)}.bind(this))}.bind(this,e),this.onInvalidated=function(){this.getLayout()}.bind(this),this.api=e,this.fn=null}return e.prototype.subscribe=function(e){if("function"!=typeof e)throw new Error("Observer must be a function");"function"!=typeof this.fn&&(this.fn=e,this.api.Invalidated.bind(this.onInvalidated),this.getLayout())},e.prototype.dispose=function(){this.api.Invalidated.unbind(this.onInvalidated)},e.prototype.cancel=function(){return!!this.requestPromise&&(this.api.app.global.cancelRequest(this.requestPromise.requestId),this.api.markAsCancelled(),this.requestPromise=null,!0)},e.prototype.retry=function(){this.api.isCancelled&&this.getLayout()},{types:["Doc","GenericObject","GenericDimension","GenericMeasure","GenericBookmark","GenericVariable"],extend:{layoutSubscribe:function(t){var n=new e(this);return n.subscribe(t),n}}}}),define("core.models/mixins/generic/effective-properties",["core.utils/json-patch"],function(e){return{types:["GenericObject"],override:{getEffectiveProperties:function(t){var n=this;return t().then(function(t){return n.effectiveProperties=n.effectiveProperties||t,e.updateObject(n.effectiveProperties,t),n.effectiveProperties})}}}}),define("core.models/mixins/client/create-client-objects",["util"],function(e){"use strict";return{types:"Doc",override:{createBookmark:function(t,n){return t(e.extend(!0,{},{qInfo:{qType:"bookmark"},qMetaDef:{title:"",description:""},creationDate:(new Date).toISOString()},n))}},extend:{createSheet:function(e){return this.createObject({qInfo:{qType:"sheet"},qMetaDef:{title:e.title||"",description:e.description||""},rank:void 0!==typeof e.rank?e.rank:-1,thumbnail:{qStaticContentUrlDef:e.thumbnail||null},columns:24,rows:12,cells:[],qChildListDef:{qData:{title:"/title"}}})},createStory:function(e){return this.createObject({qInfo:{qType:"story"},qMetaDef:{title:e.title||"",description:""},rank:void 0!==typeof e.rank?e.rank:-1,thumbnail:{qStaticContentUrlDef:e.thumbnail||null},qChildListDef:{qData:{title:"/title",rank:"/rank"}}})},createMasterObject:function(e){return e=e||{},this.createObject({qInfo:{qType:"masterobject"},qMetaDef:{title:e.title||"",description:e.description||"",tags:e.tags||""}})}}}}),define("core.models/mixins/client/publishing",["core.utils/authentication","core.utils/deferred"],function(e,t){var n,i;return e.onDataReceived.then(function(e){"NONE"!==e.userDirectory&&(n=e.userId,i=e.userDirectory)}),{types:["GenericObject"],override:{publish:function(e){return this.getLayout().then(function(n){return n.permissions.publish?e():t.reject("Permission denied")})},unPublish:function(e){return this.getLayout().then(function(r){var o=r.qMeta,s=o.published&&!o.approved,a=o.owner.userId===n&&o.owner.userDirectory===i;return s&&a?e():t.reject("Permission denied")})}}}}),define("core.utils/sheet-utils",["util"],function(e){return{objIndex:function(e,t){var n,i;for(n=0;n<e.cells.length;++n)if((i=e.cells[n]).col===t.col&&i.row===t.row)return n;return-1},getObject:function(e,t,n){var i=this.objIndex(e,t);if(-1===i){if(n)return null;throw new Error("invalid pos")}return e.cells[i]},moveObject:function(e,t){e.col=t.col,e.row=t.row,e.colspan=t.colspan,e.rowspan=t.rowspan},setObject:function(e,t,n,i){var r=this.getObject(e,t,!0),o=r?r.name:null;return r?(r.name=n,r.type=i):e.cells.push({name:n,type:i,col:t.col,row:t.row,colspan:t.colspan,rowspan:t.rowspan}),o},splitPos:function(e,t){var n={col:e.col,row:e.row,colspan:e.colspan,rowspan:e.rowspan},i={col:e.col,row:e.row,colspan:e.colspan,rowspan:e.rowspan};if("left"===t||"right"===t){var r=Math.ceil(e.colspan/2);n.colspan-=r,i.col+=e.colspan-r,i.colspan=r}if("top"===t||"bottom"===t){var o=Math.ceil(e.rowspan/2);n.rowspan-=o,i.row+=e.rowspan-o,i.rowspan=o}if("top"===t||"left"===t){var s=n;n=i,i=s}return{pos1:n,pos2:i}},splitCell:function(e,t,n){var i=this.getObject(e,t,!1);if(!i||i.colspan!==t.colspan||i.rowspan!==t.rowspan)return!1;var r=this.splitPos(i,n);return this.moveObject(i,r.pos1),r.pos2},findCellForId:function(e,t){return t.filter(function(t){return t.name===e})[0]},addChildrenToObject:function(t,n){for(var i=0;i<n.length;i++){var r=n[i];r.qInfo.qId=e.generateId(),t.qChildren.push({qChildren:[],qProperty:r})}}}}),define("core.models/mixins/client/sheet-grid",["util","core.utils/sheet-utils","core.utils/deferred","general.utils/visualizations"],function(e,t,n,i){"use strict";return{types:"sheet",extend:{edit:function(e){var t=this;return t.getProperties().then(function(n){return e(n),t.setProperties(n)})},getObject:function(e,n){return this.getLayout().then(function(i){return t.getObject(i,e,n)})},moveObject:function(e,i){return this.edit(function(r){var o=t.getObject(r,e);if(i.split&&!(i=t.splitCell(r,i.pos,i.split)))return n.reject();t.moveObject(o,i)})},swapObjects:function(e,n){return this.edit(function(i){var r=t.getObject(i,e),o=t.getObject(i,n,!0);t.moveObject(r,n),o&&t.moveObject(o,e)})},addObject:function(r){var o,s=this,a=r.template,l=r.cell.pos,c=i.getType(a),u=r.init,h=r.children||[];return o=u.qExtendsId?n.resolve(e.extend({qInfo:{qType:a}},u)):c.getInitialProperties(u),n.all({initProps:o,props:s.getFullPropertyTree()}).then(function(i){var r=i.initProps,o=i.props;if(l.split&&!(l=t.splitCell(o.qProperty,l.pos,l.split)))return n.reject();r.qInfo.qId=e.generateId();var a=t.setObject(o.qProperty,l,r.qInfo.qId,r.qInfo.qType),c=!1;if(a)for(var u=0;u<o.qChildren.length;u++)if(o.qChildren[u].qProperty.qInfo.qId===a){o.qChildren[u].qProperty=r,o.qChildren[u].qChildren=[],t.addChildrenToObject(o.qChildren[u],h),c=!0;break}if(!c){var d=o.qChildren.push({qChildren:[],qProperty:r});t.addChildrenToObject(o.qChildren[d-1],h)}return s.setFullPropertyTree(o)})},getObjectById:function(e){var t,n,i=this.layout.cells;for(t=0;t<i.length;++t)if(n=i[t],e===n.name)return n;return null},removeObject:function(e){var n=this;return n.getFullPropertyTree().then(function(i){var r=t.objIndex(i.qProperty,e),o=i.qProperty.cells[r].name;if(-1===r)throw new Error("invalid pos");i.qProperty.cells.splice(r,1);for(var s=0;s<i.qChildren.length;s++)if(i.qChildren[s].qProperty.qInfo.qId===o){i.qChildren.splice(s,1);break}return n.setFullPropertyTree(i)})},setCloneChildrenInfos:function(e){var i=this;return n.all([i.getChildInfos(),e.getChildInfos(),e.getProperties()]).then(function(n){var i=n[0],r=n[1],o=n[2];return i.forEach(function(e,n){var i=t.findCellForId(e.qId,o.cells);i&&(i.name=r[n].qId)}),e.setProperties(o).then(function(){return e})})},clone:function(){var e=this;return e.app.cloneObject(this.id).then(function(t){return e.app.getObject(t)}).then(function(t){return e.setCloneChildrenInfos(t)})},draft:function(e){var t=this;return e.rpc("CreateDraft","qDraftId",[this.id]).then(function(n){return e.getObject(n).then(function(e){return t.setCloneChildrenInfos(e)})})}}}}),define("general.utils/name-generator",["util"],function(e){"use strict";var t={};return t.nextIndex=function(t,n){var i,r=1;return i=""===n?new RegExp("^\\((\\d+)\\)$"):new RegExp("^"+e.escapeRegExp(n)+" \\((\\d+)\\)$"),t.forEach(function(e){var t=i.exec(e);if(t&&2===t.length){var n=parseInt(t[1],10);r=Math.max(n+1,r)}}),r},t.generateUniqueName=function(e,n){var i=t.nextIndex(e,n);return""===n?"("+i+")":n+" ("+i+")"},t}),define("general.utils/string-limits",[],function(){"use strict";var e={};return Object.defineProperties(e,{name:{value:255,writable:!1},description:{value:512,writable:!1},expression:{value:8192,writable:!1},script:{value:5e4,writable:!1},textImage:{value:12e3,writable:!1}}),e}),define("core.models/mixins/client/sheet-navpoints",["util","general.utils/name-generator","general.utils/string-limits"],function(e,t,n){"use strict";return{types:"sheet",extend:{removeNavPoint:function(e){var t=this;return this.getProperties().then(function(n){if(n.navPoints){for(var i=0;i<n.navPoints.length;i++)if(n.navPoints[i].info.id===e){n.navPoints.splice(i,1);break}return t.setProperties(n)}})},addNavPoint:function(i){var r={info:{type:"odagNavPoint"},title:"",odagLinkRefID:""};(r=e.extend(r,i.data)).info.id||(r.info.id=e.generateId());var o=this;return this.getProperties().then(function(s){s.navPoints||(s.navPoints=[]);var a=s.navPoints.map(function(e){return e.title});if(a.indexOf(r.title)>-1){var l=t.generateUniqueName(a,r.title);l=e.crop(l,n.name),r.title=l}var c=!1;if(i.insertBeforeNavPointID)for(var u=0;u<s.navPoints.length;u++)if(s.navPoints[u].info.id===i.insertBeforeNavPointID){s.navPoints.splice(u,0,r),c=!0;break}return c||s.navPoints.push(r),o.setProperties(s)})},getNavPoints:function(){return this.getProperties().then(function(e){return e.navPoints?e.navPoints:[]})},reorderNavPoints:function(e){var t=this;return this.getProperties().then(function(n){return n.navPoints=e,t.setProperties(n)})},moveNavPoint:function(e,t){var n=this;return this.getProperties().then(function(i){if(e){var r=null,o=null;t||(o=i.navPoints.length-1);for(var s=0;s<i.navPoints.length;s++){var a=i.navPoints[s];if(a.info.id===e?r=s:t&&a.info.id===t&&(o=s),null!==r&&null!==o)break}return r<o&&t&&o--,null!==r&&null!==o&&i.navPoints.splice(o,0,i.navPoints.splice(r,1)[0]),n.setProperties(i)}})},removeRefToLinkIDFromNavPoints:function(e){var t=this;return this.getProperties().then(function(n){for(var i=n.navPoints?n.navPoints:[],r=0;r<i.length;r++){var o=n.navPoints[r];o.odagLinkRefID===e&&(o.odagLinkRefID="")}return t.setProperties(n)})}}}}),define("core.models/mixins/client/slide",[],function(){function e(e){return Array.isArray(e)&&e.length>0?e.sort(function(e,t){return e.qData.rank<t.qData.rank?-1:e.qData.rank>t.qData.rank?1:0}):e}return{types:"slide",extend:{duplicate:function(t){var n,i=this;return t.getLayout().then(function(r){for(var o=e(r.qChildList.qItems.slice()),s=0;s<o.length;s++)if(o[s].qInfo.qId===i.id){var a=o[s],l=o[s+1];(l||a)&&(n=l&&!a?l.qData.rank-1:!l&&a?a.qData.rank+1:(a.qData.rank+l.qData.rank)/2)}return t.createSlide({rank:n}).then(function(e){return e.copyFrom(i.id).then(function(){return e.getProperties().then(function(t){return t.rank=n,e.setProperties(t)})})})})}}}}),define("core.models/mixins/client/story",["util"],function(e){return{types:"story",extend:{clone:function(){var e=this;return e.app.cloneObject(this.id).then(function(t){return e.app.getObject(t)})},createSlide:function(t){return this.createChild(e.extend(!0,{qInfo:{qId:e.generateId(),qType:"slide"},rank:-1,qChildListDef:{qData:{title:"/title",sheetId:"/sheetId",ratio:"/ratio",position:"/position",dataPath:"/dataPath",srcPath:"/srcPath",visualization:"/visualization",visualizationType:"/visualizationType",style:"/style"}}},t))}}}}),define("core.models/mixins/all",["core.models/mixins/base","core.models/mixins/doc/normalize","core.models/mixins/doc/modal","core.models/mixins/doc/get-object-cache","core.models/mixins/lists/base","core.models/mixins/lists/bookmarks","core.models/mixins/lists/current-selections","core.models/mixins/lists/current-selections-mixins","core.models/mixins/lists/dimensions","core.models/mixins/lists/fields","core.models/mixins/lists/fields-mixins","core.models/mixins/lists/master-objects","core.models/mixins/lists/measures","core.models/mixins/lists/odag-app-links","core.models/mixins/lists/sheets","core.models/mixins/lists/snapshots","core.models/mixins/lists/stories","core.models/mixins/lists/undo-info","core.models/mixins/lists/undo-info-mixins","core.models/mixins/lists/variables","core.models/mixins/generic/export-data","core.models/mixins/generic/state","core.models/mixins/generic/migration","core.models/mixins/generic/layout-observable","core.models/mixins/generic/effective-properties","core.models/mixins/client/create-client-objects","core.models/mixins/client/publishing","core.models/mixins/client/sheet-grid","core.models/mixins/client/sheet-navpoints","core.models/mixins/client/slide","core.models/mixins/client/story"],function(){"use strict";return Array.prototype.slice.call(arguments)}),define("core.models/communication",["qvangular","core.utils/authentication","core.utils/deferred","general.controllers/error-handler-controller","general.controllers/warning-handler-controller","enigma","enigma-sense-utilities","autogenerated/qix/engine-api","autogenerated/qix/engine-enums","util","translator","core.models/mixins/all"],function(e,t,n,i,r,o,s,a,l,c,u,h){"use strict";function d(t,n,r,o){t.code!==l.LocalizedErrorCode.LOCERR_GENERIC_ABORTED&&e.getService("$timeout")(function(){t.isHandled||(t.isHandled=!0,o&&o.hasHandlers("closed")&&"closed"===o.originalEvent?o.emit("closed",t):o&&o.hasHandlers("error")&&"closed"!==o.originalEvent?o.emit("error",t):r?r():n?n(t):i.showDialog(t))},1e3)}function p(e,t,n){var i=[];if(e.warnings&&(1!==e.warnings.length||e.warnings[0]!==l.LocalizedWarningCode.LOCWARN_EXPORT_DATA_TRUNCATED)){for(var o=0;o<e.warnings.length;o++)i.push({code:e.warnings[o]});n&&n.hasHandlers("warning")?n.emit("warning",e):t?t(e):r.showDialog(i)}}function f(e,t,i){var r=t.handle?e.apis.getApi(t.handle):void 0;return r&&!r.isCancelled&&i.code===l.LocalizedErrorCode.LOCERR_GENERIC_ABORTED&&C.indexOf(t.method)>-1?(i.isHandled=!0,t.retry()):n.reject(i)}function m(e,t,i){return i.code===a.enums.LocalizedErrorCode.LOCERR_HC_MODAL_OBJECT_ERROR?(i.isHandled=!0,e.app.abortModalSelection().then(function(){return t.retry()})):n.reject(i)}function g(e){if(void 0===e&&(e={}),void 0===e.urlParams&&(e.urlParams={}),e.ttl=parseFloat(c.getParameterByName("ttl")),isNaN(e.ttl)||(e.suspendOnClose=!0),"string"!=typeof e.host&&(e.host=c.hostname),"string"!=typeof e.port&&(e.port=c.port||void 0),"string"!=typeof e.prefix&&(e.prefix="/"===c.basePath?"":c.basePath),"boolean"!=typeof e.isSecure?e.secure=c.isSecure:e.secure=e.isSecure,"string"!=typeof e.reloadURI?e.urlParams.reloadUri=c.reloadURI:e.urlParams.reloadUri=e.reloadURI,void 0===e.identity){var t=c.getParameterByName("identity");t&&(e.identity=t)}return"/"===e.prefix&&(e.prefix=""),e}function v(r,s){var c=_[r];if(!c){var g=s.responseInterceptors?s.responseInterceptors:[];(c=o.create({Promise:e.getService("$q"),schema:a,mixins:h,url:r,suspendOnClose:s.suspendOnClose,createSocket:function(e){return new WebSocket(e)},requestInterceptors:[{onFulfilled:function(e,t){return-1!==S.indexOf(t.method)&&(t.return_empty=!0,t.delta=!1),t}}],responseInterceptors:g.concat([{onRejected:f},{onRejected:m},{onRejected:function(e,t,i){return s.qEvent&&(s.qEvent.originalEvent="error"),d(i,s.onError,void 0,s.qEvent),n.reject(i)}}])})).sessionConfig=s,c.on("notification:*",function(e,n){function r(e){s.qEvent&&s.qEvent.hasHandlers("error")?(s.qEvent.originalEvent="ProxyError",s.qEvent.emit("error",e)):s.onError&&s.onError(e)}var o=-1!==x.indexOf(e),a=-1!==q.indexOf(e);"OnAuthenticationInformation"===e&&t.parse(n),"fatal"===n.severity&&(o?u.ready.then(function(){r({method:e,message:u.get("ProxyError."+e)})}):r({method:e,message:n.message?n.message:n})),a&&(w?w():o=!0),o&&i.showDialog({message:"ProxyError."+e,refreshButton:!0})}),c.on("traffic:received",function(e){s.qEvent&&(s.qEvent.originalEvent="traffic:received"),p(e,s.onWarning,s.qEvent)}),c.on("closed",function(){s.qEvent&&(s.qEvent.originalEvent="closed"),u.ready.then(function(){d({code:l.LocalizedErrorCode.LOCERR_GENERIC_CONNECTION_LOST,message:u.get("ErrorCode."+l.LocalizedErrorCode.LOCERR_GENERIC_CONNECTION_LOST)},s.onError,s.onClose,s.qEvent)}),delete _[r]}),_[r]=c}return c}function y(e,t,n){e=e||"",t.appId=e;var i=v(s.buildUrl(t),t);return i.open().then(function(t){return e?(i.openDocPromise||(i.openDocPromise=t.openDoc(e,"","","",!!n).then(function(e){return e.global=t,e})),i.openDocPromise):{global:t}}).catch(function(e){throw e.srcElement instanceof WebSocket&&(e={message:"ErrorDialog.NoConnectionCreated"},t.qEvent&&(t.qEvent.originalEvent="error"),d(e,t.onError,void 0,t.qEvent)),e})}function b(e,t){return y(e=e||c.getParameterByName("app")||"?transient=",t=g(t),"true"===c.getParameterByName("noData"))}var x=["OnLicenseAccessDenied","OnLicenseAccessDeniedPendingUserSync","OnNoAppFound","OnEngineWebsocketFailed","OnNoEngineAvailable","OnNoDataPrepServiceAvailable","OnDataPrepServiceWebsocketFailed"],q=["OnSessionLoggedOut","OnSessionTimedOut","OnSessionClosed"],C=["GetObject","GetLayout","GetAppLayout","GetProperties","GetAppProperties","GetEffectiveProperties","GetFullPropertyTree","GetDimension","GetMeasure","GetVariableById","GetVariableByName","GetBookmark","GetScriptEx"],S=["GetProperties","GetFullPropertyTree"],w=void 0,_={};return{get:function(e,t){return t=g(t),e?this.getApp(e,t):this.getGlobal(t)},getApp:function(e,t){return b(e,t)},getSessionApp:function(e,t){return this.getGlobal(t).then(function(i){return(e&&"?transient="!==e?i.createSessionAppFromApp(e):i.createSessionApp()).then(function(e){return{global:i,app:e}}).catch(function(e){return e.code===l.LocalizedErrorCode.LOCERR_APP_ALREADY_OPEN?(e.isHandled=!0,i.getActiveDoc()):(t.qEvent&&(t.qEvent.originalEvent="error"),d(e,t.onError,void 0,t.qEvent),n.reject(e))})})},getGlobal:function(e){return e=g(e),y(void 0,e).then(function(e){return e.global})},setLogoutHandler:function(e){w=e},_unsupported_clearSessions:function(){_={}}}}),define("core.utils/feature-flags",["util"],function(e){var t={SMARTSEARCH_OBJECTS:!0,SMARTSEARCH_INDEX_CLOSE:!0,QDM_MULTITABLE:!0,CARDS:!1,SEARCH_HISTORY:!0,GENERIC_SELECT_FILTER_TABLE:!0,MONKEY:!1,DESKTOP_AUTHENTICATION:!1,THEMING:!0,THEMING_QMC:!0,CUSTOM_COMPONENTS:!0,COLOR_PICKER_NEW:!0,BOX_MEASURE_RANGE:!1,LABEL_EXPR:!0,MAP_MEASURE_LABEL:!1,MES_COL:!1,BUBBLE_DIST:!0,DIST_2MES:!1,ODAG_MASHUP:!0,COLOR_BY_DIM:!0,COLOR_BY_MEA:!1,LIBRARY_DATA_BUTTONS:!0,SHEET_NAME_EXPR:!0,COMBO_VALUE_LABELS:!0,DIST_JITTER:!0,ST_HSCROLL:!0,LIGHT_CUR_SEL:!1,GEO_MAPCHART:!1,GEO_MIGRATE:!0,GEO_LINELAYER:!1,DM_GOOD_DEFAULTS:!0,DESCRIPTION_EXPR:!0,DATA_REORDER:!1,GRID_SIZE:!0,EDIT_MASTER_VIS:!0};return(e.getParameterByName("feature")||"").split("+").forEach(function(e){e&&(t[e.toUpperCase()]=!0)}),t}),define("assets/hldm/services/data-manager-local-storage-service",["qvangular","underscore","core.utils/feature-flags"],function(e,t,n){function i(e){if(!n.DISABLE_DM_LOCAL_STORAGE&&s()){var t=this.storage=new r(localStorage,!0);e(function(){a(t)})}else this.storage=new r({},!1)}function r(e,t){this.storage=e,this.supportsLocalStorage=t}function o(e){return u+"."+e}function s(){try{return localStorage.setItem(u,u),localStorage.removeItem(u),!0}catch(e){return!1}}function a(e){var n=u+".",i=(new Date).getTime();e.keys().forEach(function(r){if(0===r.lastIndexOf(n,0)){var o=c(e.get(r));o&&o.created&&t.isNumber(o.created)&&i-o.created>h&&e.remove(r)}})}function l(e){return JSON.stringify(e)}function c(e){if(e)try{return JSON.parse(e)}catch(e){return}}var u="DataManager",h=2592e6;i.prototype.get=function(e){var t=c(this.storage.get(o(e)));return t?t.value:void 0},i.prototype.set=function(e,t){var n=l({created:(new Date).getTime(),version:1,value:t});this.storage.set(o(e),n)},i.prototype.remove=function(e){this.storage.remove(o(e))},r.prototype.get=function(e){return this.supportsLocalStorage?this.storage.getItem(e):this.storage[e]},r.prototype.set=function(e,t){this.supportsLocalStorage?this.storage.setItem(e,t):this.storage[e]=t},r.prototype.remove=function(e){this.supportsLocalStorage?this.storage.removeItem(e):delete this.storage[e]},r.prototype.keys=function(){var e,t=[];if(this.supportsLocalStorage)for(var n=0;n<this.storage.length;n++)e=this.storage.key(n),t.push(e);else for(e in this.storage)t.push(e);return t},e.service("qvDataManagerLocalStorageService",["$timeout",function(e){return new i(e)}])}),define("assets/hldm/services/data-manager-app-storage-service",["qvangular","core.models/communication","assets/hldm/services/data-manager-local-storage-service"],function(e,t){function n(e){return t.getApp().then(function(t){return t.id+"."+e})}function i(e){this.localStorageService=e}i.prototype.get=function(e){var t=this;return n(e).then(function(e){return t.localStorageService.get(e)})},i.prototype.set=function(e,t){var i=this;return n(e).then(function(e){i.localStorageService.set(e,t)})},i.prototype.remove=function(e){var t=this;return n(e).then(function(e){t.localStorageService.remove(e)})},e.service("qvDataManagerAppStorageService",["qvDataManagerLocalStorageService",function(e){return new i(e)}])}),define("assets/hldm/views/data-manager/data-manager-performance-debug/data-manager-performance-debug-global-defaults",["qvangular","assets/hldm/services/data-manager-app-storage-service"],function(e){var t=function(){this.globalDefaults={enableQVDCaching:!0}};return t.prototype.get=function(){var t=this;return e.getService("qvDataManagerAppStorageService").get("globalDefaults").then(function(e){return e||t.set().then(function(){return t.globalDefaults})})},t.prototype.set=function(t){return e.getService("qvDataManagerAppStorageService").set("globalDefaults",t||this.globalDefaults)},t}),define("assets/hldm/Constants",[],function(){return{Visualization:{ChartTypes:{Custom:"custom",Kpi:"kpi",Gauge:"gauge",BarChart:"barchart",ValueRange:"ValueRange",Table:"table",Mapping:"Mapping"},CustomVisualizations:{CountFact:"countFact",Ordinal:"Ordinal",NullFacts:"nullFacts",RangeFacts:"rangeFacts",UniValueFrequency:"uniValueFrequency",DTypeFacts:"dTypeFacts",ValueFrequency:"valueFrequency",TemporalFacts:"temporalFacts",MixedTypeValues:"mixedTypeValues"},Actions:{Bucketing:"bucket",Ordinal:"ordinal",SplitValuesDef:"splitValuesDef",SplitValues:"splitValues",SplitEmail:"splitEmail",SplitAddress:"splitAddress",SplitField:"splitField",MapValues:"mapValues",MixedTypeValues:"mixedTypeValues",RenameMapping:"rename",MapNulls:"mapNulls",MappingLimit:99},Size:{Auto:"auto",Small:"small",Medium:"medium",Large:"large"},Layout:{Cellspan:{Small:1,Medium:2,Large:3}},ValueRangeDisplayModes:{Text:"text",RangeLine:"rangeLine"}},Events:{Associations:{ApplyRecommendation:"ApplyRecommendation",ToggleAssociationsRecommendationsPanel:"ToggleAssociationsRecommendationsPanel",UpdateAssociationsRecommendationsToolbarButtonState:"UpdateAssociationsRecommendationsToolbarButtonState"},TablePreview:{UpdateTablePreview:"UpdateTablePreview"},SplitAction:{Reset:"SpitActionReset",Validate:"SpitActionValidate"},EditorDetailsPane:{CardsResize:"cardsResize",ResizeChart:"resizeChart",BucketingChange:"bucketingChange",OrderingChange:"orderingChange",FieldCreated:"fieldCreated",MappingCreated:"MappingCreated",MappingReset:"MappingReset",DisableMappingActionButtons:"DisableMappingActionButtons"},PubSub:{ForceReloadComplete:"/datamanager/forcereloadcomplete",StartSpinInvalidation:"/spin/start/invalidation",StopSpinInvalidation:"/spin/stop/invalidation",StartSpin:"/spin/start",StopSpin:"/spin/stop",ConnectionDeleted:"/connection/deleted",ConnectionCreated:"/connection/created",AppDetailsViewChange:"/datamanager/appdetailsviewchange"}},KeyCodes:{Enter:13,Esc:27},AddData:{Folder:"folder",InlineData:"inlinedata"}}}),define("assets/load-model/referencable",["require","exports","underscore"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e){n.isString(e)&&(this.id=e)}}();t.Referencable=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("assets/load-model/calendar",["require","exports","./referencable"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,n){var i=e.call(this,n)||this;return i.name=t,i}return __extends(t,e),t.GetDefaultCalendarModel=function(){var e={calendarModel:{locale:"en-US",defaultCalendar:{id:"autoCalendar",name:"autoCalendar",translation:"",appliedToTags:["$date"],params:{},derivedFields:[{id:"Decade",name:"Decade",translation:"",definition:"Dual(Div(Year($1),10)*10, MakeDate(Div(Year($1),10)*10, 1, 1))",tags:["$axis","$decade"],selected:!1},{id:"Year",name:"Year",translation:"scripteditor.autoCalendarYear",definition:"Dual(Year($1), YearStart($1))",tags:["$axis","$year"],selected:!0},{id:"Quarter",name:"Quarter",translation:"scripteditor.autoCalendarQuarter",definition:"Dual('Q'&Num(Ceil(Num(Month($1))/3)),Num(Ceil(NUM(Month($1))/3),00))",tags:["$quarter","$cyclic"],selected:!0},{id:"YearQuarter",name:"YearQuarter",translation:"scripteditor.autoCalendarQuarterYear",definition:"Dual(Year($1)&'-Q'&Num(Ceil(Num(Month($1))/3)),QuarterStart($1))",tags:["$yearquarter","$qualified"],selected:!0},{id:"_YearQuarter",name:"_YearQuarter",translation:"scripteditor.autoCalendarQuarterYear",definition:"Dual('Q'&Num(Ceil(Num(Month($1))/3)),QuarterStart($1))",tags:["$yearquarter","$hidden","$simplified"],selected:!0},{id:"Month",name:"Month",translation:"scripteditor.autoCalendarMonth",definition:"Month($1)",tags:["$month","$cyclic"],selected:!0},{id:"YearMonth",name:"YearMonth",translation:"scripteditor.autoCalendarMonthYear",definition:"Dual(Year($1)&'-'&Month($1), monthstart($1))",tags:["$axis","$yearmonth","$qualified"],selected:!0},{id:"_YearMonth",name:"_YearMonth",translation:"scripteditor.autoCalendarMonthYear",definition:"Dual(Month($1), monthstart($1))",tags:["$axis","$yearmonth","$simplified","$hidden"],selected:!0},{id:"Week",name:"Week",translation:"scripteditor.autoCalendarWeek",definition:"Dual('W'&Num(Week($1),00), Num(Week($1),00))",tags:["$weeknumber","$cyclic"],selected:!0},{id:"YearWeek",name:"YearWeek",translation:"",definition:"Dual(Year($1)&'-W'&num(Week($1),00), weekstart($1))",tags:["$yearweek"],selected:!1},{id:"WeekDay",name:"WeekDay",translation:"",definition:"Dual(WeekDay($1),num(WeekDay($1)))",tags:["$weekday"],selected:!1},{id:"Date",name:"Date",translation:"scripteditor.autoCalendarDate",definition:"Date(Floor($1))",tags:["$axis","$date","$qualified"],selected:!0},{id:"_Date",name:"_Date",translation:"scripteditor.autoCalendarDate",definition:"Date(Floor($1), 'D')",tags:["$axis","$date","$hidden","$simplified"],selected:!0}],groups:[{name:"YearMonthDay",drillDown:"true",fieldRefs:["Year","Month","WeekDay"]},{name:"YearMonth",drillDown:"false",fieldRefs:["Year","Month"]}],deriveFieldsType:"fieldExplicit"}}},n=new t("autoCalendar","autoCalendar"),i=e.calendarModel.defaultCalendar;return n.appliedToTags=i.appliedToTags,n.derivedFields=i.derivedFields,n.groups=i.groups,n.deriveFieldsType=i.deriveFieldsType,{calendar:n,locale:e.calendarModel.locale}},t}(n.Referencable);t.Calendar=i}),define("assets/load-model/dsm-types",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.GetFields=function(){return[e.QueryField.name,e.QueryExpressionField.name,e.QueryTransformField.name]},e}();n.QueryStatus={delete:"Delete",update:"Update",add:"Add",inSynchWithMaster:""},n.QueryField={name:"QueryField"},n.Query={name:"Query",prefix:"query"},n.ConcatenationQuery={name:"ConcatenationQuery",prefix:"concatquery"},n.ForcedConcatenationQuery={name:"ForcedConcatenationQuery"},n.CompositeQueryField={name:"CompositeQueryField"},n.CrossTableQuery={name:"CrossTableQuery"},n.DataSourceDescriptor={name:"DataSourceDescriptor",prefix:"dsd"},n.QueryExpressionField={name:"QueryExpressionField"},n.QueryTransformField={name:"QueryTransformField"},n.Transformations={geoPoint:"makeGeoPoint",lookupGeoInfo:"lookupGeoInfo",interpretValues:"interpretValues",defineOrder:"defineOrder",fieldSplit:"fieldSplit",mapValues:"mapValues",bucketed:"bucketed"},t.DSMTypes=n}),define("assets/load-model/load-model-ids",["require","exports","./dsm-types"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.generateUUID=function(){var e=(new Date).getTime();return"window"in this&&window.performance&&"function"==typeof window.performance.now&&(e+=window.performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)})},e.createTableId=function(t){return n.DSMTypes.DataSourceDescriptor.prefix+"."+e.cleanNameForId(t)},e.createFieldId=function(t,n){return t+"."+e.cleanNameForId(n)},e.createSimpleQueryId=function(){return e.generateUUID()},e.createConcatQueryId=function(){return e.generateUUID()},e.createQueryFieldId=function(){return e.generateUUID()},e.cleanNameForId=function(e){return e.replace(/[\.]/g,"..")},e}();t.LoadModelIds=i}),define("assets/load-model/invalid-load-model-exception",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(e){this.name="InvalidLoadModel",this.message=e}}();t.InvalidLoadModelException=n}),define("assets/load-model/shared-util",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.extend=function(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return e.internalExtend.apply(e,arguments)},e.each=function(t,n){return e.internalEach.apply(e,arguments)},e.internalExtend=function(t,n){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];for(var o=0;o<i.length;o++){var s=i[o];for(var a in s){var l=s[a],c=n[a];if(l!==c)if(t&&l&&"object"==typeof l){var u=void 0;u=l instanceof Array?c&&c instanceof Array?c:[]:c&&"object"==typeof c?c:{},n[a]=e.internalExtend(t,u,l)}else n[a]=l}}return n},e.internalEach=function(e,t){if(e instanceof Array)for(var n=0;n<e.length&&!1!==t.call(e[n],n,e[n]);n++);else for(var i in e)if(!1===t.call(e[i],i,e[i]))break;return e},e}();t.SharedUtil=n}),define("assets/load-model/load-model-utils",["require","exports","underscore","./dsm-types","./invalid-load-model-exception"],function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.targetTable=e}return e.isInlineTransformation=function(e){return["ignoreValues","defineOrder","mapValues","interpretValues"].indexOf(e)>=0},e.isNewFieldTransformation=function(e){return["lookupGeoInfo","bucketed","makeGeoPoint","fieldSplit"].indexOf(e)>=0},e.prototype.findFieldsWithRecommendedTransformation=function(e){return n.filter(this.targetTable.getFields(),function(t){return t.type===i.DSMTypes.QueryField.name&&void 0!==t.transformations&&void 0!==n.findWhere(t.transformations,{op:e})})},e.prototype.findFieldsWithRecommendedCountryLookupTR=function(){var e=this.findFieldsWithRecommendedTransformation(i.DSMTypes.Transformations.lookupGeoInfo);return e=n.filter(e,function(e){var t=n.findWhere(e.transformations,{op:"lookupGeoInfo"});return["countryCodeISO3","countryCodeISO2","countryAlias"].indexOf(t.arguments.geoType)>=0})},e.prototype.findCorrespondingTransformedField=function(e,t){return n.find(this.targetTable.getFields(),function(r){return r.type===i.DSMTypes.QueryTransformField.name&&void 0!==r.transformations&&void 0!==n.findWhere(r.transformations,{op:t,appliedTo:e})})},e.prototype.canBeBasedOn=function(t,n,i){var r=!!i&&e.isInlineTransformation(i);if(t===n&&!r)return!1;var o=[];return this.collectBasedOns(this.targetTable.getField(n),o),o.indexOf(t)<0},e.prototype.validateBasedOnDependencies=function(){var e=this;this.targetTable.getFields().forEach(function(t){if(t.type===i.DSMTypes.QueryExpressionField.name||t.type===i.DSMTypes.QueryTransformField.name){var n=[];if(e.collectBasedOns(t,n),n.indexOf(t.id)>=0)throw new r.InvalidLoadModelException(t.name+" has circular field dependency!")}})},e.prototype.getBasedOns=function(e){var t=[];return this.collectBasedOns(this.targetTable.getField(e),t),t},e.prototype.getAllReferences=function(e){var t=[];return this.collectBasedOns(e,t),t},e.prototype.collectBasedOns=function(t,i){var r=this;if(t.expression)for(var o=t.expression.split(e.gExpressionRegEx),s=2;s<o.length;s+=4){var a=this.targetTable.getField(o[s]);a&&i.indexOf(o[s])<0&&(i.push(a.id),this.collectBasedOns(a,i))}t.transformations&&t.transformations.forEach(function(o){var s=e.isInlineTransformation(o.op),a=e.isNewFieldTransformation(o.op),l=[];n.isArray(o.appliedTo)?o.appliedTo.forEach(function(e){(e!==t.id||!s&&!a)&&l.push(e)}):(o.appliedTo!==t.id||!s&&!a)&&l.push(o.appliedTo),l.forEach(function(e){var t=r.targetTable.getField(e);t&&i.indexOf(e)<0&&(i.push(t.id),r.collectBasedOns(t,i))})})},e}();o.gExpressionRegEx=new RegExp("({{)(\\S\\s*[^}}]*)(}})","g"),t.LoadModelUtils=o}),define("assets/load-model/operations/concat-operations",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.migrateAssociations=function(e,t,n){e.forEach(function(e){n.findAssociations(e.id).forEach(function(i){i.getFieldsReferencing(e).forEach(function(e,n){var r=t.getFieldForSourceField(e.fieldId);i.replaceFieldReferences(e,t.data,r)}),1===i.getUniqueTableReferenceCount()&&n.removeAssociation(i.getName())})})},e}();t.ConcatOperations=n}),define("assets/load-model/query-generator",["require","exports","underscore","./dsm-types","./load-model-ids","./invalid-load-model-exception","./shared-util","./load-model-utils","./operations/concat-operations"],function(e,t,n,i,r,o,s,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(){}return e.extractConcatenationQueries=function(e){return(e=e||[]).filter(function(e){return e.type===i.DSMTypes.ConcatenationQuery.name})},e.flattenConcatenationQueries=function(e){e=e||[];var t=[];return n.each(e,function(e){"ConcatenationQuery"===e.type?t=t.concat(e.sourceQueries):t.push(e)}),t},e.createConcatTableName=function(e,t){for(var i="("+e[0].name+"...)",r=0,o=i;n.find(t,function(e){return e.name===o});)o=i+"-"+ ++r;return o},e.mergeConcatenationQuery=function(t,r){var o,s,a;r?(o=r.name,a=r.id,r.fields&&r.fields.forEach(function(i){var r=n.find(t.fields,function(t){return!!e.doConcatFieldsMatch(i,t)});r?(r.id=i.id,r.name=i.name,r.transformations=i.transformations,r.classifications=i.classifications):i.sourceFieldRefs||t.fields.push(i)}),s=t.sourceQueries.length!==r.sourceQueries.length?i.DSMTypes.QueryStatus.update:r.status):(o=t.name,a=t.id,s=i.DSMTypes.QueryStatus.add),t.name=o,t.id=a,t.status=s},e.generate=function(t,n){var i=e.generateSimpleQueries(t);return i=e.surfaceConcatenationQueries(i,n)},e.cloneQuery=function(e){return s.SharedUtil.extend(!0,{},e)},e.checkIntegrity=function(t,r){if(n.pluck(t,"id").length!==t.length)throw new o.InvalidLoadModelException("missing some table ids");var s=e.flattenConcatenationQueries(r),a=e.extractConcatenationQueries(r),l=s.concat(a),c=n.pluck(l,"id");if(c.length!==l.length)throw new o.InvalidLoadModelException("missing some query ids");if(n.uniq(c).length!==c.length)throw new o.InvalidLoadModelException("not all query ids unique");if(n.pluck(l,"type").length!==l.length)throw new o.InvalidLoadModelException("queries missing the type property");if(!t.every(e.checkTableIntegrity))throw new o.InvalidLoadModelException("Invalid table");if(!s.filter(function(e){return e.type===i.DSMTypes.Query.name}).every(e.checkQueryIntegrity))throw new o.InvalidLoadModelException("Invalid simple query");if(!a.every(e.checkConcatenatedQueryIntegrity))throw new o.InvalidLoadModelException("Invalid concatenated query")},e.checkTableIntegrity=function(t){return!(n.isUndefined(t.id)||n.isUndefined(t.tableName)||n.isUndefined(t.tableAlias)||n.isUndefined(t.fields))&&t.fields.every(e.checkTableFieldsIntegrity)},e.checkTableFieldsIntegrity=function(e){return!(n.isUndefined(e.id)||n.isUndefined(e.name)||n.isUndefined(e.alias)||n.isUndefined(e.selected))},e.checkQueryIntegrity=function(t){return!(n.isUndefined(t.id)||n.isUndefined(t.type)||n.isUndefined(t.name)||n.isUndefined(t.fields)||n.isUndefined(t.tableRef))&&t.fields.every(e.checkFieldIntegrity)},e.checkConcatenatedQueryIntegrity=function(e){return!(n.isUndefined(e.id)||n.isUndefined(e.type)||n.isUndefined(e.name)||n.isUndefined(e.sourceQueries))},e.checkFieldIntegrity=function(e){return!(n.isUndefined(e.id)||n.isUndefined(e.type)||n.isUndefined(e.name)||e.type===i.DSMTypes.QueryField.name&&n.isUndefined(e.fieldRef)||e.type&&-1===n.indexOf(i.DSMTypes.GetFields(),e.type))},e.updateQueryTableStatus=function(e,t){if(e.type!==i.DSMTypes.ConcatenationQuery.name){if(0===e.fields.length)return void(e.status=i.DSMTypes.QueryStatus.delete);var r=n.pluck(e.fields,"name").sort(),o=n.pluck(t.fields,"name").sort();return!n.isEqual(r,o)?void(t.status===i.DSMTypes.QueryStatus.add?e.status=i.DSMTypes.QueryStatus.add:e.status=i.DSMTypes.QueryStatus.update):void(e.status=t.status)}},e.updateQueryTable=function(t,n,i){var r=s.SharedUtil.extend(!0,{},n),o=[],a=[];i.fields.forEach(function(t){var i=e.findQueryByFieldRef(n,t.id);t.selected?i?i.name=t.alias:o.push(e.generateFieldQuery(t)):i&&a.push(i)});var l=t.wrapInTargetTableModel(n);a.forEach(function(t){e.deleteField(l,t)}),o.forEach(function(t){var r=e.findInsertionIndex(t,n,i);n.fields.splice(r,0,t)}),e.updateQueryTableStatus(n,r)},e.deleteField=function(t,n){var i=this.constructDependencyMap(t);e.removeFieldAndDependents(t,i,n)},e.updateQueries=function(t,i,r,o){var s=e.extractConcatenationQueries(i),a=i;i=n.clone(i),a.splice(0,a.length),i=e.flattenConcatenationQueries(i),t.forEach(function(t){var n=0!==t.fields.filter(function(e){return e.selected}).length,o=e.findQueryByTableRef(i,t.id);o?n&&e.updateQueryTable(r,o,t):n&&i.push(e.generateTableQuery(t))}),i.forEach(function(n){var i=e.findSourceTableByRef(t,n.tableRef);!i&&n.sourceQueries&&1===n.sourceQueries.length&&(i=e.findSourceTableByRef(t,n.sourceQueries[0].tableRef)),r.wrapInTargetTableModel(n).pruneFieldReferences(t),0===n.fields.length&&o&&o.push(n)}),i=e.surfaceConcatenationQueries(i,r);var l=e.extractConcatenationQueries(i);e.migrateAssocations(l,r),e.mergeConcatenationQueries(l,s,r),i.forEach(function(e){a.push(e)})},e.createCompositeQueryFields=function(e){if(0===e.length)return[];var t=[],n=e[0],r={};return e.forEach(function(e){e.fields.forEach(function(e){r[e.name]||(r[e.name]=[]),r[e.name].push(e.id)})}),n.fields.filter(function(e){return e.type===i.DSMTypes.QueryField.name}).forEach(function(e){var n={id:r[e.name][0],type:i.DSMTypes.CompositeQueryField.name,name:e.name,sourceFieldRefs:r[e.name]};t.push(n)}),t},e.migrateAssocations=function(e,t){e.forEach(function(e){l.ConcatOperations.migrateAssociations(e.sourceQueries,t.wrapInTargetTableModel(e),t)})},e.surfaceConcatenationQueries=function(t,n){t=t||[];var o=[];return e.groupByQueryFieldNames(t).forEach(function(s){if(1===s.length)o.push(s[0]);else{var a={type:i.DSMTypes.ConcatenationQuery.name,status:i.DSMTypes.QueryStatus.add,name:e.createConcatTableName(s,t),sourceQueries:s,id:void 0,fields:[]};e.pruneGeoTransformFields(t,n),a.id=r.LoadModelIds.createConcatQueryId(),a.fields=e.createCompositeQueryFields(s).concat(e.extractNonQueryFields(s)),o.push(a)}}),o},e.extractNonQueryFields=function(e){if(0===e.length)return[];var t=[],n=e[0];return n.fields.filter(function(e){return e.type!==i.DSMTypes.QueryField.name}).forEach(function(e){t.push(e),n.fields.splice(n.fields.indexOf(e),1)}),t},e.removeFieldAndDependents=function(t,n,i){n[i.id].forEach(function(i){var r=t.getField(i);r&&e.removeFieldAndDependents(t,n,r)});var r=t.getFields(),o=r.indexOf(i);r.splice(o,1),n[i.id]=null},e.constructDependencyMap=function(e){var t=new a.LoadModelUtils(e),n={};return e.getFields().forEach(function(e){n[e.id]||(n[e.id]=[]),t.getAllReferences(e).forEach(function(t){n[t]||(n[t]=[]);var i=n[t];i.some(function(t){return e===t})||i.push(e.id)})}),n},e.findInsertionIndex=function(e,t,i){var r=n.findWhere(i.fields,{id:e.fieldRef}),o=i.fields.indexOf(r);if(0===o)return 0;for(var s=t.fields.length+1,a=o-1;a>=0;a--){var l=i.fields[a],c=n.findWhere(t.fields,{fieldRef:l.id});if(c){s=t.fields.indexOf(c)+1;break}}return s},e.findMatch=function(t,i,r){var o=e.getConcatenatedQuerySignature(t,r);return n.find(i,function(t){var i=e.getConcatenatedQuerySignature(t,r);return n.isEqual(o,i)})},e.mergeConcatenationQueries=function(t,n,i){t.forEach(function(t){var r=e.findMatch(t,n,i);e.mergeConcatenationQuery(t,r)})},e.getConcatenatedQuerySignature=function(e,t){if(!e||e.type!==i.DSMTypes.ConcatenationQuery.name)throw new o.InvalidLoadModelException;if(e.sourceQueries.length<1)throw new o.InvalidLoadModelException;return this.getFieldsSignature(e.sourceQueries[0],t)},e.getFieldsSignature=function(e,t){var r=t.wrapInTargetTableModel(e),o=n.filter(e.fields,function(e){return!r.wasGeneratedByTransformation(e,i.DSMTypes.QueryTransformField.name,[i.DSMTypes.Transformations.lookupGeoInfo,i.DSMTypes.Transformations.geoPoint])});return n.pluck(o,"name").sort().join()},e.getQueryFieldsSignature=function(e){var t=n.filter(e.fields,function(e){return e.type===i.DSMTypes.QueryField.name});return n.pluck(t,"name").sort().join()},e.pruneGeoTransformFields=function(e,t){e.forEach(function(e){for(var n=t.wrapInTargetTableModel(e),r=e.fields,o=r.length-1;o>=0;o--)n.wasGeneratedByTransformation(r[o],i.DSMTypes.QueryTransformField.name,[i.DSMTypes.Transformations.lookupGeoInfo,i.DSMTypes.Transformations.geoPoint])&&r.splice(o,1)})},e.generateFieldQuery=function(e){return{id:r.LoadModelIds.createQueryFieldId(),type:i.DSMTypes.QueryField.name,name:e.alias?e.alias:e.name,fieldRef:e.id}},e.doConcatFieldsMatch=function(e,t){var n=!1;return t.sourceFieldRefs?n=t.sourceFieldRefs.some(function(t){return e.sourceFieldRefs&&e.sourceFieldRefs.indexOf(t)>0}):e.type===t.type&&e.type!==i.DSMTypes.CompositeQueryField.name&&(n=e.id===t.id),n},e.generateTableQuery=function(t){var n=t.tableAlias||t.tableName;return{id:r.LoadModelIds.createSimpleQueryId(),type:i.DSMTypes.Query.name,name:n,tableRef:t.id,status:i.DSMTypes.QueryStatus.add,fields:t.fields.filter(function(e){return e.selected}).map(function(t){return e.generateFieldQuery(t)})}},e.generateSimpleQueries=function(t){return t.filter(function(e){return 0!==e.fields.filter(function(e){return e.selected}).length}).map(function(t){return e.generateTableQuery(t)})},e.groupByQueryFieldNames=function(e){var t=this,r={},o=[];return e.forEach(function(e){if(e.status!==i.DSMTypes.QueryStatus.delete&&0!==e.fields.length){var n=t.getQueryFieldsSignature(e)||e.id;r[n]?r[n].push(e):r[n]=[e]}else o.push([e])}),n.values(r).concat(o)},e.findQueryByTableRef=function(t,i){var r=n.find(t,function(e){return e.tableRef===i});return r||t.forEach(function(t){if(t.sourceQueries){var n=e.findQueryByTableRef(t.sourceQueries,i);n&&(r=n)}}),r},e.findQueryByFieldRef=function(e,t){return n.find(e.fields,function(e){return e.fieldRef===t})},e.findSourceTableByRef=function(e,t){return n.find(e,function(e){return e.id===t})},e}();t.QueryGenerator=c}),define("assets/load-model/models/classification-helper",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.isMeasure=function(e){return this.gMeasures.indexOf(e)>=0},e.isDimension=function(t){return this.gDimensions.indexOf(t)>=0||e.isTemporal(t)||e.isGeographical(t)||this.gIntervals.indexOf(t)>=0||e.gOrdinals.indexOf(t)>=0},e.isTemporal=function(t){return this.gTemporals.indexOf(t)>=0||e.gDays.indexOf(t)>=0},e.isGeographical=function(e){return this.gGeographical.indexOf(e)>=0},e.getGeoClassification=function(t){for(var n=void 0,i=0;i<t.length;i++)if(e.gGeographical.indexOf(t[i])){n=t[i];break}return n},e}();n.gMeasures=["measure","monetary","percentage"],n.gDimensions=["dimension","boolean"],n.gOrdinals=["ordinal","interval"],n.gIntervals=["interval","longitude","latitude","temporal"],n.gTemporals=["date","time","timestamp","year","quarter","month","week","minute","second","hour"],n.gDays=["day","weekDay","monthDay","yearDay"],n.gGeographical=["geographical","postalCode","city","stateProvince","country"],t.ClassificationHelper=n}),define("assets/load-model/query-field",["require","exports","underscore","./models/classification-helper"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.data=e}return e.prototype.addSourceField=function(e){this.data.sourceFieldRefs||(this.data.sourceFieldRefs=[]),this.data.sourceFieldRefs.push(e.id)},e.prototype.getSourceFieldReferences=function(){return this.data.fieldRef?[this.data.fieldRef]:this.data.sourceFieldRefs?this.data.sourceFieldRefs:void 0},e.prototype.isGeographical=function(){return!!this.data.classifications&&this.data.classifications.some(function(e){return i.ClassificationHelper.isGeographical(e)})},e.prototype.getGeographicalClassification=function(){return i.ClassificationHelper.getGeoClassification(this.data.classifications)},e.prototype.references=function(e){var t=this,n=0;return this.data.sourceFieldRefs&&e.forEach(function(e){t.data.sourceFieldRefs.some(function(t){return e.id===t})&&n++}),n===e.length},e.prototype.hasTransformation=function(e){var t=!1;return this.data.transformations&&this.data.transformations.length>0&&(t=this.data.transformations.some(function(t){return t.op===e})),t},e.prototype.getTransformation=function(e,t){var n;if(this.data.transformations)for(var i=0;i<this.data.transformations.length;i++){var r=this.data.transformations[i];if(r.op===e&&this.appliesTo(r,t)){n=r;break}}return n},e.prototype.appliesTo=function(e,t){return n.isArray(e.appliedTo)?e.appliedTo.indexOf(t)>=0:e.appliedTo===t},e}();t.QueryField=r}),define("assets/load-model/transformations/transformation-recommendation",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(e,t,n){this.targetTable=e,this.loadModel=t,this.locale=n}}();t.TransformationRecommendation=n}),define("assets/load-model/models/load-model-helpers",["require","exports","underscore","../dsm-types","../shared-util"],function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.areQueryFieldsEqual=function(t,i,r,o){var s=e._normalizeQueryField(t,r,o),a=e._normalizeQueryField(i,r,o);return n.isEqual(s,a)},e.areLoadModelsEqual=function(e,t){var i=e.serialize(),r=t.serialize();return n.isEqual(i,r)},e.findSourceTableFieldByRef=function(e,t){return n.find(e.fields,function(e){return e.id===t})},e.generateUniqueFieldName=function(t,n,i,r){for(var o=n,s=1,a=null;t.isTargetTableFieldNameInUse(o)&&(!r||!(a=e.doesAddingFieldCauseConcatenation(t,i,o)));)o=n+"_"+s,s++;return{name:o,concatenatedName:a?a.name:""}},e.doesAddingFieldCauseConcatenation=function(e,t,r){var o=e.rawClone(),s=o.getTargetTableModelById(t);s.createTransformField(r,[]),o.serialize();var a=null;return n.filter(o.queries,function(e){return e.type===i.DSMTypes.ConcatenationQuery.name}).forEach(function(e){n.find(e.sourceQueries,function(e){return e.name===s.data.name})&&(a=e)}),a},e.getQualifiedFieldName=function(e,t,n){for(var i=t+"."+n;e.isFieldNameInUse(i);)i=t+"."+i;return i},e.areSourceFieldAliasesUnique=function(e){var t=!1;return e.tableModels.forEach(function(e){if(!t){var n=e.data.fields.filter(function(e){return e.selected}).map(function(e){return e.alias});t=n.some(function(e,t){return n.indexOf(e)!==t})}}),!t},e._normalizeQueryField=function(t,i,o){var s=r.SharedUtil.extend(!0,{},t),a=e.schemas[t.type];if(!a)throw new TypeError("Field is missing a required property ( type ) and cannot be properly normalized.");return n.pairs(a).forEach(function(e){var t=e[0],n=e[1].optional;if(o&&"transformations"===e[0]&&s.transformations)for(var r=s.transformations,a=r.length-1;a>=0;a--)o(r[a])&&r.splice(a,1);if(i&&i(t))delete s[t];else if(n){var l=e[1].defaultValue;s.hasOwnProperty(t)||(s[t]=l)}else if(!s.hasOwnProperty(t))throw new TypeError("Field is missing a required property ( "+t+" ) and cannot be properly normalized.")}),s},e}();o.schemas={QueryExpressionField:{id:{optional:!1},type:{optional:!1},name:{optional:!1},expression:{optional:!1}},QueryTransformField:{id:{optional:!1},type:{optional:!1},name:{optional:!1},transformations:{optional:!1}},CompositeQueryField:{id:{optional:!1},type:{optional:!1},name:{optional:!1},sourceFieldRefs:{optional:!1}},QueryField:{id:{optional:!1},type:{optional:!1},name:{optional:!1},fieldRef:{optional:!0},transformations:{optional:!0,defaultValue:[]},classifications:{optional:!0,defaultValue:[]},exclude:{optional:!0,defaultValue:!1}}},t.LoadModelHelpers=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("assets/load-model/transformations/geo-point-recommendation",["require","exports","./transformation-recommendation","../models/load-model-helpers","../dsm-types","../load-model-utils"],function(e,t,n,i,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.updateTransformation=function(e,t){var n=this.indexOfTransformation(e,r.DSMTypes.Transformations.lookupGeoInfo);n>=0?(e.transformations[n]=t,this.updateCorrespondingGeoField(e,t)||this.handleRecommendation(t)):(e.transformations=e.transformations||[],e.transformations.push(t),this.handleRecommendation(t))},t.prototype.handleRecommendation=function(e){var t=this.targetTable,n=this.loadModel,o=t.getField(e.appliedTo[0]),s=t.getField(e.appliedTo[1]);if(o&&s){var a=s.name,l=o.name,c=s;if(o.classifications&&-1!==o.classifications.indexOf("longitude")){var u=a;a=l,c=o,l=u}if(0===t.getTransformRelatedFields(c,r.DSMTypes.Transformations.geoPoint,!1).length){var h=i.LoadModelHelpers.generateUniqueFieldName(n,a+"_"+l,t.data.id,!0);t.createTransformField(h.name,e,"geoPoint")}}},t.prototype.updateCorrespondingGeoField=function(e,t){var n=this.findCorrespondingGeoField(e);return n&&(n.transformations=[t]),!!n},t.prototype.findCorrespondingGeoField=function(e){return new o.LoadModelUtils(this.targetTable).findCorrespondingTransformedField(e.id,r.DSMTypes.Transformations.geoPoint)},t.prototype.indexOfTransformation=function(e,t){if(e.transformations)for(var n=0;n<e.transformations.length;++n)if(e.transformations[n].op===t)return n;return-1},t}(n.TransformationRecommendation);t.GeoPointRecommendation=s}),define("assets/load-model/translator",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function t(){}return t.loadLanguageBundle=function(n,i){var r=t.getLongLanguageDesc(n);if("undefined"!=typeof module&&module.exports)try{var o=e("./translations/load-model-"+r);t.resourceBundles[r]=o,i(o)}catch(e){}else{var s=["text!./assets/load-model/translations/load-model-"+r+".json"];try{window.requirejs.apply(window.requirejs,[s,function(e){var n=JSON.parse(e);t.resourceBundles[r]=n,i(n)}])}catch(e){}}},t.GetString=function(e,n){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];for(var o=t.getLoadedResourceBundle(t.getLongLanguageDesc(e))[n],s=0;s<i.length;s++){var a="{"+s+"}";o=o.replace(a,i[s])}return o},t.getLoadedResourceBundle=function(e){return t.resourceBundles[e]},t.getShortLanguageDesc=function(e){return"pseudo"!==e.toLowerCase()&&(e=e.substring(0,2)),e.toLowerCase()},t.getLongLanguageDesc=function(e){var n;return(n=t.languageList.filter(function(t){return t.long.toLowerCase()===e.toLowerCase()})).length?e=n[0].long:(n=t.languageList.filter(function(n){return n.short===t.getShortLanguageDesc(e)})).length&&(e="zh-hk"===e.toLocaleLowerCase()||"zh-mo"===e.toLocaleLowerCase()?"zh-TW":n[0].long),n.length||(e=t.DEFAULT_LANGUAGE),e},t}();n.resourceBundles=[],n.DEFAULT_LANGUAGE="en-US",n.languageList=[{short:"es",long:"es-ES",label:"Spanish"},{short:"sv",long:"sv-SE",label:"Swedish"},{short:"ja",long:"ja-JP",label:"Japanese"},{short:"en",long:"en-US",label:"English"},{short:"de",long:"de-DE",label:"German"},{short:"fr",long:"fr-FR",label:"French"},{short:"it",long:"it-IT",label:"Italian"},{short:"nl",long:"nl-NL",label:"Dutch"},{short:"pt",long:"pt-BR",label:"Brazilian Portuguese"},{short:"ru",long:"ru-RU",label:"Russian"},{short:"zh",long:"zh-CN",label:"Simplified Chinese"},{short:"zh",long:"zh-TW",label:"Traditional Chinese"},{short:"pl",long:"pl-PL",label:"Polish"},{short:"tr",long:"tr-TR",label:"Turkish"},{short:"ko",long:"ko-KR",label:"Korean"}],t.Translator=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("assets/load-model/transformations/geo-lookup-recommendation",["require","exports","../dsm-types","../models/load-model-helpers","../load-model-utils","./transformation-recommendation","../translator"],function(e,t,n,i,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.updateTransformation=function(e,t){var i=this.indexOfTransformation(e,n.DSMTypes.Transformations.lookupGeoInfo);i>=0&&null===t?(this.removeCorrespondingGeoField(e),e.classifications=["dimension"],e.transformations.splice(i,1)):t&&(i>=0?(e.transformations[i]=t,this.updateCorrespondingGeoField(e,t)||this.handleRecommendation(t)):(e.transformations=e.transformations||[],e.transformations.push(t),this.handleRecommendation(t)),e.classifications=["cityAlias"===t.arguments.geoType?"city":"country"])},t.prototype.handleRecommendation=function(e){var t=this.determineGeoInfoFieldClassification(e.arguments.geoType),r=this.targetTable,o=r.getField(e.appliedTo);if(o&&0===r.getTransformRelatedFields(o,n.DSMTypes.Transformations.lookupGeoInfo,!1).length){var a=r.data.name+"."+s.Translator.GetString(this.locale,"DataManager.GeoInfo.ColumnSuffix",o.name),l=i.LoadModelHelpers.generateUniqueFieldName(this.loadModel,a,r.data.id,!0);r.createTransformField(l.name,e,t)}},t.prototype.removeCorrespondingGeoField=function(e){var t=this.findCorrespondingGeoField(e);t&&this.targetTable.deleteTransformField(t.id)},t.prototype.updateCorrespondingGeoField=function(e,t){var n=this.findCorrespondingGeoField(e);return n&&(n.transformations=[t],n.classifications=[this.determineGeoInfoFieldClassification(t.arguments.geoType)]),!!n},t.prototype.findCorrespondingGeoField=function(e){return new r.LoadModelUtils(this.targetTable).findCorrespondingTransformedField(e.id,n.DSMTypes.Transformations.lookupGeoInfo)},t.prototype.determineGeoInfoFieldClassification=function(e){var t="geoPoint";return["countryAlias","countryCodeISO3","countryCodeISO2"].indexOf(e)>-1&&(t="geoPolygon"),t},t.prototype.indexOfTransformation=function(e,t){if(e.transformations)for(var n=0;n<e.transformations.length;++n)if(e.transformations[n].op===t)return n;return-1},t}(o.TransformationRecommendation);t.GeoLookupRecommendation=a});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("assets/load-model/transformations/date-time-recommendation",["require","exports","underscore","../dsm-types","./transformation-recommendation"],function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.updateTransformation=function(e,t){var r=-1;if(e.transformations){var o=n.find(e.transformations,function(e){return e.op===i.DSMTypes.Transformations.interpretValues});r=n.indexOf(e.transformations,o)}r>=0&&null===t?(e.classifications=[],e.transformations.splice(r,1)):t&&(r>=0?e.transformations[r]=t:(e.transformations=e.transformations||[],e.transformations.push(t)),e.classifications=[t.arguments.targetType])},t.prototype.handleRecommendation=function(e){},t}(r.TransformationRecommendation);t.DateTimeRecommendation=o}),define("assets/load-model/transformations/transformation-recommendation-util",["require","exports","../dsm-types","underscore","./geo-point-recommendation","./geo-lookup-recommendation","./date-time-recommendation"],function(e,t,n,i,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n){this.targetTable=e,this.loadModel=t,this.locale=n}return e.prototype.updateTransformation=function(t,n,r){var o=i.where(e.supportedTransformations,{op:n});o.length>0&&new(0,o[0].handler)(this.targetTable,this.loadModel,this.locale).updateTransformation(t,r)},e.prototype.handleRecommendation=function(t,n){var r=i.where(e.supportedTransformations,{op:t.op});r.length>0&&-1!==n.indexOf(t.op)&&new(0,r[0].handler)(this.targetTable,this.loadModel,this.locale).handleRecommendation(t)},e}();a.supportedTransformations=[{op:n.DSMTypes.Transformations.interpretValues,handler:s.DateTimeRecommendation},{op:n.DSMTypes.Transformations.geoPoint,handler:r.GeoPointRecommendation},{op:n.DSMTypes.Transformations.lookupGeoInfo,handler:o.GeoLookupRecommendation}],t.TransformationRecommendationUtil=a}),define("assets/load-model/target-table-model",["require","exports","underscore","./dsm-types","./load-model-ids","./load-model-utils","./query-field","./transformations/transformation-recommendation-util","./query-generator"],function(e,t,n,i,r,o,s,a,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(t){var n=t.fields=t.fields||[];t.status=void 0!==t.status?t.status:e.Statuses.add,this.data=t,this.fields=n}return e.CreateTargetTableModel=function(t){return new e(t)},e.findSourceTableByRef=function(e,t){return n.find(e,function(e){return e.id===t})},e.findFieldByRef=function(e,t){for(var i,r=0;r<e.length&&!(i=n.find(e[r].fields,function(e){return e.id===t}));r++);return i},e.getSourceFields=function(t,n){var i=[];return t.forEach(function(t){n.forEach(function(n){var r=new e(n).getField(t);r&&i.push({field:r,sourceQuery:n})})}),i},e.findTransformRelatedFields=function(t,n){var i=[];return n.forEach(function(n){var r=n.field,o=new e(n.sourceQuery),s=o.getTransformRelatedFields(r,t,!1);if(s.length>0)i.push.apply(i,s);else if(r.sourceFieldRefs){var a=e.getSourceFields(r.sourceFieldRefs,n.sourceQuery.sourceQueries),l=e.findTransformRelatedFields(t,a);if(l.length>0){var c=o.findReferencingField(l);c&&i.push(c)}}}),i},e.prototype.getSourceFields=function(t){if(this.data.sourceQueries){var n=this.getField(t),i=new s.QueryField(n).getSourceFieldReferences();return e.getSourceFields(i,this.data.sourceQueries)}return[]},e.prototype.createTransformField=function(e,t,o){var s={id:r.LoadModelIds.generateUUID(),type:i.DSMTypes.QueryTransformField.name,name:e,transformations:[],classifications:o?[o]:[]};return t&&s.transformations.push(n.clone(t)),this.fields.push(s),this.setUpdateStatus(),s},e.prototype.createField=function(e,t){var n={id:r.LoadModelIds.generateUUID(),type:t,name:e};return this.fields.push(n),this.setUpdateStatus(),new s.QueryField(n)},e.prototype.deleteTransformField=function(e){var t=this.findTransformField(e);l.QueryGenerator.deleteField(this,t),this.setUpdateStatus()},e.prototype.createCalculatedField=function(e,t){var n={id:r.LoadModelIds.generateUUID(),type:i.DSMTypes.QueryExpressionField.name,name:e,expression:t};this.fields.push(n),this.setUpdateStatus()},e.prototype.updateCalculatedField=function(e,t,n){var i=this.findCalculatedField(e);if(!i)throw Error("field not found");i.name=t,i.expression=n,this.setUpdateStatus()},e.prototype.deleteCalculatedField=function(e){var t=this.findCalculatedField(e);l.QueryGenerator.deleteField(this,t),this.setUpdateStatus()},e.prototype.setMarkForDeletion=function(){this.data.status=e.Statuses.delete,this.data.sourceQueries&&this.data.sourceQueries.forEach(function(t){t.status=e.Statuses.delete})},e.prototype.isMarkedForDeletion=function(){return this.data.status===e.Statuses.delete},e.prototype.isInSynchWithMaster=function(){return this.data.status===e.Statuses.inSynchWithMaster},e.prototype.setUpdateStatus=function(){this.isAdded()||(this.data.status=e.Statuses.update),this.data.sourceQueries&&this.data.sourceQueries.forEach(function(t){t.status!==e.Statuses.add&&(t.status=e.Statuses.update)})},e.prototype.isConcatenatedTable=function(){return this.data.type===i.DSMTypes.ConcatenationQuery.name||this.data.type===i.DSMTypes.ForcedConcatenationQuery.name},e.prototype.isQueryTable=function(){return this.data.type===i.DSMTypes.Query.name},e.prototype.isCrossTable=function(){return this.data.type===i.DSMTypes.CrossTableQuery.name},e.prototype.getStatus=function(){return this.data.status},e.prototype.setStatusAdded=function(){this.data.status=e.Statuses.add,this.data.sourceQueries&&this.data.sourceQueries.forEach(function(t){t.status=e.Statuses.add})},e.prototype.isAdded=function(){return this.data.status===e.Statuses.add},e.prototype.isUpdated=function(){return this.data.status===e.Statuses.update},e.prototype.resetStatus=function(){this.data.status=e.Statuses.inSynchWithMaster,this.data.sourceQueries&&this.data.sourceQueries.forEach(function(t){t.status=e.Statuses.inSynchWithMaster})},e.prototype.isFieldNameInUse=function(e){return n.find(this.getFields(),function(t){return t.name===e})},e.prototype.getFieldByName=function(e){return n.find(this.getFields(),function(t){return t.name===e})},e.prototype.generateUniqueFieldName=function(e){for(var t=e,n=0;this.isFieldNameInUse(t);)n++,t=e+"_"+n;return t},e.prototype.isDirty=function(){return!(void 0===this.data.status||this.data.status===e.Statuses.inSynchWithMaster)},e.prototype.rename=function(e){this.data.name=e,this.setUpdateStatus()},e.prototype.getFields=function(){return this.data.fields},e.prototype.getField=function(e){return n.find(this.getFields(),function(t){return t.id===e})},e.prototype.updateFieldTransformation=function(e,t,n,i,r){var o=this.getField(t);new a.TransformationRecommendationUtil(this,e,r).updateTransformation(o,n,i)},e.prototype.deleteFieldTransformations=function(e,t){var n=this,r=this.getField(e),s=new o.LoadModelUtils(this);r.transformations&&(r.transformations.forEach(function(t){if(t.op===i.DSMTypes.Transformations.lookupGeoInfo){var r=s.findCorrespondingTransformedField(e,i.DSMTypes.Transformations.lookupGeoInfo);r&&n.deleteTransformField(r.id)}}),r.transformations=[]),r.classifications=["dimension"]},e.prototype.setFieldSplit=function(e,t,n){this.addTransformation(e,t,i.DSMTypes.Transformations.fieldSplit,n)},e.prototype.setOrdinal=function(e,t){this.addTransformation(e,e,i.DSMTypes.Transformations.defineOrder,t)},e.prototype.setMapping=function(e,t){this.addTransformation(e,e,i.DSMTypes.Transformations.mapValues,t)},e.prototype.setBucketing=function(e,t,n){var r={},o=!0;n&&n.buckets&&(o=!1,r.intervals=n.buckets),n&&n.bucketMethod&&(o=!1,r.method=n.bucketMethod),o&&(r=void 0),this.addTransformation(e,t,i.DSMTypes.Transformations.bucketed,r)},e.prototype.getBucketingAppliesTo=function(e){var t,n=this.getField(e);if(n.transformations){var r=n.transformations.filter(function(e){return e.op===i.DSMTypes.Transformations.bucketed});if(r&&r.length>0){var o=r[0].appliedTo[0];t=this.getField(o)}}return t},e.prototype.hasOrdinal=function(e){var t=this.getField(e);return!!t.transformations&&t.transformations.filter(function(e){return e.op===i.DSMTypes.Transformations.defineOrder}).length>0},e.prototype.setFieldType=function(e,t,n,r,o){var s=this.getField(e);"noclassification"===t?(s.classifications=s.classifications||[],s.classifications=s.classifications.filter(function(e){return"date"!==e&&"timestamp"!==e})):t&&(s.classifications=[t]),this.addTransformation(e,e,i.DSMTypes.Transformations.interpretValues,{name:t,inputPattern:n,displayPattern:r,sourceFieldType:o})},e.prototype.getSourceQueries=function(){return this.data.sourceQueries||[]},e.prototype.addSourceQuery=function(e){this.data.sourceQueries||(this.data.sourceQueries=[]),this.data.sourceQueries.push(e)},e.prototype.getId=function(){return this.data.id},e.prototype.getType=function(){return this.data.type},e.prototype.getSources=function(){return this.data.sourceQueries},e.prototype.getTableRefs=function(){return this.isConcatenatedTable()||this.isCrossTable()?this.getSourceQueries().map(function(e){return e.tableRef}):[this.data.tableRef]},e.prototype.getName=function(){return this.data.name},e.prototype.pruneFieldReferences=function(t){var n=this,i=[];if(this.data.tableRef){var r=e.findSourceTableByRef(t,this.data.tableRef);this.data.fields.forEach(function(t){if(t.fieldRef){var n=r?e.findFieldByRef([r],t.fieldRef):void 0;n&&n.selected||i.push(t)}})}else this.data.sourceQueries&&(this.data.sourceQueries.forEach(function(n){new e(n).pruneFieldReferences(t)}),this.data.fields.forEach(function(t){if(t.fieldRef||t.sourceFieldRefs){var r=[];t.fieldRef?r.push(t.fieldRef):t.sourceFieldRefs&&(r=t.sourceFieldRefs),r.forEach(function(o){e.findFieldByRef(n.data.sourceQueries,o)||(r.splice(r.indexOf(o),1),0===r.length&&i.push(t))})}}));i.forEach(function(e){var t=n.data.fields.indexOf(e);n.data.fields.splice(t,1)})},e.prototype.getFieldForSourceField=function(e){for(var t=0;t<this.data.fields.length;t++)for(var n=this.data.fields[t],i=0;n.sourceFieldRefs&&i<n.sourceFieldRefs.length;i++)if(n.sourceFieldRefs[i]===e)return n},e.prototype.getGeoRelatedFields=function(e,t){return this.getTransformRelatedFields(e,i.DSMTypes.Transformations.lookupGeoInfo,t)},e.prototype.getTransformRelatedFields=function(t,n,r){var o=[];if(this.fields.forEach(function(e){var r=new s.QueryField(e);e.type===i.DSMTypes.QueryTransformField.name&&r.getTransformation(n,t.id)&&o.push(e)}),0===o.length&&r&&(t.fieldRef||t.sourceFieldRefs)&&this.getSourceQueries()&&this.getSourceQueries().length>0){var a=e.getSourceFields(t.fieldRef?[t.fieldRef]:t.sourceFieldRefs,this.getSourceQueries()),l=e.findTransformRelatedFields(n,a);l.length>0&&(o=l)}return o},e.prototype.wasGeneratedByTransformation=function(t,n,i){var r=new s.QueryField(t),o=!1;if(n&&r.data.type!==n||(o=i.some(function(e){return!!r.hasTransformation(e)||void 0})),!o){var a=r.data.sourceFieldRefs;!a&&r.data.fieldRef&&(a=[r.data.fieldRef]),a&&a.length>0&&(o=e.getSourceFields(a,this.getSourceQueries()).some(function(t){return new e(t.sourceQuery).wasGeneratedByTransformation(t.field,n,i)}))}return o},e.prototype.findReferencingField=function(e){for(var t,n=0;n<this.fields.length;n++)if(new s.QueryField(this.fields[n]).references(e)){t=this.fields[n];break}return t},e.prototype.findTransformField=function(e){return n.find(this.fields,function(t){return t.id===e&&t.type===i.DSMTypes.QueryTransformField.name})},e.prototype.findCalculatedField=function(e){return n.find(this.fields,function(t){return t.id===e&&t.type===i.DSMTypes.QueryExpressionField.name})},e.prototype._applyInterpretValueTransformation=function(e,t,i){var r=i.inputPattern,o=i.displayPattern,s=i.sourceFieldType,a=i.name;n.isEmpty(n.compact(r))?o&&(t.arguments={targetType:a,displayPattern:o},e.transformations=[t]):(t.arguments={targetType:a,patterns:r},e.transformations=[t],o&&(e.transformations[0].arguments.displayPattern=o),s&&(e.transformations[0].arguments.sourceFieldType=s))},e.prototype.addTransformation=function(e,t,n,r){var o=this.getField(e),s=this.getField(t||e),a={op:n,appliedTo:[s.id],arguments:{}},l=[];switch(o.transformations&&(l=o.transformations.filter(function(e){return e.op!==n})),n){case i.DSMTypes.Transformations.defineOrder:r&&r.length>0?(a.arguments={orderedValues:r},this.setUpdateStatus(),o.transformations=[a]):o.transformations=[];break;case i.DSMTypes.Transformations.mapValues:r&&r.length>0?(a.arguments={mapping:r},this.setUpdateStatus(),o.transformations=[a]):o.transformations=[];break;case i.DSMTypes.Transformations.bucketed:r?(a.arguments=r,o.transformations=[a]):o.transformations=[];break;case i.DSMTypes.Transformations.interpretValues:"noclassification"===r.name?o.transformations=[]:this._applyInterpretValueTransformation(o,a,r);break;case i.DSMTypes.Transformations.fieldSplit:r?(a.arguments=r,o.transformations=[a]):o.transformations=[]}l.length>0&&(o.transformations=o.transformations.concat(l))},e}();c.Statuses=i.DSMTypes.QueryStatus,t.TargetTableModel=c}),define("assets/load-model/input-table-model",["require","exports","./load-model-ids","./shared-util","underscore"],function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.data=e,e.id||this.updateId()}return e.create=function(t){return new e(t)},e.prototype.getSourceName=function(){return this.data.databaseName||this.data.dataconnectorName||""},e.prototype.isFiltered=function(){var e=this.getFilter(),t=!1;return e&&(t=""!==e.filterClause),!t&&this.data.filter&&(t=!0),t},e.prototype.getFilter=function(){return this.data.loadProperties&&this.data.loadProperties.filterInfo&&this.data.loadProperties.filterInfo},e.prototype.setLoadFilter=function(e){this.data.filter=e},e.prototype.getLoadFilter=function(){return this.data.filter},e.prototype.isNothingSelected=function(){for(var e in this.data.fields)if(this.data.fields[e].selected)return!1;return!0},e.prototype.setFieldSelected=function(e,t){this.data.state="modified",this.getOrCreateFieldByName(e).selected=t},e.prototype.addField=function(e,t,n){var i=this.createFieldModel(e);i.selected=n,this.data.fields.splice(t,0,i)},e.prototype.isFieldSelected=function(e){return this.getOrCreateFieldByName(e).selected},e.prototype.selectedFieldsCount=function(){var e=0;for(var t in this.data.fields)this.data.fields[t].selected&&e++;return e},e.prototype.fieldsCount=function(){return this.data.fields.length},e.prototype.changeFieldAlias=function(e,t){this.data.state="modified";for(var n in this.data.fields)if(this.data.fields[n].alias===e){this.data.fields[n].alias=t||this.data.fields[n].name;break}},e.prototype.setFieldAlias=function(e,t){t||(t=e),this.data.state="modified";for(var n in this.data.fields)if(this.data.fields[n].name===e){this.data.fields[n].alias=t;break}},e.prototype.getFieldQualifiedName=function(e){return this.cleanUpQualifiedNamePart(this.data.tableAlias)+"."+this.cleanUpQualifiedNamePart(e)},e.prototype.qualifyField=function(e){this.data.state="modified";for(var t in this.data.fields)if(this.data.fields[t].name===e){this.data.fields[t].alias=this.getFieldQualifiedName(this.data.fields[t].name);break}},e.prototype.getOriginalFieldNameFromAlias=function(e){for(var t in this.data.fields)if(this.data.fields[t].alias===e)return this.data.fields[t].name},e.prototype.getFieldAlias=function(e){for(var t in this.data.fields)if(this.data.fields[t].name===e)return this.data.fields[t].alias||this.data.fields[t].name},e.prototype.isFieldNameInUse=function(e){for(var t in this.data.fields)if((this.data.fields[t].alias||this.data.fields[t].name)===e)return!0;return!1},e.prototype.setFormatSpec=function(e){this.data.formatSpec=e},e.prototype.setLoadSelectStatement=function(e){this.data.loadSelectStatement=e},e.prototype.setSimpleSelectStatement=function(e){this.data.selectStatement=e},e.prototype.addSelectLoadProperty=function(e){this.data.loadProperties||(this.data.loadProperties={}),this.data.loadProperties.selectInfo=e},e.prototype.setFileFormatSettings=function(e){this.data.fileFormatSettings=e},e.prototype.getTableAlias=function(){return void 0===this.data.tableAlias||""===this.data.tableAlias?this.data.tableName:this.data.tableAlias},e.prototype.getFieldById=function(e){return r.findWhere(this.data.fields,{id:e})},e.prototype.pruneOtherFields=function(e){var t,n={};for(t in e)n[e[t]]=!0;for(t in this.data.fields){var i=this.data.fields[t];n[i.name]||(i.selected=!1)}},e.prototype.setTableGroupId=function(e){this.data.tableGroupId=e},e.prototype.getTableGroupId=function(){return this.data.tableGroupId},e.prototype.setLockSameGroupAssociations=function(e){this.data.lockSameGroupAssociations=e},e.prototype.registerFieldSourceRename=function(e,t,n){var i=this.getFieldByName(e),r=this.getFieldByName(t);if(i&&r){var o=this.data.fields.indexOf(i);-1!==o&&this.data.fields.splice(o,1),i.alias!==i.name&&(r.alias=i.alias),r.selected=n}else i?(i.alias===i.name&&(i.alias=t),i.name=t,i.selected=n):r||this.getOrCreateFieldByName(t)},e.prototype.markForRemoval=function(){for(var e in this.data.fields)this.data.fields[e].selected=!1},e.prototype.serialize=function(){this.updateId(),this.data.tableAlias=this.getTableAlias();var e=i.SharedUtil.extend(!0,{},this.data);return delete e.state,e},e.prototype.isNew=function(){return!!this.data.state},e.prototype.updateId=function(){var e=this;this.data.id=n.LoadModelIds.createTableId(this.data.tableAlias||this.data.tableName),this.data.fields.forEach(function(t){t.id||(t.id=n.LoadModelIds.createFieldId(e.data.id,t.name))})},e.prototype.setCachingEnabled=function(e,t){this.data.caching?(this.data.caching.enabled=e,this.data.caching.type=t):this.data.caching={enabled:e,type:t}},e.prototype.getByNameOrCreate=function(e,t,n){for(var i in e)if(e[i].name===t)return e[i];var r;return n&&(r=n(t),e.push(r)),r},e.prototype.createFieldModel=function(e){return{id:n.LoadModelIds.createFieldId(this.data.id,e),name:e,alias:e,selected:!1}},e.prototype.getOrCreateFieldByName=function(e){return this.getByNameOrCreate(this.data.fields,e,this.createFieldModel.bind(this))},e.prototype.getFieldByName=function(e){return this.getByNameOrCreate(this.data.fields,e)},e.prototype.cleanUpQualifiedNamePart=function(e){return e.replace(/[\.]/g,"..")},e}();t.InputTableModel=o}),define("assets/load-model/load-model-associations",["require","exports","underscore","./dsm-types","./shared-util"],function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){}return e.getAssociation=function(e,t){if(!e.associations||!e.associations[t])return null;var i={name:t,nodes:[]};return i.nodes=n.map(e.associations[t],n.clone),i.nodes.forEach(function(t){t.table=e.getTargetTableModelById(t.tableId),t.table&&(t.field=t.table.getField(t.fieldId))}),i},e.getAssociationNames=function(t,i,r){if(!t.associations)return[];var o=Object.keys(t.associations);if(!i)return o;var s=i?e.createSerializedNode(i,r):void 0,a=[];return o.forEach(function(e){n.find(t.associations[e],function(e){return r?s.fieldId===e.fieldId:s.tableId===e.tableId})&&a.push(e)}),a},e.removeAssociationByName=function(e,t){e.associations&&e.associations[t]&&delete e.associations[t]},e.renameAssociation=function(e,t,i){if(i!==t&&(e.associations||(e.associations={}),e.associations[t])){if(!e.associations[i])return e.associations[i]=e.associations[t],void delete e.associations[t];e.associations[t].forEach(function(t){n.find(e.associations[i],function(e){return e.tableId===t.tableId})||e.associations[i].push(t)}),delete e.associations[t]}},e.addAssociationBetween=function(t,i,r,o,s,a){var l=a||e.generateAssociationName(t,i,r,o,s);t.associations||(t.associations={}),i.setUpdateStatus(),o.setUpdateStatus();var c=e.createSerializedNode(i,r),u=e.createSerializedNode(o,s);t.associations[l]?[c,u].forEach(function(e){n.where(t.associations[l],e).length||t.associations[l].push(e)}):t.associations[l]=[c,u]},e.getTargetFieldByName=function(e,t){return n.find(e.getFields(),function(e){return e.name===t})},e.getAssociationNamesBetween=function(t,i,r,o,s){var a=[],l=e.getAssociationNames(t,i,r),c=e.getAssociationNames(t,o,s);return l.forEach(function(e){n.indexOf(c,e)>-1&&a.push(e)}),a},e.addToAssociation=function(t,i,r,o){t.associations||(t.associations={}),t.associations[i]||(t.associations[i]=[]);var s=e.createSerializedNode(r,o);n.where(t.associations[i],s).length||(t.associations[i].push(s),r.setUpdateStatus())},e.removeFromAssociation=function(t,n,i,r){if(t.associations&&t.associations[n]){var o=e.createSerializedNode(i,r);t.associations[n]=t.associations[n].filter(function(e){return r?e.fieldId!==o.fieldId:e.tableId!==o.tableId}),0===t.associations[n].length&&delete t.associations[n],i.setUpdateStatus()}},e.generateAssociationName=function(t,n,i,r,o){var s=e._generateAssociationName(t,n,i,r,o);return e.cleanUpKey(s)},e.removeAssociationBetween=function(t,n,i,r,o){e.getAssociationNamesBetween(t,n,i,r,o).forEach(function(s){e.removeFromAssociation(t,s,n,i),e.removeFromAssociation(t,s,r,o)})},e.updateAssociations=function(t){var n=e.getFieldName2TargetTablesMap(t);Object.keys(n).forEach(function(i){var r=n[i];r.length>1&&r.forEach(function(n){var r=n.table,o=e.getFieldQualifiedName(r.data.name,i);t.renameTargetTableField(r.data.name,i,o),e.addToAssociation(t,i,r,o)})});var i=e.getAssociationNames(t,null,null);i.forEach(function(n){e.getAssociation(t,n).nodes.forEach(function(e){var i=t.getTargetTableModelById(e.tableId);(i?i.getField(e.fieldId):null)||(t.associations[n]=t.associations[n].filter(function(t){return t.fieldId!==e.fieldId}))})}),(i=e.getAssociationNames(t,null,null)).forEach(function(n){e.getAssociation(t,n).nodes.length<=1&&e.removeAssociationByName(t,n)}),n=e.getFieldName2TargetTablesMap(t),(i=e.getAssociationNames(t,null,null)).forEach(function(i){var r=n[i];r&&r.forEach(function(n){var r=n.table,o=e.getFieldQualifiedName(r.data.name,i);t.renameTargetTableField(r.data.name,i,o)})}),Object.keys(t.associations).forEach(function(n){e.renameAssociation(t,n,e.cleanUpKey(n))})},e.getFieldQualifiedName=function(t,n){return e.cleanUpQualifiedNamePart(t)+"."+e.cleanUpQualifiedNamePart(n)},e.getDuplicateFieldInfo=function(t,n,i,r){var o={},s=e.getAssociation(t,r);t.targetTableModels.forEach(function(e){var t=e.getFields().filter(function(e){return e.name===i}),a=!1;s&&s.nodes.some(function(e){return e.field.name===i})&&(a=!0),e.data.id!==n.data.id||r?!(t.length>0&&e.data.id!==n.data.id)||s&&a||(o.otherTable=e.data.name):o.duplicateInSameTable=t.length>0});var a=e.getAssociation(t,i);if(a){var l=[];a.nodes.forEach(function(e){var t=e.table.data.name;-1===l.indexOf(t)&&l.push(t)}),l.length>=2&&(o.associatedTables=l)}return o.isUnique=!o.duplicateAssociation&&!o.duplicateInSameTable&&!o.associatedTables,o},e.serializeAssociations=function(e){var t=e.associations?e.associations:{};return r.SharedUtil.extend(!0,{},t)},e.hasDisconnectedBubbles=function(t){var n=t.targetTableModels.filter(function(e){return!e.isMarkedForDeletion()});if(n.length<=1)return!1;for(var i=0;i<n.length;i++){var r=n[i];if(0===e.getAssociationNames(t,r).length)return!0}return!1},e.doNameBasedAssociations=function(t,n,r){var o=function(n){return n.getStatus()!==i.DSMTypes.QueryStatus.delete&&0===e.getAssociationNames(t,n).length},s=n?function(e){var t=n.getTargetTableModel(e.data.name),r=!t||t.getStatus()===i.DSMTypes.QueryStatus.delete,s=e.getStatus()===i.DSMTypes.QueryStatus.add||e.getStatus()===i.DSMTypes.QueryStatus.update;return r&&s&&o(e)}:o,a=e.getFieldName2TargetTablesMap(t,!0,s);Object.keys(a).forEach(function(n){var i=a[n];i.length>1&&i.forEach(function(o){i.forEach(function(i){o!==i&&e.hasGoodScore(t,r,o,i)&&e.isSafeToAssociate(t,o.table,o.field,i.table,i.field)&&e.addAssociationBetween(t,o.table,o.field,i.table,i.field,n)})})})},e.augmentRecommendationsWithNameBasedAssociations=function(t){var n={};t.result.associatedFields.forEach(function(t){var i=t.fieldL.tableName+"::"+t.fieldR.tableName,r=n[i];r||(r=n[i]={tablePairKey:i,associatedFields:[],maxAssociationFieldScore:0,nameBasedAssociationFields:[],maxNameBasedAssociationFieldScore:0}),r.associatedFields.push(t),r.maxAssociationFieldScore=Math.max(r.maxAssociationFieldScore,t.associationScore),t.associationScore>=.75&&(e.getNonQualifiedFieldName(t.fieldL.tableName,t.fieldL.fieldName)||t.fieldL.fieldName)===(e.getNonQualifiedFieldName(t.fieldR.tableName,t.fieldR.fieldName)||t.fieldR.fieldName)&&(r.nameBasedAssociationFields.push(t),r.maxNameBasedAssociationFieldScore=Math.max(r.maxNameBasedAssociationFieldScore,t.associationScore))});for(var i in n)!function(e){var t=n[e];if(t.nameBasedAssociationFields.length){var i=Math.min(1,t.maxAssociationFieldScore+.02),r=i-.01,o=i-.02;t.associatedFields.forEach(function(e){e.associationScore>o&&t.nameBasedAssociationFields.indexOf(e)<0&&(e.associationScore=o)}),t.nameBasedAssociationFields.forEach(function(e){e.associationScore=e.associationScore===t.maxNameBasedAssociationFieldScore?i:r})}}(i);return t},e.setAssociationGraph=function(e,t){var n={};t.forEach(function(t){n[t.name]=[],t.links.forEach(function(i){e.getTargetTableModelById(i.query.id)&&e.getTargetTableModelById(i.query.id).setUpdateStatus(),n[t.name].push({tableId:i.query.id,fieldId:i.field.id})})}),e.associations=n},e.hasCycle=function(t,n){var i={};return Object.keys(t).forEach(function(e){t[e].forEach(function(e){i[e.tableId]=i[e.tableId]?i[e.tableId]:{tableId:e.tableId,color:0,children:[]}})}),Object.keys(t).forEach(function(e){t[e].forEach(function(n){var r=i[n.tableId];t[e].forEach(function(e){var t=i[e.tableId];t!==r&&-1===r.children.indexOf(t)&&r.children.push(t)})})}),!!i[n]&&e.visit(i[n],i[n])},e.isSafeToAssociate=function(t,n,i,r,o){if(e.getAssociationNamesBetween(t,n,null,r,null).length>0)return!1;var s=t.clone(),a=s.getTargetTableModel(n.data.name),l=s.getTargetTableModel(r.data.name),c=0===e.getAssociationNames(s,a).length||0===e.getAssociationNames(s,l).length;return e.addAssociationBetween(s,a,i,l,o),c||!e.hasCycle(s.associations,a.data.id)},e.visit=function(t,n){if(1===t.color)return!0;t.color=1;for(var i=0;i<t.children.length;i++){var r=t.children[i];if(r!==n&&e.visit(r,t))return!0}return t.color=2,!1},e.getFieldName2TargetTablesMap=function(t,n,i){var r={};return(i?t.targetTableModels.filter(i):t.targetTableModels).forEach(function(t){t.getFields().forEach(function(i){var o=i.name;if(n){var s=e.getNonQualifiedFieldName(t.data.name,i.name);o=s||o}r[o]||(r[o]=[]),r[o].push({table:t,field:i.name})})}),r},e.hasGoodScore=function(e,t,i,r){function o(e,t){return e.tableName===t.table.data.name&&e.fieldName===t.field}if(!t.result||!t.result.associatedFields)return!1;var s;return(s=n.find(t.result.associatedFields,function(e){return o(e.fieldL,i)&&o(e.fieldR,r)||o(e.fieldL,r)&&o(e.fieldR,i)}))&&s.associationInfo.score>=.75},e.createSerializedNode=function(t,n){var i=t.data.id,r=n?e.getTargetFieldByName(t,n):void 0;return{tableId:i,fieldId:r?r.id:void 0}},e._generateAssociationName=function(t,n,i,r,o){var s,a=e.getAssociationNames(t,n,i);if(a&&a.length>=1)return a[0];var l=e.getAssociationNames(t,r,o);if(l&&l.length>=1)return l[0];var c=e.getNonQualifiedFieldName(n.data.name,i),u=e.getNonQualifiedFieldName(r.data.name,o);return c&&u&&c===u&&!e.getAssociation(t,c)?c:i===u?i:o===c?o:c&&u&&(s=[c,u].sort().join("-"),!e.getAssociation(t,s))?s:c&&!u&&(s=[c,o].sort().join("-"),!e.getAssociation(t,s))||!c&&u&&(s=[i,u].sort().join("-"),!e.getAssociation(t,s))?s:[i,o].sort().join("-")},e.cleanUpKey=function(e){return e.replace(/^_/,"-").replace(/\\/g,"-").replace(/\//g,"-").replace(/"/g,"'")},e.cleanUpQualifiedNamePart=function(e){return e.replace(/[\.]/g,"..")},e.getNonQualifiedFieldName=function(t,n){var i=e.cleanUpQualifiedNamePart(t);return 0!==n.lastIndexOf(i+".",0)?null:n.substring(i.length+1).split("..").join(".")},e}();t.LoadModelAssociations=o}),define("assets/load-model/operations/forced-concat-operation",["require","exports","underscore","../dsm-types","./concat-operations"],function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){return function(){}}();t.QueryFieldMapping=o;var s=function(){function e(e){this.targetTable=e}return e.prototype.getConcatenationInfo=function(){var e={totalFields:0,totalConcatFields:0,fieldsMapped:0};return this.targetTable.getFields().forEach(function(t){e.totalFields++,t.type===i.DSMTypes.CompositeQueryField.name&&(e.totalConcatFields++,t.sourceFieldRefs.length>1&&e.fieldsMapped++)}),e},e.prototype.populateForcedConcatenation=function(e,t,n,i,o){i.forEach(function(n){t.removeTargetTableModel(n,!0),e.addSourceQuery(n.data)}),o&&0!==o.length||(o=this.createMapping(i,t)),this.generateConcatenationFields(e,o);var s=i.map(function(e){return e.data});return r.ConcatOperations.migrateAssociations(s,e,t),this.matchGeoFields(e,t),e},e.prototype.splitConcatenatedQuery=function(e,t){this.restoreAssociations(e,t);var n=[];return e.getSourceQueries().forEach(function(e){var i=t.addAsTargetTableModel(e);n.push(i)}),t.removeTargetTableModel(e,!0),e.setUpdateStatus(),n},e.prototype.matchGeoFields=function(e,t){e.getFields().forEach(function(n){if(t.wrapInFieldModel(n).isGeographical()&&n.sourceFieldRefs.length>0){var r=e.getGeoRelatedFields(n,!0);if(r.length>0){var o=e.createField(n.name+"_GeoInfo",i.DSMTypes.CompositeQueryField.name);r.forEach(function(e){o.addSourceField(e)})}}})},e.prototype.createMapping=function(e,t){for(var n=[],r=0;r<e.length;r++)for(var s=e[r].getFields(),a=0;a<s.length;a++){var l=s[a];e[r].wasGeneratedByTransformation(l,i.DSMTypes.QueryTransformField.name,[i.DSMTypes.Transformations.lookupGeoInfo])||(n[a]?n[a].sourceFields.push(l):(n[a]=new o,n[a].name=l.name,n[a].sourceFields=[],n[a].sourceFields.push(l)))}return n},e.prototype.generateConcatenationFields=function(e,t){t.forEach(function(t){var r,o=e.createField(t.name,i.DSMTypes.CompositeQueryField.name),s=!0;t.sourceFields.forEach(function(e,t){0===t?r=e.classifications:s&&(s=n.isEqual(r,e.classifications)),o.addSourceField(e)}),o.data.classifications=s&&r?r:[]})},e.prototype.restoreAssociations=function(e,t){t.findAssociations(e.data.id).forEach(function(e){t.removeAssociation(e.getName())})},e}();t.ForceConcateOperations=s}),define("assets/load-model/association",["require","exports","underscore"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.data=e,this.name=t}return e.prototype.getName=function(){return this.name},e.prototype.getFieldsReferencing=function(e){var t=new Array;return this.data.forEach(function(n){n.tableId===e.id&&t.push(n)}),t},e.prototype.replaceFieldReferences=function(e,t,n){for(var i=this.data.length-1;i>=0;i--){var r=this.data[i];r.tableId===e.tableId&&r.fieldId===e.fieldId&&(this.hasMappingForTable(t.id)?this.data.splice(i,1):(r.tableId=t.id,r.fieldId=n.id))}},e.prototype.getUniqueTableReferenceCount=function(){var e={};return this.data.forEach(function(t){e[t.tableId]=!0}),Object.keys(e).length},e.prototype.hasMappingForTable=function(e){var t=!1;return n.findWhere(this.data,{tableId:e})&&(t=!0),t},e}();t.Association=i}),define("assets/load-model/defaults",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){e.gInstance=this}return e.instance=function(){return e.gInstance},e.prototype.setTreatConcatAsForcedConcat=function(e){this.concatAsForcedConcat=e},e.prototype.isTreatConcatAsForcedConcat=function(){return this.concatAsForcedConcat},e}();n.gInstance=new n,t.Defaults=n}),define("assets/load-model/services/ds-fields-qualifications",["require","exports","../dsm-types"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.qualifyDuplicatedFieldNames=function(t,n){return e.qualifyNewDuplicatedFieldNamesImpl(t,n,!1)},e.qualifyNewDuplicatedFieldNames=function(t,n,i){return e.qualifyNewDuplicatedFieldNamesImpl(t,n,i)},e.qualifyNewDuplicatedFieldNamesImpl=function(t,i,r){var o=t.tableModels.reduce(function(e,t){return e[t.getTableAlias()]=t,e},{}),s=i.tableModels.filter(function(e){return!!o[e.getTableAlias()]}),a=i.tableModels.filter(function(e){return!o[e.getTableAlias()]});r&&(a=a.filter(function(t){var n=e.findTableWithSameFields(s,t);return!n||(e.applySameFieldAliases(n,t),!1)}));var l=[];a.forEach(function(t,n){var i=null;if(r&&n>0&&(i=e.findTableWithSameFields(a.slice(0,n),t)),i){var o=t.data.fields.filter(e.selectedFieldFilter).reduce(function(n,i){return n[e.getUnqualifiedFieldName(t,i)]=i,n},{});l.filter(function(e){return e.table===i}).forEach(function(n){var i=e.getUnqualifiedFieldName(n.table,n.field);n.links=n.links||[],n.links.push({table:t,field:o[i]})})}else l=l.concat(t.data.fields.filter(e.selectedFieldFilter).map(function(e){return{table:t,field:e}}))});var c=[];s.forEach(function(t){var n=e.getSelectedFieldsByName(o[t.getTableAlias()]);l=l.concat(t.data.fields.filter(e.selectedFieldFilter).filter(function(e){return!n[e.name]}).map(function(e){return{table:t,field:e}})),c=t.data.fields.filter(e.selectedFieldFilter).filter(function(e){var t=n[e.name];return!(!t||t.alias===e.alias)}).map(function(e){return{table:t,field:e}})});var u=s.reduce(function(t,n){var i=o[n.getTableAlias()],r=e.getSelectedFieldsByName(i);return n.data.fields.filter(e.selectedFieldFilter).filter(function(e){return!!r[e.name]}).forEach(function(e){var i=n.getFieldAlias(e.name);t[i]=(t[i]||0)+1}),t},{});t.targetTableModels.forEach(function(e){e.data.fields.filter(function(e){return e.type!==n.DSMTypes.QueryField.name}).forEach(function(e){u[e.name]=(u[e.name]||0)+1})});var h=l.reduce(function(e,t){var n=t.table.getFieldAlias(t.field.name);return e[n]=(e[n]||0)+1,e},{});this.qualifyFieldName(l,u,h,i,!0),this.qualifyFieldName(c,u,h,i,!1)},e.shouldQualifyWithTableGroupId=function(e,t){var n=t.table,i=t.field,r=!1;return n.data.tableGroupId&&n.data.lockSameGroupAssociations&&(r=e,n.data.tableGroupDirections&&n.data.tableGroupDirections.qualify&&(r=!1,i.tableGroupFieldInfo&&i.tableGroupFieldInfo.isKey&&(r=!0))),r},e.qualifyFieldName=function(t,n,i,r,o){t.forEach(function(t){var s=t.table.getFieldAlias(t.field.name),a=!0;t.table.data.connectionInfo&&"script"===t.table.data.connectionInfo.typeName&&(a=!1);var l=o?0:1,c=n[s]>l||i[s]>1;if(a&&(c||e.shouldQualifyWithTableGroupId(c,t))){var u=t.table.getFieldQualifiedName(s),h=u,d=1;if(e.shouldQualifyWithTableGroupId(c,t))u=t.table.data.tableGroupId+"."+s;else for(;r.isFieldNameInUse(u);)d++,u=h+"_"+d;t.table.setFieldAlias(t.field.name,u),t.links&&t.links.forEach(function(e){e.table.setFieldAlias(e.field.name,u)})}})},e.selectedFieldFilter=function(e){return e.selected},e.getSelectedFieldsByName=function(t){return t.data.fields.filter(e.selectedFieldFilter).reduce(function(e,t){return e[t.name]=t,e},{})},e.getUnqualifiedFieldName=function(e,t){var n=t.alias?t.alias:t.name;if(t.alias!==t.name){var i=e.getFieldQualifiedName("");if(0===n.indexOf(i)&&n.length>i.length){o=n.substr(i.length).replace(/\.\./g,".");return(r=e.getTableGroupId())&&0===o.indexOf(r+".")&&(o=o.substring(r.length+1)),o}var r=e.getTableGroupId(),o=n;if(r&&0===o.indexOf(r+"."))return o=o.substring(r.length+1)}return n},e.findTableWithSameFields=function(t,n){function i(t){var n=t.data.fields.filter(e.selectedFieldFilter).map(function(n){return e.getUnqualifiedFieldName(t,n).replace(/|/g,"||")});return n.sort(),n}for(var r=null,o=i(n).join("|"),s=0;s<t.length;s++){var a=t[s];if(a!==n&&o===i(a).join("|")){r=a;break}}return r},e.applySameFieldAliases=function(t,n){var i=t.data.fields.reduce(function(n,i){return n[e.getUnqualifiedFieldName(t,i)]=t.getFieldAlias(i.name),n},{});n.data.fields.forEach(function(t){var r=e.getUnqualifiedFieldName(n,t),o=i[r];o&&o!==r&&n.setFieldAlias(t.name,o)})},e}();i.FLAGS={DetectAutoConcatenate:{Yes:!0,No:!1}},t.DSFieldsQualifications=i}),define("assets/load-model/script-table-updater",["require","exports","./services/ds-fields-qualifications","underscore"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n){this.scratchModel=e,this.targetModel=n?t.rawClone():t}return e.prototype.update=function(e,t,i){this.addTables(e);var r=this.copyAndPruneTables(t,e,i);return n.DSFieldsQualifications.qualifyDuplicatedFieldNames(this.scratchModel,this.targetModel),r},e.prototype.setUserScriptConnectionMetadata=function(e){var t={name:"script",id:"",type:{provider:"script",type:"",displayName:"",connectDialog:"",selectDialog:"",connectorMain:"",needsConnect:!1,isStandardConnector:!0},typeName:"script",privileges:["read","update","delete"],canDelete:!0,sourceConnectorID:"",connectionString:""},n={dbusage:!1,ownerusage:!1,dbfirst:!1,specialchars:"",dbseparator:"",ownerseparator:"",quotesuffix:"",quoteprefix:"",quotesuffixfordoublequotes:"",quoteprefixfordoublequotes:"",keywords:[]};return e.setMetadataModelForConnection(t,n),t},e.prototype.addTables=function(e){var t=this;e.tables.forEach(function(e){if("ScriptTable"===e.sourceType){var n=e.name,i=t.setUserScriptConnectionMetadata(t.scratchModel),r=t.scratchModel.getOrCreateTableModelByDatabasePath(i,"script","",n,void 0);r.setCachingEnabled(!1,""),e.fields.forEach(function(e){r.setFieldSelected(e.name,!0)})}})},e.prototype.addChangeNotification=function(e,t,n,r){if("new"===r)(o=i.findWhere(n.new,{table:e}))||(o={table:e},void 0!==t?n.modified.push(o):n.new.push(o));else{var o=i.findWhere(n.removed,{table:e});o||(o={table:e,fields:[]}),t?(-1!==o.fields.indexOf(t)&&o.fields.push(t),n.modified.push(o)):n.removed.push(o)}},e.prototype.copyAndPruneTables=function(e,t,n){var r=this,o={new:[],removed:[],modified:[]};this.scratchModel.tableModels.length>0&&this.setUserScriptConnectionMetadata(this.targetModel),this.scratchModel.tableModels.forEach(function(t){var n=r.targetModel.getTableModelByDatabasePath(t.data.connectionInfo,t.data.databaseName,t.data.ownerName,t.data.tableName);if(n){for(var s=n.data.fields,a=s.length-1;a>=0;a--)i.findWhere(t.data.fields,{name:s[a]})||(r.addChangeNotification(t.data.tableName,s[a].name,o,"remove"),s.splice(a,1));t.data.fields.forEach(function(e){i.findWhere(n.data.fields,{name:e.name})||(r.addChangeNotification(t.data.tableName,e.name,o,"new"),n.setFieldSelected(e.name,!0))})}else r.addChangeNotification(t.data.tableName,void 0,o,"new"),r.targetModel.tableModels.push(t),n=t;n.setSimpleSelectStatement(e.generateLoadSelect(n)),n.addSelectLoadProperty({residentInfo:{isResident:!0}})});for(var s=this.targetModel.tableModels,a=this,l=s.length-1;l>=0;l--)!function(e){var t=s[e];if("script"===t.data.connectionInfo.typeName){var l=i.findWhere(n,{table:t.data.tableName});if(l){for(var c=t.data.fields,u=c.length-1;u>=0;u--)-1===l.fields.indexOf(t.data.fields[u].name)&&(a.addChangeNotification(t.data.tableName,t.data.fields[u].name,o,"remove"),t.data.fields.splice(u,1));l.fields.forEach(function(e,n){i.findWhere(c,{name:e})||(t.addField(e,n,!0),r.addChangeNotification(t.data.tableName,e,o,"new"))})}else s[e].data.fields.length>0&&(a.addChangeNotification(t.data.tableName,void 0,o,"remove"),s[e].data.fields.length=0)}}(l);return o},e}();t.ScriptTableUpdater=r}),define("assets/load-model/load-model",["require","exports","underscore","./calendar","./dsm-types","./query-generator","./target-table-model","./input-table-model","./load-model-associations","./shared-util","./load-model-ids","./operations/forced-concat-operation","./association","./query-field","./defaults","./script-table-updater"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=function(){function e(){this.queries=[],this.tableModels=[],this.targetTableModels=[],this.associations={},this.connectionMetaDataModels={},this.locale=i.Calendar.GetDefaultCalendarModel().locale,this.defaultCalendar=i.Calendar.GetDefaultCalendarModel().calendar,this.tempCounter=0,this.TEMP_NAME_PREFIX="9576934875038746211194868"}return e.CreateLoadModel=function(t,n){void 0===n&&(n=!0);var i=new e;return i.overwriteContent(t,n),i},e.findQueryByIdImpl=function(t,n){for(var i=void 0,r=0;r<t.length;r++){if(t[r].id===n){i=t[r];break}if(t[r].sourceQueries){var o=new s.TargetTableModel(t[r]).getSourceQueries(),a=e.findQueryByIdImpl(o,n);if(a){i=a;break}}}return i},e.prototype.getLocale=function(){return this.locale},e.prototype.wrapInTargetTableModel=function(e){return new s.TargetTableModel(e)},e.prototype.wrapInFieldModel=function(e){return new p.QueryField(e)},e.prototype.setMetadataModelForConnection=function(e,t){this.connectionMetaDataModels[e.name]=c.SharedUtil.extend(!0,{},e,{dbInfo:t})},e.prototype.getTableModelByDatabasePath=function(e,t,n,i,r){for(var o in this.tableModels)if(this.tableModels[o].data.dataconnectorName===e.name&&this.tableModels[o].data.databaseName===t&&this.tableModels[o].data.ownerName===n&&this.tableModels[o].data.tableName===i){if(!r)return this.tableModels[o];if(this.tableModels[o].data.tableAlias===r)return this.tableModels[o]}},e.prototype.getOrCreateTableModelWithAliasByDatabasePath=function(e,t,n,i,r,o){var s=this.getTableModelByDatabasePath(e,t,n,i,r);if(s)return s;var a=e.typeName?e.typeName:e.type,l={dataconnectorName:e.name,boxType:"folder"===a||"internet"===a?"load-file":"load-sql",databaseName:t,ownerName:n,tableName:i,tableAlias:this.getUniqueTableName(i),loadProperties:o,key:e.name+":"+t+":"+n+":"+i,fields:[],connectionInfo:this.getConnectionMetaDataModel(e.name),state:"new"};return this.createAndAddToCollection(this.tableModels,l)},e.prototype.getOrCreateTableModelByDatabasePath=function(e,t,n,i,r){return this.getOrCreateTableModelWithAliasByDatabasePath(e,t,n,i,void 0,r)},e.prototype.getDataconnectorSelectionEditor=function(e){return{getTableModelByDatabasePath:this.getTableModelByDatabasePath.bind(this,e),getOrCreateTableModelByDatabasePath:this.getOrCreateTableModelByDatabasePath.bind(this,e),getOrCreateTableModelWithAliasByDatabasePath:this.getOrCreateTableModelWithAliasByDatabasePath.bind(this,e),setMetadataModelForConnection:this.setMetadataModelForConnection.bind(this,e)}},e.prototype.generateSourceFieldIds=function(){this.tableModels.forEach(function(e){e.updateId()})},e.prototype.serialize=function(){return this.generateSourceFieldIds(),this.updateQueries(this.tableModels.map(function(e){return e.data})),l.LoadModelAssociations.updateAssociations(this),this._rawSerialize()},e.prototype.changeTableFieldAlias=function(e,t,i){var r=this.findTableByKey(e);return!n.find(r.data.fields,function(e){return e.alias===i})&&(r.changeFieldAlias(t,i),!0)},e.prototype.qualifyTableField=function(e,t){var n=this.findTableByKey(e);if(n){var i=n.getOriginalFieldNameFromAlias(t);this.isFieldNameInUse(i)&&(i=n.data.tableName+"."+i),i===t&&(i+="_"),n.changeFieldAlias(t,i)}},e.prototype.qualifyTableFields=function(e,t,n,i){var r=this.TEMP_NAME_PREFIX+this.tempCounter++,o=this.TEMP_NAME_PREFIX+this.tempCounter++,s=this.findTableByKey(e),a=this.findTableByKey(n),l=s.getOriginalFieldNameFromAlias(t),c=a.getOriginalFieldNameFromAlias(i);s.changeFieldAlias(t,r),a.changeFieldAlias(i,o),s.isFieldNameInUse(l)?s.changeFieldAlias(r,s.data.tableName+"."+t):s.changeFieldAlias(r,l),a.isFieldNameInUse(c)||c===l?a.changeFieldAlias(o,a.data.tableName+"."+i):a.changeFieldAlias(o,c)},e.prototype.clone=function(){return e.CreateLoadModel(this.serialize())},e.prototype.rawClone=function(){return e.CreateLoadModel(this._rawSerialize())},e.prototype.removeAllFieldsMarkedForDeletion=function(){var e=this;this.targetTableModels.filter(function(e){return e.isMarkedForDeletion()}).forEach(function(t){e.getSourceTableByTableRefId(t.data.tableRef).data.fields=[],t.data.fields=[]}),this.removeUnusedConnections()},e.prototype.removeAllTablesMarkedForDeletion=function(){var e=this;this.targetTableModels.filter(function(e){return e.isMarkedForDeletion()}).forEach(function(t){e._removeTargetTable(t.data.name,!1)}),this.removeUnusedConnections()},e.prototype.updateQueriesStatus=function(e){var t=this;this.targetTableModels.filter(function(e){return"Query"===e.data.type&&e.isInSynchWithMaster()}).forEach(function(n){var i=n.data.id,r=t.getSourceTableByQueryId(i),o=e.getSourceTableByQueryId(i);r&&o&&(r.data.loadSelectStatement!==o.data.loadSelectStatement||r.data.selectStatement!==o.data.selectStatement)&&n.setUpdateStatus()})},e.prototype.resetLoadModel=function(){return this.updateProperties(e.CreateLoadModel({}).serialize())},e.prototype.getTargetTable=function(e){return n.find(this.queries,function(t){return t.name===e})},e.prototype.updateTargetTableWithTransformation=function(e,t){var n=this.getTargetTableModelById(e);return(!n.isDirty()||n.isUpdated())&&(t.status=r.DSMTypes.QueryStatus.update),this.removeTargetTableAndModel(n,!0),this.addQueryAndCreateTargetTableModel(t)},e.prototype.replaceTargetTableWithSourceQueries=function(e){var t=this.getTargetTableModelById(e),n=t.getSourceQueries()[0];return(!t.isDirty()||t.isUpdated())&&(n.status=r.DSMTypes.QueryStatus.update),this.removeTargetTableAndModel(t,!0),this.addQueryAndCreateTargetTableModel(n)},e.prototype.renameTargetTable=function(e,t){var n=this.getTargetTableModel(e);n.setUpdateStatus(),n.rename(t)},e.prototype.renameTargetTableField=function(e,t,n){var i=this,o=this.getTargetTableModel(e);o.setUpdateStatus();var s=o.data;(s.type===r.DSMTypes.ConcatenationQuery.name&&!f.Defaults.instance().isTreatConcatAsForcedConcat()||s.type===r.DSMTypes.CrossTableQuery.name)&&s.sourceQueries&&s.sourceQueries.forEach(function(e){i.renameQueryField(e,t,n)}),s.fields&&this.renameQueryField(s,t,n)},e.prototype.updateScriptTables=function(t,n,i,r){var o=e.CreateLoadModel({});return new m.ScriptTableUpdater(o,this,r).update(t,n,i)},e.prototype.unconcatenateTargetTable=function(e,t){var i=this,o=this.getTargetTableModel(e),a=o.data,l=[];t&&t.forEach(function(e){var t=n.findWhere(a.sourceQueries,{id:e});t&&l.push(t)});var c=l;0===c.length&&(c=a.sourceQueries),c&&(c.forEach(function(e){var t=this;e.fields.forEach(function(n){t.renameQueryField(e,n.name,e.name+"."+n.name)})}.bind(this)),a.fields.forEach(function(e){if(o.wasGeneratedByTransformation(e,r.DSMTypes.QueryTransformField.name,[r.DSMTypes.Transformations.lookupGeoInfo,r.DSMTypes.Transformations.geoPoint])){var t,n=e.transformations[0].appliedTo,a=[];n instanceof Array?n.forEach(function(e){var n=o.getField(e);n&&(a.push(n),n.transformations&&n.transformations.length>0&&(t=n))}):(t=o.getField(e.transformations[0].appliedTo),a.push(t)),c.forEach(function(n){var r,o=new s.TargetTableModel(n),l=[];if(n.fields.forEach(function(e){a.forEach(function(n){-1!==n.sourceFieldRefs.indexOf(e.id)&&(l.push(e),n===t&&(r=e))})}),r){var c=JSON.parse(JSON.stringify(e.transformations[0]));l.length>1?c.appliedTo=[l[0].id,l[1].id]:c.appliedTo=l[0].id,o.updateFieldTransformation(i,r.id,c.op,c,"en-US")}})}})),o.setUpdateStatus()},e.prototype.getTargetTableFieldsByName=function(e){return this.getFieldsByName(e,this.queries)},e.prototype.isTargetTableFieldNameInUse=function(e){return this.getFieldsByName(e,this.queries).length>0},e.prototype.isTargetTableNameInUse=function(e,t){var i=!1;t||(t=[]);var r=this.queries.filter(function(e){return!n.contains(t,e.name)});return n.each(r,function(t){i||t.name!==e||(i=!0),!i&&t.sourceQueries&&(i=n.any(t.sourceQueries,function(t){return t.name===e}))}),i},e.prototype.getSourceFieldsByAlias=function(e){var t=[],i=function(t){return t.alias===e};return this.tableModels.forEach(function(e){var r=n.find(e.data.fields,i);r&&t.push(r)}),t},e.prototype.getTargetTableModelById=function(e){return n.find(this.targetTableModels,function(t){return t.data.id===e})},e.prototype.findQueryById=function(t){var n=this.getTargetTableModelById(t);if(n)return n;var i=e.findQueryByIdImpl(this.queries,t);return i?this.wrapInTargetTableModel(i):void 0},e.prototype.resetTargetTablesStatuses=function(){this.targetTableModels.forEach(function(e){e.resetStatus()})},e.prototype.isDirty=function(){return n.any(this.targetTableModels,function(e){return e.isDirty()})},e.prototype.hasAssociations=function(e){for(var t=Object.keys(this.associations),i=0;i<t.length;i++){var r=this.associations[t[i]];if(n.find(r,function(t){return t.tableId===e}))return!0}return!1},e.prototype.findAssociations=function(e){for(var t=Object.keys(this.associations),i=[],r=0;r<t.length;r++){var o=this.associations[t[r]];n.find(o,function(t){return t.tableId===e})&&i.push(new d.Association(o,t[r]))}return i},e.prototype.removeTargetTable=function(e,t){this.removeTargetTableImpl(e,t,!0)},e.prototype.removeTargetTableModel=function(e,t){this.removeTargetTableAndModel(e,t)},e.prototype.addTargetTableModel=function(e){this.queries.push(e.data),this.targetTableModels.push(e)},e.prototype.addAsTargetTableModel=function(e){this.queries.push(e);var t=new s.TargetTableModel(e);return this.targetTableModels.push(t),t},e.prototype.removeAssociation=function(e){delete this.associations[e]},e.prototype.addInlineTableModel=function(e,t,n){var i=this.getUniqueTableName(e),r={databaseName:"inlinedata",dataconnectorName:"inlinedata",tableName:i,tableAlias:i,key:"inlinedata."+i,connectionInfo:{name:"inlinedata",typeName:"inlinedata",type:{provider:"inlinedata",type:"inlinedata"}},loadStatementModel:{type:"inlinedata",data:n},caching:{enabled:!1,type:"qvd"},fields:[],state:"new"},o=new a.InputTableModel(r);return t.forEach(function(e,t){o.addField(e,t,!0)}),this.tableModels.push(o),this.connectionMetaDataModels.inlinedata||(this.connectionMetaDataModels.inlinedata=r.connectionInfo),r},e.prototype.createForcedConcatenationQuery=function(e,t,n){var i=s.TargetTableModel.CreateTargetTableModel({type:r.DSMTypes.ForcedConcatenationQuery.name,name:e,id:u.LoadModelIds.generateUUID()});return(new h.ForceConcateOperations).populateForcedConcatenation(i,this,e,t,n),this.addTargetTableModel(i),i},e.prototype.splitQuery=function(e){return(new h.ForceConcateOperations).splitConcatenatedQuery(e,this)},e.prototype.getTargetTableModel=function(e){return n.find(this.targetTableModels,function(t){return t.data.name===e})},e.prototype.addTableModel=function(e){this.tableModels.push(a.InputTableModel.create(e))},e.prototype.isFieldNameInUse=function(e){for(var t in this.tableModels)if(this.tableModels[t].isFieldNameInUse(e))return!0;return!1},e.prototype.getSourceTableByTableRefId=function(e){for(var t=0;t<this.tableModels.length;t++){var n=this.tableModels[t];if(n.data.id===e)return n}},e.prototype.removeTargetTableImpl=function(e,t,n){var i=this.getTargetTableModel(e);i.isAdded()?this._removeTargetTable(e,t):(this.removeFields(e),i.setMarkForDeletion()),n&&this.setProperties()},e.prototype.removeFields=function(e){var t,i,r=this,o=n.find(this.queries,function(t){return t.name===e});o&&("ConcatenationQuery"===o.type?(t=o.sourceQueries,i=n.pluck(t,"tableRef")):"Query"===o.type&&(t=[o],i=[o.tableRef]),n.each(i,function(e){var t=r.getSourceTableByTableRefId(e);t&&(t.data.fields=[])}),n.each(t,function(e){e.fields=[]}))},e.prototype._removeTargetTableImpl=function(e,t){var i=this;if(e){var r=[];e.sourceQueries&&e.sourceQueries.length>0?r=e.sourceQueries:"Query"===e.type&&(r=[e]),t||n.each(r,function(r){e.sourceQueries&&e.sourceQueries.forEach(function(e){i._removeTargetTableImpl(e,t)});var o=n.find(i.tableModels,function(e){return e.data.id===r.tableRef});if(o){var s=i.tableModels.indexOf(o);i.tableModels.splice(s,1)}});var o=this.queries.indexOf(e);e=void 0,this.queries.splice(o,1)}},e.prototype._removeTargetTable=function(e,t){var i=n.find(this.queries,function(t){return t.name===e});this._removeTargetTableImpl(i,t)},e.prototype.getConnectionMetaDataModel=function(e){return this.connectionMetaDataModels[e]},e.prototype.getTableModelWithName=function(e){for(var t in this.tableModels){var n=this.tableModels[t];if(n.getTableAlias()===e)return n}},e.prototype.getSourceTableByQueryId=function(e){for(var t=this.getQueryByQueryId(e),n=0;n<this.tableModels.length;n++){var i=this.tableModels[n];if(t&&i.data.id===t.tableRef)return i}},e.prototype.setProperties=function(){return this.updateProperties(this.serialize())},e.prototype.updateProperties=function(e){throw o.QueryGenerator.checkIntegrity(e.tables,e.queries),"Unsupported"},e.prototype.removeTargetTableAndModel=function(e,t){this._removeTargetTable(e.getName(),t);var n=this.targetTableModels.indexOf(e);this.targetTableModels.splice(n,1)},e.prototype.addQueryAndCreateTargetTableModel=function(e){this.queries.push(e);var t=this.createTargetTableModel(e);return this.targetTableModels.push(t),t},e.prototype.getQueryByQueryId=function(e){return n.find(this.queries,function(t){return t.id===e})},e.prototype.getSourceFieldById=function(e){var t=[];return this.tableModels.forEach(function(e){t=t.concat(e.data.fields)}),n.find(t,function(t){return t.id===e})},e.prototype.renameQueryField=function(e,t,i){var r=n.find(e.fields,function(e){return e.name===t});if(r){r.name=i;var o=this.getSourceFieldById(r.fieldRef);o&&(o.alias=i)}},e.prototype.getFieldsBy=function(e,t){e||(e=this.queries);var i=[];return e.forEach(function(e){var r;e.sourceQueries&&(r=[],e.sourceQueries.forEach(function(o){(r=n.find(o.fields,t))&&i.push({table:e,field:r})})),(r=n.find(e.fields,t))&&i.push({table:e,field:r})}),i},e.prototype.getFieldsByName=function(e,t){return this.getFieldsBy(t,function(t){return t.name===e})},e.prototype.createTargetTableModel=function(e){return s.TargetTableModel.CreateTargetTableModel(e)},e.prototype.createAndAddToCollection=function(e,t){var n=a.InputTableModel.create(t);return e.push(n),n},e.prototype.hasTableWithConnection=function(e){for(var t in this.tableModels)if(this.tableModels[t].data.dataconnectorName===e)return!0;return!1},e.prototype.removeUnusedConnections=function(){for(var e in this.connectionMetaDataModels)this.connectionMetaDataModels.hasOwnProperty(e)&&(this.hasTableWithConnection(e)||delete this.connectionMetaDataModels[e])},e.prototype.overwriteContent=function(e,t){var n=this;this.connectionMetaDataModels=e.connectionMetaDataModels||{},this.tableModels.splice(0,this.tableModels.length),e.tables&&e.tables.forEach(function(e){e.connectionInfo||(e.connectionInfo=n.getConnectionMetaDataModel(e.dataconnectorName)),n.addTableModel(e)}),e.queries?(this.queries.splice(0,this.queries.length),this.targetTableModels.splice(0,this.targetTableModels.length),e.queries.forEach(function(e){n.queries.push(e),n.targetTableModels.push(s.TargetTableModel.CreateTargetTableModel(e))})):this.updateQueries(e.tables),this.associations=e.associations||{},t&&l.LoadModelAssociations.updateAssociations(this),this.version++},e.prototype.updateQueries=function(e){var t=this;if(n.isEmpty(this.queries))this.queries.splice(0,this.queries.length),this.targetTableModels.splice(0,this.targetTableModels.length),o.QueryGenerator.generate(e||[],this).forEach(function(e){t.queries.push(e),t.targetTableModels.push(s.TargetTableModel.CreateTargetTableModel(e))});else{var i=[];o.QueryGenerator.updateQueries(e,this.queries,this,i),this.targetTableModels.splice(0,this.targetTableModels.length),this.queries.forEach(function(e){t.targetTableModels.push(s.TargetTableModel.CreateTargetTableModel(e))}),i.forEach(function(e){t.removeTargetTableImpl(e.name,!1,!1)})}return this.queries},e.prototype.getUniqueTableName=function(e){for(var t=0,n=e,i=e;this.getTableModelWithName(n);)n=i+"-"+ ++t;return n},e.prototype.findTableByKey=function(e){for(var t in this.tableModels)if(this.tableModels[t].data.key===e)return this.tableModels[t]},e.prototype._rawSerialize=function(){var t={connectionMetaDataModels:{},tables:this.tableModels.map(function(e){return e.isNothingSelected()&&(e.data.fields=[]),e.serialize()}),queries:[],associations:{},locale:void 0,defaultCalendar:void 0,schemaVersion:e.SCHEMA_VERSION};for(var i in this.connectionMetaDataModels)this.connectionMetaDataModels.hasOwnProperty(i)&&(t.connectionMetaDataModels[i]=c.SharedUtil.extend(!0,{},this.connectionMetaDataModels[i]));return t.queries=[],n.each(this.queries,function(e){t.queries.push(o.QueryGenerator.cloneQuery(e))}),t.associations=l.LoadModelAssociations.serializeAssociations(this),t.locale=c.SharedUtil.extend(!0,{},this.locale),t.defaultCalendar=c.SharedUtil.extend(!0,{},this.defaultCalendar),t},e}();g.SCHEMA_VERSION=2.1,t.LoadModel=g}),function(e,t){"function"==typeof define&&define.amd?define("handlebars",[],t):"object"==typeof exports?module.exports=t():e.Handlebars=e.Handlebars||t()}(this,function(){var e=function(){"use strict";function e(e){this.string=e}return e.prototype.toString=function(){return""+this.string},e}(),t=function(t){"use strict";function n(e){return o[e]}var i={},r=e,o={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},s=/[&<>"'`]/g,a=/[&<>"'`]/;i.extend=function(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e};var l=Object.prototype.toString;i.toString=l,(c=function(e){return"function"==typeof e})(/x/)&&(c=function(e){return"function"==typeof e&&"[object Function]"===l.call(e)});var c;i.isFunction=c;var u=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===l.call(e)};return i.isArray=u,i.escapeExpression=function(e){return e instanceof r?e.toString():null==e?"":e?(e=""+e,a.test(e)?e.replace(s,n):e):e+""},i.isEmpty=function(e){return!e&&0!==e||!(!u(e)||0!==e.length)},i.appendContextPath=function(e,t){return(e?e+".":"")+t},i}(),n=function(){"use strict";function e(e,n){var i;n&&n.firstLine&&(e+=" - "+(i=n.firstLine)+":"+n.firstColumn);for(var r=Error.prototype.constructor.call(this,e),o=0;o<t.length;o++)this[t[o]]=r[t[o]];i&&(this.lineNumber=i,this.column=n.firstColumn)}var t=["description","fileName","lineNumber","message","name","number","stack"];return e.prototype=new Error,e}(),i=function(e,i){"use strict";function r(e,t){this.helpers=e||{},this.partials=t||{},o(this)}function o(e){e.registerHelper("helperMissing",function(){if(1!==arguments.length)throw new l("Missing helper: '"+arguments[arguments.length-1].name+"'")}),e.registerHelper("blockHelperMissing",function(t,n){var i=n.inverse,r=n.fn;if(!0===t)return r(this);if(!1===t||null==t)return i(this);if(u(t))return t.length>0?(n.ids&&(n.ids=[n.name]),e.helpers.each(t,n)):i(this);if(n.data&&n.ids){var o=m(n.data);o.contextPath=a.appendContextPath(n.data.contextPath,n.name),n={data:o}}return r(t,n)}),e.registerHelper("each",function(e,t){if(!t)throw new l("Must pass iterator to #each");var n,i,r=t.fn,o=t.inverse,s=0,c="";if(t.data&&t.ids&&(i=a.appendContextPath(t.data.contextPath,t.ids[0])+"."),h(e)&&(e=e.call(this)),t.data&&(n=m(t.data)),e&&"object"==typeof e)if(u(e))for(var d=e.length;s<d;s++)n&&(n.index=s,n.first=0===s,n.last=s===e.length-1,i&&(n.contextPath=i+s)),c+=r(e[s],{data:n});else for(var p in e)e.hasOwnProperty(p)&&(n&&(n.key=p,n.index=s,n.first=0===s,i&&(n.contextPath=i+p)),c+=r(e[p],{data:n}),s++);return 0===s&&(c=o(this)),c}),e.registerHelper("if",function(e,t){return h(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||a.isEmpty(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers.if.call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})}),e.registerHelper("with",function(e,t){h(e)&&(e=e.call(this));var n=t.fn;if(a.isEmpty(e))return t.inverse(this);if(t.data&&t.ids){var i=m(t.data);i.contextPath=a.appendContextPath(t.data.contextPath,t.ids[0]),t={data:i}}return n(e,t)}),e.registerHelper("log",function(t,n){var i=n.data&&null!=n.data.level?parseInt(n.data.level,10):1;e.log(i,t)}),e.registerHelper("lookup",function(e,t){return e&&e[t]})}var s={},a=t,l=n;s.VERSION="2.0.0";s.COMPILER_REVISION=6;var c={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1"};s.REVISION_CHANGES=c;var u=a.isArray,h=a.isFunction,d=a.toString;s.HandlebarsEnvironment=r,r.prototype={constructor:r,logger:p,log:f,registerHelper:function(e,t){if("[object Object]"===d.call(e)){if(t)throw new l("Arg not supported with multiple helpers");a.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){"[object Object]"===d.call(e)?a.extend(this.partials,e):this.partials[e]=t},unregisterPartial:function(e){delete this.partials[e]}};var p={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(e,t){if(p.level<=e){var n=p.methodMap[e];"undefined"!=typeof console&&console[n]&&console[n].call(console,t)}}};s.logger=p;var f=p.log;s.log=f;var m=function(e){var t=a.extend({},e);return t._parent=e,t};return s.createFrame=m,s}(),r=function(e,i,r){"use strict";function o(e,t,n,i,r){var o=function(t,o){return o=o||{},n.call(e,t,e.helpers,e.partials,o.data||i,r&&[t].concat(r))};return o.program=t,o.depth=r?r.length:0,o}function s(e,t){return t&&"root"in t||((t=t?d(t):{}).root=e),t}var a={},l=t,c=n,u=r.COMPILER_REVISION,h=r.REVISION_CHANGES,d=r.createFrame;return a.checkRevision=function(e){var t=e&&e[0]||1,n=u;if(t!==n){if(t<n){var i=h[n],r=h[t];throw new c("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+i+") or downgrade your runtime to an older version ("+r+").")}throw new c("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}},a.template=function(e,t){if(!t)throw new c("No environment passed to template");if(!e||!e.main)throw new c("Unknown template object: "+typeof e);t.VM.checkRevision(e.compiler);var n={lookup:function(e,t){for(var n=e.length,i=0;i<n;i++)if(e[i]&&null!=e[i][t])return e[i][t]},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:l.escapeExpression,invokePartial:function(n,i,r,o,s,a,u,h,d){s&&(o=l.extend({},o,s));var p=t.VM.invokePartial.call(this,n,r,o,a,u,h,d);if(null==p&&t.compile){var f={helpers:a,partials:u,data:h,depths:d};u[r]=t.compile(n,{data:void 0!==h,compat:e.compat},t),p=u[r](o,f)}if(null!=p){if(i){for(var m=p.split("\n"),g=0,v=m.length;g<v&&(m[g]||g+1!==v);g++)m[g]=i+m[g];p=m.join("\n")}return p}throw new c("The partial "+r+" could not be compiled when running in runtime-only mode")},fn:function(t){return e[t]},programs:[],program:function(e,t,n){var i=this.programs[e],r=this.fn(e);return t||n?i=o(this,e,r,t,n):i||(i=this.programs[e]=o(this,e,r)),i},data:function(e,t){for(;e&&t--;)e=e._parent;return e},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n=l.extend({},t,e)),n},noop:t.VM.noop,compilerInfo:e.compiler},i=function(t,r){var o=(r=r||{}).data;i._setup(r),!r.partial&&e.useData&&(o=s(t,o));var a;return e.useDepths&&(a=r.depths?[t].concat(r.depths):[t]),e.main.call(n,t,n.helpers,n.partials,o,a)};return i.isTop=!0,i._setup=function(i){i.partial?(n.helpers=i.helpers,n.partials=i.partials):(n.helpers=n.merge(i.helpers,t.helpers),e.usePartial&&(n.partials=n.merge(i.partials,t.partials)))},i._child=function(t,i,r){if(e.useDepths&&!r)throw new c("must pass parent depths");return o(n,t,e[t],i,r)},i},a.program=o,a.invokePartial=function(e,t,n,i,r,o,s){var a={partial:!0,helpers:i,partials:r,data:o,depths:s};if(void 0===e)throw new c("The partial "+t+" could not be found");if(e instanceof Function)return e(n,a)},a.noop=function(){return""},a}(0,0,i),o=function(o,s,a,l,c){"use strict";var u=i,h=e,d=n,p=t,f=r,m=function(){var e=new u.HandlebarsEnvironment;return p.extend(e,u),e.SafeString=h,e.Exception=d,e.Utils=p,e.escapeExpression=p.escapeExpression,e.VM=f,e.template=function(t){return f.template(t,e)},e},g=m();return g.create=m,g.default=g,g}(),s=function(e){"use strict";function t(e){e=e||{},this.firstLine=e.first_line,this.firstColumn=e.first_column,this.lastColumn=e.last_column,this.lastLine=e.last_line}var i=n,r={ProgramNode:function(e,n,i){t.call(this,i),this.type="program",this.statements=e,this.strip=n},MustacheNode:function(e,n,i,o,s){if(t.call(this,s),this.type="mustache",this.strip=o,null!=i&&i.charAt){var a=i.charAt(3)||i.charAt(2);this.escaped="{"!==a&&"&"!==a}else this.escaped=!!i;e instanceof r.SexprNode?this.sexpr=e:this.sexpr=new r.SexprNode(e,n),this.id=this.sexpr.id,this.params=this.sexpr.params,this.hash=this.sexpr.hash,this.eligibleHelper=this.sexpr.eligibleHelper,this.isHelper=this.sexpr.isHelper},SexprNode:function(e,n,i){t.call(this,i),this.type="sexpr",this.hash=n;var r=this.id=e[0],o=this.params=e.slice(1);this.isHelper=!(!o.length&&!n),this.eligibleHelper=this.isHelper||r.isSimple},PartialNode:function(e,n,i,r,o){t.call(this,o),this.type="partial",this.partialName=e,this.context=n,this.hash=i,this.strip=r,this.strip.inlineStandalone=!0},BlockNode:function(e,n,i,r,o){t.call(this,o),this.type="block",this.mustache=e,this.program=n,this.inverse=i,this.strip=r,i&&!n&&(this.isInverse=!0)},RawBlockNode:function(e,n,o,s){if(t.call(this,s),e.sexpr.id.original!==o)throw new i(e.sexpr.id.original+" doesn't match "+o,this);n=new r.ContentNode(n,s),this.type="block",this.mustache=e,this.program=new r.ProgramNode([n],{},s)},ContentNode:function(e,n){t.call(this,n),this.type="content",this.original=this.string=e},HashNode:function(e,n){t.call(this,n),this.type="hash",this.pairs=e},IdNode:function(e,n){t.call(this,n),this.type="ID";for(var r="",o=[],s=0,a="",l=0,c=e.length;l<c;l++){var u=e[l].part;if(r+=(e[l].separator||"")+u,".."===u||"."===u||"this"===u){if(o.length>0)throw new i("Invalid path: "+r,this);".."===u?(s++,a+="../"):this.isScoped=!0}else o.push(u)}this.original=r,this.parts=o,this.string=o.join("."),this.depth=s,this.idName=a+this.string,this.isSimple=1===e.length&&!this.isScoped&&0===s,this.stringModeValue=this.string},PartialNameNode:function(e,n){t.call(this,n),this.type="PARTIAL_NAME",this.name=e.original},DataNode:function(e,n){t.call(this,n),this.type="DATA",this.id=e,this.stringModeValue=e.stringModeValue,this.idName="@"+e.stringModeValue},StringNode:function(e,n){t.call(this,n),this.type="STRING",this.original=this.string=this.stringModeValue=e},NumberNode:function(e,n){t.call(this,n),this.type="NUMBER",this.original=this.number=e,this.stringModeValue=Number(e)},BooleanNode:function(e,n){t.call(this,n),this.type="BOOLEAN",this.bool=e,this.stringModeValue="true"===e},CommentNode:function(e,n){t.call(this,n),this.type="comment",this.comment=e,this.strip={inlineStandalone:!0}}};return r}(),a=function(){"use strict";return function(){function e(){this.yy={}}var t={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,CONTENT:12,COMMENT:13,openRawBlock:14,END_RAW_BLOCK:15,OPEN_RAW_BLOCK:16,sexpr:17,CLOSE_RAW_BLOCK:18,openBlock:19,block_option0:20,closeBlock:21,openInverse:22,block_option1:23,OPEN_BLOCK:24,CLOSE:25,OPEN_INVERSE:26,inverseAndProgram:27,INVERSE:28,OPEN_ENDBLOCK:29,path:30,OPEN:31,OPEN_UNESCAPED:32,CLOSE_UNESCAPED:33,OPEN_PARTIAL:34,partialName:35,param:36,partial_option0:37,partial_option1:38,sexpr_repetition0:39,sexpr_option0:40,dataName:41,STRING:42,NUMBER:43,BOOLEAN:44,OPEN_SEXPR:45,CLOSE_SEXPR:46,hash:47,hash_repetition_plus0:48,hashSegment:49,ID:50,EQUALS:51,DATA:52,pathSegments:53,SEP:54,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",12:"CONTENT",13:"COMMENT",15:"END_RAW_BLOCK",16:"OPEN_RAW_BLOCK",18:"CLOSE_RAW_BLOCK",24:"OPEN_BLOCK",25:"CLOSE",26:"OPEN_INVERSE",28:"INVERSE",29:"OPEN_ENDBLOCK",31:"OPEN",32:"OPEN_UNESCAPED",33:"CLOSE_UNESCAPED",34:"OPEN_PARTIAL",42:"STRING",43:"NUMBER",44:"BOOLEAN",45:"OPEN_SEXPR",46:"CLOSE_SEXPR",50:"ID",51:"EQUALS",52:"DATA",54:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[10,3],[14,3],[9,4],[9,4],[19,3],[22,3],[27,2],[21,3],[8,3],[8,3],[11,5],[11,4],[17,3],[17,1],[36,1],[36,1],[36,1],[36,1],[36,1],[36,3],[47,1],[49,3],[35,1],[35,1],[35,1],[41,2],[30,1],[53,3],[53,1],[6,0],[6,2],[20,0],[20,1],[23,0],[23,1],[37,0],[37,1],[38,0],[38,1],[39,0],[39,2],[40,0],[40,1],[48,1],[48,2]],performAction:function(e,t,n,i,r,o,s){var a=o.length-1;switch(r){case 1:return i.prepareProgram(o[a-1].statements,!0),o[a-1];case 2:this.$=new i.ProgramNode(i.prepareProgram(o[a]),{},this._$);break;case 3:case 4:case 5:case 6:this.$=o[a];break;case 7:this.$=new i.ContentNode(o[a],this._$);break;case 8:this.$=new i.CommentNode(o[a],this._$);break;case 9:this.$=new i.RawBlockNode(o[a-2],o[a-1],o[a],this._$);break;case 10:this.$=new i.MustacheNode(o[a-1],null,"","",this._$);break;case 11:this.$=i.prepareBlock(o[a-3],o[a-2],o[a-1],o[a],!1,this._$);break;case 12:this.$=i.prepareBlock(o[a-3],o[a-2],o[a-1],o[a],!0,this._$);break;case 13:case 14:this.$=new i.MustacheNode(o[a-1],null,o[a-2],i.stripFlags(o[a-2],o[a]),this._$);break;case 15:this.$={strip:i.stripFlags(o[a-1],o[a-1]),program:o[a]};break;case 16:this.$={path:o[a-1],strip:i.stripFlags(o[a-2],o[a])};break;case 17:case 18:this.$=new i.MustacheNode(o[a-1],null,o[a-2],i.stripFlags(o[a-2],o[a]),this._$);break;case 19:this.$=new i.PartialNode(o[a-3],o[a-2],o[a-1],i.stripFlags(o[a-4],o[a]),this._$);break;case 20:this.$=new i.PartialNode(o[a-2],void 0,o[a-1],i.stripFlags(o[a-3],o[a]),this._$);break;case 21:this.$=new i.SexprNode([o[a-2]].concat(o[a-1]),o[a],this._$);break;case 22:this.$=new i.SexprNode([o[a]],null,this._$);break;case 23:this.$=o[a];break;case 24:this.$=new i.StringNode(o[a],this._$);break;case 25:this.$=new i.NumberNode(o[a],this._$);break;case 26:this.$=new i.BooleanNode(o[a],this._$);break;case 27:this.$=o[a];break;case 28:o[a-1].isHelper=!0,this.$=o[a-1];break;case 29:this.$=new i.HashNode(o[a],this._$);break;case 30:this.$=[o[a-2],o[a]];break;case 31:this.$=new i.PartialNameNode(o[a],this._$);break;case 32:this.$=new i.PartialNameNode(new i.StringNode(o[a],this._$),this._$);break;case 33:this.$=new i.PartialNameNode(new i.NumberNode(o[a],this._$));break;case 34:this.$=new i.DataNode(o[a],this._$);break;case 35:this.$=new i.IdNode(o[a],this._$);break;case 36:o[a-2].push({part:o[a],separator:o[a-1]}),this.$=o[a-2];break;case 37:this.$=[{part:o[a]}];break;case 38:this.$=[];break;case 39:o[a-1].push(o[a]);break;case 48:this.$=[];break;case 49:o[a-1].push(o[a]);break;case 52:this.$=[o[a]];break;case 53:o[a-1].push(o[a])}},table:[{3:1,4:2,5:[2,38],6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],31:[2,38],32:[2,38],34:[2,38]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:[1,10],13:[1,11],14:16,16:[1,20],19:14,22:15,24:[1,18],26:[1,19],28:[2,2],29:[2,2],31:[1,12],32:[1,13],34:[1,17]},{1:[2,1]},{5:[2,39],12:[2,39],13:[2,39],16:[2,39],24:[2,39],26:[2,39],28:[2,39],29:[2,39],31:[2,39],32:[2,39],34:[2,39]},{5:[2,3],12:[2,3],13:[2,3],16:[2,3],24:[2,3],26:[2,3],28:[2,3],29:[2,3],31:[2,3],32:[2,3],34:[2,3]},{5:[2,4],12:[2,4],13:[2,4],16:[2,4],24:[2,4],26:[2,4],28:[2,4],29:[2,4],31:[2,4],32:[2,4],34:[2,4]},{5:[2,5],12:[2,5],13:[2,5],16:[2,5],24:[2,5],26:[2,5],28:[2,5],29:[2,5],31:[2,5],32:[2,5],34:[2,5]},{5:[2,6],12:[2,6],13:[2,6],16:[2,6],24:[2,6],26:[2,6],28:[2,6],29:[2,6],31:[2,6],32:[2,6],34:[2,6]},{5:[2,7],12:[2,7],13:[2,7],16:[2,7],24:[2,7],26:[2,7],28:[2,7],29:[2,7],31:[2,7],32:[2,7],34:[2,7]},{5:[2,8],12:[2,8],13:[2,8],16:[2,8],24:[2,8],26:[2,8],28:[2,8],29:[2,8],31:[2,8],32:[2,8],34:[2,8]},{17:21,30:22,41:23,50:[1,26],52:[1,25],53:24},{17:27,30:22,41:23,50:[1,26],52:[1,25],53:24},{4:28,6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],28:[2,38],29:[2,38],31:[2,38],32:[2,38],34:[2,38]},{4:29,6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],28:[2,38],29:[2,38],31:[2,38],32:[2,38],34:[2,38]},{12:[1,30]},{30:32,35:31,42:[1,33],43:[1,34],50:[1,26],53:24},{17:35,30:22,41:23,50:[1,26],52:[1,25],53:24},{17:36,30:22,41:23,50:[1,26],52:[1,25],53:24},{17:37,30:22,41:23,50:[1,26],52:[1,25],53:24},{25:[1,38]},{18:[2,48],25:[2,48],33:[2,48],39:39,42:[2,48],43:[2,48],44:[2,48],45:[2,48],46:[2,48],50:[2,48],52:[2,48]},{18:[2,22],25:[2,22],33:[2,22],46:[2,22]},{18:[2,35],25:[2,35],33:[2,35],42:[2,35],43:[2,35],44:[2,35],45:[2,35],46:[2,35],50:[2,35],52:[2,35],54:[1,40]},{30:41,50:[1,26],53:24},{18:[2,37],25:[2,37],33:[2,37],42:[2,37],43:[2,37],44:[2,37],45:[2,37],46:[2,37],50:[2,37],52:[2,37],54:[2,37]},{33:[1,42]},{20:43,27:44,28:[1,45],29:[2,40]},{23:46,27:47,28:[1,45],29:[2,42]},{15:[1,48]},{25:[2,46],30:51,36:49,38:50,41:55,42:[1,52],43:[1,53],44:[1,54],45:[1,56],47:57,48:58,49:60,50:[1,59],52:[1,25],53:24},{25:[2,31],42:[2,31],43:[2,31],44:[2,31],45:[2,31],50:[2,31],52:[2,31]},{25:[2,32],42:[2,32],43:[2,32],44:[2,32],45:[2,32],50:[2,32],52:[2,32]},{25:[2,33],42:[2,33],43:[2,33],44:[2,33],45:[2,33],50:[2,33],52:[2,33]},{25:[1,61]},{25:[1,62]},{18:[1,63]},{5:[2,17],12:[2,17],13:[2,17],16:[2,17],24:[2,17],26:[2,17],28:[2,17],29:[2,17],31:[2,17],32:[2,17],34:[2,17]},{18:[2,50],25:[2,50],30:51,33:[2,50],36:65,40:64,41:55,42:[1,52],43:[1,53],44:[1,54],45:[1,56],46:[2,50],47:66,48:58,49:60,50:[1,59],52:[1,25],53:24},{50:[1,67]},{18:[2,34],25:[2,34],33:[2,34],42:[2,34],43:[2,34],44:[2,34],45:[2,34],46:[2,34],50:[2,34],52:[2,34]},{5:[2,18],12:[2,18],13:[2,18],16:[2,18],24:[2,18],26:[2,18],28:[2,18],29:[2,18],31:[2,18],32:[2,18],34:[2,18]},{21:68,29:[1,69]},{29:[2,41]},{4:70,6:3,12:[2,38],13:[2,38],16:[2,38],24:[2,38],26:[2,38],29:[2,38],31:[2,38],32:[2,38],34:[2,38]},{21:71,29:[1,69]},{29:[2,43]},{5:[2,9],12:[2,9],13:[2,9],16:[2,9],24:[2,9],26:[2,9],28:[2,9],29:[2,9],31:[2,9],32:[2,9],34:[2,9]},{25:[2,44],37:72,47:73,48:58,49:60,50:[1,74]},{25:[1,75]},{18:[2,23],25:[2,23],33:[2,23],42:[2,23],43:[2,23],44:[2,23],45:[2,23],46:[2,23],50:[2,23],52:[2,23]},{18:[2,24],25:[2,24],33:[2,24],42:[2,24],43:[2,24],44:[2,24],45:[2,24],46:[2,24],50:[2,24],52:[2,24]},{18:[2,25],25:[2,25],33:[2,25],42:[2,25],43:[2,25],44:[2,25],45:[2,25],46:[2,25],50:[2,25],52:[2,25]},{18:[2,26],25:[2,26],33:[2,26],42:[2,26],43:[2,26],44:[2,26],45:[2,26],46:[2,26],50:[2,26],52:[2,26]},{18:[2,27],25:[2,27],33:[2,27],42:[2,27],43:[2,27],44:[2,27],45:[2,27],46:[2,27],50:[2,27],52:[2,27]},{17:76,30:22,41:23,50:[1,26],52:[1,25],53:24},{25:[2,47]},{18:[2,29],25:[2,29],33:[2,29],46:[2,29],49:77,50:[1,74]},{18:[2,37],25:[2,37],33:[2,37],42:[2,37],43:[2,37],44:[2,37],45:[2,37],46:[2,37],50:[2,37],51:[1,78],52:[2,37],54:[2,37]},{18:[2,52],25:[2,52],33:[2,52],46:[2,52],50:[2,52]},{12:[2,13],13:[2,13],16:[2,13],24:[2,13],26:[2,13],28:[2,13],29:[2,13],31:[2,13],32:[2,13],34:[2,13]},{12:[2,14],13:[2,14],16:[2,14],24:[2,14],26:[2,14],28:[2,14],29:[2,14],31:[2,14],32:[2,14],34:[2,14]},{12:[2,10]},{18:[2,21],25:[2,21],33:[2,21],46:[2,21]},{18:[2,49],25:[2,49],33:[2,49],42:[2,49],43:[2,49],44:[2,49],45:[2,49],46:[2,49],50:[2,49],52:[2,49]},{18:[2,51],25:[2,51],33:[2,51],46:[2,51]},{18:[2,36],25:[2,36],33:[2,36],42:[2,36],43:[2,36],44:[2,36],45:[2,36],46:[2,36],50:[2,36],52:[2,36],54:[2,36]},{5:[2,11],12:[2,11],13:[2,11],16:[2,11],24:[2,11],26:[2,11],28:[2,11],29:[2,11],31:[2,11],32:[2,11],34:[2,11]},{30:79,50:[1,26],53:24},{29:[2,15]},{5:[2,12],12:[2,12],13:[2,12],16:[2,12],24:[2,12],26:[2,12],28:[2,12],29:[2,12],31:[2,12],32:[2,12],34:[2,12]},{25:[1,80]},{25:[2,45]},{51:[1,78]},{5:[2,20],12:[2,20],13:[2,20],16:[2,20],24:[2,20],26:[2,20],28:[2,20],29:[2,20],31:[2,20],32:[2,20],34:[2,20]},{46:[1,81]},{18:[2,53],25:[2,53],33:[2,53],46:[2,53],50:[2,53]},{30:51,36:82,41:55,42:[1,52],43:[1,53],44:[1,54],45:[1,56],50:[1,26],52:[1,25],53:24},{25:[1,83]},{5:[2,19],12:[2,19],13:[2,19],16:[2,19],24:[2,19],26:[2,19],28:[2,19],29:[2,19],31:[2,19],32:[2,19],34:[2,19]},{18:[2,28],25:[2,28],33:[2,28],42:[2,28],43:[2,28],44:[2,28],45:[2,28],46:[2,28],50:[2,28],52:[2,28]},{18:[2,30],25:[2,30],33:[2,30],46:[2,30],50:[2,30]},{5:[2,16],12:[2,16],13:[2,16],16:[2,16],24:[2,16],26:[2,16],28:[2,16],29:[2,16],31:[2,16],32:[2,16],34:[2,16]}],defaultActions:{4:[2,1],44:[2,41],47:[2,43],57:[2,47],63:[2,10],70:[2,15],73:[2,45]},parseError:function(e,t){throw new Error(e)},parse:function(e){var t=this,n=[0],i=[null],r=[],o=this.table,s="",a=0,l=0,c=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var u=this.lexer.yylloc;r.push(u);var h=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var d,p,f,m,g,v,y,b,x,q={};;){if(f=n[n.length-1],this.defaultActions[f]?m=this.defaultActions[f]:(null!==d&&void 0!==d||(d=function(){var e;return"number"!=typeof(e=t.lexer.lex()||1)&&(e=t.symbols_[e]||e),e}()),m=o[f]&&o[f][d]),void 0===m||!m.length||!m[0]){var C="";if(!c){x=[];for(v in o[f])this.terminals_[v]&&v>2&&x.push("'"+this.terminals_[v]+"'");C=this.lexer.showPosition?"Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+x.join(", ")+", got '"+(this.terminals_[d]||d)+"'":"Parse error on line "+(a+1)+": Unexpected "+(1==d?"end of input":"'"+(this.terminals_[d]||d)+"'"),this.parseError(C,{text:this.lexer.match,token:this.terminals_[d]||d,line:this.lexer.yylineno,loc:u,expected:x})}}if(m[0]instanceof Array&&m.length>1)throw new Error("Parse Error: multiple actions possible at state: "+f+", token: "+d);switch(m[0]){case 1:n.push(d),i.push(this.lexer.yytext),r.push(this.lexer.yylloc),n.push(m[1]),d=null,p?(d=p,p=null):(l=this.lexer.yyleng,s=this.lexer.yytext,a=this.lexer.yylineno,u=this.lexer.yylloc,c>0&&c--);break;case 2:if(y=this.productions_[m[1]][1],q.$=i[i.length-y],q._$={first_line:r[r.length-(y||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(y||1)].first_column,last_column:r[r.length-1].last_column},h&&(q._$.range=[r[r.length-(y||1)].range[0],r[r.length-1].range[1]]),void 0!==(g=this.performAction.call(q,s,l,a,this.yy,m[1],i,r)))return g;y&&(n=n.slice(0,-1*y*2),i=i.slice(0,-1*y),r=r.slice(0,-1*y)),n.push(this.productions_[m[1]][0]),i.push(q.$),r.push(q._$),b=o[n[n.length-2]][n[n.length-1]],n.push(b);break;case 3:return!0}}return!0}},n=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,i,r;this._more||(this.yytext="",this.match="");for(var o=this._currentRules(),s=0;s<o.length&&(!(n=this._input.match(this.rules[o[s]]))||t&&!(n[0].length>t[0].length)||(t=n,i=s,this.options.flex));s++);return t?((r=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,o[i],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e||void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return void 0!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)}};return e.options={},e.performAction=function(e,t,n,i){function r(e,n){return t.yytext=t.yytext.substr(e,t.yyleng-n)}switch(n){case 0:if("\\\\"===t.yytext.slice(-2)?(r(0,1),this.begin("mu")):"\\"===t.yytext.slice(-1)?(r(0,1),this.begin("emu")):this.begin("mu"),t.yytext)return 12;break;case 1:return 12;case 2:return this.popState(),12;case 3:return t.yytext=t.yytext.substr(5,t.yyleng-9),this.popState(),15;case 4:return 12;case 5:return r(0,4),this.popState(),13;case 6:return 45;case 7:return 46;case 8:return 16;case 9:return this.popState(),this.begin("raw"),18;case 10:return 34;case 11:return 24;case 12:return 29;case 13:case 14:return this.popState(),28;case 15:case 16:return 26;case 17:return 32;case 18:return 31;case 19:this.popState(),this.begin("com");break;case 20:return r(3,5),this.popState(),13;case 21:return 31;case 22:return 51;case 23:case 24:return 50;case 25:return 54;case 26:break;case 27:return this.popState(),33;case 28:return this.popState(),25;case 29:return t.yytext=r(1,2).replace(/\\"/g,'"'),42;case 30:return t.yytext=r(1,2).replace(/\\'/g,"'"),42;case 31:return 52;case 32:case 33:return 44;case 34:return 43;case 35:return 50;case 36:return t.yytext=r(1,2),50;case 37:return"INVALID";case 38:return 5}},e.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]*?(?=(\{\{\{\{\/)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],e.conditions={mu:{rules:[6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[5],inclusive:!1},raw:{rules:[3,4],inclusive:!1},INITIAL:{rules:[0,1,38],inclusive:!0}},e}();return t.lexer=n,e.prototype=t,t.Parser=e,new e}()}(),l=function(e){"use strict";function t(e,t,n){void 0===t&&(t=e.length);var i=e[t-1],r=e[t-2];return i?"content"===i.type?(r||!n?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(i.original):void 0:n}function i(e,t,n){void 0===t&&(t=-1);var i=e[t+1],r=e[t+2];return i?"content"===i.type?(r||!n?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(i.original):void 0:n}function r(e,t,n){var i=e[null==t?0:t+1];if(i&&"content"===i.type&&(n||!i.rightStripped)){var r=i.string;i.string=i.string.replace(n?/^\s+/:/^[ \t]*\r?\n?/,""),i.rightStripped=i.string!==r}}function o(e,t,n){var i=e[null==t?e.length-1:t-1];if(i&&"content"===i.type&&(n||!i.leftStripped)){var r=i.string;return i.string=i.string.replace(n?/\s+$/:/[ \t]+$/,""),i.leftStripped=i.string!==r,i.leftStripped}}var s={},a=n;return s.stripFlags=function(e,t){return{left:"~"===e.charAt(2),right:"~"===t.charAt(t.length-3)}},s.prepareBlock=function(e,n,s,l,c,u){if(e.sexpr.id.original!==l.path.original)throw new a(e.sexpr.id.original+" doesn't match "+l.path.original,e);var h=s&&s.program,d={left:e.strip.left,right:l.strip.right,openStandalone:i(n.statements),closeStandalone:t((h||n).statements)};if(e.strip.right&&r(n.statements,null,!0),h){var p=s.strip;p.left&&o(n.statements,null,!0),p.right&&r(h.statements,null,!0),l.strip.left&&o(h.statements,null,!0),t(n.statements)&&i(h.statements)&&(o(n.statements),r(h.statements))}else l.strip.left&&o(n.statements,null,!0);return c?new this.BlockNode(e,h,n,d,u):new this.BlockNode(e,n,h,d,u)},s.prepareProgram=function(e,n){for(var s=0,a=e.length;s<a;s++){var l=e[s],c=l.strip;if(c){var u=t(e,s,n,l.type),h=i(e,s,n),d=c.openStandalone&&u,p=c.closeStandalone&&h,f=c.inlineStandalone&&u&&h;c.right&&r(e,s,!0),c.left&&o(e,s,!0),f&&(r(e,s),o(e,s)&&"partial"===l.type&&(l.indent=/([ \t]+$)/.exec(e[s-1].original)?RegExp.$1:"")),d&&(r((l.program||l.inverse).statements),o(e,s)),p&&(r(e,s),o((l.inverse||l.program).statements))}}return e},s}();return function(e,t,n,i,r){"use strict";var a=o,l=s,c=n.parser,u=n.parse,h=i.Compiler,d=i.compile,p=i.precompile,f=r,m=a.create,g=function(){var e=m();return e.compile=function(t,n){return d(t,n,e)},e.precompile=function(t,n){return p(t,n,e)},e.AST=l,e.Compiler=h,e.JavaScriptCompiler=f,e.Parser=c,e.parse=u,e};return a=g(),a.create=g,a.default=a,a}(0,0,function(e,n,i,r){"use strict";var o={},c=a,u=s,h=l,d=t.extend;o.parser=c;var p={};return d(p,h,u),o.parse=function(e){return e.constructor===u.ProgramNode?e:(c.yy=p,c.parse(e))},o}(),function(e,i){"use strict";function r(){}function o(e,t){if(e===t)return!0;if(l(e)&&l(t)&&e.length===t.length){for(var n=0;n<e.length;n++)if(!o(e[n],t[n]))return!1;return!0}}var s={},a=n,l=t.isArray,c=[].slice;return s.Compiler=r,r.prototype={compiler:r,equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var n=0;n<t;n++){var i=this.opcodes[n],r=e.opcodes[n];if(i.opcode!==r.opcode||!o(i.args,r.args))return!1}for(t=this.children.length,n=0;n<t;n++)if(!this.children[n].equals(e.children[n]))return!1;return!0},guid:0,compile:function(e,t){this.opcodes=[],this.children=[],this.depths={list:[]},this.options=t,this.stringParams=t.stringParams,this.trackIds=t.trackIds;var n=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},n)for(var i in n)this.options.knownHelpers[i]=n[i];return this.accept(e)},accept:function(e){return this[e.type](e)},program:function(e){for(var t=e.statements,n=0,i=t.length;n<i;n++)this.accept(t[n]);return this.isSimple=1===i,this.depths.list=this.depths.list.sort(function(e,t){return e-t}),this},compileProgram:function(e){var t,n=(new this.compiler).compile(e,this.options),i=this.guid++;this.usePartial=this.usePartial||n.usePartial,this.children[i]=n;for(var r=0,o=n.depths.list.length;r<o;r++)(t=n.depths.list[r])<2||this.addDepth(t-1);return i},block:function(e){var t=e.mustache,n=e.program,i=e.inverse;n&&(n=this.compileProgram(n)),i&&(i=this.compileProgram(i));var r=t.sexpr,o=this.classifySexpr(r);"helper"===o?this.helperSexpr(r,n,i):"simple"===o?(this.simpleSexpr(r),this.opcode("pushProgram",n),this.opcode("pushProgram",i),this.opcode("emptyHash"),this.opcode("blockValue",r.id.original)):(this.ambiguousSexpr(r,n,i),this.opcode("pushProgram",n),this.opcode("pushProgram",i),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(e){var t,n,i=e.pairs;for(this.opcode("pushHash"),t=0,n=i.length;t<n;t++)this.pushParam(i[t][1]);for(;t--;)this.opcode("assignToHash",i[t][0]);this.opcode("popHash")},partial:function(e){var t=e.partialName;this.usePartial=!0,e.hash?this.accept(e.hash):this.opcode("push","undefined"),e.context?this.accept(e.context):(this.opcode("getContext",0),this.opcode("pushContext")),this.opcode("invokePartial",t.name,e.indent||""),this.opcode("append")},content:function(e){e.string&&this.opcode("appendContent",e.string)},mustache:function(e){this.sexpr(e.sexpr),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousSexpr:function(e,t,n){var i=e.id,r=i.parts[0],o=null!=t||null!=n;this.opcode("getContext",i.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.ID(i),this.opcode("invokeAmbiguous",r,o)},simpleSexpr:function(e){var t=e.id;"DATA"===t.type?this.DATA(t):t.parts.length?this.ID(t):(this.addDepth(t.depth),this.opcode("getContext",t.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperSexpr:function(e,t,n){var i=this.setupFullMustacheParams(e,t,n),r=e.id,o=r.parts[0];if(this.options.knownHelpers[o])this.opcode("invokeKnownHelper",i.length,o);else{if(this.options.knownHelpersOnly)throw new a("You specified knownHelpersOnly, but used the unknown helper "+o,e);r.falsy=!0,this.ID(r),this.opcode("invokeHelper",i.length,r.original,r.isSimple)}},sexpr:function(e){var t=this.classifySexpr(e);"simple"===t?this.simpleSexpr(e):"helper"===t?this.helperSexpr(e):this.ambiguousSexpr(e)},ID:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth),e.parts[0]?this.opcode("lookupOnContext",e.parts,e.falsy,e.isScoped):this.opcode("pushContext")},DATA:function(e){this.options.data=!0,this.opcode("lookupData",e.id.depth,e.id.parts)},STRING:function(e){this.opcode("pushString",e.string)},NUMBER:function(e){this.opcode("pushLiteral",e.number)},BOOLEAN:function(e){this.opcode("pushLiteral",e.bool)},comment:function(){},opcode:function(e){this.opcodes.push({opcode:e,args:c.call(arguments,1)})},addDepth:function(e){0!==e&&(this.depths[e]||(this.depths[e]=!0,this.depths.list.push(e)))},classifySexpr:function(e){var t=e.isHelper,n=e.eligibleHelper,i=this.options;if(n&&!t){var r=e.id.parts[0];i.knownHelpers[r]?t=!0:i.knownHelpersOnly&&(n=!1)}return t?"helper":n?"ambiguous":"simple"},pushParams:function(e){for(var t=0,n=e.length;t<n;t++)this.pushParam(e[t])},pushParam:function(e){this.stringParams?(e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",e.stringModeValue,e.type),"sexpr"===e.type&&this.sexpr(e)):(this.trackIds&&this.opcode("pushId",e.type,e.idName||e.stringModeValue),this.accept(e))},setupFullMustacheParams:function(e,t,n){var i=e.params;return this.pushParams(i),this.opcode("pushProgram",t),this.opcode("pushProgram",n),e.hash?this.hash(e.hash):this.opcode("emptyHash"),i}},s.precompile=function(e,t,n){if(null==e||"string"!=typeof e&&e.constructor!==n.AST.ProgramNode)throw new a("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);"data"in(t=t||{})||(t.data=!0),t.compat&&(t.useDepths=!0);var i=n.parse(e),r=(new n.Compiler).compile(i,t);return(new n.JavaScriptCompiler).compile(r,t)},s.compile=function(e,t,n){function i(){var i=n.parse(e),r=(new n.Compiler).compile(i,t),o=(new n.JavaScriptCompiler).compile(r,t,void 0,!0);return n.template(o)}if(null==e||"string"!=typeof e&&e.constructor!==n.AST.ProgramNode)throw new a("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);"data"in(t=t||{})||(t.data=!0),t.compat&&(t.useDepths=!0);var r,o=function(e,t){return r||(r=i()),r.call(this,e,t)};return o._setup=function(e){return r||(r=i()),r._setup(e)},o._child=function(e,t,n){return r||(r=i()),r._child(e,t,n)},o},s}(),function(e,t){"use strict";function n(e){this.value=e}function i(){}var r=e.COMPILER_REVISION,o=e.REVISION_CHANGES,s=t;i.prototype={nameLookup:function(e,t){return i.isValidJavaScriptVariableName(t)?e+"."+t:e+"['"+t+"']"},depthedLookup:function(e){return this.aliases.lookup="this.lookup",'lookup(depths, "'+e+'")'},compilerInfo:function(){var e=r;return[e,o[e]]},appendToBuffer:function(e){return this.environment.isSimple?"return "+e+";":{appendToBuffer:!0,content:e,toString:function(){return"buffer += "+e+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(e,t,n,i){this.environment=e,this.options=t,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!i,this.name=this.environment.name,this.isChild=!!n,this.context=n||{programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.compileChildren(e,t),this.useDepths=this.useDepths||e.depths.list.length||this.options.compat;var r,o,a,l=e.opcodes;for(o=0,a=l.length;o<a;o++)this[(r=l[o]).opcode].apply(this,r.args);if(this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new s("Compile completed with content left on stack");var c=this.createFunctionContext(i);if(this.isChild)return c;var u={compiler:this.compilerInfo(),main:c},h=this.context.programs;for(o=0,a=h.length;o<a;o++)h[o]&&(u[o]=h[o]);return this.environment.usePartial&&(u.usePartial=!0),this.options.data&&(u.useData=!0),this.useDepths&&(u.useDepths=!0),this.options.compat&&(u.compat=!0),i||(u.compiler=JSON.stringify(u.compiler),u=this.objectLiteral(u)),u},preamble:function(){this.lastContext=0,this.source=[]},createFunctionContext:function(e){var t="",n=this.stackVars.concat(this.registers.list);n.length>0&&(t+=", "+n.join(", "));for(var i in this.aliases)this.aliases.hasOwnProperty(i)&&(t+=", "+i+"="+this.aliases[i]);var r=["depth0","helpers","partials","data"];this.useDepths&&r.push("depths");var o=this.mergeSource(t);return e?(r.push(o),Function.apply(this,r)):"function("+r.join(",")+") {\n  "+o+"}"},mergeSource:function(e){for(var t,n,i="",r=!this.forceBuffer,o=0,s=this.source.length;o<s;o++){var a=this.source[o];a.appendToBuffer?t=t?t+"\n    + "+a.content:a.content:(t&&(i?i+="buffer += "+t+";\n  ":(n=!0,i=t+";\n  "),t=void 0),i+=a+"\n  ",this.environment.isSimple||(r=!1))}return r?!t&&i||(i+="return "+(t||'""')+";\n"):(e+=", buffer = "+(n?"":this.initializeBuffer()),i+=t?"return buffer + "+t+";\n":"return buffer;\n"),e&&(i="var "+e.substring(2)+(n?"":";\n  ")+i),i},blockValue:function(e){this.aliases.blockHelperMissing="helpers.blockHelperMissing";var t=[this.contextName(0)];this.setupParams(e,0,t);var n=this.popStack();t.splice(1,0,n),this.push("blockHelperMissing.call("+t.join(", ")+")")},ambiguousBlockValue:function(){this.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=[this.contextName(0)];this.setupParams("",0,e,!0),this.flushInline();var t=this.topStack();e.splice(1,0,t),this.pushSource("if (!"+this.lastHelper+") { "+t+" = blockHelperMissing.call("+e.join(", ")+"); }")},appendContent:function(e){this.pendingContent&&(e=this.pendingContent+e),this.pendingContent=e},append:function(){this.flushInline();var e=this.popStack();this.pushSource("if ("+e+" != null) { "+this.appendToBuffer(e)+" }"),this.environment.isSimple&&this.pushSource("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.aliases.escapeExpression="this.escapeExpression",this.pushSource(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(e){this.lastContext=e},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(e,t,n){var i=0,r=e.length;for(n||!this.options.compat||this.lastContext?this.pushContext():this.push(this.depthedLookup(e[i++]));i<r;i++)this.replaceStack(function(n){var r=this.nameLookup(n,e[i],"context");return t?" && "+r:" != null ? "+r+" : "+n})},lookupData:function(e,t){e?this.pushStackLiteral("this.data(data, "+e+")"):this.pushStackLiteral("data");for(var n=t.length,i=0;i<n;i++)this.replaceStack(function(e){return" && "+this.nameLookup(e,t[i],"data")})},resolvePossibleLambda:function(){this.aliases.lambda="this.lambda",this.push("lambda("+this.popStack()+", "+this.contextName(0)+")")},pushStringParam:function(e,t){this.pushContext(),this.pushString(t),"sexpr"!==t&&("string"==typeof e?this.pushString(e):this.pushStackLiteral(e))},emptyHash:function(){this.pushStackLiteral("{}"),this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}"))},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[],ids:[]}},popHash:function(){var e=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push("{"+e.ids.join(",")+"}"),this.stringParams&&(this.push("{"+e.contexts.join(",")+"}"),this.push("{"+e.types.join(",")+"}")),this.push("{\n    "+e.values.join(",\n    ")+"\n  }")},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},push:function(e){return this.inlineStack.push(e),e},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){null!=e?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},invokeHelper:function(e,t,n){this.aliases.helperMissing="helpers.helperMissing";var i=this.popStack(),r=this.setupHelper(e,t),o=(n?r.name+" || ":"")+i+" || helperMissing";this.push("(("+o+").call("+r.callParams+"))")},invokeKnownHelper:function(e,t){var n=this.setupHelper(e,t);this.push(n.name+".call("+n.callParams+")")},invokeAmbiguous:function(e,t){this.aliases.functionType='"function"',this.aliases.helperMissing="helpers.helperMissing",this.useRegister("helper");var n=this.popStack();this.emptyHash();var i=this.setupHelper(0,e,t),r=this.lastHelper=this.nameLookup("helpers",e,"helper");this.push("((helper = (helper = "+r+" || "+n+") != null ? helper : helperMissing"+(i.paramsInit?"),("+i.paramsInit:"")+"),(typeof helper === functionType ? helper.call("+i.callParams+") : helper))")},invokePartial:function(e,t){var n=[this.nameLookup("partials",e,"partial"),"'"+t+"'","'"+e+"'",this.popStack(),this.popStack(),"helpers","partials"];this.options.data?n.push("data"):this.options.compat&&n.push("undefined"),this.options.compat&&n.push("depths"),this.push("this.invokePartial("+n.join(", ")+")")},assignToHash:function(e){var t,n,i,r=this.popStack();this.trackIds&&(i=this.popStack()),this.stringParams&&(n=this.popStack(),t=this.popStack());var o=this.hash;t&&o.contexts.push("'"+e+"': "+t),n&&o.types.push("'"+e+"': "+n),i&&o.ids.push("'"+e+"': "+i),o.values.push("'"+e+"': ("+r+")")},pushId:function(e,t){"ID"===e||"DATA"===e?this.pushString(t):"sexpr"===e?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:i,compileChildren:function(e,t){for(var n,i,r=e.children,o=0,s=r.length;o<s;o++){n=r[o],i=new this.compiler;var a=this.matchExistingProgram(n);null==a?(this.context.programs.push(""),a=this.context.programs.length,n.index=a,n.name="program"+a,this.context.programs[a]=i.compile(n,t,this.context,!this.precompile),this.context.environments[a]=n,this.useDepths=this.useDepths||i.useDepths):(n.index=a,n.name="program"+a)}},matchExistingProgram:function(e){for(var t=0,n=this.context.environments.length;t<n;t++){var i=this.context.environments[t];if(i&&i.equals(e))return t}},programExpression:function(e){var t=this.environment.children[e],n=(t.depths.list,this.useDepths),i=[t.index,"data"];return n&&i.push("depths"),"this.program("+i.join(", ")+")"},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},pushStackLiteral:function(e){return this.push(new n(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent))),this.pendingContent=void 0),e&&this.source.push(e)},pushStack:function(e){this.flushInline();var t=this.incrStack();return this.pushSource(t+" = "+e+";"),this.compileStack.push(t),t},replaceStack:function(e){var t,i,r,o="";this.isInline();if(!this.isInline())throw new s("replaceStack on non-inline");var a=this.popStack(!0);if(a instanceof n)o=t=a.value,r=!0;else{var l=(i=!this.stackSlot)?this.incrStack():this.topStackName();o="("+this.push(l)+" = "+a+")",t=this.topStack()}var c=e.call(this,t);r||this.popStack(),i&&this.stackSlot--,this.push("("+o+c+")")},incrStack:function(){return++this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;if(e.length){this.inlineStack=[];for(var t=0,i=e.length;t<i;t++){var r=e[t];r instanceof n?this.compileStack.push(r):this.pushStack(r)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),i=(t?this.inlineStack:this.compileStack).pop();if(!e&&i instanceof n)return i.value;if(!t){if(!this.stackSlot)throw new s("Invalid stack pop");this.stackSlot--}return i},topStack:function(){var e=this.isInline()?this.inlineStack:this.compileStack,t=e[e.length-1];return t instanceof n?t.value:t},contextName:function(e){return this.useDepths&&e?"depths["+e+"]":"depth"+e},quotedString:function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(this.quotedString(n)+":"+e[n]);return"{"+t.join(",")+"}"},setupHelper:function(e,t,n){var i=[];return{params:i,paramsInit:this.setupParams(t,e,i,n),name:this.nameLookup("helpers",t,"helper"),callParams:[this.contextName(0)].concat(i).join(", ")}},setupOptions:function(e,t,n){var i,r,o,s={},a=[],l=[],c=[];s.name=this.quotedString(e),s.hash=this.popStack(),this.trackIds&&(s.hashIds=this.popStack()),this.stringParams&&(s.hashTypes=this.popStack(),s.hashContexts=this.popStack()),r=this.popStack(),((o=this.popStack())||r)&&(o||(o="this.noop"),r||(r="this.noop"),s.fn=o,s.inverse=r);for(var u=t;u--;)i=this.popStack(),n[u]=i,this.trackIds&&(c[u]=this.popStack()),this.stringParams&&(l[u]=this.popStack(),a[u]=this.popStack());return this.trackIds&&(s.ids="["+c.join(",")+"]"),this.stringParams&&(s.types="["+l.join(",")+"]",s.contexts="["+a.join(",")+"]"),this.options.data&&(s.data="data"),s},setupParams:function(e,t,n,i){var r=this.objectLiteral(this.setupOptions(e,t,n));return i?(this.useRegister("options"),n.push("options"),"options="+r):(n.push(r),"")}};for(var a="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),l=i.RESERVED_WORDS={},c=0,u=a.length;c<u;c++)l[a[c]]=!0;return i.isValidJavaScriptVariableName=function(e){return!i.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(e)},i}(i,n))}),define("assets/load-model/templating/template-runner",["require","exports","handlebars"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.render=function(e,t){return n.compile(e,{noEscape:!0})(t)},e}();t.TemplateRunner=i}),define("assets/load-model/box-types/load-file",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(){}}();n.template="{{#each calculatedFields}}\nLOAD *, {{expr}} AS [{{alias}}];\n{{/each}}\n{{#each inject.prefix}}\n{{.}}\n{{/each}}\n{{#if dependencies.keep.enabled}}\nKEEP ([{{dependencies.keep.model.tableName}}])\n{{/if}}\nLOAD {{load-field-list fields}}\nFROM {{load-file-from-lib dataconnectorName databaseName}}\n{{formatSpec}};\n",n.type="load-file",t.LoadFile=n}),define("assets/load-model/box-types/load-sql",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(){}}();n.template="LIB CONNECT TO [{{dataconnectorName}}];\n{{#each calculatedFields}}\n\tLOAD *, {{expr}} AS [{{alias}}];\n{{/each}}\n{{#each inject.prefix}}\n{{.}}\n{{/each}}\n{{#if dependencies.keep.enabled}}\nLEFT KEEP ([{{dependencies.keep.model.tableAlias}}])\n{{/if}}\nLOAD {{load-field-list fields}};\nSQL SELECT {{sql-field-list fields connectionInfo}}\nFROM {{database-owner-table databaseName ownerName tableName connectionInfo.dbInfo}};",n.type="load-sql",t.LoadSql=n}),define("assets/load-model/box-types/join",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(){}}();n.template="//Joined {{dependencies.from.model.tableAlias}} with {{dependencies.to.model.tableAlias}}",n.type="join",t.Join=n}),define("assets/load-model/box-types/new-generation",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(){}}();n.type="newGeneration",n.template="/*new version of a table {{tableName}}: {{key}}. Depends on transformation {{dependencies.parent.key}}. \n New fields list:\n {{load-field-list fields}} \n*/",t.NewGeneration=n}),define("assets/load-model/templating/template-helpers",["require","exports","handlebars","./template-runner"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.InitHandlebars=function(){n.registerHelper("comma-separated",function(e,t){var n="";if(e)for(var i=0,r=e.length;r>i;i++){var o=t.fn(e[i]);o.length>0&&"\n"===o[o.length-1]&&(o=o.substring(0,o.length-1)),o.length>0&&"\r"===o[o.length-1]&&(o=o.substring(0,o.length-1)),n+=o,r-1>i&&(n+=",\n\t")}return n}),n.registerHelper("quote",function(t){return e.qouteScript(t)}),n.registerHelper("load-file-from-lib",function(t,n){return e.qouteScript(n?"lib://"+t+"/"+n:"lib://"+t)}),n.registerHelper("sql-quote",function(e,t){return t.quoteprefix+e+t.quotesuffix}),n.registerHelper("sql-field-list",function(t,n){return i.TemplateRunner.render(e.SqlFieldListTemplate,{fields:t,connectionInfo:n})}),n.registerHelper("load-field-list",function(t){return i.TemplateRunner.render(e.LoadFieldListTemplate,{fields:t})}),n.registerHelper("database-owner-table",function(e,t,n,i){function r(e){return i.quoteprefix+e+i.quotesuffix}var o="",s="ACCESS"===(i.dbmsname||"").toUpperCase();return i.dbfirst?(i.dbusage&&!s&&e&&(o+=r(e)+i.dbseparator),i.ownerusage&&t&&(o+=r(t)+i.ownerseparator),o+=r(n)):(i.ownerusage&&t&&(o+=r(t)+i.ownerseparator),o+=r(n),i.dbusage&&e&&(o+=i.dbseparator+r(e))),o})},e.qouteScript=function(e){return e?-1!==e.indexOf("[")||-1!==e.indexOf("]")?'"'+e+'"':"["+e+"]":e},e}();r.LoadFieldListTemplate="{{#comma-separated fields}}\n{{#if selected}}{{quote name}}{{#alias}} AS {{quote .}}{{/alias}}{{/if}}\n{{/comma-separated}}",r.SqlFieldListTemplate="{{#comma-separated fields}}\n {{#if selected}}{{sql-quote name ../../connectionInfo.dbInfo}}{{/if}}\n{{/comma-separated}}",t.TemplateHelpers=r}),define("assets/load-model/models/box-types-model",["require","exports","../box-types/load-file","../box-types/load-sql","../box-types/join","../box-types/new-generation","../templating/template-helpers"],function(e,t,n,i,r,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s.TemplateHelpers.InitHandlebars();var a=function(){function e(){}return e.GetBoxType=function(e){switch(e){case n.LoadFile.type:return n.LoadFile;case i.LoadSql.type:return i.LoadSql;case r.Join.type:return r.Join;case o.NewGeneration.type:return o.NewGeneration}},e}();t.BoxTypesModel=a}),define("autogenerated/qix/engine-api-def",["./engine-api"],function(e){return e.structs}),define("core.models/engine",["autogenerated/qix/engine-api-def","util"],function(e,t){"use strict";function n(e,n){if("object"==typeof n&&(n=t.extend(!0,Array.isArray(n)?[]:{},n)),e&&"qResult"!==e){var i={};return i[e]=n,i}return n}function i(e,t){var n=Object.keys(e),i=t.In.map(function(e){return e.Name});return 0!==n.filter(function(e,t){return e===i[t]}).length}function r(e,t){var n=[];if(Array.isArray(t)&&1===t.length&&"object"==typeof t[0]&&i(t[0],e)&&(t=t[0]),Array.isArray(t)||"object"!=typeof t)Array.isArray(t)?n=t:n.push(t);else for(var r=0;r<e.In.length;++r)t&&void 0!==t[e.In[r].Name]?n.push(t[e.In[r].Name]):e.In[r].Optional&&void 0!==e.In[r].DefaultValue&&n.push(e.In[r].DefaultValue);return n}function o(e,t,i,o){var s=e[t],a=1===s.Out.length?s.Out[0].Name:null;i[t=t.substring(0,1).toLowerCase()+t.substring(1)]=function(){var e=Array.prototype.slice.call(arguments);e=r(s,e);var i=o[t].apply(o,e).then(n.bind(null,a));return i.__protocolRequestId=i.requestId,i}}var s={global:void 0,currentApp:void 0};return s.bootstrap=function(t){s.global||(s.global={},s.global.enigmaGlobal=t.global,Object.keys(e.Global).forEach(function(n){o(e.Global,n,s.global,t.global)}));var n={};return Object.keys(e.Doc).forEach(function(i){o(e.Doc,i,n,t)}),n},s.setCurrentApp=function(e){s.currentApp=e},s.getCurrentApp=function(){return s.currentApp},"undefined"!=typeof window&&(window.engineModuleGlobal=s),s}),define("text!assets/scripteditor/views/fileconnectdialog/fileconnectdialog.ng.html",[],function(){return'<div class="qui-modalbackground fileconnectdialogcontainer">\n\t<div class="qui-delayedModal" qv-global-escape="onCancelClicked()" qv-global-enter="onOKClicked()">\n\t\t<div class="loading-screen" ng-show="isLoading">\n\t\t\t<div class="qv-loader"></div>\n\t\t</div>\n\t\t<header class="dm-header" q-translation="{{isEdit ? \'scripteditor.dataconnectors.fileconnect.edittitle\' : \'scripteditor.dataconnectors.fileconnect.title\'}}"></header>\n\t\t<main class="dm-main">\n\t\t\t<div class="text" q-translation="scripteditor.dataconnectors.fileconnect.path"></div>\n\t\t\t<qv-file-path-input path="path" hover-path="currentHoverPath" isvalidpath="validpath" root-placeholder="rootPlaceholderName" hide-root-placeholder-in-path=\'true\'></qv-file-path-input>\n\t\t\t<p class="illegalpath" ng-style="{visibility: !validpath && \'visible\' || \'hidden\'}">{{invalidPathLabel}}</p>\n\t\t\t<qv-file-browser-widget hover-path="currentHoverPath" path="path" is-add-mode="isAddMode" folderitems="folderitems"></qv-file-browser-widget>\n\t\t\t<div class="text" q-translation="Common.Name"></div>\n\t\t\t<input class="lui-input name" ng-model="name" maxlength="{{maxConnectionNameLength}}" ng-change="onNameChanged()" invalid="{{isNameInvalid()}}"/>\n\t\t\t<label ng-style="{visibility: showCreateConnectionError && \'visible\' || \'hidden\'}" class="errorlabel">{{errorContent}}</label>\n\n\t\t\t<div>{{info}}</div>\n\t\t</main>\n\t\t<footer class="dm-footer">\n\t\t\t<lui-button x-variant="inverse" qva-activate="$event.preventDefault(); onCancelClicked()" q-translation="Common.Cancel" tid=\'2e6845\'></lui-button>\n\t\t\t<lui-button x-variant="inverse" id="confirmButton" qva-activate="$event.preventDefault(); onOKClicked()" ng-disabled="isOkDisabled()" q-translation="{{isEdit ? \'Common.Save\' : \'Common.Create\'}}"></lui-button>\n\t\t</footer>\n\t</div>\n</div>\n'}),define("general.utils/string-util",["jquery"],function(){"use strict";function e(e,t){return 0===e.indexOf(t)}function t(e,t){return t||(t=""),e.length>0?e.reduce(function(e,n){return e+t+n}):""}function n(e){return e.replace(/.*\[|\]/gi,"").match(/"[^=]*"|[^;]+/g)}function i(e){return"\\"===e.charAt(0)&&(e=e.substring(1)),"\\"===e.charAt(e.length-1)&&(e=e.slice(0,-1)),e}function r(e){return e.replace(/[0-9]+/g,function(e){var t=""+e.length;return"000".substring(0,"000".length-t.length)+t+""+e})}function o(e,t,n){var i=r(e).toLowerCase(),o=r(t).toLowerCase();return i.localeCompare(o,n)}var s=1,a=256;return{MIN_CONNECTION_NAME_LENGTH:s,MAX_CONNECTION_NAME_LENGTH:a,isValidConnectionName:function(t){var n=/^[^\\/:*?\"<>|\x00-\x1f]+$/;return void 0!==t&&!e(t,"_")&&!e(t,"$$")&&n.test(t)&&t.length>=s&&t.length<=a},isValidFieldName:function(e){return!/[\\\*\?"\(\)<>\|' &\$\^\/+\-]+/.test(e)},isValidUrl:function(e){return/^(ftp|http|https):\/\/[^ "]+$/.test(e.toLowerCase())},prefixHttpToUrl:function(e){return/^.*:\/\//.test(e)?e:"http://"+e},endsWith:function(e,t){return-1!==e.indexOf(t,e.length-t.length)},startsWith:e,goUpOneFolderLevel:function(e){var n;return"\\\\"===e.substring(0,2)?((n=i(e.substring(2)).split("\\")).pop(),"\\\\"+t(n,"\\")):((n=i(e).split("\\")).pop(),1===n.length?n[0]+"\\":t(n,"\\"))},removeSurroundingSlashes:i,arrayToString:t,formatDirectoryPathForEngine:function(e){return"\\"!==e.charAt(e.length-1)&&(e+="\\"),e},sortSlightlyMoreNaturallyArray:function(e,t,n){e.sort(function(e,i){return o(e[t],i[t],n)})},sortSlightlyMoreNaturallySingle:o,_expandNumbersForNaturalSorting:r,getValueFromConnectionString:function(e,t){var i,r=n(e);if(r)for(i=0;i<r.length;i++)if(-1!==r[i].toLowerCase().indexOf(t.toLowerCase()))return r[i].split("=")[1];return""},tokenizeConnectionString:function(e){var t,i=n(e),r=[];return i&&i.forEach(function(e){(t=e.split("="))&&r.push({key:t[0],value:t.length>1?t[1]:""})}),r},contains:function(e,t){if(!e)throw new Error("Haystack is undefined.");if(!t)throw new Error("Needle is undefined.");return-1!==e.indexOf(t)},occurrencesRE:function(e,t,n){if(e+="",!(t+=""))return 0;var i=t.match(/^\/(.*)\/([a-z]*)$/);if(!i){n||(e=e.toLowerCase(),t=t.toLowerCase());for(var r=0,o=0,s=t.length,a=!1;!a;)(o=e.indexOf(t,o))>=0?(r++,o+=s):a=!0;return r}try{var l=new RegExp(i[1],-1===i[2].indexOf("i")?"":"i");return e.split(l).length-1}catch(e){return 0}},combinePath:function(e,t){function n(){return(e+"\\"+t).replace("\\\\","\\")}return function(){if("\\\\"===e.substring(0,2))return"\\"+n()}()||n()},fileNameFromPath:function(e){return e.substring(e.lastIndexOf("\\")+1,e.length)},fileDirectoryFromPath:function(e){return e.substring(0,e.lastIndexOf("\\")+1)},lastFolderFromPath:function(e){var t=e.match(/.*\\(.*)\\.*$/);return t||(t=e.match(/^(.*)\\.*$/)),t?t[1]:null},bool:function(e){return!(!e||"false"===e)},stringWidthOverMWidth:function(e){return e<5?.9*e:e<10?.8*e:e<20?.7*e:.6*e}}}),define("assets/scripteditor/services/fix-ie-ten-box-shadow-service",["jquery"],function(e){return{fix:function(t){e(t).hide(0,function(){e(t).show()})}}}),define("scripteditor.utils/directory-arranger",["general.utils/string-util","translator"],function(e,t){function n(e,n){switch(e){case c.Removable:return t.get("DriveName.0");case c.Fixed:return t.get("DriveName.1");case c.Cd_rom:return t.get("DriveName.2");case c.Ram:return t.get("DriveName.3");case c.UnknownType:return t.get("DriveName.4");default:return n.qName}}function i(e,t){if(void 0===t)return!0;for(var n=0;n<t.length;n++)if(e.match(t[n]))return!0;return!1}function r(t){t.sort(function(t,n){return t.isFile===n.isFile?e.sortSlightlyMoreNaturallySingle(t.name,n.name):t.isFile?1:-1})}function o(e){return!(!e||!e.match(/^\\\\.*/))&&e.replace(/^\\\\/,"").split("\\").length<=1}function s(t,n){var i=e.goUpOneFolderLevel(n);l?t.unshift({name:"",path:i,isFile:!1,isAtRoot:0===n.length||o(i),disabled:!1}):t.unshift({name:"",path:i,isFile:!1,disabled:0===n.length||o(i)})}function a(e){return function(t){return!t.isFile||i(t.name,e)}}var l=!1,c={Removable:"REMOVABLE",Fixed:"FIXED",Cd_rom:"CD_ROM",Ram:"RAM",UnknownType:"UNKNOWN_TYPE"};return{setNewBackStyle:function(){l=!0},postProcessDirectoryListing:function(t,n,i,o){var l=n.map(function(n){return{name:n.qName,path:t+(e.endsWith(t,"\\")?"":"\\")+n.qName,isFile:"FILE"===n.qType}}).filter(a(i));return r(l),o||s(l,t),l},postProcessDriveListing:function(t,i){var o=(t=t||[]).map(function(t){return{name:e.removeSurroundingSlashes(t.qDrive),extraInfo:t.qUnnamedDrive?n(t.qTypeIdentifier,t):t.qName,path:t.qDrive,isFile:!1}});return r(o),i||s(o,""),o},postProcessStorageProviderDirectoryListing:function(t,n,i,o,l){var c=n.map(function(n){return{name:n.name,id:n.id,path:t?t+(e.endsWith(t,"\\")?"":"\\")+n.name:n.name,isFile:!1,isRemote:!0,extraInfo:""}});return c=c.concat(i.map(function(n){return{name:n.name,id:n.id,path:t?t+(e.endsWith(t,"\\")?"":"\\")+n.name:n.name,isFile:!0,isRemote:!0,extraInfo:""}}).filter(a(o))),r(c),l||s(c,t),c}}}),define("scripteditor.views/fileconnectdialog/fileconnectdialog",["text!assets/scripteditor/views/fileconnectdialog/fileconnectdialog.ng.html","general.utils/string-util","core.models/engine","translator","assets/scripteditor/services/fix-ie-ten-box-shadow-service","scripteditor.utils/directory-arranger"],function(e,t,n,i,r,o){return{template:e,controller:["$scope","serverside","input",function(e,s,a){function l(t){e.folderitems=[],e.isLoading=!0,t===h?n.global.getLogicalDriveStrings().then(function(t){e.isLoading=!1,e.folderitems=o.postProcessDriveListing(t.qDrives),c(!0)},function(){e.isLoading=!1}):n.global.getFolderItemsForPath(t).then(function(n){e.isLoading=!1,e.folderitems=o.postProcessDirectoryListing(t,n.qFolderItems),c(!0)},function(n){n.isHandled=!0,e.isLoading=!1,c(!1,n.code),e.folderitems=o.postProcessDirectoryListing(t,[])})}function c(t,n){e.validpath=t,e.invalidPathLabel=n?i.get("ErrorCode."+n):e.invalidPathDefaultMessage}function u(){return e.path&&e.validpath&&e.path.length<=256}var h="";e.rootPlaceholderName=i.get("scripteditor.dataconnectors.fileconnect.virtual_folder_computer"),e.validpath=!1,e.isEdit=a.editMode,e.id=a.instanceId,e.nameChangedAtLeastOnce=!1,e.isAddMode=!0,e.invalidPathDefaultMessage=i.get("scripteditor.dataconnectors.fileconnect.illegalpath"),e.maxConnectionNameLength=t.MAX_CONNECTION_NAME_LENGTH-s.getUsernameSuffix().length,e.$watch("path",function(t){"\\"!==t&&""!==t||(t=h,e.path=t),void 0!==t&&(e.path=t,l(t)),r.fix(".fileconnectdialogcontainer")}),e.isNameInvalid=function(){return e.name?!t.isValidConnectionName(e.name):e.nameChangedAtLeastOnce},e.$watch("name",function(){e.showCreateConnectionError=!1,""!==e.name&&e.isNameInvalid()&&(e.errorContent=i.get("Common.InvalidCharacters"),e.showCreateConnectionError=!0)}),e.isOkDisabled=function(){return!t.isValidConnectionName(e.name)||!u()},e.onNameChanged=function(){e.nameChangedAtLeastOnce=!0},e.handleErrors=function(t){e.errorContent=s.getErrorContent(t),e.showCreateConnectionError=!0,t.isHandled=!0,e.isLoading=!1},e.onOKClicked=function(){if(!e.isOkDisabled()){var n=t.formatDirectoryPathForEngine(e.path);e.isLoading=!0,e.isEdit?s.modifyConnection(e.id,e.name,n,e.connectorType.provider,!1,"","").then(function(t){e.isLoading=!1,t&&e.destroyComponent()},e.handleErrors):s.createNewRawConnection(e.name,n,"folder").then(function(t){e.isLoading=!1,t&&e.destroyComponent()},e.handleErrors)}},e.onCancelClicked=function(){e.isLoading||e.destroyComponent()},e.invalidPathLabel=e.invalidPathDefaultMessage,e.isEdit?(e.isLoading=!0,s.getConnection(e.id).then(function(t){e.isLoading=!1,e.name=t.qConnection.qName,e.path=t.qConnection.qConnectionString})):n.global.getMyDocumentsFolder().then(function(t){e.path=t.qFolder,e.isLoading=!1})}]}}),define("scripteditor.services/keywords",[],function(){var e,t;return{setAllKeywordsAsLowerCase:function(e){t=e},getAllKeywordsAsLowerCase:function(){return t},setAllKeywords:function(t){e=t},getAllKeywords:function(){return e}}}),define("scripteditor.services/file-script-generator",["underscore","scripteditor.services/keywords"],function(e){function t(e){return-1===e.indexOf("[")&&-1===e.indexOf("]")?"["+e+"]":-1===e.indexOf('"')?'"'+e+'"':-1===e.indexOf("'")?"'"+e+"'":-1===e.indexOf("")?""+e+"":e}return{createScriptGenerator:function(n,i,r){function o(t){return e.filter(t,function(e){return e.checked})}function s(e,r,o){var s;return s="internet"!==n.type.provider?"lib://"+n.name+"/"+e:"lib://"+n.name,t(s)+"\r\n"+i.getSettingsModelForTable(e,r,o).getFormatSpec()}function a(e,t){return h[e]||l(e,t.specialchars)||u(e,t.keywords)||c(e)||""===e?(h[e]=!0,-1===e.indexOf('"')?t.quoteprefix+e+t.quotesuffix:t.quoteprefixfordoublequotes+e+t.quotesuffixfordoublequotes):e}function l(e,t){for(var n=0;n<e.length;n++)if(-1!==t.indexOf(e.charAt(n)))return!0;return!1}function c(e){if(e.length>0){var t=e.charCodeAt(0);return 48<=t&&t<=57}return!1}function u(e){return r.isKeyword(e)}var h={};return{generateScriptForSelections:function(e,t){var n,i,r="";return t?((n=e.databases)&&n.forEach(function(e){e.owners&&e.owners.length>0&&e.owners.forEach(function(n){n.tables&&n.tables.length>0&&n.tables.forEach(function(l){if((i=o(l.fields))&&i.length>0){r+="\r\nLOAD\r\n";for(var c=0;c<i.length;c++){c>0&&(r+=",\r\n");var u=i[c].originalFieldName?i[c].originalFieldName:i[c].name;i[c].alias&&i[c].name!==i[c].alias?r+="    "+a(u,t)+" AS "+a(i[c].alias,t):r+="    "+a(u,t)}r+="\r\nFROM "+s(e.name,n.name,l.name)+";\r\n"}})})}),r.trim()+"\r\n\r\n"):""}}},quoteConnectionName:t}}),define("scripteditor.services/delimiter-options",[],function(){function e(){var e,t=[{number:"59",name:"scripteditor.dataconnectors.delimiter.semicolon",scriptCode:";",kind:"Common.Standard"},{number:"44",name:"scripteditor.dataconnectors.delimiter.comma",scriptCode:",",kind:"Common.Standard"},{number:"9",name:"scripteditor.dataconnectors.delimiter.tab",scriptCode:"\\t",kind:"Common.Standard"},{number:"32",name:"scripteditor.dataconnectors.delimiter.spaces",scriptCode:"spaces",multiple:!0,kind:"Common.Standard"}];for(e in t)t[e].title=t[e].name;return t}function t(){var e,t,n=[];for(e=0;e<=127;e++)t=String.fromCharCode(e),n[e]={number:""+e,name:t,scriptCode:t.match(/\w/)?"'"+t+"'":"'\\x"+e.toString(16)+"'",kind:"Common.Custom"};return n[0].name="NUL",n[1].name="SOH",n[2].name="STX",n[3].name="ETX",n[4].name="EOT",n[5].name="ENQ",n[6].name="ACK",n[7].name="BEL",n[8].name="BS",n[9].name="scripteditor.dataconnectors.delimiter.tab",n[10].name="LF",n[11].name="VT",n[12].name="FF",n[13].name="CR",n[14].name="SO",n[15].name="SI",n[16].name="DLE",n[17].name="DC1 (XON)",n[18].name="DC2",n[19].name="DC3 (XOFF)",n[20].name="DC4",n[21].name="NAK",n[22].name="SYN",n[23].name="ETB",n[24].name="CAN",n[25].name="EM",n[26].name="SUB",n[27].name="ESC",n[28].name="FS",n[29].name="GS",n[30].name="RS",n[31].name="US",n[32].name="scripteditor.dataconnectors.delimiter.space",n[44].name="scripteditor.dataconnectors.delimiter.comma",n[59].name="scripteditor.dataconnectors.delimiter.semicolon",n[127].name="DEL",n[8].scriptCode="'\\b'",n[9].scriptCode="'\\t'",n[10].scriptCode="'\\n'",n[13].scriptCode="'\\r'",n[32].scriptCode="' '",n[39].scriptCode='"\'"',n[92].scriptCode="\\\\",n[32].scriptCode="' '",n.splice(33,0,{number:"32",name:"scripteditor.dataconnectors.delimiter.spaces",scriptCode:"spaces",multiple:!0,kind:"Common.Custom"}),n}return e().concat(t())}),define("assets/scripteditor/services/fixedwidth/filesettings-fixedwidthdelimiters-service",[],function(){return{isValid:function(e){var t,n,i,r=0;if(0===(e=String(e)).length)return!1;t=e.split(",");for(n in t){if(0===(i=t[n].trim()).length)return!1;if(isNaN(i))return!1;if(Number(i)<=Number(r))return!1;r=i}return!0}}}),define("scripteditor.services/file-settings-model",["core.utils/class","scripteditor.services/delimiter-options","assets/scripteditor/services/fixedwidth/filesettings-fixedwidthdelimiters-service"],function(e,t,n){function i(e){return!(!e||"false"===e)}function r(e){return e.qIsMultiple&&"false"!==e.qIsMultiple?t.filter(function(e){return"spaces"===e.scriptCode})[0]:t.filter(function(t){return t.number===e.qNumber.toString()})[0]}function o(e,t){return e.filter(function(e){return e.number===t})[0]}var s=e.extend("FileSettings",{init:function(){},setSettingsGuess:function(e){this.settingsGuess=e},getParamsForEngine:function(){return{}}}),a=e.extend("TableSettings",{labelStrategyOptions:["embedded labels","no labels"],quotingOptions:["standard","msq","none"],delimiterOptions:t,init:function(e,n){this.codepageOptions=n,e&&void 0!==e.qHeaderSize?this.nbrOfHeaderLinesToRemove=""+e.qHeaderSize:this.nbrOfHeaderLinesToRemove=0,e&&void 0!==e.qTabSize?this.tabSize=e.qTabSize:this.tabSize=1,this.formatSpec="undefined format spec",e&&void 0!==e.qIgnoreEOF?this.ignoreEOF=e.qIgnoreEOF:this.ignoreEOF=!1,e&&void 0!==e.qFixedWidthDelimiters?this.fixedWidthDelimiters=e.qFixedWidthDelimiters:this.fixedWidthDelimiters="1",this.fixedWidthDelimitersLastValid=this.fixedWidthDelimiters,e&&void 0!==e.qRecordSize?this.recordSize=-e.qRecordSize:this.recordSize=0,e&&void 0!==e.qComment?this.comment=e.qComment:this.comment="",e&&e.qLabel?e.qType&&0===e.qType.indexOf("TYPE9_EXCEL_")?this.labelStrategy="embedded labels":this.labelStrategy=e.qLabel:this.labelStrategy=this.labelStrategyOptions[0],e&&e.qDelimiter?this.delimiter=r(e.qDelimiter):this.delimiter=t[0],e&&e.qQuote?this.quoting=e.qQuote:this.quoting=this.quotingOptions[0],e&&e.qCodePage?this.codepage=o(this.codepageOptions,e.qCodePage):this.codepage=this.codepageOptions[0],e&&void 0!==e.qIgnoreEOF?this.ignoreEOF=i(e.qIgnoreEOF):this.ignoreEOF=!1},setFormatSpec:function(e){this.formatSpec=e},getFormatSpec:function(){return this.formatSpec},getCompiledSettings:function(){return JSON.stringify(this.getParamsForEngine())},getParamsForEngine:function(){return n.isValid(this.fixedWidthDelimiters)&&(this.fixedWidthDelimitersLastValid=this.fixedWidthDelimiters),{qLabel:this.labelStrategy,qHeaderSize:parseInt(this.nbrOfHeaderLinesToRemove,10),qDelimiter:{qNumber:parseInt(this.delimiter.number,10),qIsMultiple:!!this.delimiter.multiple},qQuote:this.quoting,qCodePage:this.codepage.number,qIgnoreEOF:i(this.ignoreEOF),qFixedWidthDelimiters:this.fixedWidthDelimitersLastValid,qTabSize:this.tabSize,qRecordSize:-1*this.recordSize,qComment:this.comment}}});return function(e,t,n){var i={},r={};this.getSettingsModelForFile=function(e){return e||(e=""),r[e]||(r[e]=new s),r[e]},this.getSettingsModelForTable=function(r,o,s){r||(r=""),o||(o=""),s||(s="");var l=e.name+"/"+r+"/"+o+"/"+s;if(!i[l]){var c=this.getSettingsModelForFile(r,o).settingsGuess;if(n){var u=n.getTableModelByDatabasePath(r,o,s);u&&u.data.fileFormatSettings&&(c=u.data.fileFormatSettings)}i[l]=new a(c,t)}return i[l]}}}),define("text!assets/scripteditor/views/filesettings/filesettings.html",[],function(){return'<div class="filesettings">\n\t<div ng-switch="layout">\n\n\t\t\x3c!-- EXCEL SETTINGS --\x3e\n\t\t<div ng-switch-when="TYPE9_EXCEL_BIFF" class="row">\n\t\t\t<div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_area_labels\'"></div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_area_headersize\'"></div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t\x3c!-- EXCEL SETTINGS --\x3e\n\t\t<div ng-switch-when="TYPE9_EXCEL_OOXML" class="row">\n\t\t\t<div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_area_labels\'"></div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_area_headersize\'"></div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t\x3c!-- CSV SETTINGS --\x3e\n\t\t<div ng-switch-when="TYPE9_CSV" class="row">\n\t\t\t<div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_area_labels\'"></div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_area_headersize\'"></div>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_area_delimiter\'"></div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_area_codepage\'"></div>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_area_inline\'"></div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_area_oef\'"></div>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_area_comment\'"></div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t\x3c!-- FIXED FILES --\x3e\n\t\t<div ng-switch-when="TYPE9_FIX" class="row">\n\t\t\t<div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_area_labels\'"></div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_area_headersize\'"></div>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_area_fixedwidth_delimiters\'"></div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_area_codepage\'"></div>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_tab_size\'"></div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_recordsize\'"></div>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_area_oef\'"></div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t\x3c!-- HTML SETTINGS --\x3e\n\t\t<div ng-switch-when="TYPE9_HTML" class="row">\n\t\t\t<div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_area_labels\'"></div>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<div class="settingArea" ng-include src="\'setting_area_codepage\'"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n\n\x3c!-- Templates --\x3e\n\n<script type="text/ng-template" id="setting_area_labels">\n\n\t<div class="title" q-translation="scripteditor.dataconnectors.labels"></div>\n\t<div class="setting">\n\t\t<lui-select x-model="currentSettings.labelStrategy" x-options="option|translatelabelstrategy|translate for option in currentSettings.labelStrategyOptions" x-disabled="tableFieldsDisabled"></lui-select>\n\t</div>\n\n<\/script>\n\n<script type="text/ng-template" id="setting_area_headersize">\n\n\t<div class="title" q-translation="scripteditor.dataconnectors.headersize"></div>\n\t<div class="headerSizeSetting">\n\t\t<qui-input-number qui-model="currentSettings.nbrOfHeaderLinesToRemove" qui-disabled="tableFieldsDisabled" qui-min="0" qui-max="9999999" qui-with-buttons="true"></qui-input-number>\n\t</div>\n\n<\/script>\n\n<script type="text/ng-template" id="setting_area_delimiter">\n\n\t<div class="title" q-translation="scripteditor.dataconnectors.delimiter"></div>\n\t<div class="setting">\n\t\t<lui-select x-model="currentSettings.delimiter" x-options="option|delimitertotitle group by option.kind|translate for option in currentSettings.delimiterOptions"></lui-select>\n\t</div>\n\n<\/script>\n\n<script type="text/ng-template" id="setting_area_fixedwidth_delimiters">\n\n\t<div class="title" q-translation="scripteditor.dataconnectors.fixpositions"></div>\n\t<div class="setting">\n\t\t<input class="lui-input" ng-class="{ \'qui-invalid\': !isFixedWidthDelimitersValid() }" type="text" ng-model="currentSettings.fixedWidthDelimiters" ng-disabled="tableFieldsDisabled" maxlength="250"/>\n\t</div>\n\n<\/script>\n\n<script type="text/ng-template" id="setting_area_codepage">\n\n\t<div class="title" q-translation="scripteditor.dataconnectors.codepage"></div>\n\t<div class="setting">\n\t\t<lui-select class="codepageselect" x-model="currentSettings.codepage" x-options="option.title group by option.kind|translate for option in currentSettings.codepageOptions">\n\t\t</lui-select>\n\t</div>\n\n<\/script>\n\n<script type="text/ng-template" id="setting_area_inline">\n\n\t<div class="title" q-translation="scripteditor.dataconnectors.quoting"></div>\n\t<div class="setting">\n\t\t<lui-select x-model="currentSettings.quoting" x-options="option|quotingvaluetolabelkey|translate for option in currentSettings.quotingOptions">\n\t\t</lui-select>\n\t</div>\n<\/script>\n\n<script type="text/ng-template" id="setting_area_oef">\n\n\t<div class="title" q-translation="scripteditor.dataconnectors.ignoreEOF"></div>\n\t<div class="setting">\n\t\t<lui-checkbox x-model="currentSettings.ignoreEOF"></lui-checkbox>\n\t</div>\n\n<\/script>\n\n<script type="text/ng-template" id="setting_area_comment">\n\n\t<div class="title" q-translation="scripteditor.dataconnectors.comment"></div>\n\t<div class="setting">\n\t\t<input class="lui-input" type="text" ng-model="currentSettings.comment" qva-model-onblur maxlength="250" />\n\t</div>\n\n<\/script>\n\n<script type="text/ng-template" id="setting_recordsize">\n\n\t<div class="title" q-translation="scripteditor.dataconnectors.recordsize"></div>\n\t<div class="headerSizeSetting">\n\t\t<qui-input-number qui-model="currentSettings.recordSize" qui-disabled="tableFieldsDisabled" qui-min="0" qui-max="9999999" qui-with-buttons="true"></qui-input-number>\n\t</div>\n\n<\/script>\n\n<script type="text/ng-template" id="setting_tab_size">\n\n\t<div class="title" q-translation="scripteditor.dataconnectors.tabsize"></div>\n\t<div class="headerSizeSetting">\n\t\t<qui-input-number qui-model="currentSettings.tabSize" qui-disabled="tableFieldsDisabled" qui-min="1" qui-max="9999999" qui-with-buttons="true"></qui-input-number>\n\t</div>\n\n<\/script>\n'}),define("scripteditor.views/filesettings/filesettings",["qvangular","text!assets/scripteditor/views/filesettings/filesettings.html","translator","assets/scripteditor/services/fixedwidth/filesettings-fixedwidthdelimiters-service"],function(e,t,n,i){return e.filter("translatelabelstrategy",function(){return function(e){return"scripteditor.dataconnectors.labelstrategy."+e.replace(" ","_")}}),e.filter("quotingvaluetolabelkey",function(){return function(e){return"none"===e?"Common.None":"standard"===e?"Common.Standard":"scripteditor.dataconnectors.quoting."+e.replace(" ","_")}}),e.filter("delimitertotitle",function(){return function(e){return"Common.Standard"===e.kind?n.get(e.name):e.number+". "+n.get(e.name)}}),function(e){this.template=t,this.controller=["$scope",function(t){t.currentSettings={},t.tableFieldsDisabled=!0,t.$watch("ownerName",function(e){t.layout=e});var n;t.$watch("tableName",function(){t.currentSettings=e.getSettingsModelForTable(t.databaseName,t.ownerName,t.tableName),t.tableName&&(t.tableFieldsDisabled=!1),n&&n(),n=t.$watch("settingsAsText()",function(e,n){t.tableName&&t.currentSettings&&e!==n&&t.onRefresh({})})}),t.settingsAsText=function(){return t.currentSettings.getCompiledSettings()},t.isFixedWidthDelimitersValid=function(){return i.isValid(t.currentSettings.fixedWidthDelimiters)},t.$parent.$parent.setFixedWidthGUIControllerOnChangeListener(function(e){t.currentSettings.fixedWidthDelimiters=e.join(","),t.$apply()}),t.$watch("currentSettings.fixedWidthDelimiters",function(){t.$parent.$parent.specialTableSettingsOk=t.isFixedWidthDelimitersValid(),t.isFixedWidthDelimitersValid()&&t.$parent.$parent.onFixedWidthDelimitersInputChange(t.currentSettings.fixedWidthDelimiters)})}]}}),define("text!assets/scripteditor/views/flatfilechooser/flatfilechooser.ng.html",[],function(){return'<div class="qui-modalbackground flatfilechoosercontainer" tid="2e6965">\n    <div class="qui-delayedModal" qv-global-escape="onEscape()" qv-global-enter="onEnter()">\n\t\t<div class="loading-screen" ng-show="isLoading">\n\t\t\t<div class="qv-loader"></div>\n\t\t</div>\n        <header class="dm-header" q-translation="scripteditor.dataconnectors.filechooser.title"></header>\n        <main class="dm-main">\n            <div class="text" q-translation="scripteditor.dataconnectors.fileconnect.path"></div>\n            <qv-file-path-input path="path" hover-path="currentHoverPath" isvalidpath="validpath" root-placeholder="rootPlaceholderName"></qv-file-path-input>\n            <p class="illegalpath" ng-style="{visibility: !validpath && \'visible\' || \'hidden\'}">{{invalidPathLabel}}</p>\n\t\t\t<qv-file-browser-widget on-dbl-click="onOKClicked()" path="path" hover-path="currentHoverPath" folderitems="folderitems" selected-file-name="selectedFileName" on-file-clicked="onFileClicked(path, name)"></qv-file-browser-widget>\n            <div class="text" q-translation="scripteditor.flatfilechooser.filetype"></div>\n\t\t\t<lui-select class="filetype" x-model="selectedFileFilter" x-options="option.title|translate for option in fileFilters"></lui-select>\n        </main>\n        <footer class="dm-footer">\n\t\t\t<lui-button x-variant="inverse" qva-activate="$event.preventDefault(); onCancelClicked()" q-translation="Common.Cancel"></lui-button>\n\t\t\t<lui-button x-variant="inverse" qva-activate="$event.preventDefault(); onOKClicked()" ng-disabled="isOkDisabled()" q-translation="scripteditor.dataconnectors.filechooser.choosefile" title="{{filePathName()}}"></lui-button>\n        </footer>\n    </div>\n</div>\n'}),define("general.services/show-service/show-service",["jquery","assets/qvangular/qvangular-core","core.utils/deferred"],function(e,t,n){"use strict";function i(){if(!s){var t=e("<div id='show-service-popup-dialog'></div>");e("body").append(t),t.showComponent(l,{views:a}),s=!0}}function r(e,t){i();var r=new n,o={component:e,input:t,deferredResult:r,exposedApi:{destroy:function(){var e=a.indexOf(o);e>=0&&a.splice(e,1)},resultPromise:r.promise}};return a.push(o),o.exposedApi}function o(n,i){var r={$element:e("body"),input:i};for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o]);return t.$injector.invoke(n,{},r)}var s,a=[];t.componentDirective("qvShowServiceView",{destroyComponent:"&",input:"=",deferredResult:"=",exposedApi:"="});var l={template:"<div><div ng-repeat='view in views' qv-show-service-view component='view.component' data-input='view.input' data-deferred-result='view.deferredResult' destroy-component='unshow(view)' data-exposed-api='view.exposedApi'></div></div>",controller:["$scope",function(e){e.unshow=function(t){var n=e.views.indexOf(t);n>=0&&e.views.splice(n,1)}}]};return{show:function(e,t){return"function"==typeof e||Array.isArray(e)?o(e,t):r(e,t)},isViewShowing:function(){return a.length>0},closeAll:function(){a.forEach(function(e){e.exposedApi.destroy()})}}}),define("scripteditor.services/file-formats",[],function(){function e(){return[new RegExp("\\.csv$","i"),new RegExp("\\.txt$","i"),new RegExp("\\.tab$","i"),new RegExp("\\.qvo$","i"),new RegExp("\\.mem$","i"),new RegExp("\\.skv$","i"),new RegExp("\\.prn$","i"),new RegExp("\\.log$","i"),new RegExp("\\.xls$","i"),new RegExp("\\.xlw$","i"),new RegExp("\\.xlsx$","i"),new RegExp("\\.xlsm$","i"),new RegExp("\\.html$","i"),new RegExp("\\.htm$","i"),new RegExp("\\.php$","i"),new RegExp("\\.fix$","i"),new RegExp("\\.dat$","i"),new RegExp("\\.qvd$","i"),new RegExp("\\.qvx$","i"),new RegExp("\\.xml$","i"),new RegExp("\\.html$","i"),new RegExp("\\.kml$","i")]}var t=[{title:"scripteditor.flatfilechooser.files.tables",titleShort:"scripteditor.flatfilechooser.files.tablesShort",regexps:e()},{title:"scripteditor.flatfilechooser.files.delimited",titleShort:"scripteditor.flatfilechooser.files.delimitedShort",regexps:[new RegExp("\\.csv$","i"),new RegExp("\\.txt$","i"),new RegExp("\\.tab$","i"),new RegExp("\\.qvo$","i"),new RegExp("\\.mem$","i"),new RegExp("\\.skv$","i"),new RegExp("\\.prn$","i"),new RegExp("\\.log$","i")]},{title:"scripteditor.flatfilechooser.files.excel",titleShort:"scripteditor.flatfilechooser.files.excelShort",regexps:[new RegExp("\\.xls$","i"),new RegExp("\\.xlw$","i"),new RegExp("\\.xlsx$","i"),new RegExp("\\.xlsm$","i")]},{title:"scripteditor.flatfilechooser.files.html",titleShort:"scripteditor.flatfilechooser.files.htmlShort",regexps:[new RegExp("\\.html$","i"),new RegExp("\\.htm$","i")]},{title:"scripteditor.flatfilechooser.files.kml",titleShort:"scripteditor.flatfilechooser.files.kmlShort",regexps:[new RegExp("\\.kml$","i")]},{title:"scripteditor.flatfilechooser.files.fix",titleShort:"scripteditor.flatfilechooser.files.fixShort",regexps:[new RegExp("\\.fix$","i"),new RegExp("\\.dat$","i")]},{title:"scripteditor.flatfilechooser.files.qvd",titleShort:"scripteditor.flatfilechooser.files.qvdShort",regexps:[new RegExp("\\.qvd$","i")]},{title:"scripteditor.flatfilechooser.files.qvx",titleShort:"scripteditor.flatfilechooser.files.qvxShort",regexps:[new RegExp("\\.qvx$","i")]},{title:"scripteditor.flatfilechooser.files.xml",titleShort:"scripteditor.flatfilechooser.files.xmlShort",regexps:[new RegExp("\\.xml$","i"),new RegExp("\\.html$","i")]},{title:"scripteditor.flatfilechooser.files.all",titleShort:"scripteditor.flatfilechooser.files.allShort",regexps:[new RegExp(".*","i")]}];return{getAllTableFileFormats:e,getFileFilters:function(){return t},getIconForFile:function(e){switch(e.split(".").pop()){case"xls":case"xlw":case"xlsx":case"xlsm":return"../resources/img/connector-logos/Excel48.png";case"csv":case"txt":case"tab":case"qvo":case"mem":case"skv":case"prn":case"log":return"../resources/img/connector-logos/Delimited48.png";case"qvd":return"../resources/img/connector-logos/QVD48.png";case"qvx":return"../resources/img/connector-logos/QVX48.png";case"xml":case"html":case"kml":default:return"../resources/img/connector-logos/AnyFile48.png"}}}}),define("text!general.views/confirm-dialog/confirm-dialog.ng.html",[],function(){return'<div class="qv-modal-container qui-modalbackground" qva-outside-ignore-for="allOutside" ng-style="containerStyle">\n\t<div class="qui-delayedModal" qv-global-escape="onEscape()">\n\t\t<header class="dm-header">{{ translatedHeader }}</header>\n\t\t<main class="dm-main">\n\t\t\t<p>{{ translatedContent }}</p>\n\t\t\t<span ng-if="options.moreContent">\n\t\t\t\t<br>\n\t\t\t\t<span q-translation="{{ options.moreContent }}"></span>\n\t\t\t</span>\n\n\t\t</main>\n\t\t<footer class="dm-footer">\n\t\t\t<lui-button x-variant="inverse" ng-if="options.showDeclineButton" qva-activate="$event.preventDefault(); onDeclineButtonClicked();" q-translation="{{ options.declineButtonTitle }}" id="declineButton" tid="2e68fc"></lui-button>\n\t\t\t<lui-button x-variant="inverse" ng-if="options.showConfirmButton" qva-activate="$event.preventDefault(); onConfirmButtonClicked();" q-translation="{{ options.confirmButtonTitle }}" id="confirmButton" tid="2e68f8" qva-focus="true"></lui-button>\n\t\t</footer>\n\t</div>\n</div>\n'}),define("general.views/confirm-dialog/confirm-dialog",["jquery","text!general.views/confirm-dialog/confirm-dialog.ng.html","general.services/show-service/show-service","translator"],function(e,t,n,i){var r={template:t,scope:{options:"="},controller:["$scope",function(e){e.translatedHeader=i.get(e.options.header,e.options.headerParameter),e.translatedContent=i.get(e.options.content,e.options.contentParameter),e.options.closePromise&&e.options.closePromise.then(function(){e.destroyComponent()}),e.onConfirmButtonClicked=function(){e.destroyComponent(),e.deferredResult.resolve(!0)},e.onEscape=e.onDeclineButtonClicked=function(){e.destroyComponent(),e.deferredResult.reject()}}]};return{confirmAction:function(t){var i={showConfirmButton:!0,showDeclineButton:!0,confirmButtonTitle:"Common.OK",declineButtonTitle:"Common.Cancel"};return e.extend(i,t),n.show(r,{options:i})}}}),define("scripteditor.services/dataconnector-service",["core.utils/deferred","autogenerated/qix/engine-enums","qvangular","general.views/confirm-dialog/confirm-dialog","core.models/engine","general.utils/string-util","core.utils/authentication","translator","core.utils/help-url","core.utils/debug-flags"],function(e,t,n,i,r,o,s,a,l,c){function u(e){return e.substr(0,e.lastIndexOf("."))||e}function h(e){var t=g?" ("+v.toLowerCase()+"_"+g.toLowerCase()+")":"";return o.endsWith(e,t)?e:e+t}function d(){return g&&v?" ("+v.toLowerCase()+"_"+g.toLowerCase()+")":""}function p(e){var t={};return"CONNECT_64"===e?t.path=64:"CONNECT_32"===e&&(t.path=32),t.text=a.get("Common."+t.path+"bit"),t}function f(e){return e&&e.displayName?e.displayName:a.get("scripteditor.dataconnectors.add.error.unknownconnector")}var m,g,v,y,b=t.NxLocalizedErrorCode,x={};s.onDataReceived.then(function(e){"NONE"!==e.userDirectory&&(g=e.userId,v=e.userDirectory)});var q={x:function(){},y:""};return q.getUsernameSuffix=d,q.appendUsernameSuffix=h,q.showConnectorErrorMessage=function(e){i.confirmAction({header:a.get("scripteditor.dataconnectors.add.error.title",[f(e)]),content:"scripteditor.dataconnectors.add.error.message",moreContent:"scripteditor.dataconnectors.add.error.suggestion",confirmButtonTitle:"Go to help",declineButtonTitle:"Common.Close",showDeclineButton:!0}).resultPromise.then(function(){window.open(l.path+"Troubleshooting_CustomConnector")})},q.hasCreatePrivileges=function(e,t){if("bdi"===t)return!0;if(!e)return!0;for(var n=0;n<e.length;n++)if(e[n].resource===t+"connection")return e[n].canCreate},q.getDataconnectorTypes=function(){if(!y){var t=[{provider:"folder",type:"folder",displayName:"scripteditor.dataconnectors.filedirectory",connectDialog:"scripteditor.views/fileconnectdialog/fileconnectdialog",selectDialog:"scripteditor.views/fileselectdialog/fileselectdialog",connectorMain:"assets/hldm/data-connectors/native-file-connector/connector-main",needsConnect:!1,isStandardConnector:!0},{provider:"ODBC",type:"ODBC",displayName:"scripteditor.dataconnectors.ODBC",connectDialog:"scripteditor.views/odbcconnectdialog/odbcconnectdialog",selectDialog:"scripteditor.views/odbcselectdialog/odbcselectdialog",connectorMain:"assets/hldm/data-connectors/native-odbc-connector/connector-main",needsConnect:!0,isStandardConnector:!0},{provider:"OLEDB",type:"OLEDB",displayName:"scripteditor.dataconnectors.OLEDB",connectDialog:"scripteditor.views/oledbconnectdialog/oledbconnectdialog",selectDialog:"scripteditor.views/odbcselectdialog/odbcselectdialog",connectorMain:"assets/hldm/data-connectors/native-oledb-connector/connector-main",needsConnect:!0,isStandardConnector:!0},{provider:"internet",type:"internet",displayName:"scripteditor.dataconnectors.webfile",selectDialog:"scripteditor.views/fileselectdialog/fileselectdialog",connectDialog:"scripteditor.views/webfilechooser/webfilechooser",connectorMain:"assets/hldm/data-connectors/native-webfile-connector/connector-main",needsConnect:!1,isStandardConnector:!0},{provider:"BDI",type:"BDI",displayName:"BDI Native",selectDialog:"assets/hldm/data-connectors/bdi/bdi-select-dialog",connectDialog:"assets/hldm/data-connectors/bdi/bdi-connect-dialog",connectorMain:"assets/hldm/data-connectors/bdi/connector-main",needsConnect:!0,isStandardConnector:!0}],n=c.NOCONNECTOR?e.when({qConnectors:[]}):r.global.getCustomConnectors();y=n.then(function(e){var n=e.qConnectors.map(function(e){var t={provider:e.qProvider,type:"custom",name:u(e.qParent),displayName:e.qDisplayName,connectDialog:e.qConnectDialog,selectDialog:e.qSelectDialog,needsConnect:e.qNeedsConnect,architecture:p(e.qMachineMode),isStandardConnector:!1};if(!t.connectDialog){var n=t.name+".webroot",i={};i[n]="../customdata/"+t.architecture.path+"/"+t.name+"/web",requirejs.config({paths:i}),t.connectDialog=n+"/connectdialog",t.selectDialog=1==e.qSupportFileStreaming?"scripteditor.views/fileselectdialog/fileselectdialog":n+"/selectdialog",t.connectorMain=n+"/connector-main",t.needsConnect=1!=e.qSupportFileStreaming,t.isStorageProvider=e.qSupportFileStreaming}return t});return(m=t.concat(n)).forEach(function(e){x[e.provider]=e,x[e.displayName]=e,e.needsConnect&&(e.title="scripteditor.accordion.draganddrop")}),x.file=x.folder,m})}return y},q.getDataconnectorInstances=function(e){return this.getDataconnectorTypes().then(function(){return r.currentApp.getConnections().then(function(t){var n=t.qConnections.filter(function(e){return"content-library"!==e.qType}).map(function(t){var n=null;if(x[t.qType]&&x[t.qType].type&&"custom"===x[t.qType].type){var i=0,r=0;if("QvOdbcConnectorPackage.exe"===t.qType)i=t.qConnectionString.indexOf("driver=")+7,r=t.qConnectionString.indexOf(";",i),n=t.qConnectionString.substring(i,r);else{var o=t.qConnectionString.indexOf("sourceType=");-1===o?t.qType&&(n=t.qType.toLowerCase()):(i=o+11,r=t.qConnectionString.indexOf(";",i),n=t.qConnectionString.substring(i,r))}}else n=t.qType.toLowerCase();var s={name:t.qName,id:t.qId,type:x[t.qType],typeName:t.qType,privileges:t.qMeta.privileges,canDelete:!0,sourceConnectorID:n,connectionString:t.qConnectionString};return e&&e(s,t),s});return o.sortSlightlyMoreNaturallyArray(n,"name",a.language),n})})},q.getConnection=function(e){return r.currentApp.getConnection(e)},q.getServersideConnectorProxy=function(t,i){return{sendJsonRequest:function(){var o=arguments[0],s=Array.prototype.slice.call(arguments,1).map(function(e){return"object"==typeof e?JSON.stringify(e):e}),a={qProvider:t.provider,qMethod:o,qParameters:s,qCommand:"JsonRequest",qAppendConnection:i?i.name:""},l=new e,c=0,u=function(e,i){r.currentApp.sendGenericCommandToCustomConnector(i).then(function(t){var n={},i=t||{};if(i)try{n=JSON.parse(i)}catch(e){window.console.log(e)}e.resolve(n)},function(r){c<2&&r.code===b.LOCERR_GENERIC_ABORTED?(console.warn("Error loading connector, retrying: "+t.name),n.getService("$timeout")(function(){++c,u(e,i)},500)):(console.warn("Failed to load connector: "+t.name),e.reject(r))})};return u(l,a),l.promise},getUsernameSuffix:d,createNewConnectionAPI:function(e,t,i,o,s,a){return e=h(e),r.currentApp.createConnection({qConnection:{qName:e,qConnectionString:t,qType:i,qUserName:o,qPassword:s,qLogOn:a}}).then(function(e){return n.$rootScope.$broadcast("connectionListModified"),e})},removeConnection:function(e){return r.currentApp.deleteConnection(e).then(function(){n.$rootScope.$broadcast("connectionListModified")})},getConnections:function(){return r.currentApp.getConnections()},getConnection:function(e){return r.currentApp.getConnection(e).then(function(e){return e},function(){return!1})},modifyConnection:function(e,t,i,o,s,a,l,c){return t=h(t),r.currentApp.modifyConnection({qConnectionId:e,qConnection:{qName:t,qConnectionString:i,qType:o,qUserName:a,qPassword:l,qLogOn:c},qOverrideCredentials:s}).then(function(e){return n.$rootScope.$broadcast("connectionListModified"),e})},createNewRawConnection:function(e,t,n){return this.createNewConnectionAPI(e,t,n,"","")},createNewConnection:function(e,t,n,i){var r=/provider=([^;]*)/,o=r.test(t)?t.match(r)[1]:"";return this.createNewConnectionAPI(e,t,o,n,i)},getErrorContent:function(e){var t=e&&!isNaN(e.code)?e.code:0,n=this.parseErrorParams(e.parameter);return a.get("ErrorCode."+t,n)},parseErrorParams:function(e){if(e){var t=[],n=/{\\?"([^}]+?)(?=\\?"})/g;return e.replace(n,function(e,n){t.push(n)}),t}}}},q}),define("assets/connectivity/services/storage-provider-service",["core.models/engine","scripteditor.services/dataconnector-service","assets/hldm/models/dataconnectors-model","general.utils/string-util"],function(e,t,n,i){function r(){return n.createDataconnectorsModel(e,e.currentApp,t,void 0,!0).then(function(e){c=[];var t=e;return t.allConnectorEntrypoints.folder?t.allConnectorEntrypoints.folder.map(function(e){var t=e.entrypoint;c[t.id]=t.name;var n={id:t.id,name:t.name,imagePath:t.imagePath,providerName:e.connectorMain.providerName,credentialsDialog:t.credentialsDialog,requiresAuthentication:!!e.connectorMain.requiresAuthentication,authenticate:e.connectorMain.authenticate,getDirectoryInfo:e.connectorMain.getDirectoryInfo,saveConnection:e.connectorMain.saveConnection,getConnectionMatch:e.connectorMain.getConnectionMatch,updateConnection:e.connectorMain.updateConnection,getAccountId:e.connectorMain.getAccountId,modifyConnection:e.connectorMain.modifyConnection,testSavedConnection:e.connectorMain.testSavedConnection};return u[n.id]=n,n}):[]})}function o(e){var n=[];return t.getDataconnectorInstances(function(e,t){n[e.id]=t.qConnectionString}).then(function(t){return c?a(t,n,e):r().then(function(){return a(t,n,e)})})}function s(e,t,n){return e.saveConnection(t,n)}function a(e,t,n){var i=e.filter(function(e){return!!c[e.sourceConnectorID]});if(i.map(function(e){var n=t[e.id],i=u[e.sourceConnectorID];n&&i&&i.getAccountId&&(e.accountId=i.getAccountId(n),e.providerName=c[e.sourceConnectorID],e.connectorImagePath=i.imagePath)}),n){var r=[];i=i.filter(function(e){var t=!1;if(r[e.providerName])r[e.providerName][e.accountId]||(r[e.providerName][e.accountId]=!0,t=!0);else{var n={};n[e.accountId]=!0,r[e.providerName]=n,t=!0}return t})}return i}function l(e,t){for(var n=e.filter(function(e){return i.startsWith(e.name,t)}),r=t.replace(/["'()]/g,"_"),o=1;n.length>0;)r=t+o.toString(),n=n.filter(function(e){return i.startsWith(e.name,r)}),++o;return r}var c=null,u=[];return{getStorageProviders:r,getConnections:o,saveConnection:function(e,t,n,i){var r={name:"",existedPreviously:!1};return i?o().then(function(i){var o=e.getConnectionMatch(i,e,t.jsonString,n);if(!o){var a=l(i,t.connectionName);return t.connectionName=a,s(e,t,n).then(function(e){return r.name=e.name,r})}return r.name=o.name,r.existedPreviously=!0,r}):s(e,t,n).then(function(e){return r.name=e.name,r})},updateConnection:function(e,t,n){e.updateConnection(t,n)},modifyConnection:function(e,t,n,i){return e.modifyConnection(t,n,i)},getConnectorType:function(e){return t.getDataconnectorTypes().then(function(t){return t.filter(function(t){return t.provider===e})[0]})}}}),define("scripteditor.views/flatfilechooser/flatfilechooser",["text!assets/scripteditor/views/flatfilechooser/flatfilechooser.ng.html","general.services/show-service/show-service","jquery","general.utils/string-util","core.utils/deferred","core.models/engine","scripteditor.services/file-formats","translator","scripteditor.utils/directory-arranger","scripteditor.services/dataconnector-service","assets/connectivity/services/storage-provider-service"],function(e,t,n,i,r,o,s,a,l,c,u){var h={template:e,scope:{dataconnectorInstance:"=",scriptEditorProxy:"="},controller:["$scope",function(e){function t(t){function n(n){e.folderitems=l.postProcessDirectoryListing(t,n.qFolderItems,e.selectedFileFilter.regexps),h(!0),e.isLoading=!1,p()}function r(n){e.folderitems=l.postProcessDirectoryListing(t,[],e.selectedFileFilter.regexps),n.isHandled=!0,h(!1,n.code),e.isLoading=!1,p()}e.folderitems=[],e.isLoading=!0,e.dataconnectorInstance?o.currentApp.getFolderItemsForConnection({qConnectionId:e.dataconnectorInstance.id,qRelativePath:i.removeSurroundingSlashes(t)}).then(n,r):o.global.getFolderItemsForPath(t).then(n,r)}function h(t,n){e.validpath=t,e.invalidPathLabel=n?a.get("ErrorCode."+n):e.invalidPathDefaultMessage}function d(e){return v?e?g[i.removeSurroundingSlashes(e)]:"root":""}function p(){e.validFilePathName=m(e.selectedFileName)}function f(t){v=t.usesId,h(t.success?!0:!1),e.folderitems=[],e.currentLocation=t.location?t.location:"",v&&(g.root="",t.folders.forEach(function(e){g[i.removeSurroundingSlashes(e.path)]=e.id}),t.files.forEach(function(e){t.location?g[i.removeSurroundingSlashes(t.location)+"\\"+e.name]=e.id:g[e.name]=e.id})),e.folderitems=l.postProcessStorageProviderDirectoryListing(e.path,t.folders,t.files,e.selectedFileFilter.regexps)}function m(t){return e.folderitems&&e.folderitems.some(function(e){return!!e.isFile&&e.name===t})}e.storageProviders=[],e.selectedStorageProvider=null,e.providersLoaded=!1,e.isLoading=!0,e.folderitems=[];var g={},v=!1;e.storageProviders=u.getStorageProviders().then(function(t){if(e.storageProviders=t,e.dataconnectorInstance){e.currentStorageProvider=e.storageProviders.filter(function(t){return t.id===e.dataconnectorInstance.sourceConnectorID})[0];var n=e;e.currentStorageProvider?(e.serverside=c.getServersideConnectorProxy(e.dataconnectorInstance.type,e.dataconnectorInstance),e.currentStorageProvider.updateConnection(e.dataconnectorInstance,e.serverside),e.currentStorageProvider.getDirectoryInfo(e.currentCredentials,e.path,d(e.path)).then(function(e){f(e),n.isLoading=!1},function(){n.isLoading=!1})):n.isLoading=!1}else e.isLoading=!1;e.providersLoaded=!0},function(){e.isLoading=!1}),e.fileFilters=s.getFileFilters(),e.path="",e.validpath=!0,e.selectedFileFilter=e.fileFilters[0],e.rootPlaceholderName=e.dataconnectorInstance?"<"+e.dataconnectorInstance.name+">":"",e.invalidPathDefaultMessage=a.get("scripteditor.dataconnectors.fileconnect.illegalpath"),e.invalidPathLabel=e.invalidPathDefaultMessage,e.$watch("path + selectedFileFilter.title",function(){if(!e.dataconnectorInstance.sourceConnectorID||!i.startsWith(e.dataconnectorInstance.sourceConnectorID,"File_")||e.providersLoaded)if(e.currentStorageProvider||e.qvxSelectedEntrypoint&&e.qvxSelectedEntrypoint.isStorageProvider){if(e.currentStorageProvider){var n=e;n.isLoading=!0,e.currentStorageProvider.getDirectoryInfo(e.currentCredentials,e.path,d(e.path)).then(function(e){f(e),n.isLoading=!1},function(){n.isLoading=!1})}}else t(e.path)}),e.$watch("selectedFileName",function(){p()}),e.providerSelected=function(t){t?(e.currentStorageProvider=t,t.requiresAuthentication&&!e.currentCredentials?u.getConnectorType(t.providerName).then(function(i){var o=new r,s={id:t.id,name:t.name,qvxSelectedEntrypoint:{id:t.id,name:t.name},kind:"connect",connectorType:i,serverside:c.getServersideConnectorProxy(i),configuration:e.configuration,deferredResult:o};n("#credentialsContainer").showComponent(t.credentialsDialog,s).onVerifyPromise.then(function(n){e.currentCredentials=n,e.rootPlaceholderName=t.name,t.getDirectoryInfo(n,e.path,d(e.path)).then(function(e){f(e)})})}):t.getDirectoryInfo(e.currentCredentials,e.path,d(e.path)).then(function(e){f(e)})):alert("Storage provider missing")},e.onFileClicked=function(t,n){e.selectedFileName=n},e.filePathName=function(){return v&&d(e.path)?d(e.path?i.combinePath(e.path,e.selectedFileName):e.selectedFileName):e.path?i.combinePath(e.path,e.selectedFileName):e.selectedFileName},e.isOkDisabled=function(){return!e.validFilePathName},e.onOKClicked=function(){e.destroyComponent(),e.deferredResult.resolve(e.filePathName())},e.onEnter=function(){e.isOkDisabled()||e.onOKClicked()},e.onEscape=e.onCancelClicked=function(){e.destroyComponent(),e.deferredResult.reject()}}]};return{selectFile:function(e){return t.show(h,{dataconnectorInstance:e.instance,scriptEditorProxy:e.scriptEditorProxy}).resultPromise}}}),define("text!scripteditor.views/uploadedfilechooser/uploadedfilechooser.ng.html",[],function(){return'<div class="qui-modalbackground uploadedfilechoosercontainer">\n\t<div class="qui-delayedModal" qv-global-escape="onEscape()" qv-global-enter="onEnter()">\n\t\t<header class="dm-header" q-translation="scripteditor.dataconnectors.filechooser.title"></header>\n\t\t<main class="dm-main">\n\t\t\t<qv-uploaded-data-files-view class="uploaded-files-view" on-file-selected="onUploadedFileSelected(name)" selected-file-name="selectedFileName" step-context="stepContext" upload-folder-connection="dataconnectorInstance"></qv-uploaded-data-files-view>\n\t\t</main>\n\t\t<footer class="dm-footer">\n\t\t\t<lui-button x-variant="inverse" qva-activate="$event.preventDefault(); onCancelClicked()" q-translation="Common.Cancel"></lui-button>\n\t\t\t<lui-button x-variant="inverse" qva-activate="$event.preventDefault(); onOKClicked()" ng-disabled="isOkDisabled()" q-translation="scripteditor.dataconnectors.filechooser.choosefile" title="{{filePathName()}}"></lui-button>\n\t\t</footer>\n\t</div>\n</div>\n'}),define("assets/hldm/services/upload-data-files-service",["jquery","qvangular","util","xsrfplugin","core.models/engine","translator","underscore"],function(e,t,n,i,r,o,s){function a(e){return e.id===b}function l(e,t){var i=(n.basePath||"/")+"qrs/appcontent/"+n.getParameterByName("app")+"/"+e+"?";return t=t||{},i+=Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")}function c(e,t){var n=[o.get("UploadedFilesFolder.FileSizeUnit.Bytes"),o.get("UploadedFilesFolder.FileSizeUnit.KB"),o.get("UploadedFilesFolder.FileSizeUnit.MB")],i=o.get("UploadedFilesFolder.FileSize.NA");if(e>0){var r=Math.max(Math.floor(Math.log(e)/Math.log(1024)),n.length-1);i=t(e/Math.pow(1024,r)*10)/10+n[r]}return i}function u(e){return c(e,Math.ceil)}function h(e){return c(e,Math.floor)}function d(){return _=r.currentApp.getContentLibraries().then(function(e){return e.qList.filter(function(e){return e.qAppSpecific})[0]})}function p(){return(_||d()).then(function(e){return e.qMeta.privileges})}function f(e){return m().then(function(t){return t.some(function(t){return n.hasFileExtension(e.name,t)})})}function m(){var e=t.defer();if(v)e.resolve(v);else{var i=encodeURI((n.basePath||"/")+"qrs/app/content/"+n.getParameterByName("app")+"/fileextensionwhitelist?xrfkey="+x);q.get(i,{headers:{"X-Qlik-XrfKey":x}}).then(function(t){v=t.data.fileExtensions.map(function(e){return e.name}),e.resolve(v)})}return e.promise}function g(e){var n=t.defer();return d().then(function(t){if(t){var i=t.qMeta.maxFileSize,r=t.qMeta.remainingLibrarySpace,s=u(e.size);"number"==typeof i&&i>0&&e.size>i?n.reject({message:o.get("UploadedFilesFolder.Error.MaxFileSizeExceeded",[e.name,s,u(i)])}):"number"==typeof r&&e.size>r?n.reject({message:o.get("UploadedFilesFolder.Error.AvailableSpaceExceeded",[e.name,s,h(r)])}):n.resolve()}},function(e){n.reject(e)}),n.promise}var v,y=[],b="47a1cfd8-f70e-4a98-a00d-00fca6c8e253",x=i.getRandomString(16),q=t.getService("$http"),C=null,S=null,w=(new XMLHttpRequest).upload,_=null,D=null;return{isFileUploadEnabled:function(){return null==D&&(D=r.global.getConfiguration()),D.then(function(e){var t=!1;return e.qConfig.qFeatures&&(t=e.qConfig.qFeatures.qIsDesktop),!t})},getAppStoreLibrary:d,getAppStoreContent:function(){var e=/[^\/]*$/;return(_||d()).then(function(e){return r.currentApp.getLibraryContent(e.qName)}).then(function(t){var n=t.qList&&t.qList.qItems||t.qList;return n&&n.length?n.map(function(t){return{fileName:t.qUrl.match(e)[0],url:t.qUrl}}):[]})},canUserReadAppStore:function(){return p().then(function(e){return e&&e.indexOf("read")>=0})},canUserModifyAppStore:function(){return p().then(function(e){return e&&e.indexOf("update")>=0})},isFileUploadSupported:function(){return w},selectFile:function(){return S&&S.reject(null),S=t.defer(),C||(C=e("<input type='file' style='display: none;'/>").appendTo(e("body")).change(function(){S&&(S.resolve(C[0].files[0]),S=null,C.remove(),C=null)})),n.isMSIE()||n.isEdge()?t.getService("$timeout")(function(){C[0].click()},0):C[0].click(),S.promise},uploadFile:function(e){var n=t.defer(),i=new XMLHttpRequest;if(i.upload){i.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=e.loaded/Math.max(Math.max(e.total,e.loaded),1);n.notify(t)}},!1),i.addEventListener("load",function(){n.resolve(e)},!1),i.addEventListener("error",function(){n.reject()},!1),i.addEventListener("abort",function(){n.resolve(null)},!1);var r=l("uploadfile",{externalpath:e.name,overwrite:!0,xrfkey:x});i.open("POST",r,!0),i.setRequestHeader("X-Qlik-XrfKey",x);var o=new FormData;o.append("file",e),i.send(o)}return n.promise},deleteFile:function(e){var n=t.defer(),i=new XMLHttpRequest;i.addEventListener("load",function(){n.resolve()},!1),i.addEventListener("error",function(){n.reject()},!1);var r=l("deletecontent",{externalpath:e,xrfkey:x});return i.open("DELETE",r,!0),i.setRequestHeader("X-Qlik-XrfKey",x),i.send(),n.promise},getFormattedFileSize:u,getFormattedAvailableSpace:h,isUploadFolderConnection:a,adjustConnectionProperties:function(e){a(e)&&(e.displayName=o.get("UploadedFilesFolder.DisplayName"),e.privileges&&e.privileges.indexOf("read")>-1?e.privileges=["read"]:e.privileges=[])},isAllowedFileType:f,checkUploadQuota:g,preUploadValidateFile:function(e){var n=t.defer();return f(e).then(function(t){if(!t)return n.reject(new Error(o.get("UploadedFilesFolder.Error.NotAllowedFileType",[e.name]))),n.promise;try{encodeURIComponent(e.name)}catch(t){return n.reject(new Error(o.get("UploadedFilesFolder.Error.IllegalCharsInFilename",[e.name]))),n.promise}return g(e).then(function(){n.resolve(!0)},function(e){n.reject(e)}),n.promise})},setAttachedFilesToReplace:function(e){e&&e.length>0?e.forEach(function(e){y.push(e.fileName?e.fileName:e.qName)}):y=[],y=s.uniq(y)},getAttachedFilesToReplace:function(){return y},getTableIdsFromLoadModelWithFileNames:function(e,t){var n=[];return t&&t.length>0&&t.forEach(function(t){e.tableModels.forEach(function(e){t===e.data.databaseName&&n.push(e.data.id)})}),n=s.uniq(n)},getTableIdsFromLoadModelUsingTableNames:function(e,t){var n=[];return t&&t.length>0&&t.forEach(function(t){e.tableModels.forEach(function(e){t===e.data.tableName&&n.push(e.data.id)})}),n}}}),define("text!assets/hldm/add-data/uploaded-files/uploaded-data-files-view.ng.html",[],function(){return'<div class="uploaded-data-files" ng-class="{\'dragging-over\': draggingOver && !uploading}">\n\t<div class="file-list">\n\t\t<ul vs-repeat vs-scroll-parent=".file-list">\n\t\t\t<li class="qui-menu-item" ng-disabled="item.disabled" ng-repeat="item in uploadedFiles"\n\t\t\t\tng-class="{fileselected:( item.isFile && item.name == selectedFileName.name)}"\n\t\t\t\tqva-activate="onFileClicked(item)" qva-dblclick="onFileDblClick(item)" title="{{item.name}}">\n\t\t\t\t<span class="used-file-indicator" ng-class="{\'file-in-use\':item.usedInLoadModel}"\n\t\t\t\t\t  title="{{getFileInUseTitle(item)}}"></span>\n\t\t\t\t<span class="file-name-icon lui-icon lui-icon--file"></span>\n\t\t\t\t<span class="file-name">{{item.name}}</span>\n\t\t\t\t<button ng-if="canUserModifyAppStore" class="lui-fade-button" qva-activate="onDeleteFileClicked(item); $event.stopPropagation();" q-title-translation="UploadedFilesFolder.DeleteFileButton.Title">\n\t\t\t\t\t<span class="lui-button__icon  lui-icon lui-icon--bin"></span>\n\t\t\t\t</button>\n\t\t\t</li>\n\t\t</ul>\n\t</div>\n\t\x3c!-- <div class="text" q-translation="scripteditor.flatfilechooser.filetype"></div> --\x3e\n\n\t<div class="bottom">\n\t\t<lui-select class="file-type"\n\t\t\t\t\tx-model="selectedFileFilter"\n\t\t\t\t\tx-options="option.title|translate for option in fileFilters"></lui-select>\n\t\t<div ng-if="canUserModifyAppStore" class="upload-drop-zone" ng-click="selectFile()">\n\t\t\t<span class="lui-icon lui-icon--upload lui-icon--large"></span>\n\t\t\t<span class="text drag-and-drop-label" q-translation="uploadfile.selectfiledialog.draganddropfilehere"></span>\n\t\t</div>\n\t\t<div ng-if="availableSpace != null" class="store-status">\n\t\t\t<span class="text" q-translation="UploadedFilesFolder.Status.AvailableSpace, {{availableSpace}}"></span>\n\t\t</div>\n\t\t<div class="file-info" ng-show="uploading || draggingOver">\n\t\t\t<div class="overlay"></div>\n\t\t\t<div class="dragging-circle centered">\n\t\t\t\t<div class="upload-icon centered lui-icon lui-icon--upload" ng-show="draggingOver && !uploading"></div>\n\t\t\t\t<div class="text upload-progress centered" ng-show="uploading">{{uploadingProgress}}</div>\n\t\t\t</div>\n\t\t\t<div class="text upload-message centered" ng-show="draggingOver && !uploading" q-translation="uploadfile.selectfiledialog.dropfilehere"></div>\n\t\t\t<div class="text upload-message centered" ng-show="uploading">{{uploadingFileName}} ({{uploadingFileSize}})</div>\n\t\t</div>\n\t</div>\n</div>\n'}),define("assets/hldm/add-data/uploaded-files/uploaded-data-files-view",["jquery","qvangular","translator","pubsub","touche","dragoman","core.models/engine","general.utils/string-util","scripteditor.services/file-formats","scripteditor.utils/directory-arranger","general.controllers/error-handler-controller","../../services/upload-data-files-service","assets/hldm/Constants","assets/hldm/models/load-model","text!./uploaded-data-files-view.ng.html"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f){t.directive("qvUploadedDataFilesView",function(){return{restrict:"E",replace:!0,template:f,scope:{uploadFolderConnection:"=",onFileSelected:"&",selectedFileName:"=",stepContext:"=",fileToUploadOnFirstLoad:"=",showFilePickerOnOpen:"=",chooseOnSingleClick:"="},controller:["$scope","$element","$timeout","$delayedModal",function(f,m,g,v){function y(){h.getAppStoreLibrary().then(function(e){e&&(f.availableSpace=h.getFormattedAvailableSpace(e.qMeta.remainingLibrarySpace))})}function b(e){return N.then(function(t){var n={};t&&t.tables&&t.connectionMetaDataModels&&t.tables.filter(function(e){return"load-file"===e.boxType&&h.isUploadFolderConnection(t.connectionMetaDataModels[e.dataconnectorName])}).forEach(function(e){n[e.databaseName.toLowerCase()]=!0}),e.forEach(function(e){e.usedInLoadModel=!!n[e.name.toLowerCase()]})})}function x(){f.uploadFolderConnection&&s.currentApp.getFolderItemsForConnection({qConnectionId:f.uploadFolderConnection.id}).then(function(e){f.allUploadedFiles=e.qFolderItems,q(f.allUploadedFiles)},function(e){f.allUploadedFiles=null,C(e)})}function q(e){var t=c.postProcessDirectoryListing("",e,f.selectedFileFilter.regexps).filter(function(e){return e.isFile});b(t).then(function(){f.uploadedFiles=t})}function C(e){f.uploadedFiles=null,e.isHandled=!0}function S(e){var t=e.dataTransfer||e.originalEvent&&e.originalEvent.dataTransfer,n=e.target.files||t.files;return n?n[0]:null}function w(e){e.stopPropagation(),e.preventDefault(),R&&(g.cancel(R),R=null),f.$apply(function(){f.draggingOver=!0})}function _(e){e.stopPropagation(),e.preventDefault(),e.relatedTarget||(R&&g.cancel(R),R=g(function(){f.draggingOver=!1},100))}function D(e){if(e.stopPropagation(),e.preventDefault(),f.stepContext.visible){var t=S(e);f.$apply(function(){f.draggingOver=!1,A(t)})}}function M(e){var i=t.defer();return f.allUploadedFiles&&f.allUploadedFiles.some(function(t){return t.qName===e.name})?v.open({title:"UploadedFilesFolder.Confirm.Overwrite.Title",content:n.get("UploadedFilesFolder.Confirm.Overwrite.Description",[e.name]),buttons:[{name:"Common.Cancel",callback:function(){i.reject()}},{name:"UploadedFilesFolder.Button.Overwrite",defaultButton:!0,callback:function(){i.resolve(!0)}}]}):i.resolve(!0),i.promise}function A(e){f.uploading||e&&h.preUploadValidateFile(e).then(function(){M(e).then(function(){h.setAttachedFilesToReplace([{fileName:e.name}]),f.uploading=!0,f.uploadingFileName=e.name,f.uploadingFileSize=h.getFormattedFileSize(e.size),f.uploadingProgress=o.format.number(0,{style:"percent"}),h.uploadFile(e).then(E,I,T)})},I)}function E(e){x(),y(),f.uploadingProgress=o.format.number(1,{style:"percent"}),g(function(){f.uploading=!1,f.selectedFileName.name=e.name,f.onFileSelected&&f.onFileSelected({name:e.name})},800)}function I(e){f.uploading=!1,e||(e={code:500}),u.showDialog(e)}function T(e){f.uploadingProgress=o.format.number(e,{style:"percent"})}function L(e){var t=e&&e.usedInLoadModel?n.get("UploadedFilesFolder.Confirm.DeleteUsedFile.Description",[e.name]):n.get("UploadedFilesFolder.Confirm.DeleteNotUsedFile.Description",[e.name]);v.open({title:"UploadedFilesFolder.Confirm.Delete.Title",html:'<span style="word-wrap: break-word">'+t+"</span>",buttons:[{name:"Common.Cancel",callback:function(){}},{name:"Common.Delete",defaultButton:!0,callback:function(){e.deleting=!0,h.deleteFile(e.name).then(function(){k(e),i.publish(d.Events.PubSub.ConnectionDeleted)},function(t){e.deleting=!1,O(e)})}}]})}function k(e){f.selectedFileName.name===e.name&&(f.selectedFileName.name=null),x(),y()}function O(e){u.showDialog({message:n.get("UploadedFilesFolder.Error.CannotDeleteFile",[e.name])})}f.allUploadedFiles=null,f.uploadedFiles=null,f.fileFilters=l.getFileFilters(),f.selectedFileFilter=f.fileFilters[0],f.uploading=!1,f.draggingOver=!1,f.uploadingFileName=null,f.uploadingFileSize=null,f.uplodingProgress=0,f.canUserModifyAppStore=!1,f.availableSpace=null,h.canUserModifyAppStore().then(function(e){f.canUserModifyAppStore=e});var P=e("body");f.$watch("uploadFolderConnection",function(){x(),y()}),f.$watch("selectedFileFilter",function(){f.allUploadedFiles&&q(f.allUploadedFiles)});var N=p.getLoadModel(function(){}).then(function(e){return e.serialize()}),R=null;P.on("dragover",w),P.on("dragleave",_),P.on("drop",D),m.on("$destroy",function(){P.off("dragover",w),P.off("dragleave",_),P.off("drop",D)}),f.onFileClicked=function(e){f.selectedFileName.name=e.name,f.chooseOnSingleClick&&f.onFileSelected({name:a.removeSurroundingSlashes(e.name)})},f.onFileDblClick=function(e){f.onFileSelected&&f.onFileSelected({name:a.removeSurroundingSlashes(e.name)})},f.onDeleteFileClicked=function(e){L(e)},f.selectFile=function(){h.selectFile().then(function(e){e&&A(e)})},f.getFileInUseTitle=function(e){return e&&e.usedInLoadModel?n.get("UploadedFilesFolder.FileInUseIndicator.Title"):n.get("UploadedFilesFolder.FileNotInUseIndicator.Title")},f.fileToUploadOnFirstLoad&&A(f.fileToUploadOnFirstLoad),f.showFilePickerOnOpen&&f.selectFile(),r(m.find(".file-list")[0]).swipe({options:{preventDefault:!1},end:function(){r.preventGestures(this.gestureHandler)}})}]}})}),define("scripteditor.views/uploadedfilechooser/uploadedfilechooser",["text!./uploadedfilechooser.ng.html","general.services/show-service/show-service","assets/hldm/add-data/uploaded-files/uploaded-data-files-view"],function(e,t){var n={template:e,scope:{dataconnectorInstance:"=",stepContext:"="},controller:["$scope",function(e){e.selectedFileName={name:null},e.onFileClicked=function(t,n){e.selectedFileName=n},e.isOkDisabled=function(){return!e.selectedFileName.name},e.onOKClicked=function(){e.destroyComponent(),e.deferredResult.resolve(e.selectedFileName.name)},e.onEnter=function(){e.isOkDisabled()||e.onOKClicked()},e.onEscape=e.onCancelClicked=function(){e.destroyComponent(),e.deferredResult.reject()},e.onUploadedFileSelected=function(t){e.selectedFileName.name=t,t&&e.onOKClicked()}}]};return{selectFile:function(e){return t.show(n,{dataconnectorInstance:e.instance,stepContext:{visible:!0}}).resultPromise}}}),define("scripteditor.services/codepage-options",["core.models/engine"],function(e){function t(e){return 1252===e||850===e||1e4===e||65001===e||1200===e}function n(e,t){return i(e,function(e){return e.qNumber===t})}function i(e,t){var n=e.filter(t)[0],i=e.indexOf(n);return e.splice(i,1),n}return{getCodepageOptionsPromise:function(){return e.global.getSupportedCodePages().then(function(e){e.qCodePages.push({qDescription:"Unicode",qNumber:1200});var i=e.qCodePages;return[n(i,1252),n(i,850),n(i,1e4),n(i,65001),n(i,1200)].concat(i).map(function(e){return{title:e.qDescription,number:e.qNumber,kind:t(e.qNumber)?"Common.Standard":"scripteditor.dataconnectors.customcodepage"}})})}}}),define("lz-string",[],function(){var e={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(t){if(null==t)return"";var n,i,r,o,s,a,l,c="",u=0;for(t=e.compress(t);u<2*t.length;)u%2==0?(n=t.charCodeAt(u/2)>>8,i=255&t.charCodeAt(u/2),r=u/2+1<t.length?t.charCodeAt(u/2+1)>>8:NaN):(n=255&t.charCodeAt((u-1)/2),(u+1)/2<t.length?(i=t.charCodeAt((u+1)/2)>>8,r=255&t.charCodeAt((u+1)/2)):i=r=NaN),u+=3,o=n>>2,s=(3&n)<<4|i>>4,a=(15&i)<<2|r>>6,l=63&r,isNaN(i)?a=l=64:isNaN(r)&&(l=64),c=c+e._keyStr.charAt(o)+e._keyStr.charAt(s)+e._keyStr.charAt(a)+e._keyStr.charAt(l);return c},decompressFromBase64:function(t){if(null==t)return"";var n,i,r,o,s,a,l,c="",u=0,h=0,d=e._f;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<t.length;)i=e._keyStr.indexOf(t.charAt(h++))<<2|(s=e._keyStr.indexOf(t.charAt(h++)))>>4,r=(15&s)<<4|(a=e._keyStr.indexOf(t.charAt(h++)))>>2,o=(3&a)<<6|(l=e._keyStr.indexOf(t.charAt(h++))),u%2==0?(n=i<<8,64!=a&&(c+=d(n|r)),64!=l&&(n=o<<8)):(c+=d(n|i),64!=a&&(n=r<<8),64!=l&&(c+=d(n|o))),u+=3;return e.decompress(c)},compressToUTF16:function(t){if(null==t)return"";var n,i,r,o="",s=0,a=e._f;for(t=e.compress(t),n=0;n<t.length;n++)switch(i=t.charCodeAt(n),s++){case 0:o+=a(32+(i>>1)),r=(1&i)<<14;break;case 1:o+=a(r+(i>>2)+32),r=(3&i)<<13;break;case 2:o+=a(r+(i>>3)+32),r=(7&i)<<12;break;case 3:o+=a(r+(i>>4)+32),r=(15&i)<<11;break;case 4:o+=a(r+(i>>5)+32),r=(31&i)<<10;break;case 5:o+=a(r+(i>>6)+32),r=(63&i)<<9;break;case 6:o+=a(r+(i>>7)+32),r=(127&i)<<8;break;case 7:o+=a(r+(i>>8)+32),r=(255&i)<<7;break;case 8:o+=a(r+(i>>9)+32),r=(511&i)<<6;break;case 9:o+=a(r+(i>>10)+32),r=(1023&i)<<5;break;case 10:o+=a(r+(i>>11)+32),r=(2047&i)<<4;break;case 11:o+=a(r+(i>>12)+32),r=(4095&i)<<3;break;case 12:o+=a(r+(i>>13)+32),r=(8191&i)<<2;break;case 13:o+=a(r+(i>>14)+32),r=(16383&i)<<1;break;case 14:o+=a(r+(i>>15)+32,32+(32767&i)),s=0}return o+a(r+32)},decompressFromUTF16:function(t){if(null==t)return"";for(var n,i,r="",o=0,s=0,a=e._f;s<t.length;){switch(i=t.charCodeAt(s)-32,o++){case 0:n=i<<1;break;case 1:r+=a(n|i>>14),n=(16383&i)<<2;break;case 2:r+=a(n|i>>13),n=(8191&i)<<3;break;case 3:r+=a(n|i>>12),n=(4095&i)<<4;break;case 4:r+=a(n|i>>11),n=(2047&i)<<5;break;case 5:r+=a(n|i>>10),n=(1023&i)<<6;break;case 6:r+=a(n|i>>9),n=(511&i)<<7;break;case 7:r+=a(n|i>>8),n=(255&i)<<8;break;case 8:r+=a(n|i>>7),n=(127&i)<<9;break;case 9:r+=a(n|i>>6),n=(63&i)<<10;break;case 10:r+=a(n|i>>5),n=(31&i)<<11;break;case 11:r+=a(n|i>>4),n=(15&i)<<12;break;case 12:r+=a(n|i>>3),n=(7&i)<<13;break;case 13:r+=a(n|i>>2),n=(3&i)<<14;break;case 14:r+=a(n|i>>1),n=(1&i)<<15;break;case 15:r+=a(n|i),o=0}s++}return e.decompress(r)},compress:function(t){if(null==t)return"";var n,i,r,o={},s={},a="",l="",c="",u=2,h=3,d=2,p="",f=0,m=0,g=e._f;for(r=0;r<t.length;r+=1)if(a=t.charAt(r),Object.prototype.hasOwnProperty.call(o,a)||(o[a]=h++,s[a]=!0),l=c+a,Object.prototype.hasOwnProperty.call(o,l))c=l;else{if(Object.prototype.hasOwnProperty.call(s,c)){if(c.charCodeAt(0)<256){for(n=0;n<d;n++)f<<=1,15==m?(m=0,p+=g(f),f=0):m++;for(i=c.charCodeAt(0),n=0;n<8;n++)f=f<<1|1&i,15==m?(m=0,p+=g(f),f=0):m++,i>>=1}else{for(i=1,n=0;n<d;n++)f=f<<1|i,15==m?(m=0,p+=g(f),f=0):m++,i=0;for(i=c.charCodeAt(0),n=0;n<16;n++)f=f<<1|1&i,15==m?(m=0,p+=g(f),f=0):m++,i>>=1}0==--u&&(u=Math.pow(2,d),d++),delete s[c]}else for(i=o[c],n=0;n<d;n++)f=f<<1|1&i,15==m?(m=0,p+=g(f),f=0):m++,i>>=1;0==--u&&(u=Math.pow(2,d),d++),o[l]=h++,c=String(a)}if(""!==c){if(Object.prototype.hasOwnProperty.call(s,c)){if(c.charCodeAt(0)<256){for(n=0;n<d;n++)f<<=1,15==m?(m=0,p+=g(f),f=0):m++;for(i=c.charCodeAt(0),n=0;n<8;n++)f=f<<1|1&i,15==m?(m=0,p+=g(f),f=0):m++,i>>=1}else{for(i=1,n=0;n<d;n++)f=f<<1|i,15==m?(m=0,p+=g(f),f=0):m++,i=0;for(i=c.charCodeAt(0),n=0;n<16;n++)f=f<<1|1&i,15==m?(m=0,p+=g(f),f=0):m++,i>>=1}0==--u&&(u=Math.pow(2,d),d++),delete s[c]}else for(i=o[c],n=0;n<d;n++)f=f<<1|1&i,15==m?(m=0,p+=g(f),f=0):m++,i>>=1;0==--u&&(u=Math.pow(2,d),d++)}for(i=2,n=0;n<d;n++)f=f<<1|1&i,15==m?(m=0,p+=g(f),f=0):m++,i>>=1;for(;;){if(f<<=1,15==m){p+=g(f);break}m++}return p},decompress:function(t){if(null==t)return"";if(""==t)return null;var n,i,r,o,s,a,l,c=[],u=4,h=4,d=3,p="",f="",m=e._f,g={string:t,val:t.charCodeAt(0),position:32768,index:1};for(n=0;n<3;n+=1)c[n]=n;for(r=0,s=Math.pow(2,2),a=1;a!=s;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=32768,g.val=g.string.charCodeAt(g.index++)),r|=(o>0?1:0)*a,a<<=1;switch(r){case 0:for(r=0,s=Math.pow(2,8),a=1;a!=s;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=32768,g.val=g.string.charCodeAt(g.index++)),r|=(o>0?1:0)*a,a<<=1;l=m(r);break;case 1:for(r=0,s=Math.pow(2,16),a=1;a!=s;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=32768,g.val=g.string.charCodeAt(g.index++)),r|=(o>0?1:0)*a,a<<=1;l=m(r);break;case 2:return""}for(c[3]=l,i=f=l;;){if(g.index>g.string.length)return"";for(r=0,s=Math.pow(2,d),a=1;a!=s;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=32768,g.val=g.string.charCodeAt(g.index++)),r|=(o>0?1:0)*a,a<<=1;switch(l=r){case 0:for(r=0,s=Math.pow(2,8),a=1;a!=s;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=32768,g.val=g.string.charCodeAt(g.index++)),r|=(o>0?1:0)*a,a<<=1;c[h++]=m(r),l=h-1,u--;break;case 1:for(r=0,s=Math.pow(2,16),a=1;a!=s;)o=g.val&g.position,g.position>>=1,0==g.position&&(g.position=32768,g.val=g.string.charCodeAt(g.index++)),r|=(o>0?1:0)*a,a<<=1;c[h++]=m(r),l=h-1,u--;break;case 2:return f}if(0==u&&(u=Math.pow(2,d),d++),c[l])p=c[l];else{if(l!==h)return null;p=i+i.charAt(0)}f+=p,c[h++]=i+p.charAt(0),i=p,0==--u&&(u=Math.pow(2,d),d++)}}};return e}),define("general.models/bnf-model",["core.models/engine","lz-string","core.utils/deferred"],function(e,t,n){"use strict";function i(e){function t(e){return e.replace(/\s+/g," ").replace(/\s+(\)|\]|,)/g,"$1").replace(/(\(|\[|,)\s+/g,"$1")}function n(){e.forEach(r),[{qStr:"must_include",qBnfLiteral:!0}].forEach(r)}function i(){function e(e,t){return{text:t,type:e}}h.functions.length<1&&n();var t=h.notFunctions.map(e.bind(null,"keyword")),i=h.functions.map(e.bind(null,"function"));h.autocompleteList=t.concat(i)}function r(e){!0===e.qBnfLiteral&&(-1===h.keywords.indexOf(e.qStr)&&h.keywords.push(e.qStr),e.qStr&&(h.keywordsAsLowerCase.push(e.qStr.toLowerCase()),h.mapping[e.qStr.toLowerCase()]=e.qNbr,e.qAggrFunc||e.qQvFunc?(-1===h.functions.indexOf(e.qStr)&&h.functions.push(e.qStr),u[e.qStr.toLowerCase()]="function"):e.qFieldFlag||(-1===h.notFunctions.indexOf(e.qStr)&&h.notFunctions.push(e.qStr),u[e.qStr.toLowerCase()]="keyword")))}function o(t){if(t=parseInt(t,10),h.bnfEntries[t])return h.bnfEntries[t];var n=e.filter(function(e){return parseInt(e.qNbr,10)===t});return h.bnfEntries[t]=n[0],n[0]||!1}function s(e){return h.keywords.length<1&&n(),e=e.toLowerCase(),o(h.mapping[e])}function a(e){var t="",n=o(e);return e>=0&&e<=56?t=n.qStr||"":n&&(t=n.qStr||n.qName),t}function l(e){return e&&!e.signature&&(e.qBnf&&e.qBnf.length>0?e.signature=e.qBnf.map(a).join(" ").trim():e.qPNbr&&(e.signature=l(o(e.qPNbr))),e.signature=t(e.signature)),e.signature||""}function c(e){var t=s(e);return!1!==t?l(t):""}var u={},h={keywords:[],keywordsAsLowerCase:[],functions:[],notFunctions:[],bnfEntries:[],mapping:{}};return n(),{getBnfEntry:o,getLiteralString:a,getAllKeywords:function(){return h.keywords.length<1&&n(),h.keywords},getAllKeywordsAsLowerCase:function(){return h.keywordsAsLowerCase.length<1&&n(),h.keywordsAsLowerCase},getAutocompleteList:function(){return h.autocompleteList||i(),h.autocompleteList},getKeywordsWithHelp:function(){return e.filter(function(e){return e.qHelpId&&e.qHelpId>0}).map(function(e){return e.qStr})},getSignatureFromKeyword:c,getFunctionTip:c,isFunction:function(e){return"function"===u[e.toLowerCase()]},isField:function(){return!1},isKeyword:function(e){return!!u[e.toLowerCase()]},isVariable:function(){return!1},getAllFunctions:function(){return h.functions.length<1&&n(),h.functions}}}function r(r){var o="BNF_CACHE_DATA_"+r,s="BNF_HASH_"+r;return e.global.getBaseBNFHash(r).then(function(a){var l=a.qBnfHash,c=new n,u=localStorage.getItem(s)===l?localStorage.getItem(o):void 0;if(u)try{var h=JSON.parse(t.decompressFromUTF16(u));return c.resolve(i(h)),c.promise}catch(e){}return e.global.getBaseBNF(r).then(function(e){var n=e.qBnfDefs;localStorage.setItem(o,t.compressToUTF16(JSON.stringify(n))),localStorage.setItem(s,e.qBnfHash),c.resolve(i(n))}),c.promise})}function o(i){var r="BNF_STRING_CACHE_DATA_"+i,o="BNF_STRING_HASH_"+i;return e.global.getBaseBNFHash(i).then(function(s){var a=s.qBnfHash,l=new n,c=localStorage.getItem(o)===a?localStorage.getItem(r):void 0;if(c)try{var u=JSON.parse(t.decompressFromUTF16(c));return l.resolve(u),l.promise}catch(e){}return e.global.getBaseBNFString(i).then(function(e){var n=e.qBnfStr;localStorage.setItem(r,t.compressToUTF16(JSON.stringify(n))),localStorage.setItem(o,e.qBnfHash),l.resolve(n)}),l.promise})}function s(e){return l[e]||(l[e]=r(e)),l[e]}function a(e){return o(e)}var l={};return{createBnfModel:i,getReloadScriptBnfModel:function(){return s("S")},getExpressionBnfModel:function(){return s("E")},getScriptBnf:function(){return a("S")}}}),define("scripteditor.utils/unique-connector-name-util",[],function(){"use strict";function e(){return o||"Connector"}function t(t){return t?e()+" "+t:e()}function n(e){for(var t=0;t<r.length;t++)if(r[t].qName===e)return!1;return!0}function i(e){return e?e.replace(/<|\>|\:|\\|\*|\?|\"|\||\//g,""):null}var r,o;return{getName:function(e,s){r=s,o=i(e);var a=t();if(r)for(var l=r.length+1;!n(a);)a=t(l),l+=1;return a}}}),define("scripteditor.services/quick-load-connector-service",["qvangular","general.utils/string-util","scripteditor.utils/unique-connector-name-util","underscore"],function(e,t,n,i){return{createConnector:function(r,o){return r.getConnections().then(function(s){var a=n.getName(t.lastFolderFromPath(o),s.qConnections),l=t.fileDirectoryFromPath(o),c=i.find(s.qConnections,function(e){return e.qConnectionString===l});return c?e.promise({name:c.qName,type:c.qType,id:c.qId,existedPreviously:!0}):r.createNewRawConnection(a,l,"folder").then(function(e){return{name:a,type:{provider:"folder",displayName:"scripteditor.dataconnectors.filedirectory",connectDialog:"scripteditor.views/fileconnectdialog/fileconnectdialog",selectDialog:"scripteditor.views/fileselectdialog/fileselectdialog",needsConnect:!1,isStandardConnector:!0},typeName:"folder",id:e.qConnectionId,existedPreviously:!1}})})},removeConnector:function(e,t){return e.getConnections().then(function(n){for(var i=0;i<n.qConnections.length;i++)if(n.qConnections[i].qName===t)return e.removeConnection(n.qConnections[i].qId)})},getLatestConnectorPath:function(e){return e.getConnections().then(function(e){for(var t,n=0,i=0;i<e.qConnections.length;i++){var r=e.qConnections[i],o=Date.parse(r.qModifiedDate.replace(" ","T"));"folder"===r.qType&&o>n&&(t=r,n=o)}if(t)return t.qConnectionString})}}}),define("scripteditor.views/fileselectdialog/fileselectdialog",["qvangular","core.models/engine","scripteditor.services/file-script-generator","scripteditor.services/file-settings-model","scripteditor.views/filesettings/filesettings","scripteditor.views/flatfilechooser/flatfilechooser","scripteditor.views/uploadedfilechooser/uploadedfilechooser","scripteditor.services/codepage-options","general.models/bnf-model","assets/hldm/services/upload-data-files-service","autogenerated/qix/engine-enums","translator","scripteditor.services/dataconnector-service","scripteditor.services/quick-load-connector-service"],function(e,t,n,i,r,o,s,a,l,c,u,h){function d(e){return"TYPE9_FIX"===e.type&&(e.fixedWidthDelimiters=e.fixedWidthDelimiters.toString(),"1"!==e.fixedWidthDelimiters&&0!==e.fixedWidthDelimiters.indexOf("1,")&&(e.fixedWidthDelimiters="1,"+e.fixedWidthDelimiters)),e}function p(e){return e.substring(e.indexOf("_")+1,e.length)}return["input","$q","standardSelectDialogService","qvAlertDialog",function(f,m,g,v){function y(){var e,t,n,i={};for(e=0;e<arguments.length;e++){t=arguments[e];for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n])}return i}var b=f.quickLoadContext,x=e.getService("qvLoader");m.all(["internet"!==f.dataconnectorInstance.type.provider?c.isUploadFolderConnection(f.dataconnectorInstance)?s.selectFile({instance:f.dataconnectorInstance}):o.selectFile({instance:f.dataconnectorInstance}):t.currentApp.getConnection(f.dataconnectorInstance.id).then(function(e){return e.qConnection.qConnectionString}),a.getCodepageOptionsPromise(),l.getReloadScriptBnfModel()]).then(function(o){var s=o[0];s&&(s=s.replace(/^(\\)/,""));var a,l,c,m,q=o[1],C=o[2],S=f.dataconnectorInstance.id,w=new i(f.dataconnectorInstance,q),_=["TYPE9_FIX","TYPE9_EXCEL_OOXML","TYPE9_EXCEL_BIFF","TYPE9_HTML","TYPE9_XML","TYPE9_KML","TYPE9_CSV","TYPE9_QVD","TYPE9_QVX"],D=["TYPE9_EXCEL_OOXML","TYPE9_EXCEL_BIFF","TYPE9_HTML","TYPE9_XML","TYPE9_KML"];x.show({messageObj:{task:"DataLoadEditor.DataConnectors.WaitWhileAnalyzing"},transparentBackground:!0}),(s?t.currentApp.guessFileType(S,s):t.currentApp.guessFileType(S)).then(function(i){i.qDataFormat.qType="TYPE9_"+i.qDataFormat.qType,-1===_.indexOf(i.qDataFormat.qType)&&(i.qDataFormat.qType="TYPE9_CSV"),w.getSettingsModelForFile(s).setSettingsGuess(i.qDataFormat),a=D.indexOf(i.qDataFormat.qType)>-1,c="scripteditor.dataconnectors."+("TYPE9_XML"===i.qDataFormat.qType||"TYPE9_HTML"===i.qDataFormat.qType?"tables":"sheets"),l="TYPE9_XML"===i.qDataFormat.qType||"TYPE9_CSV"===i.qDataFormat.qType||"TYPE9_QVD"===i.qDataFormat.qType||"TYPE9_QVX"===i.qDataFormat.qType||"TYPE9_JSON"===i.qDataFormat.qType||"TYPE9_KML"===i.qDataFormat.qType,m=a?"top-right":(i.qDataFormat.qType,"top-wide");var o={getConnectionInfo:function(){return e.promise({dbusage:!1,ownerusage:!1,dbfirst:!1,specialchars:"! \"$&'()*+,-/:;<>`{}~[]\n\r\t",dbseparator:"",ownerseparator:"",quotesuffix:'"',quoteprefix:'"',quotesuffixfordoublequotes:"]",quoteprefixfordoublequotes:"[",keywords:[]})},getDatabases:function(){return e.promise([{qName:s}])},getOwners:function(){var t,n=[];for(t=0;t<_.length;t++)n.push({qName:_[t],qIsDefault:_[t]===i.qDataFormat.qType});return e.promise(n)},getTables:function(n,i){if(D.indexOf(i)>-1){var r=p(i),o={qConnectionId:S,qRelativePath:n,qDataFormat:{qType:r}};return("TYPE9_XML"===i||"TYPE9_JSON"===i||"TYPE9_KML"===i?t.currentApp.getFileTablesEx(o):t.currentApp.getFileTables(o)).then(function(e){if(e.qTables.length>0){if(l){for(var t=0;t<e.qTables.length;t++)w.getSettingsModelForTable(n,i,e.qTables[t].qName).setFormatSpec(e.qTables[t].qFormatSpec),f.dataconnectionEditor&&f.dataconnectionEditor.getTableEditor(n,i,e.qTables[t].qName).setFormatSpec(e.qTables[t].qFormatSpec);e.qTables[0].qIsDefault=!0}return e.qTables}return[]},function(e){return 3002!==e.code&&e.code!==u.LocalizedErrorCode.LOCERR_GENERIC_INVALID_PARAMETERS&&(e.isHandled=!0),[]})}return e.promise([{qName:s,qIsDefault:!0}])},getFields:function(e,n,i){a=D.indexOf(n)>-1;var r=d(y({qType:p(n)},w.getSettingsModelForFile(e).getParamsForEngine(),w.getSettingsModelForTable(e,n,i).getParamsForEngine())),o=a?{qConnectionId:S,qRelativePath:e,qTable:i,qDataFormat:r}:{qConnectionId:S,qRelativePath:e,qTable:"",qDataFormat:r};return t.currentApp.getFileTableFields(o).then(function(t){return w.getSettingsModelForTable(e,n,i).setFormatSpec(t.qFormatSpec),f.dataconnectionEditor&&f.dataconnectionEditor.getTableEditor(e,n,i).setFormatSpec(t.qFormatSpec),t.qFields},function(e){return e.isHandled=!0,[]})},getPreview:function(e,n,i){a=D.indexOf(n)>-1;var r=d(y({qType:p(n)},w.getSettingsModelForFile(e).getParamsForEngine(),w.getSettingsModelForTable(e,n,i).getParamsForEngine())),o=a?{qConnectionId:S,qRelativePath:e,qTable:i,qDataFormat:r}:{qConnectionId:S,qRelativePath:e,qTable:"",qDataFormat:r};return t.currentApp.getFileTablePreview(o).then(function(e){return e.qPreview},function(e){return e.isHandled=!0,[]})}},h=new n.createScriptGenerator(f.dataconnectorInstance,w,C),v=new r(w),x={databaseTitle:"scripteditor.dataconnectors.file",databasePlaceholder:"scripteditor.dataconnectors.selectfile",tablesTitle:c,ownerTitle:"scripteditor.dataconnectors.fileformat",ownerPlaceholder:"",metadataVisible:!1,tablesLocation:"full-height-left",specialTableSettingsLocation:m,databaseVisible:!1,ownerVisible:!0,tablesVisible:a,forceSelectTables:l,showSelectionsSummary:!1,specialTableSettings:v,scriptGenerator:h,precedingLoadVisible:!1,selectFromTitleName:s,fileTypesWithTables:D,quickLoadContext:b,dataconnectorInstance:f.dataconnectorInstance,forceSelectFirstTable:!0};g.showStandardDialog(o,x)}).catch(function(e){e.isHandled=!0,v.show({title:h.get("ErrorDialog.Title"),message:h.get("ErrorCode."+e.code),okLabel:h.get("Common.Close")})}).finally(function(){x.close()})})}]}),define("text!assets/hldm/data-connectors/native-file-connector/connect-step.ng.html",[],function(){return'<div class="native-file-connector-container flatfilechoosercontainer">\n\t<qv-spinner class="spinner" show="isLoading" show-delay="200" show-for-at-least="500" spinner-height="200px" spinner-width="200px" center-in-parent="true"></qv-spinner>\t\n\t<main class="dm-main" tid="hdlm-file-select">\n\t\t<div class="text" ng-if="!isCloud" q-translation="scripteditor.dataconnectors.fileconnect.path"></div>\n\t\t<div class="path-row" ng-if="!isCloud">\n\t\t\t<qv-file-path-input  path="pathModel.path" hover-path="currentHoverPath" isvalidpath="validpath" root-placeholder="rootPlaceholderName" hide-root-placeholder-in-path="hideRootPlaceholderInPath"></qv-file-path-input>\n\t\t</div>\n\t\t<p class="illegalpath" ng-if="!isCloud" ng-class="{visible: !validpath }">{{invalidPathLabel}}</p>\n\t\t<qv-file-browser-home  ng-show="pathModel.path === \'\' && !dataconnectorInstance" connections="allFileConnections" drives="drives" on-click-shortcut="onClickShortcut" on-click-drive="onClickDrive"></qv-file-browser-home>\n\t\t<qv-file-browser-widget hide-back="noBackButton" ng-show="pathModel.path || dataconnectorInstance" on-dbl-click="qvDialogContext.next()" return-to-home="returnToHome" path="pathModel.path" hover-path="currentHoverPath" folderitems="folderitems" selected-file-name="selectedFileName" on-file-clicked="onFileClicked(path, name)"></qv-file-browser-widget>\n\t\t<div class="text qs-ft" q-translation="scripteditor.flatfilechooser.filetype"></div>\n\t\t<lui-select class="filetype" x-model="selectedFileFilter" x-options="option.title|translate for option in fileFilters"></lui-select>\n\t</main>\n</div>\n'}),define("text!assets/scripteditor/directives/qvfilebrowser/qvfilebrowser.ng.html",[],function(){return'<div class="qvfilebrowser">\n\t<ul class="qv-fb-ul" vs-repeat vs-scroll-parent=".qvfilebrowser" ng-class="{\'hideBack\': hideBack}">\n\t\t<li class="qui-menu-item" tid="file-list-item" ng-disabled="item.disabled || (item.isFile && isAddMode)" ng-repeat="item in folderitems" \n\t\t\tng-class="{\'data-file\': item.isFile, \'data-folder\': !item.isFile, \'fileselected\': item.isFile && item.name == selectedFileName }"\n\t\t\tng-click="onItemClick(item);"\n\t\t\tqva-dblclick="onItemDblClick(item)"\n\t\t\ttitle="{{item.path}}">\n\n\t\t\t<span class="list-icon lui-icon lui-icon--back" ng-show="!hideBack && $index === 0"></span>\n\n\t\t\t<span  class="list-icon lui-icon" ng-show="hideBack || $index > 0" ng-class="{\'lui-icon--file\': item.isFile, \'lui-icon--folder\': !item.isFile }"></span>\n\t\t\t<span>{{item.name}}</span>\n\t\t\t<span class="extra-info" ng-show="item.extraInfo">{{item.extraInfo}}</span>\n\t\t</li>\n\t</ul>\n</div>\n'}),define("assets/scripteditor/directives/qvfilebrowser/qvfilebrowser",["assets/qvangular/qvangular-core","text!assets/scripteditor/directives/qvfilebrowser/qvfilebrowser.ng.html","touche"],function(e,t,n){e.directive("qvFileBrowserWidget",function(){return{restrict:"EAC",replace:!0,scope:{path:"=",hoverPath:"=",folderitems:"=",onFileClicked:"&",selectedFileName:"=",isAddMode:"=",onDblClick:"&",returnToHome:"=",hideBack:"="},template:t,controller:["$scope","$element","$timeout",function(e,t,i){var r=!1;e.onItemClick=function(n){n.disabled||(n.isFile?e.onFileClicked&&e.onFileClicked({item:n,path:n.path,name:n.name}):n.isAtRoot?e.returnToHome():(e.path=n.path,t.scrollTop(0)))},e.onItemDblClick=function(t){t.disabled||r||(r=!0,e.onDblClick(),i(function(){r=!1},500))},e.onMouseEnter=function(t){e.hoverPath=t},e.onMouseLeave=function(t){e.hoverPath===t&&(e.hoverPath=void 0)},e.isHovered=function(t){return e.hoverPath===t},e.isFileSelected=function(t){return t.isFile&&t.name===e.selectedFileName},n(t[0]).swipe({options:{preventDefault:!1},end:function(){n.preventGestures(this.gestureHandler)}})}]}})}),define("text!assets/scripteditor/directives/qvfilepathinput/qvfilepathinput.ng.html",[],function(){return'<div class="qvfilepathinputcontainer" tabindex="-1" ng-class="{ invalidpath: !isvalidpath }">\n\t<div class="itemcontainer" onclick="$(\'input.qvfilepathinputcontainer-input\').focus();">\n\t\t<div ng-repeat="item in items" class="item">\n\t\t\t<div class="lui-button" ng-class="{hover:isHovered(item.path)}" ng-click="onItemClick(item.path, $event);" ng-mouseenter="onMouseEnter(item.path);" ng-mouseleave="onMouseLeave(item.path);" title="{{item.path}}">{{item.name}}</div>\n\t\t\t<div class="icon-hub-next"></div>\n\t\t</div>\n\t</div>\n\t<input class="lui-input qvfilepathinputcontainer-input" tid="filepathinputcontainer-path-input-box" type="text" ng-model="path" qva-model-onblur="true" maxlength="500" onfocus="this.value = this.value;" onblur="/*QLIK-14545*/var t = this.value; this.value = \'\'; this.value = t;"/>\n</div>\n'}),define("assets/scripteditor/directives/qvfilepathinput/qvfilepathinput",["assets/qvangular/qvangular-core","text!assets/scripteditor/directives/qvfilepathinput/qvfilepathinput.ng.html","general.utils/string-util"],function(e,t,n){e.directive("qvFilePathInput",function(){return{restrict:"EA",scope:{path:"=",hoverPath:"=",isvalidpath:"=",rootPlaceholder:"=",hideRootPlaceholderInPath:"="},replace:!0,requires:["qvEnter"],template:t,controller:["$scope",function(e){function t(){e.items.unshift({name:e.rootPlaceholder,path:""})}function i(){var i,r,o,s;if(e.items=[],"\\\\"===e.path.substring(0,2)?(i=n.removeSurroundingSlashes(e.path.substring(2)||"").split("\\"))[0]="\\\\"+i[0]:i=n.removeSurroundingSlashes(e.path||"").split("\\"),i.length>0&&i[0].length>0){s="";for(var a=0;a<i.length;a++)r=i[a],":"===(o=i[a])[o.length-1]&&(o=o.substring(0,o.length-1)),s+=a!==i.length-1||""===s?r+"\\":r,e.items.push({name:o,path:s});e.rootPlaceholder&&!e.hideRootPlaceholderInPath&&t()}else e.rootPlaceholder&&t()}e.onItemClick=function(t,n){n.stopPropagation(),e.path=t,i()},e.$watch("path",function(t){void 0!==t&&(e.path=t.trim(),i())}),e.$watch("rootPlaceholder",function(){void 0!==e.path&&i()}),e.onMouseEnter=function(t){e.hoverPath=t},e.onMouseLeave=function(t){e.hoverPath===t&&(e.hoverPath=void 0)},e.isHovered=function(t){return e.hoverPath===t}}]}})}),define("text!assets/scripteditor/directives/qvfilebrowserhome/qvFileBrowserHome.ng.html",[],function(){return'<ul class="qv-fb-ul" ng-if="$ctrl.connections.length > 0">\n\n\t<li class="qui-menu-item header">\n\t\t<span class="title-icon lui-icon  lui-icon--triangle-bottom" aria-hidden="true" ng-class="{\'lui-icon--triangle-bottom\': $ctrl.folderListExpanded, \'lui-icon--triangle-right\': !$ctrl.folderListExpanded}" ng-click="$ctrl.toggleFolderExpansion()"></span>\n\t\t<div class="title-text" q-translation="AddData.SharedFiles.FolderShortcuts"></div>\n\t</li>\n\n\t<li ng-if="$ctrl.folderListExpanded" class="qui-menu-item" tid="file-list-item" ng-repeat="connection in $ctrl.connections"\n\t\ttitle="{{connection.connectorInstance.name}}" ng-click="$ctrl.onClickShortcut(connection)">\n\t\t<span class="list-icon lui-icon lui-icon--folder"></span>\n\t\t{{connection.connectorInstance.name}}\n\t</li>\n</ul>\n\n<ul class="qv-fb-ul" ng-if="$ctrl.drives.length > 0">\n\t<li class="qui-menu-item header">\n\t\t<span class="title-icon lui-icon  lui-icon--triangle-bottom" aria-hidden="true" ng-class="{\'lui-icon--triangle-bottom\': $ctrl.computerExpanded, \'lui-icon--triangle-right\': !$ctrl.computerExpanded}" ng-click="$ctrl.toggleComputerExpansion()"></span>\n\t\t<div class="title-text" q-translation="AddData.SharedFiles.Computer"></div>\n\t</li>\n\n\t<li ng-if="$ctrl.computerExpanded" tid="file-list-item" class="qui-menu-item" ng-repeat="drive in $ctrl.drives"\n\t\ttitle="{{drive.name}}" ng-click="$ctrl.onClickDrive(drive.path)">\n\t\t<span class="list-icon lui-icon lui-icon--folder"></span>\n\t\t{{drive.name}}\n\t</li>\n</ul>\n'}),define("assets/scripteditor/directives/qvfilebrowserhome/qvFileBrowserHome",["qvangular","text!./qvFileBrowserHome.ng.html"],function(e,t){e.nativeComponent("qvFileBrowserHome",{bindings:{connections:"<",drives:"<",onClickShortcut:"<",onClickDrive:"<"},controller:[function(){var e=this;e.folderListExpanded=!0,e.computerExpanded=!0,e.toggleFolderExpansion=function(){e.folderListExpanded=!e.folderListExpanded},e.toggleComputerExpansion=function(){e.computerExpanded=!e.computerExpanded}}],template:t})}),define("assets/hldm/data-connectors/native-file-connector/connect-step",["text!./connect-step.ng.html","general.utils/string-util","core.models/engine","scripteditor.services/file-formats","translator","core.utils/deferred","scripteditor.utils/directory-arranger","scripteditor.services/dataconnector-service","scripteditor.services/quick-load-connector-service","assets/scripteditor/directives/qvfilebrowser/qvfilebrowser","assets/scripteditor/directives/qvfilepathinput/qvfilepathinput","assets/scripteditor/directives/qvfilebrowserhome/qvFileBrowserHome"],function(e,t,n,i,r,o,s,a,l){return{template:e,scope:{title:"=",serverside:"=",continueWithNewConnection:"=",qvDialogContext:"=",qvxSelectedEntrypoint:"=",dataconnectorInstance:"=",storageProvider:"=",pathModel:"=",startPath:"=",allFileConnections:"=",canBrowseAll:"=",isCloud:"="},controller:["$scope","$timeout",function(e,c){function u(){e.pathModel||(e.pathModel={path:"",id:void 0}),C=!0,e.qvDialogContext.title=r.get("scripteditor.dataconnectors.filechooser.title"),e.qvDialogContext.nextDisabled=q,e.qvDialogContext.size="S",e.storageProvider&&(e.isLoading=!0,e.storageProvider.updateConnection(e.dataconnectorInstance,e.serverside),e.storageProvider.getDirectoryInfo(e.currentCredentials,e.pathModel.path,e.pathModel.id).then(function(t){e.isLoading=!1,p(e.storageProvider.name,t)})),e.fileFilters=i.getFileFilters(),e.isLoading=!1,e.startPath&&(e.pathModel.path=e.startPath,e.startPath=null),e.validpath=!0,e.hideRootPlaceholderInPath=!e.dataconnectorInstance,e.rootPlaceholderName=e.dataconnectorInstance?"<"+e.dataconnectorInstance.name+">":"",e.invalidPathDefaultMessage=r.get("scripteditor.dataconnectors.fileconnect.illegalpath"),e.invalidPathLabel=e.invalidPathDefaultMessage,e.selectedFileFilter=e.fileFilters[0],m(),e.canBrowseAll&&h().then(function(t){e.drives=t})}function h(){return n.global.getLogicalDriveStrings().then(function(e){return s.postProcessDriveListing(e.qDrives,!0).filter(function(e){return!e.disabled})})}function d(){function i(t){e.folderitems=s.postProcessDirectoryListing(e.pathModel.path,t.qFolderItems,e.selectedFileFilter.regexps,e.isCloud),g(!0),e.isLoading=!1,y()}function r(t){t.isHandled=!0,g(!1,t.code),e.isLoading=!1,y(),e.folderitems=s.postProcessDirectoryListing(e.pathModel.path,[],e.selectedFileFilter.regexps,e.isCloud)}e.pathModel&&void 0===e.pathModel.path||!e.selectedFileFilter||(e.folderitems=[],e.isLoading=!0,e.noBackButton=e.isCloud,v()&&C&&!f(e.pathModel.path)?x().then(function(t){return e.pathModel.path=t.lastPath?t.lastPath:t.myDocs.qFolder,n.global.getFolderItemsForPath(e.pathModel.path).then(i,function(t){g(!0),e.isLoading=!1,e.folderitems=s.postProcessDirectoryListing(e.pathModel.path,t.qFolderItems,e.selectedFileFilter.regexps,e.noBackButton),y()},function(){e.isLoading=!1})}):v()?n.global.getLogicalDriveStrings().then(function(t){e.isLoading=!1,e.folderitems=s.postProcessDriveListing(t.qDrives),g(!0)},function(){e.isLoading=!1}):(e.dataconnectorInstance?n.currentApp.getFolderItemsForConnection({qConnectionId:e.dataconnectorInstance.id,qRelativePath:t.removeSurroundingSlashes(e.pathModel.path)}).then(i,r):e.canBrowseAll?n.global.getFolderItemsForPath(e.pathModel.path).then(i,r):e.isLoading=!1,C=!1))}function p(t,n){e.folderitems=[],e.noBackButton=""===e.pathModel.path,e.currentLocation=n.location?n.location:"",e.folderitems=s.postProcessStorageProviderDirectoryListing(e.pathModel.path,n.folders,n.files,e.selectedFileFilter.regexps,e.noBackButton),C=!1}function f(e){return e===S}function m(){if(e.qvxSelectedEntrypoint)for(var t=0;t<e.fileFilters.length;t++)if(e.fileFilters[t].title===e.qvxSelectedEntrypoint.id){e.selectedFileFilter=e.fileFilters[t];break}}function g(t,n){e.validpath=t,e.invalidPathLabel=n?r.get("ErrorCode."+n):e.invalidPathDefaultMessage}function v(){return!e.dataconnectorInstance&&""===e.pathModel.path&&e.canBrowseAll}function y(){e.validFilePathName=b(e.selectedFileName)}function b(t){return e.folderitems&&e.folderitems.some(function(e){return!!e.isFile&&e.name===t})}function x(){return o.all({myDocs:n.global.getMyDocumentsFolder()})}function q(){return!e.validFilePathName}var C=!0,S="";s.setNewBackStyle(),u(),e.onClickDrive=function(t){e.pathModel.path=t},e.onClickShortcut=function(t){e.dataconnectorInstance=t.connectorInstance,e.pathModel.path="",u(),d()},e.returnToHome=function(){e.pathModel.path="",e.dataconnectorInstance=null,u()},e.onConnectionChnaged=function(t){e.dataconnectorInstance=t.connectorInstance,e.pathModel.path="",u(),d()},e.$watch("pathModel.path + selectedFileFilter.title",function(){if(e.storageProvider){if(C)return;var t=e.folderitems.filter(function(t){return t.path===e.pathModel.path})[0];t&&(e.pathModel.id=t.id),e.isLoading=!0,e.storageProvider.getDirectoryInfo(e.currentCredentials,e.pathModel.path,e.pathModel.id).then(function(t){e.isLoading=!1,p(e.storageProvider.name,t)})}else e.pathModel&&d(e.pathModel)}),e.$watch("selectedFileName",function(){y()}),e.onFileClicked=function(t,n){e.selectedFileName=n,c(e.qvDialogContext.next)},e.filePathName=function(){return e.pathModel.path?t.combinePath(e.pathModel.path,e.selectedFileName):e.selectedFileName},e.qvDialogContext.next=function(){q()||(e.dataconnectorInstance?e.continueWithNewConnection({pathName:e.pathModel.path,connectionName:e.dataconnectorInstance.name,singleFileName:t.removeSurroundingSlashes(e.filePathName()),usingExisting:!0}):l.createConnector(a.getServersideConnectorProxy(),e.filePathName()).then(function(t){t&&e.continueWithNewConnection({pathName:e.pathModel.path,connectionName:t.name,singleFileName:e.selectedFileName,usingExisting:t.existedPreviously})}))},e.onEscape=e.onCancelClicked=function(){e.destroyComponent(),e.deferredResult.reject()}}]}}),define("text!assets/hldm/data-connectors/native-file-connector/select-step.ng.html",[],function(){return'<div class="native-file-connector-select">\n\t<qv-generic-select-dialog ng-if="dataHasLoaded" data-provider="provider"\n\t\t\t\t\t\t\t  data-dataconnection-selection-editor="dataconnectionSelectionEditor"\n\t\t\t\t\t\t\t  data-qv-dialog-context="qvDialogContext"\n\t\t\t\t\t\t\t  data-qv-internals="qvInternals">\n\t</qv-generic-select-dialog>\n\t<qv-spinner class="spinner" show="!dataHasLoaded" show-delay="200" show-for-at-least="500" spinner-height="200px" spinner-width="200px" center-in-parent="true"></qv-spinner>\n</div>\n'}),define("assets/hldm/data-connectors/native-file-connector/native-file-provider",["core.models/engine","qvangular","core.utils/deferred","general.models/bnf-model","scripteditor.services/file-settings-model","scripteditor.services/file-script-generator","scripteditor.services/codepage-options","scripteditor.views/filesettings/filesettings","autogenerated/qix/engine-enums"],function(e,t,n,i,r,o,s,a,l){return{createNativeFileProvider:function(c,u,h,d,p){function f(e){return e.substring(e.indexOf("_")+1,e.length)}function m(e){return"FIX"===e.qType&&(e.qFixedWidthDelimiters=e.qFixedWidthDelimiters.toString(),e.qLabel="no labels","1"!==e.qFixedWidthDelimiters&&0!==e.qFixedWidthDelimiters.indexOf("1,")&&(e.qFixedWidthDelimiters="1,"+e.qFixedWidthDelimiters)),e}function g(){var e,t,n,i={};for(e=0;e<arguments.length;e++){t=arguments[e];for(n in t)t.hasOwnProperty(n)&&(i[n]=t[n])}return i}function v(t,n){return n?e.currentApp.guessFileType(t,n):e.currentApp.guessFileType(t)}var y,b,x,q=c.id;h?p?e.currentApp.getConnection(q).then(function(e){x=e.qConnection.qConnectionString}):x=h.singleFileName:d?x=d.data.databaseName:p?e.currentApp.getConnection(q).then(function(e){x=e.qConnection.qConnectionString}):x=void 0;var C,S,w,_,D,M=["TYPE9_FIX","TYPE9_EXCEL_OOXML","TYPE9_EXCEL_BIFF","TYPE9_HTML","TYPE9_XML","TYPE9_KML","TYPE9_CSV","TYPE9_QVD","TYPE9_QVX"],A=["TYPE9_EXCEL_OOXML","TYPE9_EXCEL_BIFF","TYPE9_HTML","TYPE9_XML","TYPE9_KML"];return n.all({codepageOptions:s.getCodepageOptionsPromise(),bnfModel:i.getReloadScriptBnfModel()}).then(function(n){return b=n.codepageOptions,y=n.bnfModel,C=new r(c,b,u),S=new o.createScriptGenerator(c,C,y),v(q,x).then(function(n){return n.qDataFormat.qType="TYPE9_"+n.qDataFormat.qType,-1===M.indexOf(n.qDataFormat.qType)&&(n.qDataFormat.qType="TYPE9_CSV"),C.getSettingsModelForFile(x).setSettingsGuess(n.qDataFormat),_=!d&&("TYPE9_XML"===n.qDataFormat.qType||"TYPE9_CSV"===n.qDataFormat.qType||"TYPE9_QVD"===n.qDataFormat.qType||"TYPE9_QVX"===n.qDataFormat.qType||"TYPE9_JSON"===n.qDataFormat.qType||"TYPE9_KML"===n.qDataFormat.qType),w=A.indexOf(n.qDataFormat.qType)>-1,{getConnectionInfo:function(){return t.promise({dbusage:!1,ownerusage:!1,dbfirst:!1,specialchars:"! \"$&'()*+,-/:;<>`{}~[]\r\n\t",dbseparator:"",ownerseparator:"",quotesuffix:'"',quoteprefix:'"',quotesuffixfordoublequotes:"]",quoteprefixfordoublequotes:"[",keywords:[]})},getDatabases:function(){return p?t.promise([{qName:""}]):t.promise([{qName:x}])},getOwners:function(){var e,i=[];for(e=0;e<M.length;e++)i.push({qName:M[e],qIsDefault:M[e]===n.qDataFormat.qType});return t.promise(i)},getTables:function(n,i){if(A.indexOf(i)>-1){var r=f(i),o={qConnectionId:q,qRelativePath:n,qDataFormat:{qType:r}};return("TYPE9_XML"===i||"TYPE9_JSON"===i||"TYPE9_KML"===i?e.currentApp.getFileTablesEx(o):e.currentApp.getFileTables(o)).then(function(e){if(e.qTables.length>0){if(_){for(var t=0;t<e.qTables.length;t++)if(u){var r=u.getOrCreateTableModelByDatabasePath(n,i,e.qTables[t].qName);C.getSettingsModelForTable(n,i,e.qTables[t].qName).setFormatSpec(e.qTables[t].qFormatSpec),r.setFormatSpec(e.qTables[t].qFormatSpec)}else C.getSettingsModelForTable(n,i,e.qTables[t].qName).setFormatSpec(e.qTables[t].qFormatSpec);e.qTables[0].qIsDefault=!0}return e.qTables}return[]},function(e){return 3002!==e.code&&e.code!==l.LocalizedErrorCode.LOCERR_GENERIC_INVALID_PARAMETERS&&(e.isHandled=!0),[]})}if(p)return t.promise([{qName:c.name,qIsDefault:!0}]);var s=x.lastIndexOf("\\"),a=s>=0?x.substring(s+1):x,h=a.lastIndexOf("."),d=h>=0?a.substring(0,h):a;return t.promise([{qName:d,qIsDefault:!0}])},getFields:function(t,n,i,r){var o=A.indexOf(n)>-1,s=m(g({qType:f(n)},C.getSettingsModelForFile(t).getParamsForEngine(),C.getSettingsModelForTable(t,n,i).getParamsForEngine())),a=o?{qConnectionId:q,qRelativePath:t,qTable:i,qDataFormat:s}:{qConnectionId:q,qRelativePath:t,qTable:"",qDataFormat:s};return e.currentApp.getFileTableFields(a).then(function(e){var o=C.getSettingsModelForTable(t,n,i);if(o.setFormatSpec(e.qFormatSpec),u){var s=u.getOrCreateTableModelByDatabasePath(t,n,i);s.data.fileFormatSettings=o.getParamsForEngine(),s.setFormatSpec(e.qFormatSpec)}return r&&(r.qFormatSpec=e.qFormatSpec,r.fileFormatSettings=o.getParamsForEngine()),e.qFields},function(e){return e.isHandled=!0,[]})},getPreview:function(t,n,i){w=A.indexOf(n)>-1;var r=m(g({qType:f(n)},C.getSettingsModelForFile(t).getParamsForEngine(),C.getSettingsModelForTable(t,n,i).getParamsForEngine())),o=w?{qConnectionId:q,qRelativePath:t,qTable:i,qDataFormat:r}:{qConnectionId:q,qRelativePath:t,qTable:"",qDataFormat:r};return e.currentApp.getFileTablePreview(o).then(function(e){return e.qPreview},function(e){return e.isHandled=!0,[]})},selectOptions:{databaseTitle:"scripteditor.dataconnectors.file",databasePlaceholder:"scripteditor.dataconnectors.selectfile",tablesTitle:D="scripteditor.dataconnectors."+("TYPE9_XML"===n.qDataFormat.qType||"TYPE9_HTML"===n.qDataFormat.qType?"tables":"sheets"),ownerTitle:"scripteditor.dataconnectors.fileformat",ownerPlaceholder:"",metadataVisible:!1,tablesLocation:"full-height-left",specialTableSettingsLocation:"top-right",databaseVisible:!1,ownerVisible:!0,tablesVisible:!0,forceSelectTables:_,scriptGenerator:S,showSelectionsSummary:!1,specialTableSettings:new a(C),precedingLoadVisible:!1,selectFromTitleName:x,fileTypesWithTables:A,dataconnectorInstance:c,forceSelectFirstTable:!d,tableModelToEdit:d}}})})}}}),define("assets/hldm/data-connectors/native-file-connector/select-step",["text!./select-step.ng.html","assets/hldm/data-connectors/native-file-connector/native-file-provider","translator"],function(e,t,n){return{template:e,scope:{qvDialogContext:"=",dataconnectionSelectionEditor:"=",connectionInput:"=",dataconnectorInstance:"=",qvInternals:"=",tableModelToEdit:"="},controller:["$scope","qvAlertDialog",function(e,i){e.dataHasLoaded=!1,t.createNativeFileProvider(e.dataconnectorInstance,e.dataconnectionSelectionEditor,e.connectionInput,e.tableModelToEdit,!1).then(function(t){e.qvDialogContext.size="L",e.qvDialogContext.title=e.tableModelToEdit?n.get("quickdataload.EditSelectionsFor",e.tableModelToEdit.data.tableName):n.get("scripteditor.dataconnectors.dialog.titlewithname",t.selectOptions.selectFromTitleName),e.provider=t,e.dataHasLoaded=!0},function(t){var r,o,s;return t.isHandled=!0,e.tableModelToEdit&&e.tableModelToEdit.data&&e.tableModelToEdit.data.databaseName?(r="quickdataload.EditSelections.FileNoLongerExistsHeader",o=e.tableModelToEdit.data.databaseName,s="quickdataload.EditSelections.FileNoLongerExistsContent"):(r="ErrorDialog.Title",s="ErrorCode."+t.code),i.show({title:n.get(r,o),message:n.get(s),okLabel:n.get("Common.Close")}).closed.then(function(){e.qvDialogContext.back()}),!1})}]}}),define("assets/hldm/data-connectors/native-file-connector/connector-main",["assets/hldm/data-connectors/native-file-connector/connect-step","assets/hldm/data-connectors/native-file-connector/select-step","scripteditor.services/file-formats","translator"],function(e,t,n,i){function r(e){switch(e){case"scripteditor.flatfilechooser.files.excel":case"scripteditor.flatfilechooser.files.delimited":case"scripteditor.flatfilechooser.files.all":case"scripteditor.flatfilechooser.files.qvd":case"scripteditor.flatfilechooser.files.qvx":return!0;default:return!1}}return{create:function(){return{entrypoints:n.getFileFilters().filter(function(e){return r(e.title)}).map(function(t){return{id:t.title,category:"file",name:i.get(t.titleShort),initialConnectStep:e}}).sort(function(e){return"scripteditor.flatfilechooser.files.all"===e.id?-1:1}),getInitialSelectStep:function(){return t},getInitialFileDropStep:function(){return t}}}}}),define("assets/hldm/data-connectors/native-file-connector/native-file-connector",["scripteditor.views/fileconnectdialog/fileconnectdialog","scripteditor.views/fileselectdialog/fileselectdialog","assets/hldm/data-connectors/native-file-connector/connector-main"],function(e,t,n){return{connectDialog:e,selectDialog:t,connectorMain:n}}),define("text!assets/scripteditor/views/odbcconnectdialog/odbcconnectdialog.ng.html",[],function(){return'<div class="qui-modalbackground odbcconnectdialogcontainer">\n\t<div class="qui-delayedModal odbcconnectdialog" qv-global-enter="onOKClicked()" qv-global-escape="onCancelClicked()">\n\t\t<div class="loading-screen" ng-show="isLoading">\n\t\t\t<div class="qv-loader"></div>\n\t\t</div>\n\t\t<header class="dm-header" q-translation="{{isEdit ? \'scripteditor.dataconnectors.odbcconnect.edittitle\' : \'scripteditor.dataconnectors.odbcconnect.title\'}}"></header>\n\t\t<main class="dm-main">\n\t\t\t<div class="lui-buttongroup">\n\t\t\t\t<button class="lui-button" ng-class="{ \'lui-active\': isDSNButtonActive(DSN_TYPE_USER) }" ng-disabled="isLoading" q-translation="scripteditor.dataconnectors.createdialog.label.userdsn" qva-activate="onDSNTypeClicked(DSN_TYPE_USER)" tid="selectUserOdbcDatasources"></button>\n\t\t\t\t<button class="lui-button" ng-class="{ \'lui-active\': isDSNButtonActive(DSN_TYPE_SYSTEM) }" ng-disabled="isLoading" q-translation="scripteditor.dataconnectors.createdialog.label.systemdsn" qva-activate="onDSNTypeClicked(DSN_TYPE_SYSTEM)" tid="selectSystemOdbcDatasources"></button>\n\t\t\t</div>\n\t\t\t<div class="options">\n\t\t\t\t<div ng-show="showFilter32Or64Bit();">\n\t\t\t\t\t<lui-radiobutton x-disabled="isLoading" x-name="radioButton32or64" x-model="radioButton32or64" x-value="{{BIT_TYPE_32}}">{{BIT_TYPE_32_KEY}}</lui-radiobutton>\n\t\t\t\t\t<lui-radiobutton x-disabled="isLoading" x-name="radioButton32or64" x-model="radioButton32or64" x-value="{{BIT_TYPE_64}}">{{BIT_TYPE_64_KEY}}</lui-radiobutton>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<ul class="datasource-list">\n\t\t\t\t\t<li ng-repeat="datasource in datasources | filter: filter32Or64Bit | filter: filterUserOrSystem">\n\t\t\t\t\t\t<div class="qui-menu-item" ng-class="{disabled: isDatasourceListDisabled(), selected: isSelected(datasource)}" qva-activate="onDatasourceClicked(datasource)" tid="selectDsnItem">\n\t\t\t\t\t\t\t{{datasource.qName}}{{extension32Bit(datasource)}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t\t<div class="options-force32">\n\t\t\t\t<div ng-show="showForce32bit();">\n\t\t\t\t\t<lui-checkbox id="odbcForce32" x-model="dataconnectorForce32" x-disabled="isOkDisabled()">\n\t\t\t\t\t\t{{ \'scripteditor.dataconnectors.createdialog.label.force32bit\' | translate }}\n\t\t\t\t\t</lui-checkbox>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<table>\n\t\t\t\t\t<tr ng-if="showSSO">\n\t\t\t\t\t\t<td class="padded-row" colspan="2">\n\t\t\t\t\t\t\t<p q-translation="scripteditor.dataconnectors.odbcconnect.credentials.label"></p>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr ng-show="showSSO">\n\t\t\t\t\t\t<td class="padded-row" colspan="2">\n\t\t\t\t\t\t\t<label class="lui-checkbox">\n\t\t\t\t\t\t\t\t<input class="lui-checkbox__input" type="checkbox" ng-disabled="isLoading" ng-model="radioButtonServiceOrCurrent" ng-false-value="\'{{SERVICE_USER_LOGON}}\'" ng-true-value="\'{{CURRENT_USER_LOGON}}\'" />\n\t\t\t\t\t\t\t\t<div class="lui-checkbox__check-wrap">\n\t\t\t\t\t\t\t\t\t<span class="lui-checkbox__check"></span>\n\t\t\t\t\t\t\t\t\t<span class="lui-checkbox__check-text" q-translation="scripteditor.dataconnectors.odbcconnect.credentials.singlesignon"></span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<p q-translation="Common.Username"></p>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<p q-translation="Common.Password"></p>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class="first">\n\t\t\t\t\t\t\t<input class="lui-input odbctextfield" type="text" maxlength="128" ng-disabled="allowNameInput() || isLoading" ng-model="dataconnectorUsername" ng-trim="false" />\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<input class="lui-input odbctextfield" type="password" maxlength="128" ng-disabled="allowNameInput() || isLoading" ng-model="dataconnectorPassword" ng-trim="false" />\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan="4">\n\t\t\t\t\t\t\t<label for="dataconnectorName" q-translation="Common.Name"></label>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan="4">\n\t\t\t\t\t\t\t<input class="lui-input odbctextfield" id="dataconnectorName" name="dataconnectorName"\n\t\t\t\t\t\t\t\t   type="text" ng-disabled="allowNameInput()" ng-model="dataconnectorName"\n\t\t\t\t\t\t\t\t   ng-disabled="isLoading" invalid="{{isNameInvalid()}}" ng-change="onNameChanged()" maxlength="{{maxConnectionNameLength}}"/>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td colspan="4">\n\t\t\t\t\t\t\t<span ng-style="{visibility: showCreateConnectionError && \'visible\' || \'hidden\'}" class="errorlabel">{{errorContent}}</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</main>\n\t\t<footer class="dm-footer">\n\t\t\t<lui-button x-variant="inverse" qva-activate="$event.preventDefault(); onCancelClicked()" ng-disabled="isLoading" q-translation="Common.Cancel" tid="2e683f"></lui-button>\n\t\t\t<lui-button x-variant="inverse" qva-activate="$event.preventDefault(); onOKClicked()" ng-disabled="isOkDisabled()" q-translation="{{isEdit ? \'Common.Save\' : \'Common.Create\'}}" tid="saveOdbcConnection"></lui-button>\n\t\t</footer>\n\t</div>\n</div>\n'}),define("scripteditor.views/odbcconnectdialog/odbcconnectdialog",["text!assets/scripteditor/views/odbcconnectdialog/odbcconnectdialog.ng.html","general.utils/string-util","core.models/engine","translator","touche","qvangular"],function(e,t,n,i,r,o){return{template:e,controller:["$scope","$element","serverside","input",function(e,s,a,l){function c(){return d===e.DSN_TYPE_USER?e.dataconnectorForce32?p:f:e.radioButton32or64===e.BIT_TYPE_32?p:f}function u(e){var t,n=e.match(/"[^=]*"|[^;]+/g);for(t=0;t<n.length;t++)if(-1!==n[t].indexOf("DSN"))return n[t].split("=")[1];return""}function h(n){var i=u(n);e.datasources.forEach(function(t){if(t.qName===i)return e.selectedDatasource=t,e.filter32Or64Bit(t),d=t.qUserOnly?e.DSN_TYPE_USER:e.DSN_TYPE_SYSTEM,void(e.radioButton32or64=t.qBit32?e.BIT_TYPE_32:e.BIT_TYPE_64)}),d===e.DSN_TYPE_USER&&(e.dataconnectorForce32=t.startsWith(n,"ODBC "+p))}e.DSN_TYPE_USER="USER",e.DSN_TYPE_SYSTEM="SYSTEM",e.CURRENT_USER_LOGON="LOG_ON_CURRENT_USER",e.SERVICE_USER_LOGON="LOG_ON_SERVICE_USER",e.CURRENT_USER_LABEL=i.get("scripteditor.dataconnectors.odbcconnect.currentuser"),e.SERVICE_USER_LABEL=i.get("scripteditor.dataconnectors.odbcconnect.serviceuser"),e.BIT_TYPE_32="32",e.BIT_TYPE_64="64",e.BIT_TYPE_32_KEY=i.get("Common.32bit"),e.BIT_TYPE_64_KEY=i.get("Common.64bit");var d=e.DSN_TYPE_SYSTEM,p="CONNECT32",f="CONNECT";e.isEdit=l.editMode,e.id=l.instanceId,e.isLoading=!0,e.dataconnectorName="",e.selectedDatasource="",e.dataconnectorUsername="",e.dataconnectorPassword="",e.dataconnectorForce32=!1,e.nameChangedAtLeastOnce=!1,e.radioButton32or64=e.BIT_TYPE_64,e.radioButtonServiceOrCurrent=e.SERVICE_USER_LOGON,e.maxConnectionNameLength=t.MAX_CONNECTION_NAME_LENGTH-a.getUsernameSuffix().length,e.showSSO=!o.$rootScope.isPersonalMode&&e.configuration&&e.configuration.qFeatures&&e.configuration.qFeatures.qSSOEnabled,e.onDSNTypeClicked=function(t){d=t,e.resetSelection()},e.isDSNButtonActive=function(e){return d===e},e.isSelected=function(t){return t===e.selectedDatasource},e.showFilter32Or64Bit=function(){return d===e.DSN_TYPE_SYSTEM},e.showForce32bit=function(){return d===e.DSN_TYPE_USER},e.filter32Or64Bit=function(t){if(t.qUserOnly)return!0;var n=t.qBit32?e.BIT_TYPE_32:e.BIT_TYPE_64;return e.radioButton32or64===n},e.filterUserOrSystem=function(t){var n=t.qUserOnly?e.DSN_TYPE_USER:e.DSN_TYPE_SYSTEM;return d===n},e.isDatasourceListDisabled=function(){return e.isLoading},e.onDatasourceClicked=function(t){e.isDatasourceListDisabled()||(e.selectedDatasource=t,e.isEdit||e.nameChangedAtLeastOnce||(e.dataconnectorName=t.qName.replace(/[\\\/:\*\t\?"'<>\|]/g,"-")))},e.resetSelection=function(){e.selectedDatasource=void 0,e.isEdit||(e.nameChangedAtLeastOnce||(e.dataconnectorName=""),e.dataconnectorUsername="",e.dataconnectorPassword=""),e.dataconnectorForce32=!1},e.allowNameInput=function(){return""===e.selectedDatasource||void 0===e.selectedDatasource},e.isOkDisabled=function(){return e.isLoading||!e.selectedDatasource||!e.dataconnectorName||!t.isValidConnectionName(e.dataconnectorName)},e.onNameChanged=function(){e.nameChangedAtLeastOnce=!0},e.isNameInvalid=function(){return e.dataconnectorName?!t.isValidConnectionName(e.dataconnectorName):e.nameChangedAtLeastOnce},e.$watch("dataconnectorName",function(){e.showCreateConnectionError=!1,""!==e.dataconnectorName&&e.isNameInvalid()&&(e.errorContent=i.get("Common.InvalidCharacters"),e.showCreateConnectionError=!0)}),e.buildConnectionString=function(){return"ODBC "+c()+" TO ["+e.selectedDatasource.qName+"]"},e.handleErrors=function(t){e.errorContent=a.getErrorContent(t),e.showCreateConnectionError=!0,t.isHandled=!0,e.isLoading=!1},e.onOKClicked=function(){if(!e.isOkDisabled())if(e.isLoading=!0,e.isEdit){var t=""!==e.dataconnectorUsername&&""!==e.dataconnectorPassword;a.modifyConnection(e.id,e.dataconnectorName,e.buildConnectionString(),"ODBC",t,e.dataconnectorUsername,e.dataconnectorPassword,e.radioButtonServiceOrCurrent).then(function(t){e.isLoading=!1,t&&e.destroyComponent()},e.handleErrors)}else a.createNewConnectionAPI(e.dataconnectorName,e.buildConnectionString(),"ODBC",e.dataconnectorUsername,e.dataconnectorPassword,e.radioButtonServiceOrCurrent).then(function(t){e.isLoading=!1,t&&e.destroyComponent()},e.handleErrors)},e.onCancelClicked=function(){e.isLoading||e.destroyComponent()},r(s[0]).swipe({options:{preventDefault:!1},end:function(){r.preventGestures(this.gestureHandler)}}),n.global.getOdbcDsns().then(function(t){e.datasources=t.qOdbcDsns,e.isEdit?a.getConnection(e.id).then(function(t){e.isLoading=!1,e.dataconnectorName=t.qConnection.qName,e.radioButtonServiceOrCurrent=t.qConnection.qLogOn||e.SERVICE_USER_LOGON,h(t.qConnection.qConnectionString)}):e.isLoading=!1})}]}}),define("scripteditor.views/odbcselectdialog/odbcselectdialog",["core.models/engine"],function(e){return["standardSelectDialogService","connectionId",function(t,n){function i(e){return!(!e||"false"===e)}var r={getConnectionInfo:function(){return e.currentApp.getDatabaseInfo({qConnectionId:n}).then(function(e){return{dbusage:i(e.qInfo.qDBUsage),ownerusage:i(e.qInfo.qOwnerUsage),dbfirst:i(e.qInfo.qDBFirst),specialchars:e.qInfo.qSpecialChars,dbseparator:e.qInfo.qDBSeparator,defaultdatabase:e.qInfo.qDefaultDatabase,ownerseparator:e.qInfo.qOwnerSeparator,quotesuffix:e.qInfo.qQuoteSuffix||"",quoteprefix:e.qInfo.qQuotePreffix||e.qInfo.qQuotePrefix||"",dbmsname:e.qInfo.qDBMSName,keywords:e.qInfo.qKeywords}},function(e){return e.isHandled=!0,{dbusage:!1,ownerusage:!1,dbfirst:!1,specialchars:"",dbseparator:"",defaultdatabase:"",ownerseparator:"",quotesuffix:"",quoteprefix:"",dbmsname:"",keywords:""}})},getDatabases:function(){return e.currentApp.getDatabases({qConnectionId:n}).then(function(e){return e.qDatabases},function(e){return e.isHandled=!0,[]})},getOwners:function(t){return e.currentApp.getDatabaseOwners({qConnectionId:n,qDatabase:t}).then(function(e){return e.qOwners},function(e){return e.isHandled=!0,[]})},getTables:function(t,i){return e.currentApp.getDatabaseTables({qConnectionId:n,qDatabase:t,qOwner:i}).then(function(e){return e.qTables},function(e){return e.isHandled=!0,[]})},getFields:function(t,i,r){return e.currentApp.getDatabaseTableFields({qConnectionId:n,qDatabase:t,qOwner:i,qTable:r}).then(function(e){return e.qFields},function(e){return e.isHandled=!0,[]})},getPreview:function(t,i,r,o){var s={qType:0,qWherePredicate:""};return o&&o.filterInfo&&o.filterInfo.filterClause&&(s={qType:1,qWherePredicate:o.filterInfo.filterClause}),e.currentApp.getDatabaseTablePreview({qConnectionId:n,qDatabase:t,qOwner:i,qTable:r,qConditions:s}).then(function(e){return e.qRowCount&&e.qPreview&&(e.qPreview.sourceRowCount=e.qRowCount),e.qPreview},function(e){return e.isHandled=!0,[]})}};t.showStandardDialog(r,{showTablePanel:!0})}]}),define("text!assets/hldm/data-connectors/native-odbc-connector/connect-step.ng.html",[],function(){return'<div class="native-odbc-connector-connect">\n\t<div class="loading-screen" ng-show="isLoading">\n\t\t<div class="qv-loader"></div>\n\t</div>\n\t<main class="dm-main">\n\t\t<div class="lui-buttongroup">\n\t\t\t<button class="lui-button" ng-class="{ \'lui-active\': isDSNButtonActive(DSN_TYPE_USER) }" ng-disabled="isLoading" q-translation="scripteditor.dataconnectors.createdialog.label.userdsn" qva-activate="onDSNTypeClicked(DSN_TYPE_USER)" tid="selectUserOdbcDatasources"></button>\n\t\t\t<button class="lui-button" ng-class="{ \'lui-active\': isDSNButtonActive(DSN_TYPE_SYSTEM) }" ng-disabled="isLoading" q-translation="scripteditor.dataconnectors.createdialog.label.systemdsn" qva-activate="onDSNTypeClicked(DSN_TYPE_SYSTEM)" tid="selectSystemOdbcDatasources"></button>\n\t\t</div>\n\t\t<div class="options" ng-class="{\'visible\': showFilter32Or64Bit()}">\n\t\t\t<div ng-show="showFilter32Or64Bit();">\n\t\t\t\t<lui-radiobutton x-disabled="isLoading" x-name="radioButton32or64" x-model="radioButton32or64" x-value="{{BIT_TYPE_32}}">{{BIT_TYPE_32_KEY}}</lui-radiobutton>\n\t\t\t\t<lui-radiobutton x-disabled="isLoading" x-name="radioButton32or64" x-model="radioButton32or64" x-value="{{BIT_TYPE_64}}">{{BIT_TYPE_64_KEY}}</lui-radiobutton>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="ds-list">\n\t\t\t<ul class="datasource-list">\n\t\t\t\t<li class="qui-menu-item" ng-repeat="datasource in datasources | filter: filter32Or64Bit | filter: filterUserOrSystem">\n\t\t\t\t\t<div class="item" ng-class="{disabled: isDatasourceListDisabled(), selected: isSelected(datasource)}" qva-activate="onDatasourceClicked(datasource)" tid="selectDsnItem">\n\t\t\t\t\t\t{{datasource.qName}}\n\t\t\t\t\t</div>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t\t<div class="options-force32" ng-class="{\'visible\': showForce32bit()}">\n\t\t\t<div ng-show="showForce32bit();">\n\t\t\t\t<lui-checkbox id="odbcForce32" x-model="dataconnectorForce32" x-disabled="isOkDisabled()">\n\t\t\t\t\t{{ \'scripteditor.dataconnectors.createdialog.label.force32bit\' | translate }}\n\t\t\t\t</lui-checkbox>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="credent-list">\n\t\t\t<table>\n\t\t\t\t<tr ng-if="showSSO">\n\t\t\t\t\t<td class="padded-row" colspan="2">\n\t\t\t\t\t\t<p q-translation="scripteditor.dataconnectors.odbcconnect.credentials.label"></p>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr ng-show="showSSO">\n\t\t\t\t\t<td class="padded-row" colspan="2">\n\n\t\t\t\t\t\t<label class="lui-checkbox">\n\t\t\t\t\t\t\t<input class="lui-checkbox__input" type="checkbox" ng-disabled="isLoading" ng-model="radioButtonServiceOrCurrent" ng-false-value="\'{{SERVICE_USER_LOGON}}\'" ng-true-value="\'{{CURRENT_USER_LOGON}}\'" />\n\t\t\t\t\t\t\t<div class="lui-checkbox__check-wrap">\n\t\t\t\t\t\t\t\t<span class="lui-checkbox__check"></span>\n\t\t\t\t\t\t\t\t<span class="lui-checkbox__check-text" q-translation="scripteditor.dataconnectors.odbcconnect.credentials.singlesignon"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</label>\n\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<p q-translation="Common.Username"></p>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<p q-translation="Common.Password"></p>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td class="first">\n\t\t\t\t\t\t<input class="lui-input odbctextfield" type="text" maxlength="128" ng-disabled="allowNameInput" ng-model="dataconnectorUsername" ng-trim="false" ng-disabled="isLoading"/>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<input class="lui-input odbctextfield" type="password" maxlength="128" ng-disabled="allowNameInput" ng-model="dataconnectorPassword" ng-trim="false" ng-disabled="isLoading"/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td colspan="4">\n\t\t\t\t\t\t<label for="dataconnectorName" q-translation="Common.Name"></label>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td colspan="4">\n\t\t\t\t\t\t<input class="lui-input odbctextfield" id="dataconnectorName" name="dataconnectorName"\n\t\t\t\t\t\t\t   type="text" ng-disabled="allowNameInput" ng-model="dataconnectorName"\n\t\t\t\t\t\t\t   ng-disabled="isLoading" invalid="{{isNameInvalid()}}" ng-change="onNameChanged()" maxlength="{{maxConnectionNameLength}}"/>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td colspan="4">\n\t\t\t\t\t\t<span ng-style="{visibility: showNameValidationError() && \'visible\' || \'hidden\'}" class="errorlabel" q-translation="Common.InvalidCharacters"></span>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</div>\n\t</main>\n</div>\n'}),define("assets/hldm/data-connectors/native-odbc-connector/connect-step",["text!./connect-step.ng.html","general.utils/string-util","core.models/engine","translator","qvangular"],function(e,t,n,i,r){return{template:e,scope:{title:"=",serverside:"=",continueWithNewConnection:"=",qvDialogContext:"=",configuration:"="},controller:["$scope",function(e){function o(){return u===e.DSN_TYPE_USER?e.dataconnectorForce32?h:d:e.radioButton32or64===e.BIT_TYPE_32?h:d}function s(e){var t,n=e.match(/"[^=]*"|[^;]+/g);for(t=0;t<n.length;t++)if(-1!==n[t].indexOf("DSN"))return n[t].split("=")[1];return""}function a(n){var i=s(n);e.datasources.forEach(function(t){if(t.qName===i)return e.selectedDatasource=t,e.filter32Or64Bit(t),u=t.qUserOnly?e.DSN_TYPE_USER:e.DSN_TYPE_SYSTEM,void(e.radioButton32or64=t.qBit32?e.BIT_TYPE_32:e.BIT_TYPE_64)}),u===e.DSN_TYPE_USER&&(e.dataconnectorForce32=t.startsWith(n,"ODBC "+h))}var l=e.serverside,c=e.input;e.qvDialogContext.title=i.get("scripteditor.dataconnectors.odbcconnect.title"),e.qvDialogContext.size="S",e.showSSO=!r.$rootScope.isPersonalMode&&e.configuration&&e.configuration.qFeatures&&e.configuration.qFeatures.qSSOEnabled,e.qvDialogContext.nextDisabled=function(){return e.isLoading||!e.selectedDatasource||!e.dataconnectorName||!t.isValidConnectionName(e.dataconnectorName)},e.DSN_TYPE_USER="USER",e.DSN_TYPE_SYSTEM="SYSTEM",e.CURRENT_USER_LOGON="LOG_ON_CURRENT_USER",e.SERVICE_USER_LOGON="LOG_ON_SERVICE_USER",e.CURRENT_USER_LABEL=i.get("scripteditor.dataconnectors.odbcconnect.currentuser"),e.SERVICE_USER_LABEL=i.get("scripteditor.dataconnectors.odbcconnect.serviceuser"),e.BIT_TYPE_32="32",e.BIT_TYPE_64="64",e.BIT_TYPE_32_KEY=i.get("Common.32bit"),e.BIT_TYPE_64_KEY=i.get("Common.64bit"),e.radioButtonServiceOrCurrent=e.SERVICE_USER_LOGON;var u=e.DSN_TYPE_SYSTEM,h="CONNECT32",d="CONNECT";e.isEdit=c.editMode,e.id=c.instanceId,e.isLoading=!0,e.dataconnectorName="",e.selectedDatasource="",e.dataconnectorUsername="",e.dataconnectorPassword="",e.dataconnectorForce32=!1,e.nameChangedAtLeastOnce=!1,e.radioButton32or64=e.BIT_TYPE_64,e.maxConnectionNameLength=t.MAX_CONNECTION_NAME_LENGTH-l.getUsernameSuffix().length,e.$watchGroup(["selectedDatasource","radioButtonServiceOrCurrent"],function(){e.allowNameInput=e.selectedDatasource&&e.radioButtonServiceOrCurrent!==e.SERVICE_USER_LOGON}),e.onDSNTypeClicked=function(t){u=t,e.resetSelection()},e.isDSNButtonActive=function(e){return u===e},e.isSelected=function(t){return t===e.selectedDatasource},e.showFilter32Or64Bit=function(){return u===e.DSN_TYPE_SYSTEM},e.showForce32bit=function(){return u===e.DSN_TYPE_USER},e.filter32Or64Bit=function(t){if(t.qUserOnly)return!0;var n=t.qBit32?e.BIT_TYPE_32:e.BIT_TYPE_64;return e.radioButton32or64===n},e.filterUserOrSystem=function(t){var n=t.qUserOnly?e.DSN_TYPE_USER:e.DSN_TYPE_SYSTEM;return u===n},e.isDatasourceListDisabled=function(){return e.isLoading},e.onDatasourceClicked=function(t){e.isDatasourceListDisabled()||(e.selectedDatasource=t,e.isEdit||e.nameChangedAtLeastOnce||(e.dataconnectorName=t.qName.replace(/[\\\/:\*\t\?"'<>\|]/g,"-")))},e.resetSelection=function(){e.selectedDatasource=void 0,e.isEdit||(e.nameChangedAtLeastOnce||(e.dataconnectorName=""),e.dataconnectorUsername="",e.dataconnectorPassword=""),e.dataconnectorForce32=!1},e.onNameChanged=function(){e.nameChangedAtLeastOnce=!0},e.isNameInvalid=function(){return e.dataconnectorName?!t.isValidConnectionName(e.dataconnectorName):e.nameChangedAtLeastOnce},e.showNameValidationError=function(){return""!==e.dataconnectorName&&e.isNameInvalid()},e.buildConnectionString=function(){return"ODBC "+o()+" TO ["+e.selectedDatasource.qName+"]"},e.qvDialogContext.next=function(){if(!e.qvDialogContext.nextDisabled())if(e.isLoading=!0,e.isEdit){var t=""!==e.dataconnectorUsername&&""!==e.dataconnectorPassword;l.modifyConnection(e.id,e.dataconnectorName,e.buildConnectionString(),"ODBC",t,e.dataconnectorUsername,e.dataconnectorPassword,e.radioButtonServiceOrCurrent).then(function(t){e.isLoading=!1,t&&e.destroyComponent()})}else l.createNewConnectionAPI(e.dataconnectorName,e.buildConnectionString(),"ODBC",e.dataconnectorUsername,e.dataconnectorPassword,e.radioButtonServiceOrCurrent).then(function(t){e.isLoading=!1,t&&e.continueWithNewConnection({connectionName:e.dataconnectorName})},function(){e.isLoading=!1})},e.onEscape=e.onCancelClicked=function(){e.close()},n.global.getOdbcDsns().then(function(t){e.datasources=t.qOdbcDsns,e.isEdit?l.getConnection(e.id).then(function(t){e.isLoading=!1,e.radioButtonServiceOrCurrent=t.qConnection.qLogOn,e.dataconnectorName=t.qConnection.qName,a(t.qConnection.qConnectionString)}):e.isLoading=!1})}]}}),define("text!assets/hldm/data-connectors/native-odbc-connector/select-step.ng.html",[],function(){return'<div class="native-odbc-connector-select">\n\t<qv-generic-select-dialog data-provider="provider"\n\t\t\t\t\t\t\t  data-dataconnection-selection-editor="dataconnectionSelectionEditor"\n\t\t\t\t\t\t\t  data-qv-dialog-context="qvDialogContext"\n\t\t\t\t\t\t\t  data-qv-internals="qvInternals">\n\t</qv-generic-select-dialog>\n</div>\n'}),define("assets/hldm/data-connectors/native-odbc-connector/odbc-provider",["core.models/engine"],function(e){function t(e){return!(!e||"false"===e)}return{createNativeDatabaserProvider:function(n,i){return{getConnectionInfo:function(){return e.currentApp.getDatabaseInfo({qConnectionId:n}).then(function(e){return{dbusage:t(e.qInfo.qDBUsage),ownerusage:t(e.qInfo.qOwnerUsage),dbfirst:t(e.qInfo.qDBFirst),specialchars:e.qInfo.qSpecialChars,dbseparator:e.qInfo.qDBSeparator,defaultdatabase:e.qInfo.qDefaultDatabase,ownerseparator:e.qInfo.qOwnerSeparator,quotesuffix:e.qInfo.qQuoteSuffix||"",quoteprefix:e.qInfo.qQuotePreffix||e.qInfo.qQuotePrefix||"",dbmsname:e.qInfo.qDBMSName,keywords:e.qInfo.qKeywords}},function(e){return e.isHandled=!0,{dbusage:!1,ownerusage:!1,dbfirst:!1,specialchars:"",dbseparator:"",defaultdatabase:"",ownerseparator:"",quotesuffix:"",quoteprefix:"",dbmsname:"",keywords:""}})},getDatabases:function(){return e.currentApp.getDatabases({qConnectionId:n}).then(function(e){return e.qDatabases},function(e){return e.isHandled=!0,[]})},getOwners:function(t){return e.currentApp.getDatabaseOwners({qConnectionId:n,qDatabase:t}).then(function(e){return e.qOwners},function(e){return e.isHandled=!0,[]})},getTables:function(t,i){return e.currentApp.getDatabaseTables({qConnectionId:n,qDatabase:t,qOwner:i}).then(function(e){return e.qTables},function(e){return e.isHandled=!0,[]})},getFields:function(t,i,r){return e.currentApp.getDatabaseTableFields({qConnectionId:n,qDatabase:t,qOwner:i,qTable:r}).then(function(e){return e.qFields},function(e){return e.isHandled=!0,[]})},getPreview:function(t,i,r,o){var s={qType:0,qWherePredicate:""};return o&&o.filterInfo&&o.filterInfo.filterClause&&(s={qType:1,qWherePredicate:o.filterInfo.filterClause}),e.currentApp.getDatabaseTablePreview({qConnectionId:n,qDatabase:t,qOwner:i,qTable:r,qConditions:s}).then(function(e){return e.qRowCount&&e.qPreview&&(e.qPreview.sourceRowCount=e.qRowCount),e.qPreview},function(e){return e.isHandled=!0,[]})},selectOptions:{tableModelToEdit:i,showTablePanel:!0}}}}}),define("assets/hldm/data-connectors/native-odbc-connector/select-step",["text!./select-step.ng.html","assets/hldm/data-connectors/native-odbc-connector/odbc-provider","translator"],function(e,t,n){return{template:e,scope:{qvDialogContext:"=",dataconnectionSelectionEditor:"=",dataconnectorInstance:"=",qvInternals:"=",tableModelToEdit:"="},controller:["$scope",function(e){e.qvDialogContext.size="L",e.qvDialogContext.title=e.tableModelToEdit?n.get("quickdataload.EditSelectionsFor",e.tableModelToEdit.data.tableName):n.get("quickdataload.SelectData"),e.provider=t.createNativeDatabaserProvider(e.dataconnectorInstance.id,e.tableModelToEdit)}]}}),define("assets/hldm/data-connectors/native-odbc-connector/connector-main",["assets/hldm/data-connectors/native-odbc-connector/connect-step","assets/hldm/data-connectors/native-odbc-connector/select-step","translator"],function(e,t,n){return{create:function(){return{entrypoints:[{id:"odbc",category:"database",name:n.get("scripteditor.dataconnectors.ODBC"),initialConnectStep:e}],getInitialSelectStep:function(){return t}}}}}),define("assets/hldm/data-connectors/native-odbc-connector/native-odbc-connector",["scripteditor.views/odbcconnectdialog/odbcconnectdialog","scripteditor.views/odbcselectdialog/odbcselectdialog","assets/hldm/data-connectors/native-odbc-connector/connector-main"],function(e,t,n){return{connectDialog:e,selectDialog:t,connectorMain:n}}),define("text!assets/scripteditor/views/oledbconnectdialog/oledbconnectdialog.ng.html",[],function(){return'<div class="qui-modalbackground oledbconnectdialogcontainer">\n\t<div class="qui-delayedModal oledbconnectdialog" tabindex="-1" qv-global-enter="onOKClicked()" qv-global-escape="onCancelClicked()">\n\t\t<div class="loading-screen" ng-show="isLoading">\n\t\t\t<div class="qv-loader"></div>\n\t\t</div>\n\t\t<header class="dm-header" q-translation="{{connectionInstance.isEdit ? \'scripteditor.dataconnectors.oledbconnect.edittitle\' : \'scripteditor.dataconnectors.oledbconnect.title\'}}"></header>\n\t\t<main class="dm-main">\n\t\t\t<label for="rawConnectionString" q-translation="scripteditor.dataconnectors.connectionstring" ng-hide="!connectionInstance.isEdit" maxlength="1000">Connection string</label>\n\t\t\t<input class="lui-input oledbtextfield" data-size="tiny" name="rawConnectionString" id="rawConnectionString" type="text" ng-hide="!connectionInstance.isEdit" ng-model="rawConnectionString" ng-disabled="isLoading" ng-change="onNameChanged()" maxlength="1000">\n\n\t\t\t<div ng-hide="connectionInstance.isEdit">\n\t\t\t\t<label translate="title" q-translation="scripteditor.dataconnectors.provider">Provider</label>\n\t\t\t\t<lui-select class="datasource-list" x-model="connectionInstance.selectedDataprovider" x-disabled="isLoading" x-options="datasource.qDescription for datasource in datasources" tid="oleDbProvider">\n\t\t\t\t\t<option value="" q-translation="scripteditor.dataconnectors.selectprovider"></option>\n\t\t\t\t</lui-select>\n\t\t\t</div>\n\n\t\t\t<div class="serversection">\n\t\t\t\t<div ng-hide="connectionInstance.isEdit">\n\t\t\t\t\t<label translate="title" q-translation="scripteditor.dataconnectors.servername">Server</label>\n\t\t\t\t\t<input class="lui-input oledbtextfield" data-size="tiny" name="connectionInstance.serverName" type="text" ng-model="connectionInstance.serverName" ng-disabled="isLoading || connectionInstance.selectedDataprovider == \'\'" tid="oleDbServerName">\n\n\t\t\t\t\t<div class="choosesecuritysection">\n\t\t\t\t\t\t<lui-radiobutton tid="integrated-security" x-name="choosesecuritysection" x-value="integrated" x-model="connectionInstance.serverOptions.security" x-disabled="!hasSecurityOption(\'integrated\')">{{ \'scripteditor.dataconnetors.integratedsecurity\' | translate }}</lui-radiobutton>\n\t\t\t\t\t\t<lui-radiobutton tid="specific-security" x-name="choosesecuritysection" x-value="specific" x-model="connectionInstance.serverOptions.security" x-disabled="!hasSecurityOption(\'specific\')">{{ \'scripteditor.dataconnetors.specificsecurity\' | translate }}</lui-radiobutton>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="specificsecuritysection">\n\t\t\t\t\t<label translate="title" q-translation="Common.Username">Username</label>\n\t\t\t\t\t<input class="lui-input oledbtextfield" data-size="tiny" tid="6d9333" name="userName" type="text" ng-model="connectionInstance.serverOptions.username" ng-trim="false" ng-change="resetConnectionTest()" ng-disabled="isLoading || (!connectionInstance.isEdit && !isSpecificSecurity())" maxlength="200">\n\t\t\t\t\t<label translate="title" q-translation="Common.Password">Password</label>\n\t\t\t\t\t<input class="lui-input oledbtextfield" data-size="tiny" tid="6d9332" name="password" type="password" ng-model="connectionInstance.serverOptions.password" ng-trim="false" ng-change="resetConnectionTest()" ng-disabled="isLoading || (!connectionInstance.isEdit && !isSpecificSecurity())" maxlength="200">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div>\n\t\t\t\t<span class="test-result-icon {{resultColorTheme}}" data-icon="{{testResultIcon}}"></span><span>{{connectionTestMessage}}</span>\n\t\t\t\t<button class="lui-button to-the-right" qva-activate="$event.preventDefault(); onTestClicked()" q-translation="scripteditor.dataconnectors.testconnection" ng-disabled="isTestDisabled() || isLoading" tid="2e6841"></button>\n\t\t\t</div>\n\t\t\t<div class="fullwidth-div">\n\t\t\t\t<label translate="title" ng-hide="connectionInstance.isEdit" q-translation="scripteditor.dataconnectors.database">Database</label>\n\n\t\t\t\t<div ng-hide="connectionInstance.isEdit">\n\t\t\t\t\t<button class="lui-button load-button" qva-activate="getDatabases()" ng-disabled="isLoadDisabled()" q-translation="scripteditor.dataconnectors.load" tid="loadDefaultDatabases">Load</button>\n\t\t\t\t\t<lui-select class="database-list" x-model="connectionInstance.selectedDatabase" x-disabled="!databasesLoaded" x-options="database.qName for database in databases" tid="defaultDatabase">\n\t\t\t\t\t\t<option value="" q-translation="scripteditor.dataconnectors.selectdatabase"></option>\n\t\t\t\t\t</lui-select>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<label for="dataconnectorName" q-translation="Common.Name" class="name"></label>\n\t\t\t<input class="lui-input oledbtextfield" data-size="tiny" tid="6e9333" name="dataconnectorName" id="dataconnectorName" type="text" ng-enabled="allowNameInput()" ng-model="connectionInstance.name" ng-disabled="isLoading" invalid="{{isNameInvalid()}}" ng-change="onNameChanged()" maxlength="{{maxConnectionNameLength}}">\n\t\t\t<label ng-style="{visibility: showCreateConnectionError && \'visible\' || \'hidden\'}" class="errorlabel">{{errorContent}}</label>\n\n\t\t</main>\n\t\t<footer class="dm-footer">\n\t\t\t<lui-button x-variant="inverse" qva-activate="$event.preventDefault(); onCancelClicked()" ng-disabled="isLoading" q-translation="Common.Cancel" tid="2e6840"></lui-button>\n\t\t\t<lui-button x-variant="inverse" qva-activate="$event.preventDefault(); onOKClicked()" ng-disabled="isOkDisabled()" q-translation="{{connectionInstance.isEdit ? \'Common.Save\' : \'Common.Create\'}}" tid="saveOleDbConnection"></lui-button>\n\t\t</footer>\n\t</div>\n</div>\n'}),define("scripteditor.views/oledbconnectdialog/oledbconnectdialog",["translator","text!assets/scripteditor/views/oledbconnectdialog/oledbconnectdialog.ng.html","general.utils/string-util","core.models/engine"],function(e,t,n,i){return{template:t,controller:["$scope","serverside","input","$timeout",function(t,r,o,s){function a(e){return t.connectionInstance.serverOptions.security||t.connectionInstance.serverOptions.username?"integrated"===t.connectionInstance.serverOptions.security?"Integrated Security=SSPI;":e?"User Id="+t.connectionInstance.serverOptions.username+";Password="+t.connectionInstance.serverOptions.password+";":"":""}function l(){var e=c();return e.substring(0,e.length-1)+f+"]"}function c(e){var n=t.connectionInstance.selectedDataprovider.qBit32?"CONNECT32":"CONNECT",i=a(e),r="Data Source="+t.connectionInstance.serverName+";",o=""!==t.connectionInstance.databaseName?"Initial Catalog="+t.connectionInstance.databaseName+";":"",s="OLEDB "+n+" TO [Provider="+t.connectionInstance.dataconnectorTypeName+";"+i+r+o+"]";return t.connectionInstance.isEdit&&(s=-1!==t.rawConnectionString.indexOf("Integrated Security=SSPI")?t.rawConnectionString:t.rawConnectionString.slice(0,t.rawConnectionString.lastIndexOf(";"))+";"+i+"]"),s}function u(e){var i=n.getValueFromConnectionString(e,"provider"),r=n.getValueFromConnectionString(e,"data source"),o=-1!==e.toLowerCase().indexOf("oledb connect32");t.connectionInstance.serverName=r,h(i,o)}function h(e,n){for(var i=0;i<t.datasources.length;i++)if(t.datasources[i].qName===e&&(n===t.datasources[i].qBit32||!t.datasources[i].qBit32))return void(t.connectionInstance.selectedDataprovider=t.datasources[i])}function d(e){var i=n.getValueFromConnectionString(e,"integrated security");t.connectionInstance.serverOptions=""!==i?{security:"integrated",username:"",password:""}:{security:"specific",username:"",password:""}}function p(e){var t="";return n.tokenizeConnectionString(e).forEach(function(e){"provider"!==e.key.toLowerCase()&&"data source"!==e.key.toLowerCase()&&"integrated security"!==e.key.toLowerCase()&&(t+=e.key+"="+e.value+";")}),t}t.connectionInstance={id:o.instanceId,isEdit:o.editMode,name:"",typeName:"",is32Bit:!1,databaseName:"",selectedDatabase:"",selectedDataprovider:"",serverName:"",serverOptions:{},connectionInputOK:!1,connectionTestOK:!1},t.testResultIcon="",t.resultColorTheme="",t.isLoading=!0,t.initializing=!1,t.previousServerName="",t.nameChangedAtLeastOnce=!1,t.databases=[],t.databasesLoaded=!1,t.serverOK=!1,t.rawConnectionString="",t.providerCredentialSettings={"Microsoft.ACE.OLEDB.12.0":{integrated:!1,specific:!0},MSDASQL:{integrated:!1,specific:!0},"MSDASQL Enumerator":{integrated:!1,specific:!0},MSOLAP:{integrated:!0,specific:!0},SQLOLEDB:{integrated:!0,specific:!0},MSDataShape:{integrated:!0,specific:!0},SQLNCLI11:{integrated:!0,specific:!0},"SQLNCLI Enumerator":{integrated:!0,specific:!0},ADsDSOObject:{integrated:!0,specific:!0},SQLNCLI:{integrated:!0,specific:!0},"SQLNCLI11 Enumerator":{integrated:!0,specific:!0},"SQLOLEDB Enumerator":{integrated:!0,specific:!0},MSDAOSP:{integrated:!1,specific:!1},MSIDXS:{integrated:!0,specific:!1},"OraOLEDB.Oracle":{integrated:!1,specific:!0},MSDAORA:{integrated:!1,specific:!0}},t.maxConnectionNameLength=n.MAX_CONNECTION_NAME_LENGTH-r.getUsernameSuffix().length;var f="";t.getDatabases=function(){t.serverOK=!1,t.isLoading=!0,""===t.serverName?(t.databases=[],t.connectionInstance.selectedDatabase=null,t.isLoading=!1):t.connectionInstance.selectedDataprovider&&i.global.getDatabasesFromConnectionString({qConnectionString:c(!0)}).then(function(e){t.databasesLoaded=!0,t.isLoading=!1,e&&(t.databases=e.qDatabases,t.serverOK=!0)},function(n){n.code=void 0,n.message=e.get("scripteditor.dataconnectors.connecterror"),t.databasesLoaded=!1,t.isLoading=!1,t.serverOK=!1}),t.previousServerName=t.connectionInstance.serverName},t.isDatasourceListDisabled=function(){return t.isLoading},t.isSpecificSecurity=function(){return!!t.connectionInstance.serverOptions&&"specific"===t.connectionInstance.serverOptions.security},t.isTestDisabled=function(){return!t.connectionInstance.isEdit&&(t.isLoading||!t.connectionInstance.selectedDataprovider||!t.connectionInstance.name||!t.connectionInstance.serverName||t.connectionInstance.serverName.length<1)},t.isOkDisabled=function(){return t.connectionInstance.isEdit?t.isLoading:t.isLoading||!t.connectionInstance.selectedDataprovider||!t.connectionInstance.name||!n.isValidConnectionName(t.connectionInstance.name)||!t.connectionInstance.serverName||t.connectionInstance.serverName.length<1},t.isLoadDisabled=function(){return""===t.connectionInstance.serverName||t.isLoading||!t.connectionInstance.selectedDataprovider},t.isNameInvalid=function(){return t.connectionInstance.name?!n.isValidConnectionName(t.connectionInstance.name):t.nameChangedAtLeastOnce},t.$watch("connectionInstance.serverOptions.security",function(e,n){e!==n&&t.resetConnectionTest()}),t.$watch("connectionInstance.name",function(){t.showCreateConnectionError=!1,""!==t.connectionInstance.name&&t.isNameInvalid()&&(t.errorContent=e.get("Common.InvalidCharacters"),t.showCreateConnectionError=!0)}),t.allowNameInput=function(){return t.connectionInstance.isEdit||""===t.connectionInstance.selectedDataprovider},t.hasSecurityOption=function(e){if(t.connectionInstance.selectedDataprovider&&""!==t.connectionInstance.selectedDataprovider){var n=t.providerCredentialSettings[t.connectionInstance.selectedDataprovider.qName];return!n||n[e]}return!1},t.$watch("connectionInstance.selectedDataprovider",function(e,n){e!==n&&(t.connectionInstance.selectedDataprovider=e,t.resetConnectionTest(),t.connectionInstance.selectedDataprovider&&(t.databasesLoaded=!1,t.databases=[],t.connectionInstance.dataconnectorTypeName=t.connectionInstance.selectedDataprovider.qName,t.is32Bit=t.connectionInstance.selectedDataprovider.qBit32,t.initializing||(t.hasSecurityOption("integrated")&&!t.hasSecurityOption("specific")?t.connectionInstance.serverOptions.security="integrated":t.connectionInstance.serverOptions.security="specific",t.rawConnectionString=l())),t.initializing&&s(function(){t.initializing=!1}))}),t.$watch("connectionInstance.serverName",function(e,n){e!==n&&(t.connectionInstance.serverName=e,t.resetConnectionTest(),t.connectionInstance.isEdit||t.nameChangedAtLeastOnce?!t.initializing&&t.connectionInstance.isEdit&&(t.rawConnectionString=l()):t.connectionInstance.name=t.connectionInstance.serverName.replace(/[\\\/:\*\t\?"'<>\|]/g,"-"))}),t.$watch("connectionInstance.selectedDatabase",function(){t.connectionInstance.selectedDatabase&&(t.connectionInstance.databaseName=t.connectionInstance.selectedDatabase.qName)}),t.onNameChanged=function(){t.nameChangedAtLeastOnce=!0},t.handleErrors=function(e){t.errorContent=r.getErrorContent(e),t.showCreateConnectionError=!0,e.isHandled=!0,t.isLoading=!1},t.onOKClicked=function(){if(!t.isOkDisabled())if(t.isLoading=!0,t.resetConnectionTest(),t.connectionInstance.isEdit){var e=""!==t.connectionInstance.serverOptions.username&&""!==t.connectionInstance.serverOptions.password;r.modifyConnection(t.connectionInstance.id,t.connectionInstance.name,t.rawConnectionString,"OLEDB",e,t.connectionInstance.serverOptions.username,t.connectionInstance.serverOptions.password).then(function(e){t.isLoading=!1,e&&t.destroyComponent()},t.handleErrors)}else r.createNewConnectionAPI(t.connectionInstance.name,c(),"OLEDB",t.connectionInstance.serverOptions.username,t.connectionInstance.serverOptions.password).then(function(e){t.isLoading=!1,e&&t.destroyComponent()},t.handleErrors)},t.onTestClicked=function(){t.isLoading=!0,t.resetConnectionTest(),i.global.isValidConnectionString({qConnectionString:c(!0)}).then(function(){t.isLoading=!1,t.connectionTestMessage=e.get("scripteditor.dataconnectors.testconnection.succeeded"),t.testResultIcon="tick",t.resultColorTheme="test-ok"},function(n){n.isHandled=!0,t.isLoading=!1,t.connectionTestMessage=e.get("scripteditor.dataconnectors.testconnection.failed"),t.testResultIcon="warning-triangle",t.resultColorTheme="test-failed"})},t.onCancelClicked=function(){t.isLoading||t.destroyComponent()},t.resetConnectionTest=function(){t.connectionTestMessage="",t.testResultIcon="",t.showCreateConnectionError=!1},i.global.getOleDbProviders().then(function(e){for(var n=0;n<e.qOleDbProviders.length;n++)e.qOleDbProviders[n].qBit32&&(e.qOleDbProviders[n].qDescription=e.qOleDbProviders[n].qDescription+"(32-bit)");t.datasources=e.qOleDbProviders,t.connectionInstance.isEdit?(t.initializing=!0,r.getConnection(t.connectionInstance.id).then(function(e){t.isLoading=!1,t.connectionInstance.name=e.qConnection.qName,t.rawConnectionString=e.qConnection.qConnectionString,u(e.qConnection.qConnectionString),d(e.qConnection.qConnectionString),f=p(e.qConnection.qConnectionString)})):(t.connectionInstance.serverOptions={security:"specific",username:"",password:""},t.isLoading=!1)})}]}}),define("text!assets/hldm/data-connectors/native-oledb-connector/connect-step.ng.html",[],function(){return'<div class="native-oledb-connector-connect">\n\t<div class="loading-screen" ng-show="isLoading">\n\t\t<div class="qv-loader"></div>\n\t</div>\n\t<main class="dm-main">\n\t\t<div class="flex-cont">\n\t\t\t<div ng-show="connectionInstance.isEdit" ng-class="{\'rawStr-edit\': connectionInstance.isEdit}">\n\t\t\t\t<label for="rawConnectionString" q-translation="scripteditor.dataconnectors.connectionstring" maxlength="1000">Connection string</label>\n\t\t\t\t<input class="lui-input oledbtextfield" data-size="tiny" name="rawConnectionString" id="rawConnectionString" type="text" ng-model="rawConnectionString" ng-disabled="isLoading" ng-change="onNameChanged()" maxlength="1000">\n\t\t\t</div>\n\n\t\t\t<div class="con-edit" ng-hide="connectionInstance.isEdit">\n\t\t\t\t<label translate="title" q-translation="scripteditor.dataconnectors.provider">Provider</label>\n\t\t\t\t<lui-select class="datasource-list" x-model="connectionInstance.selectedDataprovider" x-disabled="isLoading" x-options="datasource.qDescription for datasource in datasources" tid="oleDbProvider">\n\t\t\t\t\t<option value="" q-translation="scripteditor.dataconnectors.selectprovider"></option>\n\t\t\t\t</lui-select>\n\t\t\t</div>\n\n\t\t\t<div class="serversection">\n\t\t\t\t<div ng-hide="connectionInstance.isEdit">\n\t\t\t\t\t<label translate="title" q-translation="scripteditor.dataconnectors.servername">Server</label>\n\t\t\t\t\t<input class="lui-input oledbtextfield" data-size="tiny" name="connectionInstance.serverName" type="text" ng-model="connectionInstance.serverName" ng-disabled="isLoading || connectionInstance.selectedDataprovider == \'\'" tid="oleDbServerName">\n\n\t\t\t\t\t<div class="choosesecuritysection">\n\t\t\t\t\t\t<lui-radiobutton tid="integrated-security" x-name="choosesecuritysection" x-value="integrated" x-model="connectionInstance.serverOptions.security" x-disabled="isLoading || !hasSecurityOption(\'integrated\')">{{ \'scripteditor.dataconnetors.integratedsecurity\' | translate }}</lui-radiobutton>\n\t\t\t\t\t\t<lui-radiobutton tid="specific-security" x-name="choosesecuritysection" x-value="specific" x-model="connectionInstance.serverOptions.security" x-disabled="isLoading || !hasSecurityOption(\'specific\')">{{ \'scripteditor.dataconnetors.specificsecurity\' | translate }}</lui-radiobutton>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="specificsecuritysection">\n\t\t\t\t\t<label translate="title" q-translation="Common.Username">Username</label>\n\t\t\t\t\t<input class="lui-input oledbtextfield" data-size="tiny" tid="6d9333" name="userName" type="text" ng-model="connectionInstance.serverOptions.username" ng-trim="false" ng-change="resetConnectionTest()" ng-disabled="isLoading || (!connectionInstance.isEdit && !isSpecificSecurity())" maxlength="200">\n\t\t\t\t\t<label translate="title" q-translation="Common.Password">Password</label>\n\t\t\t\t\t<input class="lui-input oledbtextfield" data-size="tiny" tid="6d9332" name="password" type="password" ng-model="connectionInstance.serverOptions.password" ng-trim="false" ng-change="resetConnectionTest()" ng-disabled="isLoading || (!connectionInstance.isEdit && !isSpecificSecurity())" maxlength="200">\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="test-container">\n\t\t\t\t<span class="test-result-icon {{resultColorTheme}}" data-icon="{{testResultIcon}}"></span><span>{{connectionTestMessage}}</span>\n\t\t\t\t<button class="lui-button tst-btn" qva-activate="$event.preventDefault(); onTestClicked()" q-translation="scripteditor.dataconnectors.testconnection" ng-disabled="isTestDisabled() || isLoading" tid="2e6841"></button>\n\t\t\t</div>\n\n\t\t\t<div class="db-container">\n\t\t\t\t<label translate="title" ng-hide="connectionInstance.isEdit" q-translation="scripteditor.dataconnectors.database">Database</label>\n\n\t\t\t\t<div ng-hide="connectionInstance.isEdit">\n\t\t\t\t\t<button class="lui-button load-button" qva-activate="getDatabases()" ng-disabled="isLoadDisabled()" q-translation="scripteditor.dataconnectors.load" tid="loadDefaultDatabases">Load</button>\n\t\t\t\t\t<lui-select class="database-list" x-model="connectionInstance.selectedDatabase" x-disabled="!databasesLoaded" x-options="database.qName for database in databases" tid="defaultDatabase">\n\t\t\t\t\t\t<option value="" q-translation="scripteditor.dataconnectors.selectdatabase"></option>\n\t\t\t\t\t</lui-select>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="conName" ng-class="{\'error\': showCreateConnectionError}">\n\t\t\t\t<label for="dataconnectorName" q-translation="Common.Name" class="name"></label>\n\t\t\t\t<input class="lui-input oledbtextfield" data-size="tiny" tid="6e9333" name="dataconnectorName" id="dataconnectorName" type="text" ng-enabled="allowNameInput()" ng-model="connectionInstance.name" ng-disabled="isLoading" invalid="{{isNameInvalid()}}" ng-change="onNameChanged()" maxlength="{{maxConnectionNameLength}}">\n\t\t\t\t<label ng-style="{visibility: showCreateConnectionError && \'visible\' || \'hidden\'}" class="errorlabel">{{errorContent}}</label>\n\t\t\t</div>\n\t\t</div>\n\t</main>\n</div>\n'}),define("assets/hldm/data-connectors/native-oledb-connector/connect-step",["translator","text!./connect-step.ng.html","general.utils/string-util","core.models/engine"],function(e,t,n,i){return{template:t,scope:{title:"=",serverside:"=",continueWithNewConnection:"=",qvDialogContext:"="},controller:["$scope","serverside","input","$timeout",function(t,r,o,s){function a(){return t.connectionInstance.isEdit?t.isLoading:t.isLoading||!t.connectionInstance.selectedDataprovider||!t.connectionInstance.name||!n.isValidConnectionName(t.connectionInstance.name)||!t.connectionInstance.serverName||t.connectionInstance.serverName.length<1}function l(e){return t.connectionInstance.serverOptions.security||t.connectionInstance.serverOptions.username?"integrated"===t.connectionInstance.serverOptions.security?"Integrated Security=SSPI;":e?"User Id="+t.connectionInstance.serverOptions.username+";Password="+t.connectionInstance.serverOptions.password+";":"":""}function c(){var e=u();return e.substring(0,e.length-1)+m+"]"}function u(e){var n=t.connectionInstance.selectedDataprovider.qBit32?"CONNECT32":"CONNECT",i=l(e),r="Data Source="+t.connectionInstance.serverName+";",o=""!==t.connectionInstance.databaseName?"Initial Catalog="+t.connectionInstance.databaseName+";":"",s="OLEDB "+n+" TO [Provider="+t.connectionInstance.dataconnectorTypeName+";"+i+r+o+"]";return t.connectionInstance.isEdit&&(s=-1!==t.rawConnectionString.indexOf("Integrated Security=SSPI")?t.rawConnectionString:t.rawConnectionString.slice(0,t.rawConnectionString.lastIndexOf(";"))+";"+i+"]"),s}function h(e){var i=n.getValueFromConnectionString(e,"provider"),r=n.getValueFromConnectionString(e,"data source"),o=-1!==e.toLowerCase().indexOf("oledb connect32");t.connectionInstance.serverName=r,d(i,o)}function d(e,n){for(var i=0;i<t.datasources.length;i++)if(t.datasources[i].qName===e&&(n===t.datasources[i].qBit32||!t.datasources[i].qBit32))return void(t.connectionInstance.selectedDataprovider=t.datasources[i])}function p(e){var i=n.getValueFromConnectionString(e,"integrated security");t.connectionInstance.serverOptions=""!==i?{security:"integrated",username:"",password:""}:{security:"specific",username:"",password:""}}function f(e){var t="";return n.tokenizeConnectionString(e).forEach(function(e){"provider"!==e.key.toLowerCase()&&"data source"!==e.key.toLowerCase()&&"integrated security"!==e.key.toLowerCase()&&(t+=e.key+"="+e.value+";")}),t}t.connectionInstance={id:o.instanceId,isEdit:o.editMode,name:"",typeName:"",is32Bit:!1,databaseName:"",selectedDatabase:"",selectedDataprovider:"",serverName:"",serverOptions:{},connectionInputOK:!1,connectionTestOK:!1},t.qvDialogContext.title=e.get("scripteditor.dataconnectors.oledbconnect.title"),t.qvDialogContext.nextDisabled=a,t.qvDialogContext.size="S",t.qvDialogContext.customCss={},t.qvDialogContext.cstmClass={"native-oledb":!0},t.testResultIcon="",t.resultColorTheme="",t.isLoading=!0,t.initializing=!1,t.previousServerName="",t.nameChangedAtLeastOnce=!1,t.databases=[],t.databasesLoaded=!1,t.serverOK=!1,t.rawConnectionString="",t.providerCredentialSettings={"Microsoft.ACE.OLEDB.12.0":{integrated:!1,specific:!0},MSDASQL:{integrated:!1,specific:!0},"MSDASQL Enumerator":{integrated:!1,specific:!0},MSOLAP:{integrated:!0,specific:!0},SQLOLEDB:{integrated:!0,specific:!0},MSDataShape:{integrated:!0,specific:!0},SQLNCLI11:{integrated:!0,specific:!0},"SQLNCLI Enumerator":{integrated:!0,specific:!0},ADsDSOObject:{integrated:!0,specific:!0},SQLNCLI:{integrated:!0,specific:!0},"SQLNCLI11 Enumerator":{integrated:!0,specific:!0},"SQLOLEDB Enumerator":{integrated:!0,specific:!0},MSDAOSP:{integrated:!1,specific:!1},MSIDXS:{integrated:!0,specific:!1},"OraOLEDB.Oracle":{integrated:!1,specific:!0},MSDAORA:{integrated:!1,specific:!0}},t.maxConnectionNameLength=n.MAX_CONNECTION_NAME_LENGTH-r.getUsernameSuffix().length;var m="";t.getDatabases=function(){t.serverOK=!1,t.isLoading=!0,""===t.serverName?(t.databases=[],t.connectionInstance.selectedDatabase=null,t.isLoading=!1):t.connectionInstance.selectedDataprovider&&i.global.getDatabasesFromConnectionString({qConnectionString:u(!0)}).then(function(e){t.databasesLoaded=!0,t.isLoading=!1,e&&(t.databases=e.qDatabases,t.serverOK=!0)},function(n){n.code=void 0,n.message=e.get("scripteditor.dataconnectors.connecterror"),t.databasesLoaded=!1,t.isLoading=!1,t.serverOK=!1}),t.previousServerName=t.connectionInstance.serverName},t.isDatasourceListDisabled=function(){return t.isLoading},t.isSpecificSecurity=function(){return!!t.connectionInstance.serverOptions&&"specific"===t.connectionInstance.serverOptions.security},t.isTestDisabled=function(){return!t.connectionInstance.isEdit&&(t.isLoading||!t.connectionInstance.selectedDataprovider||!t.connectionInstance.name||!t.connectionInstance.serverName||t.connectionInstance.serverName.length<1)},t.isLoadDisabled=function(){return""===t.connectionInstance.serverName||t.isLoading||!t.connectionInstance.selectedDataprovider},t.isNameInvalid=function(){return t.connectionInstance.name?!n.isValidConnectionName(t.connectionInstance.name):t.nameChangedAtLeastOnce},t.$watch("connectionInstance.name",function(){t.showCreateConnectionError=!1,""!==t.connectionInstance.name&&t.isNameInvalid()&&(t.errorContent=e.get("Common.InvalidCharacters"),t.showCreateConnectionError=!0)}),t.allowNameInput=function(){return t.connectionInstance.isEdit||""===t.connectionInstance.selectedDataprovider},t.hasSecurityOption=function(e){if(t.connectionInstance.selectedDataprovider&&""!==t.connectionInstance.selectedDataprovider){var n=t.providerCredentialSettings[t.connectionInstance.selectedDataprovider.qName];return!n||n[e]}return!1},t.$watch("connectionInstance.serverOptions.security",function(e,n){e!==n&&t.resetConnectionTest()}),t.$watch("connectionInstance.selectedDataprovider",function(e,n){e!==n&&(t.connectionInstance.selectedDataprovider=e,t.resetConnectionTest(),t.connectionInstance.selectedDataprovider&&(t.databasesLoaded=!1,t.databases=[],t.connectionInstance.dataconnectorTypeName=t.connectionInstance.selectedDataprovider.qName,t.is32Bit=t.connectionInstance.selectedDataprovider.qBit32,t.initializing||(t.hasSecurityOption("integrated")&&!t.hasSecurityOption("specific")?t.connectionInstance.serverOptions.security="integrated":t.connectionInstance.serverOptions.security="specific",t.rawConnectionString=c())),t.initializing&&s(function(){t.initializing=!1}))}),t.$watch("connectionInstance.serverName",function(e,n){e!==n&&(t.connectionInstance.serverName=e,t.resetConnectionTest(),t.connectionInstance.isEdit||t.nameChangedAtLeastOnce?!t.initializing&&t.connectionInstance.isEdit&&(t.rawConnectionString=c()):t.connectionInstance.name=t.connectionInstance.serverName.replace(/[\\\/:\*\t\?"'<>\|]/g,"-"))}),t.$watch("connectionInstance.selectedDatabase",function(){t.connectionInstance.selectedDatabase&&(t.resetConnectionTest(),t.connectionInstance.databaseName=t.connectionInstance.selectedDatabase.qName)}),t.$watch("connectionInstance.isEdit",function(e){e&&(t.qvDialogContext.customCss=function(e,t){return{"max-height":e,"min-height":t||e}}("400px"))}),t.onNameChanged=function(){t.nameChangedAtLeastOnce=!0},t.handleErrors=function(e){t.errorContent=r.getErrorContent(e),t.showCreateConnectionError=!0,e.isHandled=!0,t.isLoading=!1},t.qvDialogContext.next=function(){if(!a())if(t.isLoading=!0,t.resetConnectionTest(),t.connectionInstance.isEdit){var e=""!==t.connectionInstance.serverOptions.username&&""!==t.connectionInstance.serverOptions.password;r.modifyConnection(t.connectionInstance.id,t.connectionInstance.name,t.rawConnectionString,"OLEDB",e,t.connectionInstance.serverOptions.username,t.connectionInstance.serverOptions.password).then(function(e){t.isLoading=!1,e&&t.destroyComponent()},t.handleErrors)}else r.createNewConnectionAPI(t.connectionInstance.name,u(),"OLEDB",t.connectionInstance.serverOptions.username,t.connectionInstance.serverOptions.password).then(function(e){t.isLoading=!1,e&&t.continueWithNewConnection({connectionName:t.connectionInstance.name})},t.handleErrors)},t.onTestClicked=function(){t.resetConnectionTest(),t.isLoading=!0,i.global.isValidConnectionString({qConnectionString:u(!0)}).then(function(){t.isLoading=!1,t.connectionTestMessage=e.get("scripteditor.dataconnectors.testconnection.succeeded"),t.testResultIcon="tick",t.resultColorTheme="test-ok"},function(n){n.isHandled=!0,t.isLoading=!1,t.connectionTestMessage=e.get("scripteditor.dataconnectors.testconnection.failed"),t.testResultIcon="warning-triangle",t.resultColorTheme="test-failed"})},t.resetConnectionTest=function(){t.connectionTestMessage="",t.testResultIcon="",t.showCreateConnectionError=!1},t.onCancelClicked=function(){t.isLoading||t.destroyComponent()},i.global.getOleDbProviders().then(function(e){for(var n=0;n<e.qOleDbProviders.length;n++)e.qOleDbProviders[n].qBit32&&(e.qOleDbProviders[n].qDescription=e.qOleDbProviders[n].qDescription+"(32-bit)");t.datasources=e.qOleDbProviders,t.connectionInstance.isEdit?(t.initializing=!0,r.getConnection(t.connectionInstance.id).then(function(e){t.isLoading=!1,t.connectionInstance.name=e.qConnection.qName,t.rawConnectionString=e.qConnection.qConnectionString,h(e.qConnection.qConnectionString),p(e.qConnection.qConnectionString),m=f(e.qConnection.qConnectionString)})):(t.connectionInstance.serverOptions={security:"specific",username:"",password:""},t.isLoading=!1)})}]}}),define("text!assets/hldm/data-connectors/native-oledb-connector/select-step.ng.html",[],function(){return'<div class="native-oledb-connector-select">\n\t<qv-generic-select-dialog data-provider="provider"\n\t\t\t\t\t\t\t  data-dataconnection-selection-editor="dataconnectionSelectionEditor"\n\t\t\t\t\t\t\t  data-qv-dialog-context="qvDialogContext"\n\t\t\t\t\t\t\t  data-qv-internals="qvInternals">\n\t</qv-generic-select-dialog>\n</div>\n'}),define("assets/hldm/data-connectors/native-oledb-connector/select-step",["text!./select-step.ng.html","assets/hldm/data-connectors/native-odbc-connector/odbc-provider","translator"],function(e,t,n){return{template:e,scope:{qvDialogContext:"=",dataconnectionSelectionEditor:"=",dataconnectorInstance:"=",qvInternals:"=",tableModelToEdit:"="},controller:["$scope",function(e){e.qvDialogContext.size="L",e.qvDialogContext.title=e.tableModelToEdit?n.get("quickdataload.EditSelectionsFor",e.tableModelToEdit.data.tableName):n.get("quickdataload.SelectData"),e.provider=t.createNativeDatabaserProvider(e.dataconnectorInstance.id,e.tableModelToEdit)}]}}),define("assets/hldm/data-connectors/native-oledb-connector/connector-main",["assets/hldm/data-connectors/native-oledb-connector/connect-step","assets/hldm/data-connectors/native-oledb-connector/select-step","translator"],function(e,t,n){return{create:function(){return{entrypoints:[{id:"oledb",category:"database",name:n.get("scripteditor.dataconnectors.OLEDB"),initialConnectStep:e}],getInitialSelectStep:function(){return t}}}}}),define("assets/hldm/data-connectors/native-oledb-connector/native-oledb-connector",["scripteditor.views/oledbconnectdialog/oledbconnectdialog","scripteditor.views/odbcselectdialog/odbcselectdialog","assets/hldm/data-connectors/native-oledb-connector/connector-main"],function(e,t,n){return{connectDialog:e,selectDialog:t,connectorMain:n}}),define("text!assets/scripteditor/views/webfilechooser/webfilechooser.ng.html",[],function(){return'<div class="qui-modalbackground filechoosercontainer">\n\t<div class="qui-delayedModal filechooser" qv-global-escape="onCancelClicked()" qv-global-enter="onChooseClicked()">\n\t\t<div class="loading-screen" ng-show="backendIsThinking">\n\t\t\t<div class="qv-loader"></div>\n\t\t</div>\n\t\t<header class="dm-header" q-translation="scripteditor.dataconnectors.filechooser.urltitle"></header>\n\t\t<main class="dm-main">\n\t\t\t<div class="title" q-translation="Common.URL"></div>\n\n\t\t\t<qv-autocomplete-input value="path" list-items="recentUrls" testid="urlInput" input-type="text" max-input-length="2000">\n\t\t\t</qv-autocomplete-input>\n\n\t\t\t<div class="text" q-translation="Common.Name"></div>\n\t\t\t<input class="lui-input textfield" ng-model="name" maxlength="{{maxConnectionNameLength}}" ng-change="onNameChanged()" invalid="{{isNameInvalid()}}"/>\n\t\t\t<label ng-style="{visibility: showCreateConnectionError && \'visible\' || \'hidden\'}" class="errorlabel">{{errorContent}}</label>\n\n\t\t</main>\n\t\t<footer class="dm-footer">\n\t\t\t<lui-button x-variant="inverse" qva-activate="$event.preventDefault(); onCancelClicked()" q-translation="Common.Cancel" ng-disabled="backendIsThinking" tid="2e684a"></lui-button>\n\t\t\t<lui-button x-variant="inverse" id="okButton" qva-activate="$event.preventDefault(); onChooseClicked()" q-translation="{{isEdit ? \'Common.Save\' : \'Common.Create\'}}" ng-disabled="isOkDisabled()"></lui-button>\n\t\t</footer>\n\t</div>\n</div>\n'}),define("text!assets/general/directives/autocomplete-input/autocomplete-input.ng.html",[],function(){return'<div class="qv-autocomplete-input" q-title-translation="{{tooltip}}">\n\n\t<div class="input-box">\n\t\t<input maxlength="{{maxInputLength}}"\n\t\t\t   type="{{inputType}}"\n\t\t\t   autocapitalize="{{autoCapitalize}}"\n\t\t\t   autocorrect="{{autoCorrect}}"\n\t\t\t   class="lui-input"\n\t\t\t   ng-model="value"\n\t\t\t   tid="{{testid}}"\n\t\t/>\n\n\t\t<div class="lui-icon lui-icon--triangle-bottom" ng-click="toggleSuggestions()" ng-if="listItems.length > 0"></div>\n\t</div>\n\n\t<div class="pop-up-list" ng-show="suggestionsVisible && filteredList.length > 0" tabindex="1">\n\n\t\t<div class="list-item" ng-repeat="item in filteredList" ng-bind="item" qva-activate="selectItem(item); hideSuggestions();" ng-class="{selected: $index === currentListIndex}" tid="{{testid}}_list_item_{{$index}}"></div>\n\n\t</div>\n</div>\n'}),define("assets/general/directives/autocomplete-input/autocomplete-input",["qvangular","text!./autocomplete-input.ng.html","jquery","underscore"],function(e,t,n,i){"use strict";e.filter("qvAutocompleteFilter",function(){return function(e,t){var n=!1,r=i.filter(e,function(e){return e===t?(n=!0,!0):e.indexOf(t)>-1});return r.length>0&&!n?r:e}}),e.directive("qvAutocompleteInput",["$timeout","$filter",function(e,i){return{restrict:"E",replace:!0,template:t,scope:{value:"=",listItems:"=",tooltip:"@",testid:"@",maxInputLength:"@",inputType:"@"},link:function(t,r){function o(i){n(i.target).closest(n(r[0])).length||e(function(){t.hideSuggestions()},0)}function s(n){e(function(){t.currentListIndex=n},0)}function a(n){n.keyCode===c?(n.preventDefault(),s(t.currentListIndex<t.filteredList.length-1?t.currentListIndex+1:0)):n.keyCode===h?(n.preventDefault(),s(0===t.currentListIndex?t.filteredList.length-1:t.currentListIndex-1)):n.keyCode===u||n.keyCode===p?(n.preventDefault(),e(function(){t.selectItem(t.filteredList[t.currentListIndex]),t.hideSuggestions()},0)):n.keyCode===d&&(n.preventDefault(),s(-1),e(function(){t.hideSuggestions()},0),f.focus())}function l(n){n.keyCode===c?(n.preventDefault(),t.suggestionsVisible&&t.filteredList.length>0&&(f.blur(),m.focus(),e(function(){t.currentListIndex=0},0))):n.keyCode===d||n.keyCode===u?(n.preventDefault(),e(function(){t.hideSuggestions()},0)):n.keyCode===p?e(function(){t.hideSuggestions()},0):t.suggestionsVisible||e(function(){t.showSuggestions()},0)}var c=40,u=13,h=38,d=27,p=9;t.autoCapitalize="on",t.autoCorrect="on",t.maxInputLength||(t.maxInputLength="256"),t.inputType||(t.inputType="text"),"url"===t.inputType&&(t.autoCapitalize="off",t.autoCorrect="off");var f=r.find("input"),m=n(r[0]).find(".pop-up-list");t.suggestionsVisible=!1,t.$watch("value",function(e){t.filteredList=i("qvAutocompleteFilter")(t.listItems,e)}),t.showSuggestions=function(){t.suggestionsVisible=!0,n(document).on("click",o)},t.hideSuggestions=function(){t.suggestionsVisible=!1,n(document).off("click",o)},t.toggleSuggestions=function(){t.suggestionsVisible?t.hideSuggestions():t.showSuggestions()},t.selectItem=function(e){t.value=e,s(-1)},f.on("keydown",l),m.on("keydown",a),t.$on("$destroy",function(){n(document).off("click",o),f.off("keydown",l),m.off("keydown",a)})}}}])}),define("scripteditor.views/webfilechooser/webfilechooser",["text!assets/scripteditor/views/webfilechooser/webfilechooser.ng.html","general.utils/string-util","translator","assets/general/directives/autocomplete-input/autocomplete-input"],function(e,t,n){return{template:e,controller:["$scope","serverside","input",function(e,i,r){function o(){return t.prefixHttpToUrl(e.path)}function s(){var e=[],t=localStorage.getItem("scripteditor.webfilechooser.recentUrls");return t&&(e=JSON.parse(t)),e}function a(e){if(t.isValidUrl(e)){var n,i=s(),r=!1;for(n=0;n<i.length;n++)e===i[n]&&(r=!0,i.splice(n,1));r||i.length>4&&i.splice(0,1),i.push(e),localStorage.setItem("scripteditor.webfilechooser.recentUrls",JSON.stringify(i))}}e.isLoading=!1,e.showRecent=!1,e.isEdit=r.editMode,e.id=r.instanceId,e.maxConnectionNameLength=t.MAX_CONNECTION_NAME_LENGTH-i.getUsernameSuffix().length,e.backendIsThinking=!1,e.path="",e.init=function(){e.isEdit?(e.isLoading=!0,i.getConnection(e.id).then(function(t){e.isLoading=!1,e.name=t.qConnection.qName,e.path=t.qConnection.qConnectionString,e.originalName=t.qConnection.qName,e.originalPath=t.qConnection.qConnectionString})):setTimeout(function(){if(!/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var e=document.getElementById("urlInput");e&&e.focus()}}),e.recentUrls=s().reverse()},e.onCancelClicked=function(){e.backendIsThinking||e.destroyComponent()},e.onNameChanged=function(){e.nameChangedAtLeastOnce=!0},e.onUrlChanged=function(){e.urlChangedAtLeastOnce=!0},e.isOkDisabled=function(){return!t.isValidConnectionName(e.name)||!t.isValidUrl(o())||e.backendIsThinking},e.$watch("name",function(){e.showCreateConnectionError=!1,""!==e.name&&e.isNameInvalid()&&(e.errorContent=n.get("Common.InvalidCharacters"),e.showCreateConnectionError=!0)}),e.isNameInvalid=function(){return e.name?!t.isValidConnectionName(e.name):e.nameChangedAtLeastOnce},e.handleErrors=function(t){e.errorContent=i.getErrorContent(t),e.showCreateConnectionError=!0,t.isHandled=!0,e.backendIsThinking=!1},e.onChooseClicked=function(){e.isOkDisabled()||(e.backendIsThinking=!0,a(o()),e.isEdit?i.modifyConnection(e.id,e.name,o(),"internet",!1,"","").then(function(t){e.isLoading=!1,e.backendIsThinking=!1,t&&e.destroyComponent()},e.handleErrors):i.createNewRawConnection(e.name,o(),"internet").then(function(t){e.isLoading=!1,e.backendIsThinking=!1,t&&e.destroyComponent()},e.handleErrors))},e.shared={},e.init()}]}}),define("text!assets/hldm/data-connectors/native-webfile-connector/connect-step.ng.html",[],function(){return'<div class="native-webfile-connector-connect flatfilechoosercontainer">\n\t<div class="loading-screen" ng-show="isLoading">\n\t\t<div class="qv-loader"></div>\n\t</div>\n\n\t<main class="dm-main">\n\t\t<div class="title" q-translation="Common.URL"/>\n\n\t\t<qv-autocomplete-input value="path" list-items="recentUrls" testid="urlInput" input-type="text" max-input-length="2000">\n\t\t</qv-autocomplete-input>\n\n\t\t<div class="text" q-translation="Common.Name"/>\n\t\t<input class="lui-input textfield" ng-model="name" maxlength="{{maxConnectionNameLength}}" invalid="{{isNameInvalid()}}"/>\n\t\t<label ng-style="{visibility: showCreateConnectionError && \'visible\' || \'hidden\'}" class="errorlabel">{{errorContent}}</label>\n\t</main>\n</div>'}),define("assets/hldm/data-connectors/native-webfile-connector/connect-step",["text!./connect-step.ng.html","general.utils/string-util","translator","assets/general/directives/autocomplete-input/autocomplete-input"],function(e,t,n){return{template:e,scope:{title:"=",serverside:"=",continueWithNewConnection:"=",qvDialogContext:"="},controller:["$scope","serverside",function(e,i){function r(){return t.prefixHttpToUrl(e.path)}function o(){var e=[],t=localStorage.getItem("scripteditor.webfilechooser.recentUrls");return t&&(e=JSON.parse(t)),e}function s(e){if(t.isValidUrl(e)){var n,i=o(),r=!1;for(n=0;n<i.length;n++)e===i[n]&&(r=!0,i.splice(n,1));r||i.length>4&&i.splice(0,1),i.push(e),localStorage.setItem("scripteditor.webfilechooser.recentUrls",JSON.stringify(i))}}e.isLoading=!1,e.showRecent=!1,e.maxConnectionNameLength=t.MAX_CONNECTION_NAME_LENGTH-i.getUsernameSuffix().length,e.path="",e.qvDialogContext.title=n.get("scripteditor.dataconnectors.filechooser.urltitle"),e.qvDialogContext.size="T",e.recentUrls=o(),e.nextDisabled=function(){return!t.isValidConnectionName(e.name)||!t.isValidUrl(r())||e.isLoading},e.$watch("name",function(){e.showCreateConnectionError=!1,""!==e.name&&e.isNameInvalid()&&(e.nameChangedAtLeastOnce=!0,e.errorContent=n.get("Common.InvalidCharacters"),e.showCreateConnectionError=!0)}),e.isNameInvalid=function(){return e.name?!t.isValidConnectionName(e.name):e.nameChangedAtLeastOnce},e.handleErrors=function(t){e.errorContent=i.getErrorContent(t),e.showCreateConnectionError=!0,t.isHandled=!0,e.isLoading=!1},e.qvDialogContext.nextDisabled=e.nextDisabled,e.qvDialogContext.next=function(){e.nextDisabled()||(e.isLoading=!0,s(r()),e.isEdit?i.modifyConnection(e.id,e.name,r(),"internet",!1,"","").then(function(){e.isLoading=!1},e.handleErrors):i.createNewRawConnection(e.name,r(),"internet").then(function(){e.isLoading=!1,e.continueWithNewConnection({connectionName:e.name})},e.handleErrors))},e.onEscape=e.onCancelClicked=function(){e.isLoading||e.destroyComponent(),e.close()}}]}}),define("text!assets/hldm/data-connectors/native-webfile-connector/select-step.ng.html",[],function(){return'<div class="native-webfile-connector-select">\n\t<qv-generic-select-dialog ng-if="dataHasLoaded" data-provider="provider"\n\t\t\t\t\t\t\t  data-dataconnection-selection-editor="dataconnectionSelectionEditor"\n\t\t\t\t\t\t\t  data-qv-dialog-context="qvDialogContext"\n\t\t\t\t\t\t\t  data-qv-internals="qvInternals">\n\t</qv-generic-select-dialog>\n\t<qv-spinner class="spinner" show="!dataHasLoaded" show-delay="200" show-for-at-least="500" spinner-height="200px" spinner-width="200px" center-in-parent="true"></qv-spinner>\n</div>\n'}),define("assets/hldm/data-connectors/native-webfile-connector/select-step",["text!./select-step.ng.html","assets/hldm/data-connectors/native-file-connector/native-file-provider","translator"],function(e,t,n){return{template:e,scope:{qvDialogContext:"=",dataconnectionSelectionEditor:"=",connectionInput:"=",dataconnectorInstance:"=",qvInternals:"=",tableModelToEdit:"="},controller:["$scope",function(e){e.dataHasLoaded=!1,t.createNativeFileProvider(e.dataconnectorInstance,e.dataconnectionSelectionEditor,e.connectionInput,e.tableModelToEdit,e.qvDialogContext,!0).then(function(t){e.qvDialogContext.size="L",e.qvDialogContext.title=e.tableModelToEdit?n.get("quickdataload.EditSelectionsFor",e.tableModelToEdit.data.tableName):n.get("scripteditor.dataconnectors.dialog.titlewithname",t.selectOptions.selectFromTitleName),e.provider=t,e.dataHasLoaded=!0})}]}}),define("assets/hldm/data-connectors/native-webfile-connector/connector-main",["assets/hldm/data-connectors/native-webfile-connector/connect-step","assets/hldm/data-connectors/native-webfile-connector/select-step","translator"],function(e,t,n){return{create:function(){return{entrypoints:[{id:"internet",category:"web",name:n.get("scripteditor.dataconnectors.webfile"),initialConnectStep:e}],getInitialSelectStep:function(){return t}}}}}),define("assets/hldm/data-connectors/native-webfile-connector/native-webfile-connector",["scripteditor.views/webfilechooser/webfilechooser","scripteditor.views/fileselectdialog/fileselectdialog","assets/hldm/data-connectors/native-webfile-connector/connector-main"],function(e,t,n){return{connectDialog:e,selectDialog:t,connectorMain:n}}),define("text!assets/hldm/data-connectors/bdi/bdi-connect-dialog.ng.html",[],function(){return'<lui-dialog id="bdi-connect-dialog">\n\n\t<lui-dialog-header q-translation="bdi.connect.title">\n\t</lui-dialog-header>\n\n\t<lui-dialog-body class="">\n\n\t\t<qv-spinner class="spinner" show="isLoading" show-delay="100" show-for-at-least="300" spinner-height="150px" spinner-width="150px"\n\t\t center-in-parent="true "></qv-spinner>\n\n\t\t<label class="lui-label" q-translation="bdi.connect.host"></label>\n\t\t<input class="lui-input" ng-model="model.host" ng-disabled="isLoading" />\n\n\t\t<label class="lui-label" q-translation="bdi.connect.port"></label>\n\t\t<input class="lui-input" ng-model="model.port" ng-disabled="isLoading" />\n\n\t\t<label class="lui-label" q-translation="bdi.connect.model"></label>\n\t\t<input class="lui-input" ng-model="model.model" ng-disabled="isLoading" />\n\n\t\t<label class="lui-label" q-translation="Common.Name"></label>\n\t\t<input class="lui-input" ng-model="model.connectionName" ng-disabled="isLoading" />\n\n\n\t</lui-dialog-body>\n\n\n\t<lui-dialog-footer class="bdi-footer">\n\n\t\t<div>\n\t\t\t{{connectionTestMessage}}\n\t\t</div>\n\n\t\t<div class="buttons">\n\t\t\t<button class="lui-button" ng-click="close()" q-translation="Common.Cancel"></button>\n\t\t\t<button class="lui-button" ng-click="testConnection() " q-translation="scripteditor.dataconnectors.testconnection" ng-disabled="isLoading || !canCreate()"></button>\n\t\t\t<button class="lui-button" ng-click="createConnection()" qv-confirm="createConnection()" q-translation="Common.Create" ng-disabled="isLoading || !canCreate()"></button>\n\t\t</div>\n\t</lui-dialog-footer>\n\n\n</lui-dialog>'}),define("assets/hldm/data-connectors/bdi/bdi-connect-dialog",["qvangular","text!./bdi-connect-dialog.ng.html","core.models/engine","translator"],function(e,t,n,i){var r={restrict:"E",template:t,replace:!0,scope:{},controller:["$scope",function(e){e.model={host:"",port:"",model:"",connectionName:""},e.editMode=e.input.editMode,e.isLoading=!0;var t=/'(.*)\s(.*):(.*)'/g;e.editMode?(e.isLoading=!0,e.input.serverside.getConnection(e.input.instanceId).then(function(n){e.isLoading=!1,e.model.connectionName=n.qConnection.qName,e.rawConnectionString=n.qConnection.qConnectionString;var i=t.exec(n.qConnection.qConnectionString);e.model.model=i[1],e.model.host=i[2],e.model.port=i[3]})):e.isLoading=!1,e.$watch("model",function(){e.connectionTestMessage=""},!0),e.testConnection=function(){e.isLoading=!0,n.global.isValidConnectionString({qConnectionString:r(e.model.model,e.model.host,e.model.port)}).then(function(){e.isLoading=!1,e.connectionTestMessage=i.get("scripteditor.dataconnectors.testconnection.succeeded")},function(t){t.isHandled=!0,e.isLoading=!1,e.connectionTestMessage=i.get("scripteditor.dataconnectors.testconnection.failed")})},e.createConnection=function(){e.editMode?e.input.serverside.modifyConnection(e.input.id,e.model.connectionName,r(e.model.model,e.model.host,e.model.port),"BDI").then(function(t){e.isLoading=!1,t&&e.destroyComponent()},e.handleErrors):e.input.serverside.createNewConnectionAPI(e.model.connectionName,r(e.model.model,e.model.host,e.model.port),"BDI").then(function(t){t&&e.destroyComponent()})};var r=function(e,t,n){return"BDI CONNECT TO '"+e+" "+t+":"+n+"'"};e.canCreate=function(){return e.model.model&&e.model.host&&e.model.port&&e.model.connectionName}}]};return{showDialog:function(t){e.getService("luiDialog").show({template:r.template,controller:r.controller,input:t,closeOnOutside:!1,showArrow:!1})}}}),define("text!assets/hldm/data-connectors/bdi/bdi.ng.html",[],function(){return'<lui-dialog id="bdi-dialog">\n\n  <lui-dialog-header>\n   <div q-translation="bdi.select.title"></div>\n  </lui-dialog-header>\n\n  <lui-dialog-body class="bdi-container">\n\n    <qv-spinner class="spinner" show="loading" show-delay="100" show-for-at-least="300" spinner-height="150px" spinner-width="150px"\n      center-in-parent="true "></qv-spinner>\n\n    <qv-stage-current-selections ng-if="app && !loading" app="app" class="qvt-selections" options="{variant: \'bright\', hideUndoRedo: true, hideSelectionsTool: true, hideSearch: true, hideClearSelections: true}"></qv-stage-current-selections>\n\n    <div class="bdi-top-bar" ng-hide="loading">\n      <lui-search class="bdi-search-box " query="search.text " on-escape="search.text=\'\' ; " placeholder="Common.Search " />\n\n      <div class="bdi-top-bar-right">\n        <button class="lui-fade-button" ng-click="selectAll()">\n          <span class="lui-fade-button__icon  lui-icon lui-icon--select-all"></span>\n        </button>\n        <button class="lui-fade-button" ng-click="clearAll()">\n          <span class="lui-fade-button__icon  lui-icon lui-icon--clear-selections"></span>\n        </button>\n      </div>\n\n    </div>\n\n    <div class="bdi-field-lists-container">\n      <bdi-field-list fields="table.fields " name="table.name " filter="search.text" state-updated="onFieldStateUpdated()" ng-repeat="table in allTables"\n        ng-hide="loading || (table.fieldListApi && !table.fieldListApi.isDisplayed())" field-list-on-init="table.fieldListApi=$api"></bdi-field-list>\n    </div>\n  </lui-dialog-body>\n\n\n  <lui-dialog-footer class="bdi-footer">\n    \x3c!-- Count is off for now --\x3e\n    <div class="bdi-row-count" ng-hide="loading" ng-if="false">\n      <div>{{selectedRowString}}</div>\n    </div>\n    <button class="lui-button close button " ng-click="cancel() " name="cancelButton " q-translation="Common.Cancel" ng-disabled="!app">Cancel</button>\n    <button class="lui-button confirm button " ng-click="insertScript()" qv-confirm="insertScript()" ng-disabled="loading || getRowCount() === 0"\n      q-translation="scripteditor.dataconnectors.addToScript"></button>\n  </lui-dialog-footer>\n\n</lui-dialog>'}),define("core.utils/model-garbage-collector",["core.utils/notification","core.utils/debug-flags"],function(e,t){function n(e){return e.Invalidated&&e.Invalidated.observers&&0===e.Invalidated.observers.length}function i(n){t.RELEASEMODELS&&window.console.info("[DBGFLG:RELEASEMODEL] Releasing model (id):",n.id),e.release(n);for(var i in n)delete n[i]}var r=[];return setInterval(function(){for(var e,o=r.length;o--;)e=r[o],t.RELEASEMODELS&&window.console.info("[DBGFLG:RELEASEMODEL] Checking model (id, handle, model):",e.id,e.handle,e),n(e)&&(i(e),r.splice(o,1))},1e4),{addToQueue:function(e){r.push(e)}}}),define("core.models/rpc-base",["core.utils/deferred","core.utils/notification","core.utils/class","core.utils/json-patch","core.utils/model-garbage-collector","autogenerated/qix/engine-enums"],function(e,t,n,i,r,o){"use strict";function s(e,t){Array.isArray(t)?i.apply(e,t):i.updateObject(e,t)}var a=o.NxLocalizedErrorCode,l=["GetLayout","GetAppLayout","AbortModal","DoSave"],c=n.extend("RPCBase",{init:function(e){var n=this;t.mixin(n),n.notification("Validated"),n.notification("Invalidated"),n.notification("Validating"),n.notification("Closed"),n.notification("Closing"),n.notification("Cancelled"),n.modelType="RPCBase",n.id=e.id,n.session=e.session,n.handle=e.handle,n.checkCreate=e.checkCreate,n._properties={},n.properties={},n.propertyTree={},n.ongoingRequests={},n.needCacheProperties=!0,n._effectiveProperties={},n.effectiveProperties={},n.needCacheEffectiveProperties=!0,n.enigmaModel=e.enigmaModel,n.setState(c.States.INVALID),"App"!==n.constructor.name&&n.bindToRPC()},bindToRPC:function(){var e=this;e.layout=e.enigmaModel.layout,e.session.onChange(e.handle,e.changeHandler.bind(e)),e.Cancelled.bind(e.clearPending.bind(e))},changeHandler:function(){var e=this;e.clearPending(),e.needCacheProperties=!0,e.needCacheEffectiveProperties=!0,e.isCancelled||e.setState(c.States.INVALID)},clearPending:function(){for(var e in this.ongoingRequests)delete this.ongoingRequests[e]},setState:function(e){var t=this,n=t.state;delete this.__layoutRPCId,t.state=e,n!==t.state&&(e===c.States.INVALID?t.Invalidated.emit():e===c.States.VALID?t.Validated.emit():e===c.States.VALIDATING?t.Validating.emit():e===c.States.CLOSED?t.Closed.emit():e===c.States.CLOSING?t.Closing.emit():e===c.States.CANCELLED&&t.Cancelled.emit())},getLayout:function(){var t=this;if(t.isValid||t.isCancelled)return e.resolve(t.layout);if(t.isValidating||t.setState(c.States.VALIDATING),t.ongoingRequests.GetLayout)return t.ongoingRequests.GetLayout;var n=t.enigmaModel.getLayout(),i=n.then(function(){return t.setState(c.States.VALID),t.layout});return t.__layoutRPCId=n.reqId,t.ongoingRequests.GetLayout=i,i},getProperties:function(t){var n=this;if(t=t||"GetProperties",n.isValid&&!n.needCacheProperties)return e.resolve(n.properties);if(n.ongoingRequests[t+!1])return n.ongoingRequests[t+!1];var r=n.rpc(t,"qProp",[],{delta:!1}).then(function(e){var t=i.generate(n._properties,e);return n._properties=e,i.apply(n.properties,t),n.isValid&&(n.needCacheProperties=!1),n.properties});return n.ongoingRequests[t+!1]=r,r},getEffectiveProperties:function(){var t=this,n="GetEffectiveProperties";if(t.isValid&&!t.needCacheEffectiveProperties)return e.resolve(t.effectiveProperties);if(t.ongoingRequests[n+!1])return t.ongoingRequests[n+!1];var r=t.rpc(n,"qProp",[],{delta:!1}).then(function(e){var n=i.generate(t._effectiveProperties,e);return t._effectiveProperties=e,i.apply(t.effectiveProperties,n),t.isValid&&(t.needCacheEffectiveProperties=!1),t.effectiveProperties});return t.ongoingRequests[n+!1]=r,r},hasChanges:function(){return i.generate(this._properties,this.properties).length>0},markAsInvalid:function(){this.state=-99,this.setState(c.States.INVALID)},markAsCancelled:function(){this.setState(c.States.CANCELLED)},getFullPropertyTree:function(e){var t=this;return e=e||"GetFullPropertyTree",t.rpc(e,"qPropEntry",[],!1).then(function(e){return t._propertyTree=e,s(t.propertyTree,e),t.propertyTree})},setProperties:function(e,t,n){var r=this;return t=t||"SetProperties",Array.isArray(e)||(e=[e]),this.rpc(t,null,e,n).then(function(){i.updateObject(r._properties,r.properties)})},setFullPropertyTree:function(e,t,n){return t=t||"SetFullPropertyTree",Array.isArray(e)||(e=[e]),this.rpc(t,null,e,n)},save:function(){return this.hasChanges()?this.setProperties(this.properties):e.resolve()},saveTree:function(){return this.setFullPropertyTree(this.propertyTree)},getChildInfos:function(){return this.rpc("GetChildInfos","qInfos",[])},close:function(t){var n=this;t||(n.rpcOptions.onClose=n.rpcOptions.onClose?n.rpcOptions.onClose:function(){}),n.setState(c.States.CLOSING);var i=e.resolve();delete n.session.changeHandlers[n.handle],delete n.session.modelCache[n.id];for(var o in n.ongoingRequests)n.ongoingRequests[o].then&&n.ongoingRequests[o].then(null,function(e){e.error.isHandled=!0});return i.then(function(){n.setState(c.States.CLOSED),r.addToQueue(n)})},rpc:function(t,n,i,r){r=r||{delta:!1,raw:!1};var o=this,s=[].slice.call(arguments);if(!o.handle&&"App"===o.constructor.name)return o.waitForOpen.promise.then(function(){return o.rpc.apply(o,s)});var c={method:t,handle:this.handle,params:i||[]};if(r.delta&&(c.delta=!0),!o.session||o.isClosing||o.isClosed)return e.reject();var u=o.session.rpc(c).then(function(e){return n?e.result[n]:r.raw?e:e.result},function(t){return t.error.code===a.LOCERR_HC_MODAL_OBJECT_ERROR?(t.error.isHandled=!0,o.session.currentApp.abortModal().then(function(){return o.rpc.apply(o,s)})):e.reject(t)});return l.indexOf(t)>-1&&(o.ongoingRequests[t+r.delta]=u,u.finally(function(){delete o.ongoingRequests[t+r.delta]})),u.rpcId=c.id,u}});return c.getModel=function(t,n,i){var r=n.modelCache[t],o=this;return t?r||(r=i().then(function(e){return new o({id:e.id,session:n,handle:e.handle,enigmaModel:e})},function(i){return delete n.modelCache[t],e.reject({error:{code:i&&i.error&&i.error.code,message:"No object with Id "+t+" found",parameter:t}})}),n.modelCache[t]=r,r):e.reject("No ID given to RPCBase#getModel")},c.getLayout=function(e,t){return this.get(e,t).then(function(e){return e.getLayout().then(function(e){return e})})},c.getProperties=function(e,t){return this.get(e,t).then(function(e){return e.getProperties().then(function(){return e})})},c.extend=function(e,t){var i=n.extend.call(this,e,t);return i.getLayout=c.getLayout,i.getProperties=c.getProperties,i.getModel=c.getModel,i},Object.defineProperties(c.prototype,{isValid:{get:function(){return this.state===c.States.VALID}},isValidating:{get:function(){return this.state===c.States.VALIDATING}},isInvalid:{get:function(){return this.state===c.States.INVALID}},isClosed:{get:function(){return this.state===c.States.CLOSED}},isClosing:{get:function(){return this.state===c.States.CLOSING}},isCancelled:{get:function(){return this.state===c.States.CANCELLED}}}),c.States={VALID:1,INVALID:2,VALIDATING:3,CLOSED:5,CLOSING:6,CANCELLED:7},c}),define("core.models/rpc-session",["qvangular","core.utils/notification","core.utils/deferred","core.models/communication","autogenerated/qix/engine-enums"],function(e,t,n,i,r){"use strict";function o(e,t,n,i){e.Send.emit(n),n.outKey=-1;var r=t.send(n);return e.dfdCache[n.id]=i,e.reqCache[n.id]=n,i.id=n.id,i.promise.requestId=r.requestId,i.promise}function s(e){var n=this;t.mixin(n),n.notification("Open"),n.notification("Close"),n.notification("Send"),n.notification("Data"),n.notification("Error"),n.notification("ClosedHandles"),n.notification("ChangedHandles"),n.notification("Notification"),n.notification("Warning"),n.changeHandlers={},n.cacheName=e.cacheName,n.dfdCache={},n.reqCache={},n.modelCache={},n.options=e,n.socket={url:""}}function a(e,t,n,i){n.open().then(function(){e[t](i)})}function l(e){var t=e.__enigmaSession;t.on("suspended",function(t){"network"===t.initiator&&e.close()}),t.on("closed",function(n){a(e,"onClose",t,n)}),t.rpc.on("error-socket",function(n){a(e,"onError",t,n)}),t.rpc.on("message",function(n){a(e,"onData",t,n)}),t.rpc.on("notification",function(n){a(e,"onData",t,n)})}var c=r.NxLocalizedErrorCode,u=null,h=[],d=["GetObject","GetLayout","GetAppLayout","GetProperties","GetAppProperties","GetEffectiveProperties","GetFullPropertyTree","GetDimension","GetMeasure","GetVariableById","GetVariableByName","GetBookmark","GetScriptEx"];return s.prototype={open:function(){return this.enigmaPromise},onError:function(e){var t=this;Object.keys(t.dfdCache).forEach(function(n){e.error={err:e,isHandled:!0},t.dfdCache[n].reject(e)}),t.Error.emit(e)},_cleanup:function(){var e=this;if(e.Close){e.Close.emit();for(var n in e.modelCache)e.modelCache[n].then(function(e){e.close(!0)});t.release(e)}},onClose:function(){var e=this;e._isClosed||(delete s.__cache[e.cacheName],s.useTimeoutOnClose?setTimeout(e._cleanup.bind(e),1e3):e._cleanup(),e._isClosed=!0)},onData:function(e){var t=this,n=t.dfdCache[e.id];e.change&&t.handleChanged(e),e.close&&t.handleClosed(e),s.debounceApply(function(){if(e.handle&&!t.changeHandlers[e.handle]&&n)n.reject("No model mapped to handle");else if(e.result)t.Data.emit(e),e.warnings&&t.Warning.emit(e),n&&n.resolve(e);else if(e.params)t.Notification.emit(e),n&&n.resolve(e);else if(e.suspend)t.rpc({method:"Resume",params:[],handle:e.suspend[0]}),n&&n.resolve(e);else if(e.error){var i=t.reqCache[e.id];i&&e.error.code===c.LOCERR_GENERIC_ABORTED&&d.indexOf(i.method)>-1?o(t,t.__enigmaSession,i,n):(n&&n.reject(e),t.Error.emit(e))}delete t.dfdCache[e.id],delete t.reqCache[e.id]})},handleChanged:function(e){var t=this;e.change.forEach(function(e){var n=t.changeHandlers[e];n&&n.forEach(function(e){e()})}),t.ChangedHandles.emit(e.change)},handleClosed:function(e){var t=this;Object.keys(t.modelCache).forEach(function(n){t.modelCache[n].then(function(t){e.close.indexOf(t.handle)>-1&&t.close(!0)})}),t.ClosedHandles.emit(e.close)},close:function(){var e=this;e.enigmaPromise.then(function(){e.__enigmaSession.close()})},rpc:function(e,t){var i=this;return t||(t=new n),i.__enigmaSession?o(i,i.__enigmaSession,e,t):i.enigmaPromise.then(function(){return o(i,i.__enigmaSession,e,t)})},onChange:function(e,t){this.changeHandlers[e]||(this.changeHandlers[e]=[]),this.changeHandlers[e].push(t)},getRequest:function(e){return this.reqCache[e]||null}},s.useTimeoutOnClose=!0,s.__cache={},s.createInput=function(e,t){return t=t||{},t.appName=e,t.cacheName=s.buildUrl(t),t},s.debounceApply=function(t){clearTimeout(u),h.push(t),u=setTimeout(function(){e.$apply(e.$rootScope,function(){for(var e=0;e<h.length;e++)try{h[e]()}catch(e){}h.length=0})})},s.get=function(e,t){function n(e){r.__enigmaApp=e.app||e,r.__enigmaGlobal=e.global||e,r.__enigmaSession=(e.app||e.global||e).session,l(r)}e=e||"";var r,o=s.createInput(e,t);return r=s.__cache[o.cacheName]=new s(o),e&&"?transient="!==e&&!t.sessionApp?r.enigmaPromise=i.get(e,t).then(n):t.sessionApp&&t.sessionApp.value&&t.sessionApp.appId?(t.route="app/"+encodeURIComponent(t.sessionApp.appId),r.enigmaPromise=i.getSessionApp(t.sessionApp.appId,t).then(n)):("?transient="===e&&(t.route="app/"+encodeURIComponent(e)),r.enigmaPromise=i.getGlobal(t).then(n)),r},s.getIfCached=function(e,t){var n=s.createInput(e,t);return s.__cache[n.cacheName]},s.buildUrl=function(e){var t="",n=e.host,i="string"==typeof e.port?e.port:e.isSecure?443:4848;return t+=e.isSecure?"wss":"ws",t+="://",t+=n||"localhost",e.port&&(t+=":",t+=i),t+=e.prefix||"/",e.subpath&&(t+=e.subpath+"/"),e.route?t+=e.route:t+="app/"+encodeURIComponent(e.appName),e.identity&&(t+="/identity/"+encodeURIComponent(e.identity)),t+="?reloadUri="+(e.reloadURI||"")},s}),define("core.models/app",["core.models/rpc-base","core.models/rpc-session","core.models/engine","core.utils/deferred","util"],function(e,t,n,i,r){"use strict";var o,s,a,l={};return o=e.extend("App",{init:function(e,n,r,o,a){var l=this;r&&s||(s=l),l.rpcOptions=n||{},l.rpcOptions.onError=o,l.rpcOptions.onWarning=a,l.session=t.get(e,n),l.session.modelCache[e]=i.resolve(l),l.waitForOpen=new i,l._super({id:e,session:l.session,checkCreate:!0});try{l.open().then(function(){l.waitForOpen.resolve(l)},function(e){l.waitForOpen.reject({error:e})})}catch(e){l.waitForOpen.reject({isHandled:!1,error:e})}},open:function(){var e=this;return e.session.Error.bind(function(e){setTimeout(function(){e.error&&!e.error.isHandled&&window.console.log("Error from Engine:",e)},1e3)}),e.session.enigmaPromise.then(function(){e.enigmaModel=e.session.__enigmaApp,e.handle=e.enigmaModel.handle,e.engineApp=n.bootstrap(e.enigmaModel),e.engineApp.name=e.id,e.enigmaModel.engineApp=e.engineApp,o.current===e&&n.setCurrentApp(e.engineApp),e.bindToRPC()})},close:function(e){return delete l[this.cacheId],this.session.close(),s===this&&(s=void 0,a=!0),this._super(e)},createSessionObject:function(e){return this.rpc("CreateSessionObject","qReturn",[e])},createSessionVariable:function(e){return this.rpc("CreateSessionVariable","qReturn",[e])},doSave:function(){return this.rpc("DoSave",null)},getProperties:function(){return this._super("GetAppProperties")},setProperties:function(e){return this._super(e,"SetAppProperties")},checkExpression:function(e,t){var n=[e];return t&&n.push(t),this.rpc("CheckExpression",null,n)},checkNumberOrExpression:function(e){return this.rpc("CheckNumberOrExpression",null,[e])},evaluateExpression:function(e){return this.rpc("Evaluate","qReturn",[e])},getConfiguration:function(){return this.session.rpc({method:"GetConfiguration",handle:-1,params:[]}).then(function(e){return e.result.qConfig})},getVersion:function(){return this.session.rpc({method:"QvVersion",handle:-1,params:[]}).then(function(e){return e.result.qReturn})},getListOfFunctions:function(){return this.session.rpc({method:"GetFunctions",handle:-1,params:[]}).then(function(e){return e.result.qFunctions})},getLocaleInfo:function(){return this.rpc("GetLocaleInfo","qReturn")},getExpressions:function(){return this.rpc("GetExpressions","qExpressions")},getStreams:function(){var e=this;return e.streamsList?i.resolve(e.streamsList):this.session.rpc({method:"GetStreamList",handle:-1,params:[]}).then(function(t){return e.streamsList=t.result.qStreamList,e.streamsList})},getPublishableStreams:function(){var e=this.getLayout(),t=this.getStreams(),n=new i;return i.all({layout:e,streams:t}).then(function(e){var t=e.streams.filter(function(t){return e.layout.stream?t.qId===e.layout.stream.id&&-1!==t.privileges.indexOf("publish"):-1!==t.privileges.indexOf("publish")});n.resolve(t)}),n.promise},getMatchingFields:function(e){return this.rpc("GetMatchingFields",null,[e])},getContentLibraries:function(){return this.rpc("GetContentLibraries").then(function(e){return e.qList.qItems})},getLibraryContent:function(e){return this.rpc("GetLibraryContent",null,[e]).then(function(e){return e.qList.qItems})},getMediaList:function(){return this.rpc("GetMediaList").then(function(e){return e.qList.qItems})},findMatchingFields:function(e,t){return this.rpc("FindMatchingFields",null,[e,t])},abortModal:function(e){return this.enigmaModel.switchModalSelection(e)},switchModal:function(e,t,n){return this.enigmaModel.switchModalSelection(e&&e.enigmaModel,t,n),i.resolve()},setModal:function(e){this.enigmaModel.setModalSelection(e&&e.enigmaModel)},isModal:function(){return this.enigmaModel.isInModalSelection()},publish:function(e){return this.rpc("Publish",null,[e])}}),Object.defineProperty(o,"current",{get:function(){return s}}),o.makeCacheId=function(e,t){var n=e.toLowerCase();return t&&(n+=t.host?"/"+t.host:"/",n+=t.identity?"/"+t.identity:"/",n+=t.openWithoutData?"/openWithoutData":"/",n+=t.port?"/"+t.port:"/",n+=t.prefix?"/"+t.prefix:"/",n+=t.subpath?"/"+t.subpath:"/"),n},o.get=function(e,t,n,r,s){return!arguments.length&&a?i.reject(new Error("The current app has been closed")):o.getSync(e,t,n,r,s).waitForOpen.promise},o.getSync=function(e,t,n,i,s){e=e||r.getParameterByName("app")||"?transient=",void 0===t&&(t={}),"string"!=typeof t.host&&(t.host=r.hostname),"string"!=typeof t.port&&(t.port=r.port),"string"!=typeof t.prefix&&(t.prefix="/"===r.basePath?"":r.basePath),"boolean"!=typeof t.isSecure&&(t.isSecure=r.isSecure),"string"!=typeof t.reloadURI&&(t.reloadURI=r.reloadURI);var a=o.makeCacheId(e,t),c=l[a]=l[a]||new o(e,t,n,i,s);return c.cacheId=a,c},o.create=function(e,t){return t.rpc({method:"CreateApp",handle:-1,params:[e]}).then(function(e){return e.result})},o.remove=function(e,t){return t.rpc({method:"DeleteApp",handle:-1,params:[e]}).then(function(e){return e.result})},o.getList=function(e){return e.rpc({method:"GetDocList",handle:-1,params:[]}).then(function(e){return e.result.qDocList})},o}),define("client.models/current-selections",["core.models/communication","core.utils/deferred"],function(e,t){"use strict";var n={};return{get:function(i){return(i?t.resolve(i.enigmaModel):e.getApp()).then(function(e){return n[e.id]=n[e.id]||e.getCurrentSelectionObject()})}}}),define("client.models/bookmark",["core.utils/deferred","core.models/communication"],function(e,t){"use strict";function n(n){return n?e.resolve(n.enigmaModel):t.getApp()}var i={};return i.get=function(e,t){return n(t).then(function(t){return t.getBookmark(e)})},i.apply=function(e,t){return n(t).then(function(t){return t.applyBookmark(e)})},i.create=function(e,t){return n(t).then(function(t){return t.createBookmark(e)})},i.remove=function(e,t){return n(t).then(function(t){return t.destroyBookmark(e)})},i.getList=function(e){return n(e).then(function(e){return e.getBookmarkListObject()})},i.getListLayout=function(e){return n(e).then(function(e){return e.getBookmarkList()})},i}),define("client.models/snapshot",["client.models/bookmark","core.utils/deferred","core.models/communication"],function(e,t,n){"use strict";function i(e){return e?t.resolve(e.enigmaModel):n.getApp()}var r={};return r.getLibraryContent=function(e,t){return i().then(function(n){return n.getSnapshotListObject().then(function(n){return n.Invalidated&&n.Invalidated.unbind(),n.Invalidated.bind(t),n.getLayout().then(function(t){return t.filter(function(t){var n=!0;return e&&(n=e===t.qData.sourceObjectId),!t.qData.isClone&&n})})})})},r.unbindList=function(){return i().then(function(e){return e.getSnapshotListObject().then(function(e){e.Invalidated.unbind()})})},r.getSnapshotCount=function(e){return i().then(function(t){return t.getSnapshotList().then(function(t){for(var n=0,i=0;i<t.length;i++)t[i].qData.isClone||t[i].qData.sourceObjectId!==e||n++;return n})})},r.create=function(t,n){return t&&(t.qInfo={qType:"snapshot"}),i().then(function(i){return i.getSnapshotList().then(function(i){for(var o=0,s=0;s<i.length;s++)i[s].qData.isClone||o++;var a=o<500;return!!a&&e.create.call(r,t,n).then(function(e){return{limit:a,id:e.id}})})})},r.get=function(t,n){return e.get(t,n)},r.remove=function(t,n){return e.remove(t,n)},r.getEmbedded=function(e){return e.enigmaModel.getSnapshotObject()},r}),define("objects.backend-api/engine-throttle",["core.utils/deferred","core.utils/class","core.utils/notification","util"],function(e,t,n,i){function r(e,t){var n=this;this.queuedRequests.push(e),clearTimeout(this._debounceTimer),t>=10?this._debounceTimer=setTimeout(function(){o.call(n)},t):o.call(n)}function o(){if(this.ongoingRequests.length)this.waitingForResponse=!0;else{var e=this.queuedRequests.pop();for(e&&s.call(this,e);this.queuedRequests.length;)(e=this.queuedRequests.shift()).dfd.reject()}}function s(e){this.waitingForResponse=!1,this.ongoingRequests.push(e);var t=this,n=e.wrapper;e.sentAt=Date.now(),n.promise.then(function(){t.ongoingRequests.splice(t.ongoingRequests.indexOf(e),1),e.respondedAt=Date.now(),t.resolvedRequests.push({sentAt:e.sentAt,respondedAt:e.respondedAt,requestedAt:e.requestedAt}),t.resolvedRequests.length>10&&(t.resolvedRequests=t.resolvedRequests.slice(-10)),e.requestedAt>t._latestResolvedRequestedAt?e.dfd.resolve.apply(e.dfd,[].slice.call(arguments)):e.dfd.reject(),t._latestResolvedRequestedAt=e.requestedAt},function(){t.ongoingRequests.splice(t.ongoingRequests.indexOf(e),1),e.respondedAt=Date.now(),e.dfd.reject.apply(e.dfd,[].slice.call(arguments))}).finally(function(){t.waitingForResponse&&o.call(t)}),this.Send.emit(e.data,n)}var a={enabled:!0,delay:50};return t.extend("Throttle",{init:function(){this.options={},this.ongoingRequests=[],this.queuedRequests=[],this.recentRequests=[],this.resolvedRequests=[],this._debounceTimer=null,this._latestResolvedRequestedAt=-1,n.mixin(this),this.notification("Send"),this.notification("Cancel"),this.setOptions({})},destroy:function(){this.clear(),this.recentRequests=[],this.resolvedRequests=[],n.release(this)},setOptions:function(e){this.options=i.extend(!0,{},a,this.options,e),this.enabled=this.options.enabled||!1,this.delay=this.options.delay||-1},clear:function(){clearTimeout(this._debounceTimer);for(;this.queuedRequests.length;)this.queuedRequests.pop().dfd.reject();for(;this.ongoingRequests.length;)this.ongoingRequests.pop().dfd.reject()},queue:function(t){var n=this.enabled?this.delay:-1,i=Date.now(),o={data:t,dfd:e(),wrapper:e(),requestedAt:i},s=Math.max(this._getAvgResolutionTime(),n),a=n<1,l=this.recentRequests.length<1,c=l||i-this.recentRequests.slice(-1)[0].requestedAt>s,u=i>this._latestResolvedRequestedAt+n;return a||l||c||u?r.apply(this,[o,0]):r.apply(this,[o,Math.min(n,1e3)]),this.recentRequests.push(o),this.recentRequests.length>10&&(this.recentRequests=this.recentRequests.slice(-10)),o.dfd.promise},updateResolutionTime:function(){this._latestResolvedRequestedAt=Date.now()},_getAvgResolutionTime:function(){var e;return this.resolvedRequests.length&&(e=0,this.resolvedRequests.forEach(function(t){e+=t.respondedAt-t.sentAt}),e/=this.resolvedRequests.length),e}})}),define("objects.backend-api/cube-slicer",["core.utils/class","general.utils/shapes/rect"],function(e,t){"use strict";var n=new t(0,0,0,0),i=new t(0,0,0,0);return e.extend("CubeSlicer",{init:function(){this.pages=[]},get:function(e){return e.map(function(e){return this.getPage(e)}.bind(this))},getPage:function(e){var r,o,s,a=[];for(o=0;o<this.pages.length;o++)if(r=this.pages[o].qArea,n.set(e.qLeft,e.qTop,e.qWidth,e.qHeight),i.set(r.qLeft,r.qTop,r.qWidth,r.qHeight),s=i.intersection(n,!0),a.push({coverage:s?s.clone():new t(0,0,0,0),idx:o}),r.qLeft<=e.qLeft&&r.qLeft+r.qWidth>=e.qLeft+e.qWidth&&r.qTop<=e.qTop&&r.qTop+r.qHeight>=e.qTop+e.qHeight)return this._extract(e,this.pages[o]);return a.sort(function(e,t){return t.coverage.width*t.coverage.height-e.coverage.width*e.coverage.height}),a[0].coverage.height>0&&a[0].coverage.width>0?this._extract(e,this.pages[a[0].idx]):{qArea:{qTop:e.qTop,qLeft:e.qLeft,qWidth:0,qHeight:0},qMatrix:[]}},destroy:function(){this.clear()},isEmpty:function(){return!(this.pages&&this.pages[0]&&this.pages[0].qArea.qHeight&&this.pages[0].qArea.qWidth)},clear:function(){this.pages=[]},store:function(e){this.pages=e},containsArea:function(e){for(var t,n=0;n<this.pages.length;n++)if((t=this.pages[n].qArea).qLeft<=e.qLeft&&t.qLeft+t.qWidth>=e.qLeft+e.qWidth&&t.qTop<=e.qTop&&t.qTop+t.qHeight>=e.qTop+e.qHeight)return!0;return!1},contains:function(e){return!(!this.pages||!this.pages.length)&&0===e.filter(function(e){return!this.containsArea(e)}.bind(this)).length},_extract:function(e,t){n.set(e.qLeft,e.qTop,e.qWidth,e.qHeight),i.set(t.qArea.qLeft,t.qArea.qTop,t.qArea.qWidth,t.qArea.qHeight);var r,o,s,a=n.intersection(i,!0);return a?(s=Math.max(0,e.qTop-t.qArea.qTop),o=Math.max(0,e.qLeft-t.qArea.qLeft),r=t.qMatrix.slice(s,s+a.height).map(function(e){return e.slice(o,o+a.width)}),{qArea:{qTop:a.y,qLeft:a.x,qWidth:a.width,qHeight:a.height},qMatrix:r}):{qArea:{qTop:e.qTop,qLeft:e.qLeft,qWidth:0,qHeight:0},qMatrix:[]}}})}),define("objects.backend-api/stacked-cube-slicer",["core.utils/class","general.utils/shapes/rect"],function(e,t){"use strict";var n=new t(0,0,0,0),i=new t(0,0,0,0);return e.extend("StackedCubeSlicer",{init:function(){this.pages=[]},get:function(e){return e.map(function(e){return this.getPage(e)}.bind(this))},getPage:function(e){var r,o,s,a=[];for(o=0;o<this.pages.length;o++)if(r=this.pages[o].qArea,n.set(e.qLeft,e.qTop,e.qWidth,e.qHeight),i.set(r.qLeft,r.qTop,r.qWidth,r.qHeight),s=i.intersection(n,!0),a.push({coverage:s?s.clone():new t(0,0,0,0),idx:o}),r.qLeft<=e.qLeft&&r.qLeft+r.qWidth>=e.qLeft+e.qWidth&&r.qTop<=e.qTop&&r.qTop+r.qHeight>=e.qTop+e.qHeight)return this._extract(e,this.pages[o]);return a.sort(function(e,t){return t.coverage.width*t.coverage.height-e.coverage.width*e.coverage.height}),a[0].coverage.height>0&&a[0].coverage.width>0?this._extract(e,this.pages[a[0].idx]):{qArea:{qTop:e.qTop,qLeft:e.qLeft,qWidth:0,qHeight:0},qData:[]}},destroy:function(){this.clear()},isEmpty:function(){return!(this.pages&&this.pages[0]&&this.pages[0].qArea.qHeight&&this.pages[0].qArea.qWidth)},clear:function(){this.pages=[]},store:function(e){this.pages=e},containsArea:function(e){for(var t,n=0;n<this.pages.length;n++)if((t=this.pages[n].qArea).qLeft<=e.qLeft&&t.qLeft+t.qWidth>=e.qLeft+e.qWidth&&t.qTop<=e.qTop&&t.qTop+t.qHeight>=e.qTop+e.qHeight)return!0;return!1},contains:function(e){return!(!this.pages||!this.pages.length)&&0===e.filter(function(e){return!this.containsArea(e)}.bind(this)).length},_extract:function(e,t){n.set(e.qLeft,e.qTop,e.qWidth,e.qHeight),i.set(t.qArea.qLeft,t.qArea.qTop,t.qArea.qWidth,t.qArea.qHeight);var r,o,s=n.intersection(i,!0);if(!s)return{qArea:{qTop:e.qTop,qLeft:e.qLeft,qWidth:0,qHeight:0},qData:[]};o=Math.max(0,e.qTop-t.qArea.qTop);var a=t.qData[0],l=a.qSubNodes;r={};for(var c in a)a.hasOwnProperty(c)&&(r[c]="qSubNodes"===c?l.slice(o,o+s.height):a[c]);return r.qUp+=o,r.qDown+=t.qArea.qHeight-s.height-o,{qArea:{qTop:s.y,qLeft:s.x,qWidth:s.width,qHeight:s.height},qData:[r]}}})}),define("objects.backend-api/pivot-cube-slicer",["./cube-slicer","general.utils/shapes/rect"],function(e,t){"use strict";function n(e,t){var n,i={};for(n in e)"qSubNodes"!==n&&e.hasOwnProperty(n)&&(i[n]=e[n]);return t.push(i),i}function i(e,t,r){var s,a,l,c=[],u=[],h=0,d=0;for(r.length&&(h=r[0].qUp||0,d=r[r.length-1].qDown||0),s=0;s<r.length;++s)if((a=r[s]).qSubNodes.length>0&&(u=i(e,t,a.qSubNodes)),l=null,(0===a.qSubNodes.length&&o>=e&&o<=e+t||u.length>0)&&(void 0!==(l=n(a,c)).qUp&&1===c.length&&(l.qUp=h+s),l.qSubNodes=u),0===a.qSubNodes.length&&o++,o===e+t){l&&void 0!==l.qDown&&(l.qDown=d+(r.length-1-s));break}return c}function r(e,t,n){return o=0,i(e,t,n)}var o,s=new t(0,0,0,0),a=new t(0,0,0,0);return e.extend("PivotCubeSlicer",{init:function(){this._super(),this.requestedAreas=[]},getPage:function(e){var n,i,r,o=[];for(i=0;i<this.pages.length;i++)if(n=this.pages[i].qArea,s.set(e.qLeft,e.qTop,e.qWidth,e.qHeight),a.set(n.qLeft,n.qTop,n.qWidth,n.qHeight),r=a.intersection(s,!0),o.push({coverage:r?r.clone():new t(0,0,0,0),idx:i}),n.qLeft<=e.qLeft&&n.qLeft+n.qWidth>=e.qLeft+e.qWidth&&n.qTop<=e.qTop&&n.qTop+n.qHeight>=e.qTop+e.qHeight)return this._extract(e,this.pages[i]);return o.sort(function(e,t){return t.coverage.width*t.coverage.height-e.coverage.width*e.coverage.height}),o[0].coverage.height>0&&o[0].coverage.width>0?this._extract(e,this.pages[o[0].idx]):{qLeft:[],qTop:[],qData:[],qArea:{qTop:e.qTop,qLeft:e.qLeft,qWidth:0,qHeight:0}}},_extract:function(e,t){var n,i;s.set(e.qLeft,e.qTop,e.qWidth,e.qHeight),a.set(t.qArea.qLeft,t.qArea.qTop,t.qArea.qWidth,t.qArea.qHeight);var o,l,c,u=s.intersection(a,!0);return u?(c=Math.max(0,e.qTop-t.qArea.qTop),l=Math.max(0,e.qLeft-t.qArea.qLeft),o=t.qData.slice(c,c+u.height).map(function(e){return e.slice(l,l+u.width)}),n=r(c,u.height,t.qLeft),i=r(l,u.width,t.qTop),{qLeft:n,qTop:i,qData:o,qArea:{qTop:u.y,qLeft:u.x,qWidth:u.width,qHeight:u.height}}):{qLeft:[],qTop:[],qData:[],qArea:{qTop:e.qTop,qLeft:e.qLeft,qWidth:0,qHeight:0}}}})}),define("objects.backend-api/cache-cube",["core.utils/class","util","core.utils/deferred","objects.backend-api/engine-throttle","objects.backend-api/cube-slicer","objects.backend-api/stacked-cube-slicer","objects.backend-api/pivot-cube-slicer"],function(e,t,n,i,r,o,s){var a={mode:"S",enabled:!0,debouncing:{enabled:!0,delay:50},height:250,width:250,maxTotalArea:1e4};return e.extend("CacheCube",{init:function(e,t,n,a){this.model=e,this.responseProperty=t,this.options={},this.cubeHeight=0,this.cubeWidth=0,this.setOptions(a||{}),this.setPath(n),"K"===this.options.mode?this.cube=new o:"P"===this.options.mode?this.cube=new s:this.cube=new r,this.throttle=new i;var l=this;this.throttle.Send.bind(function(e,t){var n=l._getDirections(l.throttle.recentRequests.map(function(e){return{top:e.data[0].qTop,left:e.data[0].qLeft}})),i=l._getAreasToCache(e,n.vertical,n.horizontal);l.cacheData(i,e).then(function(e){l.cube?t.resolve(e):t.reject()},function(){t.reject()})}),this._modelBinding=function(){l.clear()},this.model.Invalidated.bind(this._modelBinding)},destroy:function(){this.cube.destroy(),this.throttle.destroy(),this.model&&this.model.Invalidated&&this.model.Invalidated.unbind(this._modelBinding),this._modelBinding=null,delete this.model,delete this.throttle,delete this.cube},setMethodName:function(e){this.method=e},setPath:function(e){this.path=e},setCubeSize:function(e){this.cubeHeight=e.qcy,this.cubeWidth=e.qcx},setOptions:function(e){e&&(this.options=t.extend(!0,{},a,this.options,e),this.cacheHeight=this.options.height,this.cacheWidth=this.options.width,this.enabled=this.options.enabled||!1,this.debouncing={enabled:this.options.debouncing.enabled||!1,delay:this.options.debouncing.delay||-1})},clear:function(){this.cube.clear(),this.throttle.clear()},set:function(e){this.clear(),e&&e.length&&this.cube.store(e)},cacheData:function(e,t){var n=function(e){return this.cube?(this.cube.store(e),this.cube.get(t)):e};return"getHyperCubeStackData"===this.method&&this.options.maxStackedValues?this.model[this.method](this.path,e,this.options.maxStackedValues).then(n.bind(this)):this.model[this.method](this.path,e).then(n.bind(this))},getData:function(e){if(!this.model)return n.reject();if(!this.enabled||!this.cubeHeight||!this.cubeWidth)return this.model[this.method](this.path,e);var t,i,r=[];for(t=0;t<e.length;++t)i=e[t],r.push({qTop:Math.max(Math.floor(i.qTop),0),qLeft:Math.max(i.qLeft,0),qHeight:Math.min(i.qHeight,this.cubeHeight-Math.floor(i.qTop)),qWidth:Math.min(i.qWidth,this.cubeWidth-i.qLeft)});return this.cube.contains(r)?(this.throttle.updateResolutionTime(),n.resolve(this.cube.get(r))):0===r[0].qTop&&this.cube.isEmpty()&&this.throttle.ongoingRequests.length+this.throttle.queuedRequests.length===0?(this.throttle.updateResolutionTime(),this.cacheData(r,r)):this.throttle.queue(r)},_getDirections:function(e){if(!e||e.length<2)return{vertical:0,horizontal:0};var t=e.slice(-2),n=t[1].top-t[0].top,i=t[1].left-t[0].left;return{vertical:n<0?-1:n>0?1:0,horizontal:i<0?-1:i>0?1:0}},_getAreasToCache:function(e,t,n){var i,r,o,s,a,l,c,u,h,d=[],p=this.cacheHeight;for(void 0===t&&(t=0),void 0===n&&(n=0),this.cacheHeight*this.cacheWidth*e.length>this.options.maxTotalArea&&(p=Math.floor(this.options.maxTotalArea/(e.length*this.cacheWidth))),i=0;i<e.length;++i)s=(r=0!==t?Math.floor(.5*Math.max(0,p-e[i].qHeight)):0)*t-r,a=(o=0!==n?Math.floor(.5*Math.max(0,this.cacheWidth-e[i].qWidth)):0)*n-o,l=0!==t?Math.max(0,Math.min(Math.max(e[i].qHeight,p),this.cubeHeight)):e[i].qHeight,c=0!==n?Math.max(0,Math.min(Math.max(e[i].qWidth,this.cacheWidth),this.cubeWidth)):e[i].qWidth,u=Math.max(0,Math.min(e[i].qTop+s,this.cubeHeight-l)),h=Math.max(0,Math.min(e[i].qLeft+a,this.cubeWidth-c)),d.push({qTop:u,qHeight:l,qLeft:h,qWidth:c});return d}})}),define("objects.backend-api/backend-throttle",["core.utils/class","util","objects.backend-api/engine-throttle"],function(e,t,n){var i={enabled:!0,debouncing:{enabled:!0,delay:50}};return e.extend({init:function(e,t,i){this.model=e,this.responseProperty=t,this.options={},this.setOptions({}),this.setPath(i),this.throttle=new n,this.throttle.Send.bind(function(e,t){r.model[r.method](r.path,e).then(function(e){t.resolve(e)},function(){t.reject()})});var r=this;this._modelBinding=function(){r.clear()},this.model.Invalidated.bind(this._modelBinding)},setMethodName:function(e){this.method=e},setPath:function(e){this.path=e},setOptions:function(e){this.options=t.extend(!0,{},i,this.options,e),this.enabled=this.options.enabled||!1,this.debouncing={enabled:this.options.debouncing.enabled||!1,delay:this.options.debouncing.delay||-1}},clear:function(){this.throttle.clear()},destroy:function(){this.throttle.destroy(),this.model&&this.model.Invalidated&&this.model.Invalidated.unbind(this._modelBinding),this._modelBinding=null,delete this.model,delete this.throttle},set:function(){this.clear()},getData:function(e){return this.enabled?this.throttle.queue(e):this.model[this.method](this.path,e)}})}),define("objects.backend-api/backend-api",["jquery","core.utils/class","core.utils/deferred","./cache-cube","./backend-throttle"],function(e,t,n,i,r){"use strict";return t.extend("BackendApi",{init:function(e,t,n){this.model=e,this.localeInfo=e.app&&e.app.layout?e.app.layout.qLocaleInfo:{},this.path=t,t&&(this.dataPath=t.slice(1,-3)),this.cacheCube=new i(e,"qDataPages",this.path,n),this.backendStackThrottle=new r(e,"qDataPages",this.path)},setPath:function(e){this.path=e,e&&(this.dataPath=e.slice(1,-3)),this.cacheCube.setPath(e),this.backendStackThrottle.setPath(e)},setCacheOptions:function(e){this.cacheCube.setOptions(e)},updateCache:function(){},applyPatches:function(e,t){return this.model.applyPatches(e,t)},clearSoftProperties:function(){var e=this;return this.model.getLayout().then(function(t){return t.qHasSoftPatches?e.model.clearSoftPatches():n.resolve()})},beginSelections:function(){return this.model.app.switchModalSelection(this.model,this.path)},endSelections:function(e){return this.model.app.switchModalSelection(null,null,e)},clearSelections:function(e){return e=e||0,this.model.clearSelections(this.path,[e])},getDimensionInfos:function(){return this.model.layout[this.dataPath].qDimensionInfo?Array.isArray(this.model.layout[this.dataPath].qDimensionInfo)?this.model.layout[this.dataPath].qDimensionInfo:[this.model.layout[this.dataPath].qDimensionInfo]:[]},getMeasureInfos:function(){return this.model.layout[this.dataPath].qMeasureInfo},getRowCount:function(){return this.model.layout[this.dataPath].qSize.qcy},eachDataRow:function(t){var n=this.model.layout[this.dataPath],i=!0;n&&e.each(n.qDataPages,function(n,r){return e.each(r.qMatrix,function(e,n){return i=t(r.qArea.qTop+e,n)}),i})},drillUp:function(e,t){return this.model.drillUp(this.path,e,t)},hasSelections:function(){for(var e=this.getDimensionInfos(),t=0;t<e.length;++t)if(e[t].qStateCounts.qSelected>0)return!0;return!1},inSelections:function(){return this.model.layout.qSelectionInfo&&this.model.layout.qSelectionInfo.qInSelections},destroy:function(){this.cacheCube.destroy(),this.backendStackThrottle.destroy()},getSize:function(){return this.model.layout[this.dataPath].qSize}})}),define("client.utils/property-resolver",["util"],function(e){function t(e){return"object"==typeof e.items&&"array"!==e.type&&("items"===e.type||"items"===e.component||"expandable-items"===e.component||"accordion"===e.component||!e.type&&!e.component)}function n(e,t){if("function"==typeof t.defaultValue)return t.defaultValue();if(void 0!==t.defaultValue)return t.defaultValue;if(Array.isArray(t.options))return t.options[0].value;switch(e){case"array":return[];case"string":return"";case"integer":case"number":return 0;case"boolean":return!1;default:return null}}return{getValue:e.getValue,setValue:e.setValue,getTypeValue:function(e,t,n){if("string"!=typeof t)return t;switch(e){case"integer":t=parseInt(t,10),isNaN(t)&&(t=n);break;case"number":t=parseFloat(t),isNaN(t)&&(t=n);break;case"boolean":t="true"===t}return t},getDefaultValue:n,getDefaults:function(i){function r(i){var s,a,l;if(!i.schemaIgnore)if(t(i))for(s=Object.keys(i.items),l=0;l<s.length;l++)(a=i.items[s[l]])&&r(a);else i.ref&&!i.schemaIgnore&&e.setValue(o,i.ref,n(i.type,i))}var o={};return"array"===i.type&&i.items?(o={},r({type:"items",items:i.items})):r(i),o},isHierarchical:t,getUndefinedValue:function(e,t){return void 0!==t.undefinedValue?t.undefinedValue:n(e,t)}}}),define("objects.backend-api/snapshot-api",["./backend-api","core.utils/deferred","objects.backend-api/cube-slicer","objects.backend-api/pivot-cube-slicer","client.utils/property-resolver"],function(e,t,n,i,r){"use strict";function o(e,t,n,i){if(e){t.snapshotData.object.origDataPages||(t.snapshotData.object.origDataPages=t.qHyperCube[i]);for(var r=0;r<n.length;r++)n[r].qHeight=Math.min(t.qHyperCube.qSize.qcy,n[r].qHeight),n[r].qTop=t.snapshotData.object.origDataPages[r].qArea.qTop;t.qHyperCube[i]=e.get(n)}}function s(e){if("pivot-table"===e.visualization)this.responseProperty="qPivotDataPages",this.slicer=new i;else{if("table"!==e.visualization)return;this.slicer=new n}e.snapshotData.object.origDataPages?this.slicer.store(e.snapshotData.object.origDataPages):this.slicer.store(e.qHyperCube[this.responseProperty])}return e.extend("SnapshotAPI",{init:function(e){this.responseProperty="qDataPages",s.call(this,e.layout),this._super(e,e.layout.qListObject?"/qListObjectDef":"/qHyperCubeDef")},getData:function(e){var n=t();if("map"===this.model.layout.visualization){var i=this.dataPath.split("/")[1],s=this.dataPath.split("/"),a=s[s.length-1];"polygon"===this.model.layout.layers[i].type&&"3"===this.model.layout.layers[i].version?n.resolve(this.model.layout.layers[i].geodata.qHyperCube[this.responseProperty]):n.resolve(this.model.layout.layers[i][a][this.responseProperty])}else{o(this.slicer,this.model.layout,e,this.responseProperty);var l=r.getValue(this.model.layout,(this.dataPath+"/"+this.responseProperty).replace(new RegExp("/","g"),"."));n.resolve(l)}return n.promise},getHyperCubeBinnedData:function(){return t.resolve(this.model.layout.dataPages)},getHyperCubeContinousData:function(){return t.resolve({qDataPages:this.model.layout.qHyperCube.qDataPages,qAxisData:this.model.layout.qHyperCube.qAxisData})},getSize:function(){return r.getValue(this.model.layout,this.dataPath.replace(new RegExp("/","g"),".")).qSize},beginSelections:function(){},endSelections:function(){},clearSelections:function(){},isSnapshot:!0})}),define("apis/qfieldvalue",[],function(){"use strict";function e(e,t){Object.defineProperties(this,{qText:{value:e.qText},qElemNumber:{value:e.qElemNumber},qState:{value:e.qState},field:{value:t}}),isNaN(e.qNum)||Object.defineProperties(this,{qNum:{value:e.qNum}}),e.qFrequency&&Object.defineProperties(this,{qFrequency:{value:e.qFrequency}})}return e.prototype.select=function(e,t){return this.field.select([this.qElemNumber],e||!1,t||!1)},e}),define("apis/qfield",["core.utils/deferred","core.utils/notification","apis/qfieldvalue"],function(e,t,n){"use strict";function i(t,n,i,r,o,s,a){return t.waitFor?t.waitFor.then(function(){return t.field[n].apply(t.field,[i,r,o,s,a].filter(function(e){return void 0!==e}))}):e.resolve()}function r(n,i,r){var o=this;if(o.qapp=n,o.fldname=i,o.statename=r,o.rows=[],o.qapp.model.session){t.create(o,"OnData");var s=new e;o.waitFor=s.promise,o.qapp.model.waitForOpen.promise.then(function(){(n.model.enigmaModel||n.model).getField(i,r||"$").then(function(e){o.field=e,s.resolve()})})}}return r.prototype.clear=function(){return i(this,"clear")},r.prototype.lock=function(){return i(this,"lock")},r.prototype.unlock=function(){return i(this,"unlock")},r.prototype.clearOther=function(e){return i(this,"clearAllButThis",e||!1)},r.prototype.selectAll=function(e){return i(this,"selectAll",e||!1)},r.prototype.selectExcluded=function(e){return i(this,"selectExcluded",e||!1)},r.prototype.selectAlternative=function(e){return i(this,"selectAlternative",e||!1)},r.prototype.selectPossible=function(e){return i(this,"selectPossible",e||!1)},r.prototype.toggleSelect=function(e,t){return i(this,"toggleSelect",e,t||!1)},r.prototype.selectMatch=function(e,t){return i(this,"select",e,t||!1)},r.prototype.select=function(e,t,n){return i(this,"lowLevelSelect",e,t||!1,n||!1)},r.prototype.selectValues=function(e,t,n){var r=[];return e.forEach(function(e){"number"==typeof e?r.push({qIsNumeric:!0,qNumber:e}):"string"==typeof e?r.push({qText:e}):r.push(e)}),i(this,"selectValues",r,t||!1,n||!1)},r.prototype.getData=function(e){if(this.requestActive)return this;this.requestActive=!0;var t=this,i=function(){t.qapp.createGenericObject({qListObjectDef:{qStateName:t.statename?t.statename:"$",qDef:{qFieldDefs:[t.fldname]},qFrequencyMode:e&&e.freq||"V",qInitialDataFetch:[{qTop:0,qLeft:0,qHeight:e&&e.rows||200,qWidth:1}]}},function(e){t.rows.length=0,e.qListObject.qDataPages.forEach(function(e){e.qMatrix.forEach(function(e){t.rows.push(new n(e[0],t))})}),t.rowCount=e.qListObject.qDimensionInfo.qCardinal,t.stateCounts=e.qListObject.qDimensionInfo.qStateCounts,t.requestActive=!1,t.genericObject&&t.OnData.emit()}).then(function(e){t.genericObject=e,t.OnData.emit()})};return this.genericObject?this.genericObject.close().then(function(){delete t.genericObject,i()}):i(),this},r.prototype.getMoreData=function(){if(this.requestActive)return this;if(this.rowCount<=this.rows.length)return this;this.requestActive=!0;var e=this,t={qTop:this.rows.length,qLeft:0,qWidth:1,qHeight:50};return e.genericObject?e.genericObject.getListObjectData("/qListObjectDef",[t]).then(function(t){t[0].qMatrix.forEach(function(t){e.rows.push(new n(t[0],e))}),e.requestActive=!1,e.OnData.emit()}):e.requestActive=!1,this},r}),define("apis/qbookmark",["client.models/bookmark","client.models/current-selections"],function(e,t){"use strict";function n(e){this.app=e}return n.prototype.create=function(n,i,r){var o=this;return o.app.waitForOpen.promise.then(function(){return t.get(o.app).then(function(t){return t.getLayout().then(function(){var s,a=t.layout.qSelectionObject?t.layout.qSelectionObject.qSelections:null,l={currentSelectFields:[],currentSelectCount:0};if(a&&a.length>0)for(l.currentSelectCount=a.length,s=0;s<a.length;s++)l.currentSelectFields.push(a[s].qField);var c="";for(s=0;s<l.currentSelectCount;s++)s>0&&(c+=", "),c+=l.currentSelectFields[s];var u={qMetaDef:{title:n,description:i},selectionFields:c};return r&&(u.sheetId=r),e.create(u,o.app)})})})},n.prototype.apply=function(t){var n=this;return n.app.waitForOpen.promise.then(function(){return e.apply(t,n.app)})},n.prototype.remove=function(t){var n=this;return n.app.waitForOpen.promise.then(function(){return e.remove(t,n.app)})},n}),define("apis/qvariable",[],function(){"use strict";function e(e){return e.waitForOpen.promise.then(function(){return e.enigmaModel})}function t(e,t){this.app=e,this.qapp=t}function n(e){var t="string"==typeof e?{qName:e}:e;return t.qInfo=t.qInfo||{},t.qInfo.qType=t.qInfo.qType||"variable",t}return t.prototype.create=function(t){var i=n(t);return e(this.app).then(function(e){return e.createVariableEx(i)})},t.prototype.createSessionVariable=function(t){var i=n(t);return e(this.app).then(function(e){return e.createSessionVariable(i)})},t.prototype.get=function(t){return e(this.app).then(function(e){return e.getVariableById(t)})},t.prototype.getByName=function(t){return e(this.app).then(function(e){return e.getVariableByName(t)})},t.prototype.setStringValue=function(t,n){return e(this.app).then(function(e){return e.getVariableByName(t)}).then(function(e){return e.setStringValue(n).then(function(){return e.getLayout()})})},t.prototype.setNumValue=function(t,n){return e(this.app).then(function(e){return e.getVariableByName(t)}).then(function(e){return e.setNumValue(n).then(function(){return e.getLayout()})})},t.prototype.setContent=function(e,t){return this.setStringValue(e,t+"")},t.prototype.getContent=function(e,t){var n=this.qapp,i=t?function(e){t(e,n)}:function(){};return this.getByName(e).then(function(e){return e?e.getLayout().then(function(e){var t={qContent:{qString:e.qText,qIsNum:!isNaN(e.qNum)}};return i(t,n),t}):e})},t}),define("general.utils/touch-configuration-util",["jquery","general.utils/support"],function(e,t){"use strict";return{configureTouchSupport:function(){e(document.body.parentElement).addClass("touch-"+(t.treatAsDesktop()?"off":"on"))}}}),define("client.property-panel/default-sorting-properties",[],function(){return{type:"array",component:"sorting",translation:"properties.sorting",sortIndexRef:"qHyperCubeDef.qInterColumnSortOrder",allowMove:!0,schemaIgnore:!0,items:{dimensions:{type:"items",component:"expandable-items",ref:"qHyperCubeDef.qDimensions",items:{autoSort:{ref:"qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(e,t){if(e.qDef.autoSort)return t.autoSortDimension(e).then(function(){})}},dimension:{component:"sorting-dimension",type:"items",ref:"",sortingItems:{expression:!0,frequency:!1,numeric:!0,ascii:!0}}}},measures:{type:"items",component:"expandable-items",grouped:!0,ref:"qHyperCubeDef.qMeasures",items:{autoSort:{ref:"qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(e,t){if(e.qDef.autoSort)return t.autoSortMeasure(e).then(function(){})}},measure:{component:"sorting-measure",ref:"",sortingItems:{numeric:!0,ascii:!0}}}}}}}),define("objects.views/charts/utils/time-utils",[],function(){return{hasTimeTag:function(e){return e&&e.qTags&&e.qTags.some(function(e){return["$date","$timestamp","$time"].indexOf(e)>=0})},isTimeDimension:function(e,t){return!(!t||!e)&&(!!this.hasTimeTag(t)||t.qNumFormat&&["D","TS","T"].contains(t.qNumFormat.qType))},maxNumberOfLines:12}}),define("objects.utils/continuous-utils",["objects.views/charts/utils/time-utils"],function(e){return{isContinuousChart:function(t){if(!t.qHyperCube)return!1;var n=this.canBeContinuousChart(t),i=e.isTimeDimension(n,t.qHyperCube.qDimensionInfo[0]);return t.dimensionAxis&&t.dimensionAxis.continuousAuto?i&&"linechart"===t.visualization:n&&t.preferContinuousAxis},canBeContinuousChart:function(e){if(!e.qHyperCube||e.qHyperCube.qDimensionInfo.length<1)return!1;var t=e.qHyperCube.qDimensionInfo[0].qTags||[];return e.qHyperCube.qDimensionInfo[0].qContinuousAxes&&t.indexOf("$numeric")>=0}}}),define("client.property-panel/default-axis-properties-logic",["translator","objects.utils/continuous-utils","client.utils/property-resolver"],function(e,t,n){function i(e){return!(e&&e.orientation&&!t.isContinuousChart(e))||"vertical"===e.orientation}function r(e,t){return t?t.getDimensionLayouts():e&&e.qHyperCubeDef?e.qHyperCubeDef.qDimensions.map(function(e){return e.qDef}):[]}var o="qHyperCubeDef",s={left:"properties.dock.left",right:"properties.dock.right",bottom:"Common.Bottom",top:"Common.Top"};return{isVertical:i,getDimensions:r,getMeasures:function(e,t){return t?t.getMeasureLayouts():e.qHyperCubeDef.qMeasures.map(function(e){return e.qDef})},dimensionAxisLabelFn:function(t,n){var o="y",s=r(t,n).map(function(e){return e&&e.qFallbackTitle?e.qFallbackTitle:""}).join(", ");return i(n&&n.layout)&&(o="x"),s?e.get("properties."+o+"AxisWithInfo",[s]):e.get("properties."+o+"Axis")},getAxisDockProperties:function(e,t){return{ref:e+".dock",translation:"Common.Position",type:"string",component:"dropdown",defaultValue:"near",options:function(e,n,r){var o,a,l;if(t&&t.direction)l=t.direction;else{var c=i(r.layout);l=c&&t&&!t.major||!c&&t&&t.major?"y":"x"}return"x"===l?(o=s.bottom,a=s.top):(o=r.yMirrorMode?s.right:s.left,a=r.yMirrorMode?s.left:s.right),[{value:"near",translation:o},{value:"far",translation:a}]},show:function(t){return t[e]&&"none"!==t[e].show}}},dockStringMap:s,isFirstDimension:function(e,t,i){return i=i||o,n.getValue(t.properties,i+".qDimensions",[])[0]===e}}}),define("client.property-panel/default-axis-properties",["translator","objects.utils/continuous-utils","client.property-panel/default-axis-properties-logic"],function(e,t,n){var i={type:"items",items:{autoMinMax:{ref:"measureAxis.autoMinMax",type:"boolean",translation:"properties.axis.range",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},minMax:{type:"string",component:"dropdown",ref:"measureAxis.minMax",options:[{translation:"properties.axis.min",value:"min"},{translation:"Common.Max",value:"max"},{translation:"properties.axis.minMax",value:"minMax"}],defaultValue:"min",show:function(e){return e.measureAxis&&!e.measureAxis.autoMinMax}},min:{ref:"measureAxis.min",translation:"properties.axis.min",expression:"optional",type:"number",show:function(e){return e.measureAxis&&["min","minMax"].contains(e.measureAxis.minMax)&&!e.measureAxis.autoMinMax},invalid:function(e){return!(!e.measureAxis||"minMax"!==e.measureAxis.minMax)&&e.measureAxis.min>=e.measureAxis.max}},max:{ref:"measureAxis.max",translation:"Common.Max",expression:"optional",type:"number",defaultValue:10,show:function(e){return e.measureAxis&&["max","minMax"].contains(e.measureAxis.minMax)&&!e.measureAxis.autoMinMax},invalid:function(e){return!(!e.measureAxis||"minMax"!==e.measureAxis.minMax)&&e.measureAxis.min>=e.measureAxis.max}}}},r=[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],o=[{value:2,translation:"properties.gridLine.wide"},{value:1,translation:"properties.gridLine.medium"},{value:.5,translation:"properties.gridLine.narrow"}],s={type:"items",items:{show:{type:"string",component:"dropdown",ref:"dimensionAxis.show",translation:"properties.axis.labelsAndTitle",options:r,defaultValue:"all",snapshot:{title:function(t){return e.get("properties."+this.getXYAxis(t)+"Axis")},getXYAxis:function(e){return n.isVertical(e)?"x":"y"},group:!1,tid:function(e){return"property-"+this.getXYAxis(e)+"Axis"}}},label:{type:"string",component:"dropdown",ref:"dimensionAxis.label",translation:"properties.axis.labelOrientation",options:[{value:"auto",translation:"Common.Auto"},{value:"horizontal",translation:"Common.Horizontal"},{value:"tilted",translation:"properties.labels.tilted"}],defaultValue:"auto",show:function(e,i,r){return n.isVertical(r.layout)&&e.dimensionAxis&&["all","labels"].contains(e.dimensionAxis.show)&&!t.isContinuousChart(r.layout)}},dock:n.getAxisDockProperties("dimensionAxis",{major:!0})}};return{measureAxis:{type:"items",label:e.get("properties.yAxis"),grouped:!0,items:{axis:{type:"items",items:{show:{type:"string",component:"dropdown",ref:"measureAxis.show",translation:"properties.axis.labelsAndTitle",options:r,defaultValue:"all"},dock:n.getAxisDockProperties("measureAxis"),spacing:{ref:"measureAxis.spacing",translation:"properties.axis.scale",type:"number",component:"dropdown",defaultValue:1,options:o,show:function(e){return e.measureAxis&&"none"!==e.measureAxis.show}}}},minMax:i}},flippableMeasureAxis:{uses:"axis.measureAxis",label:function(t,i){var r="x",o=n.getMeasures(t,i).map(function(e){return e.qFallbackTitle}).join(", ");return n.isVertical(i.layout)&&(r="y"),o?e.get("properties."+r+"AxisWithInfo",[o]):e.get("properties."+r+"Axis")},items:{axis:{type:"items",items:{show:{snapshot:{title:function(t){return e.get("properties."+this.getXYAxis(t)+"Axis")},getXYAxis:function(e){return n.isVertical(e)?"y":"x"},group:!1,tid:function(e){return"property-"+this.getXYAxis(e)+"Axis"}}},dock:{options:function(e,t,i){var r,o;return n.isVertical(t.layout)?(r=i.yMirrorMode?"properties.dock.right":"properties.dock.left",o=i.yMirrorMode?"properties.dock.left":"properties.dock.right"):(r="Common.Bottom",o="Common.Top"),[{value:"near",translation:r},{value:"far",translation:o}]}}}}}},dimensionAxis:{type:"items",label:n.dimensionAxisLabelFn,grouped:!0,items:{continuousGroup:{type:"items",items:{auto:{ref:"dimensionAxis.continuousAuto",translation:"properties.axis.continuous",type:"boolean",component:"switch",defaultValue:!0,undefinedValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},preferContinuous:{type:"boolean",ref:"preferContinuousAxis",translation:"properties.axis.preferContinuous",defaultValue:!0,undefinedValue:!1,show:function(e){return!e.dimensionAxis.continuousAuto},readOnly:function(e,n,i){return!t.canBeContinuousChart(i.layout)}}}},othersGroup:s}},picasso:{dimensionAxis:{type:"items",label:n.dimensionAxisLabelFn,items:{othersGroup:s}},measureAxis:{type:"items",uses:"axis.flippableMeasureAxis"}}}}),define("general.utils/number-formatting",["util"],function(e){function t(e,t,n,i,r){void 0===n&&(n=r.qDecimalSep),void 0===i&&(i=r.qThousandSep);var o,s,a="";if("F"===e)if(0===t)a="#"+i+"##0";else for(a="#"+i+"##0"+n,o=0;o<t;++o)a+="0";else{for(o=0;o<t;++o)a+="#";t>3&&(s=a.length,a=a.substring(0,s-3)+i+a.substr(s-3))}return a}return{setNumFmtPattern:function(e,t,n){var i,r={type:t.qType||"U",nDec:"qType"===e?(t.qType,2):"R"===t.qType?t.qnDec||10:"number"==typeof t.qnDec?Math.max(0,t.qnDec):2,thousandSep:t.qThou,decimalSep:t.qDec};void 0!==(i=this._getSeparators(e,"M"===t.qType,r.decimalSep,r.thousandSep,n)).decimal&&(r.decimalSep=i.decimal),void 0!==i.thousand&&(r.thousandSep=i.thousand),t.qType=r.type,t.qnDec=r.nDec,t.qDec=r.decimalSep,t.qThou=r.thousandSep,t.qFmt=this._getPattern(r.type,r.nDec,r.decimalSep,r.thousandSep,n),["D","T","TS","IV"].indexOf(r.type)>=0&&(t.qDec="",t.qThou="")},_getSeparators:function(e,t,n,i,r){var o=n,s=i,a="q"+(t?"Money":"");return"qType"===e?(s=r[a+"ThousandSep"]||"",o=r[a+"DecimalSep"]||"."):"qThou"===e&&void 0===i?(s=r[a+"ThousandSep"]||"",o=n||"."):"qDec"!==e||void 0!==n&&""!==n||(o=r[a+"DecimalSep"]||".",s=i||""),{decimal:o||".",thousand:s||""}},_getPattern:function(t,n,i,r,o){var s;switch(t){case"U":return"";case"I":return"#"+r+"##0";case"R":case"F":return this.getNDecPattern("F",n,i,r,o);case"M":return s=o.qMoneyFmt,o.qMoneyDecimalSep&&(s=s.replace(new RegExp(e.escapeRegExp(o.qMoneyDecimalSep),"g"),i)),o.qMoneyThousandSep&&(s=s.replace(new RegExp(e.escapeRegExp(o.qMoneyThousandSep),"g"),r)),s;case"D":return o.qDateFmt;case"T":return o.qTimeFmt;case"TS":return o.qTimestampFmt;case"IV":return"h:mm:ss";default:return""}},getDefaultNumericFormat:function(e,n){return t("F",2,e.qDec,e.qThou||"",n)},getNDecPattern:t,getNormalizedFormat:function(e,t){var n=e.qDec+e.qThou;return/\u00a0/.test(n)&&!/\u0020/.test(n)?t.replace(/\u0020/g,""):t}}}),define("client.models/app-generic-properties",["util","core.utils/deferred","core.models/app","core.models/communication"],function(e,t,n,i){"use strict";function r(e){return(e=e||n.current)?t.resolve(e.enigmaModel):i.getApp()}var o={},s={},a={qInfo:{qType:"appprops"},sheetTitleBgColor:"",sheetTitleGradientColor:"",sheetTitleColor:"",sheetLogoThumbnail:{qStaticContentUrlDef:null},sheetLogoPosition:"",rtl:!1,theme:"sense"},l={qInfo:{qId:"AppPropsList",qType:"AppPropsList"},qAppObjectListDef:{qType:"appprops",qData:{sheetTitleBgColor:"/sheetTitleBgColor",sheetTitleGradientColor:"/sheetTitleGradientColor",sheetTitleColor:"/sheetTitleColor",sheetLogoThumbnail:"/sheetLogoThumbnail",sheetLogoPosition:"/sheetLogoPosition",rtl:"/rtl",theme:"/theme"}}};return s.create=function(t,n){return r(n).then(function(n){var i=e.extend(!0,{},a,t);return n.createObject(i)})},s.get=function(e,t){return r(t).then(function(t){return t.getObject(e)})},s.getList=function(e){return r(e).then(function(e){return o[e.id]=o[e.id]||e.getListObject(l)})},s}),define("client.models/app-generic-props-wrapper",["client.models/app-generic-properties","core.utils/notification","core.utils/deferred","util"],function(e,t,n,i){"use strict";function r(t){u=t,e.get(u).then(function(e){e.Invalidated.bind(o)})}function o(){var e;l().then(function(t){e=t,c.UpdateObjProps.emit(e)})}function s(){return e.getList().then(function(t){return t.getLayout().then(function(t){return t&&t.length?r(t[0].qInfo.qId):d?e.create({}).then(function(e){return e.getLayout().then(function(){return r(e.id)})}):((h=new n).resolve(),h.promise)})})}function a(t,n){return e.get(t).then(function(e){e.getProperties().then(function(t){var r={};r=i.extend(!0,t,n),e.setProperties(r)})})}function l(){return u?e.get(u).then(function(e){return e.getLayout()}):((h=new n).resolve({}),h.promise)}var c={},u=null,h=null,d=!1;return t.mixin(c),c.notification("UpdateObjProps"),c.setProperties=function(e){u?(d=!1,a(u,e)):(d=!0,s().then(function(){a(u,e)}))},c.getProperties=function(){return u?l():(d=!1,s().then(l))},c}),define("client.utils/theme/theme",["jquery","util","translator","core.utils/deferred","core.utils/notification","client.models/app-generic-props-wrapper","text!themes/old/sense/theme.json","core.utils/feature-flags"],function(e,t,n,i,r,o,s,a){"use strict";function l(e,t){var n=document.createElement("link");return n.setAttribute("rel","stylesheet"),n.setAttribute("href",requirejs.toUrl("themes/old/"+e+"/"+(t||"theme.css"))),document.head.appendChild(n),n}function c(e,n,i){try{e=JSON.parse(e)}catch(t){console.warn("Theme parsing error for theme: "+i+": "+t),e={}}t.extend(!0,b,p,e),n&&y.forEach(function(n){var i=t.getValue(e,n);void 0!==i&&t.setValue(b,n,i)}),g=[],e.customStyles&&e.customStyles.length&&e.customStyles.forEach(function(e){g.push({node:l(i,e.cssRef),cssClass:e.classRef}),u(e.classRef,!0)}),v=e}function u(t,n){e(".qv-client").toggleClass(t,n)}function h(){m.parentNode.removeChild(m),g.forEach(function(e){e.node.parentNode.removeChild(e.node),u(e.cssClass,!1)}),Object.keys(v).forEach(function(e){delete b[e]})}var d,p=JSON.parse(s),f=null,m=null,g=[],v={},y=["palette","colorSchemes.qualitativeScales","colorSchemes.ordinalScales"],b={};r.create(b,"ThemeChanged"),b.getAvailableThemes=function(){return i.resolve({default:[{id:"sense",name:n.get("Themes.Qlik.Classic")},{id:"card",name:n.get("Themes.Qlik.Standard")}]})},Object.defineProperty(b,"name",{iterable:!1,get:function(){return f||"sense"}}),b.getCurrentTheme=function(){return b.name},b.applyTheme=function(e){return!e||e.indexOf("/")>-1?i.resolve(!1):e===f?i.resolve(!1):(d=new i,requirejs(["text!themes/old/"+e+"/theme.json"],function(t){f&&h(),m=l(e),c(t,!0,e),b.ThemeChanged.emit(),f=e,d.resolve(!0)},function(t){console.warn("Failed to load theme: "+e+": "+t.message),d.resolve(!1)}),d.promise)},b.saveTheme=function(){o.setProperties({theme:b.getCurrentTheme()})},Object.defineProperty(b,"currentPalette",{iterable:!1,get:function(){var e=this.extendedPalette.slice();return"none"!==e[0]&&e.unshift("none"),e||[]}}),Object.defineProperty(b,"scales",{iterable:!1,get:function(){return this.colorSchemes?this.colorSchemes.ordinalScales||[]:[]}}),Object.defineProperty(b,"dataPalettes",{iterable:!1,get:function(){return this.colorSchemes?this.colorSchemes.qualitativeScales||[]:[]}}),Object.defineProperty(b,"dataColors",{iterable:!1,get:function(){return this.colorSchemes||{}}}),Object.defineProperty(b,"deprecatedPalette",{iterable:!1,get:function(){return x}}),Object.defineProperty(b,"smallPalette",{iterable:!1,get:function(){return x}});var x=["#b0afae","#7b7a78","#545352","#4477aa","#7db8da","#b6d7ea","#46c646","#f93f17","#ffcf02","#276e27","#ffffff","#000000"];return b.resolveColor=function(e,t){return t=t||b.currentPalette,void 0!==e&&null!==e?void 0!==e.index&&-1!==e.index&&t[e.index]?t[e.index]:void 0!==e.color?e.color?e.color:"none":x[e]?x[e]:e||"none":"none"},b.mapIndex=function(e,t,n){n=n||b.currentPalette;var i=t?n:x;return-1!==(e=(t?x:n).indexOf(i[e]))?e:t?3:6},b.getPaletteScale=function(e,t){var n,i=this.dataPalettes;if(i.some(function(t){return t.propertyValue.toLowerCase()===e.toLowerCase()&&(n=t,!0)}),n||(n=i[0]),"pyramid"===n.type){t=t||n.scale.length;var r=Math.max(Math.min(n.scale.length-1,t-1)%n.scale.length,0);return n.scale[r]}return n.scale},a.THEMING||(l("sense"),c(s)),b}),define("text!assets/external/sense-themes-default/sense/theme.json",[],function(){return'{\n\t"_variables": {\n\t\t"@B20": "#333333",\n\t\t"@B35": "#595959",\n\t\t"@B45": "#737373",\n\t\t"@B50": "#808080",\n\t\t"@B60": "#999999",\n\t\t"@B80": "#cccccc",\n\t\t"@B90": "#e6e6e6",\n\t\t"@B98": "#fbfbfb",\n\t\t"@B100": "#ffffff",\n\t\t"@H1": "24px",\n\t\t"@H2": "18px",\n\t\t"@H3": "14px",\n\t\t"@H4": "13px",\n\t\t"@H5": "12px",\n\t\t"@H6": "10px"\n\t},\n\t"color": "@B35",\n\t"fontSize": "13px",\n\t"backgroundColor": "transparent",\n\t"object": {\n\t\t"line": {\n\t\t\t"highContrast": {\n\t\t\t\t"color": "@B60"\n\t\t\t},\n\t\t\t"major": {\n\t\t\t\t"color": "@B80"\n\t\t\t},\n\t\t\t"minor": {\n\t\t\t\t"color": "@B90"\n\t\t\t}\n\t\t},\n\t\t"title": {\n\t\t\t"main": {\n\t\t\t\t"color": "@B50",\n\t\t\t\t"fontSize": "15px"\n\t\t\t},\n\t\t\t"subTitle": {\n\t\t\t\t"color": "@B50",\n\t\t\t\t"fontSize": "12px"\n\t\t\t},\n\t\t\t"footer": {\n\t\t\t\t"color": "@B50",\n\t\t\t\t"fontSize": "12px",\n\t\t\t\t"backgroundColor": "transparent"\n\t\t\t}\n\t\t},\n\t\t"label": {\n\t\t\t"name": {\n\t\t\t\t"color": "@B20",\n\t\t\t\t"fontSize": "13px"\n\t\t\t},\n\t\t\t"value": {\n\t\t\t\t"color": "@B20",\n\t\t\t\t"fontSize": "13px"\n\t\t\t}\n\t\t},\n\t\t"axis": {\n\t\t\t"title": {\n\t\t\t\t"fontSize": "12px",\n\t\t\t\t"color": "@B20"\n\t\t\t},\n\t\t\t"label": {\n\t\t\t\t"name": {\n\t\t\t\t\t"color": "@B35",\n\t\t\t\t\t"fontSize": "12px"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"line": {\n\t\t\t\t"major": {\n\t\t\t\t\t"color": "@B80"\n\t\t\t\t},\n\t\t\t\t"minor": {\n\t\t\t\t\t"color": "@B90"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t"grid": {\n\t\t\t"line": {\n\t\t\t\t"highContrast": {\n\t\t\t\t\t"color": "@B60"\n\t\t\t\t},\n\t\t\t\t"major": {\n\t\t\t\t\t"color": "@B80"\n\t\t\t\t},\n\t\t\t\t"minor": {\n\t\t\t\t\t"color": "@B90"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t"referenceLine": {\n\t\t\t"label": {\n\t\t\t\t"name": {\n\t\t\t\t\t"color": "@B20",\n\t\t\t\t\t"fontSize": "12px"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"outOfBounds": {\n\t\t\t\t"color": "@B90",\n\t\t\t\t"backgroundColor": "@B45",\n\t\t\t\t"fontSize": "@H6"\n\t\t\t}\n\t\t},\n\t\t"legend": {\n\t\t\t"title": {\n\t\t\t\t"fontSize": "15px",\n\t\t\t\t"color": "@B20"\n\t\t\t},\n\t\t\t"label": {\n\t\t\t\t"fontSize": "13px",\n\t\t\t\t"color": "@B35"\n\t\t\t}\n\t\t},\n\t\t"barChart": {\n\t\t\t"outOfRange": {\n\t\t\t\t"color": "@B60"\n\t\t\t},\n\t\t\t"label": {\n\t\t\t\t"value": {\n\t\t\t\t\t"color": "@B35",\n\t\t\t\t\t"fontSize": "11px"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t"gauge": {\n\t\t\t"label": {\n\t\t\t\t"value": {\n\t\t\t\t\t"color": "@B20",\n\t\t\t\t\t"fontSize": "42px"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t"treemap": {\n\t\t\t"branch": {\n\t\t\t\t"backgroundColor": ".alpha(5)",\n\t\t\t\t"label": {\n\t\t\t\t\t"color": ".inherit()",\n\t\t\t\t\t"fontSize": "14px"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"leaf": {\n\t\t\t\t"label": {\n\t\t\t\t\t"fontSize": "12px"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t"scatterPlot": {\n\t\t\t"label": {\n\t\t\t\t"value": {\n\t\t\t\t\t"color": "@B35",\n\t\t\t\t\t"fontSize": "12px"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t"lineChart": {\n\t\t\t"outOfRange": {\n\t\t\t\t"color": "@B60"\n\t\t\t},\n\t\t\t"label": {\n\t\t\t\t"value": {\n\t\t\t\t\t"color": "@B35",\n\t\t\t\t\t"fontSize": "12px"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t"pieChart": {\n\t\t\t"axis": {\n\t\t\t\t"title": {\n\t\t\t\t\t"fontSize": "12px"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"label": {\n\t\t\t\t"name": {\n\t\t\t\t\t"color": "@B20",\n\t\t\t\t\t"fontSize": "14px"\n\t\t\t\t},\n\t\t\t\t"value": {\n\t\t\t\t\t"fontSize": "12px"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t"straightTable" : {\n\t\t\t"header" : {\n\t\t\t\t"fontSize" : "@H4",\n\t\t\t\t"color": "@B35"\n\t\t\t},\n\t\t\t"content": {\n\t\t\t\t"fontSize": "@H4",\n\t\t\t\t"color": "@B35"\n\t\t\t}\n\t\t},\n\t\t"listBox": {\n\t\t\t"title": {\n\t\t\t\t"main": {\n\t\t\t\t\t"color": "@B35",\n\t\t\t\t\t"fontSize": "13px"\n\t\t\t\t}\n\t\t\t},\n\t\t\t"content": {\n\t\t\t\t"color": "@B35",\n\t\t\t\t"fontSize": "12px"\n\t\t\t}\n\t\t},\n\t\t"boxPlot": {\n\t\t\t"box": {\n\t\t\t\t"whisker": {\n\t\t\t\t\t"stroke": "@B35"\n\t\t\t\t},\n\t\t\t\t"line": {\n\t\t\t\t\t"stroke": "@B35"\n\t\t\t\t},\n\t\t\t\t"box": {\n\t\t\t\t\t"fill": "@B90",\n\t\t\t\t\t"stroke": "@B35"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t"distributionPlot": {\n\t\t\t"box": {\n\t\t\t\t"fill": "@B90"\n\t\t\t}\n\t\t},\n\t\t"histogram": {\n\t\t  "label": {\n\t\t\t"value": {\n\t\t\t  "color": "@B35",\n\t\t\t  "fontSize": "12px"\n\t\t\t}\n\t\t  }\n\t\t},\n\t\t"waterfallChart": {\n\t\t  "label": {\n\t\t\t"value": {\n\t\t\t  "color": "@B35",\n\t\t\t  "fontSize": "12px"\n\t\t\t}\n\t\t  },\n\t\t  "value": {\n\t\t\t"color": {\n\t\t\t  "default": "@B35",\n\t\t\t  "dark": "@B35",\n\t\t\t  "light": "@B90"\n\t\t\t}\n\t\t  },\n\t\t  "shape": {\n\t\t\t"positiveValue": {\n\t\t\t  "fill": "#4477AA"\n\t\t\t},\n\t\t\t"negativeValue": {\n\t\t\t  "fill": "#cc6677"\n\t\t\t},\n\t\t\t"subtotal": {\n\t\t\t  "fill": "#c3c3c3"\n\t\t\t},\n\t\t\t"bridge": {\n\t\t\t  "stroke": "@B50"\n\t\t\t}\n\t\t  }\n\t\t},\n\t\t"mapChart": {\n\t\t  "label": {\n\t\t\t"value": {\n\t\t\t  "color": "@B35",\n\t\t\t  "fontSize": "12px"\n\t\t\t}\n\t\t  }\n\t\t}\n\t},\n\t"dataColors": {\n\t\t"primaryColor": "#4477aa",\n\t\t"othersColor": "#a5a5a5",\n\t\t"errorColor": "#ff4444",\n\t\t"nullColor": "#d2d2d2"\n\t},\n\t"palettes": {\n\t\t"data": [\n\t\t\t{\n\t\t\t\t"name": "12 Colors",\n\t\t\t\t"translation": "properties.colorNumberOfColors.12",\n\t\t\t\t"propertyValue": "12",\n\t\t\t\t"type": "pyramid",\n\t\t\t\t"scale": [\n\t\t\t\t\t[ "#4477aa" ],\n\t\t\t\t\t[ "#4477aa", "#cc6677" ],\n\t\t\t\t\t[ "#4477aa", "#ddcc77", "#cc6677" ],\n\t\t\t\t\t[ "#4477aa", "#117733", "#ddcc77", "#cc6677" ],\n\t\t\t\t\t[ "#332288", "#88ccee", "#117733", "#ddcc77", "#cc6677" ],\n\t\t\t\t\t[ "#332288", "#88ccee", "#117733", "#ddcc77", "#cc6677", "#aa4499" ],\n\t\t\t\t\t[ "#332288", "#44aa99", "#88ccee", "#117733", "#ddcc77", "#cc6677", "#aa4499" ],\n\t\t\t\t\t[ "#332288", "#44aa99", "#88ccee", "#117733", "#999933", "#ddcc77", "#cc6677", "#aa4499" ],\n\t\t\t\t\t[ "#332288", "#44aa99", "#88ccee", "#117733", "#999933", "#ddcc77", "#cc6677", "#882255", "#aa4499" ],\n\t\t\t\t\t[ "#332288", "#44aa99", "#88ccee", "#117733", "#999933", "#ddcc77", "#661100", "#cc6677", "#882255", "#aa4499" ],\n\t\t\t\t\t[ "#332288", "#6699cc", "#44aa99", "#88ccee", "#117733", "#999933", "#ddcc77", "#661100", "#cc6677", "#882255", "#aa4499" ],\n\t\t\t\t\t[ "#332288", "#6699cc", "#88ccee", "#44aa99", "#117733", "#999933", "#ddcc77", "#661100", "#cc6677", "#aa4466", "#882255", "#aa4499" ]\n\t\t\t\t]\n\t\t\t},\n\t\t\t{\n\t\t\t\t"name": "100 Colors",\n\t\t\t\t"translation": "properties.colorNumberOfColors.100",\n\t\t\t\t"propertyValue": "100",\n\t\t\t\t"type": "row",\n\t\t\t\t"scale": [\n\t\t\t\t\t"#99c867",\n\t\t\t\t\t"#e43cd0",\n\t\t\t\t\t"#e2402a",\n\t\t\t\t\t"#66a8db",\n\t\t\t\t\t"#3f1a20",\n\t\t\t\t\t"#e5aa87",\n\t\t\t\t\t"#3c6b59",\n\t\t\t\t\t"#aa2a6b",\n\t\t\t\t\t"#e9b02e",\n\t\t\t\t\t"#7864dd",\n\t\t\t\t\t"#65e93c",\n\t\t\t\t\t"#5ce4ba",\n\t\t\t\t\t"#d0e0da",\n\t\t\t\t\t"#d796dd",\n\t\t\t\t\t"#64487b",\n\t\t\t\t\t"#e4e72b",\n\t\t\t\t\t"#6f7330",\n\t\t\t\t\t"#932834",\n\t\t\t\t\t"#ae6c7d",\n\t\t\t\t\t"#986717",\n\t\t\t\t\t"#e3cb70",\n\t\t\t\t\t"#408c1d",\n\t\t\t\t\t"#dd325f",\n\t\t\t\t\t"#533d1c",\n\t\t\t\t\t"#2a3c54",\n\t\t\t\t\t"#db7127",\n\t\t\t\t\t"#72e3e2",\n\t\t\t\t\t"#e2c1da",\n\t\t\t\t\t"#d47555",\n\t\t\t\t\t"#7d7f81",\n\t\t\t\t\t"#54ae9b",\n\t\t\t\t\t"#e9daa6",\n\t\t\t\t\t"#3a8855",\n\t\t\t\t\t"#5be66e",\n\t\t\t\t\t"#ab39a4",\n\t\t\t\t\t"#a6e332",\n\t\t\t\t\t"#6c469d",\n\t\t\t\t\t"#e39e51",\n\t\t\t\t\t"#4f1c42",\n\t\t\t\t\t"#273c1c",\n\t\t\t\t\t"#aa972e",\n\t\t\t\t\t"#8bb32a",\n\t\t\t\t\t"#bdeca5",\n\t\t\t\t\t"#63ec9b",\n\t\t\t\t\t"#9c3519",\n\t\t\t\t\t"#aaa484",\n\t\t\t\t\t"#72256d",\n\t\t\t\t\t"#4d749f",\n\t\t\t\t\t"#9884df",\n\t\t\t\t\t"#e590b8",\n\t\t\t\t\t"#44b62b",\n\t\t\t\t\t"#ad5792",\n\t\t\t\t\t"#c65dea",\n\t\t\t\t\t"#e670ca",\n\t\t\t\t\t"#e38783",\n\t\t\t\t\t"#29312d",\n\t\t\t\t\t"#6a2c1e",\n\t\t\t\t\t"#d7b1aa",\n\t\t\t\t\t"#b1e7c3",\n\t\t\t\t\t"#cdc134",\n\t\t\t\t\t"#9ee764",\n\t\t\t\t\t"#56b8ce",\n\t\t\t\t\t"#2c6323",\n\t\t\t\t\t"#65464a",\n\t\t\t\t\t"#b1cfea",\n\t\t\t\t\t"#3c7481",\n\t\t\t\t\t"#3a4e96",\n\t\t\t\t\t"#6493e1",\n\t\t\t\t\t"#db5656",\n\t\t\t\t\t"#747259",\n\t\t\t\t\t"#bbabe4",\n\t\t\t\t\t"#e33f92",\n\t\t\t\t\t"#d0607d",\n\t\t\t\t\t"#759f79",\n\t\t\t\t\t"#9d6b5e",\n\t\t\t\t\t"#8574ae",\n\t\t\t\t\t"#7e304c",\n\t\t\t\t\t"#ad8fac",\n\t\t\t\t\t"#4b77de",\n\t\t\t\t\t"#647e17",\n\t\t\t\t\t"#b9c379",\n\t\t\t\t\t"#8da8b0",\n\t\t\t\t\t"#b972d9",\n\t\t\t\t\t"#786279",\n\t\t\t\t\t"#7ec07d",\n\t\t\t\t\t"#916436",\n\t\t\t\t\t"#2d274f",\n\t\t\t\t\t"#dce680",\n\t\t\t\t\t"#759748",\n\t\t\t\t\t"#dae65a",\n\t\t\t\t\t"#459c49",\n\t\t\t\t\t"#b7934a",\n\t\t\t\t\t"#51c671",\n\t\t\t\t\t"#9ead3f",\n\t\t\t\t\t"#969a5c",\n\t\t\t\t\t"#b9976a",\n\t\t\t\t\t"#46531a",\n\t\t\t\t\t"#c0f084",\n\t\t\t\t\t"#76c146",\n\t\t\t\t\t"#bad0ad"\n\t\t\t\t]\n\t\t\t}\n\t\t],\n\t\t"ui": [\n\t\t\t{\n\t\t\t\t"name": "Palette",\n\t\t\t\t"colors": [\n\t\t\t\t\t"none",\n\t\t\t\t\t"#ffffff",\n\t\t\t\t\t"#46c646",\n\t\t\t\t\t"#276e27",\n\t\t\t\t\t"#b6d7ea",\n\t\t\t\t\t"#7db8da",\n\t\t\t\t\t"#4477aa",\n\t\t\t\t\t"#8e477d",\n\t\t\t\t\t"#ffcf02",\n\t\t\t\t\t"#f8981d",\n\t\t\t\t\t"#f93f17",\n\t\t\t\t\t"#633d0c",\n\t\t\t\t\t"#b0afae",\n\t\t\t\t\t"#7b7a78",\n\t\t\t\t\t"#545352",\n\t\t\t\t\t"#000000"\n\t\t\t\t]\n\t\t\t}\n\t\t]\n\t},\n\t"scales": [\n\t\t{\n\t\t\t"name": "Sequential Gradient",\n\t\t\t"translation": "properties.colorScheme.sequential",\n\t\t\t"type": "gradient",\n\t\t\t"propertyValue": "sg",\n\t\t\t"scale": [ "#662506", "#993404", "#cc4c02", "#ec7014", "#fb9a29", "#fec44f", "#fee391", "#fff7bc" ]\n\t\t},\n\t\t{\n\t\t\t"name": "Sequential Classes",\n\t\t\t"translation": "properties.colorScheme.sequentialC",\n\t\t\t"propertyValue": "sc",\n\t\t\t"type": "class",\n\t\t\t"scale": [ "#662506", "#993404", "#cc4c02", "#ec7014", "#fb9a29", "#fec44f", "#fee391" ]\n\t\t},\n\t\t{\n\t\t\t"name": "Diverging gradient",\n\t\t\t"translation": "properties.colorScheme.diverging",\n\t\t\t"propertyValue": "dg",\n\t\t\t"type": "gradient",\n\t\t\t"scale": [ "#ae1c3e", "#d24d3e", "#ed875e", "#f9bd7e", "#e6f5fe", "#b4ddf7", "#77b7e5", "#3a89c9", "#3d52a1" ]\n\t\t},\n\t\t{\n\t\t\t"name": "Diverging Classes",\n\t\t\t"translation": "properties.colorScheme.divergingC",\n\t\t\t"propertyValue": "dc",\n\t\t\t"type": "class",\n\t\t\t"scale": [ "#ae1c3e", "#d24d3e", "#ed875e", "#f9bd7e", "#ffe3aa", "#e6f5fe", "#b4ddf7", "#77b7e5", "#3a89c9", "#3d52a1" ]\n\t\t}\n\t]\n}\n'}),define("client.utils/theme/modern/providers/default-themes-provider",["translator","core.utils/deferred"],function(e,t){"use strict";function n(e){return t.resolve(o+encodeURIComponent(e))}var i={},r="assets/external/sense-themes-default/default-themes.json",o="assets/external/sense-themes-default/";return i._resolveDefaultConfiguration=function(e){var n=new t,r=JSON.parse(e);return i._waitForTranslator().then(function(){var e={default:r.default,custom:[]};i._translateNames(e.default),i._setType(e.default),n.resolve(e)}),n.promise},i._waitForTranslator=function(){return e.ready},i._getJsonPath=function(e){return"text!"+e+"/theme.json"},i._translateNames=function(t){t.forEach(function(t){t.name=e.get(t.name)})},i._setType=function(e){e.forEach(function(e){e.type="default"})},i.getThemeLists=function(){var e=new t;return requirejs(["text!"+r],function(t){i._resolveDefaultConfiguration(t).then(function(t){e.resolve(t)})}),e.promise},i.loadJson=function(e,t){return n(e).then(function(e){var n=i._getJsonPath(e);return requirejs([n],t,function(){})})},i.getResourcePath=n,i}),define("client.utils/theme/modern/providers/qrs-themes-provider",["qvangular","core.utils/deferred"],function(e,t){"use strict";function n(e){return t.resolve(r+encodeURIComponent(e))}var i={},r="extensions/";return i._getExtensionsFromQrs=function(){return e.getService("$contentApi").getExtensions()},i._isThemeExtension=function(e,t){return e.hasOwnProperty(t)&&e[t].type&&"theme"===e[t].type},i._getJsonPath=function(e){return"text!"+e+"/theme.json"},i.getThemeLists=function(){var e=new t,n={default:[],custom:[]};return i._getExtensionsFromQrs().then(function(t){for(var r in t)i._isThemeExtension(t,r)&&n.custom.push({id:r,name:t[r].name,type:"qrs"});e.resolve(n)},function(){e.resolve(n)}),e.promise},i.loadJson=function(e,t){return n(e).then(function(e){var n=i._getJsonPath(e);return requirejs([n],t,function(){})})},i.getResourcePath=n,i}),define("client.utils/theme/modern/providers/rls-themes-provider",["qvangular","core.utils/deferred"],function(e,t){"use strict";function n(e){var n=new t;return i.getThemeLists().then(function(t){var r=i._getResourcePathForList(t.default,e);r?n.resolve(r):(r=i._getResourcePathForList(t.custom,e))?n.resolve(r):n.resolve(null)}),n.promise}var i={};return i._getResourcePathForList=function(e,t){var n;return e.forEach(function(e){e.id===t&&(n="rls/themes/"+e.rlsId+"/file")}),n},i._getJsonPath=function(e,t){return"text!"+e+"/theme.json"+t},i._getThemesFromRls=function(){return e.getService("$rlsApi").getCloudThemes()},i._getListForSupplier=function(e){return e&&"qlik"===e.toLowerCase()?"default":"custom"},i.getThemeLists=function(){var e,n=this,r=new t,o={default:[],custom:[]};return i._getThemesFromRls().then(function(t){for(var i in t){var s=t[i];s.attributes.qext_filename&&s.attributes.name&&s.id&&(e=o[n._getListForSupplier(s.attributes.supplier)]).push({id:s.attributes.qext_filename,name:s.attributes.name,rlsId:s.id,type:"rls"})}r.resolve(o)},function(){r.resolve(o)}),r.promise},i.loadJson=function(t,r){return n(t).then(function(t){var n=i._getJsonPath(t,e.getService("$rlsApi").getTenantIdUrlParameter());return requirejs([n],r,function(){})})},i.getResourcePath=n,i}),define("client.utils/theme/modern/theme-loader",["core.utils/class","core.utils/deferred","./providers/default-themes-provider","./providers/qrs-themes-provider","./providers/rls-themes-provider"],function(e,t,n,i,r){"use strict";var o,s={DEFAULT:"default",QRS:"qrs",RLS:"rls"};return e.extend("ThemeLoader",{init:function(e){this._cachedThemes=null,this.config=e,this.providers={default:n,qrs:i,rls:r},this.THEME_TYPE=s,this.ERROR_THEME_ID="Invalid theme id"},getAvailableThemes:function(){var e=this,n=new t,i=[],r=Object.keys(this.providers),o={default:[],custom:[]};return this._cachedThemes?t.resolve(this._cachedThemes):this.config&&this.config.providers?(r.forEach(function(t){e.config.providers[t]&&i.push(e.providers[t].getThemeLists())}),t.all(i).then(function(t){t.forEach(function(e){o.default=o.default.concat(e.default),o.custom=o.custom.concat(e.custom)}),e._sortAlphabetically(o.custom),e._cachedThemes=o,n.resolve(o)}),n.promise):t.resolve(o)},getCustomThemesPage:function(e){var n,i,r=this;return o&&o<e?t.resolve([]):(n=new t,this.getAvailableThemes().then(function(t){i=r._getPageFromList(e,t.custom,20),n.resolve(i)}),n.promise)},getType:function(e){var n=this,i=new t;return this.getAvailableThemes().then(function(t){for(var r,o,s,a=Object.keys(t),l=null;!l;){for(o=0;o<a.length;o++)if(r=a[o],s=n._getThemeTypeInList(t[r],e)){l=s;break}break}l?i.resolve(l):i.reject("Invalid theme id")}),i.promise},getRawJson:function(e,n){var i=this;return!e||e.indexOf("/")>=0?t.reject("Invalid theme id"):this.getType(e).then(function(t){return i.providers[t].loadJson(e,n)}).catch(function(e){return t.reject(e)})},getThemePath:function(e){var n=this;return!e||e.indexOf("/")>=0?t.reject("Invalid theme id"):this.getType(e).then(function(t){return n.providers[t].getResourcePath(e)})},getPagesTotal:function(){var e=this,n=new t;return o?t.resolve(o):(this.getAvailableThemes().then(function(t){o=e._calculateNbrOfPages(t.custom,20),n.resolve(o)}),n.promise)},_sortAlphabetically:function(e){return e.sort(function(e,t){return e.name.localeCompare(t.name)})},_getThemeTypeInList:function(e,t){var n=null;if(e)for(var i=0;i<e.length;i++)if(e[i].id===t){n=e[i].type;break}return n},_getPageFromList:function(e,t,n){var i=e||e>0?e:0,r=i*n,o=(i+1)*n;return t.length<o&&(o=t.length),t.slice(r,o)},_calculateNbrOfPages:function(e,t){return Math.ceil(e.length/t)}})}),define("general.utils/css-colors",[],function(){return{aliceblue:{r:240,g:248,b:255},antiquewhite:{r:250,g:235,b:215},aqua:{r:0,g:255,b:255},aquamarine:{r:127,g:255,b:212},azure:{r:240,g:255,b:255},beige:{r:245,g:245,b:220},bisque:{r:255,g:228,b:196},black:{r:0,g:0,b:0},blanchedalmond:{r:255,g:235,b:205},blue:{r:0,g:0,b:255},blueviolet:{r:138,g:43,b:226},brown:{r:165,g:42,b:42},burlywood:{r:222,g:184,b:135},cadetblue:{r:95,g:158,b:160},chartreuse:{r:127,g:255,b:0},chocolate:{r:210,g:105,b:30},coral:{r:255,g:127,b:80},cornflowerblue:{r:100,g:149,b:237},cornsilk:{r:255,g:248,b:220},crimson:{r:220,g:20,b:60},cyan:{r:0,g:255,b:255},darkblue:{r:0,g:0,b:139},darkcyan:{r:0,g:139,b:139},darkgoldenrod:{r:184,g:134,b:11},darkgray:{r:169,g:169,b:169},darkgreen:{r:0,g:100,b:0},darkgrey:{r:169,g:169,b:169},darkkhaki:{r:189,g:183,b:107},darkmagenta:{r:139,g:0,b:139},darkolivegreen:{r:85,g:107,b:47},darkorange:{r:255,g:140,b:0},darkorchid:{r:153,g:50,b:204},darkred:{r:139,g:0,b:0},darksalmon:{r:233,g:150,b:122},darkseagreen:{r:143,g:188,b:143},darkslateblue:{r:72,g:61,b:139},darkslategray:{r:47,g:79,b:79},darkslategrey:{r:47,g:79,b:79},darkturquoise:{r:0,g:206,b:209},darkviolet:{r:148,g:0,b:211},deeppink:{r:255,g:20,b:147},deepskyblue:{r:0,g:191,b:255},dimgray:{r:105,g:105,b:105},dimgrey:{r:105,g:105,b:105},dodgerblue:{r:30,g:144,b:255},firebrick:{r:178,g:34,b:34},floralwhite:{r:255,g:250,b:240},forestgreen:{r:34,g:139,b:34},fuchsia:{r:255,g:0,b:255},gainsboro:{r:220,g:220,b:220},ghostwhite:{r:248,g:248,b:255},gold:{r:255,g:215,b:0},goldenrod:{r:218,g:165,b:32},gray:{r:128,g:128,b:128},green:{r:0,g:128,b:0},greenyellow:{r:173,g:255,b:47},grey:{r:128,g:128,b:128},honeydew:{r:240,g:255,b:240},hotpink:{r:255,g:105,b:180},indianred:{r:205,g:92,b:92},indigo:{r:75,g:0,b:130},ivory:{r:255,g:255,b:240},khaki:{r:240,g:230,b:140},lavender:{r:230,g:230,b:250},lavenderblush:{r:255,g:240,b:245},lawngreen:{r:124,g:252,b:0},lemonchiffon:{r:255,g:250,b:205},lightblue:{r:173,g:216,b:230},lightcoral:{r:240,g:128,b:128},lightcyan:{r:224,g:255,b:255},lightgoldenrodyellow:{r:250,g:250,b:210},lightgray:{r:211,g:211,b:211},lightgreen:{r:144,g:238,b:144},lightgrey:{r:211,g:211,b:211},lightpink:{r:255,g:182,b:193},lightsalmon:{r:255,g:160,b:122},lightseagreen:{r:32,g:178,b:170},lightskyblue:{r:135,g:206,b:250},lightslategray:{r:119,g:136,b:153},lightslategrey:{r:119,g:136,b:153},lightsteelblue:{r:176,g:196,b:222},lightyellow:{r:255,g:255,b:224},lime:{r:0,g:255,b:0},limegreen:{r:50,g:205,b:50},linen:{r:250,g:240,b:230},magenta:{r:255,g:0,b:255},maroon:{r:128,g:0,b:0},mediumaquamarine:{r:102,g:205,b:170},mediumblue:{r:0,g:0,b:205},mediumorchid:{r:186,g:85,b:211},mediumpurple:{r:147,g:112,b:219},mediumseagreen:{r:60,g:179,b:113},mediumslateblue:{r:123,g:104,b:238},mediumspringgreen:{r:0,g:250,b:154},mediumturquoise:{r:72,g:209,b:204},mediumvioletred:{r:199,g:21,b:133},midnightblue:{r:25,g:25,b:112},mintcream:{r:245,g:255,b:250},mistyrose:{r:255,g:228,b:225},moccasin:{r:255,g:228,b:181},navajowhite:{r:255,g:222,b:173},navy:{r:0,g:0,b:128},oldlace:{r:253,g:245,b:230},olive:{r:128,g:128,b:0},olivedrab:{r:107,g:142,b:35},orange:{r:255,g:165,b:0},orangered:{r:255,g:69,b:0},orchid:{r:218,g:112,b:214},palegoldenrod:{r:238,g:232,b:170},palegreen:{r:152,g:251,b:152},paleturquoise:{r:175,g:238,b:238},palevioletred:{r:219,g:112,b:147},papayawhip:{r:255,g:239,b:213},peachpuff:{r:255,g:218,b:185},peru:{r:205,g:133,b:63},pink:{r:255,g:192,b:203},plum:{r:221,g:160,b:221},powderblue:{r:176,g:224,b:230},purple:{r:128,g:0,b:128},red:{r:255,g:0,b:0},rosybrown:{r:188,g:143,b:143},royalblue:{r:65,g:105,b:225},saddlebrown:{r:139,g:69,b:19},salmon:{r:250,g:128,b:114},sandybrown:{r:244,g:164,b:96},seagreen:{r:46,g:139,b:87},seashell:{r:255,g:245,b:238},sienna:{r:160,g:82,b:45},silver:{r:192,g:192,b:192},skyblue:{r:135,g:206,b:235},slateblue:{r:106,g:90,b:205},slategray:{r:112,g:128,b:144},slategrey:{r:112,g:128,b:144},snow:{r:255,g:250,b:250},springgreen:{r:0,g:255,b:127},steelblue:{r:70,g:130,b:180},tan:{r:210,g:180,b:140},teal:{r:0,g:128,b:128},thistle:{r:216,g:191,b:216},tomato:{r:255,g:99,b:71},transparent:{r:255,g:255,b:255,a:0},turquoise:{r:64,g:224,b:208},violet:{r:238,g:130,b:238},wheat:{r:245,g:222,b:179},white:{r:255,g:255,b:255},whitesmoke:{r:245,g:245,b:245},yellow:{r:255,g:255,b:0},yellowgreen:{r:154,g:205,b:50}}}),define("general.utils/color",["core.utils/class","./css-colors"],function(e,t){var n,i=/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/i,r=/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),(\d(\.\d+)?)\)$/i,o=/^#([A-f0-9]{2})([A-f0-9]{2})([A-f0-9]{2})$/i,s=/^#([A-f0-9])([A-f0-9])([A-f0-9])$/i,a=/^hsl\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*\)$/i,l=/^hsla\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*,(\d(\.\d+)?)\)$/i,c=Math.floor,u=Math.round;return n=e.extend({init:function(){var e,i,r,o,s,a,l,h,d,p,f,m,g=0,v=0,y=0,b=1;if(this._invalid=!1,arguments[0]instanceof n)g=arguments[0]._r,v=arguments[0]._g,y=arguments[0]._b,b=arguments[0]._a,this._invalid=arguments[0]._invalid;else if(arguments.length<3)if("string"==typeof arguments[0])if(m=arguments[0],f=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/i.exec(m))g=parseInt(f[1],10),v=parseInt(f[2],10),y=parseInt(f[3],10);else if(f=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d(\.\d+)?)\s*\)$/i.exec(m))g=parseInt(f[1],10),v=parseInt(f[2],10),y=parseInt(f[3],10),b=parseFloat(f[4]);else if(f=/^#([A-f0-9]{2})([A-f0-9]{2})([A-f0-9]{2})$/i.exec(m))g=parseInt(f[1],16),v=parseInt(f[2],16),y=parseInt(f[3],16),b=1;else if(f=/^#([A-f0-9])([A-f0-9])([A-f0-9])$/i.exec(m))g=parseInt(f[1]+f[1],16),v=parseInt(f[2]+f[2],16),y=parseInt(f[3]+f[3],16),b=1;else if(f=/^hsl\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*\)$/i.exec(m)){switch(e=parseFloat(f[1]),i=parseFloat(f[3]),o=parseFloat(f[5]),e%=360,i/=100,o/=100,e=e<0?0:e>360?360:e,i=i<0?0:i>1?1:i,o=o<0?0:o>1?1:o,a=o<=.5?2*o*i:(2-2*o)*i,l=e/60,h=a*(1-Math.abs(l%2-1)),d=[],l=Math.floor(l)){case 0:d=[a,h,0];break;case 1:d=[h,a,0];break;case 2:d=[0,a,h];break;case 3:d=[0,h,a];break;case 4:d=[h,0,a];break;case 5:d=[a,0,h];break;default:d=[0,0,0]}p=o-.5*a,g=d[0]+p,v=d[1]+p,y=d[2]+p,g=u(255*g),v=u(255*v),y=u(255*y),b=1}else if(f=/^hsla\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*,(\d(\.\d+)?)\)$/i.exec(m)){switch(e=parseFloat(f[1]),i=parseFloat(f[3]),o=parseFloat(f[5]),b=parseFloat(f[7]),e%=360,i/=100,o/=100,e=e<0?0:e>360?360:e,i=i<0?0:i>1?1:i,o=o<0?0:o>1?1:o,a=o<=.5?2*o*i:(2-2*o)*i,l=e/60,h=a*(1-Math.abs(l%2-1)),d=[],l=Math.floor(l)){case 0:d=[a,h,0];break;case 1:d=[h,a,0];break;case 2:d=[0,a,h];break;case 3:d=[0,h,a];break;case 4:d=[h,0,a];break;case 5:d=[a,0,h];break;default:d=[0,0,0]}p=o-.5*a,g=d[0]+p,v=d[1]+p,y=d[2]+p,g=u(255*g),v=u(255*v),y=u(255*y)}else if(f=/^hsv\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*\)$/i.exec(m)){switch(e=parseFloat(f[1]),i=parseFloat(f[3]),s=parseFloat(f[5]),e%=360,i/=100,s/=100,e=e<0?0:e>360?360:e,i=i<0?0:i>1?1:i,s=s<0?0:s>1?1:s,a=s*i,l=e/60,h=a*(1-Math.abs(l%2-1)),d=[],l=Math.floor(l)){case 0:d=[a,h,0];break;case 1:d=[h,a,0];break;case 2:d=[0,a,h];break;case 3:d=[0,h,a];break;case 4:d=[h,0,a];break;case 5:d=[a,0,h];break;default:d=[0,0,0]}p=s-a,g=d[0]+p,v=d[1]+p,y=d[2]+p,g=u(255*g),v=u(255*v),y=u(255*y),b=1}else t[m.toLowerCase()]?(r=m.toLowerCase(),g=t[r].r,v=t[r].g,y=t[r].b,b="number"==typeof t[r].a?t[r].a:1):this._invalid=!0;else"number"==typeof arguments[0]&&arguments[0]>=0&&"argb"===arguments[1]?(b=(4278190080&arguments[0])>>>24,b/=255,g=(16711680&arguments[0])>>16,v=(65280&arguments[0])>>8,y=255&arguments[0]):"number"==typeof arguments[0]&&arguments[0]>=0?(g=(16711680&arguments[0])>>16,v=(65280&arguments[0])>>8,y=255&arguments[0]):this._invalid=!0;else arguments.length>=3?(g=arguments[0],v=arguments[1],y=arguments[2],b=arguments.length>=4?arguments[3]:1):this._invalid=!0;isNaN(g+v+y+b)&&(this._invalid=!0),this._r=c(g),this._g=c(v),this._b=c(y),this._a=b,this._spaces={}},isInvalid:function(){return this._invalid},setAlpha:function(e){this._a=e,this._spaces={}},getAlpha:function(){return this._a},toRGB:function(){return this._spaces.rgb||(this._spaces.rgb=n.toRGB(this)),this._spaces.rgb},toRGBA:function(){return this._spaces.rgba||(this._spaces.rgba=n.toRGBA(this)),this._spaces.rgba},toString:function(){return this._spaces.rgb||(this._spaces.rgb=n.toRGB(this)),this._spaces.rgb},toHex:function(){return this._spaces.hex||(this._spaces.hex=n.toHex(this)),this._spaces.hex},toHSL:function(e){return this._spaces.hsl||(this._spaces.hsl=n.toHSL(this,e)),this._spaces.hsl},toHSLA:function(e){return this._spaces.hsla||(this._spaces.hsla=n.toHSLA(this,e)),this._spaces.hsla},toHSV:function(){var e=this.toHSVComponents();return"hsv("+e.h+","+e.s+","+e.v+")"},toHSVComponents:function(){return this._spaces.hsvComp||(this._spaces.hsvComp=n.toHSVComponents(this)),this._spaces.hsvComp},toNumber:function(){return this._spaces.num||(this._spaces.num=n.toNumber(this)),this._spaces.num},isDark:function(){return this.isInvalid()||this.getLuminance()<125},getLuminance:function(){return void 0===this._lumi&&(this._lumi=.299*this._r+.587*this._g+.114*this._b),this._lumi},shiftLuminance:function(e){var t,n,i,r,o,s=this.toHSLA();return o=/^hsla\(\s*(\d+(\.\d+)?)\s*,\s*(\d+(\.\d+)?%?)\s*,\s*(\d+(\.\d+)?%?)\s*,(\d(\.\d+)?)\)$/i.exec(s),t=parseFloat(o[1]),n=parseFloat(o[3]),i=parseFloat(o[5]),r=parseFloat(o[7]),i+=e,i=Math.max(0,Math.min(i,100)),"hsla("+t+","+n+","+i+","+r+")"},isEqual:function(e){return e instanceof n?this._r===e._r&&this._g===e._g&&this._b===e._b:(e=new n(e),this._r===e._r&&this._g===e._g&&this._b===e._b)},blend:function(e,t){return"rgba("+[c(this._r+(e._r-this._r)*t),c(this._g+(e._g-this._g)*t),c(this._b+(e._b-this._b)*t),c(this._a+(e._a-this._a)*t)].join(",")+")"},createShiftedColor:function(e){(void 0===e||isNaN(e))&&(e=1);var t=this.getLuminance(),i=this._g<126?1:1+this._g/512,r=this.shiftLuminance(20*(t*i<220?.8+1/(t+1)*4:-(.8+t/255*1))*e);return new n(r)}}),n.toRGB=function(e){return e instanceof n?"rgb("+[e._r,e._g,e._b].join(",")+")":("string"==typeof e&&(e=n.toNumber(e)),"rgb("+((16711680&e)>>16)+","+((65280&e)>>8)+","+(255&e)+")")},n.toRGBA=function(e,t){return e instanceof n?"rgba("+[e._r,e._g,e._b,void 0!==t?t:e._a].join(",")+")":("string"==typeof e&&(e=n.toNumber(e)),"rgba("+((16711680&e)>>16)+","+((65280&e)>>8)+","+(255&e)+","+(void 0!==t?t:e._a)+")")},n.toHex=function(e){var t,i,r;return e instanceof n?(t=e._r.toString(16),i=e._g.toString(16),r=e._b.toString(16),1===t.length&&(t="0"+t),1===i.length&&(i="0"+i),1===r.length&&(r="0"+r),"#"+[t,i,r].join("")):("string"==typeof e&&(e=n.toNumber(e)),t=((16711680&e)>>16).toString(16),i=((65280&e)>>8).toString(16),r=(255&e).toString(16),1===t.length&&(t="0"+t),1===i.length&&(i="0"+i),1===r.length&&(r="0"+r),"#"+t+i+r)},n.toHSL=function(e,t){var i,r,o,s,a,l,c,u,h=0;if("string"==typeof e&&(e=new n(e)),i=e._r/255,r=e._g/255,o=e._b/255,l=Math.max(i,r,o),c=Math.min(i,r,o),a=t?.21*i+.72*r+.07*o:(l+c)/2,l===c)h=s=0;else{switch(u=l-c,s=a>.5?u/(2-l-c):u/(l+c),l){case i:h=(r-o)/u+(r<o?6:0);break;case r:h=(o-i)/u+2;break;case o:h=(i-r)/u+4}h/=6}return"hsl("+360*h+","+100*s+","+100*a+")"},n.toHSLA=function(e,t){var i,r,o,s,a,l,c,u,h,d=0;if("string"==typeof e&&(e=new n(e)),i=e._r/255,r=e._g/255,o=e._b/255,s=e._a,c=Math.max(i,r,o),u=Math.min(i,r,o),l=t?.21*i+.72*r+.07*o:(c+u)/2,c===u)d=a=0;else{switch(h=c-u,a=l>.5?h/(2-c-u):h/(c+u),c){case i:d=(r-o)/h+(r<o?6:0);break;case r:d=(o-i)/h+2;break;case o:d=(i-r)/h+4}d/=6}return"hsla("+360*d+","+100*a+","+100*l+","+s+")"},n.toHSVComponents=function(e){var t,i,r,o,s,a,l,c,u=0;if("string"==typeof e&&(e=new n(e)),t=e._r/255,i=e._g/255,r=e._b/255,a=Math.max(t,i,r),l=Math.min(t,i,r),s=a,a===l)u=o=0;else{switch(c=a-l,o=0===c?0:c/s,a){case t:u=(i-r)/c+(i<r?6:0);break;case i:u=(r-t)/c+2;break;case r:u=(t-i)/c+4}u/=6}return{h:360*u%360,s:100*o,v:100*s}},n.toNumber=function(){if(1===arguments.length&&arguments[0]instanceof n)return(arguments[0]._r<<16)+(arguments[0]._g<<8)+arguments[0]._b;var e,t,i=0,r=0,o=0;return 1===arguments.length&&"string"==typeof arguments[0]&&(t=arguments[0],(e=/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/i.exec(t))?(i=parseInt(e[1],10),r=parseInt(e[2],10),o=parseInt(e[3],10)):(e=/^#([A-f0-9]{2})([A-f0-9]{2})([A-f0-9]{2})$/i.exec(t))?(i=parseInt(e[1],16),r=parseInt(e[2],16),o=parseInt(e[3],16)):(e=/^#([A-f0-9])([A-f0-9])([A-f0-9])$/i.exec(t))&&(i=parseInt(e[1]+e[1],16),r=parseInt(e[2]+e[2],16),o=parseInt(e[3]+e[3],16))),(i<<16)+(r<<8)+o},n.blend=function(e,t,i){var r=(16711680&(e=n.toNumber(e)))>>16,o=(65280&e)>>8,s=255&e;return(r+(((16711680&(t=n.toNumber(t)))>>16)-r)*i<<16)+(o+(((65280&t)>>8)-o)*i<<8)+(s+((255&t)-s)*i)},n.getBlend=function(e,t,i){var r=e._r+(t._r-e._r)*i,o=e._g+(t._g-e._g)*i,s=e._b+(t._b-e._b)*i,a=e._a+(t._a-e._a)*i;return new n(r,o,s,a)},n.isCSSColor=function(e){return!(arguments.length>1||"string"!=typeof e)&&(i.test(e)||r.test(e)||o.test(e)||s.test(e)||a.test(e)||l.test(e)||t[e.toLowerCase()])},n.getBestContrast=function(e,t,n){var i=e.getLuminance();return Math.abs(i-t.getLuminance())>Math.abs(i-n.getLuminance())?t:n},n.getContrast=function(e,t){if(e&&t){var n=e.getLuminance()/100,i=t.getLuminance()/100;return n>i?(n+.05)/(i+.05):(i+.05)/(n+.05)}},n.isDark=function(){var e={getLuminance:n.prototype.getLuminance,isInvalid:n.prototype.isInvalid};return n.prototype.init.apply(e,[].slice.call(arguments)),n.prototype.isDark.call(e)},n.useDarkLabel=function(e,t){return e._a>.5?!e.isDark():!t},n}),define("general.utils/color-cache",["./color"],function(e){function t(e,t){return function(){var n,i,r=function(){};return r.prototype=e.prototype,n=new r,i=e.apply(n,t),Object(i)===i?i:n}}function n(){s++}var i={},r={},o=5e3,s=0,a=Math.floor;return{retriveColor:function(){var a,l,c,u;if(arguments.length<3)"string"==typeof arguments[0]?a=arguments[0]:"number"==typeof arguments[0]&&arguments[0]>=0&&(a=arguments[0]+"");else if(arguments.length>=3)for(a=arguments[0],c=0;c>arguments.length;c++)a+=","+arguments[c];if(a&&i[a])return i[a];if(u=t(e,arguments)(),l=u.isInvalid()?"INVALID":u._r+","+u._g+","+u._b+","+u._a,r[l])u=r[l];else{if(s>=o)return u;r[l]=u,n()}return a&&(i[a]=u),u},retriveBlend:function(i,l,c){var u,h,d=a(i._r+(l._r-i._r)*c),p=a(i._g+(l._g-i._g)*c),f=a(i._b+(l._b-i._b)*c),m=a(i._a+(l._a-i._a)*c);if(u=d+","+p+","+f+","+m,r[u])h=r[u];else{if(h=t(e,[d,p,f,m])(),s>=o)return h;r[u]=h,n()}return h},clear:function(){i={},r={},s=0}}}),define("objects.views/charts/representation/color-scale",["core.utils/class","general.utils/color-cache"],function(e,t){"use strict";function n(e,t,n){var i;if(e=a(s(e,1e-12),.999999999999),n){for(var r=0;r<n.length&&n[r]<=e;)r++;i=n.length-(r+(e-n[r-1])/(n[r]-n[r-1]))}else i=t-e*t;return i}function i(e){return e=e||this._startLevel,a(e,this._colorParts.length-1)}function r(e){e.forEach(function(e){e.forEach(function(e){e.reverse()}),e.reverse()})}var o,s=Math.max,a=Math.min,l=t.retriveColor(13816530);return o=e.extend({init:function(){this._colorParts=[],this._startLevel=0,this._reverse=!1,this._max=1,this._min=0,this._span=1,this._invalidSpan=!1},addColorPart:function(e,n,i){i=i||0,this._startLevel=s(i,this._startLevel),this._colorParts[i]||(this._colorParts[i]=[]),this._colorParts[i].push([t.retriveColor(e),t.retriveColor(n)])},setLimits:function(e){if(!e)return this._limits=null,void(this._expandedLimits=null);this._limits=e,this._expandedLimits=[0].concat(e,[1])},setMaxMinValues:function(e,t){if(!(e>=t)||isNaN(e)||isNaN(t))throw"Incorrect arguments to color-scale->setMaxMinValues";this._max=e,this._min=t,this._span=e-t},setReverse:function(e){this._reverse!==e&&(this._reverse=e,r(this._colorParts))},getColor:function(e,r){var o,s,a,c,u,h,d=0===this._span?.5:(e-this._min)/this._span;return isNaN(e)||isNaN(d)?l:(r=i.apply(this,[r]),o=n(d,this._colorParts[r].length,this._expandedLimits),s=Math.floor(o),s=s===o?s-1:s,c=this._colorParts[r][s],u=c[0],h=c[1],e===this._min?h:e===this._max?u:(a=o-s,t.retriveBlend(u,h,a)))},getColors:function(e){var t,n=[];for(t=0;t<e.length;t++)n.push(this.getColor(e[t]));return n},getLegendParts:function(e){var t,n,r,o=[];for(e=i.apply(this,[e]),n=this._colorParts[e].length,t=0;t<n;++t){var s={grad:r=this._colorParts[e][t],color:r[0],solid:r[0]===r[1],index:t};this._expandedLimits&&(s.limits=[this._expandedLimits[n-t-1],this._expandedLimits[n-t]]),o.push(s)}return o}}),o._limitFunction=n,o}),define("client.utils/theme/modern/theme-scale-generator",["objects.views/charts/representation/color-scale","general.utils/color"],function(e,t){"use strict";function n(e,t,n){var i=.25+(t+1)/n*.25,r=.5-i;return r+e/1*(.5+i-r)}function i(t,n){var i=[],r=new e;i.push(t[0]),n||i.push(t[0]);for(var o=1;o<t.length-1;o++)i.push(t[o]),i.push(t[o]);i.push(t[o]),n||i.push(t[o]);for(var s=0;s<i.length;s+=2)r.addColorPart(i[s],i[s+1]);return r}function r(e,i,r){for(var o=[],s=0;s<i+1;s++){var a;switch(i){case 0:a=e.getColor(.5);break;default:var l=n(1/i*s,i,r);a=e.getColor(l)}o.push(new t(a).toHex())}return o}function o(e,t,n){for(var o=i(r(i(e,!0),t-1,t),n),s=[null],a=0;a<t;a++)s.push(r(o,a,t));return s}return{createPyramidFromColors:o,generateScales:function(e){e.forEach(function(e){if("class"===e.type){var t=o(e.scale,Math.max(e.scale.length,7),!1);e.scale=t,e.type="class-pyramid"}})},validatePalettesOrScales:function(e,t){var n={},i=[];return e.forEach(function(e,r){t?-1===["pyramid","row"].indexOf(e.type)&&i.push("Improper type for data palette: "+e.name):-1===["class","class-pyramid","gradient"].indexOf(e.type)&&i.push("Improper type for data scale: "+e.name),-1!==["pyramid","class-pyramid"].indexOf(e.type)?Array.isArray(e.scale)&&Array.isArray(e.scale[e.scale.length-1])&&"string"==typeof e.scale[e.scale.length-1][0]||i.push("Improper scale structure for: "+e.name):Array.isArray(e.scale)&&"string"==typeof e.scale[0]||i.push("Improper scale structure for: "+e.name),e.propertyValue||(e.propertyValue="scale"+r),n[e.propertyValue]?i.push("Duplicate property values for: "+e.name):n[e.propertyValue]=!0}),i}}}),define("client.utils/theme/modern/theme-parser",["jquery","qvangular","util","client.utils/theme/modern/theme-scale-generator"],function(e,t,n,i){"use strict";function r(e,t){for(var n in e)"object"==typeof e[n]&&null!==e[n]?r(e[n],t):"string"==typeof e[n]&&"@"===e[n].charAt(0)&&(e[n]=t[e[n]])}function o(e){i.generateScales(e)}function s(e,t){var n;e&&(n=i.validatePalettesOrScales(e))&&n.length&&n.forEach(function(e){console.warn("Theme parsing error, scale declaration: "+e)}),t&&(n=i.validatePalettesOrScales(t,!0))&&n.length&&n.forEach(function(e){console.warn("Theme parsing error, scale declaration: "+e)})}function a(e){e.forEach(function(e){if(e.colors)for(var t=0;t<e.colors.length;t++)e.colors[t]&&(e.colors[t]=e.colors[t].toLowerCase())})}var l=["palette","colorSchemes.qualitativeScales","colorSchemes.ordinalScales","scales","palettes.data","palettes.ui"],c={};return c.injectStyleNode=function(e,n){var i=document.createElement("link"),r=t.getService("$rlsApi").getTenantIdUrlParameter();return i.setAttribute("rel","stylesheet"),i.setAttribute("href",requirejs.toUrl(e+"/"+n+r)),document.head.appendChild(i),i},c.injectExtraStyleNodes=function(e,t){var n=[];return e.customStyles&&e.customStyles.length&&e.customStyles.forEach(function(e){e.cssRef&&e.cssRef.length&&"css"===e.cssRef.split(".").pop()&&(n.push({node:c.injectStyleNode(t,e.cssRef),cssClass:e.classRef}),e.classRef&&e.classRef.length&&c.toggleCssClass(e.classRef,!0))}),n},c.toggleCssClass=function(t,n){t&&t.length&&e("body").toggleClass(t,n)},c.parseTheme=function(e,t,i,c){var u={};try{e=JSON.parse(e)}catch(t){console.warn("Theme parsing error for theme: "+c+": "+t),e={}}return r(e,e._variables),r(t,t._variables),!1===e._inherit?n.extend(!0,u,e):n.extend(!0,u,t,e),i&&l.forEach(function(t){var i=n.getValue(e,t);void 0!==i&&n.setValue(u,t,i)}),u.scales&&o(u.scales),u.palettes&&u.palettes.ui&&a(u.palettes.ui),s(u.scales,u.palettes?u.palettes.data:null),u},c}),define("client.utils/theme/modern/theme-style-resolver",["core.utils/class","general.utils/color"],function(e,t){"use strict";function n(e,t,i,r,o){var s=a(t,i,r);return"."===s.charAt(0)?(t.shift(),e.apply(null,[n(e,t,i,r,o)].concat(o))):s}function i(e,t,i,r,o,a){return n(e,s(""===t?null:t.split("."),o),i,r,a)}function r(e,t){for(var n=e,i=0;i<t.length;i++){if(!n[t[i]])return null;n=n[t[i]]}return n}function o(e,t,n){var r=e.substring(1).split("(")[0],o=/\(\s*([^)]+?)\s*\)/.exec(e);o=o&&o[1]?o[1].split(/\s*,\s*/):[];try{return i(d[r],t,n,this._theme,this._basePathSteps,o)}catch(e){console.warn("Cound not execute function: "+r+", function might not be implemented or arguments are incorrect.")}}function s(e,t){var n,i,r=[];if(e)for(var o=e.length;o>=0;){for(i=(n=t.slice()).length;i>=0;)r.push(n.concat(e)),n.pop(),i--;e.pop(),o--}else for(i=(n=t.slice()).length;i>=0;)r.push(n.concat()),n.pop(),i--;return r}function a(e,t,n){for(var i=0;i<e.length;i++){var o=r(n,e[i]);if(null!==o&&o[t])return o[t]}}function l(e,t,n){var i;return i=""===e?s(null,n):s(e.split("."),n),a(i,t,this._theme)}function c(){for(var e="",t=0;t<arguments.length;t++)arguments[t]&&arguments[t].length&&(e+=(""!==e?".":"")+arguments[t]);return e}function u(e,t){p._cache[e]=t}function h(e){return p._cache[e]}var d={shift:function(e,n){var i=new t(e),r=i.isDark()?parseInt(n):-parseInt(n);return new t(i.shiftLuminance(r)).toHex()},fontSize:function(e,t){var n=parseInt(e);return n*=parseInt(t)/100,Math.ceil(n)+"px"},inherit:function(e){return e},alpha:function(e,n){var i=new t("transparent"===e.toLowerCase()?"rgba(0,0,0,0)":e);return i.setAlpha(n/100),i.toRGBA()}},p=e.extend("ThemeStyleResolver",{init:function(e,t,n){this._basePath=e,this._basePathSteps=e.split("."),this._theme=n,this._id=t,this.layoutMap={1:"spark",3:"xsmall",7:"small",15:"medium",31:"full",m:"mobile"}},setTheme:function(e,t){this._theme=t,this._id=e},setBasePath:function(e){this._basePath=e,this._basePathSteps=e.split(".")},getStyle:function(e,t,n){var i=void 0===n||n,r=h(c(this._id,this._basePath,e,t));if(i&&void 0!==r)return r;var s=this._basePathSteps.concat(),a=l.call(this,e,t,s);return a&&a.charAt&&"."===a.charAt(0)&&(a=o.call(this,a,e,t)),i&&a&&u(c(this._id,this._basePath,e,t),a),a},scaleFontSize:function(e,t,n){if("string"==typeof t)switch(t){case"large":t=31;break;case"medium":t=15;break;case"small":t=7;break;case"tiny":t=1;break;default:t=15}var i={spark:1,xsmall:.9,small:.95,full:".discrete"===n?1:1.2};return i[this.layoutMap[t]]?Math.floor(parseInt(e)*i[this.layoutMap[t]])+"px":parseInt(e)+"px"}});return p._cache={},p.clearCache=function(){p._cache={}},p}),define("core.utils/capability",["angular","util"],function(e,t){var n,i=e.injector(["ng"]).invoke(["$http",function(i){function r(e){e.headers||(e.headers={})}function o(e){e.params||(e.params={})}function s(e){var n=t.basePath,i=n.indexOf("/resources");return i>-1&&(n=n.substring(0,i)),e.url=n+e.url,e}function a(e){return r(e),o(e),s(e),i(e)}return function(){return n=a({method:"GET",url:"api/capability/v1/list",withCredentials:!0}).then(function(t){var n={};return t.data.forEach(function(e){e.flag&&void 0!==e.enabled&&(n[e.flag]=e.enabled)}),e.extend({},n)})}}]);return{get:function(){return n||i()}}}),define("client.utils/capability-flags",["core.utils/capability","core.utils/feature-flags"],function(e,t){var n=t;return{get:function(){return n},getFlag:function(e){var t=n[e];return!0===t||"true"===t},load:function(){return e.get().then(function(e){n=e}).catch(function(){n=t})}}}),define("general.services/rls-api/rls-api",["qvangular","core.utils/deferred","core.utils/environment"],function(e,t,n){e.service("$rlsApi",["$http",function(e){function i(){var e=n.getTenantId();return e?"?tenantId="+e:""}return{getCloudExtensions:function(){var n=new t,r=i();return e({method:"GET",url:"/api/v1/extensions"+r}).then(function(e){var t=e.data.data;n.resolve(t)}).catch(function(e){var t=e.data.data;n.reject(t)}),n.promise},getCloudThemes:function(){var n=new t,r=i();return e({method:"GET",url:"/api/v1/themes"+r}).then(function(e){var t=e.data.data;n.resolve(t)}).catch(function(e){var t=e.data.data;n.reject(t)}),n.promise},getTenantIdUrlParameter:i}}])}),define("client.utils/theme/modern/theme",["core.utils/deferred","core.utils/notification","client.models/app-generic-props-wrapper","text!assets/external/sense-themes-default/sense/theme.json","client.utils/theme/modern/theme-loader","client.utils/theme/modern/theme-parser","client.utils/theme/modern/theme-style-resolver","core.utils/feature-flags","client.utils/capability-flags","general.services/rls-api/rls-api","general.services/content-api/content-api"],function(e,t,n,i,r,o,s,a,l){"use strict";function c(){p.forEach(function(e){e.node.parentNode.removeChild(e.node),o.toggleCssClass(e.cssClass,!1)}),p=[]}function u(){var e=!0;v.currentPalette.forEach(function(t,n){x[n]&&x[n].toLowerCase()===t.toLowerCase()||(e=!1)}),g=e}var h=JSON.parse(i),d=null,p=[],f={},m={},g=!0,v={},y=new r({providers:{default:!0,qrs:a.THEMING_QMC&&!l.getFlag("DISABLE_ONPREM_THEMES"),rls:l.getFlag("CLOUD_THEMES")}});t.create(v,"ThemeChanged"),v.getCurrentTheme=function(){return d||"sense"},v.applyTheme=function(t){var n=new e;return t===d&&n.resolve(!0),y.getRawJson(t,function(e){var i=o.parseTheme(e,h,!0,t);d&&c(),y.getThemePath(t).then(function(e){p=o.injectExtraStyleNodes(i,e),f=i,d=t,Object.keys(m).forEach(function(e){m[e].setTheme(d,f)}),u(),v.ThemeChanged.emit(),n.resolve(!0)})}).catch(function(){n.resolve(!1)}),n.promise},v.getThemeJSON=function(t){var n=new e;return y.getRawJson(t,function(e){n.resolve(o.parseTheme(e,h,!0,t))}).catch(function(e){n.reject(e)}),n.promise},v.saveTheme=function(e){n.setProperties({theme:e||v.getCurrentTheme()})},v.isValidTheme=function(t){return y.getType(t).then(function(){return e.resolve(!0)}).catch(function(){return e.resolve(!1)})},v.getAvailableThemes=function(){return y.getAvailableThemes()},v.getCustomThemesPage=function(e){return y.getCustomThemesPage(e)},v.getPagesTotal=function(){return y.getPagesTotal()},Object.defineProperty(v,"currentPalette",{iterable:!1,get:function(){var e;return"none"!==(e=f.palettes&&f.palettes.ui&&f.palettes.ui[0]?f.palettes.ui[0].colors:h.palettes.ui[0].colors)[0]&&e.unshift("none"),e}}),Object.defineProperty(v,"smallPalette",{iterable:!1,get:function(){return b}}),Object.defineProperty(v,"firstPalette",{iterable:!1,get:function(){return f.palettes&&f.palettes.ui&&f.palettes.ui[0]?f.palettes.ui[0]:h.palettes.ui[0]}}),Object.defineProperty(v,"themePalettes",{iterable:!1,get:function(){for(var e,t=[],n=0;n<f.palettes.ui.length;n++)f.palettes&&f.palettes.ui&&f.palettes.ui[n]?(e=f.palettes.ui[n],t.push(e)):(e=h.palettes.ui[0],t.push(e));return t}}),Object.defineProperty(v,"deprecatedPalette",{iterable:!1,get:function(){return b}}),Object.defineProperty(v,"scales",{iterable:!1,get:function(){return f.scales||h.scales}}),Object.defineProperty(v,"dataPalettes",{iterable:!1,get:function(){return f.palettes?f.palettes.data||h.palettes.data:h.palettes.data}}),Object.defineProperty(v,"dataColors",{iterable:!1,get:function(){return f.dataColors||h.dataColors}}),v.initializeService=function(e){return m[e]||(m[e]=new s(e,d,f)),m[e]},v.getMatch=function(e){var t={linechart:"lineChart",barchart:"barChart",scatterplot:"scatterPlot",piechart:"pieChart",straightable:"straightTable",pivottable:"pivotTable",table:"straightTable","pivot-table":"pivotTable",listbox:"listBox",referenceline:"referenceLine",datacolors:"dataColors","text-image":"textImage",boxplot:"boxPlot",map:"mapChart",mapchart:"mapChart"};return t[e.toLowerCase()]?t[e.toLowerCase()]:e};var b=["#b0afae","#7b7a78","#545352","#4477aa","#7db8da","#b6d7ea","#46c646","#f93f17","#ffcf02","#276e27","#ffffff","#000000"],x=["none","#ffffff","#46c646","#276e27","#b6d7ea","#7db8da","#4477aa","#8e477d","#ffcf02","#f8981d","#f93f17","#633d0c","#b0afae","#7b7a78","#545352","#000000"];return v.resolveColor=function(e,t){return t=t||v.currentPalette,void 0!==e&&null!==e?void 0!==e.index&&-1!==e.index&&t[e.index]?t[e.index]:void 0!==e.color?e.color?e.color:"none":g&&b[e]?b[e]:t[e]?t[e]:e||"none":"none"},v.mapIndex=function(e,t,n){n=n||v.currentPalette;var i=t?n:b;return-1!==(e=(t?b:n).indexOf(i[e]))?e:t?3:6},v.getPaletteScale=function(e,t){var n,i=this.dataPalettes;if(i.some(function(t){return t.propertyValue.toLowerCase()===e.toLowerCase()&&(n=t,!0)}),n||(n=i[0]),"pyramid"===n.type){t=t||n.scale.length;var r=Math.max(Math.min(n.scale.length-1,t-1)%n.scale.length,0);return n.scale[r]}return n.scale},a.THEMING&&(d="sense",f=o.parseTheme(i,h,!0,"default")),v}),define("client.utils/theme/theme-module",["client.utils/theme/theme","client.utils/theme/modern/theme","core.utils/feature-flags"],function(e,t,n){var i={};return i.get=function(){return n.THEMING?t:e},i.getTheme=function(){return n.THEMING?t.getCurrentTheme():e.name},i.setTheme=function(i){n.THEMING?t.applyTheme(i):e.applyTheme(i)},i.getThemePalettes=function(){return t.themePalettes},i}),define("client.utils/property-hypercube-helper",["client.utils/property-resolver"],function(e){return{getDimensions:function(t){return e.getValue(t,"qHyperCubeDef.qDimensions",[])},getNumDimensions:function(t){return e.getValue(t,"qHyperCubeDef.qDimensions.length",0)},getMeasures:function(t){return e.getValue(t,"qHyperCubeDef.qMeasures",[])},getNumMeasures:function(t){return e.getValue(t,"qHyperCubeDef.qMeasures.length",0)},getDimensionLayouts:function(t,n){var i=e.getValue(t,n?n+".qHyperCube":"qHyperCube",null);return i?i.qDimensionInfo:[]},getDimensionLayout:function(e,t,n){return this.getDimensionLayouts(t,n).filter(function(t){return e===t.cId})[0]},getMeasureLayouts:function(t,n){var i=e.getValue(t,n?n+".qHyperCube":"qHyperCube",null);return i?i.qMeasureInfo:[]},getMeasureLayout:function(e,t,n){return this.getMeasureLayouts(t,n).filter(function(t){return e===t.cId})[0]}}}),define("general.utils/attribute-expression-util",[],function(){return{getById:function(e,t,n){return!!e&&(n=n||"id",e.filter(function(e){return e[n]===t})[0])},getIndexById:function(e,t,n){var i=-1;return e&&(n=n||"id",e.forEach(function(e,r){e[n]===t&&(i=r)})),i},moveById:function(e,t,n,i){var r=this.getIndexById(e,n,i);t=t||[];var o=this.getIndexById(t,n,i);if(-1!==r&&-1===o){var s=e.splice(r,1);t.push(s[0])}return t},moveByIdFromGroup:function(e,t,n,i,r){n=n||"qAttributeExpressions",r=r||"id";for(var o=0;o<e.length;o++){var s=e[o][n],a=t.length;if(this.moveById(s,t,i,r),a!==t.length)return t}return t},clean:function(e){return e.filter(function(e){return e&&e.id})},IDMAP:{CELL_BACKGROUND_COLOR:"cellBackgroundColor",CELL_FOREGROUND_COLOR:"cellForegroundColor",COLOR_BY_ALTERNATIVE:"colorByAlternative",COLOR_BY_EXPRESSION:"colorByExpression",TOOLTIP:"tooltip",CELL_URL_LABEL:"urlLabel"}}}),define("client.utils/property-logic/property-logic-helper",[],function(){return{getColorByDefinition:function(e,t,n){var i={};switch(e){case"dimension":n.qLibraryId?(i.type="dimension",i.name=n.qLibraryId,i.id=n.qLibraryId):(i.type="field",t?(i.name=n.label||n.qDef,i.id=n.qDef):(i.name=n.qDef.qFieldDefs[0],i.label=n.qDef.qFieldLabels&&""!==n.qDef.qFieldLabels[0]?n.qDef.qFieldLabels[0]:n.qDef.qFieldDefs[0]));break;case"measure":n.qLibraryId?(i.type="measure",i.name=n.qLibraryId,i.id=n.qLibraryId):(i.type="expression",t?(i.name=n.label||n.qExpression,i.id=n.qExpression):(i.name=n.qDef.qDef,i.label=n.qDef.qLabel||n.qDef.qDef));break;default:throw new Error("Default-property-logic.js: getColorByDefinition: Illegal input")}return i}}}),define("client.utils/color-support",["general.utils/attribute-expression-util","client.utils/property-resolver","client.utils/property-logic/property-logic-helper"],function(e,t,n){function i(t,n){t.forEach(function(t){r(t,e.IDMAP.COLOR_BY_ALTERNATIVE,"qAttributeDimensions"),r(t,e.IDMAP.COLOR_BY_ALTERNATIVE,"qAttributeExpressions")}),n.forEach(function(t){r(t,e.IDMAP.COLOR_BY_ALTERNATIVE,"qAttributeDimensions"),r(t,e.IDMAP.COLOR_BY_ALTERNATIVE,"qAttributeExpressions")})}function r(t,n,i){if(t[i]){var r=e.getIndexById(t[i],n);r>=0&&t[i].splice(r,1)}else t[i]=[]}function o(e,t,n,i){function r(e){return e.split(" ").length>1&&"="!==e[0]&&"["!==e[0]?"["+e+"]":e}var o=n?"expression":t.type,s=e.color.mode;switch(o){case"field":s="byDimension",e.color.byDimDef={label:t.label||r(t.name),key:r(t.name),type:"expression",activeDimensionIndex:t.activeDimensionIndex};break;case"expression":s="byMeasure",e.color.byMeasureDef={label:n||t.label||t.name,key:n||t.name,type:"expression",activeMeasureIndex:t.activeMeasureIndex};break;case"dimension":s="byDimension",e.color.byDimDef={label:t.name,key:t.id,type:"libraryItem",activeDimensionIndex:t.activeDimensionIndex};break;case"measure":s="byMeasure",e.color.byMeasureDef={label:t.name,key:t.id,type:"libraryItem",activeMeasureIndex:t.activeMeasureIndex}}i||(e.color.auto=!1,e.color.mode=s),e.color.altLabel=t.label||t.name}function s(n,r,o,s,a,l){i(o,s);var c=o[o.length-1];if(c){var u=r?t.getValue(n,"color.byDimDef"):t.getValue(n,"color.byMeasureDef");if(u){var h={id:e.IDMAP.COLOR_BY_ALTERNATIVE};switch(u.type){case"expression":h.label=l||u.label,r?h.qDef=u.key:h.qExpression=u.key;break;case"libraryItem":if(!r){var d=-1;a.forEach(function(e,t){u.key===e.qLibraryId&&(d=t)}),h.matchMeasure=d}h.qLibraryId=u.key,h.colorMapRef=u.key}r?(h.qSortBy={qSortByAscii:1},c.qAttributeDimensions.push(h)):c.qAttributeExpressions.push(h)}}}var a=["scatterplot","map"],l=["scatterplot","map","barchart","linechart","combochart","piechart","treemap","distributionplot"];return{baseColor:{isSupported:function(e){return e&&e.length&&-1===a.indexOf(e)}},colorBy:{isSupported:function(e){return l.contains(e)}},colorByUpdater:function(r,a){var l,c,u,h,d=t.getValue(r,"color.mode"),p=t.getValue(r,"color.auto"),f=t.getValue(r,a+"qDimensions",[]),m=t.getValue(r,a+"qMeasures",[]),g=t.getValue(r,a+"qLayoutExclude.qHyperCubeDef.qDimensions",[]),v=t.getValue(r,"visualization");if(p)f.length&&"map"!==v&&("piechart"===v||f.length>=2)&&(c="treemap"===v?f[0]:f[f.length-1],(h=n.getColorByDefinition("dimension",!1,c)).activeDimensionIndex=-1,o(r,h,null,!0),s(r,!0,f,g,m,t.getValue(r,"color.byDimDef.label")));else if(!p&&"byDimension"===d&&f.length){if((l=t.getValue(r,"color.byDimDef"))&&l.activeDimensionIndex>-1)l.activeDimensionIndex=Math.min(l.activeDimensionIndex,f.length-1),c=f[l.activeDimensionIndex],(h=n.getColorByDefinition("dimension",!1,c)).activeDimensionIndex=l.activeDimensionIndex,o(r,h);else if(!l||!l.key){c=f[f.length-1];var y=a.split(".");if(2===f.length&&"map"===v&&"point"===r.layers[Number(y[1])].type&&(c=f[0]),u=e.getById(c.qAttributeDimensions,e.IDMAP.COLOR_BY_ALTERNATIVE),o(r,n.getColorByDefinition("dimension",!!u,u||c)),u)return}s(r,!0,f,g,m,t.getValue(r,"color.byDimDef.label"))}else if(p||"byMeasure"!==d||!f.length||"map"!==v&&!m.length)"byMultiple"===d&&m.length<2&&t.setValue(r,"color.mode","primary"),i(f,g);else{if((l=t.getValue(r,"color.byMeasureDef"))&&l.activeMeasureIndex>-1){if(l.activeMeasureIndex=Math.min(l.activeMeasureIndex,m.length-1),l.activeMeasureIndex>-1){var b=m[l.activeMeasureIndex];(h=n.getColorByDefinition("measure",!1,b)).activeMeasureIndex=l.activeMeasureIndex,o(r,h)}}else if((!l||!l.key)&&m.length){var x=m[0];if(c=f[f.length-1],u=e.getById(c.qAttributeExpressions,e.IDMAP.COLOR_BY_ALTERNATIVE),o(r,n.getColorByDefinition("measure",!!u,u||x)),u)return}s(r,!1,f,g,m,t.getValue(r,"color.byMeasureDef.label"))}},setColorByPropertyDef:o,resolveColorByPropertyDef:s,clearColorByItem:i}}),define("client.utils/default-property-logic",["core.utils/feature-flags","client.utils/theme/theme-module","client.utils/property-resolver","client.utils/property-hypercube-helper","client.utils/color-support"],function(e,t,n,i,r){function o(e){return!0!==n.getValue(e,"color.reverseScheme")}function s(e){return"byExpression"===n.getValue(e,"color.mode")&&!1===n.getValue(e,"color.expressionIsColor")}function a(e){return"byExpression"===n.getValue(e,"color.mode")&&!0===n.getValue(e,"color.expressionIsColor")}function l(e){var t=i.getDimensionLayouts(e)[0];return t&&t.qCardinal>g}function c(e){return"byDimension"===e.color.mode&&!(n.getValue(e,"color.byDimDef.activeDimensionIndex")>-1)||"byMeasure"===e.color.mode&&!(n.getValue(e,"color.byMeasureDef.activeMeasureIndex")>-1)}function u(){var e=[];return v.dataPalettes.forEach(function(t){if("true"!==t.disabled){var n={type:"classes",component:"color-scale",translation:t.translation||t.name,value:t.propertyValue};"pyramid"===t.type?n.colors=t.scale[t.scale.length-1]:n.colors=t.scale,e.push(n)}}),e}function h(){var e=[];return v.scales.forEach(function(t){if(!t.disabled){var n={component:"color-scale",reverse:this.helpers.schemeIsReverse,translation:t.translation||t.name,value:t.propertyValue};"class-pyramid"===t.type?(n.colors=t.scale[t.scale.length-1],n.type="classes"):(n.colors=t.scale,n.type="gradient"),e.push(n)}},this),e}function d(e){return!!e&&(e.coloring&&e.coloring.baseColor&&e.coloring.baseColor.color?e.coloring.baseColor:!(!e.baseColor||!e.baseColor.color)&&e.baseColor)}function p(e){return n.getValue(e,"layout.qHyperCube.qMeasureInfo",[]).filter(function(e){return!!d(e)}).length>0}function f(e){var t=n.getValue(e,"layout.layers",!1);return t?t.filter(function(e){return n.getValue(e,"qHyperCube.qDimensionInfo",[]).filter(function(e){return!!d(e)}).length>0}).length>0:n.getValue(e,"layout.qHyperCube.qDimensionInfo",[]).filter(function(e){return!!d(e)}).length>0}function m(e,t){return(x[e]||b)[t]||b[t]}var g=1e3,v=t.get(),y=r.baseColor,b={showLegend:function(e){var t=n.getValue(e,"color.auto"),r=n.getValue(e,"color.mode"),o=n.getValue(e,"color.expressionIsColor"),s=i.getNumDimensions(e),a=i.getNumMeasures(e);return t&&(s>1||a>1)||!t&&"primary"!==r&&("byExpression"!==r||!o)},colorModeOptions:{primary:function(){return!0},dimension:function(e){return i.getNumMeasures(e)<=1},multiColor:function(e){return i.getNumMeasures(e)>1},measure:function(){return!0},expression:function(e){return i.getNumMeasures(e)>=1}},persistentColorsShow:function(e){return!n.getValue(e,"color.auto")&&"byDimension"===n.getValue(e,"color.mode")&&i.getNumMeasures(e)<=1},useDimValColShow:function(e){return void 0===n.getValue(e,"color.useDimColVal")&&n.setValue(e,"color.useDimColVal",!1),!n.getValue(e,"color.auto")&&"byDimension"===n.getValue(e,"color.mode")&&"libraryItem"===n.getValue(e,"color.byDimDef.type")},expressionLabelChange:function(e){var t=n.getValue(e,"qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),i=n.getValue(e,"color");t&&(t.label=n.getValue(e,"color.expressionLabel"),i&&(i.colorExpression=t.qExpression))},attributeExpressionChange:function(e){var t=n.getValue(e,"qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),i=n.getValue(e,"color");t&&(t.id="colorByExpression",i&&(i.colorExpression=t.qExpression))},attributeExpressionGlobalChange:function(e){var t,i,r,o=n.getValue(e,"qHyperCubeDef.qMeasures",[]),s=n.getValue(e,"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",[]),a=null,l=function(e,t){"colorByExpression"===e.id&&(i=t)};if(o.length+s.length>1){for(t=s.length-1;t>=0;--t)r=s[t].qAttributeExpressions||[],i=-1,r.every(l),i>=0&&(a=r.splice(i,1)[0]);for(t=o.length-1;t>=0;--t)r=o[t].qAttributeExpressions||[],i=-1,r.every(l),i>=0&&(a=r.splice(i,1)[0]);o.length&&(!o[0].qAttributeExpressions&&a&&(o[0].qAttributeExpressions=[]),a&&o[0].qAttributeExpressions.splice(0,0,a))}var c=n.getValue(e,"color.colorExpression");1!==o.length||o[0].qAttributeExpressions&&0!==o[0].qAttributeExpressions.length||!c||(o[0].qAttributeExpressions=[{qExpression:c,id:"colorByExpression"}])},colorByGlobalChange:function(e,t,n){r.colorByUpdater(e,n)}},x={scatterplot:{colorModeOptions:{primary:function(){return!0},dimension:function(){return!0},multiColor:function(){return!1},measure:function(){return!0},expression:function(e){return i.getNumMeasures(e)>=1}},showLegend:function(e){return"primary"!==n.getValue(e,"color.mode")&&!n.getValue(e,"color.auto")},persistentColorsShow:function(e){return!n.getValue(e,"color.auto")&&"byDimension"===n.getValue(e,"color.mode")}},piechart:{showLegend:function(e){var t=n.getValue(e,"color.auto"),i=n.getValue(e,"color.expressionIsColor"),r=n.getValue(e,"color.mode");return!(!t&&"primary"===r||!t&&"byExpression"===r&&(i||void 0===i))},dimPrimaryMode:!0},linechart:{colorModeOptions:{primary:function(){return!0},dimension:function(e){return i.getNumDimensions(e)>1},multiColor:function(e){return i.getNumMeasures(e)>1},measure:function(e){return i.getNumDimensions(e)<=1},expression:function(e){return i.getNumMeasures(e)>=1}}},map:{colorModeOptions:{primary:function(){return!0},dimension:function(e){return i.getNumDimensions(e)>=1},multiColor:function(e){return i.getNumMeasures(e)>1},measure:function(e){return i.getNumDimensions(e)>=1},expression:function(e){return i.getNumDimensions(e)>=1}}},distributionplot:{colorModeOptions:{primary:function(){return!0},dimension:function(){return e.COLOR_BY_DIM},multiColor:function(){return!1},measure:function(){return e.COLOR_BY_MEA},expression:function(e){return i.getNumDimensions(e)>=1}}}},q=function(e,t){var r=m(t,"colorModeOptions"),d=m(t,"persistentColorsShow"),g=m(t,"useDimValColShow"),b=m(t,"expressionLabelChange"),x=m(t,"attributeExpressionChange"),q=m(t,"attributeExpressionGlobalChange"),C=m(t,"colorByGlobalChange");this.helpers={schemeIsReverse:o,showCompressionResolution:l,colorModeOptions:r,getMeasureSchemeOptions:h.bind(this),getDimensionSchemeOptions:u},this.color={colorMode:{options:function(t){var n=[];return"explore"===e&&n.push({value:"auto",translation:"Common.Auto"}),r.primary(t)&&n.push({value:"primary",translation:"properties.colorMode.primary"}),r.multiColor(t)&&n.push({value:"byMultiple",translation:"properties.colorMode.multicolored"}),r.dimension(t)&&n.push({value:"byDimension",translation:"properties.colorMode.byDimension"}),r.measure(t)&&n.push({value:"byMeasure",translation:"properties.colorMode.byMeasure"}),r.expression(t)&&"explore"!==e&&n.push({value:"byExpression",translation:"properties.colorMode.byExpression"}),n},show:function(e){return!n.getValue(e,"color.auto")}},paletteColor:{show:function(e,t){if(!n.getValue(e,"color.paletteColor")){var i={index:-1,color:v.resolveColor(n.getValue(e,"color.singleColor"))};n.setValue(e,"color.paletteColor",i)}return!n.getValue(e,"color.auto")&&"primary"===n.getValue(e,"color.mode")&&!(y.isSupported(e.visualization)&&p(t)&&"measure"===n.getValue(e,"color.useBaseColors")||f(t)&&"dimension"===n.getValue(e,"color.useBaseColors"))},defaultValue:function(){var e=v.dataColors.primaryColor,t=v.currentPalette.indexOf(e);return{index:-1===t?Math.min(6,v.currentPalette.length-1):t}}},colorBy:{globalChange:C,dimension:{show:function(e){return!n.getValue(e,"color.auto")&&"byDimension"===n.getValue(e,"color.mode")}},measure:{show:function(e){return!n.getValue(e,"color.auto")&&"byMeasure"===n.getValue(e,"color.mode")}},label:{show:function(e){return!n.getValue(e,"color.auto")&&c(e)&&("byDimension"===n.getValue(e,"color.mode")&&"libraryItem"!==n.getValue(e,"color.byDimDef.type")||"byMeasure"===n.getValue(e,"color.mode")&&"libraryItem"!==n.getValue(e,"color.byMeasureDef.type"))}}},baseColor:{show:function(e,t){var i=n.getValue(e,"color.mode");return!n.getValue(e,"color.auto")&&("byMultiple"===i||"primary"===i)&&(p(t)&&y.isSupported(e.visualization)||f(t))},showColors:function(e,t){return!n.getValue(e,"color.auto")&&"byMultiple"===n.getValue(e,"color.mode")&&"measure"===n.getValue(e,"color.useBaseColors")&&y.isSupported(e.visualization)&&t.layout.qHyperCube.qMeasureInfo.length>1&&p(t)},hasMeasureColor:function(e){return p(e)},hasDimensionColor:function(e){return f(e)},isSupported:function(e){return y.isSupported(e)}},persistentColors:{show:function(e){return g(e)?d(e)&&!n.getValue(e,"color.useDimColVal"):d(e)},readOnly:function(e){return n.getValue(e,"qHyperCubeDef.qDimensions.length")>1}},useDimColVal:{show:g},attributeExpression:{change:x,globalChange:q,show:function(e){return!n.getValue(e,"color.auto")&&"byExpression"===n.getValue(e,"color.mode")&&i.getNumMeasures(e)>0}},expressionIsColor:{show:function(e){return!n.getValue(e,"color.auto")&&"byExpression"===n.getValue(e,"color.mode")&&i.getNumMeasures(e)>0}},expressionLabel:{change:b,show:function(e){return!n.getValue(e,"color.auto")&&s(e)&&i.getNumMeasures(e)>0}},colorSchemeMeasure:{show:function(e){return!n.getValue(e,"color.auto")&&("byMeasure"===n.getValue(e,"color.mode")||s(e))}},reverseScheme:{show:function(e){return!n.getValue(e,"color.auto")&&("byMeasure"===n.getValue(e,"color.mode")||s(e))}},colorSchemeDimension:{show:function(e,t){return!(g(e)&&n.getValue(e,"color.useDimColVal")||n.getValue(e,"color.auto")||"byDimension"!==n.getValue(e,"color.mode")&&"byMultiple"!==n.getValue(e,"color.mode")||"measure"===n.getValue(e,"color.useBaseColors")&&y.isSupported(e.visualization)&&p(t)&&("byMultiple"===n.getValue(e,"color.mode")||n.getValue(e,"color.auto")&&t.layout.qHyperCube.qMeasureInfo.length>1))}},customRange:{show:function(e){return!n.getValue(e,"color.auto")},autoMinMax:{show:function(e){return"byMeasure"===n.getValue(e,"color.mode")||s(e)}},min:{show:function(e){return("byMeasure"===n.getValue(e,"color.mode")||s(e))&&!1===n.getValue(e,"color.autoMinMax")},invalid:function(e){return"minMax"===n.getValue(e,"color.minMax")&&n.getValue(e,"color.measureMin")>=n.getValue(e,"color.measureMax")}},max:{show:function(e){return("byMeasure"===n.getValue(e,"color.mode")||s(e))&&!1===n.getValue(e,"color.autoMinMax")},invalid:function(e){return"minMax"===n.getValue(e,"color.minMax")&&n.getValue(e,"color.measureMin")>=n.getValue(e,"color.measureMax")}}}};var S=m(t,"showLegend");this.legend={show:S,showTitle:{show:function(e){return n.getValue(e,"legend.show")&&S(e)&&!a(e)}},dock:{show:function(e){return n.getValue(e,"legend.show")&&S(e)}}}};return{getLogicFor:function(e,t){return new q(e,t)}}}),define("client.property-panel/default-properties",["client.utils/property-resolver","client.property-panel/default-sorting-properties","client.property-panel/default-axis-properties","general.utils/number-formatting","translator","client.utils/theme/theme-module","general.utils/string-limits","util","client.utils/default-property-logic","core.utils/feature-flags"],function(e,t,n,i,r,o,s,a,l,c){function u(t,n){return e.getValue(t,"qDef.qNumFormat.qFmt")===i.getDefaultNumericFormat(t.qDef.qNumFormat,n?n.localeInfo:"")}function h(t){var n=e.getValue(t,"qDef.qNumFormat.qType");return["R","M","IV"].contains(n)||"U"!==n&&!1===e.getValue(t,"qDef.numFormatFromTemplate",!0)}var d={sorting:t,axis:n},p=o.get(),f=l.getLogicFor("hard","default");return d.general={type:"items",translation:"properties.general",grouped:!0,items:{showTitles:{translation:"properties.showTitles",type:"boolean",ref:"showTitles",component:"switch",defaultValue:!0,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],snapshot:{tid:"property-showTitles"}},titles:{type:"items",show:function(e){return!1!==e.showTitles},items:{title:{translation:"Common.Title",component:"string",expression:"optional",ref:"title",defaultValue:""},subtitle:{translation:"properties.subtitle",type:"string",expression:"optional",ref:"subtitle",defaultValue:""},footnote:{translation:"properties.footnote",type:"string",expression:"optional",ref:"footnote",defaultValue:""}}},details:{type:"items",show:!0,items:{showDetails:{translation:"properties.showDetails",type:"boolean",ref:"showDetails",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Show"},{value:!1,translation:"properties.hide"}]},allowShowDetailsMessage:{component:"text",translation:"properties.allowShowDetails",style:"hint"}}}}},d.metadata={type:"items",translation:"properties.metadata",schemaIgnore:!0,show:function(e){return"masterobject"===e.qInfo.qType},grouped:!0,items:{name:{translation:"Common.Name",type:"string",ref:"qMetaDef.title",minlength:1,rollbackInvalid:!0,show:function(e){return e.qMetaDef}},labelExpression:{translation:"metadata.labelExpression",type:"string",component:"expression",expressionType:"StringExpression",expression:"always",change:function(e){a.getValue(e,"labelExpression.qStringExpression.qExpr")||(e.labelExpression=void 0)},ref:"labelExpression",show:function(e){return e.qMetaDef&&c.LABEL_EXPR}},description:{translation:"Common.Description",type:"string",component:"textarea",change:function(e,t,n){"object"==typeof n.qMetaDef.description?(n.descriptionExpression=n.qMetaDef.description,n.qMetaDef.description=""):"string"==typeof n.descriptionExpression&&n.descriptionExpression&&(n.qMetaDef.description=n.descriptionExpression,n.descriptionExpression=void 0)},refFn:function(e){return c.DESCRIPTION_EXPR&&"object"==typeof e.descriptionExpression?"descriptionExpression":"qMetaDef.description"},maxlength:s.description,show:function(e){return e.qMetaDef}},tags:{translation:"Common.Tags",component:"tags",type:"array",ref:"qMetaDef.tags",show:function(e){return e.qMetaDef}}}},c.DESCRIPTION_EXPR&&(d.metadata.items.description.expression="optional"),d.settings={type:"items",component:"expandable-items",translation:"Common.Appearance",items:{metadata:d.metadata,general:d.general}},d.addons={type:"items",component:"expandable-items",translation:"properties.addons",items:{}},d.dimensions={type:"array",component:"dimensions",translation:"Common.Dimensions",alternativeTranslation:"properties.alternative.dimensions",ref:"qHyperCubeDef.qDimensions",disabledRef:"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions",min:1,allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.dimensions.add",grouped:!0,items:{libraryId:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qLibraryId",translation:"Common.Dimension",show:function(e){return e.qLibraryId}},inlineDimension:{component:"inline-dimension",show:function(e){return!e.qLibraryId}},autoSort:{ref:"qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qDef.cId",type:"string",show:!1},nullSuppression:{type:"boolean",ref:"qNullSuppression",defaultValue:!1,translation:"properties.dimensions.showNull",inverted:!0},dimensionLimits:{type:"items",items:{otherMode:{type:"string",component:"dropdown",ref:"qOtherTotalSpec.qOtherMode",translation:"properties.dimensionLimits.limitation",options:[{value:"OTHER_OFF",translation:"properties.dimensionLimits.none"},{value:"OTHER_COUNTED",translation:"properties.dimensionLimits.fixedNumber"},{value:"OTHER_ABS_LIMITED",translation:"properties.dimensionLimits.exactValue"},{value:"OTHER_REL_LIMITED",translation:"properties.dimensionLimits.relativeValue"}],defaultValue:"OTHER_OFF",readOnly:function(e,t){return 0===t.getMeasures().length},change:function(t){var n,i=e.getValue(t,"qOtherTotalSpec.qOtherMode");"OTHER_REL_LIMITED"===i?(n=e.getValue(t,"qOtherTotalSpec.qOtherLimit.qv","0")).length&&"%"!==n[n.length-1]&&a.isNumeric(n)&&(t.qOtherTotalSpec.qOtherLimit||e.setValue(t,"qOtherTotalSpec.qOtherLimit",{qv:"0"}),t.qOtherTotalSpec.qOtherLimit.qv=n+"%"):"OTHER_ABS_LIMITED"===i&&(n=e.getValue(t,"qOtherTotalSpec.qOtherLimit.qv","0")).length&&"%"===n[n.length-1]&&(t.qOtherTotalSpec.qOtherLimit||e.setValue(t,"qOtherTotalSpec.qOtherLimit",{qv:"0"}),t.qOtherTotalSpec.qOtherLimit.qv=n.substr(0,n.length-1))}},otherSortMode:{type:"string",component:"buttongroup",ref:"qOtherTotalSpec.qOtherSortMode",options:[{value:"OTHER_SORT_DESCENDING",translation:"properties.dimensionLimits.fixedNumber.sortDescendingLabel"},{value:"OTHER_SORT_ASCENDING",translation:"properties.dimensionLimits.fixedNumber.sortAscendingLabel"}],defaultValue:"OTHER_SORT_DESCENDING",show:function(t,n){return"OTHER_COUNTED"===e.getValue(t,"qOtherTotalSpec.qOtherMode")&&n.getMeasures().length>0}},otherCounted:{component:"expression",expressionType:"ValueExpr",ref:"qOtherTotalSpec.qOtherCounted",defaultValue:{qv:"10"},show:function(t,n){return"OTHER_COUNTED"===e.getValue(t,"qOtherTotalSpec.qOtherMode")&&n.getMeasures().length>0}},otherLimitMode:{type:"string",component:"buttongroup",ref:"qOtherTotalSpec.qOtherLimitMode",options:[{value:"OTHER_GE_LIMIT",label:">=",tooltipTranslation:"properties.greaterOrEqualTo"},{value:"OTHER_GT_LIMIT",label:">",tooltipTranslation:"properties.greaterThan"},{value:"OTHER_LT_LIMIT",label:"<",tooltipTranslation:"properties.lessThan"},{value:"OTHER_LE_LIMIT",label:"<=",tooltipTranslation:"properties.lessOrEqualTo"}],defaultValue:"OTHER_GE_LIMIT",icon:!0,smallIconFont:!0,show:function(t,n){var i=e.getValue(t,"qOtherTotalSpec.qOtherMode");return("OTHER_ABS_LIMITED"===i||"OTHER_REL_LIMITED"===i)&&n.getMeasures().length>0}},otherLimit:{component:"expression",expressionType:"ValueExpr",ref:"qOtherTotalSpec.qOtherLimit",defaultValue:{qv:"0"},show:function(t,n){var i=e.getValue(t,"qOtherTotalSpec.qOtherMode");return("OTHER_ABS_LIMITED"===i||"OTHER_REL_LIMITED"===i)&&n.getMeasures().length>0}},calculatedAgainstMessage:{component:"text",label:function(e,t){var n=t.getMeasureLayouts()[0];return n?r.get("Properties.DimensionLimits.CalculatedAgainst",n.qFallbackTitle):r.get("Properties.DimensionLimits.NoMeasure")},show:function(t){return"OTHER_OFF"!==e.getValue(t,"qOtherTotalSpec.qOtherMode")}}}},others:{type:"items",items:{suppressOther:{type:"boolean",ref:"qOtherTotalSpec.qSuppressOther",translation:"properties.dimensionLimits.showOthers",inverted:!0,defaultValue:!1,show:function(t,n){return"OTHER_OFF"!==e.getValue(t,"qOtherTotalSpec.qOtherMode")&&n.getMeasures().length>0}},othersLabel:{type:"string",expression:"optional",ref:"qDef.othersLabel",translation:"properties.dimensionLimits.othersLabel",defaultValue:function(){return r.get("properties.dimensionLimits.others")},change:function(e){if(e.qDef){var t=e.qDef.othersLabel||"";"object"==typeof t?(t=t.qStringExpression&&t.qStringExpression.qExpr||"",e.qOtherLabel={qv:0===t.indexOf("=")?t:"="+t}):e.qOtherLabel={qv:t}}},show:function(t,n){return!e.getValue(t,"qOtherTotalSpec.qSuppressOther")&&"OTHER_OFF"!==e.getValue(t,"qOtherTotalSpec.qOtherMode")&&n.getMeasures().length>0}},othersLabel2:{type:"string",component:"expression",expressionType:"StringExpr",ref:"qOtherLabel",translation:"properties.dimensionLimits.othersLabel",defaultValue:function(){return r.get("properties.dimensionLimits.others")},show:!1}}}}},d.measures={type:"array",component:"measures",translation:"Common.Measures",ref:"qHyperCubeDef.qMeasures",disabledRef:"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",min:1,allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.measures.add",grouped:!0,items:{libraryId:{type:"string",component:"library-item",libraryItemType:"measure",ref:"qLibraryId",translation:"Common.Measure",show:function(e){return e.qLibraryId}},inlineMeasure:{component:"inline-measure",show:function(e){return!e.qLibraryId}},autoSort:{ref:"qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qDef.cId",type:"string",show:!1},numberFormatting:{type:"items",items:{numberFormattingType:{type:"string",component:"custom-formatter-dropdown",ref:"qDef.qNumFormat.qType",translation:"properties.numberFormatting",defaultValue:"U",schemaIgnore:!0,options:[{value:"U",translation:"Common.Auto"},{value:"F",translation:"properties.numberFormatting.types.number"},{value:"M",translation:"properties.numberFormatting.types.money"},{value:"D",translation:"properties.numberFormatting.types.date"},{value:"IV",translation:"properties.numberFormatting.types.duration"},{value:"R",translation:"Common.Custom"},{value:"OFF",translation:"properties.numberFormatting.types.customFormatting"}],change:function(e,t,n,r){i.setNumFmtPattern("qType",e.qDef.qNumFormat,r.localeInfo)}},numberFormattingMode:{type:"boolean",component:"switch",ref:"qDef.numFormatFromTemplate",translation:"properties.numberFormatting.formatting",defaultValue:!0,options:[{value:!0,translation:"properties.numberFormatting.simple"},{value:!1,translation:"Common.Custom"}],show:function(t){return["F","D","TS","T"].contains(e.getValue(t,"qDef.qNumFormat.qType"))}},numberFormattingTemplates:{type:"string",component:"number-formatter-dropdown",ref:"qDef.qNumFormat.qFmt",defaultValue:"#,##0",schemaIgnore:!0,show:function(t){var n=e.getValue(t,"qDef.qNumFormat.qType");return["F","D","TS","T"].contains(n)&&!0===e.getValue(t,"qDef.numFormatFromTemplate",!0)}},numDecimals:{type:"integer",ref:"qDef.qNumFormat.qnDec",translation:"properties.numberFormatting.nDec",defaultValue:2,schemaIgnore:!0,min:0,max:14,show:!1},numPrecisionDigits:{type:"integer",ref:"qDef.qNumFormat.qnDec",translation:"properties.numberFormatting.significantFigures",defaultValue:10,schemaIgnore:!0,min:1,max:14,show:!1},decimalSep:{type:"string",ref:"qDef.qNumFormat.qDec",translation:"properties.numberFormatting.dec",defaultValue:".",schemaIgnore:!0,show:function(t){return"R"===e.getValue(t,"qDef.qNumFormat.qType")},change:function(e,t,n,r){i.setNumFmtPattern("qDec",e.qDef.qNumFormat,r.localeInfo)},invalid:function(t){return e.getValue(t,"qDef.qNumFormat.qDec")===e.getValue(t,"qDef.qNumFormat.qThou")},readOnly:function(e,t,n,i){return!u(e,i)}},thousandSep:{type:"string",ref:"qDef.qNumFormat.qThou",translation:"properties.numberFormatting.thousandSeparator",defaultValue:"",schemaIgnore:!0,show:function(t){return"R"===e.getValue(t,"qDef.qNumFormat.qType")},change:function(e,t,n,r){i.setNumFmtPattern("qThou",e.qDef.qNumFormat,r.localeInfo)},invalid:function(t){return"I"!==e.getValue(t,"qDef.qNumFormat.qType")&&e.getValue(t,"qDef.qNumFormat.qDec")===e.getValue(t,"qDef.qNumFormat.qThou")},readOnly:function(e,t,n,i){return!u(e,i)}},format:{type:"string",component:"number-formatter",ref:"qDef.qNumFormat.qFmt",resetTranslation:"properties.numberFormatting.resetPattern",translation:"properties.numberFormatting.formatPattern",defaultValue:"",schemaIgnore:!0,show:function(e){return h(e)},change:function(e){e.qDef.qNumFormat.qFmt=i.getNormalizedFormat(e.qDef.qNumFormat,e.qDef.qNumFormat.qFmt)},invalid:function(e,t,n){if(["D","T","TS","IV"].contains(e.qDef.qNumFormat.qType))return!1;var i="R"===e.qDef.qNumFormat.qType?e.qDef.qNumFormat.qDec:n.localeInfo["q"+("M"===e.qDef.qNumFormat.qType?"Money":"")+"DecimalSep"],r=new RegExp("(0|#)"+a.escapeRegExp(i)+"0*#*"),o=(e.qDef.qNumFormat.qFmt||"").split(";"),s=o[0].match(r),l=s&&s[0]?s[0].length-2:0,c=o[1]?o[1].match(r):null,u=c&&c[0]?c[0].length-2:0;return l>15||u>15}}}}}},d.reflines={type:"array",ref:"refLine.refLines",translation:"properties.referenceLines",itemTitleRef:"label",allowAdd:!0,allowRemove:!0,allowMove:!0,add:function(e,t){var n=p.initializeService("object."+p.getMatch(t.visualization||t.qInfo.qType)).getStyle("referenceLine.label.name","color"),i=p.currentPalette.indexOf(n);e.paletteColor={index:i,color:n}},addTranslation:"properties.referenceLines.add",items:{show:{ref:"show",translation:"Common.Show",type:"boolean",defaultValue:!0},label:{ref:"label",translation:"Common.Label",type:"string"},paletteColor:{ref:"paletteColor",translation:"properties.color",type:"object",component:"color-picker",dualOutput:!0,show:function(t){if(!e.getValue(t,"paletteColor")){var n={index:-1,color:p.resolveColor(e.getValue(t,"color"))};e.setValue(t,"paletteColor",n)}return!0}},expressionValue:{ref:"refLineExpr.value",translation:"properties.referenceLines.expression",type:"number",expression:"optional",expressionType:"ValueExpression",defaultValue:0,change:function(e){var t=e.refLineExpr;"object"==typeof t.value?t.label={qStringExpression:{qExpr:t.value.qValueExpression.qExpr}}:t.label=""+t.value}},expressionLabel:{ref:"refLineExpr.label",translation:"properties.referenceLines.expression",type:"string",expression:"optional",expressionType:"StringExpression",defaultValue:"0",show:!1}}},d.staticCalcCond={type:"items",items:{expr:{ref:"qHyperCubeDef.qCalcCond",type:"string",component:"expression",expressionType:"ValueExpr",translation:"properties.hyperCube.calcCond"},customErrorMessage:{ref:"qHyperCubeDef.customErrorMessage.calcCond",component:"textarea",defaultValue:"",type:"string",placeholderTranslation:"Object.ErrorMessage.CalculationCondition",translation:"properties.hyperCube.calcCondMessage",show:function(t){var n=e.getValue(t,"qHyperCubeDef.qCalcCond");return n.qv&&""!==n.qv}}}},d.dataHandling={type:"items",translation:"properties.dataHandling",grouped:!0,items:{suppressZero:{ref:"qHyperCubeDef.qSuppressZero",defaultValue:!1,translation:"properties.hyperCube.showZero",type:"boolean",inverted:!0},calcCond:{uses:"staticCalcCond"}}},d.calcCond={component:"calc-cond",ref:"qHyperCubeDef",schemaIgnore:!0},d.colorsAndLegend={type:"items",translation:"properties.colorsAndLegend",grouped:!0,items:{colors:{type:"items",items:{autoColor:{ref:"color.auto",type:"boolean",translation:"properties.colors",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},colorMode:{ref:"color.mode",type:"string",component:"dropdown",options:f.color.colorMode.options,defaultValue:"primary",show:f.color.colorMode.show,globalChange:function(e,t){f.color.colorBy.globalChange(e,t,"qHyperCubeDef.")}},colorByDimension:{ref:"color.byDimDef",schemaIgnore:!0,translation:"properties.colorBy.selectDimension",type:"object",defaultValue:{},component:"color-by-dropdown",libraryItemType:"dimension",show:f.color.colorBy.dimension.show,change:function(t){t.color.altLabel=e.getValue(t,"color.byDimDef.label","")}},colorByMeasure:{ref:"color.byMeasureDef",schemaIgnore:!0,translation:"properties.colorBy.selectMeasure",type:"object",defaultValue:{},component:"color-by-dropdown",libraryItemType:"measure",show:f.color.colorBy.measure.show,change:function(t){t.color.altLabel=e.getValue(t,"color.byMeasureDef.label","")}},colorByLabel:{type:"string",ref:"color.altLabel",schemaIgnore:!0,translation:"Common.Label",show:f.color.colorBy.label.show,change:function(t){f.color.colorBy.measure&&f.color.colorBy.measure.show(t)?t.color.byMeasureDef.label=e.getValue(t,"color.altLabel",""):f.color.colorBy.dimension&&f.color.colorBy.dimension.show(t)&&(t.color.byDimDef.label=e.getValue(t,"color.altLabel",""))}},baseColors:{type:"items",items:{useBaseColor:{ref:"color.useBaseColors",type:"string",translation:"properties.useLibraryColors",component:"dropdown",show:f.color.baseColor.show,globalChange:function(t){"byMultiple"===e.getValue(t,"color.mode","")&&"dimension"===e.getValue(t,"color.useBaseColors","")&&e.setValue(t,"color.useBaseColors","measure")},defaultValue:"off",options:function(e,t){var n=[{value:"off",translation:"Common.None"}];return f.color.baseColor.hasMeasureColor(t)&&f.color.baseColor.isSupported(e.visualization)&&n.push({value:"measure",translation:"Common.Measure"}),f.color.baseColor.hasDimensionColor(t)&&"byMultiple"!==e.color.mode&&n.push({value:"dimension",translation:"Common.Dimension"}),n}},measureColor:{translation:"properties.libraryColors",component:"measure-color",show:f.color.baseColor.showColors}}},paletteColor:{ref:"color.paletteColor",translation:"properties.color",type:"object",component:"color-picker",readOnly:f.color.paletteColor.readOnly,dualOutput:!0,show:f.color.paletteColor.show,defaultValue:f.color.paletteColor.defaultValue},useDimColVal:{ref:"color.useDimColVal",translation:"properties.libraryColors",type:"boolean",component:"switch",defaultValue:!0,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],show:f.color.useDimColVal.show},useMeasureGradient:{ref:"color.useMeasureGradient",translation:"properties.libraryColors",type:"boolean",component:"switch",schemaIgnore:!0,defaultValue:!1,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],show:function(t){var n=e.getValue(t,"color.auto"),i=e.getValue(t,"color.mode");return c.MES_COL&&!n&&"byMeasure"===i&&"libraryItem"===e.getValue(t,"color.byMeasureDef.type")}},persistentColors:{ref:"color.persistent",translation:"properties.colorPersistence",type:"boolean",defaultValue:!1,show:f.color.persistentColors.show,readOnly:f.color.persistentColors.readOnly},attributeExpression:{type:"string",component:"expression",expressionType:"measure",schemaIgnore:!0,ref:"qHyperCubeDef.qMeasures.0.qAttributeExpressions.0.qExpression",change:f.color.attributeExpression.change,globalChange:f.color.attributeExpression.globalChange,translation:"Common.Expression",show:f.color.attributeExpression.show},expressionIsColor:{ref:"color.expressionIsColor",translation:"properties.expressionIsColor",type:"boolean",defaultValue:!0,show:f.color.expressionIsColor.show},expressionLabel:{type:"string",ref:"color.expressionLabel",translation:"Common.Label",change:f.color.expressionLabel.change,show:f.color.expressionLabel.show},colorSchemeMeasure:{ref:"color.measureScheme",type:"string",translation:"properties.colorScheme",component:"item-selection-list",defaultValue:e.getValue(p,"scales.0.propertyValue","sg"),items:f.helpers.getMeasureSchemeOptions,show:function(t){return f.color.colorSchemeMeasure.show(t)&&(!c.MES_COL||!e.getValue(t,"color.useMeasureGradient"))}},reverseScheme:{ref:"color.reverseScheme",translation:"properties.reverseColorScheme",type:"boolean",defaultValue:!1,show:f.color.reverseScheme.show},colorSchemeDimension:{ref:"color.dimensionScheme",type:"string",translation:"properties.colorScheme",component:"item-selection-list",defaultValue:e.getValue(p,"dataPalettes.0.propertyValue","12"),items:f.helpers.getDimensionSchemeOptions,show:f.color.colorSchemeDimension.show},customRange:{type:"items",items:{autoMinMax:{ref:"color.autoMinMax",type:"boolean",translation:"properties.axis.range",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],show:f.color.customRange.autoMinMax.show},min:{ref:"color.measureMin",translation:"properties.axis.min",expression:"optional",type:"number",show:f.color.customRange.min.show,invalid:f.color.customRange.min.invalid},max:{ref:"color.measureMax",translation:"Common.Max",expression:"optional",type:"number",defaultValue:10,show:f.color.customRange.max.show,invalid:f.color.customRange.max.invalid}},show:f.color.customRange.show}}},legend:{show:f.legend.show,type:"items",items:{show:{ref:"legend.show",type:"boolean",translation:"properties.legend.show",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},dock:{type:"string",component:"dropdown",ref:"legend.dock",translation:"properties.legend.position",options:[{value:"auto",translation:"Common.Auto"},{value:"right",translation:"properties.dock.right"},{value:"bottom",translation:"Common.Bottom"},{value:"left",translation:"properties.dock.left"},{value:"top",translation:"Common.Top"}],defaultValue:"auto",show:f.legend.dock.show},showTitle:{ref:"legend.showTitle",translation:"properties.legend.showTitle",type:"boolean",defaultValue:!0,show:f.legend.showTitle.show}}}}},d.data={type:"items",component:"hypercube-data",translation:"Common.Data",addTranslation:"Properties.AddData",allowAdd:!0,items:{dimensions:d.dimensions,measures:d.measures}},d.layers={component:"layers"},d}),define("client.utils/property-mapper",["client.property-panel/default-properties","client.utils/property-resolver","util"],function(e,t,n){function i(e,n,r){var o,s,a,l=null;if(e.ref===n)return e;if(t.isHierarchical(e))for(o=Object.keys(e.items),a=0;a<o.length;++a){if((s=e.items[o[a]]).ref===n){l=s;break}if(r&&null!==(l=i(s,n,r)))break}return l}function r(i,a,l){var c,u,h;if(l=l||e,i||(i=o),a&&s[a])return s[a];for(var d;i.uses;){if(!(h=t.getValue(l,i.uses)))throw"No defaults found for: "+i.uses;if(d=h.uses,i=n.extend(!0,{},h,i),!d){delete i.uses;break}i.uses=d}return t.isHierarchical(i)||"array"===i.type&&i.items?(u={},Object.keys(i.items).forEach(function(e){i.items[e]&&(u[e]=r(i.items[e],null,l))}),c=n.extend({},i,{items:u})):c=n.extend({},i),a&&!s[a]&&(s[a]=c),c}var o,s={},a={};return o={type:"items",component:"accordion",items:{settings:{uses:"settings"}}},{findDefinition:i,findSnapshotProperties:function(e){function n(e){var r,o,s;if(t.isHierarchical(e))for(r=Object.keys(e.items),s=0;s<r.length;++s)(o=e.items[r[s]]).snapshot&&i.push(o),n(o)}var i=[];return n(e),i},findGlobalListeners:function(e,t){function n(e){e.globalChange&&i.push(e.globalChange),"items"!==e.type&&"array"!==e.type||!e.items||Object.keys(e.items).forEach(function(t){e.items[t]&&n(e.items[t])})}if(t&&a[t])return a[t];var i=[];return n(e),t&&!a[t]&&(a[t]=i),i},mapDefinition:r,mapProperties:function(e,i,o){var s=r(e,o);return i?n.extend(!0,t.getDefaults(s),i):t.getDefaults(s)},getPropertyHierarchy:function(e){function n(e){function i(e){return-1!==e.search(/\.\d/g)}function r(e){var n={type:e.type,defaultValue:t.getDefaultValue(e.type,e)};return e.maxlength&&(n.maxlength=e.maxlength),e.min&&(n.min=e.min),e.max&&(n.max=e.max),e.expression&&(n.expression=e.expression),e.options&&"boolean"!==e.type&&(n.enum=e.options.map(function(e){return e.value})),n}function o(e){var a,l,c,u;if(t.isHierarchical(e))for(a=Object.keys(e.items),c=0;c<a.length;c++)l=a[c],o(e.items[l]);else e.ref&&"array"===e.type&&e.items?(u={type:"array",items:n({type:"items",items:e.items})},i(e.ref)||t.setValue(s,e.ref,u)):e.ref&&(u=r(e),i(e.ref)||t.setValue(s,e.ref,u))}var s={};return o(e),s}return n(e)}}}),define("objects.utils/hypercube-util",["util"],function(e){function t(t,n){return n=n?n+".":"",e.getValue(t,n+"qHyperCube.qDimensionInfo.length")>1}function n(t,n){return n=n?n+".":"",e.getValue(t,n+"qHyperCube.qSize.qcy")}function i(t,n){if(n=n?n+".":"",e.getValue(t,n+"qHyperCube.qStackedDataPages.0.qData.length"))return e.getValue(t,n+"qHyperCube.qStackedDataPages.0.qData.0.qSubNodes.length",0)+e.getValue(t,n+"qHyperCube.qStackedDataPages.0.qData.0.qDown",0)+e.getValue(t,n+"qHyperCube.qStackedDataPages.0.qData.0.qUp",0);var i=e.getValue(t,n+"qHyperCube.qEffectiveInterColumnSortOrder.0"),r=e.getValue(t,n+"qHyperCube.qDimensionInfo."+i+".qStateCounts");return r.qOption+r.qSelected+r.qLocked+1}return{getHyperCube:function(t,n){return t&&(t=n?e.getValue(t,n):t)&&t.qHyperCube?t.qHyperCube:null},hasSecondDimension:t,hasSecondMeasure:function(t,n){return n=n?n+".":"",e.getValue(t,n+"qHyperCube.qMeasureInfo.length")>1},getStackedCubeSizeOf2Dims:i,getStackedCubeSizeOfMax2Dims:function(e,r){return t(e,r)?i(e,r):n(e,r)},getOuterDimensionSizeOfMax2Dims:function(e,n){return t(e,n)?i(e,n):1}}}),define("objects.backend-api/generic-api",["./backend-api"],function(e){"use strict";function t(e,t){if(t){if(e[t]){if(e[t].qHyperCube)return t+".qHyperCube";if(e[t].qListObject)return t+".qListObject"}return-1!==t.indexOf("Def",t.length-3)?t.slice(0,t.length-3):t}return e.qHyperCube?"qHyperCube":"qListObject"}var n;return n=e.extend("GenericApi",{init:function(e,n){var i=t(e.layout,n);this._super(e,"/"+i+"Def"),this.isHyperCube=-1!==this.dataPath.indexOf("qHyperCube"),this.cacheCube.setMethodName(this.isHyperCube?"getHyperCubeData":"getListObjectData")},getBackendApi:function(e){return new n(this.model,e)},getProperties:function(){return this.model.getProperties()},setProperties:function(e){return this.model.setProperties(e)},applyPatches:function(e,t){return this.model.applyPatches(e,t)},clearSoftPatches:function(){return this.model.clearSoftPatches()},save:function(){return this.model.setProperties(this.model.properties)},clearSelections:function(){return this.model.resetMadeSelections()},updateCache:function(e){e&&e[this.dataPath]?(this.cacheCube.set(e[this.dataPath].qDataPages),this.cacheCube.setCubeSize(e[this.dataPath].qSize)):this.cacheCube.clear()},getData:function(e){var t=this.cacheCube.getData(e),n=this;return t.then(function(e){n.model.layout[n.dataPath].qDataPages.push(e[0])}),t},getDataRow:function(e){var t=this.model.layout[this.dataPath];if(t)for(var n=t.qDataPages.length,i=0;i<n;i++){var r=t.qDataPages[i];if(e>=r.qArea.qTop&&e<r.qArea.qTop+r.qArea.qHeight)return r.qMatrix[e-r.qArea.qTop]}return null},selectValues:function(e,t,n){return this.isHyperCube?this.model.selectHyperCubeValues(this.path,e,t,n):this.model.selectListObjectValues(this.path,t,n)},select:function(e,t,n){return this.selectValues(t,e,n)},getReducedData:function(e,t,n){return this.isHyperCube?this.model.getHyperCubeReducedData(this.path,e,t,n||"D1"):null},selectRange:function(e,t,n){return t=!!t,n=n||[],this.model.rangeSelectHyperCubeValues(this.path,e,n,t)},search:function(e){return this.isHyperCube?null:this.model.searchListObjectFor(this.path,e)},abortSearch:function(){return this.isHyperCube?null:this.model.abortListObjectSearch(this.path)},acceptSearch:function(e){return this.isHyperCube?null:this.model.acceptListObjectSearch(this.path,e)},getPivotData:function(e){return this.isHyperCube?this.model.getHyperCubePivotData(this.path,e):null},getStackData:function(e,t){return this.isHyperCube?this.model.getHyperCubeStackData(this.path,e,t||1e3):null},expandTop:function(e,t,n){return this.model.expandTop(this.path,e,t,n||!1)},expandLeft:function(e,t,n){return this.model.expandLeft(this.path,e,t,n||!1)},collapseTop:function(e,t,n){return this.model.collapseTop(this.path,e,t,n)},collapseLeft:function(e,t,n){return this.model.collapseLeft(this.path,e,t,n)}})}),define("objects.utils/data-properties/data-property-handler",["core.utils/class","util","translator","core.utils/feature-flags"],function(e,t,n,i){"use strict";var r;return r="Not supported in this object, need to implement in subclass.",e.extend({init:function(e){e=e||{},this.dimensionDefinition=e.dimensionDefinition||{max:0},this.measureDefinition=e.measureDefinition||{max:0},e.dimensionDefinition&&(this.dimensionProperties=e.dimensionProperties||{}),e.measureDefinition&&(this.measureProperties=e.measureProperties||{}),e.globalChangeListeners&&(this.globalChangeListeners=e.globalChangeListeners),e.addDimensionLabel&&(this.addDimensionLabel=e.addDimensionLabel),this.app=e.app},setProperties:function(e){this.properties=e},setGlobalChangeListeners:function(e){this.globalChangeListeners=e},setLayout:function(e){this.layout=e},type:function(){throw"Must override this method"},getDimensions:function(){return[]},getDimension:function(e){var t=this.getDimensions(),n=0;for(n;n<t.length;++n)if(t[n].qDef.cId===e)return t[n];return null},minDimensions:function(){return"function"==typeof this.dimensionDefinition.min?this.dimensionDefinition.min.call(null,this.properties,this):this.dimensionDefinition.min||0},maxDimensions:function(){return"function"==typeof this.dimensionDefinition.max?this.dimensionDefinition.max.call(null,this.getMeasures().length):isNaN(this.dimensionDefinition.max)?1e4:this.dimensionDefinition.max},canAddDimension:function(){return this.getDimensions().length<this.maxDimensions()},minMeasures:function(){return"function"==typeof this.measureDefinition.min?this.measureDefinition.min.call(null,this.properties,this):this.measureDefinition.min||0},maxMeasures:function(e){var t=e||0;return"function"==typeof this.measureDefinition.max?i.DATA_REORDER?this.measureDefinition.max.call(null,this.getDimensions().length-t):this.measureDefinition.max.call(null,this.getDimensions().length):isNaN(this.measureDefinition.max)?1e4:this.measureDefinition.max},canAddMeasure:function(){return this.getMeasures().length<this.maxMeasures()},getMeasures:function(){return[]},getLabels:function(){return[]},getMeasure:function(e){var t=this.getMeasures(),n=0;for(n;n<t.length;++n)if(t[n].qDef.cId===e)return t[n];return null},addDimension:function(){throw r},getSorting:function(){throw r},addFieldDimension:function(e,t,n){var i=this.createFieldDimension(e,t,n);return this.addDimension(i)},addLibraryDimension:function(e,t){var n=this.createLibraryDimension(e,t);return this.addDimension(n)},addMeasure:function(){throw r},addExpressionMeasure:function(e,t,n){var i=this.createExpressionMeasure(e,t,n);return this.addMeasure(i)},addLibraryMeasure:function(e,t){var n=this.createLibraryMeasure(e,t);return this.addMeasure(n)},addAlternativeFieldDimension:function(e,t,n){var i=this.createFieldDimension(e,t,n);return this.addDimension(i,!0)},addAlternativeLibraryDimension:function(e,t){var n=this.createLibraryDimension(e,t);return this.addDimension(n,!0)},addAlternativeExpressionMeasure:function(e,t,n){var i=this.createExpressionMeasure(e,t,n);return this.addMeasure(i,!0)},addAlternativeLibraryMeasure:function(e,t){var n=this.createLibraryMeasure(e,t);return this.addMeasure(n,!0)},replaceDimension:function(){throw r},replaceMeasure:function(){throw r},autoSortDimension:function(){throw r},autoSortMeasure:function(){throw r},createFieldDimension:function(e,n,i){var r=t.extend(!0,{},this.dimensionProperties||{},i||{});return r.qDef||(r.qDef={}),r.qOtherTotalSpec||(r.qOtherTotalSpec={}),e?(r.qDef.qFieldDefs=[e],r.qDef.qFieldLabels=n?[n]:[""],r.qDef.qSortCriterias=[{qSortByLoadOrder:1}]):(r.qDef.qFieldDefs=[],r.qDef.qFieldLabels=[],r.qDef.qSortCriterias=[]),r.qDef.autoSort=!0,r},createLibraryDimension:function(e,n){var i=t.extend(!0,{},this.dimensionProperties||{},n||{});return i.qDef||(i.qDef={}),i.qOtherTotalSpec||(i.qOtherTotalSpec={}),i.qLibraryId=e,i.qDef.qSortCriterias=[{qSortByLoadOrder:1}],i.qDef.autoSort=!0,delete i.qDef.qFieldDefs,delete i.qDef.qFieldLabels,i},createExpressionMeasure:function(e,n,i){var r=t.extend(!0,{},this.measureProperties||{},i||{});return r.qDef||(r.qDef={}),r.qDef.qNumFormat||(r.qDef.qNumFormat={}),r.qDef.qDef=e,r.qDef.qLabel=n,r.qDef.autoSort=!0,r},createLibraryMeasure:function(e,n){var i=t.extend(!0,{},this.measureProperties||{},n||{});return i.qDef||(i.qDef={}),i.qDef.qNumFormat||(i.qDef.qNumFormat={}),i.qLibraryId=e,i.qDef.autoSort=!0,delete i.qDef.qDef,delete i.qDef.qLabel,i},updateGlobalChangeListeners:function(){this.globalChangeListeners&&(this.globalChangeListeners||[]).forEach(function(e){e&&"function"==typeof e&&e(this.properties,this)}.bind(this))},removeDimension:function(){throw r},removeMeasure:function(){throw r},moveDimension:function(){throw r},moveMeasure:function(){throw r},changeSorting:function(){throw r},getAddDimensionLabel:function(){return this.addDimensionLabel||n.get("Visualization.Requirements.AddDimension")}})}),define("general.utils/array-util",[],function(){function e(e){return e&&"[object Array]"===Object.prototype.toString.call(e)}function t(e){return e&&"function"==typeof e}return{forEach:function(n,i){var r;if(!e(n))throw"No valid items were specified.";if(!t(i))throw"No valid action function was specified.";if(Array.prototype.forEach)n.forEach(i);else for(r in n)i(n[r])},contains:function(t,n){if(!e(t))throw"No valid items were specified.";if(Array.prototype.indexOf)return-1!==t.indexOf(n);for(var i=t.length;i--;)if(t[i]===n)return!0;return!1},move:function(e,t,n){if(n>=e.length)for(var i=n-e.length;1+i--;)e.push(void 0);e.splice(n,0,e.splice(t,1)[0])},swap:function(e,t,n){var i=e[t];e[t]=e[n],e[n]=i},limit:function(e,t){return e.length>t?e.slice(0,t):e},indexAdded:function(e,t){var n;for(n=0;n<e.length;++n)e[n]>=0&&e[n]>=t&&++e[n];e.push(t)},indexAddedAt:function(e,t,n){var i;for(i=0;i<e.length;++i)e[i]>=0&&e[i]>=t&&++e[i];e.splice(n,0,t)},indexRemoved:function(e,t){var n,i=0;for(n=0;n<e.length;++n)e[n]>t?--e[n]:e[n]===t&&(i=n);return e.splice(i,1),i},intersects:function(e,t){if(!(e&&t&&e.length&&t.length))return!1;var n,i=t.length;for(n=0;n<i;n++)if(e.indexOf(t[n])>-1)return!0;return!1},isOrderedSubset:function(e,t){if(!(e&&t&&e.length&&t.length))return!1;var n=e.indexOf(t[0]);if(-1!==n){for(var i=0;i<t.length;i++){var r=e.indexOf(t[i]);if(n>r)return!1;n=r}return!0}return!1},copy:function(e){if(!(e instanceof Array))throw new Error("Argument is not an Array.");return e.slice(0)}}}),define("objects.utils/data-properties/listobject-util",["util"],function(e){"use strict";return{autoSortDimension:function(e,t){return e.qDef.qSortCriterias=[],e.qDef.autoSort=!0,t?t.forEach(function(t,n){e.qDef.qSortCriterias[n]={qSortByState:1,qSortByLoadOrder:1,qSortByNumeric:1,qSortByAscii:1}}):e.qDef.qSortCriterias[0]={qSortByState:1,qSortByLoadOrder:1,qSortByNumeric:1,qSortByAscii:1},e},createFieldDimension:function(e){return{qDef:{qFieldDefs:[e],qFieldLabels:[e],qSortCriterias:[]}}},createLibraryDimension:function(e){return{qLibraryId:e,qDef:{qSortCriterias:[]}}},createDefaultListBox:function(t,n){var i,r=e.extend(!0,{},t);for(r.qShowAlternatives=!0,i=0;i<r.qDef.qSortCriterias.length;++i)r.qDef.qSortCriterias[i].qSortByState=1;return n=!n&&t.qDef.qLabelExpression?{qStringExpression:{qExpr:t.qDef.qLabelExpression}}:n||t.qDef.qFieldLabels&&t.qDef.qFieldLabels.length&&""!==t.qDef.qFieldLabels[0]?n||(t.qDef.qFieldLabels&&t.qDef.qFieldLabels.length?t.qDef.qFieldLabels[0]:""):t.qDef.qFieldDefs[0],{qInfo:{qType:"listbox"},qListObjectDef:r,title:n,visualization:"listbox"}}}}),define("client.assets/tab-contents/fields/assets-directdiscovery-service",[],function(){"use strict";function e(e){return!!e.qTags&&-1!==e.qTags.indexOf("$dd_measure")}function t(e){return!!e.qTags&&-1!==e.qTags.indexOf("$dd_details")}function n(e){return!!e.qTags&&-1!==e.qTags.indexOf("$dd_dimension")}return{isMeasure:e,isDetails:t,isDimension:n,removeMeasureAndDetailsFields:function(n){var i=n;return n&&(i=n.filter(function(n){return!e(n)&&!t(n)})),i},getTypeTranslationKey:function(i){var r="",o={qTags:i};return e(o)?r="DirectDiscovery.Measure":t(o)?r="DirectDiscovery.Details":n(o)&&(r="DirectDiscovery.Dimension"),r},isDirectDiscoveryField:function(e){return!!e.qTags&&-1!==e.qTags.indexOf("$directdiscovery")}}}),define("client.assets/tab-contents/fields/derived-field-formatter-service",[],function(){var e=".autoCalendar";return{trimAutoCalendarName:function(t){return t?t.split(e).join(""):""}}}),define("objects/cre/cre-util",["util","assets/load-model/models/classification-helper"],function(e,t){return{Constants:{dimension:"dimension",measure:"measure",temporal:"temporal"},isDimension:function(e){if(e&&e.length>0){var n=e[0];return t.ClassificationHelper.isDimension(n)}return!1},isMeasure:function(e){if(e&&e.length>0){var n=e[0];return t.ClassificationHelper.isMeasure(n)}return!1},getDimensionExpression:function(t){return e.escapeField(t)},getMeasureExpression:function(t,n){return n+"("+e.escapeField(t)+")"},normalizeExpression:function(e){return e?e.replace(/=|\[|\]/g,"").toLowerCase():e}}}),define("client.assets/tab-contents/fields/assets-field-list-model",["objects.utils/data-properties/listobject-util","client.assets/tab-contents/fields/assets-directdiscovery-service","client.assets/tab-contents/fields/derived-field-formatter-service","objects/cre/cre-util","client.utils/capability-flags"],function(e,t,n,i,r){"use strict";function o(e){return{qDef:{qDef:i.getMeasureExpression(e.qName,e.defaultAggregation)}}}function s(t,s,a,l){var c;if(!r.getFlag("DM_GOOD_DEFAULTS")||l&&l.shiftKey||!t.classifications&&!s.isDerived)return c=e.createFieldDimension(t.qName),e.autoSortDimension(c,[t]),{id:"newObject",args:{template:"filterpane",children:[e.createDefaultListBox(c,n.trimAutoCalendarName(t.qName))],init:{}}};var u,h;return i.isMeasure(t.classifications)?h=o(t):(c=e.createFieldDimension(t.qName),e.autoSortDimension(c,[t]),u=c),{id:"newObject",args:{template:"auto-chart",init:{qHyperCubeDef:{qDimensions:u?[u]:[],qMeasures:h?[h]:[],qInterColumnSortOrder:[0]}},annotatedFields:s}}}function a(e,t,i){var r=[];if(t)for(var o=0;o<t.qDerivedFieldLists.length;++o)for(var a=t.qDerivedFieldLists[o],l=0;l<a.qFieldDefs.length;++l){var c=a.qFieldDefs[l];r.push({id:c.qName,qName:c.qMethod,name:c.qName,displayName:n.trimAutoCalendarName(c.qName),qSrcTables:e.qSrcTables,srcTables:e.qSrcTables,qTags:c.qTags,tags:c.qTags,type:"field",isDerived:!0,isDerivedFromDate:i,getDropOption:s.bind(null,c),sourceField:e.qName,derivedDefinitionName:a.qDerivedDefinitionName})}return r}function l(e){return!!e.qDerivedFieldData&&(e.qTags.indexOf("$date")>-1||e.qTags.indexOf("$timestamp")>-1)}function c(e){return e.qTags.indexOf("$geoname")>-1}return{create:function(e,n){return e.map(function(e){var i=l(e),r=c(e),o=s.bind(null,e),u=void 0,h=void 0,d=void 0;if(n){var p=n._getFields(e.qName,e.qSrcTables);p.length>0&&(u=n.getClassifications(e.qName,e.qSrcTables),h=n.getDataTypes(e.qName,e.qSrcTables),d=n.getDefaultAggregation(e.qName,e.qSrcTables)),o=s.bind(null,e,p),e.defaultAggregation=d,e.classifications=u,e.dataTypes=h}var f={id:e.qName,name:e.qName,type:"field",dataTypes:[],classifications:[],defaultAggregation:"",isDateField:i,isGeoField:r,srcTables:e.qSrcTables,sourceField:e.sourceField,calendarTemplateName:e.derivedDefinitionName,getDropOption:o,tags:e.qTags,icon:t.isDirectDiscoveryField(e)?"direct-discovery":"",iconTooltip:t.getTypeTranslationKey(e.qTags),derivedFields:e.qDerivedFieldData?a(e,e.qDerivedFieldData,i):[]};return n&&(f.dataTypes=h,f.classifications=u,f.defaultAggregation=d),f})},expand:function(e){for(var t=[],i=0;i<e.length;++i){var r=e[i];if(r.isDateField=l(r),r.isGeoField=c(r),t.push(r),r.qDerivedFieldData)for(var o=0;o<r.qDerivedFieldData.qDerivedFieldLists.length;++o)for(var s=r.qDerivedFieldData.qDerivedFieldLists[o],a=0;a<s.qFieldDefs.length;++a){var u=s.qFieldDefs[a];t.push({qName:u.qName,displayName:n.trimAutoCalendarName(u.qName),qSrcTables:r.qSrcTables,qTags:u.qTags,isDerived:!0,isDerivedFromDate:r.isDateField,sourceField:r.qName,derivedDefinitionName:s.qDerivedDefinitionName})}}return t},createFromArray:function(e,t){var n,i=[];for(n=0;n<e.length;n++)t&&(e[n].qName=e[n][t]),i.push({name:e[n].qName,type:"field",getDropOption:s.bind(null,e[n])});return i},getTables:function(e){var t,n,i,r=e;for(i=[],t=0;t<r.length;++t)for(n=0;n<r[t].qSrcTables.length;++n)-1===i.indexOf(r[t].qSrcTables[n])&&i.push(r[t].qSrcTables[n]);return i}}}),define("objects.utils/data-properties/library-utils",["general.utils/array-util","client.assets/tab-contents/fields/assets-field-list-model"],function(e,t){"use strict";return{findField:function(n,i){var r,o,s=t.expand(e.copy(i));if(s)for(r=0;r<s.length;r++)if((o=s[r]).qName===n)return o;return null},findLibraryDimension:function(e,t){var n,i;if(t)for(n=0;n<t.length;n++)if((i=t[n]).qInfo.qId===e)return i;return null},findLibraryMeasure:function(e,t){var n,i;if(t)for(n=0;n<t.length;n++)if((i=t[n]).qInfo.qId===e)return i;return null},getSortedFields:function(n){return n.getFieldList().then(function(n){return t.expand(e.copy(n)).sort(function(e,t){return e.qName.toLowerCase().localeCompare(t.qName.toLowerCase())})})},getSortedDimensions:function(t){return t.getDimensionList().then(function(t){return e.copy(t).sort(function(e,t){return e.qData.title.toLowerCase().localeCompare(t.qData.title.toLowerCase())})})},getSortedMeasures:function(t){return t.getMeasureList().then(function(t){return e.copy(t).sort(function(e,t){return e.qData.title.toLowerCase().localeCompare(t.qData.title.toLowerCase())})})}}}),define("objects.utils/data-properties/hypercube-handler",["./data-property-handler","core.utils/deferred","objects.utils/data-properties/library-utils","general.utils/array-util","util","client.utils/color-support","client.utils/default-property-logic"],function(e,t,n,i,r,o,s){"use strict";function a(e){return h.test(e)}function l(e,t){return e?t&&r.getValue(e,t)?r.getValue(e,t).qHyperCube:e.qHyperCube:[]}var c,u=["$numeric","$year","$quarter","$yearquarter","$month","$yearmonth","$weeknumber","$date","$timestamp"],h=new RegExp(u.join("|").replace(/\$/g,"\\$"));return c=e.extend({init:function(e){this._super(e),this.path=e.path},setProperties:function(e){e&&(this._super(e),this.hcProperties=this.path?r.getValue(e,(this.path?this.path+".":"")+"qHyperCubeDef"):e.qHyperCubeDef,this.hcProperties&&(this.hcProperties.qDimensions||(this.hcProperties.qDimensions=[]),this.hcProperties.qMeasures||(this.hcProperties.qMeasures=[]),this.hcProperties.qInterColumnSortOrder||(this.hcProperties.qInterColumnSortOrder=[]),this.hcProperties.qLayoutExclude||(this.hcProperties.qLayoutExclude={}),this.hcProperties.qLayoutExclude.qHyperCubeDef||(this.hcProperties.qLayoutExclude.qHyperCubeDef={}),this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions||(this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions=[]),this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures||(this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures=[]),this.hcProperties.qDimensions.forEach(function(e){void 0!==e.autoSort&&(e.qDef.autoSort=e.autoSort,delete e.autoSort)}),this.hcProperties.qMeasures.forEach(function(e){void 0!==e.autoSort&&(e.qDef.autoSort=e.autoSort,delete e.autoSort)})))},canColorBy:function(e,t){var n=e||{qHyperCubeDef:this.hcProperties||this.properties.qHyperCubeDef},i=this.layout?this.layout.visualization:null,r=n.qHyperCubeDef.qDimensions.length>=this.minDimensions()&&n.qHyperCubeDef.qMeasures.length>=this.minMeasures();return!(!o.colorBy.isSupported(i)&&!t)&&(r&&this.layout&&this.layout.color?c.canColorBy(n,i):{})},getDimensions:function(){return this.hcProperties?this.hcProperties.qDimensions:[]},getMeasures:function(){return this.hcProperties?this.hcProperties.qMeasures:[]},getLabels:function(){return this.getMeasures().filter(function(e){return!e.qLibraryId&&!!e.qDef.qLabel}).map(function(e){return e.qDef.qLabel})},getSorting:function(){return this.hcProperties.qInterColumnSortOrder},addDimension:function(e,n,o){var s=this.getDimensions(),a=this;return e.qDef.cId||(e.qDef.cId=r.generateId()),e.qOtherTotalSpec||(e.qOtherTotalSpec={}),n?(o=void 0!==o?o:this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.length,this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.splice(o,0,e),t.resolve(e)):s.length<this.maxDimensions()?(o=void 0!==o?o:s.length,s.splice(o,0,e),this.autoSortDimension(e).then(function(){return i.indexAdded(a.hcProperties.qInterColumnSortOrder,void 0!==o?o:s.length-1),"function"==typeof a.dimensionDefinition.add?t.when(a.dimensionDefinition.add.call(a,e,a.properties,a)).then(function(){return e}):e})):s.length<1e3?(o=this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.length,this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.splice(o,0,e),t.resolve(e)):void 0},reinsertDimension:function(e,n,o){var s=this.getDimensions(),a=this;if(e.qDef.cId||(e.qDef.cId=r.generateId()),n){if(o=void 0!==o?o:this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.length,this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.splice(o,0,e),"function"==typeof a.dimensionDefinition.move)return t.when(a.dimensionDefinition.move.call(a,e,a.properties,a)).then(function(){return e})}else if(s.length<this.maxDimensions()){if(o=void 0!==o?o:s.length,s.splice(o,0,e),i.indexAdded(a.hcProperties.qInterColumnSortOrder,void 0!==o?o:s.length-1),"function"==typeof a.dimensionDefinition.move)return t.when(a.dimensionDefinition.move.call(a,e,a.properties,a)).then(function(){return e})}else s.length<1e3&&(o=this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.length,this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.splice(o,0,e));return t.resolve(e)},addMeasure:function(e,n,o){var s=this.getMeasures(),a=this;return e.qDef.cId||(e.qDef.cId=r.generateId()),n?(o=void 0!==o?o:this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.length,this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(o,0,e),t.resolve(e)):(o=void 0!==o?o:s.length,s.length<this.maxMeasures()?(s.splice(o,0,e),this.autoSortMeasure(e).then(function(){return i.indexAdded(a.hcProperties.qInterColumnSortOrder,a.getDimensions().length+s.length-1),"function"==typeof a.measureDefinition.add?t.when(a.measureDefinition.add.call(null,e,a.properties,a)).then(function(){return e}):e})):s.length<1e3?(o=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.length,this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(o,0,e),t.resolve(e)):void 0)},getDimensionLayouts:function(){var e=l(this.layout,this.path);return e?e.qDimensionInfo:[]},getDimensionLayout:function(e){return this.getDimensionLayouts().filter(function(t){return e===t.cId})[0]},getMeasureLayouts:function(){var e=l(this.layout,this.path);return e?e.qMeasureInfo:[]},getMeasureLayout:function(e){return this.getMeasureLayouts().filter(function(t){return e===t.cId})[0]},reinsertMeasure:function(e,n,o){var s=this.getMeasures(),a=this;if(e.qDef.cId||(e.qDef.cId=r.generateId()),n)o=void 0!==o?o:this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.length,this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(o,0,e);else if(o=void 0!==o?o:s.length,s.length<this.maxMeasures()){if(s.splice(o,0,e),i.indexAdded(a.hcProperties.qInterColumnSortOrder,a.getDimensions().length+s.length-1),"function"==typeof a.measureDefinition.move)return t.when(a.measureDefinition.move.call(null,e,a.properties,a,!0)).then(function(){return e})}else s.length<1e3&&(o=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.length,this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(o,0,e));return t.resolve(e)},replaceDimension:function(e,t){var n=this.getDimensions(),i=n[e],o=this;return this.autoSortDimension(t).then(function(){return t.qDef.cId=r.generateId(),n[e]=t,"function"==typeof o.dimensionDefinition.replace&&o.dimensionDefinition.replace.call(null,t,i,e,o.properties,o),t})},replaceMeasure:function(e,t){var n=this.getMeasures(),i=n[e],o=this;return this.autoSortMeasure(t).then(function(){return t.qDef.cId=r.generateId(),n[e]=t,"function"==typeof o.measureDefinition.replace&&o.measureDefinition.replace.call(null,t,i,e,o.properties,o),t})},autoSortDimension:function(e){function t(t){t.forEach(function(t,n){var r=t.qTags,o={qSortByLoadOrder:1};"function"==typeof i.dimensionDefinition.autoSort?i.dimensionDefinition.autoSort(e,i.properties,r,o,i):r&&(a(r)?o.qSortByNumeric=1:(r.contains("$text")||r.contains("$ascii"))&&(o.qSortByAscii=1)),e.qDef.qSortCriterias?e.qDef.qSortCriterias[n]=o:e.qDef.qSortCriterias=[o]})}var i=this;return e.qLibraryId?this.app.getDimensionList().then(function(i){var r=n.findLibraryDimension(e.qLibraryId,i);return r&&t(r.qData.info),e}):this.app.getFieldList().then(function(i){var r=n.findField(e.qDef.qFieldDefs[0],i);return r&&t([r]),e})},autoSortMeasure:function(e){return e.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},t.resolve(e)},removeDimension:function(e,n){var r;if(n){if(r=this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions.splice(e,1),"function"==typeof this.dimensionDefinition.remove)return t.when(this.dimensionDefinition.remove.call(null,r,this.properties,this,e))}else if(r=this.hcProperties.qDimensions.splice(e,1)[0],i.indexRemoved(this.hcProperties.qInterColumnSortOrder,e),"function"==typeof this.dimensionDefinition.remove)return t.when(this.dimensionDefinition.remove.call(null,r,this.properties,this,e));return t.resolve(r)},removeMeasure:function(e,n){var r;if(n)r=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(e,1)[0];else if(r=this.hcProperties.qMeasures.splice(e,1)[0],i.indexRemoved(this.hcProperties.qInterColumnSortOrder,this.getDimensions().length+e),"function"==typeof this.measureDefinition.remove)return t.when(this.measureDefinition.remove.call(null,r,this.properties,this,e));return t.resolve(r)},moveDimension:function(e,n){var r,o,s,a=this.getDimensions(),l=this.hcProperties.qLayoutExclude.qHyperCubeDef.qDimensions;return e<a.length&&n<a.length?i.move(a,e,n):e<a.length&&n>=a.length?(o=n-a.length,s=l.splice(0,1)[0],a.push(s),s=a.splice(e,1)[0],l.splice(o,0,s)):e>=a.length&&n<a.length?(r=e-a.length,s=a.splice(a.length-1,1)[0],l.splice(0,0,s),s=l.splice(r+1,1)[0],a.splice(n,0,s)):(r=e-a.length,o=n-a.length,i.move(l,r,o)),t.resolve(s)},moveMeasure:function(e,n){var r,o,s,a=this.getMeasures(),l=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures;return e<a.length&&n<a.length?i.move(a,e,n):e<a.length&&n>=a.length?(o=n-a.length,s=l.splice(0,1)[0],a.push(s),s=a.splice(e,1)[0],l.splice(o,0,s)):e>=a.length&&n<a.length?(r=e-a.length,s=a.splice(a.length-1,1)[0],l.splice(0,0,s),s=l.splice(r+1,1)[0],a.splice(n,0,s)):(r=e-a.length,o=n-a.length,i.move(l,r,o)),t.resolve(s)},changeSorting:function(e,t){i.move(this.hcProperties.qInterColumnSortOrder,e,t)},setSorting:function(e){e&&e.length===this.hcProperties.qInterColumnSortOrder.length&&(this.hcProperties.qInterColumnSortOrder=e)}}),c.canColorBy=function(e,t){var n={primary:!0};if(e){var i=s.getLogicFor("hard",t).helpers.colorModeOptions;n.byDimension=i.dimension(e),n.byMeasure=i.measure(e),n.byMultiple=i.multiColor(e),n.byExpression=i.expression(e)}return n},c}),define("objects.utils/data-properties/listobject-handler",["core.utils/deferred","./data-property-handler","objects.utils/data-properties/listobject-util","objects.utils/data-properties/library-utils","util"],function(e,t,n,i,r){"use strict";return t.extend({init:function(e){this._super(e)},minDimensions:function(){return 1},maxDimensions:function(){return 1},minMeasures:function(){return 0},maxMeasures:function(){return 0},autoSortDimension:function(e){return n.autoSortDimension(e)},getDimensions:function(){var e=this.properties.qListObjectDef.qDef;return e&&e.qFieldDefs&&e.qFieldDefs.length||this.properties.qListObjectDef.qLibraryId?[this.properties.qListObjectDef]:[]},addDimension:function(e){function t(){o.properties.qListObjectDef=r.extend(!0,o.properties.qListObjectDef,e),"function"==typeof o.dimensionDefinition.add&&o.dimensionDefinition.add.call(null,e,o.properties,o)}var o=this;return e.qLibraryId?this.app.getDimensionList().then(function(r){var o=i.findLibraryDimension(e.qLibraryId,r);return o&&n.autoSortDimension(e,o.qData.info),t(),e}):this.app.getFieldList().then(function(r){var o=i.findField(e.qDef.qFieldDefs[0],r);return o&&n.autoSortDimension(e,[o]),t(),e})},replaceDimension:function(t,i){var o=this,s=r.extend(!0,this.properties.qListObjectDef,i);return n.autoSortDimension(i),i.qLibraryId?(delete s.qDef.qFieldDefs,delete s.qDef.qFieldLabels):delete s.qLibraryId,o.properties.qListObjectDef=s,e.resolve(i)},removeDimension:void 0,getDimensionLayouts:function(){return[this.getDimensionLayout()]},getDimensionLayout:function(){return this.layout&&this.layout.qListObject&&this.layout.qListObject.qDimensionInfo?this.layout.qListObject.qDimensionInfo:""},getMeasures:function(){return this.properties.qListObjectDef.qExpressions},getMeasureLayout:function(){return this.layout&&this.layout.qListObject&&this.layout.qListObject.qExpressions&&this.layout.qListObject.qExpressions[0]?this.layout.qListObject.qExpressions[0].qExpr:""}})}),define("text!objects.extension/default-template.ng.html",[],function(){return'<div style="height: 100%; position: relative;"></div>\n'}),define("objects.extension/export-format",[],function(){"use strict";return function(e){e=void 0!==e?e:1,this.data=[];for(var t=0;t<e;++t)this.data.push({dimensions:[],measures:[],excludedDimensions:[],excludedMeasures:[],interColumnSortOrder:[]});this.properties={}}}),define("objects.extension/object-conversion",["util","objects.extension/export-format","general.utils/array-util","client.utils/property-resolver","client.utils/property-mapper","translator","client.utils/color-support","objects.utils/data-properties/hypercube-handler","general.utils/attribute-expression-util"],function(e,t,n,i,r,o,s,a,l){function c(e,t,n){t.hasOwnProperty(e)&&(n[e]=t[e])}function u(e,t,n,i){t.hasOwnProperty(e)?n[e]=t[e]:n[e]=i}function h(t,n){var r=e.extend(!0,{},n,t);return i.getValue(r,"qOtherTotalSpec.qOtherCounted")||i.setValue(r,"qOtherTotalSpec.qOtherCounted",{qv:"10"}),i.getValue(r,"qOtherTotalSpec.qOtherLimit")||i.setValue(r,"qOtherTotalSpec.qOtherLimit",{qv:"0"}),r.hasOwnProperty("othersLabel")||(r.othersLabel=o.get("properties.dimensionLimits.others")),r}function d(t,n){return e.extend(!0,{},n,t)}function p(e){return-1!==["qMetaDef","descriptionExpression","labelExpression"].indexOf(e)}function f(e,t,n){"masterobject"===t.properties.qInfo.qType?e.qInfo.qType="masterobject":e.qInfo.qType=n.qInfo.qType,e.visualization=n.visualization}function m(e,t,n){var r=n.qProperty,o=n.qProperty.qLayoutExclude;/boolean|number|string/.test(typeof t)?(o&&(o.changed||(o.changed={}),o.changed[e]={from:i.getValue(r,e),to:t}),i.setValue(r,e,t)):i.setValue(r,e,t)}function g(e){for(var t in e.qLayoutExclude.changed)e.qLayoutExclude.changed[t].to===i.getValue(e,t)&&i.setValue(e,t,e.qLayoutExclude.changed[t].from)}function v(e,t,n){var r,o,s=t.properties,a=t.properties.qLayoutExclude,l=i.getValue(s,e);if(!/boolean|number|string/.test(typeof l))try{if(r=JSON.stringify(l),o=r.match(/:\{/g),(o=o?o.length:0)>2)return;l=JSON.parse(r)}catch(e){return}a||(t.properties.qLayoutExclude={quarantine:{}},a=t.properties.qLayoutExclude),a.quarantine||(a.quarantine={}),a.quarantine[n]||(a.quarantine[n]={}),a.quarantine[n][e]=l}function y(e,t){var n,r=e.qLayoutExclude?e.qLayoutExclude.quarantine:{};if(!r[t])return!1;r=r[t];for(n in r)i.setValue(e,n,r[n]);return delete e.qLayoutExclude.quarantine[t],!0}var b,x,q,C,S,w,_=Math.pow(2,53)-1;return b={exportProperties:function(i,r){var o,s,a,l=new t,c=i.qProperty,u=r?c[r].qHyperCubeDef:c.qHyperCubeDef,h=l.data[0];for(u.qInterColumnSortOrder||(u.qInterColumnSortOrder=[]),o=0;o<u.qDimensions.length;++o)h.dimensions.push(u.qDimensions[o]);if(u.qLayoutExclude&&u.qLayoutExclude.qHyperCubeDef&&u.qLayoutExclude.qHyperCubeDef.qDimensions)for(o=0;o<u.qLayoutExclude.qHyperCubeDef.qDimensions.length;++o)h.excludedDimensions.push(u.qLayoutExclude.qHyperCubeDef.qDimensions[o]);for(o=0;o<u.qMeasures.length;++o)h.measures.push(u.qMeasures[o]);if(u.qLayoutExclude&&u.qLayoutExclude.qHyperCubeDef&&u.qLayoutExclude.qHyperCubeDef.qMeasures)for(o=0;o<u.qLayoutExclude.qHyperCubeDef.qMeasures.length;++o)h.excludedMeasures.push(u.qLayoutExclude.qHyperCubeDef.qMeasures[o]);if(h.interColumnSortOrder=u.qInterColumnSortOrder.concat(),u.qLayoutExclude&&u.qLayoutExclude.qHyperCubeDef&&u.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder){var d=u.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder.concat();n.isOrderedSubset(d,h.interColumnSortOrder)&&(h.interColumnSortOrder=d)}delete u.qLayoutExclude;for(s in c)l.properties[s]=c[s];if(r&&(l.properties.qHyperCubeDef=c[r].qHyperCubeDef,delete c[r].qHyperCubeDef),c.qLayoutExclude||(c.qLayoutExclude={}),c.qLayoutExclude.disabled){for(s in c.qLayoutExclude.disabled)a=s,l.properties.hasOwnProperty(a)||(l.properties[a]=c.qLayoutExclude.disabled[s]);delete c.qLayoutExclude.disabled}return c.qLayoutExclude.changed&&(g(c),delete c.qLayoutExclude.changed),c.qLayoutExclude.quarantine&&!e.isEmpty(c.qLayoutExclude.quarantine)||delete c.qLayoutExclude,l},importProperties:function(t,i,o,s){var a,l,m,g,v={qChildren:[]},y={},b=t.data[0],x={layout:{templateId:i.templateId}};o.mapProperties(x);var q=o.getDefaultDimensionProperties(),C=o.getDefaultMeasureProperties(),S=o.data&&o.data.measures;S||(S=o.definition&&o.definition.items&&o.definition.items.measures||{max:0});var w="function"==typeof S.max?S.max(b.dimensions.length):isNaN(S.max)?_:S.max,D="function"==typeof S.min?S.min(b.dimensions.length):isNaN(S.min)?0:S.min,M=o.data&&o.data.dimensions;M||(M=o.definition&&o.definition.items&&o.definition.items.dimensions||{max:0});var A="function"==typeof M.max?M.max(w):isNaN(M.max)?_:M.max,E="function"==typeof M.min?M.min(D):isNaN(M.min)?0:M.min;y.qLayoutExclude||(y.qLayoutExclude={}),y.qLayoutExclude.disabled={},y.qLayoutExclude.quarantine={};for(l in t.properties)"qLayoutExclude"===l?t.properties[l].quarantine&&(y.qLayoutExclude.quarantine=e.extend(!0,{},t.properties[l].quarantine)):"qHyperCubeDef"===l&&s||(i.hasOwnProperty(l)||p(l)?y[l]=t.properties[l]:y.qLayoutExclude.disabled[l]=t.properties[l]);s&&t.properties.qHyperCubeDef&&(y[s]=y[s]||{},y[s].qHyperCubeDef=t.properties.qHyperCubeDef),y=e.extend(!0,{},i,y);var I=s?i[s].qHyperCubeDef:i.qHyperCubeDef,T=s?y[s].qHyperCubeDef:y.qHyperCubeDef;if(T.qDimensions.length=0,T.qMeasures.length=0,(b.dimensions.length>A&&A>0||b.measures.length>w&&w>0||b.excludedDimensions.length&&b.dimensions.length+b.excludedDimensions.length>E||b.excludedMeasures.length&&b.measures.length+b.excludedMeasures.length>D||!w&&b.measures.length||!A&&b.dimensions.length)&&(T.qLayoutExclude||(T.qLayoutExclude={}),T.qLayoutExclude.qHyperCubeDef||(T.qLayoutExclude.qHyperCubeDef={}),(b.dimensions.length>A&&A>0||b.excludedDimensions&&b.excludedDimensions.length&&b.dimensions.length+b.excludedDimensions.length>E)&&(T.qLayoutExclude.qHyperCubeDef.qDimensions||(T.qLayoutExclude.qHyperCubeDef.qDimensions=[])),(b.measures.length>w&&w>0||b.excludedMeasures&&b.excludedMeasures.length&&b.measures.length+b.excludedMeasures.length>D)&&(T.qLayoutExclude.qHyperCubeDef.qMeasures||(T.qLayoutExclude.qHyperCubeDef.qMeasures=[])),!w&&b.measures.length&&(T.qLayoutExclude.qHyperCubeDef.qMeasures||(T.qLayoutExclude.qHyperCubeDef.qMeasures=[])),!A&&b.dimensions.length&&(T.qLayoutExclude.qHyperCubeDef.qDimensions||(T.qLayoutExclude.qHyperCubeDef.qDimensions=[]))),A>0)for(m=0;m<b.dimensions.length;++m)T.qDimensions.length<A?T.qDimensions.push(h(b.dimensions[m],q)):T.qLayoutExclude.qHyperCubeDef.qDimensions.push(h(b.dimensions[m],q));else if(b.dimensions.length)for(m=0;m<b.dimensions.length;++m)T.qLayoutExclude.qHyperCubeDef.qDimensions.push(h(b.dimensions[m],q));if(b.excludedDimensions.length)for(m=0;m<b.excludedDimensions.length;++m)T.qDimensions.length<E?T.qDimensions.push(h(b.excludedDimensions[m],q)):T.qLayoutExclude.qHyperCubeDef.qDimensions.push(h(b.excludedDimensions[m],q));if(w>0)for(m=0;m<b.measures.length;++m)T.qMeasures.length<w?T.qMeasures.push(d(b.measures[m],C)):T.qLayoutExclude.qHyperCubeDef.qMeasures.push(d(b.measures[m],C));else if(b.measures.length)for(m=0;m<b.measures.length;++m)T.qLayoutExclude.qHyperCubeDef.qMeasures.push(d(b.measures[m],C));if(b.excludedMeasures.length)for(m=0;m<b.excludedMeasures.length;++m)T.qMeasures.length<D?T.qMeasures.push(d(b.excludedMeasures[m],C)):T.qLayoutExclude.qHyperCubeDef.qMeasures.push(d(b.excludedMeasures[m],C));if(g=T.qDimensions.length+T.qMeasures.length,T.qInterColumnSortOrder=b.interColumnSortOrder.concat(),(m=T.qInterColumnSortOrder.length)!==g)for(T.qLayoutExclude&&(T.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder=b.interColumnSortOrder.concat());m!==g;)m<g?(n.indexAdded(T.qInterColumnSortOrder,m),++m):(--m,n.indexRemoved(T.qInterColumnSortOrder,m));a=r.mapProperties(r.mapDefinition(o.definition,o.type),{},o.type);var L=s?a[s]&&a[s].qHyperCubeDef:a.qHyperCubeDef;return["qAlwaysFullyExpanded","qSuppressMissing","qSuppressZero"].filter(function(e){return L&&void 0===L[e]}).forEach(function(e){c(e,I,T)}),c("qMaxStackedCells",I,T),c("qNoOfLeftDims",I,T),u("qInitialDataFetch",I,T,[{qTop:0,qLeft:0,qWidth:0,qHeight:0}]),u("qMode",I,T,"S"),u("qReductionMode",I,T,"N"),u("qSortbyYValue",I,T),u("qIndentMode",I,T),u("qShowTotalsAbove",I,T),f(y,t,i),v.qProperty=y,v}},x={exportProperties:function(e){var n,i,r,o=new t,s=e.qProperty,a=s.qListObjectDef,l=o.data[0];if((a.qLibraryId||a.qDef&&a.qDef.qFieldDefs[0])&&l.dimensions.push({qLibraryId:a.qLibraryId,qDef:a.qDef,title:a.title,qOtherTotalSpec:{}}),a.qLayoutExclude&&a.qLayoutExclude.qHyperCubeDef&&a.qLayoutExclude.qHyperCubeDef.qDimensions)for(n=0;n<a.qLayoutExclude.qHyperCubeDef.qDimensions.length;++n)l.excludedDimensions.push(a.qLayoutExclude.qHyperCubeDef.qDimensions[n]);if(a.qLayoutExclude&&a.qLayoutExclude.qHyperCubeDef&&a.qLayoutExclude.qHyperCubeDef.qMeasures)for(n=0;n<a.qLayoutExclude.qHyperCubeDef.qMeasures.length;++n)l.excludedMeasures.push(a.qLayoutExclude.qHyperCubeDef.qMeasures[n]);if(a.qLayoutExclude&&a.qLayoutExclude.qHyperCubeDef&&a.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder)for(n=0;n<a.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder.length;++n)l.interColumnSortOrder.push(a.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder[n]);delete a.qLayoutExclude;for(i in s)o.properties[i]=s[i];if(s.qLayoutExclude&&s.qLayoutExclude._disabled){for(i in s.qLayoutExclude._disabled)r="_"===i.substr(0,1)?i.substring(1):i,o.properties.hasOwnProperty(r)||(o.properties[r]=s.qLayoutExclude.disabled[i]);delete s.qLayoutExclude.disabled}if(l.dimensions.length>0)for(n=0;n<l.dimensions[0].qDef.qSortCriterias.length;++n)l.dimensions[0].qDef.qSortCriterias[n].qSortByFrequency=0;return o},importProperties:function(t,n){var i,r,o={qChildren:[]},s={},a=t.data[0];s.qLayoutExclude||(s.qLayoutExclude={}),s.qLayoutExclude.disabled={};for(i in t.properties)"qLayoutExclude"===i?t.properties[i].quarantine&&(s.qLayoutExclude.quarantine=e.extend(!0,{},t.properties[i].quarantine)):n.hasOwnProperty(i)||p(i)?s[i]=t.properties[i]:s.qLayoutExclude.disabled[i]=t.properties[i];for((s=e.extend(!0,{},n,s)).qListObjectDef.qLayoutExclude||(s.qListObjectDef.qLayoutExclude={}),s.qListObjectDef.qLayoutExclude.qHyperCubeDef||(s.qListObjectDef.qLayoutExclude.qHyperCubeDef={}),s.qListObjectDef.qLayoutExclude.qHyperCubeDef.qDimensions||(s.qListObjectDef.qLayoutExclude.qHyperCubeDef.qDimensions=[]),s.qListObjectDef.qLayoutExclude.qHyperCubeDef.qMeasures||(s.qListObjectDef.qLayoutExclude.qHyperCubeDef.qMeasures=[]),s.qListObjectDef.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder||(s.qListObjectDef.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder=[]),r=0;r<a.dimensions.length;++r)r<1?(s.qListObjectDef.qDef=a.dimensions[r].qDef,s.qListObjectDef.qLibraryId=a.dimensions[r].qLibraryId):s.qListObjectDef.qLayoutExclude.qHyperCubeDef.qDimensions.push(a.dimensions[r]);for(r=0;r<a.excludedDimensions.length;++r)s.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions.push(h(a.excludedDimensions[r]));for(r=0;r<a.measures.length;++r)s.qListObjectDef.qLayoutExclude.qHyperCubeDef.qMeasures.push(a.measures[r]);for(r=0;r<a.excludedMeasures.length;++r)s.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures.push(a.excludedMeasures[r]);for(r=0;r<a.interColumnSortOrder.length;++r)s.qListObjectDef.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder.push(a.interColumnSortOrder[r]);return s.qListObjectDef.qInitialDataFetch=n.qListObjectDef.qInitialDataFetch,f(s,t,n),o.qProperty=s,o}},q={importProperties:function(e,t,n){var r=this.hypercube.importProperties(e,t,n),o=i.getValue(r,"qProperty.visualization"),l=i.getValue(r,"qProperty.qHyperCubeDef.qDimensions",[]),c=i.getValue(r,"qProperty.qHyperCubeDef.qMeasures",[]),u=i.getValue(r,"qProperty.qHyperCubeDef.qMeasures.0.qAttributeExpressions",[]),h=i.getValue(r,"qProperty.color.colorExpression",""),d=i.getValue(r,"qProperty.color.mode",""),p=i.getValue(r,"qProperty.color.auto",""),f=i.getValue(r,"qProperty.color.persistent",!1);return a.canColorBy(r.qProperty,o)[d]?p?s.colorByUpdater(r.qProperty,"qHyperCubeDef."):"byDimension"!==d&&"byMeasure"!==d||!l.length?"byExpression"===d&&c.length&&(u.splice(0,0,{qExpression:h,id:"colorByExpression"}),i.setValue(r,"qProperty.qHyperCubeDef.qMeasures.0.qAttributeExpressions",u)):s.colorByUpdater(r.qProperty,"qHyperCubeDef."):(i.setValue(r,"qProperty.color.mode","primary"),i.setValue(r,"qProperty.color.auto",!0),s.colorByUpdater(r.qProperty,"qHyperCubeDef.")),l.length>1&&!f&&m("color.persistent",!0,r),l.forEach(function(e){"qTotalMode"in e.qOtherTotalSpec&&delete e.qOtherTotalSpec.qTotalMode,"qGlobalOtherGrouping"in e.qOtherTotalSpec&&delete e.qOtherTotalSpec.qGlobalOtherGrouping}),r},exportProperties:function(e){var t=this.hypercube.exportProperties(e),n=t.data[0];return l.moveByIdFromGroup(n.dimensions.concat(n.excludedDimensions),[],"qAttributeDimensions",l.IDMAP.COLOR_BY_ALTERNATIVE),l.moveByIdFromGroup(n.dimensions.concat(n.excludedDimensions),[],"qAttributeExpressions",l.IDMAP.COLOR_BY_ALTERNATIVE),l.moveByIdFromGroup(n.measures.concat(n.excludedMeasures),[],"qAttributeExpressions",l.IDMAP.COLOR_BY_EXPRESSION),t}},C={importProperties:function(t,n,i){var r,o,s=this.colorChart.importProperties.apply(this,[t,n,i]),a=s.qProperty;if(n.measureAxis&&void 0===n.measureAxis.autoMinMax?y(a,"unsupportedAutoMinMax")||e.extend(a.measureAxis,n.measureAxis):y(a,"supportedAutoMinMax")||e.extend(a.measureAxis,n.measureAxis),t.properties.measureAxes&&!n.measureAxes&&n.measureAxis&&void 0!==n.measureAxis.autoMinMax){var l=[];if(a.qHyperCubeDef.qMeasures.length>0&&a.qHyperCubeDef.qMeasures.forEach(function(e){e.qDef.series&&(l[e.qDef.series.axis]||(l[e.qDef.series.axis]={axis:e.qDef.series.axis,type:{line:0,marker:0,bar:0,total:0}}),["bar","marker","line"].contains(e.qDef.series.type)&&l[e.qDef.series.axis].type[e.qDef.series.type]++,l[e.qDef.series.axis].type.total++)}),l.length){var c="barchart"===n.visualization?"bar":"linechart"===n.visualization?"line":"";c&&(r=l.filter(function(e){return e.type[c]>0}).sort(function(e,t){return t.type[c]-e.type[c]})),r&&r.length||(r=l.sort(function(e,t){return t.type.total-e.type.total})),r&&r[0]&&e.extend(a.measureAxis,t.properties.measureAxes[r[0].axis])}else e.extend(a.measureAxis,t.properties.measureAxes[0])}return a.qHyperCubeDef.qDimensions.length>1&&0!==(o=a.qHyperCubeDef.qInterColumnSortOrder.indexOf(0))&&(r=a.qHyperCubeDef.qInterColumnSortOrder[0],a.qHyperCubeDef.qInterColumnSortOrder[0]=0,a.qHyperCubeDef.qInterColumnSortOrder[o]=r),s},exportProperties:function(e){var t=this.colorChart.exportProperties.apply(this,[e]);return"gauge"===t.properties.visualization?(v("measureAxis.min",t,"unsupportedAutoMinMax"),v("measureAxis.max",t,"unsupportedAutoMinMax")):(v("measureAxis.min",t,"supportedAutoMinMax"),v("measureAxis.max",t,"supportedAutoMinMax")),t}},S={importProperties:function(e,t,n){var r,o,s=this.hypercube.importProperties(e,t,n),a=i.getValue(s,"qProperty.qHyperCubeDef.qDimensions",[]),l=a.length,c=i.getValue(s,"qProperty.qHyperCubeDef.qMeasures",[]).length,u=i.getValue(s,"qProperty.qHyperCubeDef.qInterColumnSortOrder",[]),h=!0;l+c===u.length&&i.setValue(s,"qProperty.qLayoutExclude.quarantine.interColSortOrder",u.concat());var d=i.getValue(s,"qProperty.qLayoutExclude.quarantine.pivotInterColSortOrder");d?(u=d,o=d.slice(),i.setValue(s,"qProperty.qHyperCubeDef.qInterColumnSortOrder",u),delete s.qProperty.qLayoutExclude.quarantine.pivotInterColSortOrder):u.length=0;var p=u.indexOf(-1)>-1,f=l+p;if(f>u.length)for(r=u.length;r<f;r++)u.indexOf(r)<0&&u.push(r-p);for(r=u.length-1;r>=0;r--)u[r]>=l&&u.splice(r,1);if(c>1&&u.indexOf(-1)<0?u.push(-1):c<2&&u.indexOf(-1)>-1&&u.splice(u.indexOf(-1),1),l>0&&-1===i.getValue(s,"qProperty.qHyperCubeDef.qNoOfLeftDims",-1)&&i.setValue(s,"qProperty.qHyperCubeDef.qNoOfLeftDims",l),o&&u&&o.length===u.length){for(r=0;r<o.length;r++)if(o[r]!==u[r]){h=!1;break}h&&y(s.qProperty,"noOfLeftDims")}return a.forEach(function(e){"qTotalMode"in e.qOtherTotalSpec||(e.qOtherTotalSpec.qTotalMode="TOTAL_EXPR")}),s},exportProperties:function(e){var t=i.getValue(e,"qProperty.qHyperCubeDef.qInterColumnSortOrder",[]),n=t.slice(0),r=t.indexOf(-1);r>-1&&t.splice(r,1);var o=this.hypercube.exportProperties(e),s=o.properties.qHyperCubeDef,a=s.qDimensions.length,l=s.qMeasures.length,c=s.qInterColumnSortOrder;i.setValue(o,"properties.qLayoutExclude.quarantine.pivotInterColSortOrder",n),v("qHyperCubeDef.qNoOfLeftDims",o,"noOfLeftDims"),delete o.properties.qHyperCubeDef.qNoOfLeftDims;var u=i.getValue(o,"properties.qLayoutExclude.quarantine.interColSortOrder");u&&(c=u,i.setValue(o,"properties.qHyperCubeDef.qInterColumnSortOrder",c),i.setValue(o,"data.0.interColumnSortOrder",c),delete o.properties.qLayoutExclude.quarantine.interColSortOrder);for(var h=c.length;h<a+l;h++)c.length<=h&&c.push(h);return o}},w={importProperties:function(t,n){var i,r={qChildren:[]},o={};o.qLayoutExclude||(o.qLayoutExclude={}),o.qLayoutExclude.disabled={};for(i in t.properties)"qLayoutExclude"!==i&&(n.hasOwnProperty(i)||p(i)?o[i]=t.properties[i]:o.qLayoutExclude.disabled[i]=t.properties[i]);return o=e.extend(!0,{},n,o),f(o,t,n),r.qProperty=o,r},exportProperties:function(e){var n,i,r=new t,o=e.qProperty;for(n in o)r.properties[n]=o[n];if(o.qLayoutExclude||(o.qLayoutExclude={}),o.qLayoutExclude.disabled)for(n in o.qLayoutExclude.disabled)i=n,r.properties.hasOwnProperty(i)||(r.properties[i]=o.qLayoutExclude.disabled[n]);return delete o.qLayoutExclude,r}},{importCommonProperties:f,isMasterItemProp:p,hypercube:b,listbox:x,axisChart:C,colorChart:q,pivotChart:S,other:w,changeProperty:m,quarantineProperty:v,unquarantineObject:y}}),define("client.soft-property-panel/default-explore-properties",["client.utils/property-resolver","client.utils/default-property-logic","client.utils/property-hypercube-helper"],function(e,t,n){var i,r,o,s,a=t.getLogicFor("explore","default");return s={translation:"properties.data",type:"items",component:"hypercube-data",icon:"database",items:{dimensions:{ref:"qHyperCubeDef.qDimensions",alternativeRef:"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions",translation:"Common.Dimensions",type:"items"},measures:{ref:"qHyperCubeDef.qMeasures",alternativeRef:"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",translation:"Common.Measures",type:"items"}}},i={translation:"properties.sorting",type:"items",component:"sort",sortIndexRef:"qHyperCubeDef.qInterColumnSortOrder",icon:"ascending",items:{dimensions:{ref:"qHyperCubeDef.qDimensions",type:"items",items:{sortOptions:{component:"radio-list",type:"number",diffs:["qDef.qSortCriterias.0.qSortByExpression","qDef.qSortCriterias.0.qSortByNumeric","qDef.qSortCriterias.0.qSortByAscii"],options:function(){return[{value:1,translation:"properties.sorting.ascending"},{value:-1,translation:"properties.sorting.descending"}]},setPropertyValue:function(t,n){e.setValue(t,"qDef.qSortCriterias.0.qSortByExpression",0),e.setValue(t,"qDef.qSortCriterias.0.qSortByNumeric",0),e.setValue(t,"qDef.qSortCriterias.0.qSortByAscii",n)},getValue:function(t){return 0===e.getValue(t,"qDef.qSortCriterias.0.qSortByExpression",0)&&0===e.getValue(t,"qDef.qSortCriterias.0.qSortByNumeric",0)?e.getValue(t,"qDef.qSortCriterias.0.qSortByAscii",0):0}}}},measures:{ref:"qHyperCubeDef.qMeasures",type:"items",items:{sortOptions:{component:"radio-list",type:"number",ref:"qSortBy.qSortByNumeric",options:function(){return[{value:1,translation:"properties.sorting.ascending"},{value:-1,translation:"properties.sorting.descending"}]}}}}}},r={component:"items",translation:"properties.colorsAndLegend",icon:"palette",grouped:!0,items:{mode:{component:"radio-list",type:"string",options:a.color.colorMode.options,diffs:["color.mode","color.auto"],setPropertyValue:function(e,t){"auto"===t?e.color.auto=!0:(e.color.auto=!1,e.color.mode=t),a.color.colorBy.globalChange(e,null,"qHyperCubeDef.")},getValue:function(e){return e.color.auto?"auto":e.color.mode}},dimension:{type:"items",show:function(e){return!e.color.auto&&"byDimension"===e.color.mode},items:{colorScheme:{translation:"properties.colorScheme",type:"string",component:"item-selection-list",horizontal:!0,showLabels:!1,ref:"color.dimensionScheme",items:a.helpers.getDimensionSchemeOptions,show:function(e,t){if(e.color&&"byDimension"===e.color.mode&&e.color.useDimColVal&&a.color.useDimColVal.show(e))return!1;if(1===n.getNumDimensions(e)&&n.getNumMeasures(e)<=1){var i=n.getDimensionLayouts(t)[0];return!(i&&i.qCardinal<=12)}return n.getNumMeasures(e)<=1||n.getNumMeasures(e)>12}},persistentColors:{ref:"color.persistent",translation:"properties.colorPersistence",type:"boolean",show:function(e){return n.getNumMeasures(e)<=1&&n.getNumDimensions(e)<=1&&!(e.color&&"byDimension"===e.color.mode&&e.color.useDimColVal&&a.color.useDimColVal.show(e))},readOnly:a.color.persistentColors.readOnly}}},measure:{type:"items",show:function(e){return!e.color.auto&&"byMeasure"===e.color.mode},items:{sequential:{component:"item-selection-list",translation:"properties.colorScheme",horizontal:!0,showLabels:!1,show:function(e){return!0!==e.color.useMeasureGradient},type:"string",ref:"color.measureScheme",items:a.helpers.getMeasureSchemeOptions}}},legend:{ref:"legend.show",type:"boolean",translation:"properties.legend.show",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(e,t){return!e.color.auto&&a.legend.show(e,t)}}}},o={translation:"properties.presentation",type:"items",icon:"view",grouped:!0,items:{}},{data:s,sort:i,color:r,colorsAndLegend:void 0,presentation:o}}),define("objects.extension/default-extension",["qvangular","util","core.utils/deferred","objects.utils/hypercube-util","objects.backend-api/generic-api","client.utils/property-mapper","objects.utils/data-properties/hypercube-handler","objects.utils/data-properties/listobject-handler","text!./default-template.ng.html","general.utils/visualizations","objects.utils/data-properties/library-utils","objects.extension/object-conversion","client.soft-property-panel/default-explore-properties"],function(e,t,n,i,r,o,s,a,l,c,u,h,d){function p(e,t){var n=i.getHyperCube(e,t);return n?n.qDimensionInfo||[]:e.qChildList?(e.qChildList.qItems||[]).map(function(){return{}}):!e.qListObject||!e.qListObject.qDimensionInfo||e.qListObject.qDimensionInfo.qError?[]:[e.qListObject.qDimensionInfo]}function f(e,t){var n=i.getHyperCube(e,t);return n?n.qMeasureInfo||[]:[]}function m(e,t,n){var i,r,o,s,a,l;for(i=0;i<e.data.length;++i){for(r=0;r<e.data[i].dimensions.length;++r)(o=e.data[i].dimensions[r]).qLibraryId&&(a=u.findLibraryDimension(o.qLibraryId,t))&&(o.title=a.qData.title);for(r=0;r<e.data[i].measures.length;++r)(s=e.data[i].measures[r]).qLibraryId&&(l=u.findLibraryMeasure(s.qLibraryId,n))&&(s.title=l.qData.title);for(r=0;r<e.data[i].excludedDimensions.length;++r)(o=e.data[i].excludedDimensions[r]).qLibraryId&&(a=u.findLibraryDimension(o.qLibraryId,t))&&(o.title=a.qData.title);for(r=0;r<e.data[i].excludedMeasures.length;++r)(s=e.data[i].excludedMeasures[r]).qLibraryId&&(l=u.findLibraryMeasure(s.qLibraryId,n))&&(s.title=l.qData.title)}}return{BackendApi:r,template:l,hasDefaultTemplate:function(){return this.template===l},mapProperties:function(){this.mappedDefinition=o.mapDefinition(this.definition,this.type),this.globalChangeListeners=o.findGlobalListeners(this.mappedDefinition);var e=this.data&&this.data.dimensions;e?(e.min=void 0!==e.min?e.min:1,e.max=void 0!==e.max?e.max:1e3):this.data||((e=o.findDefinition(this.mappedDefinition,"qHyperCubeDef.qDimensions",!0))||(e=o.findDefinition(this.mappedDefinition,"qListObjectDef",!0)),e&&(e.obsolete=!0)),this.dimensionDefinition=e;var t=this.data&&this.data.measures;t?(t.min=void 0!==t.min?t.min:1,t.max=void 0!==t.max?t.max:1):this.data||(t=o.findDefinition(this.mappedDefinition,"qHyperCubeDef.qMeasures",!0))&&(t.obsolete=!0),this.measureDefinition=t},getDefaultDimensionProperties:function(){return this.dimensionDefinition&&this.dimensionDefinition.obsolete?o.mapProperties(this.dimensionDefinition):this.dimensionDefinition?o.mapProperties(this.mappedDefinition.items.data.items.dimensions):void 0},getDefaultMeasureProperties:function(){return this.measureDefinition&&this.measureDefinition.obsolete?o.mapProperties(this.measureDefinition):this.measureDefinition?o.mapProperties(this.mappedDefinition.items.data.items.measures):void 0},getCreatePropertyHandler:function(e){var t,n,i=this.globalChangeListeners;return this.model&&this.model.layout&&this.model.layout.qListObject?(t=o.mapProperties(this.dimensionDefinition),new a({app:e,dimensionDefinition:this.dimensionDefinition,dimensionProperties:t})):(t=this.getDefaultDimensionProperties(),n=this.getDefaultMeasureProperties(),new s({app:e,dimensionDefinition:this.dimensionDefinition,measureDefinition:this.measureDefinition,dimensionProperties:t,measureProperties:n,globalChangeListeners:i}))},mapSoftProperties:function(){function e(t){var n=[{diffs:t.ref||t.sortIndexRef?[t.ref||t.sortIndexRef]:t.diffs||[]}];return t.items&&Object.keys(t.items).forEach(function(i){n.push({diffs:e(t.items[i])})}),t._diffs=n,n}if(this.softDefinition){var t=o.mapDefinition(this.softDefinition,null,d);e(t),this.mappedSoftDefinition=t}},hasError:function(e){var t=e.layout,n=e.ext&&e.ext.options.hyperCubePath?t[e.ext.options.hyperCubePath].qHyperCube:t.qHyperCube;return n?!!n.qError:!!t.qListObject&&!!t.qListObject.qError},showRequirements:function(e){var t,n=e.ext.dimensionDefinition?e.ext.dimensionDefinition.min:0,i=e.ext.measureDefinition?e.ext.measureDefinition.min:0,r=p(e.layout,e.ext.options.hyperCubePath),o=f(e.layout,e.ext.options.hyperCubePath);if(n>0&&r.length<n)return!0;for(t=0;t<r.length;++t)if(r[t].qError)return!0;if(i>0&&o.length<i)return!0;for(t=0;t<o.length;++t)if(o[t].qError)return!0;return!1},addFieldDimension:function(t,n){return n.model.getProperties().then(function(i){var r=n.getCreatePropertyHandler();return r.setProperties(i),r.addFieldDimension(t.value,t.trimmedValue).then(function(t){return r.updateGlobalChangeListeners(),e.$rootScope.$broadcast("pp-open-path","data."+t.qDef.cId),n.model.setProperties(i)})})},addLibraryDimension:function(t,n){return n.model.getProperties().then(function(i){var r=n.getCreatePropertyHandler();return r.setProperties(i),r.addLibraryDimension(t.libraryId).then(function(t){return r.updateGlobalChangeListeners(),e.$rootScope.$broadcast("pp-open-path","data."+t.qDef.cId),n.model.setProperties(i)})})},addLibraryMeasure:function(t,n){return n.model.getProperties().then(function(i){var r=n.getCreatePropertyHandler();return r.setProperties(i),r.addLibraryMeasure(t.libraryId).then(function(t){r.updateGlobalChangeListeners(),e.$rootScope.$broadcast("pp-open-path","data."+t.qDef.cId),n.model.setProperties(i)})})},addExpressionMeasure:function(t,n){return n.model.getProperties().then(function(i){var r=n.getCreatePropertyHandler();return r.setProperties(i),r.addExpressionMeasure(t.value,t.trimmedValue).then(function(t){return r.updateGlobalChangeListeners(),e.$rootScope.$broadcast("pp-open-path","data."+t.qDef.cId),n.model.setProperties(i)})})},getDropFieldOptions:function(e,t,n,i,r){e.Add(n,t,r),e.ReplaceDimensions(n,t,r),e.AddFieldAsMeasure(n,t,r),e.ColorBy(n,t,r),i()},getDropDimensionOptions:function(t,n,i,r,o){n.getDimensions().length<n.minDimensions()?n.addLibraryDimension(t.item.id).then(function(t){i.setProperties(n.properties),e.$rootScope.$broadcast("pp-open-path","data."+t.qDef.cId)}):(t.Add(i,n,o),t.ReplaceDimensions(i,n,o),t.ColorBy(i,n,o),r())},getDropMeasureOptions:function(t,n,i,r,o){var s=n.getMeasures().length;s<n.minMeasures()||0===s&&s<n.maxMeasures()?"expression"===t.item.type?n.addExpressionMeasure(t.item.name,"").then(function(t){i.setProperties(n.properties),e.$rootScope.$broadcast("pp-open-path","data."+t.qDef.cId)}):n.addLibraryMeasure(t.item.id).then(function(t){i.setProperties(n.properties),e.$rootScope.$broadcast("pp-open-path","data."+t.qDef.cId)}):(t.Add(i,n,o),t.ReplaceMeasures(i,n,o),t.ColorBy(i,n,o),r())},getDropTemplateOptions:function(e,t,n,i,r){var o=this,s=c.getType(e.item.template),a=["contextMenu.convertTo",e.item.name];o.type!==s.type?s.getExtensionType().then(function(t){!r.isReadonly&&!n.layout.qHasSoftPatches&&o.exportProperties&&t.importProperties&&e.menu.addItem({translation:a,tid:"convert",select:function(){o._convert(s,t,e.item)}}),i()},function(){i()}):i()},getDropOptions:function(e,n,i){var r,o,s,a=e.model,l=this;if(o={field:"getDropFieldOptions",dimension:"getDropDimensionOptions",measure:"getDropMeasureOptions",template:"getDropTemplateOptions",expression:"getDropMeasureOptions"},r=n.item.type,s=o[r])return a.getProperties().then(function(r){var o=e.getCreatePropertyHandler(),c=t.extend(!0,{},r);return o.setProperties(c),o.setLayout(e.model&&e.model.layout),l[s](n,o,a,i,e)});i()},_convert:function(e,t,i){var r,o,s=this;n.all({initialProperties:e.getInitialProperties(i.init),propertyTree:s.model.getFullPropertyTree()}).then(function(e){try{r=s.exportProperties(e.propertyTree,s.options?s.options.hyperCubePath:void 0),n.all({dimensionList:s.model.app.getDimensionList(),measureList:s.model.app.getMeasureList()}).then(function(n){m(r,n.dimensionList,n.measureList),o=t.importProperties(r,e.initialProperties,t,t.options?t.options.hyperCubePath:void 0),s.model.getLayout().then(function(e){e.qHasSoftPatches?(s.model.markAsCancelled(),s.model.clearSoftPatches().then(function(){s.model.setFullPropertyTree(o).then(function(){s.model.markAsInvalid()})})):s.model.setFullPropertyTree(o)})})}catch(e){}})},exportProperties:function(e){return e.qProperty.qHyperCubeDef?h.hypercube.exportProperties(e):e.qProperty.qListObjectDef?h.listbox.exportProperties(e):h.other.exportProperties(e)},importProperties:function(e,t,n){return t.qHyperCubeDef?h.hypercube.importProperties(e,t,n):t.qListObjectDef?h.listbox.importProperties(e,t,n):h.other.importProperties(e,t,n)},support:{cssScaling:!1,sharing:!1,colorBy:!1,viewData:!1,snapshot:!1,export:!1,exportData:!0},options:{},hasNewType:function(e,t){return e.type!==t}}}),define("objects.extension/library-info",["util","core.utils/feature-flags","client.utils/capability-flags"],function(e,t,n){function i(t,n){if(!t)throw new Error("Missing type: "+t);var i={translationKey:"",icon:"",iconChar:"e",isLibraryItem:!0,visible:!0};o[t]=e.extend(i,n)}function r(t,n){if(!n.icon)throw new Error("Missing icon for type: "+t);if(!n.iconChar)throw new Error("Missing iconChar for type: "+t);if(!1!==n.isLibraryItem&&!n.descriptionKey)throw new Error("Missing descriptionKey for type: "+t);var r={name:t,template:t,author:"Qlik",isThirdParty:!1};i(t,e.extend(r,n))}var o={};return n.getFlag("DM_GOOD_DEFAULTS")&&r("auto-chart",{descriptionKey:"Template.preview.description.auto-chart",translationKey:"Object.AutoChart",icon:"auto-chart",iconChar:"",visible:!1}),r("barchart",{descriptionKey:"Template.preview.description.barchart",translationKey:"Object.BarChart",icon:"bar-chart",iconChar:"!"}),r("combochart",{descriptionKey:"Template.preview.description.combochart",translationKey:"Object.ComboChart",icon:"combo-chart",iconChar:""}),r("distributionplot",{descriptionKey:"Template.preview.description.distributionplot",translationKey:"Object.DistributionPlot",icon:"distributionplot",iconChar:""}),r("boxplot",{descriptionKey:"Template.preview.description.boxplot",translationKey:"Object.BoxPlot",icon:"boxplot",iconChar:""}),r("filterpane",{descriptionKey:"Template.preview.description.filterpane",translationKey:"Object.FilterPane",icon:"filterpane",iconChar:"."}),r("gauge",{descriptionKey:"Template.preview.description.gauge",translationKey:"Object.Gauge",icon:"gauge-chart",iconChar:")"}),r("histogram",{descriptionKey:"Template.preview.description.histogram",translationKey:"Object.Histogram",icon:"histogram",iconChar:""}),r("kpi",{descriptionKey:"Template.preview.description.kpi",translationKey:"Object.Kpi",icon:"kpi",iconChar:"1"}),r("linechart",{descriptionKey:"Template.preview.description.linechart",translationKey:"Object.LineChart",icon:"line-chart",iconChar:"%"}),r("listbox",{descriptionKey:"Template.preview.description.listbox",translationKey:"Object.Listbox",icon:"list",iconChar:"-",isLibraryItem:!1}),r("piechart",{descriptionKey:"Template.preview.description.piechart",translationKey:"Object.PieChart",icon:"pie-chart",iconChar:"&"}),r("pivot-table",{descriptionKey:"Template.preview.description.pivot-table",translationKey:"Object.PivotTable",icon:"pivot-table",iconChar:"("}),r("map",{descriptionKey:"Template.preview.description.map",translationKey:"Object.Map",icon:"map",iconChar:","}),r("scatterplot",{descriptionKey:"Template.preview.description.scatterplot",translationKey:"Object.ScatterPlot",icon:"scatter-chart",iconChar:"+"}),r("table",{descriptionKey:"Template.preview.description.table",translationKey:"Object.Table",icon:"table",iconChar:"'"}),r("text-image",{descriptionKey:"Template.preview.description.text-image",translationKey:"Object.TextImage",icon:"text",iconChar:"/"}),r("treemap",{descriptionKey:"Template.preview.description.treemap",translationKey:"Object.Treemap",icon:"treemap",iconChar:""}),r("waterfallchart",{descriptionKey:"Template.preview.description.waterfallchart",translationKey:"Object.WaterfallChart",icon:"waterfallchart",iconChar:""}),t.GEO_MAPCHART&&r("map-chart",{descriptionKey:"Template.preview.description.map",translationKey:"MapChart",icon:"map",iconChar:","}),r("widget",{translationKey:"Object.Widget",icon:"widget",iconChar:"",name:"Widget",description:"Qlik Sense Widget",isLibraryItem:!1}),{registerThirdPartyLibraryInfo:function(t,n){var r={name:t,description:n.description||"",template:t,icon:"puzzle",iconChar:"g",isThirdParty:!0},o=e.extend(r,n);"bar-chart-vertical"===o.icon&&(o.icon="bar-chart"),i(t,o)},getLibraryInfo:function(t){return e.extend({},o[t])}}}),define("objects.views/selections/cache-item",[],function(){"use strict";function e(e,t,n,i,r,o,s){if(e instanceof Array&&!e[0].pointInside&&!e.pointInside)throw"The shape must implement a `pointInside` function";this.setShape(e),this.selected=!!t,this.value=n,this.parent=i,this.index=r,this.objectShapes={},o&&(this.parent=o.parent,this.node=o,this.rowIndex=o.data.rowIndex,this.label=o.data.qText,this.id=o.data.qElemNo),s&&e&&(this.objectShapes[s]=e instanceof Array?e:[e])}return e.prototype={getShapes:function(e){return(e||0===e)&&this.objectShapes&&this.objectShapes[e]?this.objectShapes[e]:this.shapes?this.shapes:[this.shape]},addShape:function(e,t){this.objectShapes[e]instanceof Array||(this.objectShapes[e]=[]),this.objectShapes[e].push(t),this.shapes.push(t)},setShape:function(e){this.shape=e instanceof Array?e[0]:e,this.shapes=e?e instanceof Array?e:[e]:[]},addValue:function(e){void 0===this.value&&(this.value=[]),this.value instanceof Array||(this.value=[this.value]),this.value.push(e)}},e}),define("objects.extension/default-selection-toolbar",["core.utils/class"],function(e){"use strict";return e.extend("SelectionToolbar",{menuButtons:[],init:function(e,t,n,i,r,o){this.backendApi=e,this.selectionsApi=t,this.showMenu=n,this.showLock=i,r=r||[],this.menuButtons=o||[];var s=[{name:"Tooltip.clearSelection",tid:"selection-toolbar.clear",isIcon:!0,buttonClass:"clear",iconClass:"lui-icon lui-icon--clear-selections",action:function(){this.selectionsApi.clear()},isDisabled:function(){return!this.selectionsApi.selectionsMade}},{clazz:"sel-toolbar-separator",buttonClass:"sel-toolbar-icon-separator",isDisabled:function(){return!0}}];s.push({name:"Tooltip.CancelSelections",tid:"selection-toolbar.undo",isIcon:!1,iconClass:"lui-icon lui-icon--close",buttonClass:"sel-toolbar-cancel",action:function(){this.selectionsApi.cancel()}}),s.push({name:"Tooltip.ConfirmSelections",tid:"selection-toolbar.refresh",iconClass:"lui-icon lui-icon--tick",buttonClass:"sel-toolbar-confirm",action:function(){this.selectionsApi.confirm()},isDisabled:function(){return!this.selectionsApi.selectionsMade}}),this.buttons=r.concat(s)},hasState:function(e){if(!e)return!0;for(var t=this.backendApi.getDimensionInfos(),n=0;n<t.length;++n)for(var i=0;i<e.length;++i)if(t[n].qStateCounts[e[i]]>0)return!0;return!1}})}),define("objects.utils/interaction-states",[],function(){"use strict";return{STATIC:0,ANALYSIS:1,EDIT:2}}),define("objects.extension/default-view",["objects.extension/base-view","core.utils/deferred","qvangular","general.utils/shapes/rect","objects.views/selections/cache-item","objects.extension/default-selection-toolbar","objects.utils/interaction-states"],function(e,t,n,i,r,o,s){"use strict";var a;return a=e.extend("DefaultView",{$scope:null,$element:null,containerRect:null,options:null,selections:null,backendApi:null,activeDimensions:[0],selectedShapes:[],init:function(e,t,n,i){this._super(e,t,n,i),e.selectValues=this.selectValues.bind(this)},on:function(){this.selections&&this.selections.on(),this.tooltips&&this.tooltips.on(),this.options&&!1===this.options.selections?this.selectionsEnabled=!1:this.selectionsEnabled=!0,this._on=!0},off:function(){this.selections&&this.selections.off(),this.tooltips&&this.tooltips.off(),this.selectionsEnabled=!1,this._on=!1},isOn:function(){return this._on},suppressOnPaint:function(e){return this.$scope.object._forcePaint?(this.$scope.object._forcePaint=!1,!1):e.qSelectionInfo&&e.qSelectionInfo.qInSelections},paint:function(){return t.resolve()},destroy:function(){this.$scope.selectValues=null},initialize:function(){this.selections&&this.initSelections(),this.options&&(isNaN(this.options.interactionState)||this.setInteractionState(this.options.interactionState),this.options.direction&&this.setDirection(this.options.direction)),this.tooltips&&this.initTooltips()},setSelections:function(e){this.selections=e},initSelections:function(){this.selections&&(this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",{rect:new i(0,0,this.$element.width(),this.$element.height())}),this.options._disableSelections||(this.selections.Select.bind(function(e,t){this.onSelect(e,t)}.bind(this)),this.selections.ToggleShape.bind(function(e){var t=this.selectedShapes.indexOf(e);-1!==t?this.selectedShapes.splice(t,1):this.selectedShapes.push(e),this.onToggleShape(e)}.bind(this)),this.selections.Deactivated.bind(function(){this.selectedShapes=[]}.bind(this)),this.selections.Clear.bind(function(){this.selectedShapes=[]}.bind(this))))},setTooltips:function(e){this.tooltips=e},initTooltips:function(){},refreshSelections:function(){this.selections&&(this.containerRect=this.$element[0].getBoundingClientRect(),this.selections.cache.clear())},onToggleShape:function(e){e.$element[this.isSelected(e.value)?"addClass":"removeClass"]("selected")},onSelect:function(e,t){if(e.length){var n=this.selectedShapes.map(function(e){return e.value});n.length>0&&this.activeDimensions.length>0?this.backendApi.select(n,this.activeDimensions,t):1!==e.length||e[0].selected||this.backendApi.clearSelections()}},onRangeSelect:function(){},addToSelectionCache:function(e,t){if(this.selections){var n=this.containerRect,o=e[0].getBoundingClientRect(),s=new r(new i(o.left-n.left,o.top-n.top,o.right-o.left,o.bottom-o.top),!1,t);s.$element=e,this.selections.cache.add(s)}},isSelected:function(e){return this.selectedShapes.filter(function(t){return t.value===e}).length},setSnapshotData:function(){},getSelectionToolbar:function(){var e=this;return new o(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1,[{name:"Tooltip.ToggleOnLassoSelection",tid:"selection-toolbar.toggleLasso",isIcon:!0,buttonClass:"sel-toolbar-icon-toggle",iconClass:"lui-icon lui-icon--lasso",action:function(){e.toggleLasso=!e.toggleLasso},isActive:function(){return this.name=e.toggleLasso?"Tooltip.ToggleOffLassoSelection":"Tooltip.ToggleOnLassoSelection",e.toggleLasso},isDisabled:function(){return!(!e.isLassoDisabled||!e.isLassoDisabled())}}],[])},selectValues:function(e,t,n){if(this.selectionsEnabled){var i=this.$scope;if(!i.selectionsApi.active){var r=this;i.selectionsApi.confirm=function(){i.backendApi.endSelections(!0),i.selectionsApi.deactivated()},i.selectionsApi.cancel=function(){i.backendApi.endSelections(!1),i.selectionsApi.deactivated()},i.selectionsApi.deactivate=function(){this.deactivated()},i.selectionsApi.clear=function(){r.clearSelectedValues(r.$element),i.backendApi.clearSelections(),i.selectionsApi.selectionsMade=!1,r.selectedArrays={}},this.getSelectionToolbar=function(){return new o(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1,[],[])},i.selectionsApi.activated(),this.selectedArrays={}}if(this.$scope.selectionsApi.selectionsMade=!0,this.selectedArrays[e]||(this.selectedArrays[e]=[]),n)for(var s=0;s<t.length;s++){var a=this.selectedArrays[e].indexOf(t[s]);-1===a?this.selectedArrays[e].push(t[s]):this.selectedArrays[e].splice(a,1)}else this.selectedArrays[e]=this.selectedArrays[e].concat(t);this.backendApi.selectValues(e,this.selectedArrays[e],!1)}},clearSelectedValues:function(e){e.find(".selected").removeClass("selected")},setInteractionState:function(e){this._interactionState=e,this._inEditState=e===s.EDIT,this._inAnalysisState=e===s.ANALYSIS,this._inAnalysisState&&!this._on?this.on():!this._inAnalysisState&&this._on&&this.off()},setDirection:function(e){this.$scope.options.direction=e,this.options.direction=e,this.selections&&this.selections.options&&this.selections.options.range&&(this.selections.options.range.rtl="rtl"===e,this.selections.types.range.setDirection(e))},inAnalysisState:function(){return this._inAnalysisState},inEditState:function(){return this._inEditState},getPreferredSize:function(){}}),Object.defineProperties(a.prototype,{toggleLasso:{set:function(e){this.selections&&(this.selections.lassoEnabled=e,n.$apply(n.$rootScope,function(){this.options.lassoEnabled=e}.bind(this)))},get:function(){return this.selections&&this.selections.lassoEnabled}}}),a}),define("objects.extension/base-controller",["core.utils/class","core.utils/deferred","objects.extension/default-selection-toolbar"],function(e,t,n){"use strict";var i=e.extend({$scope:null,init:function(e){this.$scope=e},onPaint:function(){return t.resolve()},onResize:function(){return t.resolve()},setInteractionState:function(){},setFreeResize:function(){},setDirection:function(){},setSnapshotData:function(){},setBackendApi:function(){},getContextMenu:function(){},getObjectMenu:function(){},getSelectionToolbar:function(){return new n(this.$scope.backendApi,this.$scope.selectionsApi,!1,!1)},getPreferredSize:function(){},onInit:function(){return t.resolve()}});return i.$inject=["$scope"],i}),define("general.utils/shapes/point",[],function(){"use strict";function e(e,t){0===arguments.length?this.set(0,0):this.set(e,t)}return e.prototype={toString:function(){return this.x+" "+this.y},clone:function(){return new e(this.x,this.y)},set:function(e,t){this.x=e,this.y=t},equal:function(e){return this.x===e.x&&this.y===e.y},closeTo:function(e,t){return!!e&&(Math.abs(this.x-e.x)<t&&Math.abs(this.y-e.y)<t)},distanceTo:function(e){return e?Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)):NaN}},e}),define("objects.views/charts/utils/cache-utils",[],function(){function e(t,n){return t.forEach(function(t){if(t.isCacheItem)n.push(t);else if(t.data.cacheItem)n.push(t.data.cacheItem);else if(t.cacheItem&&(n.push(t.cacheItem),t.cacheItem.isCacheItem))throw"Using new cache item before its time";t.children&&t.children.length>0&&e.apply(this,[t.children,n])}),n}return{getCacheItems:function(){return this.children&&this.children?e.apply(this,[this.children,[]]):[]}}}),define("objects.views/charts/utils/tree-iterator",[],function(){var e={getLevel:function(){if(this&&this.parent!==this){for(var e=this.parent,t=0;e;)t+=1,e=e.parent;return t}},each:function(t){var n,i=this.children;if(i)for(n=0;n<i.length;n+=1){if(t&&!1===t(i[n],n,i.length-1))return!1;if(!1===e.each.call(i[n],t))return!1}},getLeaves:function(){if(!this.children||!this.children)return[];var t,n=[];for(t=0;t<this.children.length;t+=1)this.children[t]&&this.children[t].children&&this.children[t].children.length?n=n.concat(e.getLeaves.call(this.children[t])):n.push(this.children[t]);return n}};return e}),define("objects.views/selections/shapes-from",["jquery","core.utils/class","objects.views/charts/utils/cache-utils","objects.views/charts/utils/tree-iterator"],function(e,t,n,i){"use strict";function r(e){return e?e.selectionIdentifier:null}function o(e,t){if(t){var n=!1;return t.contains(0)&&(n=e.parent?-2===e.parent.id:-2===e.id),e.parent&&t.contains(1)&&(n=n||-2===e.id),n}return-2===e.id||e.parent&&-2===e.parent.id}function s(e,t){return e&&e.length?t.filter(function(t){return e.some(function(e){return t.col===e.col&&t.id===e.id})}):[]}return t.extend({init:function(t,n){this.options=e.extend(!0,{},{allowNullSelect:!1,activeComponent:null},n),this.cache=t,this.allowNullSelect=this.options.allowNullSelect,this.activeComponent=this.options.activeComponent},shapeFromPoint:function(e){return this.shapesFromPoints([e])[0]},shapesFromPoints:function(e){var t,n,i,s,a,l,c,u,h,d,p=this.cache.data,f=this.cache.data.length,m=e.length,g=this.activeComponent||this.components&&this.components.dataArea?(this.activeComponent||this.components.dataArea[0]).chartScale||1:1,v=r(this.activeComponent),y=[];for(u=0;u<f;++u)if(c=p[u],!o(c)||this.allowNullSelect)for(h=0;h<m;++h)for(n={x:(t=e[h]).x/g,y:t.y/g},a=c.getShapes(r(this.activeComponent)),"dataArea"===v&&c.toggleShapes&&(a=a.concat(c.toggleShapes)),s=a.length,d=0;d<s;++d)if(l=a[d],i=l.clearModelView?t:n,l.pointInside(i.x,i.y)){y.push(c);break}return y},shapesFromLines:function(e){var t,n,i,s,a,l,c,u=this.cache.data,h=this.cache.data.length,d=e.length,p=[];for(a=0;a<h;++a)if(s=u[a],!o(s)||this.allowNullSelect)for(l=0;l<d;++l)for(t=e[l],n=(i=s.getShapes(r(this.activeComponent))).length,c=0;c<n;++c)if(i[c].intersectsLine(t)){p.push(s);break}return p},shapesFromPolygon:function(e){var t,n,i,s,a,l,c,u,h,d,p=this.cache.data,f=this.cache.data.length,m=[];for(c=0;c<f;++c)if(l=p[c],!o(l)||this.allowNullSelect)for(d=!1,s=(a=l.getShapes(r(this.activeComponent))).length,h=0;h<s&&!d;++h)for(i=(t=a[h].getPoints()).length,u=0;u<i;++u)if(n=t[u],e.pointInside(n.x,n.y)){m.push(l),d=!0;break}return m},shapesFromRect:function(e,t){if(!e)return[];var n,i,s,a,l,c,u=this.cache.data,h=this.cache.data.length,d=[];for(l=0;l<h;++l)if(a=u[l],!o(a)||this.allowNullSelect)for(n=(i=a.getShapes(t||r(this.activeComponent))).length,c=0;c<n;c++)if((s=i[c]).intersectsRect){if(s.intersectsRect(e)){d.push(a);break}}else if(e.intersectsWith(s)){d.push(a);break}return d},shapesFromRectForDirection:function(e,t,n){var i,s,a,l,c,u,h,d=this.cache.data,p=this.cache.data.length,f=[],m=0,g=0,v="";switch(t){case"x":m=e.x,g=e.getRight(),v="getRight";break;case"y":m=e.y,g=e.getBottom(),v="getBottom"}for(u=0;u<p;++u)if(i=d[u],!o(i)||this.allowNullSelect)for(s=(a=i.getShapes(n||r(this.activeComponent))).length,h=0;h<s;++h)if("cx"in(l=a[h])){if(l["c"+t]>=m&&l["c"+t]<=g){f.push(i);break}}else{if((c=l.getBoundingRect())[t]>=m&&c[t]<=g){f.push(i);break}if(c[v]()>=m&&c[v]()<=g){f.push(i);break}if(m>=c[t]&&g<=c[v]()){f.push(i);break}}return f},shapesFromRange:function(e,t,n,i){var r,s,a,l,c,u,h=Math.min(e,t),d=Math.max(e,t),p=this.cache.data,f=this.cache.data.length,m=this.activeComponent&&"function"==typeof this.activeComponent.getType?this.activeComponent.getType().indices:null,g=[];for(i=!1!==i,u=(n=!1!==n)&&i?function(e){return e>=h&&e<=d}:n?function(e){return e>=h&&e<d}:i?function(e){return e>h&&e<=d}:function(e){return e>h&&e<d},l=0;l<f;++l)if(r=p[l],!o(r)||this.allowNullSelect)for(s=r.values instanceof Array?r.values:r.value instanceof Array?r.value:[r.value],m&&m.length&&(s=s.filter(function(e,t){return m.indexOf(t)>=0})),c=0;c<s.length;c++)if(a=s[c],u(a)){g.push(r);break}return g},shapesFromDimensionValue:function(e){var t,n,i,r=this.cache.data,s=this.cache.data.length,a=[];for(n=0;n<s;++n)if(t=r[n],!o(t)||this.allowNullSelect)for(i=0;i<e.length;i++)if(t.id===e[i]){a.push(t);break}return a},groupedItemsFromShapes:function(e){var t,r,o,a,l=[];return t=void 0!==this.activeComponent.getSelectionIndices?this.activeComponent.getSelectionIndices():[0],r=t[t.length-1],e&&e[0]&&e[0].col===r?s(e,this.cache.data):(e.forEach(function(t){void 0!==(a=t.parent)&&(o=i.getLevel.call(a)-(t.isCacheItem?0:1))===r&&-1===l.indexOf(a)&&e&&l.push(a)}),l.length>0&&(e=[],l.forEach(function(t){e=e.concat(n.getCacheItems.call(t))})),e)},shapesFromIndex:function(e,t){var n,i,r=Math.min(e,t),o=Math.max(e,t),s=this.cache.data,a=this.cache.data.length,l=[];for(i=0;i<a;++i)void 0!==(n=s[i]).index&&n.index>=r&&n.index<=o&&l.push(n);return l},_isNull:o,release:function(){this.cache=null,this.allowNullSelect=null,this.activeComponent=null}})}),define("objects.views/selections/cache-consumer",["jquery","core.utils/class","general.utils/shapes/point","./shapes-from"],function(e,t,n,i){"use strict";function r(e){var t=this.indexOf(e);return t>=0?this.splice(t,1):null}function o(e,t){return Object.keys(t).filter(function(n){return t[n].filter(function(t){return t===e}).length})[0]}return t.extend({init:function(t,n){this.options=e.extend(!0,{},{components:{}},n),this._selectedShapes=[],this._cssTransform={scale:1},this.components=this.options.components,this.shapesFrom=new i(t,n)},setActiveComponent:function(e){this.activeComponent=e,this.shapesFrom.activeComponent=e},initComponent:function(){throw new Error("base.js: initComponent has to be implemented in subclass")},setComponent:function(e,t){var n=Array.isArray(t)?t.concat():[t];switch(n.forEach(function(e){var t=o(e,this.components);t&&this.removeComponent(t,e)},this),e){case"x":case"y":case"dataArea":case"colorLegend":this.components[e]&&this.components[e].forEach(function(e){-1===n.indexOf(e)&&this.deregister(this,e)},this),n.forEach(function(t){this.components[e]&&-1!==this.components[e].indexOf(t)||this.register(this,t)},this),this.components[e]=n;break;default:throw"Key "+e+" not implemented"}},addComponent:function(e,t){switch(e){case"x":case"y":case"dataArea":case"colorLegend":this.components[e]||(this.components[e]=[]),!r.call(this.components[e],t)&&this.register(this,t),this.components[e].push(t);break;default:throw"Key "+e+" not implemented"}},removeComponent:function(e,t){switch(e){case"x":case"y":case"dataArea":case"colorLegend":this.components[e]&&t&&r.call(this.components[e],t),t&&this.components[e]&&this.components[e].length||delete this.components[e],this.deregister(this,t);break;default:throw"Key "+e+" not implemented"}},register:function(){},deregister:function(){},getComponent:function(e,t,i){var r=new n(e-i.x,t-i.y);return Object.keys(this.components).map(function(e){return this.components[e]},this).reduce(function(e,t){return e.concat(t)}).filter(function(e){var t=(e.chartScale||1)*this._cssTransform.scale;return this.getRect(e).pointInside(r.x/t,r.y/t)},this)[0]},getRect:function(e){return e.rect},getComponentKey:function(e){return Object.keys(this.components).filter(function(t){return this.components[t].indexOf(e)>=0},this)[0]},getTransformedPoint:function(e,t,i){var r=this.getRect(this.activeComponent||this.components.dataArea[0]),o=(this.activeComponent||this.components.dataArea[0]).chartScale||1;return new n((e-r.x*o*this._cssTransform.scale-i.x)/this._cssTransform.scale,(t-r.y*o*this._cssTransform.scale-i.y)/this._cssTransform.scale)},getPagePoint:function(e,t,i,r){var o=this.getRect(i||this.activeComponent||this.components.dataArea[0]),s=(this.activeComponent||this.components.dataArea[0]).chartScale||1;return new n(e+o.x*s+r.x,t+o.y*s+r.y)},release:function(){this.activeComponent=null,this.shapesFrom&&this.shapesFrom.release(),this.components=null,this.options.components=null,this.shapesFrom=null}})}),define("objects.views/selections/interaction-type",["core.utils/class"],function(e){var t=e.extend({init:function(){},tap:{},taptwo:{},tapthree:{},swipe:{},swipetwo:{},rotate:{},mousemove:{},mouseleave:{},mousewheel:{},wheelswipe:{},exclusive:function(){return!1},active:function(){return!0}});return{extend:function(){return 2===arguments.length?t.extend.call(e,arguments[0],arguments[1]):new(t.extend(arguments[0]))}}}),define("objects.utils/event-utils",["qvangular","touche"],function(e,t){"use strict";function n(e,t,n){return function(){var r,s=this,a=arguments;i(n=n||o),r=setTimeout(function(){e.apply(s,a)},t),n.debounceTimer=r}}function i(e){(e=e||o).debounceTimer&&clearTimeout(e.debounceTimer),e.debounceTimer=null}var r=t.Gesture.augment(function(e){return this.defaults={which:2,radiusThreshold:3},this.start=function(e,n){t.utils.touch||t.utils.msPointer&&e.pointerType!==e.MSPOINTER_TYPE_MOUSE&&"mouse"!==e.pointerType||this.isValidMouseButton(e,this.options.which)&&(this.initiated=!0,n.startPoint=n.points[0],this.binder.start.call(this,e,n))},this.update=function(e,t){!this.started&&t.startPoint&&t.startPoint.distanceTo(t.points[0])>=this.options.radiusThreshold?(this.started=!0,this.binder.update.call(this,e,t)):this.started&&this.binder.update.call(this,e,t)},this.end=function(e,t){this.initiated&&(this.binder.end.call(this,e,t),this.initiated=!1)},function(){e.apply(this,arguments)}});t.gestures.add("wheelswipe",r);var o={debouceTimer:null};return{getMouseWheelData:function(e){var t=0,n=0,i=0;return e.wheelDelta&&(t=e.wheelDelta/60),e.detail&&(t=-e.detail/3),i=t,void 0!==e.axis&&e.axis===e.HORIZONTAL_AXIS&&(i=0,n=-1*t),void 0!==e.wheelDeltaY&&(i=e.wheelDeltaY/60),void 0!==e.wheelDeltaX&&(n=-1*e.wheelDeltaX/60),{delta:t,deltaX:n,deltaY:i,x:e.pageX,y:e.pageY}},cancelGestures:function(e,t){e.gestures.forEach(function(n){n!==t&&e.cancelGesture(n)})},throttle:function(e,t,n){var i,r;return function(){var o=n||this,s=+new Date,a=arguments;i&&s<i+t?(clearTimeout(r),r=setTimeout(function(){i=s,e.apply(o,a)},t)):(i=s,e.apply(o,a))}},debounce:n,cancelDebounce:i,showLockedFeedback:function(t){t&&(t=t.map(function(e){return e.qGroupFieldDefs?e.qGroupFieldDefs[e.qGroupPos||0]:e.qFallbackTitle}),e.$rootScope.$broadcast("locked-feedback",[t]),n(function(){e.$rootScope.$broadcast("locked-feedback",[t,!0])},100)())}}}),define("objects.views/selections/interaction-handler",["jquery","touche","core.utils/class","core.utils/notification","objects.utils/event-utils"],function(e,t,n,i){function r(e){return b+"."+e}function o(e,t){return e.priority-t.priority}function s(e,t){return e.filter(function(e){return e.target===t.target&&e.container===t.container}).length?null:(t.priority=isNaN(t.priority)?0:t.priority,e.push(t),e.sort(o),t)}function a(e,t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}function l(e,t,n){return e.filter(function(e){return e[n]===t})}function c(e,t,n){for(var i,r=e.gesture,o=e.action,s=e.item.targets,a=0;a<s.length&&(!(i=s[a].target).active()||(i[r][o]&&i[r][o].apply(this,[t,n,s[a].data]),!i.exclusive()));a++);}function u(e,t,n){for(var i,r=e.gesture,o=e.item.targets,s=0;s<o.length&&!((i=o[s].target).active()&&(i[r].apply(this,[t,n,o[s].data]),i.exclusive&&i.exclusive()));s++);}function h(e,t){e.handlers.start=function(n,i){c.apply(this,[{gesture:t,action:"start",item:e},n,i])},e.handlers.end=function(n,i){c.apply(this,[{gesture:t,action:"end",item:e},n,i])},["swipe","swipetwo","wheelswipe","rotate"].contains(t)&&(e.handlers.update=function(n,i){c.apply(this,[{gesture:t,action:"update",item:e},n,i])},e.handlers.cancel=function(n,i){c.apply(this,[{gesture:t,action:"cancel",item:e},n,i])})}function d(e,t,n){var i={id:r(t),options:{preventDefault:n}};switch(Object.keys(e.handlers).forEach(function(t){i[t]=e.handlers[t]}),t){case"swipe":i.options.useMomentum=!0,i.options.inertia=.5;case"tap":i.options.touches=1;break;case"swipetwo":i.options.useMomentum=!0,i.options.inertia=.5;case"taptwo":i.options.touches=2;break;case"tapthree":i.options.touches=3}return i}function p(e){switch(e){case"taptwo":case"tapthree":return"tap";case"swipetwo":return"swipe";case"tap":case"swipe":case"wheelswipe":case"rotate":default:return e}}function f(e,n,i){var r=x[i].containers.filter(function(t){return t.container===e.container})[0];return r||(h(r={container:e.container,targets:[],handlers:{}},i),r.unbind=t(e.container)[p(i)](d(r,i,n)),x[i].containers.push(r)),s(r.targets,e),r}function m(t,n){var i=q[n].containers.filter(function(e){return e.container===t.container})[0];if(!i){(i={container:t.container,targets:[],handler:null}).handler=function(e){u.apply(this,[{gesture:n,item:i},e])};var r=n+"."+b+("mousewheel"===n?" DOMMouseScroll."+b:""),o=e(t.container);o.on(r,i.handler),i.unbindJqueryEvents=function(){o.off(r,i.handler)}}return s(i.targets,t),i}function g(e){switch(e){case"tap":case"swipe":case"taptwo":case"swipetwo":case"wheelswipe":case"tapthree":case"rotate":return"touche";case"mousemove":case"mouseleave":case"mousewheel":case"mouseup":return"jquery"}}var v=e(document),y=[],b="chart-interaction",x={tap:{containers:[]},taptwo:{containers:[]},tapthree:{containers:[]},swipe:{containers:[]},swipetwo:{containers:[]},wheelswipe:{containers:[]},rotate:{containers:[]}},q={mousemove:{containers:[]},mouseleave:{containers:[]},mousewheel:{containers:[]},mouseup:{containers:[]}},C=new(n.extend({init:function(){i.mixin(this),this.notification("ShiftToggle"),this.notification("CtrlToggle"),this.notification("KeyPressed"),this.notification("MouseUp"),this.notification("MouseLeave"),v.on("keydown."+b,function(e){16!==e.which||this.shiftPressed?17!==e.which||this.ctrlPressed||(this.ctrlPressed=!0,this.CtrlToggle.emit(this.ctrlPressed)):(this.shiftPressed=!0,this.ShiftToggle.emit(this.shiftPressed))}.bind(this)),v.on("keyup."+b,function(e){16===e.which&&this.shiftPressed?(this.shiftPressed=!1,this.ShiftToggle.emit(this.shiftPressed)):17===e.which&&this.ctrlPressed&&(this.ctrlPressed=!1,this.CtrlToggle.emit(this.ctrlPressed)),this.KeyPressed.emit(e.which)}.bind(this)),v.on("mouseup."+b,function(e){this.MouseUp.emit(e)}.bind(this)),v.on("mouseleave."+b,function(e){this.MouseLeave.emit(e)}.bind(this)),this.shiftPressed=!1,this.ctrlPressed=!1},addInteraction:function(e,t,n,i,r,o){var a=s(y,{target:e,container:t,priority:n,types:{},data:o});if(!a)throw new Error("Duplicate add of interaction, potential leak detected.");i.forEach(function(t){if(!e[t])throw new Error("Interaction reciver does not implement the specified interaction type: "+t);switch(t){case"tap":case"taptwo":case"swipe":case"swipetwo":case"wheelswipe":case"tapthree":case"rotate":a.types[t]=f(a,r,t);break;case"mousemove":case"mouseleave":case"mousewheel":case"mouseup":a.types[t]=m(a,t);break;default:throw"The specified interaction type does not exist: "+t}})},removeInteraction:function(e,n){var i=l(y,e,"target");n&&(i=l(i,n,"container")),i&&i.length&&i.forEach(function(e){Object.keys(e.types).forEach(function(n){var i=e.types[n];a(i.targets,e),i.targets.length||("touche"===g(n)?(t(i.container).off("*",r(n)),a(x[n].containers,i)):i.unbindJqueryEvents())}),a(y,e)})},removeAllInteraction:function(){Object.keys(x).forEach(function(e){x[e].containers.forEach(function(n){t(n.container).off("*",r(e))}),x[e].containers=[]}),y=[]}}));return{ShiftToggle:C.ShiftToggle,CtrlToggle:C.CtrlToggle,KeyPressed:C.KeyPressed,MouseUp:C.MouseUp,MouseLeave:C.MouseLeave,addInteraction:C.addInteraction,removeInteraction:C.removeInteraction,removeAllInteraction:C.removeAllInteraction,preventGestures:function(e){if(!e.gestureHandler)throw"Interaction.js, preventGestures: Called with invalid binder";t.preventGestures(e.gestureHandler)},_unitTestExposure:{toucheHandlers:x}}}),define("general.utils/arrow-positioner",[],function(){"use strict";function e(e){return{left:"right",right:"left",top:"bottom",bottom:"top"}[e]}var t=Math.floor;return{align:function(t,n,i,r){var o=e(i),s={left:{width:0,height:.5},right:{width:1,height:.5},top:{width:.5,height:0},bottom:{width:.5,height:1}}[o],a=0,l=0,c=0,u=0,h=n[0].getBoundingClientRect(),d=r.outerWidth();"left"===o||"right"===o?(c=parseInt(n.offset().top+h.height*(1-s.height)-t.offset().top-d*(1-s.height),10),"left"===o?l="auto":a="auto",u="auto"):(a=parseInt(n.offset().left+h.width*(1-s.width)-t.offset().left-d*(1-s.width),10),"bottom"===o?c="auto":u="auto",l="auto"),r.css({left:a,right:l,top:c,bottom:u})},alignToParent:function(t,n,i){var r,o,s=e(n),a={left:{width:0,height:.5},right:{width:1,height:.5},top:{width:.5,height:0},bottom:{width:.5,height:1}}[s],l=t.outerWidth(),c=t.outerHeight(),u=i.outerWidth(),h=i.outerHeight();"left"===s||"right"===s?(r=a.width*(l-u),o=i.offset().top-h*(1-a.height)):(r=l*(1-a.width)-u*(1-a.width),o=a.height*(c-h)+h),i.css({left:r,top:o})},alignToCoordinate:function(n,i,r,o,s){var a,l,c=e(o),u={left:{width:0,height:.5,size:-1},right:{width:1,height:.5,size:1},top:{width:.5,height:0,size:-1},bottom:{width:.5,height:1,size:1}}[c],h=n[0].getBoundingClientRect(),d=s[0].getBoundingClientRect();"left"===c||"right"===c?(a=u.width*(h.width-d.width)+d.width*u.size-parseInt(n.css("padding-left")),l=r-n.offset().top-d.width*(1-u.height)):(a=i-n.offset().left-d.width*(1-u.width),l=u.height*(h.height-d.height)+d.height*u.size),s.css({left:t(a),top:t(l)})}}}),define("text!objects.views/charts/tooltip/chart-tooltip.ng.html",[],function(){return'<div>\n\t<div ng-if="template" ng-include src="template"></div>\n\n\t<div ng-if="!template" qva-direction x-dir-setting="{{options.direction}}" class="qv-tooltip qvt-chart-tooltip" qva-press="hideTooltip($event)" tid="qv-chart-tooltip" ng-class="{\'above\':alwaysOnTop}">\n\t\t<div class="immidiate-contextual-arrow"></div>\n\t\t<div class="qv-chart-tooltip-inner">\n\t\t\t<div ng-repeat="item in content" class="qv-chart-tooltip-item">\n\t\t\t\t<div class="qv-chart-tooltip-content">\n\t\t\t\t\t<div qva-direction x-dir-text="{{item.header}}" x-dir-setting="{{options.direction}}" class=\'qv-tp-header\' ng-if="item.header !== undefined">\n\t\t\t\t\t\t<strong>{{item.header}}</strong>\n\t\t\t\t\t</div>\n\t\t\t\t\t<table>\n\t\t\t\t\t\t<tr ng-repeat="row in item.rows" class="qv-tp-row">\n\t\t\t\t\t\t\t<td class=\'qv-tp-item\'>\n\t\t\t\t\t\t\t\t<span qva-direction x-dir-text="{{row.label}}" class="qv-tp-rowPart" ng-class="{\'qv-tp-single\' : (content.length + item.rows.length) <= 3}">{{row.label}}</span>\n\t\t\t\t\t\t\t\t<span>:&nbsp;</span>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td ng-if="!row.template" class=\'qv-tp-value\'>\n\t\t\t\t\t\t\t\t<div class="qv-tp-rowPart" dir="ltr">{{row.value}}</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td ng-if="row.template" class=\'qv-tp-template qv-tp-value\' ng-bind-html="row.template">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="qv-chart-tooltip-excess" ng-if="numberInExcess > 0" q-translation="Object.ChartTooltip.NMore,{{numberInExcess}}">More</div>\n\t</div>\n</div>'}),define("objects.views/charts/tooltip/chart-tooltip-directive",["jquery","touche","qvangular","general.utils/arrow-positioner","general.utils/window-positioner","core.utils/resize","text!./chart-tooltip.ng.html"],function(e,t,n,i,r,o,s){n.directive("qvaChartTooltip",function(){return{template:s,replace:!0,scope:{content:"=",position:"=",visible:"=",direction:"=",template:"=",numberInExcess:"=",target:"=",hideCallback:"=",alwaysOnTop:"=",options:"="},link:function(s,a){var l,c,u=!1;l=function(e){var t=e?"block":"none";a.css("display",t)},s.synchronAlign=function(){var t,n=a.find(".qv-tooltip"),o=a.find(".immidiate-contextual-arrow");l(s.visible);var c=s.direction instanceof Array?s.direction:[s.direction];t=r.alignToBestCoordinate(n,s.position,c,s.target,!1,5,5);var h=n.offset(),d=r.getScrolledRect(e(window));switch(t.position){case"right":h.left+=9,t.y=d.y+Math.min(d.height-25,Math.max(25,t.y-d.y));break;case"left":h.left-=9,t.y=d.y+Math.min(d.height-25,Math.max(25,t.y-d.y));break;case"bottom":h.top+=9,t.x=d.x+Math.min(d.width-25,Math.max(25,t.x-d.x));break;default:h.top-=9,t.x=d.x+Math.min(d.width+d.x-25,Math.max(25,t.x-d.x))}n.offset(h),o.length&&(o.removeClass().addClass("immidiate-contextual-arrow").addClass(t.position),i.alignToCoordinate(n,t.x,t.y,t.position,o)),u=!1},s.align=function(){c=n.getService("$timeout")(s.synchronAlign)},s.$watch("position",function(e){e&&(e instanceof Array||e.x&&e.y)&&(u=!0,s.align())}),s.$watch("visible",function(e){u||l(e)}),s.$watch("content",function(e){e||(s.visible=!1)}),s.hideTooltip=function(e){s.visible=!1,s.hideCallback&&s.hideCallback(),e&&e.stopPropagation&&(e.stopPropagation(),e.preventDefault(),t.preventGestures())},s.$on("$destroy",function(){n.getService("$timeout").cancel(c),o.off("end",s.hideTooltip)}),o.on("end",s.hideTooltip)}}})}),define("objects.views/charts/tooltip/chart-tooltip-component",["./chart-tooltip-directive"],function(){return{transclude:!0,template:'<div qva-chart-tooltip position="position" content="content" direction="direction" visible="visible" template="template" number-in-excess="numberInExcess" target="target" hide-callback="hideCallback" always-on-top="alwaysOnTop" options="options"></div>',controller:["$scope",function(e){e.visible=!1,this.hide=function(){e.visible=!1},this.show=function(t){e.content=t.content,e.position=t.position,e.direction=t.direction,e.template=t.template,e.numberInExcess=t.numberInExcess,e.alwaysOnTop=t.alwaysOnTop,e.visible=!0,e.hideCallback=t.hideCallback,e.target=t.target,e.options={direction:t.dir}}}]}}),define("objects.views/charts/tooltip/chart-tooltip-service",["angular","qvangular","core.utils/notification","./chart-tooltip-component","angular"],function(e,t,n,i){"use strict";t.service("qvChartTooltipService",["$document","$timeout",function(t,r){function o(){r.cancel(c),c=null,r.cancel(l),l=null}var s,a,l,c,u=t.find("body"),h=e.element('<div id="qs-chart-tooltip">').appendTo(u),d=!1;return s={open:function(e,t,n){if(d&&a&&a.hide(),o(),!a){var u=e.position;e.position=void 0,a=h.showComponent(i,e),e.position=u}h.attr("dir",e.dir),l=r(function(){t&&(c=r(function(){s.close()},t)),d=!0,a.show(e)},n)},close:function(){this.Closed.emit(),a&&r(function(){a.hide()}),o()},destroy:function(){d&&a&&a.hide(),a=null}},n.create(s,"Closed"),s}])}),define("objects.views/charts/tooltip/chart-tooltip",["jquery","qvangular","general.utils/support","general.utils/shapes/rect","general.utils/shapes/point","objects.views/selections/cache-consumer","objects.views/selections/interaction-type","objects.views/selections/interaction-handler","objects.views/charts/tooltip/chart-tooltip-service"],function(e,t,n,i,r,o,s,a){"use strict";function l(e,t){return e.components&&e.components.dataArea&&e.components.dataArea.length&&e.components.dataArea[0].chartFormatter&&(null===e.components.dataArea[0].chartFormatter.measureFormatters||null===e.components.dataArea[0].chartFormatter.measureFormatters[t])}function c(e){var t=e.getBoundingRect();return isNaN(t.x+t.y+t.width+t.height)}function u(e){return e.getDimensions().join(", ")}function h(e){return e.id+(e.parent?"-"+e.parent.id:"")}function d(){M&&(M=null,A=null),D=null}function p(e,t,n,r){if(n){var o=new i(0,0,n.rect.width,n.rect.height);e=e.intersection(o)}return{positions:[t(e.x+e.width/2,e.y,n,r),t(e.x+e.width,e.y+e.height/2,n,r),t(e.x,e.y+e.height/2,n,r),t(e.x+e.width/2,e.y+e.height,n,r)],directions:["top","right","left","bottom"]}}function f(e,t){var n,i,r,o,s,a,l,u=[],h={positions:null,directions:null,target:null,component:null};return this._positionAtMouse||1!==this._cssTransform.scale?(n=t||e[0].interactPosition)&&(i=this.getTransformedPoint(n.x,n.y,this.containerRect),o=e[0].getShapes(),u=o.filter(function(e){return e.pointInside(i.x,i.y)}),h.target=u.length?u[0]:o[0],h.directions=["top","right","left","bottom"],h.positions=[n]):(e.forEach(function(e){var n=null,a=null;o=e.getShapes(),e.calculateTooltipPosition&&e.tooltipShape?(a=this.components[e.tooltipShapeComponent]?this.components[e.tooltipShapeComponent][0]:void 0,(r=e.getShapeBounds(e.tooltipShapeComponent,a?a.chartScale||1:1))&&(h.target=u.length?u[0]:o[0],h.component=a)):(e.tooltipShape&&!c(e.tooltipShape)?(u=[e.tooltipShape],h.component=this.components[e.tooltipShapeComponent]?this.components[e.tooltipShapeComponent][0]:void 0):t&&(i=this.getTransformedPoint(t.x,t.y,this.containerRect),u=o.filter(function(e){return e.pointInside(i.x,i.y)})),h.target=u.length?u[0]:o[0],h.target&&(h.target.getRelevantPosition?n=h.target.getRelevantPosition():(r=h.target.getBoundingRect(),!h.target.clearModelView&&h.component&&(l=h.component.chartScale||1,(r=r.clone()).set(r.x*l,r.y*l,r.width*l,r.height*l))))),n?(h.positions=[this.getPagePoint(n.pos.x,n.pos.y,h.component,this.containerRect)],h.directions=n.direction):s=s?r.combineWith(s):r},this),s&&(a=p(s,this.getPagePoint.bind(this),h.component,this.containerRect),h.positions=a.positions,h.directions=a.directions)),h}function m(e,t){var n,i,r,o,s,a,c,u=[],h=0,d=this.measureFormatters||[];if(e.isCacheItem)for(a=e.getMeasures(),i=(c=e.getMeasuresIndecies(t)).length,h;h<i;++h){var p=c[h];o=r=e.getValue(p),s=e.getPreformattedLabel(p),d[c[h]]?r="U"!==d[p].type&&s?s:d[p].format(r):r&&s&&l(this,p)?r=s:"NaN"===r&&(r="-"),a[p]&&void 0!==r&&u.push({label:a[p],value:r+"",num:o})}else for(i=e.node.children.length,h;h<i;++h)o=r=e.node.children[h].children[0].data.qNum||e.node.children[h].children[0].data.qValue,s=e.node.children[h].children[0].data.qText,d[h]&&(r="U"!==d[h].type&&s?s:d[h].format(r)),u.push({label:e.node.children[h].data.qText,value:r+"",num:o});this.colorMap&&(n=this.colorMap.getTooltipContent(e,t.rowIndex))&&u.splice(0,0,n);var f=[];return u.forEach(function(e){f.some(function(t){return t.label===e.label&&(t.value===e.value||t.num===e.num)})||f.push(e)}),f}function g(e,t){for(var n=[],i=0,r=0;i<E&&r<e.length;)n.push({header:u(e[r]),rows:m.call(this,e[r],t)}),i+=n[r].rows.length+1,r++;return e.length>r&&(n.numberInExcess=e.length-r),n}function v(e,n,i,r){var o=f.call(this,e,n);if(o.positions&&o.directions){var s=this.getPagePoint(0,0,o.component,this.containerRect),a=g.call(this,e,o.target);t.getService("qvChartTooltipService").open({target:{shape:o.target,targetToPageTranslation:s},position:o.positions,content:a,direction:o.directions,numberInExcess:a.numberInExcess,hideCallback:d.bind(this),dir:this.yMirrorMode?"rtl":"ltr"},i,r),M=e[0],A=e.map(h).join("")}}function y(e){var t=this.getTransformedPoint(e.x,e.y,this.containerRect);return this.shapesFrom.shapesFromPoints([t])}function b(e){return y.call(this,e).map(h).join("")}function x(e){var n=this;this.setActiveComponent(this.getComponent(e.x,e.y,this.containerRect));var i=y.call(n,e);i&&i.length&&this.activeComponent&&(n._positionAtMouse="MapArea"===n.activeComponent.className||1!==n._cssTransform.scale,D=t.getService("$timeout")(function(){v.call(n,i,e,n._duration),D=null},I))}function q(e,t){var n=this;e&&e.length&&this.activeComponent&&(n._positionAtMouse="MapArea"===n.activeComponent.className||1!==n._cssTransform.scale,v.call(n,e,null,2e4,t))}function C(){t.getService("$timeout").cancel(D),D=null,this.prevPoint=null}function S(){M&&(M=null,A=null,t.getService("qvChartTooltipService").close()),D=null}function w(e,t){var n,i,r=t?t.length:0;for(n=0;n<r;n++)if((i=t[n])&&i.pointInside&&i.pointInside(e.x,e.y))return!0;return!1}function _(e){var t,n,i,r=e?e.length:0,o=[];for(t=0;t<r;t++)n=e[t]._shapes,i||(i=e[t]._interactPosition)&&(i=this.getTransformedPoint(i.x,i.y,this.containerRect)),i&&w(i,n)&&(o[o.length]=e[t]);return o.length||(o=e),o}var D,M,A,E=7,I=500,T=o.extend("ChartTooltip",{init:function(e,t,n){this._super(n,t),this.cache=n,M=null,D=null,this.container=e,this.containerRect=new i(0,0,0,0),this._positionAtMouse=!0,this._enabled=!0,this._allowNullSelect=!0,this.touchTimeout=isNaN(t.touchTimeout)?10:t.touchTimeout,this._duration=7e3},refreshContainerRect:function(){var e=this.offset=this.container.offset(),t=this.container.width(),n=this.container.height();this.containerRect.set(e.left,e.top,t,n)},on:function(){function e(e){n.treatAsDesktop()?a.addInteraction(t._interactionEvents,e.container,0,["mousemove","mouseleave","swipe","mousewheel"]):a.addInteraction(t._interactionEvents,e.container,0,["swipe","swipetwo","rotate","tap"])}if(!this._isListening){this._isListening=!0;var t=this;this._interactionEvents=s.extend({mousemove:function(e){var n=new r(e.pageX,e.pageY);t.refreshContainerRect(),t.move(e,n)},mouseleave:function(e){t.leave(e)},mousewheel:function(){t.cancel()},swipe:{start:function(){t.cancel()},cancel:function(){t.cancel()}},swipetwo:{start:function(){t.cancel()},cancel:function(){t.cancel()}},rotate:{start:function(){t.cancel()},cancel:function(){t.cancel()}},tap:{end:function(e,n){var i=n.pagePoints[0];t.refreshContainerRect(),t.setActiveComponent(t.getComponent(i.x,i.y,t.containerRect));var r=y.call(t,i);r.forEach(function(e){e.interactPosition=i}),t.updateHighlightedShape(r)}},active:function(){return t._enabled}}),n.treatAsDesktop()&&a.MouseLeave.bind(t._interactionEvents.mouseleave),this.registerAddedComponent=function(t){e(t)},this.deregisterAddedComponent=function(e){a.removeInteraction(t._interactionEvents,e.container)},Object.keys(this.components).map(function(e){return t.components[e]}).forEach(function(e){e.forEach(function(e){t.registerAddedComponent(e)})})}},register:function(e,t){this.registerAddedComponent&&this.registerAddedComponent(t)},deregister:function(e,t){this.deregisterAddedComponent&&this.deregisterAddedComponent(t)},off:function(){this._isListening=!1,a.MouseLeave.unbind(this._onMouseLeave),a.removeInteraction(this._interactionEvents),this.registerAddedComponent=null,this.deregisterAddedComponent=null},initComponent:function(e){this.setActiveComponent(this.getComponent(e.x,e.y,this.containerRect))},updateHighlightedShape:function(e,t){if(e.length>=1){var i,r=!0,o=!1;if(!(i=_.call(this,e))||!i.length)return;n.treatAsDesktop()||((i=i.filter(function(e){return!e.selected})).length&&(M||D?(i.length>1||i[0]!==M)&&(r=!1,o=!0):(r=!1,o=!0)),r&&(C.call(this),S.call(this)),o&&q.call(this,i,this.touchTimeout))}else!n.treatAsDesktop()&&t&&(C.call(this),S.call(this))},getRect:function(e){return e?e.hasOwnProperty("innerRect")?e.innerRect:e.rect:new i(0,0,0,0)},move:function(e,t){n.treatAsDesktop()&&this._enabled&&(null!==D?(!this.prevPoint||t.distanceTo(this.prevPoint)>5)&&(C.call(this),x.call(this,t)):(this.prevPoint=t,M?b.call(this,t)!==A&&(S.call(this),x.call(this,t)):x.call(this,t)))},setCssTransform:function(e){this._cssTransform=e||{scale:1}},leave:function(t){var n=t.toElement||t.relatedTarget;e(n).hasClass("qvt-chart-tooltip")||e(n).parents(".qvt-chart-tooltip").length||(C.call(this),S.call(this))},cancel:function(){C.call(this),S.call(this)},clearSelection:function(){C.call(this),S.call(this)},release:function(){this._super(),this.off()}});return Object.defineProperties(T.prototype,{enabled:{set:function(e){this._enabled=e},get:function(){return this._enabled}}}),T}),define("objects.views/selections/cache-item-base",["core.utils/class"],function(e){"use strict";function t(e){var t=e.getBoundingRect();return isNaN(t.x+t.y+t.width+t.height)}var n=e.extend({init:function(e,t,n,i,r,o,s){if(e&&!(e instanceof Array)||t&&!(t instanceof Array)||n&&!(t instanceof Array)||i&&!(n instanceof Array))throw"The dimensions, measures and values input must be undefined or arrays";this.selected=!1,this.highlighted=!1,this.values=n||[],this.labels=i||[],this.row=r,this.col=o,this.id=s,this.parent=void 0,this.children=[],this._dimensions=e||[],this._measures=t||[],this._attrDims=[],this._attrDimTypes=[],this._objectShapes={},this._shapes=[],this._tooltipShape=void 0,this._tooltipShapeComponent=void 0},get siblings(){return this._parent?this._parent.children:[]},clearShapes:function(e){e&&this._objectShapes[e]&&(this._objectShapes[e]=[]),this._shapes=[];for(var t in this._objectShapes)this._shapes=this._shapes.concat(this._objectShapes[t])},getShapes:function(e){return e?this._objectShapes[e]||(this._objectShapes[e]=[]):this._shapes},getShapeBounds:function(e,n){if(this._calculateTooltipPosition&&e){var i=this.getShapes(e).map(function(e){var t=e.getBoundingRect();return e.clearModelView||(t=t.clone()).set(t.x*n,t.y*n,t.width*n,t.height*n),t});return(i=i.filter(function(e){return!t(e)})).length?i.reduce(function(e,t){return e.combineWith(t)},i[0]):null}return null},addShape:function(e,t,n){if(t instanceof Array&&(!t[0].pointInside||!t[0].getBoundingRect)||!t.pointInside||!t.getBoundingRect)throw"The shape must implement a `pointInside` function";this._objectShapes[e]instanceof Array||(this._objectShapes[e]=[]),this._objectShapes[e].push(t),this._shapes.push(t),n&&(this._tooltipShape=t,this._tooltipShapeComponent=e)},addMeasure:function(e,t,n){this.values.push(t),this.labels.push(n),this._measures.push(e)},getMeasures:function(){return this._measures},getMeasuresIndecies:function(){return this._measures.map(function(e,t){return t})},addDimension:function(e){this._dimensions.push(e)},getDimensions:function(){return this._dimensions},addAttributeDimension:function(e,t,n){this._attrDims.push({value:e,label:t,name:n})},getAttributeDimensions:function(e){return this._attrDims.length?isNaN(e)?this._attrDims.map(function(e){return e.value}):[this._attrDims[e].value]:null},getValue:function(e){return e=e||0,this.values[e]},getPreformattedLabel:function(e){return e=e||0,this.labels[e]},getCombinedElementID:function(){for(var e=this,t=[e.id];e.parent;)e=e.parent,t.push(e.id);return t.reverse(),t.join(",")}});return n.prototype.isCacheItem=!0,Object.defineProperties(n.prototype,{tooltipShape:{get:function(){return this._tooltipShape}},calculateTooltipPosition:{set:function(e){this._calculateTooltipPosition=e},get:function(){return this._calculateTooltipPosition}},interactPosition:{set:function(e){this._interactPosition=e},get:function(){return this._interactPosition}},tooltipShapeComponent:{get:function(){return this._tooltipShapeComponent}},label:{get:function(){throw new Error("CacheItem: label: Removed functionality")}},shape:{get:function(){throw new Error("CacheItem: shape: Removed functionality")}},value:{get:function(){throw new Error("CacheItem: value: Removed functionality")}}}),n}),define("objects.views/selections/cache",["./cache-item","./cache-item-base"],function(e,t){"use strict";function n(){this.data=[]}return Object.defineProperties(n.prototype,{has:{value:function(e){return-1!==this.data.indexOf(e)}},add:{value:function(n){if(!(n instanceof e||n instanceof t))throw"Invalid cache item!";this.has(n)||this.data.push(n)}},remove:{value:function(e){var t=this.data.indexOf(e);-1!==t&&this.data.splice(t,1)}},clear:{value:function(){this.data.length=0}}}),n}),define("objects.utils/selection-util",[],function(){return{isModalSelectionModel:function(e){return e&&e.enigmaModel&&e.enigmaModel.app&&e.enigmaModel===e.enigmaModel.app.modalSelectionObject},isInSelection:function(e){return e&&e.qSelectionInfo&&e.qSelectionInfo.qInSelections}}}),define("objects.extension/update-data-tracker",["qvangular"],function(e){"use strict";function t(){r.pending=0}var n,i=7500,r={pending:0,resetTime:void 0};return{begin:function(){n=n||e.getService("$timeout"),r.pending++,r.resetTime&&n.cancel(r.resetTime),r.resetTime=n(t,i)},end:function(){r.pending&&r.pending--},hasPending:function(){return r.pending>0}}}),define("general.utils/shapes/polygon",["general.utils/shapes/rect","general.utils/shapes/line"],function(e,t){"use strict";function n(t){var n,i,r=Number.MAX_VALUE,o=-Number.MAX_VALUE,s=Number.MAX_VALUE,a=-Number.MAX_VALUE,l=t?t.length:0;if(!l)return null;for(i=0;i<l;i++)o=(n=t[i]).x>o?n.x:o,r=n.x<r?n.x:r,a=n.y>a?n.y:a,s=n.y<s?n.y:s;return new e(r,s,o-r,a-s)}function i(){this._numPoints=this.points?this.points.length:0,this._closedPolygon=this._numPoints>1&&this.points[0].x===this.points[this._numPoints-1].x&&this.points[0].y===this.points[this._numPoints-1].y,this._closedPolygon?this._numLines=this._numPoints-1:this._numLines=this._numPoints,this._pointsChanged=!0}function r(e){0===arguments.length?this.set([]):this.set(e),this._pointsChanged=!0}return r.prototype={clone:function(){return new r(this.points.map(function(e){return e.clone()}))},set:function(e){this.points=e,i.call(this)},getPoints:function(){return this.points},getNumPoints:function(){return this.points?this.points.length:0},addPoint:function(e){this.points.push(e),i.call(this)},pointInside:function(e,t){if(this.calculateBounds(),!this._bounds)return!1;if(e<this._bounds.x||e>this._bounds.x+this._bounds.width||t<this._bounds.y||t>this._bounds.y+this._bounds.height)return!1;var n,i,r,o,s;for(n=!1,o=-1,r=(i=this.points.length)-1;++o<i;r=o){if(this.points[o].x===e&&this.points[o].y===t)return!0;if(this.points[o].y===this.points[r].y&&this.points[o].y===t&&(e-this.points[o].x)*(e-this.points[r].x)<=0)return!0;if(this.points[o].y<t&&t<=this.points[r].y||this.points[r].y<t&&t<=this.points[o].y){if(s=(this.points[r].x-this.points[o].x)*(t-this.points[o].y)/(this.points[r].y-this.points[o].y)+this.points[o].x,e===s)return!0;e<s&&(n=!n)}}return n},intersectsLine:function(e){if(!e)return!1;if(this.pointInside(e.x1,e.y1)||this.pointInside(e.x2,e.y2))return!0;var n,i;if(0===this._numPoints)return!1;if(1===this._numPoints)return!!e.intersectsLine(new t(this.points[0].x,this.points[0].y,this.points[0].x,this.points[0].y));for(i=this._numPoints-1,n=0;n<i;n++)if(e.intersectsLine(new t(this.points[n].x,this.points[n].y,this.points[n+1].x,this.points[n+1].y)))return!0;return!(this._closedPolygon||!e.intersectsLine(new t(this.points[i].x,this.points[i].y,this.points[0].x,this.points[0].y)))},intersectsLines:function(e){var t,n=e?e.length:0;for(t=0;t<n;t++)if(this.intersectsLine(e[t]))return!0;return!1},intersectsRect:function(e){if(!e)return!1;if(this.calculateBounds(),!this._bounds)return!1;if(e.rectInside(this._bounds))return!0;if(!this._bounds.intersectsWith(e))return!1;var n,i,r,o,s;return n=e.x,i=e.getRight(),r=e.y,o=e.getBottom(),!!(this.pointInside(n,r)||this.pointInside(i,r)||this.pointInside(i,o)||this.pointInside(n,o))||(s=[new t(n,r,i,r),new t(n,o,i,o),new t(n,r,n,o),new t(i,r,i,o)],this.intersectsLines(s))},calculateBounds:function(){return this._pointsChanged&&(this._bounds=n(this.points),this._pointsChanged=!1),this._bounds},getBoundingRect:function(){return this.calculateBounds()},translate:function(e,t){if(e||t){for(var n=0;n<this._numPoints;n++)this.points[n].x+=e,this.points[n].y+=t;this._pointsChanged=!0}},toString:function(){var e,t="",n=this._numPoints-1;for(e=0;e<n;e++)t+=this.points[e].toString()+",";return t+=this.points[n].toString()}},r}),define("objects.views/selections/types/base",["../cache-consumer"],function(e){"use strict";var t=e.extend({init:function(e,t){this._super(e.cache,t),this._selectedShapes=[],this.handler=e,this.options=t,this.components=t.components||{}},release:function(){this._super(),this.components={},this._selectedShapes=[],this.handler=null},resetSelectedShapes:function(){this._selectedShapes.length=0},getSelectedShapes:function(){return this._selectedShapes},toggleSelectedShape:function(e){var t=this._selectedShapes.indexOf(e);-1!==t?this._selectedShapes.splice(t,1):this._selectedShapes.push(e)},setActiveMode:function(e){this._activeMode=e},getActiveMode:function(){return this._activeMode},register:function(e,t){this.handler.register(e,t)},deregister:function(e,t){this.handler.deregister(e,t)},getActiveDimensions:function(){return this.activeComponent.getSelectionIndices()},toggle:function(){},toggleRect:function(){},start:function(){},update:function(){},end:function(){},cancel:function(){},move:function(){},leave:function(){},getTransformedPoint:function(e,t){return this._super(e,t,this.handler.containerRect)},getPagePoint:function(e,t,n){return this._super(e,t,n,this.handler.containerRect)},shapeFromPoint:function(e){return this.shapesFrom.shapeFromPoint(e)},shapesFromPoints:function(e){return this.shapesFrom.shapesFromPoints(e)},shapesFromLines:function(e){return this.shapesFrom.shapesFromLines(e)},shapesFromPolygon:function(e){return this.shapesFrom.shapesFromPolygon(e)},shapesFromRect:function(e,t){return this.shapesFrom.shapesFromRect(e,t)},shapesFromRectForDirection:function(e,t,n){return this.shapesFrom.shapesFromRectForDirection(e,t,n)},shapesFromRange:function(e,t,n,i){return this.shapesFrom.shapesFromRange(e,t,n,i)},shapesFromDimensionValue:function(e){return this.shapesFrom.shapesFromDimensionValue(e)},groupedItemsFromShapes:function(e){return this.shapesFrom.groupedItemsFromShapes(e)},shapesFromIndex:function(e,t){return this.shapesFrom.shapesFromIndex(e,t)},ToggleFlag:{select:1,deselect:2,auto:4,replace:8},toggleSelection:function(e,t){function n(n){var i=e.filter(n);i.forEach(function(e){r||(e.selected=!e.selected,l(e),s.emit(e,t))}),i.length>0&&a.emit(e,t)}var i,r=this.handler._disableSelections,o=this.ToggleFlag,s=this.handler.ToggleShape,a=this.handler.ToggleShapes,l=this.toggleSelectedShape.bind(this);(t=t||o.auto)&o.select?n(function(e){return!e.selected}):t&o.deselect?n(function(e){return e.selected}):t&o.auto?n(function(){return!0}):t&o.replace&&(i=e,e=this.handler.cache.data,n(function(e){return e.selected}),e=i,n(function(){return!0}))},clearSelection:function(){var e=this.handler.Clear,t=this.handler.cache.data,n=this.ToggleFlag.deselect;this.toggleSelection(t,n),e.emit()}});return t.defaultOptions={},t}),define("general.components/framer/framer",["qvangular","general.services/show-service/show-service"],function(e,t){var n={template:'<div class ="qv-framer" ng-style="style"></div>',controller:["$scope",function(e){e.style={},e.style.top=e.top,e.style.left=e.left,e.style.height=e.height,e.style.width=e.width,e.closeComponent()}],scope:{top:"=",left:"=",height:"=",width:"=",closeComponent:"="}};return{flash:function(i,r){var o=e.getService("$timeout"),s=t.show(n,{top:Math.min(i.y,r.y)+"px",left:Math.min(i.x,r.x)+"px",height:Math.max(i.y,r.y)-Math.min(i.y,r.y)+"px",width:Math.max(i.x,r.x)-Math.min(i.x,r.x)+"px",closeComponent:function(){o(function(){s.destroy(),s=null},300)}})}}}),define("objects.views/selections/types/data-area",["jquery","general.utils/shapes/point","general.utils/shapes/polygon","general.utils/shapes/rect","general.utils/shapes/line","./base","general.components/framer/framer"],function(e,t,n,i,r,o,s){"use strict";function a(){C.beginPath(),C.moveTo(p.x,p.y),C.fillStyle="rgba(77, 192, 78, 1)",C.arc(p.x,p.y,10,0,2*Math.PI,!0),C.fill()}function l(e,t,n){var i,r;!n||"x"!==n&&"y"!==n||(t[n]=p[n]),i=(e.x+t.x)/2,r=(e.y+t.y)/2,C.beginPath(),C.moveTo(e.x,e.y),C.quadraticCurveTo(i,r,t.x,t.y),C.stroke()}function c(e,t,n,i){var r,o=(i=i||[2,4]).length,s=n.x-t.x,a=n.y-t.y,l=Math.sqrt(s*s+a*a),c=l,u=0,h=!0,d=t.x,p=t.y;for(s/=l,a/=l,e.moveTo(d,p),u=0;c>=.1&&u<5e3;++u)0===(r=i[u%o])&&(r=.001),r>c&&(r=c),d+=r*s,p+=r*a,e[h?"lineTo":"moveTo"](d,p),c-=r,h=!h}function u(e,t){S.clearRect(0,0,b.width,b.height),S.beginPath(),c(S,e,t),S.stroke()}function h(){f.hide(),g.hide(),y.hide(),f.detach()}var d,p,f=e("<div />"),m=f[0],g=e("<canvas />"),v=g[0],y=e("<canvas />"),b=y[0],x=e("<canvas />"),q=x[0],C=v.getContext("2d"),S=b.getContext("2d"),w=q.getContext("2d"),_=[],D=!1,M=!1;return m.appendChild(v),m.appendChild(b),m.appendChild(q),m.className="selections-data-area-ui",f.hide(),d=o.extend("DataAreaSelection",{init:function(e,t){this._super(e,t),this.setActiveMode("item"),this._startIndex=-1,this._endIndex=-1},initComponent:function(){this.setActiveComponent(this.components.dataArea[0])},refreshCanvas:function(){this.rect=this.components.dataArea[0].rect;var e={position:"absolute",left:this.rect.x+"px",top:this.rect.y+"px",width:this.rect.width+"px",height:this.rect.height+"px","z-index":20};C.canvas.width=this.rect.width,C.canvas.height=this.rect.height,C.lineWidth=2,C.lineCap="round",C.lineJoin="round",C.strokeStyle="rgba(102,102,102,1)",C.fillStyle="rgba(102,102,102,1)",g.css(e),S.canvas.width=this.rect.width,S.canvas.height=this.rect.height,S.lineWidth=2,S.lineCap="round",S.lineJoin="round",S.strokeStyle="rgba(102,102,102,1)",y.css(e),w.canvas.width=this.rect.width,w.canvas.height=this.rect.height,x.css(e)},toggle:function(e,t,n){(n=void 0!==n?n:this.handler.getKeyAsToggleSelected(e))||this.clearSelection(),this.resetSelectedShapes(),this.setActiveComponent(this.components.dataArea[0]);var r,o=this.getTransformedPoint(t.x,t.y),s=this.options.toggle.callback||this.toggleSelection,a=this.options.indexSelection,l=this.ToggleFlag.auto|this.ToggleFlag.tooltip;return r=a?this.shapesFromRectForDirection(new i(o.x,o.y,0,0),"y"):this.shapesFromPoints([o]),(r=this.groupedItemsFromShapes(r)).forEach(function(e){e.selectionMode="dataArea"}),r.forEach(function(e){e.interactPosition=t}),s.call(this,r,l),r&&r.length>0},toggleRect:function(t,n,r){if(n&&r){var o,a,l,c,u,h,d,p,f,m,g,v=e(this.components.dataArea[0].container),y=v.offset(),b=function(e){return{x:Math.min(Math.max(e.x,y.left),y.left+v.width()),y:Math.min(Math.max(e.y,y.top),y.top+v.height())}};m=n=b(n),g=r=b(r),this.resetSelectedShapes(),n=this.getTransformedPoint(n.x,n.y),r=this.getTransformedPoint(r.x,r.y),o=Math.min(n.x,r.x),a=Math.min(n.y,r.y),l=Math.max(1,Math.abs(r.x-n.x)),c=Math.max(1,Math.abs(r.y-n.y)),u=new i(o,a,l,c),d=this.ToggleFlag.select,p=this.options.indexSelection,f=this.toggleSelection,this.setActiveComponent(this.components.dataArea[0]),h=p?this.shapesFromRectForDirection(u,"y"):this.shapesFromRect(u),(h=this.groupedItemsFromShapes(h)).forEach(function(e){e.selectionMode="dataArea"}),f.call(this,h,d),this.getSelectedShapes().length>0&&this.handler.Select.emit(this.getSelectedShapes(),!0),s.flash(m,g)}},start:function(e,n){this.handler.getKeyAsToggleSelected(e)||this.clearSelection(),this.resetSelectedShapes(),this.setActiveComponent(this.components.dataArea[0]);var r=this.getTransformedPoint(n.x,n.y),o=this.options.captureInput,s=this.options.indexSelection;if(o&&(g.show(),y.show(),f.appendTo(this.handler.container),f.show(),this.refreshCanvas()),_.length=0,_.push(r),p=new t(_[0].x,_[0].y),D=!1,M=!1,s){var l=this.shapesFromRectForDirection(new i(p.x,p.y,1,1),"y"),c=l.length&&l[0].index;void 0!==c&&c>=0&&(this._startIndex=c)}o&&a()},update:function(e,t){var n,o,s,a,c=this.getTransformedPoint(t.x,t.y),h=this.options,d=h.captureInput,f=h.lassoAutoCloseDistance,m=h.indexSelection,g=e.shiftKey&&h.shiftLockCapture?h.shiftLockAxis:"",v=this.ToggleFlag.select,y=-1,x=this.toggleSelection;n=_[_.length-1],_.push(c),d&&l(n,c,g),d&&(D||(D=_.length>2&&p.distanceTo(c)>=f),S.clearRect(0,0,b.width,b.height),D&&(p.distanceTo(c)<=f?(u(c,p),M=!0):M=!1)),m?(void 0!==(y=(a=this.shapesFromRectForDirection(new i(c.x,c.y,1,1),"y")).length?a[0].index:-1)&&y>=0&&(this._endIndex=y),o=this.shapesFromIndex(this._startIndex,this._endIndex),s=this.getSelectedShapes().filter(function(e){return-1===o.indexOf(e)}),x.call(this,s,this.ToggleFlag.deselect),x.call(this,o,v)):(o=this.shapesFromLines([new r(n.x,n.y,c.x,c.y)]),(o=this.groupedItemsFromShapes(o)).forEach(function(e){e.selectionMode="dataArea"}),x.call(this,o,v))},end:function(e){var t,i,r=this.options.captureInput,o=this.options.indexSelection,s=this.ToggleFlag.select,a=this.toggleSelection;o&&(this._startIndex=-1,this._endIndex=-1),r&&h(),r&&M&&(i=new n(_),t=this.shapesFromPolygon(i),(t=this.groupedItemsFromShapes(t)).forEach(function(e){e.selectionMode="dataArea"}),a.call(this,t,s)),_.length=0,this.getSelectedShapes().length>0&&this.handler.Select.emit(this.getSelectedShapes(),this.handler.getKeyAsToggleSelected(e))},cancel:function(e){_.length&&h(),e&&this.clearSelection(),this.setActiveComponent(null)}}),d.defaultOptions={captureInput:!0,indexSelection:!1,shiftLockCapture:!1,shiftLockAxis:"x",lassoAutoCloseDistance:50,autoConfirm:!1,toggle:{callback:null},interpolation:{pixelPrecision:2}},d}),define("text!objects.views/selections/types/range/range-template.ng.html",[],function(){return'<div class="qvt-range-selection">\n\t<div class="range-vertical-clip" ng-style="{ top: vOptions.offset, height: vOptions.rect.height }" ng-class="{ clip: vOptions.shouldClip }">\n\t\t<div class="range-vertical"\n\t\t\t ng-repeat="range in vRanges track by $index"\n\t\t\t qva-range-selection-range="y"\n\t\t\t ng-class="{\'near\': vOptions.dock == \'left\', \'far\' : vOptions.dock == \'right\'}"\n\t\t\t ng-style="range.style">\n\t\t\t<div class="range">\n\t\t\t\t<div class="axis-cover" ng-style="vRelevantSize" tid="range-vertical-cover" ng-class="{\'active\' : range.cover}"></div>\n\t\t\t</div>\n\t\t\t<div class="far-edge" tid="range-vertical-far" ng-class="{\'active\' : range.near}">\n\t\t\t</div>\n\t\t\t<div class="near-edge" tid="range-vertical-near" ng-class="{\'active\' : range.far}">\n\t\t\t</div>\n\t\t\t<div class="outer-bubble-wrapper" ng-style="vWrappperSize">\n\t\t\t\t<qva-range-selection-bubble tid="range-vertical-near-bubble" visible="visible" active-component="vComponent" handle-points="range.points" range-index="$index" horizontal="false" far="false" data="range.values.start" active="range.far"> </qva-range-selection-bubble>\n\t\t\t\t<qva-range-selection-bubble tid="range-vertical-far-bubble" visible="visible" active-component="vComponent" handle-points="range.points" range-index="$index" horizontal="false" far="true" data="range.values.end" active="range.near"> </qva-range-selection-bubble>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n\t<div class="range-horizontal-clip" ng-style="{ left: hOptions.offset, width: hOptions.rect.width }" ng-class="{ clip: hOptions.shouldClip }">\n\t\t<div class="range-horizontal"\n\t\t\t ng-repeat="range in hRanges track by $index"\n\t\t\t qva-range-selection-range="x"\n\t\t\t ng-class="{\'near\': hOptions.dock == \'bottom\', \'far\' : hOptions.dock == \'top\'}"\n\t\t\t ng-style="range.style">\n\t\t\t<div class="range">\n\t\t\t\t<div class="axis-cover" ng-style="hRelevantSize" tid="range-horizontal-cover" ng-class="{\'active\' : range.cover}"></div>\n\t\t\t</div>\n\n\t\t\t<div class="far-edge" tid="range-horizontal-far" ng-class="{\'active\' : range.far}">\n\t\t\t</div>\n\t\t\t<div class="near-edge" tid="range-horizontal-near" ng-class="{\'active\' : range.near}">\n\t\t\t</div>\n\t\t\t<div class="outer-bubble-wrapper" ng-style="hWrappperSize">\n\t\t\t\t<qva-range-selection-bubble tid="range-horizontal-near-bubble" visible="visible" active-component="hComponent" handle-points="range.points" range-index="$index" horizontal="true" far="false" data="range.values.start" active="range.near"> </qva-range-selection-bubble>\n\t\t\t\t<qva-range-selection-bubble tid="range-horizontal-far-bubble" visible="visible" active-component="hComponent" handle-points="range.points" range-index="$index" horizontal="true" far="true" data="range.values.end" active="range.far"> </qva-range-selection-bubble>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>'}),define("text!objects.views/selections/types/range/range-bubble.ng.html",[],function(){return'<div class="bubble-wrapper" ng-class="{\'far\' : far, \'near\' : !far}">\n\t<div ng-show="!editing" qva-direction x-dir-text="{{data.text}}" class="bubble range-bubble" ng-class="{\'active\' : active}">{{data.text}}</div>\n\t<input ng-show="editing" type="text" ng-class="{\'active\' : active, \'invalid\': invalid}" class="bubble range-input"/>\n</div>'}),define("objects.views/selections/types/range/range-bubble-directive",["jquery","touche","qvangular","text!./range-bubble.ng.html"],function(e,t,n,i){function r(e){e.$emit("rangeStart")}function o(e,t){e.editing=t,e.$emit("rangeEditChanged",t)}function s(e,t,n,i,r){e.$emit("rangeUpdate",t,n,i,!1,r)}function a(e,t){e.$emit("rangeEnd",t)}function l(){e(this).css("width",6*e(this).val().length+50+"px")}var c=".rangeselection";n.directive("qvaRangeSelectionBubble",["$timeout",function(e){return{template:i,replace:!0,restrict:"E",scope:{data:"=",active:"=",far:"=",horizontal:"=",activeComponent:"=",handlePoints:"=",visible:"=",rangeIndex:"="},link:function(n,i){function u(){f||(f=!0,t(h[0]).tap({id:c,options:{preventDefault:!1},start:function(){t.preventGestures(this.gestureHandler)}}),t(d[0]).tap({id:c,start:function(){t.preventGestures(this.gestureHandler)},end:function(){n.editable&&!n.editing&&(o(n,!0),n.onEditBubble())}}).swipe({id:c,start:function(){p=[{x:n.handlePoints[0].x,y:n.handlePoints[0].y},{x:n.handlePoints[1].x,y:n.handlePoints[1].y}],t.preventGestures(this.gestureHandler),r(n)},update:function(e,t){var i,r,o,a,l=n.far?1:0;n.horizontal?(i=t.swipe.deltaX,r="x"):(i=t.swipe.deltaY,r="y"),o=p[1^l][r],a=p[l][r]+i,0===l&&(n.horizontal&&a>o||!n.horizontal&&a<o)?(l=1,o=p[1][r]):1===l&&(n.horizontal&&a<o||!n.horizontal&&a>o)&&(l=0,o=p[0][r]),n.handlePoints[l][r]=a,n.handlePoints[1^l][r]=o,n.$digest(),s(n,n.handlePoints,r,n.rangeIndex)},end:function(){a(n,n.handlePoints)}}),h.keyup(l),n.onEditConfirmed=function(){if(n.editing){var e,t,i=h.val(),r={value:parseFloat(i),index:n.far?1:0,switch:!1},o=n.activeComponent.getPositionOfValue(r.value),l=n.handlePoints;isNaN(r.value)?n.invalid=!0:(t=n.horizontal?"x":"y",l[r.index][t]=o,(n.horizontal&&l[1][t]<l[0][t]||!n.horizontal&&l[1][t]>l[0][t])&&(e=l[1][t],l[1][t]=l[0][t],l[0][t]=e,r.index=r.index?0:1,r.switch=!0),n.endEditing(),s(n,n.handlePoints,t,n.rangeIndex,r),a(n,n.handlePoints)),n.$digest()}},n.$on("confirmEdit",n.onEditConfirmed))}var h=i.find(".range-input"),d=i.find(".range-bubble"),p={},f=!1;n.$watch("activeComponent",function(){n.editable=n.activeComponent&&!n.activeComponent.isDimension&&!n.activeComponent.isDiscrete()&&"function"==typeof n.activeComponent.getPositionOfValue,n.editable?(h.removeClass("non-editable"),d.removeClass("non-editable")):(h.addClass("non-editable"),d.addClass("non-editable"))}),n.endEditing=function(){n.invalid=!1,n.editing&&(o(n,!1),h.blur())},n.$watch("data.value",function(e){isNaN(e)?this.invalid=!0:(n.editing&&n.endEditing(),h.val(e))}),n.$watch("visible",function(){n.visible||n.endEditing()}),n.$on("off",function(){n.endEditing(),t(h[0]).off("*",c),t(d[0]).off("*",c),i.off("keyup"+c,"*"),f=!1}),n.onEditBubble=function(){n.editing=!0,h.css("width",d.width()),n.$digest(),h.focus(),h[0].setSelectionRange(0,9999),n.$digest(),e(function(){l.call(h)})},n.$on("on",u),u()}}}])}),define("objects.views/selections/types/range/range-directive",["touche","qvangular","general.utils/shapes/point","text!./range-template.ng.html","./range-bubble-directive"],function(e,t,n,i){function r(e,t,i,r){var o=[];return o[t]="y"===i?new n(e[t].x,e[t].y+r):new n(e[t].x+r,e[t].y),o[1^t]=e[1^t],o}function o(e){e.$emit("rangeStart")}function s(e,t,n,i,r){e.$emit("rangeUpdate",t,n,i,r)}function a(e,t){e.$emit("rangeEnd",t)}function l(e,t,n){return t?e[0][n]>e[1][n]?0:1:e[0][n]<e[1][n]?0:1}function c(t,n,i,c){var u,h,p,f=i?"x":"y";e(n).tap({id:d,options:{preventDefault:!0},start:function(){e.preventGestures(this.gestureHandler)}}).swipe({id:d,options:{radiusThreshold:0},start:function(){h=l(t.range.points,c,f),u=t.range.points,e.preventGestures(this.gestureHandler),o(t)},update:function(e,n){t.range.points=r(u,h,f,i?n.swipe.deltaX:n.swipe.deltaY),t.$digest(),t.range.near=t.range.far=!1,p=l(t.range.points,c,f)^!i?"far":"near",t.range[p]=!0,s(t,t.range.points,f,t.$index,!1)},end:function(){a(t,t.range.points),t.range.near=t.range.far=!1}})}function u(t,n){if(!t.isOn){t.isOn=!0;var i="hey";if(e(t.axisCover).tap({id:d,options:{preventDefault:!0},start:function(){e.preventGestures(this.gestureHandler)},end:function(e,t){n.$emit("rangeToggle",e,t.pagePoints[0])}}).swipe({id:d,options:{preventDefault:!0},start:function(){i=n.range.points,e.preventGestures(this.gestureHandler),o(n),n.range.cover=!0},update:function(e,r){"y"===t.dir?n.range.points=[{x:i[0].x,y:i[0].y+r.swipe.deltaY},{x:i[1].x,y:i[1].y+r.swipe.deltaY}]:n.range.points=[{x:i[0].x+r.swipe.deltaX,y:i[0].y},{x:i[1].x+r.swipe.deltaX,y:i[1].y}],n.$digest(),s(n,n.range.points,t.dir,n.$index,!0)},end:function(){a(n,n.range.points),n.range.cover=!1}}),!e.utils.touch){var r="x"===t.dir;c(n,t.farEdge,r,r),c(n,t.nearEdge,r,!r)}}}function h(t){e(t.axisCover).off("*",d),e(t.farEdge).off("*",d),e(t.nearEdge).off("*",d),t.isOn=!1}var d=".rangeselection";t.directive("qvaRangeSelectionRange",function(){return{scope:!1,link:function(e,t,n){var i={isOn:!1,dir:n.qvaRangeSelectionRange,axisCover:t.find(".axis-cover")[0],farEdge:t.find(".far-edge")[0],nearEdge:t.find(".near-edge")[0]};u(i,e),e.$on("on",function(){u(i,e)}),e.$on("off",function(){h(i)}),e.$on("$destroy",function(){h(i)})}}}),t.directive("qvaRangeSelection",function(){return{template:i,replace:!0,scope:{vOptions:"=",hOptions:"=",vRanges:"=",hRanges:"=",activeComponent:"=",hComponent:"=",vComponent:"=",visible:"="},link:function(e){e.vRelevantSize=0,e.hRelevantSize=0,e.activeOptions={y:{far:!1,near:!1,cover:!1},x:{far:!1,near:!1,cover:!1}},e.setRangeStyle=function(e,t,n){t&&n&&t.forEach(function(t){var n=t.points[0],i=t.points[1];t.style="y"===e?{height:Math.abs(n[e]-i[e]),top:Math.min(n[e],i[e])}:{width:Math.abs(n[e]-i[e]),left:Math.min(n[e],i[e])}})},e.$watchCollection("[vRanges, vOptions]",function(t){e.setRangeStyle("y",t[0],t[1])}),e.$watchCollection("[hRanges, hOptions]",function(t){e.setRangeStyle("x",t[0],t[1])}),e.$watch("hOptions",function(t){t&&e.setRelevantSize("x",t.rect.height)}),e.$watch("vOptions",function(t){t&&e.setRelevantSize("y",t.rect.width)}),e.setRelevantSize=function(t,n){"x"===t?(e.hRelevantSize={height:n+"px"},e.hWrappperSize={height:"calc(100% - "+n+"px)"}):(e.vRelevantSize={width:n+"px"},e.vWrappperSize={width:"calc(100% - "+n+"px)"})}}}})}),define("objects.views/selections/types/range/range-angular",["jquery","qvangular","./../base","general.utils/shapes/point","general.utils/shapes/rect","./range-directive"],function(e,t,n,i,r){"use strict";function o(e){if(e.isCacheItem){var t=e.getDimensions();return t[t.length-1]}return e.parent&&e.parent.data&&e.parent.data.qText?e.parent.data.qText:e.label}function s(e,t){for(var n=e.indicators||e.getLevels()[0],i=e.getPlotMax(),r=e.getPlotMin(),o=Number.MAX_VALUE,s=-1,a=0;a<n.values.length;a++){var l=n.values[a],c=Math.abs(t-l);if(!(l<r||l>i)){if(!(c<o))break;o=c,s=a}}if(-1!==a){var u=s;return{value:n.values[s],label:(n.qualifiedLabels||n.labels)[u]}}return null}function a(e,t,n){for(var i=e.getLevels(),r=i.length-1;r>=0;--r){for(var o=i[r],s=null,a=null,l=0;l<o.values.length;++l)o.values[l]===t&&(s=(o.qualifiedLabels||o.labels)[l]),o.values[l]===n&&(a=(o.qualifiedLabels||o.labels)[l]);if(s&&a)return{l1:s,l2:a}}return{l1:null,l2:null}}function l(e,t){var n=e.isDiscrete&&e.isDiscrete();if(!(e.isDimension&&!n))return null;var i=s(e,e.getValueOfPosition(t));return i?(i.newPoint=e.getPositionOfValue(i.value),Math.abs(i.newPoint-t)>T?null:i):null}function c(e,t){var n=this.getComponentKey(this.activeComponent),i="x"===n?"width":"height",r=e.rect[n],o=e.rect[n]+e.rect[i],s=this.activeComponent.rect,a=this.getRect(this.activeComponent),l=a[n]-s[n],c=l+a[i];r===o&&0===r&&(r=o=t[n]);var u=null,h=null;if(I[n].length>1)for(var d=0;d<I[n].length;++d){var p=I[n][d];if(e!==p){var f=p.rect[n],m=p.rect[n]+p.rect[i];m<=r&&(null===u||m>u)&&(u=m),f>=o&&(null===h||f<h)&&(h=f)}}return l<=r&&(null===u||l>u)&&(u=l),c>=o&&(null===h||c<h)&&(h=c),{min:u,max:h}}function u(e,t,n,i,r){var s,a,u,h,d,p=this.activeComponent,f=this.components.dataArea[0].rect,m=function(e,t,i){if(r){if(r.switch){var o=n.startVal;n.startVal=n.updateVal,n.updateVal=o}var s=Math.max(Math.min(r.value,p.getPlotMax()),p.getPlotMin());0===r.index&&"horizontal"===i||1===r.index&&"vertical"===i?n.startVal=s:n.updateVal=s}else n.startVal=p.getValueOfPosition(e),n.updateVal=p.getValueOfPosition(t),n.maxIncluded=!p.isDimension||p.getDataMax()<=n.updateVal},g=0,v=0,y=0,b=0,q=p.isDiscrete&&p.isDiscrete(),C=c.call(this,n,e);switch(p.dock){case"top":case"bottom":g=_(e.x,t.x),y=D(e.x,t.x),v=0,b=f.height,null!==C.min&&C.min>g?(i&&(y+=C.min-g),g=C.min):(s=l(p,g))?(n.startLabel=s.label,g=null===C.min?s.newPoint:Math.max(C.min,s.newPoint)):n.startLabel=x(p.getValueOfPosition(g),p),null!==C.max&&C.max<y?(i&&(g+=C.max-y),y=C.max):(a=l(p,y))?(n.updateLabel=a.label,y=null===C.max?a.newPoint:Math.min(C.max,a.newPoint)):n.updateLabel=x(p.getValueOfPosition(y),p),n.rect.set(g,v,y-g,b-v),q?((u=this.shapesFromRectForDirection(n.rect,"x","dataArea")).length?(h=this.options&&this.options.rtl?u[u.length-1]:u[0],d=this.options&&this.options.rtl?u[0]:u[u.length-1],n.startVal=o(h),n.updateVal=o(d)):(n.startVal="-",n.updateVal="-"),n.maxIncluded=!0):m.call(this,g,y,"horizontal");break;case"left":case"right":v=_(e.y,t.y),b=D(e.y,t.y),g=0,y=f.width,null!==C.min&&C.min>v&&(i&&(b+=C.min-v),v=C.min),null!==C.max&&C.max<b&&(i&&(v+=C.max-b),b=C.max),(s=l(p,v))?(n.startLabel=s.label,v=s.newPoint):n.startLabel=x(p.getValueOfPosition(v),p),(a=l(p,b))?(n.updateLabel=a.label,b=a.newPoint):n.updateLabel=x(p.getValueOfPosition(b),p),n.rect.set(g,v,y-g,b-v),q?((u=this.shapesFromRectForDirection(n.rect,"y","dataArea")).length?(h=u[0],d=u[u.length-1],n.startVal=o(h),n.updateVal=o(d)):(n.startVal="-",n.updateVal="-"),n.maxIncluded=!0):m.call(this,v,b,"vertical")}}function h(){return this.components.x&&this.components.y&&1===this.components.x.length&&1===this.components.y.length&&!this.components.x[0].isDiscrete()&&!this.components.y[0].isDiscrete()}function d(){C.y=!1,C.x=!1,this._rangeEventWatchers&&(this._rangeEventWatchers.forEach(function(e){e()}),this._rangeEventWatchers=null),M.hide(),M.detach(),C.rangeSelectIsVisible=!1,I={x:[],y:[]}}function p(e,t,n){var i={rect:new r(0,0,0,0),startVal:0,updateVal:0,component:t};return n?I[e].push(i):I[e][0]=i,i}function f(e,t,n){for(var i=I[e],o="x"===e&&n.yMirrorMode,s=o?t.end:t.start,l=o?t.start:t.end,c=a(n,s,l),u=c.l1||(o?null:t.label),h=c.l2||(o?t.label:null),d=-1,p=0;p<i.length;p++)if(o?i[p].updateVal<=l&&s<=i[p].startVal:i[p].startVal<=s&&l<=i[p].updateVal){d=p;break}if(-1===d)i.push({startVal:s,startLabel:u,updateVal:l,updateLabel:h,component:n,rect:new r(0,0,0,0),maxIncluded:!1});else{var f=i[d];i[d]={startVal:f.startVal,startLabel:f.startLabel,updateVal:s,updateLabel:u,component:n,rect:new r(0,0,0,0),maxIncluded:!1},i.push({startVal:l,startLabel:h,updateVal:f.updateVal,updateLabel:f.updateLabel,component:n,rect:new r(0,0,0,0),maxIncluded:!1})}m(e,n.yMirrorMode)}function m(e,t){var n="x"===e&&t,i=n?"updateVal":"startVal",r=n?"startVal":"updateVal",o=I[e];o.sort(function(e,t){return e[i]<t[i]?-1:e[i]>t[i]?1:0});for(var s=o.length-1;s>=0;--s)o[s].startVal!==o[s].updateVal?s<o.length-1&&o[s][r]>=o[s+1][i]&&(o[s+1][r]>o[s][r]&&(o[s][r]=o[s+1][r],n?o[s].startLabel=o[s+1].startLabel:o[s].updateLabel=o[s+1].updateLabel),o.splice(s+1,1),s<o.length-1&&++s):o.splice(s,1)}function g(e,t,n){e||(e="x"),t||(t=0);var i=I[e][t];return i||(i={rect:new r(0,0,0,0),startVal:0,endVal:0},I[e][t]=i),i.component=n,i}function v(e,t,n,i){var r,o=[],s=this._previousShapes?this._previousShapes.slice():[],a=this.getActiveMode(),l=I["y"===t?"x":"y"];if("range.discrete"===a)o=this.shapesFromRectForDirection(e.rect,t,"dataArea"),(o=this.groupedItemsFromShapes(o)).forEach(function(e){var t=s.indexOf(e);t>=0&&s.splice(t,1),e.selectionMode=a}),n.call(this,o,i),this._clearPrev&&n.call(this,s,this.ToggleFlag.deselect),this._shapes=o;else if("range.dimension"===a){if(this.components.dataArea&&this.components.dataArea[0].updateRangeSelection){var c=I[t].map(function(e){return b(e.startVal,e.updateVal,e.maxIncluded)});this.handler.UpdateRanges.emit(c)}}else h.call(this)?(r=l.length?e.rect.intersection(l[0].rect):e.rect,this.components.dataArea&&this.components.dataArea[0].updateRangeSelection&&this.components.dataArea[0].getIsReduced()||(o=this.shapesFromRect(r,"dataArea")),this.components.dataArea&&this.components.dataArea[0].updateRangeSelection&&this.components.dataArea[0].updateRangeSelection(r)):o=this.shapesFromRange(e.startVal,e.updateVal),o.forEach(function(e){e.selectionMode=a}),n.call(this,o,i),this._shapes=o}function y(e,t,n,i){var r=this.getComponentKey(this.activeComponent),o=t,s=this.ToggleFlag.select,a=this.toggleSelection;u.call(this,S,o,e,n,i),"range.measure"===this.getActiveMode()?this.clearSelection(!0):this._shapes&&a.call(this,this._shapes,this.ToggleFlag.deselect),v.call(this,e,r,a,s),this.updateRangeDisplay()}function b(e,t,n){return{min:Math.min(e,t),max:Math.max(e,t),maxIncluded:!!n}}function x(e,t){return t.isDiscrete&&t.isDiscrete()||!t.isDimension?t.getFormatter().format(e):t.formatValue(e)}var q,C,S,w=!1,_=Math.min,D=Math.max,M=e("<div />"),A=M[0],E=e('<div qva-range-selection visible="rangeSelectIsVisible" active-component="activeComponent" v-component="vComponent" h-component="hComponent" v-ranges="vRanges" h-ranges="hRanges" h-options="hOptions" v-options="vOptions"/>'),I={x:[],y:[]},T=15;return q=n.extend("RangeSelection",{init:function(e,t){this._super(e,t),this._shapes=null,this._nrEditing=0,this.setActiveMode("item")},initComponent:function(e){this.previousComponent=this.activeComponent,this.setActiveComponent(this.getComponent(e.x,e.y)),C.activeComponent=this.activeComponent,-1!==this.components.x.indexOf(C.activeComponent)?C.hComponent=C.activeComponent:-1!==this.components.y.indexOf(C.activeComponent)&&(C.vComponent=C.activeComponent)},setDirection:function(e){this.options.rtl="rtl"===e},refreshContainer:function(){var t,n=this.components.dataArea[0].rect,i=e(this.components.dataArea[0].container).position(),o=new r(i.left,i.top,n.width,n.height),s=[];["x","y"].forEach(function(e){this.components[e]&&!this.components[e].contains(this.activeComponent)&&(s=s.concat(this.components[e]))}.bind(this)),this.activeComponent&&s.push(this.activeComponent),s.forEach(function(n){n.isVisible()&&(t=e(n.container).position(),o=o.combineWith(new r(t.left,t.top,n.rect.width,n.rect.height)))},this),this._offset={left:i.left-o.x,top:i.top-o.y},M.css({left:o.x,top:o.y,width:o.width,height:o.height})},resetSelectedShapes:function(){this._previousSelectedShapes=this._selectedShapes.concat(),this._super()},getIsEditing:function(){return this._editing},confirmEdit:function(){C.$broadcast("confirmEdit")},getRect:function(e,t){return e?(t=t||!1,e.hasOwnProperty("innerRect")&&!t?e.innerRect:e.rect):new r(0,0,0,0)},getExtendedRect:function(e){return e?e.hasOwnProperty("extendedRect")?e.extendedRect:this.getRect(e):new r(0,0,0,0)},getTransformedPoint:function(e,t){var n=this.getRect(this.activeComponent||this.components.dataArea[0],!0);return new i(e-n.x-this.handler.containerRect.x,t-n.y-this.handler.containerRect.y)},getComponent:function(e,t){var n=new i(e-this.handler.containerRect.x,t-this.handler.containerRect.y);return Object.keys(this.components).map(function(e){return this.components[e]},this).reduce(function(e,t){return e.concat(t)}).filter(function(e){return this.getExtendedRect(e).pointInside(n.x,n.y)},this)[0]},checkActiveMode:function(e,t){e.contains(this.handler.getActiveMode())||this.clearSelection(t),this.setActiveMode(e[0])},toggleRect:function(e,t,n){this.start(e,t),this.update(e,n),this.end(e)},toggle:function(e,t,n){var i;if((n=void 0!==n?n:this.handler.getKeyAsToggleSelected(e))||this.clearSelection(),this.resetSelectedShapes(),this._editing&&this.confirmEdit(),this.activeComponent&&"function"==typeof this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()){this.cancel(),i=this.getTransformedPoint(t.x,t.y);var r=this.shapesFromPoints([i]),o=this.options.toggle.callback||this.toggleSelection,s=this.ToggleFlag.auto|this.ToggleFlag.tooltip;(r=this.groupedItemsFromShapes(r)).forEach(function(e){e.selectionMode="dataArea"}),this.checkActiveMode(["item"]),o.call(this,r,s)}else if(this.activeComponent&&this.activeComponent.isDimension){i=this.getTransformedPoint(t.x,t.y);var a=this.activeComponent.getLabelFromPoint(i);if(a){this.checkActiveMode(["range.dimension"]),this.resetSelectedShapes();var l=this.getComponentKey(this.activeComponent);f(l,a,this.activeComponent),v.call(this,null,l,null,null),this.selectRange(),this.refreshContainer(),this.initWatchers(),this.updateRangeProjection(),this.updateRangeDisplay()}}},updateRangeDisplay:function(){C.hRanges=[],C.vRanges=[],C.vRanges=I.y.map(function(e){var t=new i(e.rect.x,e.rect.y),n=new i(e.rect.x+e.rect.width,e.rect.y+e.rect.height),r=e.startLabel||(isNaN(e.startVal)?e.startVal:x(e.startVal,e.component)),o=e.updateLabel||(isNaN(e.updateVal)?e.updateVal:x(e.updateVal,e.component));return e.maxIncluded||(o="<"+o),{points:[n,t],values:{start:{text:o,value:e.updateVal},end:{text:r,value:e.startVal}}}}),C.hRanges=I.x.map(function(e){var t=new i(e.rect.x,e.rect.y),n=new i(e.rect.x+e.rect.width,e.rect.y+e.rect.height),r=e.startLabel||(isNaN(e.startVal)?e.startVal:x(e.startVal,e.component)),o=e.updateLabel||(isNaN(e.updateVal)?e.updateVal:x(e.updateVal,e.component));return e.maxIncluded||(e.component.yMirrorMode?r="<"+r:o="<"+o),{points:[t,n],values:{start:{text:r,value:e.startVal},end:{text:o,value:e.updateVal}}}}),I.y.length>0&&(C.vOptions={rect:this.getRect(I.y[0].component,!0).clone(),offset:this._offset.top,padding:I.y[0].component.getPadding(),dock:I.y[0].component.dock,shouldClip:"range.dimension"===this.getActiveMode()}),I.x.length>0&&(C.hOptions={rect:this.getRect(I.x[0].component,!0).clone(),offset:this._offset.left,padding:I.x[0].component.getPadding(),dock:I.x[0].component.dock,shouldClip:"range.dimension"===this.getActiveMode()}),C.rangeSelectIsVisible||(this.handler.container.append(M),M.show(),C.rangeSelectIsVisible=!0),C.$digest()},initWatchers:function(){if(!this._rangeEventWatchers){var e=this;this._rangeEventWatchers=[],this._rangeEventWatchers.push(C.$on("rangeStart",function(){e.resetSelectedShapes(),e._shapes=e._previousShapes,e._clearPrev=!0})),this._rangeEventWatchers.push(C.$on("rangeUpdate",function(t,n,i,r,o,s){S=n[0],e.components[i].indexOf(e.activeComponent)<0&&e.setActiveComponent(e.components[i][0]);var a=I[i][r];y.call(e,a,n[1],o,s),e._clearPrev=!1})),this._rangeEventWatchers.push(C.$on("rangeEditChanged",function(t,n){e._nrEditing=n?e._nrEditing+1:e._nrEditing-1,e._nrEditing>1&&(e.confirmEdit(),e._nrEditing=1,t.targetScope.onEditBubble()),e._editing=e._nrEditing>0})),this._rangeEventWatchers.push(C.$on("rangeEnd",function(){e.end(),e._clearPrev=!1})),this._rangeEventWatchers.push(C.$on("rangeToggle",function(t,n,i){e.toggle(n,i)}))}},start:function(e,t){if(this.handler._disableSelections)return!0;this.resetSelectedShapes(),this.refreshContainer(),this.activeComponent.isDiscrete&&this.activeComponent.isDiscrete()?this.checkActiveMode(["range.discrete","item"]):this.activeComponent.isDimension?this.checkActiveMode(["range.dimension"]):this.checkActiveMode(["range.measure"]);var n=this.getComponentKey(this.activeComponent);"x"!==n&&"y"!==n||(this.currentRange=p(n,this.activeComponent,"range.dimension"===this.getActiveMode()),this.initWatchers(),S=this.getTransformedPoint(t.x,t.y))},update:function(e,t){if(this.handler._disableSelections)return!0;y.call(this,this.currentRange,this.getTransformedPoint(t.x,t.y),!1)},updateShapesState:function(){var e=g(this.getComponentKey(this.activeComponent),0,this.activeComponent),t=this.getActiveMode(),n=this.ToggleFlag.select,i=[],r=this.toggleSelection;this.clearSelection(!0),this.activeComponent.isDiscrete&&!this.activeComponent.isDiscrete()&&((i=this.shapesFromRange(e.startVal,e.updateVal)).forEach(function(e){e.selectionMode=t}),r.call(this,i,n)),this._shapes=i},updateRangeProjection:function(){var e=this.components.dataArea[0].rect;I.x.forEach(function(t){var n=t.component.getPositionOfValue(t.startVal),i=t.component.getPositionOfValue(t.updateVal),r=Math.min(n,i),o=Math.max(n,i),s=e.height;t.rect.set(r,0,o-r,s-0)}),I.y.forEach(function(t){var n=t.component.getPositionOfValue(t.startVal),i=t.component.getPositionOfValue(t.updateVal),r=e.width,o=Math.max(n,i),s=Math.min(n,i);t.rect.set(0,s,r-0,o-s)})},end:function(){if(this.handler._disableSelections)return!0;this.currentRange=null,"range.dimension"===this.getActiveMode()&&(m(this.getComponentKey(this.activeComponent),this.activeComponent.yMirrorMode),this.updateRangeProjection()),this.updateRangeDisplay(),this.selectRange(),this._previousShapes=this._shapes,this._shapes=null},cancel:function(){if(this.handler._disableSelections)return!0;this._nrEditing=0,this._editing=!1,"range.discrete"===this.getActiveMode()&&this.setActiveMode("item"),this._shapes=null,d.call(this)},clearSelection:function(e){e=e||!1,this._shapes=null,e?this._super():(this._super(),d.call(this))},selectRange:function(){var e=this.handler.SelectRange,t=[],n=!1;if(this.activeComponent){if("range.discrete"===this.getActiveMode()){var i=this._previousSelectedShapes,r=this.getSelectedShapes().concat();return i.forEach(function(e){-1===r.indexOf(e)&&r.push(e)}),void(r.length>0&&this.handler.Select.emit(r))}I.x.concat(I.y).forEach(function(e){e.component.getType().current.forEach(function(n){t.push({idx:n,type:e.component.getType().type,range:b(e.startVal,e.updateVal,e.maxIncluded)})})}),n=!h.call(this),this._editing||e.emit(t,n)}},on:function(){if(!w){var e=t.getService("$compile"),n=t.getService("$rootScope");C=n.$new(),A.className="selections-range-ui",M.append(E),M.hide(),e(A)(C),w=!0,C.rangeSelectIsVisible=!1}C.$broadcast("on")},off:function(){this.activeComponent&&(C.$broadcast("off"),this.setActiveComponent(null),d.call(this))}}),q.defaultOptions={toggle:{callback:null}},q}),define("objects.views/selections/types/dom-base",["./base","general.utils/shapes/rect"],function(e,t){"use strict";function n(e,t){var n,i,r=t[0],o=!1;for(n=0;n<e.length;n++)(i=e[n]).startVal===r.startVal&&i.updateVal===r.updateVal&&(e.splice(n,1),n--,o=!0);return o||(e=e.concat(t)),e}var i;return i=e.extend({init:function(e,t){this._super(e,t),this.internal=!0},release:function(){},initComponent:function(e,t){document.activeElement&&document.activeElement.blur(),t?this.setActiveComponent(t):(this.handler.refreshContainerRect(),this.setActiveComponent(this.getComponent(e.x,e.y,this.handler.containerRect)))},getRect:function(e){return e?e.hasOwnProperty("innerRect")?e.innerRect:e.rect:new t(0,0,0,0)},setComponent:function(e,t){this._super(e,t),(Array.isArray(t)?t.concat():[t]).forEach(function(e){e.selections=this,this.handler._isListening&&t.on()},this)},addComponent:function(e,t){this._super(e,t),t.selections=this,this.handler._isListening&&t.on()},removeComponent:function(e,t){this._super(e,t),t.selections=null,t.off()},updateFromItems:function(e,t,n,i){var r=this.handler,o=this;r.canTypeBeActivated(this)?(this.resetSelectedShapes(),this.setActiveMode(n?"item"+this.activeComponent.getColorMap().getColorDataInfo().legendPath.replace(/\//g,"."):"item"),r.activate(this),n&&r.SelectAttributeDim.emit(i,r.getKeyAsToggleSelected(e)),(t=t.filter(function(e){return o._allowNullSelect||!o.shapesFrom._isNull(e,o.activeComponent.getSelectionIndices())})).length&&((this.options.toggle.callback||this.toggleSelection).call(this,t),n||r.Select.emit(this.getSelectedShapes(),r.getKeyAsToggleSelected(e)))):r.SelectWhileLocked.emit(n?this.activeComponent.getAttributeDimensionInfo():void 0)},rangeStart:function(e){var t=this.handler;t.canTypeBeActivated(this)?(this.setActiveMode("range.measure"),t.activate(this),e&&this.resetSelectedShapes()):t.SelectWhileLocked.emit()},rangeUpdate:function(e,t){var i=this.handler;if(i.canTypeBeActivated(this)){var r,o=this.options.toggle.callback||this.toggleSelection,s=[],a=this.ToggleFlag.select;for(this.clearSelection(!0),this._rangeObjects&&t&&(e=n(this._rangeObjects,e)),r=0;r<e.length;r++){var l=e[r];s=s.concat(this.shapesFromRange(l.startVal,l.updateVal,!0,l.isMax))}s.forEach(function(e){e.selectionMode="range.measure"}),o.call(this,s,a),this._rangeObjects=e,this._shapes=s}else i.SelectWhileLocked.emit()},rangeEnd:function(){this.selectRange(),this._shapes=null},toggle:function(){},cancel:function(){this._rangeObjects=null,this.activeComponent.cancelSelection()},clearSelection:function(e){this._super(),e||(this._rangeObjects=null,this.activeComponent.clearSelection())},selectRange:function(){var e,t,n=this.handler.SelectRange,i=[];if(this._rangeObjects){for(e=0;e<this._rangeObjects.length;e++)t=this._rangeObjects[e],i.push({idx:t.idx||0,range:{min:Math.min(t.startVal,t.updateVal),max:Math.max(t.startVal,t.updateVal)}});n.emit(i,!0)}}}),i.defaultOptions={},i}),define("objects.views/selections/types/color-legend",["./dom-base"],function(e){"use strict";var t;return t=e.extend({setIsEditing:function(e,t){this._editing=e,this._scope=t},getIsEditing:function(){return this._editing},confirmEdit:function(){this._scope.$broadcast("confirmEdit")},selectWhileLocked:function(e){this.handler.SelectWhileLocked.emit(e)}}),t.defaultOptions={captureInput:!0,toggle:{callback:null}},t}),define("objects.views/selections/handler",["jquery","core.utils/class","core.utils/notification","client.utils/state","./types/data-area","./types/range/range-angular","./types/color-legend","general.utils/shapes/rect","./interaction-type","./interaction-handler"],function(e,t,n,i,r,o,s,a,l,c){function u(t){Object.keys(t).forEach(function(n){n in f&&(this.types[n]=new f[n](this,e.extend(!0,{},f[n].defaultOptions,t[n])))},this)}function h(e,t){var n;for(n=0;n<t.length;n++)if(e.contains(t[n]))return!0;for(n=0;n<e.length;n++)if(t.contains(e[n]))return!0;return!1}var d,p,f={dataArea:r,range:o,colorLegend:s};return d=t.extend({init:function(t,i,r){n.mixin(this),this.notification("Activated"),this.notification("Deactivated"),this.notification("ToggleShape"),this.notification("ToggleShapes"),this.notification("SelectWhileLocked"),this.notification("Lasso"),this.notification("Confirm"),this.notification("Cancel"),this.notification("Select"),this.notification("SelectRange"),this.notification("SelectAttributeDim"),this.notification("Clear"),this.notification("ResetSelections"),this.notification("UpdateRanges"),this._active=!1,this._autoActivated=!1,this._isListening=!1,this._isScrolling=!1,this._isLocked=!1,this._shiftPressed=!1,this._lassoEnabled=!1,this._allowLasso=!0,this._enabled=!0,this.container=t,this.options=e.extend(!0,{},{toggle:!0,toggleRect:!0,swipe:!0,ctrlKeyAsToggleSelected:!1},i),this.cache=r,this.containerRect=new a(0,0,0,0),this.types={},this._keyboard=!0,u.call(this,this.options)},setContainer:function(e){this.off(),this.container=e,this.on()},refreshContainerRect:function(){var e=this.offset=this.container.offset(),t=this.container.width(),n=this.container.height();this.containerRect.set(e.left,e.top,t,n)},canTypeBeActivated:function(e){return!(e&&e.activeComponent&&"function"==typeof e.activeComponent.isSelectionLocked?e.activeComponent.isSelectionLocked():this._isLocked)},on:function(){function e(){if(f._activeType&&f._activeType!==d){var e=f._activeType.getActiveDimensions();f._activeType.getActiveMode()===d.getActiveMode()&&h(e,d.getActiveDimensions())||(f._activeType.clearSelection(),f.ResetSelections.emit()),f._activeType.cancel()}f._activeType=d}function t(){e(),m._disableSelectionActivation||f.activate()}function n(){return f._active&&!i.isInEditMode()}function s(){return d&&m.swipe}function a(e,t){p=t,d=e,f.refreshContainerRect(),d&&d.initComponent(t)}function u(e,t){c.addInteraction(f._eventHandlers,e.container,1,["tap","swipe","taptwo"],m.swipe,t)}if(!this._isListening){this._isListening=!0;var d,f=this,m=this.options;this._reset=function(){d=null},this.getActiveType=function(){return f._activeType},this.getActiveMode=function(){return f._activeType?f._activeType.getActiveMode():null},this._setTypeOnAutoActivate=function(){d=f.types.dataArea},this._activateType=function(t){d=t,e()},this._mouseUp=function(e){1===e.which&&(!f._shiftPressed&&f._drawingWithShift||f._shiftPressed&&f._drawingWithoutShift)&&f.Lasso.emit(!f.lassoEnabled)},this._shiftToggle=function(e){f._shiftPressed=e,f._allowLasso&&f._keyboard&&!f._drawingWithShift&&!f._drawingWithoutShift&&f._active&&f.Lasso.emit(!f.lassoEnabled)},this._keyPressed=function(e){f._keyboard&&n()&&(27===e?f.cancel():13===e&&(d&&d.getIsEditing&&d.getIsEditing()?d.confirmEdit():f.confirm()))},c.ShiftToggle.bind(this._shiftToggle),c.KeyPressed.bind(this._keyPressed),c.MouseUp.bind(this._mouseUp),this.types.range&&this.types.range.on&&this.types.range.on();var g,v=!1;this._eventHandlers=l.extend({tap:{start:function(e,t,n){a(n,t.pagePoints[0]),document.activeElement&&document.activeElement.blur()},end:function(e,n){d&&!d.internal&&m.toggle&&(f.canTypeBeActivated(d)?(t(),c.preventGestures(this),d.toggle.call(d,e,n.pagePoints[0]),d.getSelectedShapes().length>0&&f.Select.emit(d.getSelectedShapes(),f.getKeyAsToggleSelected(e))):f.SelectWhileLocked.emit())}},taptwo:{start:function(){},end:function(e,n,i){m.toggleRect&&(a(i,n.pagePoints[0]),d&&m.toggle&&(f.canTypeBeActivated(d)?(t(),d.toggleRect.call(d,e,n.pagePoints[0],n.pagePoints[1])):f.SelectWhileLocked.emit()))}},swipe:{start:function(e){if((s()||m._enablePanning)&&(f._shiftPressed&&!f._active&&f.allowLasso&&f.Lasso.emit(!f.lassoEnabled),d&&!d.internal))if(f._drawingWithShift=f._shiftPressed,f._drawingWithoutShift=!f._shiftPressed,!f.lassoEnabled&&d.activeComponent&&d instanceof r)this._isPanning=!0;else if(d.activeComponent){if(this._isPanning=!1,v=!0,g=this.options.useMomentum,this.options.useMomentum=!1,!f.canTypeBeActivated(d))return void f.SelectWhileLocked.emit();t(),d.start.call(d,e,p)}},update:function(e,t){if((s()||m._enablePanning)&&!this._isPanning&&v&&d){if(!f.canTypeBeActivated(d))return void f.SelectWhileLocked.emit();d.update.call(d,e,t.pagePoints[0])}},end:function(e,t){if(s()||m._enablePanning)if(f._drawingWithShift=!1,f._drawingWithoutShift=!1,this._isPanning)this._isPanning=!1;else if(v&&d){if(v=!1,this.options.useMomentum=g,!f.canTypeBeActivated(d))return void f.SelectWhileLocked.emit();d.end.call(d,e,t)}},cancel:function(){f._drawingWithShift=!1,f._drawingWithoutShift=!1,d&&v&&(this.options.useMomentum=g,d.cancel.call(d,!0))}},exclusive:function(){return f.lassoEnabled},active:function(){return f._enabled||f._drawingWithShift||f._drawingWithoutShift}}),this.registerAddedComponent=function(e,t){e.internal||e instanceof o&&"dataArea"===t.selectionIdentifier||u(t,e)},this.deregisterAddedComponent=function(e,t){e.internal||e instanceof o&&"dataArea"===t.selectionIdentifier||c.removeInteraction(f._eventHandlers,t.container)},Object.keys(this.types).map(function(e){return this.types[e]},this).forEach(function(e){return Object.keys(e.components).map(function(t){return e.components[t]}).forEach(function(t){t.forEach(function(t){f.registerAddedComponent(e,t)})})})}},register:function(e,t){this.registerAddedComponent&&this.registerAddedComponent(e,t)},deregister:function(e,t){this.deregisterAddedComponent&&this.deregisterAddedComponent(e,t)},off:function(){c.ShiftToggle.unbind(this._shiftToggle),c.KeyPressed.unbind(this._keyPressed),c.MouseUp.unbind(this._mouseUp),c.removeInteraction(this._eventHandlers),this.types.range&&this.types.range.off&&this.types.range.off(),this._isListening=!1,this.registerAddedComponent=null,this.deregisterAddedComponent=null},autoActivate:function(){!this._autoActivated&&this._isListening&&(this._autoActivated=!0,this._setTypeOnAutoActivate(),this._activeType=this.types.dataArea,this._activeType.initComponent(),this.activate())},activate:function(e){this._active||(this.Activated.emit(),this._active=!0,this._shiftPressed&&!this.lassoEnabled&&this.Lasso.emit(!0)),e&&this._activateType(e)},deactivate:function(e){this._active&&(this._active=!1,this._autoActivated=!1,e||this.clearSelection(),this._activeType&&(this._activeType.cancel(),this._activeType=void 0),this.Deactivated.emit(),this._reset())},confirm:function(){this._activeType&&this.deactivate(!0),this.Confirm.emit()},cancel:function(){this.deactivate(),this.Cancel.emit()},clearSelection:function(){this._activeType&&this._activeType.clearSelection()},toggleKeyboardAccelerators:function(e){this._keyboard=e},getKeyAsToggleSelected:function(e){return!(e.metaKey||e.ctrlKey)},release:function(){this.off(),n.release(this),Object.keys(this.types).forEach(function(e){this.types[e].release()},this)},setLocked:function(e){this._isLocked=e}}),Object.defineProperties(d.prototype,{allowLasso:{set:function(e){this._allowLasso=e},get:function(){return this._allowLasso}},lassoEnabled:{set:function(e){this._lassoEnabled=e&&this.allowLasso},get:function(){return this._lassoEnabled}},enabled:{set:function(e){this._enabled=e},get:function(){return this._enabled}}}),d}),define("objects.extension/default-view-selection-service",["qvangular","objects.views/selections/handler"],function(e,t){"use strict";e.service("qvDefaultViewSelectionService",[function(){return{createSelections:function(e,n,i,r){var o,s;if(i&&i.dataArea)return i.range&&(i.range.rtl="rtl"===e.options.direction),i.isPopover=e.options.isPopover,i.selectionsDisabled=e.options.selectionsDisabled||!1,(o=new t(n,i,r)).Activated.bind(function(){e.selectionsApi.activated()}),o.Deactivated.bind(function(){e.selectionsApi.deactivateSearch&&e.selectionsApi.deactivateSearch()}),o.Cancel.bind(function(){e.selectionsApi.cancel()}),o.Select.bind(function(){e.selectionsApi.selectionsMade=!0}),o.SelectRange.bind(function(){e.selectionsApi.selectionsMade=!0}),o.SelectAttributeDim.bind(function(){e.selectionsApi.selectionsMade=!0}),o.Confirm.bind(function(){e.backendApi.endSelections(!0),e.selectionsApi.deactivated()}),o.ResetSelections.bind(function(){e.backendApi.clearSelections()}),e.selectionsApi.confirm=function(){o&&o.confirm()},s=e.selectionsApi.deactivated.bind(e.selectionsApi),e.selectionsApi.deactivated=function(){o&&o.deactivate(),s()},e.selectionsApi.deactivate=function(){o&&(o.deactivate(),this.deactivated())},e.selectionsApi.clear=function(){o.clearSelection(),e.backendApi.clearSelections(),e.tooltipApi.cancel(),e.selectionsApi.selectionsMade=!1},e.selectionsApi.toggleKeyboardAccelerators=function(e){o.toggleKeyboardAccelerators(e)},e.selectionsApi.getKeyAsToggleSelected=function(e){return o.getKeyAsToggleSelected(e)},e.selectionsApi.toggleSearch=function(){e.options.search.toggle()},e.selectionsApi.activate=function(){o.autoActivate()},e.selectionsApi.on=function(){o.on()},e.selectionsApi.off=function(){o.off()},e.$on("$destroy",function(){o&&(o.release(),o=null)}),o}}}])}),define("objects.extension/default-controller",["objects.extension/base-controller","util","core.utils/deferred","objects.views/charts/tooltip/chart-tooltip","objects.views/selections/cache","objects.utils/selection-util","objects.extension/update-data-tracker","objects.extension/default-view-selection-service"],function(e,t,n,i,r,o,s){"use strict";function a(e,t,i,r){return s.begin(),e.updateData(i.layout).then(function(){if(!t.isDestroyed&&r.visible){var o=e.$element;return i.ext.hasDefaultTemplate()&&(o=o.children().first()),e.paint(o,i.layout)}return n.resolve()}).finally(s.end)}var l;return l=e.extend({$scope:null,$element:null,api:null,view:null,_create:function(e,n,i,o,s,a,l,c){o.navigation=!1!==o.navigation;var u=this._createView(e,n,i,o,a,l,c),h=new r;if(s.selections){var d=t.extend(!0,{},s.selections,o.selections||{});!1!==o.selections&&!0!==o._disableSelections&&this._createSelections(u,e,n,d,h)}return s.tooltips&&!1!==o.tooltips&&this._createTooltip(u,e,n,t.extend(!0,{},s.tooltips,o.tooltips||{}),h,o.cssTransform,c),u},_createView:function(e,t,n,i,r,o,s){return new n(e,t,i,r,o,s)},_createSelections:function(e,t,n,i,r){var o=this.selectionService.createSelections(t,n,i,r);return e.setSelections(o),o},_createTooltip:function(e,t,n,r,o,s,a){var l=new i(n,r,o);l.setCssTransform(s),a.cancel=function(){l.cancel()},e.setTooltips(l)},init:function(e,t,n){this.$scope=e,this.$element=t,this.selectionService=n;var i=this,r=this.view=this._create(e,t,e.ext.View,e.options,e.ext.options,e.backendApi,e.selectionsApi,e.tooltipApi);r.initialize(),this._handleSpecialCaseForSyntaxSugarInExtension(r),r.mounted(t),e.$on("$destroy",function(){r&&(r.beforeDestroy(r),r.destroy(r),e.options=null,i.view=null,i.isDestroyed=!0,r=null)})},_handleSpecialCaseForSyntaxSugarInExtension:function(e){var t,n=this.$scope.object.ext,i=["View","constructor","options","init"];for(t in n)-1===i.indexOf(t)&&e[t]&&(e[t]=n[t])},onPaint:function(e,t){var i=this.view,r=this.$scope,s=this,l=r.object&&r.object.model;return i&&!i.suppressOnPaint(r.layout)&&l?(o.isModalSelectionModel(l)&&i.selectionsApi&&i.selectionsApi.confirm(),i.refreshSelections(),i.prePaint(r.layout),r.ext.options&&r.ext.options.usingDerivedProperties&&!r.backendApi.isSnapshot?l.getEffectiveProperties().then(function(e){return i.updateDerivedProperties(e,r.layout).then(function(e){return e?n.resolve(!1):a.call(this,i,s,r,t)})}):a.call(this,i,s,r,t)):n.resolve()},onResize:function(e,t){var i=this.view,r=this.$scope;return i.refreshSelections(),n.resolve().then(function(){var n=i.$element;return r.ext.hasDefaultTemplate()&&(n=n.children().first()),i.resize(n,e,t)})},setInteractionState:function(e){this.view&&this.view.setInteractionState(e)},setFreeResize:function(e){this.view&&this.view.setFreeResize(e)},setDirection:function(e){this.view&&this.view.setDirection(e)},setBackendApi:function(e){this.view.setBackendApi(e)},setSnapshotData:function(e,t){return this.view.setSnapshotData(e,t)},getContextMenu:function(e,t){return this.view.getContextMenu(e,t)},getSelectionToolbar:function(){return this.view.getSelectionToolbar()},getViewState:function(){return this.view.getViewState()},getPreferredSize:function(){return this.view.getPreferredSize()}}),l.$inject=["$scope","$element","qvDefaultViewSelectionService"],l}),define("core.utils/bind-layout",[],function(){function e(e,t,n,i){function r(){var n=e.$eval(t);n&&n.Invalidated&&n.Invalidated.unbind(o)}t=t||"model";var o,s,a,l=function(){var i=this,r=this.getLayout();e.__layoutRPCId=r.rpcId,r.then(function(r){e.$eval(t)===i&&n&&n(r)})};return a=e.$on("$destroy",function(){r()}),s=e.$watch(t,function(e,t){t&&t!==e&&t.Invalidated&&t.Invalidated.unbind(o),!e||e.isClosing&&e.isClosed||(i&&i(e),e.getLayout().then(n),o=l.bind(e),e.Invalidated.bind(o))}),function(){r(),s(),a(),n&&(n=null),i&&(i=null)}}function t(){return(n||e).apply(this,arguments)}var n=null;return t.mock=function(e){n=e},t}),define("text!objects/inline-title-edit.ng.html",[],function(){return'<div ng-show="!editing && displayValue == \'\'" class="qv-inline-edit-button">\n\t<div qva-direction x-dir-setting="{{dirSetting}}" class="add-content" q-title-translation="{{emptyTranslation}}">\n\t\t<span class="lui-icon lui-icon--plus"></span>\n\t\t<span class="add-text" qva-direction x-dir-text="{{addTranslation}}" title="{{addTranslation}}">{{addTranslation}}</span>\n\t</div>\n</div>\n<div qva-direction x-dir-setting="{{dirSetting}}" x-dir-text="{{displayValue}}" ng-show="!editing && displayValue != \'\'" class="qv-inline-edit-value">{{displayValue}}</div>\n<input qva-direction x-dir-setting="{{dirSetting}}" x-dir-text="{{displayValue}}" ng-show="editing" class="qv-inline-edit-input" type="text" ng-model="titleValue" qv-inline-title-input maxlength="255"/>\n'}),define("objects/inline-title-edit",["qvangular","angular","translator","core.utils/bind-layout","client.utils/property-resolver","text!./inline-title-edit.ng.html"],function(e,t,n,i,r,o){"use strict";function s(e){return"object"==typeof e&&"="!==(e=e.qStringExpression.qExpr)[0]&&(e="="+e),e}function a(e){return e&&0===e.indexOf("=")?{qStringExpression:{qExpr:e}}:e}e.directive("qvInlineTitleInput",[function(){return{priority:1,require:"ngModel",link:function(t,n,i,r){n.unbind("input keydown change compositionend"),n.bind("blur",function(){e.$apply(t,function(){r.$setViewValue(n.val()),t.doEdit()})}),t.$on("$destroy",function(){n.trigger("blur")}),n.bind("keydown",function(e){e.stopPropagation(),27===e.which?(n.val(r.$viewValue),n.trigger("blur")):13===e.which&&"textarea"!==n[0].nodeName.toLowerCase()&&n.trigger("blur")})}}}]),e.directive("qvInlineTitleEdit",["$timeout",function(e){return{template:o,restrict:"A",scope:{model:"=",propertyPath:"@",layoutPath:"@",emptyTranslation:"@",dirSetting:"@"},priority:1,link:function(o,l){var c=l.children().first(),u=l.children().eq(1),h=l.children().eq(2);o.editing=!1,o.titleProperty="",o.titleValue="",o.addTranslation=n.get(o.emptyTranslation),i(o,"model",function(e){o.displayValue=r.getValue(e,o.layoutPath),o.editing=!1}),o.doEdit=function(){var e=a(o.titleValue);o.editing&&(t.equals(d,e)?o.editing=!1:o.model.getProperties().then(function(t){r.setValue(t,o.propertyPath,e),o.model.setProperties(t),d=e}))};var d;c.add(u).on("qv-activate",function(){o.editing||o.model.getProperties().then(function(t){var n=h.get(0),i=r.getValue(t,o.propertyPath),a=s(i),l=a.length;a.indexOf("\n")>-1||(o.editing=!0,o.titleProperty=i,o.titleValue=a,d=o.titleProperty,n.scrollLeft=n.scrollWidth,n.selectionStart=l,n.selectionEnd=l,e(function(){n.focus(),n.setSelectionRange(l,l)}))})})}}}])}),define("objects.extension/extension-type",["core.utils/class","client.utils/property-mapper","objects.extension/default-extension","objects.extension/library-info","util","qvangular","core.utils/deferred","objects.extension/default-view","objects.extension/default-controller","require","objects/inline-title-edit"],function(e,t,n,i,r,o,s,a,l,c){function u(e,t){var i=r.extend(!0,{},n,t);return i.libraryInfo=e.getLibraryInfo(),i}function h(e){var t,n=e.path;return d[n]||(t=s(),c([n],function(n){o.$rootScope.$apply(function(){t.resolve(u(e,n))})},function(e){t.reject(e)}),d[n]=t.promise),d[n]}var d={};return o.componentDirective("qvaIncludeObject",{model:"=",ext:"=",options:"="}),e.extend("ExtensionType",{init:function(e){var t=e.type;this.type=t,this.path=e.path,this.libraryInfo=i.getLibraryInfo(t),this.components=e.components||[]},getLibraryInfo:function(){return this.libraryInfo},getIconName:function(){return this.libraryInfo.icon},getIconChar:function(){return this.libraryInfo.iconChar||"g"},getModelCtor:function(){return h(this).then(function(e){return e.Model})},getInitialProperties:function(e){var n=this;return h(n).then(function(i){var o=r.extend(!0,{qInfo:{qType:n.type},visualization:n.type},i.initialProperties,e);return i.libraryInfo.isThirdParty&&(i.libraryInfo.version&&!o.version&&(o.version=i.libraryInfo.version),o.extensionMeta=r.extend(!0,{},i.libraryInfo)),t.mapProperties(i.definition,o,n.type)}).catch(function(){return{qInfo:{qType:n.type},visualization:n.type}})},load:function(){return h(this).then(function(e){if((e=r.extend(!0,{},e)).View)for(var t in a)if(a.hasOwnProperty(t)&&(e.View[t],a[t],!1))throw"extension.View property is missing DefaultView "+t;return void 0===e.View&&(e.View=a),void 0===e.controller&&(e.controller=l),e})},getExtensionType:function(){return h(this)}})}),define("general.models/library/extension-list",["core.utils/deferred","qvangular","general.services/content-api/content-api"],function(e,t){"use strict";var n={list:[]},i=null;return n.getList=function(n){function r(e){return t.getService("$contentApi").getExtensions().then(function(t){o.list=[];for(var n in t)t.hasOwnProperty(n)&&o.list.push({id:n,data:t[n]});e.resolve(o.list)},function(){o.list=[],e.resolve(o.list)}),e.promise}var o=this;return null===i?(i=new e,r(i)):n?r(new e):i.promise},n}),define("general.models/library/cloud-extension-list",["core.utils/deferred","qvangular"],function(e,t){"use strict";var n={list:[],extensionListAvailable:!1},i=null;return n.getList=function(n){function r(e){return t.getService("$rlsApi").getCloudExtensions().then(function(t){o.extensionListAvailable=!0,o.list=[];for(var n in t){var i=t[n];i.attributes.name&&i.attributes.loadpath&&i.id&&(i.attributes.certified=!0,o.list.push({id:i.attributes.qext_filename||i.attributes.name,data:i.attributes,path:"rls/extensions/"+i.id+"/file/"+i.attributes.loadpath}))}e.resolve(o.list)},function(){o.extensionListAvailable=!1,o.list=[],e.resolve(o.list)}),e.promise}var o=this;return null===i?(i=new e,r(i)):n?r(new e):i.promise},n.areCloudExtensionsAvailable=function(){var e=this;return this.getList().then(function(){return e.extensionListAvailable})},n}),define("objects.utils/type-loader",["core.utils/deferred","general.utils/visualizations","objects.extension/extension-type","objects.extension/library-info","general.models/library/extension-list","general.models/library/cloud-extension-list","client.utils/capability-flags","core.utils/feature-flags"],function(e,t,n,i,r,o,s,a){function l(e,t){return(t=t||{}).previewIconURL||"string"==typeof t.preview&&t.preview.match(/\.(?:png|gif|jpe?g|svg)$/)&&(t.previewIconURL="../extensions/"+e+"/"+t.preview),t.icon&&"extension"!==t.icon||(t.icon="puzzle"),t.description=t.description||t.name,t.template=t.template||e,t.isLibraryItem=!1!==t.isLibraryItem,t.isThirdParty=!0,t.name=t.name||t.template||e,t}function c(e){if(e.data&&"visualization"===e.data.type){if(t.getType(e.id.toLowerCase()))return void console.error("Extension id already registered: "+e.id);var r=l(e.id,e.data);i.registerThirdPartyLibraryInfo(e.id,r),t.registerType(e.id,new n({type:e.id,path:e.path||"extensions/"+e.id+"/"+e.id}))}}function u(){if(!h){var t=s.getFlag("DISABLE_ONPREM_EXTENSIONS")?e.resolve([]):r.getList(),n=s.getFlag("CLOUD_EXTENSIONS")?o.getList():e.resolve([]);h=n.then(function(e){return e.forEach(c),t.then(function(e){e.forEach(c)})})}return h}var h=null,d=!1;return{load:function(i){return d||(t.registerType("listbox",new n({type:"listbox",path:"extensions.qliktech/listbox/listbox"})),t.registerType("filterpane",new n({type:"filterpane",path:"extensions.qliktech/filterpane/filterpane"})),s.getFlag("DM_GOOD_DEFAULTS")&&t.registerType("auto-chart",new n({type:"auto-chart",path:"extensions.qliktech/auto-chart/auto-chart"})),t.registerType("boxplot",new n({type:"boxplot",path:"extensions.qliktech/boxplot/boxplot"})),t.registerType("histogram",new n({type:"histogram",path:"extensions.qliktech/histogram/histogram"})),t.registerType("distributionplot",new n({type:"distributionplot",path:"extensions.qliktech/distributionplot/distributionplot"})),t.registerType("waterfallchart",new n({type:"waterfallchart",path:"extensions.qliktech/waterfallchart/waterfallchart"})),t.registerType("gauge",new n({type:"gauge",path:"extensions.qliktech/gauge/gauge"})),t.registerType("kpi",new n({type:"kpi",path:"extensions.qliktech/kpi/kpi"})),t.registerType("table",new n({type:"table",path:"extensions.qliktech/straight-table/straight-table"})),t.registerType("pivot-table",new n({type:"pivot-table",path:"extensions.qliktech/pivot-table/pivot-table"})),t.registerType("barchart",new n({type:"barchart",path:"extensions.qliktech/barchart/barchart"})),t.registerType("piechart",new n({type:"piechart",path:"extensions.qliktech/piechart/piechart"})),t.registerType("scatterplot",new n({type:"scatterplot",path:"extensions.qliktech/scatterplot/scatterplot"})),t.registerType("linechart",new n({type:"linechart",path:"extensions.qliktech/linechart/linechart"})),t.registerType("combochart",new n({type:"combochart",path:"extensions.qliktech/combochart/combochart"})),t.registerType("treemap",new n({type:"treemap",path:"extensions.qliktech/treemap/treemap"})),t.registerType("map",new n({type:"map",path:"extensions.qliktech/map/map"})),t.registerType("text-image",new n({type:"text-image",path:"extensions.qliktech/text-image/text-image"})),a.GEO_MAPCHART&&t.registerType("map-chart",new n({type:"map-chart",path:"extensions.qliktech/mapchart/Map"})),t.registerType("widget",new n({type:"widget",path:"extensions.qliktech/widget/widget"})),d=!0),i?e.when():u()},loadThirdParty:u,isLoaded:function(e){return!!t.getType(e)},registerExtension:c}}),define("client.utils/rtl/direction-service",["client.models/app-generic-props-wrapper","core.utils/notification"],function(e,t){"use strict";var n={},i=!1,r="ltr",o=!1;return t.mixin(n),n.notification("DirectionChanged"),n.init=function(){return e.getProperties().then(function(e){return o=!0,n.setRtl(e&&e.rtl)})},n.setRtl=function(e){return i!==e&&(r=(i=e)?"rtl":"ltr",n.DirectionChanged.emit(r)),r},Object.defineProperty(n,"isInit",{get:function(){return o}}),Object.defineProperty(n,"isRtl",{get:function(){return i}}),Object.defineProperty(n,"direction",{get:function(){return r}}),e.UpdateObjProps.bind(function(e){n.setRtl(e.rtl)}),n}),define("apis/qevent",[],function(){"use strict";function e(){this.handlers=[]}return e.prototype.register=function(e,t){this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t)},e.prototype.emit=function(e,t){if(this.handlers[e])for(var n in this.handlers[e])this.handlers[e][n](t)},e.prototype.hasHandlers=function(e){return!!this.handlers[e]},e.prototype.clear=function(e){e?delete this.handlers[e]:this.handlers=[]},e}),define("objects.utils/properties-generator/properties-generator",["util","objects.utils/chart-type-utils/chart-type-utils","core.utils/deferred"],function(e,t,n){function i(t){return"string"==typeof t?t={qDef:{qDef:t}}:t.qType&&(t.qDef=t.qDef||{},t.qDef.cId=e.generateId()),t}function r(t){return"string"==typeof t?t={qDef:{qFieldDefs:[t]}}:t.qType&&(t.qDef=t.qDef||{},t.qDef.cId=e.generateId()),t}function o(e){return"string"==typeof e?0===e.indexOf("="):e.qType?"measure"===e.qType:!!(e.qDef&&e.qDef.qDef||e.qSortBy||e.qAttributeExpressions)}return{createProperties:function(s,a,l,c){return n.all([t.getExtensionType(a),t.getInitialProperties(a)]).then(function(t){var a=new n,u=t[0],h=t[1];u.mapProperties();var d=u.getCreatePropertyHandler.call(u,s);if(d.setProperties(h),l){var p=l.slice(0);if(h.qListObjectDef)p.forEach(function(e,t){0===t?(h.qListObjectDef.qDef||(h.qListObjectDef.qDef={}),h.qListObjectDef.qDef.qFieldDefs=[e]):(h.qListObjectDef.qExpressions||(h.qListObjectDef.qExpressions=[]),h.qListObjectDef.qExpressions.push({qDef:{qDef:e}}))}),a.resolve(h);else{var f=function(e){if(e.length<=0)return a.resolve(h);var t=e.shift();o(t)?d.addMeasure(i(t)).then(function(){f(e)}):d.addDimension(r(t)).then(function(){f(e)})};f(p)}}else a.resolve(h);return a.promise.then(function(t){return c&&e.extend(!0,t,c),u.exportProperties&&u.importProperties?u.importProperties(u.exportProperties({qProperty:t},u.options.hyperCubePath),t,u,u.options.hyperCubePath).qProperty:t})})},convertProperties:function(i,r,o,s){var a=i.getEffectiveProperties(),l=t.getExtensionType(r),c=t.getExtensionType(o),u=t.getInitialProperties(r);return n.all([a,c,l,u]).then(function(t){var n={qProperty:t[0]};s&&e.extend(!0,n,s);var i=t[1],o=t[2],a=t[3],l="table"===r&&"function"==typeof i.exportTableProperties?i.exportTableProperties:i.exportProperties,c=o.importProperties(l(n),a,o).qProperty;return c.qInfo&&c.qInfo.qId&&delete c.qInfo.qId,c})}}}),define("client.utils/rtl/rtl-util",["jquery"],function(e){function t(e){return c.test(e)}function n(e){return u.test(e)||h.test(e)}function i(e){var i,r,o=e?e.length:0;for(i=0;i<o;i++){if(r=e[i],t(r))return"ltr";if(n(r))return"rtl"}return"ltr"}function r(){var e=document.createElement("div"),t=document.getElementsByTagName("body")[0];e.setAttribute("style","position: absolute; width: 1px; height: 1px; top: -999px; overflow: scroll; white-space:nowrap;"),e.setAttribute("dir","rtl"),t.appendChild(e),a=o(e),l=s(e),t.removeChild(e)}function o(e){e.innerHTML="RTL-SCROLL-TEST";var t="reverse";return e.scrollLeft>0?t="default":(e.scrollLeft=1,0===e.scrollLeft&&(t="negative")),t}function s(t){t.innerHTML="        ";var n;switch(a){case"reverse":n=!1;break;case"default":n=t.scrollLeft>0;break;case"negative":e(t).scrollLeft(-1e3),n=t.scrollLeft<0;break;default:n=!1}return n}var a,l,c=new RegExp("[A-Za-z---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]"),u=new RegExp("[-------]"),h=new RegExp("[-----------]"),d=new RegExp('[\t-\r-"&-*;-@[-`{-~-----------------------------\u2029-------------------------------------------------------]'),p=String.fromCharCode(8206),f=String.fromCharCode(8207);return r(),{supportDirAuto:function(){return void 0===l&&r(),l},detectTextDirection:i,getAutoOrAlternativeDirection:function(e){return l?"auto":i(e)},isLtrChar:t,isRtlChar:n,isNeutralChar:function(e){return d.test(e)},lrm:p,rlm:f,scrollImplementation:a,getScrollPos:function(e,t,n){return n=isNaN(n)?0:n,e&&"reverse"===a?t+n:t-n}}}),define("client.utils/rtl/direction-directive",["qvangular","client.utils/rtl/rtl-util","client.utils/rtl/direction-service"],function(e,t,n){e.directive("qvaDirection",function(){return{restrict:"A",link:function(e,i,r){function o(){var e,o=r.dirSetting?r.dirSetting:n.direction,s=r.dirText;e=s?t.detectTextDirection(s):o,i.attr("dir",e),"rtl"===e?i.addClass("qv-rtl-text"):i.removeClass("qv-rtl-text"),"rtl"===o?i.addClass("qv-rtl-layout"):i.removeClass("qv-rtl-layout")}o(),r.$observe("dirText",o),r.$observe("dirSetting",o)}}})}),define("apis/qutil",["angular","qvangular","core.utils/deferred","util","dragoman","translator","pubsub","core.utils/environment","general.utils/touch-configuration-util","objects.utils/type-loader","general.utils/visualizations","general.models/library/extension-list","objects.utils/interaction-states","client.utils/rtl/direction-service","core.utils/feature-flags","apis/qevent","objects.utils/properties-generator/properties-generator","client.utils/rtl/direction-directive","general.services/content-api/content-api"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g){"use strict";function v(e){var t="",n="";return e&&e.currentSelections?((e.noInteraction||e.noSelections)&&(n=" style='pointer-events:none;'"),t+='<qv-stage-current-selections class="qvt-selections" options="options" app="app"'+n+'></qv-stage-current-selections><div class="qv-global-search-container"'+n+"></div>"):e&&e.showNavigationToolbar?t+='<qv-odag-toolbar class="qv-odag-bar-container" model="model" in-edit-mode="inEdit" stand-Alone="standAlone"></qv-odag-toolbar>':t+='<qv-object model="model" options="options"></qv-object>',t}function y(e,t){e.qInfo=e.qInfo||{},e.qInfo.qType=e.qInfo.qType||t||"mashup",e.qInfo.qId=e.qInfo.qId||"MU"+i.generateId()}function b(e,t,n){if(Array.isArray(e)&&!Array.isArray(t)){var i=t||{},r=[],o=[],s=[];e.forEach(function(e){q(e)?(s.push(-1),o.push(e)):(s.push(r.length),r.push(e))});var a=r.length;return s.forEach(function(e,t){e<0&&(s[t]=a,a++)}),i.columnOrder=s,i.qInterColumnSortOrder=s,b(r,o,i)}var l=n||{};if(e){var c=[];e.forEach(function(e){"string"==typeof e?c.push({qDef:{qFieldDefs:[e]}}):c.push(e)}),l.qDimensions=c}var u=[];return t.forEach(function(e){"string"==typeof e?u.push({qDef:{qDef:e}}):u.push(e)}),l.qMeasures=u,l.qInitialDataFetch=[{qTop:0,qLeft:0,qHeight:20,qWidth:(l.qDimensions?l.qDimensions.length:0)+l.qMeasures.length}],n&&n.rows&&(l.qInitialDataFetch[0].qHeight=n.rows),l}function x(e,t,n){for(var i in t)t.hasOwnProperty(i)&&(t[i]instanceof Object&&!Array.isArray(t[i])?x(e+i+"/",t[i],n):n.push({qPath:e+i,qOp:"add",qValue:"string"==typeof t[i]?'"'+t[i]+'"':JSON.stringify(t[i])}))}function q(e){return"string"==typeof e?0===e.indexOf("="):e.qType?"measure"===e.qType:!!(e.qDef&&e.qDef.qDef||e.qSortBy||e.qAttributeExpressions)}function C(e,t,n){return(e=e?e+", ":"")+o.get(t,JSON.stringify(n))}function S(e){if(!Array.isArray(e))return o.get("Devhub.Cols.Array");var t;return e.forEach(function(e){"object"==typeof e?e.qType?"measure"!==e.qType&&"dimension"!==e.qType?t=C(t,"Devhub.Cols.InvalidQtype",e):e.qLibraryId||(t=C(t,"Devhub.Cols.QlibraryIdMissing",e)):e.qDef?e.qDef.qDef?"string"!=typeof e.qDef.qDef&&(t=C(t,"Devhub.Cols.QdefString",e)):e.qDef.qFieldDefs?Array.isArray(e.qDef.qFieldDefs)||(t=C(t,"Devhub.Cols.QfielddefArray",e)):t=C(t,"Devhub.Cols.QdefOrQfielddefs",e):t=C(t,"Devhub.Cols.QdefOrQlibraryid",e):"string"!=typeof e&&(t=C(t,"Devhub.Cols.InvalidType",e))}),t}var w=!1,_=!1,D={createVisualizationHtml:v,showVisualization:function(n,i,r,o){if("string"==typeof n&&(n=document.getElementById(n)),n){var s=n[0]?n[0]:n;s.innerHTML=v(r);var a=e.element(s).scope();if(!a)return;var l=a.$new(!0),c=e.copy(r)||{};r&&(r.noSelections&&(c.selections=!1),r.noInteraction&&(c.interactionState=d.STATIC),r.showNavigationToolbar&&(l.inEdit=!1,l.standAlone=!0));var u=function(){l.model=i,l.app=o,l.options=c,t.getService("$compile")(e.element(s).children("qv-object, qv-stage-current-selections, qv-odag-toolbar"))(l)};return p.isInit?(c.direction=p.direction,u()):p.init().then(function(){c.direction=p.direction,t.$apply(l,function(){u()})}),t.$apply(l),l}},clearElement:function(e){"string"==typeof e?e=document.getElementById(e):e[0]&&(e=e[0]),e&&(e.innerHTML="")},appDoIt:function(e,i,r){var o=new n;return e.waitForOpen.promise.then(function(){var n=e.enigmaModel||e;t.$apply(t.$rootScope,function(){o.resolve(n[i].apply(n,r))})}),o.promise},setDefaultId:y,getDefaultListParam:function(e,t){var n={};return y(n,e),"BookmarkList"===e?n.qBookmarkListDef={qType:"bookmark",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description"}}:"SnapshotList"===e?n.qBookmarkListDef={qType:"snapshot",qData:{title:"/title",libraryTitle:"/qMetaDef/title",description:"/qMetaDef/description",sourceObjectId:"/sourceObjectId",visualizationType:"/visualizationType",timestamp:"/timestamp",snapshotData:"/snapshotData",isClone:"/isClone"}}:"CurrentSelections"===e?n.qSelectionObjectDef=t||{}:"DimensionList"===e?n.qDimensionListDef={qType:"dimension",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags",grouping:"/qDim/qGrouping",info:"/qDimInfos"}}:"MeasureList"===e?n.qMeasureListDef={qType:"measure",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags"}}:"sheet"===e?n.qAppObjectListDef={qType:"sheet",qData:{title:"/qMetaDef/title",labelExpression:"/labelExpression",description:"/qMetaDef/description",thumbnail:"/thumbnail",cells:"/cells",rank:"/rank",columns:"/columns",rows:"/rows"}}:"masterobject"===e?n.qAppObjectListDef={qType:"masterobject",qData:{name:"/metadata/name",visualization:"/visualization",tags:"/metadata/tags"}}:"VariableList"===e?n.qVariableListDef={qType:"variable",qData:{tags:"/tags"}}:"story"===e?n.qAppObjectListDef={qType:"story",qData:{title:"/qMetaDef/title",description:"/qMetaDef/description",thumbnail:"/thumbnail",rank:"/rank"}}:n["q"+e+"Def"]={},n},createHypercubeDef:b,makeConfig:function(e){return e=e||{},{host:e.host||i.hostname,port:e.port?e.port.toString():i.port,isSecure:e.isSecure||i.isSecure,reloadURI:e.reloadURI?e.reloadURI:i.reloadURI,transientApp:!!e.transientApp,prefix:e.prefix||i.basePath.replace("/extensions/","/"),openWithoutData:e.openWithoutData,identity:e.identity,subpath:e.subpath,qEvent:new m}},inClient:a.inClient,initClient:function(){w||(w=!0,a.inClient()||(l.configureTouchSupport(),r.init({Promise:t.getService("$q")}).then(function(){_||""!==o.localeDetected||o.setup({context:"devhub"})})))},registerExtension:function(e,t,n){var i="extensions/"+e+"/"+e;return window.define(i,t),c.registerExtension({id:e,data:n||{type:"visualization"}}),i},addPatches:x,isMeasure:q,validateColumns:S,createDefinition:function(e,t,i,r){if(!u.getType(t))return n.reject(o.get("Devhub.Visualization.InvalidType",t));if(i){var s=S(i);if(s)return n.reject(s)}return e.model.waitForOpen.promise.then(function(){return g.createProperties(e.model.enigmaModel,t,i,r)})},convertDefinition:function(e,t,n,i){return g.convertProperties(e,t,n,i)},setLanguage:function(e){_=!0,o.setup({context:"devhub",language:e})},resize:function(e){e?s.publish("/ui/object/resize."+e):s.publish("/resize/end")},getExtensionList:function(e){return h.getList().then(function(t){e&&e(t)})},callRepository:function(e,n,i){return t.getService("$contentApi").request({method:n||"GET",url:e,data:i})},capabilityFlags:{get:function(){return this.flags},init:function(e){(e=e||(window.config?window.config:{})).featureFlags&&e.featureFlags instanceof Array&&e.featureFlags.forEach(function(e){f.hasOwnProperty(e)&&!1===f[e]&&(f[e]=!0)}),this.flags=f}}};return Object.defineProperty(D,"Promise",{get:function(){return n.Promise}}),D}),define("apis/qglobal",["qvangular","core.models/app","autogenerated/qix/engine-enums","core.models/rpc-session","apis/qutil"],function(e,t,n,i,r){"use strict";function o(e,t,n,i){return e.session.rpc({method:t,handle:-1,params:n||[]}).then(function(e){return i&&i(e.result),e.result})}function s(n,i,r){e.$apply(e.$rootScope,function(){t.getList(n).then(function(e){r&&n.close(),i(e)},function(){l&&l({code:u.LOCERR_GENERIC_CONNECTION_LOST,message:"ErrorCode."+u.LOCERR_GENERIC_CONNECTION_LOST})})})}function a(e){if(r.initClient(),e instanceof i)this.session=e,this.qEvent=e.options.qEvent;else if(e.app&&e.rpc){var t=i.getIfCached(e.app.id,e.sessionConfig);this.session=t||i.get(e.app.id,e.sessionConfig),this.session.open()}else this.session=i.get("?transient=",e),this.session.open(),this.qEvent=e.qEvent}var l,c,u=n.NxLocalizedErrorCode;return a.setErrorCallback=function(e,t){l=e,c=t},a.get=function(e){var t=r.makeConfig(e);return t.onError=l?function(e){(e=e||{}).code!==u.LOCERR_GENERIC_CONNECTION_LOST&&l(e||{code:u.LOCERR_GENERIC_CONNECTION_LOST,message:"Connection lost"})}:l,r.capabilityFlags.init(e),new a(t)},a.getAppList=function(e,t){var n=r.makeConfig(t);n.onError=l?function(e){(e=e||{}).code!==u.LOCERR_GENERIC_CONNECTION_LOST&&l(e||{code:u.LOCERR_GENERIC_CONNECTION_LOST,message:"Connection lost"})}:l,c&&(n.onWarning=c);var o=i.get("?transient=",n);o.open(),s(o,e,!0)},a.prototype.getAppList=function(e){s(this.session,e,!1)},a.prototype.getAuthenticatedUser=function(e){return o(this,"GetAuthenticatedUser",[],e)},a.prototype.isPersonalMode=function(e){return o(this,"IsPersonalMode",[],e)},a.prototype.getQTProduct=function(e){return o(this,"QTProduct",[],e)},a.prototype.getProductVersion=function(e){return o(this,"ProductVersion",[],e)},a.prototype.cancelReload=function(){return o(this,"CancelReload")},a.prototype.getProgress=function(e,t){return o(this,"GetProgress",[e],t)},a.prototype.GetProgress=function(e,t){return this.getProgress(e,t)},a.prototype.on=function(e,t){this.qEvent.register(e,t)},a.prototype.off=function(e){this.qEvent.clear(e)},a}),define("objects.error-handling/error-translation",["autogenerated/qix/engine-enums","translator"],function(e,t){"use strict";function n(e){return"ErrorCode."+e}var i=e.NxLocalizedErrorCode;return{getDimensionError:function(e){var r;return r=e===i.LOCERR_CALC_INVALID_DEF?"Object.ErrorMessage.InvalidDimension":e===i.LOCERR_CALC_NOT_IN_LIB?"Object.ErrorMessage.MissingDimension":n(e),t.get(r)},getMeasureError:function(e){var r;return r=e===i.LOCERR_CALC_INVALID_DEF?"Object.ErrorMessage.InvalidMeasure":e===i.LOCERR_CALC_NOT_IN_LIB?"Object.ErrorMessage.MissingMeasure":n(e),t.get(r)},getHyperCubeError:function(e){var i=n(e);return t.get(i)},getListObjectError:function(e){var i=n(e);return t.get(i)}}}),define("apis/qtable",["core.utils/notification","objects.error-handling/error-translation","apis/qutil"],function(e,t,n){"use strict";function i(e,n,i){Object.defineProperties(this,{qFallbackTitle:{value:e.qFallbackTitle},qSortIndicator:{value:e.qSortIndicator},qReverseSort:{value:e.qReverseSort||!1},col:{value:n},isOrderedBy:{value:n===i.qHyperCube.qEffectiveInterColumnSortOrder[0]},isDimension:{value:n<i.qHyperCube.qDimensionInfo.length},selections:{value:[]},parent:{value:i}}),this.isDimension?Object.defineProperties(this,{qCardinal:{value:e.qCardinal},qStateCounts:{value:e.qStateCounts},qDimensionInfo:{value:e}}):Object.defineProperties(this,{qMax:{value:e.qMax},qMin:{value:e.qMin},qMeasureInfo:{value:e}}),e.qGroupFieldDefs&&e.qGroupFieldDefs.length>0&&Object.defineProperties(this,{field:{value:i.app.field(e.qGroupFieldDefs[e.qGroupPos])}}),e.qError&&Object.defineProperties(this,{errorCode:{value:e.qError.qErrorCode},errorMessage:{value:this.isDimension?t.getDimensionError(e.qError.qErrorCode):t.getMeasureError(e.qError.qErrorCode)}})}function r(e,t,n,i){Object.defineProperties(this,{qDimensionInfo:{value:t},qText:{value:e.qIsOtherCell?t.othersLabel:e.qText},qElemNumber:{value:e.qElemNumber},qState:{value:e.qState},col:{value:n},selected:{get:function(){return this.header.isSelected(this.qElemNumber)}},header:{get:function(){return this.parent.headers[this.col]}},parent:{value:i}}),isNaN(e.qNum)||Object.defineProperties(this,{qNum:{value:e.qNum}})}function o(e,t,n){Object.defineProperties(this,{qMeasureInfo:{value:t},qGrandTotal:{value:n},qText:{value:e.qText}}),isNaN(e.qNum)||Object.defineProperties(this,{qNum:{value:e.qNum}})}function s(e,t,n){var i=[],s=[],a=[],l=t.qDimensionInfo.length,c=t.columnOrder;e.forEach(function(e,a){a<l?i.push(new r(e,t.qDimensionInfo[a],a,n)):s.push(new o(e,t.qMeasureInfo[a-l],t.qGrandTotalRow[a-l]))}),c?c.forEach(function(e){a.push(e<l?i[e]:s[e-l])}):a=i.concat(s),Object.defineProperties(this,{dimensions:{value:i},measures:{value:s},cells:{value:a}})}function a(t,n,i){if(e.create(this,"OnData"),Object.defineProperties(this,{app:{value:t},path:{value:i||"qHyperCube"},defPath:{get:function(){return this.path+"Def"}},rows:{value:[]},headers:{value:[]},totals:{value:[]},rowCount:{get:function(){if(this.qHyperCube&&this.qHyperCube.qSize)return this.qHyperCube.qSize.qcy}},colCount:{get:function(){if(this.qHyperCube&&this.qHyperCube.qSize)return this.qHyperCube.qSize.qcx}}}),"function"==typeof n.then){var r=this;n.then(function(e){l(r,e)})}else l(this,n.backendApi?n.backendApi.model:n,n.backendApi?n:void 0)}function l(e,t,n){Object.defineProperties(e,{model:{value:t},view:{value:n}}),c(e),e.model&&e.model.Validated&&(e._OnModelValid=function(){c(e)},e.model.Validated.bind(e._OnModelValid))}function c(e){if(!e.qHyperCube&&e.model.layout&&(e.qHyperCube=e.model.layout[e.path]),!(e.model&&e.model.layout&&e.model.layout.qSelectionInfo&&e.model.layout.qSelectionInfo.qInSelections)){if(e.headers.length=0,e.totals.length=0,e.rows.length=0,e.qHyperCube){var t=e.qHyperCube.qDimensionInfo?e.qHyperCube.qDimensionInfo.length:0,n=e.qHyperCube.columnOrder;e.qHyperCube.qDimensionInfo&&e.qHyperCube.qDimensionInfo.forEach(function(t,r){if(n){var o=n.indexOf(r);e.headers[o]=new i(t,r,e)}else e.headers.push(new i(t,r,e))}),e.qHyperCube.qMeasureInfo&&e.qHyperCube.qMeasureInfo.forEach(function(r,o){if(n){var s=n.indexOf(o+t);e.headers[s]=new i(r,o+t,e)}else e.headers.push(new i(r,o+t,e))}),e.qHyperCube.qGrandTotalRow&&e.qHyperCube.qGrandTotalRow.forEach(function(t,n){e.totals.push(new o(t,e.qHyperCube.qMeasureInfo[n]))}),u(e,e.qHyperCube.qDataPages)}e.OnData.emit()}}function u(e,t){t&&t.forEach(function(t){t.qMatrix.forEach(function(t){e.rows.push(new s(t,e.qHyperCube,e))})})}return i.prototype.orderBy=function(){var e=[this.col];this.parent.qHyperCube.qEffectiveInterColumnSortOrder.forEach(function(t){t!==e[0]&&e.push(t)});var t=[{qPath:"/"+this.parent.defPath+"/qInterColumnSortOrder",qOp:"replace",qValue:"["+e.join(",")+"]"}];return this.parent.model.applyPatches(t,!0)},i.prototype.reverseOrder=function(){var e=this.col<this.parent.qHyperCube.qDimensionInfo.length,t=[{qPath:"/"+this.parent.defPath+(e?"/qDimensions/"+this.col:"/qMeasures/"+(this.col-this.parent.qHyperCube.qDimensionInfo.length))+"/qDef/qReverseSort",qOp:"replace",qValue:(!this.qReverseSort).toString()}];return this.parent.model.applyPatches(t,!0)},i.prototype.isSelected=function(e){return this.selections.indexOf(e)>-1},i.prototype.toggleSelect=function(e){var t=this.selections.indexOf(e);t<0?this.selections.push(e):this.selections.splice(t,1)},i.prototype.selectRange=function(e,t,n,i){var r={qMeasureIx:this.col-this.parent.qHyperCube.qDimensionInfo.length,qRange:{qMin:e,qMax:t,qMinInclEq:n,qMaxInclEq:i}};return this.parent.model.rangeSelectHyperCubeValues("/"+this.parent.defPath,[r],[],!1)},r.prototype.select=function(){return this.header.toggleSelect(this.qElemNumber),this.parent.view&&this.parent.view.selectValues?this.parent.view.selectValues(this.col,[this.qElemNumber],!0):this.parent.model.selectHyperCubeValues("/"+this.parent.defPath,this.col,[this.qElemNumber],!0)},o.prototype.getPercentOfMax=function(){return Math.round(100*this.qNum/this.qMeasureInfo.qMax*100)/100},o.prototype.getPercent=function(){return Math.round(100*this.qNum/this.qGrandTotal.qNum*100)/100},a.prototype.getMoreData=function(){if(!(this.requestActive||this.rowCount<=this.rows.length)){this.requestActive=!0;var e=this,t={qTop:this.rows.length,qLeft:0,qWidth:this.colCount,qHeight:50};return e.view?e.view.backendApi.getData([t]).then(function(t){u(e,t),e.requestActive=!1,e.OnData.emit()}):e.qHyperCube?e.model.getHyperCubeData("/qHyperCubeDef",[t]).then(function(t){u(e,t),e.requestActive=!1,e.OnData.emit()}):null}},a.prototype.getColByName=function(e){if(e){var t,n=e.toUpperCase();return this.headers.forEach(function(e,i){e.qFallbackTitle.toUpperCase()===n&&(t=i)}),t}},a.prototype.exportData=function(e,t){return e=e||{},this.model.exportData(e.format||"OOXML","/"+this.defPath,e.filename,e.state||"P").then(function(i){var r=this.app.global,o=r&&r.session.options,s=(o=n.makeConfig(o)).prefix+i.qUrl.substring(1);e.download&&window.open(s),t&&t(s)}.bind(this))},a.prototype.destroy=function(){this.model&&this.model.Validated&&this._OnModelValid&&(this.model.Validated.unbind(this._OnModelValid),delete this._OnModelValid)},a}),define("apis/qvisualization",["apis/qtable","apis/qutil","objects.extension/object-data-view"],function(e,t,n){"use strict";function i(t,n){if(n instanceof i)return n;Object.defineProperties(this,{id:{value:n.id},qapp:{value:t},model:{value:n}}),n.layout.qHyperCube&&Object.defineProperties(this,{table:{value:new e(this.qapp,n),configurable:!0}})}return i.prototype.setOptions=function(e){var n=[];return t.addPatches("/",e,n),this.model.applyPatches(n,!0)},i.prototype.show=function(e,n){n=n||{};var i=t.showVisualization(e,this.model.enigmaModel,n);return this._scopes=this._scopes||[],this._scopes.push(i),this._elements=this._elements||[],this._elements.push(e),i},i.prototype.close=function(){return this._scopes&&(this._scopes.forEach(function(e){e.$destroy()}),delete this._scopes),this._elements&&(this._elements.forEach(function(e){t.clearElement(e)}),delete this._elements),this.table&&(this.table.destroy(),delete this.table),this.model&&this.model._expendable&&this.model.close(),t.Promise.resolve()},i.prototype.resize=function(){t.resize(this.id)},i.prototype.toggleDataView=function(){var e=this;return e.dataView||(e.dataView=e._elements.map(function(t){return new n(e.qapp.model,e.model,document.getElementById(t).firstElementChild)})),e.dataView.map(function(e){return e.toggle()})},i}),define("apis/qappvisualization",["objects.utils/type-loader","apis/qvisualization","apis/qutil"],function(e,t,n){"use strict";function i(e){this.qapp=e}return i.prototype.get=function(e){var n=this;return n.qapp.getObject(e).then(function(e){return new t(n.qapp,e)})},i.prototype.create=function(i,r,o){var s=this;return e.load().then(function(){return("object"==typeof r&&r.hasOwnProperty("genericType")?n.convertDefinition(r,i,r.genericType,o):n.createDefinition(s.qapp,i,r,o)).then(function(e){return s.qapp.createGenericObject(e).then(function(e){return e._expendable=!0,new t(s.qapp,e)})})})},i}),define("apis/qselection-state",["core.utils/notification"],function(e){"use strict";function t(e,t){Object.defineProperties(this,{fieldName:{value:e.qField},field:{get:function(){return i(this.parent,this.fieldName)}},qSortIndex:{value:e.qSortIndex},locked:{value:e.qLocked||!1},isNumeric:{value:e.qIsNum||!1},totalCount:{value:e.qTotal},selectedCount:{value:e.qSelectedCount},qStateCounts:{value:e.qStateCounts},qSelected:{value:e.qSelected},selectedValues:{value:e.qSelectedFieldSelectionInfo},notSelectedValues:{value:e.qNotSelectedFieldSelectionInfo},qSelectionThreshold:{value:e.qSelectionThreshold},qTextSearch:{value:e.qTextSearch},qRangeInfo:{value:e.qRangeInfo},parent:{value:t}})}function n(t,n,i){e.create(this,"OnData"),Object.defineProperties(this,{qapp:{value:t},selections:{value:[]},stateName:{value:i||"$"}});var o=this;n.then(function(e){r(o,e),e.Validated.bind(function(){r(o,e)})})}function i(e,t){return e.qapp.field(t,e.stateName)}function r(e,n){e.selections.length=0,n.layout.qSelectionObject&&(void 0===e.backCount&&Object.defineProperties(e,{backCount:{get:function(){return n.layout.qSelectionObject.qBackCount||0}},forwardCount:{get:function(){return n.layout.qSelectionObject.qForwardCount||0}}}),n.layout.qSelectionObject.qSelections.forEach(function(n){e.selections.push(new t(n,e))}),e.OnData.emit())}return n.prototype.clearAll=function(e){return this.qapp.clearAll(e,this.stateName)},n.prototype.lockAll=function(){return this.qapp.lockAll(this.stateName)},n.prototype.unlockAll=function(){return this.qapp.unlockAll(this.stateName)},n}),define("apis/qtheme",["client.utils/theme/theme-module","client.utils/theme/modern/theme-style-resolver"],function(e,t){"use strict";function n(e,t){this.id=e,Object.defineProperties(this,{id:{value:e},properties:{value:t}})}var i=e.get();return n.prototype.getStyle=function(e,n,i){return new t(e,this.id,this.properties).getStyle(n,i,!1)},n.prototype.apply=function(){return i.applyTheme(this.id).then(function(e){return e})},n}),define("apis/qtheme-global",["apis/qtheme","client.utils/theme/theme-module"],function(e,t){"use strict";function n(){i=t.get()}var i;return n.getThemeList=function(){return i.getAvailableThemes().then(function(e){return e.custom?e.default.concat(e.custom):e.default})},n.prototype.apply=function(e){return i.applyTheme(e).then(function(e){return e})},n.prototype.get=function(t){return i.getThemeJSON(t).then(function(n){return new e(t,n)})},n}),define("apis/qtheme-app",["client.utils/theme/theme-module","apis/qtheme-global","client.models/app-generic-props-wrapper"],function(e,t,n){"use strict";function i(e){this.app=e}var r=e.get(),o=new t;return i.prototype.save=function(e){var t=this.app;r.isValidTheme(e).then(function(n){if(!n)throw new Error("Invalid theme id");t.waitForOpen.promise.then(function(){t.getLayout().then(function(t){if(!t.permissions.update)throw new Error("permission denied");r.saveTheme(e)})})})},i.prototype.get=function(e){return e?o.get(e):this.app.waitForOpen.promise.then(function(){return n.getProperties().then(function(e){return o.get(e.theme)})})},i.prototype.getApplied=function(){return o.get(r.getCurrentTheme())},i}),define("apis/qapp",["core.utils/deferred","core.models/app","autogenerated/qix/engine-enums","client.models/current-selections","client.models/snapshot","objects.backend-api/snapshot-api","translator","apis/qfield","apis/qbookmark","apis/qvariable","apis/qglobal","apis/qtable","apis/qutil","apis/qappvisualization","apis/qselection-state","apis/qtheme-app"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){"use strict";function g(e){this.fieldCache={},this.stateCache={},Object.defineProperties(this,{id:{value:e.id},model:{value:e}}),e.session&&Object.defineProperties(this,{global:{value:new u(e.session)},bookmark:{value:new l(e)},variable:{value:new c(e,this)},visualization:{value:new p(this)},theme:{value:new m(e)}}),e.rpcOptions&&e.rpcOptions.qEvent&&(this.qEvent=e.rpcOptions.qEvent),this.getAppLayout()}function v(t,n){var i=n||new e;return t.getLayout().then(function(){i.resolve(t)},function(e){i.reject(e)}),i.promise}var y,b,x,q=n.NxLocalizedErrorCode,C={};return g.prototype.clearAll=function(e,t){return d.appDoIt(this.model,"clearAll",[e||!1,t||"$"])},g.prototype.back=function(){return d.appDoIt(this.model,"back")},g.prototype.forward=function(){return d.appDoIt(this.model,"forward")},g.prototype.lockAll=function(e){return d.appDoIt(this.model,"lockAll",[e||"$"])},g.prototype.unlockAll=function(e){return d.appDoIt(this.model,"unlockAll",[e||"$"])},g.prototype.getObject=function(t,n,r){var o,a,l=this.model,c=this;return n||(n=t,t=void 0),o=new e,l.waitForOpen.promise.then(function(){if("CurrentSelections"===n){if(t){var u=r||{};u.currentSelections=!0,a=d.showVisualization(t,null,u,l)}i.get(l).then(function(e){e.close=a?a.$destroy.bind(a):function(){},o.resolve(e)})}else if("AppNavigationBar"===n&&d.capabilityFlags.get().ODAG_MASHUP){var h=r||{};r.app=l,h.showNavigationToolbar=!0,a=d.showVisualization(t,r,h,l),o.resolve()}else l.enigmaModel.getObject(n).then(function(n){return v(n).then(function(n){if(t){a=d.showVisualization(t,n,r);var i=function(){return a.$destroy(),d.clearElement(t),e.resolve()};n.close=function(){return i()},n.Closed.bind(function(){i()})}v(n,o)})},function(e){e.error&&e.error.code===q.LOCERR_GENERIC_NOT_FOUND&&(e={message:s.get("Object not found"),code:e.error.code}),c.qEvent&&c.qEvent.hasHandlers("error")?(c.qEvent.emit("error",e),e.isHandled=!0):y&&(y(e),e.isHandled=!0),o.reject(e)})},function(){o.reject()}),o.promise},g.prototype.getSnapshot=function(e,t){t||(t=e,e=void 0);var n=this.model;return n.waitForOpen.promise.then(function(){return r.get(t,n).then(function(t){return e&&d.showVisualization(e,t.enigmaModel,{APIType:o,noInteraction:!0}),t.getLayout().then(function(){return t})})})},g.prototype.getObjectProperties=function(e){var t=this.model;return t.waitForOpen.promise.then(function(){return t.enigmaModel.getObject(e)}).then(function(e){return e.getProperties().then(function(){return e})})},g.prototype.getFullPropertyTree=function(e){var t=this.model;return t.waitForOpen.promise.then(function(){return t.enigmaModel.getObject(e)}).then(function(e){return e.getFullPropertyTree().then(function(t){return e.propertyTree=t,e})})},g.prototype.createGenericObject=function(t,n){var i=this;return i.model.waitForOpen.promise.then(function(){var e=n?function(e){n(e,i)}:function(){};return d.setDefaultId(t),i.model.enigmaModel.getOrCreateSessionObject(t).then(function(t){return t.Invalidated.bind(function(){t.getLayout().then(e)}),t.close=function(){return i.destroySessionObject(t.id).then(function(){return t.emit("closed",t),t})},t.Closed.bind(function(){i.model.enigmaModel._listCache&&i.model.enigmaModel._listCache[this.id]&&delete i.model.enigmaModel._listCache[this.id]}),t.getLayout().then(function(n){return e(n),t})},function(e){y&&(y(e.error,i),e.error.isHandled=!0)})},function(){return e.reject()})},g.prototype.destroySessionObject=function(e){return d.appDoIt(this.model,"destroySessionObject",[e])},g.prototype.createCube=function(e,t){return this.createGenericObject({qHyperCubeDef:e},t)},g.prototype.createList=function(e,t){return this.createGenericObject({qListObjectDef:e},t)},g.prototype.getList=function(e,t){return this.createGenericObject(d.getDefaultListParam(e),t)},g.prototype.getAppObjectList=function(e,t){return t||(t=e,e="sheet"),this.getList(e,t)},g.prototype.searchSuggest=function(e,t,n){var i=d.appDoIt(this.model,"searchSuggest",[t,e]).then(function(e){return{qResult:e}});return n&&i.then(function(e){n(e)}),i},g.prototype.searchAssociations=function(e,t,n,i){var r=d.appDoIt(this.model,"searchAssociations",[n||{},e,t]).then(function(e){return{qResults:e}});return i&&r.then(function(e){i(e)}),r},g.prototype.searchResults=function(e,t,n,i){var r=d.appDoIt(this.model,"searchResults",[n||{},e,t]).then(function(e){return{qResult:e}});return i&&r.then(function(e){i(e)}),r},g.prototype.selectAssociations=function(e,t,n){return d.appDoIt(this.model,"selectAssociations",[n||{},t,e])},g.prototype.getAppLayout=function(t){var n=this,i=new e,r=t?function(e){t(e.layout,n)}:function(){};return n.model.waitForOpen?n.model.waitForOpen.promise.then(function(){n.model.Invalidated&&n.model.Invalidated.bind(function(){v(n.model).then(r)}),v(n.model).then(function(e){r(e),i.resolve(e)})}):v(n.model).then(function(e){r(e),i.resolve(e)}),i.promise},g.prototype.addAlternateState=function(e){return d.appDoIt(this.model,"addAlternateState",[e])},g.prototype.removeAlternateState=function(e){return d.appDoIt(this.model,"removeAlternateState",[e])},g.prototype.doReload=function(e,t,n){return this.fieldCache={},d.appDoIt(this.model,"doReload",[e||0,t||!1,n||!1])},g.prototype.doSave=function(e){return d.appDoIt(this.model,"doSave",[e])},g.prototype.field=function(e,t){var n=t?e+"/"+t:e;return this.fieldCache[n]||(this.fieldCache[n]=new a(this,e,t)),this.fieldCache[n]},g.prototype.table=function(e,t){return new h(this,e,t)},g.setErrorCallback=function(e,t){y=e,b=t},g.prototype.createTable=function(e,t,n){var i=d.createHypercubeDef(e,t,n);return new h(this,this.createGenericObject({qHyperCubeDef:i}))},g.prototype.selectionState=function(e){var t=e||"$";if(!this.stateCache[t]){var n=d.getDefaultListParam("CurrentSelections",{qStateName:t});this.stateCache[t]=new f(this,this.createGenericObject(n),t)}return this.stateCache[t]},g.prototype.getScript=function(){return this.model.getScript?this.model.getScript().then(function(e){return{qScript:e}}):this.model.rpc("GetScript")},g.prototype.setScript=function(e){function t(e,t){return t.qErrors&&t.qErrors.length>0?t:e}var n=this.model,i="function"==typeof this.model.setScript?function(e){return n.setScript(e)}:function(e){return n.rpc("SetScript",null,[e])},r="function"==typeof this.model.checkScriptSyntax?function(){return n.checkScriptSyntax().then(function(e){return{qErrors:e}})}:function(){return n.rpc("CheckScriptSyntax")};return i(e).then(function(e){return r().then(function(n){return t(e,n)})})},g.currApp=function(e){var n;return(n=e&&e.backendApi&&e.backendApi.model.session&&e.backendApi.model.session.currentApp?e.backendApi.model.session.currentApp:e&&e.backendApi&&e.backendApi.model.app?e.backendApi.model.app:t.current)?(x||(x=new g(n)),x.model===n?x:new g(n)):null},g.openApp=function(n,i){d.capabilityFlags.init(i),d.initClient(),n=n||"";var r,o,s=d.makeConfig(i),a=t.makeCacheId(n,s);if(C[a])return C[a];r=y?function(e){y(e||{code:q.LOCERR_GENERIC_CONNECTION_LOST,message:"Connection lost"})}:y,b&&(o=b);var l=t.getSync(n,s,!0,r,o);if(l){var c=new g(l);c.close=function(){var t=new e;return setTimeout(function(){delete C[a],t.resolve(l.close(!1))},200),t.promise},C[a]=c}return C[a]},g.sessionApp=function(e){return this.sessionAppFromApp("?transient=",e)},g.sessionAppFromApp=function(n,i){var r;d.capabilityFlags.init(i),d.initClient();var o,s=d.makeConfig(i),a=t.makeCacheId(n,s);s.identity=s.identity||"sessionapp",s.sessionApp={value:!0,appId:n},o=function(e){e&&1002===e.code?e.isHandled=!0:y&&y({code:q.LOCERR_GENERIC_CONNECTION_LOST,message:"Connection lost"})};var l=t.getSync(n,s,!0,o,b);return l&&((r=new g(l)).close=function(){var t=new e;return setTimeout(function(){delete C[a],t.resolve(l.close(!1))},200),t.promise}),r},g.table=function(e,t){return g.currApp(e).table(e,t)},g.prototype.on=function(e,t){this.qEvent.register(e,t)},g.prototype.off=function(e){this.qEvent.clear(e)},g}),define("text!assets/hldm/data-connectors/bdi/bdi-field-list.ng.html",[],function(){return'<ul class="bdi-field-list lui-list">\n\n    <li class="lui-list__header bdi-field-header">\n        <span class="lui-list__text">{{$ctrl.name}}</span>\n        <label class="lui-checkbox bdi-header-selectall">\n            <input class="lui-checkbox__input" type="checkbox" aria-label="Label" qva-indeterminate="$ctrl.tableState.indeterminate"\n                ng-checked="$ctrl.tableState.checked" ng-click="$ctrl.tableSelectClicked()" />\n            <div class="lui-checkbox__check-wrap">\n                <span class="lui-checkbox__check"></span>\n            </div>\n        </label>\n    </li>\n\n    <div class="bdi-item-container">\n\n        <li class="lui-list__item bdi-field-item" ng-click="$ctrl.showFilterFor($event, field)" ng-repeat="field in $ctrl.fields">\n\n            <div class="bdi-field-item-container">\n                \n\n                <span class="lui-list__text bdi-list-item-text">\n                    <div>{{field.qName}}</div>\n                </span>\n\n\n                <label class="lui-checkbox bdi-field-item-check" ng-if="!field.isKeyField">\n                        <input class="lui-checkbox__input" type="checkbox" aria-label="Label" ng-model="field.selected" ng-click="$event.stopPropagation(); $ctrl.updateCheckedStates()"/>\n                        <div class="lui-checkbox__check-wrap" ng-click="$event.stopPropagation()">\n                            <span class="lui-checkbox__check"></span>\n                        </div>\n                    </label>\n    \n                    <span class="lui-icon  lui-icon--key bdi-field-item-icon" aria-hidden="true" ng-if="field.isKeyField"></span>\n\n            </div>\n\n            \x3c!-- turned off for now --\x3e\n            <qv-state-count-bar ng-if="false && $ctrl.showStateBar( field )" state-counts="field.cachedListVisual.model.layout.qListObject.qDimensionInfo.qStateCounts" options="options"></qv-state-count-bar>\n        </li>\n\n    </div>\n\n</ul>'}),define("text!client.views/state-count-bar/state-count-bar.ng.html",[],function(){return'<div class="qv-state-count-bar" tid="stateCount" qva-direction x-dir-setting="{{options.direction}}">\n\t<div class="state selected" ng-style="{\'width\': percents.qSelected + \'%\'}"></div>\n\t<div class="state locked" ng-style="{\'width\': percents.qLocked + \'%\'}"></div>\n\t<div class="state optional" ng-style="{\'width\':  percents.qOption + \'%\'}"></div>\n\t<div class="state alternative" ng-style="{\'width\':  percents.qAlternative + \'%\'}"></div>\n</div>'}),define("client.views/state-count-bar/state-count-bar",["qvangular","text!./state-count-bar.ng.html"],function(e,t){"use strict";e.directive("qvStateCountBar",function(){return{restrict:"E",template:t,replace:!0,scope:{stateCounts:"=",options:"="},link:function(e){function t(){var t,n=e.stateCounts;n&&(t=i(n),e.percents=r(t))}function n(e){return Object.keys(e).reduce(function(t,n){return t+e[n]},0)}function i(e){var t=n(e),i={};return["qSelected","qLocked","qOption","qAlternative"].forEach(function(n){var r=e[n]||0,o=Math.round(r/t*100);r>0&&0===o&&(o=1),i[n]=o}),i}function r(e){var t,n,i={},r=0;for(t in e)i[t]=e[t],(!n||e[t]>e[n])&&(n=t),r+=e[t];return r>100&&(i[n]=e[n]-(r-100)),i}e.percents=[],e.$watchCollection("stateCounts",function(){t()})}}})}),define("objects.models/listbox",["core.models/communication","core.utils/deferred","general.utils/visualizations","objects.utils/data-properties/listobject-util","util","objects.utils/type-loader","angular"],function(e,t,n,i,r,o,s){"use strict";function a(n){return n?t.resolve(n.enigmaModel):e.getApp()}var l=[],c={};return c.get=function(e,t){return a(t).then(function(t){return t.getObject(e)})},c.createTransient=function(e,t,i){var r,a,c,u=-1,h=l.length;for(r={that:e,app:t,props:i},a=0;a<h;a++)if(l[a].askFor.that===e&&l[a].askFor.app===t&&s.equals(l[a].askFor.props,i)){u=a;break}return u>=0?l[u].result:(c=o.load().then(function(){return n.getType("listbox").getInitialProperties(i).then(function(e){return t.createSessionObject(e)})}),l.push({askFor:r,result:c}),c)},c.createTransientField=function(e,t,n){var o={};return o.qListObjectDef=i.createFieldDimension(t),r.extend(!0,o,n||{}),this.createTransient(this,e,o)},c.createTransientDimension=function(e,t,n){var o={};return o.qListObjectDef=i.createLibraryDimension(t),r.extend(!0,o,n||{}),this.createTransient(this,e,o)},c}),define("text!client.views/selection-toolbar/selection-toolbar.ng.html",[],function(){return'<div qva-direction class="qv-selection-toolbar qvt-selection-toolbar"\n\t ng-style="toolbar.style"\n\t ng-class="{ \'sel-toolbar-card\': !options.isPopover, \'sel-toolbar-popover\': options.isPopover, \'sel-toolbar-click-to-unlock-bg\': locked, \'sel-toolbar-menu-item\': locked }"\n\t qva-activate="locked && toggleLock($event);">\n    <div class="sel-toolbar-list-wrapper">\n\t\t<table class="sel-toolbar-list">\n            <tr>\n                <td ng-if="toolbar.showLock || locked" class="sel-toolbar-list-item sel-toolbar-list-item-lockunlock">\n                    <button tid="selection-toolbar.lock"\n                            class="sel-toolbar-btn sel-toolbar-icon"\n                            q-title-translation="{{locked ? \'SelectionToolbar.ClickToUnlock\' : \'SelectionToolbar.ClickToLock\'}}"\n                            ng-disabled="locked ? false : !toolbar.backendApi.hasSelections()"\n                            qva-activate="!locked && toggleLock($event);">\n                        <span class="lui-icon sel-toolbar-span-icon" ng-class="!locked ? \'lui-icon--unlock\':\'lui-icon--lock sel-toolbar-menu-span-icon\'"></span>\n                    </button>\n                </td>\n\t\t\t\t<td class="sel-toolbar-list-item" ng-class="{ \'sel-toolbar-list-item-hide-more\': !shouldShowBtnMore() }">\n\t\t\t\t\t<button tid="selection-toolbar.toggleShowMenu"\n\t\t\t\t\t\t\t\t\tclass="sel-toolbar-btn sel-toolbar-icon sel-toolbar-icon-toggle"\n\t\t\t\t\t\t\t\t\tng-class="{ \'menu-active\': toolbar.showMenu }"\n\t\t\t\t\t\t\t\t\tq-title-translation="{{toolbar.showMenu ? \'Tooltip.CloseSelectionMenu\' : \'Tooltip.SelectionMenu\'}}"\n\t\t\t\t\t\t\t\t\tqva-activate="toggleShowMenu($event)">\n\t\t\t\t\t\t<span class="lui-icon  lui-icon--more"></span>\n\t\t\t\t\t</button>\n\t\t\t\t</td>\n                <td ng-show="locked" class="sel-toolbar-list-item-locked">\n                    <p class="sel-toolbar-menu-text" q-translation="SelectionToolbar.ClickToUnlock"></p>\n                </td>\n                <td ng-show="locked && options.smallDevice" qva-activate="toolbar.selectionsApi.confirm()" class="sel-toolbar-list-item-close">\n                    <qui-toolbarbutton>\n                        <span class="sel-toolbar-menu-text sel-toolbar-btn-close-text" q-translation="Common.Close"></span>\n                    </qui-toolbarbutton>\n\t\t\t\t</td>\n\t\t\t\t<td ng-repeat="select in selectComponents" class="sel-toolbar-list-item-optionslist">\n\t\t\t\t\t<select ng-show="shouldShowSelect(select)" ng-disabled="shouldDisableSelect(select)" tid="select.tid" q-title-translation="{{select.name}}" ng-style="{width: select.width}" class="lui-select" ng-model="select.value" ng-change="select.action(select)">\n\t\t\t\t\t\t<option ng-if="select.noSelectOption" value="{{select.noSelectOption.value || \'\'}}">{{select.noSelectOption.label || select.noSelectOption.value || ""}}</option>\n\t\t\t\t\t\t<option ng-repeat="option in select.options" value="{{option.value}}">{{option.label || option.value}}</option>\n\t\t\t\t\t</select>\n\t\t\t\t</td>\n                <td ng-show="!locked" ng-repeat="button in filteredButtons" class="sel-toolbar-list-item" ng-class="button.clazz">\n                    <button tid="{{button.tid}}"\n                            qva-activate="buttonAction($event, button)"\n                            q-title-translation="{{button.name}}"\n                            ng-disabled="buttonIsDisabled(button)"\n                            class="sel-toolbar-btn"\n                            ng-class="[button.buttonClass, button.isIcon ? \'sel-toolbar-icon\' : \'\', button.isActive(this) ? \'menu-active\' : \'\']">\n                        <span class="sel-toolbar-span-icon lui-icon" ng-class="button.iconClass"></span>\n                    </button>\n                </td>\n            </tr>\n        </table>\n\n\t</div>\n\t\n\t\x3c!-- Menu container (drop-down) --\x3e\n\t<div ng-if="toolbar.showMenu" class="sel-toolbar-menu" ng-style="toolbar.menuStyle"\n\t\t qva-delegated-activate="div:not(.disabled)#menuAction($event);">\n\n\t\t \x3c!-- Menu "go back"-button for sub-levels --\x3e\n\t\t <div ng-if="levels.length > 0" class="sel-toolbar-menu-item back-item" tid="sel-toolbar-menu-back">\n\t\t\t<table class="sel-toolbar-menu-table">\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<span class="sel-toolbar-menu-span-icon lui-icon lui-icon--triangle-left" ng-class="button.iconClass"></span>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<p class="sel-toolbar-menu-text" q-translation="Back"></p>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</div>\n\n\t\t\x3c!-- Menu buttons --\x3e\n\t\t<div ng-repeat="button in currentMenuButtons" class="sel-toolbar-menu-item"\n\t\t\t tid="{{button.tid}}"\n\t\t\t q-title-translation="{{button.name}}"\n\t\t\t ng-class="{\'disabled\': buttonIsDisabled(button), \'selected\': isButtonSelected( button ) }">\n\t\t\t<table class="sel-toolbar-menu-table" ng-class="{ \'selection-toolbar-menu-table-align-center\': !filteredButtons.length }">\n\t\t\t\t<tr>\n\n\t\t\t\t\t\x3c!-- Button icon --\x3e\n\t\t\t\t\t<td ng-if="button.iconClass">\n\t\t\t\t\t\t<span class="sel-toolbar-menu-span-icon" ng-class="button.iconClass"></span>\n\t\t\t\t\t</td>\n\n\t\t\t\t\t\x3c!-- Button label --\x3e\n\t\t\t\t\t<td ng-if="filteredButtons.length || ( button.name && !button.iconClass )" ng-class="{\'menu-text-with-right-icon\': button.items}">\n\t\t\t\t\t\t<p class="sel-toolbar-menu-text" ng-class="{\'menu-text-without-left-icon\': !button.iconClass}" q-translation="{{button.name}}"></p>\n\t\t\t\t\t</td>\n\n\t\t\t\t\t\x3c!-- "Click to see more"-icon --\x3e\n\t\t\t\t\t<td ng-if="button.items">\n\t\t\t\t\t\t<span class="sel-toolbar-menu-span-icon next-icon lui-list__aside lui-icon lui-icon--triangle-right"></span>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</div>\n\t</div>\n</div>\n'}),define("client.views/selection-toolbar/selection-toolbar-constants",[],function(){"use strict";var e={BUTTON_WIDTH:44,SEPARATOR_WIDTH:1,BORDER_SPACING:8,SELECT_DEFAULT_WIDTH:200,EXTRA_EDGE_PADDING:2,TYPE_BUTTON:"button",TYPE_SEPARATOR:"separator",TYPE_SELECT:"select"};return Object.freeze(e),e}),define("client.views/selection-toolbar/selection-toolbar",["jquery","qvangular","text!./selection-toolbar.ng.html","client.views/selection-toolbar/selection-toolbar-constants","core.utils/deferred","util"],function(e,t,n,i,r,o){"use strict";var s,a,l={},c=i.BUTTON_WIDTH,u=i.SEPARATOR_WIDTH,h=i.BORDER_SPACING,d=i.SELECT_DEFAULT_WIDTH,p=i.EXTRA_EDGE_PADDING,f=i.TYPE_BUTTON,m=i.TYPE_SEPARATOR,g=i.TYPE_SELECT;return t.componentDirective("qvaIncludeSelectionToolbar",{toolbar:"=",options:"="}),s={width:0,items:[],hasItems:function(){return this.items.length>0},reset:function(e){this.width=e,this.items.length=0},freeWidth:function(){var e,t=0;for(e=0;e<this.items.length;e++)t+=this.items[e];return this.width-t}},{template:n,controller:["$scope",function(n){function i(e){return e.component?e.component:"sel-toolbar-icon-separator"===e.buttonClass?m:f}function v(e){switch(i(e)){case f:return c+h;case m:return u+h;case g:return(e.width||d)+h}}function y(e,t,i){var r,o,a=0;for(s.reset(e-(h+2*p)),o=t.length-1;o>=0&&(r=v(t[o]))<=s.freeWidth();o--)s.items.push(r);for((n.toolbar.showLock||n.locked)&&(a+=c+h),(i.length>0||t.length>s.items.length)&&(a+=c+h);s.hasItems()&&s.freeWidth()<a;)s.items.pop();return s.items.length}function b(e,t){e._componentId=t,e.items&&e.items.forEach(function(e){e._componentId=t})}function x(e){e.forEach(function(e){e._componentId&&b(e,e._componentId)}),n.currentMenuButtons=e}function q(e){e.forEach(function(e){b(e,e._componentId||o.generateId()),l[e._componentId]=e})}function C(){var e,t,r=[].concat(n.toolbar.buttons),o=[].concat(n.toolbar.menuButtons),s=y(n.toolbar.style.width,r,o),a=[];n.filteredButtons=[];var l=[];for(n.levels=[],q(r.concat(o).filter(function(e){return e.component})),e=0;e<s&&r.length;++e)(t=r.pop()).component?a.push(t):n.filteredButtons.push(t);for(n.filteredButtons.reverse();r.length;)i(t=r.pop())!==m&&l.push(t);for(;o.length;)l.push(o.shift());x(l),S(a)}function S(e){e.forEach(function(e){switch(e.component){case g:var t={width:d},i=o.extend(!0,t,e);o.extend(e,i),n.selectComponents=n.selectComponents||[],n.selectComponents.push(e);break;default:throw new Error("Select toolbar component: "+e.component+" was not recognized")}})}function w(){a=null,x(n.levels.pop().items)}function _(e){n.levels.push({items:n.currentMenuButtons}),x(e)}function D(e){return l[e]}function M(e){n.locked=e,n.toolbar.showMenu=!1,E.then(function(){C()})}var A=r(),E=A.promise;n.filteredButtons=[],n.currentMenuButtons=[],n.levels=[],n.selectionInfo={show:!1,selected:0,total:0},n.lassoEnabled=!1,this.layoutItems=C,this.confirm=function(){n.selectionsApi.confirm()},this.close=function(){n.destroyComponent()},this.refresh=function(){t.$apply(n)},n.shouldShowBtnMore=function(){return n.currentMenuButtons.length>0},n.shouldDisableSelect=function(e){return!!(!0===e.isDisabled||"function"==typeof e.isDisabled&&e.isDisabled())},n.shouldShowSelect=function(e){return!!(!n.locked&&(void 0===e.show||"boolean"==typeof e.show&&!1!==e.show||"function"==typeof e.show&&e.show(e.value)))},n.buttonAction=function(e,t){e.originalEvent.preventDefault(),t.action.call(n.toolbar)},n.buttonIsDisabled=function(e){switch(typeof e.isDisabled){case"function":return!!e.isDisabled.call(n.toolbar);case"boolean":return e.isDisabled;default:return!1}},n.isButtonSelected=function(e){var t=e.items,n=D(e._componentId)||{};return!!(!t&&e._componentId&&e.hasOwnProperty("value")&&n.value===e.value)},n.menuAction=function(t){t.originalEvent.preventDefault();var i="DIV"===t.target.tagName?e(t.target):e(t.target).parents("div"),r=i.scope(),o=i.attr("tid");if(r.button&&r.button.items)a=r,_(r.button.items);else if("sel-toolbar-menu-back"===o)w();else{a&&w();var s=r.button.action||a&&a.action;if(!s)throw Error("selection-toolbar: menu button has no action function defined");s.call(n.toolbar,r.button),n.toolbar.showMenu=!n.toolbar.showMenu}},n.toggleShowMenu=function(e){e.originalEvent.preventDefault(),n.toolbar.showMenu=!n.toolbar.showMenu},n.toggleLasso=function(){n.lassoEnabled=!n.lassoEnabled,n.toolbar.toggleLasso(n.lassoEnabled)},n.toggleLock=function(t){e(t.target).closest(".sel-toolbar-list-item-close").length>0||(t.originalEvent.preventDefault(),t.stopPropagation(),n.toolbar.backendApi.isLocked()?(n.toolbar.selectionsApi.selectionsMade=!0,n.toolbar.backendApi.unlock()):n.toolbar.backendApi.lock())},n.$watch("toolbar.backendApi.isLocked()",function(e){void 0!==e&&M(!!e)}),n.$watch("toolbar.position",function(e){e&&(n.toolbar.style=e,A.resolve(),M(!!n.toolbar.backendApi.isLocked&&n.toolbar.backendApi.isLocked()))}),n.$watch("toolbar.menuMaxHeight",function(e){e&&(n.toolbar.menuStyle={maxHeight:e})}),n.$watch("options.lassoEnabled",function(e){n.lassoEnabled=e})}]}}),define("objects/listbox-popover/listbox-popover",["core.utils/deferred","core.utils/resize"],function(e,t){return{template:null,controller:["$scope","$element","$timeout",function(n,i,r){function o(){r(function(){n.destroyComponent(),i.remove()}),t.off("start.listbox-popover-error",o)}var s=this;n.input.selectionsActivated=function(){},n.input.selectionsDeactivated=function(){},s.close=function(){o()};var a=n.input.onPopoverClose,l=null;n.closingDeferred.promise.then(function(e){l&&l(),a(e),o()}),e.all({object:n.input.getVisualization(),width:r(function(){return i.find(".toolbar-wrapper").outerWidth()})}).then(function(e){var i=e.object,r=e.width;i.getSelectionToolbar().then(function(e){n.toolbar=e,n.toolbar.showLock=n.input.options.showLock,n.toolbar.position={width:r},i.activateSelections()}),i.loaded.then(function(){i.ext.hasError(i)&&t.on("start.listbox-popover-error",o)}),i.selectionsApi.watchActivated(function(){n.input.selectionsActivated()}),i.selectionsApi.watchDeactivated(function(){n.input.selectionsDeactivated(),o()}),l=function(){i.selectionsApi.confirm()}})}]}}),define("text!objects/listbox-popover/listbox-popover.ng.html",[],function(){return'<lui-popover\n\t\tclass="qv-listbox-popover"\n\t\tstyle="min-width: 200px;width: 234px;height: 332px"\n\t\ton-close-view="closeView(event)"\n\t\tqva-outside-ignore-for="{{input.qvaOutsideIgnoreFor}}"\n\t\tqva-mouse-wheel-outside="close()">\n\t<lui-popover-body style="height: 332px" class="lui-nopad">\n\t\t<div class="toolbar-wrapper"\n\t\t\t qva-include-selection-toolbar\n\t\t\t component="input.selectionToolbarComponent"\n\t\t\t toolbar="toolbar"\n\t\t\t options="input.options"></div>\n\t\t<div class="listbox-wrapper">\n\t\t\t<qv-object object="object" model="input.model" options="input.options"></qv-object>\n\t\t</div>\n\t</lui-popover-body>\n</lui-popover>\n'}),define("objects.utils/layout",[],function(){"use strict";var e={SPARK:1,XSMALL:3,SMALL:7,MEDIUM:15,FULL:31},t=[[550,450,e.FULL],[400,220,e.MEDIUM],[300,150,e.SMALL],[150,75,e.XSMALL],[0,0,e.SPARK]],n=[[450,e.FULL],[220,e.MEDIUM],[150,e.SMALL],[75,e.XSMALL],[0,e.SPARK]],i=[[550,e.FULL],[400,e.MEDIUM],[300,e.SMALL],[150,e.XSMALL],[0,e.SPARK]],r=t.length;return{LayoutMode:e,getLayoutMode:function(n,i){var o;for(o=0;o<r;++o)if(n>=t[o][0]&&i>=t[o][1])return t[o][2];return e.SPARK},getLayoutModeKey:function(t){var n=Object.keys(e).filter(function(n){return e[n]===t})[0];return n&&n.toLowerCase()||""},getHorizontalLayoutMode:function(t){var n;for(n=0;n<r;++n)if(t>=i[n][0])return i[n][1];return e.SPARK},getVerticalLayoutMode:function(t){var i;for(i=0;i<r;++i)if(t>=n[i][0])return n[i][1];return e.SPARK}}}),define("text!objects/object.ng.html",[],function(){return'<div class="qv-object-wrapper" ng-class="wrapperClassList" x-ms-format-detection="none">\n\n\t<article class="qv-object qvt-visualization" ng-class="classList" tid="{{objectClass}}">\n\t\t<div class="qv-inner-object" ng-style="styles.backgroundColor">\n\t\t\t<qv-rain ng-if="object.throbberApi.isVisible" show="object.throbberApi.isVisible" resize="object.throbberApi.watchResize"></qv-rain>\n\t\t\t<div class="retry-overlay" ng-if="object.throbberApi.isQueryCanceled">\n\t\t\t\t<ul class="cancelled-list">\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="retry-text" q-translation="Object.Cancelled"></div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<button class="retry-button lui-button" qva-activate="retry()" q-translation="Dialog.Button.Retry" tid="retry-calculations"></button>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t\t<div class="cancel-overlay" ng-if="object.throbberApi.isLongRunningQuery">\n\t\t\t\t<button class="cancel-button lui-button" ng-if="!object.throbberApi.isQueryCanceled" qva-activate="cancel()"\n\t\t\t\t\t\tq-translation="Common.Cancel" tid="cancel-calculations"></button>\n\t\t\t</div>\n\n\t\t<header qva-direction x-dir-setting="{{options.direction}}" ng-show="object.hasFrame" class="qv-object-header" ng-class="{\'thin\' : !object.showTitles || ( layout.title === \'\' && layout.subtitle === \'\' && !object._inEditState )}">\n\t\t\t<h1 ng-show="object.showTitles" qva-direction x-dir-setting="{{options.direction}}" ng-attr-title="{{layout.title}}" class="qv-object-title qvt-visualization-title" qva-activate="titleClicked();" ng-style="styles.title">\n\t\t\t\t\t<a ng-if="options.showSearch && object.isInteractive && !object.backendApi.isLocked() && !object._inEditState" q-title-translation="Common.Search" class="qv-object-search lui-icon lui-icon--search"\n\t\t\t\t\t   qva-activate="options.showSearch && options.search.toggle()"></a>\n\t\t\t\t<a ng-if="options.showSearch && object.isInteractive && object.backendApi.isLocked()" class="qv-object-locked lui-icon lui-icon--lock"\n\t\t\t\t   qva-activate="titleClicked()"></a>\n\t\t\t\t<span ng-if="options.showSearch && object.backendApi.isDrillDown()" class="lui-icon lui-icon--select-alternative" q-title-translation="Tooltip.dimensions.drilldown"></span>\n\t\t\t\t<div ng-if="options.highlightTitle && (!object._inEditState || object._inEditState && object.isReadonly)" qve-highlight text="{{layout.title}}" query="options.highlightQuery" class="qv-object-title-text" qva-direction x-dir-setting="{{options.direction}}" x-dir-text="{{layout.title}}"></div>\n\t\t\t\t<div ng-if="!options.highlightTitle && (!object._inEditState || object._inEditState && object.isReadonly)" class="qv-object-title-text" qva-direction x-dir-setting="{{options.direction}}" x-dir-text="{{layout.title}}">{{layout.title}}</div>\n\t\t\t\t<div ng-if="options.showDisclaimerStar && !!layout.title && !object._inEditState" class="disclaimer qv-object-title-text">*</div>\n\t\t\t\t<div ng-if="object._inEditState && !object.isReadonly" qv-inline-title-edit x-dir-setting="{{options.direction}}" x-model="model" x-property-path="title" x-layout-path="title"\n\t\t\t\t\t x-empty-translation="Object.AddTitle" class="qv-object-title-edit" qva-direction x-dir-setting="{{options.direction}}"></div>\n\t\t\t\t</h1>\n\n\t\t\t<h2 ng-if="!!layout.subtitle && object.showTitles" ng-style="styles.subTitle" qva-direction x-dir-setting="{{options.direction}}" x-dir-text="{{layout.subtitle}}" ng-attr-title="{{layout.subtitle}}" ng-show="!!layout.subtitle" class="qv-object-subtitle qvt-visualization-subtitle">{{layout.subtitle}}</h2>\n\t\t\t</header>\n\n\t\t\t<div class="qv-object-content-container">\n\t\t\t\t<div class="qv-object-content" qv-object-content component="object.content" options="options" object="object" backend-api="object.backendApi" layout="layout"\n\t\t\t\t ext="object.ext" selections-api="object.selectionsApi" tooltip-api="object.tooltipApi" throbber-api="object.throbberApi" on-init="onInit">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="qv-footer-wrapper" ng-show="object.hasFrame && object.showTitles && !!layout.footnote" ng-style="styles.footer">\n\t\t\t<footer qva-direction x-dir-setting="{{options.direction}}" x-dir-text="{{layout.footnote}}" ng-attr-title="{{layout.footnote}}" ng-if="object.hasFrame && object.showTitles && !!layout.footnote" class="qv-object-footnote qvt-visualization-footnote">{{layout.footnote}}</footer>\n\t\t</div>\n\n\n\t<div qva-direction x-dir-setting="{{options.direction}}" class="qv-object-nav" ng-class="{\'zero-top\' : options.isZoomed, \'visible\' : navMenu.visible, \'active\': options.isActive, \'inline\' : thinHeader}">\n\t\t\t<a ng-repeat="menuItem in navMenu.items"\n\t\t\t   ng-if="menuItem.isVisible()"\n\t\t\t   ng-class="[menuItem.cssClasses, menuItem.dynamicCssClasses()]"\n\t\t\t   qva-activate="menuItem.action()"\n\t\t\t   q-title-translation="{{menuItem.translation}}"\n\t\t\t   tid="{{menuItem.tid}}"></a>\n\t\t</div>\n\n\t</article>\n\n\t<qv-soft-property-panel object="object" ng-if="options.isZoomed && object.hasSoftProperties" can-save-soft-properties="options.canSaveSoftProperties" ng-hide="!object.showExploreMenu"></qv-soft-property-panel>\n</div>\n'}),define("text!objects.requirements/requirements.ng.html",[],function(){return'<div qv-requirements class="requirements-wrapper" ng-show="show" ng-class="{\'incomplete\': !showAdd}">\n\t<div class="requirements">\n\t\t<h2 class="header">\n\t\t\t<i class="object-icon  lui-icon  lui-icon--{{iconName}}"></i>\n\t\t</h2>\n\t<p class="incomplete-text" ng-if="!showAdd" q-translation="Visualization.Requirements.IncompleteVisualization"></p>\n\t\t\x3c!-- finished dimensions --\x3e\n\t<ul ng-if="showAdd && finishedDimensions.length">\n\t\t<li ng-repeat="dimension in finishedDimensions" class="item" ng-class="{ finished: !dimension.invalid, invalid: dimension.invalid }"\n\t\t\ttid="{{ dimension.invalid ? \'invalid-dimension\' : \'added-dimension\'}}">\n\t\t\t<span class="text" ng-class="{ \'no-icon\': !canRemoveDim }" title="{{dimension.title}}">{{dimension.title}}</span>\n\t\t\t<i ng-if="canRemoveDim" class="lui-icon lui-icon--remove" qva-activate="removeDimension($index)" q-title-translation="Common.Delete"></i>\n\t\t\t</li>\n\t\t</ul>\n\t\t\x3c!-- unfinished dimensions --\x3e\n\t<ul ng-if="showAdd && unfinishedDimensions.length">\n\t\t<li ng-repeat="d in unfinishedDimensions" class="item missing" tid="missing-dimension">\n\t\t\t<button class="add-button lui-button"  ng-class="{ \'lui-active\': d.active }" ng-click="showAddDimension($event,d)"\n\t\t\t\t\t tid="add-dimension">{{addDimensionLabel}}</button>\n\t\t\t</li>\n\t\t</ul>\n\t\t\x3c!-- finished measures --\x3e\n\t<ul ng-if="showAdd && finishedMeasures.length">\n\t\t<li ng-repeat="measure in finishedMeasures" class="item" ng-class="{ finished: !measure.invalid, invalid: measure.invalid }"\n\t\t\ttid="{{ measure.invalid ? \'invalid-measure\' : \'added-measure\'}}">\n\t\t\t<span class="text" title="{{measure.title}}">{{measure.title}}</span>\n\t\t\t<i class="lui-icon lui-icon--remove" qva-activate="removeMeasure($index)" q-title-translation="Common.Delete"></i>\n\t\t\t</li>\n\t\t</ul>\n\t\t\x3c!-- unfinished measures --\x3e\n\t<ul ng-if="showAdd && unfinishedMeasures.length">\n\t\t<li ng-repeat="m in unfinishedMeasures" class="item missing" tid="missing-measure">\n\t\t\t<button class="add-button lui-button"  ng-class="{ \'lui-active\': m.active }" ng-click="showAddMeasure($event,m)"\n\t\t\t\t\tq-translation="Visualization.Requirements.AddMeasure" tid="add-measure"></button>\n\t\t\t</li>\n\t\t</ul>\n\t</div>\n</div>\n'}),define("text!objects.add-popovers/add-dimension-popover.ng.html",[],function(){return'<lui-popover style="min-width: 200px;width: 230px;" align-to="alignTo" position="position" collision="\'flipfit\'" on-close-view="closeAddPopover(event)" qva-outside-ignore-for="{{qvaOutsideIgnoreFor}}">\n\t<object-add-typeahead>\n\t\t<lui-popover-header>\n\t\t\t<div class="lui-input-group">\n\t\t\t\t<input class="lui-input  lui-input-group__item  lui-input-group__input" type="text" name="new-dimension" autocomplete="off" ng-model="search.term" tid="add-dimension-input" qva-focus="autoFocus"\n\t\t\t\t\t   object-add-typeahead-input on-escape="onEscape($event)" on-enter="onEnter($event)" maxlength="255"/>\n\t\t\t\t<button ng-if="allowExpressionEditor !== false" class="lui-button  lui-input-group__item  lui-input-group__button" qva-activate="close()"\n\t\t\t\t\t\tpp-expression-editor="search.term" pp-expression-editor-on-apply="addFieldDimension({value:value})" expression-type="dimension"\n\t\t\t\t\t\tq-title-translation="Tooltip.OpenExpressionEditor">\n\t\t\t\t\t<span class="lui-button__icon  lui-icon  lui-icon--expression  edit-expression"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</lui-popover-header>\n\t\t<div class="object-add-popover-content" object-add-typeahead-menu>\n\t\t\t<ul class="lui-list">\n\t\t\t\t<li class="lui-list__item lui-list__action" ng-repeat="dimension in activeDimensions" tid="dimension-item"\n\t\t\t\t\tobject-add-typeahead-item="dimension" on-select="addActiveDimension(dimension)">\n\t\t\t\t\t<span qve-highlight text="{{dimension.translatedTitle}}" title="{{dimension.translatedTitle}}" query="search.term" class="lui-list__text lui-list__text--ellipsis"></span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t\t<div class="object-add-popover-list-header" ng-if="dimensions.length" q-translation="Common.Dimensions"></div>\n\t\t\t<ul class="lui-list">\n\t\t\t\t<li class="lui-list__item lui-list__action" ng-repeat="dimension in dimensions" tid="dimension-item"\n\t\t\t\t\tobject-add-typeahead-item="dimension" on-select="addLibraryDimension(dimension)">\n\t\t\t\t\t<span ng-if="dimension.isDrillDown" class="lui-icon lui-icon--select-alternative lui-list__aside" q-title-translation="Tooltip.dimensions.drilldown"></span>\n\t\t\t\t\t<span qve-highlight text="{{dimension.label}}" title="{{dimension.label}}" query="search.term" class="lui-list__text lui-list__text--ellipsis"></span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t\t<div class="object-add-popover-list-header" ng-if="fields.length" q-translation="Common.Fields"></div>\n\t\t\t<ul class="lui-list">\n\t\t\t\t<li class="lui-list__item lui-list__action" ng-repeat="field in fields" tid="field-item"\n\t\t\t\t\tobject-add-typeahead-item="field" on-select="addFieldDimension(field)"\n\t\t\t\t\tng-class="{\'derived-field\': (field.isDerived && search.term === \'\')}">\n\t\t\t\t\t<i ng-if="isDirectDiscoveryField( field )" class="lui-icon  lui-icon--direct-discovery  lui-list__aside" q-title-translation="{{ getDirectDiscoveryTypeTranslationKey( field.qTags ) }}"></i>\n\t\t\t\t\t<span ng-if="field.isDateField" class="lui-icon lui-list__aside  lui-icon--calendar"></span>\n\t\t\t\t\t<span ng-if="field.isGeoField" class="lui-icon lui-list__aside  lui-icon--map"></span>\n\t\t\t\t\t<span qve-highlight text="{{getFieldDisplayName(field)}}" title="{{field.toolTip}}" query="search.term" class="lui-list__text lui-list__text--ellipsis"></span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t\t<div class="object-add-popover-nohits" ng-if="!dimensions.length && !fields.length" q-translation="Toolbox.Search.Nohits"></div>\n\t\t</div>\n\t</object-add-typeahead>\n</lui-popover>\n'}),define("text!objects.add-popovers/object-add-typeahead.ng.html",[],function(){return"<div ng-transclude></div>"}),define("general.services/aligner/aligner",[],function(){function e(e){this.container=e.container,this.body=e.body,this.alignAgainst=e.alignAgainst}return e.prototype.showTranscluded=function(e){e(function(e){this.container.appendTo(this.body).append(e)}.bind(this))},e.prototype.showContent=function(e){this.container.appendTo(this.body).append(e)},e.prototype.update=function(){var e=this.alignAgainst.offset();this.container.css({top:e.top,left:e.left,width:this.alignAgainst.width(),height:this.alignAgainst.height(),zIndex:1021})},e.prototype.hide=function(){this.container.remove()},e}),define("objects.add-popovers/object-add-typeahead",["qvangular","text!./object-add-typeahead.ng.html","general.services/aligner/aligner"],function(e,t){e.directive("objectAddTypeahead",[function(){return{template:t,scope:{},transclude:!0,replace:!0,restrict:"E",controller:["$scope",function(e){function t(){var t=e.menu;if(e.activeItem){var n=e.activeItem,i=n.getPosition();i.top<0?t.setScrollTop(n.getOffsetTop()):i.top+n.getHeight()>t.getHeight()&&n.scrollIntoView(!1)}else t.setScrollTop(0)}var n=this;e.items=[],this.activate=function(t){e.activeItem=t},this.nextItem=function(i){var r=e.items.indexOf(e.activeItem);void 0!==i&&(r=(r+i)%e.items.length),r===e.items.length-1?n.activate(null):-1===r?n.activate(e.items[0]):n.activate(e.items[r+1]),t()},this.prevItem=function(i){var r=e.items.indexOf(e.activeItem);void 0!==i&&(r=(r-i+e.items.length)%e.items.length),0===r?n.activate(null):-1===r?n.activate(e.items[e.items.length-1]):n.activate(e.items[r-1]),t()},this.getActiveItem=function(){return e.activeItem},this.selectActiveItem=function(){e.activeItem&&e.activeItem.select()},this.select=function(t){e.select({item:t}),e.activeItem=null},this.setMenu=function(t){e.menu=t},this.addItem=function(t){e.items.push(t)},this.removeItem=function(t){var n=e.items.indexOf(t);n>=0&&e.items.splice(n,1)}}]}}]),e.directive("objectAddTypeaheadInput",[function(){return{require:["^objectAddTypeahead","ngModel"],link:function(e,t,n,i){var r=i[0],o=i[1];t.on("keydown",function(t){t.stopPropagation(),13===t.which||9===t.which?(t.preventDefault(),r.getActiveItem()?e.$apply(function(){r.selectActiveItem()}):e.$apply(function(){e.$eval(n.onEnter,{$event:t})})):33===t.which?(t.preventDefault(),e.$apply(function(){r.prevItem(10)})):34===t.which?(t.preventDefault(),e.$apply(function(){r.nextItem(10)})):40===t.which?(t.preventDefault(),e.$apply(function(){r.nextItem()})):38===t.which?(t.preventDefault(),e.$apply(function(){r.prevItem()})):27===t.which&&(t.preventDefault(),e.$apply(function(){e.$eval(n.onEscape,{$event:t})}))}),e.$watch(r.getActiveItem,function(e){e?e.item.label&&t.val(e.item.label):t.val(o.$modelValue)}),e.$watch(o.$modelValue,function(e){e||r.activate(null)})}}}]),e.directive("objectAddTypeaheadMenu",[function(){return{require:"^objectAddTypeahead",link:function(e,t,n,i){e.controller=i,i.setMenu({getHeight:function(){return t.height()},setScrollTop:function(e){t[0].scrollTop=e}})}}}]),e.directive("objectAddTypeaheadItem",[function(){return{require:"^objectAddTypeahead",link:function(e,t,n,i){function r(){e.$eval(n.onSelect,{item:o})}var o=e.$eval(n.objectAddTypeaheadItem),s={item:o,getOffsetTop:function(){return t[0].offsetTop},scrollIntoView:function(e){t[0].scrollIntoView(e)},getPosition:function(){return t.position()},getHeight:function(){return t.height()},select:function(){r()}};i.addItem(s),e.$on("$destroy",function(){i.removeItem(s)}),e.$watch(function(){var e=i.getActiveItem();return!!e&&e.item===o},function(e){e?t.addClass("object-add-typeahead-active"):t.removeClass("object-add-typeahead-active")}),t.on("mouseenter",function(){t.addClass("object-add-typeahead-hover")}),t.on("mouseleave",function(){t.removeClass("object-add-typeahead-hover")}),t.on("qv-activate",function(t){t.preventDefault(),e.$apply(function(){r()})})}}}])}),define("objects.add-popovers/add-dimension-popover",["core.utils/deferred","general.utils/string-normalization","general.utils/array-util","general.utils/support","objects.utils/data-properties/library-utils","text!objects.add-popovers/add-dimension-popover.ng.html","client.assets/tab-contents/fields/assets-directdiscovery-service","client.assets/tab-contents/fields/derived-field-formatter-service","translator","objects.add-popovers/object-add-typeahead"],function(e,t,n,i,r,o,s,a,l){"use strict";function c(e,n){return""===n?e:e.filter(function(e){return void 0!==e.value&&t.string(e.value.toLowerCase()).indexOf(t.string(n.toLowerCase()))>-1})}var u=100;return{template:o,controller:["$scope",function(t){t.search={term:""},t.isDirectDiscoveryField=s.isDirectDiscoveryField,t.getDirectDiscoveryTypeTranslationKey=s.getTypeTranslationKey,t.autoFocus=i.treatAsDesktop(),t.position||(t.position="right"),t.onEscape=function(e){""!==t.search.term?(e.stopPropagation(),t.search.term=""):t.close()},t.onEnter=function(e){""!==t.search.term?(e.stopPropagation(),t.addFieldDimension({value:t.search.term})):t.close()},t.getFieldDisplayName=function(e){return""===t.search.term?e.label:a.trimAutoCalendarName(e.value)};var o=null;t.$watch("search.term",function(i){function s(){var e=c(o.fields,i),r=c(o.dimensions,i),s=c(o.activeDimensions,i);r.length+s.length>u?(r=n.limit(r,Math.max(u-s.length,0)),e=[]):e.length+r.length+s.length>u&&(e=n.limit(e,Math.max(u-r.length-s.length,0))),t.fields=e,t.dimensions=r,t.activeDimensions=s}o?s():e.all({fields:r.getSortedFields(t.app),dimensions:r.getSortedDimensions(t.app)}).then(function(e){var n=e.fields.map(function(e){var t=e.isDerived&&""===i?e.qName.substring(e.qName.lastIndexOf(".")+1,e.qName.length):e.qName;return{toolTip:e.qName,label:t,value:e.qName,trimmedValue:e.displayName,qTags:e.qTags,isDerived:e.isDerived,isDateField:e.isDateField,isGeoField:e.isGeoField,activeDimensionIndex:-1}}),r=e.dimensions.map(function(e){return{label:e.qData.title,value:e.qData.title,libraryId:e.qInfo.qId,isDrillDown:"H"===e.qData.grouping,activeDimensionIndex:-1}}),a=[];t.activeDimensions&&t.activeDimensions.length&&t.activeDimensions.forEach(function(e,t){var i={};e.qLibraryId?(r.forEach(function(t){t.libraryId===e.qLibraryId&&(i.label=t.label,i.value=t.value)}),i.libraryId=e.libraryId,console.log(e.libraryId)):n.forEach(function(t){t.value===e.qDef.qFieldDefs[0]&&(i.label=t.label,i.value=t.value)}),i.translatedTitle=l.get("properties.colorBy.currentDimension",t+1),i.activeDimensionIndex=t,a.push(i)}),o={fields:n,dimensions:r,activeDimensions:a},s()})})}],scope:{alignTo:"=",app:"=",addFieldDimension:"=",addLibraryDimension:"=",qvaOutsideIgnoreFor:"=",close:"=",position:"=",allowExpressionEditor:"@",selectColorByDimIndex:"="}}}),define("text!objects.add-popovers/add-measure-popover.ng.html",[],function(){return'<lui-popover class="add-popover-wrapper" style="min-width: 200px;width: 230px;" align-to="alignTo" position="position" collision="\'flipfit\'" on-close-view="closeAddPopover(event)" qva-outside-ignore-for="{{qvaOutsideIgnoreFor}}">\n\t<div ng-show="!step2">\n\t\t<object-add-typeahead>\n\t\t\t<lui-popover-header>\n\t\t\t\t\t<div class="lui-input-group">\n\t\t\t\t\t\t<input class="lui-input  lui-input-group__item  lui-input-group__input" type="text" name="new-measure" autocomplete="off" ng-model="search.term" tid="add-measure-input" qva-focus="autoFocus"\n\t\t\t\t\t\t\t   maxlength="255" object-add-typeahead-input on-escape="onEscape($event)" on-enter="onEnter($event)"/>\n\n\t\t\t\t\t\t<button ng-if="allowExpressionEditor !== false" class="lui-button  lui-input-group__item  lui-input-group__button" qva-activate="close()"\n\t\t\t\t\t\t\t\tpp-expression-editor="search.term" pp-expression-editor-on-apply="addExpressionMeasure({value:value})" expression-type="measure"\n\t\t\t\t\t\t\t\tq-title-translation="Tooltip.OpenExpressionEditor">\n\t\t\t\t\t\t\t<span class="lui-button__icon  lui-icon  lui-icon--expression  edit-expression"></span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t</lui-popover-header>\n\t\t\t<div class="object-add-popover-content" object-add-typeahead-menu>\n\t\t\t\t<ul class="lui-list">\n\t\t\t\t\t<li class="lui-list__item lui-list__action" ng-repeat="measure in activeMeasures" tid="measure-item"\n\t\t\t\t\t\tobject-add-typeahead-item="measure" on-select="addActiveMeasure(measure)">\n\t\t\t\t\t\t<span qve-highlight text="{{measure.translatedTitle}}" title="{{measure.translatedTitle}}" query="search.term" class="lui-list__text lui-list__text--ellipsis"></span>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t\t<div class="object-add-popover-list-header" ng-if="measures.length"  q-translation="Common.Measures"></div>\n\t\t\t\t<ul class="lui-list">\n\t\t\t\t\t<li class="lui-list__item lui-list__action" ng-repeat="measure in measures" tid="measure-item"\n\t\t\t\t\t\tobject-add-typeahead-item="measure" on-select="addLibraryMeasure(measure)">\n\t\t\t\t\t\t<span qve-highlight text="{{measure.value}}" title="{{measure.value}}" query="search.term" class="lui-list__text lui-list__text--ellipsis"></span>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t\t<div class="object-add-popover-list-header" ng-if="fields.length" q-translation="Visualization.Requirements.FromField"></div>\n\t\t\t\t<ul class="lui-list">\n\t\t\t\t\t<li class="lui-list__item lui-list__action" ng-repeat="field in fields" tid="field-item"\n\t\t\t\t\t\tobject-add-typeahead-item="field" on-select="showFromField(field)"\n\t\t\t\t\t\tng-class="{\'derived-field\': (field.isDerived && search.term === \'\')}"\t>\n\t\t\t\t\t\t<i ng-if="isDirectDiscoveryField( field )" class="lui-icon  lui-icon--direct-discovery  lui-list__aside" q-title-translation="{{ getDirectDiscoveryTypeTranslationKey( field.qTags ) }}"></i>\n\t\t\t\t\t\t<span ng-if="field.isGeoField" class="lui-icon lui-icon--map lui-list__aside"></span>\n\t\t\t\t\t\t<span ng-if="field.isDateField" class="lui-icon lui-icon--calendar lui-list__aside"></span>\n\t\t\t\t\t\t<span qve-highlight text="{{getFieldDisplayName(field)}}" title="{{field.toolTip}}" query="search.term" class="lui-list__text lui-list__text--ellipsis"></span>\n\t\t\t\t\t\t<i class="object-add-popover-toogle-step2-icon  lui-list__aside lui-icon  lui-icon--triangle-right"></i>\n\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t\t<div class="object-add-popover-nohits" ng-if="!measures.length && !fields.length" q-translation="Toolbox.Search.Nohits"></div>\n\t\t\t</div>\n\t\t</object-add-typeahead>\n\t</div>\n\t<div class="object-add-popover back" ng-show="step2">\n\t\t<div class="object-add-popover-header">\n\t\t\t<div qva-activate="goBack($event);">\n\t\t\t\t<i class="object-add-popover-back-icon  lui-icon  lui-icon--triangle-left"></i>\n\t\t\t\t<span q-translation="Visualization.Requirements.Back"></span>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="object-add-popover-content">\n\t\t\t<div class="object-add-popover-list-header" q-translation="Visualization.Requirements.Aggregation"></div>\n\t\t\t<ul class="lui-list">\n\t\t\t\t<li class="lui-list__item lui-list__action" ng-repeat="suggestion in fieldSuggestions" qva-activate="addFromField(suggestion)" tid="from-field-item">\n\t\t\t\t\t<span class="lui-list__text lui-list__text--ellipsis" title="{{suggestion.aggregation}}({{suggestion.field}})">{{suggestion.aggregation}}({{suggestion.field}})</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t</div>\n</lui-popover>\n'}),define("objects.add-popovers/add-measure-popover",["core.utils/deferred","general.utils/string-normalization","util","general.utils/array-util","general.utils/support","objects.utils/data-properties/library-utils","text!objects.add-popovers/add-measure-popover.ng.html","client.assets/tab-contents/fields/assets-directdiscovery-service","client.assets/tab-contents/fields/derived-field-formatter-service","translator","objects.add-popovers/object-add-typeahead"],function(e,t,n,i,r,o,s,a,l,c){"use strict";function u(e,n){return""===n?e:e.filter(function(e){return void 0!==e.value&&t.string(e.value.toLowerCase()).indexOf(t.string(n.toLowerCase()))>-1})}var h=100;return{template:s,controller:["$scope",function(t){t.search={term:""},t.isDirectDiscoveryField=a.isDirectDiscoveryField,t.getDirectDiscoveryTypeTranslationKey=a.getTypeTranslationKey,t.autoFocus=r.treatAsDesktop(),t.position||(t.position="right"),t.onEscape=function(e){""!==t.search.term?(e.stopPropagation(),t.search.term=""):t.close()},t.onEnter=function(e){""!==t.search.term?(e.stopPropagation(),t.addExpressionMeasure({value:t.search.term})):t.close()},t.showFromField=function(e){t.currentField=e,t.step2=!0},t.goBack=function(e){e.preventDefault(),t.currentField=null,t.step2=!1},t.$watch("currentField",function(e){t.fieldSuggestions=e?["Sum","Count","Avg","Min","Max"].map(function(e){return{aggregation:e,field:n.escapeField(t.currentField.value)}}):[]}),t.addFromField=function(e){var n=e.aggregation+"("+e.field+")";t.addExpressionMeasure({value:n})},t.getFieldDisplayName=function(e){return""===t.search.term?e.label:l.trimAutoCalendarName(e.value)};var s=null;t.$watch("search.term",function(n){function r(){var e=u(s.measures,n),r=u(s.fields,n),o=u(s.activeMeasures,n);e.length+o.length>h?(e=i.limit(e,Math.max(h-o.length,0)),r=[]):e.length+o.length+r.length>h&&(r=i.limit(r,Math.max(h-e.length-o.length,0))),t.fields=r,t.measures=e,t.activeMeasures=o}s?r():e.all({fields:o.getSortedFields(t.app),measures:o.getSortedMeasures(t.app),activeMeasures:t.activeMeasures}).then(function(e){var t=e.fields.map(function(e){var t=e.isDerived&&""===n?e.qName.substring(e.qName.lastIndexOf(".")+1,e.qName.length):e.qName;return{toolTip:e.qName,value:e.qName,trimmedValue:e.displayName,label:t,field:e.qName,qTags:e.qTags,isDerived:e.isDerived,isDateField:e.isDateField,isGeoField:e.isGeoField,activeMeasureIndex:-1}}),i=e.measures.map(function(e){return{value:e.qData.title,label:e.qData.title,libraryId:e.qInfo.qId,activeMeasureIndex:-1}}),o=[];e.activeMeasures&&e.activeMeasures.length&&(o=e.activeMeasures.map(function(e,n){var r={};return e.qLibraryId?i.forEach(function(t){t.libraryId===e.qLibraryId&&(r.value=t.value,r.label=t.label),r.libraryId=e.libraryId}):t.forEach(function(t){t.value===e.qDef.qDef&&(r.label=t.label,r.value=t.value)}),r.translatedTitle=c.get("properties.colorBy.currentMeasure",n+1),r.activeMeasureIndex=n,r})),s={fields:t,measures:i,activeMeasures:o},r()})})}],scope:{alignTo:"=",app:"=",addExpressionMeasure:"=",addLibraryMeasure:"=",addActiveMeasure:"=",close:"=",qvaOutsideIgnoreFor:"=",position:"=",allowExpressionEditor:"@"}}}),define("text!objects.error-handling/error-info-popup.ng.html",[],function(){return'<immidiate-contextual align-to="alignTo" width="200" position="\'top\'" collision="\'flipfit\'" class="qui-immidiateContextual" on-close-view="onClose(event)">\n\t<div class="object-error-popup">\n\t\t\x3c!--<div class="object-error-title" q-translation="{{error.title}}"></div>--\x3e\n\t\t<div class="object-error-message">{{error.message}}</div>\n\t</div>\n</immidiate-contextual>'}),define("objects.error-handling/error-info-popup",["text!objects.error-handling/error-info-popup.ng.html","core.utils/resize"],function(e,t){"use strict";return{template:e,controller:["$scope",function(e){function n(){e.onClose()}e.$on("$destroy",function(){t.off("start",n)}),t.on("start",n)}]}}),define("text!objects.error-handling/error.ng.html",[],function(){return'<div qv-errorhandler class="object-error" ng-class="error.class" tid="object.Error">\n\t<div class="object-error-content">\n\t\t<div class="object-error-title">\n\t\t\t<span>{{error.title}}</span>\n\t\t\t<i class="object-error-more icon-info" qva-activate="showMore($event)"></i>\n\t\t</div>\n\t\t<div ng-if="error.message" class="object-error-message">{{error.message}}</div>\n\t</div>\n</div>\n'}),define("objects/adapters/calc-cond-adapter",["util"],function(e){"use strict";return{getLayoutMsg:function(e){return e.customErrorMessage&&e.customErrorMessage.calcCond||e.qCalcCondMsg},getPropCondition:function(t,n){return e.getValue(t,n||"qCalcCond.qv")||e.getValue(t,"qCalcCondition.qCond.qv")||""},setPropCondition:function(t,n,i){e.setValue(t,i||"qCalcCond.qv",n),e.setValue(t,"qCalcCondition.qCond.qv",n)},getPropMessage:function(t){var n=e.getValue(t,"customErrorMessage.calcCond"),i=e.getValue(t,"qCalcCondition.qMsg.qv");return n||i||""},setPropMessage:function(t,n){e.setValue(t,"customErrorMessage.calcCond","="!==n[0]?n:""),e.setValue(t,"qCalcCondition.qMsg.qv",n)}}}),define("objects.error-handling/error-handler",["angular","touche","translator","core.utils/deferred","./error-info-popup","text!./error.ng.html","objects.extension/base-controller","objects.error-handling/error-translation","autogenerated/qix/engine-enums","objects/adapters/calc-cond-adapter"],function(e,t,n,i,r,o,s,a,l,c){"use strict";function u(e){return e.qErrorCode===l.NxLocalizedErrorCode.LOCERR_CALC_EVAL_CONDITION_FAILED}function h(e,t){var n={holder:null,type:""},i=t&&e[t]?e[t].qHyperCube:e.qHyperCube;return i&&i.qError?(n.holder=i,n.errorTranslationFunc=a.getHyperCubeError):e.layers&&e.layers.length&&e.layers[0].qHyperCube?(e.layers[0].qHyperCube.qError?n.holder=e.layers[0].qHyperCube:e.layers[0].geodata.qHyperCube.qError&&(n.holder=e.layers[0].geodata.qHyperCube),n.errorTranslationFunc=a.getHyperCubeError):e.qListObject&&e.qListObject.qError?(n.holder=e.qListObject,n.errorTranslationFunc=a.getListObjectError):e.qListObject.qDimensionInfo&&e.qListObject.qDimensionInfo.qError.qErrorCode&&(n.holder=e.qListObject.qDimensionInfo,n.errorTranslationFunc=a.getDimensionError),n}function d(e){switch(e.qError.qErrorCode){case l.NxLocalizedErrorCode.LOCERR_CALC_EVAL_CONDITION_FAILED:return c.getLayoutMsg(e)||""}}var p=s.extend({$scope:null,init:function(n){this.$scope=n,n.hasSoftError=!1,n.hasHardError=!1,n.showMore=function(i){var o=e.element("<div>").appendTo("body");o.showComponent(r,{alignTo:e.element(i.target),error:n.error,onClose:function(){o.remove(),t.preventGestures()}})}},onPaint:function(){var e,t=this.$scope,r=t.object.error;if(!r){var o=h(t.layout,t.object.ext&&t.object.ext.options?t.object.ext.options.hyperCubePath:"");o.holder&&(e=d(o.holder)||o.errorTranslationFunc(o.holder.qError.qErrorCode),r=u(o.holder.qError)?{class:"soft-error",message:e}:{class:"hard-error",title:n.get("Object.Error"),message:e})}return t.error=r,i.resolve()}});return p.$inject=["$scope"],{template:o,controller:p,isCalcCondNotCalculatedErr:function(e){return e.qErrorCode===l.NxLocalizedErrorCode.LOCERR_CALC_NOT_CALCULATED}}}),define("general.models/library/measure",["core.models/communication","core.utils/deferred","util"],function(e,t,n){"use strict";function i(n){return n?t.resolve(n.enigmaModel):e.getApp()}var r={};return r.get=function(e,t){return i(t).then(function(t){return t.getMeasure(e)})},r.create=function(e,t){return i(t).then(function(t){return e.qInfo.qId=e.qInfo.qId||n.generateId(),t.createMeasure(e)})},r.remove=function(e,t){return i(t).then(function(t){return t.destroyMeasure(e)})},r.getList=function(e){return i(e).then(function(e){return e.getMeasureListObject()})},r.getListLayout=function(e){return r.getList(e).then(function(e){return e.getLayout()})},r}),define("objects.picasso/title/title-retriever",["core.utils/deferred","objects.error-handling/error-handler","objects.error-handling/error-translation","general.models/library/measure"],function(e,t,n,i){"use strict";function r(){this.measureTitles={}}function o(e,t){return t[l(e)]}function s(e,t){var n=l(e),i={id:n,promise:null};return t[n]=i,i}function a(t,r,o,s){if(!t)return e.when("");var a=r.qLibraryId;if(t.qError)return e.when(n.getMeasureError(t.qError.qErrorCode));if(a&&o){if(!s)throw new Error("TitleRetriever: Argument 'app' is required");return i.get(a,s).then(function(e){return e.getProperties()}).then(function(e){return e.qMeasure.qLabel||""})}return!a&&o?e.when(r.qDef.qLabelExpression||t.qFallbackTitle||""):e.when(t.qFallbackTitle||"")}function l(e){return e&&e.cId}return r.prototype.getDimensionTitle=function(e,i,r){if(!e)return"";if(e.qError&&!t.isCalcCondNotCalculatedErr(e.qError))return n.getDimensionError(e.qError.qErrorCode);var o=i.qLibraryId;return"H"===e.qGrouping||o&&r?e.title||"":!o&&r?i.qDef.qLabelExpression||e.qFallbackTitle||"":e.qFallbackTitle||""},r.prototype.getMeasureTitle=function(e,t,n,i){var r=o(e,this.measureTitles);return r?r.promise:(r=s(e,this.measureTitles),r.promise=a(e,t,n,i),r.promise)},r.prototype.resetTitles=function(){this.measureTitles={}},r}),define("objects.picasso/title/title-retriever-factory",["objects.picasso/title/title-retriever"],function(e){"use strict";return{create:function(){return new e}}}),define("objects.requirements/requirements",["jquery","objects.utils/hypercube-util","text!./requirements.ng.html","client.utils/state","core.utils/environment","core.utils/deferred","objects.extension/base-controller","objects.error-handling/error-translation","core.utils/resize","objects.add-popovers/add-dimension-popover","objects.add-popovers/add-measure-popover","core.utils/feature-flags","objects.picasso/title/title-retriever-factory"],function(e,t,n,i,r,o,s,a,l,c,u,h,d){"use strict";function p(e){var t,n=new Array(e);for(t=0;t<e;++t)n[t]={index:t};return n}function f(e,n){if(e.layers&&e.layers[0]){var i=e.layers[0],r=i.qHyperCube.qDimensionInfo;return"point"===i.type?r[1].qError&&r[1].qError.qErrorCode?[r[1]]:[r[0]]:e.layers[0].qHyperCube.qDimensionInfo||[]}var o=t.getHyperCube(e,n);return o?o.qDimensionInfo||[]:e.qChildList?(e.qChildList.qItems||[]).map(function(){return{}}):e.qListObject&&e.qListObject.qDimensionInfo?[e.qListObject.qDimensionInfo]:[]}function m(e,n){var i=t.getHyperCube(e,n);return i?i.qMeasureInfo||[]:[]}function g(e){e.showAdd=r.inClient()?i.isInEditMode()&&!e.object.isReadonly:!e.object.isReadonly}function v(e){var t=e.ext.dimensionDefinition?e.ext.dimensionDefinition.min:0,n=e.ext.dimensionDefinition?e.ext.dimensionDefinition.max:0,i=e.ext.measureDefinition?e.ext.measureDefinition.min:0,r=e.ext.measureDefinition?e.ext.measureDefinition.max:0;e.minDimensions=t,e.minMeasures=i,e.maxDimensions=n,e.maxMeasures=r,e.headerStr=t!==n||i!==r?"Visualization.Requirements.AddAtLeast":"Visualization.Requirements.Add"}var y=null,b=s.extend({$scope:null,init:function(t,n){function r(){g(t)}function o(e){return t.object.ext.addFieldDimension(e,t.object).then(function(){p()})}function s(e){return t.object.ext.addLibraryDimension(e,t.object).then(function(){p()})}function a(e){return t.object.ext.addLibraryMeasure(e,t.object).then(function(){p()})}function h(e){return t.object.ext.addExpressionMeasure(e,t.object).then(function(){p()})}function p(t){f&&(f.close(),f=null),y&&(y.active=!1),t&&!e(t.target).hasClass("add-button")&&(y=null)}this.$scope=t,this.$scope.hyperCubePath=t.object.ext.options.hyperCubePath,this.titleRetriever=d.create(),i.StateChanged.bind(r),t.$on("$destroy",function(){i.StateChanged.unbind(r)}),r(),t.removeDimension=function(e){t.object.model.getProperties().then(function(n){var i=t.object.getCreatePropertyHandler();i.setProperties(n),i.removeDimension(e).then(function(){t.object.model.setProperties(n)})})},t.removeMeasure=function(e){t.object.model.getProperties().then(function(n){var i=t.object.getCreatePropertyHandler();i.setProperties(n),i.removeMeasure(e).then(function(){t.object.model.setProperties(n)})})};var f;t.showAddDimension=function(i,r){if(y&&y===r)return f&&f.close(),f=null,void(y=null);var a,l=t.ext.addDimensionPopoverComponent||c;(f=n.show({template:l.template,controller:l.controller,input:{app:t.object.model.app,closeAddPopover:p,addFieldDimension:o,addLibraryDimension:s},alignTo:i.target,closeOnEscape:!0,outsideIgnore:".add-button",dock:"right"})).closing.then(function(t){a=t,t&&!e(t.target).hasClass("add-button")&&(y=null)}),f.closed.then(function(){f=null,r.active=!1,a||(y=null)}),r.active=!0,y=r},t.showAddMeasure=function(i,r){if(y&&y===r)return f&&f.close(),f=null,void(y=null);var o,s=t.ext.addMeasurePopoverComponent||u;(f=n.show({template:s.template,controller:s.controller,input:{app:t.object.model.app,closeAddPopover:p,addLibraryMeasure:a,addExpressionMeasure:h},alignTo:i.target,closeOnEscape:!0,dock:"right",outsideIgnore:'[tid="add-measure"]'})).closing.then(function(t){o=t,t&&!e(t.target).hasClass("add-button")&&(y=null)}),f.closed.then(function(){f=null,r.active=!1,o||(y=null)}),r.active=!0,y=r},l.on("start",p),t.$on("$destroy",function(){l.off("start",p),p()})},onPaint:h.LABEL_EXPR?function(e){var t=this.$scope,n=this;return this.$scope.object.model.getProperties().then(function(i){var r,s=n.titleRetriever;g(t),v(t),t.iconName=t.object.ext.libraryInfo.icon,t.type!==t.object.type.type?(r=n.propertyHandler=t.object.getCreatePropertyHandler(),t.canRemoveDim=!!r.removeDimension,t.type=t.object.type.type,t.addDimensionLabel=r.getAddDimensionLabel()):r=n.propertyHandler,r.setLayout(e),r.setProperties(i),s.resetTitles();var a=r.getDimensions().map(function(e){var t=e.qDef.cId,n=r.getDimensionLayout(t),i=i=n.qError&&n.qError.qErrorCode;return{invalid:!!i,title:s.getDimensionTitle(n,e,!0)}});return o.all(r.getMeasures().map(function(e){var t=e.qDef.cId,n=r.getMeasureLayout(t),i=n.qError&&n.qError.qErrorCode;return s.getMeasureTitle(n,e,!0,r.app).then(function(e){return{invalid:!!i,title:e}})})).then(function(e){t.finishedDimensions=a,t.finishedMeasures=e,t.unfinishedDimensions=p(Math.max(0,t.minDimensions-t.finishedDimensions.length)),t.unfinishedMeasures=p(Math.max(0,t.minMeasures-t.finishedMeasures.length)),t.show=!0})})}:function(){var e,t,n,i=this.$scope,r=i.layout;return g(i),v(i),i.iconName=i.object.ext.libraryInfo.icon,i.type!==i.object.type.type&&(n=i.object.getCreatePropertyHandler(),i.canRemoveDim=!!n.removeDimension,i.type=i.object.type.type,i.addDimensionLabel=n.getAddDimensionLabel()),e=f(r,i.hyperCubePath).map(function(e){var t,n=e.qError&&e.qError.qErrorCode;return t=n?a.getDimensionError(n):e.title||e.qFallbackTitle,{invalid:!!n,title:t}}),t=m(r,i.hyperCubePath).map(function(e){var t,n=e.qError&&e.qError.qErrorCode;return t=n?a.getMeasureError(n):e.qFallbackTitle,{invalid:!!n,title:t}}),i.finishedDimensions=e,i.finishedMeasures=t,i.unfinishedDimensions=p(Math.max(0,i.minDimensions-i.finishedDimensions.length)),i.unfinishedMeasures=p(Math.max(0,i.minMeasures-i.finishedMeasures.length)),i.show=!0,o.resolve()}});return b.$inject=["$scope","luiPopover"],{template:n,controller:b}}),define("text!storytelling.views/annotations/annotations.ng.html",[],function(){return'<lui-popover>\n\t<lui-popover-header >\n\t\t<lui-popover-title q-translation="Storytelling.Snapshot.AnnotationTitle"></lui-popover-title>\n\t</lui-popover-header>\n\t<lui-popover-body>\n\t\t<div class="form">\n\t\t<textarea class="lui-textarea" maxlength="255" rows="3" ng-model="annotation.text"\n\t\t\t\t  q-placeholder="Storytelling.Snapshot.AnnotationHint"></textarea>\n\t\t</div>\n\t</lui-popover-body>\n\t<lui-popover-footer>\n\t\t<button class="lui-button  lui-button"  ng-click="closeDialog();" q-translation="Common.Cancel"></button>\n\t\t<button class="lui-button  lui-button" ng-click="save();"  q-translation="Common.Save"></button>\n\t</lui-popover-footer>\n</lui-popover>'}),define("storytelling.views/annotations/annotations",["jquery","qvangular","text!storytelling.views/annotations/annotations.ng.html","client.models/snapshot","core.utils/resize"],function(e,t,n,i,r){function o(i,o,a){d(),m.endAnnotation=o;var l,f=t.getService("luiPopover").show({template:n,controller:["$scope","$element",function(t,n){function o(e){return(e.ctrlKey||e.metaKey)&&!e.altKey&&(37===e.which||39===e.which)}l=t,t.annotation={text:""},t.active=!0,t.focused=!1,t.save=function(){c(f.currentAnnotationId,t.annotation.text),t.close()},t.closeDialog=function(){t.annotation.text="",t.focused=!1,s(),t.close()},i.on("mouseenter.annotations",function(){u(t)}),i.on("mouseleave.annotations",function(){h(t)}),n.on("mouseenter.dialog",function(){u(t)}),n.on("mouseleave.dialog",function(){h(t)}),n.on("click.dialog",function(n){e(n.target).is(".lui-textarea")&&(t.focused=!0)}),r.on("start.storytellingAnnotate",t.closeDialog),t.$on("$destroy",function(){r.off("start.storytellingAnnotate",t.closeDialog),e(document).off("keydown.annotations"),n.off("mouseenter.dialog"),n.off("mouseleave.dialog"),n.off("click.dialog")}),e(document).on("keydown.annotations",function(e){o(e)&&h(t,1)}),a&&h(t)}],alignTo:i[0]});return f.closed.then(function(){p(),c(f.currentAnnotationId,l.annotation.text),l.focused=!1,l.close()}),f}function s(t){if(t||(t=e(g)),t.length&&m){m.endAnnotation();for(var n=f.length;n>=0;n--)clearTimeout(f.pop());t.off("mouseenter.annotations"),t.off("mouseleave.annotations"),p()}}function a(e){return i.get(e)}function l(e,t){return e.getProperties().then(function(n){n.qMetaDef.annotation=t,e.setProperties(n)})}function c(t,n){var i=e(g);a(t).then(function(e){l(e,n).then(function(){s(i)})}),t||s(i)}function u(e){e.active=!0;for(var t=f.length;t>=0;t--)clearTimeout(f.pop())}function h(t,n){var i=e.isNumeric(n)?n:4e3;!1===t.focused&&(t.active=!1,t.focused=!1,f.push(setTimeout(function(){t.$apply(function(){t.closeDialog()})},i)))}function d(){e(g).parents("#grid").append("<div class='block' style='background-color: transparent;'></div>")}function p(){setTimeout(function(){e("#grid").children(".block").remove()})}var f=[],m={endAnnotation:null},g=".qv-object-nav .lui-icon--camera";return t.service("annotationsDialog",function(){return{openDialog:o,closeDialog:s}}),{getSnapshotModel:a,saveAnnotationInModel:l}}),define("objects.snapshot/snapshot-helper",["jquery","util","translator","qvangular","client.models/app-generic-props-wrapper","client.models/snapshot","core.utils/deferred","client.utils/state","client.utils/rtl/direction-service","storytelling.views/annotations/annotations"],function(e,t,n,i,r,o,s,a,l){function c(e){var t=!m||m!==e;return t&&(m=e,setTimeout(function(){m=null},f)),t}function u(n,i,o,l,c){var u=new s,h=new Date,d=o?t.extend(!0,{},n):n;return p(i,d,c).then(function(){r.getProperties().then(function(r){d.snapshotData={object:{size:i.objectSize},rtl:void 0!==r.rtl&&r.rtl},i.setSnapshotData(d,l||{}).then(function(){if(o){d.qInfo.qId=t.generateId(),d.visualizationType=n.qInfo.qType,d.sourceObjectId=n.qInfo.qId,d.sheetId=a.model.id,d.timestamp=h.getTime(),d.isClone=!1,d.qMetaDef={title:n.title},d.supportExport=i.supportExport(),delete d.qExtendsId;var r=e(".qv-panel-sheet");d.snapshotData.parent={h:r.height(),w:r.width()}}else d.snapshotData.object.origDataPages=i.model.layout.snapshotData.object.origDataPages,d.snapshotData.content&&(d.snapshotData.content.chartData=t.extend(!0,{},i.model.layout.snapshotData.content.chartData));u.resolve(d)})})}),u.promise}function h(e,t){var r=new s;return o.create(t).then(function(t){t.limit?(d(e.find(".qv-object")),r.resolve(t.id)):i.getService("qvAlertDialog").show({title:n.get("Storytelling.Snapshot.MaxLimitReached.Title"),message:n.get("Storytelling.Snapshot.MaxLimitReached.Text"),closeLabel:n.get("Common.OK")})}),r.promise}function d(t){t.prepend(e('<div class="qv-snapshot-tool-flash '+l.direction+'" />').bind("oanimationend animationend webkitAnimationEnd",function(){e(this).remove()}))}function p(e,n,i){function r(e){a(l,"qStaticContentUrl",n,i),a(c,"qStaticContentUrlDef",e),o(),u.resolve(n)}function o(){l.forEach(function(e,n){t.extend(!0,e,c[n])})}function a(e,t,n,i){for(var r in n)n.hasOwnProperty(r)&&"qHyperCube"!==r&&"qHyperCubeDef"!==r&&(r===t?(i&&(delete n[r],n.qStaticContentUrlDef={}),e.push(n.qStaticContentUrlDef)):"object"==typeof n[r]&&a(e,t,n[r],i))}var l=[],c=[],u=new s;return void 0===i&&(i=!0),n.qExtendsId&&"text-image"===n.visualization?e.model.app.getObject(n.qExtendsId).then(function(e){e.getProperties().then(function(e){r(e)})}):e.model.getProperties().then(function(e){r(e)}),u.promise}var f=1e3,m=null;return{createSnapshot:function(e,t,n){var i=new s,r=e.layout;return c(r.qInfo.qId)?u(r,e,!0,n).then(function(e){return delete e.qInfo,h(t,e)}):(i.reject(),i.promise)},getNumberOfSnapshots:function(e){return o.getSnapshotCount(e)},prepSnapshotData:u,prepareStaticContent:p,formatSnapshotForRendering:function(e,t){return JSON.stringify({data:e,appLocaleInfo:t||{},language:n.language})}}}),define("objects.utils/data-properties/empty-handler",["./data-property-handler","util"],function(e){"use strict";return e.extend({getDimensions:function(){return[]},getMeasures:function(){return[]}})}),define("text!objects.error-handling/invalid-type.ng.html",[],function(){return'<div class="object-error hard-error" tid="object.Error">\n\t<div class="object-error-content">\n\t\t<div class="object-error-title">\n\t\t\t<span>{{error.title}}</span>\n\t\t\t<i class="object-error-more icon-info" qva-activate="showMore($event)"></i>\n\t\t</div>\n\t\t<div ng-if="error.message" class="object-error-message">{{error.message}}</div>\n\t\t<button ng-if="showButton" class="lui-button object-error-remove" qva-activate="remove($event)" q-translation="Common.Delete"></button>\n\t</div>\n</div>\n'}),define("objects.error-handling/invalid-type",["angular","touche","translator","objects.utils/data-properties/empty-handler","./error-info-popup","text!objects.error-handling/invalid-type.ng.html"],function(e,t,n,i,r,o){"use strict";return{type:"invalid",template:o,definition:{type:"items",items:{}},support:{exportData:!1},getContextMenu:function(){},hasError:function(){return!1},showRequirements:function(){return!1},getCreatePropertyHandler:function(e){return new i({app:e})},getDropFieldOptions:function(){},getDropDimensionOptions:function(){},getDropMeasureOptions:function(){},controller:["$scope",function(i){var o,s=i.object.error,a=n.get(s.title);o=Array.isArray(s.message)?n.get(s.message[0],s.message.slice(1)):n.get(s.message),i.error={title:a,message:o},i.showButton=i.options&&"function"==typeof i.options.removeIt,i.remove=function(e){i.options.removeIt(),e.stopPropagation()},i.showMore=function(n){var o=e.element("<div>").appendTo("body");o.showComponent(r,{alignTo:e.element(n.target),error:i.error,onClose:function(){o.remove(),t.preventGestures()}})}}]}}),define("objects.utils/resize",["pubsub"],function(e){function t(t){t=t||{},e.publish("/ui/object/resize",t)}["/resize/end","/ui/panel/toggle","/ui/grid/cellswap","/ui/grid/cellresize","/ui/grid/cellsplitting","/ui/grid/zoom/activated","/ui/grid/zoom/deactivated"].forEach(function(n){e.subscribe(n,t)})}),define("client.views/selection-toolbar/selection-toolbar-service",["angular","qvangular","client.views/selection-toolbar/selection-toolbar","util","core.utils/notification","angular"],function(e,t,n,i,r){"use strict";t.service("qvSelectionToolbarService",function(){function t(e,t){var n,i,r,o=e[0].getBoundingClientRect(),s=t[0].getBoundingClientRect();return t.is("th, td")&&(i=t.closest("table")[0].getBoundingClientRect(),n=t.prevAll(),r=n.length?n.last():t,r[0].getBoundingClientRect().left-i.left==1)?{top:s.top-o.top,left:s.left-1-o.left,width:s.width}:{top:s.top-o.top,left:s.left-o.left,width:s.width}}var o,s,a;return o={open:function(r,o,l){var c=t(r,o),u={top:-44+c.top,width:c.width+(l.offsetWidth||0),left:c.left};l.toolbar=i.extend(!0,l.toolbar,{position:u,menuMaxHeight:l.menuMaxHeight}),s=e.element("<div>"),a=s.showComponent(n,l),s.appendTo(r),this.Opened.emit()},refresh:function(){a&&a.refresh()},close:function(){a&&(a.close(),this.Closed.emit(),a=void 0),s&&s.remove()},confirm:function(){a&&(a.confirm(),a=void 0),this.close()}},r.create(o,"Closed"),r.create(o,"Opened"),o})}),define("text!objects/throbber/throbber.ng.html",[],function(){return'<div ng-show="progress" class="qv-animate progress ng-hide">\n\t<div class="progress-loader" style="width:20%;height:20%;position:absolute;top:40%;left:40%"></div>\n</div>\n'}),define("objects/throbber/throbber",["qvangular","text!./throbber.ng.html"],function(e,t){"use strict";e.directive("qvThrobber",["$timeout",function(e){return{replace:!0,template:t,restrict:"E",scope:{model:"=",progress:"=",delay:"=",disabled:"="},link:function(t){var n;t.$watch("model.isValidating",function(i){!0!==t.disabled?t.model&&void 0===t.model.state?t.progress=!0:i?(n&&e.cancel(n),n=e(function(){t.model&&t.model.isValidating&&(t.progress=!0)},t.delay||1e3)):t.progress=!1:t.progress=!1})}}}])}),define("text!general.services/loader/rain/rain.ng.html",[],function(){return'<div class="rain progress" ng-class="{\'qv-fade-out\': fadeOut}">\n\t<div class="rain-progress" ng-style="rainStyle">\n\t\t<div class="progress-div rotating" ng-class="ngClasses">\n\t\t</div>\n\t</div>\n\t<div class="qv-loader-text" ng-if="messageObj" ng-class="ngClasses">\n\t\t<div ng-show="messageObj.task" q-translation="{{messageObj.task}}"></div>\n\t\t<div ng-show="messageObj.message" q-translation="{{messageObj.message}}"></div>\n\t</div>\n</div>\n'}),define("general.services/loader/rain/rain",["qvangular","text!../rain/rain.ng.html"],function(e,t){"use strict";e.directive("qvRain",[function(){return{replace:!0,template:t,restrict:"E",scope:{show:"=",resize:"=?",messageObj:"=?"},link:function(e,t){function n(){var n=t[0].getBoundingClientRect(),i=Math.min(n.width,n.height);i*=.3,e.rainStyle.height=i+"px",e.rainStyle.width=i+"px",e.rainStyle.top=(n.height-i)/2,e.rainStyle.left=(n.width-i)/2}var i;e.rainStyle={},e.$watch("show",function(e){void 0!==e&&e&&n()}),e.resize&&(i=e.resize(n)),n(),e.$on("$destroy",function(){i&&i()})}}}])}),define("objects/object",["jquery","qvangular","core.utils/deferred","general.utils/visualizations","objects.utils/layout","objects.utils/type-loader","text!./object.ng.html","pubsub","general.utils/responsive-state","objects.extension/extension-type","util","translator","objects.requirements/requirements","objects.error-handling/error-handler","core.utils/resize","objects.extension/base-controller","objects.extension/default-controller","objects.utils/interaction-states","objects.snapshot/snapshot-helper","client.utils/theme/theme-module","core.utils/feature-flags","client.utils/capability-flags","objects.utils/snapshot-utils","objects.error-handling/invalid-type","objects.utils/resize","client.views/selection-toolbar/selection-toolbar-service","objects/throbber/throbber","general.services/loader/rain/rain"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,x,q,C){"use strict";function S(e){e.selectionsApi&&e.selectionsApi.active&&e.selectionsApi.confirm()}function w(e,n){function i(){return!e.options||!1!==e.options.isVisible}function r(){S(n)}function o(){i()&&(t.$apply(e,function(){n.resize()}),n.throbberApi.resize(),n.explore.resize())}function s(){l||(l=setTimeout(function(){o(),clearTimeout(l),l=null},100))}var l;e.$on("resizeCell",function(){s()}),a.subscribe("/ui/object/resize."+e.$id,function(){s()}),f.on("start."+e.$id,r),e.$on("$destroy",function(){clearTimeout(l),a.unsubscribe("."+e.$id),f.off("start."+e.$id,r)})}function _(e,t){function n(n){e.model.isCancelled||(e.layout=n,t.setLayout(n,e.options))}function i(){t.setRenderState(k.INVALID)}function r(r){r.Invalidated&&!r.isCancelled&&r.Invalidated.bind(i),t.subscription=e.model.layoutSubscribe(n)}function o(e){e&&e.Invalidated&&e.Invalidated.unbind(i),t.subscription&&t.subscription.dispose()}e.object._forcePaint=!0,e.$watch("model",function(e){e&&(t.model&&o(t.model),r(e),t.setModel(e))}),e.$on("$destroy",function(){o(e.model)})}function D(e,t){if(x.THEMING){var n=O.initializeService("object."+O.getMatch(t.visualization||t.qInfo.qType));e.styles={backgroundColor:{"background-color":n.getStyle("","backgroundColor")},title:{"font-size":n.getStyle("title.main","fontSize"),color:n.getStyle("title.main","color")},subTitle:{"font-size":n.getStyle("title.subTitle","fontSize"),color:n.getStyle("title.subTitle","color")},footer:{"font-size":n.getStyle("title.footer","fontSize"),color:n.getStyle("title.footer","color"),"background-color":n.getStyle("title.footer","backgroundColor")}}}}function M(e,n,i,o){function s(){return!e.options||!1!==e.options.isVisible}var a,l,c,u,d;n.setObjectClass=function(t){c||(c=i.find(".qv-object")),(t||void 0===u)&&(u=c[0].clientWidth),(t||void 0===d)&&(d=c[0].clientHeight);var o=r.getLayoutMode(u,d),s=n.type&&n.type.type,a=[];n.supportSnapshot()&&a.push("qv-can-take-snapshot"),n.selectionsApi&&n.selectionsApi.active&&a.push("qv-selections-active"),n.objectSize={w:u,h:d},e.options.layoutMode=o;var l="qv-layout-"+r.getLayoutModeKey(o);a.push(l),e.objectClass="qv-object-"+s,a.push(e.objectClass),n.selectionClass&&a.push(n.selectionClass),e.classList=a,e.wrapperClassList=[],e.object&&e.object.hasFrame&&e.object.showTitles&&e.layout.footnote&&e.wrapperClassList.push("has-footnote"),e.thinHeader=!n.showTitles||""===e.layout.title&&""===e.layout.subtitle&&!n._inEditState},n.update=function(){if(this.valid){D(e,e.layout);var i=this;a=t.getService("$timeout")(function(){n.backendApi&&n.backendApi.updateCache(e.layout),n.setObjectClass(),e.$digest(),i.loadContent(),o.contentLoaded().then(function(t){try{return t.onPaint(e.layout,{visible:s()}).then(function(t){!1!==t&&(n.setRenderState(k.RENDERED),"function"==typeof e.options.onRendered&&e.options.onRendered.call(null))}).catch(function(){n.setRenderState(k.INVALID),"function"==typeof e.options.onRendered&&e.options.onRendered.call(null)})}catch(t){throw n.setRenderState(k.INVALID),n.error={class:"hard-error",title:h.get("Object.Error"),message:h.get("Object.ErrorMessage.RenderingFailed",n.ext&&n.ext.type)},o.updateContent(p).then(function(i){i.onPaint(e.layout,{visible:!1}).then(function(){n.setRenderState(k.RENDERED),"function"==typeof e.options.onRendered&&e.options.onRendered.call(null,t)})}),t}})})}},n.resize=function(){s()&&(n.setRenderState(k.INVALID),l=t.getService("$timeout")(function(){n.setObjectClass(!0),o.contentLoaded().then(function(t){t.onResize(e.layout).then(function(){n.setRenderState(k.RENDERED)})})}))},n.onResize=function(){o.contentLoaded().then(function(t){t.onResize(e.layout).then(function(){n.setRenderState(k.RENDERED)})})},e.$on("$destroy",function(){var e=t.getService("$timeout");e.cancel(a),e.cancel(l)})}function A(e,r,o,s){var a,l=n();o.loaded=l.promise,o.valid=!1,o.showExploreMenu=!1,o.loadContent=function(){var t,n={options:e.options,object:o,layout:e.layout,ext:o.ext};t=o.ext.hasError(n)?p:o.ext.showRequirements(n)?d:o.ext,s.updateContent(t)},o.reset=function(){this.valid&&(e.options=u.extend({},e.resetOptions,{isZoomed:e.options.isZoomed,interactionState:e.options.interactionState,direction:e.options.direction}),l=n(),this.loaded=l.promise,this.valid=!1)},o.validate=function(){this.valid||this.layout&&this.type&&this.ext&&(this.valid=!0,l.resolve())},o.setExtension=function(t){this.ext=t,e.ext=t,"invalid"!==t.type&&(t.mapProperties(this.model),t.mapSoftProperties(),this.setBackendApi(),t.migrate?(this.model.migrate={properties:t.migrate.properties,snapshot:t.migrate.snapshot},"function"==typeof t.migrate.snapshot&&C.isSnapshotData(this.model.layout)&&t.migrate.snapshot(this.model.layout)):this.model.migrate={properties:function(e){return e},snapshot:function(e){return e}}),this.validate(),this.update(),this.ext.model=this.model},o.setBackendApi=function(){var t=e.options.APIType||this.ext.BackendApi,n=this.backendApi=new t(this.model);s.contentLoaded().then(function(e){e.setBackendApi(n)})},o.setType=function(n,i){this.backendApi&&this.backendApi.destroy(),this.ext=null,this.backendApi=null,this.hasContent=!1,this.type=n,n.load().then(function(a){function l(){o.setExtension(a),E(e,r,o),i&&(t.$rootScope.$broadcast("refreshPropertyPanel"),t.$rootScope.$broadcast("reloadExploreContent"))}if(o.type===n)if(n!==L&&(o.error=null),"function"==typeof a.init){var c=a.init.call(null,r,o.layout);c&&"function"==typeof c.then?c.then(function(){l()},function(t){o.setRenderState(k.INVALID),o.error={class:"hard-error",title:h.get("Object.Invalid.Title"),message:t||h.get("Object.ErrorMessage.RenderingFailed",a.type)},s.updateContent(p).then(function(n){n.onPaint(e.layout,{visible:!1}).then(function(){o.setRenderState(k.RENDERED),"function"==typeof e.options.onRendered&&e.options.onRendered.call(null,t)})}),l()}):l()}else l()},function(){o.setType(L),q.getFlag("CLOUD_EXTENSIONS")?o.error={class:"hard-error",title:h.get("Object.Invalid.Title"),message:h.get("Object.ErrorMessage.NotFound.Cloud.Extensions",n.type)}:o.error={class:"hard-error",title:h.get("Object.Invalid.Title"),message:h.get("Object.ErrorMessage.NotFound",n.type)},o.isInvalid=!0,o.setObjectClass()})},o.setModel=function(e){this.model=e,this.ext&&(this.ext.model=e,this.setBackendApi())},o.on=function(){s.contentLoaded().then(function(e){e.view&&e.view.on()})},o.off=function(){s.contentLoaded().then(function(e){e.view&&e.view.off()})},o.isOn=function(){return s.contentLoaded().then(function(e){return e.view?e.view.isOn():null})},o.setInteractionState=function(n){o._interactionState=n,o._inEditState=n===v.EDIT,o._inAnalysisState=n===v.ANALYSIS,e.options.interactionState=n,this._inEditState&&o.viewDataToggled&&o.toggleDataView(),s.contentLoaded().then(function(e){n!==v.ANALYSIS&&S(o),e.setInteractionState(n),t.getService("$timeout").cancel(a),a=t.getService("$timeout")(function(){o.setObjectClass()})})},o.getInteractionState=function(){return o._interactionState},o.inAnalysisState=function(){return o._inAnalysisState},o.inEditState=function(){return o._inEditState},o.setFreeResize=function(t){e.options.freeResize=t,s.contentLoaded().then(function(e){e.setFreeResize(t)})},o.setDirection=function(t){t&&e.options.direction!==t&&(e.options.direction=t,s.contentLoaded().then(function(e){e.setDirection(t),o.update()}))},o.setLayout=function(e){this.layout=e;var t=e.visualization||e.qInfo&&e.qInfo.qType,n=i.getType(t);e.qError&&(n=L,this.error={title:"Object.Error",message:"Object.Invalid.Info"}),n||(n=L,q.getFlag("CLOUD_EXTENSIONS")?this.error={title:"Object.Invalid.Title",message:["Object.ErrorMessage.NotFound.Cloud.Extensions",t]}:this.error={title:"Object.Invalid.Title",message:["Object.ErrorMessage.NotFound",t]}),(this.ext&&this.ext.hasNewType&&this.ext.hasNewType(this,n,e)||this.type!==n)&&(this.reset(),this.setType(n,!!this.type)),this.isInvalid=n===L,this.isLink=!this.isInvalid&&!!e.qExtendsId,this.showTitles=!1!==e.showTitles,this.validate(),this.update()}}function E(n,i,r){function o(t){var n=e(t.target);r.selectionsApi.ignoreOnOutside(n)||(r.selectionsApi.getDockToElement().off(".object"),r.selectionsApi.confirm())}function s(){return r.backendApi&&r.backendApi.endSelections(!0),null}r.activateSelections=function(){void 0!==r.ext.options.selections&&r.inAnalysisState()&&r.selectionsApi.activate()},r.selectionsApi&&"function"==typeof r.selectionsApi.destroy&&r.selectionsApi.destroy(),r.tooltipApi={cancel:function(){},destroy:function(){}},r.selectionsApi={destroy:function(){this._activatedCallbacks=[],this._deactivatedCallbacks=[],e(window).off("onbeforeunload",s)},active:!1,selectionsMade:!1,_activatedCallbacks:[],_deactivatedCallbacks:[],on:function(){},off:function(){},ignoreOnOutside:function(e){return!(!e.closest(".qv-selection-toolbar").length&&!e.closest(".selections-data-area-ui").length)},getDockToElement:function(){return l.isSmallDevice?i:i.children(".qv-object")},getMenuMaxHeight:function(){return r.selectionsApi.getDockToElement().outerHeight()},getSelectionToolbarWidthOffset:function(){return 0},refreshToolbar:function(){t.getService("qvSelectionToolbarService").refresh()},watchActivated:function(e){return this._activatedCallbacks.push(e),function(){var t=this._activatedCallbacks.indexOf(e);this._activatedCallbacks.splice(t,1)}.bind(this)},activated:function(a){this.active=!0,a||r.backendApi.beginSelections(),e(window).on("onbeforeunload",s),n.options.isPopover||(this.getDockToElement().on("qv-outside.object",o),t.$apply(n,function(){r.setObjectClass(),r.getSelectionToolbar().then(function(e){var o={toolbar:e,selectionsApi:r.selectionsApi,options:n.options,menuMaxHeight:r.selectionsApi.getMenuMaxHeight(),offsetWidth:r.selectionsApi.getSelectionToolbarWidthOffset()};t.getService("qvSelectionToolbarService").open(i,r.selectionsApi.getDockToElement(),o)})})),this._activatedCallbacks.forEach(function(e){e.call(this)},this)},watchDeactivated:function(e){return this._deactivatedCallbacks.push(e),function(){var t=this._deactivatedCallbacks.indexOf(e);this._deactivatedCallbacks.splice(t,1)}.bind(this)},deactivated:function(){e(window).off("onbeforeunload",s),this.active=!1,this.selectionsMade=!1,r.tooltipApi.cancel(),n.options.isPopover||(r.selectionsApi.getDockToElement().off(".object"),t.$apply(n,function(){r.setObjectClass(),t.getService("qvSelectionToolbarService").close()})),this._deactivatedCallbacks.forEach(function(e){e.call(this)},this)},confirm:function(){r.selectionsApi.deactivateSearch&&r.selectionsApi.deactivateSearch(),r.backendApi.endSelections(!0),r.tooltipApi.cancel(),this.deactivated()},cancel:function(){r.selectionsApi.deactivateSearch&&r.selectionsApi.deactivateSearch(),r.backendApi.endSelections(!1),r.tooltipApi.cancel(),this.deactivated()},clear:function(){r.backendApi.clearSelections(),r.tooltipApi.cancel(),this.selectionsMade=!1},toggleKeyboardAccelerators:function(){},getKeyAsToggleSelected:function(e){return!(e.metaKey||e.ctrlKey)},search:function(){},confirmSearch:function(){},cancelSearch:function(){},activate:function(){this.active||this.activated()}}}function I(e,n){function i(i,r){t.getService("$timeout").cancel(o),t.getService("$timeout").cancel(s),n.selectionsApi&&n.selectionsApi.active?n.throbberApi.hide():e.model&&void 0===e.model.state?n.throbberApi.show():e.model&&e.model.isCancelled?n.throbberApi.isQueryCanceled=!0:i?(o=t.getService("$timeout")(function(){e.model&&e.model.isValidating&&n.throbberApi.show()},r),s=t.getService("$timeout")(function(){!0===n.throbberApi.isVisible&&(n.throbberApi.isLongRunningQuery=!0,n.throbberApi.isQueryCanceled=!1)},8e3)):(n.throbberApi.hide(),n.throbberApi.isLongRunningQuery=!1)}var r,o,s;n.throbberApi&&"function"==typeof n.throbberApi.destroy&&n.throbberApi.destroy(),n.throbberApi={resizeCallbacks:[],isVisible:!1,isLongRunningQuery:!1,isQueryCanceled:!1,initialize:function(){r=e.$watch("model.isValidating",function(e){i(e,1e3)})},reset:function(e){i(e,0)},show:function(){n.throbberApi.isVisible=!0,n.throbberApi.isQueryCanceled=!1,n.throbberApi.isLongRunningQuery=!1},hide:function(){n.throbberApi.isVisible=!1,n.throbberApi.isLongRunningQuery=!1,t.getService("$timeout").cancel(o),t.getService("$timeout").cancel(s)},off:function(){r(),t.getService("$timeout").cancel(o),t.getService("$timeout").cancel(s)},destroy:function(){n.throbberApi.off(),n.throbberApi.resizeCallbacks.length=0},resize:function(){n.throbberApi.resizeCallbacks.forEach(function(e){e()})},watchResize:function(e){var t=n.throbberApi.resizeCallbacks;return t.push(e),function(){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}}},n.throbberApi.initialize()}function T(e,t){t.explore={resizeCallbacks:[],resize:function(){t.explore.resizeCallbacks.forEach(function(e){e()})},watchResize:function(e){t.explore.resizeCallbacks.push(e)},unwatchResize:function(e){var n=t.explore.resizeCallbacks.indexOf(e);-1!==n&&t.explore.resizeCallbacks.splice(n,1)},destroy:function(){t.explore.resizeCallbacks=[]}}}var L=new c({type:"invalid",path:"objects.error-handling/invalid-type"}),k={INVALID:0,RENDERED:1},O=b.get();t.componentDirective("qvObjectContent",{object:"=",backendApi:"=",ext:"=",options:"=",layout:"=",selectionsApi:"=",tooltipApi:"=",throbberApi:"=",onInit:"="},null,function(e,t,n){t.onInit(e,t,n)}),t.directive("qvObject",function(){return{restrict:"E",replace:!0,template:s,scope:{options:"=",model:"=",object:"=?",navMenu:"=",snapshot:"=?"},controller:["$scope","qvDefaultViewSelectionService",function(e,t){var i=n();this.updateContent=function(t){var r=e.object;return r&&r.content!==t&&(void 0!==r.content&&(i=n()),r.content=t),i.promise},this.contentLoaded=function(){return i.promise},e.onInit=function(e,n,r){e instanceof m||(e=new(g.extend(e))(n,r,t)),i.resolve(e)}}],link:function(i,r,s,a){function l(e,t,n){var r=h&&i.ext&&!(i.model&&!i.model.isValid&&!i.model.isValidating);return t||(r=r&&e!==d),n||(r=r&&e!==p),r}function c(e){var t=i.ext&&i.ext.support[e];return"function"==typeof t?t.call(null,i.layout):"boolean"==typeof t&&t}var h=i.object={};i.options||(i.options={}),i.options.zoomEnabled=!!s.zoomObject,i.resetOptions=u.extend({},i.options),Object.defineProperties(h,{hasFrame:{get:function(){return!i.options.isPopover&&!h.isInvalid}},isReadonly:{get:function(){return!h||h.isLink||h.isInvalid||i.options.isReadonly}},isInteractive:{get:function(){return!!h&&i.options.interactionState!==v.STATIC}},hasSoftProperties:{get:function(){return!!this.ext&&!!this.ext.mappedSoftDefinition}}}),h.getCreatePropertyHandler=function(){var e=h.model.app;return h.ext.getCreatePropertyHandler(e)},h.getPropertyPanelContent=function(){return h.loaded.then(function(){var e=h.getCreatePropertyHandler();return{definition:h.ext.mappedDefinition||h.ext.definition,globalChangeListeners:h.ext.globalChangeListeners,type:h.type,app:h.model.app,backendApi:h.backendApi,handler:e,iconName:h.ext.libraryInfo.icon,titleRef:"title",ext:h.ext}})},h.getSoftPropertyContent=function(){return h.loaded.then(function(){return{definition:h.ext.mappedSoftDefinition||h.ext.softDefinition,type:h.type,backendApi:h.backendApi}})},h.toggleExploreMenu=function(e){h.showExploreMenu=void 0!==e?e:!h.showExploreMenu},h.setSnapshotData=function(e,t){return a.contentLoaded().then(function(n){return n.setSnapshotData(e,t)})},h.getViewState=function(){return a.contentLoaded().then(function(e){return e.getViewState?e.getViewState():void 0})},h.getPreferredSize=function(){return a.contentLoaded().then(function(e){var t=e.getPreferredSize();return t?t.then(function(e){var t=r.find("footer"),n=r.find("header");return{w:e.w,h:e.h+(t.height()||0)+(n.height()||0)+35+r[0].offsetTop}}):void 0})},h.getSnapshotLayout=function(){return h.loaded.then(function(){return a.contentLoaded().then(function(){return y.prepSnapshotData(h.model.layout,h,!0)})})},h.toggleDataView=function(){return a.contentLoaded().then(function(e){return"function"==typeof e.view.toggleDataView?e.view.toggleDataView(r).then(function(e){h.viewDataToggled=e}):n.resolve()})},h.getDropOptions=function(e,t){return h.loaded.then(function(){return a.contentLoaded().then(function(){return h.ext.getDropOptions(h,e,t)})})},h.getContextMenu=function(e){return a.contentLoaded().then(function(t){return t.getContextMenu(h,e)})},h.getObjectMenu=function(e){return a.contentLoaded().then(function(t){return t.getObjectMenu(h,e)})},h.getSelectionToolbar=function(){return h.loaded.then(function(){return a.contentLoaded().then(function(e){return e.getSelectionToolbar()})})},h.reloadContent=function(){i.ext=h.ext=e.extend({},h.ext),h.loadContent(),h.update()},h.canShowExploreMenu=function(){var e=this.content===d||this.content===p;return!this.isInvalid&&this.hasSoftProperties&&!e},h.supportCssScaling=function(){return l(this.content)&&c("cssScaling")},h.supportSnapshot=function(){if(!l(this.content))return!1;var e=i.ext&&i.ext.snapshot&&i.ext.snapshot.canTakeSnapshot;return void 0===e?c("snapshot"):"function"==typeof e?e.call(null,i.layout):"boolean"==typeof e&&e},h.supportObjectInfo=function(){return!!l(this.content)&&(!h.isInvalid&&this.layout.showDetails)},h.supportExportData=function(){return l(this.content,!1,!0)&&c("exportData")},h.supportExport=function(){return l(this.content)&&c("export")},h.supportSharing=function(){return l(this.content)&&c("sharing")},h.supportViewData=function(){return l(this.content)&&c("viewData")},h.setRenderState=function(e){h&&h.renderState!==e&&(h.renderState=e,i.$emit("objectRenderStateChange",e))},A(i,r,h,a),w(i,h),M(i,h,r,a),T(0,h),h.setRenderState(k.INVALID),h._themeChangeWatcher=function(){h.update()},O.ThemeChanged.bind(h._themeChangeWatcher),o.load(i.options._skipRegisterExtensions).then(function(){_(i,h)}),h.loaded.then(function(){i.cancelled=i.model.isCancelled}),i.$watch("options.interactionState",function(e){var t=isNaN(e)?1:e;h.setInteractionState(t)}),i.$watch("options.direction",function(e){h.setDirection(e)}),i.$watch("options",function(e){e&&e.setController&&a.contentLoaded().then(function(){e.setController(h)})}),i.$on("childSelectionActive",function(e,t){h.childInSelection=t,e.preventDefault()}),i.titleClicked=function(){this.options._disableSelections||h._inEditState||a.contentLoaded().then(function(e){(e.view&&e.view.selections||e.$scope.interactive)&&h.activateSelections()})},i.cancel=function(){h.subscription.cancel(),h.throbberApi.hide(),h.throbberApi.isQueryCanceled=!0},i.retry=function(){h.throbberApi.hide(),h.throbberApi.reset(!0),h.throbberApi.isQueryCanceled=!1,i.model.markAsInvalid(),i.model.getLayout().then(function(e){i.layout=e,h.setLayout(e)})},I(i,h);var f=!1;i.$on("$destroy",function(){f||(f=!0,t.getService("$timeout").cancel(void 0),O.ThemeChanged.unbind(h._themeChangeWatcher),h&&(S(h),h.selectionsApi&&"function"==typeof h.selectionsApi.destroy&&h.selectionsApi.destroy(),h.tooltipApi&&(h.tooltipApi.destroy&&h.tooltipApi.destroy(),h.tooltipApi=null),h.backendApi&&(h.backendApi.destroy(),h.backendApi=null),h.throbberApi&&h.throbberApi.destroy(),h.explore&&h.explore.destroy(),h=null,i.object=null))})}}})}),define("text!general.components/immidiate-contextual/immidiate-contextual.ng.html",[],function(){return"<div qva-outside='onOutsidePopover($event)' ng-class=\"{'lui-immidiateContextual': popupStyle === 'lui', 'qui-immidiateContextual' : popupStyle !== 'lui' }\">\n\t<div class='immidiate-contextual-arrow' ng-hide='hidepointer'></div>\n\t<div class='content' ng-class=\"{ 'no-padding': noPadding && popupStyle === 'lui' }\" ng-transclude></div>\n</div>\n"}),define("text!general.components/immidiate-contextual/immidiate-contextual-small.ng.html",[],function(){return"<div class='qui-immidiateContextual-small' qva-activate='onOutsidePopover($event)' qva-outside='onOutsidePopover($event)'>\n    <div class='immidiate-contextual-arrow' ng-hide='hidepointer'></div>\n    <div class='content' ng-transclude></div>\n</div>\n"}),define("general.components/immidiate-contextual/immidiate-contextual",["jquery","general.utils/window-positioner","general.utils/arrow-positioner","text!general.components/immidiate-contextual/immidiate-contextual.ng.html","text!general.components/immidiate-contextual/immidiate-contextual-small.ng.html","assets/qvangular/qvangular-core","core.utils/resize","general.utils/dom-util","general.utils/responsive-state"],function(e,t,n,i,r,o,s,a,l){o.directive("immidiateContextual",function(){return{replace:!0,template:function(e,t){var n=i;return l.isSmallDevice&&t.smallview&&(n=r),n},transclude:!0,scope:{onCloseView:"&",hidepointer:"=",luiStyle:"=",noPadding:"="},restrict:"E",link:function(i,r,l){i.popupStyle="qui",i.luiStyle&&(i.popupStyle="lui");var c,u,h=e(i.$parent.$eval(l.alignTo)),d=e(i.$parent.$eval(l.offset))[0],p=i.$parent.$eval(l.width),f=i.$parent.$eval(l.top),m=i.$parent.$eval(l.height),g=i.$parent.$eval(l.position),v=i.$parent.$eval(l.limits)||null,y=i.$parent.$eval(l.collision)||"none";void 0!==m&&r.css("height",m||"100"),void 0!==p&&r.css("width",p||"100"),i.onOutsidePopover=function(e){e.stopPropagation(),e.preventDefault(),i.onCloseView({event:e})},e(document).on("keydown.immediateContextual",function(t){var n=a.isInput(document.activeElement);!e(".qui-immidiateContextual").length&&!e(".lui-immidiateContextual").length||n||9!==t.which&&32!==t.which&&27!==t.which||(t.preventDefault(),i.onCloseView({event:t}),i.$apply(),h.hasClass("lui-button")&&h.hasClass("lui-active")&&h.removeClass("lui-active"))}),i.positionMap=function(e){return{topRight:"right",top:"top",topLeft:"left",centerRight:"right",center:"right",centerLeft:"left",bottom:"bottom",bottomLeft:"left",bottomRight:"right"}[e]},i.synchronAlign=function(){i.hidepointer?i.$parent.event&&(c=t.alignToCoordinate(r,i.$parent.event.pageX,i.$parent.event.pageY,l.position)):(d?(c=t.alignToCoordinate(r,d.x,d.y,g),c=i.positionMap(c)):c=t.align(r,h,{position:g,collision:y,limits:v}),r.find("div.immidiate-contextual-arrow").addClass(c),n.align(r,h,c,r.children("div.immidiate-contextual-arrow")))},i.align=function(){void 0!==f&&r.css({top:parseInt(f,10)}),u=o.getService("$timeout")(i.synchronAlign)},i.$on("recalculatePointer",function(){i.hidepointer||n.align(r,h,c,r.children("div.immidiate-contextual-arrow"))}),i.$on("$destroy",function(){o.getService("$timeout").cancel(u),s.off("end",i.align),e(document).off("keydown.immediateContextual")}),s.on("end",i.align),i.align()}}})}),define("objects/listbox-popover/listbox-popover-service",["qvangular","util","core.utils/deferred","objects.models/listbox","client.views/selection-toolbar/selection-toolbar","objects/listbox-popover/listbox-popover","general.utils/responsive-state","text!./listbox-popover.ng.html","objects/object","general.components/immidiate-contextual/immidiate-contextual"],function(e,t,n,i,r,o,s,a){e.service("qvListboxPopoverService",["luiPopover",function(e){var l,c;return{showDelayed:function(i,u,h,d){var p=n();return l&&(c.selectionsActivated=function(){},c.selectionsDeactivated=function(){},l.close()),c={getVisualization:function(){return p.promise},onPopoverClose:this.onPopoverClose,options:{setController:p.resolve,isPopover:!0,showLock:u.showLock,search:u.search||{},smallDevice:s.isSmallDevice,direction:u.direction},selectionToolbarComponent:r,onClose:o},l=e.show({template:a,controller:o.controller,alignTo:u.$alignToElement[0],input:c,closeOnResize:!1,dock:"top"}),i.then(function(e){c.model=e}),c.selectionsActivated=function(){t.isFunction(d)&&d()},c.selectionsDeactivated=function(){t.isFunction(h)&&h(),h=null,d=null},l},show:function(e,t,i,r){return this.showDelayed(n.when(e),t,i,r)},showField:function(e,t,r,o,s,a){return i.createTransientField(t,e,o).then(function(e){return n.resolve(this.show(e,r,s,a))}.bind(this))},showDimension:function(e,t,n,r,o,s){i.createTransientDimension(t,e,r).then(function(e){this.show(e,n,o,s)}.bind(this))},close:function(){l&&l.close(),l=null},onPopoverClose:function(){},getPopover:function(){return l},onClosing:function(){}}}])}),define("assets/hldm/data-connectors/bdi/bdi-field-list",["qvangular","text!./bdi-field-list.ng.html","client.views/state-count-bar/state-count-bar","objects/listbox-popover/listbox-popover-service"],function(e,t){e.nativeComponent("bdiFieldList",{bindings:{name:"<",fields:"<",filter:"<",fieldListOnInit:"&",stateUpdated:"&"},controller:["qvListboxPopoverService",function(e){var t=this;t.$onInit=function(){t.api={},t.api.selectAll=i,t.api.deselectAll=r,t.api.isDisplayed=t.isDisplayed,t.fieldListOnInit({$api:t.api})},t.tableState={checked:!1,indeterminate:!1},t.isDisplayed=function(){if(""===t.filter)return!0;var e=t.filter.toLowerCase();return t.name.toLowerCase().indexOf(e)>-1||t.fields.filter(function(t){return t.qName.toLowerCase().indexOf(e)>-1}).length>0},t.showFilterFor=function(t,n){if(!n.isKeyField){var i={$alignToElement:[t.currentTarget],position:"right",collision:"flipfit"};n.cachedListVisual?e.show(n.cachedListVisual.model,i):e.showDelayed(n.listboxCreation(),i)}},t.updateCheckedStates=function(){var e=t.fields.filter(function(e){return e.selected}).length,n=t.fields.filter(function(e){return!e.isKeyField}).length;0===e?(t.tableState.checked=!1,t.tableState.indeterminate=!1):e===n?(t.tableState.checked=!0,t.tableState.indeterminate=!1):(t.tableState.checked=!1,t.tableState.indeterminate=!0),t.stateUpdated()},t.showStateBar=function(e){return!!e.cachedListVisual&&(e.cachedListVisual.model.layout.qListObject.qDimensionInfo.qStateCounts.qExcluded>0||e.cachedListVisual.model.layout.qListObject.qDimensionInfo.qStateCounts.qSelected>0)},t.tableSelectClicked=function(){n(!t.tableState.checked),t.tableState.checked=!t.tableState.checked,t.tableState.indeterminate=!1,t.stateUpdated()};var n=function(e){t.fields.forEach(function(t){t.isKeyField||(t.selected=e)})},i=function(){n(!0),t.tableState.checked=!0,t.tableState.indeterminate=!1,t.stateUpdated()},r=function(){n(!1),t.tableState.checked=!1,t.tableState.indeterminate=!1,t.stateUpdated()}}],template:t})}),define("text!client.views/current-selections/current-selections.ng.html",[],function(){return'<div class="qv-panel-subtoolbar qv-panel-current-selections" ng-class="{smallDevice: isSmallDevice, light: lightCurSel}">\n\t<div ng-if="!isSmallDevice">\n\t\t<div class="qv-selections-pager">\n\n\t\t\t<div class="buttons borderbox border-bottom border-right">\n\n\t\t\t\t<button\n\t\t\t\t\tclass="qv-subtoolbar-button borderbox"\n\t\t\t\t\tng-hide="hideUndoRedo"\n\t\t\t\t\tng-click="back()"\n\t\t\t\t\tng-disabled="disable.back"\n\t\t\t\t\tq-title-translation="Tooltip.NavigateBack"\n\t\t\t\t\tdata-tid="current-selections-back"\n\t\t\t\t>\n\t\t\t\t\t<i class="lui-icon lui-icon--selections-back"></i>\n\t\t\t\t</button>\n\n\t\t\t\t<button\n\t\t\t\t\tclass="qv-subtoolbar-button borderbox"\n\t\t\t\t\tng-hide="hideUndoRedo"\n\t\t\t\t\tng-click="forward()"\n\t\t\t\t\tng-disabled="disable.forward"\n\t\t\t\t\tq-title-translation="Tooltip.NavigateForward"\n\t\t\t\t\tdata-tid="current-selections-forward"\n\t\t\t\t>\n\t\t\t\t\t<i class="lui-icon lui-icon--selections-forward"></i>\n\t\t\t\t</button>\n\n\t\t\t\t<button\n\t\t\t\t\tid="clearselections"\n\t\t\t\t\tclass="qv-subtoolbar-button borderbox"\n\t\t\t\t\tng-disabled="disable.clear"\n\t\t\t\t\tng-hide="hideClearSelections"\n\t\t\t\t\tng-click="clearAllFields()"\n\t\t\t\t\tq-title-translation="Tooltip.ClearSelections"\n\t\t\t\t\tdata-tid="current-selections-clear"\n\t\t\t\t>\n\t\t\t\t\t<i class="lui-icon lui-icon--clear-selections"></i>\n\t\t\t\t</button>\n\n\t\t\t</div>\n\t\t\t<div class="selections-shadow" ng-if="showShadow"></div>\n\t\t\t<div class="wrap borderbox" style="height: 100%;" qv-pager qv-selection-pager>\n\t\t\t\t<ul class="list" ng-show="items.length > 0 && !isGlobalSelectionsActive" qva-delegated-activate=".item#showPopover($event)" qva-outside-ignore-for="currentSelectionsItems">\n\t\t\t\t\t<li ng-repeat="item in items track by item.qField" data-csid="{{item.qField}}">\n\t\t\t\t\t\t<div class="item current-selection-elem" ng-mousemove="openTooltip($event, item)" ng-mouseleave="closeTooltip()" ng-class="{\n\t\t\t\t\'active\' : item.qField === activeFieldName,\n\t\t\t\t\'dim\' : $parent.itemSelected && !item.active,\n\t\t\t\t\'item-locked\' : item.qLocked,\n\t\t\t\t\'locked-feedback item-animate-in\' : item.feedbackActive && item.qLocked,\n\t\t\t\t\'item-animate-out\' : !item.feedbackActive && item.qLocked }">\n\t\t\t\t\t\t\t<div ng-class="{locked:item.qLocked}" class="text">\n\t\t\t\t\t\t\t\t<div class="text-wrap">\n\t\t\t\t\t\t\t\t\t<span ng-class="{ \'lui-icon lui-icon--lock\': item.qLocked }"></span><span class="name">{{item.name}}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<span class="values">{{item.translation}}</span>\n\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\n\t\t\t\t\t\t\t<div class="options">\n\t\t\t\t\t\t\t\t<a ng-if="!item.qLocked && !item.isPlaceHolder" ng-click="clear(item.qField)" class="remove" q-title-translation="CurrentSelections.Remove">\n\t\t\t\t\t\t\t\t\t<span class="lui-clear-all lui-icon lui-icon--remove"></span>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<qv-state-count-bar ng-if="!item.isPlaceHolder" state-counts="item.qStateCounts"></qv-state-count-bar>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\n\t\t\t\t<div ng-if="!items.length && !haveHiddenSelections" class="empty-text no-selection borderbox" q-translation="CurrentSelections.NoSelections"></div>\n\t\t\t\t<div ng-if="!items.length && haveHiddenSelections" class="empty-text no-selection borderbox" q-translation="CurrentSelections.OnlyHiddenSelections"></div>\n\t\t\t\t<a class="qv-pager-nav qv-pager-previous" ng-class="{inverted: lightCurSel}" ng-click="prevPage()" q-title-translation="Tooltip.Previous"><i class="lui-icon lui-icon--arrow-left"></i></a>\n\t\t\t\t<a class="qv-pager-nav qv-pager-next" ng-class="{inverted: lightCurSel}" ng-click="nextPage()" q-title-translation="Tooltip.Next"><i class="lui-icon lui-icon--arrow-right"></i></a>\n\t\t\t</div>\n\t\t\t<div class="buttons-end borderbox border-left">\n\t\t\t\t<div tid="toggleCaoButton" tabindex="0" class="qv-subtoolbar-button toggle-button borderbox" ng-if="options && options.enableCao" ng-class="{active: isCaoActive}" ng-click="toggleCao()" q-title-translation="{{isCaoActive ? \'cao.CloseCognitiveAssociativeOverlay\' : \'cao.CognitiveAssociativeOverlay\'}}">\n\t\t\t\t\t<i class="lui-icon lui-icon--debug icon"></i> \x3c!-- Placeholder icon --\x3e\n\t\t\t\t</div>\n\t\t\t\t<div tid="toggleGlobalSearchButton" tabindex="0" class="qv-subtoolbar-button toggle-button borderbox" ng-hide="hideSearch" ng-class="{active: isGlobalSearchActive, indexing: isGlobalSearchIndexing}" ng-click="toggleGlobalSearch()" q-title-translation="{{isGlobalSearchActive ? \'Tooltip.CloseGlobalSearch\' : \'Tooltip.GlobalSearch\'}}">\n\t\t\t\t\t<i class="lui-icon lui-icon--search icon"></i>\n\t\t\t\t\t<div class="label" q-translation="GlobalSearch.Preparing" q-title-translation="GlobalSearch.Preparing.Tooltip"></div>\n\t\t\t\t\t<qv-progress-bar ng-if="isGlobalSearchIndexing" percent-done="indexPercentDone" on-completed="setSearchIndexingDone()" options="progressBarOptions"></qv-progress-bar>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="qv-subtoolbar-button toggle-button borderbox" tabindex="0" ng-class="{active: isGlobalSelectionsActive}" ng-hide="hideSelectionsTool" ng-click="toggleGlobalSelection($event)"\n\t\t\t\t\tq-title-translation="{{isGlobalSelectionsActive ? \'Tooltip.CloseGlobalSelector\' : \'Tooltip.GlobalSelector\'}}" tid="currentSelections.toggleGlobalSelections">\n\t\t\t\t\t<i class="lui-icon lui-icon--selections-tool"></i>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t</div>\n\t</div>\n\t<div ng-if="isSmallDevice && mobileIndicatorShow && !inSelection " ng-click="toggleGlobalSelection($event)" class="qv-current-selections-mobile-wrapper" tid="currentSelections.toggleMobileSelections" q-title-translation="GlobalSelections.CurrentSelections">\n\t\t<div class="qv-current-selections-mobile-background">\n\t\t\t<p class="qv-current-selections-mobile-nbr" ng-class="{selections: nbrSelections > 0}">{{nbrSelections}}</p>\n\t\t</div>\n\t</div>\n</div>'}),define("text!client.views/current-selections/current-selections-tooltip-template.ng.html",[],function(){return'<div qva-direction x-dir-setting={{options.direction}}" class="qv-tooltip qvt-generic-tooltip" ng-class="{\'above\':alwaysOnTop}">\n\t<div ng-repeat="item in content">\n\t\t<div qva-direction x-dir-text="{{item.header}}" x-dir-setting="{{options.direction}}" class="qv-tp-header">\n\t\t\t<strong>{{item.header}}</strong>\n\t\t</div>\n\t\t<table>\n\t\t\t<tr ng-repeat="row in item.rows" class="qv-tp-row">\n\t\t\t\t<td class=\'qv-tp-item\'>\n\t\t\t\t\t<div qva-direction x-dir-text="{{row.content}}" class="qv-tp-rowContent fade-out">{{row.content}}</div>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\t</div>\n</div>'}),define("general.utils/qv-keyboard-shortcuts",["jquery","general.utils/dom-util"],function(e,t){"use strict";function n(){this.groups=[],this.shortcuts=[],this.timer={id:null},this.isReleased=!0,this.currentEvent=void 0}var i={a:65,alt:18,b:66,backspace:8,c:67,ctrl:17,d:68,del:46,down:40,e:69,end:35,f:70,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,enter:13,esc:27,g:71,h:72,home:36,i:73,insert:45,j:74,k:75,l:76,left:37,m:77,n:78,o:79,p:80,pagedown:34,pageup:33,q:81,r:82,right:39,s:83,shift:16,space:32,t:84,tab:9,u:85,up:38,v:86,w:87,win:224,x:88,y:89,z:90,cmd:91,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,0:48,"*":106},r=!1;return n.prototype.createGroup=function(e,t){var n,i,r=this;for(i=0;i<this.groups.length;i++)if(this.groups[i].name===e){n=this.groups[i];break}if(n)throw"Keyboard shortcut group already exist: "+e;return n={name:e,priority:t,active:!1,shortcuts:[]},this.groups.push(n),this.groups.sort(function(e,t){return e.priority-t.priority}),{registerKeys:function(e,t,i){r.registerKeys(n,e,t,i)},unregisterKeys:function(e,t){for(var i=n.shortcuts,r=0;r<i.length;r++)if(i[r].keyCombo===e&&i[r].callback===t){i.splice(r,1);break}},on:function(){r.activateGroup(n)},off:function(){r.deactivateGroup(n)},delete:function(){r.deactivateGroup(n),r.deleteGroup(n)}}},n.prototype.activateGroup=function(t){var n=this;t.active=!0,r||(r=!0,e(document).on("keydown.qvKeyboardShortcuts",function(e){n.handleEvent(e)}))},n.prototype.deactivateGroup=function(t){t.active=!1,0===this.groups.reduce(function(e,t){return t.active&&e++,e},0)&&r&&(r=!1,e(document).off("keydown.qvKeyboardShortcuts"))},n.prototype.deleteGroup=function(e){this.groups=this.groups.filter(function(t){return t!==e})},n.prototype.registerKeys=function(e,t,n,r){var o=t.toLowerCase().split("+"),s={keyCombo:t,ctrlKey:!1,shiftKey:!1,altKey:!1,keyCode:null,name:"",callback:null,allowInAllContexts:!!(r&&"allowInInput"in r)&&r.allowInInput,preventDefault:!(r&&"preventDefault"in r)||r.preventDefault,delay:r&&"delay"in r?r.delay:250};for(var a in i)for(var l=0;l<o.length;l++)s.name=t.toLowerCase(),s.callback=n,"ctrl"!==o[l]&&"cmd"!==o[l]||(s.ctrlKey=!0),"alt"===o[l]&&(s.altKey=!0),"shift"===o[l]&&(s.shiftKey=!0),o[l]===a&&17!==i[a]&&16!==i[a]&&91!==i[a]&&18!==i[a]&&(s.keyCode=i[a]);e.shortcuts.push(s)},n.prototype.preventDefault=function(){this.currentEvent&&this.currentEvent.preventDefault()},n.prototype.handleEvent=function(e){function n(t,n,o,s){for(var l,c,u=0;u<a.groups.length;u++)if((l=a.groups[u]).active)for(var h=l.shortcuts.length-1;h>=0&&((c=l.shortcuts[h]).keyCode!==i["*"]&&(c.keyCode!==s||c.ctrlKey!==t||c.shiftKey!==n||c.altKey!==o)||r(e,c));h--);}function r(e,n){return!(t.isInput(document.activeElement)&&!n.allowInAllContexts)&&o(e,n)}function o(e,t){if(t.preventDefault&&e.preventDefault(),"number"!=typeof a.timer.id&&(t.delay>0&&(a.timer.id=setTimeout(function(){s()},t.delay)),!0===t.callback(t,e)))return s(),!0}function s(){clearTimeout(a.timer.id),delete a.timer.id}var a=this;this.currentEvent=e,e.shiftKey?!e.ctrlKey&&!e.metaKey||e.altKey?e.ctrlKey||e.metaKey||!e.altKey?n(!1,!0,!1,e.which):n(!1,!0,!0,e.which):n(!0,!0,!1,e.which):!e.ctrlKey&&!e.metaKey||e.altKey?e.ctrlKey||e.metaKey||!e.altKey?n(!1,!1,!1,e.which):n(!1,!1,!0,e.which):n(!0,!1,!1,e.which)},new n}),define("client.views/current-selections/current-selection-keyboard-shortcuts",["jquery","qvangular","general.utils/qv-keyboard-shortcuts"],function(e,t,n){return function(i){function r(){n.preventDefault(),t.$rootScope.$apply()}var o={preventDefault:!1,allowInInput:!1};this.keyboardShortcutsGroup=n.createGroup("current-selection-"+i.app.id,1),this.keyboardShortcutsGroup.registerKeys("ctrl+shift+y",function(){i.inSelection&&e(document).trigger("qv-press"),i.forward(),r()},o),this.keyboardShortcutsGroup.registerKeys("ctrl+shift+z",function(){i.inSelection&&e(document).trigger("qv-press"),i.back(),r()},o),this.keyboardShortcutsGroup.on(),this.on=function(){this._isOn||(this.keyboardShortcutsGroup.on(),this._isOn=!0)},this.off=function(){this._isOn&&(this.keyboardShortcutsGroup.off(),this._isOn=!1)},this.delete=function(){this.keyboardShortcutsGroup.delete()}}}),define("widget.pager",["jquery","jqueryui"],function(e){return e.widget("qv.pager",{options:{itemSelector:">li",orientation:"horizontal",pageSize:"auto",startPage:1,animationDuration:300},_create:function(){var t=this.options;e.extend(this,{positionProperty:"horizontal"===t.orientation?"left":"top",sizeProperty:"horizontal"===t.orientation?"outerWidth":"outerHeight"}),this.refresh(),this.goToPage(t.startPage)},isItemInsidePage:function(t){var n=e(t),i=n.position()[this.positionProperty]+n[this.sizeProperty](),r=Math.abs(parseFloat(n.parent().css("margin-"+this.positionProperty))),o=r+this.containerSize;return i>r&&i<o},calculatePageSize:function(){return Math.floor(this.containerSize/this.calculateItemSize())},calculateItemSize:function(){return this.element.find(this.options.itemSelector).eq(0)[this.sizeProperty]()},refresh:function(){var e=this.currentPage||1;this.containerSize=this.element.parent()[this.sizeProperty](),this.pageSize="auto"===this.options.pageSize?this.calculatePageSize():this.options.pageSize,this.itemSize=this.calculateItemSize(),this.maxPages=Math.ceil(this.element.find(this.options.itemSelector).length/this.pageSize||1),this.currentPage=Math.min(e,this.maxPages),this.goToPage(this.currentPage)},goToPage:function(e){this.currentPage=Math.min(Math.max(1,e),this.maxPages);var t=(this.currentPage-1)*this.itemSize*this.pageSize,n={};n[this.positionProperty]=-t+"px",this.element.stop(!0).animate(n,this.options.animationDuration)},goToPreviousPage:function(){this.goToPage(this.currentPage-1)},goToNextPage:function(){this.goToPage(this.currentPage+1)},goToPageContaining:function(e){var t=Math.ceil(this.element.find(e).index()+1/this.pageSize);this.goToPage(t)},_destroy:function(){this.element.off(this.eventNamespace)}}),e}),define("general.components/pager/pager",["qvangular","core.utils/resize","general.utils/support","widget.pager"],function(e,t,n){e.directive("qvPager",["$timeout",function(e){return{restrict:"A",priority:0,link:function(i,r){function o(){i.refreshPager()}n.treatAsDesktop()||r.css("overflow-x","auto"),i.pagerData=r.find("ul").pager().data("qv-pager"),r.addClass("qv-pager"),i.nextPage=function(){e(function(){i.pagerData.goToNextPage(),i.refreshPager(!0)})},i.prevPage=function(){e(function(){i.pagerData.goToPreviousPage(),i.refreshPager(!0)})},i.goToPage=function(e){i.pagerData.goToPage(e),i.refreshPager(!0)},i.refreshPager=function(e){var t="";e||i.pagerData.refresh(),r.removeClass("qv-pager-back qv-pager-forward"),1!==i.pagerData.currentPage?(i.showShadow=!0,t+="qv-pager-back "):i.showShadow=!1,i.pagerData.currentPage!==i.pagerData.maxPages&&(t+="qv-pager-forward "),r.addClass(t)},i.$on("refreshPager",o),i.$on("$destroy",function(){t.off("end",o)})}}}])}),define("text!client.views/global-selections/global-selections.ng.html",[],function(){return'<div class="qv-global-selections" ng-class="{\'toolbar\': toolbar, \'selection-toolbar-open\': selectionToolbarOpen}">\n\n\t<section class="qv-gs-section qv-gs-top" tid="globalSelections.topSection">\n\t\t<header class="qv-gs-header">\n\t\t\t<h2 q-translation="GlobalSelections.CurrentSelections"></h2>\n\t\t</header>\n\t\t<div qv-global-select-section="{ itemSize: 220, itemSpacing: 20, type: \'fields\' }" all-items="selectedFields" app="app"></div>\n\t</section>\n\n\t<section class="qv-gs-section" tid="globalSelections.bottomSection">\n\t\t<header class="qv-gs-header">\n\t\t\t<h2 q-translation="GlobalSelections.AppDimensions"></h2>\n\t\t\t<lui-checkbox x-variant="inverse" x-model="showFields" title="{{\'GlobalSelections.ShowFields\'|translate}}" tid="globalSelections.showFields">{{\'GlobalSelections.ShowFields\'|translate}}</lui-checkbox>\n\t\t\t<lui-search x-variant="inverse" class="qv-gs-searchfield" placeholder="{{showFields ? \'GlobalSelections.FilterDimensionsAndFields\' : \'GlobalSelections.FilterDimensions\'}}" query="filter" maxlength="255"\n\t\t\t\t\t\t\t tid="globalSelections.searchField" on-escape="filter = \'\';" auto-focus="autoFocus" on-enter="onEnter($event)"></lui-search>\n\t\t</header>\n\n\t\t<div class="qv-gs-info" ng-if="!dimAvailable && !showFields">\n\t\t\t<h2 q-translation="GlobalSelections.DimensionsWarning"></h2>\n\t\t</div>\n\t\t<div class="qv-gs-info" ng-if="showNoMatches">\n\t\t\t<h2 q-translation="GlobalSelections.NoMatchesForSearch"></h2>\n\t\t</div>\n\t\t<div qv-global-select-section="{ itemSize: 220, itemSpacing: 20, type: \'dimensions\'}" all-items="dimensionsFields" filter="filter" app="app"></div>\n\n\t</section>\n</div>\n'}),define("client.services/stage-state",["core.utils/deferred","jquery"],function(e,t){var n={};return n.reset=function(){n.selectedObject=null,n.assetsOpen=!0,n.propertiesOpen=void 0},n.setSelectedObject=function(i){var r={id:"",type:"",customObject:null,canCopy:function(){return!0},copy:null,canCut:function(){return!0},cut:null,paste:null,canRemove:function(){return!0},remove:null,getAllPropertyPanelContent:function(){var t={objectType:"",iconClass:"",titleRef:"",definition:{},properties:{},layout:{},localeInfo:null,app:null,cache:null,ext:null,globalChangeListeners:null,handler:null,model:null};return e.resolve(t)}};i?(t.extend(r,i),n.selectedObject=r):n.selectedObject=null},n.reset(),n}),define("client.assets/assets-utils",["jquery","qvangular","util","pubsub","client.utils/state","client.services/stage-state","translator"],function(e,t,n,i,r,o,s){function a(e,n){t.getService("qvConfirmDialog").show({message:s.get(e),icon:"cogwheel"}).closed.then(function(e){e&&n.apply()})}var l;return{init:function(t,n){t&&(l=e.extend({},t,n))},getContextMenuAddToText:function(e){var t=o.selectedObject;return e&&"odaglinks"===e?"library.addtoAppNavigation":t&&"sheetCell"===t.type?"contextMenu.addToSheet":"contextMenu.addToVisualization"},getAddToOptions:function(){var e=o.selectedObject,t=null;return e&&r.isInEditMode()&&(t={},"gridCell"===e.type?t.object=!0:"sheetCell"===e.type&&(t.sheet=!0)),t},getAddToText:function(e){var t=o.selectedObject;return t&&r.isInEditMode()?e&&"odaglinks"===e?"library.addtoAppNavigation":"gridCell"===t.type?"library.addtoVisualization":"sheetCell"===t.type?"library.addtosheet":"":null},addItemToSheetOrVisualization:function(e,t){if(this.isAddToMode()){var n=o.selectedObject,r={item:e};t&&(r.event=t),n&&"gridCell"===n.type&&(r.cell=n.customObject),i.publish("/ui/library/addToSheet",r)}},librarySearchFn:function(e,t,i){return!t||""===t||(i=i||function(e,t){return n.match([e.name],t)})(e,t.toLowerCase())},libraryMultiSearch:function(e,t,i){if(e.match={},!t||""===t)return!0;t=t.toLowerCase();for(var r=!1,o=0;o<i.length;++o){var s=i[o];n.match(e[s],t)&&(r=!0,e.match[s]=!0)}return r},itemDblClickHandler:function(e){this.isAddToSheetMode()&&i.publish("/ui/library/addToSheet",{item:e})},removeDialog:a,editDialog:a,hasLinks:function(e,t){return t.get(e).then(function(e){return e.getLinkedObjects().then(function(e){return 0!==e.length})})},toggleSelection:function(t,n){var i=e(n.currentTarget);return t.selected=!t.selected,t.selected?(i.on("qv-outside",function(n){var r=e(n.target);1!==r.closest("#library-preview").length&&1!==r.closest(".qv-contextmenu").length&&(t.selected=!1,i.off("qv-outside"))}),!0):(i.off("qv-outside"),!1)},removeSelection:function(t){e.each(t,function(e,t){t.selected=!1})},localeOrderBy:function(e,t){if(e){var n=function(e,t){return e.localeCompare(t,s.language)};t&&t instanceof Function&&(n=function(e,n){return t(e).localeCompare(t(n),s.language)}),e.sort(n)}return e},isAddToSheetMode:function(){return r.isInEditMode()&&r.view===r.Views.sheet&&r.model.layout.permissions.update},isAddToVisualizationMode:function(){return r.isInEditMode()&&(r.view===r.Views.object&&r.model.layout.permissions.update||r.view===r.Views.masterObject)},isAddToMode:function(){return this.isAddToSheetMode()||this.isAddToVisualizationMode()},hasAppUpdatePermssion:function(){return l.update},permissionToCreate:function(e){if(!l)throw new TypeError("Permissions are not available yet. Make sure you have initialized this module with init().");switch(e){case"measure":return l.createMeasure;case"dimension":return l.createDimension;case"visualization":return l.createMasterobject;case"odagLink":return l.createOdagLink;default:throw new TypeError("'"+e+"' is an unknown type.")}}}}),define("text!client.views/global-selections/directives/scroll/scroll.ng.html",[],function(){return'<div class="qv-gs-scroll-container">\n\t<qv-scroll-area class="qv-gs-scroll-area">\n\t\t<div ng-if="scrollApi.loadPrevious" class="qv-gs-scroll-btn qv-gs-scroll-btn-previous" tid="globalSelections.loadPrevious">\n\t\t\t<qv-scroll-load-button tag="div" class="qv-listbox-load-buttons" on-load="scrollApi.gotoPreviousBlock()" text="Object.Listbox.LoadPrevious" previous="true"></qv-scroll-load-button>\n\t\t</div>\n\t\t<div ng-repeat="item in items" class="qv-gs-listbox">\n\t\t\t<qv-object ng-if="item.visible" model="item.model" options="item.options" object="item.object" class="qv-object-listbox" id="{{item.id}}"></qv-object>\n\t\t\t<div ng-if="!item.visible" class="qv-object qv-object-listbox qv-gs-placeholder" id="{{item.id}}">\n\t\t\t\t<h1 class="qv-object-title" qva-direction x-dir-text="{{item.title}}">\n\t\t\t\t\t<span class="qv-object-title-text" qva-direction x-dir-text="{{item.title}}">{{item.title}}</span>\n\t\t\t\t</h1>\n\t\t\t\t<div class="progress">\n\t\t\t\t\t<qv-rain></qv-rain>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<p ng-if="item.qField" q-title-translation="Common.Field" tid="globalSelections.fieldIndicator" class="qv-gs-field-indicator" qva-direction>\n\t\t\t\t<span class="lui-icon  lui-icon--field"></span>\n\t\t\t</p>\n\t\t\t<qv-gs-badge></qv-gs-badge>\n\t\t</div>\n\t\t<div ng-if="scrollApi.loadNext" class="qv-gs-scroll-btn" tid="globalSelections.loadNext">\n\t\t\t<qv-scroll-load-button tag="div" class="qv-listbox-load-buttons" on-load="scrollApi.gotoNextBlock()" text="Object.Listbox.LoadMore"></qv-scroll-load-button>\n\t\t</div>\n\t</qv-scroll-area>\n\t<qv-scroll-loader tag="li" class="qv-scroll-row-loader"></qv-scroll-loader>\n</div>\n'}),define("general.scroll/api/dom-api",["core.utils/class","touche"],function(e,t){"use strict";function n(){return".grid-object-dom-api-"+ ++i}var i=0;return e.extend({init:function(e,t,i,r,o,s){s=s||".scroll-content",this.$element=e,this.$scrollArea=t,this.$scrollContent=t.find(s),this.rowSelector=i,this.firstRowSelector=r,this.lastRowSelector=o,this.namespace=n()},destroy:function(){this.unbindNativeScroll()},bindNativeScroll:function(e){this.$scrollArea.on("scroll"+this.namespace,e)},unbindNativeScroll:function(){this.$scrollArea.off(this.namespace)},resetNativeScroll:function(){this.$scrollArea.scrollTop(0)},preventNativeScroll:function(){var e="mousewheel"+this.namespace+" DOMMouseScroll"+this.namespace+" mousemove"+this.namespace;return this.$scrollArea.on(e,function(e){e.preventDefault()}),t(this.$scrollArea[0]).tap({id:this.namespace}),function(){this.$scrollArea.off(e),t(this.$scrollArea[0]).off("tap",this.namespace)}.bind(this)},getBoundingBox:function(){return this.$element[0].getBoundingClientRect()},getClientWidth:function(){return this.$element[0].clientWidth},getClientHeight:function(){return this.$element[0].clientHeight},getScrollAreaBoundingBox:function(){return this.$scrollArea[0].getBoundingClientRect()},getScrollAreaClientWidth:function(){return this.$scrollArea[0].clientWidth},getScrollAreaClientHeight:function(){return this.$scrollArea[0].clientHeight},getScrollAreaOffsetTop:function(){return this.$scrollArea[0].offsetTop},getScrollContentBoundingBox:function(){return this.$scrollContent[0].getBoundingClientRect()},getFirstRow:function(){return this.$scrollArea.find(this.firstRowSelector)},getLastRow:function(){return this.$scrollArea.find(this.lastRowSelector)},getVisibleRowCount:function(e){function t(e,t){var n=e.getBoundingClientRect();return Math.round(n.bottom-t.bottom)<1}function n(e,t){var n=t-e;return 1===n?t:Math.floor(e+n/2)}function i(e,r,o,s){var a=o-r,l=n(r,o),c=t(e[l],s);return 0===a?c?l:-1:1===a?c?l:i(e,r,r,s):c?i(e,l,o,s):i(e,r,l,s)}var r=this.$element[0].querySelectorAll(this.rowSelector);if(0===r.length)return 0;if(r=Array.prototype.slice.call(r),0===(r=r.filter(function(e){return e.nodeType===Node.ELEMENT_NODE})).length)return 0;var o=this.getScrollAreaBoundingBox(),s=i(r,0,r.length-1,o)+1;if(s===r.length){var a=r[r.length-1].getBoundingClientRect(),l=Math.round(o.bottom-a.bottom);s+=Math.floor(l/e)}return s},alignToFirstRow:function(){var e=this.getFirstRow();return function(){var t=e.position().top-48;this.$scrollArea.scrollTop(t)}.bind(this)},alignToLastRow:function(){var e=this.getLastRow();return function(){this.$scrollArea.scrollTop(0);var t=e.position().top-this.getScrollAreaBoundingBox().height+e[0].getBoundingClientRect().height+48;this.$scrollArea.scrollTop(t)}.bind(this)}})}),define("general.scroll/api/data-api",["core.utils/deferred","core.utils/class"],function(e,t){"use strict";return t.extend({getRowCount:function(){return 0},getFirstElementIndex:function(){return-1},getLastElementIndex:function(){return-1},getIndexOf:function(e){return e.getIndex()},onVirtualScroll:function(){return e.resolve()},onGotoNextBlock:function(){return e.resolve()},onGotoPreviousBlock:function(){return e.resolve()},onInitialNativeScroll:function(){return e.resolve()}})}),define("general.scroll/scroll-area-service",["qvangular"],function(e){"use strict";e.service("qvScrollAreaService",function(){function e(e){if("rtl"===e.textDirection&&"horizontal"===e.direction){var t=e.showMinAffordance;e.showMinAffordance=e.showMaxAffordance,e.showMaxAffordance=t}}return{createScrollbar:function(){return{vLength:0,vViewportLength:0,vPos:0,vPage:0,thumb:{},style:{},classList:[],enabled:!1,getScrollDelta:function(e){var t=0,n=0;if(!this.enabled)return[0,0];switch(this.direction){case"vertical":n=e.swipe.curDeltaY*(1/this.scaleFactor);break;case"horizontal":t=("rtl"===this.textDirection?-1:1)*e.swipe.curDeltaX*(1/this.scaleFactor);break;default:throw"not implemented"}return[t,n]},active:!1}},setScrollbarData:function(t,n,i,r,o,s,a){var l;switch(n){case"vertical":l=s.height;break;case"horizontal":l=s.width;break;default:throw"not implemented"}if(t.enabled=o<r&&l>0,t.enabled){switch(l-=6,t.uiOffset=3,t.direction=n,t.vLength=r,t.vViewportLength=o,t.vPos=0,t.vPage=l,t.length=l,t.trackSize=i,t.scaleFactor=l/r,t.thumb.pos=0,t.thumb.size=0,t.thumb.vPos=0,t.showMinAffordance=!1,t.showMaxAffordance=!0,t.textDirection=a,t.direction){case"vertical":t.style.top=s.top+t.uiOffset+"px",t.style.width=i+"px",t.style.left="rtl"===a?t.uiOffset+"px":s.left+s.width-i-t.uiOffset+"px",t.style.height=s.height-2*t.uiOffset+"px";break;case"horizontal":t.style.height=i+"px",t.style.top=s.top+s.height-i-t.uiOffset+"px",t.style.left=s.left+t.uiOffset+"px",t.style.width=s.width-2*t.uiOffset+"px";break;default:throw"not implemented"}e(t)}},setVirtualScrollPos:function(t,n,i){var r=n.vLength-n.vViewportLength,o=0,s=n.thumb.vPos;return n.enabled?(n.vPos+=t,n.showMinAffordance=!1,n.showMaxAffordance=!1,n.vPos<0?(s=0,n.vPos=i?n.vPos:0,n.showMaxAffordance=!0):n.vPos>r?(s=r,n.vPos=i?n.vPos:r,n.showMinAffordance=!0):(0!==n.vPos&&(n.showMinAffordance=!0),n.vPos!==r&&(n.showMaxAffordance=!0),s=n.vPos),o=s-n.thumb.vPos,n.thumb.vPos=s,e(n),o):0},setThumbStyle:function(e,t){var n=t.thumb,i=t.scaleFactor,r=Math.floor(n.vPos*i),o=Math.floor(t.vViewportLength*i);switch(o<12&&(r-=Math.floor((12-o)/2),o=12),(r=Math.max(r,0))+o>t.length&&(r=t.length-o),n.size=o,n.pos=r,t.direction){case"vertical":e.top=r+"px",e.height=o+"px";break;case"horizontal":"rtl"===t.textDirection?(delete e.left,e.right=r+"px"):(delete e.right,e.left=r+"px"),e.width=o+"px";break;default:throw"not implemented"}},setTrackHitAreaStyle:function(e,t,n){"vertical"===t.direction?(e.right=-t.uiOffset+"px",e.width=n+t.uiOffset+"px"):(e.bottom=-t.uiOffset+"px",e.height=n+t.uiOffset+"px")}}})}),define("general.scroll/scroll-area-controller",["general.utils/support","general.scroll/scroll-area-service"],function(e){"use strict";return["$scope","$element","qvScrollAreaService",function(t,n,i){var r,o,s,a,l=[],c=[],u=[];t.interactiveX=!1,t.interactiveY=!1,t.virtualSize={width:0,height:0},t.virtualViewport={width:0,height:0},t.scrollbarX=i.createScrollbar(),t.scrollbarY=i.createScrollbar(),t.viewportRect={top:0,left:0,width:0,height:0},t.hover=!1,t.isMouse=!0,t.$on("$destroy",function(){clearTimeout(s),clearTimeout(a)}),this.setMouse=function(e){t.isMouse=e},this.getScrollAreaRect=function(){var e=n[0].getBoundingClientRect();return{top:0,left:0,width:Math.ceil(e.width),height:Math.ceil(e.height)}},this.addScrollbarXCtrl=function(e){r=e},this.addScrollbarYCtrl=function(e){o=e},this.allowFade=function(){return(void 0===r||r.allowFade())&&(void 0===o||o.allowFade())},this.fadeScrollbarsWithoutDelay=function(){r&&r.fadeOut(),o&&o.fadeOut()},this.toggleFadeScrollbars=function(e){clearTimeout(a),clearTimeout(s),(e||this.allowFade())&&(s=setTimeout(function(){var t=e?"fadeIn":"fadeOut";r&&r[t](),o&&o[t]()},e?0:800))},this.fadeInScrollbars=function(){this.toggleFadeScrollbars(!0)},this.fadeOutScrollbars=function(){e.treatAsDesktop()&&t.hover||this.toggleFadeScrollbars(!1)},this.fadeOutScrollbarsDelayed=function(){clearTimeout(a),a=setTimeout(function(){this.toggleFadeScrollbars(!1)}.bind(this),1e3)},this.setNonMouseTrackSize=function(){"object"==typeof t.nonMouseViewportScrolling&&(n.addClass(t.nonMouseViewportScrolling.className),this.setTrackSize(t.nonMouseViewportScrolling.scrollbarSize))},this.setMouseTrackSize=function(){"object"==typeof t.nonMouseViewportScrolling&&n.removeClass(t.nonMouseViewportScrolling.className),this.setTrackSize(t.scrollbarSize)},this.setTrackSize=function(e){var n=this.getVirtualPosition();this.setVirtualSize(t.virtualSize,t.virtualViewport,t.viewportRect,e),this.setVirtualScrollPos(n.vPosX,n.vPosY)},this.setupScrollbars=function(e){e=e||8,i.setScrollbarData(t.scrollbarY,"vertical",e,t.virtualSize.height,t.virtualViewport.height,t.viewportRect,t.direction),i.setScrollbarData(t.scrollbarX,"horizontal",e,t.virtualSize.width,t.virtualViewport.width,t.viewportRect,t.direction),t.scrollbarX.enabled&&t.scrollbarY.enabled&&(t.scrollbarX.length-=e,t.scrollbarX.scaleFactor=t.scrollbarX.length/t.virtualSize.width,t.scrollbarX.style.width=t.viewportRect.width-e-2*t.scrollbarX.uiOffset+"px","rtl"===t.direction&&(t.scrollbarX.style.left=t.viewportRect.left+t.scrollbarX.uiOffset+e+"px"),t.scrollbarY.length-=e,t.scrollbarY.scaleFactor=t.scrollbarY.length/t.virtualSize.height,t.scrollbarY.style.height=t.viewportRect.height-e-2*t.scrollbarY.uiOffset+"px")},this.setVirtualSize=function(e,n,i,r){t.viewportRect=i,t.virtualSize.width=e.width,t.virtualSize.height=e.height,t.virtualViewport.width=n.width,t.virtualViewport.height=n.height,this.setupScrollbars(r)},this.setViewport=function(e){t.viewportRect=e},this.setVirtualViewport=function(e){var n=this.getVirtualPosition();t.virtualViewport.width=e.width,t.virtualViewport.height=e.height,t.scrollbarX.vViewportLength=e.width,t.scrollbarY.vViewportLength=e.height,this.setupScrollbars(t.isMouse?t.scrollbarSize:t.nonMouseViewportScrolling.scrollbarSize),this.setVirtualScrollPos(n.vPosX,n.vPosY)},this.getVirtualSize=function(){return{width:t.virtualSize.width,height:t.virtualSize.height}},this.getVirtualPosition=function(){var e=this.getMaxPosition();return{vPosX:Math.max(0,Math.min(e.vPosX,t.scrollbarX.vPos)),vPosY:Math.max(0,Math.min(e.vPosY,t.scrollbarY.vPos))}},this.getMaxPosition=function(){return{vPosX:Math.max(0,t.scrollbarX.vLength-t.scrollbarX.vViewportLength),vPosY:Math.max(0,t.scrollbarY.vLength-t.scrollbarY.vViewportLength)}},this.isMouseOver=function(){return t.hover},this.resetScroll=function(){void 0!==t.scrollbarX.vPos&&void 0!==t.scrollbarY.vPos&&(0===t.scrollbarX.vPos&&0===t.scrollbarY.vPos||this.scroll(-t.scrollbarX.vPos,-t.scrollbarY.vPos,!0,!1))},this.setVirtualScrollPos=function(e,n,r){i.setVirtualScrollPos(e,t.scrollbarX,r),i.setVirtualScrollPos(n,t.scrollbarY,r)},this.scroll=function(e,n,r,o){var s,a;s=i.setVirtualScrollPos(e,t.scrollbarX,o),a=i.setVirtualScrollPos(n,t.scrollbarY,o),(0!==s||0!==a||r)&&l.forEach(function(e){e(s,a)})},this.getScrollAmount=function(e,t,n){return{deltaX:e,deltaY:t}},this.scrollStart=function(){c.forEach(function(e){e()})},this.scrollEnd=function(){u.forEach(function(e){e()})},this.onScroll=function(e){l.push(e)},this.onScrollStart=function(e){c.push(e)},this.onScrollEnd=function(e){u.push(e)},this.on=function(){t.interactiveX||t.interactiveY||(t.off=t.on(),t.interactiveX=!0,t.interactiveY=!0)},this.off=function(){t.off&&(t.off(),t.interactiveX=!1,t.interactiveY=!1)},this.setHorizontalScrollInteractive=function(e){t.interactiveX=e},this.setVerticalScrollInteractive=function(e){t.interactiveY=e},this.isVerticalScrollEnabled=function(){return t.scrollbarY.enabled},this.digest=function(){t.$parent.$digest()}}]}),define("general.scroll/loader/loader",["qvangular","core.utils/deferred"],function(e,t){"use strict";e.directive("qvScrollLoader",["$animateCss","$timeout",function(e,n){return{restrict:"E",replace:!0,template:function(e,t){var n=t.tag||"div";return"<"+n+' ng-style="loaderStyle" class="qv-scroll-loader qv-animate"><qv-rain ng-if="showRain" show="showRain"></qv-rain></'+n+">"},scope:{},controller:function(){},link:function(i,r,o,s){function a(e,t,n){i.loaderStyle.top=e,i.loaderStyle.left=t,i.loaderStyle.width=n.width,i.loaderStyle.height=n.height}var l,c,u,h=!!o.noRain;i.loaderStyle={width:0,height:0},i.showRain=!1,s.fadeIn=function(o,s,u){var d=t();return a(o,s,u),h||(l=n(function(){i.showRain=!0})),(c=e(r,{addClass:"fade"})).start().done(function(){d.resolve()}),d.promise},s.fadeOut=function(){var n=t();return i.showRain=!1,(u=e(r,{removeClass:"fade"})).start().done(function(){i.loaderStyle.width=0,i.loaderStyle.height=0,i.$apply(),n.resolve()}),n.promise},i.$on("$destroy",function(){n.cancel(l)})}}}])}),define("text!general.scroll/loader/load-button.ng.html",[],function(){return'<div class="qv-scroll-data-load-buttons" ng-class="{ previous: previous }">\n\t<div ng-transclude></div>\n\t<button class="lui-button" qva-activate="load()" ng-disabled="disabled">\n\t\t<p q-translation="{{text}}"></p>\n\t</button>\n</div>\n'}),define("general.scroll/loader/load-button",["qvangular","text!./load-button.ng.html","underscore"],function(e,t,n){"use strict";e.directive("qvScrollLoadButton",[function(){return{restrict:"E",transclude:!0,replace:!0,template:function(e,n){var i=n.tag||"div";return t.replace(/^\s*<div/,"<"+i).replace(/<\/div>\s*$/,"</"+i+">")},scope:{onLoad:"&",text:"@",previous:"=",disabled:"=",scrollApi:"=",watchResize:"=",showButton:"="},link:function(e,t){function i(){if(e.scrollApi){var t=e.scrollApi.domApi.$scrollContent[0].clientWidth,n=e.scrollApi.settings.width,i=e.scrollApi.domApi.$element[0].scrollLeft,o=t-n;r[0].style.left=i-o/2+"px"}}e.load=function(){e.onLoad()};var r=t.find(".lui-button"),o=e.$watch("watchResize",function(e){"function"==typeof e&&(e(i),o())}),s=e.$watch("showButton",function(t){t&&(i(),e.scrollApi.domApi.$element.scroll(n.debounce(i,40)),s())})}}}])}),define("text!general.scroll/scroll-area.ng.html",[],function(){return'<div dir={{direction}}>\n\t<div class="scroll-content" ng-transclude></div>\n\t<qv-scroll-area-affordance x-show="scrollbarY.showMinAffordance" x-direction="\'vertical\'" x-dock="\'min\'" ng-if="scrollbarY.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\n\t<qv-scroll-area-affordance x-show="scrollbarX.showMinAffordance" x-direction="\'horizontal\'" x-dock="\'min\'" ng-if="scrollbarX.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\n\t<qv-scrollbar x-data="scrollbarY" x-interactive="interactiveY" x-viewport-rect="viewportRect" ng-if="scrollbarY.enabled"></qv-scrollbar>\n\t<qv-scrollbar x-data="scrollbarX" x-interactive="interactiveX" x-viewport-rect="viewportRect" ng-if="scrollbarX.enabled"></qv-scrollbar>\n\t<qv-scroll-area-affordance x-show="scrollbarY.showMaxAffordance" x-direction="\'vertical\'" x-dock="\'max\'" ng-if="scrollbarY.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\n\t<qv-scroll-area-affordance x-show="scrollbarX.showMaxAffordance" x-direction="\'horizontal\'" x-dock="\'max\'" ng-if="scrollbarX.enabled" x-viewport-rect="viewportRect"></qv-scroll-area-affordance>\n</div>\n'}),define("text!general.scroll/scrollbar.ng.html",[],function(){return'<div class="scrollbar-animation scrollbar-track"\n\tng-class="data.classList"\n\tng-style="data.style">\n\t<qv-scrollbar-track-hit-area ng-style="trackHitAreaStyle" class="scrollbar-hitarea"></qv-scrollbar-track-hit-area>\n\t<qv-scrollbar-thumb ng-class="{ active: data.active }" class="scrollbar-thumb" ng-style="thumbStyle"></qv-scrollbar-thumb>\n</div>\n'}),define("general.scroll/scroll-area-affordance",["qvangular"],function(e){"use strict";e.directive("qvScrollAreaAffordance",function(){return{restrict:"E",template:'<div ng-show="show" class="scroll-affordance" ng-class="[dock,direction]" ng-style="style"></div>',replace:!0,require:"^qvScrollArea",scope:{viewportRect:"=",direction:"=",dock:"=",size:"=?",show:"="},link:function(e){e.size=e.size||18,e.style={},e.updateAffordance=function(){switch(e.direction){case"vertical":switch(e.style.width=e.viewportRect.width+"px",e.style.height=e.size+"px",e.dock){case"min":e.style.left=e.viewportRect.left+"px",e.style.top=e.viewportRect.top+"px";break;case"max":e.style.left=e.viewportRect.left+"px",e.style.top=e.viewportRect.top+e.viewportRect.height-e.size+"px";break;default:throw"Dock "+e.dock+" not supported"}break;case"horizontal":switch(e.style.width=e.size+"px",e.style.height=e.viewportRect.height+"px",e.dock){case"min":e.style.left=e.viewportRect.left+"px",e.style.top=e.viewportRect.top+"px";break;case"max":e.style.left=e.viewportRect.left+e.viewportRect.width-e.size+"px",e.style.top=e.viewportRect.top+"px";break;default:throw"Dock "+e.dock+" not supported"}break;default:throw"Direction "+e.direction+" not supported"}},e.$watch("viewportRect",e.updateAffordance,!0)}}})}),define("general.scroll/scroll-area",["jquery","qvangular","general.scroll/scroll-area-controller","text!./scroll-area.ng.html","text!./scrollbar.ng.html","touche","general.utils/support","general.scroll/scroll-area-service","general.scroll/scroll-area-affordance"],function(e,t,n,i,r,o,s){"use strict";t.directive("qvScrollArea",["$document",function(t){return{restrict:"E",transclude:!0,template:i,replace:!0,scope:{scrollbarSize:"=?",nonMouseViewportScrolling:"=?",direction:"=?"},require:"qvScrollArea",controller:n,link:function(n,i,r,a){function l(e,t){var i=n.viewportRect.left,r=n.viewportRect.top,o=n.viewportRect.left+n.viewportRect.width,s=n.viewportRect.top+n.viewportRect.height;return e>=i&&e<=o&&t>=r&&t<=s}function c(){i.off(n.namespace),t.off(n.namespace),o(i[0]).off("*",n.namespace)}"number"!=typeof n.scrollbarSize&&(n.scrollbarSize=8),n.direction||(n.direction="ltr"),n.$watch("scrollbarX.enabled",function(e){!0===e&&i.css("overflow-x","hidden")}),n.$watch("scrollbarY.enabled",function(e){!0===e&&i.css("overflow-y","hidden")}),n.namespace=".scroll-area-"+n.$id,n.on=function(){return i.on("wheel"+n.namespace,function(e){var t=e.originalEvent,n=t.shiftKey?t.deltaY:t.deltaX,i=t.shiftKey?t.deltaX:t.deltaY,r=a.getScrollAmount(n,i,t.deltaMode);a.scroll(r.deltaX,r.deltaY,!1,!1),s.treatAsDesktop()||(a.setMouseTrackSize(),a.fadeInScrollbars(),a.fadeOutScrollbarsDelayed()),a.digest()}),t.on("keydown"+n.namespace,function(t){var i,r,o=0,s=0,l=e(t.target),c=l.is("input")||l.is("textarea");if(n.hover&&!c){switch(t.keyCode){case 33:s=1,i=2;break;case 34:s=-1,i=2;break;case 36:s=1,i=10;break;case 35:s=-1,i=10;break;case 38:s=1,i=1;break;case 40:s=-1,i=1;break;case 39:o=-1,i=1;break;case 37:o=1,i=1;break;default:return}r=a.getScrollAmount(o,s,i),a.scroll(-r.deltaX,-r.deltaY,!1,!1),a.digest()}}),i.on("mouseenter"+n.namespace+"pointerenter"+n.namespace,function(e){n.isMouse=s.isMouse(e.originalEvent),n.isMouse?(n.hover=!0,s.treatAsDesktop()&&(a.setMouseTrackSize(),a.fadeInScrollbars()),a.digest()):e.preventDefault()}),i.on("mouseleave"+n.namespace+"pointerleave"+n.namespace,function(e){n.isMouse=s.isMouse(e.originalEvent),n.isMouse&&(n.hover=!1,s.treatAsDesktop()&&a.fadeOutScrollbars())}),"object"==typeof n.nonMouseViewportScrolling&&("number"!=typeof n.nonMouseViewportScrolling.scrollbarSize&&(n.nonMouseViewportScrolling.scrollbarSize=36),"string"!=typeof n.nonMouseViewportScrolling.className&&(n.nonMouseViewportScrolling.className="show-non-mouse-scrollbars"),o(i[0]).swipe({id:n.namespace,options:{radiusThreshold:0,useMomentum:!0,inertia:.7,preventDefault:!1},start:function(e,t){s.isMouse(e)?this.cancel():l(t.pagePoints[0].x-this.rect.x,t.pagePoints[0].y-this.rect.y)?(a.setMouse(!1),a.setNonMouseTrackSize(),a.scrollStart(),a.fadeInScrollbars(),a.digest()):this.cancel()},update:function(e,t){var i=n.scrollbarX.getScrollDelta(t)[0],r=n.scrollbarY.getScrollDelta(t)[1];a.scroll(-1*i,-1*r,!1,!0),a.digest()},end:function(){a.scrollEnd(),a.fadeOutScrollbars(),a.digest()}})),c},n.$on("$destroy",function(){c()})}}}]),t.directive("qvScrollbar",["qvScrollAreaService",function(e){return{restrict:"E",require:["^qvScrollArea","qvScrollbar"],scope:{data:"=",interactive:"=",viewportRect:"="},template:r,replace:!0,controller:function(){},link:function(t,n,i,r){function o(e){n[e?"addClass":"removeClass"]("fade")}var a=r[0],l=r[1];"vertical"===t.data.direction?(t.data.classList.push("vertical"),a.addScrollbarYCtrl(l)):(t.data.classList.push("horizontal"),a.addScrollbarXCtrl(l)),l.allowFade=function(){return!t.data.active},l.fadeIn=function(){return o(!0)},l.fadeOut=function(){return o(!1)},t.thumbStyle={},t.$watch("data.thumb",function(){e.setThumbStyle(t.thumbStyle,t.data)},!0),t.$watch("data.vPage",function(){e.setThumbStyle(t.thumbStyle,t.data)}),t.$watch("data.vLength",function(){e.setThumbStyle(t.thumbStyle,t.data)}),t.$watch("data.enabled",function(e){a.isMouseOver()&&e&&l.fadeIn()}),t.setThumbStyle=e.setThumbStyle.bind(null,t.thumbStyle,t.data),t.trackHitAreaStyle={},t.$watch("data.trackSize",function(n){void 0!==n&&e.setTrackHitAreaStyle(t.trackHitAreaStyle,t.data,n)}),t.start=function(e){a.setMouse(e),t.data.active||s.treatAsDesktop()||(e?a.setMouseTrackSize():a.setNonMouseTrackSize(),a.fadeInScrollbars()),t.data.active=!0,a.scrollStart()},t.update=function(e,t){a.scroll(e,t,!1,!0)},t.end=function(e){var n=t.data,i=n.vLength-n.vViewportLength;n.vPos<0?n.vPos=0:n.vPos>i&&(n.vPos=i),t.data.active=!1,a.scrollEnd(),e?a.fadeOutScrollbarsDelayed():a.fadeOutScrollbars()},t.on=function(){return t.hitAreaOff=t.hitAreaOn(),t.thumbOff=t.thumbOn(),function(){t.hitAreaOff(),t.thumbOff()}},t.$watch("interactive",function(e){e?t.off=t.on():t.off&&t.off()})}}}]),t.directive("qvScrollbarThumb",[function(){return{restrict:"E",template:"<div></div>",replace:!0,require:"^qvScrollArea",link:function(e,t,n,i){e.thumbOn=function(){return o(t[0]).tap({start:function(t){o.preventGestures(this.gestureHandler),e.start(s.isMouse(t)),i.digest()}}).swipe({options:{radiusThreshold:0},update:function(t,n){e.update.apply(e,e.data.getScrollDelta(n)),i.digest()},end:function(){e.end(),i.digest()}}),function(){o(t[0]).off()}},e.$on("$destroy",function(){o(t[0]).off()})}}}]),t.directive("qvScrollbarTrackHitArea",[function(){return{restrict:"E",replace:!0,template:"<div></div>",require:"^qvScrollArea",link:function(e,t,n,i){function r(t,n){var r,o,s,a=e.data.thumb.size,l=e.data.thumb.pos,c=0,u=0;switch(e.data.direction){case"vertical":r=t.pagePoints[0].y-n.y<l,t.pagePoints[0].y-n.y>l+a?(c=0,u=-i.getScrollAmount(-1,-1,2).deltaY):r&&(c=0,u=-i.getScrollAmount(1,1,2).deltaY);break;case"horizontal":o=t.pagePoints[0].x-n.x<l,s=t.pagePoints[0].x-n.x>l+a,o?(c=-i.getScrollAmount(1,1,2).deltaX,u=0):s&&(c=-i.getScrollAmount(-1,-1,2).deltaX,u=0)}i.scroll(c,u)}function a(t,n){switch(e.data.direction){case"vertical":e.update(0,(t.pagePoints[0].y-n.y-(e.data.thumb.pos+e.data.thumb.size/2))*(1/e.data.scaleFactor));break;case"horizontal":e.update((t.pagePoints[0].x-n.x-(e.data.thumb.pos+e.data.thumb.size/2))*(1/e.data.scaleFactor),0);break;default:throw"not implemented"}}e.hitAreaOn=function(){return o(t[0]).tap({start:function(t,n){o.preventGestures(this.gestureHandler),e.start(s.isMouse(t)),e.setThumbStyle(),s.isMouse(t)?r(n,this.rect):a(n,this.rect),i.digest()},end:function(){e.end(!0),i.digest()}}).swipe({options:{radiusThreshold:0},start:function(t,n){s.isMouse(t)?this.cancel():(e.update.apply(e,e.data.getScrollDelta(n)),i.digest())},update:function(t,n){e.update.apply(e,e.data.getScrollDelta(n)),i.digest()},end:function(){e.end(!0),i.digest()}}),function(){o(t[0]).off()}},e.$on("$destroy",function(){o(t[0]).off()})}}}])}),define("general.scroll/api/vertical-scroll-api",["core.utils/class","core.utils/notification","util","general.utils/support","general.scroll/api/dom-api","general.scroll/api/data-api","general.scroll/scroll-area-controller","general.scroll/loader/loader","general.scroll/loader/load-button","general.scroll/scroll-area"],function(e,t,n,i,r,o,s){"use strict";return e.extend({destroy:function(){this.$timeout.cancel(this.initPromise),this.$timeout.cancel(this.setVirtualSizePromise),this.unpreventNativeScroll&&this.unpreventNativeScroll(),this.domApi.destroy()},init:function(e,r){t.create(this,"Scroll"),this.$timeout=e,this.initPromise=null,this.setVirtualSizePromise=null,void 0!==r.virtualScrollEnabled?this.virtualScrollEnabled=r.virtualScrollEnabled:this.virtualScrollEnabled=i.treatAsDesktop(),this.loaderStyle={width:0,height:0},this.totalRows=0,this.totalColumns=0,this.alignBottomAbsolute=!1,this.axisDelta={xAxis:0,yAxis:0},this.alignToBottomReduce={active:!1,activeFromStart:!1},this.ignoreScroll=!1,this.loadNext=!1,this.loadPrevious=!1,this.settings=n.extend(!0,{alignToBottom:"absolute",minRowHeight:21,maxRowHeight:21,minColumnWidth:30,viewportRowCount:0,viewportColumnCount:0,width:0,height:0,blockSize:100,keepItemsCount:10},r)},initialize:function(e,t,n,i){if(!(e instanceof r))throw"Must provide an instance of domApi";if(!(t instanceof o))throw"Must provide an instance of dataApi";if(!(n instanceof s[s.length-1]))throw"Must provide an instance of ScrollAreaController";if(!i||"function"!=typeof i.fadeIn||"function"!=typeof i.fadeOut)throw"Must provide valid loader api";return this.initPromise?this.initPromise:(this.domApi=e,this.dataApi=t,this.virtualScrollApi=n,this.loaderApi=i,this.initPromise=this.$timeout(function(){this.onInit(),this.onInitVirtualScroll(),this.bindNativeScroll()}.bind(this)),this.initPromise)},onInit:function(){this.updateViewport()},onInitVirtualScroll:function(){this.virtualScrollApi.onScroll(this.onVirtualScroll.bind(this)),this.virtualScrollApi.getScrollAmount=this.getVirtualScrollAmount.bind(this)},bindNativeScroll:function(){this.domApi.bindNativeScroll(this.onNativeScroll.bind(this))},activate:function(){this.virtualScrollEnabled&&this.virtualScrollApi.on(),this.unpreventNativeScroll&&(this.unpreventNativeScroll(),this.unpreventNativeScroll=null)},deactivate:function(){this.unpreventNativeScroll=this.domApi.preventNativeScroll(),this.virtualScrollApi.off()},updateViewport:function(){var e=this.domApi.getBoundingBox();this.settings.width=e.width,this.settings.height=e.height,this.settings.viewportRowCount=Math.ceil(this.settings.height/this.settings.minRowHeight),this.settings.viewportColumnCount=Math.ceil(this.settings.width/this.settings.minColumnWidth)},setTotalRows:function(e){this.totalRows=e},setTotalColumns:function(e){this.totalColumns=e},getSpliceArgs:function(){return[0,this.dataApi.getRowCount()-this.settings.viewportRowCount-this.settings.keepItemsCount]},onSetVirtualSize:function(e){var t,n,i,r,o=this.domApi.getScrollAreaBoundingBox(),s=this.domApi.getScrollContentBoundingBox(),a=this.virtualScrollApi.getVirtualPosition(),l=this.settings.minRowHeight*this.totalRows;"reduce"===this.settings.alignToBottom?(this.alignToBottomReduce.active=!1,this.alignToBottomReduce.activeFromStart=!1,s.height>=o.height&&this.settings.viewportRowCount>=this.totalRows&&(t=this.domApi.getVisibleRowCount(this.settings.maxRowHeight))<this.settings.viewportRowCount&&(this.alignToBottomReduce.active=!0,this.alignToBottomReduce.activeFromStart=!0,this.settings.viewportRowCount=t),i={width:o.width,height:this.settings.viewportRowCount*this.settings.minRowHeight}):i={width:o.width,height:o.height},n={width:this.settings.minColumnWidth*this.totalColumns,height:l},r={top:0,left:0,width:o.width,height:o.height},this.virtualScrollApi.setVirtualSize(n,i,r),e&&this.virtualScrollApi.scroll(a.vPosX,a.vPosY,!0)},setVirtualSize:function(e){if(this.virtualScrollEnabled)return this.setVirtualSizePromise=this.$timeout(function(){this.updateViewport(),this.onSetVirtualSize(e),this.updateAlignToBottom()}.bind(this))},getVirtualScrollAmount:function(e,t,n){var i=this.virtualScrollApi.getVirtualPosition(),r=this.virtualScrollApi.getMaxPosition();if(this.alignBottomAbsolute&&t<0)return{deltaX:e,deltaY:t};switch(n){case 1:return{deltaX:0,deltaY:this.settings.minRowHeight*t};case 2:return{deltaX:0,deltaY:this.settings.viewportRowCount*this.settings.minRowHeight*t};case 10:return{deltaX:0,deltaY:t>0?i.vPosY*t:i.vPosY-r.vPosY};default:return{deltaX:e,deltaY:t}}},getPage:function(e){return{left:Math.floor(e.vPosX/this.settings.minColumnWidth),top:Math.floor(e.vPosY/this.settings.minRowHeight),width:this.settings.viewportColumnCount,height:this.settings.viewportRowCount}},adjustPageToBounds:function(e){e.top>0&&e.top+e.height>this.totalRows&&(e.top=Math.max(0,this.totalRows-e.height),e.height=Math.min(this.totalRows,e.height)),e.left>0&&e.left+e.width>this.totalColumns&&(e.left=Math.max(0,this.totalColumns-e.width),e.width=Math.min(this.totalColumns,e.width))},onVirtualScroll:function(e,t){this.Scroll.emit();var n=this.virtualScrollApi.getVirtualPosition(),i=this.virtualScrollApi.getMaxPosition(),r=this.getPage(n);return this.alignToBottomReduce.active&&t<0&&(this.graduallyLeaveAlignToBottomReduce(r),i=this.virtualScrollApi.getMaxPosition()),"reduce"===this.settings.alignToBottom&&i.vPosY>0&&n.vPosY===i.vPosY&&(this.alignToBottomReduce.active=!0),this.adjustPageToBounds(r),this.axisDelta.xAxis=e,this.axisDelta.yAxis=t,this.dataApi.onVirtualScroll(r.top,r.height,r.left,r.width,e,t).then(function(){this.updateAlignToBottom()}.bind(this))},updateAlignToBottom:function(){"reduce"===this.settings.alignToBottom?this.updateAlignToBottomReduce():this.updateAlignToBottomAbsolute()},updateAlignToBottomAbsolute:function(){var e=this.virtualScrollApi.getVirtualPosition(),t=this.virtualScrollApi.getMaxPosition();this.virtualScrollApi.isVerticalScrollEnabled()&&e.vPosY===t.vPosY?this.alignBottomAbsolute=!0:this.alignBottomAbsolute=!1},updateAlignToBottomReduce:function(){var e=!1;if(this.alignToBottomReduce.active){if(this.axisDelta.yAxis>0){var t=this.domApi.getVisibleRowCount(this.settings.maxRowHeight);this.settings.viewportRowCount=Math.max(1,t)}else{var n=Math.ceil(this.domApi.getScrollAreaClientHeight()/this.settings.minRowHeight);this.settings.viewportRowCount>=n&&(this.alignToBottomReduce.active=!1),e=!0}var i=this.domApi.getScrollAreaBoundingBox();this.virtualScrollApi.setViewport({top:0,left:0,width:i.width,height:i.height}),this.virtualScrollApi.setVirtualViewport({width:i.width,height:this.settings.viewportRowCount*this.settings.minRowHeight}),e&&this.virtualScrollApi.setVirtualScrollPos(0,-1)}},graduallyLeaveAlignToBottomReduce:function(e){var t=Math.ceil(this.domApi.getScrollAreaClientHeight()/this.settings.minRowHeight);this.alignToBottomReduce.activeFromStart||(e.height=Math.min(this.totalRows-e.top,t),this.settings.viewportRowCount=e.height)},updateLoadingButtons:function(){var e=this.dataApi.getFirstElementIndex();e+this.dataApi.getRowCount()>=this.totalRows||0===this.totalRows||e<0?this.loadNext=!1:this.loadNext=!0,this.loadPrevious=e>0},resetNativeScroll:function(){return this.ignoreScroll=!0,this.loadNext=!1,this.loadPrevious=!1,this.domApi.resetNativeScroll(),function(){this.ignoreScroll=!1}.bind(this)},onNativeScroll:function(){if(this.Scroll.emit(),!this.ignoreScroll){var e=this.dataApi.getLastElementIndex()+1,t=this.settings.blockSize-e;this.ignoreScroll=!0,this.dataApi.onInitialNativeScroll(e,t).then(function(){this.updateLoadingButtons()}.bind(this))}},gotoNextBlock:function(){var e="function"==typeof this.domApi.getHorizontalScroll?this.domApi.getHorizontalScroll():0;this.loaderApi.fadeIn(this.domApi.getScrollAreaOffsetTop(),e,this.domApi.getBoundingBox()).then(function(){var e=this.domApi.alignToLastRow(),t=this.dataApi.getLastElementIndex()+1,n=this.settings.blockSize-this.settings.keepItemsCount;this.dataApi.onGotoNextBlock(t,n).then(function(){this.updateLoadingButtons(),this.$timeout(function(){e(),this.$timeout(function(){this.loaderApi.fadeOut()}.bind(this))}.bind(this))}.bind(this))}.bind(this))},gotoPreviousBlock:function(){var e="function"==typeof this.domApi.getHorizontalScroll?this.domApi.getHorizontalScroll():0;this.loaderApi.fadeIn(this.domApi.getScrollAreaOffsetTop(),e,this.domApi.getBoundingBox()).then(function(){var e=this.domApi.alignToFirstRow(),t=this.settings.blockSize-this.settings.keepItemsCount,n=this.dataApi.getFirstElementIndex()-t;n<0&&(t+=n,n=0),this.dataApi.onGotoPreviousBlock(n,t).then(function(){this.updateLoadingButtons(),this.$timeout(function(){e(),this.$timeout(function(){this.loaderApi.fadeOut()}.bind(this))}.bind(this))}.bind(this))}.bind(this))}})}),define("general.scroll/api/simple-list-data-api",["core.utils/deferred","general.scroll/api/data-api"],function(e,t){"use strict";return t.extend({init:function(e){this.list=[],this.scrollApi=e},getRowCount:function(){return this.scrollApi.items?this.scrollApi.items.length:0},getFirstElementIndex:function(){return this.list.indexOf(this.scrollApi.items[0])},getLastElementIndex:function(){return this.list.indexOf(this.scrollApi.items[this.scrollApi.items.length-1])},getItems:function(e,t){return this.list.slice(Math.max(0,e),e+t)},setItems:function(e,t){this.scrollApi.items=this.getItems(e,t)},setList:function(e,t){this.list=e,this.scrollApi.setTotalRows(this.list.length);var n=this.getRowCount(),i=t&&n>0?this.getFirstElementIndex():0;this.scrollApi.virtualScrollEnabled?(this.setItems(i,this.scrollApi.settings.viewportRowCount),this.scrollApi.setVirtualSize(t)):t?(n=Math.min(e.length-i,Math.max(this.getRowCount(),this.scrollApi.settings.blockSize)),this.setItems(i,n),this.scrollApi.updateLoadingButtons()):(this.setItems(i,this.scrollApi.settings.viewportRowCount+1),this.scrollApi.resetNativeScroll()())},resize:function(){this.scrollApi.updateViewport();var t=this.getRowCount(),n=t>0?this.getFirstElementIndex():0;return 0!==n&&n+this.scrollApi.settings.viewportRowCount>t&&(n=Math.max(0,t-this.scrollApi.settings.viewportRowCount)),this.scrollApi.virtualScrollEnabled?(this.setItems(n,this.scrollApi.settings.viewportRowCount),this.scrollApi.setVirtualSize(!0)):0===n&&t<this.scrollApi.settings.blockSize?(this.setItems(n,this.scrollApi.settings.viewportRowCount+1),this.scrollApi.resetNativeScroll()(),e.resolve()):e.resolve()},onVirtualScroll:function(t,n){return this.setItems(t,n),e.resolve()},onInitialNativeScroll:function(t,n){return this.setItems(0,t+n),e.resolve()},onGotoNextBlock:function(t,n){var i=this.scrollApi.settings.keepItemsCount+this.scrollApi.settings.viewportRowCount;return this.setItems(t-i,n+i),e.resolve()},onGotoPreviousBlock:function(t,n){var i=this.scrollApi.settings.keepItemsCount+this.scrollApi.settings.viewportRowCount;return this.setItems(t,n+i),e.resolve()}})}),function(){"use strict";function Sha256(e,t){t?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}function HmacSha256(e,t,n){var i,r=typeof e;if("string"===r){var o,s=[],a=e.length,l=0;for(i=0;i<a;++i)(o=e.charCodeAt(i))<128?s[l++]=o:o<2048?(s[l++]=192|o>>6,s[l++]=128|63&o):o<55296||o>=57344?(s[l++]=224|o>>12,s[l++]=128|o>>6&63,s[l++]=128|63&o):(o=65536+((1023&o)<<10|1023&e.charCodeAt(++i)),s[l++]=240|o>>18,s[l++]=128|o>>12&63,s[l++]=128|o>>6&63,s[l++]=128|63&o);e=s}else{if("object"!==r)throw new Error(ERROR);if(null===e)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw new Error(ERROR)}e.length>64&&(e=new Sha256(t,!0).update(e).array());var c=[],u=[];for(i=0;i<64;++i){var h=e[i]||0;c[i]=92^h,u[i]=54^h}Sha256.call(this,t,n),this.update(u),this.oKeyPad=c,this.inner=!0,this.sharedMemory=n}var ERROR="input is invalid type",WINDOW="object"==typeof window,root=WINDOW?window:{};root.JS_SHA256_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,NODE_JS=!root.JS_SHA256_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS?root=global:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_SHA256_NO_COMMON_JS&&"object"==typeof module&&module.exports,AMD="function"==typeof define&&define.amd,ARRAY_BUFFER=!root.JS_SHA256_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],OUTPUT_TYPES=["hex","array","digest","arrayBuffer"],blocks=[];!root.JS_SHA256_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!ARRAY_BUFFER||!root.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var createOutputMethod=function(e,t){return function(n){return new Sha256(t,!0).update(n)[e]()}},createMethod=function(e){var t=createOutputMethod("hex",e);NODE_JS&&(t=nodeWrap(t,e)),t.create=function(){return new Sha256(e)},t.update=function(e){return t.create().update(e)};for(var n=0;n<OUTPUT_TYPES.length;++n){var i=OUTPUT_TYPES[n];t[i]=createOutputMethod(i,e)}return t},nodeWrap=function(method,is224){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),algorithm=is224?"sha224":"sha256",nodeMethod=function(e){if("string"==typeof e)return crypto.createHash(algorithm).update(e,"utf8").digest("hex");if(null===e||void 0===e)throw new Error(ERROR);return e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||ArrayBuffer.isView(e)||e.constructor===Buffer?crypto.createHash(algorithm).update(new Buffer(e)).digest("hex"):method(e)};return nodeMethod},createHmacOutputMethod=function(e,t){return function(n,i){return new HmacSha256(n,t,!0).update(i)[e]()}},createHmacMethod=function(e){var t=createHmacOutputMethod("hex",e);t.create=function(t){return new HmacSha256(t,e)},t.update=function(e,n){return t.create(e).update(n)};for(var n=0;n<OUTPUT_TYPES.length;++n){var i=OUTPUT_TYPES[n];t[i]=createHmacOutputMethod(i,e)}return t};Sha256.prototype.update=function(e){if(!this.finalized){var t,n=typeof e;if("string"!==n){if("object"!==n)throw new Error(ERROR);if(null===e)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw new Error(ERROR);t=!0}for(var i,r,o=0,s=e.length,a=this.blocks;o<s;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),t)for(r=this.start;o<s&&r<64;++o)a[r>>2]|=e[o]<<SHIFT[3&r++];else for(r=this.start;o<s&&r<64;++o)(i=e.charCodeAt(o))<128?a[r>>2]|=i<<SHIFT[3&r++]:i<2048?(a[r>>2]|=(192|i>>6)<<SHIFT[3&r++],a[r>>2]|=(128|63&i)<<SHIFT[3&r++]):i<55296||i>=57344?(a[r>>2]|=(224|i>>12)<<SHIFT[3&r++],a[r>>2]|=(128|i>>6&63)<<SHIFT[3&r++],a[r>>2]|=(128|63&i)<<SHIFT[3&r++]):(i=65536+((1023&i)<<10|1023&e.charCodeAt(++o)),a[r>>2]|=(240|i>>18)<<SHIFT[3&r++],a[r>>2]|=(128|i>>12&63)<<SHIFT[3&r++],a[r>>2]|=(128|i>>6&63)<<SHIFT[3&r++],a[r>>2]|=(128|63&i)<<SHIFT[3&r++]);this.lastByteIndex=r,this.bytes+=r-this.start,r>=64?(this.block=a[16],this.start=r-64,this.hash(),this.hashed=!0):this.start=r}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha256.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=EXTRA[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},Sha256.prototype.hash=function(){var e,t,n,i,r,o,s,a,l,c=this.h0,u=this.h1,h=this.h2,d=this.h3,p=this.h4,f=this.h5,m=this.h6,g=this.h7,v=this.blocks;for(e=16;e<64;++e)t=((r=v[e-15])>>>7|r<<25)^(r>>>18|r<<14)^r>>>3,n=((r=v[e-2])>>>17|r<<15)^(r>>>19|r<<13)^r>>>10,v[e]=v[e-16]+t+v[e-7]+n<<0;for(l=u&h,e=0;e<64;e+=4)this.first?(this.is224?(o=300032,g=(r=v[0]-1413257819)-150054599<<0,d=r+24177077<<0):(o=704751109,g=(r=v[0]-210244248)-1521486534<<0,d=r+143694565<<0),this.first=!1):(t=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),i=(o=c&u)^c&h^l,g=d+(r=g+(n=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7))+(p&f^~p&m)+K[e]+v[e])<<0,d=r+(t+i)<<0),t=(d>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),i=(s=d&c)^d&u^o,m=h+(r=m+(n=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7))+(g&p^~g&f)+K[e+1]+v[e+1])<<0,t=((h=r+(t+i)<<0)>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10),i=(a=h&d)^h&c^s,f=u+(r=f+(n=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7))+(m&g^~m&p)+K[e+2]+v[e+2])<<0,t=((u=r+(t+i)<<0)>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),i=(l=u&h)^u&d^a,p=c+(r=p+(n=(f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7))+(f&m^~f&g)+K[e+3]+v[e+3])<<0,c=r+(t+i)<<0;this.h0=this.h0+c<<0,this.h1=this.h1+u<<0,this.h2=this.h2+h<<0,this.h3=this.h3+d<<0,this.h4=this.h4+p<<0,this.h5=this.h5+f<<0,this.h6=this.h6+m<<0,this.h7=this.h7+g<<0},Sha256.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,i=this.h3,r=this.h4,o=this.h5,s=this.h6,a=this.h7,l=HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[n>>28&15]+HEX_CHARS[n>>24&15]+HEX_CHARS[n>>20&15]+HEX_CHARS[n>>16&15]+HEX_CHARS[n>>12&15]+HEX_CHARS[n>>8&15]+HEX_CHARS[n>>4&15]+HEX_CHARS[15&n]+HEX_CHARS[i>>28&15]+HEX_CHARS[i>>24&15]+HEX_CHARS[i>>20&15]+HEX_CHARS[i>>16&15]+HEX_CHARS[i>>12&15]+HEX_CHARS[i>>8&15]+HEX_CHARS[i>>4&15]+HEX_CHARS[15&i]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[15&r]+HEX_CHARS[o>>28&15]+HEX_CHARS[o>>24&15]+HEX_CHARS[o>>20&15]+HEX_CHARS[o>>16&15]+HEX_CHARS[o>>12&15]+HEX_CHARS[o>>8&15]+HEX_CHARS[o>>4&15]+HEX_CHARS[15&o]+HEX_CHARS[s>>28&15]+HEX_CHARS[s>>24&15]+HEX_CHARS[s>>20&15]+HEX_CHARS[s>>16&15]+HEX_CHARS[s>>12&15]+HEX_CHARS[s>>8&15]+HEX_CHARS[s>>4&15]+HEX_CHARS[15&s];return this.is224||(l+=HEX_CHARS[a>>28&15]+HEX_CHARS[a>>24&15]+HEX_CHARS[a>>20&15]+HEX_CHARS[a>>16&15]+HEX_CHARS[a>>12&15]+HEX_CHARS[a>>8&15]+HEX_CHARS[a>>4&15]+HEX_CHARS[15&a]),l},Sha256.prototype.toString=Sha256.prototype.hex,Sha256.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,n=this.h2,i=this.h3,r=this.h4,o=this.h5,s=this.h6,a=this.h7,l=[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24&255,n>>16&255,n>>8&255,255&n,i>>24&255,i>>16&255,i>>8&255,255&i,r>>24&255,r>>16&255,r>>8&255,255&r,o>>24&255,o>>16&255,o>>8&255,255&o,s>>24&255,s>>16&255,s>>8&255,255&s];return this.is224||l.push(a>>24&255,a>>16&255,a>>8&255,255&a),l},Sha256.prototype.array=Sha256.prototype.digest,Sha256.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e},HmacSha256.prototype=new Sha256,HmacSha256.prototype.finalize=function(){if(Sha256.prototype.finalize.call(this),this.inner){this.inner=!1;var e=this.array();Sha256.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(e),Sha256.prototype.finalize.call(this)}};var exports=createMethod();exports.sha256=exports,exports.sha224=createMethod(!0),exports.sha256.hmac=createHmacMethod(),exports.sha224.hmac=createHmacMethod(!0),COMMON_JS?module.exports=exports:(root.sha256=exports.sha256,root.sha224=exports.sha224,AMD&&define("sha256",[],function(){return exports}))}(),define("assets/datamodelviewer/utils/dmv-crypto-util",["sha256"],function(e){return{sha256:function(t){if(void 0===t)throw new Error("String is undefined.");if(0===t.length)throw new Error("String is empty.");return e(t)}}}),define("client.views/global-selections/directives/scroll/scroll",["qvangular","text!./scroll.ng.html","core.utils/class","objects.models/listbox","objects.utils/data-properties/listobject-util","core.utils/resize","core.utils/deferred","general.scroll/api/vertical-scroll-api","general.scroll/api/dom-api","general.scroll/api/simple-list-data-api","jquery","util","general.utils/shapes/rect","assets/datamodelviewer/utils/dmv-crypto-util","client.utils/rtl/direction-service","client.views/selection-toolbar/selection-toolbar-service","general.scroll/scroll-area"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f){"use strict";function m(e,t){for(;e.length>t;)e.pop()}var g=c.extend({init:function(){this.resetColumnIndex(),this._super.apply(this,arguments)},resetColumnIndex:function(){this.columnIndex=0},setList:function(e){this.list=e,this.scrollApi.setTotalRows(this.list.length),this.setItems(this.columnIndex,this.scrollApi.settings.blockSize),this.scrollApi.updateLoadingButtons()},onInitialNativeScroll:function(){return s.resolve()},onGotoNextBlock:function(){return this._super.apply(this,arguments).then(function(){this.columnIndex=this.getFirstElementIndex()}.bind(this))},onGotoPreviousBlock:function(){return this._super.apply(this,arguments).then(function(){this.columnIndex=this.getFirstElementIndex()}.bind(this))}}),v=l.extend({resetNativeScroll:function(){this.$scrollArea.scrollLeft(0)},alignToFirstRow:function(){var e=this.getFirstRow().children(".qv-object-wrapper").attr("id");return function(){var t,n=u(this.$scrollArea.find("#"+e));n.length>0&&(t=n.offset().left-260,this.$scrollArea.scrollLeft(t))}.bind(this)},alignToLastRow:function(){var e=this.getLastRow().children(".qv-object-wrapper").attr("id");return function(){var t,n=u(this.$scrollArea.find("#"+e));n.length>0&&(this.$scrollArea.scrollLeft(0),t=n.parent().position().left-this.getScrollAreaBoundingBox().width+n[0].getBoundingClientRect().width+250,this.$scrollArea.scrollLeft(t))}.bind(this)},getBoundingBox:function(){var e=this._super.apply(this,arguments);return new d(e.top,e.left,e.height,e.width)}}),y=n.extend({size:{width:0,height:0},itemSize:0,itemSpacing:0,$element:void 0,init:function(e,t,n){this.$scope=e,this.$timeout=t,this.selectionToolbarService=n,this.$scope.items=[],this.$scope.options={direction:f.direction}},initialize:function(e,t,n){this.setSize(t),this.setItemSize(n.itemSize),this.setItemSpacing(n.itemSpacing),this.setElement(e.find(".qv-gs-scroll-area")),this.setItems(),this.initialized=!0},updateVisible:function(){var e=this.offsetX-(this.$scope.scrollApi.loadPrevious?1:0),t=this.visibleItemsCount;this.$scope.items.forEach(function(n,i){var r=i>=e&&i<e+t;!n.visible&&r&&(n.options={isPopOver:!1,highlightTitle:!0,direction:f.direction}),r&&!n.model&&this.getModel(n).then(function(e,t){e.model=t}.bind(null,n)),n.visible=r},this)},getModel:function(e){var t,n=this.getInitProps(e.title);return e.qField?t=i.createTransientField(this.$scope.app,e.qField,n):e.qId&&(t=i.createTransientDimension(this.$scope.app,e.qId,n)),t},onScroll:function(){this.qvGlobalSelectionsCtrl.setIgnoreUpdates(!1),this.selectionToolbarService.confirm(),this.updateHighlights(),this.$timeout.cancel(this.scrollTimeout),this.scrollTimeout=this.$timeout(function(){this.updateVisible(),this.updateHighlights()}.bind(this),100)},onResize:function(e){this.setSize(e),this.updateVisible()},updateHighlights:function(){this.$scope.items.forEach(function(e){e.options.highlightQuery=this.$scope.filter},this)},setItems:function(){var e,t,n,i=this.$scope,r=this.totalItemsCount;for(i.items.length!==r&&m(i.items,r),e=0;e<r;e++)t=i.items[e]||{},(n=i.scrollApi.items[e]).enableBadge&&(t.enableBadge=n.enableBadge),t.model||(t.options={isPopOver:!1,highlightTitle:!0,direction:f.direction}),n.qField?(delete t.qId,t.model&&t.qField===n.qField||(t.visible&&(i.items[e]=h.extend(!0,{},t),delete(t=i.items[e]).$$hashKey,delete t.options.search),t.title=n.title,t.qField=n.qField,t.id=p.sha256(t.qField),delete t.model)):n.qId&&(delete t.qField,t.model&&t.qId===n.qId||(t.visible&&(i.items[e]=h.extend(!0,{},t),delete(t=i.items[e]).$$hashKey,delete t.options.search),t.title=n.title,t.qId=n.qId,t.id=p.sha256(t.qId),delete t.model)),i.items[e]||(i.items[e]=t);this.updateVisible()},getInitProps:function(e){var t={title:e,qListObjectDef:{qDef:{}}};return r.autoSortDimension(t.qListObjectDef),t},getWidthOf:function(e){return this.totalItemSize*e-this.itemSpacing},setItemSize:function(e){this.itemSize=e||220},setItemSpacing:function(e){this.itemSpacing=e||20},setSize:function(e){this.size=e},setElement:function(e){this.$element=e,this.$element.on("scroll",this.onScroll.bind(this))}});Object.defineProperties(y.prototype,{vPosX:{get:function(){return this.$element.scrollLeft()}},totalItemSize:{get:function(){return this.itemSize+this.itemSpacing}},visibleItemsCount:{get:function(){var e=Math.ceil(((this.vPosX+(this.previousBtnVisible?240:0))%this.totalItemSize+this.size.width)/this.totalItemSize);return Math.min(e,this.totalItemsCount+(this.previousBtnVisible?1:0))}},totalItemsCount:{get:function(){return(this.$scope.scrollApi.items||[]).length}},offsetX:{get:function(){return Math.floor(this.vPosX/this.totalItemSize)}},previousBtnVisible:{get:function(){return!!this.$scope.scrollApi.loadPrevious}}}),y.$inject=["$scope","$timeout","qvSelectionToolbarService"],e.directive("qvGlobalSelectSection",["$parse","$timeout",function(e,n){return{controller:y,require:["qvGlobalSelectSection","^qvGlobalSelections"],template:t,replace:!0,scope:{allItems:"=",filter:"=",app:"="},link:function(t,i,r,s){var l=s[0],c=s[1],u=e(r.qvGlobalSelectSection)(),h={},d=i.find(".qv-gs-scroll-area"),p=d.controller("qvScrollArea"),f=i.find(".qv-scroll-loader").controller("qvScrollLoader"),m={blockSize:24,minRowHeight:240,maxRowHeight:240,keepItemsCount:4,virtualScrollEnabled:!1},y=t.scrollApi=new a(n,m),b=new g(y),x=new v(i,d,".qv-gs-listbox",".qv-gs-listbox:first",".qv-gs-listbox:last"),q=null,C=function(){h.width=i.innerWidth(),h.height=i.innerHeight(),l.onResize(h)};l.qvGlobalSelectionsCtrl=c,y.initialize(x,b,p,f).then(function(){y.activate(),y.updateViewport(),t.$watch("filter",function(){b.resetColumnIndex(),y.resetNativeScroll()}),t.$watch("allItems",function(e){e&&(b.setList(e),q&&q(),q=t.$watch("scrollApi.items",function(){c.ignoreUpdates||(0===y.items.length&&t.allItems.length>0&&(y.resetNativeScroll(),b.resetColumnIndex(),b.setList(e)),l.initialized&&l.setItems())}))})}),n(function(){h.width=i.innerWidth(),h.height=i.innerHeight(),l.initialize(i,h,u)}),o.on("end",C),t.$on("$destroy",function(){o.off("end",C),y.destroy()}),c.addCallback(u.type,function(){l.$timeout(function(){l.setItems(),l.$timeout(function(){l.updateHighlights()})})})}}}])}),define("text!client.views/global-selections/directives/badge/badge.ng.html",[],function(){return'<div class="qv-gs-badge" ng-if="item.showBadge" q-title-translation="Tooltip.clearSelection" tid="globalSelections.badge" ng-click="badgeClick(item)">\n\t<span class="lui-icon lui-icon--remove"></span>\n</div>\n'}),define("objects.backend-api/listbox-api",["./backend-api"],function(e){"use strict";return e.extend("Listbox",{init:function(e){this._super(e,"/qListObjectDef",{width:1}),this.cacheCube.setMethodName("getListObjectData")},select:function(e,t,n){return this.model.selectListObjectValues(this.path,t,n)},selectAll:function(){return this.model.selectListObjectAll(this.path)},selectPossible:function(){return this.model.selectListObjectPossible(this.path)},selectAlternative:function(){return this.model.selectListObjectAlternative(this.path)},selectExcluded:function(){return this.model.selectListObjectExcluded(this.path)},search:function(e){return this.model.searchListObjectFor(this.path,e)},abortSearch:function(){return this.model.abortListObjectSearch(this.path)},confirmSearch:function(e){return this.model.acceptListObjectSearch(this.path,e)},updateCache:function(e){this.cacheCube.set(e.qListObject.qDataPages),this.cacheCube.setCubeSize(e.qListObject.qSize)},setInitialData:function(e){this.cacheCube.set(e.qListObject.qDataPages)},getData:function(e){return this.cacheCube.getData(e)},getDataPage:function(e){return this.getData([e]).then(function(e){return e[0]})},getSize:function(){return this.model.layout.qListObject.qSize},lock:function(){return this.model.lock(this.path)},unlock:function(){return this.model.unlock(this.path)},isLocked:function(){return!(!this.model.layout||!this.model.layout.qListObject)&&!!this.model.layout.qListObject.qDimensionInfo.qLocked},isDrillDown:function(){return!(!this.model.layout||!this.model.layout.qListObject)&&"H"===this.model.layout.qListObject.qDimensionInfo.qGrouping},getDimensionInfos:function(){return this.model.layout&&this.model.layout.qListObject?[this.model.layout.qListObject.qDimensionInfo]:[]}})}),define("client.views/global-selections/directives/badge/badge",["qvangular","text!./badge.ng.html","objects.backend-api/listbox-api"],function(e,t,n){e.directive("qvGsBadge",function(){return{restrict:"E",template:t,replace:!0,link:function(t){t.item.enableBadge&&(t.item.object||(t.item.object={}),t.$watchCollection("[item.model.layout.qListObject.qDimensionInfo.qLocked, item.object.selectionsApi.active]",function(n){e.$apply(e.$rootScope,function(){t.item.showBadge=(void 0===n[0]||!1===n[0])&&!1===n[1]})}),t.badgeClick=function(e){var t=new n(e.model);t.beginSelections(),t.clearSelections(),t.endSelections(!0)})}}})}),define("client.views/global-selections/global-selections",["jquery","qvangular","text!./global-selections.ng.html","general.utils/support","client.assets/assets-utils","core.utils/class","client.assets/tab-contents/fields/assets-field-list-model","core.utils/deferred","core.utils/resize","client.assets/tab-contents/fields/assets-directdiscovery-service","objects.utils/type-loader","touche","client.views/selection-toolbar/selection-toolbar-service","client.views/global-selections/directives/scroll/scroll","client.views/global-selections/directives/badge/badge","client.views/global-selections/global-selections-service"],function(e,t,n,i,r,o,s,a,l,c,u,h){var d=".globalSelections",p=o.extend({init:function(t,n){var r=this;this.$scope=t,this.callbacks=[],this.ignoreUpdates=!1,this.hasLoaded=!1,t.dimensions=[],t.dimensionsFields=[],t.selectedFields=[],t.fields=[],t.dimAvailable=!1,t.showFields=n.getShowFields(t.app),t.showFieldsCheckbox=!0,t.filter="",t.autoFocus=i.treatAsDesktop(),t.selectionToolbarOpen=!1,t.showNoMatches=!1,a.all({fields:this.getFields(),select:this.bindCurrentSelections(),dim:this.getLibraryDimensions(),reg:this.registerExtensions()}).then(function(){r.hasLoaded=!0,t.showFieldsCheckbox=t.fields.length>0,t.dimAvailable=t.dimensions.length>0,!t.dimAvailable&&t.showFieldsCheckbox&&(t.showFields=!0,n.setShowFields(t.showFields,t.app)),t.$watch("filter",function(){r.filterShown(r,r.$scope)}),t.$watch("showFields",function(){n.setShowFields(t.showFields,t.app),r.filterShown(r,r.$scope)}),e(".qv-gs-section .qv-gs-header")[1].style.display="none",e(".qv-gs-section .qv-gs-header")[1].offsetHeight,e(".qv-gs-section .qv-gs-header")[1].style.display="block"})},registerExtensions:function(){var e=new a;return u.load().then(function(){e.resolve()}),e.promise},getFields:function(){var e=this.$scope;return e.app.getFieldList().then(function(t){e.fields=s.expand(t).map(function(e){return{title:e.qName,qField:e.qName,qTags:e.qTags}})})},_updateCurrentSelectionFields:function(e){var t=this,n=this.$scope;n.selectedFields=e.qSelectionObject.qSelections.filter(function(e){return!e.qIsHidden}).sort(function(e,t){return e.qSortIndex-t.qSortIndex}).map(function(e){return{title:e.qReadableName||e.qField,qField:e.qField,enableBadge:!0}}),t.hasLoaded&&t.filterShown(t,n)},handleCurrentSelectionFields:function(){var e=this;this.$scope.currentSelectionsModel.getLayout().then(function(t){e._updateCurrentSelectionFields(t)})},bindCurrentSelections:function(){var e=this.$scope,t=this;return t.$scope.app.getCurrentSelectionObject().then(function(n){e.currentSelectionsModel=n,t.subscription=n.layoutSubscribe(function(n){e.app.isInModalSelection()||t._updateCurrentSelectionFields(n)})})},getLibraryDimensions:function(){var e=this.isCalculatedField,t=this.$scope;return t.app.getDimensionList().then(function(n){t.dimensions=n.filter(function(t){return t.qData.info.length>0&&!t.qData.info.some(e)&&"H"!==t.qData.grouping}).map(function(e){return{title:e.qData.labelExpression||e.qData.title,fieldName:e.qData.info[0].qName,qId:e.qInfo.qId}})})},isCalculatedField:function(e){return"="===e.qName[0]},filterShown:function(e,n){var i="",o=[];n.dimensionsFields=n.dimensions.filter(function(e){return!n.selectedFields.some(function(t){return e.fieldName===t.qField})}),n.showFields&&(o=n.fields.filter(function(e){return!n.selectedFields.some(function(t){return t.qField===e.qField})}),o=c.removeMeasureAndDetailsFields(o),n.dimensionsFields=n.dimensionsFields.concat(o.filter(function(e){return!n.dimensions.some(function(t){return e.qField===t.fieldName})}))),n.filter.length>0&&(i=n.filter.toLowerCase(),o=n.dimensionsFields.filter(function(e){return-1!==e.title.toLowerCase().indexOf(i)}),n.dimensionsFields=o),r.localeOrderBy(n.dimensionsFields,function(e){return e.title}),n.showNoMatches=0===n.dimensionsFields.length&&!this.ignoreUpdates&&n.filter.length>0,t.$apply(n,function(){e.notifyCallbacks(e)})},addCallback:function(e,t){this.callbacks.push({type:e,fn:t})},notifyCallbacks:function(e){e.hasLoaded&&(e.ignoreUpdates||e.callbacks.forEach(function(e){"fields"!==e.type&&"dimensions"!==e.type||e.fn()}))},setIgnoreUpdates:function(e){this.ignoreUpdates=e}});return p.$inject=["$scope","qvGlobalSelectionsService"],t.directive("qvGlobalSelections",["$document","qvSelectionToolbarService","$timeout",function(t,i,r){return{restrict:"E",template:n,controller:p,require:["qvGlobalSelections"],scope:{app:"="},replace:!0,link:function(n,o,s,a){n.toolbar=!!t.find(".qui-toolbar")[0];var c=a[0],u=function(){c.ignoreUpdates=!1},p=function(){n.selectionToolbarOpen=!1,r(function(){c.handleCurrentSelectionFields()})},f=function(){n.selectionToolbarOpen=!0};i.Closed.bind(p),i.Opened.bind(f),t.on("keyup"+d,function(e){27===e.which?c.ignoreUpdates=!1:13===e.which&&(c.ignoreUpdates=!1)}),h(t[0].body).tap({id:d,options:{preventDefault:!1},start:function(t){var n=e(t.target).closest(".qv-gs-badge").length>0,i=e(t.target).closest(".qv-gs-listbox").length>0,r=e(t.target).closest(".qv-selection-toolbar").length>0;c.ignoreUpdates=i&&!n&&!r}}),l.on("start",u),n.$on("$destroy",function(){c.callbacks=[],i.Closed.unbind(p),i.Opened.unbind(f),h(t[0].body).off("*",d),t.off(d),l.off("start",u),c.subscription&&c.subscription.dispose()}),n.onEnter=function(e){e.stopPropagation(),e.target.blur()}}}}]),'<qv-global-selections app="app"></qv-global-selections>'}),define("text!client.views/mobile-selections/mobile-selections.ng.html",[],function(){return'<div class="qv-mobile-selections" tid="{{\'mobileSelections.showFields.\' + filter.showFields}}">\n\t<div class="qv-ms-toolbar">\n\t\t<p ng-click="selectionsBack()" ng-class="{\'qv-ms-button-disabled\' : disable.back, \'qv-ms-button-enabled\': !disable.back}" class="lui-icon lui-icon--selections-back qv-ms-toolbar-buttons" tid="mobileSelections.back" q-title-translation="Tooltip.NavigateBack"></p>\n\t\t<p ng-click="selectionsForward()" ng-class="{\'qv-ms-button-disabled\' : disable.forward, \'qv-ms-button-enabled\': !disable.forward}" class="qv-ms-toolbar-buttons lui-icon lui-icon--selections-forward" tid="mobileSelections.forward" q-title-translation="Tooltip.NavigateForward"></p>\n\t\t<p ng-click="selectionsClear()" ng-class="{\'qv-ms-button-disabled\' : disable.clear, \'qv-ms-button-enabled\': !disable.clear}" class="qv-ms-toolbar-buttons lui-icon lui-icon--clear-selections" tid="mobileSelections.clear" q-title-translation="Tooltip.ClearSelections"></p>\n\t\t<p ng-click="toggleMenu()" ng-class="{\'qv-ms-button-disabled\' : !enableMenu, \'qv-ms-button-enabled\': enableMenu, \'qv-ms-button-menu-active\': !!popover }" class="qv-ms-toolbar-buttons lui-icon\tlui-icon--settings" id="mobileSelectionsMenu" tid="mobileSelections.showMenu" qva-outside-ignore-for="allOutside" q-title-translation="Toolbar.Menu"></p>\n\n\t\t<qui-toolbarbutton ng-click="close($event)" name="close" class="qv-ms-toolbar-close" tid="mobileSelections.close">\n\t\t\t<span q-translation="Common.Close" class="qv-ms-toolbar-close-text"></span>\n\t\t</qui-toolbarbutton>\n\t</div>\n\t<header class="qv-ms-header">\n\t\t<h2 q-translation="GlobalSelections.CurrentSelections"></h2>\n\t</header>\n\t<lui-search x-variant="inverse" class="qv-ms-searchbox" placeholder="{{filter.showFields ? \'GlobalSelections.FilterDimensionsAndFields\' : \'GlobalSelections.FilterDimensions\'}}" query="filter.filter" maxlength="255"\n\t\ton-enter="filter.onEnter($event)" tid="mobileSelections.searchfield">\n\t</lui-search>\n\t<div class="qv-ms-scroll-area">\n\t\t<qv-ms-selected ng-repeat="item in selectedFields"></qv-ms-selected>\n\t\t<div class="qv-ms-selectable" ng-if="filter.filter.length && (!selectables || selectables.length === 0)">\n\t\t\t<span q-translation="GlobalSelections.NoMatchesForSearch"></span>\n\t\t</div>\n\t\t<qv-ms-selectable ng-repeat="item in selectables"></qv-ms-selectable>\n\t</div>\n</div>\n'}),define("general.models/library/dimension",["core.models/communication","core.utils/deferred","util"],function(e,t,n){"use strict";function i(n){return n?t.resolve(n.enigmaModel):e.getApp()}var r={};return r.get=function(e,t){return i(t).then(function(t){return t.getDimension(e)})},r.create=function(e,t){return i(t).then(function(t){return e.qInfo.qId=e.qInfo.qId||n.generateId(),t.createDimension(e)})},r.remove=function(e,t){return i(t).then(function(t){return t.destroyDimension(e)})},r.getList=function(e){return i(e).then(function(e){return e.getDimensionListObject()})},r.getListLayout=function(e){return r.getList(e).then(function(e){return e.getLayout()})},r}),define("general.models/field",["core.models/communication","core.utils/deferred"],function(e,t){"use strict";function n(n){return n?t.resolve(n.enigmaModel):e.getApp()}var i={};return i.get=function(e,t,i){return n(i).then(function(n){return n.getField(e,t||"$")})},i.getList=function(e){return n(e).then(function(e){return e.getFieldListObject()})},i.getOnTheFlyList=function(e){return n(e).then(function(e){return e.getOnTheFlyListObject()})},i.getOnTheFlyWithHiddenList=function(e){return n(e).then(function(e){return e.getOnTheFlyWithHiddenListObject()})},i}),define("text!client.views/mobile-selections/menu/mobile-selections-menu.ng.html",[],function(){return'<div class="lui-bg-inverse qv-ms-menu">\n\t<ul class="lui-list lui-list--inverse">\n\t\t<li class="lui-list__item" ng-click="input.toggle()">\n\t\t\t<span class="lui-list__aside lui-bg-inverse lui-icon lui-icon--large lui-icon--{{::input.icon}}"></span>\n\t\t\t<span class="lui-list__text lui-list__text--ellipsis lui-bg-inverse lui-list__action" q-translation="{{input.text}}"></span>\n\t\t</li>\n\t</ul>\n</div>\n'}),define("text!client.views/mobile-selections/directives/selectable/selectable.ng.html",[],function(){return'<div ng-click="showSelectable()" ng-class="{\'qv-ms-touch-flash\' : item.flash}" class="qv-ms-selectable" tid="mobileSelections.selectable">\n\t<span ng-if="item.isField" class="lui-icon  lui-icon--field"></span>\n\t<div class="qv-ms-highlight">\n\t\t<span qve-highlight text="{{item.title}}" query="filter.filter"></span>\n\t</div>\n</div>\n'}),define("client.views/mobile-selections/directives/selectable/selectable",["qvangular","text!./selectable.ng.html"],function(e,t){e.directive("qvMsSelectable",["$timeout",function(e){return{restrict:"E",replace:!0,template:t,link:function(t){t.showSelectable=function(){t.item.flash=!0,e(function(){t.$emit("showListbox",t.item),t.item.flash=!1},20)}}}}])}),define("text!client.views/mobile-selections/directives/selected/selected.ng.html",[],function(){return'<div class="qv-ms-selected" tid="mobileSelections.selected">\n\t<div class="qv-ms-selected-icon">\n\t\t<a ng-show="!item.qLocked" ng-click="clear(item.qField)">\n\t\t\t<i class="lui-icon  lui-icon--remove"></i>\n\t\t</a>\n\t\t<a ng-show="item.qLocked" ng-click="showSelected(item.qField)">\n\t\t\t<i class="lui-icon lui-icon--lock"></i>\n\t\t</a>\n\t</div>\n\t<div ng-click="showSelected(item.qField)" class="qv-ms-selected-info">\n\t\t<h1 class="qv-object-title">{{item.qReadableName || item.qField}}</h1>\n\t\t<span>{{item.translation}}</span>\n\t\t<qv-state-count-bar state-counts="item.qStateCounts"></qv-state-count-bar>\n\t</div>\n</div>\n'}),define("client.views/mobile-selections/directives/selected/selected",["qvangular","text!./selected.ng.html"],function(e,t){e.directive("qvMsSelected",function(){return{restrict:"E",replace:!0,template:t,link:function(e){e.showSelected=function(){e.$emit("showListbox",e.item)},e.clear=function(t){e.currentSelectionsModel.clearField(t)}}}})}),define("client.views/current-selections/current-selections-service",["qvangular","translator"],function(e,t){e.service("qvCurrentSelectionsService",[function(){return{translate:function(e){var n=e.qStateCounts.qSelected+e.qStateCounts.qSelectedExcluded+e.qStateCounts.qLocked+e.qStateCounts.qLockedExcluded,i=e.qTotal;return i===n&&i>1?t.get("CurrentSelections.All"):n>1&&i>1?t.get("CurrentSelections.Of",[n,i]):e.qSelectedFieldSelectionInfo.map(function(e){return e.qName}).join(", ").toString()}}}])}),define("objects/listbox-popover/listbox-popover-mobile",["core.utils/deferred","core.utils/resize"],function(e,t){return{template:null,controller:["$scope","$element","$timeout",function(n,i,r){function o(){r(function(){n.destroyComponent(),i.remove()}),t.off("start.listbox-popover-error",o)}var s=this;s.selectionsActivated=function(){},s.selectionsDeactivated=function(){},s.close=function(){o()},n.closeView=function(e){n.onPopoverClose(e),o()},e.all({object:n.getVisualization(),width:r(function(){return i.find(".toolbar-wrapper").outerWidth()})}).then(function(e){var i=e.object,r=e.width;i.getSelectionToolbar().then(function(e){n.toolbar=e,n.toolbar.showLock=n.options.showLock,n.toolbar.position={width:r},i.activateSelections()}),i.loaded.then(function(){i.ext.hasError(i)&&t.on("start.listbox-popover-error",o)}),i.selectionsApi.watchActivated(function(){s.selectionsActivated()}),i.selectionsApi.watchDeactivated(function(){s.selectionsDeactivated(),o()}),n.closeView=function(e){i.selectionsApi.confirm(),n.onPopoverClose(e),o()}})}]}}),define("text!objects/listbox-popover/listbox-popover-small-device.ng.html",[],function(){return'<div\n\tclass="qv-listbox-popover-small-device">\n\t<div class="toolbar-wrapper"\n\t\tqva-include-selection-toolbar\n\t\tcomponent="selectionToolbarComponent"\n\t\ttoolbar="toolbar"\n\t\toptions="options">\n\t</div>\n\t<h1 qva-direction x-dir-setting="{{options.direction}}" x-dir-text="{{model.layout.title || model.layout.qListObject.qDimensionInfo.qFallbackTitle}}" class="qvt-visualization-title">{{model.layout.title || model.layout.qListObject.qDimensionInfo.qFallbackTitle}}</h1>\n\t<div class="listbox-wrapper">\n\t\t<qv-object object="object" model="model" options="options"></qv-object>\n\t</div>\n</div>\n'}),define("objects/listbox-popover/listbox-popover-service-mobile",["angular","qvangular","util","core.utils/deferred","objects.models/listbox","client.views/selection-toolbar/selection-toolbar","objects/listbox-popover/listbox-popover-mobile","general.utils/responsive-state","text!./listbox-popover-small-device.ng.html","objects/object","general.components/immidiate-contextual/immidiate-contextual"],function(e,t,n,i,r,o,s,a,l){t.service("qvListboxPopoverServiceMobile",["$document",function(t){var c,u,h=t.find("body");return{show:function(t,r,d,p){var f=i(),m={$alignToElement:r.$alignToElement,popupPosition:r.position||"bottom",collision:r.collision||"none",qvaOutsideIgnoreFor:r.qvaOutsideIgnoreFor,getVisualization:function(){return f.promise},model:t,onPopoverClose:this.onPopoverClose,options:{setController:f.resolve,isPopover:!0,showLock:r.showLock,search:r.search||{},smallDevice:a.isSmallDevice,direction:r.direction},selectionToolbarComponent:o};return u&&(u.selectionsActivated=function(){},u.selectionsDeactivated=function(){},u.close()),c=e.element("<div>"),h.append(c),s.template=l,u=c.showComponent(s,m),u.selectionsActivated=function(){n.isFunction(p)&&p()},u.selectionsDeactivated=function(){n.isFunction(d)&&d(),d=null,p=null},u},showField:function(e,t,n,o,s,a){return r.createTransientField(t,e,o).then(function(e){return i.resolve(this.show(e,n,s,a))}.bind(this))},showDimension:function(e,t,n,i,o,s){r.createTransientDimension(t,e,i).then(function(e){this.show(e,n,o,s)}.bind(this))},close:function(){u&&u.close()},onPopoverClose:function(){}}}])}),define("client.views/mobile-selections/mobile-selections",["qvangular","text!./mobile-selections.ng.html","client.models/current-selections","general.models/library/dimension","general.models/field","client.assets/assets-utils","core.utils/deferred","core.models/app","core.utils/bind-layout","objects.models/listbox","text!./menu/mobile-selections-menu.ng.html","client.assets/tab-contents/fields/assets-directdiscovery-service","general.utils/qv-keyboard-shortcuts","client.views/global-selections/global-selections-service","client.views/mobile-selections/directives/selectable/selectable","client.views/mobile-selections/directives/selected/selected","client.views/current-selections/current-selections-service","objects.views/charts/tooltip/chart-tooltip-service","objects/listbox-popover/listbox-popover-service-mobile"],function(e,t,n,i,r,o,s,a,l,c,u,h,d){function p(t,n){var i="",r=[];t.selectables=n.dimensions.filter(function(e){return!t.selectedFields.some(function(t){return e.qField===t.qField})}),!0===t.filter.showFields&&(r=n.fields.filter(function(e){return!t.selectedFields.some(function(t){return t.qField===e.qField})}),r=h.removeMeasureAndDetailsFields(r),t.selectables=t.selectables.concat(r.filter(function(e){return!n.dimensions.some(function(t){return e.qField===t.qField})}))),t.filter.filter.length>0&&(i=t.filter.filter.toLowerCase(),r=t.selectables.filter(function(e){return-1!==e.title.toLowerCase().indexOf(i)}),t.selectables=r),o.localeOrderBy(t.selectables,function(e){return e.title}),e.$apply(t)}function f(e){return e.every(function(e){return e.qLocked})}function m(t,i){var r=new s,o=e.getService("qvCurrentSelectionsService");return n.get().then(function(e){t.currentSelectionsModel=e,l(t,"currentSelectionsModel",function(e){t.disable={clear:0===e.qSelectionObject.qSelections.length||f(e.qSelectionObject.qSelections),back:0===e.qSelectionObject.qBackCount,forward:0===e.qSelectionObject.qForwardCount},t.selectedFields=e.qSelectionObject.qSelections.filter(function(e){return!e.qIsHidden}).sort(function(e,t){return e.qSortIndex-t.qSortIndex}),t.selectedFields.forEach(function(e){e.translation=o.translate(e)}),i.hasLoaded&&p(t,i)}),r.resolve()}),r.promise}function g(e){var t=function(e){return"="===e.qName[0]},n=new s;return i.getList().then(function(i){i.getLayout().then(function(i){e.dimensions=i.filter(function(e){return e.qData.info.length>0&&!e.qData.info.some(t)&&"H"!==e.qData.grouping}).map(function(e){return{title:e.qData.title,qField:e.qData.info[0].qName,qId:e.qInfo.qId}}),n.resolve()})}),n.promise}function v(e){var t=new s;return r.getList().then(function(e){return e.getLayout()}).then(function(n){e.fields=n.map(function(e){return{title:e.qName,qField:e.qName,qTags:e.qTags,isField:!0}}),t.resolve()}),t.promise}var y=["$scope","qvGlobalSelectionsService",function(t,n){var i={hasLoaded:!1,dimensions:[],fields:[]};t.selectedFields=[],t.filter={filter:"",showFields:n.getShowFields(a.current),onEnter:function(e){e.stopPropagation(),e.target.blur()}},t.selectables=[],t.enableMenu=!0,t.disable={clear:!1,back:!1,forward:!1},e.getService("qvChartTooltipService").close(),s.all({selectionsDfd:m(t,i),dimensionsDfd:g(i),fieldsDfd:v(i)}).then(function(){i.hasLoaded=!0,t.enableMenu=i.fields.length>0,i.dimensions.length<=0&&t.enableMenu&&(t.filter.showFields=!0,n.setShowFields(t.filter.showFields,a.current)),t.$watch("filter",function(){p(t,i)},!0)})}];return e.directive("qvMobileSelections",["qvGlobalSelectionsService","qvListboxPopoverServiceMobile","qvMobileMenu",function(e,n,i){return{restrict:"E",template:t,controller:y,replace:!0,require:["qvMobileSelections"],scope:{},link:function(t,r){function o(){t.popover&&(t.popover.close(),t.popover=null)}var l,h=function(){r.find(".qv-ms-scroll-area").animate({scrollTop:0})},p=d.createGroup("mobile-selections",0);p.registerKeys("enter",function(){}),p.on(),document.activeElement&&document.activeElement.blur(),t.close=function(t){t.preventDefault(),e.off()},t.popover=null,t.selectionsBack=function(){t.disable.back||t.currentSelectionsModel.back(),o()},t.selectionsForward=function(){t.disable.forward||t.currentSelectionsModel.forward(),o()},t.selectionsClear=function(){t.disable.clear||t.currentSelectionsModel.clearAll(),o()},t.toggleMenu=function(){t.popover?o():t.popover=i.show({template:u,input:{icon:t.filter.showFields?"remove":"plus",text:t.filter.showFields?"GlobalSelections.HideFields":"GlobalSelections.ShowFields",toggle:function(){t.filter.showFields=!t.filter.showFields,e.setShowFields(t.filter.showFields,a.current),o()}}})},t.$on("showListbox",function(e,i){var o={title:i.qReadableName||i.title,qListObjectDef:{qDef:{}}},u=-1!==t.selectedFields.indexOf(i),d=function(){t.currentSelectionsModel.getLayout().then(function(e){u||!e.qSelectionObject.qSelections.some(function(e){return i.qField===e.qField})?l.reject():l.resolve()})},p=function(e){l&&l.reject(),(l=new s).promise.then(h),r.children(".qv-ms-searchbox").find("input").blur(),n.show(e,{showLock:!0},d)};i.qField?c.createTransientField(a.current.enigmaModel,i.qField,o).then(p):c.createTransientDimension(a.current.enigmaModel,i.qId,o).then(p)}),t.$on("$destroy",function(){o(),l&&l.reject(),p.delete()})}}}]),"<qv-mobile-selections></qv-mobile-selections>"}),define("client.views/global-selections/global-selections-service",["jquery","angular","qvangular","client.views/global-selections/global-selections","client.views/mobile-selections/mobile-selections","client.utils/state","general.utils/responsive-state","core.models/app"],function(e,t,n,i,r,o,s,a){n.service("qvGlobalSelectionsService",["$document",function(n){function l(e){return y[u(e)]}function c(e,t){y[u(e)]=t}function u(e){return e&&e.id?e.id.toUpperCase():""}function h(e){return{$container:void 0,$app:e,$selectionCount:!1,$showFields:!1,getComponent:function(){return s.isSmallDevice?r:i},setup:function(){s.ViewChanged.bind(d)},destroy:function(){s.ViewChanged.unbind(d)}}}function d(){var e=l(a.current);f(e),p(e)}function p(e){e.$container=t.element("<div>"),n.find("body").append(e.$container),e.$container.showComponent(e.getComponent(),["$scope",function(t){t.app=e.$app}]),e.setup()}function f(e){e.$container&&(e.$container.remove(),e.$container=void 0),e.destroy()}function m(e){var t=l(e);return t||c(e,t=new h(e.enigmaModel)),t}function g(e){return e&&void 0!==e.$container}function v(t){g(t)?(f(t),e("body").removeClass("qv-global-selections-enabled")):(o.setState(o.States.analysis),e("body").addClass("qv-global-selections-enabled"),p(t))}var y={},b=!1,x=null;return{toggleGlobalSelection:function(e){v(m(e=e||a.current&&a.current.enigmaModel))},off:function(){Object.keys(y).forEach(function(e){f(y[e])})},isSelectActive:function(e){var t=l(e=e||a.current&&a.current.enigmaModel);return!(void 0===e||!g(t))},getCaoActive:function(){return b},setCaoActive:function(e){b=e},setCsShowCallback:function(e){x=e},setCsShow:function(e){x&&x(e)},setSelectionCount:function(e,t){m(t).$selectionCount=e},getSelectionCount:function(e){return(l(e=e||a.current&&a.current.enigmaModel)||{}).$selectionCount},setShowFields:function(e,t){m(t).$showFields=e},getShowFields:function(e){return!!(l(e=e||a.current&&a.current.enigmaModel)||{}).$showFields}}}])}),define("text!client.views/global-search/global-search.ng.html",[],function(){return'<div>\n\t<div class="qv-global-search" ng-class="{ \'overlay\': displaySuggestions || displayResult.data || displayResult.visuals }" ng-style="{paddingTop: toolbarHeight}" qva-outside="onOutsideSearch($event)" tid="globalSearch">\n\t\t<qv-global-search-input class="qv-global-search-input"></qv-global-search-input>\n\t\t<div class="qv-global-search-line" ng-if="!showMobileIndexProgressBar"></div>\n\t\t<qv-mobile-index-progress ng-if="isSmallDevice && query.length === 0 && isIndexClosedFeature"></qv-mobile-index-progress>\n\t\t<qv-global-search-history ng-if="isSearchHistoryFeature && searchInputFocused && query.length === 0"></qv-global-search-history>\n\t\t<div class="qv-global-search-dimmer" ng-if="query.length > 0 || forceShowDimmer" ng-style="dimmerStyles">\n\t\t\t<qv-global-search-result tid="globalSearch.ResultList"></qv-global-search-result>\n\t\t\t<div ng-show="scrollShow && !activity.show" class="scroll-affordance scroll-vertical"></div>\n\t\t</div>\n\t</div>\n\t<div class="qv-global-search-glass" ng-if="query.length > 0" qva-activate="close();"></div>\n</div>\n'}),define("client.views/global-search/global-search-keyboard-shortcuts",["qvangular","general.utils/qv-keyboard-shortcuts"],function(e,t){return function(n,i,r){function o(){i.activeSelectIx=i.focusState.activeStateName===i.focusState.Results?0:-1,i.activeHistoryIx=i.focusState.activeStateName===i.focusState.History?0:-1,i.activeSuggestionIx=i.focusState.activeStateName===i.focusState.Suggestions?0:-1,i.activeVisualIx=i.focusState.activeStateName===i.focusState.Visuals?0:-1,i.$broadcast(i.focusState.activeStateName===i.focusState.Visuals?"visualsGroupFocus":"visualsGroupBlur")}function s(){return"INPUT"===p[0].activeElement.tagName}function a(){t.preventDefault(),e.$rootScope.$apply()}function l(e){var t;return document.selection&&document.selection.createRange?t=document.selection.createRange().getBookmark().charCodeAt(2)-2:e.setSelectionRange&&(t=e.selectionStart),t===e.value.length}function c(e,t){i.displaySuggestions&&(t||l(d))&&(i.activeSuggestionIx=-1===i.activeSuggestionIx?0:i.activeSuggestionIx,i.onSuggestSelect()),a()}var u,h,d=n.find("input")[0],p=e.getService("$document");u={preventDefault:!1,allowInInput:!0,delay:0},h={preventDefault:!1,allowInInput:!0,delay:75},i.focusState.ActiveStateChanged.bind(o),this.keyboardShortcutsGroup=t.createGroup("global-search-"+i.app.id,1),this.keyboardShortcutsGroup.registerKeys("esc",function(){s()?i.focusState.activeStateName===i.focusState.Suggestions?r.hideSuggestions():i.query?i.query="":i.close():i.close(),a()},u),this.keyboardShortcutsGroup.registerKeys("left",function(){i.focusState.activeStateName===i.focusState.Suggestions?(i.activeSuggestionIx=i.activeSuggestionIx>0?i.activeSuggestionIx-1:i.suggestions.length-1,a()):i.focusState.activeStateName===i.focusState.Visuals&&(i.$broadcast("visualsGroupMoveActiveVisual",-1),a())},h),this.keyboardShortcutsGroup.registerKeys("right",function(){i.focusState.activeStateName===i.focusState.Suggestions?(i.activeSuggestionIx=(i.activeSuggestionIx+1)%i.suggestions.length,a()):i.focusState.activeStateName===i.focusState.Visuals&&(i.$broadcast("visualsGroupMoveActiveVisual",1),a())},h),this.keyboardShortcutsGroup.registerKeys("up",function(){var e=i.focusState.activeStateName;if(i.focusState.previous(),e===i.focusState.activeStateName)switch(i.focusState.activeStateName){case i.focusState.History:i.activeHistoryIx=Math.max(-1,i.activeHistoryIx-1);break;case i.focusState.Results:r.moveActiveResult(-1)}a()},h),this.keyboardShortcutsGroup.registerKeys("down",function(){var e=i.focusState.activeStateName;if(i.focusState.next(),e===i.focusState.activeStateName)switch(i.focusState.activeStateName){case i.focusState.History:i.activeHistoryIx=Math.min(i.activeHistoryIx+1,i.searchHistory.length-1);break;case i.focusState.Results:r.moveActiveResult(1)}a()},h),this.keyboardShortcutsGroup.registerKeys("enter",function(e){switch(i.focusState.activeStateName){case i.focusState.History:r.setQueryFromHistory(i.activeHistoryIx);break;case i.focusState.Input:i.isPartials()?r.setShowPartialMatches():i.displaySuggestions?c(0,!0):i.displayResult.data?r.select(i.searchTerms,0):r.showNoResultsMessage()&&i.haveUnlockedSelections()&&r.searchOutsideSelections();break;case i.focusState.Suggestions:c(0,!0);break;case i.focusState.Visuals:i.$broadcast("selectActiveVisualItem");break;case i.focusState.Partials:r.setShowPartialMatches();break;case i.focusState.Results:i.showMeMoreFocus?r.loadNextPage():r.select(i.searchTerms,i.activeSelectIx);break;case i.focusState.StartNewSearch:r.searchOutsideSelections()}a()},u),this.keyboardShortcutsGroup.registerKeys("tab",c,u),this.keyboardShortcutsGroup.registerKeys("ctrl+f",function(){r.closeSearch(),a()},u),this.keyboardShortcutsGroup.on(),this.on=function(){this.keyboardShortcutsGroup.on()},this.off=function(){this.keyboardShortcutsGroup.off()},this.delete=function(){this.keyboardShortcutsGroup.delete(),i.focusState.ActiveStateChanged.unbind(o)}}}),define("text!client.dialogs/object-info-dialog/content/object-info-content.ng.html",[],function(){return'<div class="q-card-content" qva-direction x-dir-setting="{{direction}}">\n\n\t<header ng-if="object.title || object.description">\n\t\t<div class="object-title" ng-if="object.title" qva-direction x-dir-text="{{object.title}}">{{object.title}}</div>\n\t\t<div ng-if="object.description" qva-direction x-dir-text="{{object.description}}" ng-bind-html="getTrustedHtml(object.description)"></div>\n\t</header>\n\n\t<section ng-if="object.dimensions.length">\n\t\t<div class="item-header" qva-direction x-dir-setting="{{direction}}">\n\t\t\t<span q-translation="Common.Dimensions"></span>\n\t\t\t<span class="item-count" dir="ltr">({{ object.dimensions.length }})</span>\n\t\t</div>\n\t\t<div class="item" ng-repeat="dimension in object.dimensions">\n\t\t\t<div class="item-title" qva-direction x-dir-text="{{dimension.title}}"><span class="lui-icon lui-icon--small lui-icon--select-alternative" q-title-translation="Tooltip.dimensions.drilldown" ng-if="dimension.isDrilldown"></span>{{ dimension.title }}</div>\n\t\t\t<div class="item-description" ng-if="dimension.description" qva-direction x-dir-text="{{dimension.description}}" ng-bind-html="getTrustedHtml(dimension.description)"></div>\n\t\t</div>\n\t</section>\n\n\t<section ng-if="object.measures.length">\n\t\t<div class="item-header" qva-direction x-dir-setting="{{direction}}">\n\t\t\t<span q-translation="Common.Measures"></span>\n\t\t\t<span class="item-count" dir="ltr">({{ object.measures.length }})</span>\n\t\t</div>\n\t\t<div class="item" ng-repeat="measure in object.measures">\n\t\t\t<div class="item-title" qva-direction x-dir-text="{{measure.title}}">{{ measure.title }}</div>\n\t\t\t<div class="item-description" ng-if="measure.description" qva-direction x-dir-text="{{measure.description}}" ng-bind-html="getTrustedHtml(measure.description)"></div>\n\t\t</div>\n\t</section>\n\n</div>'}),define("client.dialogs/object-info-dialog/content/object-info-util",["core.utils/deferred","objects.models/listbox","util","core.utils/feature-flags"],function(e,t,n,i){function r(t,n,i){var r="dimension"===n?"getDimension":"getMeasure",o="dimension"===n?"qDim":"qMeasure";return t&&i?t.app[r](i).then(function(e){return e.getLayout().then(function(e){return e[o].descriptionExpression||e.qMeta.description})}):e.resolve()}function o(e,t,n){return r(e,"dimension",t).then(function(e){var t,r="H"===n.qGrouping;return t=i.LABEL_EXPR?r?n.title:n.qFallbackTitle||n.title:n.title||n.qFallbackTitle,{title:t,description:e,isDrilldown:r}})}function s(e,t,i){var r=t.layout,o=n.getValue(r,t.ext.options.hyperCubePath||"",r),s=n.getValue(i,t.ext.options.hyperCubePath||"",i);return"map"===r.visualization?l(e,r,i):"filterpane"===r.visualization?c(e,r):"table"===r.visualization?u(e,r,i):"pivot-table"===r.visualization?h(e,r,i):a(e,o,s)}function a(t,n,i){var r,s=[];for(r=0;r<n.qHyperCube.qDimensionInfo.length;r++)s.push(o(t,i.qHyperCubeDef.qDimensions[r].qLibraryId,n.qHyperCube.qDimensionInfo[r]));return e.all(s)}function l(t,n,i){var r,s=[];for(r=0;r<n.layers.length;r++)s.push(o(t,i.layers[r].qHyperCubeDef.qDimensions[0].qLibraryId,n.layers[r].qHyperCube.qDimensionInfo[0]));return e.all(s)}function c(n,i){var r=[];return i.qChildList.qItems.forEach(function(i){r.push(t.get(i.qInfo.qId).then(function(t){return e.all({layout:t.getLayout(),properties:t.getProperties()}).then(function(e){return o(n,e.properties.qListObjectDef.qLibraryId,e.layout)})}))}),e.all(r)}function u(t,n,i){var r,s,a=[];for(r=0;r<n.qHyperCube.columnOrder.length;r++)(s=n.qHyperCube.columnOrder[r])<n.qHyperCube.qDimensionInfo.length&&a.push(o(t,i.qHyperCubeDef.qDimensions[s].qLibraryId,n.qHyperCube.qDimensionInfo[s]));return e.all(a)}function h(t,n,i){var r,s,a=[];for(r=0;r<n.qHyperCube.qEffectiveInterColumnSortOrder.length;r++)(s=n.qHyperCube.qEffectiveInterColumnSortOrder[r])>-1&&a.push(o(t,i.qHyperCubeDef.qDimensions[s].qLibraryId,n.qHyperCube.qDimensionInfo[s]));return e.all(a)}function d(e,t,n){return r(e,"measure",t).then(function(e){return{title:n,description:e}})}function p(t,i,r){var o=i.layout,s=n.getValue(o,i.ext.options.hyperCubePath||"",o),a=n.getValue(r,i.ext.options.hyperCubePath||"",r);return"map"===o.visualization?m(t,o,r):"filterpane"===o.visualization?e.resolve():"table"===o.visualization?g(t,o,r):f(t,s,a)}function f(t,n,i){var r,o=[];for(r=0;r<n.qHyperCube.qMeasureInfo.length;r++)o.push(d(t,i.qHyperCubeDef.qMeasures[r].qLibraryId,n.qHyperCube.qMeasureInfo[r].qFallbackTitle));return e.all(o)}function m(t,n,i){var r,o,s=[];for(o=0;o<n.layers.length;o++)for(r=0;r<n.layers[o].qHyperCube.qMeasureInfo.length;r++)s.push(d(t,i.layers[r].qHyperCubeDef.qMeasures[0].qLibraryId,n.layers[r].qHyperCube.qMeasureInfo[r].qFallbackTitle));return e.all(s)}function g(t,n,i){var r,o,s=[];for(r=0;r<n.qHyperCube.columnOrder.length;r++)(o=n.qHyperCube.columnOrder[r])>=n.qHyperCube.qDimensionInfo.length&&(o-=n.qHyperCube.qDimensionInfo.length,s.push(d(t,i.qHyperCubeDef.qMeasures[o].qLibraryId,n.qHyperCube.qMeasureInfo[o].qFallbackTitle)));return e.all(s)}function v(t,n,i){return e.all({title:t.layout.showTitles?t.layout.title:null,description:t.layout.descriptionExpression||i.qMetaDef.description,dimensions:s(n,t,i),measures:p(n,t,i)})}return{createObjectInfo:function(e){return e.layout.qExtendsId?e.model.app.getObject(e.layout.qExtendsId).then(function(t){return t.getProperties().then(function(n){return v(e,t,n)})}):e.model.getEffectiveProperties().then(function(t){return v(e,e.model,t)})}}}),define("client.dialogs/object-info-dialog/content/object-info-content",["qvangular","sirtrevor","client.utils/rtl/direction-service","text!./object-info-content.ng.html","./object-info-util"],function(e,t,n,i,r){"use strict";function o(e){var t=/(https?:\/\/[^\s<]+)/g;return e.indexOf("javascript:")>-1?e:e.replace(t,'<a href="$1" target="_blank">$1</a>')}return{template:i,scope:{close:"&"},controller:["$scope",function(i){var s=e.getService("$sce");i.direction=n.direction,i.getTrustedHtml=function(e){return e?s.getTrustedHtml(o(t.toHTML(e))):null},r.createObjectInfo(i.input.object).then(function(e){i.object=e})}]}}),define("text!client.dialogs/object-info-dialog/card/object-info-card.ng.html",[],function(){return'<div class="q-card-header-container" qva-direction x-dir-setting="{{direction}}">\n\t<div class="q-card-header">\n\t\t<span q-translation="ObjectInfo.Dialog.Header"></span>\n\t</div>\n\t<div>\n\t\t<button class="lui-fade-button close-button" q-title-translation="Common.Close" qva-activate="close()">\n\t\t\t<span class="lui-button__icon  lui-icon  lui-icon--close"></span>\n\t\t</button>\n\t</div>\n</div>\n<div class="content"></div>'}),define("client.dialogs/object-info-dialog/card/object-info-card",["client.utils/rtl/direction-service","client.dialogs/object-info-dialog/content/object-info-content","text!./object-info-card.ng.html"],function(e,t,n){"use strict";return{template:n,scope:{close:"&"},controller:["$scope","$element",function(n,i){n.direction=e.direction,i.find(".content").showComponent(t,{input:n.input})}]}}),define("client.dialogs/object-info-dialog/card/object-info-card-service",["qvangular","./object-info-card","general.utils/responsive-state"],function(e,t,n){function i(){o=null,n.ViewChanged.unbind(r)}function r(){e.getService("cardService").close()}var o=null,s={show:function(s){n.ViewChanged.bind(r);var a={cardSteps:[{component:t,input:{object:s}}],onClose:i};o=s.id,e.getService("cardService").show(a)},isShowing:function(){return o}};return e.service("objectInfoCard",[function(){return s}]),s}),define("client.services/preferred-grid-service",[],function(){var e=12;return{setPreferredGridSize:function(t){e=t},getPreferredGridSize:function(){return e}}}),define("client.property-panel/components/components",[],function(){function e(e){return t[e]}var t={missing:{template:"<div></div>",controller:[function(){}]}};return{getComponent:e,hasComponent:function(t){return!!e(t)},findComponent:function(e){var n=e.component;if("string"==typeof n)return t[n]?t[n]:(window.console.log('Error! No component found with name "'+n+'"'),t.missing);if("object"==typeof n)return n;switch(e.type){case"items":return t.items;case"string":return t.string;case"integer":return t.integer;case"number":return t.number;case"boolean":return t.checkbox;case"array":return e.items?t.list:t.slider;default:return e.type?(window.console.log('Error! No component found for type "'+e.type+'"'),t.missing):(window.console.log('Warning! Missing component/type in definition. Using "items" component.'),t.items)}},addComponent:function(e,n){if(t[e])throw"Property panel component already loaded: "+e;t[e]=n}}}),define("client.property-panel/component-utils",["qvangular","client.utils/property-resolver","core.utils/deferred","util","translator"],function(e,t,n,i,r){function o(e,t,n){return"function"==typeof e.refFn?e.refFn(t,n):e.ref}var s={defineValue:function(n,i,r,a){function l(e){var s=o(i,r(),n.args),a=t.getValue(r(),s);return void 0===a?t.getUndefinedValue(e,i):a}function c(a,l,c){var u=t.getTypeValue(a,l,c),h=r(),d=o(i,h,n.args);i.rollbackInvalid?s.validateType(u,i,h)?t.setValue(h,d,u):e.getService("$timeout")(function(){e.$rootScope.$broadcast("pp-revalidate")}):t.setValue(h,d,u)}var u,h,d;i.convertFunctions?(h=function(){return i.convertFunctions.get(l,i,n.args)},d=function(e){return i.convertFunctions.set(e,c,i,n.args)}):(h=function(){return l(i.type)},d=function(e){var n=t.getDefaultValue(i.type,i);c(i.type,e,n)}),u=void 0!==a?a:"value",Object.defineProperty(n,u,{get:h,set:d})},defineExpression:function(e,n,i){var r=e.definition.expression,s=e.definition.expressionType,a="optional"===r||"always"===r,l=n?"qValueExpression":"qStringExpression";!s&&a&&(s=n?"ValueExpression":"StringExpression"),e.expressionType=s,e.isExpressionDefinition=a,Object.defineProperty(e,"displayValue",{get:function(){var t=e.value;return t&&"object"==typeof t&&(t=t[l].qExpr)&&"="!==t[0]&&(t="="+t),t},set:function(t){var n,i=a&&t&&0===t.indexOf("=");t&&i?(n={})[l]={qExpr:t.substr(1)}:n=t,e.value=n}}),e.isExpression=function(){if("always"===r)return!0;if("optional"===r){var n=o(e.definition,e.data,e.args);return"object"==typeof t.getValue(e.data,n)}return!!s},e.isLocked=function(){if(a){var t=e.value;if("object"==typeof t&&(t=t[l].qExpr),!t||n&&"number"==typeof t)return!1;var r=i&&-1!==t.indexOf("\n");return t&&(r||t.length>e.maxlength)}return!1}},defineChange:function(e,t){function n(){e.$emit("saveProperties")}e.change=function(){if("function"==typeof e.definition.change){var i=e.definition.change(e.data,t,e.args.properties,e.args);"object"==typeof i&&i.then?i.then(function(e){!1!==e&&n()}):!1!==i&&n()}else n()}},defineVisible:function(e,t){var n=e.definition.show;"function"==typeof n?Object.defineProperty(e,"visible",{get:function(){return n(e.data,t,e.args)}}):e.visible="boolean"!=typeof n||n},defineReadOnly:function(e,t){var n=e.definition.readOnly;"function"==typeof n?Object.defineProperty(e,"readOnly",{get:function(){return n(e.data,t,e.args)}}):e.readOnly="boolean"==typeof n&&n},definePlaceholder:function(e,t){t.placeholderTranslation?e.placeholder=r.get(t.placeholderTranslation):t.placeholder&&(e.placeholder=t.placeholder)},defineLabel:function(e,t,n,i){return t.translation?e.label=r.get(t.translation):"function"==typeof t.label?Object.defineProperty(e,"label",{get:function(){return t.label(n(),i)}}):t.label&&(e.label=t.label),""},defineCustom:function(e,t,n){var i=e.definition[n];"function"==typeof i?Object.defineProperty(e,n,{get:function(){return i(e.data,t,e.args,e)}}):i&&(e[n]=i)},fillOptions:function(e,t,i,o,s){function a(e){return e.filter(function(e){return!!e}).map(function(e){var t={value:e.value};return e.translation?t.label=r.get(e.translation):e.label?t.label=e.label:t.label=e.value,e.tooltipTranslation?t.tooltip=r.get(e.tooltipTranslation):e.tooltip&&(t.tooltip=e.tooltip),t})}var l=new n;return function(){var r=e.options;return"function"==typeof r&&(r=e.options.call(null,t,i,s)),"object"==typeof r&&"function"==typeof r.then?r:n.resolve(r)}().then(function(e){e=a(e),o.splice(0,o.length);for(var t=0;t<e.length;++t)o.push(e[t]);l.resolve()},l.reject),l.promise},validateType:function(e,t,n,r){var o=!1;return"boolean"==typeof t.invalid&&(o=o||t.invalid),"function"==typeof t.invalid&&(o=o||t.invalid.call(null,n,r.properties,r)),"number"===t.type&&(i.isNumeric(e)?("number"==typeof t.max&&e>t.max&&(o=!0),"number"==typeof t.min&&e<t.min&&(o=!0)):o=!0),"integer"===t.type&&(i.isInteger(e)?("number"==typeof t.max&&e>t.max&&(o=!0),"number"==typeof t.min&&e<t.min&&(o=!0)):o=!0),"string"===t.type&&(void 0!==t.maxlength&&(o=o||e.length>t.maxlength),void 0!==t.minlength&&(o=o||e.length<t.minlength)),!o}};return s}),define("text!client.property-panel/sheet-properties/sheet-thumbnail/sheet-thumbnail.ng.html",[],function(){return'<div class="pp-component pp-media-component pp-sheet-thumbnail-component" tcl="media">\n\t<div class="label" ng-if="label">{{label}}</div>\n\t<div class="value">\n\t\t<div class="placeholder">\n\t\t\t<div qv-ao-thumb item="item" issheet="true" thumbprop="data.thumbnail" thumblayout="thumbLayout.thumbnail" editmode="!readOnly" thumb-width="221" thumb-height="128" emitchanges="true"></div>\n\t\t</div>\n\t</div>\n</div>\n'}),define("client.property-panel/sheet-properties/sheet-thumbnail/sheet-thumbnail",["client.property-panel/components/components","client.property-panel/component-utils","text!./sheet-thumbnail.ng.html"],function(e,t,n){var i={template:n,controller:["$scope",function(e){t.defineLabel(e,e.definition,function(){return e.data},e.args.handler),t.defineReadOnly(e,e.args.handler),e.item={qData:e.data,qMeta:{published:e.args.model.layout.qMeta.published}},e.save=function(){e.$emit("saveProperties")},e.$on("thumbnailchanged",function(){e.save()}),e.$on("layoutchanged",function(t,n){e.thumbLayout={thumbnail:n.thumbnail}}),e.thumbLayout={thumbnail:e.args.model.layout.thumbnail}}]};return e.addComponent("sheet-thumbnail",i),i}),define("client.property-panel/sheet-properties/sheet-properties",["core.utils/feature-flags","client.services/preferred-grid-service","util","client.property-panel/sheet-properties/sheet-thumbnail/sheet-thumbnail"],function(e,t){var n={type:"items",component:"accordion",items:{sheetProps:{type:"items",translation:"properties.sheetProperties",items:{title:{type:"string",ref:"qMetaDef.title",translation:"Common.Title",minlength:1,readOnly:function(e,t,n){var i=n.layout;return i&&(i.permissions&&!i.permissions.update||i.qMeta&&i.qMeta.sourceObject&&i.qMeta.sourceObject.length>0)},rollbackInvalid:!0},labelExpression:{type:"string",ref:"labelExpression",translation:"properties.titleExpression",readOnly:function(e,t,n){var i=n.layout;return i&&(i.permissions&&!i.permissions.update||i.qMeta&&i.qMeta.sourceObject&&i.qMeta.sourceObject.length>0)},rollbackInvalid:!0,expression:"optional",show:e.SHEET_NAME_EXPR},description:{type:"string",component:"textarea",readOnly:function(e,t,n){var i=n.layout;return i&&i.permissions&&!i.permissions.update},change:function(e,t,n){"object"==typeof n.qMetaDef.description?(n.descriptionExpression=n.qMetaDef.description,n.qMetaDef.description=""):"string"==typeof n.descriptionExpression&&n.descriptionExpression&&(n.qMetaDef.description=n.descriptionExpression,n.descriptionExpression=void 0)},refFn:function(t){return e.DESCRIPTION_EXPR&&"object"==typeof t.descriptionExpression?"descriptionExpression":"qMetaDef.description"},translation:"Common.Description"},thumbnail:{translation:"properties.sheetProperties.thumbnail",type:"string",readOnly:function(e,t,n){var i=n.layout;return i&&i.permissions&&!i.permissions.update},component:"sheet-thumbnail",defaultValue:""},gridSize:{type:"items",ref:"grid",show:function(){return e.GRID_SIZE},items:{dropDown:{translation:"properties.gridSize",readOnly:function(e,t,n){return 0!==e.cells.length||!n.layout.permissions.update},type:"number",component:"dropdown",ref:"rows",defaultValue:t.getPreferredGridSize,options:[{value:12,translation:"properties.gridSmall"},{value:15,translation:"properties.gridMedium"},{value:18,translation:"properties.gridLarge"}],change:function(e){t.setPreferredGridSize(e.rows),e.columns=2*e.rows}},allowShowDetailsMessage:{component:"text",translation:"properties.gridSizeFootnote",style:"hint"}}}}}}};return e.DESCRIPTION_EXPR&&(n.items.sheetProps.items.description.expression="optional"),n}),define("client.views/sheet/sheet-service",["qvangular","pubsub","client.utils/state","client.services/stage-state","client.property-panel/sheet-properties/sheet-properties"],function(e,t,n,i,r){e.service("qvSheetService",function(){var o,s=e.getService("$cacheFactory")("pp-sheet");return{set:function(e){o=e},get:function(){return o},destroy:function(){o=null},setSheetAsSelectedObj:function(){var e=n.model,o=e.id,a={id:e.id,type:"sheetCell",canCopy:function(){return!1},canCut:function(){return!1},canRemove:function(){return!1},remove:function(){},paste:function(){t.publish("/activeSheet/pasteObject",null)},getAllPropertyPanelContent:function(){return e.getProperties().then(function(t){return e.getLayout().then(function(n){if(o===t.qInfo.qId)return{properties:t,layout:n,definition:r,type:"sheet",model:e,iconName:"sheet",titleRef:"qMeta.title",cache:s}})})}};return i.setSelectedObject(a)}}})}),define("client.controllers/grid-controller",["jquery","angular","qvangular","core.utils/deferred","client.utils/state","general.utils/responsive-state","general.utils/support","client.services/stage-state","pubsub","objects.utils/interaction-states","client.utils/rtl/direction-service","client.dialogs/object-info-dialog/card/object-info-card-service","client.views/sheet/sheet-service"],function(e,t,n,i,r,o,s,a,l,c,u){"use strict";function h(e,t){for(var n=[],i=0;i<t;i++){n[i]=[];for(var r=0;r<e;r++)n[i][r]=1}return n}function d(e,t){var n,i,r=t.row+t.rowspan,o=t.col+t.colspan;for(n=t.row;n<r;n++)for(i=t.col;i<o;i++)e[n][i]=0}function p(e,t){return{id:t.id,type:"gridCell",customObject:t,canCopy:function(){return!t.object.isInvalid},copy:function(){l.publish("/activeSheet/copyObject",t)},canCut:function(){return!t.object.isInvalid},cut:function(){l.publish("/activeSheet/cutObject",t)},paste:function(){l.publish("/activeSheet/pasteObject",t)},canRemove:function(){return!0},remove:function(){e.gridService.removeCell(t)},getAllPropertyPanelContent:function(){var e=null;return t.getVisualization().then(function(t){return e=t.model.id,t.getPropertyPanelContent().then(function(n){var r=n.type,o=n.app;return i.all({appLayout:o.getLayout(),properties:t.model.getProperties(),layout:t.model.getLayout()}).then(function(s){return e!==s.properties.qInfo.qId?i.resolve(null):{definition:n.definition,globalChangeListeners:n.globalChangeListeners,type:r.type,ext:n.ext,handler:n.handler,iconName:n.iconName,titleRef:n.titleRef,properties:s.properties,layout:s.layout,localeInfo:s.appLayout.qLocaleInfo,app:o,model:t.model,cache:S}})})})}}}function f(e,t){var n=e.rectFor(t);return{width:"calc( "+n.width+"% - "+2*n.margin+"px )",height:"calc( "+n.height+"% - "+2*n.margin+"px )",left:"calc( "+n.left+"% + "+n.margin+"px )",top:"calc( "+n.top+"% + "+n.margin+"px )"}}function m(e){e.getVisualization().then(function(t){t.getPreferredSize().then(function(t){t&&o.isSmallDevice&&(e.style={width:t.w+"px",height:t.h+"px"})})})}function g(e,t,n){var i=100/t,r=100/n;e.rectFor=function(e){var t=e.colspan*i,n=e.rowspan*r;return{left:e.col*i,top:e.row*r,width:t,height:n,margin:2}};var o,s=[],a=[];for(o=0;o<t-1;++o){var l=(o+1)*i;a.push({left:l+"%"})}for(o=0;o<n-1;++o){var c=(o+1)*r;s.push({top:c+"%"})}e.cols=t,e.rows=n,e.horizontalLines=s,e.verticalLines=a}function v(e,t){var n=t.qInfo.qId!==e.lastSheetId,i=!n&&r.isInEditMode()&&!e.zoomCell&&t.permissions.update;e.lastSheetId=t.qInfo.qId,e.hasUpdatePermission=t.permissions.update,e.isSheet=!0,e.isMaster=!1,e.sheetTitle=t.labelExpression||t.qMeta&&t.qMeta.title||"",e.isDraft=t.qMeta&&t.qMeta.sourceObject&&t.qMeta.sourceObject.length,e.isDraftOwner=t.qMeta&&t.qMeta.draftObject&&t.qMeta.draftObject.length,!n&&e.hasUpdatePermission||e.clearActiveCell(),n&&(e.cells=[]),x(e,t.cells.slice(),i)}function y(t,i,o){return{active:!1,visible:!1,items:[{translation:"contextMenu.showDetails",tid:"nav-menu-info",cssClasses:"lui-icon lui-icon--info",dynamicCssClasses:function(){var e=[];return i.zoomCell?e.push("big"):e.push("border","white"),e.join(" ")},isVisible:function(){return(s.treatAsDesktop()||i.zoomCell)&&!r.isInEditMode()&&!o.object.isInvalid&&o.object.supportObjectInfo()},action:function(){n.getService("objectInfoCard").show(o.object)}},{translation:"Visualization.Unlink",tid:"nav-menu-link",cssClasses:"lui-icon lui-icon--link",dynamicCssClasses:function(){var e=[];return i.zoomCell?e.push("big"):e.push("border","white"),e.join(" ")},isVisible:function(){return(s.treatAsDesktop()||i.zoomCell)&&o.object.isLink&&r.isInEditMode()},action:function(){o.getVisualization().then(function(e){require("client.services/link-object-service").showBreakLinkDialog(e.model)})}},{translation:"contextMenu.takeSnapshot",tid:"nav-menu-snapshot",cssClasses:"lui-icon lui-icon--camera",dynamicCssClasses:function(){var e=[];return i.zoomCell?e.push("big"):e.push("border","white"),o.snapshot.dialogOpen&&e.push("blue"),e.join(" ")},isVisible:function(){return(s.treatAsDesktop()||i.zoomCell)&&!o.object.isInvalid&&!i.zooming&&!r.isInEditMode()&&o.object.supportSnapshot()&&t.permissions.createBookmark||o.snapshot.isAnnotating},action:function(){if(!o.snapshot.snapshotTimer){o.snapshot.snapshotTimer=setTimeout(function(){o.snapshot.snapshotTimer=null},1e3);o.snapshot.isAnnotating||(i.zoomCell&&o.object.showExploreMenu?(o.object.toggleExploreMenu(),o.object.resize(),o.snapshot.take(!0)):i.zoomCell?o.snapshot.take(!0,!0):o.snapshot.take(!0))}}},{translation:"Tooltip.ExplorationMenu",tid:"nav-menu-explore",cssClasses:"lui-icon lui-icon--control",dynamicCssClasses:function(){var e=[];return o.object.showExploreMenu&&e.push("active"),i.zoomCell?e.push("big"):e.push("border","white"),e.join(" ")},isVisible:function(){return(s.treatAsDesktop()||i.zoomCell)&&o.object.canShowExploreMenu()&&!r.isInEditMode()&&!i.zooming},action:function(){i.zoomCell?(o.object.toggleExploreMenu(),o.object.resize()):(i.zoom(o),o.object.toggleExploreMenu(!0))}},{translation:"Tooltip.ZoomOut",tid:"nav-menu-zoom-out",cssClasses:"lui-icon lui-icon--remove big",isVisible:function(){return i.isSheet&&i.zoomCell===o&&!i.zooming},action:function(){o.navMenu.visible=!1,o.object.showExploreMenu&&o.object.toggleExploreMenu(!1),e(".embedded-sheet-toolbar").length>0&&e(".embedded-sheet-toolbar").css("display","block"),i.zoom(null)}},{translation:"Tooltip.ZoomIn",tid:"nav-menu-zoom-in",cssClasses:"lui-icon lui-icon--expand white border",isVisible:function(){return s.treatAsDesktop()&&!i.zoomCell&&!o.object.isInvalid&&!i.zooming},action:function(){i.zoom(o)}}]}}function b(e,t){var n;if(!t)return null;for(n=0;n<t.length;++n)if(t[n].id===e)return t[n];return null}function x(e,t,n){function o(t){d(f,t);var n={},i={col:t.col,row:t.row,colspan:t.colspan,rowspan:t.rowspan};e.setCellSize(n,i),n.isEmpty=!0,n.navMenu={},p.push(n)}function s(){function e(e,t,n){for(var s=e;i.length>0;){var a=i[i.length-1];if(a.rowSpan===n)return;if(a.rowSpan<n)break;i.pop(),s=a.col;var l=e-a.col,c=a.rowSpan*l;c>r&&(r=c,o={col:a.col,row:t,colspan:l,rowspan:a.rowSpan})}n>0&&i.push({col:s,rowSpan:n})}for(var t,n,i,r,o,s=a,c=[];s--;)for(n=0,t=l,c[s]=[];t--;)f[t][s]?c[s][t]=++n:(n=0,c[s][t]=null);for(o=null,r=0,i=[],t=0;t<l;++t){for(s=0;s<a;++s)null!==c[s][t]?e(s,t,c[s][t]):e(s,t,0);e(s,t,0)}return o}var a=e.cols,l=e.rows,p=[],f=h(a,l);t.forEach(function(t){d(f,t);var o=b(t.name,e.cells);if(o)o.options.canSaveSoftProperties=q(e);else{(o={}).id=t.name;var s,a=i();s=r.state===r.States.edit?c.EDIT:c.ANALYSIS,o.options={setController:a.resolve,id:t.name,isVisible:!0,isZoomed:!1,isActive:!1,canSaveSoftProperties:q(e),interactionState:s,direction:u.direction,removeIt:function(){e.gridService.removeCell(o)}},e.app.getLayout().then(function(t){o.navMenu=y(t,e,o)}),e.app.getObject(t.name).then(function(t){o.model=t,n&&e.toggleActive(o)}),o.getVisualization=function(){return a.promise}}var l={col:t.col,row:t.row,colspan:t.colspan,rowspan:t.rowspan};e.setCellSize(o,l),o.isEmpty=!1,p.push(o)}),!e.hasUpdatePermission&&e.zoomCell&&r.state===r.States.edit&&e.zoom(null),function(e){e.sort(function(e,t){return e=e.pos,t=t.pos,e.row-t.row}).sort(function(e,t){return e=e.pos,t=t.pos,e.row===t.row?e.col-t.col:e.row-t.row})}(p),function(){for(var e,n=1;e=s();)e.priority=n++,t.push(e),o(e)}(),e.cells=p}function q(e){return e.hasUpdatePermission&&!o.isSmallDevice}function C(e,t){this.gridService=e,this.blocked=!1,this.app=t}var S=t.injector(["ng"]).get("$cacheFactory")("pp-object");return C.prototype.updateCellsSize=function(e){var t=this;for(var n in e.cells)t.setCellSize(e.cells[n],e.cells[n].pos)},C.prototype.setCellSize=function(e,t){o.isSmallDevice&&e.getVisualization?e.style=m(e):e.style=f(this,t),e.options&&(e.options.canSaveSoftProperties=q(this)),e.pos=t},C.prototype.block=function(){this.blocked=!0,this.removeResizeHandles()},C.prototype.unblock=function(){this.blocked=!1,this.updateActiveCell()},C.prototype.isBlocked=function(){return this.blocked},C.prototype.updateActiveCell=function(){function e(e,t){t>=0&&c[e]>t&&(c[e]=t)}function t(e){var t={top:!0,bottom:!0}[e]||!1,n={X:0,Y:0},r=!1;if({left:!0,right:!0}[e]||!1)n.X=c[e],r=i.colspan<=1;else if(t)n.Y=c[e],r=i.rowspan<=1;else{var o=e.split("-");n.Y=c[o[0]],n.X=c[o[1]],r=i.rowspan<=1&&i.colspan<=1}0===n.Y&&0===n.X&&r||m.push({dir:e,expand:n,contract:{X:i.colspan-1,Y:i.rowspan-1}})}var n=this;if(n.activeCell&&r.isInEditMode()&&!this.blocked){for(var i=n.activeCell.pos,o=i.col,s=o+i.colspan,a=i.row,l=a+i.rowspan,c={left:o,right:n.cols-s,top:a,bottom:n.rows-l},u=0;u<n.cells.length;++u)if(n.cells[u]!==n.activeCell&&!n.cells[u].isEmpty){var h=n.cells[u].pos.col,d=h+n.cells[u].pos.colspan,p=n.cells[u].pos.row,f=p+n.cells[u].pos.rowspan;p<l&&f>a&&(e("left",o-d),e("right",h-s)),h<s&&d>o&&(e("top",a-f),e("bottom",p-l))}var m=[];t("left"),t("right"),t("top"),t("bottom"),t("top-left"),t("bottom-right"),t("top-right"),t("bottom-left"),n.activeCell.resize=m,n.activeCell.updating=!1}},C.prototype.removeResizeHandles=function(){var e=this;e.activeCell&&delete e.activeCell.resize},C.prototype.clearActiveCell=function(){var e=this;e.removeResizeHandles(),e.activeCell=null},C.prototype.setCellSelected=function(e){e&&!e.isEmpty?"gridCell"===a.selectedObject.type&&a.selectedObject.id===e.id||a.setSelectedObject(p(this,e)):n.getService("qvSheetService").setSheetAsSelectedObj()},C.prototype.toggleActive=function(e){var t=this;r.isInEditMode()&&(!e||t.zoomCell||e.isEmpty?t.clearActiveCell():(t.clearActiveCell(),t.hasUpdatePermission&&(t.activeCell=e),t.updateActiveCell()),t.setCellSelected(e))},C.prototype.setEditMaster=function(e,t){var n=this,i=[{name:e,type:t,col:0,row:0,colspan:1,rowspan:1}];n.lastSheetId=null,n.isSheet=!1,n.isMaster=!0,g(n,1,1),n.clearActiveCell(),x(n,i,!1),n.setCellSelected(n.cells[0]),n.zoom(n.cells[0])},C.prototype.update=function(e){if(e){var t=this;t.layout=e,g(t,e.columns||12,e.rows||7),v(t,e),t.activeCell&&-1===t.cells.indexOf(t.activeCell)&&t.setCellSelected(null),t.zoomCell&&-1===t.cells.indexOf(t.zoomCell)&&(t.zoomCell=null,t.setCellSelected(null)),t.updateActiveCell()}},C.prototype.zoom=function(e){var t=this;t.cells&&(t.cells.forEach(function(t){t.options&&(t.options.isVisible=t===e||!e,t.options.isZoomed=t===e&&!!e)}),e?(t.clearActiveCell(),t.zoomCell=e,t.gridService.saveScrollState(),e.object&&(e.object.expanded=!!e)):t.zoomCell&&(t.zoomCell.object&&(t.zoomCell.object.expanded=!1),t.clearActiveCell(),t.hasUpdatePermission&&(t.activeCell=t.zoomCell),t.zoomCell=null,t.updateActiveCell(),t.gridService.restoreScrollState()))},C.prototype.highlight=function(e){var t=this;t.cells&&t.cells.forEach(function(t){t.isHighlighted=t===e||!e})},C.prototype.exploreMenu=function(e,t){e&&e.object&&e.object.hasSoftProperties&&e.object.toggleExploreMenu(t)},C.prototype.getOptimalCell=function(){var e=this.cells.slice();e.sort(function(e,t){if(e.isEmpty&&!t.isEmpty)return-1;if(t.isEmpty&&!e.isEmpty)return 1;var n=e.pos.colspan*e.pos.rowspan,i=t.pos.colspan*t.pos.rowspan;return n>i?-1:n<i?1:0});var t=e[0]||null;if(t&&!t.isEmpty)if(t.pos.colspan>1||t.pos.rowspan>1){var n=t.pos.colspan>t.pos.rowspan?"right":"bottom";t={isEmpty:!0,pos:{pos:t.pos,split:n}}}else t=null;return t},C}),define("client.services/grid-service",["qvangular","core.utils/deferred","core.utils/bind-layout","general.utils/responsive-state","client.services/stage-state","client.controllers/grid-controller","client.utils/state","jquery","translator"],function(e,t,n,i,r,o,s,a,l){"use strict";function c(e,t){s.setView(e);var n=a(document.body);n.toggleClass("qv-view-sheet",!t),n.toggleClass("qv-view-object",t),n.toggleClass("qv-gridzoom",t)}function u(){v.grid.updateCellsSize(v.grid)}function h(e){v&&(v.model=e,v.grid.unblock())}function d(){var t=v&&v.grid.getOptimalCell();return t||e.getService("qvAlertDialog").show({title:l.get("Ui.Warning.GridFull.Title"),message:l.get("Ui.Warning.GridFull"),closeLabel:l.get("Common.OK")}),t}function p(){return v&&v.grid.isBlocked()}function f(e){return p()?t.reject():(v.grid.block(),v.model.removeObject(e).finally(function(){v.grid.unblock()}))}function m(){return v&&v.grid&&!v.model}function g(){m()&&(h(s.model),c(s.Views.sheet,!1))}var v=null,y=null,b={gridElement:null,scrollTop:0,scrollLeft:0,lastZoomedCell:null,intervalPromise:null,hightlightedCellId:null};return{start:function(t){var a;v||((v=e.$rootScope.$new(!0)).grid=new o(this,t.enigmaModel.app),v.model=t,v.stageState=r,n(v,"model",function(e){v&&v.grid.update(e)}),i.ViewChanged.bind(u),v.$watch(s.isInEditMode,function(e){a=e,v.grid.update(v.grid.layout),a?v.grid.updateActiveCell():(v.grid.removeResizeHandles(),g())}),v.$watch("grid.zoomCell",function(e){m()||s.view===s.Views.story&&s.state!==s.States.analysis||c(e?s.Views.object:s.Views.sheet,!!e)}),v.$watch("grid.changedZoom",function(e){!1!==e||v.grid.zoomCell||u(v.grid)}),v.$watch("stageState.selectedObject",function(e){v&&e&&"gridCell"!==e.type&&v.grid.clearActiveCell()}),s.SheetChanged.bind(h))},stop:function(){y||(y=e.getService("$interval")),v&&(v.$destroy(),v=null,i.ViewChanged.unbind(u),s.SheetChanged.unbind(h),y.cancel(b.intervalPromise),b.gridElement=null)},goToEditMode:function(){s.setState(s.States.edit)},getOptimalCell:d,removeCell:function(e){v&&f(e.pos)},isActive:function(){return!!v},getGrid:function(){return v&&v.grid},getModel:function(){return v&&v.model},activateCell:function(e){v&&v.grid.toggleActive(e)},deactivateCell:function(){v&&v.grid.toggleActive(null)},getZoomCell:function(){return v&&v.grid.zoomCell},getZoomedCellId:function(){return v.grid.zoomCell.id},zoomInOnCell:function(e){var t;v&&(t=v.grid.cells.filter(function(t){return t.id===e})).length&&v.grid.zoom(t[0])},zoomOut:function(){v&&v.grid.zoom(null)},saveZoom:function(){!b.lastZoomedCell&&v.grid.zoomCell&&v.grid.zoomCell.id&&(b.lastZoomedCell=v.grid.zoomCell.id)},restoreZoom:function(){b.lastZoomedCell&&e.getService("$timeout")(function(){v.grid.blockZoomAnimation=!0,this.zoomInOnCell(b.lastZoomedCell),b.lastZoomedCell=null}.bind(this))},setGridElement:function(e){b.gridElement=e},saveScrollState:function(){!b.lastZoomedCell&&b.gridElement&&(b.scrollTop=b.gridElement.scrollTop,b.scrollLeft=b.gridElement.scrollLeft)},restoreScrollState:function(){y||(y=e.getService("$interval")),b.lastZoomedCell||(b.scrollTop>0&&(b.intervalPromise=y(function(){b.gridElement.children.length>0&&(b.gridElement.scrollTop=b.scrollTop,b.scrollTop=0,y.cancel(b.intervalPromise))},50)),b.scrollLeft>0&&(b.intervalPromise=y(function(){b.gridElement.children.length>0&&(b.gridElement.scrollLeft=b.scrollLeft,b.scrollLeft=0,y.cancel(b.intervalPromise))},50)))},getCellWithId:function(e){if(v){var t=v.grid.cells.filter(function(t){return t.id===e});return t.length?t[0]:null}return null},highlightedCell:function(e){e&&(b.hightlightedCellId=e);var t;v&&b.hightlightedCellId&&(t=v.grid.cells.filter(function(e){return e.id===b.hightlightedCellId})).length&&(v.grid.highlight(t[0]),b.hightlightedCellId=null)},isBlocked:p,addObject:function(e){return p()?t.reject():(v.grid.block(),v.model.addObject(e).finally(function(){v.grid.unblock()}))},addCaoObject:function(e,n){var i,r=n||s.model,o=v.grid&&v.grid.layout&&v.grid.layout.qMeta&&v.grid.layout.qMeta.published;return p()||o?t.reject():(v.grid.block(),i={cell:d(r),init:e,template:e.qInfo.qType},v.model.addObject(i,r).finally(function(){v.grid.unblock()}))},swapObjects:function(e,n){return p()?t.reject():v.model.swapObjects(e,n)},moveObject:function(e,n){return p()?t.reject():v.model.moveObject(e,n)},isEditMaster:m,closeEditMaster:g,editMaster:function(e,t){v&&(v.model=null,v.grid.setEditMaster(e,t),c(s.Views.masterObject,!0))}}}),define("client.views/global-search/constants/request-state",[],function(){"use strict";var e={};return Object.defineProperties(e,{idle:{value:0},pending:{value:1}}),e}),define("client.views/global-search/constants/search-method",[],function(){"use strict";var e={};return Object.defineProperties(e,{data:{value:"searchResults"},visuals:{value:"searchObjects"},indexProgress:{value:"GetProgress"}}),e}),define("client.views/global-search/focus-state",["core.utils/notification"],function(e){"use strict";function t(n,i){var r=n[i];if(!(this instanceof t))throw new Error("FocusState needs to be called with the new keyword");if(!r)throw new Error("Invalid initialStateName provided");e.mixin(this),this.notification("ActiveStateChanged"),Object.defineProperties(this,{initialState:{value:r},activeState:{configurable:!0,value:r},activeStateName:{configurable:!0,value:r.name}})}function n(e,t){Object.defineProperties(e,{activeState:{value:t},activeStateName:{value:t.name}}),e.ActiveStateChanged.emit()}function i(e,t){var n={value:t};Object.defineProperty(e,t,n),Object.defineProperty(e.prototype,t,n)}return t.prototype.next=function(){var e=this.activeState;if(!e.onBeforeNext||e.onBeforeNext())for(var t=e.next();t;){if(!t.onBeforeEnter||t.onBeforeEnter())return void n(this,t);t=t.next()}},t.prototype.previous=function(){var e=this.activeState;if(!e.onBeforePrevious||e.onBeforePrevious())for(var t=e.previous();t;){if(!t.onBeforeEnter||t.onBeforeEnter())return void n(this,t);t=t.previous()}},t.prototype.reset=function(){n(this,this.initialState)},i(t,"Input"),i(t,"Suggestions"),i(t,"History"),i(t,"Partials"),i(t,"Visuals"),i(t,"Results"),i(t,"StartNewSearch"),t}),define("client.views/global-search/focus-state-definitions",[],function(){"use strict";function e(e){var t=this[e];if(!t)throw new Error("Invalid stateName provided");return t}function t(e,t,n){if(e[t])throw new Error("State with name '"+t+"' already exists");n.name=t,e[t]=n}return function(n,i,r){var o={};return t(o,n.Input,{previous:function(){return!1},onBeforeNext:function(){return!r.throbber.show},next:e.bind(o,n.Suggestions)}),t(o,n.Suggestions,{onBeforeEnter:function(){return!!r.displaySuggestions},previous:e.bind(o,n.Input),next:e.bind(o,n.History)}),t(o,n.History,{onBeforeEnter:function(){return r.isSearchHistoryFeature&&r.searchInputFocused&&0===r.query.length},onBeforeNext:function(){return!1},onBeforePrevious:function(){return 0===r.activeHistoryIx},previous:e.bind(o,n.Suggestions),next:e.bind(o,n.Visuals)}),t(o,n.Visuals,{onBeforeEnter:function(){return r.isObjectsFeature&&r.displayResult.visuals&&!r.isSmallDeviceLandscape},previous:e.bind(o,n.History),next:e.bind(o,n.Partials)}),t(o,n.Partials,{onBeforeEnter:function(){return!!r.displayResult.data&&r.isPartials()},previous:e.bind(o,n.Visuals),next:e.bind(o,n.Results)}),t(o,n.Results,{onBeforeEnter:function(){return!!r.displayResult.data&&(!r.isPartials()||r.forcePartials)},onBeforeNext:function(){return!1},onBeforePrevious:function(){return 0===r.activeSelectIx},previous:e.bind(o,n.Partials),next:e.bind(o,n.StartNewSearch)}),t(o,n.StartNewSearch,{onBeforeEnter:function(){return i.showNoResultsMessage()&&r.haveUnlockedSelections()},previous:e.bind(o,n.Results),next:function(){return!1}}),o}}),define("scripteditor.services/local-storage-service",["underscore","general.utils/string-util"],function(e,t){function n(t){if(!e.isString(t))throw'The key "'+t+'" is not a String.';return s+"."+t}function i(t){if(!e.isString(t))throw'The key "'+t+'" is not a String.';return!e.isEmpty(localStorage[n(t)])}function r(e){return JSON.parse(localStorage[n(e)])}function o(t){if(!e.isString(t))throw'The key "'+t+'" is not a String.';if(!i(t))throw'There is no data set for the key "'+t+'". Please use contains() first to verify you should actually do a get().';delete localStorage[n(t)]}var s="localstorageservice";return{set:function(t,i,r){var o,s,a=(new Date).getTime();if(!e.isString(t))throw'The key "'+t+'" is not a String.';if(!e.isObject(i))throw'The value "'+i+'" for the key "'+t+'" is not valid object.';if(r){if(!e.isNumber(r))throw'The time to live value "'+r+'" is not numeric.';r+=a}s={timeToLive:r,value:i},o=JSON.stringify(s),localStorage[n(t)]=o},get:function(t,n){if(!e.isString(t))throw'The key "'+t+'" is not a String.';if(!i(t)){if(void 0!==n)return n;throw'There is no data set for the key "'+t+'". Please use contains() first to verify you should actually do a get().'}return r(t).value},contains:i,clean:function(){var n,i,a;for(n in localStorage)t.startsWith(n,s)&&(i=r(n=n.substring(s.length+1)),a=(new Date).getTime(),e.isNumber(i.timeToLive&&a>i.timeToLive)&&o(n))},remove:o}}),define("scripteditor.services/session-storage-service",["underscore","general.utils/string-util"],function(e,t){function n(t){if(!e.isString(t))throw'The key "'+t+'" is not a String.';return s+"."+t}function i(t){if(!e.isString(t))throw'The key "'+t+'" is not a String.';return!e.isEmpty(sessionStorage[n(t)])}function r(e){return JSON.parse(sessionStorage[n(e)])}function o(t){if(!e.isString(t))throw'The key "'+t+'" is not a String.';if(!i(t))throw'There is no data set for the key "'+t+'". Please use contains() first to verify you should actually do a get().';delete sessionStorage[n(t)]}var s="sessionstorageservice";return{set:function(t,i,r){var o,s,a=(new Date).getTime();if(!e.isString(t))throw'The key "'+t+'" is not a String.';if(!e.isObject(i))throw'The value "'+i+'" for the key "'+t+'" is not valid object.';if(r){if(!e.isNumber(r))throw'The time to live value "'+r+'" is not numeric.';r+=a}s={timeToLive:r,value:i},o=JSON.stringify(s),sessionStorage[n(t)]=o},get:function(t,n){if(!e.isString(t))throw'The key "'+t+'" is not a String.';if(!i(t)){if(void 0!==n)return n;throw'There is no data set for the key "'+t+'". Please use contains() first to verify you should actually do a get().'}return r(t).value},contains:i,clean:function(){var n,i,a;for(n in sessionStorage)t.startsWith(n,s)&&(i=r(n=n.substring(s.length+1)),a=(new Date).getTime(),e.isNumber(i.timeToLive&&a>i.timeToLive)&&o(n))},remove:o}}),define("client.views/global-search/global-search-history",["underscore","scripteditor.services/local-storage-service","scripteditor.services/session-storage-service"],function(e,t,n){function i(e){return e.app.id+"."+e.userID+".smartSearch.history"}function r(e){return e.isCloud&&"anonymous"==e.userID.substring(0,9)?(e.historyPermission=!0,e.userID="ANON",t):e.isCloud?(e.historyPermission=!0,t):"DESKTOP"==e.userID?(e.historyPermission=!0,n):e.userID&&"anonymous"!=e.userID.substring(0,9)?(e.historyPermission=!0,n):(e.historyPermission=!1,"NONE")}function o(e){return e.map(function(e){return e.startQuote&&e.endQuote?e.string='"'+e.string+'"':e.string})}function s(e,t){var n=u(l(t),c(e)),i=[];return n>=0?(t.splice(n,1),t.unshift(e),i=a(t)):(t.unshift(e),i=a(t)),i}function a(e){return e.length>4&&(e.length=4),e}function l(e){function t(e){return e.toLowerCase()}return e.map(function(e){return e.map(t)})}function c(e){return e.map(function(e){return e.toLowerCase()})}function u(t,n){for(var i=0;i<t.length;i++)if(e.isEqual(t[i],n))return i}function h(e){return e.map(function(e){return e.join(" ")})}return{initHistory:function(e){if(e.storage=r(e),"NONE"!=e.storage){var t=i(e);return e.storage.contains(t)?h(e.storage.get(t)):void 0}},createEntryInHistory:function(e,t){var n=i(e),r=[],a=[];if(e.storage.contains(n)){r=e.storage.get(n);var l=s(a=o(t),r),c=h(l);e.storage.set(n,l),e.searchHistory=c}else{a=o(t),r.unshift(a),e.storage.set(n,r);var u=h(r);e.searchHistory=u}},clearSearchHistory:function(e){var t=i(e);e.storage.contains(t)&&(e.searchHistory=[],e.storage.remove(t))},removeSingleHistory:function(e,t){var n=i(e);if(e.storage.contains(n)){var r=e.storage.get(n);r.splice(t,1),e.storage.set(n,r);var o=h(r);e.searchHistory=o}},getStoragePath:i}}),define("text!client.views/global-search/directives/input/input.ng.html",[],function(){return'<div class="qv-search-input" ng-class="{\'focus\': isInputFocused}">\n\t<div class="search-field-area">\n\t\t<lui-search class="search-field" query="query" auto-focus="autoFocus" autocomplete="\'off\'" is-focused="isInputFocused" tid="globalSearch.searchField" placeholder="{{placeholder}}" />\n\t</div>\n\t<div class="search-underlines">\n\t\t<span ng-repeat="underline in underlines" class="underline" ng-class="underline.isWhitespace ? \'term-space\' : \'term\' + underline.colorIx">{{underline.string}}</span><qv-global-search-input-hint></qv-global-search-input-hint>\n\t</div>\n</div>\n'}),define("text!client.views/global-search/directives/input/input-hint.ng.html",[],function(){return'<span ng-show="displaySuggestions" class="search-suggest" tid="globalSearch.suggestionString">{{hintString}}</span>\n'}),define("client.views/global-search/global-search-data-service",["qvangular"],function(e){function t(e,t,i,a){var l;0!==t.length&&(e[i]||(e[i]={}),(l=e[i]).string=t,l.isWhitespace=a||t.length<s&&!n(t)||'"'===t,l.colorIx=l.isWhitespace?-1:r,r=l.isWhitespace?r:(r+1)%o)}function n(e){return e.match(/[\u3040-\u9FBF]/)||e.match(/[\uFF65-\uFF9F]/)}function i(e,t,i,r){t.length<s&&!n(t)||e.push({string:t,startQuote:i,endQuote:r})}var r=0,o=6,s=1;e.service("qvGlobalSearchDataService",function(){this.transformResult=function(e,t){var n=t;e.matches=e.matches||[],e.searchTermGroups=e.searchTermGroups||[],e.searchVisualsGroups=e.searchVisualsGroups||[];for(var i=0;i<n.qSearchGroupArray.length;++i)if("DatasetType"===n.qSearchGroupArray[i].qGroupType){e.searchTermGroups.push(n.qSearchGroupArray[i]);var r=n.qSearchGroupArray[i];-1===e.matches.indexOf(r.qSearchTermsMatched.length)&&e.matches.push(r.qSearchTermsMatched.length)}else e.searchVisualsGroups.push(n.qSearchGroupArray[i]);e.displayResult.data=e.searchTermGroups.length>0,e.displayResult.visuals=e.searchVisualsGroups.length>0},this.showMore=function(e,t){if(t&&e&&1===e.qSearchGroupArray.length){for(var n,i=e.qSearchGroupArray[0],r=0;r<i.qItems.length;r++)if(i.qItems[r].qIdentifier===t.qIdentifier){n=i.qItems[r].qItemMatches;break}n&&(t.qItemMatches=n)}},this.setHeaders=function(e){var t,n=0;for(t=0;t<e.searchTermGroups.length;t++)e.searchTermGroups[t].qTotalNumberOfItems>n&&(n=e.searchTermGroups[t].qTotalNumberOfItems);for(e.columnCount=n,e.columnWidth=Math.floor(100/n)+"%",e.shadowHeaders=e.shadowHeaders||[],e.shadowHeaders.splice(0,e.shadowHeaders.length-n),t=e.shadowHeaders.length;t<n;t++)e.shadowHeaders[t]={}},this.transformSuggest=function(e,t,n){var i,r,o=0,s=[];for(this.getUnderlinersAndSearchTerms(e.query,s,[]),n=void 0!==n?n:25,n=Math.min(n,t.qSuggestions.length),i=0;i<n;++i)r={value:t.qSuggestions[i].qValue,term:t.qSuggestions[i].qTerm},e.query!==this.getResultingQueryFromSuggestion(s,r)&&(e.suggestions[o]=r,o++);e.suggestions.splice(o,e.suggestions.length-o)},this._whitespaces=[" ","\t","\n","\r","\r\n",""],this.isWhiteSpaceAt=function(e,t){var n,i=this._whitespaces,r=e.charAt(t);for(n=0;n<i.length;++n)if(r===i[n])return!0;return!1},this.getUnderlinersAndSearchTerms=function(e,n,o){function s(){for(;c<u&&p.isWhiteSpaceAt(e,c);)c++;c>l&&t(n,e.substring(l,c),h++,!0),l=c}var a,l=0,c=0,u=e.length,h=0,d=this._whitespaces,p=this;for(o.length=0,r=0,s();l<u;)if('"'!==e.charAt(l)){if(c=function(e,t){var n,i,r;for(i=0;i<d.length;++i)(n=e.indexOf(d[i],t))>=0&&(!r||n<r)&&(r=n);return r||-1}(e,l),a=c>=0?e.substring(l,c):e.substring(l),t(n,a,h++),i(o,a,!1,!1),c<0)break;l=c,s()}else{if(t(n,e.substring(l,l+1),h++),c=function(e,t){var n;do{t=(n=e.indexOf('"',t))+1}while(n>=0&&t<u&&!p.isWhiteSpaceAt(e,t));return n}(e,++l),a=c>=0?e.substring(l,c):e.substring(l),t(n,a,h++),i(o,a,!0,c>0),c<0)break;t(n,e.substring(c,c+1),h++),l=c+=1,s()}n.splice(h,n.length-h)},this.getSuggestTerms=function(e,t){var n,i,r=this;return i=function(e){var t,n,i;if(0===(e=e.trim()).length)return null;for(n=(t=e.length)-1,i=-1;n>-1;){if(r.isWhiteSpaceAt(e,n)){i=n+1;break}n--}return i=Math.max(i,0),e.substring(i,t)}(e),n=t.map(function(e){return e.string}),i&&2===i.length&&'"'===i.charAt(0)&&n.push(i.charAt(1)),n},this.getUnderlineLengthFromTermIx=function(e,t){for(var n,i=0,r=0;i<e.length&&(n=e[i],r<t||n.isWhitespace)&&(i!==e.length-1||1!==n.string.length||this.isWhiteSpaceAt(n.string,0)||'"'===n.string);)n.isWhitespace||r++,i++;return i>0?i:0},this.getResultingQueryFromSuggestion=function(e,t){var n,i,r,o,s=this.getUnderlineLengthFromTermIx(e,t.term);return n=e.slice(0,s).reduce(function(e,t){return e+t.string},""),i='"'===n.charAt(n.length-1),r=!i&&t.value.indexOf(" ")>=0,o=r||i,n+(r?'"':"")+t.value+(o?'"':"")},this.getMinQueryLength=function(){return s},this.getMaxColorsNum=function(){return o}})}),define("client.views/global-search/directives/input/input",["jquery","qvangular","translator","util","text!./input.ng.html","text!./input-hint.ng.html","general.utils/string-normalization","touche","general.utils/support","client.views/global-search/global-search-data-service"],function(e,t,n,i,r,o,s,a,l){function c(e,t){var n;if(e.length!==t.length)return!1;for(n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}var u=null;t.directive("qvGlobalSearchInput",["$timeout","qvGlobalSearchDataService",function(o,s){return{restrict:"E",replace:!0,template:r,require:"^qvGlobalSearch",link:function(r,h,d,p){var f=h.find("input"),m=[],g=t.getService("$document");f.on("keydown",function(){r.ignoreQueryChange=!1}),r.$watch("isSelectActiveInSmallDevice",function(e){r.autoFocus=!i.isIos()&&!i.isAndroid()&&!e}),r.placeholder=n.get("GlobalSearch.SearchData"),r.isObjectsFeature&&!l.treatAsDesktop()&&h.on("qv-outside",function(t){if(r.isInputFocused){if(1===e(t.target).closest(".qv-global-search-suggest").length||1===e(t.target).closest(".qv-search-last-history").length)return;t.preventDefault(),t.stopPropagation(),a.preventGestures(this.gestureHandler),r.$apply(function(){p.hideSuggestions(),p.hideSoftKeyboard()})}}),r.$watch("query",function(e){var t,n,i=[];if(o.cancel(u),p.showHistory(r.isSearchHistoryFeature&&r.isInputFocused&&0===r.query.length),r.ignoreQueryChange||p.resetSuggestions(),!e||0===e.length)return p.emptyResult(),r.underlines.length=0,void(m=[]);s.getUnderlinersAndSearchTerms(e,r.underlines,i),r.ignoreQueryChange?r.ignoreQueryChange=!1:u=o(function(){s.isWhiteSpaceAt(e,e.length-1)||'"'===e.charAt(e.length-1)?p.hideSuggestions():(n=s.getSuggestTerms(e,i),p.suggest(n)),t=i.map(function(e){return e.string}),i.length>0&&!c(t,m)?(p.searchVisuals(t),p.search(t)):e.length<s.getMinQueryLength()&&p.emptyResult(),m=t,u=null},200)}),r.$watch("isInputFocused",function(e){r.isSmallDevice&&(e?g.find("body").animate({scrollTop:h.offset().top},100):r.isObjectsFeature&&a.utils.touch&&p.hideSuggestions()),r.isSearchHistoryFeature&&e&&0===r.query.length&&p.showHistory(!0)}),r.$on("focusInput",function(){f.focus()}),r.$on("blurInput",function(){f.blur()}),r.$on("$destroy",function(){f.off()})}}}]),t.directive("qvGlobalSearchInputHint",["qvGlobalSearchDataService",function(e){return{restrict:"E",replace:!0,template:o,require:"^qvGlobalSearch",link:function(t){function n(){var n,i,r,o,a,l=t.suggestions[-1===t.activeSuggestionIx?0:t.activeSuggestionIx],c=[],u=[];e.getUnderlinersAndSearchTerms(t.query,c,u),n=e.getSuggestTerms(t.query,u),!t.displaySuggestions||t.suggestions.length<=0||0===n.length||(i=e.getUnderlineLengthFromTermIx(c,l.term),o=c.slice(i).reduce(function(e,t){return e+(t.isWhitespace?" ":t.string)},""),r=s.string(o).length,o=s.string(l.value).slice(0,r),a=s.string(l.value).slice(r),t.ignoreQueryChange=!0,t.hintString=a)}t.$watch("activeSuggestionIx",function(){n()}),t.$watchCollection("suggestions",function(){n()}),t.$watch("displaySuggestions",function(){n()})}}}])}),define("text!client.views/global-search/directives/result/result.ng.html",[],function(){return'<div class="qv-global-search-result" ng-class="classes" qv-smartsearch-swipe-results >\n\t<qv-global-search-suggest ng-if="displaySuggestions" class="qv-global-search-suggest" qv-scroll-to-active="{{activeSelectIx === -1 && focusState.activeStateName === focusState.Suggestions}}"></qv-global-search-suggest>\n\n\t<h3 class="title-section title-navigation" ng-if="displayResult.visuals && !isSmallDeviceLandscape" qv-scroll-to-active="{{focusState.activeStateName === focusState.Visuals}}">\n\t\t<span q-translation="GlobalSearch.Navigations"></span>\n\t\t<i qva-activate="resetDockState();" class="lui-icon lui-icon--arrow-down"></i>\n\t</h3>\n\n\t<h3 class="title-section title-landscape" ng-if="displayResult.visuals && isSmallDeviceLandscape">\n\t\t<span class="lui-icon lui-icon--object"></span>\n\t\t<span q-translation="GlobalSearch.RotateForVisuals"></span>\n\t</h3>\n\n\t<qv-smartsearch-visuals-group items="searchVisualsGroups" app="app" search-terms="searchTerms" options="{\'preload\': false}" ng-if="displayResult.visuals" ng-hide="isSmallDeviceLandscape" ng-class="visualClasses"></qv-smartsearch-visuals-group>\n\n\t<h3 ng-if="isObjectsFeature && ( displayResult.data || showNoResultsMessage() )" class="title-section title-selections" >\n\t\t<span q-translation="GlobalSearch.Selections"></span>\n\t\t<i qva-activate="resetDockState();" class="lui-icon lui-icon--arrow-up"></i>\n\t</h3>\n\n\t<div ng-show="displayResult.data" class="qv-global-search-result-groups data-container">\n\t\t\n\t\t<div ng-if="isPartials()" qv-scroll-to-active="{{ focusState.activeStateName === focusState.Partials }}" class="qv-global-search-result-message search-partials-message">\n\t\t\t<qv-global-search-result-msg></qv-global-search-result-msg>\n\t\t\t<div><button class="lui-button" qva-activate="setShowPartialMatches($event)" tid="globalSearch.showPartialMatches" q-translation="{{ !forcePartials?\'GlobalSearch.ShowPartialMatches\' : \'GlobalSearch.HidePartialMatches\' }}" ng-class="{ \'lui-active\': focusState.activeStateName === focusState.Partials }"></button></div>\n\t\t</div>\n\n\t\t<div ng-if="(outsideSelection || currentSelections) && (!isPartials() || forcePartials)" class="qv-global-search-result-title strong" >\n\t\t\t<span ng-if="outsideSelection && !currentSelections" tid="globalSearch.matchesWholeDataset" q-translation="GlobalSearch.MatchesWholeDataset"></span>\n\t\t\t<span ng-if="currentSelections" tid="globalSearch.addToYourSelections" q-translation="GlobalSearch.AddToYourSelections"></span>\n\t\t</div>\n\n\t\t<div ng-repeat="m in matches" class="data-matches-group" ng-if="(!isPartials() || forcePartials)">\n\n\t\t\t<div ng-if="m !== searchTerms.length" class="caption-flex" q-translation="GlobalSearch.MatchedSearchTerms,{{m}}"></div>\n\n\t\t\t<div class="content-flex" ng-init="parentIndex = $index" ng-class="{ \'touch-off\':!isSmallDevice }" ng-repeat="row in getSearchTermGroup(m)" qv-scroll-to-active="{{( row.qId === activeSelectIx) && focusState.activeStateName === focusState.Results }}" tid="globalSearch.resultGroup" >\n\t\t\t\t\n\t\t\t\t<div class="cell" ng-repeat="item in row.qItems" tid="globalSearch.resultField" ng-class="{ \'maxcell\': !$last && !$first, \'maxcellfirst\': ($first && row.qTotalNumberOfItems > 1) }" >\n\n\t\t\t\t\t<div class="group-hits" qva-activate="select( row, $parentIndex )" ng-class="{ \'shown\': (item.qTotalNumberOfMatches-item.qItemMatches.length) > 0  }">\n\t\t\t\t\t\t<span class="field-name" tid="globalSearch.resultField.Name">{{item.qIdentifier}}</span>\n\t\t\t\t\t\t<span ng-repeat="hit in item.qItemMatches" tid="globalSearch.resultField.Hit">\n\t\t\t\t\t\t\t<qv-global-search-highlights q-text="hit.qText" q-ranges="hit.qRanges"></qv-global-search-highlights >\n\t\t\t\t\t\t\t<span>{{$last ? \'\' : \', \'}}</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<div tid="globalSearch.resultField.MoreHits" ng-if="item.qTotalNumberOfMatches-item.qItemMatches.length > 0" qva-activate="onShowMoreHits($event, item, row.qId)" class="more-hits"><span class="more-text" q-translation="GlobalSearch.MoreResults,{{(item.qTotalNumberOfMatches-item.qItemMatches.length)}}"></span></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="more-hits-area-mobile" ng-if="item.qTotalNumberOfMatches-item.qItemMatches.length > 0" tid="globalSearch.resultField.MoreHitsMobile" qva-activate="onShowMoreHits($event, item, row.qId)">\n\t\t\t\t\t\t<button class="lui-button lui-button--rounded">\n\t\t\t\t\t\t\t<span class="lui-button__icon lui-icon lui-icon--more"></span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div qv-scroll-to-active="{{showMeMoreFocus}}" class="show-me-more"><button ng-if="paging.totalRows > paging.lastRowIx && (!isPartials() || forcePartials)" tid="globalSearch.showmemore" qva-activate="loadNextPage($event)" class="lui-button" q-translation="GlobalSearch.ShowMeMore" ng-class="{\'lui-active\': showMeMoreFocus }"></button></div>\n\n\t</div>\n\n\t<div class="fixed-bar" ng-show="fixedbar">\n\t\t<span qva-activate="resetDockState();" class="lui-fade-button">\n\t\t\t<span class="lui-fade-button__icon lui-icon lui-icon--arrow-down"></span>\n\t\t</span>\n\t</div>\n\n\t<qv-global-search-no-results class="search-no-results-message" ng-show="showNoResultsMessage()" ></qv-global-search-no-results>\n\n\t<qv-global-search-throbber></qv-global-search-throbber>\n</div>\n'}),define("text!client.views/global-search/directives/result/result-message.ng.html",[],function(){return'<div class="qv-global-search-result-message-inline">\n    <span ng-if="currentSelections" q-translation="GlobalSearch.NoMatchesWithinCurrentSelection"></span>\n    <span ng-if="!currentSelections" q-translation="GlobalSearch.NoMatchesForYourTerms"></span>\n</div>'}),define("text!client.views/global-search/directives/result/no-results.ng.html",[],function(){return'<div>\n    <div class="qv-global-search-result-groups" ng-if="!error.show">\n\n        <div class="qv-global-search-result-message" >            \n            <qv-global-search-result-msg></qv-global-search-result-msg>\n\n            <div ng-if="haveUnlockedSelections()">\n                <button class="lui-button qv-gs-new-search-button" qva-activate="searchOutsideSelections($event)" tid="globalSearch.newSearchJustFor"\n\t\t\t\t\t\tq-translation="GlobalSearch.ClearSelectionAndSearchAgain" q-title-translation="GlobalSearch.ClearSelectionAndSearchAgain"\n\t\t\t\t\t\tng-class="{ \'lui-active\': focusState.activeStateName === focusState.StartNewSearch }"></button>\n            </div>\n        </div>\n    </div>      \n\n    <div class="qv-global-search-result-error" ng-if="error.show">\n        <span q-translation="{{error.translation}}"></span>\n    </div>\n</div>'}),define("text!client.views/global-search/directives/result/highlights.ng.html",[],function(){return"<span ng-repeat=\"slice in slices track by $index\" ng-class=\"slice.highlight ? 'highlighted' + slice.qTerm : ''\">{{slice.qSliceText}}</span>"}),define("client.views/global-search/directives/result/highlights",["qvangular","text!./highlights.ng.html","client.views/global-search/global-search-data-service"],function(e,t){e.directive("qvGlobalSearchHighlights",function(){return{restrict:"E",template:t,replace:!0,scope:{qText:"=",qRanges:"="},link:function(t){function n(e,t){for(var n=null,i=0;i<e.length;i++)if(e[i].iStart===t.iStart){n=e.splice(i,1,t);break}n||e.push(t)}var i=e.getService("qvGlobalSearchDataService").getMaxColorsNum();t.slices=null,t.$watch("qRanges",function(e){if(e){for(var r=0,o=[],s=e.sort(function(e,t){return e.qCharPos-t.qCharPos}),a=0;a<s.length;a++){var l=s[a];l.qCharPos>r&&o.push({qTerm:-1,qSliceText:t.qText.slice(r,l.qCharPos),highlight:!1,iStart:r,iEnd:l.qCharPos}),r=l.qCharPos+l.qCharCount,n(o,{qTerm:l.qTerm%i,highlight:!0,qSliceText:t.qText.slice(l.qCharPos,r),iStart:l.qCharPos,iEnd:r}),a===e.length-1&&r<t.qText.length&&o.push({qTerm:-1,qSliceText:t.qText.slice(r,t.qText.length),highlight:!1,iStart:r,iEnd:t.qText.length})}t.slices=o}})}}})}),define("text!client.views/global-search/directives/result/objects/visuals-group.ng.html",[],function(){return'<div class="qv-smartsearch-visuals-group" qva-smart-search-swipe-horizontal="onSwipePage(delta)" >\n\t<div class="nav-visual-arrow left" qva-activate="goToPage( pageIndex - 1 );" ng-show="pageIndex > 0">\n\t\t<span class="lui-fade-button">\n\t\t\t<span class="lui-fade-button__icon  lui-icon lui-icon--arrow-left"></span>\n\t\t</span>\n\t</div>\n\t<div class="visuals-wrapper" >\n\t\t<div class="page" ng-repeat="p in pages" ng-class="{ \'first\': $first, \'last\': $last }">\n\t\t\t<div class="content" >\n\t\t\t\t<qv-smartsearch-visual-preview\n\t\t\t\t\tng-repeat="visualItem in p"\n\t\t\t\t\tapp="app"\n\t\t\t\t\tactive-visual-ix="activeVisualIx"\n\t\t\t\t\tvisual-object="visualItem"\n\t\t\t\t\tsearch-terms="searchTerms"\n\t\t\t\t\tng-class="{ \'first\': $first && !$last, \'last\': $last, \'active\': focusState.activeStateName === focusState.Suggestions && activeVisualIx === visualItem.itemIndex }">\n\t\t\t\t</qv-smartsearch-visual-preview>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class="nav-visual-arrow right" qva-activate="goToPage( pageIndex + 1 );" ng-show="pageIndex < (pages.length - 1)">\n\t\t<span class="lui-fade-button">\n\t\t\t<span class="lui-fade-button__icon  lui-icon lui-icon--arrow-right"></span>\n\t\t</span>\n\t</div>\n\n\t<qv-global-search-more-indicator pages="pages" active-page-ix="pageIndex" on-page-change="goToPage(index);"></qv-global-search-more-indicator>\n</div>'}),define("text!client.views/global-search/directives/result/objects/visual-item.ng.html",[],function(){return'<div class="visual-item" >\n\t<div class="object" qva-activate="navigateToSheet($event)" >\n\t\t<qv-object ng-if="viz && visualObject.load" model="viz.model" options="viz.options"></qv-object>\n\t\t<div class="transparent-overlay"></div>\n\t\t<div ng-hide="visualObject.load" class="qv-animate progress">\n\t\t\t<div class="progress-loader"></div>\n\t\t</div>\n\t</div>\n\t<div class="visual-data" qva-activate="showExtraInfo($event);">\n\t\t<div ng-if="visualObject.load" class="keywords">\n\t\t\t<div class="terms">\n\t\t\t\t<span ng-repeat="t in termsMatched"><span ng-if="!$first">&nbsp;</span><span class="highlighted{{t.pos}}">{{t.string}}</span></span>\n\t\t\t</div>\n\t\t\t<div class="lui-fade-button" ng-if="matches.length">\n\t\t\t\t<span class="lui-fade-button__icon lui-icon lui-icon--info"></span>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="extra-info" ng-if="visualObject.load" ng-class="{ \'show\': extra }">\n\t\t\t<div ng-if="matches.length" ng-repeat="hits in matches" class="hits">\n\t\t\t\t<div ng-repeat="hit in hits" class="match-hit">\n\t\t\t\t\t<span ng-if="$first"><b q-translation="{{hit.trans}}"></b>: </span><qv-global-search-highlights q-text="hit.qText" q-ranges="hit.qRanges" class="highlights"></qv-global-search-highlights><span ng-if="!$last">,&nbsp;</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="more-hits" qva-activate="showMoreHits($event)" ng-if="$last && (visualObject.qTotalNumberOfMatches-hitsDisplayed) > 0" q-translation="GlobalSearch.MoreResults,{{(visualObject.qTotalNumberOfMatches-hitsDisplayed)}}"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>'}),define("client.views/global-search/directives/result/objects/visual-item",["qvangular","underscore","text!./visual-item.ng.html","core.utils/deferred","client.utils/rtl/direction-service","client.views/global-search/directives/result/highlights","client.views/global-search/global-search-data-service"],function(e,t,n,i,r){e.directive("qvSmartsearchVisualPreview",[function(){function o(e,t){return t.getObject(e.qIdentifier).then(function(e){return{model:e,options:{isReadonly:!0,isPopover:!1,selectionsDisabled:!0,components:{miniChart:{show:!1},scrollArea:{showFlag:0}},direction:r.direction}}})}function s(e){var t=e.split("/");return(t=t.map(function(e){return parseInt(e)}).filter(function(e){return!isNaN(e)})).length?t[0]:-1}function a(e,t){e.id=-1,-1!==t.indexOf("qDimensions")||-1!==t.indexOf("qListObjectDef/qDef")?(e.id=s(t),e.type=-1===t.indexOf("qLayoutExclude")?c.DIMENSION:c.ALTERNATIVE_DIMENSION,e.isLabel=-1!==t.indexOf("qFieldLabels")):-1!==t.indexOf("qMeasures")?(e.id=s(t),e.type=-1===t.indexOf("qLayoutExclude")?c.MEASURE:c.ALTERNATIVE_MEASURE,e.isLabel=-1!==t.indexOf("qLabel")):(-1!==t.indexOf("subtitle")?e.type=c.SUBTITLE:-1!==t.indexOf("title")?e.type=c.TITLE:-1!==t.indexOf("footnote")?e.type=c.FOOTNOTE:-1!==t.indexOf("type")?e.type=c.TYPE:e.type=c.VALUE,e.isLabel=-1===t.indexOf("qExpr")),e.trans=l(e.type)}function l(e){var t="---";switch(e){case c.TITLE:t="Common.Title";break;case c.DIMENSION:t="Common.Dimensions";break;case c.MEASURE:t="Common.Measures";break;case c.ALTERNATIVE_DIMENSION:t="properties.alternative.dimensions";break;case c.ALTERNATIVE_MEASURE:t="properties.alternative.measures";break;case c.SUBTITLE:t="properties.subtitle";break;case c.FOOTNOTE:t="properties.footnote";break;case c.TYPE:t="properties.type";break;case c.VALUE:t="properties.dataPoints.labelmode.value"}return t}var c={TITLE:0,SUBTITLE:1,FOOTNOTE:2,DIMENSION:3,MEASURE:4,ALTERNATIVE_DIMENSION:5,ALTERNATIVE_MEASURE:6,TYPE:7,VALUE:8};return{restrict:"E",template:n,replace:!0,require:["^qvGlobalSearch"],scope:{visualObject:"=",searchTerms:"=",activeVisualIx:"=",app:"="},link:function(n,r,s,l){function c(){p().then(function(e){(e=e.filter(function(e){return e})).length&&(m.navigateToSheet(e[0].sheet),v.onNavigateToSheet(e[0].cell.name))})}function u(){n.termsMatched=n.visualObject.qSearchTermsMatched.map(function(e){return{string:n.searchTerms[e],pos:e%g}})}function h(e){n.hitsDisplayed=e.length;var i,r,o;e.forEach(function(e){e.qAttributes&&e.qAttributes.length&&a(e,e.qAttributes[0][1])}),i=n.visualObject.qItemMatches.filter(function(t){if(t.isLabel)return!0;var n=e.filter(function(e){return e.isLabel&&t.type===e.type&&t.id===e.id&&t!==e});return!t.qRanges.every(function(e){return n.some(function(t){return t.qRanges.some(function(t){return e.qTerm===t.qTerm})})})}),r=t.groupBy(i,function(e){return e.type}),o=Object.keys(r).map(function(e){return r[e]}),n.matches?o.forEach(function(e,t){if(e.length>n.matches[t].length)for(var i=n.matches[t].length;i<e.length;i++)n.matches[t].push(e[i])}):n.matches=o}function d(e,t,r){var o={sheet:e,cell:t};return t.name===n.visualObject.qIdentifier?i.resolve(o):"filterpane"===t.type?r.getObject(t.name).then(function(e){return e.getLayout().then(function(e){return e.qChildList&&e.qChildList.qItems.length&&e.qChildList.qItems.filter(function(e){return e.qInfo.qId===n.visualObject.qIdentifier}).length?o:null})}):i.resolve(null)}function p(){for(var e,t=[],r=0;r<m.all.mashed.length;r++){e=m.all.mashed[r];for(var o=0;o<e.qData.cells.length;o++)t.push(d(e,e.qData.cells[o],n.app))}return i.all(t)}var f,m=e.getService("$navigationService").Sheets,g=e.getService("qvGlobalSearchDataService").getMaxColorsNum(),v=l[0];n.viz=null,n.termsMatched=null,n.extra=!1,n.matches=null,n.$watch("visualObject.load",function(e){!0===e?(u(),f?n.viz=f:(o(n.visualObject,n.app).then(function(e){f=e,n.viz=e}),h(n.visualObject.qItemMatches))):n.viz=null}),n.$watch("searchTerms",function(e){e&&n.visualObject&&u()}),n.$on("selectActiveVisualItem",function(){n.activeVisualIx===n.visualObject.itemIndex&&c()}),n.$on("$destroy",function(){f=null}),n.showMoreHits=function(e){e.stopPropagation(),v.showMoreHitsForVisual(n.visualObject).then(function(e){h(e.qItemMatches)})},n.showExtraInfo=function(e){n.extra=!n.extra&&n.matches.length,e.stopPropagation()},n.navigateToSheet=function(e){e.stopPropagation(),c()}}}}])}),define("text!client.views/global-search/directives/more-indicator/more-indicator.ng.html",[],function(){return'<div class="qv-gs-more-indicator" ng-class="{ \'touch-on\': touchOn }">\n\t<div class="hit-area" qva-activate="onPageClick($index);" ng-repeat="p in pages">\n\t\t<span class="dot" ng-class="{ \'active\': $index === activePageIx, \'pressed\': $index === pressedPageIx }"></span>\n\t</div>\n</div>'}),define("client.views/global-search/directives/more-indicator/more-indicator",["qvangular","general.utils/support","text!./more-indicator.ng.html"],function(e,t,n){"use strict";e.directive("qvGlobalSearchMoreIndicator",function(){return{replace:!0,template:n,restrict:"E",scope:{pages:"=",activePageIx:"=",onPageChange:"&"},link:function(e){e.touchOn=!t.treatAsDesktop(),e.pressedPageIx=void 0,e.onPageClick=function(t){e.pressedPageIx=t,e.onPageChange({index:t})},e.$watch("activePageIx",function(){e.pressedPageIx=void 0})}}})}),define("client.views/global-search/directives/swipe-horizontal",["qvangular","general.utils/support","touche"],function(e,t,n){"use strict";e.directive("qvaSmartSearchSwipeHorizontal",["$parse",function(e){var i={up:!1,down:!1,right:!0,left:!0};return{restrict:"A",link:function(r,o,s){var a=e(s.qvaSmartSearchSwipeHorizontal);t.treatAsDesktop()||n(o[0]).swipe({options:{radiusThreshold:50,preventDefault:!0,useMomentum:!0},start:function(e,t){if(i[t.swipe.direction]){var o=t.swipe.curDeltaX>0?-1:0===t.swipe.curDeltaX?0:1;a(r,{delta:o}),n.preventGestures(this.gestureHandler)}}}),r.$on("$destroy",function(){n(o[0]).off()})}}}])}),define("client.views/global-search/directives/result/objects/visuals-group",["qvangular","text!./visuals-group.ng.html","general.utils/responsive-state","core.utils/resize","client.views/global-search/directives/result/objects/visual-item","client.views/global-search/directives/more-indicator/more-indicator","client.views/global-search/directives/swipe-horizontal"],function(e,t,n,i){var r={MAX_MOBILE_VISUALS:10,PAGE_VISUALS:3,PAGE_VISUALS_PORTRAIT:2,PADDING_PAGES:15};e.directive("qvSmartsearchVisualsGroup",["$timeout",function(e){return{restrict:"E",template:t,replace:!0,scope:{items:"=",searchTerms:"=",options:"=",app:"="},controller:function(){this.loadPage=function(){},this.preparePages=function(){}},link:function(t,o,s,a){function l(){t.pages=[],u.scrollLeft(0),t.pageIndex=0}var c=0;t.pageIndex=0,t.activeVisualIx=-1,t.pages=[],t.objects=null;var u=o.find(".visuals-wrapper"),h=!1,d=n.isSmallDevice?400:600,p=function(){d=n.isSmallDevice?400:600,u[0].scrollLeft=t.pageIndex*(u[0].offsetWidth+r.PADDING_PAGES)},f=function(){a.preparePages(t.items[0].qItems)};n.OrientationChanged.bind(f),n.ViewChanged.bind(f),t.setPageIndex=function(e){t.pageIndex=e;for(var n=0;n<t.pages.length;n++)t.pages[n].forEach(function(i){t.options.preload?i.load=n===e||n===e+1||n===e-1:i.load=n===e})},i.on("update",p),t.goToPage=function(e){a.loadPage(e)},t.onSwipePage=function(e){a.loadPage(t.pageIndex+e)},t.$watch("items",function(e){e&&e.length&&a.preparePages(e[0].qItems)}),t.$on("visualsGroupMoveActiveVisual",function(e,n){if(!h){var i,r,o=t.pages.reduce(function(e,t){return e+t.length},0);i=t.activeVisualIx>0||n>0?(t.activeVisualIx+n)%o:o-1,(r=Math.floor(i/c))!==t.pageIndex&&a.loadPage(r),t.activeVisualIx=i}}),t.$on("visualsGroupBlur",function(){t.activeVisualIx=-1}),t.$on("visualsGroupFocus",function(){t.activeVisualIx=0,0!==t.pageIndex&&a.loadPage(0)}),t.$on("$destroy",function(){i.off("update",p),n.OrientationChanged.unbind(f),n.ViewChanged.unbind(f)}),a.loadPage=function(n){!h&&n>=0&&n<t.pages.length&&(h=!0,u.animate({scrollLeft:n*(u[0].offsetWidth+r.PADDING_PAGES)},d,"swing",function(){h=!1,e(function(){t.setPageIndex(n)})}))},a.preparePages=function(e){if(e){l();var i,o=0,s=[];n.orientation===n.Orientation.landscape?i=n.isSmallDevice?1:r.PAGE_VISUALS:n.orientation===n.Orientation.portrait&&(i=n.isSmallDevice?1:r.PAGE_VISUALS_PORTRAIT),c=i;for(var a=0;a<e.length&&!(n.isSmallDevice&&s.length>=r.MAX_MOBILE_VISUALS&&s[o].length>=i);a++)s[o]?s[o].length>=i&&(o++,s.push([])):s.push([]),e[a].itemIndex=a,e[a].load=t.options.preload?0===o||1===o:0===o,s[o].push(e[a]);t.pages=s}}}}}])}),define("client.views/global-search/directives/result/result",["qvangular","text!./result.ng.html","text!./result-message.ng.html","text!./no-results.ng.html","touche","general.utils/support","client.views/global-search/directives/result/highlights","client.views/global-search/directives/result/objects/visuals-group"],function(e,t,n,i,r,o){var s={INITIAL:0,VISUALS_DOCKED:1,DATA_DOCKED:2};e.directive("qvGlobalSearchResult",["$timeout",function(e){return{restrict:"E",template:t,replace:!0,require:["^qvGlobalSearch","qvGlobalSearchResult"],controller:function(){this.getElement=function(){},this.setDockState=function(){}},link:function(t,n,i,a){var l,c,u=a[0],h=a[1],d=function(){var i=this,r=0;o.treatAsDesktop()&&!c&&(c=n.find(".qv-smartsearch-visuals-group")),e(function(){c&&c.length&&(r=c[0].offsetTop+c[0].offsetHeight-33,t.fixedbar=i.scrollTop>r),t.scrollShow=i.scrollHeight-i.scrollTop>i.clientHeight})},p=!o.treatAsDesktop()&&t.isObjectsFeature?n.find(".data-container"):n;t.dockState=s.INITIAL,t.emptyMessageEnabled=!1,t.fixedbar=!1,t.classes={"qv-global-search-result-throbber-open":t.activity.show,"with-objects":t.isObjectsFeature&&!t.isSmallDeviceLandscape},t.$watch("isObjectsFeature && !isSmallDeviceLandscape",function(e){t.classes["with-objects"]=e}),t.$watch("activity.show",function(e){t.classes["qv-global-search-result-throbber-open"]=e}),t.$watch(function(){return t.showNoResultsMessage()},function(e){t.classes.noresults=e}),t.select=function(n,i){r.utils.touch?(t.activeResultIx=i,e(function(){u.select(t.searchTerms,n.qId)},100)):u.select(t.searchTerms,n.qId)},t.loadNextPage=function(){u.loadNextPage()},h.getElement=function(){return n},h.setDockState=function(n){e(function(){t.dockState=n,t.classes["visuals-docked"]=n===s.VISUALS_DOCKED,t.classes["data-docked"]=n===s.DATA_DOCKED})},t.setShowPartialMatches=function(){u.setShowPartialMatches()},t.showNoResultsMessage=function(){return t.emptyMessageEnabled&&t.searchTerms.length>0&&!t.displayResult.data&&!t.error.show&&!t.activity.show||t.error.show},u.showNoResultsMessage=function(){return t.showNoResultsMessage()},t.resetDockState=function(){t.dockState=s.INITIAL,o.treatAsDesktop()&&p.animate({scrollTop:0},300,"swing")},l=t.$watch(function(){return p[0].scrollHeight},function(e){t.scrollShow=e>p[0].clientHeight}),p.on("scroll",d),t.$on("resultScrollToTop",function(){n[0].scrollTop=0}),t.$on("$destroy",function(){l(),p.off("scroll",d)})}}}]),e.directive("qvScrollToActive",function(){return{restrict:"A",require:"^qvGlobalSearchResult",link:function(e,t,n,i){n.$observe("qvScrollToActive",function(e){if(e=e+""=="true",t.toggleClass("active",e),e){var n=i.getElement(),r=t.position();r.top<0?n[0].scrollTop=t[0].offsetTop:r.top+t.height()>n.height()&&t[0].scrollIntoView(!1)}})}}}),e.directive("qvGlobalSearchResultMsg",function(){return{restrict:"E",template:n,replace:!0,require:["^qvGlobalSearch","^qvGlobalSearchResult"],link:function(e){e.capUnderlineMaxNumber=6}}}),e.directive("qvGlobalSearchNoResults",function(){return{restrict:"E",template:i,replace:!0,require:["^qvGlobalSearch","^qvGlobalSearchResult"],link:function(){}}}),e.directive("qvSmartsearchSwipeResults",["$timeout",function(e){return{restrict:"A",require:["^qvGlobalSearchResult"],link:function(t,n,i,a){function l(){r(n[0]).off(),v&&v.off("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",m),g[0].removeEventListener("touchstart",p,!1),document.removeEventListener("touchmove",f,!1)}function c(e,n){if(v&&0!==v.length)if(y!==s.INITIAL||t.isSmallDevice||"up"!==n.swipe.direction){if(D[n.swipe.direction]&&!x){if(y===s.VISUALS_DOCKED&&g[0].scrollTop>1)return;var i=C+n.swipe.curDeltaY;if(i<0)return void g.removeAttr("style");e.preventDefault(),q=!0,C=i<w?i:w,g.css("overflow","hidden"),v.css("height",C+"px")}}else r.preventGestures(this.gestureHandler);else r.preventGestures(this.gestureHandler)}function u(e,t){!x&&D[t.swipe.direction]?(C=v?v[0].clientHeight:0,w=n.height()-75,c(e,t)):r.preventGestures(this.gestureHandler)}function h(n){y=n,b.setDockState(y),x||y!==s.INITIAL&&y!==s.DATA_DOCKED?x&&v.addClass("transitionAnim"):t.$broadcast("resizeCell"),g.scrollTop(0),e(function(){v.removeAttr("style"),g.removeAttr("style")},50)}function d(){!x&&q&&(C>0&&C<w?(x=!0,h(C<S-_?s.VISUALS_DOCKED:C>S-_&&C<S+_?s.INITIAL:s.DATA_DOCKED)):0===C?h(s.VISUALS_DOCKED):C===w&&h(s.DATA_DOCKED),q=!1)}if(t.isObjectsFeature){var p,f,m,g=n.find(".data-container"),v=null,y=s.INITIAL,b=a[0],x=!1,q=!1,C=null,S=0,w=0,_=t.isSmallDevice?80:200,D={up:!0,down:!0,left:!1,right:!1};p=function(){0===this.scrollTop?this.scrollTop+=1:this.scrollTop+this.offsetHeight>=this.scrollHeight&&(this.scrollTop-=1)},f=function(e){g[0].scrollHeight>g[0].offsetHeight?y!==s.INITIAL&&y!==s.DATA_DOCKED||e.preventDefault():e.preventDefault()},m=function(){this.classList.remove("transitionAnim"),(x&&y===s.INITIAL||y===s.DATA_DOCKED)&&t.$broadcast("resizeCell"),x=!1},t.$watchGroup(["displayResult.visuals","isSmallDeviceLandscape"],function(e){e[0]&&!e[1]?((v=n.find(".qv-smartsearch-visuals-group")).on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",m),S=S||v.height(),o.treatAsDesktop()||(r(n[0]).swipe({options:{radiusThreshold:20,preventDefault:!1,useMomentum:!1},start:u,update:c,end:d}),document.addEventListener("touchmove",f,!1),g[0].addEventListener("touchstart",p,!1))):l()}),t.$watch("dockState",function(e){e===s.INITIAL&&y!==s.INITIAL&&(x=!0,h(s.INITIAL))}),t.$on("$destroy",function(){l()})}}}}])}),define("text!client.views/global-search/directives/suggest/suggest.ng.html",[],function(){return'<div class="qv-search-suggest-wrapper" tid="globalSearch.suggestions">\n\t<span class="hidden">{{query}}</span>\n    <div ng-show="isSmallDevice" ng-if="!isObjectsFeature" class="dym" q-translation="GlobalSearch.DidYouMean"></div>\n\t<ul class="suggest-popup">\n\t\t<li ng-repeat="suggest in suggestions track by $index" qv-scroll-to-active-suggestion="{{$index === activeSuggestionIx && focusState.activeStateName === focusState.Suggestions}}" ng-class="{active: $index === activeSuggestionIx && focusState.activeStateName === focusState.Suggestions }" qva-activate="onSuggestSelect($index)" tid="globalSearch.suggestion" bold-suggest=\'{{suggest.value}}\'>\n\t\t\t{{suggest.value}}\n\t\t</li>\n\t</ul>\n</div>\n'}),define("client.views/global-search/directives/suggest/suggest",["qvangular","text!./suggest.ng.html"],function(e,t){e.directive("qvGlobalSearchSuggest",[function(){return{restrict:"E",template:t,replace:!0,require:["^qvGlobalSearch"],link:function(){}}}]),e.directive("qvScrollToActiveSuggestion",function(){return{restrict:"A",link:function(e,t,n){n.$observe("qvScrollToActiveSuggestion",function(e){if(e=e+""=="true"){var n=t.position(),i=t.parent(),r=t[0].clientWidth>i[0].clientWidth,o=n.left+t[0].clientWidth-i[0].clientWidth;t[0].scrollIntoView(r),n.left<=i[0].offsetLeft?i.scrollLeft(t[0].offsetLeft-i[0].offsetLeft):o>0&&!r&&(i[0].scrollLeft=i[0].scrollLeft+o)}})}}})}),define("text!client.views/global-search/directives/history/history.ng.html",[],function(){return'<div class="qv-search-last-history" tid="globalSearch.searchHistory">\n\t<div class="history-header" ng-show="searchHistory.length">\n\t\t<div class="title"  q-translation="GlobalSearch.RecentSearches"></div>\n\t\t<div class="clear-all-button" q-translation="GlobalSearch.ClearAll" qva-activate="clearSearchHistory($index)"></div>\n\t</div>\n\t<ul class="history-popup" ng-show="searchHistory.length">\n\t\t<li ng-repeat="items in searchHistory track by $index" qva-delegated-activate=".history-query#onSearchHistorySelect($index); .lui-icon--close#removeSelectedHistory($index);" tid="globalSearch.searchHistoryItem" ng-class="{active: $index === activeHistoryIx && focusState.activeStateName === focusState.History}" qv-scroll-to-active-history="{{$index === activeHistoryIx && focusState.activeStateName === focusState.History}}">\n\t\t\t<div class="history-query">{{searchHistory[$index]}}</div>\n\t\t\t<div class="lui-icon lui-icon--close" q-title-translation="Common.Delete" title="Delete"></div>\n\t\t</li>\n\t</ul>\n</div>'}),define("client.views/global-search/directives/history/history",["qvangular","text!./history.ng.html","client.views/global-search/global-search-data-service"],function(e,t){e.directive("qvGlobalSearchHistory",["$timeout",function(n){return{restrict:"E",template:t,replace:!0,require:["^qvGlobalSearch"],link:function(t,i,r,o){var s=o[0],a=i.find(".history-popup")[0];t.colorsLimit=e.getService("qvGlobalSearchDataService").getMaxColorsNum(),t.$watch("searchInputFocused",function(e){e&&n(function(){a.scrollTop=0})}),t.onSearchHistorySelect=function(e){s.setQueryFromHistory(e)},t.clearSearchHistory=function(){s.clearHistory()},t.removeSelectedHistory=function(e){s.removeHistory(e)}}}}]),e.directive("qvScrollToActiveHistory",function(){return{restrict:"A",link:function(e,t,n){n.$observe("qvScrollToActiveHistory",function(e){e=e+""=="true",t.toggleClass("active",e),e&&t[0].scrollIntoView(!1)})}}})}),define("text!client.views/global-search/directives/throbber/throbber.ng.html",[],function(){return'<div ng-show="activity.show" class="qv-qs-throbber-container qv-animate ng-hide">\n\n\t<div class="qv-gs-throbber-dimmer"></div>\n\n\t<div ng-show="throbber.show" class="qv-gs-throbber ng-hide"></div>\n\n\t<div ng-show="indexProgress.show" class="qv-gs-index qv-gs-index-progress qv-animate ng-hide">\n\n\t\t<div class="qv-gs-index-group" qva-smart-search-swipe-horizontal="onSwipePage(delta)">\n\t\t\t<div class="qv-gs-index-section">\n\t\t\t\t<div class="qv-gs-index-content qv-gs-index-content-shrink">\n\t\t\t\t\t<span class="qv-gs-index-header" q-translation="GlobalSearch.PreparingSmartSearch"></span>\n\n\t\t\t\t\t<qv-progress-bar percent-done="percentDone" on-completed="showIndexDone()"></qv-progress-bar>\n\n\t\t\t\t\t<span class="qv-gs-index-text" q-translation="GlobalSearch.NextTimeFaster"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class="qv-gs-index-section">\n\t\t\t\t<div class="qv-gs-index-content qv-gs-index-content-shrink">\n\t\t\t\t\t<div class="qv-gs-index-help" qva-activate="openHelp()">\n\t\t\t\t\t\t<span class="qv-gs-index-header" q-translation="GlobalSearch.LearnHowToUse"></span>\n\t\t\t\t\t\t<img ng-src="{{imgSrc}}" class="qv-gs-index-image" />\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<qv-global-search-more-indicator pages="pages" active-page-ix="activePageIx" on-page-change="goToPage(index);"></qv-global-search-more-indicator>\n\n\t</div>\n\n\t<div ng-show="indexDone.show" class="qv-gs-index qv-gs-index-done qv-animate ng-hide">\n\t\t<div class="qv-gs-index-section qv-gs-index-section-single">\n\t\t\t<div class="qv-gs-index-content qv-gs-index-shrink">\n\t\t\t\t<span class="qv-gs-index-icon lui-icon lui-icon--tick" aria-hidden="true"></span>\n\t\t\t\t<span class="qv-gs-index-text-big" q-translation="GlobalSearch.Done"></span>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\n</div>'}),define("text!client.views/progress-bar/progress-bar.ng.html",[],function(){return'<div class="qv-progress-bar">\n\t<div class="progress-bar-bg">\n\t\t<div class="progress-bar-fg" ng-style="{ width: display }"></div>\n\t</div>\n\n\t<div class="progress-text" ng-bind="display" ng-hide="options.hideText"></div>\n</div>'}),define("client.views/progress-bar/progress-bar",["qvangular","text!./progress-bar.ng.html"],function(e,t){"use strict";e.directive("qvProgressBar",["$interval",function(e){return{replace:!0,template:t,restrict:"E",scope:{percentDone:"=",onCompleted:"&",options:"="},link:function(t){function n(){if(t.showPercent>=100)return e.cancel(r),void t.onCompleted();t.showPercent>=t.percentDone?e.cancel(r):i(t.showPercent+1)}function i(e){t.showPercent=e,t.display=e+"%"}var r,o=!0;t.display="0%",t.showPercent=0,t.$watch("percentDone",function(t){void 0!==t&&(o?(i(t),o=!1):(e.cancel(r),r=e(n,10)))}),t.$on("$destroy",function(){e.cancel(r)})}}}])}),define("client.views/global-search/directives/throbber/throbber",["qvangular","text!./throbber.ng.html","core.utils/help-url","core.utils/deferred","general.utils/responsive-state","core.utils/resize","client.views/progress-bar/progress-bar","client.views/global-search/global-search-service","client.views/global-search/directives/swipe-horizontal"],function(e,t,n,i,r,o){"use strict";var s={};Object.defineProperties(s,{THROBBER:{value:1e3},INDEX_PROGRESS:{value:5e3},NEXT_INDEX_PROGRESS:{value:500},HIDE_INDEX_DONE:{value:1e3}}),e.directive("qvGlobalSearchThrobber",["$timeout","$window","$animate",function(a,l,c){return{replace:!0,template:t,restrict:"E",link:function(t,u){function h(e){var t=i(),n=u.find(e)[0];return c.on("removeClass",n,function(e,i){"close"===i&&(c.off(n),t.resolve())}),t.promise}function d(){t.throbber.show=!1,t.indexProgress.enabled=!1,t.indexProgress.show=!1,t.indexProgress.visible=!1,t.indexDone.show=!1,t.indexDone.visible=!1}function p(){return void 0!==t.percentDone&&t.percentDone<100||E.couldEngineBeIndexing(t.app)}function f(e){A||(E.IndexProgressUpdate.bind(C),A=!0),a.cancel(D),D=a(function(){E.requestIndexProgressUpdate(t.app)},e||0)}function m(){t.indexDone.visible=!1,t.indexDone.show=!1,a.cancel(S),t.$emit("updateForceShowDimmer",!1),t.asyncHideActivity?x():S=a(b,s.THROBBER)}function g(e){h(".qv-gs-index-progress").then(function(){t.indexProgress.visible=!0,t.isSmallDevice||t.$emit("updateForceShowDimmer",!0)}),t.percentDone=e,t.indexProgress.show=!0,t.activity.show=!0,t.throbber.show=!1,e<100?f(s.NEXT_INDEX_PROGRESS):y()}function v(e){t.percentDone=e,e<100?f(s.NEXT_INDEX_PROGRESS):y()}function y(){a.cancel(D),A&&(E.IndexProgressUpdate.unbind(C),A=!1)}function b(){t.activity.show=!0,t.throbber.show=!0,t.emptyMessageEnabled=!1}function x(){a.cancel(S),a.cancel(w),a.cancel(_),a.cancel(D),y(),t.activity.show=!1,t.throbber.show=!1,t.indexProgress.enabled=!1,t.indexProgress.show=!1,t.indexProgress.visible=!1,t.emptyMessageEnabled=t.searchTerms.length>0}function q(){t.indexProgress.enabled=!0,f()}function C(e,n){if(e===(t.app.id||"").toUpperCase()){var i=new Number(n);if(isNaN(i)||!n)return t.indexProgress.enabled=!0,void f(s.INDEX_PROGRESS);!t.indexProgress.show&&i<100?g(i):t.indexProgress.show?v(i):(a.cancel(S),S=a(b,s.THROBBER))}}var S,w,_,D,M,A,E=e.getService("qvGlobalSearchService"),I=u.find(".qv-gs-index-progress .qv-gs-index-group");t.asyncHideActivity=!1,t.percentDone=void 0,t.imgSrc=requirejs.toUrl("img/core/static/smart-search.png"),t.pages=[{},{}],t.activePageIx=0,M=function(){a(function(){I[0].scrollLeft=t.activePageIx*I[0].offsetWidth})},r.OrientationChanged.bind(M),o.on("update",M),t.goToPage=function(e){I.animate({scrollLeft:e*I[0].offsetWidth},400,"swing",function(){a(function(){t.activePageIx=e})})},t.onSwipePage=function(e){if(t.isSmallDevice){var n=e>0?1:0;n!==t.activePageIx&&t.goToPage(n)}},t.openHelp=function(){l.open(n.path+"SmartSearch_Intro")},t.$on("$destroy",function(){a.cancel(S),a.cancel(w),a.cancel(_),a.cancel(D),o.off("update",M),r.OrientationChanged.unbind(M),E.IndexProgressUpdate.unbind(C),c.off("removeClass",u[0])}),t.showIndexDone=function(){h(".qv-gs-index-done").then(function(){t.indexProgress.show=!1,t.indexProgress.visible=!1,t.indexDone.visible=!0,t.percentDone=void 0,a.cancel(_),_=a(m,s.HIDE_INDEX_DONE)}),t.indexDone.show=!0},t.$on("toggleActivityIndicator",function(e,n,i){if(n){if(t.asyncHideActivity=!1,t.activity.show)return;d(),a.cancel(S),a.cancel(w),p()?q():(S=a(b,s.THROBBER),w=a(q,s.INDEX_PROGRESS))}else{var r=t.percentDone&&t.percentDone<100;if(r&&i)E.setLastKnownIndexProgress(t.app,100),y(),t.percentDone=100,t.asyncHideActivity=!0;else if(r&&!i){if(!t.isSmallDevice)return;x()}else 100==t.percentDone?(E.setLastKnownIndexProgress(t.app,100),y(),t.asyncHideActivity=!0):x()}})}}}])}),define("client.views/global-search/directives/mobile-index-progress/mobile-index-progress",["qvangular","client.views/progress-bar/progress-bar","client.views/global-search/global-search-service"],function(e){"use strict";e.directive("qvMobileIndexProgress",["$timeout",function(t){return{replace:!0,template:'<div class="qv-mobile-index-progress"><qv-progress-bar ng-if="showMobileIndexProgressBar" percent-done="indexPercentDone" on-completed="hideMobileIndexProgressWhenDone()" options="progressBarOptions"></qv-progress-bar></div>',restrict:"E",link:function(n){function i(e,t){e===(n.app.id||"").toUpperCase()&&(!n.showMobileIndexProgressBar&&t<100?(n.indexPercentDone=t,n.showMobileIndexProgressBar=!0,o(500)):n.showMobileIndexProgressBar?(n.indexPercentDone=t,t<100&&o(500)):r())}function r(){t.cancel(a),s&&(l.IndexProgressUpdate.unbind(i),s=!1)}function o(e){s||(l.IndexProgressUpdate.bind(i),s=!0),t.cancel(a),a=t(function(){l.requestIndexProgressUpdate(n.app)},e||0)}var s,a,l=e.getService("qvGlobalSearchService");n.progressBarOptions={hideText:!0},l.couldEngineBeIndexing(n.app)&&o(0),n.$on("$destroy",function(){t.cancel(a),l.IndexProgressUpdate.unbind(i)}),n.hideMobileIndexProgressWhenDone=function(){n.showMobileIndexProgressBar=!1}}}}])}),define("client.views/global-search/global-search-controller",["jquery","qvangular","core.utils/feature-flags","core.utils/environment","core.utils/resize","core.utils/bind-layout","core.utils/authentication","./global-search-keyboard-shortcuts","autogenerated/qix/engine-enums","general.controllers/error-handler-controller","general.utils/responsive-state","client.services/grid-service","general.utils/support","client.views/global-search/constants/request-state","client.views/global-search/constants/search-method","client.views/global-search/focus-state","client.views/global-search/focus-state-definitions","client.views/global-search/global-search-history","client.views/global-search/directives/input/input","client.views/global-search/directives/result/result","client.views/global-search/directives/suggest/suggest","client.views/global-search/directives/history/history","client.views/global-search/directives/throbber/throbber","client.views/global-search/directives/mobile-index-progress/mobile-index-progress","client.views/global-search/global-search-data-service","client.views/global-selections/global-selections-service"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,v){function y(e,t,n,i){var r={qOffset:t,qCount:n,qGroupOptions:[],qGroupItemOptions:[]};return e===f.data?(r.qGroupOptions.push({qGroupType:"DatasetType",qOffset:0,qCount:-1}),r.qGroupItemOptions.push({qGroupItemType:"Field",qOffset:0,qCount:i})):e===f.visuals&&(r.qGroupOptions.push({qGroupType:"GenericObjectsType",qOffset:0,qCount:30}),r.qGroupItemOptions.push({qGroupItemType:"GenericObject",qOffset:0,qCount:i})),r}function b(e){var t={qContext:"CurrentSelections"};return e&&(t.qCharEncoding="Utf16"),t}function x(e,t){e.dimmerStyles["max-height"]=t,e.dimmerStyles.height=t}function q(e){e.isSmallDeviceLandscape=u.orientation===u.Orientation.landscape&&u.isSmallDevice}return function(C,S,w){var _,D=t.getService("qvGlobalSearchDataService"),M=t.getService("$timeout"),A=t.getService("qvGlobalSelectionsService"),E=t.getService("qvGlobalSearchService"),I={search:{idCounter:0,requestState:p.idle,searchTerms:""},searchVisuals:{idCounter:0,requestState:p.idle,searchTerms:""},result:{requestState:p.idle},suggest:{idCounter:0,requestState:p.idle,suggestTerms:""}},T=function(){M(function(){C.isSmallDevice=u.isSmallDevice,C.isSmallDevice&&(C.forceShowDimmer=!1),q(C),P=O(),k()})},L=function(){C.isSmallDeviceLandscape=u.orientation===u.Orientation.landscape&&u.isSmallDevice,q(C),P=O(),k()},k=function(){x(C,S.find("body").height()-P)},O=function(){return w.offset().top+w[0].offsetTop+w.find(".qv-global-search-input").outerHeight()},P=O(),N=w.parent().parent(),R=this;C.inClient=i.inClient(),C.focusState=new m(new g(m,this,C),m.Input),_=new a(w,C,this),C.forceShowDimmer=!1,C.isObjectsFeature=n.SMARTSEARCH_OBJECTS&&C.inClient,C.isSearchHistoryFeature=n.SEARCH_HISTORY,C.isIndexClosedFeature=n.SMARTSEARCH_INDEX_CLOSE,C.isSearchHistoryFeature&&i.isCloud().then(function(e){C.isCloud=e,s.userId?C.userID=s.userId:C.userID="DESKTOP",C.searchInputFocused=!1,C.activeHistoryIx=-1,C.historyPermission=!1,C.searchHistory=v.initHistory(C)}),C.isSmallDevice=u.isSmallDevice,C.isSmallDeviceLandscape=u.orientation===u.Orientation.landscape&&u.isSmallDevice,C.showMobileIndexProgressBar=!1,u.ViewChanged.bind(T),u.OrientationChanged.bind(L),r.on("end",k),C.input="input goes here",C.result="result goes here",C.isSelectActiveInSmallDevice=!1,C.$on("$destroy",function(){w.off("qv-outside"),_.delete(),u.ViewChanged.unbind(T),u.OrientationChanged.unbind(L),r.off("end",k)}),C.$on("updateForceShowDimmer",function(e,t){C.forceShowDimmer=t}),C.$watch("throbber.show",function(e){e&&C.focusState.reset()}),C.app.getCurrentSelectionObject().then(function(e){C.modelSelections=e}),o(C,"modelSelections",function(e){var t,n=e.qSelectionObject.qSelections;t=n.reduce(function(e,t){return e+(!0===t.qLocked)?1:0},0),C.currentSelections=n.length>0,C.allSelectionsLocked=n.length===t,C.isObjectsFeature&&R.searchVisuals(C.searchTerms),R.search(C.searchTerms)}),C.$watch("app.isModal()",function(e){e&&M(function(){E.toggleGlobalSearch(C.app)})}),C.$watch(A.isSelectActive.bind(null,C.app),function(e){C.isSelectActiveInSmallDevice=e&&C.isSmallDevice}),C.$watch("query",function(e){E.setHaveQuery(C.app,!!e)}),C.isIndexClosedFeature&&!C.isSmallDevice&&E.couldEngineBeIndexing(C.app)&&(C.forceShowDimmer=!0,M(function(){C.$broadcast("toggleActivityIndicator",!0)})),C.underlines=[],C.query="",C.searchTerms=[],C.searchTermGroups=[],C.matches=[],C.displayResult={data:!1,visuals:!1},C.activity={show:!1},C.throbber={show:!1},C.indexProgress={enabled:!1,show:!1,visible:!1},C.indexDone={show:!1,visible:!1},C.activeSelectIx=-1,C.showMeMoreFocus=!1,C.forcePartials=!1,C.allSelectionsLocked=!1,C.dimmerStyles={},C.error={show:!1,message:"",description:""},C.paging={lastRowIx:0,totalRows:0},C.searchOutsideSelections=function(){R.searchOutsideSelections()},C.onShowMoreHits=function(e,t,n){if(e.stopPropagation(),!t.disableShowMore){x(C,w.find(".qv-global-search-dimmer").height()),t.disableShowMore=!0,t.mobileExpand=!0;var i=y(f.data,n,1,t.qItemMatches.length+15);R.callSearch(C.searchTerms,i).then(function(e){D.showMore(e,t)}).finally(function(){t.disableShowMore=!1})}},C.getSearchTermGroup=function(e){return C.searchTermGroups.filter(function(t){return t.qSearchTermsMatched.length===e})},C.close=function(){R.closeSearch()},w.on("qv-outside",function(t){var n=e(t.target);1!==n.closest(".qv-selections-pager").length&&1!==n.closest(".transparent-overlay-scroll").length&&R.closeSearch()}),C.suggestions=[],C.displaySuggestions=!1,C.activeSuggestionIx=-1,C.ignoreQueryChange=!1,C.onOutsideSearch=function(){C.isSearchHistoryFeature&&R.showHistory(!1)},C.onSuggestSelect=function(e){var t,n,i,r=[];e=void 0!==e?e:C.activeSuggestionIx,i=C.suggestions[e],D.getUnderlinersAndSearchTerms(C.query,r,[]),(t=D.getResultingQueryFromSuggestion(r,i)).length>255?(_.off(),c.showDialog({message:"ErrorDialog.SearchStringTooLong"}),n=C.$on("errorHandlerClosed",function(){_.on(),n()})):(C.query=t+" ",C.ignoreQueryChange=!1),R.hideSuggestions(),C.$broadcast("focusInput")},C.haveUnlockedSelections=function(){return C.currentSelections&&!C.allSelectionsLocked},this.hideSuggestions=function(){C.displaySuggestions&&(C.displaySuggestions=!1,this.resetSuggestions())},this.hideSoftKeyboard=function(){C.$broadcast("blurInput")},this.showNoResultsMessage=function(){return!1},this.searchOutsideSelections=function(){C.outsideSelection=!0,C.modelSelections.clearAll(),C.$broadcast("focusInput")},this.setShowPartialMatches=function(){C.forcePartials=!C.forcePartials,d.treatAsDesktop()&&C.$broadcast("focusInput")},C.isPartials=function(){return C.searchTermGroups.length&&C.searchTerms.length>C.searchTermGroups[0].qSearchTermsMatched.length},this.resetSuggestions=function(){C.activeSuggestionIx=-1,C.activeSelectIx=-1},this.showSuggestions=function(){C.displaySuggestions=!0,C.activeSuggestionIx=-1,C.activeSelectIx=-1},this.showError=function(e){C.displayResult={data:!1,visuals:!1},C.error.show=!0,C.error.translation="ErrorCode."+e.code,e.isHandled=!0},this.toogleSuggestions=function(e){e?this.showSuggestions():this.hideSuggestions()},this.emptyResult=function(){C.displayResult={data:!1,visuals:!1},C.activeSelectIx=-1,C.error.show=!1,I.search.requestState=p.idle,I.searchVisuals.requestState=p.idle,I.suggest.requestState=p.idle,C.searchTerms=[],C.searchTermGroups=[],C.searchVisualsGroups=[],C.matches=[],C.outsideSelection=!1,C.$broadcast("toggleActivityIndicator",!1),C.forcePartials=!1,C.focusState.reset(),this.hideSuggestions(),N.removeClass("queryon")},this.moveActiveResult=function(e){C.showMeMoreFocus=!1,0!==e&&(e>0?(C.activeSelectIx=Math.min(C.activeSelectIx+1,C.searchTermGroups.length),C.activeSelectIx=Math.min(C.activeSelectIx,C.paging.totalRows-1),C.activeSelectIx===C.searchTermGroups.length&&(C.showMeMoreFocus=!0)):e<0&&(C.activeSelectIx=Math.max(C.activeSelectIx-1,0)))},this.searchVisuals=function(e){if(C.isObjectsFeature&&(x(C,S.find("body").height()-P),0!==e.length)){I.searchVisuals.idCounter=I.searchVisuals.idCounter+1;var t=I.searchVisuals.idCounter,n=this,i={qAttributes:["qProperty"],qCharEncoding:"Utf16"},r=y(f.visuals,0,-1,20);I.searchVisuals.requestState=p.pending,I.searchVisuals.searchTerms=e,C.app[f.visuals](i,e,r).then(function(e){C.searchVisualsGroups=[],t===I.searchVisuals.idCounter&&I.searchVisuals.requestState===p.pending&&(I.searchVisuals.requestState=p.idle,I.searchVisuals.searchTerms="",D.transformResult(C,e))},function(e){e.code===l.NxLocalizedErrorCode.LOCERR_SEARCH_TIMEOUT&&(n.emptyResult(),n.showError(e)),e.code!==l.NxLocalizedErrorCode.LOCERR_GENERIC_ABORTED&&(I.searchVisuals.requestState=p.idle,I.searchVisuals.searchTerms="",C.displayResult.visuals=!1)})}},this.search=function(e){if(x(C,S.find("body").height()-P),C.focusState.reset(),0!==e.length){N.addClass("queryon"),I.search.idCounter=I.search.idCounter+1;var t=I.search.idCounter,n=this,i=y(f.data,0,5,5);I.search.requestState=p.pending,I.search.searchTerms=e,C.$broadcast("toggleActivityIndicator",!0),C.$broadcast("resultScrollToTop"),C.error.show=!1,this.callSearch(e,i).then(function(n){C.searchTermGroups=[],C.matches=[],t===I.search.idCounter&&I.search.requestState===p.pending&&(I.search.requestState=p.idle,I.search.searchTerms="",C.searchTerms=e,C.$broadcast("toggleActivityIndicator",!1,!0),C.$broadcast("resultScrollToTop"),D.transformResult(C,n),C.activeSelectIx=-1,C.paging.lastRowIx=C.searchTermGroups.length,C.paging.totalRows=n.qTotalNumberOfGroups)},function(e){e.code===l.NxLocalizedErrorCode.LOCERR_SEARCH_TIMEOUT&&(n.emptyResult(),n.showError(e)),e.code!==l.NxLocalizedErrorCode.LOCERR_GENERIC_ABORTED&&(I.search.requestState=p.idle,I.search.searchTerms="",C.displayResult.data=!1)})}},this.loadNextPage=function(){function e(){e.code===l.NxLocalizedErrorCode.LOCERR_SEARCH_TIMEOUT&&(n.emptyResult(),n.showError(e)),e.code!==l.NxLocalizedErrorCode.LOCERR_GENERIC_ABORTED&&(I.search.requestState=p.idle,I.search.searchTerms="",C.displayResult.data=!1)}x(C,w.find(".qv-global-search-dimmer").height());var t=y(f.data,C.paging.lastRowIx,5,5),n=this;I.result.requestState===p.idle&&(I.result.requestState=p.pending,C.showMeMoreFocus=!1,C.$broadcast("toggleActivityIndicator",!0),this.callSearch(C.searchTerms,t).then(function(e){I.result.requestState=p.idle,C.$broadcast("toggleActivityIndicator",!1,!0),D.transformResult(C,e),C.paging.lastRowIx=C.searchTermGroups.length},e))},this.callSearch=function(e,t){return C.app[f.data](b(!0),e,t)},this.closeSearch=function(){C.isSmallDevice?(R.emptyResult(),C.query="",C.$broadcast("blurInput")):E.toggleGlobalSearch(C.app)},this.suggest=function(e){if(0!==e.length){var t=this;I.suggest.idCounter=I.suggest.idCounter+1;var n=I.suggest.idCounter;I.suggest.requestState=p.pending,I.suggest.suggestTerms=e,C.app.searchSuggest({},e).then(function(e){I.suggest.suggestTerms="",D.isWhiteSpaceAt(C.query,C.query.length-1)||'"'===C.query.charAt(C.query.length-1)||(n===I.suggest.idCounter&&I.suggest.requestState===p.pending&&(D.transformSuggest(C,e,10),t.toogleSuggestions(C.suggestions.length>0),C.$broadcast("suggestShow",!0,!0)),I.suggest.requestState=p.idle)},function(e){e.code===l.NxLocalizedErrorCode.LOCERR_SEARCH_TIMEOUT&&(e.isHandled=!0),e.code!==l.NxLocalizedErrorCode.LOCERR_GENERIC_ABORTED&&(I.suggest.requestState=p.idle,I.suggest.suggestTerms="")})}},this.select=function(e,t){if(C.$broadcast("blurInput"),0!==e.length&&0!==C.searchTermGroups.length){t<0&&(t=C.activeSelectIx=0);var n=[],i=[];D.getUnderlinersAndSearchTerms(C.query,n,i);var r=i;C.app.selectAssociations(b(),e,t).then(function(){C.isSearchHistoryFeature&&C.historyPermission&&v.createEntryInHistory(C,r)}),this.emptyResult(),C.query="",d.treatAsDesktop()&&!C.isSearchHistoryFeature&&C.$broadcast("focusInput")}},this.setTestSearchTermGroups=function(e){C.searchTermGroups=e},this.onNavigateToSheet=function(e){var t=[],n=[];D.getUnderlinersAndSearchTerms(C.query,t,n),C.isSearchHistoryFeature&&C.historyPermission&&""!=C.query&&v.createEntryInHistory(C,n),d.treatAsDesktop()?(R.emptyResult(),C.query="",C.isSearchHistoryFeature?C.$broadcast("blurInput"):C.$broadcast("focusInput")):M(function(){R.emptyResult(),C.query=""},200),h.highlightedCell(e)},this.showMoreHitsForVisual=function(e){var t={qOffset:0,qCount:1,qGroupOptions:[{qGroupType:"GenericObjectsType",qOffset:e.itemIndex,qCount:1}],qGroupItemOptions:[{qGroupItemType:"GenericObject",qOffset:0,qCount:e.qItemMatches.length+15}]};return C.app[f.visuals]({qAttributes:["qProperty"]},C.searchTerms,t).then(function(t){return D.showMore(t,e),e})},this.showHistory=function(e){C.searchInputFocused=e},this.setQueryFromHistory=function(e){C.ignoreQueryChange=!1,C.query=C.searchHistory[e],this.showHistory(!1),C.$broadcast("focusInput")},this.clearHistory=function(){v.clearSearchHistory(C),this.showHistory(!1)},this.removeHistory=function(e){v.removeSingleHistory(C,e)}}}),define("client.views/global-search/global-search",["qvangular","text!./global-search.ng.html","client.views/global-search/global-search-controller"],function(e,t,n){return e.directive("qvGlobalSearch",function(){return{restrict:"E",template:t,controller:["$scope","$document","$element",n],require:["qvGlobalSearch"],scope:!0,replace:!0,link:function(){}}}),"<qv-global-search></qv-global-search>"}),define("client.views/global-search/global-search-service",["angular","qvangular","client.views/global-search/global-search","client.utils/state","core.utils/notification","client.views/global-search/global-search-data-service","client.views/selection-toolbar/selection-toolbar-service"],function(e,t,n,i,r){t.service("qvGlobalSearchService",["$document","qvSelectionToolbarService",function(t,o){function s(e){return v[l(e)]}function a(e,t){v[l(e)]=t}function l(e){return e.id?e.id.toUpperCase():e.id}function c(e){return{$container:void 0,$containerId:".qv-global-search-container",$app:e,$lastKnownIndexProgress:void 0,$haveQuery:!1,getComponent:function(){return n},setup:function(){i.StateChanged.bind(u.bind(null,e)),e.isInModalSelection()&&o.confirm()},destroy:function(){i.StateChanged.unbind(u)}}}function u(e){(i.isInEditMode()||!i.isInAnalysisMode||i.inObjectView())&&p(s(e))}function h(n,i){n.$container=e.element("<div>"),(i=i||t).find(n.$containerId).append(n.$container),n.$container.showComponent(n.getComponent(),["$scope",function(e){e.app=n.$app}]),n.setup()}function d(e){return!(!e||void 0===e.$container)}function p(e){e.$container&&(e.$container.remove(),e.$container=void 0),e.destroy()}function f(e){var t=s(e);return t||a(e,t=new c(e)),t}function m(e,t){try{var n=t.qTransientProgressMessage.qMessageParameters[0],i=new Number(n),r=f(e);!isNaN(i)&&n&&(r.$lastKnownIndexProgress=i),g.IndexProgressUpdate.emit(l(e),i)}catch(e){return}}var g,v={};return g={toggleGlobalSearch:function(e,t){var n=f(e);d(n)?p(n):(i.setState(i.States.analysis),h(n,t))},openGlobalSearch:function(e,t){var n=f(e);d(n)||(p(n),h(n,t))},closeGlobalSearchIfNoQuery:function(e){var t=s(e);t&&t.$haveQuery||this.off()},off:function(){Object.keys(v).forEach(function(e){p(v[e])})},isSearchOpen:function(e){return d(s(e))},setLastKnownIndexProgress:function(e,t){(s(e)||{}).$lastKnownIndexProgress=t},getLastKnownIndexProgress:function(e){return(s(e)||{}).$lastKnownIndexProgress},couldEngineBeIndexing:function(e){var t=(s(e)||{}).$lastKnownIndexProgress;return void 0!==t&&t<100},requestIndexProgressUpdate:function(e){e.global.getProgress(0).then(m.bind(null,e))},setHaveQuery:function(e,t){f(e).$haveQuery=t}},r.mixin(g),g.notification("IndexProgressUpdate"),g}])}),define("text!client.views/cao/cao.ng.html",[],function(){return'<div class="qv-cao overlay">\n\t<h1 style="text-align: center; margin-top: 40px; font-size: 40px;">Add visualizations</h1>\t\n\t<div class="qv-cao-button-wrap">\n\t\t<lui-button class="qv-cao-add-button" ng-click ="addCreatedObject()">Add dynamically created object</lui-button>\n\t</div>\n</div>\n'}),define("client.views/cao/cao",["qvangular","text!./cao.ng.html","client.services/grid-service","objects.utils/type-loader","core.models/app","general.models/library/dimension","general.models/library/measure","apis/qutil"],function(e,t,n,i,r,o,s,a){var l=["$scope",function(e){i.load(),e.addCreatedObject=function(){r.get().then(function(e){var t,i;o.getList().then(function(r){r.getLayout().then(function(r){t=r[0],s.getList().then(function(r){r.getLayout().then(function(r){i=r[0],a.createDefinition({model:e.enigmaModel},"barchart",[t.qData.title,"="+i.qData.title]).then(function(e){n.addCaoObject(e).then(function(){},function(e){console.log(e)})})})})})})})}}];return e.directive("qvCaoComponent",function(){return{restrict:"E",template:t,controller:l,scope:!0,replace:!0,link:function(){}}}),"<qv-cao-component></qv-cao-component>"}),define("client.views/cao/cao-service",["angular","qvangular","client.views/cao/cao","client.utils/state","core.models/app","general.utils/qv-keyboard-shortcuts","client.views/selection-toolbar/selection-toolbar-service"],function(e,t,n,i,r,o){t.service("qvCaoService",["$document","qvSelectionToolbarService",function(t,s){function a(){return{$container:void 0,$containerId:".qv-cao-container",getComponent:function(){return n},setup:function(){r.get().then(function(e){i.StateChanged.bind(l.bind(null,e)),e.enigmaModel.isInModalSelection()&&s.confirm()})},destroy:function(){i.StateChanged.unbind(l)}}}function l(){(i.isInEditMode()||!i.isInAnalysisMode||i.inObjectView())&&h()}function c(n){p.on(),d.$container=e.element("<div>"),(n=n||t).find(d.$containerId).append(d.$container),d.$container.showComponent(d.getComponent()),d.setup()}function u(){return!(!d||void 0===d.$container)}function h(){p.off(),d&&(d.$container&&(d.$container.remove(),d.$container=void 0),d.destroy())}var d,p,f;return(p=o.createGroup("cao",1)).registerKeys("ctrl+left",o.preventDefault),p.registerKeys("ctrl+home",o.preventDefault),p.registerKeys("ctrl+right",o.preventDefault),p.registerKeys("ctrl+end",o.preventDefault),p.registerKeys("ctrl+e",o.preventDefault),p.registerKeys("ctrl+c",o.preventDefault),p.registerKeys("ctrl+x",o.preventDefault),p.registerKeys("ctrl+v",o.preventDefault),p.registerKeys("ctrl+z",o.preventDefault),p.registerKeys("ctrl+y",o.preventDefault),p.registerKeys("cmd+shift+z",o.preventDefault),p.registerKeys("del",o.preventDefault),p.registerKeys("ctrl+f",o.preventDefault),p.registerKeys("backspace",o.preventDefault),p.registerKeys("esc",o.preventDefault),{toggleCao:function(e){return d||(d=new a),u()?(h(),!1):(i.setState(i.States.analysis),c(e),!0)},off:function(){h()},setPublishCallback:function(e){f=e},removePublishCallback:function(){f=null},triggerPublishCallback:function(){f&&f()}}}])}),define("client.views/current-selections/current-selections",["angular","qvangular","jquery","touche","text!./current-selections.ng.html","text!./current-selections-tooltip-template.ng.html","client.models/current-selections","core.utils/bind-layout","core.utils/resize","general.utils/responsive-state","client.utils/state","util","client.utils/rtl/direction-service","core.utils/feature-flags","./current-selection-keyboard-shortcuts","client.utils/capability-flags","objects/listbox-popover/listbox-popover-service","general.components/pager/pager","client.views/global-selections/global-selections-service","client.views/global-search/global-search-service","client.views/cao/cao-service","client.views/state-count-bar/state-count-bar","objects.views/charts/tooltip/chart-tooltip-service","client.views/current-selections/current-selections-service","objects/listbox-popover/listbox-popover-service-mobile","client.views/progress-bar/progress-bar"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){"use strict";function g(e,t,n){return e.isPlaceHolder=!0,e.active=!1,e.qLocked=!1,e.feedbackActive=!1,e.translation="",e.qTotal=0,e.qStateCounts=0,t&&(e.qField=t),n&&(e.name=n),e}function v(e,t,n,i,r){return e.showField(t,i.model.app.enigmaModel,n,{},function(){i.activeFieldName="",r(function(){i.closeTooltip()},100)})}t.directive("qvSelectionPager",["qvGlobalSelectionsService","$timeout",function(e,n){return t.getService("$templateCache").put("current-selections-tooltip-template.ng.html",o),{restrict:"A",priority:1,link:function(t){function i(){t.refreshPager(!1)}var r=t.$watch(function(){return e.isSelectActive(t.app)},function(e){t.$emit("globalSelectionActive",e),n(function(){t.refreshPager(!1)})});l.on("end",i),t.$on("$destroy",function(){r(),l.off("end",i)})}}}]);var y={template:r,replace:!0,restrict:"E",scope:{app:"=",options:"="},link:function(e,n){function i(t,n){if(t===(e.app.enigmaModel.id||"").toUpperCase()){var i=new Number(n);!e.isGlobalSearchIndexing&&i<100?(e.indexPercentDone=i,e.isGlobalSearchIndexing=!0,o(500)):e.isGlobalSearchIndexing?(e.indexPercentDone=i,i<100&&o(500)):r()}}function r(){x.cancel(y),v&&(C.IndexProgressUpdate.unbind(i),v=!1)}function o(t){v||(C.IndexProgressUpdate.bind(i),v=!0),x.cancel(y),y=x(function(){C.requestIndexProgressUpdate(e.app.enigmaModel)},t||0)}function a(){x(function(){e.isSmallDevice=c.isSmallDevice,p.SMARTSEARCH_INDEX_CLOSE&&(e.isSmallDevice?(r(),e.setSearchIndexingDone()):!C.isSearchOpen(e.app.enigmaModel)&&C.couldEngineBeIndexing(e.app.enigmaModel)&&o(0)),e.isSmallDevice&&e.isCaoActive&&(e.isCaoActive=!1)})}function l(){b&&(u.isInAnalysisMode()?b.on():b.off())}function h(){u.inSheetView()&&c.isSmallDevice&&C.openGlobalSearch(e.app.enigmaModel,w),l(),u.isInEditMode()&&(e.isCaoActive=!1)}function d(t){s.get(t).then(function(t){e.model=t}),e.$watch(t.isInModalSelection.bind(t),function(t){e.inSelection=t,e.inSelection&&e.activeFieldName&&e.activeFieldName.length>0?e.cachedPlaceHolders=e.items.map(function(e){return g({},e.qField,e.qReadableName||e.qField)}):(e.cachedPlaceHolders=[],e.items=e.items.filter(function(e){return!e.isPlaceHolder}))})}var v,y,b,x=t.getService("$timeout"),q=t.getService("qvGlobalSelectionsService"),C=t.getService("qvGlobalSearchService"),S=t.getService("qvCaoService"),w=n.parent();m.getFlag("SELECTION_KEYS")&&(b=new f(e)),e.nbrSelection=0,e.haveHiddenSelections=!1,e.isSmallDevice=c.isSmallDevice,e.cachedPlaceHolders=[],e.isGlobalSearchIndexing=!1,e.progressBarOptions={hideText:!0},e.setSearchIndexingDone=function(){e.isGlobalSearchIndexing=!1},l(),c.ViewChanged.bind(a),e.$watch("isSmallDevice",function(t){!0===t?C.openGlobalSearch(e.app.enigmaModel,w):C.closeGlobalSearchIfNoQuery(e.app.enigmaModel)}),u.StateChanged.bind(h),e.mobileIndicatorTop=!1,e.mobileIndicatorShow=!1,q.setCsShowCallback(function(t){e.mobileIndicatorShow=t}),e.$on("globalSelectionActive",function(t,n){e.isGlobalSelectionsActive=n});var _=e.$watch("app",function(e){d(e.enigmaModel),_()});e.$watch(function(){return C.isSearchOpen(e.app.enigmaModel)},function(t){if(e.isGlobalSearchActive=t,p.SMARTSEARCH_INDEX_CLOSE)if(e.isSmallDevice||t)r(),e.isGlobalSearchIndexing=!1;else if(C.couldEngineBeIndexing(e.app.enigmaModel)){var n=C.getLastKnownIndexProgress(e.app.enigmaModel);e.isGlobalSearchIndexing=!0,e.indexPercentDone=n,o(500)}}),e.toggleGlobalSelection=function(t){t.preventDefault(),q.toggleGlobalSelection(e.app),C.off(),e.isCaoActive=!1},e.toggleGlobalSearch=function(){C.toggleGlobalSearch(e.app.enigmaModel,w),e.isCaoActive=!1,q.off()},e.toggleCao=function(){e.isCaoActive=S.toggleCao(w),C.off(),q.off()},e.$watch("isCaoActive",function(e){q.setCaoActive(!!e),!1===e&&S.off()}),e.$on("$destroy",function(){c.ViewChanged.unbind(a),C.off(),S.off(),e.isCaoActive=!1,q.off(),u.StateChanged.unbind(h),q.setCsShowCallback(null),x.cancel(y),C.IndexProgressUpdate.unbind(i),b&&b.delete()})},controller:["$scope","$timeout","qvChartTooltipService","qvGlobalSelectionsService","qvCurrentSelectionsService",function(r,o,s,l,f){function m(){l.setCsShow(c.isSmallDevice&&r.items.length>0&&u.view!==u.Views.object)}function y(e){return e.every(function(e){return e.qLocked})}var b,x,q,C=!1,S=t.getService("qvListboxPopoverService"),w=t.getService("qvListboxPopoverServiceMobile");r.items=[],r.disable={clear:!0,back:!0,forward:!0},r.lightCurSel=p.LIGHT_CUR_SEL||r.options&&"bright"===r.options.variant,r.hideUndoRedo=r.options&&!0===r.options.hideUndoRedo,r.hideSelectionsTool=r.options&&!0===r.options.hideSelectionsTool,r.hideSearch=r.options&&!0===r.options.hideSearch,r.hideClearSelections=r.options&&!0===r.options.hideClearSelections,a(r,"model",function(){q&&q.dispose(),q=r.model.layoutSubscribe(function(e){r.disable.clear=0===e.qSelectionObject.qSelections.length||y(e.qSelectionObject.qSelections),r.disable.back=0===e.qSelectionObject.qBackCount,r.disable.forward=0===e.qSelectionObject.qForwardCount,r.items=e.qSelectionObject.qSelections.filter(function(e){return!e.qIsHidden}).sort(function(e,t){return e.qSortIndex-t.qSortIndex}),r.haveHiddenSelections=e.qSelectionObject.qSelections.some(function(e){return e.qIsHidden}),r.items.forEach(function(e){e.translation=f.translate(e),e.name=e.qReadableName||e.qField}),r.nbrSelections=r.items.length,l.setSelectionCount(r.items.length,r.app),m(),r.cachedPlaceHolders.length>0&&r.activeFieldName&&r.activeFieldName.length>0&&(r.cachedPlaceHolders.forEach(function(e){g(e)}),r.items.forEach(function(e){r.cachedPlaceHolders.forEach(function(t,n){e.qField===t.qField&&(r.cachedPlaceHolders[n]=h.extend(!0,{},e))})}),r.items=r.cachedPlaceHolders),o(function(){r.$broadcast("refreshPager")})})}),r.$watch(u.inObjectView,m),r.$watch("isSmallDevice",m),r.clear=function(e){r.$parent.itemSelected&&(r.$parent.itemSelected=!1),r.model.clearField(e)},r.clearAllFields=function(){r.model.clearAll()},r.back=function(){r.model.back()},r.forward=function(){r.model.forward()},r.showPopover=function(t){var i=e.element(t.target).closest(".item"),s=i.scope().item.qField,a=i.scope().item.isPlaceHolder,l={qvaOutsideIgnoreFor:"currentSelectionsItems",$alignToElement:i,showLock:!0,direction:d.direction};if(r.isClearSelectionIcon(t.target))r.activeFieldName&&(c.isSmallDevice?S.close():w.close(),r.activeFieldName="");else{if(s===r.activeFieldName||a)return c.isSmallDevice?S.close():w.close(),void(r.activeFieldName="");o(function(){r.closeTooltip()},100),r.activeFieldName=s,c.isSmallDevice?v(w,s,l,r,o):v(S,s,l,r,o).then(function(e){var t;e.closing.then(function(e){e&&!n(e.target).closest(".current-selection-elem").length>0&&(r.activeFieldName=""),t=e}),e.closed.then(function(){e=null,t||(r.activeFieldName="")})})}},r.openTooltip=function(e,t){r.isClearSelectionIcon(e.target)?r.closeTooltip():C||i.utils.touch||(r.cancelTooltip(),b=o(function(){var n=t.qStateCounts,i="object"==typeof n?" ("+(n.qSelected+n.qSelectedExcluded+n.qLocked+n.qLockedExcluded)+"/"+t.qTotal+")":"";C=!0,s.open({content:[{header:(t.qReadableName||t.qField)+i,rows:[{content:t.translation}]}],position:{x:e.clientX,y:e.clientY},alwaysOnTop:!0,direction:"bottom",template:"current-selections-tooltip-template.ng.html"})},500))},r.closeTooltip=function(){C=!1,r.cancelTooltip(),s.close()},r.cancelTooltip=function(){o.cancel(b)},r.isClearSelectionIcon=function(t){return e.element(t).closest(".remove").is(".remove")},x=t.$rootScope.$on("locked-feedback",function(e,n){r.items.forEach(function(e){-1!==n[0].indexOf(e.qField)&&(n[1]?e.feedbackActive=!1:e.feedbackActive=!0,t.$apply(r))})}),r.$on("$destroy",function(){x(),q&&q.dispose()})}]};return t.directive("qvStageCurrentSelections",function(){return y}),y}),define("assets/hldm/data-connectors/bdi/bdi",["text!./bdi.ng.html","apis/qapp","translator","core.models/communication","./bdi-field-list","client.views/current-selections/current-selections"],function(e,t,n,i){return{restrict:"E",template:e,replace:!0,scope:{},controller:["$scope","$q",function(e,r){var o,s,a,l;e.loading=!1,e.search={text:""},e.totalPossibleRows=0,e.loading=!0,e.selectedRowString=n.get("bdi.select.selectedrows",[0,0]),e.openedDeferred.promise.then(function(){i.getSessionApp("?transient=",{route:"app/bdi",onError:function(){}}).then(function(n){o=n.app,a=n.global,e.app=o;var i="SET CreateSearchIndexOnReload=0;"+e.input.connectionString+";Import Live "+e.input.model+";";o.setScript({qScript:i}),o.doReload().then(function(){s=new t(o);var e={qWindowSize:{qcx:0,qcy:0},qNullSize:{qcx:0,qcy:0},qCellHeight:0,qSyntheticMode:!1,qIncludeSysVars:!1};o.getTablesAndKeys(e.qWindowSize,e.qNullSize,e.qCellHeight,e.qSyntheticMode,e.qIncludeSysVars).then(function(e){c(e)});var n={qInfo:{qId:"BDIObject",qType:"BDIObject"},qBDIObjectDef:{}};o.createSessionObject(n).then(function(e){l=e})})})}),e.$on("$destroy",function(){e.selState&&e.selState.OnData&&e.selState.OnData.unbind(u)});var c=function(t){var n=t.qtr.map(function(e){return{name:e.qName,fields:e.qFields,isMeta:e.qName.indexOf("_meta")>0}});e.allTables=n.filter(function(e){return!e.isMeta}).sort(function(e,t){return e.name.toLowerCase().localeCompare(t.name.toLowerCase())});var i=[];e.allTables.forEach(function(t){t.fields.forEach(function(n){n.qTags.indexOf("$key")>-1&&(n.isKeyField=!0),n.selected=!1,t.countField||n.isKeyField||(t.countField=n,e.totalPossibleRows+=n.qnPresentDistinctValues),n.listboxCreation=function(){return h(n)}})}),r.all(i).then(function(){e.selState=s.selectionState(),e.selState.OnData.bind(u),e.onFieldStateUpdated(),e.loading=!1})},u=function(){e.onFieldStateUpdated()},h=function(e){return s.visualization.create("listbox",[e.qName],{title:e.qName}).then(function(t){return e.cachedListVisual={id:e,model:t.model,options:{}},e.cachedListVisual.model})};e.selectAll=function(){e.allTables.forEach(function(e){e.fieldListApi.selectAll()})},e.clearAll=function(){e.allTables.forEach(function(e){e.fieldListApi.deselectAll()})},e.onFieldStateUpdated=function(){};var d=function(t){var n=e.input.connectionString+";\r\n";return e.allTables.filter(function(e){return e.fields.filter(function(e){return!0===e.selected}).length>0}).forEach(function(i){var r="QSL SELECT \r\n";r=i.fields.filter(function(e){return e.selected||e.isKeyField}).reduce(function(e,t,n,i){var r=e+"\t["+t.qName+"]";return n<i.length-1&&(r+=", "),r+="\r\n"},r),r+="FROM ["+e.input.model+"].["+i.name+"]\r\n",n+=r+="AT STATE ${"+t+"};\r\n\r\n"}),n},p=function(e){return"odhBDIHandle_"+(e.map(function(e){return parseInt(e.slice(e.lastIndexOf("_")+1))}).reduce(function(e,t){return Math.max(e,t)})+1)},f=function(e,t){return i.getApp().then(function(n){return n.getObject("BDIAttachments").then(function(i){return i.getFullPropertyTree().then(function(r){var o=r.qProperty.qBDIObjectDef.qAttachments,s=p(o.map(function(e){return e.qID})),a={qPatches:[{qPath:"/qBDIObjectDef/qAttachments/"+o.length,qOp:"add",qValue:JSON.stringify({qID:s,qConnectionString:t,qHandle:e})}]};return i.applyPatches(a).then(function(){return n.doSave().then(function(){return s})})})},function(){var i={qInfo:{qId:"BDIAttachments",qType:"BDIObject"},qBDIObjectDef:{qAttachments:[{qID:"odhBDIHandle_0",qConnectionString:t,qHandle:e}]}};return n.createObject(i).then(function(){return n.doSave().then(function(){return"odhBDIHandle_0"})})})})};e.insertScript=function(){var t={qBDIObjectDef:{qHandleCopyInLayout:"model"}};l.setProperties(t).then(function(){l.getLayout().then(function(t){var n=t.qBDIObject.qGeneratedHandleCopy,i=t.qBDIObject.qConnectionString,r={qPatches:[{qPath:"/qBDIObjectDef/qPendingCleanup/0",qOp:"remove",qValue:""}]};l.applyPatches(r).then(function(){f(n,i).then(function(t){e.input.scriptEditorProxy.insertCode(d(t)),a.session.close().then(function(){a=null,e.close()})})})})})},e.cancel=function(){a&&a.session.close().then(function(){a=null,e.close()})}}]}}),define("assets/hldm/data-connectors/bdi/bdi-select-dialog",["qvangular","./bdi"],function(e,t){return{showDialog:function(n,i){var r=/'(.*)\s(.*):(.*)'/g,o=n.connectionString,s=r.exec(o)[1],a={connectionName:n.name,connectionString:o,model:s,scriptEditorProxy:i};e.getService("luiDialog").show({template:t.template,controller:t.controller,input:a,closeOnOutside:!1,showArrow:!1})}}}),define("assets/hldm/data-connectors/bdi/connector-main",[],function(){return{create:function(){return{entrypoints:[{id:"BDI",category:"database",name:"BDI",scriptOnly:!0}],getInitialSelectStep:function(){}}}}}),define("assets/hldm/data-connectors/bdi/bdi-connector",["assets/hldm/data-connectors/bdi/bdi-connect-dialog","assets/hldm/data-connectors/bdi/bdi-select-dialog","assets/hldm/data-connectors/bdi/connector-main"],function(e,t,n){return{connectDialog:e,selectDialog:t,connectorMain:n}}),define("assets/hldm/data-connectors/connector-loader",["core.utils/deferred"],function(e){function t(t,n){return new e.Promise(function(e,i){switch(t.type){case"folder":require(["assets/hldm/data-connectors/native-file-connector/native-file-connector"],function(t){e(t[n])},i);break;case"ODBC":require(["assets/hldm/data-connectors/native-odbc-connector/native-odbc-connector"],function(t){e(t[n])},i);break;case"OLEDB":require(["assets/hldm/data-connectors/native-oledb-connector/native-oledb-connector"],function(t){e(t[n])},i);break;case"internet":require(["assets/hldm/data-connectors/native-webfile-connector/native-webfile-connector"],function(t){e(t[n])},i);break;case"BDI":require(["assets/hldm/data-connectors/bdi/bdi-connector"],function(t){e(t[n])},i);break;default:i("No native connector with type: "+t.type)}})}function n(t,n){return new e.Promise(function(e,i){var r=t[n];requirejs([r],e,i)})}return{loadComponent:function(e,i){return e.isStandardConnector?t(e,i):n(e,i)}}}),define("assets/hldm/models/dataconnectors-model",["core.utils/deferred","assets/hldm/data-connectors/connector-loader"],function(e,t){var n=[],i={},r={};return{createDataconnectorsModel:function(o,s,a,l){function c(r){var o=r.provider;if(!i[o]){var s=new e;i[o]=s.promise,-1!==n.indexOf(r.connectorMain)?s.resolve(void 0):t.loadComponent(r,"connectorMain").then(function(t){t&&t.create?e.when(t.create(a.getServersideConnectorProxy(r))).then(function(e){s.resolve(e)},function(){s.resolve(void 0)}):s.resolve(void 0)},function(){n.push(r.connectorMain),s.resolve(void 0)})}return i[o]}function u(e){return c(e).then(function(t){return{connectorType:e,connectorMain:t||{entrypoints:[{id:e.provider,scriptOnly:!0}]}}},function(){})}function h(e){return e.filter(function(e){return e&&e.connectorMain})}function d(){return a.getDataconnectorTypes().then(function(t){return e.all(t.map(u))})}function p(t){if(!r[t.id]){var n=new e;r[t.id]=n.promise,t.type?c(t.type).then(function(e){var i={connectorInstance:t,connectorMain:e};n.resolve(i)},function(){n.resolve(void 0)}):n.resolve(void 0)}return r[t.id]}function f(e){var t="";switch(e){case"scripteditor.flatfilechooser.files.all":t="../resources/img/connector-logos/connector-folder-all-logo.png";break;case"scripteditor.flatfilechooser.files.excel":t="../resources/img/connector-logos/connector-folder-excel-logo.png";break;case"scripteditor.flatfilechooser.files.qvd":t="../resources/img/connector-logos/connector-folder-qvd-logo.png";break;case"scripteditor.flatfilechooser.files.qvx":t="../resources/img/connector-logos/connector-folder-qvx-logo.png";break;case"scripteditor.flatfilechooser.files.delimited":t="../resources/img/connector-logos/connector-folder-delimited-logo.png";break;case"internet":t="../resources/img/connector-logos/connector-internet-logo.png";break;case"odbc":t="../resources/img/connector-logos/connector-odbc-logo.png";break;case"oledb":t="../resources/img/connector-logos/connector-oledb-logo.png";break;default:t="../resources/img/connector-logos/connector-generic-logo.png"}return t}function m(){return g.selectDialogsEnabled=!1,g.addButtonEnabled=!1,g.connectorTypesByName={},d().then(function(t){g.connectors=t;var n={database:[],file:[],web:[],datamarket:[]},i={},o={};for(var s in t){var c=t[s].connectorMain;for(var u in c.entrypoints){var d=c.entrypoints[u];d.imagePath||(d.imagePath=f(d.id)),n[d.category]=n[d.category]||[],n[d.category].push({entrypoint:d,connectorMain:c,connectorType:t[s].connectorType,canCreate:a.hasCreatePrivileges(l,t[s].connectorType.type.toLowerCase())})}1===c.entrypoints.length&&c.entrypoints[0].id&&(o[t[s].connectorType.provider.toLowerCase()]=c.entrypoints[0].id.toLowerCase()),i[t[s].connectorType.type]=c}return a.getDataconnectorInstances().then(function(t){return e.all(t.map(p)).then(h).then(function(e){return g.connections=e,g.allConnectorEntrypoints=n,g.entryPointProviderToIdMap=o,g.completeConnectionPromises=r,g})})})}var g={connectors:[],connections:[],completeConnectionPromises:{},allConnectorEntrypoints:[],populateList:m,getConnectionServersideProxy:function(e,t){return a.getServersideConnectorProxy(e,t)},getConnectionFromServer:function(e,t){return a.getDataconnectorInstances().then(function(n){for(var i=0;i<n.length;i++){var r=t?e:a.appendUsernameSuffix(e);if(n[i].name.toLowerCase()===r.toLowerCase())return n[i]}})},getConnectionFromModel:function(e){for(var t in g.connections)if(g.connections[t].connectorInstance.name===e)return g.connections[t]},getCompleteConnectionInstance:p};return m().then(function(e){return e})}}}),define("assets/hldm/models/load-select-statement-fetcher",["underscore","core.utils/deferred","assets/load-model/templating/template-runner","assets/load-model/models/box-types-model","core.models/engine","assets/hldm/models/dataconnectors-model","scripteditor.services/dataconnector-service"],function(e,t,n,i,r,o,s){function a(e){return l||(l=o.createDataconnectorsModel(r.global,r.getCurrentApp(),s,!0,!0)),l.then(function(r){var o,s=r.getConnectionFromModel(e.dataconnectorName),a={};if(s&&s.connectorMain&&s.connectorMain.getRawScript)return o=r.getConnectionServersideProxy(e.connectionInfo.type,e.connectionInfo),s.connectorMain.getRawScript(o,e).then(function(e){return a.selectStatement=e,a.loadSelectStatement="",a});if(s&&s.connectorMain&&s.connectorMain.generateSelectScript)return o=r.getConnectionServersideProxy(e.connectionInfo.type,e.connectionInfo),s.connectorMain.generateSelectScript(o,e).then(function(e){return a.loadSelectStatement=e,a});if(s&&s.connectorMain&&s.connectorMain.getScriptTemplate)return o=r.getConnectionServersideProxy(e.connectionInfo.type,e.connectionInfo),t.when(s.connectorMain.getScriptTemplate(o,e)).then(function(e){return n.TemplateRunner.render(e).then(function(e){return a.loadSelectStatement=e,a})});if(s&&s.connectorMain&&s.connectorMain.getBoxType){var l=s.connectorMain.getBoxType(s);return t.when(n.TemplateRunner.render(i.BoxTypesModel.GetBoxType(l).template,e)).then(function(e){return a.selectStatement=e,a})}return"script"!==e.dataconnectorName&&void 0!==i.BoxTypesModel.GetBoxType(e.boxType)?t.when(n.TemplateRunner.render(i.BoxTypesModel.GetBoxType(e.boxType).template,e)).then(function(e){return a.loadSelectStatement=e,a}):""})}var l;return{getLoadSelectStatement:function(n,i){if("script"===n.connectionInfo.typeName){var r=new t;return r.resolve({loadSelectStatement:n.loadSelectStatement,selectStatement:n.selectStatement}),r.promise}if(n.fields&&n.fields.filter(function(e){return e.selected}).length>0){var o=e.clone(n);return o.tableAlias=o.tableName,o.fields=o.fields.filter(function(e){return e.selected}).map(function(t){var n=e.clone(t);return n.alias=t.name,n}),a(o,i).then(function(e){return e})}var s=new t;return s.resolve({}),s.promise},forceConnectionListUpdate:function(){l&&(l=l.then(function(e){return e.populateList()}))}}}),define("assets/hldm/models/load-model-storage",["util","core.utils/deferred","core.models/app","qvangular"],function(e,t,n,i){"use strict";function r(e){for(var t in e)if("LoadModel"===e[t].qInfo.qId)return!0;return!1}function o(){l||(l=new t,s())}function s(){n.get().then(function(e){e.enigmaModel.getListObject(c).then(function(t){t.getLayout().then(function(t){r(t)?e.enigmaModel.getObject("LoadModel").then(function(e){a=e,l.resolve(e)}):(delete e.enigmaModel._listCache.LoadModelList,i.getService("$timeout")(s,2e3))})})})}var a,l,c={qInfo:{qId:"LoadModelList",qType:"LoadModelList"},qAppObjectListDef:{qType:"LoadModel"}};return{awaitGenericObject:function(){return o(),l.promise},setProperties:function(i){o();var r=new t,s={qInfo:{qType:"LoadModel",qId:"LoadModel"}};return e.extend(s,i),a?r.resolve():n.get().then(function(e){e.createObject(s).then(function(){r.resolve()})}),r.promise.then(function(){l.promise.then(function(){return a.setProperties(s)})})}}}),define("assets/hldm/services/data-prep-service",["pubsub","core.utils/class","core.models/engine","core.models/rpc-session","core.utils/deferred","qvangular","util","translator","jquery","assets/hldm/services/data-prep-rest-service","assets/hldm/Constants"],function(e,t,n,i,r,o,s,a,l,c,u){"use strict";function h(e){return o.$rootScope.isPersonalMode&&-1!==e.indexOf(f,e.length-f.length)?e.substr(0,e.length-1)+"f":e}var d={},p=t.extend("DataPrepService",{init:function(e,t){function n(e){(e=e||{}).isHandled=!0,e.message=a.get("DataPrep.Recommendations.ConnectionLostToDPS"),u.waitForOpen.reject(e)}function o(){u.waitForOpen.resolve(u)}e=e||s.getParameterByName("app"),(t=t||p.connectOptions).route="app/"+encodeURIComponent(e).toLowerCase(),t.responseInterceptors=[{onRejected:function(e,t,n){return n.isHandled=!0,r.reject(n)}}],this.session=i.get(null,t);var u=this;this._callbacks=l.Callbacks(),this.waitForOpen=new r,this.restService=new c,this.session.Error.bind(function(e){var t=e.error;t&&(t.isHandled=!0,-32e3!==t.code&&(t.dpsError=!0))}),this.session.Close.bind(n),this.session.Open.bind(o),this.session.enigmaPromise.then(o).catch(n)},rpc:function(t,n){var i={method:t,params:n||[]},r=this;return r.session.rpc(i).then(function(i){return i.result.notification&&1005===i.result.notification.data.code?(e.publish(u.Events.PubSub.StartSpin,{method:t}),!0===(n.length&&n.length>1&&n[1].forceReload)&&(n[1].forceReload=!1),r.executeAfterReload(t,n).finally(function(){e.publish(u.Events.PubSub.StopSpin,{method:t})})):i})},rpcWithPolling:function(t,n,i){i&&e.publish(u.Events.PubSub.StartSpin,{method:t});var r=!0,o=void 0,s=function(){i&&e.publish(u.Events.PubSub.StopSpin,{method:t})};o=setInterval(function(){r&&this.getProgress().then(function(){})}.bind(this),15e3);var a=function(){r=!1,void 0!==o&&clearInterval(o),o=void 0};return this.rpc(t,n).then(function(e){return a(),s(),e},function(e){throw a(),s(),e})},executeAfterReload:function(e,t){var n=new r;return this.waitForReload(n),n.promise.then(function(){return this.rpc(e,t)}.bind(this))},_checkProgress:function(e){var t=!1;return e.engine&&e.engine.qProgressData&&e.engine.qProgressData.qFinished&&!0===e.dps.dataLoad.complete&&!0===e.dps.profiling.complete&&(t=!0),t},waitForReload:function(e){this.getProgress().then(function(t){this._checkProgress(t.result)?e.resolve(!0):setTimeout(function(){this.waitForReload(e)}.bind(this),1e3)}.bind(this),function(t){e.reject(t)})},augmentOptions:function(e){return e.throwOnReload=!0,e},getProgress:function(){return this.rpc("getProgress",[0])},getModel:function(e){return this.rpc("getModel",[e||{}])},setModel:function(e,t){return this.rpc("setModel",[e,t||{}])},initModel:function(e,t){return this.rpc("initModel",[e,t||{}])},analyzeModel:function(e,t){return this.rpc("analyzeModel",[e,t||{}])},getTargetTables:function(e,t){return this.rpc("getTargetTables",[e,this.augmentOptions(t)||{}])},warmUpDPS:function(e,t){return this.rpc("getTargetTables",[e,this.augmentOptions(t)||{}]).catch(function(e){throw e.error.dpsHandled=!0,console.log("Warming up DPS ignored this error: "),console.log(e),e})},getTablePreview:function(e,t,n){return this.rpc("getTablePreview",[e,t,this.augmentOptions(n)||{}])},getTableFields:function(e,t,n){return this.rpc("getTableFields",[e,t,this.augmentOptions(n)||{}])},getLoadScript:function(e,t){return this.rpc("getLoadScript",[e,t||{}])},getClassifications:function(e){return this.rpc("getClassifications",[e])},getRestService:function(){return this.restService},getVisRecommendations:function(e,t){return this.rpc("getVisRecommendations",[e,t])},adaptVisualization:function(e,t){return this.rpc("adaptVisualization",[e,t])},syncLoadModel:function(e){return this.rpc("syncLoadModel",[e])},getRecommendations:function(e,t){return this.rpcWithPolling("getRecommendations",[e,this.augmentOptions(t)||{}],!0)},getDataPreview:function(e){return this.rpc("getDataPreview",[e])},updateSources:function(e,t,n){return this.rpcWithPolling("updateSources",[e,t,n||{}])}});p.getConnectOptions=function(){if(p.connectOptions){var e=new r;return e.resolve(p.connectOptions),e.promise}return n.global.getConfiguration().then(function(){return p.connectOptions={host:s.hostname,isSecure:s.isSecure,prefix:s.basePath,port:s.port,subpath:"dataprepservice",reloadURI:s.reloadURI},p.connectOptions})},p.isRunning=function(){return(new c).isRunning()},p.get=function(e,t){return p.getConnectOptions(t).then(function(t){return e=e||s.getParameterByName("app"),e=h(e),(d[e.toLowerCase()]=d[e.toLowerCase()]||new p(e,t)).waitForOpen.promise})};var f=".qvw";return p}),define("assets/hldm/models/load-model",["assets/load-model/load-model","assets/load-model/query-generator","assets/hldm/models/load-select-statement-fetcher","assets/hldm/models/load-model-storage","assets/hldm/services/data-prep-service","core.utils/deferred"],function(e,t,n,i,r,o){function s(e){function t(e){h.overwriteContent(e),f.forEach(function(t){t&&t(e)})}return e.Invalidated.bind(function(){e.getLayout().then(t)}),e.getLayout().then(t)}function a(e){n.forceConnectionListUpdate();var t=e.tableModels.map(function(t){if(!t.data.loadSelectStatement&&!t.data.selectStatement)return n.getLoadSelectStatement(t.data,null).then(function(n){var i=e.getTableModelWithName(t.getTableAlias());i.data.loadSelectStatement=n&&n.loadSelectStatement,i.data.selectStatement=n&&n.selectStatement})});return o.all(t)}function l(e){return t.QueryGenerator.checkIntegrity(e.tables,e.queries),i.setProperties(e)}function c(e){f.splice(f.indexOf(e),1)}function u(e){-1===f.indexOf(e)&&f.push(e)}var h,d,p,f=[],m={createLoadModel:e.LoadModel.CreateLoadModel,getLoadModel:function(e){return d||(d=new o),u(e),r.isRunning().catch(function(t){d.reject(t),c(e)}),d.promise},updateProperties:l,resetLoadModel:function(){return l(e.LoadModel.CreateLoadModel({}).serialize())},populateLoadSelectStatements:a,bindLoadModel:function(t,n){return-1===f.indexOf(t)&&f.push(t),p||((h=e.LoadModel.CreateLoadModel(n)).updateProperties=m.updateProperties,p=i.awaitGenericObject().then(function(e){return s(e).then(function(){return a(h).then(function(){return h})})}),d||(d=new o),p.then(function(e){d.resolve(e)}).catch(function(e){d.reject(e)})),d.promise},unregisterInvalidationFn:c,registerInvalidationFn:u};return m}),define("assets/hldm/services/data-prep-rest-service",["jquery","pubsub","core.utils/class","core.utils/deferred","util","general.utils/swagger-api","assets/hldm/views/data-manager/data-manager-performance-debug/data-manager-performance-debug-global-defaults","assets/hldm/Constants"],function(e,t,n,i,r,o,s,a){"use strict";var l;return n.extend("DataPrepRestService",{init:function(){},_getAPI:function(){return l||(l=o.getApi("api/dataprepservice/v1","openapi")),l},_handleRestResponse:function(e,n,i){return i.body&&i.body.notification&&1005===i.body.notification.data.code?(t.publish(a.Events.PubSub.StartSpin,{method:e}),this.executeAfterReload({apiFunc:this[e],initialParams:n}).finally(function(){t.publish(a.Events.PubSub.StopSpin,{method:e})})):(i.body.response&&i.body.response.loadModel&&require(["assets/hldm/models/load-model"],function(e){e.updateProperties(i.body.response.loadModel)}),i.body.response)},executeAfterReload:function(e){var t=new i;return this.waitForReload(t),t.promise.then(function(){return e.apiFunc.apply(this,e.initialParams)}.bind(this))},waitForReload:function(e){this.getProgress().then(function(t){this._checkProgress(t.result)?e.resolve(!0):setTimeout(function(){this.waitForReload(e)}.bind(this),1e3)}.bind(this),function(t){e.reject(t)})},_checkProgress:function(e){var t=!1;return e.engine&&e.engine.qProgressData&&e.engine.qProgressData.qFinished&&!0===e.dps.dataLoad.complete&&!0===e.dps.profiling.complete&&(t=!0),t},_getAppName:function(){return r.getParameterByName("app")},getRestResponseHandler:function(e,t){return function(){return this[e].bind(this,t)}.bind(this)},getSerializedLoadModel:function(){var e=this,t=arguments;return this._getAPI().then(function(n){return n.apis.model.getCurrentLoadModel({appId:e._getAppName()}).then(e._handleRestResponse.bind(e,"getSerializedLoadModel",t))})},_addTables:function(e){var t=this,n=arguments;return this._getAPI().then(function(i){return i.apis.table.addTables({appId:t._getAppName(),body:e}).then(t._handleRestResponse.bind(t,"_addTables",n))})},_getDesiredTransforms:function(){var e=[];return e.push("makeGeoPoint"),e.push("lookupGeoInfo"),e},isRunning:function(){return this._getAPI()},getForcedConcatRecommendations:function(e){var t=this,n=arguments;return this._getAPI().then(function(i){var r={type:"concatenate",queries:e};return i.apis.table.recommendTableTransformation({appId:t._getAppName(),body:r}).then(t._handleRestResponse.bind(t,"getForcedConcatRecommendations",n))})},getTargetTables:function(e,t){var n=this,i=arguments;return this._getAPI().then(function(r){return r.apis.table.getCurrentTables({appId:n._getAppName(),forceReload:e,noData:t}).then(n._handleRestResponse.bind(n,"getTargetTables",i))})},invokeWithPolling:function(e,n,i){n&&t.publish(a.Events.PubSub.StartSpin,{method:i});var r=!0,o=void 0;o=setInterval(function(){r&&this.getProgress().then(function(){})}.bind(this),15e3);var s=function(){r=!1,void 0!==o&&clearInterval(o),o=void 0};return e().then(function(e){return s(),n&&t.publish(a.Events.PubSub.StopSpin,{method:i}),e},function(e){throw s(),n&&t.publish(a.Events.PubSub.StopSpin),e})},invokeWithGlobalSpinnerSupport:function(e){return t.publish(a.Events.PubSub.StartSpinInvalidation),e().catch(function(){t.publish(a.Events.PubSub.StopSpinInvalidation)})},createConcatenatedQuery:function(e,t,n){var i=this,r=arguments;return this.invokeWithGlobalSpinnerSupport(function(){return i._getAPI().then(function(o){var s={type:"forceConcatenate",payload:{name:e,queries:t,mappings:n}};return o.apis.table.applyTransformation({appId:i._getAppName(),body:s}).then(i._handleRestResponse.bind(i,"createConcatenatedQuery",r))})})},splitQuery:function(e,t){var n=this,i=arguments;return this.invokeWithGlobalSpinnerSupport(function(){return n._getAPI().then(function(r){var o={type:"split",payload:{queries:[e],queryProperties:[{sourceQueries:t}]}};return r.apis.table.applyTransformation({appId:n._getAppName(),body:o}).then(n._handleRestResponse.bind(n,"splitQuery",i))})})},synchronizeScriptedTables:function(){return this.invokeWithPolling(function(){return this.addTables([],!0).then(function(e){return e})}.bind(this),!0,"synchronize")},getProgress:function(){var e=this,t=arguments;return this._getAPI().then(function(n){var i={appId:e._getAppName()};return n.apis.session.getProgress(i).then(e._handleRestResponse.bind(e,"getProgress",t))})},addTables:function(t,n){for(var i={data:[],applyTransformations:this._getDesiredTransforms(),defaults:{},scriptedSources:n},r=0;r<t.length;r++){var o=t[r],a={tables:[]};a.connectionInfo=e.extend(!0,{},o.connectionInfo,{dbInfo:o.dbInfo}),i.data.push(a);var l=a.tables;o.tablesAndFields.map(function(e){var t={databaseName:o.databaseName,ownerName:o.ownerName,tableName:e.table.qName,formatSpec:e.table.qFormatSpec,fileFormatSettings:e.table.fileFormatSettings};t.fields=[],e.fields.forEach(function(e){t.fields.push({name:e.qName,selected:!0})}),l.push(t)})}return(new s).get().then(function(e){return i.defaults.enableQVDCaching=e.enableQVDCaching,this._addTables(i)}.bind(this))},getVisRecommendations:function(e,t,n,i){var r=this,o=arguments;return this._getAPI().then(function(s){var a={appId:r._getAppName()};e&&(["fields","libItems","expressions"].forEach(function(t){e[t]&&e[t].length&&(a[t]=JSON.stringify(e[t]))}),e.table&&(a.table=e.table)),n&&(a.bundleOverride=JSON.stringify(n)),i&&(a.detailLevel=JSON.stringify([]));var l=s.apis.visualization;return(t?l.getVisualizationsForLoaded(a):l.getVisualizationsForCurrent(a)).then(r._handleRestResponse.bind(r,"getVisRecommendations",o))})},bucketField:function(e,t,n){var i=this,r=arguments;return this._getAPI().then(function(o){var s={type:"bucket",bucketing:n};s.bucketing.fieldId=t;var a={appId:i._getAppName(),tableId:e,body:s};return o.apis.table.applyTableTransformation(a).then(i._handleRestResponse.bind(i,"bucketField",r))})},applyOrdinal:function(e,t,n){var i=this,r=arguments;return this._getAPI().then(function(o){var s={type:"ordinal",ordinals:n},a={appId:i._getAppName(),tableId:e,fieldId:t,body:s};return o.apis.field.addFieldTransformation(a).then(i._handleRestResponse.bind(i,"applyOrdinal",r))})},applyFieldMapping:function(e,t,n){var i=this,r=arguments;return this._getAPI().then(function(o){var s={type:"mapping",mappings:n},a={appId:i._getAppName(),tableId:e,fieldId:t,body:s};return o.apis.field.addFieldTransformation(a).then(i._handleRestResponse.bind(i,"applyFieldMapping",r))})},splitField:function(e,t,n){var i=this,r=arguments;return this._getAPI().then(function(o){var s={type:"splitField",splitDef:{fieldId:t,splitInfo:n}},a={appId:i._getAppName(),tableId:e,body:s};return o.apis.table.applyTableTransformation(a).then(i._handleRestResponse.bind(i,"splitField",r))})},adaptVisualization:function(e,t,n,i,r,o){var s=this,a=arguments;return this._getAPI().then(function(l){var c={action:e,datasetName:t,analysisType:i,dims:r,msrs:o,visType:n};return l.apis.visualization.createVisRecommendationForCurrent({appId:s._getAppName(),body:c}).then(s._handleRestResponse.bind(s,"adaptVisualization",a))})}})}),define("objects/cre/recommendations-fetcher",["assets/hldm/services/data-prep-rest-service"],function(e){function t(e){return e}function n(e){return e&&e.group&&"insight"!==e.group}function i(e,t){return!e.isExtendedAnalysis&&t===e.matchRecord.matches.length}var r=new e;return{getChartRecommendations:function(e){return r.getVisRecommendations(e,!0,{explore:"appNMinExplore"},[]).then(function(t){var r=[],o=e.fields.length+e.libItems.length+e.expressions.length;return t.appRecommendations.forEach(function(e){n(e)&&e.recAnalyses.forEach(function(e){i(e,o)&&r.push(e)})}),r}).catch(t)},getFallbackRecommendation:function(e){function t(e){return e.isLibraryItem()?{libId:e.libId,cType:"eLibItem"}:e.isFieldItem()?{field:e.name,expr:e.expr,cType:"eField"}:{expr:e.expr,cType:"eInlineExpr"}}return{analysis:{analysis:"list",dims:e.dimensions.map(t),msrs:e.measures.map(t)}}}}}),define("objects/cre/chart-data-definitions/barchart-data-definition",[],function(){return{type:"barchart",encodings:[{key:"bars",classification:"dimension",path:"qHyperCubeDef.qDimensions.0.qDef.qFieldDefs.0",encodings:[{key:"height",classification:"measure",path:"qHyperCubeDef.qMeasures.$measureIndex.qDef.qDef"},{key:"group",classification:"dimension",path:"qHyperCubeDef.qDimensions.$dimensionIndex.qDef.qFieldDefs.0"},{key:"stack",classification:"dimension",path:"qHyperCubeDef.qDimensions.$dimensionIndex.qDef.qFieldDefs.0"},{key:"color",classification:"dimension",path:"qHyperCubeDef.qDimensions.0.qDef.qAttrDims.0"}]}],analyses:[{analysis:"rank",dimensions:1,measures:1,score:5,encodings:[{key:"bars",classification:"dimension",index:"0"},{key:"height",classification:"measure",index:"0"}]},{analysis:"breakdown",dimensions:1,measures:{min:2,max:15},encodings:[{key:"bars",classification:"dimension",index:"0"},{key:"height",classification:"measure",indexRange:{start:0,end:14}}]},{analysis:"breakdown",dimensions:2,measures:1,criteria:function(e){var t=e.getMetaDataForDimension(0);return!!t&&(t.qCardinal&&t.qCardinal<13&&e.isPerfectHierarchy())},encodings:[{key:"bars",classification:"dimension",index:"1"},{key:"color",classification:"dimension",index:"0"},{key:"height",classification:"measure",index:"0"}]},{analysis:"breakdown",dimensions:2,measures:1,criteria:function(e){return e.isPerfectHierarchy()},encodings:[{key:"bars",classification:"dimension",index:"0"},{key:"group",classification:"dimension",index:"1"},{key:"height",classification:"measure",index:"0"}]}]}}),define("objects/cre/chart-data-definitions/kpi-data-definition",[],function(){return{type:"kpi",encodings:[{key:"values",path:"qHyperCubeDef.qMeasures.$measureIndex.qDef.qDef",classification:"measure"}],analyses:[{analysis:"list",dimensions:0,measures:{min:1,max:1},score:10,encodings:[{key:"values",classification:"measure",index:0}]},{analysis:"fact",dimensions:0,measures:{min:1,max:2},encodings:[{key:"values",classification:"measure",indexRange:{start:0,end:1}}]}]}}),define("objects/cre/chart-data-definitions/gauge-data-definition",["util"],function(e){return{type:"gauge",encodings:[{key:"values",path:"qHyperCubeDef.qMeasures.$measureIndex.qDef.qDef",classification:"measure"}],analyses:[{analysis:"fact",dimensions:0,measures:1,criteria:function(e){var t=e.getMetaDataForMeasure(0);return!!t&&(t.qMin>0&&t.qMax<1)},score:10,encodings:[{key:"values",classification:"measure",index:"0"}],adapt:function(t){e.setValue(t,"measureAxis.max",1),t.disclaimerClosed=!0}}]}}),define("objects/cre/chart-data-definitions/scatterplot-data-definition",[],function(){return{type:"scatterplot",encodings:[{key:"dots",path:"qHyperCubeDef.qDimensions.0.qDef.qFieldDefs.0",classification:"dimension",encodings:[{key:"x-axis",classification:"measure",path:"qHyperCubeDef.qMeasures.0.qDef.qDef"},{key:"y-axis",classification:"measure",path:"qHyperCubeDef.qMeasures.1.qDef.qDef"},{key:"size",classification:"measure",path:"qHyperCubeDef.qMeasures.2.qDef.qDef"},{key:"color",classification:"dimension",path:"qHyperCubeDef.qDimensions.0.qDef.qAttrDims.0"},{key:"color",classification:"measure",path:"qHyperCubeDef.qDimensions.0.qAttributeExpressions.0"}]}],analyses:[{analysis:"comparison",dimensions:1,measures:{min:2,max:4},score:10,encodings:[{key:"dots",classification:"dimension",index:"0"},{key:"x-axis",classification:"measure",index:"0"},{key:"y-axis",classification:"measure",index:"1"},{key:"size",classification:"measure",index:"2"},{key:"color",classification:"measure",index:"3"}]},{analysis:"comparison",dimensions:2,measures:{min:2,max:3},criteria:function(e){return e.isPerfectHierarchy()},score:10,encodings:[{key:"dots",classification:"dimension",index:"0"},{key:"color",classification:"dimension",index:"1"},{key:"x-axis",classification:"measure",index:"0"},{key:"y-axis",classification:"measure",index:"1"},{key:"size",classification:"measure",index:"2"}]}]}}),define("objects/cre/chart-data-definitions/linechart-data-definition",[],function(){return{type:"linechart",encodings:[{key:"linePoints",classification:"dimension",path:"qHyperCubeDef.qDimensions.0.qDef.qFieldDefs.0",encodings:[{key:"lines",classification:"dimension",path:"qHyperCubeDef.qDimensions.1.qDef.qFieldDefs.0"},{key:"position",classification:"measure",path:"qHyperCubeDef.qMeasures.$measureIndex.qDef.qDef"}]}],analyses:[{analysis:"trend",dimensions:1,measures:{min:1,max:4},encodings:[{key:"linePoints",classification:"dimension",index:"0"},{key:"position",classification:"measure",indexRange:{start:0,end:3}}]},{analysis:"trend",dimensions:2,measures:1,criteria:function(e){var t=e.getMetaDataForDimension(0),n=e.getMetaDataForDimension(1);return t.qCardinal*n.qCardinal===e.qSize.qcy},encodings:[{key:"linePoints",classification:"dimension",index:"0"},{key:"lines",classification:"dimension",index:"1"},{key:"position",classification:"measure",index:"0"}],adapt:function(e){e.lineType="area",e.stackedArea=!0}},{analysis:"trend",dimensions:2,measures:1,encodings:[{key:"linePoints",classification:"dimension",index:"0"},{key:"lines",classification:"dimension",index:"1"},{key:"position",classification:"measure",index:"0"}]}]}}),define("objects/cre/chart-data-definitions/straight-table-data-definition",[],function(){return{type:"table",encodings:[{key:"columns",classification:"dimension",path:"qHyperCubeDef.qDimensions.$dimensionIndex.qDef.qFieldDefs.0"},{key:"columns",classification:"measure",path:"qHyperCubeDef.qMeasures.$measureIndex.qDef.qDef"}],analyses:[{analysis:"list",dimensions:{min:0,max:15},measures:{min:0,max:15},encodings:[{key:"columns",classification:"dimension",indexRange:{start:0,end:14}},{key:"columns",classification:"measure",indexRange:{start:0,end:14}}]}]}}),define("objects/cre/chart-data-definitions/piechart-data-definition",[],function(){return{type:"piechart",encodings:[{key:"slices",path:"qHyperCubeDef.qDimensions.0.qDef.qFieldDefs.0",classification:"dimension",encodings:[{key:"color",path:"qHyperCubeDef.qDimensions.0.qDef.qAttrDims.0",classification:"dimension"},{key:"angle",path:"qHyperCubeDef.qMeasures.0.qDef.qDef",classification:"measure"}]}],analyses:[{analysis:"rank",dimensions:1,measures:1,score:10,criteria:function(e){var t=e.getMetaDataForDimension(0),n=e.getMetaDataForMeasure(0);return!!(t&&t.qCardinal<13&&n&&n.aggregation&&"sum"===n.aggregation.toLowerCase()&&e.isSummable())},encodings:[{key:"slices",classification:"dimension",index:"0"},{key:"color",classification:"dimension",index:"0"},{key:"angle",classification:"measure",index:"0"}]}]}}),define("objects/cre/chart-data-definitions/combochart-data-definition",[],function(){return{type:"combochart",encodings:[{key:"records",classification:"dimension",path:"qHyperCubeDef.qDimensions.0.qDef.qFieldDefs.0",encodings:[{key:"bars",classification:"measure",path:"qHyperCubeDef.qMeasures.$measureIndex.qDef.qDef"},{key:"lines",classification:"measure",path:"qHyperCubeDef.qMeasures.$measureIndex.qDef.series"}]}],analyses:[{analysis:"trend",dimensions:1,measures:2,score:10,criteria:function(e){function t(e){return Math.log(e)/Math.LN10}var n=e.getMetaDataForMeasure(0),i=e.getMetaDataForMeasure(1),r=Math.floor(t(n.qMax)),o=Math.floor(t(i.qMax));return Math.abs(r-o)>=1},encodings:[{key:"records",classification:"dimension",index:"0"},{key:"bars",classification:"measure",index:"0"},{key:"lines",classification:"measure",index:"1",adapt:function(e){e.qDef.series={type:"line",axis:1,marker:"circle",markerFill:!0}}}]}]}}),define("objects/cre/chart-data-definitions/treemap-data-definition",[],function(){return{type:"treemap",encodings:[{key:"blocks",classification:"dimension",path:["qHyperCubeDef.qDimensions.$dimensionIndex.qDef.qFieldDefs.0","qHyperCubeDef.qDimensions.$dimensionIndex.qDef.qFieldLabels.0"],encodings:[{key:"color",classification:"dimension",path:"qHyperCubeDef.qDimensions.0.qDef.qAttrDims.0"},{key:"size",classification:"measure",path:"qHyperCubeDef.qMeasures.$measureIndex.qDef.qDef"},{key:"color",classification:"measure",path:"qHyperCubeDef.qDimensions.0.qDef.qAttrExps.0"}]}],analyses:[{analysis:"breakdown",dimensions:{min:2,max:15},measures:{min:1,max:2},criteria:function(e){var t=!1,n=e.getMetaDataForMeasure(0),i=e.getMetaDataForMeasure(1);return n.qMin>0&&(t=!i||i.qMin>0),t},score:10,encodings:[{key:"blocks",classification:"dimension",index:"0"},{key:"group",classification:"dimension",indexRange:{start:1,end:14}},{key:"size",classification:"measure",index:"0"},{key:"color",classification:"measure",index:"1"}]}]}}),define("objects/cre/chart-data-definitions/mapchart-data-definition",["util","client.utils/capability-flags"],function(e,t){return{type:"map",encodings:[{key:"point",classification:"dimension",encodings:[{key:"size",classification:"dimension"},{key:"color",classification:"measure"}]}],analyses:[{analysis:"polymapdistribution",dimensions:1,measures:{min:0,max:1},criteria:function(){return t.getFlag("GEO_MIGRATE")},score:100,encodings:[{key:"area",classification:"dimension",index:"0"},{key:"color",classification:"measure",index:"0"}]},{analysis:"pointmapdistribution",dimensions:1,measures:{min:0,max:2},criteria:function(){return t.getFlag("GEO_MIGRATE")},score:100,encodings:[{key:"points",classification:"dimension",index:"0"},{key:"custom",classification:"measure",index:"0",adapt:function(t,n){n.isFieldValue()||n.isExpressionValue()?(e.setValue(t,"size.expression.key",n.getExpression()),e.setValue(t,"size.expression.label",n.getExpression()),e.setValue(t,"size.expression.type","expression")):n.isLibraryValue()&&(e.setValue(t,"size.expression.key",n.getLibraryId()),e.setValue(t,"size.expression.label",""),e.setValue(t,"size.expression.type","libraryItem"))}},{key:"color",classification:"measure",index:"1"}]}]}}),define("objects/cre/chart-data-definitions/distributionplot-data-definition",[],function(){return{type:"distributionplot",encodings:[{key:"records",classification:"dimension",encodings:[{key:"bars",classification:"dimension"},{key:"lines",classification:"measure"}]}],analyses:[{analysis:"distribution",dimensions:{min:1,max:2},measures:1,criteria:function(e){var t=!1;if(e.getMetaDataForMeasure(0)){var n=e.getMetaDataForDimension(0),i=e.getMetaDataForDimension(1);n&&n.qCardinal<=500&&(i?i&&i.qCardinal<=500&&(t=!0):t=!0)}return t},encodings:[{key:"records",classification:"dimension",index:"0"},{key:"bars",classification:"dimension",index:"1"},{key:"lines",classification:"measure",index:"0"}]}]}}),define("objects/cre/chart-data-definitions/boxplot-data-definition",[],function(){return{type:"boxplot",encodings:[{key:"records",classification:"dimension",encodings:[{key:"bars",classification:"dimension"},{key:"lines",classification:"measure"}]}],analyses:[{analysis:"distribution",dimensions:{min:1,max:2},measures:1,criteria:function(e){var t=!1;if(e.getMetaDataForMeasure(0)){var n=e.getMetaDataForDimension(0),i=e.getMetaDataForDimension(1);n&&n.qCardinal>500&&(i?i&&i.qCardinal>500&&(t=!0):t=!0)}return t},hyperCubePath:"boxplotDef",encodings:[{key:"records",classification:"dimension",index:"0"},{key:"bars",classification:"dimension",index:"1"},{key:"lines",classification:"measure",index:"0"}]}]}}),define("objects/cre/chart-data-definitions/histogram-data-definition",[],function(){return{type:"histogram",encodings:[{key:"values",path:"qHyperCubeDef.qDimensions.0.qDef.qFieldDefs.0",classification:"dimension"}],analyses:[{analysis:"distribution",dimensions:1,measures:0,encodings:[{key:"values",classification:"dimension",index:0}]}]}}),define("objects/cre/chart-data-definitions/chart-data-definitions",["underscore","objects/cre/chart-data-definitions/barchart-data-definition","objects/cre/chart-data-definitions/kpi-data-definition","objects/cre/chart-data-definitions/gauge-data-definition","objects/cre/chart-data-definitions/scatterplot-data-definition","objects/cre/chart-data-definitions/linechart-data-definition","objects/cre/chart-data-definitions/straight-table-data-definition","objects/cre/chart-data-definitions/piechart-data-definition","objects/cre/chart-data-definitions/combochart-data-definition","objects/cre/chart-data-definitions/treemap-data-definition","objects/cre/chart-data-definitions/mapchart-data-definition","objects/cre/chart-data-definitions/distributionplot-data-definition","objects/cre/chart-data-definitions/boxplot-data-definition","objects/cre/chart-data-definitions/histogram-data-definition"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p){function f(e){m[e.type]=e}var m={};f(n),f(i),f(o),f(s),f(a),f(l),f(c),f(u),f(h),f(d),f(p),f(r),f(t);var g=void 0;return{getSupportedChartTypes:function(){var t=e.keys(m);return g?e.filter(t,function(e){return g.indexOf(e)>=0}):t},getChartDataDefinition:function(e){return m[e]},restrictSupportedChartTypes:function(e){g=e}}}),define("objects/cre/chart-data-properties-creator/chart-data-properties-model",[],function(){function e(e){this.type="eLibItem"===e.cType?"library":"eField"===e.cType?"field":"eInlineExpr"===e.cType?"expression":"unknown",this.expr=e.expr,this.field=e.field,this.libId=e.libId}function t(e,t,n,i){this.key=e,this.classification=t,this.value=n,this.adapt=i}return e.prototype.isLibraryValue=function(){return"library"===this.type},e.prototype.getLibraryId=function(){return this.libId},e.prototype.isFieldValue=function(){return"field"===this.type},e.prototype.getFieldName=function(){return this.field||this.expr},e.prototype.isExpressionValue=function(){return"expression"===this.type},e.prototype.getExpression=function(){return this.expr},t.prototype.isMeasure=function(){return"measure"===this.classification},t.prototype.isDimension=function(){return"dimension"===this.classification},t.prototype.isColorBy=function(){return"color"===this.key},t.prototype.isCustom=function(){return"custom"===this.key},{Value:e,Encoding:t}}),define("objects/cre/chart-data-properties-creator/chart-data-properties-creator",["underscore","objects/cre/chart-data-definitions/chart-data-definitions","objects/cre/chart-data-properties-creator/chart-data-properties-model"],function(e,t,n){"use strict";function i(e,t,i,r,o,s){var a="dimension"===t?o:s;if(!(a.length<=r)){var l=new n.Value(a[r]);return new n.Encoding(e,t,l,i)}}function r(e,n){var i=[],r=e.analysis;return t.getSupportedChartTypes().forEach(function(e){var s=t.getChartDataDefinition(e);s.analyses&&s.analyses.filter(function(e){return e.analysis===r.analysis&&(!!o(r.dims,e.dimensions)&&(!!o(r.msrs,e.measures)&&!(e.criteria&&!e.criteria(n))))}).forEach(function(t){var n={chartType:e,encodings:s.encodings,score:t.score||0,adapt:t.adapt,analysis:t};i.push(n)})}),i}function o(t,n){if(e.isObject(n)){if(s(t?t.length:0,n.min,n.max))return!0}else if(s(t?t.length:0,n,n))return!0;return!1}function s(e,t,n){return e>=t&&e<=n}return{createChartDataProperties:function(e,t){function n(e,t){var n,r;void 0!==t.index?n=r=t.index:void 0!==t.indexRange?(n=t.indexRange.start,r=t.indexRange.end):n=r=-1;for(var a=n;a<=r;a++){var l=i(t.key,t.classification,t.adapt,a,o,s);l&&e.push(l)}return e}var o=e.analysis.dims||[],s=e.analysis.msrs||[],a=[];return r(e,t).forEach(function(e){var t={type:e.chartType,score:e.score,encodings:e.analysis.encodings.reduce(n,[]),adapt:e.adapt,hyperCubePath:e.analysis.hyperCubePath};a.push(t)}),a}}}),define("objects.picasso/advanced-colorer",["general.utils/attribute-expression-util","client.utils/property-resolver","client.utils/property-logic/property-logic-helper"],function(e,t,n){function i(t,n){t.forEach(function(t){r(t,e.IDMAP.COLOR_BY_ALTERNATIVE,"qAttributeDimensions"),r(t,e.IDMAP.COLOR_BY_ALTERNATIVE,"qAttributeExpressions")}),n.forEach(function(t){r(t,e.IDMAP.COLOR_BY_ALTERNATIVE,"qAttributeDimensions"),r(t,e.IDMAP.COLOR_BY_ALTERNATIVE,"qAttributeExpressions")})}function r(t,n,i){if(t[i]){var r=e.getIndexById(t[i],n);r>=0&&t[i].splice(r,1)}else t[i]=[]}function o(e,t,n,i){function r(e){return e.split(" ").length>1&&"="!==e[0]&&"["!==e[0]?"["+e+"]":e}var o=n?"expression":t.type,s=e.mode;switch(o){case"field":s="byDimension",e.byDimDef={label:t.label||r(t.name),key:r(t.name),type:"expression",activeDimensionIndex:t.activeDimensionIndex};break;case"expression":s="byMeasure",e.byMeasureDef={label:n||t.label||t.name,key:n||t.name,type:"expression"};break;case"dimension":s="byDimension",e.byDimDef={label:t.name,key:t.id,type:"libraryItem",activeDimensionIndex:t.activeDimensionIndex};break;case"measure":s="byMeasure",e.byMeasureDef={label:t.name,key:t.id,type:"libraryItem"}}i||(e.auto=!1,e.mode=s),e.altLabel=t.label||t.name}function s(n,r,o,s,a,l){i(o,s);var c=o[o.length-1];if(c){var u=r?t.getValue(n,"byDimDef"):t.getValue(n,"byMeasureDef");if(u){var h={id:e.IDMAP.COLOR_BY_ALTERNATIVE};switch(u.type){case"expression":h.label=l||u.label,r?h.qDef=u.key:h.qExpression=u.key;break;case"libraryItem":if(!r){var d=-1;a.forEach(function(e,t){u.key===e.qLibraryId&&(d=t)}),h.matchMeasure=d}h.qLibraryId=u.key,h.colorMapRef=u.key}r?(h.qSortBy={qSortByAscii:1},c.qAttributeDimensions.push(h)):c.qAttributeExpressions.push(h)}}}var a=["scatterplot","map"],l=["map"];return{baseColor:{isSupported:function(e){return e&&e.length&&-1===a.indexOf(e)},isDimSupported:function(e){return e&&e.length&&-1!==l.indexOf(e)}},colorBy:{},colorByUpdater:function(e,t,n,i){this.updateColorDef(e,i,n),this.updateHypercubeAttributes(e,t,n)},updateColorDef:function(i,r,s){var a,l,c,u,h=t.getValue(s,"mode"),d=t.getValue(s,"auto"),p=t.getValue(i,r+"qDimensions",[]),f=t.getValue(i,r+"qMeasures",[]);if(!d&&"byDimension"===h&&p.length)(a=t.getValue(s,"byDimDef"))&&a.activeDimensionIndex>-1?(a.activeDimensionIndex=Math.min(a.activeDimensionIndex,p.length-1),l=p[a.activeDimensionIndex],(u=n.getColorByDefinition("dimension",!1,l)).activeDimensionIndex=a.activeDimensionIndex,o(s,u)):a&&a.key||(l=p[p.length-1],c=e.getById(l.qAttributeDimensions,e.IDMAP.COLOR_BY_ALTERNATIVE),o(s,n.getColorByDefinition("dimension",!!c,c||l)));else if(!d&&"byMeasure"===h&&p.length){if((!(a=t.getValue(s,"byMeasureDef"))||!a.key)&&f.length){var m=f[0];l=p[p.length-1],c=e.getById(l.qAttributeExpressions,e.IDMAP.COLOR_BY_ALTERNATIVE),o(s,n.getColorByDefinition("measure",!!c,c||m))}}else"byMultiple"===h&&f.length<2&&t.setValue(s,"mode","primary")},updateHypercubeAttributes:function(e,n,r){var o=t.getValue(r,"mode"),a=t.getValue(r,"auto"),l=t.getValue(e,n+"qDimensions",[]),c=t.getValue(e,n+"qMeasures",[]),u=t.getValue(e,n+"qLayoutExclude.qHyperCubeDef.qDimensions",[]);!a&&"byDimension"===o&&l.length?s(r,!0,l,u,c,t.getValue(r,"byDimDef.label")):!a&&"byMeasure"===o&&l.length?s(r,!1,l,u,c,t.getValue(r,"byMeasureDef.label")):i(l,u)},setColorByPropertyDef:o,resolveColorByPropertyDef:s,clearColorByItem:i}}),define("extensions.qliktech/mapchart/DataUtils",["require","exports"],function(e,t){"use strict";var n;return function(e){function t(e,t){if(!t.qDimensionInfo[0])return null;for(var n=0;n<t.qDimensionInfo.length;n++){for(var i=t.qDimensionInfo[n].qAttrExprInfo,r=0;r<i.length;r++)if(i[r].id===e)return{index:r,isDim:!1,dimensionIndex:n};for(var o=t.qDimensionInfo[n].qAttrDimInfo,r=0;r<o.length;r++)if(o[r].id===e)return{index:r,isDim:!0,dimensionIndex:n}}return null}function n(e,n,i){var r=n.qMatrix,o=[],s=t(e,i);if(null==s)return o;for(var a=s.index,l=s.dimensionIndex,c=0;c<r.length;c++)try{var u=r[c][l].qAttrExps.qValues[a].qNum;o.push(u)}catch(e){o.push(null)}return o}e.addExpr=function(e,t,n,i){if(n.qDimensions[0]&&t&&t.key&&0!==t.key.trim().length){var r="libraryItem"===t.type,o=r&&!(!0===i),s=r?{qLibraryId:t.key,id:e}:{qExpression:t.key,id:e};o?n.qDimensions[0].qAttributeDimensions.push(s):n.qDimensions[0].qAttributeExpressions.push(s)}},e.setExprInProperties=function(e,t,n){if(n.qHyperCubeDef.qDimensions[0]){for(var i=n.qHyperCubeDef.qDimensions[0].qAttributeExpressions,r=-1,o=0;o<i.length;o++)if(i[o].id===e){r=o;break}if(null!=t&&0!==t.trim().length)r<0&&(r=i.length,i.push(null)),i[r]={qExpression:t,id:e};else if(r>=0){for(o=r;o<i.length-1;o++)i[o]=i[o+1];i.pop()}}},e.getDimensionExpressionIndex=t,e.getDimensionExpressionTitle=function(e,n){var i=t(e,n);if(null==i)return null;var r=n.qDimensionInfo[i.dimensionIndex].qAttrExprInfo[i.index];return null==r?null:r.label||r.qFallbackTitle},e.getMinMax=function(e,n){var i=t(e,n);if(null==i)return null;var r=n.qDimensionInfo[i.dimensionIndex];if(!r)return null;var o=i.index,s=r.qAttrExprInfo[o];return!s||isNaN(s.qMin)||isNaN(s.qMax)?null:[s.qMin,s.qMax]},e.getNumericData=n,e.getNumericDataMinMax=function(e,t,i){var r=[],o=Number.MAX_VALUE,s=Number.MIN_VALUE;for(var a in t){var l=n(e,t[a],i);if(0===l.length)return null;r.push(l);for(var c=l.length,u=0;u<c;u++){var h=l[u];h&&!isNaN(h)&&(h>s&&(s=h),h<o&&(o=h))}}return{min:o,max:s,pages:r}},e.getStringOrNumber=function(e,n,i){var r=n.qMatrix,o=[],s=t(e,i);if(null==s)return o;for(var a=s.index,l=s.isDim,c=s.dimensionIndex,u=0;u<r.length;u++)try{var h=l?r[u][c].qAttrDims:r[u][c].qAttrExps,d=null;h.qValues[a].qText?d=h.qValues[a].qText:h.qValues[a].qNum&&!isNaN(h.qValues[a].qNum)&&(d=h.qValues[a].qNum),o.push(d||null)}catch(e){o.push(null)}return o},e.getStringData=function(e,n,i){var r=n.qMatrix,o=[],s=t(e,i);if(null==s)return o;for(var a=s.index,l=s.isDim,c=s.dimensionIndex,u=0;u<r.length;u++)try{var h=(l?r[u][c].qAttrDims:r[u][c].qAttrExps).qValues[a].qText;o.push(h||null)}catch(e){o.push(null)}return o},e.getElemData=function(e){return e.qMatrix.map(function(e){var t=e[0];return null==t?{id:null,dimValue:null,state:null}:{id:t.qElemNumber,dimValue:t.qText,state:t.qState}})}}(n||(n={})),n}),define("extensions.qliktech/mapchart/LayerType",["require","exports"],function(e,t){"use strict";var n;return function(e){e.AREA="AreaLayer",e.POINT="PointLayer",e.GEODATA="GeodataLayer"}(n||(n={})),n}),define("client.utils/routing",["general.controllers/route-controller","util"],function(e,t){"use strict";var n={getUrlForSheet:function(n,i,r){var o=["sheet",n,"state",i];return r&&o.splice(0,0,!0,"sense","app",t.getParameterByName("app")),e.buildUrl.apply(e,o)},goToOverview:function(){e.setUrl(e.buildUrl())},goToDataManager:function(t){e.setUrl(e.buildUrl(!0,"sense","app",t,"datamanager","datamanager"))},goToSheet:function(t,i){e.setUrl(n.getUrlForSheet(t,i,!1))},goToStory:function(t,n,i){var r=["story",t,"state",n];i&&r.push("slide",i),e.setUrl(e.buildUrl.apply(e,r))}};return n}),define("apis/qnavigation",["qvangular","client.utils/state","client.utils/routing"],function(e,t,n){"use strict";function i(){return d||(d=e.getService("$navigationService")),d}function r(){return i().Sheets.all.mashed}function o(){return i().Stories.all.mashed}function s(e){var n=t.model.id,i=-1;return e.forEach(function(e,t){e.qInfo.qId===n&&(i=t)}),i}function a(e,t){var n;return t.forEach(function(t){t.qInfo.qId===e&&(n=t)}),n}function l(e,t){var n;return t.forEach(function(t){t.qInfo.qId===e&&(n=t)}),n}function c(e){return n.goToSheet(e,Object.keys(t.States)[t.state]),{success:!0,sheetId:e}}function u(e){return n.goToStory(e,Object.keys(t.States)[t.States.play]),{success:!0,storyId:e}}function h(e,t,n){this.inClient=e,Object.defineProperties(this,{ANALYSIS:{get:function(){return"analysis"}},EDIT:{get:function(){return"edit"}},SNAPSHOT:{get:function(){return"snapshot"}},sheets:{get:function(){return e?r(this):t||[]}},stories:{get:function(){return e?o(this):n||[]}}})}var d;return h.prototype.gotoSheet=function(e){return a(e,this.sheets)?c(e):{success:!1,error:"NOSUCHSHEET",errorMsg:"No such sheet"}},h.prototype.nextSheet=function(){if((t.view===t.Views.sheet||t.view===t.Views.object)&&t.model){var e=s(this.sheets)+1;return c(this.sheets[e===this.sheets.length?0:e].qInfo.qId)}return{success:!1,error:"NOCURRENTSHEET",errorMsg:"No current sheet"}},h.prototype.prevSheet=function(){if((t.view===t.Views.sheet||t.view===t.Views.object)&&t.model){var e=s(this.sheets)-1;return c(this.sheets[e<0?this.sheets.length-1:e].qInfo.qId)}return{success:!1,error:"NOCURRENTSHEET",errorMsg:"No current sheet"}},h.prototype.getCurrentSheetId=function(){return t.view===t.Views.sheet&&t.model?{success:!0,sheetId:t.model.id}:{success:!1,error:"NOCURRENTSHEET",errorMsg:"No current sheet"}},h.prototype.getMode=function(){return Object.keys(t.States)[t.state]},h.prototype.setMode=function(e){return this.isModeAllowed(e)?(t.setState(t.States[e]),{success:!0,mode:e}):{success:!1,error:"MODENOTALLOWED",errorMsg:"Mode not allowed"}},h.prototype.isModeAllowed=function(e){switch(e){case this.ANALYSIS:return!0;case this.EDIT:return this.inClient&&t.model.layout&&t.model.layout.permissions&&t.model.layout.permissions.update;case this.SNAPSHOT:return this.inClient}return!1},h.prototype.gotoStory=function(e){return l(e,this.stories)?u(e):{success:!1,error:"NOSUCHSTORY",errorMsg:"No such story"}},h}),define("apis/qlik-visual",["apis/qapp"],function(e){"use strict";function t(t){var n=t.getAttribute("appid");if(n){var i=JSON.parse(t.getAttribute("config"));t.app=e.openApp(n,i)}else t.app=e.currApp()}function n(e){var n=e.getAttribute("visid"),i=JSON.parse(e.getAttribute("options"));if(e.app||t(e),e.app&&n)e.app.visualization.get(n).then(function(t){e.vis=t,i&&t.setOptions(i),t.show(e)});else if(e.app){var r=JSON.parse(e.getAttribute("cols")),o=e.getAttribute("type")||"barchart";e.app.visualization.create(o,r,i).then(function(t){e.vis=t,t.show(e)})}}function i(e){e.vis&&(e.vis.close(),delete e.vis)}var r=Object.create(HTMLElement.prototype);return r.attachedCallback=function(){n(this)},r.attributeChangedCallback=function(e,r,o){if("options"===e&&this.vis){var s=JSON.parse(o);this.vis.setOptions(s)}else i(this),"appid"!==e&&"config"!==e||t(this),n(this)},r.detachedCallback=function(){i(this)},r.init=function(){if(document.registerElement)try{document.registerElement("qlik-visual",{prototype:r})}catch(e){}},r}),define("text!assets/qlikui/custom-components/qui-button-icon/qui-button-icon.html",[],function(){return'<button class="{{className}}" ng-class="classes" ng-transclude></button>'}),define("assets/qlikui/custom-components/qui-button-icon/qui-button-icon",["qvangular","text!./qui-button-icon.html"],function(e,t){function n(e,t,n){e.className="qui-btn-icn"+(t?"-tgl":""),n&&(e.className+=" qui-active")}var i=13;e.component("quiButtonIcon",{template:t,scope:{icon:"@",active:"="},controller:["$scope","$element","$attrs",function(e,t,r){e.$watch("active",function(){n(e,r.hasOwnProperty("toggle"),e.active)}),t.on("keypress",function(e){e.keyCode===i&&t.trigger("qv-activate")})}]})}),define("text!assets/qlikui/custom-components/qui-button-outline-round/qui-button-outline-round.html",[],function(){return'<button class="{{className}}" ng-class="{\'qv-btn-outline-round-no-text\': !qvaButtonText && !qvaButtonPreIconText, \'qv-btn-outline-round-with-text\':  qvaButtonText || qvaButtonPreIconText}">\n\t<div class="qv-btn-outline-round-flex">\n\t\t<div ng-if="qvaButtonPreIconText" ng-class="{\'qv-btn-outline-round-icon-right\': classIcon}" class="qv-btn-outline-round-text">{{qvaButtonPreIconText}}</div>\n\t\t<i class="outline-icon {{ classIcon }}"></i>\n\t\t<div ng-if="qvaButtonText" ng-class="{\'qv-btn-outline-round-icon-left\': classIcon}" class="qv-btn-outline-round-text" q-translation="{{qvaButtonText}}"></div>\n\t</div>\n</button>\n'}),define("assets/qlikui/custom-components/qui-button-outline-round/qui-button-outline-round",["qvangular","text!./qui-button-outline-round.html"],function(e,t){e.component("quiButtonOutlineRound",{template:t,scope:{classIcon:"@",qvaButtonText:"@",qvaButtonPreIconText:"="},controller:["$scope","$attrs",function(e,t){e.className="qv-btn-outline-round",t.hasOwnProperty("light")&&(e.className+=" qv-btn-outline-round-light"),e.$watch("classIcon",function(t){e.classIcon=t})}]})}),define("text!assets/qlikui/custom-components/qui-dialog-default/qui-dialog-default.html",[],function(){return'<div class="qui-delayedModal delayedModal qui-delayedmodal" ng-transclude>\n\t\x3c!-- This will be replaced by ng-transclude --\x3e\n</div>\n'}),define("assets/qlikui/custom-components/qui-dialog-default/qui-dialog-default",["qvangular","text!./qui-dialog-default.html"],function(e,t){e.component("quiDialogDefault",{template:t})}),define("text!assets/qlikui/custom-components/qui-dialog-pleasewait/qui-dialog-pleasewait.html",[],function(){return'<div>\n\t<qui-dialog-default>\n\t\t<header class="dm-header" q-translation="Common.PleaseWait">#Working#</header>\n\t\t<main class="dm-main">\n\t\t\t<p class="qui-pleasewaitdialog-loader-container"><img src="../resources/img/core/loader.svg"/></p>\n\n\t\t\t<p class="qui-pleasewaitdialog-pleasewait" q-translation="Common.PleaseWait"></p>\n\t\t</main>\n\t\t<footer class="dm-footer">\n\t\t</footer>\n\t</qui-dialog-default>\n</div>\n'}),define("assets/qlikui/custom-components/qui-dialog-pleasewait/qui-dialog-pleasewait",["qvangular","text!./qui-dialog-pleasewait.html"],function(e,t){e.component("quiDialogPleasewait",{template:t})}),define("text!assets/qlikui/custom-components/qui-filter/qui-filter.ng.html",[],function(){return'<div class="button-div qui-filter lui-buttongroup">\n\t<lui-button qva-activate="toggleAscDesc()"\n\t\t\t\tclass="asc-desc"\n\t\t\t\ttitle="{{sortTitle | translate}}">\n\t\t<span class="lui-icon  lui-button__icon" ng-class="isAscending ? \'lui-icon--ascending\' : \'lui-icon--descending\'"></span>\n\t</lui-button>\n\n\t<lui-button disabled="disabled"\n\t\t\t\tng-if="sections.length <= 1"\n\t\t\t\tclass="sort-filter"\n\t\t\t\ttitle="{{ sortOptTitle | translate }}">\n\t\t<span class="lui-button__text">\n\t\t\t{{ $parent.sections[0].text || "Common.SortByAlphabetical" | translate }}\n\t\t</span>\n\t\t<span class="lui-caret  lui-button__caret"></span>\n\t</lui-button>\n\n\t<lui-select ng-if="sections.length > 1"\n\t\t\t\tclass="sort-filter"\n\t\t\t\tx-model="$parent.selectedFltr"\n\t\t\t\tx-options="option.value as option.text | translate for option in sections"\n\t\t\t\ttitle="{{sortOptTitle | translate}}"></lui-select>\n</div>\n'}),define("assets/qlikui/custom-components/qui-filter/qui-filter",["qvangular","text!./qui-filter.ng.html"],function(e,t){e.component("quiFilter",{template:t,scope:{isAscending:"=",sections:"=",selectedFltr:"=",toggleAscDesc:"&",sortTitle:"@",sortOptTitle:"@"}})}),define("text!assets/qlikui/custom-components/qui-float/qui-float.html",[],function(){return'<div class="qui-float" ng-style="{top:top, left:left}" ng-show="visible" qva-reported-window-size="reportedWindowSize">\n\t<div ng-transclude></div>\n</div>\n'}),define("assets/qlikui/custom-components/qui-float/qui-float",["qvangular","text!./qui-float.html"],function(e,t){e.component("quiFloat",{transclude:!0,template:t,scope:{quiOffset:"=",quiResizeOnChange:"="},controller:["$scope","$element","$timeout",function(e,t,n){e.$watch("quiResizeOnChange",function(){n(function(){e.reportedSize={width:t.outerWidth(),height:t.outerHeight()}})},!0),e.$watch("[quiOffset, reportedSize, reportedWindowSize]",function(){e.quiOffset&&e.reportedSize&&e.reportedWindowSize?(e.quiOffset.left+e.reportedSize.width<e.reportedWindowSize.width?e.left=e.quiOffset.left:e.left=e.reportedWindowSize.width-e.reportedSize.width,e.quiOffset.top+e.reportedSize.height<e.reportedWindowSize.height?e.top=e.quiOffset.top:e.top=e.reportedWindowSize.height-e.reportedSize.height,e.visible=!0):e.visible=!1},!0)}]})}),define("assets/qlikui/custom-components/qui-input-number/numerical-interval-transformer",[],function(){function e(e){return Number(String(e).replace(/[^-\d]/g,""))}return{getNumerical:function(t,n,i){return t=e(t),n=Number(n),i=Number(i),t<n?n:0!==i&&t>i?i:t}}}),define("text!assets/qlikui/custom-components/qui-input-number/qui-input-number.ng.html",[],function(){return'<span class="qui-input-number lui-input-group">\n\t<button class="lui-input-group__item  lui-input-group__button  lui-button" qva-activate="onChange(-1)" ng-disabled="quiDisabled" ng-if="quiWithButtons">\n\t\t<span class="lui-button__icon">-</span>\n\t</button>\n\t<input type="tel" class="lui-input-group__item  lui-input-group__input  lui-input {{quiClass}}" tid="{{quiTid}}" title="{{quiTitle}}" ng-model="quiModel" ng-model-options="{ updateOn: \'blur\' }" ng-change="onChange()" ng-disabled="quiDisabled"/>\n\t<button class="lui-input-group__item  lui-input-group__button  lui-button" qva-activate="onChange(1)" ng-disabled="quiDisabled" ng-if="quiWithButtons">\n\t\t<span class="lui-button__icon">+</span>\n\t</button>\n</span>\n'}),define("assets/qlikui/custom-components/qui-input-number/qui-input-number",["qvangular","./numerical-interval-transformer","text!./qui-input-number.ng.html"],function(e,t,n){e.component("quiInputNumber",{template:n,scope:{quiModel:"=",quiDisabled:"=",quiTitle:"@",quiMin:"@",quiMax:"@",quiClass:"@",quiSelectTextOnFocus:"@",quiWithButtons:"@",quiTid:"@"},controller:["$scope","$element",function(e,n){e.quiSelectTextOnFocus&&(e.selected=!1,n.click(function(){!1===e.selected&&(n.select(),e.selected=!0)}),n.blur(function(){e.selected=!1})),e.onChange=function(i){var r=parseInt(i)||0;e.quiModel=t.getNumerical(parseInt(n.find(".lui-input").val())+r,e.quiMin,e.quiMax)}}]})}),define("text!assets/qlikui/custom-components/qv-popover-button/qv-popover-button.ng.html",[],function(){return'<button\n\t\ttid="{{quiModel.tid}}"\n\t\tng-disabled="quiModel.isDisabled()"\n\t\tng-class="[quiModel.buttonClass, quiModel.buttonVariant, {\'lui-active\': shared.pressed }]"\n\t\tq-title-translation="{{currentTitle}}"\n\t\tqva-outside-ignore-for="{{quiModel.tid}}"\n\t\tng-click="onClick()">\n\t<span class="{{quiModel.buttonClass}}__icon lui-icon  lui-icon--{{quiModel.icon}}  {{quiModel.menuOptions.smallview ? \'lui-icon--large\' : \'\'}}"></span>\n\t<span class="{{quiModel.buttonClass}}__text" ng-if="quiModel.buttonText">\n\t\t{{quiModel.buttonText}}\n\t</span>\n\t<span ng-if="!quiModel.hideCaret" class="{{quiModel.buttonClass}}__caret  lui-caret"></span>\n</button>\n'}),define("text!assets/qlikui/custom-components/qv-popover-button/qv-popover-button-menu.ng.html",[],function(){return'<lui-popover ng-style="{ width: quiModel.menuOptions.width }">\n\t<ul ng-class="menuClasses" tid="{{quiModel.menuOptions.content.tid}}">\n\t\t<li class="lui-list__item"\n\t\t\tng-repeat="menuItem in menuItems"\n\t\t\tng-class="{\'open-in-new-tab-always\': menuItem.openInNewTab == \'always\', \'lui-disabled\': menuItem.disable}"\n\t\t\tng-hide="menuItem.hide">\n\t\t\t<button tid="{{menuItem.tid}}"\n\t\t\t\t class="action-item"\n\t\t\t\t ng-click="selectMenuItem(menuItem, $event)"\n\t\t\t\t q-title-translation="{{ menuItem.title || menuItem.text}}"\n\t\t\t\t ng-disabled="menuItem.disable">\n\t\t\t\t<span ng-if="menuItem.icon"\tclass="lui-list__aside">\n\t\t\t\t\t<span class="lui-icon  lui-icon--{{menuItem.icon}}" ng-disabled="menuItem.disable"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class="lui-list__text menu-item-text"\n\t\t\t\t\t  q-translation="{{menuItem.text}}"\n\t\t\t\t\t  ng-class="{\'open-in-new-tab-text-optional\': menuItem.openInNewTab == \'optional\', \'open-in-new-tab-always\': menuItem.openInNewTab == \'always\'}">\n\t\t\t\t</span>\n\t\t\t</button>\n\t\t\t<div class="list-divider" ng-if="menuItem.openInNewTab === \'optional\'"></div>\n\t\t\t<button ng-if="menuItem.openInNewTab" class="lui-fade-button"\n\t\t\t\t\tq-title-translation="{{ menuItem.title || \'Tooltip.OpenInNewTab\'}}"\n\t\t\t\t\tng-click="selectMenuItem(menuItem, $event, \'true\')"\n\t\t\t\t\tng-disabled="menuItem.disable">\n\t\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--new-tab"></span>\n\t\t\t</button>\n\t\t</li>\n\t</ul>\n</lui-popover>\n'}),define("assets/qlikui/custom-components/qv-popover-button/qv-popover-button",["jquery","assets/qvangular/qvangular-core","text!./qv-popover-button.ng.html","text!./qv-popover-button-menu.ng.html"],function(e,t,n,i){function r(e){return e.parents(".popover-container").length?e.parents(".popover-container")[0]:null}function o(t,n,i){return t.which===s.TAB&&t.target!==n.alignTo&&e(t.target).closest(".lui-popover-container")[0]!==i[0]}var s={TAB:9},a={template:i,scope:{quiModel:"=",shared:"=",close:"="},controller:["$scope","$element","$document",function(e,t,n){e.menuClasses=e.quiModel.menuOptions.content.menuClasses?e.quiModel.menuOptions.content.menuClasses:"qui-textlist",e.quiModel.menuOptions.content.createMenuItems().then(function(t){e.menuItems=t}),e.selectMenuItem=function(t,n,i){n&&n.preventDefault&&n.preventDefault(),t.disable||(e.close&&e.close(),t.selected(n,i))},n.on("keyup.qv-popover",function(n){r(t)&&o(n,e,t)&&e.close&&e.close()}),e.$on("$destroy",function(){n.off("keyup.qv-popover")})}]};t.directive("qvPopoverButton",function(){return{template:n,transclude:!0,replace:!0,restrict:"E",scope:{quiModel:"=",quiPopoverContainer:"=?"},controller:["$scope","$element","luiPopover",function(e,t,n){var i;e.shared={pressed:!1},e.onClick=function(){e.shared.pressed&&i?i.close():(e.shared.pressed=!e.shared.pressed,(i=n.show({controller:a.controller,template:a.template,dock:"bottom",alignTo:t[0],autoFocus:!1,closeOnResize:!0,outsideIgnore:e.quiModel.tid,container:r(t),input:{quiModel:e.quiModel,shared:e.shared,close:function(){i.close()}}})).closed.then(function(){e.shared.pressed=!1}))},e.$watch("shared.pressed",function(t){e.currentTitle=t&&e.quiModel.tooltipActive?e.quiModel.tooltipActive:e.quiModel.tooltipInactive})}]}})}),define("text!assets/qlikui/custom-components/qui-popover-button/qui-popover-button.ng.html",[],function(){return'<button\n\t\ttid="{{quiModel.tid}}"\n\t\tng-disabled="quiModel.isDisabled()"\n\t\tng-class="[quiModel.buttonClass, quiModel.buttonVariant, {\'lui-active\': shared.pressed }]"\n\t\tq-title-translation="{{currentTitle}}"\n\t\tqva-outside-ignore-for="{{quiModel.tid}}"\n\t\tng-click="onClick()">\n\t<span class="{{quiModel.buttonClass}}__icon lui-icon  lui-icon--{{quiModel.icon}}  {{quiModel.menuOptions.smallview ? \'lui-icon--large\' : \'\'}}"></span>\n\t<span class="{{quiModel.buttonClass}}__text" ng-if="quiModel.buttonText">\n\t\t{{quiModel.buttonText}}\n\t</span>\n\t<span ng-if="!quiModel.hideCaret" class="{{quiModel.buttonClass}}__caret  lui-caret"></span>\n</button>\n'}),define("text!assets/qlikui/custom-components/qui-popover-button/qui-popover-button-menu.ng.html",[],function(){return'<immidiate-contextual align-to="alignTo"\n\t\t\t\t\t  smallview="quiModel.menuOptions.smallview"\n\t\t\t\t\t  position="quiModel.menuOptions.position"\n\t\t\t\t\t  width="quiModel.menuOptions.width"\n\t\t\t\t\t  top="quiModel.menuOptions.top"\n\t\t\t\t\t  lui-style="true"\n\t\t\t\t\t  no-padding="true"\n\t\t\t\t\t  hidepointer="quiModel.menuOptions.hidepointer"\n\t\t\t\t\t\tqva-outside-ignore-for="{{quiModel.tid}}"\n\t\t\t\t\t  on-close-view="onClose(event)">\n\t<ul ng-class="menuClasses" tid="{{quiModel.menuOptions.content.tid}}">\n\t\t<li class="lui-list__item" ng-repeat="menuItem in menuItems" ng-disabled="menuItem.disable" qui-click=\'menuItem.fn()\'\n\t\t\tng-class="{\'open-in-new-tab-always\': menuItem.openInNewTab == \'always\'}" ng-hide="menuItem.hide">\n\t\t\t<span ng-if="menuItem.icon" class="lui-list__aside">\n\t\t\t\t<span class="lui-icon  lui-icon--{{menuItem.icon}}"></span>\n\t\t\t</span>\n\t\t\t<span class="lui-list__text menu-item-text"\n\t\t\t\t  tid="{{menuItem.tid}}"\n\t\t\t\t  q-title-translation="{{ menuItem.title || menuItem.text}}"\n\t\t\t\t  ng-class="{\'open-in-new-tab-text-optional\': menuItem.openInNewTab == \'optional\', \'open-in-new-tab-always\': menuItem.openInNewTab == \'always\'}"\n\t\t\t\t  qva-activate="selectMenuItem(menuItem, $event)" q-translation="{{menuItem.text}}" ng-disabled="menuItem.disable">\n\t\t\t</span>\n\t\t\t<div class="list-divider" ng-if="menuItem.openInNewTab === \'optional\'"></div>\n\t\t\t<button ng-if="menuItem.openInNewTab" class="lui-fade-button  open-in-new-tab" ng-class="{\'open-in-new-tab-always\': menuItem.openInNewTab == \'always\'}" q-title-translation="{{ menuItem.title || \'Tooltip.OpenInNewTab\'}}" qva-activate="selectMenuItem(menuItem, $event, \'true\')" ng-disabled="menuItem.disable">\n\t\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--new-tab"></span>\n\t\t\t</button>\n\t\t</li>\n\t</ul>\n</immidiate-contextual>\n'}),define("assets/qlikui/custom-components/qui-popover-button/qui-popover-button",["assets/qvangular/qvangular-core","jquery","text!./qui-popover-button.ng.html","text!./qui-popover-button-menu.ng.html","general.services/show-service/show-service","core.utils/resize","general.components/immidiate-contextual/immidiate-contextual"],function(e,t,n,i,r,o){var s={template:i,scope:{quiModel:"=",alignTo:"=",shared:"="},controller:["$scope",function(e){e.shared.destroyComponent=e.destroyComponent,e.menuClasses=e.quiModel.menuOptions.content.menuClasses?e.quiModel.menuOptions.content.menuClasses:"qui-textlist",e.quiModel.menuOptions.content.createMenuItems().then(function(t){e.menuItems=t}),e.selectMenuItem=function(t,n,i){n&&n.preventDefault&&n.preventDefault(),t.disable||(e.onClose&&e.onClose(n),t.selected(n,i))},e.onClose=function(n){t(n.target).hasClass("qui-popover-button")&&e.quiModel.tid===t(n.target).attr("tid")||(e.destroyComponent(),e.shared.pressed=!1)},e.closeFromContent=function(){e.destroyComponent(),e.shared.pressed=!1},e.$on("$destroy",function(){o.off("start",e.onClose)}),o.on("start",e.onClose)}]};e.directive("quiPopoverButton",function(){return{template:n,transclude:!0,replace:!0,restrict:"E",scope:{quiModel:"=",quiPopoverContainer:"=?"},controller:["$scope","$element",function(e,t){var n={ENTER:13,SPACE:32};e.shared={},e.shared.pressed=!1,e.$watch("shared.pressed",function(t){e.currentTitle=t&&e.quiModel.tooltipActive?e.quiModel.tooltipActive:e.quiModel.tooltipInactive}),t.on("keypress",function(t){t.keyCode!==n.ENTER&&t.keyCode!==n.SPACE||e.onClick()}),e.onClick=function(){e.shared.pressed?e.shared.destroyComponent&&(e.shared.destroyComponent(),e.shared.pressed=!1):(e.shared.pressed=!0,r.show(e.quiPopoverContainer||s,{quiModel:e.quiModel,alignTo:t,shared:e.shared}))},e.quiModel&&(e.quiModel.forceClick=e.onClick)}]}})}),define("text!assets/qlikui/custom-components/qui-toolbar/qui-app-info.ng.html",[],function(){return'<section class="qv-app-info-holder">\n\t<button class="lui-fade-button app-info-click-area has-app-details"\n\t\t\tng-if="quiModel.hasAppDetails()"\n\t\t\tng-click="quiModel.onButton()"\n\t\t\tdata-tid="toggle-app-details"\n\t\t\tq-title-translation="{{quiModel.tooltip()}}">\n\t\t<span class="app-info-icon lui-icon  lui-icon--more-rounded"></span>\n\t\t<span class="app-read-only" ng-if="quiModel.readOnly"><i class="lui-icon lui-icon--lock" q-title-translation="Hub.App.ReadOnly"></i>&nbsp;</span>\n\t\t<span class="app-title" data-tid="toolbar-app-title">{{quiModel.appTitle}}</span>\n\t</button>\n\t<div class="app-info-click-area"\n\t\t ng-if="!quiModel.hasAppDetails()"\n\t\t q-title-translation="{{quiModel.tooltip()}}">\n\t\t<span class="app-read-only" ng-if="quiModel.readOnly"><i class="lui-icon lui-icon--lock" q-title-translation="Hub.App.ReadOnly"></i>&nbsp;</span>\n\t\t<h1 class="app-title" data-tid="toolbar-app-title">{{quiModel.appTitle}}</h1>\n\t</div>\n</section>\n'}),define("text!assets/qlikui/custom-components/qui-toolbar/qui-toolbar-button.ng.html",[],function(){return'<button\n\t\ttid="{{quiModel.tid}}"\n\t\tng-click="onButton($event)"\n\t\tng-mousedown="onMouseDown()"\n\t\tqva-outside-ignore-for="{{quiModel.name}}"\n\t\tq-title-translation="{{(quiModel.pressed && quiModel.tooltipActive ? quiModel.tooltipActive : quiModel.tooltipInactive)}}"\n\t\tng-disabled="quiModel.isDisabled()"\n\t\tng-hide="quiModel.isHidden()"\n\t\tclass="lui-button"\n\t\ttext-inactive="{{quiModel.textInactive ? quiModel.textInactive : \'\'}}"\n\t\tng-class="classList">\n\t<span\n\t\tqva-outside-ignore-for="{{quiModel.name}}"\n\t\tng-if="quiModel.icon && quiModel.iconToTheLeft"\n\t\tclass="lui-button__icon  lui-icon  lui-icon--{{quiModel.icon}}"\n\t></span>\n\t<span\n\t\tqva-outside-ignore-for="{{quiModel.name}}"\n\t\tng-if="!quiModel.dynamicText && quiModel.showText()"\n\t\tclass="lui-button__text  item-title"\n\t\tqva-direction\n\t\tx-dir-text="{{(quiModel.pressed && quiModel.textActive ? quiModel.textActive : quiModel.textInactive) | translate}}"\n\t>\n\t\t{{(quiModel.pressed && quiModel.textActive ? quiModel.textActive : quiModel.textInactive) | translate}}\n\t</span>\n\t<span\n\t\tqva-outside-ignore-for="{{quiModel.name}}"\n\t\tng-if="quiModel.icon && !quiModel.iconToTheLeft"\n\t\tclass="lui-button__icon  lui-icon  lui-icon--{{quiModel.icon}}"\n\t></span>\n\t<span\n\t\tqva-outside-ignore-for="{{quiModel.name}}"\n\t\tng-if="!quiModel.dynamicText && !quiModel.textOnly && quiModel.isDropdownButton"\n\t\tclass="lui-button__caret  lui-caret"\n\t></span>\n\t<span class="lui-button__text" qva-outside-ignore-for="{{quiModel.name}}" ng-if="quiModel.dynamicText">\n\t\t{{ quiModel.dynamicText() }}\n\t</span>\n</button>\n'}),define("text!assets/qlikui/custom-components/qui-toolbar/qui-toolbar-mobile-button.ng.html",[],function(){return'<button\n\t\ttid="{{quiModel.tid}}"\n\t\tng-click="onButton($event)"\n\t\tqva-outside-ignore-for="{{quiModel.name}}"\n\t\tq-title-translation="{{(quiModel.pressed && quiModel.tooltipActive ? quiModel.tooltipActive : quiModel.tooltipInactive)}}"\n\t\tng-disabled="quiModel.isDisabled()"\n\t\tng-hide="quiModel.isHidden()"\n\t\tclass="lui-fade-button lui-fade-button--large lui-fade-button--inverse"\n\t\tng-class="{ \'lui-active\': quiModel.pressed }">\n\t<span qva-outside-ignore-for="{{quiModel.name}}" ng-if="!quiModel.dynamicText && quiModel.showText()"\n\t\tclass="lui-fade-button__text  item-title"\n\t\tqva-direction\n\t\tx-dir-text="{{(quiModel.pressed && quiModel.textActive ? quiModel.textActive : quiModel.textInactive) | translate}}">\n\t\t{{(quiModel.pressed && quiModel.textActive ? quiModel.textActive : quiModel.textInactive) | translate}}\n\t</span>\n\t<span\n\t\tqva-outside-ignore-for="{{quiModel.name}}"\n\t\tng-if="!quiModel.dynamicText && !quiModel.textOnly"\n\t\tclass="lui-fade-button__icon  lui-icon  lui-icon--large  lui-icon--{{quiModel.icon}}"></span>\n\t<span\n\t\tqva-outside-ignore-for="{{quiModel.name}}"\n\t\tclass="lui-fade-button__text"\n\t\tng-if="quiModel.dynamicText">{{ quiModel.dynamicText() }}</span>\n</button>\n'}),define("text!assets/qlikui/custom-components/qui-toolbar/qui-toolbar-tab-nav.ng.html",[],function(){return'<div class="qv-navigation-tab">\n\t<div class="tab title" ng-click="$ctrl.navigator.navigateToDataManager()" ng-class="{\'selected\': $ctrl.navState.InDataManager}" ng-bind="\'Data\'"></div>\n\t<div class="tab title" ng-click="$ctrl.navigator.navigateToSheetsView()" ng-class="{\'selected\': $ctrl.navState.InSheetView}" ng-bind="\'Analysis\'"></div>\n\t<div class="tab title" ng-click="$ctrl.navigator.navigateToStories()"  ng-class="{\'selected\': $ctrl.navState.InStorytelling}" ng-bind="\'Story\'"></div>\n</div>\n'}),define("assets/qlikui/custom-components/qui-toolbar/qui-toolbar",["jquery","qvangular","text!./qui-app-info.ng.html","text!./qui-toolbar-button.ng.html","text!./qui-toolbar-mobile-button.ng.html","text!./qui-toolbar-tab-nav.ng.html"],function(e,t,n,i,r,o){t.component("quiToolbar",{template:"<div class='qui-toolbar' ng-transclude />"}),t.component("quiToolbarLeft",{template:"<div class='qui-buttonset-left' ng-transclude />"}),t.component("quiToolbarRight",{template:"<div class='qui-buttonset-right' ng-transclude />"}),t.component("quiToolbarButtonGroup",{template:"<div class='lui-buttongroup' ng-transclude />"}),t.component("quiToolbarAppInfo",{template:n,scope:{quiModel:"="}}),t.nativeComponent("quiToolbarTabNavigation",{template:o,bindings:{navState:"<",navigator:"<"}}),t.component("quiToolbarButton",{template:i,scope:{quiModel:"="},controller:["$scope",function(t){function n(){var e=[],n=t.quiModel;n.pressed?n.activeVariant?e.push(n.activeVariant):e.push("lui-active"):n.variant?e.push(n.variant):e.push("lui-button--toolbar"),t.classList=e}t.isMouseDown=!1,t.onMouseDown=function(){t.isMouseDown=!0},t.onButton=function(n){e.support.touch&&n.target.focus(),t.quiModel.isToggleButton&&(t.quiModel.pressed=!t.quiModel.pressed),t.quiModel.isOpenedByClick=t.isMouseDown,t.isMouseDown=!1,t.quiModel.onButtonClicked(t.quiModel,n)},t.$watch("quiModel.pressed",n),t.$watch("quiModel.variant",n),t.$watch("quiModel.activeVariant",n),n()}]}),t.component("quiToolbarMobileButton",{template:r,scope:{quiModel:"="},controller:["$scope",function(t){t.onButton=function(n){e.support.touch&&n.target.focus(),t.quiModel.isToggleButton&&(t.quiModel.pressed=!t.quiModel.pressed),t.quiModel.onButtonClicked(t.quiModel,n)}}]})}),define("assets/qlikui/custom-components",["assets/qlikui/custom-components/qui-button-icon/qui-button-icon","assets/qlikui/custom-components/qui-button-outline-round/qui-button-outline-round","assets/qlikui/custom-components/qui-dialog-default/qui-dialog-default","assets/qlikui/custom-components/qui-dialog-pleasewait/qui-dialog-pleasewait","assets/qlikui/custom-components/qui-filter/qui-filter","assets/qlikui/custom-components/qui-float/qui-float","assets/qlikui/custom-components/qui-input-number/qui-input-number","assets/qlikui/custom-components/qv-popover-button/qv-popover-button","assets/qlikui/custom-components/qui-popover-button/qui-popover-button","assets/qlikui/custom-components/qui-toolbar/qui-toolbar"],function(){}),define("general.utils/qv-activate",["jquery","touche","jqueryoutside"],function(e,t){function n(t,n,i){return e.Event(t,{pageX:i.pagePoints[0].x,pageY:i.pagePoints[0].y,ctrlKey:n.ctrlKey,metaKey:n.metaKey,shiftKey:n.shiftKey,originalEvent:n,gestureData:i})}var i;t(document.body).tap({options:{preventDefault:!1},start:function(t){i=e(t.target)},end:function(e,t){var r=n("qv-activate",e,t);0===i.closest(":disabled").length&&i.trigger(r),i=null}});var r=t.Gesture.augment(function(e){return this.defaults={precedence:6},this.start=function(e,t){this.binder.start.call(this,e,t)},function(){e.apply(this,arguments)}});t.gestures.add("press",r),t(document.body).press({start:function(t,i){var r=n("qv-press",t,i);e(t.target).trigger(r)}}),e.addOutsideEvent("qv-press","qv-outside","touchstart","touchend")}),define("general.utils/qv-swipe",["jquery","touche"],function(e,t){function n(t,n,i){return e.Event(t,{pageX:i.pagePoints[0].x,pageY:i.pagePoints[0].y,ctrlKey:n.ctrlKey,shiftKey:n.shiftKey,originalEvent:n,gestureData:i})}function i(){function e(){document.removeEventListener("mousedown",t,!0),document.removeEventListener("mousemove",n,!0),document.removeEventListener("mouseup",i,!0)}function t(e){e.preventDefault(),e.stopPropagation()}function n(e){e.preventDefault(),e.stopPropagation()}function i(t){t.preventDefault(),t.stopPropagation(),e(),clearTimeout(r)}var r;document.addEventListener("mousedown",t,!0),document.addEventListener("mousemove",n,!0),document.addEventListener("mouseup",i,!0),r=setTimeout(e,350)}var r;t(document.body).tap({options:{preventDefault:!1},start:function(t){r=e(t.target)}}),t(document.body).swipe({options:{preventDefault:!1,radiusThreshold:8},start:function(e,t){var i=n("qv-swipestart",e,t);r.trigger(i)},update:function(e,t){var i=n("qv-swipeupdate",e,t);r.trigger(i)},cancel:function(){var t=e.Event("qv-swipecancel");r.trigger(t)},end:function(e,o){t.utils.isMouse(e)||i();var s=n("qv-swipe",e,o);r.trigger(s)}})}),define("general.utils/qv-longtapswipe",["jquery","touche"],function(e,t){"use strict";var n=t.Gesture.augment(function(n){function i(){function e(){document.removeEventListener("mousedown",t,!0),document.removeEventListener("mousemove",n,!0),document.removeEventListener("mouseup",i,!0)}function t(e){e.preventDefault(),e.stopPropagation()}function n(e){e.preventDefault(),e.stopPropagation()}function i(t){t.preventDefault(),t.stopPropagation(),e(),clearTimeout(r)}var r;document.addEventListener("mousedown",t,!0),document.addEventListener("mousemove",n,!0),document.addEventListener("mouseup",i,!0),r=setTimeout(e,350)}var r=!1;return this.defaults={radiusThreshold:10,timeThreshold:510,touches:1,precedence:4,preventDefault:!1,which:1,interval:10},this.on=function(e){this.count=0,t(e).longtap({id:this.id,options:{precedence:this.options.precedence,preventDefault:this.options.preventDefault,touches:this.options.touches,which:this.options.which,areaThreshold:this.options.areaThreshold,timeThreshold:this.options.timeThreshold,interval:this.options.interval},start:this.longtapStart.bind(this),update:this.longtapUpdate.bind(this),cancel:this.longtapCancel.bind(this),end:this.longtapEnd.bind(this)}).swipe({id:this.id,options:{precedence:this.options.precedence+1,preventDefault:this.options.preventDefault,radiusThreshold:this.options.radiusThreshold,touches:this.options.touches},start:this.swipeStart.bind(this),update:this.swipeUpdate.bind(this),end:this.swipeEnd.bind(this),cancel:this.swipeCancel.bind(this)})},this.off=function(e){t(e).off("longtap",this.id),t(e).off("swipe",this.id)},this.longtapStart=function(){r=!1},this.longtapUpdate=function(e,t){100===t.percentage&&(r=!0)},this.longtapEnd=function(){this.binder.cancel()},this.longtapCancel=function(){r||this.binder.cancel()},this.swipeStart=function(t,n){var i=e(t.target).is("input, textarea");r&&!i?this.binder.start(t,n):r&&i&&(r=!1)},this.swipeUpdate=function(e,t){r&&this.binder.update(e,t)},this.swipeEnd=function(e,t){r&&(i(),this.binder.end(e,t),r=!1)},this.swipeCancel=function(){r=!1,this.binder.cancel()},function(){n.apply(this,arguments)}});t.gestures.add("longtapswipe",n)}),define("text!client.views/odag-toolbar/odag-toolbar.ng.html",[],function(){return'<div class="qv-odag-bar" ng-class="{\'inEditMode\': inEditMode, \'inAnalysisMode\': !inEditMode, \'standAlone\': standAlone }">\n\t<div class="leftOdag" qv-pager qv-sortable-list="sortableNavPoints"> \n\t\t<div ng-if="odagNavPoints.items.length === 0" class="drag-help" ng-class="{\'inEditMode\': inEditMode}">{{waterMarkText}}</div>\n\t\t<ul class="list">\n\t\t\t<li ng-repeat="item in odagNavPoints.items track by item.id" class="odag-nav-point" ng-class="item.classList">\n\t\t\t\t<div class="nav-point-container" ng-class="{\'invalid\': item.invalid }">\n\t\t\t\t\t<div ng-if="inEditMode" class="dropArea"></div>\n\t\t\t\t\t<qv-odag-toolbar-navpoint item="item" in-edit-mode="inEditMode"></qv-odag-toolbar-navpoint>\n\t\t\t\t</div>\n\t\t\t</li> \n\t\t</ul>\n\t\t<a class="qv-pager-nav qv-pager-previous" ng-click="prevPage()" q-title-translation="Tooltip.Previous"><i class="lui-icon lui-icon--arrow-left"></i></a>\n\t\t<a class="qv-pager-nav qv-pager-next" ng-click="nextPage()" q-title-translation="Tooltip.Next"><i class="lui-icon lui-icon--arrow-right"></i></a>\t\t\n\t</div>\n </div>\t\n'}),define("general.sortable/sortable-list-constants",[],function(){var e={};return Object.defineProperties(e,{ENTER_BEFORE:{value:0},ENTER_AFTER:{value:1},ENTER_SWAP:{value:2},TYPEFLAG_PLACEHOLDER:{value:16},TYPEFLAG_LOCKED:{value:32}}),e}),define("general.sortable/sortable-list-service",["jquery","qvangular","general.sortable/sortable-list-constants"],function(e,t,n){"use strict";t.service("qvSortableListDragService",[function(){var t;return t={$new:function(e){return{fromItem:void 0,enterItem:void 0,enterList:void 0,toItem:void 0,toList:void 0,offsetX:0,offsetY:0,left:0,top:0,direction:void 0,clientRect:void 0,scroll:{},pageX:0,pageY:0,zIndex:e.zIndex,enterItemAction:void 0}},startOffset:function(e,t,n,i){var r=n.offsetParent(),o=n.position();t.left=o.left+r[0].scrollLeft,t.top=o.top+r[0].scrollTop,t.offsetX=t.left-i.x-r[0].scrollLeft,t.offsetY=t.top-i.y-r[0].scrollTop},startData:function(e,t,n,i){t.scroll.clientRect=e[0].getBoundingClientRect(),t.scroll.width=e[0].scrollWidth,t.scroll.height=e[0].scrollHeight,t.clientRect=n[0].getBoundingClientRect(),t.minLeft=-t.clientRect.width,t.maxLeft=t.scroll.width,t.minTop=-t.clientRect.height,t.maxTop=t.scroll.height-t.clientRect.height,t.fromItem=n.scope()[i],t.toItem=void 0,t.toList=void 0,t.enterItem=void 0,t.enterList=void 0,t.enterItemAction=void 0},updateDragCoordinates:function(e,t,n,i){i=i||e.scroll.clientRect,e.pageX=t,e.pageY=n,e.pageX<=i.left?e.pageX=i.left+1:e.pageX>=i.left+i.width&&(e.pageX=i.left+i.width-1),e.pageY<=i.top?e.pageY=i.top+1:e.pageY>=i.top+i.height&&(e.pageY=i.top+i.height-1)},updateEnterItemAction:function(e,t){var i,r,o,s=t[0].getBoundingClientRect();switch(e.direction){case"horizontal":i=e.pageX,r=s.left,o=s.width;break;case"vertical":i=e.pageY,r=s.top,o=s.height;break;default:return}i<=r+.5*o?e.enterItemAction=n.ENTER_BEFORE:i>r+.5*o&&(e.enterItemAction=n.ENTER_AFTER)},updateData:function(n,i,r,o,s,a,l,c,u){function h(e){return e.length&&t.isChild(n[0],e[0])}function d(e){return"function"==typeof s?s(e):e.scope()[s]}var p,f,m,g,v=i.enterItemAction,y=function(){},b=r[0].style.display;r[0].style.display="none",f=document.elementFromPoint(i.pageX,i.pageY),h(p=e(f).closest(a))?y=function(e){m=e.scope()[l],t.updateEnterItemAction(i,e),(i.enterItem!==m||i.enterItem===m&&v!==i.enterItemAction)&&(i.enterList=void 0,i.enterItem=m,c())}:h(p=e(f).closest(o))?y=function(e){g=d(e),i.enterList!==g&&(i.enterList=g,i.enterItem=void 0,u())}:(i.enterItem=void 0,i.enterList=void 0),r[0].style.display=b,y(p)},start:function(e,t,n){n[0].style||(n[0].style=""),n[0].style.position="absolute",n[0].style.width=t.clientRect.width+"px",n[0].style.height=t.clientRect.height+"px",n[0].style.pointerEvents="none",n[0].style.left=t.left+"px",n[0].style.top=t.top+"px",n[0].style.zIndex=t.zIndex},update:function(e,t,n,i){var r,o;switch(t.direction){case"horizontal":t.left=i.currentPoint.x+t.offsetX+e[0].scrollLeft;break;case"vertical":t.top=i.currentPoint.y+t.offsetY+e[0].scrollTop;break;default:t.left=i.currentPoint.x+t.offsetX+e[0].scrollLeft,t.top=i.currentPoint.y+t.offsetY+e[0].scrollTop}r=t.left,o=t.top,t.left<t.minLeft?r=t.minLeft:t.left>t.maxLeft&&(r=t.maxLeft),t.top<t.minTop?o=t.minTop:t.top>t.maxTop&&(o=t.maxTop),n[0].style.left=r+"px",n[0].style.top=o+"px"},end:function(e,t){e.stopAutoScrolling&&(e.stopAutoScrolling(),e.stopAutoScrolling=null),t&&t.length&&t[0].removeAttribute("style")},isParent:function(e,t){return e===t},isChild:function(e,n){var i=n;if(t.isParent(e,n))return!1;for(;i;){if(i===e)return!0;i=i.parentNode}return!1},autoScroll:function(e,t,n,i,r,o,s,a){function l(r,s){if(u=e.scrollLeft,h=e.scrollTop,c){if(r<0&&0===u)return void(c=!1);if(r>0&&u+parseInt(t.height+.5,10)>=n)return void(c=!1);if(s<0&&0===h)return void(c=!1);if(s>0&&h+parseInt(t.height+.5,10)>=i)return void(c=!1);0!==r&&(e.scrollLeft+=r),0!==s&&(e.scrollTop+=s),o(),setTimeout(function(){l(r,s)})}}var c=!0,u=0,h=0,d=0,p=0;switch(r.direction){case"horizontal":r.pageX<=t.left+a?d=-s:r.pageX>=t.left+t.width-a&&(d=s);break;case"vertical":r.pageY<=t.top+a?p=-s:r.pageY>=t.top+t.height-a&&(p=s);break;default:r.pageY<=t.top+a?p=-s:r.pageY>=t.top+t.height-a&&(p=s)}return 0===d&&0===p||l(d,p),r.stopAutoScrolling&&(r.stopAutoScrolling(),delete r.stopAutoScrolling),r.stopAutoScrolling=function(){c=!1},r.stopAutoScrolling}}}])}),define("general.sortable/sortable-list",["core.utils/class","util","jquery","qvangular","touche","general.utils/dom-util","general.sortable/sortable-list-service"],function(e,t,n,i,r,o){"use strict";var s=e.extend("DefaultSortableList",{init:function(e,n){this.options=t.extend(!0,{gesture:{name:"swipe",options:{radiusThreshold:2,preventDefault:!1}},direction:"",scrollSelector:"",listSelector:"",listKey:"",itemSelector:"[ng-repeat]",itemDragSelector:"[ng-repeat]",itemKey:"$index",zIndex:1},e||{}),this.ctrl=n},onBegin:function(){},onEnter:function(){},onEnterList:function(){},onMove:function(){},onMoveToList:function(){},onCancel:function(){},onEnd:function(){},allowDrag:function(e){return r.utils.isMouse(e)?!!n(e.target).closest(this.options.itemSelector).length:!!n(e.target).closest(this.options.itemDragSelector).length},allowScroll:function(e){return!this.allowDrag(e)},allowEnter:function(){return!0},allowEnterList:function(){return!0},allowAutoScroll:function(){return!0},onAutoScroll:function(e){e()},getGesture:function(){return this.options.gesture},getDirection:function(){return this.options.direction},getScrollSensitivity:function(e){return r.utils.isMouse(e)?15:25},getScrollSpeed:function(e){return r.utils.isMouse(e)?15:25}});return i.directive("qvSortableList",["qvSortableListDragService",function(e){return{restrict:"A",controller:function(){},link:function(t,i,a,l){var c=t.$watch(a.qvSortableList,function(a){function u(){return p=void 0,r(i[0])[g.name](q).tap(x),r(d[0]).tap({id:"sortable-list-tap-"+t.$id,options:{preventDefault:!1},start:function(e){a.allowScroll(e)||o.isInput(e.target)||e.preventDefault()}}),function(){r(d[0]).off("*","sortable-list-tap-"+t.$id),r(i[0]).off("*",b)}}if(c(),a instanceof s)a.ctrl=l;else{var h=s.extend(a||{});a=new h(a&&a.options,l)}var d=i.closest(a.options.scrollSelector);d.length||(d=i);var p,f,m,g,v,y=e.$new(a.options),b="sortable-list-"+t.$id,x={id:b,options:{preventDefault:!1},start:function(t,i){p=void 0,!o.isInput(t.target)&&e.isChild(d[0],t.target)&&a.allowDrag(t)&&(0!==(p=n(t.target).closest(a.options.itemSelector)).length?(y.direction=a.getDirection(),f=a.getScrollSpeed(t),m=a.getScrollSensitivity(t),e.startOffset(d,y,p,i.pagePoints[0]),e.startData(d,y,p,a.options.itemKey)):p=void 0)},end:function(){p=void 0}},q={id:b,start:function(n){p?(n.preventDefault(),a.onBegin(y.fromItem,y.clientRect),t.$digest(),e.start(d,y,p)):this.cancel()},update:function(n,i){function r(){a.allowEnter(y.enterItem,y.fromItem)&&(y.toItem=y.enterItem,y.toList=void 0,a.onEnter(y.enterItem,y.enterItemAction),t.$digest())}function o(){a.allowEnterList(y.enterList,y.fromItem)&&(y.toItem=void 0,y.toList=y.enterList,a.onEnterList(y.enterList),t.$digest())}function s(){e.update(d,y,p,i.swipe),e.updateDragCoordinates(y,i.pagePoints[0].x,i.pagePoints[0].y,a.options.boundingRect),e.updateData(d,y,p,a.options.listSelector,a.options.listKey,a.options.itemSelector,a.options.itemKey,r,o)}if(p){if(s(),a.allowAutoScroll()){var l=e.autoScroll.bind(this,d[0],y.scroll.clientRect,y.scroll.width,y.scroll.height,y,s,f,m);a.onAutoScroll(l,y.enterList,y.enterItem,function(t,n,i,r){e.autoScroll(t,n,i,r,y,s,f,m)})}}else this.cancel()},end:function(){e.end(y,p),void 0!==y.toItem?(a.onMove(y.fromItem,y.toItem),t.$digest()):void 0!==y.toList?(a.onMoveToList(y.fromItem,y.toList),t.$digest()):(a.onCancel(),t.$digest()),a.onEnd(),p=void 0},cancel:function(){p&&(e.end(y,p),a.onCancel(),p=void 0,"$digest"!==t.$root.$$phase&&t.$digest())}};g=a.options.gesture,q.options=g.options,t.$on("$destroy",function(){r(d[0]).off("*","sortable-list-tap-"+t.$id),r(i[0]).off("*",b)}),l.on=function(){v||(v=u())},l.off=function(){v&&(v(),v=void 0)},l.cancel=function(){q.cancel()},l.on()})}}}]),s}),define("general.sortable/sortable-item-lists",["core.utils/class","util","general.sortable/sortable-list","general.sortable/sortable-list-constants"],function(e,t,n,i){"use strict";var r=e.extend("SortableItemList",{init:function(e,t){this.items=[],this.disabled=!1,this.typeFlag=e||1,this.locked=!1,Object.keys(t||{}).forEach(function(e){this[e]=t[e]},this)},addSortableItem:function(e,t){Object.defineProperty(e,"__sortableItem__",{configurable:!1,enumerable:!0,writable:!0,value:{typeFlag:t||1}}),this.items.push(e)},moveItem:function(e,t){this.items.splice(t,0,this.items.splice(e,1)[0])},getIndexByItem:function(e){return this.items.indexOf(e)},get:function(e){return this.items.filter(e||function(){return!0})},getLockedIndices:function(){return this.get(function(e){return!!(e.__sortableItem__.typeFlag&i.TYPEFLAG_LOCKED)}).map(function(e){return this.getIndexByItem(e)},this)},reset:function(){this.items.length=0,this.disabled=!1},isEmpty:function(){return 0===this.items.length},setLocked:function(e){this.locked=e}});Object.defineProperties(r.prototype,{length:{get:function(){return this.items.length}}});var o=n.extend("SortableItemLists",{init:function(){this._super.apply(this,arguments),this.lists=[],this.dragPlaceholder=null},addPlaceholder:function(e){var n=this.getList(e),r=n.items.indexOf(e);return this.dragPlaceholder=t.extend(!0,{},e),this.dragPlaceholder.id="placeholder",this.dragPlaceholder.__sortableItem__.typeFlag=i.TYPEFLAG_PLACEHOLDER,this.dragPlaceholder.style={opacity:"0.3"},n.items.splice(r,0,this.dragPlaceholder),this.dragPlaceholder},removePlaceholder:function(){if(this.dragPlaceholder){var e=this.getList(this.dragPlaceholder),t=e?e.items.indexOf(this.dragPlaceholder):-1;-1!==t&&(e.items.splice(t,1),this.dragPlaceholder=null)}},getPlaceholder:function(){return this.dragPlaceholder},createList:function(e,t){var n=new r(e,t);return this.lists.push(n),n},reset:function(){this.lists.forEach(function(e){e.reset()})},getList:function(e){return this.lists.filter(function(t){return-1!==t.items.indexOf(e)})[0]},disable:function(e){this.lists.forEach(function(t){t.disabled=!(e.__sortableItem__.typeFlag&t.typeFlag)})},enable:function(){this.lists.forEach(function(e){e.disabled=!1})},getIndexOfItem:function(e){return this.getList(e).items.indexOf(e)},moveItem:function(e,t){var n,i,r=this.getList(e),o=this.getList(t);r&&o&&(i=o.items.indexOf(t),n=r.items.indexOf(e),r.items.splice(n,1),o.items.splice(i,0,e))},onBegin:function(e,t){this.addPlaceholder(e,t),this.disable(e)},onEnter:function(e,t){var n=this.getList(e),r=n.getLockedIndices();if(e!==this.dragPlaceholder){if(t===i.ENTER_BEFORE||t===i.ENTER_AFTER){var o,s,a=this.getList(this.dragPlaceholder);if(!a||!n)return;o=a.getIndexByItem(this.dragPlaceholder),a.items.splice(o,1),s=n.getIndexByItem(e),s+=t===i.ENTER_AFTER?1:0,n.items.splice(s,0,this.dragPlaceholder)}else this.moveItem(this.dragPlaceholder,e);var l=n.getLockedIndices();r.forEach(function(e,t){n.moveItem(l[t],e)})}},onEnterList:function(e){if(!e.disabled&&!e.locked){var t=this.getList(this.dragPlaceholder),n=t.getIndexByItem(this.dragPlaceholder);t.items.splice(n,1),e.items.push(this.dragPlaceholder)}},onMove:function(e){var t=this.dragPlaceholder;this.moveItem(e,t),this.removePlaceholder(),this.enable()},onMoveToList:function(e,t){if(!t.disabled&&!t.locked){var n=this.getList(e),i=n.items.indexOf(e);if(n===t)return void this.onMove(e,this.dragPlaceholder);n.items.splice(i,1),t.items.push(e)}this.removePlaceholder(),this.enable()},onCancel:function(){this.removePlaceholder(),this.enable()},allowEnter:function(e,t){var n=this.getList(e);return void 0!==n&&!n.disabled&&!n.locked&&!!(t.__sortableItem__.typeFlag&n.typeFlag)},allowEnterList:function(e,t){return!e.disabled&&!e.locked&&!!(t.__sortableItem__.typeFlag&e.typeFlag)}});return o.create=function(e){return e=new(o.extend(e||{}))(e&&e.options)},o}),define("general.services/error-dialog/error-dialog",["qvangular"],function(e){return{show:function(t){return e.getService("qvAlertDialog").show({title:t.title,message:t.message,closeOnEscape:!1})}}}),define("client.services/odag-rest-service",["core.utils/class","translator","general.services/error-dialog/error-dialog","general.utils/swagger-api","assets/external/swagger-client/swagger-client"],function(e,t,n,i){"use strict";var r;return e.extend("ODAGRestService",{init:function(e,t,n,i){this._host=e,this._port=t,this._isSecured=i,this._proxy=n},_errorHandler:function(e){if(!e.isHandled){e.isHandled=!0;var i=e.response&&e.response.obj&&e.response.obj.message?e.response.obj.message:"";i||e&&(500===e.status?i=t.get("odag.Error.Unreachable"):e.message&&(i=t.get(e.errObj.message))),n.show({title:t.get("odag.Error.Title"),message:i})}throw e},_getAPI:function(){return r||(r=i.getApi("api/odag/v1","openapi",this._isSecured,this._host,this._port,this._proxy)),r},_getLinksWithIds:function(e,t){var n={linkList:t};return this._getAPI().then(function(t){return t.apis.Link.SyncAppLinkUsages({selAppId:e,linkUsagePayload:n}).then(function(e){return e.body})}).catch(this._errorHandler)},_getLinks:function(){return this._getAPI().then(function(e){return e.apis.Link.LinksGet().then(function(e){return e.body})}).catch(this._errorHandler)},_getLink:function(e){return this._getAPI().then(function(t){return t.apis.Link.LinkGet({linkId:e}).then(function(e){return e.body})}).catch(this._errorHandler)},_isODAGAvailable:function(){return this._getAPI().then(function(e){return e.apis.Global.IsOdagAvailable().then(function(e){return e.body})}).catch(this._errorHandler)},_canCreateLink:function(e){return this._getAPI().then(function(t){var n={};return e&&(n.optSelectAppId=e),t.apis.Link.LinkCanCreate(n).then(function(e){return e.body})},function(){return{canCreateLinks:!1}}).catch(this._errorHandler)},_createLink:function(e){return this._getAPI().then(function(t){return t.apis.Link.LinkCreate({linkPayload:e}).then(function(e){return e.body})}).catch(this._errorHandler)},_deleteLink:function(e,t){var n={statusSetting:"decommission",modifiedDate:t.data.modifiedDate};return this._getAPI().then(function(t){return t.apis.Link.LinkUpdate({linkId:e,linkPayload:n}).then(function(e){return e.body})}).catch(this._errorHandler)},_updateLink:function(e,t){return this._getAPI().then(function(n){return n.apis.Link.LinkUpdate({linkId:e,linkPayload:t}).then(function(e){return e.body})}).catch(this._errorHandler)},_renameApp:function(e,t){return this._getAPI().then(function(n){var i={appName:t};return n.apis.Request.RenameApp({requestId:e,renameAppPayload:i})}).catch(this._errorHandler)},_deleteApp:function(e){return this._getAPI().then(function(t){return t.apis.Request.DeleteApp({requestId:e})}).catch(this._errorHandler)},_reloadApp:function(e,t,n,i,r){var o={};return t&&(r&&(o.copyRequest=r),o.actualRowEst=t,o.bindSelectionState=n,o.selectionState=i),this._getAPI().then(function(t){return t.apis.Request.ReloadApp({requestId:e,reloadAppPayload:o})}).catch(this._errorHandler)},_requestAction:function(e,t,n,i){var r={requestId:e,action:t,ignoreSucceeded:!0};return void 0!==n&&(r.delGenApp=n),void 0!==i&&(r.autoAck=i),this._getAPI().then(function(e){return e.apis.Request.RequestAction(r).then(function(e){return e.body})}).catch(this._errorHandler)},_getGeneratedAppsForLink:function(e,t,n,i,r,o,s){var a={linkId:e};return r&&(a.user=r),o&&(a.state=o),s&&(a.pending=s),this._getAPI().then(function(e){return e.apis.Request.LinkRequestsGet(a).then(function(e){return e.body})}).catch(this._errorHandler)},_generateApp:function(e,t,n,i,r,o,s){var a={linkId:e,requestPostPayload:{clientContextHandle:n,actualRowEst:r,selectionApp:t,bindSelectionState:o,selectionState:s,sheetname:i}};return this._getAPI().then(function(e){return e.apis.Request.LinkRequestCreate(a).then(function(e){return e.body})}).catch(this._errorHandler)},getODAGLinksWithIds:function(e,t){return this._getLinksWithIds(e,t)},getODAGLink:function(e){return this._getLink(e)},canCreateLink:function(e){return this._canCreateLink(e)},createODAGLink:function(e){return this._createLink(e)},deleteODAGLink:function(e,t){return this._deleteLink(e,t)},updateODAGLink:function(e,t){return this._updateLink(e,t)},renameApp:function(e,t){return this._renameApp(e,t)},deleteApp:function(e){return this._deleteApp(e)},isODAGAvailable:function(){return this._isODAGAvailable()},reloadApp:function(e,t,n,i,r){return this._reloadApp(e,t,n,i,r)},generateApp:function(e,t,n,i,r,o,s){return this._generateApp(e,t,n,i,r,o,s)},getGeneratedAppsForLink:function(e,t,n,i,r,o,s){return this._getGeneratedAppsForLink(e,t,n,i,r,o,s)},requestAction:function(e,t,n,i){return this._requestAction(e,t,n,i)}})}),define("client.models/odag-app-link",["core.models/communication","core.utils/deferred","util"],function(e,t,n){"use strict";function i(n){return n?t.resolve(n.enigmaModel):e.getApp()}var r={};return r.create=function(e,t){return i(e).then(function(e){var i={qInfo:{qId:n.generateId(),qType:"odagapplink"},qMetaDef:{odagLinkRef:"",timestamp:Date.now()}};return e.createObject(n.extend(!0,i,t))})},r.remove=function(e,t){return i(e).then(function(e){return e.destroyObject(t)})},r.get=function(e,t){return i(e).then(function(e){return e.getObject(t)})},r.getList=function(e){return i(e).then(function(e){return e.getODAGAppLinkObject()})},r}),define("client.models/sheet",["core.models/communication","core.utils/deferred"],function(e,t){"use strict";function n(n){return n?t.resolve(n.enigmaModel):e.getApp()}var i={};return i.create=function(e,t){return n(t).then(function(t){return t.createSheet(e)})},i.remove=function(e,t){return n(t).then(function(t){return t.destroyObject(e)})},i.get=function(e,t){return n(t).then(function(t){return t.getObject(e)})},i.getList=function(e){return n(e).then(function(e){return e.getSheetListObject()})},i}),define("assets/client/views/odag-toolbar/odag-toolbar-navpoint-session-object-definitions",[],function(){return{fieldHyperCubeProperties:{qInfo:{qType:"odag-toolbar-navpoint"},qMetaDef:{},qHyperCubeDef:{qDimensions:[],qInitialDataFetch:[{qLeft:0,qTop:0,qWidth:1,qHeight:0}]}},maxRowExpression:{qInfo:{qType:"odag-toolbar-navpoint"},MaxRowCountExpression:{qValueExpression:{qExpr:""}}}}}),define("text!assets/general/services/guidance-popover/guidance-popover.ng.html",[],function(){return'<immidiate-contextual align-to="input.alignTo"\n\t\t\t\t\t  position="input.menuOptions.position"\n\t\t\t\t\t  width="input.menuOptions.width"\n\t\t\t\t\t  top="input.menuOptions.bottom"\n\t\t\t\t\t  on-close-view="onOutsidePopover(event)"\n\t\t\t\t\t  lui-style="true"\n\t\t\t\t\t  class= "qv-guidance-popover"\n\t\t\t\t\t  ng-style="{\'opacity\': popupClosing? 0 : 1}"\t\t\t\t\t  \n>\n\t<div class="qv-guidance-popover-content">\n\t\t<div class="qv-guidance-popover-title">{{input.title}}</div>\n\t\t<div class="qv-guidance-popover-message">{{input.message}}</div>\n\t\t<div class="qv-guidance-popover-button">\n\t\t\t<button class="lui-button  lui-button--success qui-popover-ok-button" qva-activate="onCloseClicked()">{{input.buttonText}}</button>\n\t\t</div>\n\t</div>\n</immidiate-contextual>\n'}),define("assets/general/services/guidance-popover/guidance-popover",["jquery","qvangular","core.utils/resize","text!./guidance-popover.ng.html","general.services/show-service/show-service","translator"],function(e,t,n,i,r,o){"use strict";var s={template:i,scope:{input:"="},controller:["$scope","$timeout",function(t,i){function r(e){e?(t.popupClosing=!0,i(function(){t.destroyComponent()},500)):t.destroyComponent()}function s(){t.destroyComponent()}t.popupClosing=!1,t.input.buttonText=t.input.buttonText?t.input.buttonText:o.get("Common.OK"),t.input.title=t.input.title?t.input.title:"",t.input.message=t.input.message?t.input.message:"",t.input.closeAfter&&i(function(){r(!0)},t.input.closeAfter),t.onOutsidePopover=function(t){event.stopPropagation(),event.preventDefault(),e(t.target).closest(".qui-popover-ok-button").length||r()},t.onCloseClicked=function(){r(!0)},t.$on("$destroy",function(){n.off("start",s)}),n.on("start",s)}]};t.service("qvGuidancePopover",function(){return{show:function(e){return r.show(s,{input:e,class:e.class?e.class:""})}}})}),define("client.services/odag-data-service",["client.services/odag-rest-service","util","angular","underscore","client.models/odag-app-link","core.models/app","general.models/field","client.models/sheet","client.models/current-selections","core.utils/deferred","core.utils/environment","assets/client/views/odag-toolbar/odag-toolbar-navpoint-session-object-definitions","assets/general/services/guidance-popover/guidance-popover"],function(e,t,n,i,r,o,s,a,l,c,u,h){function d(e){return b?c.resolve(!0):e?(u.setup(e.enigmaModel.session),c.resolve(!0)):o.get().then(function(e){u.setup(e.enigmaModel.session)})}function p(t){if(y)return y;var n="",i="",r="",o=!1;if(t&&t.enigmaModel&&t.enigmaModel.session){var s=t.enigmaModel.session.sessionConfig?t.enigmaModel.session.sessionConfig:null;s&&(n=s.prefix?s.prefix:"/",i=s.host?s.host:null,r=s.port?s.port:null,o=!(!s.isSecure&&!s.secure))}return(y=new e).init(i,r,n,o),y}function f(e,t,n,i,r,o,s){return e||(e=[]),t||(t=[]),i<o?n.getHyperCubeData("/qHyperCubeDef",[{qTop:i,qLeft:0,qWidth:1,qHeight:1e4}]).then(function(a){return a[0].qMatrix.forEach(function(n){var i=n[0];r.indexOf(i.qState)>-1&&e.push({selStatus:i.qState,strValue:i.qText,numValue:i.qNum}),s&&"S"===i.qState&&t.push({selStatus:i.qState,strValue:i.qText,numValue:i.qNum})}),i+=1e4,f(e,t,n,i,r,o,s)}):c.resolve({fieldValues:e,selectedFieldValues:t})}function m(e,n,i){var r=n.selectAppParamName,o=n.selectionStates,s=t.extend(!0,{},h.fieldHyperCubeProperties);return s.qHyperCubeDef.qDimensions.push({qDef:{qFieldDefs:[r]},qNullSuppression:!0}),e.enigmaModel.createSessionObject(s).then(function(t){return t.getLayout().then(function(n){var r=n.qHyperCube.qSize.qcy;return f(null,null,t,0,o,r,i).then(function(t){return g(e,n.qInfo.qId),t})})})}function g(e,t){var n=e.enigmaModel||e;return n.enigmaModel.destroySessionObject.apply(n,[t])}function v(e,t){var n={bindingValuesArray:[],selectedValuesArray:[]};if(!t)return c.resolve(null);var i=t.bindings?t.bindings:[];return x.getCurrentlySelectedFields(e).then(function(t){return x.getAllFieldBindingValues(e,i,t).then(function(r){for(var o=0;o<i.length;o++){for(var s=r[o],a=-1,l=0;l<t.length;l++)if(t[l]&&t[l].fieldName===i[o].selectAppParamName){a=l;break}if(a>=0){var c={selectionAppParamType:"Field",selectionAppParamName:i[o].selectAppParamName,values:s.selectedFieldValues.length<10001?s.selectedFieldValues:[],selectedSize:s.selectedFieldValues.length};n.selectedValuesArray.push(c),t.splice(a,1)}var u={selectionAppParamType:"Field",selectionAppParamName:i[o].selectAppParamName,values:s.fieldValues};n.bindingValuesArray.push(u)}for(var h=[],d=0;d<t.length;d++)h.push({selectAppParamName:t[d].fieldName,selectionStates:"S"});return x.getAllFieldBindingValues(e,h,null).then(function(e){for(var i=0;i<t.length;i++){var r=e[i],o={selectionAppParamType:"Field",selectionAppParamName:t[i].fieldName,values:r.fieldValues.length<10001?r.fieldValues:[],selectedSize:r.fieldValues.length};n.selectedValuesArray.push(o)}return n})})})}var y=null,b=null,x={addingNewNavPointID:{},odagLinkSessionObjects:{},getODAGLinksPromise:{}};return x.ODAGRequestActionConst={CANCEL:"cancel",PAUSE:"pause",RESUME:"resume",CANCEL_ACK:"ackcancel",FAIL_ACK:"ackfailure"},x.getODAGLinks=function(e,t){t=void 0!==t&&t;var n=this;return this.getODAGLinksPromise[e.id]&&!t||(this.getODAGLinksPromise[e.id]=r.getList(e).then(function(t){return t.getLayout().then(function(t){return n.onAppLinksLoaded(e,t)})})),this.getODAGLinksPromise[e.id]},x.onAppLinksLoaded=function(e,t){var n=t.map(function(e){return e.qData.odagLinkRef});return x.loadODAGLinks(e,n)},x.loadODAGLinks=function(e,t){return p(e).getODAGLinksWithIds(e.id,t)},x.loadODAGLink=function(e,t){return p(e).getODAGLink(t)},x.canCreateLink=function(e){return p(e).canCreateLink(e.id)},x.isODAGAvailable=function(e){return d(e).then(function(){return c.all({isDesktop:u.isDesktop(),isCloud:u.isCloud()}).then(function(t){return!t.isDesktop&&!t.isCloud&&p(e).isODAGAvailable().then(function(e){return!(!e||!e.available)})})})},x.createODAGLink=function(e,t){var i=n.copy(t)||{};return i.selectionApp=e.id,p(e).createODAGLink(i).then(function(t){var n={qMetaDef:{odagLinkRef:t.objectDef.id}};return r.create(e,n)})},x.deleteODAGLink=function(e,t,n){return p(e).deleteODAGLink(t,n).then(function(){return r.getList(e).then(function(n){return n.getLayout().then(function(n){for(var i=null,o=0;o<n.length&&!i;o++){var s=n[o];s.qData.odagLinkRef===t&&(i=s.qInfo.qId)}if(i)return r.remove(e,i).then(function(){return a.getList(e).then(function(e){return e.getLayout().then(function(e){var n=[];return e.forEach(function(e){var i=a.get(e.qInfo.qId).then(function(e){return e.removeRefToLinkIDFromNavPoints(t)});n.push(i)}),c.all(n)})})})})})})},x.updateODAGLink=function(e,t,n){return p(e).updateODAGLink(t,n).then(function(t){return r.getList(e).then(function(n){return n.getLayout().then(function(n){for(var i=null,o=0;o<n.length;o++){var s=n[o];if(s.qData.odagLinkRef===t.objectDef.id){i=s.qInfo.qId;break}}if(i)return r.get(e,i).then(function(e){return e.getProperties().then(function(t){return t.qMetaDef.timestamp=Date.now(),e.setProperties(t)})})})})})},x.addODAGNavPoint=function(e,n){if(e){var i=t.generateId();this.addingNewNavPointID[e.id]=i;var r={insertBeforeNavPointID:n.insertBeforeItem?n.insertBeforeItem.data.info.id:null,data:{info:{id:i},title:n.title,odagLinkRefID:n.odagLinkRefID}};e.addNavPoint(r)}},x.clearSelections=function(e){return l.get(e).then(function(e){return e.clearAll()})},x.renameGenApp=function(e,t,n){return p(e).renameApp(t,n)},x.deleteGenApp=function(e,t){return p(e).deleteApp(t)},x.selectFieldValuesForField=function(e,t,n){for(var i=[],r=0;r<n.length;r++){var o=n[r],a={};isNaN(o.numValue)?(a.qIsNumeric=!1,a.qText=o.strValue):(a.qIsNumeric=!0,a.qNumber=o.numValue),i.push(a)}return s.get(t,null,e).then(function(e){return e.selectValues(i,!0,!0)})},x.getAllFieldBindingValues=function(e,t,n){if(t.length){for(var r=[],o=0;o<t.length;o++){var s=t[o],a=s.selectAppParamName,l=!(!n||null===i.find(n,function(e){return e.fieldName===a}));r.push(m(e,s,l))}return c.all(r)}return c.resolve([])},x.getCurrentlySelectedFields=function(e){return l.get(e).then(function(e){return e.getLayout().then(function(e){for(var t=[],n=0;n<e.qSelectionObject.qSelections.length;n++){var i=e.qSelectionObject.qSelections[n];t.push({fieldName:i.qField,selectionCount:i.qSelectedCount})}return t})})},x.reloadApp=function(e,t,n,i,r){switch(i){case 1:case 2:return v(e,t).then(function(t){if(t){var o=!1;return 2==i&&(o=!0),p(e).reloadApp(n,r,t.bindingValuesArray,t.selectedValuesArray,o)}return c.resolve(null)});default:return p(e).reloadApp(n)}},x.generateApp=function(e,t,n,i,r){return v(e,n).then(function(o){return o?p(e).generateApp(n.id,e.id,i,t,r,o.bindingValuesArray,o.selectedValuesArray):c.resolve(null)})},x.removeODAGAppLinkWithODAGLinkId=function(e,t){return r.getList(e).then(function(n){return n.getLayout().then(function(n){var i=n.filter(function(e){return e.qData.odagLinkRef===t});if(i.length)return r.remove(e,i[0].qInfo.qId)})})},x.reorderNavPoints=function(e,t){e.reorderNavPoints(t)},x.moveNavPoint=function(e,t,n){e.moveNavPoint(t,n)},x.requestAction=function(e,t,n,i,r){return p(e).requestAction(t,n,i,r)},x.getGeneratedAppsForLink=function(e,t,n,i,r,o){return p(e).getGeneratedAppsForLink(n,i,e.id,t,r,o,!0)},x.clearCachedSessionObjects=function(e){var t=this,n=[];for(var i in this.odagLinkSessionObjects[e.id])n.push(function(n){return t.odagLinkSessionObjects[e.id][n].getLayout().then(function(i){g(e,i.qInfo.qId),delete t.odagLinkSessionObjects[e.id][n]})}(i));return this.getODAGLinksPromise[e.id]=null,c.all(n)},x.getOrCreateSessionObjectsForLink=function(e,t){var n=this;return this.odagLinkSessionObjects[e.id]&&this.odagLinkSessionObjects[e.id][t.id]?c.resolve(this.odagLinkSessionObjects[e.id][t.id]):(h.maxRowExpression.MaxRowCountExpression.qValueExpression.qExpr=t.rowEstExpr,e.enigmaModel.createSessionObject(h.maxRowExpression).then(function(i){return n.odagLinkSessionObjects[e.id]||(n.odagLinkSessionObjects[e.id]={}),n.odagLinkSessionObjects[e.id][t.id]=i,i}))},x}),define("general.utils/drag-and-drop-service",["util","qvangular"],function(e,t){function n(e,t,n){this.offsetX=e,this.offsetY=t,this.elem=n}function i(e,t,n,i,r){return e[n]&&e[n][t.type]?e[n][t.type].call(null,i,r):"function"==typeof e[n]?e[n].call(null,i,r):void 0}function r(e,t,n){this.info=e,this.handle=t,this.targets=n,this.rects=[];var i=this.docRect=document.body.getBoundingClientRect(),r=this.canvas=document.createElement("canvas");r.style.position="absolute",r.style.left=(window.pageXOffset||0)+"px",r.style.top=(window.pageYOffset||0)+"px",r.style.zIndex=999,r.width=i.width,r.height=i.height,document.body.appendChild(r),this.context=r.getContext("2d")}function o(e,t,n,i){if(e.setLineDash)e.setLineDash(i),e.moveTo(s(t.x),s(t.y)),e.lineTo(s(n.x),s(n.y)),e.stroke();else{var r,o=(i=i||[2,4]).length,a=n.x-t.x,l=n.y-t.y,c=Math.sqrt(a*a+l*l),u=c,h=0,d=!0,p=t.x,f=t.y;for(a/=c,l/=c,e.moveTo(s(p),s(f)),h=0;u>=.1&&h<5e3;++h)0===(r=i[h%o])&&(r=.001),r>u&&(r=u),p+=r*a,f+=r*l,e[d?"lineTo":"moveTo"](s(p),s(f)),u-=r,d=!d}}function s(e){return Math.round(e)}function a(e,t,n){if(n=n||[5],e.setLineDash)e.setLineDash(n),e.strokeRect(s(t.left),s(t.top),s(t.right-t.left),s(t.bottom-t.top));else{var i=e.lineWidth/2;e.beginPath();var r={x:t.left+i,y:t.top+i},a={x:t.right-i,y:t.top+i},l={x:t.right-i,y:t.bottom-i},c={x:t.left+i,y:t.bottom-i};o(e,r,a,n),o(e,a,l,n),o(e,l,c,n),o(e,c,r,n),e.stroke()}}function l(e,t){var n=e.lineWidth+4;e.beginPath(),e.rect(t.left+n,t.top+n,t.right-t.left-2*n,t.bottom-t.top-2*n),e.fillStyle="rgba(0,0,0,0.05)",e.fill()}var c=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;n.prototype.update=function(e,t){var n={x:e.pageX+this.offsetX,y:e.pageY+this.offsetY},i=this.elem;t&&t.snapToGrid&&t.snapToGrid.snapFunc(e,t,n,i),c?(i.style.left=n.x+"px",i.style.top=n.y+"px"):i.style.transform=i.style.webkitTransform=i.style.mozTransform=i.style.msTransform="translate3d("+n.x+"px, "+n.y+"px, 0)"},n.prototype.end=function(){this.elem.parentNode.removeChild(this.elem)},r.prototype.start=function(){for(var n=this.targets,r=this.info,o=0;o<n.length;++o)i(n[o],r,"start",this);this.rects.sort(function(t,n){return e.compare(n.prio,t.prio)}),t.$rootScope.$apply()},r.prototype.update=function(e){e.preventDefault();var t=e.pageX,n=e.pageY;this.handle.update(e,this.info);for(var r=this.rects,o=null,s=0;s<r.length;++s){var c=r[s].targetRect;if(c.left<=t&&t<=c.right&&c.top<=n&&n<=c.bottom){o=r[s];break}}if(o!==this.activeRect){this.activeRect&&i(this.activeRect,this.info,"leave",this.info);var u=this.context,h=this.docRect;if(u.clearRect(0,0,h.width,h.height),o){u.strokeStyle="#F7A24D",u.lineWidth=2;var d=o.drawRect;d&&(a(u,o.cellRect||d,[5]),l(u,d)),i(o,this.info,"enter",this.info)}}this.activeRect=o},r.prototype.registerDropRect=function(e){e.prio=e.prio||0,this.rects.push(e)},r.prototype._end=function(){for(var e=0;e<this.targets.length;++e)i(this.targets[e],this.info,"end",this);document.body.removeChild(this.canvas),this.handle.end(),t.$rootScope.$apply()},r.prototype.end=function(e){this.activeRect&&i(this.activeRect,this.info,"drop",this.info,e),this._end()},r.prototype.cancel=function(){this._end()};var u=[];return{registerDropTarget:function(e){-1===u.indexOf(e)&&u.push(e)},unregisterDropTarget:function(e){var t=u.indexOf(e);-1!==t&&u.splice(t,1)},startDrag:function(e,t){e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.zIndex=9999,document.body.appendChild(e);var o=e.getBoundingClientRect(),s=new n(-o.width/2,-o.height/2,e),a=u.filter(function(e){return i(e,t,"accept",t)}),l=new r(t,s,a);try{return l.start(),l}catch(e){return l.cancel(),!1}}}}),define("client.models/odag-link",["jquery","core.utils/deferred","client.services/odag-data-service","core.utils/class"],function(e,t,n,i){"use strict";var r=i.extend("ODAGLink",{properties:null,getProperties:function(){return t.resolve(this.properties)},create:function(e){return n.createODAGLink(e,this.properties.data)},init:function(t){return this.properties={type:"odaglink",data:{id:"",name:"",templateApp:"",rowEstExpr:"",privileges:[],properties:{rowEstRange:[{context:"*",highBound:null}],genAppLimit:[{context:"User_*",limit:5}],appRetentionTime:[{context:"User_*",retentionTime:""}],publishTo:[],targetSheet:[{context:"User_*",sheetId:""}]},tags:[]}},e.extend(!0,this.properties.data,t),this}});return r.getLinkedObjects=function(){return t.resolve([])},r.get=function(e,t){return n.loadODAGLink(t,e).then(function(e){return new r(e.objectDef)})},r.getList=function(e,t){return n.getODAGLinks(e,t).then(function(t){for(var i=[],o=0;o<t.length;o++){var s=t[o];if(s&&s.link)if("decommissioned"===s.link.status)n.removeODAGAppLinkWithODAGLinkId(e,s.link.id);else{var a=new r(s.link);i.push(a)}}return i})},r}),define("client.models/odag-navpoint",["core.utils/deferred","core.utils/class","underscore","core.utils/notification","client.models/odag-link","util"],function(e,t,n,i,r,o){"use strict";return t.extend("ODAGNavPoint",{properties:null,parent:null,init:function(e){i.mixin(this),this.notification("Invalidated"),this.parent=e.parent,this.properties={qInfo:{qType:"odagNavPoint"}},this.properties=o.extend(this.properties,e.properties);var t=this;this._sheetInvalidated=function(){t.parent.getProperties().then(function(e){for(var i=0;i<e.navPoints.length;i++){var r=e.navPoints[i];if(r.info.id===t.properties.info.id){n.isEqual(r,n.omit(t.properties,["qInfo"]))||(t.properties=o.extend(t.properties,r),t.Invalidated.emit());break}}})},this.parent.Invalidated.bind(this._sheetInvalidated)},getLayout:function(){var e=this;return this.properties.odagLinkName=null,r.getList(this.parent.app).then(function(t){return t.filter(function(t){return t.properties.data.id===e.properties.odagLinkRefID}).length>0?r.get(e.properties.odagLinkRefID,e.parent.app).then(function(t){return e.properties.odagLinkName=t.properties.data.name,e.properties}):(e.properties.odagLinkName="",e.properties)})},getProperties:function(){return e.resolve(this.properties)},getEffectiveProperties:function(){return e.resolve(this.properties)},clearSoftPatches:function(){},removeObject:function(){this.parent.removeNavPoint(this.properties.info.id)},setProperties:function(e){var t=this;return this.properties=o.extend(this.properties,e),this.parent.getProperties().then(function(e){for(var n=0;n<e.navPoints.length;n++)if(e.navPoints[n].info.id===t.properties.info.id){var i=o.extend({},t.properties);delete i.qInfo,e.navPoints[n]=i;break}return t.parent.setProperties(e)})},destroy:function(){this.parent.Invalidated.unbind(this._sheetInvalidated)}})}),define("client.property-panel/odag-properties/odag-item-properties",[],function(){return{type:"items",component:"accordion",items:{navPointProps:{type:"items",translation:"properties.odagNavProperties",items:{general:{type:"items",grouped:!0,items:{title:{type:"string",ref:"title",translation:"Common.Name",minlength:1,readOnly:function(e,t,n){var i=n.layout;return i&&(i.permissions&&!i.permissions.update||i.qMeta&&i.qMeta.sourceObject&&i.qMeta.sourceObject.length>0)},rollbackInvalid:!0}}},odagLinkInfo:{type:"items",items:{odagLinkName:{type:"string",ref:"odagLinkName",translation:"properties.odag.link.name",minlength:1,readOnly:function(){return!0},rollbackInvalid:!0}}}}}}}}),define("client.views/odag-toolbar/odag-toolbar-helper",["qvangular","core.utils/deferred","client.property-panel/odag-properties/odag-item-properties"],function(e,t,n){var i=null,r=null;return{createSelectedObjFromNavPoint:function(o){return{id:o.id,type:o.type,canCopy:function(){return!1},canCut:function(){return!1},canRemove:function(){return!0},remove:function(){o.model.removeObject()},getAllPropertyPanelContent:function(){return i||(i=e.getService("$cacheFactory"),r=i("pp-navPoint")),t.all({properties:o.model.getProperties(),layout:o.model.getLayout()}).then(function(e){return{definition:n,iconClass:"lui-icon lui-icon--sign-post",titleRef:"qMeta.title",properties:e.properties,layout:e.layout,model:o.model,cache:r,type:o.invalid?"invalid":"odagNavPoint"}})}}}}}),define("client.views/odag-toolbar/odag-toolbar-service",["core.utils/deferred","client.models/odag-navpoint","client.services/stage-state","client.models/sheet","client.views/odag-toolbar/odag-toolbar-helper","client.services/odag-data-service","client.models/odag-app-link","client.models/odag-link"],function(e,t,n,i,r,o,s,a){function l(e){this.qvSheetService=e,this.currentApp=null,this.currentSheet=null,this.odagNavPoints=null,this.appLinkModelList=null,this.openAppCallback=null}return l.prototype.init=function(e,t){var n=this;return this.odagNavPoints=[],this.currentApp=e,this.openAppCallback=t,s.getList(e).then(function(e){return n.appLinkModelList=e,e.getLayout().then(function(){n.updateNavPoints(),e.Invalidated.bind(n.updateNavPoints.bind(n))})})},l.prototype.sheetChanged=function(e){var t=this;this.currentSheet&&this.currentSheet.Invalidated.unbind(this.updateNavPoints),e&&i.get(e,this.currentApp).then(function(e){t.currentSheet=e,t.currentSheet&&(t.updateNavPoints(),t.currentSheet.Invalidated.bind(t.updateNavPoints.bind(t)))})},l.prototype.getODAGLinkInfo=function(t){var n=new e;return t._cachedLinkProps?n.resolve(t._cachedLinkProps):t.data.odagLinkRefID?a.getList(t.model.parent.app).then(function(e){e.filter(function(e){return e.properties.data.id===t.data.odagLinkRefID}).length>0?o.loadODAGLink(t.model.parent.app,t.data.odagLinkRefID).then(function(e){if(!e||"decommissioned"!==e.objectDef.status)return t.invalid=!1,t.maxNumberOfApps=e.objectDef.properties.genAppLimit[0].limit,t.maxRowExpressionCount=e.objectDef.properties.rowEstRange[0].highBound,t._cachedLinkProps=e.objectDef,n.resolve(e.objectDef);t.invalid=!0,n.resolve(null)},function(){t.invalid=!0,n.resolve(null)}):(t.invalid=!0,n.resolve(null))}):(t.invalid=!0,n.resolve(null)),n.promise},l.prototype.createODAGNavPointsList=function(i){var s=n.selectedObject?n.selectedObject:null,a=null,l=this;if(void 0!==i){if(this.odagNavPoints.splice(0,this.odagNavPoints.length),i.forEach(function(i){var c={id:i.info.id,type:"ODAGNavPoint",object:{isInvalid:!0},data:i,openAppCallback:l.openAppCallback,model:null,maxRowExpressionCount:null,maxNumberOfApps:null,_cachedLinkProps:null,invalid:!1,initialized:null},u={parent:l.currentSheet,properties:i};c.model=new t(u),c.getLoadedLinkInfo=l.getODAGLinkInfo,c.getCurrentCountSessionObjectForLink=function(){return this.getLoadedLinkInfo(c).then(function(t){return t?o.getOrCreateSessionObjectsForLink(l.currentApp,t).then(function(e){return e}):e.resolve(null)})},l.odagNavPoints.push(c),s&&s.id===i.info.id&&!o.addingNewNavPointID[l.currentSheet.id]&&(a=c,n.setSelectedObject(r.createSelectedObjFromNavPoint(c)))}),o.addingNewNavPointID[this.currentSheet.id]){var c=this.odagNavPoints.filter(function(e){return e.data.info.id===o.addingNewNavPointID[l.currentSheet.id]});c.length&&(n.setSelectedObject(r.createSelectedObjFromNavPoint(c[0])),a=c[0]),o.addingNewNavPointID[this.currentSheet.id]=null}this.qvSheetService&&s&&"ODAGNavPoint"===s.type&&!a&&this.qvSheetService.setSheetAsSelectedObj()}},l.prototype.updateNavPoints=function(){var e=this;if(this.currentApp&&this.currentSheet)return o.clearCachedSessionObjects(this.currentApp).then(function(){e.currentSheet.getNavPoints().then(function(t){e.createODAGNavPointsList(t)})})},l.prototype.hasODAGNavPoints=function(){return this.odagNavPoints.length>0},l.prototype.destroy=function(){this.odagNavPoints=[],this.appLinkModelList.Invalidated.unbind(this.updateNavPoints),this.currentSheet.Invalidated.unbind(this.updateNavPoints)},l.prototype.getOdagNavPoints=function(){return this.odagNavPoints},l}),define("text!client.views/odag-toolbar/odag-toolbar-navpoint.ng.html",[],function(){return'<div class="drag-odag-navpoint">\n\t<div class="odag-nav-point-cell" ng-class="{\'active\': item.id === selObject.id, \'popoverOpen\': popover, \'invalid\': item.invalid }" ng-style="item.style" ng-click="onODAGNavPointClicked(item)">\n\t\t<qv-progress-circle ng-if="!inEditMode && !item.invalid" class=" odag-progress-circle" percentage="rowCountPercentage"></qv-progress-circle>\n\t\t<div class="cell-name" ng-if="inEditMode || !item.invalid" title="{{item.data.title}}">{{item.data.title}}</div>\n\t\t<div class="cell-name" ng-if="!inEditMode && item.invalid " q-title-translation="odag.toolbar.navpoint.invalid" q-translation="odag.toolbar.navpoint.invalid"></div>\n\t\t<div ng-if="!inEditMode && !item.invalid" class="arrow"></div>\n\t\t<button ng-if="inEditMode && item.invalid" class="lui-fade-button delete-invalid-navpoint" ng-click="deleteInvalidNavPoint($event, item)">\n\t\t\t<span class="lui-fade-button__icon  lui-icon lui-icon--bin"></span>\n\t\t</button>\n\t</div>\n</div>'}),define("text!general.services/loader/default-loader.ng.html",[],function(){return'<div class="qv-block-ui" ng-class="{\'qv-fade-out\': fadeOut}">\n\t<div class="qv-loader-container" ng-class="ngClasses">\n\t\t<div class="qv-loader"></div>\n\t</div>\n\t<div class="qv-loader-text" ng-if="messageObj" ng-class="ngClasses">\n\t\t<div ng-show="messageObj.task" q-translation="{{messageObj.task}}"></div>\n\t\t<div ng-show="messageObj.message" q-translation="{{messageObj.message}}"></div>\n\t</div>\n</div>\n'}),define("text!client.views/odag-toolbar/odag-toolbar-navpoint-popover.ng.html",[],function(){return'<lui-popover id="odag-toolbar-navpoint-popover" ng-class="expandedItem.item? \' request-expanded\' : \'\'" class="odag-toolbar-navpoint-popover" x-arrow="arrow">\t\n\t<lui-popover-header ng-class="{\'invalid\': header.invalid}">\t\t\n\t\t<img qva-prevent-drag ng-src="{{ header.imgSrc }}" class="app-thumbnail-img"/>\n\t\t<div class="title-description-container">\t\t\t\n\t\t\t<lui-popover-title title="{{header.templateName}}" >{{header.templateName}}</lui-popover-title>\n\t\t\t<lui-popover-title ng-if="!header.invalid" class="desciption" title="{{header.templateDescription}}">{{header.templateDescription}}</lui-popover-title>\n\t\t</div>\t\n\t</lui-popover-header>\n\n\t<lui-popover-body class="odag-popup-body" qva-outside-ignore-for="odag-request-menu">\n\t\t<odag-app-list2 class="odag-app-list-container" applist="generatedApps" reload-app="reloadApp" load-generated-apps="loadGeneratedApps" generate-app-in-progress="generateAppInProgress" expanded-item="expandedItem" is-header-invalid="header.invalid" is-generate-btn-disabled="isGenerateBtnDisabled" loading="loadingContent.value" delete-clicked="deleteGenAppClicked" on-apply-selections-callback="onApplySelections" open-app-callback="item.openAppCallback"></odag-app-list2>\n\t\t<div ng-if="maxGeneratedAppLimitReached && !dismissedMaxGenAppMsg && !expandedItem.item" class="odag-max-app-limit-reached">\n\t\t\t<div class="max-app-text" q-translation="odag.toolbar.napvoint.popup.maxAppLimitReached"></div>\n\t\t\t<button class="lui-fade-button close-button" q-title-translation="Common.Close" ng-click="dismissMaxGenAppMsgClicked()"><span class="lui-button__icon  lui-icon lui-icon--small  lui-icon--close"></span></button>\n\t\t</div>\n\t</lui-popover-body>\n\t<div ng-if="showInfoPopup" class="infoPopup">\n\t\t<div class="info-constraints-header">{{infoHeader}}</div>\n\t\t<div class="info-row-count-container">\n\t\t\t<div class="info-section" q-translation="odag.toolbar.navpoint.popup.info.row.count.header"></div>\t\t\t\n\t\t\t<div class="info-row-count-content">\n\t\t\t\t<div class="info-row-count-progress-circle">\n\t\t\t\t\t<circle-chart model=\'circleModel\'></circle-chart>\n\t\t\t\t</div>\n\t\t\t\t<div class="info-row-count-current">\n\t\t\t\t\t<div class="info-row-count-header" q-translation="odag.toolbar.navpoint.popup.info.row.count.current.header" ></div>\n\t\t\t\t\t<div class="">{{actualRowEstFormatted}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="info-row-count-constraint">\n\t\t\t\t\t<div class="info-row-count-header" q-translation="odag.toolbar.navpoint.popup.info.row.count.constraint.header"></div>\n\t\t\t\t\t<div> < {{maxRowExpressionCountFormatted}}</div>\n\t\t\t\t</div>\n\t\t\t</div>\t\t\t\n\t\t</div>\t\n\t\t<div class="info-section" q-translation="odag.toolbar.navpoint.popup.info.field.header"></div>\n\t\t<div class="info-field-header">\n\t\t\t<div class="info-field" q-translation="odag.toolbar.navpoint.popup.info.field.table.header"></div>\n\t\t\t<div class="info-value" q-translation="odag.toolbar.navpoint.popup.info.current.table.header"></div>\n\t\t\t<div class="info-constraint" q-translation="odag.toolbar.navpoint.popup.info.constraint.table.header"></div>\n\t\t</div>\n\t\t<div class="info-field-values">\n\t\t\t<div ng-repeat="binding in bindings" class="info-field-row" ng-if="bindings.length">\n\t\t\t\t<div class="info-field-data">{{binding.fieldName}}</div>\n\t\t\t\t<div class="info-value-data">\n\t\t\t\t\t<div class="info-field-checkmark" ng-if="binding.bindingPassesConstraint">\n\t\t\t\t\t\t<span class="lui-icon  lui-icon--tick" aria-hidden="true"></span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="info-field-warning" ng-if="!binding.bindingPassesConstraint">\n\t\t\t\t\t<span class="lui-icon  lui-icon--warning-triangle" aria-hidden="true"></span>\n\t\t\t\t</div>\n\t\t\t\t<div>{{binding.values.length}}</div>\n\t\t\t</div>\n\t\t\t<div class="info-constraint-data">{{binding.constraint}}</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<lui-popover-footer>\n\t\t<lui-button ng-if="!expandedItem.item" class="info-button"  ng-class="{\'lui-button--danger\': bindingsPass, \'lui-active\': showInfoPopup}" x-variant="fade" ng-click="onNavPointInfoClicked($event)"><span class="lui-icon  lui-button__icon lui-icon--info"></span></lui-button>\n\t\t<lui-button ng-if="!expandedItem.item" tid="odag-toolbar-navpoint-popover_generate_app_button" ng-disabled="isGenerateBtnDisabled()" ng-click="onGenerateAppClicked()" q-translation="odag.toolbar.navpoint.popup.generate.app"></lui-button>\t\t\n\t</lui-popover-footer>\t\n</lui-popover>\n\n'}),define("general.utils/progressindicator-helper",["translator"],function(e){"use strict";function t(e){return"MessageCode."+(e||0)}function n(n){return e.get(t(n.qMessageCode),n.qMessageParameters)}return{translateMessage:n,translateMessageArray:function(e){var t="";if(e)for(var i in e)t+=n(e[i]),i<e.length-1&&(t+="\n");return t},formatNum:function(e){return(e=Math.floor(e))>9?""+e:"0"+e},filterOutDuplicates:function(e){var t,n,i=[],r=[];for(t in e)(n=e[t]).qErrorString&&n.qLine&&(r[n.qLine]=!0);for(t in e)!(n=e[t]).qErrorString&&r[n.qLine]||i.push(n);return i}}}),define("client.views/app-overview/directives/item-thumb/item-thumb-config",["general.utils/visualizations","core.utils/deferred"],function(e,t){function n(e){var t={};return t.width=e.width-e.numCols*e.spacing,t.height=e.height-e.numRows*e.spacing,t.columnWidth=t.width/e.numCols,t.rowHeight=t.height/e.numRows,t.cols=e.numCols,t.rows=e.numRows,t.spacing=e.spacing,t}function i(t,n,i){var r=i.colspan/n.cols*n.width+(i.colspan-2)*n.spacing,s=i.rowspan/n.rows*n.height+(i.rowspan-2)*n.spacing,a=n.spacing+n.columnWidth*i.col+n.spacing*i.col,l=n.spacing+n.rowHeight*i.row+n.spacing*i.row,c=r>=s?s:r;t.fillStyle="rgb(242, 242, 242)",t.fillRect(a,l,r,s),c=Math.round(.5*c),c=16*(c=Math.max(8,Math.min(c,20)))/26,t.fillStyle="rgba(89, 89, 89,0.6)",t.textAlign="center",t.textBaseline="middle",t.font=c*o+"px 'LUI icons'",t.fillText(e.getIconChar(i.type)||"g",a+r/2,l+s/2)}var r={width:144,height:96},o=2,s={staticSrc:{staticPublishedSheet:function(){return requirejs.toUrl("img/core/static/sheet-pub.png")},staticUnPublishedSheet:function(){return requirejs.toUrl("img/core/static/sheet.png")},staticPublishedStory:function(){return requirejs.toUrl("img/core/static/story-pub.png")},staticUnPublishedStory:function(){return requirejs.toUrl("img/core/static/story.png")},staticApp:function(){return requirejs.toUrl("img/core/static/app.png")},brokenImage:function(){return requirejs.toUrl("img/core/static/broken.png")}},dimensions:{original:r,width:r.width-2,height:r.height-2,spacing:2},getSrc:function(e,t){var n=t?"Sheet":"Story",i=e?"staticPublished":"staticUnPublished";return s.staticSrc[i+n]()},generateImageForStory:function(e,n){var i=new t;return n.get(e.item.qInfo.qId).then(function(t){t.getLayout().then(function(n){n.qChildList&&n.qChildList.qItems.length?(e.slide=n.qChildList.qItems.slice().sort(function(e,t){return e.qData.rank===t.qData.rank?0:e.qData.rank<t.qData.rank?-1:1})[0],e.slide?t.app.getObject(e.slide.qInfo.qId).then(function(e){e.getLayout().then(function(e){e.qChildList.qItems.length>0?i.resolve():i.reject()},i.reject)}):i.reject()):i.reject()})}),i.promise},paintCanvas:function(e){var t,r,a,l=document.createElement("canvas");return t=n({width:s.dimensions.width*o,height:s.dimensions.height*o,spacing:s.dimensions.spacing,numRows:e.qData.rows,numCols:e.qData.columns}),l.width=s.dimensions.width*o,l.height=s.dimensions.height*o,(r=l.getContext("2d")).clearRect(0,0,l.width,l.height),function(e){e.forEach(function(e){i(r,t,e)})}(e.qData.cells),a=l.toDataURL(),r=null,t=null,l.remove&&l.remove(),l=null,a}};return s}),define("client.views/odag-toolbar/odag-navpoint-service-ui",["qvangular","general.utils/progressindicator-helper","dragoman","client.views/app-overview/directives/item-thumb/item-thumb-config","translator"],function(e,t,n,i,r){e.service("odagNavpointServiceUI",["$timeout",function(e){function o(e,t){t.value=!0;for(var n=0;n<e.length;n++){var i="",o=e[n];if(o.selectedSize>1e4)t.value=!1,i=r.get("odag.toolbar.navpoint.popup.request.tab.xNumSelectedValues",o.selectedSize),o.valuesDisplayString=i;else{for(var s=0;s<o.values.length&&s<5;s++)s>0&&(i+=", "),i+=o.values[s].strValue;5===s&&o.values.length>5&&(i+=r.get("odag.toolbar.navpoint.popup.request.tab.moreSelectedValues",[o.values.length-5+""])),o.valuesDisplayString=i}}}return{createGeneratedAppWrapper:function(e,i){function s(e){var t="";if(Intl&&Intl.DateTimeFormat){var i={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"};t=Intl.DateTimeFormat(n.locale.get(),i).format(e)}else t=n.format.date(e,{datetime:"medium"});return t}var a=s(new Date(e.modifiedDate)),l=null;e.loadState.finishedAt&&(l=s(new Date(e.loadState.finishedAt)));var c="",u=!1,h="",d="lui-icon--bin",p=r.get("odag.toolbar.navpoint.popup.tooltip.delete"),f=[],m=[],g=[];switch(h=e.generatedAppOrigName?e.generatedAppOrigName:"",e.generatedApp&&e.generatedApp.name&&(h=e.generatedApp.name),e.validation&&e.validation.contents&&e.validation.contents.forEach(function(e){f.push({id:f.length,message:e}),m.push({id:m.length,message:e})}),e.loadState.messages&&e.loadState.messages.progressData&&(e.loadState.messages.progressData.persistentProgressMessages&&e.loadState.messages.progressData.persistentProgressMessages.forEach(function(e){m.push({id:m.length,message:t.translateMessage(e)})}),e.loadState.messages.progressData.transientProgressMessage&&m.push({id:m.length,message:t.translateMessage(e.loadState.messages.progressData.transientProgressMessage)}),e.loadState.messages.progressData.errorData&&e.loadState.messages.progressData.errorData.forEach(function(e){g.push({id:g.length,message:e.qErrorString})})),e.state){case"validating":case"queued":case"loading":case"canceling":u=!0,c="",h=h||r.get("odag.toolbar.navpoint.popup.status.generating"),d="lui-icon--remove",p=r.get("odag.toolbar.navpoint.popup.tooltip.cancel"),"canceling"==e.state&&(d="",l=a=r.get("odag.toolbar.navpoint.popup.status.canceling"),p="");break;case"failed":c="warning",h=h||r.get("odag.toolbar.navpoint.popup.status.failed"),d="lui-icon--remove",p=r.get("odag.toolbar.navpoint.popup.tooltip.remove");break;case"canceled":c="",d="lui-icon--remove",p=r.get("odag.toolbar.navpoint.popup.tooltip.remove");break;case"succeeded":c="",h=e.generatedApp?e.generatedApp.name:"",d="lui-icon--bin",p=r.get("odag.toolbar.navpoint.popup.tooltip.delete")}var v={value:!1};return e.selectionState&&o(e.selectionState,v),{name:h,createdDate:e.createdDate,requestId:e.id,owner:e.owner,lastLoadedTime:l,generatedAppId:e.generatedApp?e.generatedApp.id:null,published:!!e.generatedApp&&e.generatedApp.published,publishToStreamName:e.publishToStreamName?e.publishToStreamName:r.get("odag.toolbar.navpoint.popup.request.tab.info.notPublished"),targetSheet:e.targetSheet,timestamp:a,status:c,state:e.state,loading:u,parentContext:i,deleteIcon:d,deleteIconTooltip:p,actionInProgress:!1,statusMessageArray:m,selectionsState:e.selectionState,canApplySelections:v.value,progressErrors:g}},updateImageOnItemHeader:function(t){var n=new Image,r=t.templateThumbnail;r&&(n.src=r,n.onerror=function(){t.imgSrc=i.staticSrc.staticApp()},n.onload=function(){e(function(){t.imgSrc=r})})}}}])}),define("text!general.services/delayed-modal/delayed-modal.ng.html",[],function(){return'<div class="lui-dialog error-dialog" on-close-view="closeView( $event )" qv-escape="handleEscButton( $event )" ng-style="modalStyle" tid="errorDialog">\n\t<div class="lui-dialog__header">\n\t\t<div class="lui-dialog__title" ng-if="title" q-translation="{{title}}"></div>\n\t</div>\n\t<div class="lui-dialog__body dm-main">\n\n\t\t<main ng-if="!html">{{content | translate}}</main>\n\t\t<main ng-if="html" class="qv-appname"></main>\n\n\t</div>\n\n\t<div class="lui-dialog__footer">\n\t\t<lui-button qv-delayed-dialog-button ng-if="!buttons.length && showDefaultButton" ng-click="closeModal( $event, true );" qva-focus="true"\n\t\t\t\t\tq-translation="Common.OK" tid="confirm"></lui-button>\n\t\t<lui-button qv-delayed-dialog-button ng-repeat="button in buttons" qva-focus="button.defaultButton" ng-click="closeModal( $event );" ng-disabled="button.expression === false"\n\t\t\t\t\tq-translation="{{button.name}}" tid="{{button.tid}}"></lui-button>\n\t</div>\n</div>'}),define("general.services/delayed-modal/delayed-modal",["jquery","core.utils/deferred","qvangular","text!general.services/delayed-modal/delayed-modal.ng.html","angular"],function(e,t,n,i){var r,o=window.angular,s={"max-height":"90%","max-width":"90%","min-height":"180px",width:"400px"},a=!1,l=!1;n.directive("qvDelayedDialogButton",function(){return{replace:!0,restrict:"A",link:function(e){e.button&&e.button.defaultEscButton&&(r=e),e.closeModal=function(t,n){t&&(t.preventDefault(),t.stopPropagation()),e.button&&e.button.callback&&(void 0===e.button.expression||e.button.expression)&&e.button.callback(),(n||e.autoClose||e.button&&!e.button.callback)&&e.destroyModal()}}}}),n.service("$delayedModal",["$compile","$rootScope","$document",function(n,c,u){var h,d,p,f,m,g={},v=i,y={open:function(e){var i,y=new t;h&&(d=h,f=p),h=c.$new(),p=o.element('<div class="qv-modal-container qui-modalbackground-centered" qva-outside-ignore-for="allOutside" ng-style="containerStyle" ng-class="classes"></div>'),h.containerStyle={content:" "},h.classes={},h.modalStyle={};for(var b in s)h.modalStyle[b]=s[b];h.wasDisabled=[],h.showDefaultButton=!0,a=!0,l=!1,g=e,h.failed=!1,h.autoClose=!0;for(b in g)h[b]=g[b];return p.html(v).appendTo(u.find("body")),h.html&&p.find("main").append(h.html),i=h.$watch("element",function(){y.resolve(),i()}),m=n(p)(h),h.destroyModal=this.close.bind(this),h.handleEscButton=function(e){e&&(e.preventDefault(),e.stopPropagation()),h.buttons&&r?r&&r.closeModal():h.destroyModal()},h.$broadcast("delayed-modal-opened"),h.$watchCollection("[width, height]",function(){h.width&&(h.modalStyle.width=h.width),h.height&&(h.modalStyle.height=h.height)}),y.promise},update:function(e){if(a){for(var t in e)h[t]=e[t],g[t]=e[t];(e.html||e.buttons)&&(p.html(v),p.find("main").html(e.html),u.find("body").find(".qui-delayedModal").replaceWith(p.html()),m=n(p)(h))}},close:function(){h&&p&&(h.$broadcast("delayed-modal-closed"),p.remove(),h.$destroy(),h=d||null,p=f||null,d=f=null),a=!1,l=!1},lock:function(){l=!0,h.wasDisabled.length=0,m.find("button, input, textarea, select").each(function(){var t=e(this);t.prop("disabled")?h.wasDisabled.push(this):t.prop("disabled",!0)})},unlock:function(){l=!1,m.find("button, input, textarea, select").each(function(){-1===h.wasDisabled.indexOf(this)&&e(this).prop("disabled",!1)}),h.wasDisabled.length=0}};return Object.defineProperty(y,"isOpened",{get:function(){return a}}),Object.defineProperty(y,"isLocked",{get:function(){return l}}),Object.defineProperty(y,"scope",{get:function(){return h}}),y}])}),define("client.views/odag-toolbar/odag-navpoint-service",["qvangular","underscore","core.utils/deferred","translator","client.services/odag-data-service","./odag-navpoint-service-ui","general.services/delayed-modal/delayed-modal"],function(e,t,n,i,r){e.service("odagNavpointService",["$timeout","$delayedModal","odagNavpointServiceUI",function(e,o,s){function a(i,o,l,c){return l||(c=Date.now(),u[i.id]=c),u[i.id]&&c>=u[i.id]?r.getGeneratedAppsForLink(i.model.parent.app,i.model.parent.id,i.data.odagLinkRefID,i.id).then(function(n){n.forEach(function(e){var n=s.createGeneratedAppWrapper(e,i.model.parent),r=o.map(function(e){return e.requestId}).indexOf(e.id);if(r>-1){var a=o[r];t.chain(n).keys().every(function(e){return t.has(a,e)&&t.isEqual(n[e],a[e])}).value()||o.splice(r,1,n)}else o.push(n)});for(var r=o.length-1;r>-1;r--){var l=o[r];n.some(function(e){return e.id===l.requestId})||o.splice(r,1)}if(o.sort(function(e,t){var n=new Date(e.createdDate);return new Date(t.createdDate)-n}),o.some(function(e){return e.loading}))return e(function(){a(i,o,!0,c)},3e3);delete u[i.id]}):n.resolve()}function l(e){var t=i.get("Common.None");return e.range&&(e.range.lowerBound&&e.range.lowerBound===e.range.upperBound?t=e.range.lowerBound:void 0===e.range.lowerBound||e.range.upperBound?void 0===e.range.upperBound||e.range.lowerBound?void 0!==e.range.lowerBound&&void 0!==e.range.upperBound&&(t="["+e.range.lowerBound+" - "+e.range.upperBound+"]"):t="<="+e.range.upperBound:t=">="+e.range.lowerBound),t}function c(e,t){var n=!0;return e.range&&(e.range.lowerBound&&e.range.lowerBound===e.range.upperBound?n=e.range.lowerBound===t.length:void 0===e.range.lowerBound||e.range.upperBound?void 0===e.range.upperBound||e.range.lowerBound?void 0!==e.range.lowerBound&&void 0!==e.range.upperBound&&(n=t.length>=e.range.lowerBound&&t.length<=e.range.upperBound):n=t.length<=e.range.upperBound:n=t.length>=e.range.lowerBound),n}var u={},h={SUCCEEDED:"succeeded",FAILED:"failed",VALIDATING:"validating",QUEUED:"queued",LOADING:"loading",CANCELING:"canceling",CANCELED:"canceled"},d=[h.SUCCEEDED,h.FAILED,h.CANCELED];return{ODAG_STATE:h,ODAG_TERMINAL_STATES:d,updateItemHeader:function(e,t){return s.updateImageOnItemHeader(t),e.getLoadedLinkInfo(e).then(function(e){e.templateApp?(t.templateName=e.templateApp.name,t.templateDescription=e.templateApp.description,e.templateApp.thumbnail&&("/"===e.templateApp.thumbnail.substr(0,1)&&(e.templateApp.thumbnail=e.templateApp.thumbnail.substr(1)),t.templateThumbnail=requirejs.toUrl("../"+e.templateApp.thumbnail)),s.updateImageOnItemHeader(t)):(t.invalid=!0,t.templateName=i.get("odag.toolbar.navpoint.popup.noTemplate"),t.templateDescription="")})},loadGeneratedApps:a,stopLoadGeneratedApps:function(e){delete u[e.id]},deleteGeneratedApp:function(e){switch(e.state){case h.SUCCEEDED:var t=i.get("odag.toolbar.navpoint.popup.delete.confirmation",[e.name]),s=new n;return o.open({title:i.get("odag.toolbar.navpoint.popup.delete.confirmation.title"),content:t,buttons:[{name:"Common.Cancel",callback:function(){s.resolve()}},{name:"Common.Delete",defaultButton:!0,callback:function(){return r.deleteGenApp(e.parentContext.app,e.requestId).then(function(){s.resolve()})}}]}),s.promise;case h.FAILED:return r.requestAction(e.parentContext.app,e.requestId,r.ODAGRequestActionConst.FAIL_ACK,!0,!0);case h.VALIDATING:case h.QUEUED:case h.LOADING:case h.CANCELING:var a=!0,l=!0;return e.lastLoadedTime&&(a=!1,l=!1),r.requestAction(e.parentContext.app,e.requestId,r.ODAGRequestActionConst.CANCEL,a,l);case h.CANCELED:return r.requestAction(e.parentContext.app,e.requestId,r.ODAGRequestActionConst.CANCEL_ACK,!0,!0)}},reloadApp:function(e,t,n){return e.getLoadedLinkInfo(e).then(function(i){return r.reloadApp(e.model.parent.app,i,t,n,e.actualRowEst)})},generateApp:function(e){return e.getLoadedLinkInfo(e).then(function(t){return r.generateApp(e.model.parent.app,e.model.parent.id,t,e.id,e.actualRowEst)})},renameGenApp:function(e,t,n){return r.renameGenApp(e,t,n)},applySelections:function(e){var t=e.parentContext.app;return r.clearSelections(t).then(function(){for(var i=[],o=0;o<e.selectionsState.length;o++){var s=e.selectionsState[o],a=s.selectionAppParamName,l=s.values;i.push(r.selectFieldValuesForField(t,a,l))}return n.all(i)})},initializeBindings:function(e,t){t.length=0,e.getLoadedLinkInfo(e).then(function(n){r.getAllFieldBindingValues(e.model.parent.app,n.bindings).then(function(e){for(var i=0;i<n.bindings.length;i++){var r=e[i],o={fieldName:n.bindings[i].selectAppParamName,values:r.fieldValues,constraint:l(n.bindings[i]),bindingPassesConstraint:c(n.bindings[i],r.fieldValues)};t.push(o)}})})}}}])}),define("client.views/app-overview/rename-service",[],function(){"use strict";return{allowedChars:function(e){var t=/^[^\\\/:\*\t\?"<>\|]+$/,n=!0;return e.length&&(n=t.test(e)),n},emptyTitle:function(e){return 0===e.length||0===e.replace(/\n|\t|\s|\u200B|\uFEFF|\xA0/g,"").length}}}),define("text!client.views/odag-toolbar/odag-request-menu.ng.html",[],function(){return'<lui-popover x-variant="{{::variant}}" x-arrow="arrow" qva-outside-ignore-for="allOutside">\n\t<lui-popover-body class="lui-nopad">\n\t\t<ul class="lui-list odag-request-menu">\n\t\t\t<li class="lui-list__item" style="cursor: pointer" ng-disabled="!canOpenApp()" ng-click="openApp( $event )" tid="openAppFromMenu">\n\t\t\t\t<span class="lui-list__text lui-list__action"\n\t\t\t\t\tq-translation="odag.toolbar.navpoint.popup.request.menu.openApp">\n\t\t\t\t</span>\n\t\t\t</li>\n\t\t\t<li class="lui-list__item" style="cursor: pointer" ng-disabled="!canReloadApp()" ng-click="reloadApp( $event )" tid="reloadFromRequestMenu">\n\t\t\t\t<span class="lui-list__text lui-list__action"\n\t\t\t\t\tq-translation="odag.toolbar.navpoint.popup.request.reload">\n\t\t\t\t</span>\n\t\t\t</li>\t\t\t\n\t\t\t<li class="lui-list__item" style="cursor: pointer" ng-click="deleteApp( $event )" tid="deleteAppFromMenu">\n\t\t\t\t<span class="lui-list__text lui-list__action"\n\t\t\t\t\tq-translation="odag.toolbar.navpoint.popup.request.menu.deleteApp">\n\t\t\t\t</span>\n\t\t\t</li>\n\t\t</ul>\n\t</lui-popover-body>\n</lui-popover>'}),define("text!client.views/odag-toolbar/odag-request-reload-menu.ng.html",[],function(){return'<lui-popover x-variant="{{::variant}}" x-arrow="arrow" qva-outside-ignore-for="allOutside">\n\t<lui-popover-body class="lui-nopad">\n\t\t<ul class="lui-list odag-request-menu">\n\t\t\t<li class="lui-list__item" style="cursor: pointer" ng-disabled="!canReloadApp()" ng-click="reloadApp( $event )" tid="reloadFromMenu">\n\t\t\t\t<span class="lui-list__text lui-list__action"\n\t\t\t\t\tq-translation="odag.toolbar.navpoint.popup.request.reload">\n\t\t\t\t</span>\n\t\t\t</li>\n\t\t\t<li class="lui-list__item" style="cursor: pointer" ng-disabled="!canApplySelectionsReloadApp()" ng-click="applySelectionsReloadApp( $event )" tid="applySelectionsReloadFromMenu">\n\t\t\t\t<span class="lui-list__text lui-list__action"\n\t\t\t\t\tq-translation="odag.toolbar.navpoint.popup.request.applySelections.reload">\n\t\t\t\t</span>\n\t\t\t</li>\n\t\t\t<li class="lui-list__item" style="cursor: pointer" ng-disabled="!canApplySelectionsReloadApp()" ng-click="copyApplySelectionsReloadApp( $event )" tid="copyApplySelectionsReloadFromMenu">\n\t\t\t\t<span class="lui-list__text lui-list__action"\n\t\t\t\t\tq-translation="odag.toolbar.navpoint.popup.request.copyAndApplySelections.reload">\n\t\t\t\t</span>\n\t\t\t</li>\n\t\t</ul>\n\t</lui-popover-body>\n</lui-popover>'}),define("text!client.views/odag-toolbar/odag-app-list2.ng.html",[],function(){return'<div class="odag-app-list2" ng-class="$ctrl.variant">\n\t<div ng-if="$ctrl.applist.length === 0 && !$ctrl.loading" class="description">{{$ctrl.helpTextNoGeneratedApps}}</div>\n\t<ul ng-if="$ctrl.applist.length && !$ctrl.loading && !$ctrl.expandedItem.item" class="generated-apps-list">\n\t\t<li ng-repeat="genAppitem in $ctrl.applist" class="list-item" ng-click="$ctrl.rowClicked(genAppitem)">\n\t\t\t<div class="generated-app-item request-header">\n\t\t\t\t<div class="request-first">\n\t\t\t\t\t<div class="expander lui-icon lui-icon--triangle-right"></div>\n\t\t\t\t\t<div class="request-name-timestamp-area">\n\t\t\t\t\t\t<div class="request-first-top-line">\t\t\t\t\t\t\n\t\t\t\t\t\t\t<div class="name" title="{{genAppitem.name}}" ng-class="{\'generating\': genAppitem.state === \'validating\' || genAppitem.state === \'queued\' || genAppitem.state === \'loading\' || genAppitem.state === \'canceling\'}">{{genAppitem.name}}</div>\n\t\t\t\t\t\t</div>\t\n\t\t\t\t\t\t<div class="request-first-bottom-line timestamp">{{genAppitem.lastLoadedTime ? genAppitem.lastLoadedTime : genAppitem.timestamp }}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="request-second">\n\t\t\t\t\t<button class="status-button lui-fade-button" qva-outside-ignore-for="allOutside" ng-click="$ctrl.statusClicked($event, genAppitem)">\n\t\t\t\t\t\t<span ng-hide="genAppitem.loading" class="lui-fade-button__icon lui-icon lui-icon--{{genAppitem.status}}"></span>\n\t\t\t\t\t\t<div ng-if="genAppitem.loading" class="genAppLoading qv-loader"></div>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button ng-if="genAppitem.state === \'validating\' || genAppitem.state === \'queued\' || genAppitem.state === \'loading\'" class="lui-fade-button" title={{genAppitem.deleteIconTooltip}} ng-click="$ctrl.deleteClicked($event, genAppitem)">\n\t\t\t\t\t  <span class="lui-fade-button__icon  lui-icon lui-icon--remove"></span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button ng-if="!$ctrl.requestInProgress( genAppitem )" class="lui-fade-button" q-title-translation="odag.toolbar.navpoint.popup.request.moreMenu.tooltip" ng-click="$ctrl.moreMenuClicked($event, genAppitem)" ng-class="{\'lui-active\': $ctrl.moreMenuPopupItem === genAppitem}">\n\t\t\t\t\t  <span class="lui-fade-button__icon  lui-icon lui-icon--more"></span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button ng-if="!$ctrl.requestInProgress( genAppitem )" ng-disabled="!(genAppitem.state === \'succeeded\' || genAppitem.state === \'failed\' || genAppitem.state === \'canceled\') || !genAppitem.generatedAppId" class="lui-fade-button" q-title-translation="{{ $ctrl.openAppCallback ? \'odag.toolbar.navpoint.popup.request.openApp.generic.tooltip\' : \'odag.toolbar.navpoint.popup.request.openApp.tooltip\'}}" ng-click="$ctrl.openAppClicked($ctrl, $event, genAppitem)">\n\t\t\t\t\t  <span class="lui-fade-button__icon  lui-icon icon--openapp"></span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\t\t\t\n\t\t</li>\n\t</ul>\n\t<div ng-if="$ctrl.expandedItem.item" class="gen-item-expand" qva-outside="$ctrl.onOutsideClick( $event )">\n\t\t<div class="details-container">\n\t\t\t<div class="request-header" ng-click="$ctrl.rowClicked(null)">\n\t\t\t\t<div class="request-first">\n\t\t\t\t\t<div class="expander lui-icon lui-icon--triangle-bottom"></div>\n\t\t\t\t\t<div class="request-name-timestamp-area">\n\t\t\t\t\t\t<div class="request-first-top-line">\n\t\t\t\t\t\t\t<div class="name" title="{{$ctrl.expandedItem.item.name}}" ng-class="{\'generating\': $ctrl.expandedItem.item.state === \'validating\' || $ctrl.expandedItem.item.state === \'queued\' || $ctrl.expandedItem.item.state === \'loading\' || $ctrl.expandedItem.item.state === \'canceling\'}">{{$ctrl.expandedItem.item.name}}</div>\t\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="request-first-bottom-line timestamp" >{{$ctrl.expandedItem.item.lastLoadedTime ? $ctrl.expandedItem.item.lastLoadedTime : $ctrl.expandedItem.item.timestamp }}</div>\n\t\t\t\t\t</div>\t\t\t\t\n\t\t\t\t</div>\n\t\t\t\t<div class="request-second">\n\t\t\t\t\t<button class="status-button lui-fade-button" qva-outside-ignore-for="allOutside" ng-clicks="$ctrl.statusClicked($event, $ctrl.expandedItem.item)">\n\t\t\t\t\t\t<span class="lui-fade-button__icon lui-icon lui-icon--{{$ctrl.expandedItem.item.status}}"></span>\n\t\t\t\t\t\t<div ng-if="$ctrl.expandedItem.item.loading" class="genAppLoading qv-loader"></div>\n\t\t\t\t\t</button>\t\t\t\t\t\t\t\t\n\t\t\t\t\t<button ng-if="$ctrl.expandedItem.item.state === \'validating\' || $ctrl.expandedItem.item.state === \'queued\' || $ctrl.expandedItem.item.state === \'loading\'" class="lui-fade-button" title={{$ctrl.expandedItem.item.deleteIconTooltip}} ng-click="$ctrl.deleteClicked($event, $ctrl.expandedItem.item)">\n\t\t\t\t\t  <span class="lui-fade-button__icon  lui-icon lui-icon--remove"></span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button ng-if="$ctrl.expandedItem.item.state === \'succeeded\' || $ctrl.expandedItem.item.state === \'failed\' || $ctrl.expandedItem.item.state === \'canceled\'" class="lui-fade-button" q-title-translation="{{ $ctrl.openAppCallback ? \'odag.toolbar.navpoint.popup.request.openApp.generic.tooltip\' : \'odag.toolbar.navpoint.popup.request.openApp.tooltip\'}}" ng-disabled="!($ctrl.expandedItem.item.state === \'succeeded\' || $ctrl.expandedItem.item.state === \'failed\' || $ctrl.expandedItem.item.state === \'canceled\') || !$ctrl.expandedItem.item.generatedAppId" ng-click="$ctrl.openAppClicked($ctrl, $event, $ctrl.expandedItem.item)">\n\t\t\t\t\t  <span class="lui-fade-button__icon  lui-icon icon--openapp"></span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\t\n\t\t\t</div>\n\t\t\t<div class="generateAppInput">\n\t\t\t\t<input class="lui-input" ng-disabled="$ctrl.generateAppInProgress || !$ctrl.expandedItem.item.generatedAppId || $ctrl.expandedItem.item.state === \'queued\' || $ctrl.expandedItem.item.state === \'loading\' || $ctrl.expandedItem.item.state === \'validating\' || $ctrl.expandedItem.item.state === \'canceling\'" ng-model="$ctrl.inputName" type="text" name="name" maxlength="255" ng-blur="$ctrl.onBlurGenAppName()" ng-change="$ctrl.validateAppName()" qv-enter="$ctrl.inputKeyEnter($event)" ng-class="{ \'lui-invalid\': !$ctrl.appNameValid }"/>\n\t\t\t</div>\n\t\t\t<div class="action-button-section">\n\t\t\t\t<div class="lui-buttongroup reload-button">\n\t\t\t\t\t<lui-button ng-disabled="!$ctrl.canReloadApp( $ctrl.expandedItem.item )" ng-click="$ctrl.reloadClicked($event, $ctrl.expandedItem.item)" q-translation="odag.toolbar.navpoint.popup.request.reload"></lui-button>\n\t\t\t\t\t<lui-button ng-disabled="!$ctrl.canReloadApp( $ctrl.expandedItem.item ) " class= "reload-drop"\n ng-click="$ctrl.onReloadMenuClicked( $event, $ctrl.expandedItem.item )">\n\t\t\t\t\t\t<span class="lui-icon lui-caret"></span>\t\t\t\t\t\t\n\t\t\t\t\t</lui-button>\n\t\t\t\t</div>\n\t\t\t\t<lui-button ng-disabled="$ctrl.expandedItem.item.state !== \'succeeded\' && $ctrl.expandedItem.item.state !== \'failed\' && $ctrl.expandedItem.item.state !== \'canceled\' " class="delete-button" ng-click="$ctrl.deleteClicked($event, $ctrl.expandedItem.item)" ><span class="lui-icon  lui-button__icon lui-icon--bin"></span></lui-button>\n\t\t\t</div>\n\n\t\t\t<div class="tab-section">\n\t\t\t\t<div class="tab-header">\n\t\t\t\t\t<ul class="lui-tabset lui-tabset--fill">\n\t\t\t\t\t\t<li class="lui-tab" tabindex="0" ng-class="{\'lui-active\': $ctrl.selectedTab === \'info\' }" ng-click="$ctrl.selectTab(\'info\')">\n\t\t\t\t\t\t\t<span class="lui-tab__text tab-label" q-translation="odag.toolbar.navpoint.popup.request.tab.info"></span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="lui-tab" tabindex="0" ng-class="{\'lui-active\': $ctrl.selectedTab === \'selections\' }" ng-click="$ctrl.selectTab(\'selections\')">\n\t\t\t\t\t\t\t<span class="lui-tab__text tab-label" q-translation="odag.toolbar.navpoint.popup.request.tab.selections"></span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t\t<li class="lui-tab" tabindex="0" ng-class="{\'lui-active\': $ctrl.selectedTab === \'status\' }" ng-click="$ctrl.selectTab(\'status\')">\n\t\t\t\t\t\t\t<span class="lui-tab__text tab-label" q-translation="odag.toolbar.navpoint.popup.request.tab.status"></span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t\t<div class="tab-contents">\n\t\t\t\t\t<div class="tab-content selection-tab" ng-if="$ctrl.selectedTab === \'selections\'">\n\t\t\t\t\t\t<div class="info-section selection-tab-top">\n\t\t\t\t\t\t\t<div class="info-text" q-translation="odag.toolbar.navpoint.popup.request.tab.selections.helpText"></div>\n\t\t\t\t\t\t\t<div class="apply-selections-button">\n\t\t\t\t\t\t\t\t<lui-button ng-disabled="($ctrl.expandedItem.item.state !== \'succeeded\' && $ctrl.expandedItem.item.state !== \'failed\' && $ctrl.expandedItem.item.state !== \'canceled\') || $ctrl.applyInProgress" ng-if="$ctrl.expandedItem.item.canApplySelections" ng-click="$ctrl.applySelectionsClicked($ctrl.expandedItem.item)" q-translation="Common.Apply"></lui-button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="selections-field-header">\n\t\t\t\t\t\t\t<div class="selections-field" q-translation="odag.toolbar.navpoint.popup.request.tab.selections.field"></div>\n\t\t\t\t\t\t\t<div class="selections-value" q-translation="odag.toolbar.navpoint.popup.request.tab.selections.values"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="selections-field-values">\n\t\t\t\t\t\t\t<div ng-if="$ctrl.expandedItem.item.selectionsState && $ctrl.expandedItem.item.selectionsState.length" ng-repeat="selection in $ctrl.expandedItem.item.selectionsState" class="selections-field-row">\n\t\t\t\t\t\t\t\t<div class="selections-field-data">{{selection.selectionAppParamName}}</div>\n\t\t\t\t\t\t\t\t<div class="selections-value-data">{{selection.valuesDisplayString}}</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div ng-if="!$ctrl.expandedItem.item.selectionsState" q-translation="odag.toolbar.navpoint.popup.request.tab.noSelectedValues"> </div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="selections-no-selections" ng-if="$ctrl.expandedItem.item.selectionsState && $ctrl.expandedItem.item.selectionsState.length === 0" q-translation="odag.toolbar.navpoint.popup.request.tab.selections.noselections" >\n\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tab-content" ng-if="$ctrl.selectedTab === \'info\'">\n\t\t\t\t\t\t<div class="info-section">\n\t\t\t\t\t\t\t<div class="info-section-label" q-translation="odag.toolbar.navpoint.popup.request.tab.info.status"></div>\n\t\t\t\t\t\t\t<div class="info-section-value" q-translation="odag.toolbar.navpoint.popup.request.tab.status.{{$ctrl.expandedItem.item.state}}"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="info-section">\n\t\t\t\t\t\t\t<div class="info-section-label" q-translation="odag.toolbar.navpoint.popup.request.tab.info.appOwner"></div>\n\t\t\t\t\t\t\t<div class="info-section-value">{{$ctrl.expandedItem.item.owner.userDirectory}}\\{{$ctrl.expandedItem.item.owner.userId}} ({{$ctrl.expandedItem.item.owner.name}})</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="info-section">\n\t\t\t\t\t\t\t<div class="info-section-label" q-translation="odag.toolbar.navpoint.popup.request.tab.info.publishToStream"></div>\n\t\t\t\t\t\t\t<div class="info-section-value"> {{$ctrl.expandedItem.item.publishToStreamName}} </div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tab-content odag-request-status-content" ng-if="$ctrl.selectedTab === \'status\'">\n\t\t\t\t\t\t<div class="info-section">\n\t\t\t\t\t\t\t<div class="info-section-label" q-translation="odag.toolbar.navpoint.popup.request.tab.info.lastCompletedRun"></div>\n\t\t\t\t\t\t\t<div class="info-section-value">{{$ctrl.expandedItem.item.lastLoadedTime ? $ctrl.expandedItem.item.lastLoadedTime : \'Common.None\' | translate }}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div ng-repeat="message in $ctrl.expandedItem.item.statusMessageArray" class="info-field-row" ng-if="$ctrl.expandedItem.item.statusMessageArray.length" ng-bind="message.message"></div>\n\t\t\t\t\t\t<div ng-repeat="error in $ctrl.expandedItem.item.progressErrors" class="info-field-row info-field-row-error" ng-if="$ctrl.expandedItem.item.progressErrors.length" ng-bind="error.message"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>'}),define("client.views/odag-toolbar/odag-app-list2",["qvangular","jquery","translator","client.views/app-overview/rename-service","text!./odag-request-menu.ng.html","text!./odag-request-reload-menu.ng.html","text!./odag-app-list2.ng.html","client.views/odag-toolbar/odag-navpoint-service"],function(e,t,n,i,r,o,s){e.nativeComponent("odagAppList2",{bindings:{applist:"<",loading:"<",deleteClicked:"<",isGenerateBtnDisabled:"<",isHeaderInvalid:"<",loadGeneratedApps:"<",onApplySelectionsCallback:"<",openAppCallback:"<",reloadApp:"<",generateAppInProgress:"=",expandedItem:"=",variant:"@"},controller:["$element","$timeout","luiPopover","odagNavpointService",function(e,s,a,l){var c=this;c.helpTextNoGeneratedApps=n.get("odag.toolbar.navpoint.popup.noApps"),c.selectedTab="info",c.moreMenuPopup=null,c.moreMenuPopupItem=null,c.reloadMenuPopup=null,c.inputName="",c.appNameValid=!0,c.applyInProgress=!1,c.openAppClicked=function(e,n,i){if(n.preventDefault(),n.stopPropagation(),e.openAppCallback&&t.isFunction(e.openAppCallback))e.openAppCallback(i.generatedAppId,i.targetSheet?i.targetSheet:null);else if(i.generatedAppId&&l.ODAG_TERMINAL_STATES.indexOf(i.state)>-1){var r;r=i.targetSheet?requirejs.toUrl("../sense/app/"+i.generatedAppId+"/sheet/"+i.targetSheet):requirejs.toUrl("../sense/app/"+i.generatedAppId),window.open(r)}},c.renameGenApp=function(e,t){l.renameGenApp(c.expandedItem.item.parentContext.app,e,t).then(function(){c.loadGeneratedApps()})},c.applySelectionsClicked=function(e){c.applyInProgress=!0,l.applySelections(e).then(function(){c.onApplySelectionsCallback&&c.onApplySelectionsCallback(),c.applyInProgress=!1})},c.$doCheck=function(){var e=this;if(this.applist&&this.expandedItem.item){var t=this.applist.filter(function(t){return t.requestId===e.expandedItem.item.requestId})[0];this.expandedItem.item=t||null}},c.moreMenuClicked=function(e,t){e.preventDefault(),e.stopPropagation(),c.moreMenuPopup?c.moreMenuPopup.close():(c.moreMenuPopupItem=t,c.moreMenuPopup=a.show({template:r,alignTo:e.target,variant:null,controller:["$scope",function(e){e.canOpenApp=function(){return t.generatedAppId&&l.ODAG_TERMINAL_STATES.indexOf(t.state)>-1},e.openApp=function(n){e.canOpenApp()&&(c.moreMenuPopup.close(),c.openAppClicked(c,n,t))},e.canReloadApp=function(){return c.canReloadApp(t)},e.reloadApp=function(n){if(n.preventDefault(),n.stopPropagation(),e.canReloadApp())return c.moreMenuPopup.close(),c.reloadApp(t)},e.deleteApp=function(e){e.preventDefault(),e.stopPropagation(),c.moreMenuPopup.close(),c.deleteClicked(e,t)}}],closeOnResize:!0,closeOnEscape:!0}),c.moreMenuPopup.closed.then(function(){c.moreMenuPopup=null,c.moreMenuPopupItem=null}))},c.onOutsideClick=function(){c.expandedItem.item=null},c.rowClicked=function(e){c.moreMenuPopup&&c.moreMenuPopup.close(),c.reloadMenuPopup&&c.reloadMenuPopup.close(),c.expandedItem.item=e,c.expandedItem.item&&(c.inputName=c.expandedItem.item.name)},c.reloadClicked=function(e,t){e.preventDefault(),e.stopPropagation(),c.reloadApp(t)},c.requestInProgress=function(e){var t=!1;switch(e.state){case l.ODAG_STATE.VALIDATING:case l.ODAG_STATE.QUEUED:case l.ODAG_STATE.LOADING:case l.ODAG_STATE.CANCELING:t=!0}return t},c.canReloadApp=function(e){return e&&!c.isHeaderInvalid&&!c.generateAppInProgress&&!c.requestInProgress(e)},c.validateAppName=function(){var e=!0;c.inputName?i.allowedChars(c.inputName)||(e=!1):e=!1,c.appNameValid=e},c.statusClicked=function(e,t){e.preventDefault(),e.stopPropagation(),c.moreMenuPopup&&c.moreMenuPopup.close(),c.reloadMenuPopup&&c.reloadMenuPopup.close(),c.expandedItem.item===t?c.expandedItem.item=null:(c.selectedTab="status",c.expandedItem.item=t,c.scrollIfNecessary())},c.selectTab=function(e){c.selectedTab=e,c.scrollIfNecessary()},c.inputKeyEnter=function(e){e.target.blur()},c.onBlurGenAppName=function(){c.appNameValid?c.renameGenApp(c.expandedItem.item.requestId,c.inputName):(c.inputName=c.expandedItem.item.name,c.validateAppName())},c.scrollIfNecessary=function(){"status"===c.selectedTab&&s(function(){var n=t(e.find(".tab-contents"));n.scrollTop(n[0].scrollHeight)})},c.onReloadMenuClicked=function(e,t){e.preventDefault(),e.stopPropagation(),c.reloadMenuPopup?c.reloadMenuPopup.close():(c.reloadMenuPopup=a.show({template:o,alignTo:e.target,variant:null,controller:["$scope",function(e){e.canReloadApp=function(){return c.canReloadApp(t)},e.reloadApp=function(n){if(n.preventDefault(),n.stopPropagation(),e.canReloadApp())return c.reloadMenuPopup.close(),c.reloadApp(t)},e.canApplySelectionsReloadApp=function(){return!c.isGenerateBtnDisabled()},e.applySelectionsReloadApp=function(n){n.preventDefault(),n.stopPropagation(),e.canApplySelectionsReloadApp()&&(c.reloadMenuPopup.close(),c.reloadApp(t,1))},e.copyApplySelectionsReloadApp=function(n){n.preventDefault(),n.stopPropagation(),e.canApplySelectionsReloadApp()&&(c.reloadMenuPopup.close(),c.reloadApp(t,2))}}],closeOnResize:!0,closeOnEscape:!0}),c.reloadMenuPopup.closed.then(function(){c.reloadMenuPopup=null}))}}],template:s})}),define("text!assets/hldm/directives/circle-chart/circle-chart.ng.html",[],function(){return'<div class="ds-visualization-circle-chart">\n\t<div class="chart-heading">{{ model.header }}</div>\n\n\t<div class="circular-bar">\n\t\t<svg version="1.1" xmlns="http://www.w3.org/2000/svg" ng-style="svgPos">\n\t\t\t<g class="arcs">\n\t\t\t\t<circle ng-attr-cx="{{radius}}" ng-attr-cy="{{radius}}" ng-attr-r="{{radius}}" class="outer-circle" />\n\t\t\t\t <path ng-attr-d="{{arcValue}}" class="outer-arc" tid="circle-chart-arc1" /> \n\t\t\t\t<circle ng-attr-cx="{{radius}}" ng-attr-cy="{{radius}}" ng-attr-r="{{radius - 10}}" class="inner-circle"  />\n\t\t\t</g>\n\t\t\t<text ng-attr-x="{{percentagePos.x}}" ng-attr-y="{{percentagePos.y}}" class="percentage-label">{{ chartPercentageValue }}</text>\n\t\t\t<text ng-attr-x="{{subtextPos.x}}" ng-attr-y="{{subtextPos.y}}" class="percentage-subtext-label">{{ model.chartValueSubText }}</text>\n\t\t</svg>\n\t</div>\n\n\t<div class="chart-footer">{{ model.footer }}</div>\n</div>\n\n'}),define("assets/hldm/directives/circle-chart/circle-chart",["qvangular","dragoman","text!./circle-chart.ng.html","assets/hldm/Constants","translator"],function(e,t,n,i,r){e.directive("circleChart",function(){return{scope:{model:"="},restrict:"E",replace:!0,template:n,controller:["$scope","$element","$timeout",function(e,n,o){function s(){if(h()){var t=d.height(),n=d.width();t<n?(e.radius=t/2,e.svgPos={height:t,width:t,top:0,left:n/2-t/2}):(e.radius=n/2,e.svgPos={height:n,width:n,top:t/2-n/2,left:0})}u()}function a(e,t,n,i){var r=(i-90)*Math.PI/180;return{x:e+n*Math.cos(r),y:t+n*Math.sin(r)}}function l(e,t,n,i,r){var o=a(e,t,n,r),s=a(e,t,n,i),l=r-i<=180?"0":"1";return["M",o.x,o.y,"A",n,n,0,l,0,s.x,s.y].join(" ")}function c(e){return 3.6*e}function u(){var n;if(e.model.chartValue?n=e.model.chartValue:e.model.numerator&&e.model.denominator&&(n=0===e.model.denominator?0:e.model.numerator/e.model.denominator,n*=100),n>0&&n<1){var i=t.format.number(0,{style:"percent"});e.chartPercentageValue=r.get("CircleChart.ChartPercentageValue.LessThanOne",i)}else e.chartPercentageValue=t.format.number(Math.round(n)/100,{style:"percent"});var o=e.radius,s=8,a=0;e.model.chartValueSubText&&(s=-3,a=17),e.percentagePos={x:o,y:o+s},e.subtextPos={x:o,y:o+a};var u=100===n?99.99:n;u||(u=0),e.arcValue=l(o,o,o-5,0,c(u))}function h(){return d.height()>0||d.width()>0}var d=n.find(".circular-bar");e.radius=50,e.arcValue="M50 0 A 50 50, 0, 0, 1, 0 0, L 50 50 z",e.$on(i.Events.EditorDetailsPane.ResizeChart,function(){s()}),e.$watch("model",function(){u()}),h()?s():o(function(){s()})}]}})}),define("client.views/odag-toolbar/odag-toolbar-navpoint-popover",["qvangular","translator","general.controllers/route-controller","text!general.services/loader/default-loader.ng.html","dragoman","text!./odag-toolbar-navpoint-popover.ng.html","client.views/odag-toolbar/odag-navpoint-service","client.views/odag-toolbar/odag-app-list2","assets/hldm/directives/circle-chart/circle-chart"],function(e,t,n,i,r,o){return{template:o,controller:["$scope","$element","$timeout","odagNavpointService",function(o,s,a,l){function c(){return l.updateItemHeader(o.item,o.header)}function u(){a.cancel(h),h=null,d.close()}var h,d=e.getService("qvLoader");o.odagNavpointService=l,o.loadingContent={value:!0},o.showInfoPopup=!1,o.generatedApps=[],o.bindings=[],o.expandedItem={item:null},o.generateAppInProgress=!1,o.bindingsPass=!0,o.maxGeneratedAppLimitReached=!1,o.dismissedMaxGenAppMsg=!1,o.dismissMaxGenAppMsgClicked=function(){o.dismissedMaxGenAppMsg=!0},o.isGenerateBtnDisabled=function(){return o.bindingsPass=o.bindings.filter(function(e){return!1===e.bindingPassesConstraint}).length>0,o.header.invalid||o.maxGeneratedAppLimitReached||o.bindingsPass||!o.item.rowCountPercentage||100!==o.item.rowCountPercentage||n.isSuffixInUse("noData")||o.generateAppInProgress},o.infoHeader=t.get("odag.toolbar.navpoint.popup.info.header"),o.circleModel={chartValue:o.item.rowCountPercentage?o.item.rowCountPercentage:0},o.$watchCollection("item.rowCountPercentageNumber",function(e){o.item.rowCountPercentage=-1===e?NaN:e,o.circleModel.chartValue=o.item.rowCountPercentage?o.item.rowCountPercentage:0}),o.header={invalid:!1,templateThumbnail:requirejs.toUrl("img/core/static/app.png"),templateName:t.get("Common.Loading"),templateDescription:t.get("Common.Loading")},o.loadGeneratedApps=function(){l.loadGeneratedApps(o.item,o.generatedApps).then(function(){o.loadingContent.value=!1,o.expandedItem.item&&(o.generatedApps.some(function(e){return o.expandedItem.item.requestId===e.requestId})||(o.expandedItem.item=null)),o.maxGeneratedAppLimitReached=o.generatedApps.length>=o.item.maxNumberOfApps,u()})},l.initializeBindings(o.item,o.bindings),(h=a(function(){d.close(!0).then(function(){d.show({template:i,hugeLoader:!1,mediumLoader:!0,appendTo:s.find(".odag-popup-body")[0]})})},0,!1)).then(function(){o.item.initialized.promise.then(function(){o.actualRowEstFormatted="NaN"===o.item.actualRowEst?t.get("odag.toolbar.navpoint.popup.invalid"):r.format.number(o.item.actualRowEst),o.maxRowExpressionCountFormatted=r.format.number(o.item.maxRowExpressionCount),c().finally(function(){o.loadGeneratedApps()})})}),o.onApplySelections=function(){l.initializeBindings(o.item,o.bindings)},o.onNavPointInfoClicked=function(e){e.preventDefault(),e.stopPropagation(),o.showInfoPopup=!o.showInfoPopup},o.deleteGenAppClicked=function(e,t){e.preventDefault(),e.stopPropagation(),o.showInfoPopup&&(o.showInfoPopup=!o.showInfoPopup),t.deleteIcon&&!t.actionInProgress&&(t.actionInProgress=!0,l.deleteGeneratedApp(t).then(function(){o.loadGeneratedApps(),o.expandedItem.item&&t.requestId===o.expandedItem.item.requestId&&(o.expandedItem.item=null),t.actionInProgress=!1}).catch(function(e){throw t.actionInProgress=!1,e}))},o.reloadApp=function(e,t){o.generateAppInProgress=!0,l.reloadApp(o.item,e.requestId,t).then(function(){2===t&&(o.expandedItem.item=null),o.loadGeneratedApps(),o.generateAppInProgress=!1}).catch(function(e){throw o.generateAppInProgress=!1,e})},o.onGenerateAppClicked=function(){o.generateAppInProgress=!0,o.showInfoPopup=!1,l.generateApp(o.item).then(function(){o.generateAppInProgress=!1,o.loadGeneratedApps()}).catch(function(e){throw o.generateAppInProgress=!1,e})},o.$on("$destroy",function(){l.stopLoadGeneratedApps(o.item),u()})}]}}),define("text!objects/progress-circle/progress-circle.ng.html",[],function(){return'<div class="progress-circle-container" ng-class="{\'full\': percentage === 100}">\n\t<svg class="progress-circle-svg" viewPort="0 0 0 0">\n\t\t<circle class="baseCircle" r="6" cx="8px" cy="8px" fill="transparent" stroke-dasharray="37.699" stroke-dashoffset="0"></circle>\n\t\t<circle class="whiteBar" r="6" cx="8px" cy="8px" fill="transparent" stroke-dasharray="37.699" stroke-dashoffset="0"></circle>\n\t\t<circle class="bar" r="6" cx="8px" cy="8px" fill="transparent" stroke-dasharray="37.699" stroke-dashoffset="0"></circle>\n\t</svg>\n</div>\n'}),define("objects/progress-circle/progress-circle",["qvangular","text!./progress-circle.ng.html"],function(e,t){e.directive("qvProgressCircle",function(){return{scope:{percentage:"="},restrict:"E",template:t,link:function(e,t){e.$watch("percentage",function(){var n=e.percentage,i=t.find(".progress-circle-svg .bar"),r=i.attr("r"),o=Math.PI*(2*r);if(isNaN(n))n=100,i.css({strokeDashoffset:o,fill:"#CCCCCC"});else{n<0&&(n=0),n>100&&(n=100);var s=(100-n)/100*o;i.css({strokeDashoffset:s}),100===e.percentage?i.css({fill:"#61a729"}):i.css({fill:"transparent"})}})},controller:["$scope",function(e){e.$on("$destroy",function(){})}]}})}),define("client.views/odag-toolbar/odag-toolbar-navpoint",["qvangular","core.utils/deferred","client.services/stage-state","general.controllers/route-controller","text!client.views/odag-toolbar/odag-toolbar-navpoint.ng.html","core.utils/resize","client.views/odag-toolbar/odag-toolbar-navpoint-popover","util","client.views/odag-toolbar/odag-toolbar-helper","general.components/pager/pager","objects/progress-circle/progress-circle"],function(e,t,n,i,r,o,s,a,l){var c={template:r,restrict:"E",replace:!0,scope:{inEditMode:"=",inMobileMode:"=",item:"="},controller:["$scope","$timeout","$element","luiPopover",function(e,r,c,u){function h(){if(e.popover)e.popover.close();else{var t={item:e.item};if(t.item.openAppCallback){var n=t.item.openAppCallback;t.item.openAppCallback=function(t,i){e.popover.close(),n(t,i)}}var i=s,r={input:t,dock:"top",alignTo:c[0],closeOnResize:!0};i=a.extend(!0,r,i),e.popover=u.show(i),e.popover.closed.then(function(){e.popover=null})}}function d(){var n=new t;if(f){var o=e.item;f.getLayout().then(function(t){o.actualRowEst=t.MaxRowCountExpression,i.isSuffixInUse("noData")&&(o.actualRowEst="NaN");var n=o.maxRowExpressionCount,s=100*Math.min(n/o.actualRowEst,1);s>=100?100!==e.rowCountPercentage?(e.rowCountPercentage=99,r(function(){e.rowCountPercentage=100,o.rowCountPercentage=100,o.rowCountPercentageNumber=100},300)):o.rowCountPercentage=100:(o.rowCountPercentage=s,e.rowCountPercentage=s),Number.isNaN(o.rowCountPercentage)?o.rowCountPercentageNumber=-1:o.rowCountPercentageNumber=o.rowCountPercentage}).finally(function(){n.resolve()})}else n.reject();return n.promise}function p(){e.item.getCurrentCountSessionObjectForLink().then(function(t){(f=t)&&f.Invalidated.bind(d),d().finally(function(){e.item.initialized.resolve()})})}e.popover=null,e.stageState=n,e.$watch("stageState.selectedObject",function(t){e.selObject=t});var f=null;e.rowCountPercentage=0,e.$watchCollection("item",function(e,n){null!==n&&null===e.initialized&&(e.initialized=new t,p())}),o.on("end",function(){e.popover&&e.popover.close()}),e.onODAGNavPointClicked=function(t){e.inMobileMode||(e.inEditMode?n.setSelectedObject(l.createSelectedObjFromNavPoint(t)):e.item.invalid||h())},e.deleteInvalidNavPoint=function(e,t){t.model.removeObject()},r(function(){e.$broadcast("refreshPager")}),e.$on("$destroy",function(){f&&f.Invalidated.unbind(d)})}]};return e.directive("qvOdagToolbarNavpoint",function(){return c}),c}),define("client.views/odag-toolbar/odag-toolbar",["jquery","qvangular","translator","client.utils/state","text!client.views/odag-toolbar/odag-toolbar.ng.html","general.sortable/sortable-item-lists","general.utils/support","core.utils/resize","client.services/odag-data-service","general.utils/drag-and-drop-service","client.views/odag-toolbar/odag-toolbar-service","client.views/sheet/sheet-service","client.views/odag-toolbar/odag-toolbar-navpoint","general.components/pager/pager"],function(e,t,n,i,r,o,s,a,l,c,u){function h(e){return{odagLinkItem:function(t){var n=t.item.getDropOption(),r={insertBeforeItem:e,title:n.args.init.linkRef.name,odagLinkRefID:n.args.init.linkRef.id},o=i.model;l.addODAGNavPoint(o,r)}}}function d(t,n){function i(e,t,n){var i={targetRect:n,drawRect:n,drop:h(t),dropShadePercentage:10};e.registerDropRect(i)}var r,o={accept:{odagLinkItem:function(){return!0}},end:function(){n.removeClass(r),t.dragging=!1},start:function(o){t.dragging=!0;var s;try{s=n[0].getBoundingClientRect()}catch(e){return}var a={left:s.left+2,right:s.right-2,top:s.top+2,bottom:s.bottom-2};r="odagLinkItem"===o.info.type?"dragging library-dragging":"dragging",n.addClass(r);for(var l=n.find(".dropArea"),c=0;c<l.length;c++){var u=e(l[c])[0].getBoundingClientRect(),h={left:u.left+2,right:u.right-2,top:u.top+2,bottom:u.bottom-2},d=null,p=t.odagNavPoints;c<p.items.length&&(d=p.items[c]),i(o,d,h)}var f=n.find(".odag-nav-point-cell:last"),m=a.left;f.length&&(m=f[0].getBoundingClientRect().right),i(o,null,{left:m,top:a.top,right:a.right,bottom:a.bottom})}};c.registerDropTarget(o),t.$on("$destroy",function(){c.unregisterDropTarget(o)})}var p={template:r,restrict:"E",scope:{model:"=",inEditMode:"=",standAlone:"="},link:function(e,t){d(e,t)},controller:["$scope","$timeout","$element","qvSheetService",function(e,t,r,c){e.sortableNavPoints=null;var h=e.standAlone?null:c;e.odagToolbarService=new u(h),e.dragging=!1,e.waterMarkText="";var d=null;l.isODAGAvailable(e.model.app).then(function(t){t&&l.getODAGLinks(e.model.app)}),e.sortableNavPoints=o.create({options:{direction:"horizontal",listKey:"list",listSelector:".list",itemKey:"item",itemSelector:".drag-odag-navpoint",itemDragSelector:".drag-odag-navpoint",gesture:{name:"swipe",options:{radiusThreshold:s.treatAsDesktop()?4:0,preventDefault:!1}}},allowDrag:function(){return this._super.apply(this,arguments)&&e.inEditMode},addPlaceholder:function(){this._super.apply(this,arguments)},onBegin:function(e){this._super.apply(this,arguments),(d=e).classList=["reordering"];var t=r.find(".list");t.css("height",t.innerHeight())},removePlaceholder:function(){this._super.apply(this,arguments),r.find(".list").css("height",""),d.classList=""},onMove:function(){this._super.apply(this,arguments);var t=e.odagNavPoints.get().map(function(e){return e.data}),n=i.model;l.reorderNavPoints(n,t)}}),e.odagNavPoints=e.sortableNavPoints.createList(1,{tid:"odagNavPoints"}),e.$watchCollection("odagToolbarService.getOdagNavPoints()",function(n){e.odagNavPoints.reset();for(var i=0;i<n.length;i++)e.odagNavPoints.addSortableItem(n[i]);t(function(){e.$broadcast("refreshPager")})}),e.$watch("model.sheetId",function(t){e.odagToolbarService.sheetChanged(t)}),e.$watch("dragging",function(t){e.waterMarkText=t?n.get("odag.toolbar.help.dragging"):n.get("odag.toolbar.help.watermark")}),e.odagToolbarService.init(e.model.app,e.model.openAppCallback).then(function(){e.waterMarkText=n.get("odag.toolbar.help.watermark")}),a.on("end",function(){e.refreshPager(!1)}),e.$on("$destroy",function(){e.odagToolbarService.destroy()})}]};return t.directive("qvOdagToolbar",function(){return p}),p}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{enumerable:!1,get:function(){var e=this.toString().match(/^function( (.*?))?\(/);return e&&e.length>=3?e[2]:"anonymous function"}}),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,i=function(){},r=function(){return n.apply(this instanceof i&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,r.prototype=new i,r}),Array.prototype.contains||Object.defineProperty(Array.prototype,"contains",{enumerable:!1,value:function(e){return-1!==this.indexOf(e)}}),"scrollX"in window.constructor.prototype||Object.defineProperties(window.constructor.prototype,{scrollX:{get:function(){return this.pageXOffset}},scrollY:{get:function(){return this.pageYOffset}}}),define("core.utils/augment",function(){}),define("extensions.qliktech/mapchart/FieldManager",["require","exports","general.models/field","general.models/library/dimension","_qlik"],function(e, t, n, i, r){"use strict";function o(e){return e.qTags.indexOf("$geopoint")>-1||e.qTags.indexOf("$geotag")>-1}function s(e){return e.qTags.indexOf("$geomultipolygon")>-1||e.qTags.indexOf("$geopolygon")>-1}function a(e){for(var t=e.qTags,n=t?t.length:0,i=[],r=0; r<n; r++)"$relates_"===t[r].substring(0,9)&&i.push(t[r].substring(9,t[r].length));return i}function l(e, t){for(var n=a(e),i=[],r=0; r<t.length; r++)n.indexOf(t[r].qName)>=0&&i.push(t[r]);return i}return function(){function e(){}return e.load=function(){n.getOnTheFlyWithHiddenList().then(function(e){return e.getLayout()}).then(function(t){e.fields=t}),i.getListLayout().then(function(t){e.dimensions=t})},e.loadTest=function(t,n){e.fields=t,e.dimensions=n},e.setDefaultLocation=function(t,n){var i=n.locationOrLatitude,r=t.qDef.qFieldDefs?t.qDef.qFieldDefs[0]:e.fieldNameFromDimension(t.qLibraryId),o=!1;if(r&&(0===i.key.trim().length||i.key===n.locationDefault)){var s=e.relatedFieldName(r,"AreaLayer"===n.type?"Area":"Point");s&&(i.key="["+s+"]",i.label=s,i.type="expression",n.locationDefault=s,o=!0)}o||0!==i.key.trim().length&&n.locationDefault!==i.key||(t.qDef.qFieldDefs?(i.key="["+r+"]",i.label=r,i.type="expression",n.locationDefault=r):(i.key=t.qLibraryId,i.label="",i.type="libraryItem",n.locationDefault=t.qLibraryId))},e.relatedFieldName=function(t,n){var i=e.findField(t);return i?e.relatedField(i,n):null},e.fieldNameFromDimension=function(t){for(var n in e.dimensions)if(e.dimensions[n].qInfo.qId===t)return e.getFirstField(e.dimensions[n]);return null},e.relatedFieldNameAsync=function(e,t){return n.getOnTheFlyWithHiddenList().then(function(e){return e.getLayout()}).then(function(n){for(var i in n){var a=n[i];if(a.qName===e){var c=l(a,n);for(var u in c){var h=c[u];if("Point"===t&&o(h)||"Area"===t&&s(h))return r.Promise.resolve(h.qName)}break}}return r.Promise.resolve(null)})},e.findField=function(t){for(var n in e.fields){var i=e.fields[n];if(i.qName===t)return i}return null},e.findDimension=function(t){for(var n in e.dimensions){var i=e.dimensions[n];if(i.qInfo.qId===t)return i}return null},e.relatedField=function(t,n){var i=l(t,e.fields);for(var r in i){var a=i[r];if("Point"===n&&o(a)||"Area"===n&&s(a))return a.qName}return null},e.relatedFieldTypes=function(t){var n=l(t,e.fields),i=[];for(var r in n){var a=n[r];o(a)&&i.push("Point"),s(a)&&i.push("Area")}return i},e.getFirstField=function(e){return e.qData.info[0].qName},e.getRecommendedLayerTypeByTags=function(t){var n=e.findField(t),i={PointLayer:!1,AreaLayer:!1};if(n){var r=e.relatedFieldTypes(n);(o(n)||r.indexOf("Point")>=0)&&(i.PointLayer=!0),(s(n)||r.indexOf("Area")>=0)&&(i.AreaLayer=!0)}return i},e.getDrillDownDimension=function(t){var n=e.findDimension(t).qData;return n.info.length>1?n:null},e.fieldContainsTags=function(t,n){var i=e.findField(t);if(i){for(var r in n)if(!(i.qTags.indexOf(n[r])>-1))return!1;return!0}return!1},e.fields=[],e.dimensions=[],e}()}),define("extensions.qliktech/mapchart/LayerProperties",["require","exports","./DataUtils","./LayerType","./FieldManager","translator","util","client.utils/default-property-logic"],function(e,t,n,i,r,o,s,a){"use strict";var l;return function(e){function t(t){var n={ref:"showLayer",translation:"geo.properties.showLayer",type:"boolean",defaultValue:!0},i={type:"items",items:{haveVisibleRange:{ref:"showInAllLevels",translation:"geo.properties.showInZoomLevels",type:"boolean",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.All"},{value:!1,translation:"Common.Custom"}]},zoomRange:{ref:"zoomRange",type:"array",min:e.ZOOM_RANGE_MIN,max:e.ZOOM_RANGE_MAX,step:1,defaultValue:[e.ZOOM_RANGE_MIN,e.ZOOM_RANGE_MAX],show:function(e){return!e.showInAllLevels},label:function(t){var n=Math.abs(t.zoomRange[0]),i=Math.abs(t.zoomRange[1]);return n===e.ZOOM_RANGE_MIN&&i!==e.ZOOM_RANGE_MAX?o.get("geo.properties.zoomRangeMin",[i]):n!==e.ZOOM_RANGE_MIN&&i===e.ZOOM_RANGE_MAX?o.get("geo.properties.zoomRangeMax",[n]):n===e.ZOOM_RANGE_MIN&&i===e.ZOOM_RANGE_MAX?o.get("geo.properties.zoomRangeMinMax"):o.get("geo.properties.zoomRange",[n,i])}}}},s={type:"items",items:{drillDownAuto:{ref:"drillDown.auto",translation:"geo.properties.drilldown.visible.levels",type:"boolean",component:"switch",defaultValue:!0,options:[{value:!0,translation:"geo.properties.drilldown.all"},{value:!1,translation:"Common.Custom"}],show:function(e){try{var t=e.qHyperCubeDef.qDimensions[0].qLibraryId,n=void 0;return!!t&&(!!(n=r.getDrillDownDimension(t))&&(d=n,!0))}catch(e){return!1}}},drillDown0:{ref:"drillDown.showLevel0",label:function(){try{return d.info[0].qName}catch(e){}},type:"boolean",defaultValue:!0,show:function(e){try{return d.info[0]&&!e.drillDown.auto}catch(e){return!1}}},drillDown1:{ref:"drillDown.showLevel1",label:function(){try{return d.info[1].qName}catch(e){}},type:"boolean",defaultValue:!0,show:function(e){try{return d.info[1]&&!e.drillDown.auto}catch(e){return!1}}},drillDown2:{ref:"drillDown.showLevel2",label:function(){try{return d.info[2].qName}catch(e){}},type:"boolean",defaultValue:!0,show:function(e){try{return d.info[2]&&!e.drillDown.auto}catch(e){return!1}}},drillDown3:{ref:"drillDown.showLevel3",label:function(){try{return d.info[3].qName}catch(e){}},type:"boolean",defaultValue:!0,show:function(e){try{return d.info[3]&&!e.drillDown.auto}catch(e){return!1}}},drillDown4:{ref:"drillDown.showLevel4",label:function(){try{return d.info[4].qName}catch(e){}},type:"boolean",defaultValue:!0,show:function(e){try{return d.info[4]&&!e.drillDown.auto}catch(e){return!1}}},drillDown5:{ref:"drillDown.showLevel5",label:function(){try{return d.info[5].qName}catch(e){}},type:"boolean",defaultValue:!0,show:function(e){try{return d.info[5]&&!e.drillDown.auto}catch(e){return!1}}},drillDown6:{ref:"drillDown.showLevel6",label:function(){try{return d.info[6].qName}catch(e){}},type:"boolean",defaultValue:!0,show:function(e){try{return d.info[6]&&!e.drillDown.auto}catch(e){return!1}}},drillDown7:{ref:"drillDown.showLevel7",label:function(){try{return d.info[7].qName}catch(e){}},type:"boolean",defaultValue:!0,show:function(e){try{return d.info[7]&&!e.drillDown.auto}catch(e){return!1}}}}},a={uses:"dataHandling",items:{calcCond:{uses:"calcCond"},suppressZero:null}};return{groups:{type:"items",grouped:!0,items:t?{visible:n,zoomLevels:i,drillDown:s,dataHandling:a}:{visible:n,zoomLevels:i}}}}function l(){return{type:"items",items:{showLabel:{ref:"label.show",translation:"geo.properties.showLabel",type:"boolean",component:"switch",defaultValue:!0,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}]},expression:{ref:"label.expression",label:o.get("properties.labels"),type:"string",component:"color-by-dropdown",schemaIgnore:!0,defaultValue:{},libraryItemType:"dimension",change:function(e){h(e,e.label.expression)},show:function(e){return e.label.show}},position:{ref:"label.position",translation:"geo.properties.labelPosition",type:"string",component:"dropdown",options:[{value:"BOTTOM",translation:"geo.properties.labelPosition.above"},{value:"MIDDLE",translation:"geo.properties.labelPosition.centered"},{value:"TOP",translation:"geo.properties.labelPosition.below"}],defaultValue:"TOP",show:function(e){return e.label.show&&e.label&&e.label.expression&&0!==e.label.expression.key.trim().length&&"PointLayer"===e.type}},haveVisibleRange:{ref:"label.showInAllLevels",translation:"geo.properties.showInZoomLevels",type:"boolean",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.All"},{value:!1,translation:"Common.Custom"}],show:function(e){return e.label.show}},visibleRange:{ref:"label.visibleRange",type:"array",min:e.ZOOM_RANGE_MIN,max:e.ZOOM_RANGE_MAX,step:1,defaultValue:[e.ZOOM_RANGE_MIN,e.ZOOM_RANGE_MAX],label:function(t){var n=Math.abs(t.label.visibleRange[0]),i=Math.abs(t.label.visibleRange[1]);return n===e.ZOOM_RANGE_MIN&&i!==e.ZOOM_RANGE_MAX?o.get("geo.properties.zoomRangeMin",[i]):n!==e.ZOOM_RANGE_MIN&&i===e.ZOOM_RANGE_MAX?o.get("geo.properties.zoomRangeMax",[n]):n===e.ZOOM_RANGE_MIN&&i===e.ZOOM_RANGE_MAX?o.get("geo.properties.zoomRangeMinMax"):o.get("geo.properties.zoomRange",[n,i])},show:function(e){return e.label&&e.label.show&&!e.label.showInAllLevels&&e.label.expression&&0!==e.label.expression.key.trim().length}}}}}function c(e){var t={ref:"displayLegend",translation:"geo.properties.displayLegend",type:"string",component:"dropdown",options:[{value:"auto",translation:"Common.Auto"},{value:"full",translation:"geo.properties.displayLegend.full"},{value:"small",translation:"geo.properties.displayLegend.small"},{value:"none",translation:"Common.None"}],defaultValue:"full"},n={type:"items",items:{popUp:{ref:"showPopUp",translation:"geo.properties.showPopUp",type:"boolean",defaultValue:!0,change:function(e){}},maxObjects:{ref:"maxObjects",translation:"geo.properties.maxObjects",type:"number",defaultValue:1e3,change:function(e){}}}};return{groups:{type:"items",grouped:!0,items:e?{legend:t,showThings:n,label:l()}:{legend:t}}}}function u(e){return e<20?Math.ceil(e/2):e<40?e-20+10:e<60?30+2*(e-40):70+4*(e-60)}function h(e,t){var n=t.activeDimensionIndex;if(void 0!==n)try{var i=e.qHyperCubeDef.qDimensions[n].qLibraryId;i&&(t.key=i,t.label="",t.type="libraryItem",t.activeDimensionIndex=void 0)}catch(e){}}e.ZOOM_RANGE_MAX=20,e.ZOOM_RANGE_MIN=0;var d;e.getOptionsSection=function(e){return{type:"items",component:"expandable-items",translation:"geo.properties.options",items:{otherOptions:{type:"items",translation:"geo.properties.other.options",items:c(e)},visibilityOptions:{type:"items",translation:"geo.properties.layer.visibility",items:t(e)}}}},e.getDataSection=function(){return{component:"items",translation:"Common.Data",items:{helpText:{component:"text",translation:"geo.properties.dimension.hint",style:"hint",show:function(e){return 0===e.qHyperCubeDef.qDimensions.length}},data:{uses:"data",translation:"Common.Dimensions",dimension:{min:1,max:1,add:function(e,t,n){e.qDef.qSortCriterias[0]={qSortByLoadOrder:1},r.setDefaultLocation(e,t),e.qLibraryId?(t.label.expression.key=e.qLibraryId,t.label.expression.type="libraryItem",t.label.expression.label=""):(t.label.expression.key=e.qDef.qFieldDefs[0],t.label.expression.type="expression",t.label.expression.label="dimension.qDef.qFieldDefs[0]")},remove:function(e,t,n){t.locationOrLatitude.key===t.locationDefault&&(t.locationOrLatitude.key="",t.locationOrLatitude.label="",t.locationOrLatitude.type="")}},items:{dimensions:{disabledRef:""}}}}}},e.getGeodataSection=function(){return{component:"items",translation:"geo.properties.geodata",items:{title:{ref:"title",type:"string",translation:"Common.Label"},tmsUrl:{ref:"tms.url",translation:"Common.URL",minlength:1,type:"string",component:"expression",defaultValue:"",change:function(e){!e.title&&e.tms&&e.tms.url&&(e.title=$("<a>").attr("href",e.tms.url).prop("hostname"))}},attribution:{ref:"tms.attribution",type:"string",translation:"properties.attribution",component:"textarea",maxlength:1024}}}},e.getSizeSection=function(){return{component:"items",translation:"geo.properties.sizeShape",items:{sizeField:{ref:"size.expression",label:o.get("geo.properties.size"),type:"object",component:"color-by-dropdown",schemaIgnore:!0,defaultValue:{},libraryItemType:"measure",change:function(e){}},sizeSlider:{ref:"size.slider",label:function(e){var t="";switch(e.size.shape){case"points":t="Bubble";break;case"squares":t="Square";break;case"triangles":t="Triangle";break;case"hexagons":t="Hexagon";break;case"pentagons":t="Pentagon";break;default:t="Bubble"}return o.get("geo.properties.sizeRange"+t)},type:"array",component:"slider",min:1,max:100,step:1,defaultValue:[4,12],change:function(e){var t=u(e.size.slider[0]),n=u(e.size.slider[1]);e.size.radiusMin=t,e.size.radiusMax=n},show:function(e){return e.size.expression.key&&e.size.expression.key.length>0}},sizeSingleSlider:{ref:"size.sliderSingle",label:function(e){var t="";switch(e.size.shape){case"points":t="Bubble";break;case"squares":t="Square";break;case"triangles":t="Triangle";break;case"hexagons":t="Hexagon";break;case"pentagons":t="Pentagon";break;default:t="Bubble"}return o.get("geo.properties.sizeSingle"+t)},type:"number",component:"slider",min:1,max:50,step:1,defaultValue:8,change:function(e){var t=u(e.size.sliderSingle),n=Math.ceil(t/2);e.size.radiusMin=t-n,e.size.radiusMax=t+n},show:function(e){return!(e.size.expression.key&&e.size.expression.key.length>0)}},sizeRange:{ref:"size.autoRadiusValueRange",translation:"properties.axis.range",type:"boolean",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],show:function(e){return e.size.expression.key&&e.size.expression.key.length>0}},minSizeValue:{ref:"size.radiusValueMin",translation:"geo.properties.radius.min",expression:"optional",type:"number",defaultValue:0,show:function(e){return!e.size.autoRadiusValueRange&&e.size.expression.key&&e.size.expression.key.length>0}},maxSizeValue:{ref:"size.radiusValueMax",translation:"geo.properties.radius.max",expression:"optional",type:"number",defaultValue:0,show:function(e){return!e.size.autoRadiusValueRange&&e.size.expression.key&&e.size.expression.key.length>0}},sizeShape:{ref:"size.shape",translation:"geo.properties.shape",type:"string",component:"dropdown",options:[{value:"points",translation:"geo.properties.marker.points"},{value:"triangles",translation:"geo.properties.marker.triangles"},{value:"squares",translation:"geo.properties.marker.squares"},{value:"pentagons",translation:"geo.properties.marker.pentagons"},{value:"hexagons",translation:"geo.properties.marker.hexagons"}],defaultValue:"points"},sizeUrl:{ref:"size.url",translation:"Common.Image",type:"string",component:"expression",defaultValue:"",change:function(){},show:function(e){return!(!e.size||!e.size.shape||"image"!==e.size.shape)}}}}},e.getLocationSection=function(e){var t={component:"text",translation:"geo.properties.location.hint",style:"hint",show:function(e){return!e.isLatLong}},n={component:"text",translation:"geo.properties.latlong.hint",style:"hint",show:function(e){return e.isLatLong}},r={ref:"locationOrLatitude",type:"object",component:"color-by-dropdown",schemaIgnore:!0,defaultValue:{},libraryItemType:"dimension",label:function(e){return e.isLatLong?o.get("geo.properties.latitude"):o.get("geo.properties.locationField")},change:function(e){h(e,e.locationOrLatitude)}},s={ref:"locationNamesAuto",translation:"geo.properties.location.details",type:"boolean",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],show:function(e){return!e.isLatLong}},a={component:"text",translation:"geo.properties.location.country.hint",style:"hint",show:function(e){return!e.isLatLong&&!e.locationNamesAuto}},l={component:"text",translation:"geo.properties.location.admin1.hint",style:"hint",show:function(e){return!e.isLatLong&&e.locationCountry&&0!==e.locationCountry.key.trim().length&&!e.locationNamesAuto}},c={ref:"locationType",translation:"geo.properties.locationType",type:"string",component:"dropdown",options:[{value:"",translation:"Common.Auto"},{value:"LCONT",translation:"geo.properties.location.continent"},{value:"APCL*",translation:"geo.properties.location.country"},{value:"XCISO2",translation:"geo.properties.location.countryISO2"},{value:"XCISO3",translation:"geo.properties.location.countryISO3"},{value:"AADM1",translation:"geo.properties.location.admin1"},{value:"AADM2",translation:"geo.properties.location.admin2"},{value:"AADM3",translation:"geo.properties.location.admin3"},{value:"AADM4",translation:"geo.properties.location.admin4"},{value:"XPC",translation:"geo.properties.location.postalCode"},{value:"P*",translation:"geo.properties.location.city"},{value:"XIATA",translation:"geo.properties.location.airportIATA"},{value:"XICAO",translation:"geo.properties.location.airportICAO"}],defaultValue:"",show:function(e){return!e.isLatLong&&!e.locationNamesAuto}},u={ref:"locationCountry",label:o.get("geo.properties.countryForNames"),type:"object",component:"color-by-dropdown",schemaIgnore:!0,defaultValue:{},libraryItemType:"dimension",show:function(e){return!e.isLatLong&&!e.locationNamesAuto},change:function(e){h(e,e.locationCountry)}},d={ref:"locationAdmin1",label:o.get("geo.properties.stateAdmin1ForNames"),type:"object",component:"color-by-dropdown",schemaIgnore:!0,defaultValue:{},libraryItemType:"dimension",show:function(e){return!e.isLatLong&&e.locationCountry&&0!==e.locationCountry.key.trim().length&&!e.locationNamesAuto},change:function(e){h(e,e.locationAdmin1)}},p={ref:"locationAdmin2",label:o.get("geo.properties.admin2ForNames"),type:"object",component:"color-by-dropdown",schemaIgnore:!0,defaultValue:{},libraryItemType:"dimension",show:function(e){return!e.isLatLong&&e.locationAdmin1&&0!==e.locationAdmin1.key.trim().length&&e.locationCountry&&0!==e.locationCountry.key.trim().length&&!e.locationNamesAuto},change:function(e){h(e,e.locationAdmin2)}},f={ref:"isLatLong",translation:"geo.properties.isLatLong",type:"boolean",defaultValue:!1},m={ref:"longitude",label:o.get("geo.properties.longitude"),schemaIgnore:!0,type:"object",defaultValue:{},component:"color-by-dropdown",libraryItemType:"dimension",show:function(e){return e.isLatLong},change:function(e){var t=e.longitude;t&&h(e,t)}};return{component:"items",translation:"geo.properties.location",items:e===i.AREA?{location:r,locationText:t,locationRestrictionSwitch:s,locationtype:c,country:u,locationNameCountryInstruction:a,admin1:d,locationNameAdmin1Instruction:l,admin2:p}:{islatlong:f,location:r,locationText:t,longitude:m,latlongText:n,locationRestrictionSwitch:s,locationtype:c,country:u,locationNameCountryInstruction:a,admin1:d,locationNameAdmin1Instruction:l,admin2:p}}},e.getColorSection=function(){return{uses:"colorsAndLegend",translation:"properties.colors",show:function(e){return e.qHyperCubeDef&&e.qHyperCubeDef.qDimensions.length>0},items:{colors:{items:{colorMode:{options:function(){return[{value:"primary",translation:"properties.colorMode.primary"},{value:"byDimension",translation:"properties.colorMode.byDimension"},{value:"byMeasure",translation:"properties.colorMode.byMeasure"},{value:"byExpression",translation:"properties.colorMode.byExpression"}]},change:function(e){e.color.auto||"byExpression"!==e.color.mode?n.setExprInProperties("colorByExpression",null,e):"byExpression"===e.color.mode&&n.setExprInProperties("colorByExpression",e.color.colorExpression,e)}},baseColors:{type:"items",items:{useBaseColor:{options:function(e,t){var n=a.getLogicFor("hard","default"),i=t.layout,r=[{value:"off",translation:"Common.None"}];return n.color.baseColor.hasDimensionColor(t)&&"byMultiple"!==i.color.mode&&r.push({value:"dimension",translation:"Common.Dimension"}),r}}}},attributeExpression:{ref:"color.colorExpression",globalChange:function(){},change:function(e){n.setExprInProperties("colorByExpression",e.color.colorExpression,e)},show:function(e){return!e.color.auto&&"byExpression"===e.color.mode}},expressionIsColor:{show:function(e){return!e.color.auto&&"byExpression"===e.color.mode}},customRange:{type:"items",items:{min:{invalid:function(e){return e.color.measureMin>=e.color.measureMax}},max:{invalid:function(e){return e.color.measureMin>=e.color.measureMax}}}},outline:{ref:"color.outline",translation:"geo.properties.color.outline",type:"integer",component:"color-picker",dualOutput:!0,defaultValue:function(){return{index:-1,color:"#7b7a78"}},show:function(e){return!e.color.auto},change:function(e){e.color.outline.index=-1}},transparency:{ref:"color.opacity",translation:"properties.opacity",type:"number",defaultValue:1,min:0,max:1,step:.05,component:"slider"}}},legend:{show:function(){return!1}}}}},e.getInitialProperties=function(t){var n={type:t,locationOrLatitude:{key:"",label:"",type:""},locationDefault:"",locationNamesAuto:!0,locationType:"",locationCountry:{key:"",label:"",type:""},locationAdmin1:{key:"",label:"",type:""},locationAdmin2:{key:"",label:"",type:""},maxObjects:"PointLayer"===t?4e3:1e3,showLayer:!0,color:{outline:{index:-1,color:"#7b7a78"},opacity:1,auto:!0,mode:"primary",paletteColor:{index:6,color:"#4477aa"},measureScheme:"sg",dimensionScheme:"12",colorExpression:"",expressionIsColor:!0,measureMin:0,measureMax:10},displayLegend:"auto",showToolTip:!0,showInAllLevels:!0,zoomRange:[e.ZOOM_RANGE_MIN,e.ZOOM_RANGE_MAX],showPopUp:!0,displayUnselected:!1,label:{show:!1,expression:{key:"",label:"",type:""},position:"TOP",showInAllLevels:!0,visibleRange:[e.ZOOM_RANGE_MIN,e.ZOOM_RANGE_MAX]},drillDown:{auto:!0,showLevel0:!0,showLevel1:!0,showLevel2:!0,showLevel3:!0,showLevel4:!0,showLevel5:!0,showLevel6:!0,showLevel7:!0},qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:1,qHeight:0}]}};switch(t){case i.POINT:n.size={radiusMin:4,radiusMax:12,radiusValueMin:0,radiusValueMax:1,autoRadiusValueRange:!0,expression:{key:"",label:"",type:""},slider:[8,24],sliderSingle:16,shape:"points"};break;case i.GEODATA:s.extend(!0,n,{title:"",dataType:"tms",tms:{url:"",attribution:""}})}return n},e.getSliderValueFromSize=function(e){return e<10?2*e:e<30?20+Math.round(e-10):e<70?40+Math.round((e-30)/2):60+Math.round((e-70)/4)}}(l||(l={})),l}),define("objects/cre/chart-properties-generator/chart-properties-generator",["util","objects.utils/chart-type-utils/chart-type-utils","objects.utils/data-properties/hypercube-handler","objects.picasso/advanced-colorer","extensions.qliktech/mapchart/LayerProperties","core.utils/deferred","objects/cre/cre-util"],function(e,t,n,i,r,o,s){function a(e,t,n,i,r){return t>=e.length?o.resolve():l(e[t],n,i,r).then(function(){return a(e,t+1,n,i,r)})}function l(t,n,r,s){var a=t.value;if(t.isColorBy()){if(r.color){var l,u=t.isMeasure(),h=c(t,n);a.isFieldValue()||a.isExpressionValue()?(l={type:u?"expression":"field",name:u||a.isExpressionValue()?a.getExpression():a.getFieldName()},h&&(l.label=u?h.qDef.qLabel:h.qDef.qFieldLabels[0])):a.isLibraryValue()&&(l={type:u?"measure":"dimension",id:a.getLibraryId()}),l&&(t.adapt&&t.adapt(l),i.setColorByPropertyDef(r.color,l),s.updateGlobalChangeListeners())}}else if(t.isCustom())t.adapt(r,a);else if(t.isMeasure()){var d,p=c(t,n);if(p)d=e.extend(!0,{},p);else if(a.isFieldValue()||a.isExpressionValue()){var f=a.getExpression();d=s.createExpressionMeasure(f,f)}else if(a.isLibraryValue()){var m=a.getLibraryId();d=s.createLibraryMeasure(m)}if(d)return t.adapt&&t.adapt(d),s.addMeasure(d)}else if(t.isDimension()){var g,v=c(t,n);if(v)g=e.extend(!0,{},v);else if(a.isFieldValue()){var y=a.getFieldName(),b=a.getExpression();g=s.createFieldDimension(b,y)}else if(a.isExpressionValue()){var x=a.getExpression();g=s.createFieldDimension(x,x)}else if(a.isLibraryValue()){var q=a.getLibraryId();g=s.createLibraryDimension(q)}if(g)return t.adapt&&t.adapt(g),s.addDimension(g)}return o.resolve()}function c(e,t){var n=e.value;if(e.isMeasure()){if(n.isFieldValue()||n.isExpressionValue()){var i=n.getExpression(),r=s.normalizeExpression(i);return u(t.measures,function(e){return e.qDef&&s.normalizeExpression(e.qDef.qDef)===r})}if(n.isLibraryValue()){var o=n.getLibraryId();return u(t.measures,function(e){return e.qLibraryId===o})}}else if(e.isDimension()){if(n.isFieldValue()){var a=n.getExpression(),l=s.normalizeExpression(a);return u(t.dimensions,function(e){return e.qDef&&e.qDef.qFieldDefs&&s.normalizeExpression(e.qDef.qFieldDefs[0])===l})}if(n.isExpressionValue()){var c=n.getExpression(),h=s.normalizeExpression(c);return u(t.dimensions,function(e){return e.qDef&&e.qDef.qFieldDefs&&s.normalizeExpression(e.qDef.qFieldDefs[0])===h})}if(n.isLibraryValue()){var d=n.getLibraryId();return u(t.dimensions,function(e){return e.qLibraryId===d})}}}function u(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(t(i))return e.splice(n,1),i}}function h(t){if(t.qHyperCubeDef){var n=t.qHyperCubeDef.qDimensions,i=t.qHyperCubeDef.qMeasures;n.forEach(function(t){t.qDef.cId=e.generateId()}),i.forEach(function(t){t.qDef.cId=e.generateId()})}}return{generateProperties:function(s,l,c){var u=s.type;return o.all([t.getExtensionType(u),t.getInitialProperties(u)]).then(function(t){var o,d=t[0],p=t[1],f=p;if("map"===u){var m="AreaLayer";s.encodings&&"points"===s.encodings[0].key&&(m="PointLayer");var g=r.getInitialProperties(m);g.cId=e.generateId(),p.gaLayers.push(g),f=g;var v=r.getDataSection().items.data;o=new n({app:c,dimensionDefinition:v.dimension||{},measureDefinition:v.measure||{},dimensionProperties:g.qHyperCubeDef.qDimensions,measureProperties:g.qHyperCubeDef.qMeasures,globalChangeListeners:[function(e){i.colorByUpdater(e,"qHyperCubeDef.",e.color)}]})}else f=p,d.mapProperties(),o=d.getCreatePropertyHandler.call(d,c);o.setProperties(f);var y={dimensions:l.qHyperCubeDef.qDimensions.map(function(e){return e}),measures:l.qHyperCubeDef.qMeasures.map(function(e){return e})};return a(s.encodings,0,y,f,o).then(function(){return s.adapt&&s.adapt(p),h(p),d.exportProperties&&d.importProperties?d.importProperties(d.exportProperties({qProperty:p},s.hyperCubePath),p,d,s.hyperCubePath).qProperty:p})})}}}),define("objects/cre/data-collection/data-collection-model",[],function(){function e(e){this.name=e.name,this.expr=e.expr,this.defaultClassifications=e.defaultClassifications,this.libId=e.libId,this.dataTypes=e.dataTypes}function t(e){this.name=e.name,this.aggregation=e.aggregation,this.defaultAggregation=e.defaultAggregation,this.defaultClassifications=e.defaultClassifications,this.expr=e.expr,this.libId=e.libId,this.dataTypes=e.dataTypes}function n(){this.dimensions=[],this.measures=[]}return e.prototype.isLibraryItem=function(){return!!this.libId},e.prototype.isFieldItem=function(){return!!this.name},t.prototype.isLibraryItem=function(){return!!this.libId},t.prototype.isFieldItem=function(){return!!this.name},n.prototype.size=function(){return this.dimensions.length+this.measures.length},{Dimension:e,Measure:t,DataCollection:n}}),define("objects/cre/data-collection/data-collection-factory",["underscore","core.utils/class","objects/cre/data-collection/data-collection-model"],function(e,t,n){var i=["sum","count","avg","min","max"];return new(t.extend("DataCollectionFactory",{getField:function(t,n){return e.find(t,function(e){return e.qName===n})},isAggregation:function(e){return e&&i.indexOf(e.toLowerCase())>=0},unwrapName:function(e){return"["===e.charAt(0)&&"]"===e.charAt(e.length-1)?e.substring(1,e.length-1):e},createDataCollection:function(e,t,i){var r=this,o=new n.DataCollection;return t.forEach(function(t){var i;if(t.qLibraryId)i=new n.Dimension({libId:t.qLibraryId});else{var s=t.qDef.qFieldDefs[0],a=r.unwrapName(s),l=r.getField(e,a);i=l?new n.Dimension({dataTypes:l.dataTypes,defaultClassifications:l.classifications,name:a,expr:s}):new n.Dimension({expr:s})}i&&o.dimensions.push(i)}),i.forEach(function(t){var i;if(t.qLibraryId)i=new n.Measure({libId:t.qLibraryId});else{var s=t.qDef.qDef,a=/^=?(.+)\(((\[(.+)\])|((.+)))\)$/.exec(s);if(a&&(a=a.filter(function(e){return e})).length>=5){var l=a[1],c=a[4];if(l&&(l=l.trim()),r.isAggregation(l)){var u=r.getField(e,c);u&&(i=new n.Measure({dataTypes:u.dataTypes,defaultClassifications:u.classifications,defaultAggregation:u.defaultAggregation,aggregation:l,name:c,expr:s}))}}i||(i=new n.Measure({expr:s}))}i&&o.measures.push(i)}),o},merge:function(e){var t=new n.DataCollection;return e.forEach(function(e){t.dimensions=t.dimensions.concat(e.dimensions),t.measures=t.measures.concat(e.measures)}),t}}))}),define("objects/cre/chart-properties-extractor/chart-properties-extractor",["underscore","objects/cre/cre-util","objects/cre/data-collection/data-collection-factory"],function(e,t,n){function i(t,n){if(n&&n.qDimensionInfo){var i=e.find(n.qDimensionInfo,function(e){return e.qGroupFieldDefs&&e.qGroupFieldDefs.indexOf(t)>=0});return i&&i.qDerivedField}return!1}return{createDataCollection:function(e,t){return e.getFieldList().then(function(e){return n.createDataCollection(e,t.qHyperCubeDef.qDimensions,t.qHyperCubeDef.qMeasures)})},adaptDataCollectionForRecommendations:function(e,n){var r={fields:[],libItems:[],expressions:[]};return e.dimensions.forEach(function(e,o){var s={};if(n.qDimensionInfo&&n.qDimensionInfo.length>o){var a=n.qDimensionInfo[o];s.distinctCount=a.qCardinal}e.isLibraryItem()?r.libItems.push({libId:e.libId,overrides:s}):e.isFieldItem()?(r.fields.push({name:e.name,overrides:s}),t.isDimension(e.defaultClassifications)?s.classifications=[e.defaultClassifications[0]]:s.classifications=[t.Constants.dimension]):(r.expressions.push({expr:e.expr,overrides:s}),i(e.expr,n)?s.classifications=[t.Constants.temporal]:s.classifications=[t.Constants.dimension])}),e.measures.forEach(function(e,i){var o={};if(n.qMeasureInfo&&n.qMeasureInfo.length>i){var s=n.qMeasureInfo[i];o.valueRange={min:s.qMin,max:s.qMax}}e.isLibraryItem()?r.libItems.push({libId:e.libId,overrides:o}):e.isFieldItem()?(r.fields.push({name:e.name,overrides:o}),o.defaultAggregation=e.aggregation,t.isMeasure(e.defaultClassifications)?o.classifications=[e.defaultClassifications[0]]:o.classifications=[t.Constants.measure]):(r.expressions.push({expr:e.expr,overrides:o}),o.classifications=[t.Constants.measure])}),r}}}),define("objects/cre/meta-data/meta-data",["util"],function(e){function t(t,n,i,r,o){this.dataCollection=r,this.overallIndicators=i.analysis.overallIndicators,this.measures=n,this.dimensions=t,e.extend(!0,this,o)}return t.prototype.getMetaDataForDimension=function(e){if(this.dimensions.length>e)return this.dimensions[e]},t.prototype.getMetaDataForMeasure=function(e){if(this.measures.length>e)return this.measures[e]},t.prototype.getIndicatorByName=function(e){var t=void 0;return this.overallIndicators.some(function(n){var i=n.name===e;return i&&(t=n),i}),t},t.prototype.isSummable=function(){var e=this.getIndicatorByName("summable");return e&&"1"===e.result},t.prototype.isPerfectHierarchy=function(){var e=this.getIndicatorByName("perfectHierarchy");return e&&"1"===e.result},t}),define("objects/cre/meta-data/meta-data-collector",["util","objects/cre/meta-data/meta-data","objects/cre/cre-util"],function(e,t,n){function i(e,t,i){var r=-1;return e&&t&&t.some(function(t,o){return"dimension"===i?(e.qLibraryId&&e.qLibraryId===t.libId||n.normalizeExpression(e.qDef.qFieldDefs[0])===n.normalizeExpression(t.expr))&&(r=o):"measure"===i&&(e.qLibraryId&&e.qLibraryId===t.libId||n.normalizeExpression(e.qDef.qDef)===n.normalizeExpression(t.expr))&&(r=o),-1!==r}),r}function r(e,t,n,i,r){var o,s=[];switch(i){case"dimension":s=r.dimensions;break;case"measure":s=r.measures}s.some(function(i){var r=!1;return t?(r=i.expr===t,e.dataType=i.dataTypes&&i.dataTypes.length>0?i.dataTypes[0]:null,e.aggregation=i.aggregation?i.aggregation:null):n&&(r=i.libId===n),o=r?i:o,r})}function o(e,t,n,i,o){function s(e,t){!!a.qLibraryId?c=a.qLibraryId:"dimension"===t?l=a.qDef.qFieldDefs[0]:"measure"===t&&(l=a.qDef.qDef)}var a,l,c;"dimension"===n?(a=i.qDimensions[t],s(0,"dimension")):"measure"===n&&(a=i.qMeasures[t],s(0,"measure")),r(e,l,c,n,o)}function s(t,n,i,r,s){var a=e.extend(!0,{},t,n);return o(a,n,i,r,s),a}return{merge:function(n,r,o,a){var l=a.analysis.dims?a.analysis.dims:[],c=a.analysis.msrs?a.analysis.msrs:[],u=new Array(c.length),h=new Array(l.length);n.qDimensionInfo.forEach(function(e,t){var l=i(r.qDimensions[t],a.analysis.dims,"dimension");h.splice(l,1,s(n.qDimensionInfo[t],t,"dimension",r,o))}),n.qMeasureInfo.forEach(function(e,t){var l=i(r.qMeasures[t],a.analysis.msrs,"measure");u.splice(l,1,s(n.qMeasureInfo[t],t,"measure",r,o))});var d={qSize:e.extend(!0,{},n.qSize)};return new t(h,u,a,o,d)}}}),define("objects/cre/chart-recommendation-service",["underscore","objects/cre/recommendations-fetcher","objects/cre/chart-data-properties-creator/chart-data-properties-creator","objects/cre/chart-properties-generator/chart-properties-generator","objects/cre/chart-properties-extractor/chart-properties-extractor","objects/cre/meta-data/meta-data-collector","core.utils/debug-flags"],function(e,t,n,i,r,o,s){function a(i,s,a){return r.createDataCollection(a,i).then(function(a){var l=r.adaptDataCollectionForRecommendations(a,s.qHyperCube);return t.getChartRecommendations(l).then(function(r){var l=[];if(!e.isArray(r)&&(r=[]),!r.some(function(e){return"list"===e.analysis.analysis})){var c=t.getFallbackRecommendation(a);r.push(c)}return r.forEach(function(e){var t=o.merge(s.qHyperCube,i.qHyperCubeDef,a,e);n.createChartDataProperties(e,t).forEach(function(e){l.push(e)})}),{recommendations:r,allChartDataProperties:l}})})}return{generateAlternativeChartProperties:function(e,t,n){return a(e,t,n).then(function(t){if(s.CRE_CHARTS){var r={recommendations:t.recommendations,allChartDataProperties:t.allChartDataProperties};console.log(r)}return t.allChartDataProperties.map(function(t){return i.generateProperties(t,e,n)})})},generateDefaultChartProperties:function(e,t,n){return a(e,t,n).then(function(t){var r=t.allChartDataProperties;r.length>1&&r.sort(function(e,t){return t.score-e.score});var o=r[0];return i.generateProperties(o,e,n).then(function(e){if(s.CRE_CHARTS){var n={recommendations:t.recommendations,allChartDataProperties:r,bestChartDataProperties:o,chartProperties:e};console.log(n)}return e})})}}}),define("extensions.qliktech/auto-chart/auto-chart-view",["qvangular","objects.extension/base-view","objects.picasso/derived-properties/derived-properties","objects.utils/chart-creation-service/chart-creation-service","objects/cre/chart-recommendation-service","assets/client/soft-property-panel/soft-property-handler","core.utils/deferred","util","client.utils/state","objects.picasso/derived-properties/save/save"],function(e,t,n,i,r,o,s,a,l,c){function u(e,t){var n=!1;if(t.generated){var i=["showTitles","title","subtitle","footnote"];n=h(t.generated,e,i)}return n}function h(e,t,n){var i=!1;return n&&n.length>0&&n.forEach(function(n){"object"!=typeof t[n]&&n in e&&e[n]===t[n]||(e[n]="object"==typeof t[n]?a.extend({},t[n]):t[n],i=!0)}),i}function d(e,t,n,i,r){return e.item&&e.item.model?f(e.item.model,n):p(n,t,e,i,r)}function p(e,t,n,r,o){function l(e,t,n){function i(e,t,n){e.forEach(function(i,r){var o=!0,s=-1;t.some(function(e){return(o=i.qLibraryId?i.qLibraryId===e.qLibraryId:n(i,e))||(s=r),o})||(c=!0,e.splice(s,1))})}var r=n||t.qHyperCubeDef,o=r.qDimensions,s=r.qMeasures,a=e.qHyperCubeDef.qDimensions,l=e.qHyperCubeDef.qMeasures,c=!1;return i(a,o,function(e,t){return!!t.qDef.qFieldDefs&&e.qDef.qFieldDefs[0]===t.qDef.qFieldDefs[0]}),o.forEach(function(e,t){var n=!1,i=-1,r=e;a.some(function(t){return n=e.qLibraryId?t.qLibraryId===e.qLibraryId:!!t.qDef.qFieldDefs&&e.qDef.qFieldDefs[0]===t.qDef.qFieldDefs[0]}),n||(i=t,c=!0,a.splice(i,0,r))}),i(l,s,function(e,t){return e.qDef.qDef===t.qDef.qDef}),c&&(e.qHyperCubeDef.qInterColumnSortOrder=JSON.parse(JSON.stringify(r.qInterColumnSortOrder))),c}return i.createChart(e,t,!1).then(function(e){if(n.item={paintDeferred:new s,model:e},n.options.onRendered){var t=a.extend({},n.options);t.onRendered=function(){("histogram"!==n.item.model.layout.visualization||n.item.model.layout.qUndoExclude)&&(n.item.paintDeferred.resolve(),n.item.paintDeferred=new s)},n.item.options=t}else n.item.options=n.options,n.item.paintDeferred.resolve();n.item.model.getProperties=n.item.model.getEffectiveProperties,n.item.model.setProperties=function(t){var n=!1;a.isEqual(o.title,t.title)||(h(o,t,["title"]),n=!0);var i=!1;return t.qHyperCubeDef&&(i=l(o,t)),(n=n||i)?r.setProperties(o):f(e,t)}})}function f(e,t){return e.clearSoftPatches().then(function(){return new o(e).saveSoftProperties({},t)})}function m(e){return{qHyperCubeDef:e.qHyperCubeDef}}return t.extend("AutoChart",{init:function(e,t,i,r,o,s){this._super(e,t,i,r,o,s),this._derivedProperties=new n},updateData:function(t){var n=this;return this._super(t).then(function(){var i=n.backendApi.model;return i.getProperties().then(function(o){var h=a.extend(!0,{},t),f=a.extend(!0,{},o);return n._derivedProperties.addDefaultHyperCubeHash(f.qHyperCubeDef,h.qHyperCube,i.app,m(f)).then(function(t){var o={layout:h,properties:f,model:i,hashData:t,generateDerivedProperties:function(t,o){var s=e.getService("$timeout");return n.showThrobberTimeout=s(function(){n.$scope.object.throbberApi.show()},1e3),r.generateDefaultChartProperties(o,t,i.app).then(function(e){return s.cancel(n.showThrobberTimeout),n.$scope.object.throbberApi.hide(),o.qUndoExclude.generated=e,u(f,f.qUndoExclude),d(n.$scope,i.app,f.qUndoExclude.generated,i,f)})}};if(f.qUndoExclude||(f.qUndoExclude={}),!n._derivedProperties.isDerivedUpToDate(o))return n._derivedProperties.updateDerivedProperties(o);var m=a.extend(!0,{},f),g=u(f,f.qUndoExclude);if(!n.$scope.item||!n.$scope.item.model)return p(f.qUndoExclude.generated,i.app,n.$scope,i,f);if(g){var v=[];return v.push(d(n.$scope,i.app,f.qUndoExclude.generated,i,f)),v.push(c.saveDerivedProperties(i,h,f,m,l)),s.all(v)}})})})},initialize:function(){},suppressOnPaint:function(){return!1},refreshSelections:function(){},setInteractionState:function(){this.$scope.innerObject.setInteractionState.apply(this,arguments)},setDirection:function(e){e&&this.$scope.options.direction===e&&(this.$scope.options.direction=""),this.$scope.innerObject.setDirection.apply(this,arguments)},setSnapshotData:function(e){return Object.keys(e).forEach(function(t){"snapshotData"!==t&&"qInfo"!==t&&delete e[t]}),a.extend(e,this.$scope.innerObject.layout),this.$scope.innerObject.setSnapshotData.apply(this,arguments)},paint:function(){return this.$scope.item.paintDeferred?this.$scope.item.paintDeferred.promise:s.resolve()}})}),define("extensions.qliktech/auto-chart/auto-chart-properties",["objects/cre/chart-recommendation-service","core.utils/deferred","util","client.utils/capability-flags","general.utils/visualizations","translator"],function(e,t,n,i,r,o){var s={uses:"dimensions",disabledRef:"",items:{nullSuppression:{show:!1},dimensionLimits:{show:!1},others:{show:!1}}},a={uses:"measures",disabledRef:""};return i.getFlag("CHANGE_CHART_TYPE")?function(){var i=o.get("properties.chartType");return{component:"items",items:{data:{uses:"data",items:{dimensions:s,measures:a}},header:{component:"header",marginTop:"40px",label:i},changeBtn:{component:"icon-button",icon:function(e){return r.getType(e.preferredType||e.qUndoExclude.generated.visualization).getLibraryInfo().iconChar},title:function(e){return o.get(r.getType(e.preferredType||e.qUndoExclude.generated.visualization).getLibraryInfo().translationKey)},subTitle:function(e){return o.get(e.preferredType?"properties.chartType.selected":"properties.chartType.recommended")},action:function(r,s,a,l){e.generateAlternativeChartProperties(a.properties,a.layout,a.model.app).then(function(e){t.all(e).then(function(e){var t=[];e.forEach(function(e,n){t.push({component:"chart-type",currentType:r.qUndoExclude.generated.visualization,type:e.qInfo.qType,model:a.model,app:a.model.app,properties:e,recommended:0===n})}),l.$emit("showSubPanel",{id:"pp_change_chart_type_"+n.generateId(),triggerId:"propertyPanelAutoChart",title:i,width:"300px",definition:{component:"items",items:{header:{component:"text",style:"chart-type-header",label:o.get("properties.chartType.selectChartType")},text:{component:"text",label:o.get("properties.chartType.avalibleTypes")},charts:{component:"items",items:t}}}})})})},label:i},settings:{uses:"settings"}}}}():{type:"items",component:"accordion",defaultActiveTabIndex:0,items:{data:{uses:"data",items:{dimensions:s,measures:a}},settings:{uses:"settings"}}}}),define("extensions.qliktech/auto-chart/auto-chart-conversion",["objects.extension/object-conversion"],function(e){return{importProperties:e.hypercube.importProperties,exportProperties:e.hypercube.exportProperties}}),define("text!extensions.qliktech/auto-chart/auto-chart.ng.html",[],function(){return'<qv-object model="item.model" options="item.options" object="innerObject"></qv-object>\n'}),define("extensions.qliktech/auto-chart/auto-chart-data-definition",[],function(){return{dimensions:{min:0,max:15},measures:{min:0,max:15}}}),define("extensions.qliktech/auto-chart/auto-chart",["extensions.qliktech/auto-chart/auto-chart-view","extensions.qliktech/auto-chart/auto-chart-properties","extensions.qliktech/auto-chart/auto-chart-conversion","text!./auto-chart.ng.html","extensions.qliktech/auto-chart/auto-chart-data-definition","objects/cre/cre-util"],function(e,t,n,i,r,o){return{type:"auto-chart",template:i,View:e,definition:t,data:r,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qSuppressMissing:!0}},support:{cssScaling:!1,snapshot:!0,export:!0,exportData:!0,sharing:!0,viewData:function(e){return e.qHyperCube&&e.qHyperCube.qDimensionInfo.length>0}},getDropFieldOptions:function(e,t,n,i,r){var s=e.item;if(s.isDerivedFromDate||s.classifications&&0!==s.classifications.length)if(s.isDerivedFromDate)t.addFieldDimension(s.name,s.displayName).then(function(){n.setProperties(t.properties)});else if(o.isMeasure(s.classifications)){var a=o.getMeasureExpression(s.name,s.defaultAggregation);t.addExpressionMeasure(a,s.displayName).then(function(){n.setProperties(t.properties)})}else{var l=o.getDimensionExpression(s.name);t.addFieldDimension(l,s.displayName).then(function(){n.setProperties(t.properties)})}else e.Add(n,t,r),e.ReplaceDimensions(n,t,r),e.AddFieldAsMeasure(n,t,r),e.ReplaceMeasures(n,t,r),i()},getDropDimensionOptions:function(e,t,n){t.addLibraryDimension(e.item.id).then(function(){n.setProperties(t.properties)})},getDropMeasureOptions:function(e,t,n){t.addLibraryMeasure(e.item.id).then(function(){n.setProperties(t.properties)})},importProperties:n.importProperties,exportProperties:n.exportProperties}}),define("objects.views/charts/events/event-launcher",["core.utils/class"],function(e){"use strict";return e.extend({init:function(){this._listeners={}},listen:function(e,t,n){return"function"!=typeof t?this:(this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push({callback:t,scope:n}),this)},stopListen:function(e,t,n){var i,r=this._listeners[e];if(r)for(i=r.length-1;i>=0;i-=1)t?(n&&n===r[i].scope&&r[i].callback===t||!n&&r[i].callback===t)&&r.splice(i,1):r.splice(i,1);return this},fire:function(e,t){var n,i,r=e;if("string"!=typeof r&&(r=e.getType()),n=this._listeners[r])for(i=n.length-1;i>=0;--i)"string"==typeof e?n[i].callback.apply(n[i].scope?n[i].scope:this,t||[]):n[i].callback.apply(n[i].scope?n[i].scope:this,[e]);return this},hasListener:function(e){var t=e;return"string"!=typeof t&&(t=e.getType()),this._listeners&&this._listeners[t]&&this._listeners[t].length}})}),define("objects.utils/animation-frame",[],function(){var e=function(e){return window.setTimeout(e,1e3/60)},t=function(e){return window.clearTimeout(e)},n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||e,i=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.msCancelAnimationFrame||t;return{request:n===e?e:n.bind(window),cancel:i===t?t:i.bind(window)}}),define("objects.views/charts/invalidatable",["core.utils/deferred","./events/event-launcher","objects.utils/animation-frame"],function(e,t,n){"use strict";function i(t,i){var s;if(this._validating=!0,this._invalidatedProperties&&(!t||t&&t.contains("properties"))&&(s=o.call(this))&&"function"==typeof s.then&&this._pendingDfds.push(s),this._invalidatedDisplay&&(!t||t&&t.contains("display"))&&(s=r.call(this))&&"function"==typeof s.then&&this._pendingDfds.push(s),this._validating=!1,this._invalidated=this._invalidatedDisplay||this._invalidatedProperties,this._invalidated){if(!t){var a=this,l=this.dfd;this._timer=n.request(function(){a._validate(null,l)})}}else this._pendingDfds.length?(e.all(this._pendingDfds).then(function(){i.__qvState=1,i.resolve()}),this._pendingDfds=[]):(i.__qvState=1,i.resolve())}function r(){var e=this._updateDisplay();return this._invalidatedDisplay=!1,this.__invalidators.display=[],e}function o(){var e=this._updateProperties();return this._invalidatedProperties=!1,this.__invalidators.properties=[],e}function s(){if(!this._invalidated&&!this._validating&&!this._released){var t,i=this;this._invalidated=!0,(t=e()).__qvState=0,t.__id=++this._dfdCount,this.dfd=t,this._timer=n.request(function(){i._validate(null,t)})}if(this.dfd)return this.dfd.promise}return t.extend("Invalidatable",{init:function(){this._super(),this.__invalidators={size:[],display:[],properties:[]},this._pendingDfds=[],this._dfdCount=0},invalidate:function(){return this._released?e.reject():s.call(this)},invalidateProperties:function(t){return this._released?e.reject():(this._invalidatedProperties||(this._invalidatedProperties=!0,s.call(this)),this.__invalidators.properties.push(t),this.dfd.promise)},invalidateDisplay:function(t){return this._released?e.reject():(this._invalidatedDisplay||(this._invalidatedDisplay=!0,s.call(this)),this.__invalidators.display.push(t),this.dfd.promise)},validateNow:function(){return this._invalidated=!0,this.updateNow(),this},updateNow:function(e){if(this._invalidated&&!this._validating){var t=e&&e.contains("display")===this._invalidatedDisplay,i=e&&e.contains("properties")===this._invalidatedProperties;(!e||t&&i)&&(n.cancel(this._timer),this._timer=null),this._validate(e,this.dfd)}return this},_update:function(){return this},_updateDisplay:function(){},_updateProperties:function(){},cancel:function(){n.cancel(this._timer),this._invalidatedProperties=!1,this.__invalidators.properties=[],this._invalidatedDisplay=!1,this.__invalidators.display=[],this._invalidated=!1,this.dfd&&(this.dfd.__qvState=2,this.dfd.reject())},release:function(){this._released=!0,this.cancel(),this.dfd=null},_validate:function(e,t){i.call(this,e,t)}})}),define("objects.views/charts/utils/transition-helper",["jquery","core.utils/class","core.utils/deferred"],function(e,t,n){"use strict";function i(t,n,i,s){o.apply(this,[t,n]);var l,c,u,h,d,p=!0,f=!1,m=this;p=a.checkEqual(t,i);for(l in i)void 0===t[l]&&(f=!0);return p?(m._endCallback&&m._endCallback.call(m._scope),void s.resolve()):f?(e.extend(n,i),e.extend(t,i),m._endCallback&&m._endCallback.call(m._scope),void s.resolve()):(c=this._transitionTime,u=Date.now(),this._inAnimation=!0,this._initiateAnimation=!1,this._transitionProgress=0,e.extend(n,r(t,n,i,0)),void(this._animationCallback=setInterval(function(){if((h=(Date.now()-u)/c)>1)clearInterval(m._animationCallback),e.extend(n,r(t,n,i,1)),m._updateCallback&&m._updateCallback.call(m._scope),m._inAnimation=!1,m._lastFrame=!0,m._transitionProgress=1;else{switch(m._transitionCurve){case"linear":d=h;break;case"easeout":d=Math.sin(Math.PI*h/2);break;case"easein":d=1-Math.cos(Math.PI*h/2);break;default:d=(1+Math.cos(Math.PI*(1+h)))/2}m._transitionProgress=d,e.extend(n,r(t,n,i,d)),m._updateCallback&&m._updateCallback.call(m._scope)}h>1&&(n=e.extend({},i),m._endCallback.call(m._scope),s.resolve())},15)))}function r(t,n,i,o){if(o<=0)return t;if(o>=1)return i;for(var s in t)t||!i?!t||i?(t[s]instanceof Array?t[s].forEach(function(t,n){e.extend(t,r(t,i[s][n],o))}):isNaN(t[s])&&t[s]instanceof Object&&function(e,t,n){t[s]=r(e[s],t[s],n[s],o)}(t,n,i),t[s]&&!i[s]&&(n[s]=i[s]),null===t[s]||null===i[s]||isNaN(t[s])||isNaN(i[s])||(n[s]=t[s]*(1-o)+i[s]*o)):void 0!==t.opacity&&(n.opacity=1-o):(void 0!==i.opacity&&(n.opacity=o),n=e.extend(n,i));return n}function o(t,n){e.extend(t,n),clearInterval(this._animationCallback),this._inAnimation=!1,this._lastFrame=!1}function s(e,t,n,r){this._inAnimation||this._initiateAnimation&&this._transitionEnabled?i.call(this,e,t,n,r):r.resolve()}var a;return a=t.extend("TransitionHelper",{namespace:".transitionhelper",init:function(e,t,n,i){this._updateCallback=e,this._endCallback=t,this._transitionTime=n||500,this._scope=i,this._inAnimation=!1,this._transitionProgress=0,this._lastFrame=!1,this._animationCallback=function(){return null},this._initiateAnimation=!0,this._transitionEnabled=!0,this._transitionDelay=0,this._transitionCurve=""},transition:function(e,t,i,r,a,l){var c=this,u=n();return this._oldValues=e,this._currentValues=t,this._newValues=i,this._updateCallback=a,this._endCallback=r,this._scope=l,o.apply(this,[e,t]),this._initiateAnimation=!0,this._inAnimation||this._lastFrame?u.resolve():this._transitionDelay>0?this._trantisionTimeout=setTimeout(function(){s.apply(c,[e,t,i,u])},this._transitionDelay):s.apply(this,[e,t,i,u]),u.promise},clear:function(){clearInterval(this._animationCallback),clearTimeout(this._trantisionTimeout),this._inAnimation=!1,this._lastFrame=!0,this._transitionProgress=1},setTransitionTime:function(e){this._transitionTime=e},setDelay:function(e){this._transitionDelay=e},setTransitionCurve:function(e){this._transitionCurve=e}}),a.checkEqual=function(e,t){var n;for(n in t){if(!(n in e))return!1;if(typeof t[n]!=typeof e[n])return!1;if(Array.isArray(t[n])){if(!a.checkEqual(e[n],t[n]))return!1}else if(!(t[n]===e[n]||void 0===e[n]||"number"==typeof t[n]&&"number"==typeof e[n]&&isNaN(t[n])&&isNaN(e[n])))return!1}return!0},a}),define("objects.views/charts/utils/node",["core.utils/class"],function(e){var t;return t=e.extend("Node",{init:function(){this._parent=null,this._children=[],this._ancestors=null,this.data={}},detach:function(){return this._parent&&this._parent.removeChild(this),this},each:function(e,t){if("function"!=typeof e||!this._children||!this._children.length)return this;var n,i=this._children.length;for(n=0;n<i;n++)e.call(t,this._children[n],n),this._children[n].isBranch&&this._children[n].each(e,t);return this}}),Object.defineProperties(t.prototype,{parent:{get:function(){return this._parent}},isBranch:{get:function(){return this._children&&this._children.length}},children:{get:function(){return this._children}},siblings:{get:function(){if(!this._parent)return[];var e=this._parent._children.slice();return e.splice(e.indexOf(this),1),e}},ancestors:{get:function(){if(!this._ancestors){var e=this._parent;this._ancestors=e?[e].concat(e.ancestors):[]}return this._ancestors}},descendants:{get:function(){var e,t,n,i=[];for(e=0,t=this._children.length;e<t;e++)n=this._children[e],i.push(n),n._children.length&&(i=i.concat(n.descendants));return i}},leaves:{get:function(){var e,t,n=[],i=this._children.length;for(t=0;t<i;t++)(e=this._children[t])._children&&e._children.length?n=n.concat(e.leaves):n.push(e);return n}}}),t}),define("objects.views/charts/utils/matrix",["core.utils/class"],function(e){var t;return t=e.extend({init:function(){this._elements=[[1,0,0],[0,1,0],[0,0,1]],this._stack=[]},clone:function(){return(new t).multiply(this._elements)},set:function(e){return this._elements=e,this},save:function(){return this._stack.push(this.elements),this},restore:function(){return this._stack.length&&(this._elements=this._stack.pop()),this},add:function(e){var t,n;for(t=0;t<this._elements.length;t++)for(n=0;n<this._elements[t].length;n++)this._elements[t][n]+=e;return this},translate:function(e,t){return this.multiply([[1,0,e],[0,1,t],[0,0,1]]),this},rotate:function(e){var t=Math.cos(-e),n=Math.sin(-e);return this.multiply([[t,n,0],[-n,t,0],[0,0,1]]),this},skew:function(e,t){var n=Math.tan(e),i=Math.tan(t);return this.multiply([[1,n,0],[i,1,0],[0,0,1]]),this},multiply:function(e){var n,i,r,o;if(e instanceof t&&(e=e._elements),Array.isArray(e)){for(r=[[0,0,0],[0,0,0],[0,0,0]],n=0;n<this._elements.length;n++)for(i=0;i<this._elements[n].length;i++)for(o=0;o<3;o++)r[n][i]+=this._elements[n][o]*e[o][i];this._elements=r}else for(n=0;n<this._elements.length;n++)for(i=0;i<this._elements[n].length;i++)this._elements[n][i]*=e;return this},scale:function(e,t){return(arguments.length<2||void 0===t)&&(t=e),this.multiply([[e,0,0],[0,t,0],[0,0,1]]),this},determinant:function(){var e=this._elements[0][0],t=this._elements[0][1],n=this._elements[0][2],i=this._elements[1][0],r=this._elements[1][1],o=this._elements[1][2],s=this._elements[2][0],a=this._elements[2][1],l=this._elements[2][2];return e*r*l+t*o*s+n*i*a-n*r*s-t*i*l-e*o*a},invert:function(){var e=this.determinant(),t=this._elements[0][0],n=this._elements[0][1],i=this._elements[0][2],r=this._elements[1][0],o=this._elements[1][1],s=this._elements[1][2],a=this._elements[2][0],l=this._elements[2][1],c=this._elements[2][2];return this._elements=[[o*c-s*l,i*l-n*c,n*s-i*o],[s*a-r*c,t*c-i*a,i*r-t*s],[r*l-o*a,a*n-t*l,t*o-n*r]],this.multiply(1/e),this},transpose:function(){var e=Object.create(this._elements);return this._elements=[[e[0][0],e[1][0],e[2][0]],[e[0][1],e[1][1],e[2][1]],[e[0][2],e[1][2],e[2][2]]],this},identity:function(){return this._elements=[[1,0,0],[0,1,0],[0,0,1]],this},transformPoint:function(e){var t,n,i=[e.x,e.y,1],r=this._elements,o=[0,0,0];for(t=0;t<this._elements.length;t++)for(n=0;n<this._elements[t].length;n++)o[t]+=i[n]*r[t][n];return{x:o[0],y:o[1]}},transformPoints:function(e){var t,n,i,r,o,s=this._elements,a=[];for(r=0;r<e.length;r++){for(t=[e[r].x,e[r].y,1],o=[0,0,0],n=0;n<this._elements.length;n++)for(i=0;i<this._elements[n].length;i++)o[n]+=t[i]*s[n][i];a.push({x:o[0],y:o[1]})}return a},toString:function(){var e="";return this._elements.forEach(function(t,n,i){e+=t.join("\t")+(n<i.length?"\n":"")}),e},isIdentity:function(){var e=this._elements;return 1===e[0][0]&&0===e[0][1]&&0===e[0][2]&&0===e[1][0]&&1===e[1][1]&&0===e[1][2]&&0===e[2][0]&&0===e[2][1]&&1===e[2][2]},identityIfClose:function(e){var t=this._elements;Math.abs(t[0][0]-1)<e&&Math.abs(t[0][1])<e&&Math.abs(t[0][2])<e&&Math.abs(t[1][0])<e&&Math.abs(t[1][1]-1)<e&&Math.abs(t[1][2])<e&&Math.abs(t[2][0])<e&&Math.abs(t[2][1])<e&&Math.abs(t[2][2]-1)<e&&this.identity()}}),Object.defineProperties(t.prototype,{elements:{get:function(){var e=this._elements;return[[e[0][0],e[0][1],e[0][2]],[e[1][0],e[1][1],e[1][2]],[e[2][0],e[2][1],e[2][2]]]}}}),t}),define("objects.views/charts/utils/node-selector",["client.utils/property-resolver"],function(e){"use strict";var t={className:/^\w[\w-]+/,attr:/^\[\w(?:[\w\._-]+)?(?:[!]?=['\"][\w\s*#_-]*['\"])?\]/},n={className:function(e,t){return t.filter(function(t){var n=t.constructor.name;if(n){var i=e.replace(/(\-[a-z])/g,function(e){return e[1].toUpperCase()});return i=i[0].toUpperCase()+i.slice(1),n===e||n===i}})},attr:function(t,n,i,r){return r.filter(function(r){var o=e.getValue(r,t);if(!n)return void 0!==o;if(void 0===o)return!1;switch(n){case"=":return i===String(o);case"!=":return i!==String(o)}return!1})}};return{find:function(e,t){var n,i,r=[],o=[];return t.isBranch&&(n=this._tokenize(e),i=t.descendants,n.forEach(function(e){var t=i.slice(),n=[],r=!1;e.reverse().forEach(function(e){if(" "===e.type)return n.push(t),t=i.slice(),void(r=!1);t=this._filter(e,t),r=!0},this),r&&n.push(t);var s=n[0].filter(function(e){var t,i,r=e.parent;for(t=1;t<n.length;t++){for(;r&&(i=n[t].indexOf(r))<0;)r=r.parent;if(i<0)return!1}return!0});o.push(s)},this),o.forEach(function(e){e.forEach(function(e){r.indexOf(e)<0&&r.push(e)})})),r||[]},_filter:function(e,t){if(!t||!t.length||!e||"function"!=typeof n[e.type])return[];switch(e.type){case"className":return n[e.type](e.value,t);case"attr":return n[e.type](e.attribute,e.operator,e.attributeValue,t)}return[]},_tokenize:function(e){var n,i,r,o,s=[];return e.split(/\s*,\s*/).forEach(function(e){for(e=e.trim(),n=[];e;){o=!1,(r=e.match(/^\s*([>+~]|\s)\s*/))&&(o=!0,n.push({type:" ",value:r[0]}),e=e.slice(r[0].length));for(var a in t)(r=e.match(t[a]))&&(o=!0,e=e.slice(r[0].length),i={type:a,value:r[0]},"attr"===a&&(r=r[0].match(/\[(\w[\w\._-]+)?(?:([!]?=)['\"]([\w\s#_-]*)['\"])?\]/),i.attribute=r[1],i.operator=r[2],i.attributeValue=r[3]),n.push(i));if(n&&n.length&&s.indexOf(n)<0&&s.push(n),!o)break}}),s}}}),define("objects.views/charts/shapes/display-object",["objects.views/charts/utils/node","objects.views/charts/utils/matrix","general.utils/shapes/rect","objects.views/charts/utils/node-selector"],function(e,t,n,i){"use strict";function r(){this.matrix=new t,this.scale=s.scale,this.rotate=s.rotate,this.translate=s.translate,this._dirtyBounds=!0}var o,s={translate:function(e,t){return this.matrix.translate(e,t),this._dirtyBounds=!0,this.invalidate(),this},rotate:function(e){return this.matrix.rotate(e),this._dirtyBounds=!0,this.invalidate(),this},scale:function(e,t){return this.matrix.scale(e,t),this._dirtyBounds=!0,this.invalidate(),this}};return o=e.extend("DisplayObject",{init:function(){this._super(),this._dirtyBounds=!0,this._bounds=new n(NaN,NaN,NaN,NaN),this._vmBounds=new n(NaN,NaN,NaN,NaN),this._visualBounds=new n(NaN,NaN,NaN,NaN),this._stage=null,this.rData={inherited:{}},this._modelView=null,this._inverseModelView=null,this._inheritedProps={}},find:function(e){return i.find(e,this)},translate:function(e,t){return 0===e&&0===t?this:(r.call(this),s.translate.call(this,e,t))},rotate:function(e){return isNaN(e)||0===e?this:(r.call(this),s.rotate.call(this,e))},scale:function(e,t){return 1===e?this:(r.call(this),s.scale.call(this,e,t))},clearTransform:function(){return this.matrix&&(this.matrix.identity(),this._dirtyBounds=!0,this.invalidate()),this},invalidate:function(){var e=this._stage||this.stage;return e&&e.invalidateObject(this),this._inheritedProps={},this},attr:function(e){return void 0!==this[e]?this[e]:void 0!==this.rData.inherited[e]?this.rData.inherited[e]:void 0},attrs:function(e){for(var t in e)void 0===e[t]?delete this[t]:this[t]=e[t];return this},getBoundingRect:function(){return this._dirtyBounds&&this._calculateBounds(),this._vmBounds},getVisualBounds:function(){return this._dirtyBounds&&this._calculateBounds(),this._visualBounds},getVisualExpansion:function(){var e;return this.attr("stroke")&&(e=this.attr("strokeWidth"))?e/2:0},pointInside:function(e,t){if(!1===this.visible)return!1;var n,i=this.getInverseModelView();return i&&!0!==this._transformedIncomingPoint?(n=i.transformPoint({x:e,y:t}),this.containsPoint(n.x,n.y)):this.containsPoint(e,t)},intersectsLine:function(e){if(!1===this.visible)return!1;var t,n,i,r=this.getInverseModelView();return r&&!0!==this._transformedIncomingPoint?(n=r.transformPoint({x:e.x1,y:e.y1}),i=r.transformPoint({x:e.x2,y:e.y2}),(e=e.clone()).set(n.x,n.y,i.x,i.y),this._transformedIncomingPoint=!0,t=this.intersectsLocalLine(e),delete this._transformedIncomingPoint,t):this.intersectsLocalLine(e)},intersectsRect:function(e){if(!1===this.visible)return!1;var t,n,i=this.getInverseModelView();return i&&!0!==this._transformedIncomingPoint?(this._transformedIncomingPoint=!0,t=this._getTransformedBoundsOfRect(i,e),n=this.intersectsLocalRect(t),delete this._transformedIncomingPoint,n):this.intersectsLocalRect(e)},getPoints:function(){if(!1===this.visible)return[];var e,t,n,i=this.getModelView();if(i){for(t=0,n=(e=this.getLocalPoints().slice())?e.length:0;t<n;t++)e[t]=i.transformPoint(e[t]);return e}return this.getLocalPoints()},getLocalPoints:function(){return[]},intersectsLocalLine:function(){return!1},intersectsLocalRect:function(e){var t,n="function"==typeof e.getPoints?e.getPoints():[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}],i=n.length;for(t=0;t<i;t++)if(this.containsPoint(n[t].x,n[t].y))return!0;for(i=(n=this.getLocalPoints()).length,t=0;t<i;t++)if(n[t].x>=e.x&&n[t].x<=e.x+e.width&&n[t].y>=e.y&&n[t].y<=e.y+e.height)return!0;return!1},containsPoint:function(){return!1},getLocalBoundingRect:function(){return this._bounds},invalidateBounds:function(){return this._dirtyBounds=!0,this},clearModelView:function(){this._modelView=null,this._inverseModelView=null,this._isModelViewCalculated=!1,this._dirtyBounds=!0},getModelView:function(){return this._modelView||this._isModelViewCalculated||this._calculateModelView(),this._modelView},getInverseModelView:function(){return this._inverseModelView||this._isModelViewCalculated||this._calculateModelView(),this._inverseModelView},destroy:function(){this._stage=null},_calculateBounds:function(){var e,t=this._bounds,n=this.getLocalBoundingRect(),i=this.getModelView(),r=this.getVisualExpansion();n?(t.set(n.x,n.y,n.width,n.height),i?(e=this._getTransformedBoundsOfRect(i,t),this._vmBounds.set(e.x,e.y,e.width,e.height),e=this._getTransformedBoundsOfRect(i,{x:t.x-r,y:t.y-r,width:t.width+2*r,height:t.height+2*r}),this._visualBounds.set(e.x,e.y,e.width,e.height)):(this._vmBounds.set(n.x,n.y,n.width,n.height),this._visualBounds.set(n.x-r,n.y-r,n.width+2*r,n.height+2*r))):(t.set(NaN,NaN,NaN,NaN),this._vmBounds.set(NaN,NaN,NaN,NaN),this._visualBounds.set(NaN,NaN,NaN,NaN)),this._dirtyBounds=!1},_getTransformedBoundsOfRect:function(e,t){var i,r,o,s,a,l,c;return i=e.transformPoints([{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}]),r=i.map(function(e){return e.x}),o=i.map(function(e){return e.y}),s=Math.min.apply(null,r),l=Math.max.apply(null,r),a=Math.min.apply(null,o),c=Math.max.apply(null,o),new n(s,a,l-s,c-a)},_calculateModelView:function(){for(var e=this;e&&!e.rData.vmTransform;)e=e._parent;return this._isModelViewCalculated=!0,!!e&&(e._modelView||(e._modelView=new t,e._inverseModelView=new t),e.rData.dirtyVMTransform&&(e._modelView.set(e.rData.vmTransform),e._inverseModelView.set(e.rData.vmTransform).invert(),delete e.rData.dirtyVMTransform),this._modelView=e._modelView,this._inverseModelView=e._inverseModelView,!0)}}),Object.defineProperties(o.prototype,{stage:{get:function(){return this._parent&&!this._stage?this._stage=this._parent.stage:this._parent||this._stage===this||(this._stage=null),this._stage}}}),o}),define("general.utils/shapes/circle",["./rect"],function(e){"use strict";function t(e,t,n){0===arguments.length?this.set(0,0,0):this.set(e,t,n)}return t.prototype={toString:function(){return this.cx+" "+this.cy+" "+this.r},clone:function(){return new t(this.cx,this.cy,this.r)},set:function(e,t,n){this.cx=e,this.cy=t,this.r=n,this.radius=n},setPosition:function(e,t){this.cx=e,this.cy=t},setRadius:function(e){this.radius=e},combineWith:function(){},intersectsWith:function(e){return e.pointInside(this.cx,this.cy)},intersectsRect:function(e){return e.pointInside(this.cx,this.cy)},intersectsLine:function(e){if(this.pointInside(e.x1,e.y1)||this.pointInside(e.x2,e.y2))return!0;var t,n,i,r,o,s,a;if(t=Math.sqrt(Math.pow(e.x2-e.x1,2)+Math.pow(e.y2-e.y1,2)),n=(e.x2-e.x1)/t,i=(e.y2-e.y1)/t,r=n*(this.cx-e.x1)+i*(this.cy-e.y1),o=n*(this.cx-e.x2)+i*(this.cy-e.y2),r>=0&&o<=1){if(s=r*n+e.x1,a=r*i+e.y1,Math.sqrt(Math.pow(s-this.cx,2)+Math.pow(a-this.cy,2))<=this.r)return!0}else if(o>=0&&o<=1&&(s=o*n+e.x2,a=o*i+e.y2,Math.sqrt(Math.pow(s-this.cx,2)+Math.pow(a-this.cy,2))<=this.r))return!0;return!1},pointInside:function(e,t){return Math.sqrt(Math.pow(this.cx-e,2)+Math.pow(this.cy-t,2))<=this.r},getPoints:function(){return[{x:this.cx,y:this.cy}]},getBoundingRect:function(){return new e(this.cx-this.r,this.cy-this.r,2*this.r,2*this.r)}},t}),define("general.utils/shapes/vector",["core.utils/class"],function(e){var t;return t=e.extend({init:function(e,t){this.x=e||0,this.y=t||0},clone:function(){return new t(this.x,this.y)},add:function(e){this.x+=e.x,this.y+=e.y},dot:function(e){return this.x*e.x+this.y*e.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}),t.add=function(e,t){return e.clone().add(t)},t}),define("general.utils/shapes/arc",["./line","./circle","./rect","./vector"],function(e,t,n,i){"use strict";function r(e,t,n,i,r,o,s){this.cx=e,this.cy=t,this.innerRadius=n,this.radius=i,this.radianOffset=(s<0?s+2*Math.PI:s)%(2*Math.PI),this.start=r,this.start-=this.start>Math.PI?2*Math.PI:0,this.end=o,this.end-=this.end>Math.PI?2*Math.PI:0,this.arcCenter=(r+o)/2%(2*Math.PI),this.x1=e+i*Math.cos(this.start+this.radianOffset),this.y1=t+i*Math.sin(this.start+this.radianOffset),this.x2=e+i*Math.cos(this.end+this.radianOffset),this.y2=t+i*Math.sin(this.end+this.radianOffset),this.x3=e+n*Math.cos(this.start+this.radianOffset),this.y3=t+n*Math.sin(this.start+this.radianOffset),this.x4=e+n*Math.cos(this.end+this.radianOffset),this.y4=t+n*Math.sin(this.end+this.radianOffset)}var o=["top","left","bottom","right"],s={top:"left",left:"bottom",bottom:"right",right:"top"},a={top:"right",left:"top",bottom:"left",right:"bottom"};return r.prototype={getDistance:function(e,t,n,i){var r=Math.abs(e-n),o=Math.abs(t-i);return Math.sqrt(Math.pow(r,2)+Math.pow(o,2))},getAngle:function(e,t,n,i){var r=e-n,o=t-i,s=Math.atan2(o,r)-this.radianOffset;return s=s<0?s+2*Math.PI:s,s=s>Math.PI?s-2*Math.PI:s},pointInside:function(e,t){var n=this.getAngle(e,t,this.cx,this.cy),i=this.getDistance(e,t,this.cx,this.cy),r=this.start,o=this.end;return!(i>this.radius||i<this.innerRadius)&&(n>=r&&n<=o||r>o&&(n<=o||n>=r))},getDirection:function(e){(e+=Math.PI/4)<0&&(e+=2*Math.PI);var t=3;return(e%=2*Math.PI)>=1.5*Math.PI?t=0:e>=Math.PI?t=1:e>=Math.PI/2&&(t=2),o[t]},getSecondaryDirection:function(e){var t=this.getDirection(e);return(e+=Math.PI/4)%(Math.PI/2)>Math.PI/4?a[t]:s[t]},getPoints:function(){var e=[];return e.push({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},{x:this.x3,y:this.y3},{x:this.x4,y:this.y4}),e},getBoundingRect:function(){var e=Math.min(Math.min(this.x1,this.x2),Math.min(this.x3,this.x4)),t=Math.min(Math.min(this.y1,this.y2),Math.min(this.y3,this.y4)),i=Math.max(Math.max(this.x1,this.x2),Math.max(this.x3,this.x4))-e,r=Math.max(Math.max(this.y1,this.y2),Math.max(this.y3,this.y4))-t;return new n(e,t,i,r)},getRelevantPosition:function(){var e=this.cx+this.radius*Math.cos(this.arcCenter+this.radianOffset),t=this.cy+this.radius*Math.sin(this.arcCenter+this.radianOffset),n=this.getDirection(this.arcCenter+this.radianOffset),i=this.getSecondaryDirection(this.arcCenter+this.radianOffset);return{pos:{x:e,y:t},direction:[n,i].concat(i===s[n]?[a[n],s[i]]:[s[n],a[i]])}},intersectsWith:function(t){return this.intersectsLine(new e(t.x,t.y,t.x+t.width,t.y))||this.intersectsLine(new e(t.x+t.width,t.y,t.x+t.width,t.y+t.height))||this.intersectsLine(new e(t.x,t.y+t.height,t.x+t.width,t.y+t.height))||this.intersectsLine(new e(t.x,t.y,t.x,t.y+t.height))},intersectsLine:function(n){if(this.pointInside(n.x1,n.y1)||this.pointInside(n.x2,n.y2))return!0;if(n.intersectsLine(new e(this.x1,this.y1,this.x4,this.y4))||n.intersectsLine(new e(this.x3,this.y3,this.x2,this.y2)))return!0;var r=new t(this.cx,this.cy,this.innerRadius);if(this.innerRadius>0&&r.pointInside(n.x1,n.y1)&&r.pointInside(n.x2,n.y2))return!1;var o,s,a,l,c=new i(n.x2-n.x1,n.y2-n.y1),u=new i(n.x1-this.cx,n.y2-this.cy),h=c.dot(c),d=2*u.dot(c),p=d*d-4*h*(u.dot(u)-this.radius*this.radius),f=[];if(p<0)return!1;if(a=(-d+(p=Math.sqrt(p)))/(2*h),(s=(-d-p)/(2*h))>=0&&s<=1&&f.push({x:n.x1+s*c.x,y:n.y1+s*c.y}),a>=0&&a<=1&&f.push({x:n.x1+a*c.x,y:n.y1+a*c.y}),!f.length)return!1;for(o=0;o<f.length;o++){if((l=this.getAngle(f[o].x,f[o].y,this.cx,this.cy))>=this.start&&l<=this.end)return!0;if(this.start>this.end&&(l<=this.end||l>=this.start))return!0}return!1}},r}),define("objects.views/charts/shapes/arc",["objects.views/charts/shapes/display-object","general.utils/shapes/arc"],function(e,t){"use strict";var n,i=Math.PI/2,r=3*Math.PI/2,o=2*Math.PI;return n=e.extend("Arc",{init:function(e,n,i,r,o,s,a){this._super(),t.apply(this,[e,n,i,r,o,s,a])},containsPoint:t.prototype.pointInside,intersectsLocalLine:t.prototype.intersectsLine,getLocalPoints:t.prototype.getPoints,intersectsLocalRect:function(e){return t.prototype.intersectsWith.call(this,e)},getLocalBoundingRect:function(){var e,t,n=[this.x1,this.x2,this.x3,this.x4],s=[this.y1,this.y2,this.y3,this.y4],a=(this.start+this.radianOffset)%o,l=a+this.end-this.start;return(a<o&&l>o||a<0&&l>0)&&n.push(this.cx+this.radius),a<i&&l>i&&s.push(this.cy+this.radius),a<Math.PI&&l>Math.PI&&n.push(this.cx-this.radius),(a<r&&l>r||a<-i&&l>-i)&&s.push(this.cy-this.radius),e=Math.min.apply(null,n),t=Math.min.apply(null,s),{x:e,y:t,width:Math.max.apply(null,n)-e,height:Math.max.apply(null,s)-t}},getRelevantPosition:function(){var e=this.getModelView(),n=t.prototype.getRelevantPosition.call(this);if(e){var i={x:this.cx+this.radius*Math.cos(this.arcCenter+this.radianOffset),y:this.cy+this.radius*Math.sin(this.arcCenter+this.radianOffset)};i=e.transformPoint(i),n.pos.x=i.x,n.pos.y=i.y}return n},set:function(){t.apply(this,[].slice.call(arguments)),this.invalidateBounds()}}),Object.keys(t.prototype).forEach(function(e){!n.prototype.hasOwnProperty(e)&&["pointInside","intersectsLine","getBoundingRect","getPoints","getRelevantPosition","intersectsRect"].indexOf(e)<0&&(n.prototype[e]=t.prototype[e])}),n}),define("objects.views/charts/components/chart-component",["../invalidatable","objects.views/charts/utils/transition-helper","general.utils/shapes/rect","objects.views/charts/shapes/arc","objects.utils/layout","core.utils/deferred","jquery"],function(e,t,n,i,r,o,s){"use strict";function a(e){if(this._$renderAreaWrap){this.containerRect=new n(this.rect.x*this.layoutToContainerRatios.x||1,this.rect.y*this.layoutToContainerRatios.y||1,this.rect.width*this.layoutToContainerRatios.x||1,this.rect.height*this.layoutToContainerRatios.y||1),this.container.style.left=this.containerRect.x+"px",this.container.style.top=this.containerRect.y+"px",this.container.style.width=this.containerRect.width+"px",this.container.style.height=this.containerRect.height+"px";var t=this.isVisible(e)&&0!==this.rect.width&&0!==this.rect.height?"block":"none";this.container.style.display!==t&&(this.container.style.display=t)}}function l(e,n){return t.checkEqual(e,n)}function c(e){return e?(e=e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()})).replace(/^\-/,""):""}return e.extend("ChartComponent",{init:function(e,i,r){this._super(),this.testId=r,this.options=s.extend(!0,{},{dock:"center",show:!0,relevantSize:0,showFlag:this.ShowFlags.SPARK,components:{}},i),this.rect=new n,this._transitionHelper=new t,this._transitionHelper.setTransitionCurve("easein"),this._oldProperties={},this._currentProperties={},this._transitionProperties={},this._useTransition=!1,this.outerRect=new n,this.containerRect=new n,this.layoutToContainerRatios={x:1,y:1},this.renderers={},this.dock=this.options.dock,this.show=this.options.show,this.isMini=this.options.isMini,this.relevantSize=this.options.relevantSize,this.showFlag=this.options.showFlag,this.layoutOrder=this.options.order||1,this.reductionOrder=this.options.reductionOrder,this.parentContainer=e,this.components=this.options.components,this.selectionIdentifier=this.options.label,this._selectionIndices=[0],this.chartFormatter=null,this.measureFormatters=[],this._globalAlpha=1,this._hasValidData=!1,this._createRenderArea();try{var o=i&&i.tcl?i.tcl:c(this.constructor.name);o&&this._$renderAreaWrap[0].setAttribute("tcl",o)}catch(e){}this.chartScale=1,this._edgeBleed={top:0,bottom:0,left:0,right:0}},ShowFlags:{SPARK:1,XSMALL:2,SMALL:4,MEDIUM:8,FULL:16},setData:function(e){return this._data=e,this.invalidateProperties("ChartComponent.setData")},getTransformedShape:function(e){var t,r=this.layoutToContainerRatios.x||1,o=this.layoutToContainerRatios.y||1;if(e instanceof n)t=new n(e.x*r,e.y*o,e.width*r,e.height*o);else if(e instanceof i){var s=e.getModelView(),a={x:e.cx*r,y:e.cy*o};s&&(a=s.transformPoint(a)),t=new i(a.x,a.y,Math.min(r,o)*e.innerRadius,Math.min(r,o)*e.radius,e.start,e.end,e.radianOffset)}return t},getTransformedPoint:function(e,t){return{x:e*this.layoutToContainerRatios.x||1,y:t*this.layoutToContainerRatios.y||1}},getOriginalPoint:function(e,t){return{x:e/this.layoutToContainerRatios.x||1,y:t/this.layoutToContainerRatios.y||1}},setLayoutMode:function(e){if(this._layoutMode!==e){this._layoutMode=e;var t=/\s*qv-layout-\S+\s*/g,n=this._layoutMode?" qv-layout-"+r.getLayoutModeKey(e):"";this.container.className.match(t)?this.container.className=this.container.className.replace(/\s*qv-layout-\S+/g,n):this.container.className+=n,this.invalidateDisplay("ChartComponent.setLayoutMode")}},getLayoutMode:function(){return this._layoutMode},setVerticalLayoutMode:function(e){this._verticalLayoutMode=e},setHorizontalLayoutMode:function(e){this._horizontalLayoutMode=e},setSelectableShapes:function(e){this._selectableShapes=e},getSelectableShapes:function(){return this._selectableShapes||[]},getSelectedCacheItems:function(){var e,t=this._selectableShapes?this._selectableShapes.length:0,n=[];for(e=0;e<t;e++)this._selectableShapes[e].selected&&n.push(this._selectableShapes[e]);return n},getRect:function(){return this.rect},setRect:function(e,t,n,i){this.rect.set(e,t,n,i)},setUseTransition:function(e){this._useTransition=e},getUseTransition:function(){return this._useTransition},getTransitionHelper:function(){return this._transitionHelper},setOuterRect:function(e,t,n,i){this.outerRect.set(e,t,n,i)},setLayoutToContainerRatios:function(e,t){this.layoutToContainerRatios={x:e,y:t}},setContainerRect:function(e,t,n,i){this.containerRect.set(e,t,n,i)},setSelectionIndices:function(e){if(!(e&&e instanceof Array))throw"invalid input, selectionsIndices has to be an Array";this._selectionIndices=e},getSelectionIndices:function(){return this._selectionIndices},setSelectionLocked:function(e){this._selectionLocked=e},isSelectionLocked:function(e){e=e||this._data;var t=this.getSelectionIndices();return e&&Array.isArray(t)&&t.length?!e.qHyperCube.qDimensionInfo.filter(function(e,n){return-1!==t.indexOf(n)},this).some(function(e){return!0!==e.qLocked}):this._selectionLocked},setYMirrorMode:function(e){this.yMirrorMode=e,this.readDirection=this.yMirrorMode?"rtl":"ltr"},setDock:function(e){switch(e){case"left":case"top":case"right":case"bottom":case"center":break;default:throw e+" invalid parameter"}this.options.dock=e,this.dock=e},getOppositeDock:function(){var e=this.options.dock;switch(e){case"left":return"right";case"top":return"bottom";case"right":return"left";case"bottom":return"top";case"center":return"center";default:throw e+" invalid parameter"}},isHorizontal:function(){switch(this.options.dock){case"top":case"bottom":return!0;default:return!1}},isVertical:function(){switch(this.options.dock){case"left":case"right":return!0;default:return!1}},showComponent:function(){if(this.show=this.options.show,this.renderers)for(var e in this.renderers)this.renderers[e].show()},hideComponent:function(){if(this.show=!1,this.renderers)for(var e in this.renderers)this.renderers[e].hide()},getFormatter:function(){return this._formatter||this.measureFormatters[0]||{format:function(e){return e.toString()}}},isVisible:function(e){void 0===e&&(e=this._layoutMode);var t=this.showFlag,n=e;return"object"==typeof t&&("whenVertical"in t&&(t=this.isVertical()?t.whenVertical:t.whenHorizontal),"vertical"in t)?this.show&&!!(t.vertical&this._verticalLayoutMode)&&!!(t.horizontal&this._horizontalLayoutMode):this.show&&!!(t&n)},setHasValidData:function(e){this._hasValidData=e},hasValidData:function(){return this._hasValidData},calculateRelevantSize:function(){this.relevantSize=this.options.relevantSize},reduceLayoutRect:function(e){switch(this.dock){case"top":e.y+=this.relevantSize,e.height-=this.relevantSize;break;case"bottom":e.height-=this.relevantSize;break;case"left":e.x+=this.relevantSize,e.width-=this.relevantSize;break;case"right":e.width-=this.relevantSize}},insertAdjacentTo:function(e,t){switch(this.dock){case"top":this.rect.x=e.x,this.rect.y=e.y-this.relevantSize,this.rect.width=e.width,this.rect.height=this.isVisible(this._layoutMode)?this.relevantSize:0,t&&(e.y-=this.relevantSize,e.height+=this.relevantSize);break;case"bottom":this.rect.x=e.x,this.rect.y=e.getBottom(),this.rect.width=e.width,this.rect.height=this.isVisible(this._layoutMode)?this.relevantSize:0,t&&(e.height+=this.relevantSize);break;case"left":this.rect.x=e.x-this.relevantSize,this.rect.y=e.y,this.rect.width=this.isVisible(this._layoutMode)?this.relevantSize:0,this.rect.height=e.height,t&&(e.x-=this.relevantSize,e.width+=this.relevantSize);break;case"right":this.rect.x=e.getRight(),this.rect.y=e.y,this.rect.width=this.isVisible(this._layoutMode)?this.relevantSize:0,this.rect.height=e.height,t&&(e.width+=this.relevantSize);break;case"center":this.rect.x=e.x,this.rect.y=e.y,this.rect.width=e.width,this.rect.height=e.height}},_updateProperties:function(){return this._transition()},_updateDisplay:function(){return this.hasValidData()?this.isVisible(this._layoutMode)&&this.rect.width>0&&this.rect.height>0?this.paint(this._layoutMode,this._data):o.resolve():this.clear()},updateSize:function(){a.call(this,this._layoutMode);for(var e in this.renderers)this.renderers[e].setDimensions(0,0,this.rect.width,this.rect.height),this.renderers[e].setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y);this._windowSizeMultiplier=Math.min(Math.min(this.rect.width,this.rect.height)/600,1)},_transition:function(){this._useTransition?l(this._currentProperties,this._transitionProperties)?this._onAnimatitonEnd():(this._inTransition=!0,this._transitionHelper.transition(this._oldProperties,this._currentProperties,this._transitionProperties,this._onAnimatitonEnd,this._updateDisplay,this)):(s.extend(this._currentProperties,this._transitionProperties),s.extend(this._oldProperties,this._transitionProperties),this.invalidateDisplay("onAnimatitonEnd"))},paint:function(){},setGlobalOpacity:function(e,t){this._globalAlpha=e,t||this.invalidateDisplay("ChartComponent.setGlobalOpacity")},_createRenderArea:function(){this.parentContainer&&(this.container=document.createElement("div"),this._$renderAreaWrap=s(this.container),this._$renderAreaWrap.attr("tid",this.testId),this._$renderAreaWrap.css({position:"absolute"}).addClass("qv-chart-component"),this.parentContainer.appendChild(this.container))},_onAnimatitonEnd:function(){this._inTransition=!1,this._oldProperties=s.extend(!0,{},this._transitionProperties),this.invalidateDisplay("onAnimatitonEnd")},release:function(){if(this._super(),this.renderers)for(var e in this.renderers)this.renderers[e].release();this.container=null,this._$renderAreaWrap=null,this._selectableShapes=null,this._transitionHelper.clear()},clear:function(){var e=[];if(this.renderers)for(var t in this.renderers)e.push(this.renderers[t].clear());return o.all(e)},on:function(){this._on=!0},off:function(){this._on=!1}})}),define("objects.views/charts/shapes/polygon",["objects.views/charts/shapes/display-object","general.utils/shapes/polygon","general.utils/shapes/line"],function(e,t){"use strict";var n;return n=e.extend("Polygon",{init:function(e){this._super(),e?this.set(e):this._polygons=[]},getLocalBoundingRect:function(){var e;if(this._polygons&&this._polygons.length)return e=this._polygons.reduce(function(e,t){return e.combineWith(t.getBoundingRect())},this._polygons[0].getBoundingRect()),{x:e.x,y:e.y,width:e.width,height:e.height}},getLocalPoints:function(){return this._polygons&&this._polygons[0]?this._polygons[0].points:[]},getPartialFromRange:function(e,t){for(var i,r=0,o=[],s=this._polygons[0]?this._polygons[0].points:[],a=s.length,l=e<=t;r<a&&(l?s[r].x<e:s[r].x>e);)r++;for(r&&r<a&&(i=(e-s[r-1].x)/(s[r].x-s[r-1].x),o.push({x:e,y:s[r-1].y+i*(s[r].y-s[r-1].y),y_:s[r-1].y_+i*(s[r].y_-s[r-1].y_)}));r<a&&(l?s[r].x<t:s[r].x>t);)o.push({x:s[r].x,y:s[r].y,y_:s[r].y_}),r++;if(r&&r<a&&(i=(t-s[r-1].x)/(s[r].x-s[r-1].x),o.push({x:t,y:s[r-1].y+i*(s[r].y-s[r-1].y),y_:s[r-1].y_+i*(s[r].y_-s[r-1].y_)})),o.length)return new n(o)},set:function(e){var n=e&&e[0]&&Array.isArray(e[0])?e:[e];this._polygons=n.map(function(e){return new t(e)}),this.invalidateBounds()},intersectsLocalLine:function(e){return this._polygons.some(function(t){return t.intersectsLine(e)})},intersectsLocalRect:function(e){return this._polygons.some(function(n){return t.prototype.intersectsRect.call(n,e)})},containsPoint:function(e,t){return this._polygons.some(function(n){return n.pointInside(e,t)})}})}),define("objects.views/charts/utils/tree-node",["objects.views/charts/utils/node"],function(e){"use strict";var t;return e.extend("TreeNode",{addChild:function(n){if(!(n&&n instanceof e))throw new TypeError("Expecting a Node as argument, but got "+n);if(n===this)throw"Can not add itself as child!";if(n._children&&n._children.length&&this.ancestors.indexOf(n)>=0)throw"Can not add an ancestor as child!";return n._parent&&n._parent!==this&&n._parent.removeChild(n),n._pushed&&(t=this._children.indexOf(n))>=0&&this._children.splice(t,1),n._pushed=!0,this._children.push(n),n._parent=this,n._ancestors=null,this},addChildren:function(e){var t,n=e?e.length:0;for(t=0;t<n;t++)this.addChild(e[t]);return this},removeChild:function(e){return(t=this._children.indexOf(e))>=0&&(this._children.splice(t,1),e._parent=null,e._ancestors=null),this},removeChildren:function(e){var t,n;if(!this._children)return this;if(e)for(n=e.length,t=0;t<n;t++)this.removeChild(e[t]);else for(;this._children.length;)this.removeChild(this._children[0]);return this}})}),define("objects.views/charts/shapes/container",["objects.views/charts/shapes/display-object","objects.views/charts/utils/tree-node"],function(e,t){"use strict";return e.extend("Container",{init:function(){this._super()},addChild:function(e){t.prototype.addChild.call(this,e),this.doInvalidate&&e.invalidate()},addChildren:t.prototype.addChildren,removeChild:function(e){this.doInvalidate&&e.invalidate(),e._stage=null;var n,i=e.descendants,r=i?i.length:0;for(n=0;n<r;n++)i[n]._stage=null;return t.prototype.removeChild.call(this,e),this},removeChildren:function(e){var t,n,i,r,o;if(!this._children)return this;if(e)for(i=e.length,t=0;t<i;t++)this.removeChild(e[t]);else{for(i=this._children.length,t=0;t<i;t++)for(this._children[t]._parent=null,this._children[t]._ancestors=null,this._children[t]._stage=null,o=(r=this._children[t].descendants)?r.length:0,n=0;n<o;n++)r[n]._stage=null;this._children.length=0}return this},containsPoint:function(e,t){if(this._children&&this._children.length)for(var n=0,i=this._children.length;n<i;n++)if(this._children[n].containsPoint(e,t))return!0;return!1},intersectsLocalRect:function(e){if(this._children&&this._children.length)for(var t=0,n=this._children.length;t<n;t++)if(this._children[t].intersectsLocalRect(e))return!0;return!1},intersectsLocalLine:function(e){if(this._children&&this._children.length)for(var t=0,n=this._children.length;t<n;t++)if(this._children[t].intersectsLocalLine(e))return!0;return!1},getLocalPoints:function(){var e=[];if(this._children&&this._children.length)for(var t=0,n=this._children.length;t<n;t++)e=e.concat(this._children[t].getLocalPoints());return e},getLocalBoundingRect:function(){var e,t,n,i,r,o,s,a=!1;if(this._children&&this._children.length){for(o=0,s=this._children.length;o<s;o++)(r=this._children[o].getVisualBounds())&&!isNaN(r.width+r.height+r.x+r.y)&&(a?(e=Math.min(e,r.x),n=Math.max(n,r.x+r.width),t=Math.min(t,r.y),i=Math.max(i,r.y+r.height)):(e=r.x,n=r.x+r.width,t=r.y,i=r.y+r.height,a=!0));return a?{x:e,y:t,width:n-e,height:i-t}:void 0}},_calculateBounds:function(){var e=this._bounds,t=this.getLocalBoundingRect();t?(e.set(t.x,t.y,t.width,t.height),this._vmBounds.set(t.x,t.y,t.width,t.height),this._visualBounds.set(t.x-0,t.y-0,t.width+0,t.height+0)):(e.set(NaN,NaN,NaN,NaN),this._vmBounds.set(NaN,NaN,NaN,NaN),this._visualBounds.set(NaN,NaN,NaN,NaN)),this._dirtyBounds=!1}})}),define("objects.views/charts/renderers/stage",["objects.views/charts/shapes/container","general.utils/shapes/rect","core.utils/notification"],function(e,t,n){return e.extend("Stage",{init:function(){this._super(),this._stage=this,this._dimensions=new t(0,0,0,0),n.create(this,"Invalid")},invalidateObject:function(e){return this.Invalid.emit(e),this},destroy:function(){this._super(),n.release(this)}})}),define("objects.views/charts/renderers/renderer",["core.utils/class","objects.views/charts/renderers/stage","general.utils/shapes/rect","objects.views/charts/utils/node-selector"],function(e,t,n,i){"use strict";var r;return r=e.extend("Renderer",{init:function(){this._stage=new t,this._stageBinding=function(e){this.invalidateObject(e)}.bind(this),this._stage.Invalid.bind(this._stageBinding),this.scaling={x:1,y:1},this._size=new n,this._extendedSize=new n},find:function(e){return i.find(e,this._stage)},setDimensions:function(e,t,n,i){this._size.set(e,t,n,i)},setDimensionsToContainerRatio:function(e,t){this.scaling={x:e,y:t}},release:function(){this._stage&&this._stage.Invalid&&this._stage.Invalid.unbind(this._stageBinding),this._stage.destroy(),this._stageBinding=null},render:function(){},clear:function(){},invalidateObject:function(){}}),Object.defineProperties(r.prototype,{stage:{get:function(){return this._stage}}}),r}),define("objects.views/charts/shapes/rect",["objects.views/charts/shapes/display-object","general.utils/shapes/rect"],function(e,t){"use strict";var n;return n=e.extend("Rect",{init:function(e,n,i,r,o){this._super(),this._radius=o||0,t.apply(this,[e,n,i,r])},containsPoint:t.prototype.pointInside,intersectsLocalLine:t.prototype.intersectsLine,intersectsLocalRect:t.prototype.intersectsRect,getLocalBoundingRect:t.prototype.getBoundingRect,getLocalPoints:t.prototype.getPoints,set:function(e,n,i,r,o){t.prototype.set.apply(this,[e,n,i,r]),o>=0&&(this._radius=o),this.invalidateBounds()}}),Object.keys(t.prototype).forEach(function(e){!n.prototype.hasOwnProperty(e)&&["pointInside","intersectsLine","getBoundingRect","getPoints","intersectsRect"].indexOf(e)<0&&(n.prototype[e]=t.prototype[e])}),n}),define("objects.views/charts/renderers/canvas/rect",["objects.views/charts/shapes/rect"],function(e){"use strict";return{displayObject:e,render:function(e,t,n){if(this._radius){var i=this.x,r=this.y,o=this.width,s=this.height,a=Math.min(this._radius,o/2,s/2),l=i+o,c=r+s;e.beginPath(),e.moveTo(i+a,r),e.quadraticCurveTo(i,r,i,r+a),e.lineTo(i,c-a),e.quadraticCurveTo(i,c,i+a,c),e.lineTo(l-a,c),e.quadraticCurveTo(l,c,l,c-a),e.lineTo(l,r+a),e.quadraticCurveTo(l,r,l-a,r),e.lineTo(i+a,r),e.closePath(),t&&e.fill(),n&&e.stroke()}else t&&e.fillRect(this.x,this.y,this.width,this.height),n&&e.strokeRect(this.x,this.y,this.width,this.height)}}}),define("objects.views/charts/shapes/circle",["objects.views/charts/shapes/display-object","general.utils/shapes/circle"],function(e,t){"use strict";var n;return n=e.extend("Circle",{init:function(e,n,i){this._super(),t.apply(this,[e,n,i])},containsPoint:t.prototype.pointInside,intersectsLocalLine:t.prototype.intersectsLine,intersectsLocalRect:t.prototype.intersectsRect,getLocalPoints:t.prototype.getPoints,getLocalBoundingRect:function(){return{x:this.cx-this.r,y:this.cy-this.r,width:2*this.r,height:2*this.r}},set:function(){t.prototype.set.apply(this,[].slice.call(arguments)),this.invalidateBounds()}}),Object.keys(t.prototype).forEach(function(e){!n.prototype.hasOwnProperty(e)&&["pointInside","intersectsLine","getBoundingRect","getPoints","intersectsRect"].indexOf(e)<0&&(n.prototype[e]=t.prototype[e])}),n}),define("objects.views/charts/renderers/canvas/circle",["objects.views/charts/shapes/circle"],function(e){"use strict";return{displayObject:e,render:function(e,t,n){e.beginPath(),e.moveTo(this.cx+this.r,this.cy),e.arc(this.cx,this.cy,this.r,0,2*Math.PI,!1),t&&e.fill(),n&&e.stroke()}}}),define("objects.views/charts/shapes/line",["objects.views/charts/shapes/display-object","general.utils/shapes/line","util"],function(e,t,n){"use strict";var i;return i=e.extend("Line",{init:function(e,n,i,r){this._super(),t.apply(this,[e,n,i,r])},containsPoint:function(){return!1},intersectsLocalLine:t.prototype.intersectsLine,intersectsLocalRect:t.prototype.intersectsRect,getLocalPoints:t.prototype.getPoints,getLocalBoundingRect:function(){var e=Math.min(this.x1,this.x2),t=Math.max(this.x1,this.x2),n=Math.min(this.y1,this.y2);return{x:e,y:n,width:t-e,height:Math.max(this.y1,this.y2)-n}},set:function(){t.prototype.set.apply(this,[].slice.call(arguments)),this.invalidateBounds()},getPartialFromRange:function(e,t){if(!(t<this.x1||e>this.x2)){var r=this.x2-this.x1,o=this.y2-this.y1,s=e<=this.x1?0:(e-this.x1)/r,a=t>=this.x2?1:(t-this.x1)/r,l=new i(this.x1+s*r,this.y1+s*o,this.x1+a*r,this.y1+a*o);if(l.data=n.extend({},this.data),!isNaN(this.data.y1_)){var c=this.data.y2_-this.data.y1_;l.data.y1_=this.data.y1_+s*c,l.data.y2_=this.data.y1_+a*c}return l}}}),Object.keys(t.prototype).forEach(function(e){!t.prototype.hasOwnProperty(e)&&["pointInside","intersectsLine","getBoundingRect","getPoints","intersectsRect"].indexOf(e)<0&&(i.prototype[e]=t.prototype[e])}),i}),define("objects.views/charts/renderers/canvas/line",["objects.views/charts/shapes/line"],function(e){"use strict";return{displayObject:e,render:function(e,t,n){n&&(e.beginPath(),e.moveTo(this.x1,this.y1),e.lineTo(this.x2,this.y2),e.stroke())}}}),define("objects.views/charts/renderers/canvas/polygon",["objects.views/charts/shapes/polygon"],function(e){"use strict";return{displayObject:e,render:function(e,t,n){var i,r,o,s,a,l;for(e.beginPath(),a=0;a<this._polygons.length;a++){if(i=this._polygons[a].points,r=i?i.length:0,!(o=i[0]))return;for(l=o,e.moveTo(o.x,o.y),s=1;s<r;s+=1)o=i[s],e.lineTo(o.x,o.y);!1===this.close||!n||l.x===o.x&&l.y===o.y||e.lineTo(l.x,l.y)}!1!==this.close&&e.closePath(),t&&e.fill(),n&&e.stroke()}}}),define("objects.views/charts/renderers/canvas/arc",["objects.views/charts/shapes/arc"],function(e){"use strict";return{displayObject:e,render:function(e,t,n){e.beginPath(),0===this.innerRadius?(e.arc(this.cx,this.cy,this.radius,this.start+this.radianOffset,this.end+this.radianOffset,!1),e.lineTo(this.innerRadius*Math.cos(this.end+this.radianOffset)+this.cx,this.innerRadius*Math.sin(this.end+this.radianOffset)+this.cy)):this.end-this.start==2*Math.PI?(e.arc(this.cx,this.cy,this.radius,this.start+this.radianOffset,this.end+this.radianOffset,!1),e.moveTo(this.cx+this.innerRadius*Math.cos(this.radianOffset+this.start),this.cy+this.innerRadius*Math.sin(this.radianOffset+this.start)),e.arc(this.cx,this.cy,this.innerRadius,this.end+this.radianOffset,this.start+this.radianOffset,!0)):(e.arc(this.cx,this.cy,this.radius,this.start+this.radianOffset,this.end+this.radianOffset,!1),e.lineTo(this.innerRadius*Math.cos(this.end+this.radianOffset)+this.cx,this.innerRadius*Math.sin(this.end+this.radianOffset)+this.cy),e.arc(this.cx,this.cy,this.innerRadius,this.end+this.radianOffset,this.start+this.radianOffset,!0),e.lineTo(this.radius*Math.cos(this.start+this.radianOffset)+this.cx,this.radius*Math.sin(this.start+this.radianOffset)+this.cy)),t&&e.fill(),n&&(e.closePath(),e.stroke())}}}),define("objects.views/charts/shapes/text-helper",[],function(){function e(e,t,n,i){var r,o,a,l,c=e?e.split(/\n+|\r+|\r\n/):[],u=[],h=e?e.split(/\s+/):[],d=c[0];if("number"!=typeof t||t<=0)return[e];if("number"==typeof i&&c.length>=i)return c.slice(0,i);for(n&&(s.font=n),o=0;o<c.length;o++){for(d=(h=(c[o]||"").split(/\s+/))[0],l="",r=1;r<h.length;r++)if(a=d+" "+h[r],s.measureText(a).width>t&&("number"!=typeof i||i>u.length)?(u.push(d),d=h[r]):d=a,"number"==typeof i&&u.length>=i){l=h.slice(r+1).join(" ");break}"number"!=typeof i||u.length<i?u.push(d):u[Math.max(0,u.length-1)]=(u[Math.max(0,u.length-1)]||"")+" "+d+" "+l}return u}function t(e,t,i,r,a){if(!e||!e.length)return[];i&&(s.font=i);var l,c,u,h,d=[],p=e.slice();if(p.filter(function(e){return!!e}),"number"!=typeof t||t<0)return e.slice();for(h=0;h<p.length;h++)c=null,(u=p[h])&&(u.length<=1||s.measureText(u).width<=t?d.push(u):(l=o(u,t,void 0,r-d.length)).length<=1?d.push(l[0]):(c=l.pop(),d=d.concat(l),p[h+1]?s.measureText(c+" "+p[h+1]).width>t&&d.length+p.length-h<=r?p.splice(h+1,0,c):p[h+1]=c+" "+p[h+1]:p.push(c)));return d.forEach(function(e,t,n){n[t]=e?e.trim():e}),d.length>r?(d=d.splice(0,r))[d.length-1]=n(d[d.length-1],t,i,a).text:(u=d[d.length-1])&&u.length>1&&s.measureText(u).width>t&&(d[d.length-1]=n(u,t,i,a).text),d}function n(e,t,n,i){var r,o,l,c,u=e,h=s.measureText("i").width,d=Math.ceil(t/h);if(i=i||a,n&&(s.font=n),e&&t){if(s.measureText(u).width>t){for(r=Math.min(d,u.length);r>0;r--)if(o=u.substring(0,r-1),l=o.trim()+i,s.measureText(l).width<=t){c=u.substring(r-1),u=l;break}r||(c=u,u=a)}}else c=void 0;return{text:u,rest:c}}function i(e){return"number"==typeof e&&isFinite(e)}function r(e,t,n,o){var a,c=e,u="",h=[];if(i(n)&&n<=1)return[e];var d=Math.ceil(t/o);for(a=Math.min(e.length,d);a>0&&(c=e.substring(0,a)," "===e.substring(a-1,a)?c=e.substring(0,a-1):c+=l,u=e.substring(a),!(s.measureText(c).width<=t));a--);return(!a&&!c||s.measureText(c).width>t)&&(c=e.substring(0,1),u=e.substring(1)),h.push(c),u?(s.measureText(u).width>t?(u=r(u,t,n-1,o),h=h.concat(u)):h.push(u),h.filter(function(e){return""!==e.trim()})):h}function o(e,t,n,i){return e&&t?(n&&(s.font=n),r(e,t,i,Math.max(1,s.measureText("i").width))):[]}var s=document.createElement("canvas").getContext("2d"),a="",l="-";return{lineWrap:e,wordWrap:t,splitWord:o,wrap:function(n,i,r,o,s){var a;return isNaN(i)?[n]:(a=o>1?e(n,i,r,o):[n],a=t(a,i,r,o,s))},truncate:n}}),define("objects.views/charts/shapes/text",["objects.views/charts/shapes/display-object","objects.views/charts/shapes/text-helper","general.utils/shapes/line"],function(e,t,n){"use strict";function i(e){return 1.5*e.measureText("m").width}function r(e){o.font=this.font;var n,r=i(o),s=(this.lineHeightMultiplicator||1)*r,a="maxWidth"in this?this.maxWidth:this.width,l="maxHeight"in this?this.maxHeight:this.height,c=this.maxNumLines,u=[],h=0,d=[];return this.lineHeight=s,l<r?[]:(n=l?Math.max(1,Math.floor(l/s)):c||1,Array.isArray(c)?(c.forEach(function(e){h+=isNaN(e)||e<=0?0:e}),c.forEach(function(e){u.push(isNaN(e)||e<=0?n-h:e)})):u=[isNaN(c)||c<=0?n:Math.min(n,c)],Array.isArray(e)?e.forEach(function(e,i){d.length<n&&(d=d.concat(t.wrap(e,a,this.font,u[i])))},this):d=t.wrap(e,a,this.font,u[0],this.ellipsis),d)}var o=document.createElement("canvas").getContext("2d");return e.extend("Text",{init:function(){this._super(),this.options={},this.x=0,this.y=0,this.lineHeightMultiplicator=1,this._dirtyMeasures=!0,this._measures={numLines:0,width:0,height:0}},setText:function(e){return this.text=e,this.invalidateBounds(),this},tokenize:function(){return this.lines=r.apply(this,[this.text]),this},measure:function(){if(this.preRender(),this._dirtyMeasures){var e,t=0,n=this.lines;for(o.font!==this.font&&(o.font=this.font),e=0;e<n.length;e++)t=Math.max(t,o.measureText(n[e]).width);this._measures.numLines=n.length,this._measures.width=t,this._measures.height=n.length*this.lineHeight,this._dirtyMeasures=!1}return{numLines:this._measures.numLines,width:this._measures.width,height:this._measures.height}},getHorizontalAnchor:function(){var e,t=this.x||0;if(this.width>0){if("center"===(e=this.attr("align")))return t+this.width/2;if("right"===e)return t+this.width}return t},getVerticalAnchorFirstLine:function(){var e,t=this.y||0,n=this.attr("baseline");return"middle"===n?(e=this.attr("lineHeight"),t-=(this.lines.length-1)*e/2,this.height>0&&(t+=this.height/2)):"bottom"===n&&(e=this.attr("lineHeight"),t-=(this.lines.length-1)*e,this.height>0&&(t+=this.height)),t},preRender:function(){var e,t="";Array.isArray(this.text)?this.text.forEach(function(e){t+=e+"__"}):t=this.text,e=this.attr("font"),this.font=e;var n=t+e+this.maxWidth+this.width+this.height;return n!==this._renderedID&&(this.tokenize(),this.invalidateBounds(),this._dirtyMeasures=!0,this._renderedID=n),this},getLocalBoundingRect:function(){var e=this.measure(),t=this.x,n=this.y,i=this.attr("align")||"left",r=this.attr("baseline")||"top";return this.height?"middle"===r?n+=this.height/2-e.height/2:"bottom"===r&&(n+=this.height-e.height):"middle"===r?n-=e.height/2:"bottom"===r&&(n-=e.height),this.width?"center"===i?t+=this.width/2-e.width/2:"right"===i&&(t+=this.width-e.width):"center"===i?t-=e.width/2:"right"===i&&(t-=e.width),{x:t,y:n,width:e.width,height:e.height}},containsPoint:function(e,t){var n=this.getLocalBoundingRect();return e>n.x&&e<n.x+n.width&&t>n.y&&t<n.y+n.height},getLocalPoints:function(){var e=this.getLocalBoundingRect();return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}]},intersectsLocalRect:function(e){if(!e)return!1;var t=this.getLocalBoundingRect();return t.x<=e.x+e.width&&e.x<=t.x+t.width&&t.y<=e.y+e.height&&e.y<=t.y+t.height},intersectsLocalLine:function(e){if(this.containsPoint(e.x1,e.y1)||this.containsPoint(e.x2,e.y2))return!0;var t=this.getLocalBoundingRect();return e.intersectsLine(new n(t.x,t.y,t.x+t.width,t.y))||e.intersectsLine(new n(t.x+t.width,t.y,t.x+t.width,t.y+t.height))||e.intersectsLine(new n(t.x+t.width,t.y+t.height,t.x,t.y+t.height))||e.intersectsLine(new n(t.x,t.y+t.height,t.x,t.y))}})}),define("objects.views/charts/renderers/canvas/text",["objects.views/charts/shapes/text","client.utils/rtl/rtl-util"],function(e,t){"use strict";var n=!t.supportDirAuto();return{displayObject:e,render:function(e,i,r){var o,s,a,l=this.x||0,c=this.y||0,u=this.lines||[],h=u.length,d=[],p=this.lineHeight,f=e.textAlign,m="center"===f&&n;if(l=this.getHorizontalAnchor(),c=this.getVerticalAnchorFirstLine(),i&&d.push("fillText"),r&&(this.strokeFirst?d.unshift("strokeText"):d.push("strokeText")),d.length){for(o=0;o<h;o++)s=t.detectTextDirection(u[o]),e.canvas.dir=s,m&&"rtl"===s?(e.textAlign="left",a=l-e.measureText(u[o]).width/2):(e.textAlign=f,a=l),e[d[0]](u[o],a,c),d[1]&&e[d[1]](u[o],a,c),c+=p;e.textAlign=f}}}}),define("objects.views/charts/renderers/canvas-renderer",["jquery","core.utils/deferred","objects.views/charts/renderers/renderer","objects.views/charts/utils/matrix","objects.utils/animation-frame","general.utils/shapes/rect","objects.views/charts/renderers/canvas/rect","objects.views/charts/renderers/canvas/circle","objects.views/charts/renderers/canvas/line","objects.views/charts/renderers/canvas/polygon","objects.views/charts/renderers/canvas/arc","objects.views/charts/renderers/canvas/text"],function(e,t,n,i,r,o){"use strict";function s(e,t){q.length>100&&delete x[q.shift()],q.push(e),x[e]=t}function a(){var e={dfd:t(),state:b.PENDING};return e.dfd.promise.then(function(){e.state=b.RESOLVED},function(){e.state=b.REJECTED}),e}function l(e,t,n,i,r){return i+r*(e-t)/n}var c,u=1,h=[].slice.call(arguments,6),d={},p=h.length,f=document.createElement("canvas").getContext("2d"),m=["fill","stroke","strokeWidth","opacity","font","align","baseline","lineJoin","lineCap"],g=new RegExp(m.join("|")),v=m.length,y={fill:"fillStyle",stroke:"strokeStyle",strokeWidth:"lineWidth",opacity:"globalAlpha",align:"textAlign",baseline:"textBaseline"},b={PENDING:0,RESOLVED:1,REJECTED:2},x={},q=[],C=0;return c=n.extend("CanvasRenderer",{init:function(t,n){this._super(),this._id=++C,this._canvas=document.createElement("canvas"),this._canvas.width=this._size.width,this._canvas.height=this._size.height,this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0",this._bufferCanvas=document.createElement("canvas"),this._bufferCanvas.width=this._canvas.width,this._bufferCanvas.height=this._canvas.height,this._mvMatrix=new i,this._wrapper=document.createElement("div"),this._wrapper.style.position="relative",this._wrapper.style.left="0",this._wrapper.style.top="0",this._wrapper.appendChild(this._canvas),n&&n.name&&e(this._wrapper).attr({tid:n.name}),e(this._wrapper).attr({tcl:"renderer"}).data("_renderer",this),this.container=t,this.container.appendChild(this._wrapper),this._isCompositingEnabled=!0,this._invalidObjects=[],this._transformMatrix=new i,this._storeNewImage=!0},setDimensions:function(e,t,n,i){this._super(e,t,n,i),this._wrapper.style.left=e+"px",this._wrapper.style.top=t+"px"},setCompositingEnabled:function(e){this._isCompositingEnabled=e},getCompositingEnabled:function(){return this._isCompositingEnabled},render:function(e){if(!this._rendering)return this._resetImage(),this._renderDfdObj&&this._renderDfdObj.state===b.PENDING||(this._renderDfdObj=a()),e?this._invalidate(!0,!1):(this._doClear=!1,this._doRender=!0,this._validate()),this._renderDfdObj.dfd.promise},clear:function(e){this._rendering||(e?this._invalidate(!1,!0):(this._doRender=!1,this._doClear=!0,this._validate()))},release:function(){this._super(),this._clearSchedule(),e(this._wrapper).removeData(),this._bufferCanvas=null,this._canvas=null,this.container&&(this.container.removeChild(this._wrapper),this.container=null)},invalidateObject:function(e){this._isCompositingEnabled&&this._invalidObjects.indexOf(e)<0&&this._invalidObjects.push(e),this.render(!0)},transformScene:function(e){return this._transformMatrix=e.clone(),this._invalidate(!0,!1),this},translateScene:function(e,t){return this._transformMatrix.translate(e,t),this._invalidate(!0,!1),this},scaleScene:function(e,t,n){return this._transformMatrix.translate(-e,-t),this._transformMatrix.scale(n,n),this._transformMatrix.translate(e,t),this._invalidate(!0,!1),this},setAttribute:function(e,t){var n;for(n in t)t.hasOwnProperty(n)&&(this._wrapper[e][n]=t[n])},getTextWidth:function(e,t){return c.getTextWidth(e,t,this._canvas.getContext("2d"))},getFontHeight:function(e){return c.getFontHeight(e,this._canvas.getContext("2d"))},_render:function(){if(this._canvas){this._rendering=!0;var e=this._canvas,t=e.getContext("2d"),n=this._mvMatrix,i=[],r=this._isCompositingEnabled&&!this._transformMatrix.isIdentity(),s=c.getDevicePixelToBackingStoreRatio();if(r&&this._storeNewImage&&(this._storeImage(),this._storeNewImage=!1),this._updateSize()||(this._isCompositingEnabled&&((i=this._getInvalidViews().filter(function(e){return!e.hasNaN()})).length&&r?i=[]:r&&(t.clearRect(0,0,e.width,e.height),i=i.concat(this._getInvalidImageParts()).filter(function(e){return!e.hasNaN()}))),i.length||t.clearRect(0,0,e.width,e.height)),t.save(),n.save(),this.stage.matrix&&this.stage.matrix.identity(),this.stage.scale(this.scaling.x,this.scaling.y),this.stage.translate(-this._extendedSize.x,-this._extendedSize.y),this.stage.translate(this._transformMatrix.elements[0][2],this._transformMatrix.elements[1][2]),t.setTransform(s,0,0,s,0,0),i.length&&(r&&(t.save(),t.setTransform(1,0,0,1,0,0),this._patchImage(),this._transformMatrix.identity(),t.restore()),t.beginPath(),i.forEach(function(e){t.rect(e.x,e.y,e.width,e.height)}),t.clip(),t.clearRect(0,0,this._extendedSize.width,this._extendedSize.height)),!i.length){var a=new o(0,0,this.scaling.x*this._extendedSize.width,this.scaling.y*this._extendedSize.height);i.push(a)}c._updateTransforms([this.stage],n,{}),c._renderDisplayObjects(t,[this.stage],!!this._isCompositingEnabled&&i,s),n.restore(),t.restore(),this._invalidObjects=[],this._rendering=!1}},_updateSize:function(){var e,t,n,i=this._canvas,r=c.getDevicePixelToBackingStoreRatio(),s=this._extendedSize;return this.edgeBleed?s.set(-this.edgeBleed.left,-this.edgeBleed.top,this._size.width+this.edgeBleed.left+this.edgeBleed.right,this._size.height+this.edgeBleed.top+this.edgeBleed.bottom):s.set(this._size.x,this._size.y,this._size.width,this._size.height),n=new o(Math.round(s.x*this.scaling.x),Math.round(s.y*this.scaling.y),Math.round(s.width*this.scaling.x),Math.round(s.height*this.scaling.y)),e=Math.round(r*n.width),t=Math.round(r*n.height),this._canvas.style.left=n.x+"px",this._canvas.style.top=n.y+"px",(i.width!==e||i.height!==t)&&(i.width=e,i.height=t,i.style.width=n.width+"px",i.style.height=n.height+"px",this._bufferCanvas.width=e,this._bufferCanvas.height=t,!0)},_invalidate:function(e,t){if(this._doRender=e||this._doRender,this._doClear=t||this._doClear,!this._invalidated){var n=this;this._invalidated=!0,this._timer=r.request(function(){n._validate()},this._canvas)}},_validate:function(){this._doClear&&!this._doRender?this._clear():this._doRender&&this._render(),this._renderDfdObj&&this._renderDfdObj.state===b.PENDING&&this._renderDfdObj.dfd.resolve(),this._clearSchedule()},_clear:function(){this._canvas&&(this._canvas.width=this._canvas.width)},_clearSchedule:function(){this._timer&&(r.cancel(this._timer),this._timer=null),this._renderDfdObj&&this._renderDfdObj.state===b.PENDING&&this._renderDfdObj.dfd.reject(),this._doRender=!1,this._doClear=!1,this._invalidated=!1},_getInvalidViews:function(){var e,t,n,i,r,s,a,l,c,u,h,d=this._invalidObjects?this._invalidObjects.length:0,p=new o,f=!1,m=!1,g=new o;for(e=0;e<d;e++)t=this._invalidObjects[e].getVisualBounds(),n=this._invalidObjects[e].rData.oldVisualBounds,!f&&t?(i=t.x,s=t.x+t.width,r=t.y,a=t.y+t.height,f=!0):t&&(i=Math.min(i,t.x),s=Math.max(s,t.x+t.width),r=Math.min(r,t.y),a=Math.max(a,t.y+t.height)),!m&&n?(l=n.x,u=n.x+n.width,c=n.y,h=n.y+n.height,m=!0):n&&(l=Math.min(l,n.x),u=Math.max(u,n.x+n.width),c=Math.min(c,n.y),h=Math.max(h,n.y+n.height));return p.set(Math.floor(i)-1,Math.floor(r)-1,Math.ceil(s-i)+2,Math.ceil(a-r)+2),g.set(Math.floor(l)-1,Math.floor(c)-1,Math.ceil(u-l)+2,Math.ceil(h-c)+2),p.x!==g.x||p.y!==g.y||p.width!==g.width||p.height!==g.height?[p,g]:[p]},_getInvalidImageParts:function(){var e=[],t=this._transformMatrix.elements[0][0],n=this._transformMatrix.elements[0][2],i=this._transformMatrix.elements[1][2];return t&&t>1?e.push(new o(0,0,0,0)):t&&t<1?e.push(new o(0,0,0,0)):(0!==n&&this._size.width>Math.abs(n)&&e.push(new o(n>0?0:this._size.width+n,0,Math.abs(n),this._size.height)),0!==i&&this._size.height>Math.abs(i)&&e.push(new o(0,i>0?0:this._size.height+i,this._size.width,Math.abs(i)))),e},_storeImage:function(){var e=this._bufferCanvas.getContext("2d");e.clearRect(0,0,this._bufferCanvas.width,this._bufferCanvas.height),e.drawImage(this._canvas,0,0)},_patchImage:function(){var e=c.getDevicePixelToBackingStoreRatio(),t=this._transformMatrix.elements[0][0];if(1!==t){var n,i,r,o,s,a,u,h,d={x:0,y:this._size.height},p={x:this._size.width,y:0},f=this._transformMatrix.transformPoint(d),m=this._transformMatrix.transformPoint(p),g=m.x-f.x,v=m.y-f.y,y=f.x/g,b=m.y/v;if(t>1?(u=0,h=0,n=this._size.width,i=this._size.height,r=-y*this._size.width,o=b*this._size.height,s=this._size.width/t,a=this._size.height/t):(r=0,o=0,s=this._size.width,a=this._size.height,u=y*(n=this._size.width*t),h=-b*(i=this._size.height*t)),s*=e,a*=e,r*=e,o*=e,u*=e,h*=e,n*=e,i*=e,r>this._bufferCanvas.width||r+s<0||o>this._bufferCanvas.height||o+a<0)this._canvas.getContext("2d").drawImage(this._bufferCanvas,0,0,0,0,0,0,0,0);else{var x,q,C,S,w,_,D,M,A,E;x=Math.max(r,0),q=Math.min(r+s,this._bufferCanvas.width),C=l(x,r,s,u,n),D=q-x,A=l(q,r,s,u,n)-C,S=Math.max(o,0),w=Math.min(o+a,this._bufferCanvas.height),_=l(S,o,a,h,i),M=w-S,E=l(w,o,a,h,i)-_,this._canvas.getContext("2d").drawImage(this._bufferCanvas,x,S,D,M,C,_,A,E)}}else this._canvas.getContext("2d").drawImage(this._bufferCanvas,this._transformMatrix.elements[0][2]*e,this._transformMatrix.elements[1][2]*e)},_resetImage:function(){this._transformMatrix.identity(),this._storeNewImage=!0}}),c.getFontHeightOfContext=function(e){return 1.5*e.measureText("m").width},c.getFontHeight=function(e,t){if("string"!=typeof e)throw new Error("CanvasRenderer.getFontHeight(): Input font is not a string");if(e in x)return x[e];var n;return(t=t||f).font!==e?(t.save(),t.font=e,n=1.5*t.measureText("m").width,t.restore()):n=1.5*t.measureText("m").width,s(e,n),n},c.getTextWidth=function(e,t,n){var i;return(n=n||f).save(),n.font=t,i=void 0!==e?Math.ceil(n.measureText(e).width):0,n.restore(),i},c.getDevicePixelToBackingStoreRatio=function(){return(window.devicePixelRatio||1)/(f.webkitBackingStorePixelRatio||f.mozBackingStorePixelRatio||f.msBackingStorePixelRatio||f.oBackingStorePixelRatio||f.backingStorePixelRatio||1)},c.measureText=function(e,t,n){var i,r;return n=n||f,t&&n.font!==t&&(n.save(),n.font=t),r=n.measureText(e).width,t in x?i=x[t]:s(t,i=1.5*n.measureText("m").width),t&&n.restore(),void 0!==e?{width:r,height:i}:{width:0,height:0}},c._renderDisplayObjects=function(e,t,n,i){var r,o,s,a,l,u,h=n?n.length:0,d=[],p=!0,f=[];for(o=t?t.length:0,r=0;r<o;r++)if(!1!==(s=t[r]).visible&&!1!==s.data.isVisible){if(h){for(p=!1,l=0;l<h;l++)if(n[l].intersectsWith(s.getVisualBounds())){p=!0;break}if(!p)continue}a=c._getRenderFn(t[r]),u=s.children.length>0,("function"==typeof a||u)&&(s.zIndex>0?(d[s.zIndex]||(d[s.zIndex]={index:s.zIndex,objects:[]}),d[s.zIndex].objects.push({object:s,renderFn:a,hasChildren:u})):c._renderObject(e,s,a,u,n,i))}for(d=d.filter(function(e){return e&&e.objects.length}).sort(function(e,t){return e.index-t.index}),r=0;r<d.length;r++)for(o=(f=d[r].objects).length,l=0;l<o;l++)c._renderObject(e,f[l].object,f[l].renderFn,f[l].hasChildren,n,i)},c._renderObject=function(e,t,n,i,r,o){var s,a,l,u,h;"function"==typeof n&&(void 0===(a=t.attr("strokeWidth"))&&(a=1),l=!!t.attr("fill"),u=!!t.attr("stroke")&&a>0),e.save(),t.rData.stroke=u,t.rData.strokeWidth=a,r&&(h=t.getVisualBounds(),t.rData.oldVisualBounds={x:h.x,y:h.y,width:h.width,height:h.height}),c._applyAttributes(e,t),t.rData.vmTransform&&(s=t.rData.vmTransform,e.setTransform(o*s[0][0],o*s[1][0],o*s[0][1],o*s[1][1],o*s[0][2],o*s[1][2])),t.clip&&(e.beginPath(),e.rect(t.clip.x,t.clip.y,t.clip.width,t.clip.height),e.clip()),(l||u)&&(t.preRender&&t.preRender(),n.apply(t,[e,l,u])),i&&c._renderDisplayObjects(e,t.children,r,o),e.restore()},c._registerRenderFn=function(e,t){var n;if("function"!=typeof e)throw new TypeError("First parameter must be a function");(n="function"!=typeof t&&"function"==typeof t.constructor?t.constructor:t).__renderFnId="_"+u++,d[n.__renderFnId]=e},c._getRenderFn=function(e){var t=e.__renderFnId||(e.constructor?e.constructor.__renderFnId:void 0);if(t)return d[t];for(var n=0;n<p;n++)if(h[n].displayObject===e.constructor)return c._registerRenderFn(h[n].render,e),h[n].render;for(n=0;n<p;n++)if(e instanceof h[n].displayObject)return c._registerRenderFn(h[n].render,e),h[n].render;e.constructor.__renderFnId="does not exist"},c._updateTransforms=function(e,t,n){var i,r,o,s,a,l={},u=e?e.length:0;for(a in n)g.test(a)&&(l[a]=n[a]);for(i=0;i<u;i++){(r=e[i]).clearModelView(),r.matrix&&(t.save(),t.multiply(r.matrix),r.rData.vmTransform=t.elements,r.rData.dirtyVMTransform=!0),r.rData.inherited={};for(a in l)r.rData.inherited[a]=l[a];if((s=r.children)&&s.length){for(o=0;o<v;o++)r.hasOwnProperty(m[o])&&(l[a]=r[a]);c._updateTransforms(s,t,l)}r.matrix&&t.restore()}},c.Gradient={LINEAR:0,RADIAL:1},c._applyAttributes=function(e,t){var n,i;for(i=0;i<v;i++)(n=m[i])in t&&void 0!==t[n]&&(("fill"===n||"stroke"===n)&&t[n]&&t[n].gradient?t[n].gradient.r?e[y[n]]=c._createGradient(e,t[n].gradient,c.Gradient.RADIAL)||"#000000":e[y[n]]=c._createLinearGradient(e,t[n].gradient)||"#000000":e[y[n]||n]=t[n])},c._createLinearGradient=function(e,t){return c._createGradient(e,t,c.Gradient.LINEAR)},c._createGradient=function(e,t,n){var i,r,o;if(!(isNaN(t.x0)||isNaN(t.y0)||isNaN(t.x1)||isNaN(t.y1))){for(i=n===c.Gradient.RADIAL?e.createRadialGradient(t.x0,t.y0,0,t.x1,t.y1,t.r):e.createLinearGradient(t.x0,t.y0,t.x1,t.y1),o=t.limits.length,r=0;r<o;r++)i.addColorStop(t.limits[r],t.colors[r]);return i}},c.registerRenderObject=function(e){h.push(e),p=h.length},c}),define("extensions.qliktech/barchart/layers/bar-helpers",["objects.views/charts/shapes/rect"],function(e){"use strict";function t(e,t,n,i){var r=[{x:e.x,y:e.y},{x:e.x,y:e.y+e.height},{x:e.x+e.width,y:e.y+e.height},{x:e.x+e.width,y:e.y}];switch(t){case"left":i?r[0].x-=n:r[1].x+=n;break;case"right":i?r[2].x+=n:r[3].x-=n;break;case"top":i?r[3].y-=n:r[0].y+=n;break;case"bottom":i?r[1].y+=n:r[2].y-=n}return r}function n(n,i,r){var o,s=r.pad,a=r.gap,l=r.sharpness,c=n.clone(),u=t,h=[];return"right"===i?(o=new e(c.x+c.width+a,c.y,s-a,c.height),h.push(u(c,"right",l,!0)),h.push(u(o,"left",l,!1,!0)),n.width+=o.width+a):"left"===i?(o=new e(0,c.y,s-a,c.height),h.push(u(c,"left",l,!0)),h.push(u(o,"right",l,!1,!0)),n.x=o.x,n.width+=o.width+a):"down"===i?(o=new e(c.x,c.y+c.height+a,c.width,s-a),h.push(u(c,"bottom",l,!0)),h.push(u(o,"top",l,!1,!0)),n.height+=o.height+a):"up"===i&&(o=new e(c.x,0,c.width,s-a),h.push(u(c,"top",l,!0)),h.push(u(o,"bottom",l,!1,!0)),n.y=o.y,n.height+=o.height+a),h}function i(e,t,n,i,r){var o=[];return"left"===r?(o.push({x:e,y:t+n/2}),o.push({x:e,y:t-n/2}),o.push({x:e-i,y:t})):"right"===r?(o.push({x:e,y:t+n/2}),o.push({x:e,y:t-n/2}),o.push({x:e+i,y:t})):"up"===r?(o.push({x:e-n/2,y:t}),o.push({x:e+n/2,y:t}),o.push({x:e,y:t-i})):"down"===r&&(o.push({x:e-n/2,y:t}),o.push({x:e+n/2,y:t}),o.push({x:e,y:t+i})),o}function r(e,t,n){var r,o,s;return s=Math.min(e[["left","right"].contains(t)?"height":"width"]/2,8),o=Math.min(s,8),"left"===t?(r=i(n.x+o,e.y+e.height/2,s,o,t),e.width+=o):"right"===t?(r=i(n.x+n.width-o-1,e.y+e.height/2,s,o,t),e.width+=o,e.x-=o):"up"===t?(r=i(e.x+e.width/2,n.y+o,s,o,t),e.height+=o):"down"===t&&(r=i(e.x+e.width/2,n.y+n.height-o-1,s,o,t),e.height+=o,e.y-=o),r}return{updateRectangle:function(e,t,n,i,r,o,s){var a,l;return o?(a=t,l=n,n=r,t=i,r=a,i=l,n<t&&(a=n,n=t,t=a),t=Math.max(s.x,Math.min(s.x+s.width,t)),n=Math.max(s.x,Math.min(s.x+s.width,n))):(i<r&&(a=r,r=i,i=a),i=Math.max(s.y,Math.min(s.y+s.height,i)),r=Math.max(s.y,Math.min(s.y+s.height,r))),e.set(t,r,n-t,i-r),e},getSpike:n,getSlicedPolygon:t,getHint:r,updateSpike:function(e,t,i){e.set(n(e.data.hitRect,t,i))},updateHint:function(e,t,n){e.set(r(e.data.hitRect,t,n))}}}),define("extensions.qliktech/barchart/layers/bar-layer",["core.utils/class","general.utils/shapes/rect","objects.views/charts/shapes/polygon","objects.views/charts/renderers/canvas-renderer","client.utils/property-resolver","extensions.qliktech/barchart/layers/bar-helpers"],function(e,t,n,i,r,o){"use strict";function s(){var e,i,r,s,a,l,c,u,h,d,p,f,m,g=this.style.shape,v=new t(0,0,0,0),y=this.widthRatio,b=this.isSpikingEnabled,x=this.isHintingEnabled,q=[],C=this.majorAxis.isDiscrete(),S=this.majorAxis.getDiscreteSpacing()*y,w=this.minorAxis.getPlotMax(),_=this.minorAxis.getPlotMin(),D=!this.majorAxis.isVertical(),M=this.minorAxis.getPadding(),A=this.minorAxis.getPositionOfValue(0)-1,E={pad:D?M.top:M.right},I={pad:D?M.bottom:M.left},T=new t;E.gap=.3*E.pad,E.sharpness=.3*E.pad,I.gap=.3*I.pad,I.sharpness=.3*I.pad,T.set(M.left,M.top,this.rect.width-M.left-M.right,this.rect.height-M.top-M.bottom),this._bounds=T;var L=D?this.rect.width:this.rect.height,k=D?this.rect.height:this.rect.width;if(u=this.shapes?this.shapes.length:0,this.isNumeric){C=!1;var O=this.majorAxis._scale.plotRange/(this.majorAxis._scale._dataMax-this.majorAxis._scale._dataMin),P=this.majorAxis._scale._plotSize/90;m=Math.max(P-Math.pow(O,.25)*P,2),isNaN(m)&&(m=2)}for(h=0;h<u;h++)if(l=this.shapes[h],f=l instanceof n||"Polygon"===l.type,c=this.isNumeric?this.majorAxis.getPositionOfValue(l.data.axisNum):this.majorAxis.getPositionOfId(l.data.axisId),a=C?S:m||this.majorAxis.getWidthOfId(l.data.axisId)*y,l.data.isNaN||isNaN(l.data.value)?(l.data.isNaN=!0,r=s=A):(r=this.minorAxis.getPositionOfValue(l.data.start)-1,s=this.minorAxis.getPositionOfValue(l.data.end)-1),e=c-a/2,i=c+a/2,o.updateRectangle(l.data.hitRect,e,i,r,s,!D,T),delete l.data.labelRect,delete l.data.isCutOff,delete l.data.hintDirection,i<0||e>L)l.data.isVisible=!1;else{l.data.isVisible=!0,f?l.set(l.data.hitRect.getPoints()):l.set(l.data.hitRect.x,l.data.hitRect.y,l.data.hitRect.width,l.data.hitRect.height),v.set(l.data.hitRect.x,l.data.hitRect.y,l.data.hitRect.width,l.data.hitRect.height),q.push(l);var N=(d=l.data.cacheItem).selected;if(l.data.isFakeOtherCell&&l.data.highlightOnGroupSelect&&d.children[0].selected){N=!0;for(var R=0;R<d.children.length;R++)if(!d.children[R].selected){N=!1;break}}this.isNumeric&&this.selectedRanges&&!N&&(N=this.selectedRanges.some(function(e){return l.data.axisNum>=e.min&&(e.maxIncluded?l.data.axisNum<=e.max:l.data.axisNum<e.max)})),p=N&&a>6?g.selected:{border:{color:0,width:0}},l.stroke=p.border.color,l.fill=l.data.isFakeOtherCell?this.othersFillPattern:l.data.fill,l.strokeWidth=p.border.width,l.opacity=N?1:this._globalAlpha;var F=!!x&&this._getHint(r,s,T,D);!(!f||F||!b)&&this._getSpike(l.data.end,r,s,T,D,_,w)?(l.data.labelRect=v.clone(),o.updateSpike(l,D?l.data.end>=0?"up":"down":l.data.end>=0?"right":"left",l.data.end>=0?E:I),l.data.isCutOff=!0):F?(l.fill=g.outOfRange.color,o.updateHint(l,F,T),l.data.hintDirection=F):(r<-1&&s<-1||r>k&&s>k)&&(l.data.isVisible=!1)}this.nodesInView=q}return e.extend("BarLayer",{init:function(e){this.renderer=new i(e,{name:"bar-layer"}),this.widthRatio=.7,this.isSpikingEnabled=!1,this.isHintingEnabled=!1,this.shapes=[],this._globalAlpha=1},release:function(){this.renderer.release(),this.shapes=null,this.minorAxis=null,this.majorAxis=null},update:function(){s.call(this)},render:function(){return this.renderer.render()},clear:function(){this.renderer.clear()},_getStyle:function(e){return{selected:{border:{color:r.getValue(e,"shape.selected.border.color","rgba(0,0,0,0.25)"),width:r.getValue(e,"shape.selected.border.width",1)}}}},_getHint:function(e,t,n,i){if(i){if(t+1<n.y&&e+1<=n.y)return"up";if(t+1>n.y+n.height&&e+1>=n.y+n.height)return"down"}else{if(t+1<n.x&&e+1<=n.x)return"left";if(t+1>n.x+n.width&&e+1>=n.x+n.width)return"right"}return!1},_getSpike:function(e,t,n,i,r,o,s){var a=e>s,l=e<o;return r?(a=a&&n<i.y&&t>i.y,l=l&&n>i.y+i.height&&t<i.y+i.height):(a=a&&n>i.x+i.width&&t<i.x+i.width,l=l&&n<i.x&&t>i.x),a||l}})}),define("objects.views/charts/utils/canvas-renderer",["core.utils/class","general.utils/shapes/rect","objects.utils/animation-frame","jquery","./matrix","core.utils/deferred","client.utils/rtl/rtl-util"],function(e,t,n,i,r,o,s){"use strict";function a(e,t){_.length>100&&delete w[_.shift()],_.push(e),w[e]=t}function l(e){if(e.font in w)return w[e.font];var t=1.5*e.measureText("m").width;return a(e.font,t),t}function c(e,t,n,i,r){var o,s,a=t.shape.points,l=a?a.length:0;if(e.beginPath(),o=a[0]){for(e.moveTo(o.x,o.y),s=1;s<l;s+=1)o=a[s],e.lineTo(o.x,o.y);r&&e.closePath(),n&&e.fill(),i&&e.stroke()}}function u(e,t,n){var i,r,o=e?e.replace(/^\s*|\s*$/,"").split(" "):[],s=[],a=o[0];if(!a)return[];for(i=1;i<o.length;i++)r=a+" "+o[i],x.measureText(r).width>t&&n>s.length?(s.push(a),a=o[i]):a=r;return s.length<n?s.push(a):s[Math.max(0,s.length-1)]?s[Math.max(0,s.length-1)]+=" "+a:s[Math.max(0,s.length-1)]=" "+a,s}function h(e,t,n){if(void 0!==e){var i,r,o,s,a,l,c,u,h=x.measureText("i").width;for(i=0;i<e.length;i++){if(r=e[i],(c=Math.ceil(Math.max(0,t/h))+1)<r.length?(s=r.slice(c),r=r.slice(0,c)):s="",o=r,r&&r.length>1&&x.measureText(r).width>t){for(a=!1,l=r.length;l>0;l--)if(o=o.substring(0,o.length-1),u=o+(i+1<n?"-":""),x.measureText(u).width<t){s=r.substring(l-1)+s,r=u,a=!0;break}a||(s=r.substring(1),r=r.substring(0,1)),a||l||(s="",r="")}e[i]=String(r).trim(),s&&i<e.length-1?e[i+1]=s+" "+e[i+1]:s&&e.length<n&&e.push(s)}}}function d(e,t,n){var i,r=n.maxWidth;return isNaN(r)?[e]:(i=t>1?u(e,r,t):[e],h(i,r,t),i)}function p(e,t,n){var i,r,o,a,c=t.text,u=(t.lineHeight||1)*l(e),h="maxWidth"in t?t.maxWidth:t.width,p="maxHeight"in t?t.maxHeight:t.height,f=t.width,m=t.height,g=t.maxNumLines,v=t.x||0,y=t.y||0,b=e.textAlign,q="center"===b&&D;if(x.font=e.font,isNaN(g)&&(g=p?Math.max(1,Math.floor(p/u)):1),i=d(c,g,{maxWidth:h,maxHeight:p}),n){for(f=0,r=0;r<i.length;r++)f=Math.max(f,e.measureText(i[r]).width);return{lines:i,numLines:i.length,width:f,height:i.length*u,truncated:Array.isArray(/$/.exec(i[i.length-1]))}}for("middle"===e.textBaseline?void 0!==m?y+=m/2:i.length&&(y-=(i.length-1)*u/2):"bottom"===e.textBaseline&&(void 0!==m?y+=m:y-=(i.length-1)*u),"center"===e.textAlign&&f?v+=f/2:"right"===e.textAlign&&f&&(v+=f),r=0;r<i.length;r++)o=s.detectTextDirection(i[r]),e.canvas.dir=o,q&&"rtl"===o?(e.textAlign="left",a=v-e.measureText(i[r]).width/2):(e.textAlign=b,a=v),e.canvas.dir=s.detectTextDirection(i[r]),e.fillText(i[r],a,y),y+=u;e.textAlign=b}function f(e,t,n,i,r,o){var s,a,l,c,u,h,d;for(s=0;s<n.length;s+=1)if(c=n[s]){if(e.save(),(l=c.transform)&&(t.save(),t.multiply(l)),"opacity"in c&&(e.globalAlpha=c.opacity),c.fill)if(c.fill.gradient){if(d=c.fill.gradient,isNaN(d.x0)||isNaN(d.y0)||isNaN(d.x1)||isNaN(d.y1))return;for(h=e.createLinearGradient(d.x0,d.y0,d.x1,d.y1),a=0;a<d.limits.length;a++)h.addColorStop(d.limits[a],d.colors[a]);e.fillStyle=h}else e.fillStyle=c.fill;if(c.stroke&&0!==c.strokeWidth){if(c.stroke.gradient){for(d=c.stroke.gradient,h=e.createLinearGradient(d.x0,d.y0,d.x1,d.y1),a=0;a<d.limits.length;a++)h.addColorStop(d.limits[a],d.colors[a]);e.strokeStyle=h}else e.strokeStyle=c.stroke;e.lineWidth=c.strokeWidth||1,i>1&&"polygon"!==c.type&&(e.lineWidth/=i)}c.lineJoin&&(e.lineJoin=c.lineJoin),c.lineCap&&(e.lineCap=c.lineCap),u=t.elements,"group"===c.type?(t.save(),c.clip&&(e.beginPath(),e.setTransform(u[0][0],u[1][0],u[0][1],u[1][1],u[0][2],u[1][2]),e.rect(c.clip.rect.x,c.clip.rect.y,c.clip.rect.width,c.clip.rect.height),e.clip()),f(e,t,c.children,void 0,!!c.fill||!!r,!!c.stroke&&0!==c.strokeWidth||!!o),t.restore()):c.type in y&&(e.setTransform(u[0][0],u[1][0],u[0][1],u[1][1],u[0][2],u[1][2]),y[c.type](e,c,!!c.fill||!!r,!!c.stroke&&0!==c.strokeWidth||!!o)),e.globalAlpha=1,l&&t.restore(),e.restore()}}function m(e,t,n){if(n){var i=t.elements;switch(n.type){case"clip":e.save(),e.setTransform(i[0][0],i[1][0],i[0][1],i[1][1],i[0][2],i[1][2]),e.beginPath(),e.rect(n.rect.x,n.rect.y,n.rect.width,n.rect.height),e.clip()}}}function g(e,t){t&&e.restore()}var v,y,b=window.devicePixelRatio||1,x=document.createElement("canvas").getContext("2d"),q=document.createElement("span"),C=x.webkitBackingStorePixelRatio||x.mozBackingStorePixelRatio||x.msBackingStorePixelRatio||x.oBackingStorePixelRatio||x.backingStorePixelRatio||1,S=b/C,w={},_=[],D=!s.supportDirAuto();q.innerText="Wj",y={rect:function(e,t,n,i){n&&e.fillRect(t.shape.x||0,t.shape.y||0,t.shape.width||0,t.shape.height||0),i&&e.strokeRect(t.shape.x||0,t.shape.y||0,t.shape.width||0,t.shape.height||0)},roundRect:function(e,t,n,i){e.beginPath(),e.moveTo(t.shape.x+t.shape.radius,t.shape.y),e.lineTo(t.shape.x+t.shape.width-t.shape.radius,t.shape.y),e.quadraticCurveTo(t.shape.x+t.shape.width,t.shape.y,t.shape.x+t.shape.width,t.shape.y+t.shape.radius),e.lineTo(t.shape.x+t.shape.width,t.shape.y+t.shape.height-t.shape.radius),e.quadraticCurveTo(t.shape.x+t.shape.width,t.shape.y+t.shape.height,t.shape.x+t.shape.width-t.shape.radius,t.shape.y+t.shape.height),e.lineTo(t.shape.x+t.shape.radius,t.shape.y+t.shape.height),e.quadraticCurveTo(t.shape.x,t.shape.y+t.shape.height,t.shape.x,t.shape.y+t.shape.height-t.shape.radius),e.lineTo(t.shape.x,t.shape.y+t.shape.radius),e.quadraticCurveTo(t.shape.x,t.shape.y,t.shape.x+t.shape.radius,t.shape.y),e.closePath(),n&&e.fill(),i&&e.stroke()},circle:function(e,t,n,i){if(t.shape&&t.shape.r&&!t.shape.radius&&(t.shape.radius=t.shape.r),!(isNaN(t.shape.cx)||isNaN(t.shape.cy)||isNaN(t.shape.radius)||t.shape.radius<=0)){var r=.551784;e.save(),e.translate(t.shape.cx,t.shape.cy),e.scale(t.shape.radius,t.shape.radius),e.beginPath(),e.moveTo(1,0),e.bezierCurveTo(1,-r,r,-1,0,-1),e.bezierCurveTo(-r,-1,-1,-r,-1,0),e.bezierCurveTo(-1,r,-r,1,0,1),e.bezierCurveTo(r,1,1,r,1,0),e.closePath(),e.restore(),n&&e.fill(),i&&e.stroke()}},line:function(e,t,n,i){i&&(e.beginPath(),e.moveTo(t.shape.x1,t.shape.y1),e.lineTo(t.shape.x2,t.shape.y2),e.stroke())},polygon:function(e,t,n,i){c(e,t,n,i,!0)},polyline:function(e,t,n,i){c(e,t,n,i)},polygons:function(e,t,n,i){var r,o,s,a,l,c,u=t.shape.polygons,h=u?u.length:0;for(e.beginPath(),l=0;l<h;l++)if(r=u[l],o=r.points,0!==(s=o?o.length:0)&&(a=o[0]))for(e.moveTo(a.x,a.y),c=1;c<s;c+=1)a=o[c],e.lineTo(a.x,a.y);n&&e.fill(),i&&e.stroke()},multipolygon:function(e,t,n,i){var r,o,s,a,l,c,u,h,d=t.shape.geopolygons,p=d?d.length:0;for(e.beginPath(),c=0;c<p;c++)for(o=(r=d[c].getPolygons())?r.length:0,u=0;u<o;u++)if(s=r[u].points,0!==(a=s?s.length:0)&&(l=s[0]))for(e.moveTo(l.x,l.y),h=1;h<a;h+=1)l=s[h],e.lineTo(l.x,l.y);n&&e.fill(),i&&e.stroke()},arc:function(e,t,n,i){var r=t.shape;e.beginPath(),r.end-r.start==2*Math.PI?(e.arc(r.cx,r.cy,r.radius,r.start+r.radianOffset,r.end+r.radianOffset,!1),e.moveTo(r.cx+r.innerRadius*Math.cos(r.radianOffset+r.start),r.cy+r.innerRadius*Math.sin(r.radianOffset+r.start)),e.arc(r.cx,r.cy,r.innerRadius,r.end+r.radianOffset,r.start+r.radianOffset,!0)):(e.arc(r.cx,r.cy,r.radius,r.start+r.radianOffset,r.end+r.radianOffset,!1),isNaN(r.innerRadius)||r.innerRadius===r.radius||(e.lineTo(r.innerRadius*Math.cos(r.end+r.radianOffset)+r.cx,r.innerRadius*Math.sin(r.end+r.radianOffset)+r.cy),r.innerRadius>0&&e.arc(r.cx,r.cy,r.innerRadius,r.end+r.radianOffset,r.start+r.radianOffset,!0),e.lineTo(r.radius*Math.cos(r.start+r.radianOffset)+r.cx,r.radius*Math.sin(r.start+r.radianOffset)+r.cy))),e.closePath(),n&&e.fill(),i&&e.stroke()},text:function(e,t){t.shape&&t.shape.text&&t.fill&&(t.shape.font&&(e.font=t.shape.font),t.shape.align&&(e.textAlign=t.shape.align),t.shape.baseline&&(e.textBaseline=t.shape.baseline),p(e,t.shape))}},v=e.extend({init:function(e,n){var o=i.extend(!0,{storeObjects:!1},n);this._container=e,this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._canvas.width=0,this._canvas.height=0,o.name&&this._canvas.setAttribute("name",o.name),this.storeRenderedObjects=!0===o.storeObjects,this.scaling={x:1,y:1},this._container&&this._container.appendChild(this._canvas),this.rect=new t(0,0,0,0),this.shapes=[],this._matrix=new r},setDimensions:function(e,t,n,i){this.rect.set(e,t,n,i)},setDimensionsToContainerRatio:function(e,t){this.scaling={x:e,y:t},this.ratios={x:e,y:t}},show:function(){this._canvas.style.display=""},hide:function(){this._canvas.style.display="none"},clear:function(e){if(e){if(!this._clearTimer){var t=this;this._clearTimer=n.request(function(){t._clearTimer&&(t._canvas.width=0,t._clearTimer=0)})}}else n.cancel(this._clearTimer),this._clearTimer=0,this._canvas.width=0,this._canvas.height=0,i(this._canvas).data("shapes",null),this.shapes=[]},render:function(){n.cancel(this._clearTimer),this._clearTimer=0,b=window.devicePixelRatio||1,C=x.webkitBackingStorePixelRatio||x.mozBackingStorePixelRatio||x.msBackingStorePixelRatio||x.oBackingStorePixelRatio||x.backingStorePixelRatio||1,S=b/C;var e,t,r=this._canvas,s=r.getContext("2d"),a=S,l=this._matrix,c=0,u=0;return t=this.rect.height*this.scaling.y,e=this.rect.width*this.scaling.x,this.edgeBleed&&(c=this.edgeBleed.left*this.scaling.x,u=this.edgeBleed.top*this.scaling.y,t+=this.edgeBleed.top*this.scaling.y+this.edgeBleed.bottom*this.scaling.y,e+=this.edgeBleed.left*this.scaling.x+this.edgeBleed.right*this.scaling.x),t=Math.round(t),e=Math.round(e),this._canvas.style.left=-c+"px",this._canvas.style.top=-u+"px",r.width!==e||r.height!==t?(r.width=a*e,r.height=a*t,this._canvas.style.width=e+"px",this._canvas.style.height=t+"px"):s.clearRect(0,0,r.width,r.height),s.save(),l.save(),l.scale(a*this.scaling.x,a*this.scaling.y),l.translate(c/this.scaling.x,u/this.scaling.y),m(s,l,this.viewBox),f(s,l,this.shapes,this.scaling.x),g(s,this.viewBox),s.restore(),l.restore(),this.storeRenderedObjects&&i(this._canvas).data("shapes",this.shapes),o.resolve()},setFont:function(e){this._canvas.getContext("2d").font=e},getFontHeight:function(e){if("string"!=typeof e)throw new Error("CanvasRenderer.getFontHeight(): Input font is not a string");if(e in w)return w[e];var t,n=this._canvas.getContext("2d");return n.font!==e?(n.save(),n.font=e,t=1.5*n.measureText("m").width,n.restore()):t=1.5*n.measureText("m").width,a(e,t),t},getTextWidth:function(e,t){var n,i=this._canvas.getContext("2d");return i.save(),i.font=t,n=void 0!==e?Math.ceil(i.measureText(e).width):0,i.restore(),n},getEMFontWidth:function(e){var t,n=this._canvas.getContext("2d");return n.save(),n.font=e,t=n.measureText("m").width,n.restore(),t},getAverageLetterWidth:function(e){var t="eeeaaaiinnoorsstldumcph";return x.font=e||this._canvas.getContext("2d").font,x.measureText(t).width/t.length},release:function(){i(this._canvas).data("shapes",null),this.shapes=[],this._container&&(this._container.removeChild(this._canvas),this._container=null)},applyTransform:function(){var e;for(e=0;e<this.shapes.length;e+=1)this.shapes[e].type in M&&M[this.shapes[e].type](this.shapes[e].shape,this.ratios)}});var M={rect:function(e,t){e.x*=t.x,e.y*=t.y,e.width*=t.x,e.height*=t.y},line:function(e,t){e.x1*=t.x,e.y1*=t.y,e.x2*=t.x,e.y2*=t.y},circle:function(e,t){e.cx*=t.x,e.cy*=t.y,e.r*=Math.min(t.x,t.y)},polygon:function(e,t){var n,i;for(n=0;n<e.points.length;n++)(i=e.points[n]).x*=t.x,i.y*=t.y},text:function(e,t){e.x*=t.x,e.y*=t.y,e.width*=t.x,e.height*=t.y}};return v.getTextWidth=function(e){return Math.ceil(x.measureText(e).width)},v.setFont=function(e){x.font=e},v.getAverageLetterWidth=function(e){var t="eeeaaaiinnoorsstldumcph";return x.font=e,x.measureText(t).width/t.length},v.measureText=function(e,t){var n,i,r=x;return t&&r.font!==t&&(r.save(),r.font=t),i=r.measureText(e).width,t in w?n=w[t]:a(t,n=1.5*r.measureText("m").width),t&&r.restore(),void 0!==e?{width:i,height:n}:{width:0,height:0}},v.measureTextObject=function(e){return e.shape.font&&(x.font=e.shape.font),e.shape.align&&(x.textAlign=e.shape.align),e.shape.baseline&&(x.textBaseline=e.shape.baseline),p(x,e.shape,!0)},v.measureDisplayTextObject=function(e){return e.font&&(x.font=e.font),e.align&&(x.textAlign=e.align),e.baseline&&(x.textBaseline=e.baseline),p(x,e,!0)},v.getFontHeight=function(e){var t,n=x;return e in w?w[e]:(e&&(n.save(),n.font=e),t=1.5*n.measureText("m").width,a(e,t),e&&n.restore(),t)},v.getDevicePixelToBackingStoreRatio=function(){return(window.devicePixelRatio||1)/(x.webkitBackingStorePixelRatio||x.mozBackingStorePixelRatio||x.msBackingStorePixelRatio||x.oBackingStorePixelRatio||x.backingStorePixelRatio||1)},v}),define("extensions.qliktech/barchart/layers/label-layer",["core.utils/class","objects.views/charts/utils/canvas-renderer","objects.views/charts/utils/matrix","general.utils/color","objects.views/charts/utils/tree-iterator"],function(e,t,n,i){"use strict";function r(e,t){return e?i.useDarkLabel(t,M)?w.label.dark.color:w.label.light.color:w.label.color}function o(e,t,n,i,r,o,s){return{type:"text",fill:w.label.dark.color,opacity:i||1,data:{value:t,rect:n,labelRect:o,hintDirection:s,color:r},shape:{text:e,maxNumLines:1,align:"center",baseline:"middle"}}}function s(e){var t,n,i,r;if(t=e.descendants.filter(function(e){return!e.isBranch&&!1!==e.data.isVisible}),(n=t.map(function(e){return e.data.hitRect})).length)return i=n[0],n.length>1&&(i=i.combineWith(n.slice(-1)[0])),r=o(e.data.valueLabel,e.data.sum,i,t[t.length-1].opacity,t[t.length-1].data.color,null,null),r.data.isFillPattern=window.CanvasPattern&&t[t.length-1].fill instanceof window.CanvasPattern,r.data.lastRect=n[n.length-1],r}function a(e,t){var n,i;e.forEach(function(e){n=e.children,e.data.isStack?(i=s(e))&&(i.data.isStack=!0,i.targetShape=e,t.push(i)):n&&n.length?a(n,t):!1!==e.data.isVisible&&((i=o(e.data.valueLabel,e.data.value,e.data.hitRect,e.opacity,e.data.color,e.data.labelRect,e.data.hintDirection)).targetShape=e,t.push(i))})}function l(e,t){var n;e.forEach(function(e){(n=e.children)&&n.length?l(n,t):!1!==e.data.isVisible&&t.push(e)})}function c(e,t){Object.keys(t).forEach(function(n){e[n]=t[n]})}function u(e){return e.filter(function(e){return!!e.labelBounds})}function h(e,t,n){return e.filter(function(e){return e.labelBounds.x>=t&&e.labelBounds.x+e.labelBounds.width<=n})}function d(e,t){var n,i,r,o=t?t.length:0;for(i=e.labelBounds,n=0;n<o;n++)if(r=t[n].data.hitRect,e.targetShape===t[n]){if(i.y+i.height/2>r.y&&i.width>r.width+8)return!0}else if(r&&i.x<=r.x+r.width&&r.x<=i.x+i.width&&i.y<=r.y+r.height&&r.y<=i.y+i.height)return!0;return!1}function p(e,t){return e.filter(function(e){return!d(e,t)})}function f(e){return e.filter(function(e){return e.data.value<0})}function m(e){return e.filter(function(e){return e.data.value>=0})}function g(e,t){var n,i,r,o=t?t.length:0;for(i=e.labelBounds,n=0;n<o;n++)if(r=t[n].labelBounds,i.x<=r.x+r.width&&r.x<=i.x+i.width&&i.y<=r.y+r.height&&r.y<=i.y+i.height)return!0;return!1}function v(e){var t,n,i,r,o,s=e?e.length:0,a=[];for(t=0;t<s;t++)n=(o=e[t]).data.value,i=0===t?n:e[t-1].data.value,r=t===s-1?n:e[t+1].data.value,o.priority=n>i&&n>r?6:n<i&&n<r?5:n>i&&n===r||n===i&&n>r?4:n<i&&n===r||n===i&&n<r?3:n===i&&n===r?2:1;for(e.sort(function(e,t){return e.priority-t.priority}),t=0;t<s;t++)g(e[t],a)||(a[a.length]=e[t]);return a}function y(){var e,n,i,r,o=[],s=[],c=this.minorAxis.getPlotMin(),d=this.minorAxis.getPlotMax(),g=w.label.font,y=this.bounds;a(this._shapes,o),t.setFont(g),this.renderer.setFont(g),o=o.filter(function(e){return"NaN"===e.data.value||(!(!e.data.labelRect&&!e.data.showHintLabel)||(e.data.value>=0&&d>=e.data.value&&c<=e.data.value||(e.data.value<0&&c<=e.data.value&&d>=e.data.value||!!(e.data.rect.width&&e.data.rect.height&&y.intersectsWith(e.data.rect)))))});var q,S,D;for(D=this._shapes&&this._shapes.length?(S=this._shapes[0].descendants.filter(function(e){return!e.isBranch})[0])?S.data.hitRect.width:this.majorAxis._discreteSpacing:0,q=0,e=o?o.length:0,i=0;i<e;i++)(n=o[i]).shape&&(n.shape.font=g,n.data.labelWidth=t.getTextWidth(n.shape.text),q=Math.max(q,n.data.labelWidth));this._longestLabel=q,r=this._longestLabel<D;var A;for(A=this.minorAxis.isVertical()?r?b:x:C,i=0;i<e;i++)A.call(this,o[i],D);if(this.isNumeric){var E,I;l(this._shapes,s),o=u(o),o=h(o,this.bounds.x-4,this.bounds.x+this.bounds.width+4),E=f(o=p(o,s)),I=m(o),E=v(E),I=v(I),o=I.concat(E)}o.slice().forEach(function(e){e.fill&&e.backdrop&&(o.unshift({opacity:e.opacity||1,type:"roundRect",fill:_,shape:e.backdrop}),e.fill=M?w.label.light.color:w.label.dark.color)}),this.renderer.shapes=o,this.renderer.render()}function b(e,t){for(var n,i=this.renderer.getFontHeight(w.label.font),o=q.apply(this,[e,!1,t]),s=0;s<o.length;s++)if(c(e.shape,o[s].rect),i<o[s].rect.height){n=o[s];break}if(n){var a=n.rect.width-e.data.labelWidth;c(e.shape,n.rect),e.shape.baseline=n.baseline,e.shape.align=n.align,e.labelBounds={x:n.rect.x+Math.min(a/2,4),y:"top"===n.baseline?n.rect.y:n.rect.y+n.rect.height-16,width:Math.max(n.rect.width-Math.min(a,8)),height:16,containingRect:n.inline?e.shape:void 0},e.data.isStack&&n.inline&&(e.data.lastRect.height<20||e.data.isFillPattern)?e.backdrop={x:e.labelBounds.x,y:e.labelBounds.y,width:e.labelBounds.width,height:e.labelBounds.height,radius:4}:(e.fill=r(n.inline,e.data.color),e.backdrop=!1)}else e.fill=!1}function x(e,i){var o,s,a,l,u=q.apply(this,[e,!0,i]);l=this.bounds.x+this.bounds.width,o="labelWidth"in e.data?e.data.labelWidth:t.getTextWidth(e.shape.text);for(s=0;s<u.length;s++)if(u[s].rect.height>=o){a=u[s];break}if(a||(u.sort(function(e,t){return.8*t.rect.height-e.rect.height}),u[0].rect.height>=8&&(a=u[0])),a){var h=new n;h.translate(a.rect.x,a.rect.y+a.rect.height),h.rotate(-Math.PI/2),c(e.shape,{width:a.rect.height,height:a.rect.width,baseline:a.baseline,align:a.align,x:0,y:0}),e.transform=h.elements,e.labelBounds={x:a.rect.x+a.rect.width/2-8,y:"right"===a.align?a.rect.y-4:a.rect.y+a.rect.height-o-4,width:16,height:o+8},a.rect.x<0&&a.rect.x+a.rect.width>0&&(e.labelBounds.x=Math.max(e.labelBounds.x,this.bounds.x-4)),a.rect.x<l&&a.rect.x+a.rect.width>l&&(e.labelBounds.x=Math.min(e.labelBounds.x,l-e.labelBounds.width)),e.data.isStack&&a.inline&&(e.data.lastRect.height<o+4||e.data.isFillPattern)?e.backdrop={x:e.labelBounds.x,y:e.labelBounds.y,width:e.labelBounds.width,height:e.labelBounds.height,radius:4}:(e.fill=r(a.inline,e.data.color),e.backdrop=!1)}else e.fill=!1}function q(e,t,n){var i,r,o,s,a=t&&e.data.isStack?8:4,l=[];return i=e.data.rect.width,r=e.data.rect.height,o=e.data.rect.x,s=e.data.rect.y,"up"!==e.data.hintDirection&&e.data.value>=0||"down"===e.data.hintDirection?(s-this.bounds.y-2*a>4&&l.push({align:t?"left":"center",baseline:t?"middle":"bottom",rect:{x:o-.5*(n-i),y:this.bounds.y+a,width:n,height:s-this.bounds.y-2*a}}),e.data.labelRect&&(i=e.data.labelRect.width,r=e.data.labelRect.height,o=e.data.labelRect.x,s=e.data.labelRect.y),e.data.hintDirection||l.push({align:t?"right":"center",baseline:t?"middle":"top",inline:!0,rect:{x:o,y:s+a,width:i,height:r-2*a}})):(this.bounds.height-s-r-2*a>0&&l.push({align:t?"right":"center",baseline:t?"middle":"top",rect:{x:o-.5*(n-i),y:s+r+a,width:n,height:this.bounds.height-s-r-2*a}}),e.data.labelRect&&(i=e.data.labelRect.width,r=e.data.labelRect.height,o=e.data.labelRect.x,s=e.data.labelRect.y),e.data.hintDirection||l.push({align:t?"left":"center",baseline:t?"middle":"bottom",inline:!0,rect:{x:o,y:s+a,width:i,height:r-2*a}})),l}function C(e,n){var i,o,s,a;s=S.apply(this,[e,n]),i="labelWidth"in e.data?e.data.labelWidth:t.getTextWidth(e.shape.text);for(o=0;o<s.length;o++)if(s[o].rect.width>=i){a=s[o];break}!a&&s.length&&(s.sort(function(e,t){return.8*t.rect.width-e.rect.width}),s[0].rect.width>=8&&(a=s[0])),a?(e.shape.baseline="middle",e.shape.align=a.align,c(e.shape,a.rect),e.labelBounds={x:("right"===a.align?a.rect.x+a.rect.width-i:a.rect.x)-4,y:a.rect.y+a.rect.height/2-8,width:i+8,height:16},e.data.isStack&&a.inline&&(e.data.lastRect.width<i+8||e.data.isFillPattern)?e.backdrop={x:e.labelBounds.x,y:e.labelBounds.y,width:e.labelBounds.width,height:e.labelBounds.height,radius:4}:(e.fill=r(a.inline,e.data.color),e.backdrop=!1)):e.fill=!1}function S(e){var t,n,i,r,o=e.data.isStack?8:4,s=[];return t=e.data.rect.width,n=e.data.rect.height,i=e.data.rect.x,r=e.data.rect.y,"right"!==e.data.hintDirection&&(this.yMirrorMode?e.data.value<0:e.data.value>=0)||"left"===e.data.hintDirection?(this.bounds.width-i-t-2*o>0&&s.push({align:"left",rect:{x:i+t+o,y:r,width:this.bounds.width-i-t-2*o,height:n}}),e.data.labelRect&&(t=e.data.labelRect.width,n=e.data.labelRect.height,i=e.data.labelRect.x,r=e.data.labelRect.y),e.data.hintDirection||s.push({align:"right",inline:!0,rect:{x:i+o,y:r,width:t-2*o,height:n}})):(i-this.bounds.x-2*o&&s.push({align:"right",rect:{x:this.bounds.x+o,y:r,width:i-this.bounds.x-2*o,height:n}}),e.data.labelRect&&(t=e.data.labelRect.width,n=e.data.labelRect.height,i=e.data.labelRect.x,r=e.data.labelRect.y),e.data.hintDirection||s.push({align:"left",inline:!0,rect:{x:i+o,y:r,width:t-2*o,height:n}})),s}var w,_,D,M;return e.extend("LabelLayer",{init:function(e){this.renderer=new t(e)},setYMirrorMode:function(e){this.yMirrorMode=e},setData:function(e){this._data=e},setMeasureIndices:function(){},setBarData:function(e){this._barData=e},setShapes:function(e){this._shapes=e},show:function(){this.renderer.show()},hide:function(){this.renderer.hide()},clear:function(){this.renderer.clear()},release:function(){this.renderer.release()},render:function(){w=this.style.dataPoints,D=new i(this.style.backgroundColor),M=D.isDark(),_=i.toRGBA(D,.75),y.call(this)}})}),define("objects.views/charts/chart-style-service",["core.utils/class","client.utils/theme/theme","general.utils/responsive-state"],function(e,t,n){"use strict";function i(e,t){if("string"==typeof e&&"@"===e[0]){var n=e.substring(1);return t[n]?i(t[n],t):e}return e}function r(e,t,n,i,r){var s,a=t.split("."),l=e,c=r;for(void 0!==l[n]&&(c=l[n]),s=0;s<a.length;++s){if(void 0===l[a[s]])return c;void 0!==(l=l[a[s]])[n]&&(c=l[n])}return void 0!==l[n]&&(c=l[n]),["string","number","boolean","array"].contains(typeof c)?c:c?void 0!==c.default||void 0!==i?o(c,i):r:null}function o(e,t){var n,i,r=e,o=e.default;if(!t)return o;for(n=t.split("."),i=0;i<n.length;++i){if(void 0===r[n[i]])return o;o=r=r[n[i]]}return o}function s(e){return e=e||{}}function a(e,t){return e=e.substring(0,e.length-2),(e*=t)+"px"}function l(e,t){return t?e+"."+t:e}var c,u;return c=e.extend("ChartStyleService",{init:function(){this._baseStyle=t,this._chartStyles=t,this._fontCache={},this._variables=s(t._variables);var e=this;t.ThemeChanged.bind(function(){e._variables=s(t._variables)})},getValue:function(e,t,n,o,s){return""===(e=e||"")||this._chartStyles[e]?(""!==e&&(e+="."),t&&(e+=t),i(r(this._chartStyles,e,n,o,s),this._variables)):s},getFont:function(e,t,n,i,o,s){if(e=e||"",s=s||1,""===e||this._chartStyles[e]){""!==e&&(e+="."),t&&(e+=t);var c=l(e,n);if(this._fontCache[c]&&1===s&&isNaN(o))return this._fontCache[c];var u=r(this._chartStyles,e,"lineHeight",n),h=r(this._chartStyles,e,"fontFamily",n),d=[r(this._chartStyles,e,"fontStyle",n)||"",r(this._chartStyles,e,"fontVariant",n)||"",r(this._chartStyles,e,"fontWeight",n)||"",r(this._chartStyles,e,"fontStretch",n)||"",o||0===o?o+"px":a(r(this._chartStyles,e,"fontSize",n)||"12px",s),u?"/"+u:"",h?"'"+h+"'":"'Qlikview Sans'"];return d=d.filter(function(e){return""!==e}),1===s?(this._fontCache[c]=d.join(" "),this._fontCache[c]):d.join(" ")}return i}}),u=new c,u.layoutMap={1:"spark",3:"xsmall",7:"small",15:"medium",31:"full",m:"mobile"},u.getLayoutKey=function(e){return n.isSmallDevice?this.layoutMap.m:this.layoutMap[e]},{getInstance:function(){return u}}}),define("extensions.qliktech/linechart/layers/layer",["core.utils/class","objects.views/charts/renderers/canvas-renderer","core.utils/deferred"],function(e,t,n){return e.extend("layer",{init:function(e,n){this.wrapper=document.createElement("div"),this.wrapper.style.position="absolute",this.renderer=new t(this.wrapper,n),this.minorAxis=null,this.majorAxis=null,e.appendChild(this.wrapper)},update:function(){},release:function(){this.wrapper&&this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper),this.wrapper=null,this.renderer.release(),this.minorAxis=null,this.majorAxis=null},show:function(){this.wrapper.style.display="block"},hide:function(){this.wrapper.style.display="none"},render:function(){return"none"!==this.wrapper.style.display?this.renderer.render():n.resolve()},clear:function(){this.renderer.clear()}})}),define("extensions.qliktech/linechart/layers/selection-highlight-layer",["./layer","objects.views/charts/shapes/rect","general.utils/color"],function(e,t,n){return e.extend("SelectionHighlightLayer",{init:function(){this._super.apply(this,arguments),this.ranges=[],this.color=n.toRGBA("#52cc52",.2)},setRanges:function(e){this.ranges=e},update:function(e){var n=this.ranges.map(function(n){var i=e.getPositionOfValue(n.min),r=e.getPositionOfValue(n.max),o=new t(i,0,r-i,this.rect.height);return o.fill=this.color,o},this);this.renderer.stage.removeChildren(),n.length?(this.renderer.stage.addChildren(n),this.show()):this.hide()}})}),define("extensions.qliktech/barchart/style",[],function(){return{dataPoint:{label:{dark:{color:"#666"},light:{color:"#eee"},font:"11px 'QlikView Sans'"}},shape:{selected:{border:{color:"#333",width:2}},unselected:{opacity:.5},highlighted:{border:{dark:{color:"rgba( 26, 26, 26, 0.75 )"},light:{color:"rgba( 230, 230, 230, 0.75)"},width:1}}}}}),define("extensions.qliktech/barchart/bararea",["objects.views/charts/components/chart-component","./layers/bar-layer","./layers/label-layer","general.utils/color","general.utils/shapes/rect","objects.views/charts/shapes/container","objects.views/charts/shapes/polygon","objects.views/charts/shapes/rect","objects.views/charts/chart-style-service","client.utils/theme/modern/theme","core.utils/deferred","extensions.qliktech/linechart/layers/selection-highlight-layer","core.utils/feature-flags","./style"],function(e,t,n,i,r,o,s,a,l,c,u,h,d){"use strict";function p(e){return g.width=5,g.height=5,v.save(),v.fillStyle=i.toRGBA(e,.8),v.scale(1,1),v.fillRect(0,0,1,1),v.fillRect(0,1,1,1),v.fillRect(1,0,1,1),v.fillRect(4,1,1,1),v.fillRect(4,2,1,1),v.fillRect(3,2,1,1),v.fillRect(3,3,1,1),v.fillRect(2,3,1,1),v.fillRect(2,4,1,1),v.fillRect(1,4,1,1),v.restore(),v.createPattern(g,"repeat")}function f(e,t){var n=e.layoutMap[t]||"medium";return d.THEMING?{shape:{selected:{border:{color:"#333333",width:2}},outOfRange:{color:e.getStyle("outOfRange","color")}},dataPoints:{label:{font:"normal "+e.getStyle("label.value","fontSize")+" 'QlikView Sans'",color:e.getStyle("label.value","color"),dark:{color:"#595959"},light:{color:"#E6E6E6"}},backgroundColor:e.getStyle("","backgroundColor")},backgroundColor:e.getStyle("","backgroundColor")}:{shape:{selected:{border:{color:e.getValue(m,"shape.border","color","selected"),width:e.getValue(m,"shape.border","width","selected")}},outOfRange:{color:"#999999"}},dataPoints:{label:{font:e.getFont(m,"value",n),color:e.getValue(m,"value","color","dark"),dark:{color:e.getValue(m,"value","color","dark")},light:{color:e.getValue(m,"value","color","light")}}},backgroundColor:e.getValue(m,null,"backgroundColor")}}var m="barChart",g=document.createElement("canvas"),v=g.getContext("2d");return e.extend("BarArea",{init:function(){this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._shapes=[],this._barData=[],this._showDataPoints=!0,this._colorMap=null,this._groupingMode="grouped",this._globalAlpha=1,d.THEMING?this._styleService=c.initializeService("object.barChart"):this._styleService=l.getInstance(),this._edgeBleed=0,this._barLayer=new t(this.container),this._barLayer.isMini=this.isMini,this.layers=[this._barLayer],this.isMini?(this._rangeSelectionLayer=new h(this.container),this.layers.push(this._rangeSelectionLayer)):(this._labelLayer=new n(this.container),this.layers.push(this._labelLayer))},setYMirrorMode:function(e){this._super(e),this._labelLayer&&this._labelLayer.setYMirrorMode(e)},beforeBarsAddedToRenderer:function(){},barsAddedToRenderer:function(){},labelAddedToRenderer:function(){},afterPaint:function(){return u.resolve()},setColorMap:function(e){this._colorMap=e},getColorMap:function(){return this._colorMap},setShowDataPoints:function(e){this._showDataPoints=e,this.invalidateDisplay("BarArea.setShowDataPoints")},getShowDataPoints:function(){return this._showDataPoints},getMeasureIndices:function(){return this._measureIndices},setMeasureIndices:function(e){this._measureIndices=e},setMajorAxis:function(e){this._majorAxis=e,this._majorAxis.listen("changed",function(){this.invalidateDisplay("BarArea.setMajorAxis")},this)},setMinorAxis:function(e){this._minorAxis=e,this._minorAxis.listen("changed",function(){this._localFormatting&&(this._areLabelsFormatted=!1),this.invalidateDisplay("BarArea.setMinorAxis")},this)},setTimeAxis:function(e){this.timeAxis=e,this.timeAxis.listen("changed",function(){this.invalidateDisplay()},this)},setContinuousAxis:function(e){this.continuousAxis=e,this.continuousAxis.listen("changed",function(){this.invalidateDisplay()},this)},setActiveDimensionAxis:function(e){this._activeDimAxis=e},setIsDimensionContinuous:function(e){this.isDimensionContinuous=e,this._edgeBleed=this.isDimensionContinuous?5:0},setDimensionTree:function(e){this._tree=e},setGroupingMode:function(e){this._groupingMode=e},_updateSize:function(){this.invalidateDisplay("BarArea._updateSize")},insertAdjacentTo:function(e,t){if(this._super(e,t),this._minorAxis&&this._minorAxis.isHorizontal())switch(this._minorAxis.dock){case"bottom":this.rect.height-=1}},getMajorAxisData:function(){return this._majorAxisData},getMinorAxisData:function(){return this._minorAxisData},setCacheItems:function(e){this._cacheItems=e},getCacheItems:function(){return this._cacheItems},createAxisData:function(e,t,n,i){i||(this._cacheIndex=0,this._outerCacheIndex=0);var r,o=t.stackLevel===i+1,s=e.children,a=t.numLevels-t.numMeasures;return"measure"===t.types[i]&&this._measureIndices&&(s=s.filter(function(e,t){return this._measureIndices.indexOf(t)>=0},this)),s.map(function(e){var s;if("dimension"===t.types[i]){if(s={label:e.data.qText,group:"dimension"===t.types[i+1]||"measure"===t.types[i+1]&&t.numMeasures>1,id:e.data.id,cacheIndex:[]},"measure"===t.types[i+1])for(r=0;r<t.numMeasures;r++)s.cacheIndex.push(this._cacheIndex++);else a>1&&0===i&&e.children.forEach(function(e){e.children[0].isBranch&&(-2!==e.data.qElemNo&&s.cacheIndex.push(this._outerCacheIndex),this._outerCacheIndex++)},this);!o&&("dimension"===t.types[i+1]||"measure"===t.types[i+1]&&t.numMeasures>1)&&(s.children=this.createAxisData(e,t,n,i+1))}else"measure"===t.types[i]&&(s={label:e.data.qText,id:e.data.id});return s},this)},_createMeasureDisplayNode:function(e,t){if(e.isBranch){var n=!0===this.isMini||this._isStacked?new a:new s,i=e.children[0].data,o=e.parent.cacheItem,l=new r(0,0,0,0),c=this.measureFormatters[t],u=void 0!==i.qValue?i.qValue:i.qNum,h=e.ancestors.filter(function(e){return"qElemNo"in e.data}).map(function(e){return e.data.qElemNo}).reverse();return n.data={qText:e.data.qText,measureIndex:t,value:u,start:0,end:u,valueLabel:e.children[0].data.qText,formatted:!c||"U"!==c.type,hitRect:l,cacheItem:o,color:this._colorMap.getColor(h,u,t,e.data.rowIndex)},o.addShape("dataArea",l,!0),o.calculateTooltipPosition=!0,n.data.fill=n.data.color.toRGBA(),n.fill=n.data.fill,n.data.isFillColorDark=n.data.color.isDark(),n}},_createDimensionDisplayNode:function(e){var t=new o;return t.data={qText:e.data.qText,qElemNo:e.data.qElemNo,qMaxPos:e.data.qMaxPos,qMinNeg:e.data.qMinNeg,qType:e.data.qType},t},_createStackNode:function(){var e=new o;return e.data={stack:!0},e},_createOtherNode:function(e,t){var n=new a,i=new r(0,0,0,0),o=this.measureFormatters[0];return n.data={measureIndex:0,value:t-e,start:e,end:t,isFakeOtherCell:!0,highlightOnGroupSelect:0===this._selectionIndices[0],valueLabel:"valueLabel",formatted:!o||"U"!==o.type,hitRect:i,cacheItem:{},color:this._colorMap.getColor([-3],t-e,0,0)},n.data.fill=n.data.color.toRGBA(),n.fill=n.data.fill,n.data.isFillColorDark=n.data.color.isDark(),n},_addOtherNode:function(e,t,n){var i=this._createDimensionDisplayNode({data:{qMaxPos:0,qMinNeg:0,qElemNo:-3,qType:"O"}}),r=this._createOtherNode(e.data.sum,t);return r.data.axisId=n.data.id,r.data.cacheItem=n.cacheItem,i.addChild(r),e.data.sum=t,e.addChild(i),r},_stackNodes:function(e,t,n,i){var r,o,s,a,l,c=this._createStackNode(),u=this._createStackNode(),h=!1,d=!1,p=0,f=0;c.data.isStack=!0,u.data.isStack=!0,e.forEach(function(e){r=t,(s=e.children&&e.children[0]?e.children[0].data:e.data).value>=0?(r=c,s.start=p,p+=s.value,s.end=p,o=p,a=!0,r.addChild(e),"O"===e.data.qType&&(h=!0)):isNaN(s.value)||(r=u,s.start=f,f+=s.value,s.end=f,o=f,l=!0,r.addChild(e),"O"===e.data.qType&&(d=!0)),r.data.sum=o}),void 0===t.data.qMaxPos||h||p===t.data.qMaxPos||(i.push(this._addOtherNode(c,t.data.qMaxPos,n)),p=c.data.sum,a=p>0),void 0===t.data.qMinNeg||d||f===t.data.qMinNeg||(i.push(this._addOtherNode(u,t.data.qMinNeg,n)),f=u.data.sum,l=f<0),a&&(c.data.valueLabel=this.combinedMeasuresFormatter?this.combinedMeasuresFormatter.formatValue(c.data.sum):c.data.sum+"",t.addChild(c)),l&&(u.data.valueLabel=this.combinedMeasuresFormatter?this.combinedMeasuresFormatter.formatValue(u.data.sum):u.data.sum+"",t.addChild(u)),t.data.sum={positive:p,negative:f}},getRenderTree:function(e,t,n,i){var r,o,s,a,l,c,u,h=t.stackLevel===i+1,d=[];for(s=e.children,"measure"===t.types[i]&&this._measureIndices&&(s=s.filter(function(e,t){return this._measureIndices.indexOf(t)>=0},this)),l=s.length,a=0;a<l;a++)if(u=s[a],"dimension"===t.types[i])c=this._createDimensionDisplayNode(u),o=this.getRenderTree(u,t,n,i+1),h?(this._stackNodes(o,c,u,n.otherShapes),n.globalPositiveSum=Math.max(n.globalPositiveSum,c.data.sum.positive),n.globalNegativeSum=Math.min(n.globalNegativeSum,c.data.sum.negative)):c.addChildren(o),c.isBranch&&d.push(c);else if("measure"===t.types[i]){if(!(c=this._createMeasureDisplayNode(u,this._measureIndices?this._measureIndices[a]:a)))continue;r=u,t.numMeasures<=1&&(r=r.parent),t.stackLevel===i&&(r=r.parent),c.data.axisId=r.data.id,c.data.axisNum=1===i?r.data.qNum:r._parent.data.qNum,n.shapes.push(c),d.push(c)}return d},_applyIds:function(e,t,n,i){var r;e.children.forEach(function(o,s){r=e.data.id?e.data.id+";"||"":"","dimension"===n[i]?(o.data.id=r+t[i]+":"+o.data.qElemNo,this._applyIds(o,t,n,i+1)):"measure"===n[i]&&(o.data.id=r+t[i+s])}.bind(this))},renderRangeSelections:function(){return this._rangeSelectionLayer.update(this._activeDimAxis),this._rangeSelectionLayer.render()},updateRangeSelection:function(e){this._rangeSelectionLayer&&(this._rangeSelectionLayer.setRanges(e),this.renderRangeSelections()),this.isMini||(this._barLayer.selectedRanges=e)},_updateProperties:function(){if(this._data&&this._tree){this._barLayer.renderer.stage.removeChildren();var e=this._data.qHyperCube.qDimensionInfo.length,t=this._measureIndices?this._measureIndices.length:this._data.qHyperCube.qMeasureInfo.length,n="stacked"===this._groupingMode&&(e>1||t>1),i=e+1,r=-2,o=[],s=new Array(e).join(",").split(",").map(function(){return"dimension"}),a=this._data.qHyperCube.qDimensionInfo.concat(this._data.qHyperCube.qMeasureInfo).map(function(e){return e.cId}),l=this._data.qHyperCube.qDimensionInfo.map(function(e){return e.qApprMaxGlyphCount});if(s.push("measure"),l.push(this._data.qHyperCube.qMeasureInfo.reduce(function(e,t){return Math.max(e,t.qApprMaxGlyphCount)},0)),n)r=t>1?e:e-1;else if(e>1){var c=this._data.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+this._data.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected,u=this._data.qHyperCube.qSize.qcy/c;o.push(u),o.push(t)}else o.push(t),o.push(1);this._isStacked=n;var h={columns:[],shapes:[],shapesToLabel:[],otherShapes:[],globalPositiveSum:0,globalNegativeSum:0},d={colIds:a,types:s,numLevels:i,numMeasures:t,stackLevel:r};e>1&&this._allowInnerSelection&&!this._data.qHyperCube.qDimensionInfo[1].qLocked?(this.setSelectionIndices([1]),this._majorAxis.setSelectionIndices([1]),this._majorAxis.setCurrentDataIndices([1])):(this.setSelectionIndices([0]),this._majorAxis.setSelectionIndices([0]),this._majorAxis.setCurrentDataIndices([0])),this._applyIds(this._tree,a,s,0);var p=this.getRenderTree(this._tree,d,h,0);this._objects=p,this._formatted=this._isStacked||this.measureFormatters.every(function(e,t){return!(!this._measureIndices||this._measureIndices.indexOf(t)>=0)||e&&"U"!==e.type},this),this._shapes=h.shapes;var f=h.shapes.map(function(e){return e.data.cacheItem});this._shapes=this._shapes.concat(h.otherShapes),p.forEach(function(e){this._barLayer.renderer.stage.addChild(e)}.bind(this));var m=this.createAxisData(this._tree,d,h,0),g=s.map(function(e,t){return{qApprMaxGlyphCount:l[t],show:t<s.length-1,groupSize:o[t]}});this._majorAxisData={data:m,info:g},this._numDimensions=e,this._numMeasures=t,this._minorAxisData=n?{min:h.globalNegativeSum,max:h.globalPositiveSum}:null,this.setSelectableShapes(f)}},hasValidData:function(){return this._super()&&this._majorAxis&&this._minorAxis&&this._data&&this._tree&&(this._data.qHyperCube.qStackedDataPages.length>0||this._data.qHyperCube.qDataPages.length>0)},updateSize:function(){this._super(),this.layers.forEach(function(e){e.rect=this.rect,e.renderer.setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y),e.renderer.setDimensions(0,0,this.rect.width,this.rect.height)},this)},paint:function(){this._super(this._layoutMode,this._data),this._majorAxis.updateNow(),this._minorAxis.updateNow(),this._activeDimAxis&&this._activeDimAxis.updateNow();var e=this._minorAxis.getPadding(),t=new r,n=this;this._style=f(this._styleService,this._layoutMode),t.set(e.left,e.top,this.rect.width-e.left-e.right,this.rect.height-e.top-e.bottom),this.layers.forEach(function(e){e.minorAxis=this._minorAxis,e.majorAxis=this.isDimensionContinuous?this._activeDimAxis:this._majorAxis,e.isNumeric=this.isDimensionContinuous,e.shapes=this._shapes,e.othersFillPattern=p(this._colorMap.getColor([-3])),e.groupingMode=this._groupingMode,e.widthRatio=this._numDimensions<=1&&this._numMeasures<=1||"stacked"===this._groupingMode?.7:.95,e.isSpikingEnabled=!(this.isMini||"stacked"===this._groupingMode&&(this._numDimensions>1||this._numMeasures>1)),e.isHintingEnabled=!this.isMini&&("grouped"===this._groupingMode||"stacked"===this._groupingMode&&this._numDimensions+this._numMeasures<=2),e.style=this._style,e._globalAlpha=this._globalAlpha},this),this._barLayer.renderer.edgeBleed={left:this._edgeBleed,right:this._edgeBleed,top:0,bottom:0},this._barLayer.colorMap=this._colorMap,this._barLayer.update(),this.nodesInView=this._barLayer.nodesInView,this.barsAddedToRenderer(),this._labelLayer&&(this._labelLayer.renderer.edgeBleed={left:this._edgeBleed,right:this._edgeBleed,top:0,bottom:0},this._labelLayer.setShapes(this._objects),this._labelLayer.bounds=t,this._labelLayer._longestLabel=20,this._layoutMode>this.ShowFlags.XSMALL&&this._showDataPoints?(this._formatLabels(),this._labelLayer.show(),this._labelLayer.render()):this._labelLayer.hide());var i=[this._barLayer.render()];return this._rangeSelectionLayer&&i.push(this.renderRangeSelections()),u.all(i).then(function(){return n.afterPaint()})},_formatLabels:function(){if(!this._isStacked&&!this._formatted){var e,t,n=this.nodesInView?this.nodesInView.length:0;for(e=0;e<n;e++)(t=this.nodesInView[e].data).formatted||(t.formatted=!0,t.valueLabel=this.measureFormatters[t.measureIndex]?this.measureFormatters[t.measureIndex].formatValue(t.value):t.valueLabel)}},preRelevantSizeCalculation:function(){this.perpendicularlyRelevantSpacing={left:this._edgeBleed,right:this._edgeBleed,top:0,bottom:0}},clear:function(){this._super(),this.layers.forEach(function(e){e.clear()})},release:function(){this.layers.forEach(function(e){e.release()}),this._super(),this._majorAxis&&this._majorAxis.stopListen("changed",null,this),this._minorAxis&&this._minorAxis.stopListen("changed",null,this),this.timeAxis&&this.timeAxis.stopListen("changed",null,this),this.continuousAxis&&this.continuousAxis.stopListen("changed",null,this)}})}),define("extensions.qliktech/barchart/barchart-properties",["client.utils/property-resolver","objects.utils/continuous-utils","client.property-panel/default-axis-properties-logic"],function(e,t,n){function i(n){return{get:function(e,i,r){return t.isContinuousChart(r.layout)?n:e(i.type)},set:function(t,n,i){var r=e.getDefaultValue(i.type,i);n(i.type,t,r)}}}return{type:"items",component:"accordion",items:{data:{uses:"data",items:{dimensions:{items:{nullSuppression:{show:function(e,i,r){var o=n.isFirstDimension(e,i),s=t.isContinuousChart(r.layout);return!(o&&s)}}}}}},sorting:{type:"items",translation:"properties.sorting",items:{noContinuousSortingMessage:{component:"text",translation:"properties.sorting.noContinuousSortingMessage",show:function(e,n,i){return t.isContinuousChart(i.layout)}},defaultSorting:{show:function(e,n,i){return!t.isContinuousChart(i.layout)},uses:"sorting",items:{dimensions:{locked:function(e,t,n){return 1===n.getMeasures().length&&2===n.getDimensions().length&&0===e}}}}}},addons:{type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{calcCond:{uses:"calcCond"}}},refLines:{uses:"reflines"}}},settings:{uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{grouping:{ref:"barGrouping.grouping",type:"string",component:"item-selection-list",defaultValue:"grouped",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.grouped",value:"grouped"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.stacked",value:"stacked"}],show:function(e){return e.qHyperCubeDef.qMeasures.length+e.qHyperCubeDef.qDimensions.length>2},change:function(e,t){t.getDimensions().length>1&&"stacked"===e.barGrouping.grouping?(e.qHyperCubeDef.qMode="K",e.qHyperCubeDef.qAlwaysFullyExpanded=!0):e.qHyperCubeDef.qMode="S"},readOnly:function(e,n,i){return t.isContinuousChart(i.layout)},convertFunctions:i("stacked")},orientation:{ref:"orientation",type:"string",component:"item-selection-list",defaultValue:"vertical",horizontal:!0,items:[{component:"icon-item",icon:"",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}],readOnly:function(e,n,i){return t.isContinuousChart(i.layout)},convertFunctions:i("vertical")},scrollStartPos:{ref:"scrollStartPos",type:"number",translation:"properties.ScrollAlignment",component:"dropdown",defaultValue:0,options:[{value:0,translation:"properties.ScrollAlignStart"},{value:1,translation:"properties.ScrollAlignEnd"}],show:function(e,n,i){return!t.isContinuousChart(i.layout)}},gridLines:{type:"items",snapshot:{tid:"property-gridLines"},items:{showGridLines:{ref:"gridLine.auto",type:"boolean",translation:"properties.gridLine.spacing",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},gridSpacing:{ref:"gridLine.spacing",type:"number",component:"dropdown",defaultValue:2,options:[{value:0,translation:"properties.gridLine.noLines"},{value:1,translation:"properties.gridLine.wide"},{value:2,translation:"properties.gridLine.medium"},{value:3,translation:"properties.gridLine.narrow"}],show:function(e){return e.gridLine&&!e.gridLine.auto}}}},showLabels:{ref:"dataPoint.showLabels",type:"boolean",translation:"properties.dataPoints.labelmode",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],snapshot:{tid:"property-dataPoints"}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{legend:{items:{show:{snapshot:{tid:"property-legend"}}}}}},dimensionAxis:{uses:"axis.dimensionAxis"},measureAxis:{uses:"axis.flippableMeasureAxis"}}}}}}),define("extensions.qliktech/barchart/barchart-data",["core.utils/deferred","client.utils/property-resolver","objects.utils/data-properties/library-utils","general.models/library/dimension"],function(e,t,n,i){function r(t){function r(e){e>10?1!==t.getSorting()[0]&&t.changeSorting(1,0):0!==t.getSorting()[0]&&t.changeSorting(1,0)}var o,s=t.getDimensions(),a=t.getMeasures();if(1===s.length&&1===a.length){var l=s[0];return l.qLibraryId?i.get(l.qLibraryId,t.app).then(function(e){return e.getLayout()}).then(function(e){return e&&e.qDimInfos&&e.qDimInfos[0]&&r(e.qDimInfos[0].qCardinal),l}):t.app.getFieldList().then(function(e){var t=n.findField(l.qDef.qFieldDefs[0],e);return t&&r(t.qCardinal),l})}return s.length>1&&1===a.length&&0!==(o=t.getSorting().indexOf(0))&&t.changeSorting(o,0),e.resolve()}function o(e){var t;e.getDimensions().length>1&&1===e.getMeasures().length&&0!==(t=e.getSorting().indexOf(0))&&e.changeSorting(t,0)}function s(e,n){var i=n.getDimensions(),r=n.getMeasures(),o=t.getValue(e,"color.mode");i.length>1&&e.color?e.color.persistent=!0:"byDimension"===o&&r.length>1?t.setValue(e,"color.mode","byMultiple"):"byExpression"===o&&0===r.length&&t.setValue(e,"color.mode","primary")}return{measures:{min:1,max:function(e){return e>=2?1:15},description:function(e){return"vertical"===e.orientation?"Height":"Width"},add:function(e,t,n){return r(n).then(function(){return e.qSortBy.qSortByNumeric=-1,s(t,n),e})},move:function(e,t,n){o(n),s(t,n)},remove:function(e,t,n){var i=n.getDimensions();s(t,n),i.length>1&&"stacked"===t.barGrouping.grouping?(t.qHyperCubeDef.qMode="K",t.qHyperCubeDef.qAlwaysFullyExpanded=!0):1===i.length&&(t.qHyperCubeDef.qMode="S")}},dimensions:{min:1,max:function(e){return e>=2?1:2},description:function(e,t,n){return n>1&&0===t?"stacked"===e.barGrouping.grouping?"Stacks":"Groups":"Bars"},add:function(e,t,n){return n.getDimensions().length>1&&"stacked"===t.barGrouping.grouping&&(t.qHyperCubeDef.qMode="K",t.qHyperCubeDef.qAlwaysFullyExpanded=!0),r(n).then(function(){return s(t,n),e})},move:function(e,t,n){n.getDimensions().length>1&&"stacked"===t.barGrouping.grouping&&(t.qHyperCubeDef.qMode="K",t.qHyperCubeDef.qAlwaysFullyExpanded=!0),o(n),s(t,n)},remove:function(e,t,n){var i=n.getDimensions();s(t,n),1===i.length&&(t.qHyperCubeDef.qMode="S")}}}}),define("extensions.qliktech/barchart/barchart-explore-properties",["client.utils/property-hypercube-helper","objects.utils/continuous-utils"],function(e,t){return{type:"items",component:"accordion",items:{data:{uses:"data"},sort:{uses:"sort",show:function(e,n){return!t.isContinuousChart(n)},items:{dimensions:{locked:function(t,n){return 1===e.getNumMeasures(n)&&2===e.getNumDimensions(n)&&0===t}}}},presentation:{uses:"presentation",items:{showLabels:{ref:"dataPoint.showLabels",type:"boolean",translation:"properties.dataPoints.labelmode",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},grouping:{ref:"barGrouping.grouping",type:"string",component:"item-selection-list",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.grouped",value:"grouped"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.stacked",value:"stacked"}],show:function(e,n){return e.qHyperCubeDef.qMeasures.length+e.qHyperCubeDef.qDimensions.length>2&&!t.isContinuousChart(n)},change:function(e){e.qHyperCubeDef.qDimensions.length>1&&"stacked"===e.barGrouping.grouping?(e.qHyperCubeDef.qMode="K",e.qHyperCubeDef.qAlwaysFullyExpanded=!0):e.qHyperCubeDef.qMode="S"}},orientation:{ref:"orientation",type:"string",component:"item-selection-list",horizontal:!0,items:[{component:"icon-item",icon:"",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}],show:function(e,n){return!t.isContinuousChart(n)}}}},color:{uses:"color"}}}}),define("objects.views/charts/layout-engine",["general.utils/shapes/rect"],function(e){function t(){this._layoutComponents=[],this._componentSizes=[]}function n(e){var t=this._componentSizes.filter(function(t){return t.component===e})[0];t||(t={component:e},this._componentSizes.push(t)),t.rect=e.rect.clone()}function i(e){return this._componentSizes.filter(function(t){return t.component===e})[0]}function r(e,t,n,i,r){var o,s=this._layoutComponents.slice(),a=[{fn:"_reduceComponentRectBySpacingV",dock:["left","right"]},{fn:"_reduceComponentRectBySpacingH",dock:["top","bottom"]}];for("vertical"===i&&a.reverse(),s.sort(function(e,t){return(e.reductionOrder||1e3)-(t.reductionOrder||1e3)}),o=0;o<s.length;o++)s[o].perpendicularlyRelevantSpacing={top:0,left:0,right:0,bottom:0},s[o].preRelevantSizeCalculation&&s[o].preRelevantSizeCalculation();var l=e.clone();a.forEach(function(e){this._reducePreliminaryLayoutRectForComponents(s,l,t,n,function(t){return t&&e.dock.indexOf(t.dock)>=0})},this),a.forEach(function(e){this[e.fn](l,t,s,n)},this),r&&r()&&(l=e.clone(),a.forEach(function(e){this._reducePreliminaryLayoutRectForComponents(s,l,t,n,function(t){return t&&e.dock.indexOf(t.dock)>=0}),this[e.fn](l,t,s,n)},this)),a.forEach(function(i){this._reduceLayoutRectForComponents(s,e,t,l,n,function(e){return e&&i.dock.indexOf(e.dock)>=0})},this),a.forEach(function(i){this[i.fn](e,t,s,n)},this)}return t.prototype={addComponent:function(e){var t;t=this._layoutComponents,this.removeComponent(e),t.push(e)},removeComponent:function(e){var t,n;for(n=this._layoutComponents,t=0;t<n.length;++t)if(n[t]===e)return void n.splice(t,1)},_reduceLayoutRectForComponents:function(e,t,n,i,r,o){var s;for(s=0;s<e.length;++s)e[s]&&["left","right","bottom","top"].contains(e[s].dock)&&o(e[s])&&(e[s].calculateRelevantSize(t,n,i),e[s].isVisible(r)&&(e[s].relevantSize=Math.round(e[s].relevantSize),e[s].reduceLayoutRect(t)))},_reducePreliminaryLayoutRectForComponents:function(e,t,n,i,r){var o;for(o=0;o<e.length;++o)e[o]&&["left","right","bottom","top"].contains(e[o].dock)&&r(e[o])&&(e[o].calculatePreliminaryRelevantSize?e[o].calculatePreliminaryRelevantSize(t,n):e[o].calculateRelevantSize(t,n),e[o].isVisible(i)&&e[o].reduceLayoutRect(t))},_reduceComponentRectBySpacingH:function(e,t,n,i){var r,o;for(r=0;r<n.length;++r)(o=n[r].perpendicularlyRelevantSpacing)&&n[r].isVisible(i)&&(o.left>e.x&&e.x>=0&&(e.width-=o.left-e.x,e.x=o.left),o.right>t.width-e.x-e.width&&(e.width-=o.right-(t.width-e.x-e.width-t.x)))},_reduceComponentRectBySpacingV:function(e,t,n,i){var r,o;for(r=0;r<n.length;++r)(o=n[r].perpendicularlyRelevantSpacing)&&n[r].isVisible(i)&&(o.top>e.y&&e.y>=0&&(e.height-=o.top-e.y,e.y=o.top),o.bottom>t.height-e.y-e.height&&(e.height-=o.bottom-(t.height-e.y-e.height-t.y)))},_layoutComponent:function(e,t,n,i){e&&e.insertAdjacentTo(e.dock&&"center"!==e.dock?e.isVertical()?n.x:n.y:i,e.isVisible(t))},layout:function(t,o,s,a,l){t=new e(t.x,t.y,t.width,t.height);var c,u,h,d,p,f=(s=new e(s.x,s.y,s.width,s.height)).width/t.width,m=s.height/t.height;for((u=this._layoutComponents).sort(function(e,t){return"center"===e.dock?"center"===t.dock?0:-1:"center"===t.dock?1:e.layoutOrder-t.layoutOrder}),t=new e(t.x,t.y,t.width-4,t.height-4),h=new e(t.x,t.y,t.width,t.height),d={x:new e,y:new e},r.apply(this,[h,t,o,a,l]),h.x+=2,h.y+=2,d.x.set(h.x,h.y,h.width,h.height),d.y.set(h.x,h.y,h.width,h.height),c=0;c<u.length;++c)u[c].setLayoutToContainerRatios(f,m),this._layoutComponent(u[c],o,d,h),p=i.call(this,u[c]),u[c].updateSize(!p||p.rect.width!==u[c].rect.width||p.rect.height!==u[c].rect.height),n.call(this,u[c])}},t}),define("objects.views/charts/components/data-area",["./chart-component"],function(e){return e.extend({paint:function(e){this._super(e)}})}),define("objects.views/charts/components/axis/radial-axis-helper",["objects.views/charts/utils/matrix","general.utils/shapes/rect"],function(e){function t(e,t,n,i){var r,o,s,a,l,c,u,h,d=e.labels,p=t,f=e.opacities,m=[],g=i._style;if(0!==(a=d?d.length:0)){for(l=a-1,h=0;h<a;h++)c=i.yMirrorMode?d[l-h]:d[h],r=i._renderer.getTextWidth(c,g.label.font),o=(s=(u=p[h]).angle)-.1<3*Math.PI/2&&s+.1>3*Math.PI/2?"center":s<Math.PI/2||s>3*Math.PI/2?"left":"right",m.push({type:"text",fill:g.label.color,opacity:f?f[h]:1,shape:{text:c,x:u.x,y:u.y,maxWidth:u.x-r<0?u.x:u.x+r>i.rect.width?i.rect.width-u.x:r,height:void 0,maxNumLines:1,font:g.label.font,align:o,baseline:"middle"}});return m}}function n(e,t){var n=[],r=Math.min(e.rect.width,e.rect.height),o=i(e);return n.push({type:"text",fill:t.title.color,opacity:1,shape:{text:e._title,x:o.x,y:o.y+r*(.06+Math.min(r-300,0)/-300*.04),maxWidth:1.4*e._radius,maxNumLines:1,font:t.title.font,align:"center",baseline:"middle"}}),n}function i(e){return{x:e.rect.width/2,y:e.rect.height/2}}function r(e,t){var n=t._radialOptions;return Math.max(Math.min(e,1),0)*(n.end-n.start)+n.start}function o(e,t,n){var i=t._radialOptions;return a({a:e*(i.end-i.start)+i.start,r:t._radius},n)}function s(e){return{r:Math.sqrt(e.x*e.x+e.y*e.y),a:Math.atan2(e.y,e.x)}}function a(e,t){return t||(t={x:0,y:0}),{x:t.x+e.r*Math.cos(e.a),y:t.y+e.r*Math.sin(e.a)}}return{renderRadial:function(i,l,c){var u,h,d,p,f,m,g=i.length>0?i[0].positions:[],v=l._style,y=l._radialOptions,b=new e,x=v.ticks.major.length*c,q=v.label.offset*c*20,C="far"===l.getAlignment()?"left":"right",S=[],w=Math.min(l.rect.height,l.rect.width),_=[],D=l._radius;if(u="left"===C?1:-1,x*=u,u>0?0:l.rect.width,l.getShowLine()&&S.push({stroke:v.line.color,shape:{cx:l._centerPoint.x,cy:l._centerPoint.y,radius:D,radianOffset:0,start:y.start,end:y.end},type:"arc"}),l.getShowLabels())for(m=0;m<g.length;m++)(f=s(p=o(h=(g[m]-0)/(w-0),l))).r=f.r+q,f=a(f,l._centerPoint),d=r(h,l),f.angle=d,_.push(f),b.save(),b.translate(p.x+l._centerPoint.x,p.y+l._centerPoint.y),b.rotate(d),S.push({stroke:v.ticks.major.color,opacity:l.ticks[m].opacity,transform:b.elements,shape:{x1:0,x2:-x,y1:0,y2:0},type:"line"}),b.restore();if(v.ticks.major.length*u,l._showLabels&&l._layoutMode>1)for(m=0;m<i.length;m++)S=S.concat(t(i[m],_,0,l)),i[m].labelSpace*u;l._showTitle&&l._layoutMode>1&&(S=S.concat(n(l,v))),l._renderer.shapes=S,l._renderer.render()},getPointOfValue:o,getPolPos:s,getCartPos:a,getAngleOfNormalizedValue:r}}),define("objects.views/charts/components/axis/axis",["jquery","../chart-component","objects.views/charts/components/axis/radial-axis-helper","objects.views/charts/utils/canvas-renderer","objects.views/charts/utils/matrix","general.utils/shapes/rect","general.utils/shapes/polygon","objects.views/charts/chart-style-service","client.utils/theme/modern/theme","core.utils/feature-flags"],function(e,t,n,i,r,o,s,a,l,c){"use strict";function u(){var e,t=this;(e=this.getLevels()||[]).length||this._showTitle_internal?(this._cacheItems&&this._cacheItems.length&&(this._cacheItems[0].objectShapes?this._cacheItems.forEach(function(e){e.objectShapes[t.selectionIdentifier]=null}):this._cacheItems.forEach(function(e){e.clearShapes(t.selectionIdentifier)})),this.isRadial()?n.renderRadial(e,this,this._windowSizeMultiplier):this.isVertical()?g.apply(this,[e]):b.apply(this,[e,this.indicators])):this._renderer.clear()}function h(e,t,n,i){var o,a,l,c,u,h,d,p,f,m=e.labels,g=e.positions,v=Math.abs(this._fontHeight*Math.sin(n)),y=e.labelSpace,b=Math.abs(y/Math.sin(n)),C=Math.cos(n),S=this.yMirrorMode?-Math.PI/2:Math.PI/2,w=(new r).skew(S-n,0).scale(this._discreteSpacing*(this._groupSize||1)/this._fontHeight,1).translate(0,-i*this._fontHeight/2).rotate(-S),_=[],D=n<0?"right":"left";for("middle","near"===this.getAlignment()&&"center"!==D&&(D="left"===D?"right":"left"),f=0;f<m.length;f++)(o=g[f])<0||o>this.rect.width||((d=new r).translate(g[f],t+i*v/2),d.rotate(n),h="right"===D?Math.min((o+this._edgeBleed.left)/C,b):Math.min((this.rect.width-o+this._edgeBleed.right)/C,b),h-=2*v,_.push({type:"text",fill:this._style.label.color,opacity:e.opacities[f],transform:d.elements,shape:{text:m[f]||"",font:this._style.label.font,maxWidth:h,align:D,baseline:"middle"}}),x(this._cacheItems,this.isDiscrete(),e.indecies,f)&&(c=[{x:a="left"===D?0:-Math.abs(y),y:-(l=this._fontHeight/2)},{x:a+y,y:-l},{x:a+y,y:l},{x:a,y:l}],(p=new r).translate(g[f]-e.offsets[f],t+i*v/2),p.multiply(w),u=new s(p.transformPoints(c)),q(this._cacheItems,e.indecies[f],this.selectionIdentifier,u)));return _}function d(e,t){return e<t/2?e+=t/2-e:t/2>this._plotSize-e+this._padding.left&&(e-=t/2-(this._plotSize-e+this._padding.left)),e}function p(e,t,n){var r,s,a,l,c,u,h,p,m="near"===this.getAlignment()?"bottom":"top",g=e.align||"center",v=e.labels,y=e.positions,b=e.opacities,C=e.labelMode,w=this._style,_=e.widths,D=[];for(r=0;r<v.length;r++){if(p=_[r],e.labelsBetweenTicks){if(this.yMirrorMode&&(y[r+1]>this.rect.width||y[r]<0))continue;if(!this.yMirrorMode&&(y[r+1]<0||y[r]>this.rect.width))continue;if(u=Math.min(this.rect.width,Math.max(0,y[r])),h=Math.min(this.rect.width,Math.max(0,y[r+1]||(this.yMirrorMode?Number.MIN_VALUE:Number.MAX_VALUE))),s=u+("left"===g?this._labelPadding:-this._labelPadding),(p=Math.min(p,Math.abs(u-h)-this._labelPadding))<this._labelPadding+20)continue}else if((s=y[r])<-.5||s>this.rect.width+.5)continue;!this.isDiscrete()||C!==S||0!==r&&r!==v.length-1||(a=i.measureTextObject({type:"text",shape:{text:v[r]||"",x:s,y:t,maxWidth:_[r]-this._labelPadding,font:this._style.label.font,align:g,baseline:m}}).width,0===r&&s<a/2?s+=a/2-s:r===v.length-1&&a/2>this._plotSize-s&&(s-=a/2-(this._plotSize-s))),c=t+(C===S?0:1.5*this._fontHeight*(r%2)*n),x(this._cacheItems,this.isDiscrete(),e.indecies,r)&&(l=new o(y[r]-e.offsets[r]-e.fullWidths[r]/2,c-("bottom"===m?this._fontHeight*w.label.lineHeight:0),e.fullWidths[r],this._fontHeight*w.label.lineHeight),q(this._cacheItems,e.indecies[r],this.selectionIdentifier,l)),D.push({type:"text",fill:this._style.label.color,opacity:b?b[r]:1,_index:r,shape:{text:v[r]||"",x:s,y:c,maxWidth:p-this._labelPadding,font:this._style.label.font,align:g,baseline:m}})}if(e.labelsBetweenTicks&&v.length>=2&&(this.yMirrorMode?-.5===y[v.length-1]:this.rect.width-y[v.length-1]==.5)&&f.call(this,{objectsToRender:D,positions:y,values:v,opacities:b,widths:_,align:g,baseline:m,y:t}),!this.isDiscrete()&&D.length>0&&!e.labelsBetweenTicks){var M=D[0];a=i.measureTextObject(M).width,M.shape.x=d.apply(this,[M.shape.x,a]),M=D[D.length-1],a=i.measureTextObject(M).width,M.shape.x=d.apply(this,[M.shape.x,a])}return D}function f(e){var t=e.objectsToRender,n=e.positions,r=e.values,o=e.opacities,s=e.widths,a=e.align,l=e.baseline,c=e.y,u=Math.min(this.rect.width,Math.max(0,n[r.length-1]))+("left"===a?-this._labelPadding:this._labelPadding),h=i.measureTextObject(t[t.length-1]).width,d={text:r[r.length-1],font:this._style.label.font,baseline:l};if(h+i.measureDisplayTextObject(d).width+3*this._labelPadding>s[r.length-2]){if(!(r.length>2))return;t.length=t.length-1}t.push({type:"text",fill:this._style.label.color,opacity:o?o[r.length-1]:1,_index:r.length-1,shape:{text:r[r.length-1]||"",x:u,y:c,maxWidth:s[r.length-2]-this._labelPadding,font:this._style.label.font,align:"left"===a?"right":"left",baseline:l}})}function m(e,t,n){var i,r,s,a,l,c=e.labels,u=e.positions,h=e.opacities,d=e.labelSpace,p=[],f=this._style;for(i=this._renderer.getFontHeight(f.label.font),a=u.length>1?Math.abs(u[0]-u[1]):this.rect.height,this.isDiscrete()||(a=0),s=0;s<c.length;s++)r=u[s],(r=Math.max(i/2,Math.min(this._padding.top+this._plotSize-i/2,r)))-.5<0||r+.5>this.rect.height||(x(this._cacheItems,this.isDiscrete(),e.indecies,s)&&(l=new o(t-("right"===n?d:0),u[s]-e.fullWidths[s]/2-e.offsets[s],d,e.fullWidths[s]),q(this._cacheItems,e.indecies[s],this.selectionIdentifier,l)),p.push({type:"text",fill:f.label.color,opacity:h?h[s]:1,shape:{text:c[s],x:t,y:r-a/2,maxWidth:d,height:a,maxNumLines:1,font:f.label.font,align:n,baseline:"middle"}}));return p}function g(e){var t,n,i,o,s=e[0]?e[0].positions:[],a=e[0]?e[0].opacities:[],l=this._style,c=this.isDiscrete()?0:l.ticks.major.length,u=new r,h="far"===this.getAlignment()?"left":"right",d=[];if(i="left"===h?1:-1,c*=i,t=i>0?0:this.rect.width,n=0,t+=1*i/2,n+=this._padding.top,this._showLine_internal&&d.push({stroke:l.line.color,shape:{x1:t,x2:t,y1:n-1,y2:n+this._plotSize},type:"line"}),!this.isDiscrete()&&this._showLabels_internal){if(this._showLabels_internal)for(o=0;o<s.length;o++)s[o]>=0&&s[o]<=this.rect.height&&d.push({stroke:l.ticks.major.color,opacity:a[o],shape:{x1:t,x2:t+c,y1:s[o],y2:s[o]},type:"line"});t+=l.ticks.major.length*i}if(this._showLabels_internal){for(t+=l.label.margin*i,e.reverse(),o=0;o<e.length;o++)e[o].labelMode!==C&&(d=d.concat(m.apply(this,[e[o],t,h])),t+=e[o].labelSpace*i);e.reverse()}this._showTitle_internal&&((u=new r).translate((i>0?t:0)+(i>0?this.rect.width-t:t)/2,this._padding.top+this._plotSize/2),u.rotate(.5*Math.PI*("right"===h?-1:1)),d.push({type:"text",fill:l.title.color,transform:u.elements,shape:{text:this._title||"",maxWidth:this._plotSize,font:l.title.font,align:"center",baseline:"middle"}})),this._renderer.shapes=d,this._renderer.render()}function v(e,t,n,i,r){if(t)for(var o=0;o<t.positions.length;o++)t.positions[o]>=0&&t.positions[o]<=this.rect.width&&e.push({stroke:r,opacity:t.opacities[o],shape:{x1:t.positions[o],x2:t.positions[o],y1:n,y2:n+i},type:"line"})}function y(e,t){var n=this._padding.left||0;e.push({stroke:this._style.line.color,shape:{x1:n-1,x2:n+this._plotSize,y1:t,y2:t},type:"line"})}function b(e,t){var n,i,r,o,s,a=!!e[0]&&e[0].labelsBetweenTicks,l=this._style.ticks.major.length,c="far"===this.getAlignment()?1:-1,u=[];if(l*=c,n=this._padding.left||0,i="near"===this.getAlignment()?this.rect.height-1:this.isDiscrete()&&this.isHorizontal()?-1:0,i+=_/2*c,y.call(this,u,i),this.isDiscrete()||(i+=_*c/2,a||(v.call(this,u,e[0],i,l,this._style.ticks.major.color),i+=l)),this._showLabels_internal)for(v.call(this,u,t,i,3,this._style.ticks.major.color),i+=this._style.label.margin*c,r=0;r<e.length;r++)e[r].labelMode!==C&&(a&&(l=e[0].labelSpace*c*(r+(e[r].outOfSyncWithLevelBelow?0:1)),o=i-this._style.label.margin*c-(e[r].outOfSyncWithLevelBelow?0:e[0].labelSpace*c*r),s=e.length>1&&r<e.length-1?this._style.ticks.minor.color:this._style.ticks.major.color,v.call(this,u,e[r],o,l,s)),u=e[r].labelMode===w?u.concat(h.apply(this,[e[r],i,e[r].radians,c])):u.concat(p.apply(this,[e[r],i,c])),e[r].labelSpace&&(i+=e[r].labelSpace*c));this._showTitle_internal&&u.push({type:"text",fill:this._style.title.color,shape:{x:n,y:c>0?i:0,width:this._plotSize,height:c>0?this.rect.height-i:i,text:this._title||"",font:this._style.title.font,align:"center",baseline:"middle"}}),this._renderer.shapes=u,this._renderer.render()}function x(e,t,n,i){return t&&e&&n&&e[n[i][0]]}function q(e,t,n,i){Array.isArray(t)?t.forEach(function(t){e[t].addShape(n,i)}):e[t].addShape(n,i)}var C=0,S=1,w=3,_=1;return t.extend("Axis",{init:function(t,n,r){this._super.apply(this,[t,e.extend(!0,{},{components:{title:{show:!0,showFlag:n.showFlag},labels:{show:!1,showFlag:n.showFlag}}},n),r]),this._fontHeight=20,this._titleShowFlag=n.titleShowFlag||null,this._showLabels=!0,this._showLabels_internal=!0,this._showLine=!0,this._showLine_internal=!0,this._showTitle=!1,this._dataIndex=0,this._radial=!1,this._relevantAngle=0,this._labelPadding=4,this._cacheItems=null,c.THEMING?this._styleService=l.initializeService("object."+n.parentType):this._styleService=a.getInstance(),this._style=this._getStyleObject(this._styleService),this._padding={top:0,bottom:0,left:0,right:0},this._renderer=new i(this.container),this._$renderAreaWrap&&this._$renderAreaWrap.addClass("qv-chart-component-axis"),this.innerRect=new o(0,0,0,0),this.renderers={axis:this._renderer},this.isDimension=n.isDimension},getLevels:function(){return[]},setSelectableShapes:function(e){this._cacheItems=e},setSelectedRanges:function(){},calculateValuePositionMappingInfo:function(){},_calculatePlotSize:function(e){var t,n,i=0;this.isRadial()?(n=.4*(t=Math.min(e.height,e.width)),this._relevantAngle=Math.abs(this._radialOptions.end-this._radialOptions.start),i=Math.tan(-this._relevantAngle/4+Math.PI/2)*t*.02,this._radius=n+i,this._centerPoint={x:e.width/2,y:e.height/2+4*i}):t=this.isVertical()?e.height-this._padding.top-this._padding.bottom:e.width-this._padding.left-this._padding.right,this._plotSize,this._plotSize=t},_calculateEdgeBleedAndPlotSize:function(e){this._edgeBleed={top:(this.isVertical(),1),bottom:this.isVertical()?1:0,left:this.isVertical()?1:Math.max(e.x,1),right:this.isVertical()?0:Math.max(0,this.outerRect.width-e.width-e.x)},this._calculatePlotSize(e)},preRelevantSizeCalculation:function(){this._isSizing=!0,this.updateNow(["properties"]),this._isVertical=this.isVertical(),this._style=this._getStyleObject(this._styleService,this._layoutMode,this.isDiscrete()),this._fontHeight=Math.ceil(this._renderer.getFontHeight(this._style.label.font));var e=this._isVertical;this._showTitle_internal=t.prototype.isVisible.call({show:this._showTitle&&!!this._title,_verticalLayoutMode:this._verticalLayoutMode,_horizontalLayoutMode:this._horizontalLayoutMode,isVertical:function(){return e},showFlag:null!==this._titleShowFlag?this._titleShowFlag:this.showFlag<<1},this._layoutMode),this._showTitle_internal&&(this._titleFontHeight=this._renderer.getFontHeight(this._style.title.font),this.relevantSize+=this._titleFontHeight*this._style.title.lineHeight)},calculatePreliminaryRelevantSize:function(e,t){var n,i=0,r=0,o=e[this.isVertical()?"height":"width"];this._isSizing=!0,this.relevantSize=0,this.preliminaryRelevantSize=0,this._preliminaryStatics=0,o<=0||(i=(n=this.calculatePreliminaryLabelSpace(e,t)).relevantLabelSize||0,r=n.relevantSpacing||0,this.isDiscrete()?this._preliminaryStatics+=_:this._preliminaryStatics+=this._style.ticks.major.length,i&&(this.preliminaryRelevantSize+=i,this.preliminaryRelevantSize+=this._style.label.margin),this._showTitle_internal&&(this._preliminaryStatics+=this._titleFontHeight*this._style.title.lineHeight),this.preliminaryRelevantSize+=this._preliminaryStatics,this.preliminaryRelevantSize=Math.ceil(this.preliminaryRelevantSize),this.perpendicularlyRelevantSpacing={top:0,left:this.yMirrorMode&&"near"===this.getAlignment()||!this.yMirrorMode&&"far"===this.getAlignment()?r:0,right:this.yMirrorMode&&"far"===this.getAlignment()||!this.yMirrorMode&&"near"===this.getAlignment()?r:0,bottom:0},this.relevantSize=this.preliminaryRelevantSize)},calculateRelevantSize:function(e,t,n){this._isSizing=!0,this._isVertical=this.isVertical(),this.relevantSize=0;var i=n||e,r=0,o=0;if(this.rect.set(i.x,i.y,i.width,i.height),this._calculationSize=i[this.isVertical()?"height":"width"],this.isVertical()?this._calculationSize-=this._padding.top+this._padding.bottom:this._calculationSize-=this._padding.left+this._padding.right,this._plotSize=this._calculationSize,0!==i.width){var s=this.calculateLabelSpace(e,t,n);return r=s.relevantLabelSize||0,o=s.relevantSpacing||0,r&&(this.relevantSize+=r,this.relevantSize+=this._style.label.margin),this.relevantSize+=this._preliminaryStatics,this.relevantSize=Math.ceil(this.relevantSize),this.perpendicularlyRelevantSpacing={top:0,left:this.yMirrorMode&&"near"===this.getAlignment()||!this.yMirrorMode&&"far"===this.getAlignment()?o:0,right:this.yMirrorMode&&"far"===this.getAlignment()||!this.yMirrorMode&&"near"===this.getAlignment()?o:0,bottom:0},this._isSizing=!1,this}},insertAdjacentTo:function(e,t){if(this._super(e,t),!this.isDiscrete())switch(this.dock){case"top":this.rect.y+=1;break;case"bottom":this.rect.y-=1}},_getStyleObject:function(e,t,n){var i=e.layoutMap[t]||"medium",r=n?".discrete":"";return c.THEMING?{backgroundColor:e.getStyle("","backgroundColor"),label:{lineHeight:1.4,color:e.getStyle("axis.label.name","color"),margin:4,offset:1,font:"normal "+e.scaleFontSize(e.getStyle("axis.label.name","fontSize"),t,r)+" 'QlikView Sans'"},ticks:{major:{color:e.getStyle("axis.line.major","color"),length:8},minor:{color:e.getStyle("axis.line.minor","color"),length:8}},line:{color:e.getStyle("axis.line.major","color")},title:{lineHeight:1.4,font:"normal "+e.scaleFontSize(e.getStyle("axis.title","fontSize"),"full"===i?t:"medium",r)+" 'QlikView Sans'",color:e.getStyle("axis.title","color")}}:{backgroundColor:e.getValue("",null,"backgroundColor"),label:{lineHeight:1.4,color:e.getValue("","axis.label","color"),margin:e.getValue("","axis.label","margin"),offset:1,font:e.getFont("","axis.label"+r,i)},ticks:{major:{color:e.getValue("","axis.tick.major","color"),length:e.getValue("","axis.tick.major","length")},minor:{color:e.getValue("","axis.tick.minor","color"),length:e.getValue("","axis.tick.minor","length")}},line:{color:e.getValue("","axis.line","color")},title:{lineHeight:1.4,font:e.getFont("","axis.title",i),color:e.getValue("","axis.title","color")}}},isVisible:function(){return this._super.apply(this,[].slice.call(arguments))&&this._showSubcomponents},setShowLabels:function(e){this._showLabels_internal=e,this._showLabels=e},getShowLabels:function(){return this._showLabels},getSpacingMode:function(){},setShowLine:function(e){this._showLine_internal=e,this._showLine=e},getShowLine:function(){return this._showLine},setShowStrategy:function(e){this._showSubcomponents="none"!==e,this._showTitle=["all","title"].contains(e),this._showTitle_internal=this._showTitle,this.components.title.show=this._showSubcomponents&&["all","title"].contains(e),this._showLabels=["all","labels"].contains(e),this._showLabels_internal=this._showLabels,this.components.labels.show=this._showSubcomponents&&["all","labels"].contains(e)},getShowStrategy:function(){return this._showSubcomponents},setTitle:function(e){this._title=e},setLabelMode:function(e){this._explicitLabelMode=e},setLabels:function(e){this._explicitLabels=e},setCurrentDataIndices:function(e){this._currentDataIndices=Array.isArray(e)?e:[e]},setDataIndices:function(e){this._dataIndices=Array.isArray(e)?e:[e]},setDataRange:function(){},setOffset:function(){},setInnerOffset:function(){},getInnerOffset:function(){},getNumDiscreteUnits:function(){},setNumDiscreteUnits:function(){},getNumDiscreteUnitsInView:function(){},setMaxDiscreteUnitSize:function(){},setMinDiscreteUnitSize:function(){},setUnitAlignment:function(){},_updateProperties:function(){var e=this.getType().indices;return this._formatter=1===e.length&&this.measureFormatters.length?this.measureFormatters[e[0]]:this.combinedMeasuresFormatter||this._defaultFormatter,this.container.setAttribute("data-type",this.isDiscrete()?"discrete":"continuous"),this},updateSize:function(){this._super(),this._calculateEdgeBleedAndPlotSize(this.rect),this._renderer.edgeBleed=this._edgeBleed,this.innerRect=new o(this.rect.x+this._padding.left,this.rect.y+this._padding.top,this.rect.width-this._padding.left-this._padding.right,this.rect.height-this._padding.top-this._padding.bottom),this._isVertical=this.isVertical()},paint:function(){return u.apply(this,[]),this.fire("rendered"),this},isDiscrete:function(){return!1},getPositionOfValue:function(){},getAngleOfValue:function(){},getValueOfPosition:function(){},getType:function(){return{type:this.isDimension||this.isDiscrete()?"dimension":"measure",indices:this._dataIndices||[0],current:this._currentDataIndices||[0]}},setPadding:function(e,t,n,i){this._padding={top:e>0?e:0,right:t>0?t:0,bottom:n>0?n:0,left:i>0?i:0}},getPadding:function(){return this._padding},isVertical:function(){switch(this.options.dock){case"left":case"right":return!0;case"center":return"vertical"===this._orientation;default:return!1}},setOrientation:function(e){this._orientation=e},setAlignment:function(e){this._align=e},getAlignment:function(){switch(this.options.dock){case"left":case"top":return"near";case"center":return this._align;default:return"far"}},setRadial:function(e,t){this._radial=e,this._radialOptions=t},isRadial:function(){return this._radial}})}),define("objects.views/charts/components/axis/discrete-axis",["./axis","general.utils/shapes/rect"],function(e,t){"use strict";function n(e){var t=this._cacheItems;return t&&e&&e.some(function(e){return t[e]&&t[e].selected})?1:this._globalAlpha}function i(e,t,i){var r,o,s=this.isHorizontal(),a=[],l=[],c=[],u=[],h=[],d=[],p=[];for(r=0;r<e.length;r+=1)if(!((o={center:this.getPositionOfValue(r,t),width:this.getWidthOfValue(r,t)}).width>=2*this._discreteSpacing&&(o.center-this._discreteSpacing+o.width/2<0||o.center+this._discreteSpacing-o.width/2>i)||o.width<2*this._discreteSpacing&&(o.center<0||o.center>i))){if(u.push(o.width),s&&o.center+o.width/2>i?a.push(Math.min(i,i-(o.center-o.width/2))):s&&o.center-o.width/2<0?a.push(Math.min(i,o.width/2+o.center)):a.push(Math.min(i,o.width)),o.width>this._discreteSpacing){var f=Math.max(1,Math.min(o.center,i-1));l.push(f),c.push(f-o.center)}else l.push(o.center),c.push(0);h.push(e[r].label),d.push(e[r].cacheIndex?e[r].cacheIndex:0),p.push(n.apply(this,[e[r].cacheIndex]))}return{labels:h,widths:a,positions:l,indecies:d,opacities:p,offsets:c,fullWidths:u}}function r(e){var t=e.match(/[\u4E00-\u9FFF]/g);return t=t?t.length:0,{latin:e.length-t,cjk:t}}function o(e,t,n,i,s,a){if(!e||!e.length)return[];var l,c,u,h,d,p,f=[];for(l=0;l<e.length;l++)u={},h="",d=null,"object"==typeof(c=e[l])?(h=c.label,d=c.children?o(c.children,t,n+1,u,s,a):null,u.cacheIndex="cacheIndex"in e[l]?e[l].cacheIndex:[],u.group=!0===c.group,c.id&&(a[c.id]=u)):h=c,u.label=h||"",u.parent=i,p=r(u.label),d&&d.length&&(u.children=d),f.push(u),t[n]||(t[n]={data:[]},t[n].show=!(s&&s[n]&&!1===s[n].show||t[n].silo),t[n].qApprMaxGlyphCount=s&&s[n]&&s[n].qApprMaxGlyphCount||10,t[n].characterRatios={latin:0,cjk:0},t[n].groupSize=s&&s[n]?s[n].groupSize:void 0),t[n].data.push(u),t[n].characterRatios.latin+=p.latin,t[n].characterRatios.cjk+=p.cjk;return f}function s(e){for(var t=e.parent,n=[];t;)t.collapseChildren||n.push(t),t=t.parent;return n}function a(e,t){var n,i,r,o,a,l,c,u,h=e[e.length-1].data;for(h[0].distanceFrom=t/2,h[0].distanceTo=h[0].distanceFrom+1,c=(n=s(h[0])).filter(function(e){return e.group})[0],o=1;o<h.length;o++){if(l=h[o-1].distanceTo,i=s(h[o]),(u=i.filter(function(e){return e.group})[0])!==c){for(a=0;a<i.length&&(i[a]!==n[a]||!(i[a]<0||i[a].group));a++);l+=t*a,c=u,n=i}h[o].distanceFrom=l,h[o].distanceTo=h[o].distanceFrom+1}if(e.length>1)for(o=e.length-2;o>=0;o--)for(r=e[o].data,a=0;a<r.length;a++)r[a].distanceFrom=r[a].children[0].distanceFrom,r[a].distanceTo=r[a].children[r[a].children.length-1].distanceTo}function l(e,t,n,i){var r=t.getTextWidth("",n),o=e<=24?t.getTextWidth("m",n):t.getAverageLetterWidth(n);return i?e*(r*i.cjk+o*i.latin):e*o}return e.extend("DiscreteAxis",{init:function(){this._super.apply(this,[].slice.call(arguments)),this._unitsOffset=0,this._innerOffset=0,this._shrinkToFitThreshold=arguments[1]&&null!==arguments[1].shrinkToFitThreshold?arguments[1].shrinkToFitThreshold:.85,this._maxDiscreteUnitSize=null,this._minDiscreteUnitSize=null,this._alignmentOffset=0,this._unitAlignment="center",this._angle1=-40,this._angle2=-90},setYMirrorMode:function(e){this._super(e),e?(this._angle1=40,this._angle2=90):(this._angle1=-40,this._angle2=-90)},updateSize:function(){this._super(),1===this._numDiscrete?this._discreteSpacing=Math.min(this._discreteSpacing,this._plotSize/this._numDiscrete):this._discreteSpacing-=(this._preliminarySize-this._plotSize)/(this._numUnitsInView||1),this._alignmentOffset=this._getAlignmentOffset(this._unitAlignment,this._plotSize),this.extendedRect=new t(this.rect.x-this._edgeBleed.left,this.rect.y-this._edgeBleed.top,this.rect.width+this._edgeBleed.left+this._edgeBleed.right,this.rect.height+this._edgeBleed.top+this._edgeBleed.bottom)},updateLevels:function(){var e=this._oldLevels;this._levels.forEach(function(t,n){t.labelSpace=e[n].labelSpace,t.labelMode=e[n].labelMode,t.radians=e[n].radians,t.show=e[n].show})},setLabelLevelVisibility:function(e){this._labelLevelVisibility=e,this._levels&&this._levels.forEach(function(t,n){t.show=!1!==e[n]})},_getPerpendicularExtensionForTiltedLabels:function(e,t,n,i){var r,o=this._angle1*Math.PI/180,s=Math.abs(Math.sin(o))*e.longestLabelWidth,a=0;return s=Math.min(i,s),r=Math.abs(Math.cos(o))*s,r=Math.max(r-this._discreteSpacing/2,0),"bottom"===this.dock?(r=Math.max(r-this._alignmentOffset,0))>t.x&&(a=r-t.x):"top"===this.dock&&(r=Math.max(r-("center"===this._unitAlignment?this._alignmentOffset:this._getAlignmentOffset("far"===this._unitAlignment?"near":"far")),0))>n.width-t.x-t.width&&(a=r-(n.width-n.x-t.x-t.width)),a},_getLabelMode:function(e,t,n){var i,r=e.qApprMaxGlyphCount;return this._showLabels&&"none"!==this._explicitLabelMode?this._explicitLabelMode&&"auto"!==this._explicitLabelMode?"none"===this._explicitLabelMode?0:"tilted"===this._explicitLabelMode?3:1:t&&this.isHorizontal()&&e.data&&e.data.length&&(i=l(r,this._renderer,this._style.label.font,e.characterRatios),e.groupSize&&(n*=e.groupSize),n<i)?3:1:0},preRelevantSizeCalculation:function(){this._super();var e,t=this._levels?this._levels.filter(function(e){return!1!==e.show}):[],n=t.length,i=this.outerRect[this.isVertical()?"width":"height"]/4,r=0,o=0;if(this.isVisible()){for(e=0;e<n;e++)t[e].longestLabelWidth=l(t[e].qApprMaxGlyphCount,this._renderer,this._style.label.font,t[e].characterRatios),r+=t[e].longestLabelWidth;for(e=0;e<n;e++)t[e].labelSizeRatio=Math.min(1/n,t[e].longestLabelWidth/Math.min(r,i)),o+=t[e].labelSizeRatio;o<1&&n>1?t[0].labelSizeRatio===1/n?t[0].labelSizeRatio+=1-o:t[1].labelSizeRatio===1/n&&(t[1].labelSizeRatio+=1-o):1===n&&(t[0].labelSizeRatio=1)}},calculatePreliminaryLabelSpace:function(e,t){var n,i=this._hideMyLabels,r=this._levels?this._levels.filter(function(e){return!1!==e.show&&!i}):[],o=r.length,s=this.outerRect[this._isVertical?"width":"height"]/4,a=this._fontHeight*this._style.label.lineHeight,l=0,c=0,u=0;if(this._preliminarySize=e[this._isVertical?"height":"width"],this._calculateDiscreteUnits(this._preliminarySize),this.isVisible())for(n=0;n<o;n++){r[n].labelMode=this._getLabelMode(r[n],n===r.length-1,this._discreteSpacing);switch(r[n].labelMode){case 1:var h=Math.min(r[n].labelSizeRatio*s,r[n].longestLabelWidth);r[n].labelSpace=this.isHorizontal()?a:Math.min(r[n].labelSizeRatio*s,r[n].longestLabelWidth),c=Math.max(0,h-r[n].labelSpace);break;case 3:r[n].radians=this._angle1*Math.PI/180,this._getPerpendicularExtensionForTiltedLabels(r[n],e,t,s*r[n].labelSizeRatio)>e.width/5&&(r[n].radians=this._angle2*Math.PI/180),r[n].labelSpace=Math.abs(Math.sin(r[n].radians))*r[n].longestLabelWidth+Math.abs(this._fontHeight*Math.sin(r[n].radians)*2),r[n].labelSpace=Math.min(c+r[n].labelSizeRatio*s+Math.abs(this._fontHeight*Math.sin(r[n].radians)/2),r[n].labelSpace);break;default:r[n].labelSpace=0}3===r[n].labelMode&&(l=Math.max(l,Math.min(e.width/3,Math.ceil(Math.cos(r[n].radians)*r[n].labelSpace))),l=Math.max(l-this._discreteSpacing/2,0),"bottom"===this.dock?l=Math.max(l-this._alignmentOffset,0):"top"===this.dock&&(l=Math.max(l-("center"===this._unitAlignment?this._alignmentOffset:this._getAlignmentOffset("far"===this._unitAlignment?"near":"far")),0)),l=Math.ceil(l)),u+=r[n].labelSpace}return l>0&&("bottom"===this.dock&&l>e.x?this._preliminarySize=this._preliminarySize-(l-e.x):"top"===this.dock&&l>t.width-e.x-e.width&&(this._preliminarySize=this._preliminarySize-(l-(t.width-t.x-e.x-e.width))),this._calculateDiscreteUnits(this._preliminarySize)),this.fire("numDiscreteUnitsChanged"),this.fire("numDiscreteUnitsInViewChanged"),this._showLabels_internal=this._showLabels&&r&&r.some(function(e){return 0!==e.labelMode}),this._preliminaryRelevantSize={relevantLabelSize:u,relevantSpacing:l},this._preliminaryRelevantSize},calculateLabelSpace:function(){return this.updateNow(["properties"]),this._preliminaryRelevantSize},setDataRange:function(e,t){var n,i,r,s;if(this._levels&&this._levels.length&&(this._oldLevels=this._levels.map(function(e){return{labelMode:e.labelMode,labelSpace:e.labelSpace,radians:e.radians,show:e.show,groupSize:e.groupSize}})),this._levels=[],this._labelIds={},o(e,this._levels,0,-1,t,this._labelIds),r=this._levels.length>1?1:0,this._levels&&this._levels.length){a(this._levels,r);for(var l=0;l<this._levels.length;l++)this._levels[l].characterRatios&&(s=this._levels[l].characterRatios.latin+this._levels[l].characterRatios.cjk||1,this._levels[l].characterRatios.latin=this._levels[l].characterRatios.latin/s,this._levels[l].characterRatios.cjk=this._levels[l].characterRatios.cjk/s);i=(n=this._levels[this._levels.length-1].data)[n.length-1].distanceTo+r/2,this._numDiscrete=n.length,this._numDiscrete=i||0,this._explicitNumDiscrete&&(this._numDiscrete=this._explicitNumDiscrete,this._numDiscrete=this._explicitNumDiscrete)}return this},setOffset:function(e){if(this._unitsOffset!==e)return this._unitsOffset=e,this.invalidateProperties(),this.invalidateDisplay("setOffset"),this.fire("changed"),this},getOffset:function(){return this._unitsOffset},setInnerOffset:function(e){this._innerOffset=e},getInnerOffset:function(){return this._innerOffset||0},getNumDiscreteUnits:function(){return this._numDiscrete},setNumDiscreteUnits:function(e){this._explicitNumDiscrete=e},getNumDiscreteUnitsInView:function(){return this._numUnitsInView},setMaxDiscreteUnitSize:function(e){this._maxDiscreteUnitSize=e},setMinDiscreteUnitSize:function(e){this._minDiscreteUnitSize=e},setUnitAlignment:function(e){this._unitAlignment=e},isDiscrete:function(){return!0},setLockedInfo:function(e){this._lockedInfo=e},getLevels:function(){var e,t,n=[];if(this._levels&&this._levels.length)for(t=0;t<this._levels.length;t++)this._levels[t].show&&((e=i.call(this,this._levels[t].data,t,this._plotSize)).labelMode=this._levels[t].labelMode,e.labelSpace=this._levels[t].labelSpace,e.radians=this._levels[t].radians,n.push(e));return n},calculateValuePositionMappingInfo:function(){this._calculateDiscreteUnits(this._plotSize)},getDiscreteSpacing:function(){return this._discreteSpacing},getPositionOfValue:function(e,t){var n,i,r=this._levels.length-1;void 0!==t&&(r=Math.min(this._levels.length-1,Math.max(0,t)));var o=((i=(n=this._levels[r].data)[e]).distanceFrom+.5*(i.distanceTo-i.distanceFrom)+this._innerOffset-this._unitsOffset)*this._discreteSpacing+this._alignmentOffset;return!this._isVertical&&this.yMirrorMode?this._plotSize-o:o},getWidthOfValue:function(e,t){var n,i=this._levels.length-1;return void 0!==t&&(i=Math.min(this._levels.length-1,Math.max(0,t))),((n=this._levels[i].data)[e].distanceTo-n[e].distanceFrom)*this._discreteSpacing},getPositionOfId:function(e){var t=this._labelIds[e]||this._labelIds[e.split(";").reverse().slice(-1).reverse().join(";")];if(!t)return 0;var n=(t.distanceFrom+.5*(t.distanceTo-t.distanceFrom)+this._innerOffset-this._unitsOffset)*this._discreteSpacing+this._alignmentOffset;return!this._isVertical&&this.yMirrorMode?this._plotSize-n:n},getWidthOfId:function(e){var t=this._labelIds[e]||this._labelIds[e.split(";").reverse().slice(-1).reverse().join(";")];return t?(t.distanceTo-t.distanceFrom)*this._discreteSpacing:0},getValueOfPosition:function(e){var t,n,i,r,o=this._levels[0].data,s=o.length;for(e=!this._isVertical&&this.yMirrorMode?this._plotSize-e:e,i=0;i<s;i+=1)if(r=o[i],t=(r.distanceFrom+this._innerOffset-this._unitsOffset)*this._discreteSpacing,n=t+(r.distanceTo-r.distanceFrom)*this._discreteSpacing,e>=t&&e<=n)return r.label;return""},_calculateDiscreteUnits:function(e){this._discreteSpacing=Math.max(null!==this._minDiscreteUnitSize?this._minDiscreteUnitSize:0,e/this._numDiscrete),null!==this._maxDiscreteUnitSize&&(this._discreteSpacing=Math.min(this._maxDiscreteUnitSize,this._discreteSpacing)),(1===this._numDiscrete||this._numDiscrete*this._discreteSpacing>e&&this._numDiscrete*this._discreteSpacing*this._shrinkToFitThreshold<e)&&(this._discreteSpacing=Math.min(this._discreteSpacing,e/this._numDiscrete)),this._alignmentOffset=this._getAlignmentOffset(this._unitAlignment,e),this._numUnitsInView=Math.min(this._numDiscrete,Number((e/this._discreteSpacing).toFixed(5)))},_getAlignmentOffset:function(e,t){var n=null!==this._maxDiscreteUnitSize&&this._discreteSpacing<t/this._numDiscrete?.5*(t-this._numDiscrete*this._discreteSpacing):0;return"near"===e?0:"far"===e?2*n:n}})}),define("objects.views/charts/utils/scale-utils",[],function(){"use strict";function e(){var e,t,n,i;e=0===this.explicitPlotMax?1:w.getMagnitude(this.explicitPlotMax),t=this.explicitPlotMax,n=this.maxNumIntervals<2?t-e:t-2*e,i=t-(n=Math.ceil(n/e)*e),this.tickDataSpacing=Math.max(i/this.maxNumIntervals,this.minTickDataSpacing),this.tickDataSpacingNN=Math.max(e/10,w.getNiceNumber(this.tickDataSpacing)),this.plotMax=t,this.plotMin=n,this.plotRange=i,this.maxNumIntervals<1&&(this.tickBaseValue=this.plotMin)}function t(){var e,t,n,i;e=0===this.explicitPlotMin?1:w.getMagnitude(this.explicitPlotMin),n=this.explicitPlotMin,t=this.maxNumIntervals<2?n+e:n+2*e,i=(t=Math.floor(t/e)*e)-n,this.tickDataSpacing=Math.max(i/this.maxNumIntervals,this.minTickDataSpacing),this.tickDataSpacingNN=Math.max(e/10,w.getNiceNumber(this.tickDataSpacing)),this.plotMax=t,this.plotMin=n,this.plotRange=i,this.maxNumIntervals<1&&(this.tickBaseValue=this.plotMax-this.tickDataSpacingNN)}function n(){null!==this.explicitPlotMax&&this.explicitPlotMax<this.usedDataMin?e.call(this):null!==this.explicitPlotMin&&this.explicitPlotMin>this.usedDataMax&&t.call(this)}function i(){this.plotMax=this.plotMin=this.tickBaseValue=this.usedDataMin,this.plotRange=0,this.tickDataSpacing=this.tickDataSpacingNN=0===this.usedDataMin?1:Math.abs(this.usedDataMin),this.tickMaxIndex=this.tickMinIndex=0}function r(){if(0===this.usedDataMax)this.maxNumIntervals<2?(this.plotMin=0,this.plotMax=1):(this.plotMin=-1,this.plotMax=1),this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacing=Math.max(this.plotRange/this.maxNumIntervals,this.minTickDataSpacing),this.tickDataSpacingNN=Math.max(.1,w.getNiceNumber(this.tickDataSpacing)),this.tickMinIndex=Math.ceil(this.plotMin/this.tickDataSpacingNN),this.tickMaxIndex=Math.floor(this.plotMax/this.tickDataSpacingNN);else{var e=a(Math.abs(this.usedDataMax),this.maxNumIntervals);this.usedDataMax>0?(this.plotMax=e.max,this.plotMin=e.min,this.tickBaseValue=e.tickBaseValue):(this.plotMax=-e.min,this.plotMin=-e.max,this.tickBaseValue=-e.tickBaseValue),this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacing=Math.max(this.plotRange/this.maxNumIntervals,this.minTickDataSpacing),this.tickDataSpacingNN=Math.max(e.magnitude/10,w.getNiceNumber(this.tickDataSpacing)),this.tickMinIndex=Math.floor((this.plotMin-this.tickBaseValue)/this.tickDataSpacingNN),this.tickMaxIndex=Math.floor((this.plotMax-this.tickBaseValue)/this.tickDataSpacingNN)}}function o(){0===this.explicitPlotMax?(this.plotMax=0,this.plotMin=-1,this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacingNN=Math.max(.1,w.getNiceNumber(this.plotRange/this.maxNumIntervals))):e.call(this)}function s(){0===this.explicitPlotMin?(this.plotMax=1,this.plotMin=0,this.plotRange=this.plotMax-this.plotMin,this.tickDataSpacingNN=Math.max(.1,w.getNiceNumber(this.plotRange/this.maxNumIntervals))):t.call(this)}function a(e,t){var n,i,r=w.getMagnitude(e),o=e/r,s=Math.floor(o),a=Math.round(o),l=0;return t<2?(n=s*r,i=(s+1)*r,t<1&&(l=n)):(n=(a-1)*r,i=(a+1)*r),{min:n,max:i,tickBaseValue:l,magnitude:r}}function l(){null!==this.explicitPlotMin&&null!==this.explicitPlotMax?i.call(this):null===this.explicitPlotMin&&null===this.explicitPlotMax?r.call(this):null===this.explicitPlotMin&&null!==this.explicitPlotMax?o.call(this):s.call(this)}function c(e,t,n){void 0===e&&(e=null!==this.explicitPlotMin),void 0===t&&(t=null!==this.explicitPlotMax),this.tickDataSpacingNN=n?w.getGoodNumber(this.tickDataSpacing):w.getNiceNumber(this.tickDataSpacing),x.apply(this,[e,t])}function u(){var e,t,n;if(c.call(this),e=this.tickMaxIndex-this.tickMinIndex,t=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=t/this.plotRange,(n=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit)&&this.maxNumIntervals>=5){for(;this.tickDataSpacing<=this.absMax&&n;)this.tickDataSpacing=Math.max(1.1*this.tickDataSpacingNN,this.minTickDataSpacing),c.call(this),t=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=t/this.plotRange,n=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit;if(!n)return}for(this.tickDataSpacing=Math.max(this.usedDataRange/this.maxNumIntervals,this.minTickDataSpacing),(n||e<=2&&this.maxNumIntervals>=2*e)&&c.apply(this,[void 0,void 0,!0]),t=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=t/this.plotRange,n=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit;this.tickDataSpacing<=this.absMax&&n;)this.tickDataSpacing=Math.max(1.1*this.tickDataSpacingNN,this.minTickDataSpacing),c.apply(this,[void 0,void 0,!0]),t=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=t/this.plotRange,n=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit}function h(e){e?(this.tickDataSpacingNN=w.getGoodNumber(this.absMax),this.tickBaseValue=-this.tickDataSpacingNN,this.plotMin=null===this.explicitPlotMin?-this.tickDataSpacingNN:this.explicitPlotMin,this.plotMax=null===this.explicitPlotMax?this.tickDataSpacingNN:this.explicitPlotMax,this.tickMinIndex=null===this.explicitPlotMin?0:1,this.tickMaxIndex=(this.explicitPlotMax,1),this.tickDataSpacingNN=2*this.tickDataSpacingNN):(this.plotMax=this.usedDataMax,this.plotMin=this.usedDataMin,this.plotRange=this.plotMax-this.plotMin,this.tickMinIndex=0,this.tickMaxIndex=0,this.tickDataSpacingNN=w.getNiceNumber(this.absMax),this.tickDataSpacingNN===this.absMax&&(this.tickDataSpacingNN=w.getNiceNumber(1.1*this.absMax)))}function d(){var e;this.tickDataSpacingNN=w.getNiceNumber(this.tickDataSpacing),this.plotMin=this.usedDataMin,this.plotMax=this.usedDataMax,this.plotRange=this.plotMax-this.plotMin,this.tickMinIndex=0,this.tickMaxIndex=0,(this.usedDataMax<0||this.usedDataMin>0)&&(e=w.getSmallNiceNumber(this.plotRange),this.tickBaseValue=Math.ceil(this.plotMin/e)*e)}function p(){var e,t,n,i,r;for(e=(n=this.usedDataMax>=-this.usedDataMin)||null!==this.explicitPlotMin,t=!n||null!==this.explicitPlotMax,c.apply(this,[e,t,!0]),r=(this.absMax+(1-this.spaceUseLimit)*this.absMin)/this.spaceUseLimit*1.0001;this.tickDataSpacing<=r&&this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel;)this.tickDataSpacing=Math.max(1.1*this.tickDataSpacingNN,this.minTickDataSpacing),c.apply(this,[e,t,!0]);i=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=i/this.plotRange,this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit&&h.call(this)}function f(){u.call(this);var e=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin);this.spaceUseFactor=e/this.plotRange,this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit&&(this.tickDataSpacing=Math.max(this.usedDataRange/this.maxNumIntervals,this.minTickDataSpacing),p.call(this))}function m(){var e,t,n,i,r,o,s,a,l,c=w.getNiceNumber(this.tickDataSpacingNN);this.tickDataSpacingNN!==c&&0===this.tickBaseValue&&(e=this.tickDataSpacingNN,i=this.tickMinIndex,o=(r=this.tickMaxIndex)-i,t=this.plotMin,n=this.plotMax,this.tickDataSpacingNN=c,x.apply(this,[null!==this.explicitPlotMin,null!==this.explicitPlotMax]),s=(this.plotMaxCanBeTuned?this.usedDataMax:this.plotMax)-(this.plotMinCanBeTuned?this.usedDataMin:this.plotMin),this.spaceUseFactor=s/this.plotRange,a=this.plotSize*this.tickDataSpacingNN/this.plotRange<this.minTickSpacingInPixel||this.spaceOptimizingEnabled&&this.spaceUseFactor<this.spaceUseLimit,l=this.tickMaxIndex-this.tickMinIndex,!a&&(l===o||l>=10||l>=3&&1.5*l>=o)||(this.tickDataSpacingNN=e,this.tickMinIndex=i,this.tickMaxIndex=r,this.plotMin=t,this.plotMax=n,this.plotRange=this.plotMax-this.plotMin))}function g(){this.niceNumberEnabled&&this.plotMax!==this.plotMin&&0!==this.plotSize?(this.minTickValue=this.tickBaseValue+this.tickMinIndex*this.tickDataSpacingNN,this.maxTickValue=this.tickBaseValue+this.tickMaxIndex*this.tickDataSpacingNN):(this.minTickValue=this.plotMin,this.maxTickValue=this.plotMax)}function v(){var e,t,n;if(this.mainTickValues=[],this.secondaryTickValues=[],g.call(this),0!==this.plotSize)if(this.niceNumberEnabled){if(e=this.tickBaseValue,!((n=this.tickMaxIndex-this.tickMinIndex)<1)){for(t=0;t<=n;t++)this.mainTickValues.push(e+(t+this.tickMinIndex)*this.tickDataSpacingNN);for(e=this.tickBaseValue+this.tickDataSpacingNN/2,t=0;t<n;t++)this.secondaryTickValues.push(e+(t+this.tickMinIndex)*this.tickDataSpacingNN)}}else{for(this.numIntervals=Math.floor(this.maxNumIntervals),this.tickDataSpacing=Math.max(this.usedDataRange/this.numIntervals,this.minTickDataSpacing),e=this.usedDataMin,t=0;t<=this.numIntervals;t++)this.mainTickValues.push(e+t*this.tickDataSpacing);for(e=this.usedDataMin+this.tickDataSpacing/2,t=0;t<this.numIntervals;t++)this.secondaryTickValues.push(e+t*this.tickDataSpacing)}}function y(){var e,t,n,i,r=[.5];for(e=this.mainTickValues[0],i=0;i<r.length;i++)if(t=e-this.tickDataSpacingNN*r[i],n=this.plotMax-t,this.plotSize*this.tickDataSpacingNN/n>3*this.fontHeight)return this.plotMin=t,this.plotRange=n,void this.mainTickValues.splice(0,0,t)}function b(){var e,t,n,i,r=[.5];for(e=this.mainTickValues[this.mainTickValues.length-1],i=0;i<r.length;i++)if(t=e+this.tickDataSpacingNN*r[i],n=t-this.plotMin,this.plotSize*this.tickDataSpacingNN/n>3*this.fontHeight)return this.plotMax=t,this.plotRange=n,void this.mainTickValues.push(t)}function x(e,t){this.tickMinIndex=e?Math.ceil(this.usedDataMin/this.tickDataSpacingNN):Math.floor(this.usedDataMin/this.tickDataSpacingNN),this.tickMaxIndex=t?Math.floor(this.usedDataMax/this.tickDataSpacingNN):Math.ceil(this.usedDataMax/this.tickDataSpacingNN),this.plotMin=e?this.usedDataMin:this.tickMinIndex*this.tickDataSpacingNN,this.plotMax=t?this.usedDataMax:this.tickMaxIndex*this.tickDataSpacingNN,this.plotRange=this.plotMax-this.plotMin}function q(){var e,t,n,i,r=this.plotMin,o=this.plotMax,s=this.tickMinIndex,a=this.tickMaxIndex,l=this.tickDataSpacingNN,c=this.tickMaxIndex-this.tickMinIndex,u=null!==this.explicitPlotMin,h=null!==this.explicitPlotMax,d=!0,p=2*this.fontHeight,f=c;if(n=this.mainTickValues?this.mainTickValues.length:0,e=this.mainTickValues[0],t=this.mainTickValues[n-1],null===this.explicitPlotMin&&e>this.dataMin&&f++,null===this.explicitPlotMax&&t<this.dataMax&&f++,f!==c){for(i=0;d&&i<10;)this.tickDataSpacingNN=w.getSmallNiceNumber(.99*this.tickDataSpacingNN),x.apply(this,[u,h]),this.tickMaxIndex-this.tickMinIndex>f&&(d=!1),i++;for(d=!0,i=0;this.tickDataSpacingNN<l&&d&&i<10;)this.tickDataSpacingNN=w.getGoodNumber(1.1*this.tickDataSpacingNN),x.apply(this,[u,h]),this.tickMaxIndex-this.tickMinIndex===f&&this.plotSize*this.tickDataSpacingNN/this.plotRange>p&&(d=!1),i++;d?(this.plotMin=r,this.plotMax=o,this.tickMinIndex=s,this.tickMaxIndex=a,this.tickDataSpacingNN=l):v.call(this)}}function C(){var e,t,n;n=this.mainTickValues?this.mainTickValues.length:0,e=this.mainTickValues[0],t=this.mainTickValues[n-1],null===this.explicitPlotMin&&e>this.dataMin&&null===this.explicitPlotMax&&t<this.dataMax?Math.abs(this.dataMin)<=Math.abs(this.dataMax)?(y.call(this),b.call(this)):(b.call(this),y.call(this)):null===this.explicitPlotMin&&e>this.dataMin?y.call(this):null===this.explicitPlotMax&&t<this.dataMax&&b.call(this)}function S(){return{plotMin:this.plotMin,plotMax:this.plotMax,tickSpacing:this.tickDataSpacingNN,tickBaseValue:this.tickBaseValue,tickMinIndex:this.tickMinIndex,tickMaxIndex:this.tickMaxIndex,minTickValue:this.minTickValue,maxTickValue:this.maxTickValue,mainTickValues:this.mainTickValues,secondaryTickValues:this.secondaryTickValues}}var w,_=Math.log(10);return w={log:function(e,t){return e<=0||t<=0?NaN:Math.log(e)/Math.log(t)},log10:function(e){return e<=0?NaN:Math.log(e)/_},eliminateFloatingError:function(e){var t=Math.round(e);return Math.abs(e-t)<1e-12&&(e=t),e},getNiceNumber:function(e){var t,n;return 0===e?0:(t=Math.floor(Math.log(Math.abs(e))/_),n=e/Math.pow(10,t),(n<=1?1:n<=2?2:n<=5?5:10)*Math.pow(10,t)*(e<0?-1:1))},getSmallNiceNumber:function(e){var t,n,i;return 0===e?0:(t=Math.floor(Math.log(Math.abs(e))/_),(n=e/Math.pow(10,t))<1?(i=5,t--):i=n<2?1:n<5?2:5,i*Math.pow(10,t)*(e<0?-1:1))},getMagnitude:function(e){var t;return 0===e?0:(t=Math.floor(Math.log(Math.abs(e))/_),Math.pow(10,t))},getFraction:function(e){var t;return 0===e?0:(t=Math.floor(Math.log(Math.abs(e))/_),e/Math.pow(10,t))},getGoodNumber:function(e){var t,n,i;return 0===e?0:(t=Math.floor(Math.log(Math.abs(e))/_),n=e/Math.pow(10,t),7!==(i=Math.ceil(n))&&9!==i||i++,n>1&&n<=1.5?i=1.5:n>2&&n<=2.5&&(i=2.5),i*Math.pow(10,t)*(e<0?-1:1))},calculateTicks:function(e,t,i,r,o,s,a,c,g,y,b,x){var w,_=!1;return void 0===b&&(b=!1),isNaN(r)&&(r=null),isNaN(o)&&(o=null),t>i&&(w=t,t=i,i=w),null!==r&&null!==o&&r>o&&(w=r,r=o,o=w),this.plotSize=e,this.dataMin=t,this.dataMax=i,this.explicitPlotMin=r,this.explicitPlotMax=o,this.minTickSpacingInPixel=s,this.usedDataMin=null===this.explicitPlotMin?this.dataMin:this.explicitPlotMin,this.usedDataMax=null===this.explicitPlotMax?this.dataMax:this.explicitPlotMax,this.absMax=Math.max(Math.abs(this.usedDataMax),Math.abs(this.usedDataMin)),this.absMin=Math.min(Math.abs(this.usedDataMax),Math.abs(this.usedDataMin)),this.usedDataRange=this.usedDataMax-this.usedDataMin,this.maxNumIntervals=this.plotSize/this.minTickSpacingInPixel,this.maxNumTicks=this.maxNumIntervals+1,this.minTickDataSpacing=x||0,this.tickDataSpacing=Math.max(this.usedDataRange/this.maxNumIntervals,this.minTickDataSpacing),this.fontHeight=a,this.niceNumberEnabled=c,this.tickBaseValue=0,this.spaceUseLimit=void 0===y?.6:y,this.spaceOptimizingEnabled=g,this.plotMaxCanBeTuned=null===this.explicitPlotMax&&this.usedDataMax>0,this.plotMinCanBeTuned=null===this.explicitPlotMin&&this.usedDataMin<0,c&&0!==e?(null!==this.explicitPlotMax&&this.explicitPlotMax<this.usedDataMin||null!==this.explicitPlotMin&&this.explicitPlotMin>this.usedDataMax?(_=!0,n.call(this)):0===this.usedDataRange?l.call(this):this.maxNumIntervals<1?d.call(this):(this.usedDataMax>0&&this.usedDataMin<0?1===this.maxNumIntervals?h.call(this,!0):this.maxNumIntervals>=5?u.call(this):this.maxNumIntervals<2?p.call(this):f.call(this):u.call(this),this.tickMaxIndex<this.tickMinIndex?(this.tickDataSpacing=Math.max(this.usedDataRange/this.maxNumIntervals,this.minTickDataSpacing),d.call(this)):m.call(this)),v.call(this),b&&this.maxNumIntervals>=1&&!_&&(q.call(this),C.call(this)),S.call(this)):(this.plotMin=this.usedDataMin,this.plotMax=this.usedDataMax,this.tickDataSpacingNN=this.tickDataSpacing,v.call(this),S.call(this))}}}),define("objects.views/charts/components/axis/linear-scale",["core.utils/class","../../utils/scale-utils"],function(e,t){"use strict";return e.extend("LinearScale",{init:function(){this.plotMin=null,this.plotMax=null,this.plotRange=null,this.tickMin=this.plotMin,this.tickMax=this.plotMax,this.mainValues=[],this.secondaryValues=[],this._plotSize=0,this._calculationSize=0},setSize:function(e){this._plotSize=e},getPositionOfValue:function(e){return(e-this.plotMin)/this.plotRange*this._plotSize},getValueOfPosition:function(e){return this.plotMin+this.plotRange*e/this._plotSize},getNormalizedValue:function(e){return(e-this.plotMin)/this.plotRange},calculateLimits:function(){this._usedDataMin=isNaN(this._realDataMin)?this._dataMin:this._realDataMin,this._usedDataMax=isNaN(this._realDataMax)?this._dataMax:this._realDataMax,this.plotMin=null===this._explicitPlotMin||isNaN(this._explicitPlotMin)?this._usedDataMin:this._explicitPlotMin,this.plotMax=null===this._explicitPlotMax||isNaN(this._explicitPlotMax)?this._usedDataMax:this._explicitPlotMax,this.plotRange=this.plotMax-this.plotMin},calculateTicks:function(){var e,n,i,r,o;i=isNaN(this._realDataMin)?this._dataMin:this._realDataMin,n=isNaN(this._realDataMax)?this._dataMax:this._realDataMax,e=t.calculateTicks(this._calculationSize,i,n,this._explicitPlotMin,this._explicitPlotMax,this._minTickSpacingInPixel,this._fontHeight,this._niceNumberEnabled,this._whiteSpaceOptimizingEnabled,.6,this._showExplicitMinMax,this._minTickDataSpacing),this._tickSpacing=e.tickSpacing,this.plotMin=e.plotMin,this.plotMax=e.plotMax,this.plotRange=this.plotMax-this.plotMin,this.tickMin=e.tickMinValue,this.tickMax=e.tickMaxValue,this.mainValues=e.mainTickValues,this.secondaryValues=e.secondaryTickValues,0===this.mainValues.length&&this.mainValues.push(e.minTickValue),0===this._tickSpacing&&(this._tickSpacing=1),this._showExplicitMinMax&&(o=this.mainValues[0],this.mainValues[0]=e.plotMin,o-e.plotMin>=e.tickSpacing/2&&this.mainValues.splice(1,0,o),r=e.mainTickValues[e.mainTickValues.length-1],e.plotMax-r<=e.tickSpacing/2?this.mainValues[e.mainTickValues.length-1]=e.plotMax:this.mainValues.push(e.plotMax))},getValues:function(){return{mainValues:this.mainValues,secondaryValues:this.secondaryValues}}})}),define("objects.views/charts/utils/scale-log-utils",["objects.views/charts/utils/scale-utils"],function(e){"use strict";function t(e,t,n){var i,r=e?e.length:0,o=void 0===t?Number.MAX_VALUE:e[0]/t;for(i=1;i<r;i++)o=Math.min(o,e[i]/e[i-1]);void 0!==n&&(o=Math.min(o,n/e[r-1])),e.splice(0,0,o)}function n(e,n,i){var r,o=e?e.length:0;for(r=0;r<o;r++)t(e[r],n,i)}function i(){var e,t,n,i,r,o=!0,s=0;for(e=this.tickDataSpacingLog,0;o&&s<5;)e=0===s?Math.ceil(this.tickDataSpacingLog):Math.ceil(1.01*e),t=this.minIsStrict?Math.ceil(this.usedDataMinLog/e):Math.floor(this.usedDataMinLog/e),n=this.maxIsStrict?Math.floor(this.usedDataMaxLog/e):Math.ceil(this.usedDataMaxLog/e),i=this.minIsStrict?this.explicitPlotMinLog:t*e,o=e/((r=this.maxIsStrict?this.explicitPlotMaxLog:n*e)-i)*this.plotSize<this.minTickSpacingInPixel,s++;return o&&(e=Math.ceil(this.tickDataSpacingLog),t=this.minIsStrict?Math.ceil(this.usedDataMinLog/e):Math.floor(this.usedDataMinLog/e),n=this.maxIsStrict?Math.floor(this.usedDataMaxLog/e):Math.ceil(this.usedDataMaxLog/e),i=this.minIsStrict?this.explicitPlotMinLog:t*e,r=this.maxIsStrict?this.explicitPlotMaxLog:n*e),{plotMinLog:i,plotMaxLog:r,tickMinIndex:t,tickMaxIndex:n,tickDataSpacingNNLog:e,tickBaseValueLog:0,success:!o}}function r(){var e,t,n,i,r,o,s=!0,a=0;for(e=this.tickDataSpacingLog,t=0,o=this.usedDataMinLogFloor;s&&a<5;)e=0===a?Math.ceil(this.tickDataSpacingLog):Math.ceil(1.01*e),t=this.minIsStrict?Math.ceil((this.usedDataMinLog-o)/e):Math.floor((this.usedDataMinLog-o)/e),n=this.maxIsStrict?Math.floor((this.usedDataMaxLog-o)/e):Math.ceil((this.usedDataMaxLog-o)/e),i=this.minIsStrict?this.explicitPlotMinLog:t*e+o,s=e/((r=this.maxIsStrict?this.explicitPlotMaxLog:n*e+o)-i)*this.plotSize<this.minTickSpacingInPixel,a++;return s&&(e=0===a?Math.ceil(this.tickDataSpacingLog):Math.ceil(1.01*e),t=this.minIsStrict?Math.ceil((this.usedDataMinLog-o)/e):Math.floor((this.usedDataMinLog-o)/e),n=this.maxIsStrict?Math.floor((this.usedDataMaxLog-o)/e):Math.ceil((this.usedDataMaxLog-o)/e),i=this.minIsStrict?this.explicitPlotMinLog:t*e+o,r=this.maxIsStrict?this.explicitPlotMaxLog:n*e+o),{plotMinLog:i,plotMaxLog:r,tickMinIndex:t,tickMaxIndex:n,tickDataSpacingNNLog:e,tickBaseValueLog:o,success:!s}}function o(){var e,t,n,o,s,a,l;return(t=r.call(this)).success?(n=this.usedDataMaxLog-this.usedDataMinLog,1==(s=n/(t.plotMaxLog-t.plotMinLog))?t:(e=i.call(this)).success?(o=n/(e.plotMaxLog-e.plotMinLog),a=e.tickMaxIndex-e.tickMinIndex,(l=t.tickMaxIndex-t.tickMinIndex)>a||l===a&&s>o||l===a&&s===o&&t.plotMinLog<e.plotMinLog?t:e):t):e=i.call(this)}function s(t,n,i,r,o){var s=e.getNiceNumber(1.1*o),a=t?Math.ceil(i/s):Math.floor(i/s),l=n?Math.floor(r/s):Math.ceil(r/s);return{plotMin:t||0===a?i:a*s,plotMax:n?r:l*s,tickSpacing:s,tickBaseValue:0}}function a(e,t){var n;for(n=0;n<e.length;n++)if(e[n]>=t)return n-1}function l(e,t){var n;for(n=e.length-1;n>=0;n--)if(e[n]<=t)return n+1}function c(e,t,n,i,r){var o,s;o=a(e,t),s=l(e,n),!i&&void 0!==e[o+1]&&e[o+1]>t&&(o-=1),!r&&s>0&&void 0!==e[s-1]&&e[s-1]<n&&(s+=1),s<e.length&&e.splice(s,e.length-s),o>=0&&e.splice(0,o+1)}function u(t,n,i,r){var o,s,a,l,c=Number.MAX_VALUE,u=-Number.MAX_VALUE,h=e.log10(i),d=e.log10(n),p=h-d;for(s=t?t.length:0,a=new Array(s),(null===r||isNaN(r))&&(r=1.71),o=0;o<s;o++)a[o]=e.log10(t[o]);for(o=1;o<s;o++)l=a[o]-a[o-1],c=Math.min(c,l),u=Math.max(u,l);return u=Math.max(u,Math.abs(a[0]-d)),u=Math.max(u,Math.abs(h-a[s-1])),c/p*this.plotSize>=this.minTickSpacingInPixel-M&&u/c<=r&&t.length-1<=this.maxNumIntervals}function h(t){var n,i,r,o,s=Number.MAX_VALUE,a=-Number.MAX_VALUE,l=t.mainTickValues;for(i=l?l.length:0,r=new Array(i),n=0;n<i;n++)r[n]=e.log10(l[n]);for(n=1;n<i;n++)o=r[n]-r[n-1],s=Math.min(s,o),a=Math.max(a,o);t.maxTickSpacing=a,t.minTickSpacing=s,t.tickSpacingRatio=a/s,t.spaceUseFactor=this.usedDataRange/(t.plotMax-t.plotMin),t.factor=t.spaceUseFactor/(t.tickSpacingRatio*t.tickSpacingRatio)}function d(t,n,i,r,o){var s,a,l,c,u;return s=(r+i)/2,void 0===o?(a=Math.round(s))>=i&&a<=r?Math.pow(10,a):(l=Math.floor(s))>=i&&l<=r?Math.pow(10,l):(c=Math.ceil(s))>=i&&c<=r?Math.pow(10,c):(u=e.getSmallNiceNumber(Math.max(1,n-t)),Math.ceil(t/u)*u):(l=Math.pow(10,Math.floor(s)),c=Math.pow(10,Math.ceil(s)),Math.abs(l-o)<Math.abs(c-o)?l:c)}function p(e,t,n,i,r,o){var s,a=r?Math.ceil((e-n)/i):Math.floor((e-n)/i),l=o?Math.floor((t-n)/i):Math.ceil((t-n)/i),c=[];for(s=a;s<=l;s++)s*i+n>0&&c.push(s*i+n);return c}function f(e,t,n,i){e.mainTickValues=t,e.plotMin=n,e.plotMax=i}function m(){return this.usedDataMax>=10*this.usedDataMin?1:this.usedDataMaxLogFloor===this.usedDataMinLogFloor?this.maxIsStrict&&this.minIsStrict?2:3:1}function g(e){e.sort(function(e,t){return e-t})}function v(e,t,n,i,r,o,s){var a,l,h,d,p,f,m,v=0,y=[];for(v=0;v<e.length;v++)if(t<=e[v][0]+M){for(p=n.concat(),a=i;a<r;a++)for(l=1;l<e[v].length;l++)p.push(e[v][l]*Math.pow(10,a*o+s));g(p),c(p,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),f=this.minIsStrict?this.explicitPlotMin:p[0],m=this.maxIsStrict?this.explicitPlotMax:p[p.length-1],u.apply(this,[p,f,m])&&y.push({mainTickValues:p,plotMin:f,plotMax:m})}if(0===y.length)return p=n,c(p,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),f=this.minIsStrict?this.explicitPlotMin:p[0],m=this.maxIsStrict?this.explicitPlotMax:p[p.length-1],{mainTickValues:p,plotMin:f,plotMax:m};if(1===y.length)return y[0];for(d=n.length-1,v=0;v<y.length;v++)if(h=y[v].mainTickValues.length-1,y[v].mainTickValues[0]===n[0]&&y[v].mainTickValues[h]===n[d])return y[v];return y[0]}function y(e,t){var n,i,r,o,s,a,l=!0,c=Math.ceil(this.fractionMinLog),h=Math.floor(this.fractionMaxLog),p=0;if(e[c]&&e[c][h])for((s=e[c][h])instanceof Array||(s=e[c][s]),a=s.length;p<a&&l;){if(t<=s[p][0]+M&&s[p].length-2<=this.maxNumIntervals){for(i=[],n=1;n<s[p].length;n++)i.push(s[p][n]*this.dataMinMagnitude);l=!u.apply(this,[i,this.usedDataMin,this.usedDataMax])}l&&p++}return l&&(i=[d(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog)]),r=this.minIsStrict?this.explicitPlotMin:i[0],o=this.maxIsStrict?this.explicitPlotMax:i[i.length-1],{mainTickValues:i,plotMin:r,plotMax:o}}function b(e,t){var n,i,r,o,s,a,l,h,p,m,g,v,y,b,x,q=this.minIsStrict?Math.ceil(this.fractionMinLog):Math.floor(this.fractionMinLog),C=this.maxIsStrict?Math.floor(this.fractionMaxLog):Math.ceil(this.fractionMaxLog),S={};if(T[q]&&T[q][C])for(h=(l=T[q][C])instanceof Array?l.length/2:0,S.mainTickValues=[],n=0;n<h;n++)if(p=l[2*n],m=l[2*n+1],e[p]&&e[p][m])for(v=(g=e[p][m]).length,i=0;i<v;i++)if(y=t<=g[i][0]+M&&g[i].length-2<=this.maxNumIntervals,b=g[i][1]*this.dataMinMagnitude,x=g[i][g[i].length-1]*this.dataMinMagnitude,y=this.minIsStrict?y&&b>=this.usedDataMin:y&&b<=this.usedDataMin,y=this.maxIsStrict?y&&x<=this.usedDataMax:y&&x>=this.usedDataMax){for(o=[],r=1;r<g[i].length;r++)o.push(g[i][r]*this.dataMinMagnitude);if(c(o,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),s=this.minIsStrict?this.explicitPlotMin:o[0],a=this.maxIsStrict?this.explicitPlotMax:o[o.length-1],u.apply(this,[o,s,a])){S.mainTickValues.length<o.length&&f(S,o,s,a);break}}return S.mainTickValues&&0!==S.mainTickValues.length||(S.mainTickValues=[d(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog)]),o=S.mainTickValues,S.plotMin=this.minIsStrict?this.explicitPlotMin:o[0],S.plotMax=this.maxIsStrict?this.explicitPlotMax:o[o.length-1],S}function x(e,t,n){var i,r=e.length;if(n){for(i=r-1;i>=0;i--)if(Math.abs(e[i]-t[i]*this.dataMinMagnitude)>M)return!1;return!0}for(i=0;i<r;i++)if(Math.abs(e[i]-t[i]*this.dataMinMagnitude)>M)return!1;return!0}function q(e){var t,n,i=e.mainTickValues,r=i.length;if(!(r<2||r>4))return n=5*this.dataMinMagnitude,(this.minIsStrict&&this.usedDataMin<=n||!this.minIsStrict&&this.usedDataMin>=n)&&(x.apply(this,[i,[6,10,20,40]])||x.apply(this,[i,[4,10,20,40]]))?(t=i[0],i[0]=n,e.plotMin=this.minIsStrict?this.explicitPlotMin:i[0],void(u.apply(this,[i,e.plotMin,e.plotMax])||(i[0]=t,e.plotMin=this.minIsStrict?this.explicitPlotMin:i[0]))):(n=80*this.dataMinMagnitude,(this.maxIsStrict&&this.usedDataMax>=n||!this.maxIsStrict&&this.usedDataMax<=n)&&x.apply(this,[i,[10,20,40,60],!0])?(t=i[r-1],i[r-1]=n,e.plotMax=this.maxIsStrict?this.explicitPlotMax:i[r-1],void(u.apply(this,[i,e.plotMin,e.plotMax])||(i[r-1]=t,e.plotMax=this.maxIsStrict?this.explicitPlotMax:i[r-1]))):void 0)}function C(t,n,i,r,o,a,l,c,h,d){var f,m,g,v,y=e.calculateTicks(t,n,i,r,o,a,l,c,h,d),b=null!==r,x=null!==o,q=b?r:n,C=x?o:i,S=1;for(0===y.plotMin&&(y.plotMin=b?r:n),f=y.mainTickValues,m=b?r:Math.min(n,f[0]),g=x?o:Math.max(f[f.length-1],i);!u.apply(this,[f,m,g])&&S<=20;)f=p(q,C,(y=s(b||y.tickSpacing>q,x,q,C,y.tickSpacing)).tickBaseValue,y.tickSpacing,b,x),m=b?r:Math.min(n,f[0]),g=x?o:Math.max(f[f.length-1],i),S++;return u.apply(this,[f,m,g])?(v=e.getFraction(f[0])/2,2===f.length&&f[1]/f[0]==2&&f[0]/2>=m&&v===Math.floor(v)&&(f.splice(0,0,f[0]/2),v=e.getFraction(f[0])/2,f[0]/2>=m&&v===Math.floor(v)&&f.splice(0,0,f[0]/2))):f=[],y.mainTickValues=f,y.numLoops=S,y}function S(){var e,t,n,i,r,s,a,l,h,p,g,x,C,S,w,_={};if(this.maxIsStrict&&this.explicitPlotMax<=this.usedDataMin?(this.dataMinLog=Math.ceil(this.explicitPlotMaxLog-(this.maxNumIntervals<2?1:2)),this.dataMin=Math.pow(10,this.dataMinLog)):this.minIsStrict&&this.explicitPlotMin>=this.usedDataMax?(this.dataMaxLog=Math.floor(this.explicitPlotMinLog+(this.maxNumIntervals<2?1:2)),this.dataMax=Math.pow(10,this.dataMaxLog)):this.usedDataMin===this.usedDataMax&&(n=this.usedDataMin,this.dataMinLog=Math.floor(this.dataMinLog),this.dataMaxLog=this.dataMinLog+1,this.dataMin=Math.pow(10,this.dataMinLog),this.dataMax=Math.pow(10,this.dataMaxLog)),this.usedDataMin=this.minIsStrict?this.explicitPlotMin:this.dataMin,this.usedDataMax=this.maxIsStrict?this.explicitPlotMax:this.dataMax,this.usedDataMinLog=this.minIsStrict?this.explicitPlotMinLog:this.dataMinLog,this.usedDataMaxLog=this.maxIsStrict?this.explicitPlotMaxLog:this.dataMaxLog,this.maxNumIntervals<1)return f(_,[d(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog,n)],this.usedDataMin,this.usedDataMax),_;if(this.tickDataSpacingLog=(this.usedDataMaxLog-this.usedDataMinLog)/this.maxNumIntervals,this.usedDataMinLogFloor=Math.floor(this.usedDataMinLog),this.usedDataMaxLogFloor=Math.floor(this.usedDataMaxLog),this.dataMinMagnitude=Math.pow(10,this.usedDataMinLogFloor),this.fractionMinLog=this.usedDataMin/this.dataMinMagnitude,this.fractionMaxLog=this.usedDataMax/this.dataMinMagnitude,e=Math.ceil(this.usedDataMaxLog),this.usedDataMinLog===this.usedDataMinLogFloor&&this.usedDataMaxLog===e&&this.maxNumIntervals>=2&&this.maxNumIntervals<3&&this.tickDataSpacingLog>1&&this.tickDataSpacingLog-Math.floor(this.tickDataSpacingLog)<A&&(t=Math.floor((this.usedDataMinLogFloor+e)/2),C=[Math.pow(10,this.usedDataMinLogFloor),3*Math.pow(10,t),Math.pow(10,e)],c(C,this.usedDataMin,this.usedDataMax,this.minIsStrict,this.maxIsStrict),S=this.minIsStrict?this.explicitPlotMin:C[0],w=this.maxIsStrict?this.explicitPlotMax:C[C.length-1],C.length>=2&&u.apply(this,[C,S,w])))return f(_,C,S,w),_;if(!(a=o.call(this)).success)return f(_,[d(this.usedDataMin,this.usedDataMax,this.usedDataMinLog,this.usedDataMaxLog)],this.usedDataMin,this.usedDataMax),_;for(l=a.tickMinIndex,h=a.tickMaxIndex,r=a.tickDataSpacingNNLog,s=a.tickBaseValueLog,this.minIsStrict&&l--,this.maxIsStrict&&h++,g=[],p=l;p<=h;p++)g.push(Math.pow(10,p*r+s));return i=Math.pow(10,this.tickDataSpacingLog),2===(x=m.call(this))?y.apply(this,[I,i]):3===x?b.apply(this,[I,i]):(_=v.apply(this,[E,i,g,l,h,r,s]),q.call(this,_),_)}function w(){var e,t,n,i,r={};for(this.plotMin=this.usedDataMin,this.plotMax=this.usedDataMax,t=Math.floor(this.maxNumIntervals),n=(this.dataMaxLog-this.dataMinLog)/t,i=[this.usedDataMin],e=0;e<t;e++)i.push(Math.pow(10,this.dataMinLog+(e+1)*n));return f(r,i,this.plotMin,this.plotMax),r}var _,D=Math.log(10),M=1e-12,A=Math.log(3)/D,E=[[2,4,6],[2,4],[3]],I=[,[,,[[1,2]],[[1,2,3],[1,3]],[[1,2,4],[1,4]],[[1,2,4],[1,5]],[[1,2,4,6],[2,4,6],[1,3,6],[1,6]],[[1,2,4,6],[2,4,6],[1,3,6],[1,7]],[[1,2,4,8],[2,4,8],[1,8]],[[1,2,4,8],[2,4,8],[1,3,9],[1,9]],[[1,2,4,6,10],[1,2,4,10],[1,3,10],[3,10],[1,10]]],[,,,[[2,3]],[[2,3,4],[2,4]],[[2,3,4],[2,4],[2,5]],[[2,4,6],[2,6]],[[2,4,6],[2,6],[2,7]],[[2,4,8],[2,8]],[[2,4,8],[2,8],[2,9]],[[2,4,6,10],[2,4,10],[5,10],[3,10]]],[,,,,[[3,4]],[[3,4,5],[3,5]],[[3,4,5,6],[3,6]],[[3,4,5,6],[3,5,7],[3,7]],[[3,4,5,6,8],[3,5,7],[4,8],[3,8]],[[3,4,5,6,8],[3,4,6,9],[3,4,6,8],[3,6,9],[4,8],[3,9]],[[4,6,10],[5,10],[3,10]]],[,,,,,[[4,5]],[[4,5,6],[4,6]],[[4,5,6,7],[4,5,6],[4,6]],[[4,5,6,7,8],[4,5,6,7],[4,6,8],[4,8]],[[4,5,6,7,8],[4,6,9],[4,6,8],[4,8]],[[4,6,10],[5,7,9],[5,10],[4,10]]],[,,,,,,[[5,6]],[[5,6,7],[5,7]],[[5,6,7,8],[5,6,7],[6,8]],[[5,6,7,8,9],[5,6,7,8],[5,7,9],[5,9]],[[6,8,10],[5,10]]],[,,,,,,,[[6,7]],[[6,7,8],[6,8]],[[6,7,8,9],[6,7,8],[6,9]],[[6,7,8,9,10],[6,8,10],[6,10]]],[,,,,,,,,[[7,8]],[[7,8,9],[7,9]],[[7,8,9,10],[8,10],[7,10],[7,9]]],[,,,,,,,,,[[8,9]],[[8,9,10],[8,10]]],[,,,,,,,,,,[[9,10]]]],T=[,[,,[1,2],[1,3],[1,4],[1,5,1,6],[1,6],[1,10,1,8,1,7],[1,8,1,10],[1,10,1,9]],[,,,[2,3],[2,4],[2,6,2,5],[2,6,2,8],[2,8,2,7],[2,8,1,10],[1,10,2,10,2,9],[1,10,2,10]],[,,,,[3,4,2,4],[3,6,3,5],[3,6,2,6],[2,8,3,8,3,7],[2,8,3,8,3,9],[2,10,3,10,3,9]],[,,,,,[4,5,4,6,3,5],[4,6],[4,8,4,7],[4,8],[4,10,4,9,3,9],[4,10]],[,,,,,[5,6,4,6],[5,7,4,8],[4,8,5,8,5,10],[5,10,4,10,5,9],[5,10,4,10]],[,,,,,,[6,7,6,8],[6,8],[6,10,5,10,6,9],[6,10,5,10]],[,,,,,,,[7,8,6,8],[7,9,6,10],[6,10,7,10]],[,,,,,,,,[8,10,8,9],[8,10]],[,,,,,,,,,[9,10]]];return function(){var e,t;for(n(E,1,10),e=0;e<I.length;e++)if(I[e])for(t=0;t<I[e].length;t++)I[e][t]instanceof Array&&n(I[e][t])}(),_={calculateTicksLogPositive:function(t,n,i,r,o,s,a,l,c){var u,d,p,m={};return isNaN(r)&&(r=null),isNaN(o)&&(o=null),n>i&&(u=n,n=i,i=u),null!==r&&null!==o&&r>o&&(u=r,r=o,o=u),this.plotSize=t,this.dataMin=n,this.dataMax=i,this.explicitPlotMin=r,this.explicitPlotMax=o,this.minTickSpacingInPixel=s,this.minIsStrict=null!==r,this.maxIsStrict=null!==o,this.usedDataMin=this.minIsStrict?r:n,this.usedDataMax=this.maxIsStrict?o:i,this.usedDataRange=this.usedDataMax-this.usedDataMin,this.maxNumIntervals=t/s,this.maxNumTicks=this.maxNumIntervals+1,this.explicitPlotMinLog=this.minIsStrict?e.eliminateFloatingError(e.log10(r)):null,this.explicitPlotMaxLog=this.maxIsStrict?e.eliminateFloatingError(e.log10(o)):null,this.dataMinLog=e.eliminateFloatingError(e.log10(n)),this.dataMaxLog=e.eliminateFloatingError(e.log10(i)),l&&0!==t?this.minIsStrict&&this.maxIsStrict&&this.explicitPlotMin===this.explicitPlotMax?(f(m,[this.explicitPlotMin],this.explicitPlotMin,this.explicitPlotMax),m):(p=S.call(this),this.usedDataMax>=10*this.usedDataMin?p:(d=C.apply(this,[t,n,i,r,o,s,a,l,c])).mainTickValues.length<2?p:p.mainTickValues.length<2?d:d.mainTickValues.length===p.mainTickValues.length?(h.call(this,d),h.call(this,p),d.factor>p.factor?d:p):d.mainTickValues.length-1>=1.5*(p.mainTickValues.length-1)&&d.mainTickValues.length>p.mainTickValues.length?d:p):w.call(this)},calculateTicks:function(e,t,n,i,r,o,s,a,l){var c,u,h,d,p,f,m;if(isNaN(i)&&(i=null),isNaN(r)&&(r=null),t>n&&(c=t,t=n,n=c),null!==i&&null!==r&&i>r&&(c=i,i=r,r=c),t*n<=0&&(t=null===i?t:i,n=null===r?n:r),t>0&&n>0&&(null===i||i>0)&&(null===r||r>0))return u=_.calculateTicksLogPositive(e,t,n,i,r,o,s,a,l),u.sign=1,u;if(t<0&&n<0&&(null===i||i<0)&&(null===r||r<0)){for(h=_.calculateTicksLogPositive(e,-n,-t,null===r?null:-r,null===i?null:-i,o,s,a,l),(u={}).plotMin=-h.plotMax,u.plotMax=-h.plotMin,f=(p=h.mainTickValues)?p.length:0,d=new Array(f),m=0;m<f;m++)d[m]=-p[f-1-m];return u.mainTickValues=d,u.sign=-1,u}return{plotMin:null===i?t:i,plotMax:null===r?n:r,mainTickValues:[]}}}}),define("objects.views/charts/components/axis/log-scale",["core.utils/class","../../utils/scale-utils","../../utils/scale-log-utils"],function(e,t,n){return e.extend("LogScale",{init:function(){this.plotMin=null,this.plotMax=null,this.plotRange=null,this.tickMin=this.plotMin,this.tickMax=this.plotMax,this.mainValues=[],this.secondaryValues=[],this._plotSize=0,this._calculationSize=0},setSize:function(e){this._plotSize=e},getPositionOfValue:function(e){return 0===e?this._usedDataMin>0?0:this._plotSize:((e>0?t.log10(e):-t.log10(-e))-this._plotMinLog10)/this._plotRangeLog10*this._plotSize},getNormalizedValue:function(e){return 0===e?this._usedDataMin>0?0:1:((e>0?t.log10(e):-t.log10(-e))-this._plotMinLog10)/this._plotRangeLog10},getValueOfPosition:function(e){var t;return 0===e?0:(t=this._plotMinLog10+this._plotRangeLog10*e/this._plotSize,this._usedDataMin>0?Math.pow(10,t):-Math.pow(10,-t))},calculateLimits:function(){this._usedDataMin=isNaN(this._realDataMin)?this._dataMin:this._realDataMin,this._usedDataMax=isNaN(this._realDataMax)?this._dataMax:this._realDataMax,this.plotMin=null===this._explicitPlotMin||isNaN(this._explicitPlotMin)?this._usedDataMin:this._explicitPlotMin,this.plotMax=null===this._explicitPlotMax||isNaN(this._explicitPlotMax)?this._usedDataMax:this._explicitPlotMax,this.plotRange=this.plotMax-this.plotMin,this._plotMinLog10=t.log10(Math.abs(this.plotMin))*(this.plotMin<0?-1:1),this._plotMaxLog10=t.log10(Math.abs(this.plotMax))*(this.plotMax<0?-1:1),this._plotRangeLog10=this._plotMaxLog10-this._plotMinLog10},calculateTicks:function(){var e;e=n.calculateTicks(this._calculationSize,this._usedDataMin,this._usedDataMax,this._explicitPlotMin,this._explicitPlotMax,this._minTickSpacingInPixel,this._fontHeight,this._niceNumberEnabled,this._whiteSpaceOptimizingEnabled),this.plotMin=e.plotMin,this.plotMax=e.plotMax,this.plotRange=this.plotMax-this.plotMin,this.tickMin=e.tickMin,this.tickMax=e.tickMax,this.mainValues=e.mainTickValues,this.secondaryValues=[],this._dataSign=e.sign,this._tickSpacing=this.mainValues.length>1?this.mainValues[1]-this.mainValues[0]:this.plotMax-this.plotMin,this._plotMinLog10=this._dataSign*t.log10(Math.abs(this.plotMin)),this._plotMaxLog10=this._dataSign*t.log10(Math.abs(this.plotMax)),this._plotRangeLog10=this._plotMaxLog10-this._plotMinLog10,0===this.mainValues.length&&this.mainValues.push(e.minTickValue),0===this._tickSpacing&&(this._tickSpacing=1)},getValues:function(){return{mainValues:this.mainValues,secondaryValues:this.secondaryValues}}})}),define("objects.views/charts/utils/tween",["core.utils/class","objects.utils/animation-frame"],function(e,t){"use strict";function n(){l.tick()&&(c=t.request(n))}function i(e){u.push(e),e._isRunning=!0,null===c&&(c=t.request(n))}function r(e,t){for(var n in e)this._props[n]||(this._props[n]={}),this._props[n][t]=Array.isArray(e[n])?e[n].slice():e[n]}function o(){var e,t,n,i;for(e in this._props)if(i=this._props[e],t="from"in i?i.from:this._target[e],n=i.to,i.from=t,Array.isArray(t)){var r=t.map(function(e){return e.value}),o=n.map(function(e){return e.value});i.fresh=n.filter(function(e){return r.indexOf(e.value)<0}),i.rotten=t.filter(function(e){return o.indexOf(e.value)<0}),i.ripe=n.filter(function(e){return r.indexOf(e.value)>=0}),i.combined=i.rotten.concat(i.ripe).concat(i.fresh),i.isArray=!0}else isNaN(t)||isNaN(i.to)||(i.change=i.to-t)}function s(e){var t;for(t in e)if(e[t].isArray){if(e[t].fresh.length||e[t].rotten.length)return!0}else if(e[t].change)return!0;return!1}function a(e,t,n){var i,r,o,s,a,l,c;for(r in e){if(o=e[r],s=o.to,a=o.from,o.isArray){for(l=o.fresh,c=o.rotten,o.value=n?o.to:o.combined,i=0;i<l.length;i++)l[i].opacity=t;for(i=0;i<c.length;i++)c[i].opacity=1-t;n&&(delete o.combined,delete o.fresh,delete o.rotten,delete o.ripe)}else o.value=!n&&"change"in o?a+o.change*t:s;n&&delete e[r].from}}var l,c=null,u=[],h=!0,d=Math.PI,p=Math.cos;(l=e.extend("Tween",{init:function(e,t,n,r){var a,c,u,h={},d=!0;this._target=e,this._enabled=!0;for(a in t)c=Array.isArray(e[a])?e[a].slice():e[a],u=Array.isArray(t[a])?t[a].slice():t[a],h[a]={from:c,to:u};this._props=h,o.call(this),"object"==typeof n?(this._duration=n.duration||200,this._easing="function"==typeof n.easing?n.easing:l.easing[n.easing||"linear"],d=!1!==n.autoStart):(this._duration=n||200,this._easing="function"==typeof r?r:l.easing[r||"linear"]),this._dfd=new f,this._pos=0,this._isRunning=!1,d&&(s(this._props)?(this._startTime=Date.now(),i(this)):this._step(!0))},from:function(e){return this._isRunning||r.call(this,e,"from"),this},to:function(e){return this._isRunning||r.call(this,e,"to"),this},start:function(){return!this._isRunning&&this._enabled&&h&&(o.call(this),s(this._props)?this._start():this._dfd.resolve()),this},willStart:function(){return!(this._isRunning||!this._enabled||!h||(o.call(this),!s(this._props)))},stop:function(){return this._isRunning&&(this._isRunning=!1,u.splice(u.indexOf(this),1)),this},end:function(){return this._isRunning&&this._step(!0),this},then:function(){return this._dfd.then.apply(this._dfd,[].slice.call(arguments)),this},progress:function(){return this._dfd.progress.apply(this._dfd,[].slice.call(arguments)),this},isRunning:function(){return this._isRunning},on:function(){this._enabled=!0},off:function(){this._enabled=!1},destroy:function(){this.stop(),this._dfd.destroy()},_update:function(){var e;for(e in this._props)this._target[e]=this._props[e].value},_step:function(e){var t,n=Date.now()-this._startTime;if(n>=this._duration||e)return this._pos=1,this._isRunning=!1,(t=u.indexOf(this))>=0&&u.splice(t,1),a(this._props,this._pos,!0),this._update(),this._dfd.notify(n,n/this._duration,this._pos),void this._dfd.resolve();this._pos=this._easing(n/this._duration),a(this._props,this._pos,!1),this._update(),this._dfd.notify(n,n/this._duration,this._pos)},_start:function(){this._startTime=Date.now(),i(this),this._step()}})).off=function(){h=!1},l.on=function(){h=!0},l.tick=function(){var e,n=u.slice(),i=n.length;for(e=0;e<i;e++)n[e]._step();return!!u.length||(t.cancel(c),c=null,!1)},l.clear=function(){},l.easing={linear:function(e){return e},easeInOut:function(e){return.5*(1-p(e*d))}},l.tweens=u;var f=function(){this._onSuccess=[],this._onProgress=[],this._isResolved=!1};return f.prototype={then:function(e){this._onSuccess.push(e),this._isResolved&&e.call(null,[].slice.apply(arguments))},progress:function(e){this._onProgress.push(e)},resolve:function(){this._isResolved=!0;var e,t=this._onSuccess.length;for(e=0;e<t;e++)this._onSuccess[e].apply(null,[].slice.call(arguments))},notify:function(){var e,t=this._onProgress.length;for(e=0;e<t;e++)this._onProgress[e].apply(null,[].slice.call(arguments))},destroy:function(){this._onSuccess=[],this._onProgress=[]}},l}),define("objects.views/charts/components/axis/axis-utils",[],function(){return{getAxisUnitAlignment:function(e,t){return["near","far"].contains(e)?t?e:"near"===e?"far":"near":t?"left"===e?"near":"far":"bottom"===e?"far":"near"},roundToHalf:function(e){var t=Math.round(e);return t-e>=0?t-.5:t+.5},getTicks:function(e){var t=[];return e&&e.forEach(function(e){t.push({position:0,value:e,opacity:1})}),t},getAvgTickWidth:function(e){return!e||e.length<2?0:Math.abs(e[e.length-1]-e[0])/(e.length-1)}}}),define("objects.views/charts/components/axis/continuous-axis",["./axis","./linear-scale","./log-scale","objects.views/charts/components/axis/radial-axis-helper","util","objects.views/charts/utils/tween","./axis-utils","general.utils/shapes/rect","general.utils/shapes/polygon"],function(e,t,n,i,r,o,s){"use strict";function a(e){return e.some(function(e){return null===e})}function l(e,t){var n,i,r=0,o=e[this._isVertical?"height":"width"],s=0,a=this._style;if(this._isVertical?o-=this._padding.top+this._padding.bottom:o-=this._padding.left+this._padding.right,this.isRadial())r=2*Math.sin(this._relevantAngle/4)*this._fontHeight*a.label.lineHeight;else if(this._isVertical){if(this._calculateScale(o),n=this._formatter,i=this._renderer,n){var l=this._scale.getValues().mainValues.map(function(e){return i.getTextWidth(n.formatValue(e)+"ml",a.label.font)});s=Math.max.apply(null,l.length?l:[0])}r=Math.min(t[this._isVertical?"width":"height"]/3,s<this.outerRect.width/2?s:this.outerRect.width/3)}else r=this._fontHeight*a.label.lineHeight;return this._wantedLabelSpacePerLevel=r,r}function c(){if(this._useTimeScaling)return 0;var e,t,n,i;if(e=this._formatter){switch(t=e.pattern,n=e.thousandDelimiter,i=e.decimalDelimiter,t){case"#"+n+"##0":return 1;case"#"+n+"##0"+i+"0":return.1;case"#"+n+"##0"+i+"00":case"0%":return.01;case"0"+i+"0%":return.001;case"0"+i+"00%":return 1e-4}return 0}}var u={autoStart:!1,duration:500,easing:"easeInOut"},h={onProgress:function(){this._updateTickPositions(),this.invalidateDisplay(),this.fire("changed")},on:function(){this._tickTween.on(),this._linearTween.on()},off:function(){this._tickTween.off(),this._linearTween.off()},to:function(){this._linearTween.stop().to({plotMin:this._scale.plotMin,plotMax:this._scale.plotMax,plotRange:this._scale.plotRange}),this._tickTween.stop().to({ticks:this.ticks})},from:function(){this._linearTween.stop().from({plotMin:this._scale.plotMin,plotMax:this._scale.plotMax,plotRange:this._scale.plotRange}),this._tickTween.stop().from({ticks:this.ticks})},start:function(){this._useTransition&&this._linearTween.willStart()&&(this._tickTween.start(),this._linearTween.start())},end:function(){this._useTransition&&(this._tickTween.end(),this._linearTween.end())},stop:function(){this._tickTween.stop(),this._linearTween.stop()}};return e.extend("ContinuousAxis",{init:function(){this._super.apply(this,[].slice.call(arguments)),this._scaleDetails={showExplicitMinMax:!0,niceNumberEnabled:!0,tickMultiplier:1},this.ticks=[],this.minorTicks=null,this._tickDates=[],this._minorTickDates=[],this._explicitLabels=[],this._defaultFormatter={formatValue:function(e){return String(e)},format:function(e){return String(e)}},this._formatter=this._defaultFormatter,this._useLogScaleIfPossible=!1,this._cacheItems=null,this._useTransition=!1,this._selectedRanges=[],this._initScales(),this._linearTween=new o(this._scale,{},u).progress(h.onProgress.bind(this)),this._tickTween=new o(this,{},u)},_initScales:function(){this._logarithmicScale=new n,this._scale=this._linearScale=new t},setSelectableShapes:function(e){this._cacheItems=e},getDiscreteSpacing:function(){return 4},updateSize:function(){this._super(),this._calculationSize=this._plotSize,this._updateScaleAndTicks(),this._scale.setSize(this._plotSize),this._updateTickPositions(),h.to.call(this),this._changed?(this._changed=!1,h.start.call(this)):h.end.call(this)},getPlotSize:function(){return this._plotSize},calculateValuePositionMappingInfo:function(){this._scale.setSize(this._plotSize),this._scale._calculationSize=this._plotSize,this._scale.calculateLimits()},setUseTransition:function(e){this._super(e),h[e?"on":"off"].call(this)},preRelevantSizeCalculation:function(){this._super(),this._areLabelsVisible=this.isVisible(this._layoutMode)&&this._showLabels},calculatePreliminaryLabelSpace:function(e){var t=0;return this._areLabelsVisible&&(t=l.call(this,e,e)),{relevantLabelSize:t||0,relevantSpacing:0}},calculateLabelSpace:function(e,t,n){var i=0;return this._calculateScale(this._calculationSize),this._areLabelsVisible&&(i=l.call(this,n||e,e)),{relevantLabelSize:i||0,relevantSpacing:0}},_getLabels:function(e,t){var n,i,r,o=e?e.length:0,a=[],l=[],c=[],u=[],h=[],d=[];if(e.forEach(function(e){i=this.getPositionOfValue(e.value),i=s.roundToHalf(i),u.push(i),c.push(e.value),h.push("opacity"in e?e.opacity:1),a.push(e.value+""),l.push(e.qualifiedLabel)},this),o<=1)d=[this._plotSize];else if(t){for(r=this.yMirrorMode?this._padding.left+this._plotSize-u[0]:u[0],d[0]=Math.abs(u[1]-u[0])+r,n=1;n<e.length-1;n++)d.push(Math.abs(u[n]-u[n-1]));d[n]=this.yMirrorMode?u[n]:this._padding.left+this._plotSize-u[n]}else{for(r=this.yMirrorMode?this._padding.left+this._plotSize-u[0]:u[0],d[0]=Math.abs(u[1]-u[0])/2+r,n=1;n<e.length-1;n++)d.push(Math.abs(u[n]-u[n-1])/2+Math.abs(u[n+1]-u[n])/2);r=this.yMirrorMode?u[n]:this._padding.left+this._plotSize-u[n],d[n]=Math.abs(u[n]-u[n-1])/2+r}return{values:c,widths:d,positions:u,opacities:h,labels:a,labelMode:1,labelSpace:this._wantedLabelSpacePerLevel,qualifiedLabels:l[0]?l:null,labelsBetweenTicks:t}},_updateTickPositions:function(){var e,t;for(t=0;t<this.ticks.length;t++)e=this.getPositionOfValue(this.ticks[t].value),this.ticks[t].position=s.roundToHalf(e);for(t=0;t<this.minorTicks.length;t++)e=this.getPositionOfValue(this.minorTicks[t].value),this.minorTicks[t].position=s.roundToHalf(e);if(this._initLevels(),this._updateTickFormatting(this._levels,this._formatter),this.indicators)for(t=0;t<this.indicators.positions.length;t++)e=this.getPositionOfValue(this.indicators.values[t]),this.indicators.positions[t]=s.roundToHalf(e);this._snapTicksAvgWidth=s.getAvgTickWidth(this.indicators?this.indicators.positions:this._levels[0].positions)||this._plotSize},_initLevels:function(){this._levels=[this._getLabels(this.ticks,!1)]},_calculateScale:function(e){if(0!==e){var t,n=this._scaleDetails,i=isNaN(n.realDataMin)?n.dataMin:n.realDataMin,r=isNaN(n.realDataMax)?n.dataMax:n.realDataMax,o=isNaN(n.explicitPlotMin)||null===n.explicitPlotMin?i:n.explicitPlotMin,s=isNaN(n.explicitPlotMax)||null===n.explicitPlotMax?r:n.explicitPlotMax;t=this.isRadial()?96:Math.max(96,this._getApproximateLabelWidth(o,s));var a=this.isVertical()?4*this._fontHeight:t;a=e/(Math.max(2,e/a/n.tickMultiplier+1)-1),this._useLogScaleIfPossible&&o*s>0&&i*r>0?(this._scale=this._logarithmicScale,this.setUseTransition(!1)):this._scale=this._linearScale,n.usedDataMin=i,n.usedDataMax=r,n.minTickSpacingInPixel=a,n.minTickDataSpacing=c.call(this),n.plotSize=this._plotSize,n.calculationSize=void 0!==e?e:this._calculationSize,n.fontHeight=this._fontHeight,Object.keys(n).forEach(function(e){this._scale["_"+e]=n[e]},this),this._scale.calculateTicks()}},_getApproximateLabelWidth:function(e,t,n){var i=this._formatter,r=this._renderer,o=this._style.label.font;return i?Math.max.apply(null,[e,t,(t-e)/2].map(function(e){return r.getTextWidth(i.formatValue(e,n),o)})):0},_generateTickObjects:function(e,t){var n=e.getValues();this.ticks=s.getTicks(n.mainValues,this._padding,t),this.minorTicks=s.getTicks(n.secondaryValues,this._padding,t),this._tickDates=n.mainDates,this._minorTickDates=n.secondaryDates},_updateTickFormatting:function(e,t){for(var n=0;e[0]&&n<e[0].values.length;n++)e[0].labels[n]=t?t.formatValue(e[0].values[n]):e[0].values[n]},setPlotMin:function(e){this._scaleDetails.explicitPlotMin="number"==typeof e?e:null,this.invalidateProperties("setPlotMin")},getPlotMin:function(){return this._scale.plotMin},setPlotMax:function(e){this._scaleDetails.explicitPlotMax="number"==typeof e?e:null,this.invalidateProperties("setPlotMax")},getPlotMax:function(){return this._scale.plotMax},setTickMultiplier:function(e){this._scaleDetails.tickMultiplier=e||1,this.invalidateProperties("setTickMultiplier")},setSpacingMode:function(e){this._scaleDetails.spacingMode=e,this.invalidateProperties("setSpacingMode")},getSpacingMode:function(){return this._scaleDetails.spacingMode},setShowExplicitMinMax:function(e){this._scaleDetails.showExplicitMinMax=e,this.invalidateProperties("setShowExplicitMinMax")},setLogScale:function(e){this._useLogScaleIfPossible=e,this.invalidateProperties("setLogScale")},getLogScale:function(){return this._scale===this._logarithmicScale},numberFormat:function(e,t){return this._discrete?e:r.numberFormat(e,t||this._precision,this._exponentUsed)},format:function(e){return this._discrete||!this._formatter?e+"":this._formatter.format(e,this._formatPattern)},formatValue:function(e){return this._discrete||!this._formatter?e+"":this._formatter.formatValue(e)},_transition:function(){this._onAnimatitonEnd()},setDataRangeTransition:function(e){this._transitionEnabled=e},setDataRange:function(e,t){return this._scaleDetails.dataMin=e,this._scaleDetails.dataMax=t,this.invalidateDisplay("setDataRange"),this.invalidateProperties("setDataRange"),this},setRealDataRange:function(e,t){this._scaleDetails.realDataMin=e,this._scaleDetails.realDataMax=t,this.invalidateProperties("setRealDataRange")},getDataMin:function(){return this._scaleDetails.dataMin},getDataMax:function(){return this._scaleDetails.dataMax},setNiceNumberEnabled:function(e){this._scaleDetails.niceNumberEnabled!==e&&(this._scaleDetails.niceNumberEnabled=e,this.invalidateProperties("setNiceNumberEnabled"))},setWhiteSpaceOptimizingEnabled:function(e){this._scaleDetails.whiteSpaceOptimizingEnabled=e,this.invalidateProperties("setWhiteSpaceOptimizingEnabled")},getLevels:function(){return this._levels},updateFormatter:function(){if(this.isDimension)this._formatter=this.dimensionFormatter||this._defaultFormatter;else{var e=this.getType().indices;this._formatter=1===e.length&&this.measureFormatters.length&&!a(this.measureFormatters)?this.measureFormatters[e[0]]:this.combinedMeasuresFormatter||this._defaultFormatter}this._formatter.prepare&&this._formatter.prepare()},_onAnimatitonEnd:function(){this._super(),this.rect.width>0&&this.calculateLabelSpace(this.rect)},_updateProperties:function(){h.from.call(this),this._changed=this._oldIsVertical===this.isVertical()&&"number"==typeof this._scale.plotRange&&!isNaN(this._scale.plotRange),this._oldIsVertical=this.isVertical(),this.updateFormatter(),this._isSizing||this._updateScaleAndTicks()},_updateScaleAndTicks:function(){this._calculateScale(this._calculationSize),this._generateTickObjects(this._scale,this._plotSize),this._updateTickPositions()},clear:function(){this._linearTween.end(),this._tickTween.end(),this._super()},getWidthOfValue:function(){return 1},getSnapTicksAvgWidth:function(){return this._snapTicksAvgWidth},getPositionOfValue:function(e){var t,n=this._scale.plotMin;return t=0===this._scale.plotRange?e>n?100*this._plotSize:e<n?100*-this._plotSize:this._plotSize/2:this._scale.getPositionOfValue(e),(this._isVertical&&!this._reverse||!this._isVertical&&(this._reverse||this.yMirrorMode))&&(t=this._plotSize-t),t+this._padding[this._isVertical?"top":"left"]},getNormalizedValue:function(e){var t=this._scale.plotMin;return 0===this._scale.plotRange?e>t?1:e<t?0:.5:this._scale.getNormalizedValue(e)},getPositionOfNormalizedValue:function(e){var t=this._scale.plotMin,n=this._scale.plotMax;return this.getPositionOfValue(e*(n-t)+t)},getValueOfPosition:function(e){return this._plotSize<=0?NaN:(e-=this._padding[this._isVertical?"top":"left"],(this._isVertical&&!this._reverse||!this._isVertical&&(this._reverse||this.yMirrorMode))&&(e=this._plotSize-e),this._scale.getValueOfPosition(e))},getAngleOfValue:function(e){return i.getAngleOfNormalizedValue((e-this._scale.plotMin)/(this._scale.plotMax-this._scale.plotMin),this)},getAngleOfNormalizedValue:function(e){return i.getAngleOfNormalizedValue(e,this)},isLabelSelected:function(e,t){return this._selectedRanges.some(function(n){return n.min<=e&&n.max>=t})},setSelectedRanges:function(e){this._selectedRanges=e,this._updateTickPositions()},getLabelFromPoint:function(e){if(this.isVertical())return null;var t="far"===this.getAlignment()?1:-1,n=(1+this._style.label.margin)*t,i="near"===this.getAlignment()?this.rect.height-1:0;i+=n;for(var r=null,o=0;o<this._levels.length;++o)if(i+=this._levels[o].labelSpace*t,e.y*t<i*t){r=this._levels[o];break}if(!r)return null;for(o=0;o<r.labels.length;++o){var s=r.positions[o],a=r.positions[o+1];if(e.x>=s&&e.x<a||e.x<=s&&e.x>a)return{label:r.labels[o],start:r.values[o],end:r.values[o+1]}}return null}})}),define("objects.views/charts/components/legend/legend-data",["objects.views/charts/utils/canvas-renderer"],function(e){function t(e){return e.label?e.label:e.min&&e.max?e.min+" - "+(e.isMax?"":"<")+e.max:e.max?"<"+e.max:">"+e.min}function n(e){for(var t=0;e&&e.parent;)t++,e=e.parent;return t}function i(e,t,i){var r={};if(e){var o,s,a,l,c=e.length,u=n(e[0])-t;for(o=0;o<c;o++)if(a=e[o]){for(s=0;s<u&&a.parent;)a=a.parent,s--;r[l=!isNaN(i)&&i>=0?a.getAttributeDimensions(i):a.id]?r[l].push(e[o]):r[l]=[e[o]]}}return r}var r=26,o=26,s=54,a=4,l=20,c=15,u=10,h=1,d=100;return{prepareDiscreteData:function(n,c,u,p,f,m,g){var v,y,b,x,q,C,S=[],w=0,_=o,D=Math.min(d,n.length);C=i(c,m=m||0,g),u=u||{font:"13px 'QlikView Sans'"},p>((q=e.getAverageLetterWidth(u.font)*l)+r)*n.length&&(q=p/n.length-r-h);var M={type:"text",fill:0,opacity:1,shape:{text:null,font:u.font,maxWidth:q,align:"left",baseline:"middle",maxNumLines:2}};for(v=0;v<D;v++){var A=n[v];y=A.color.toHex(),M.shape.text=t(A);var E=e.measureTextObject(M);E.height=Math.ceil(E.height),w=Math.max(w,E.width),_=Math.max(_,E.height),"range"===A.type?S.push({text:E.lines.join(" "),height:Math.max(E.height,o)*f,tipText:A.label,marker:"rect",color:y,isDimensionValue:!0,locked:!1,id:A.id,index:A.index,isMax:A.isMax,type:A.type}):S.push({text:E.lines.join(" "),tipText:A.label,height:Math.max(E.height,o)*f,marker:A.marker||"rect",color:y,isDimensionValue:!0,locked:!1,id:A.id,index:A.index,cacheItems:C[A.id],type:A.type})}return b=_,x=Math.max(w+r,s),{viewItems:S,cellHeight:b,cellWidth:x+h+2*a}},prepareContinousData:function(t,n,i){var r,o=[],s=0;for(e.setFont(n.font),r=t.length-1;r>=0;r--){var a=t[r],l={colorFrom:a.grad[0].toHex(),colorTo:a.grad[1].toHex(),maxText:i.formatValue(a.max),minText:i.formatValue(a.min),max:a.id[0],min:a.id[1],limits:a.limits};o.push(l)}var c=t.length-1,h=o[0].max>o[c].max?o[0].maxText:o[c].maxText,d=o[0].min<o[c].min?o[0].minText:o[c].minText;return s=Math.max(s,e.getTextWidth(h.substr(0,u)),e.getTextWidth(d.substr(0,u))),{viewItems:o,labelHeight:e.getFontHeight(n.font),maxLabelWidth:s+1}},prepareLegendTitle:function(t,n){var i=e.getAverageLetterWidth(n.font)*c,r={type:"text",fill:0,opacity:1,shape:{text:t,font:n.font,maxWidth:i,align:"left",baseline:"middle",maxNumLines:2}},o=e.measureTextObject(r);return{text:o.lines.join(" "),fullText:t,height:o.height,width:o.width+h}},Modes:{DISCRETE:"discrete",CONTINOUS:"continous"},constants:{PADDING:a}}}),define("objects.views/charts/components/chart-component-angular",["jquery","qvangular","./chart-component"],function(e,t,n){"use strict";return n.extend({init:function(n,i,r,o){this._super(n,i,r);var s=t.getService("$compile");this._innerContainer=e(o).appendTo(e(this.container)),s(this._innerContainer)(e(this.container).scope().$new()),this._innerScope=this._innerContainer.scope()},getInnerContainer:function(){return this._innerContainer},setYMirrorMode:function(e){this._super(e),this._innerScope.options.direction=this.readDirection},getInnerContainerScope:function(){return this._innerScope},release:function(){this._super(),this._innerContainer.remove(),this._innerContainer=null,this._innerScope.$destroy(),this._innerScope=null}})}),define("text!objects.views/charts/components/legend/color-legend.ng.html",[],function(){return'<div qva-direction x-dir-setting="{{options.yMirrorMode ? \'rtl\' : \'ltr\'}}" class="color-legend">\n    <div qv-discrete-legend\n         ng-if="discrete && visible"\n         view-items="viewItems"\n         options="options">\n    </div>\n\n\t<div qv-continous-legend\n\t\t ng-if="!discrete && visible"\n\t\t view-items="viewItems"\n\t\t options="options"></div>\n</div>\n'}),define("assets/external/numberformatter/format",[],function(){return function(e,t){if(!e||isNaN(+t))return t;var n=(t="-"==e.charAt(0)?-t:+t)<0?t=-t:0,i=e.match(/[^\d\-\+#]/g),r=i&&i[i.length-1]||".",o=i&&i[1]&&i[0]||",",e=e.split(r);t=+(t=t.toFixed(e[1]&&e[1].length))+"";var s=e[1]&&e[1].lastIndexOf("0"),a=t.split(".");(!a[1]||a[1]&&a[1].length<=s)&&(t=(+t).toFixed(s+1));var l=e[0].split(o);e[0]=l.join("");var c=e[0]&&e[0].indexOf("0");if(c>-1)for(;a[0].length<e[0].length-c;)a[0]="0"+a[0];else 0==+a[0]&&(a[0]="");(t=t.split("."))[0]=a[0];var u=l[1]&&l[l.length-1].length;if(u){for(var h=t[0],d="",p=h.length%u,f=0,m=h.length;f<m;f++)d+=h.charAt(f),!((f-p+1)%u)&&f<m-u&&(d+=o);t[0]=d}return t[1]=e[1]&&t[1]?r+t[1]:"",(n?"-":"")+t[0]+t[1]}}),define("objects.utils/number-formatter",["core.utils/class","util","assets/external/numberformatter/format"],function(e,t,n){"use strict";function i(e,t,n,i){return e=e.toString(t),n[1]===n[1].toUpperCase()&&(e=e.toUpperCase()),e.length-e.indexOf(".")>10&&(e=e.slice(0,e.indexOf(".")+11)),e.replace(".",i||".")}function r(e,t,n){var r;return p.test(t)?e=i(e,Number(/\d{2}/.exec(t)[0]),t,n):f.test(t)?e=i(e,8,t,n):m.test(t)?e=i(e,10,t,n):g.test(t)?e=i(e,16,t,n):v.test(t)?e=i(e,2,t,n):y.test(t)&&(r="",e<0&&(r="-",e=-e),e=0===(e=Math.floor(e))?"0":e<=5e5?r+(e=o(e,t)):t+r+e.toExponential(0)),e}function o(e,t){for(var n,i="",r=Number(String(e).slice(-3)),o=(e-r)/1e3,s=[0,1,4,5,9,10,40,50,90,100,400,500,900].reverse(),a=["0","I","IV","V","IX","X","XL","L","XC","C","CD","D","CM"].reverse();r>0;)for(n=0;n<s.length;n++)if(s[n]<=r){i+=a[n],r-=s[n];break}for(n=0;n<o;n++)i="M"+i;return t[1]!==t[1].toUpperCase()&&(i=i.toLowerCase()),i}function s(e){if(!e||!e.qNumericalAbbreviation)return h;var t={};return e.qNumericalAbbreviation.split(";").forEach(function(e){var n=e.split(":");2===n.length&&(t[n[0]]=n[1])}),t}function a(e,t,n){var i,r,o,s,a,u,h,p,f,m=e.pattern;m.indexOf("A")>=0&&(m=m.replace("A",""),e.abbreviate=!0),f=c(t,n),s=(o=(o=m.match(f))?o[0]:"")?m.substr(0,m.indexOf(o)):m,a=o?m.substring(m.indexOf(o)+o.length):"",o||(o=m?"#":"##########"),t&&t===n&&(r=(i=o.split(n)).pop(),o=i.join("")+n+r,t=""),u=t,t=/,/.test(n)?"":",",u&&(o=o.replace(l(u,"g"),t)),h=n,n=".",h&&(o=o.replace(l(h,"g"),n)),p=(p=o.match(/#/g))?p.length:0;var g,v=m.split(h);v[1]&&(g=v[1].match(/#|0/g)),e.prefix=s||"",e.postfix=a||"",e.pattern=m,e.maxPrecision=g?g.length:2,e.percentage=d.test(m),e.numericPattern=o||"",e.numericRegex=new RegExp(l(t,null,!0)+"|"+l(n,null,!0),"g"),e.groupTemp=u,e.decTemp=h,e.t=t,e.d=n,e.temp=p}function l(e,n,i){var r=t.escapeRegExp(e);return i?r:new RegExp(r||"",n)}function c(e,n){return n&&(n=t.escapeRegExp(n)),e&&(e=t.escapeRegExp(e)),new RegExp("(?:[#0]+"+e+")?[#0]+(?:"+n+"[#0]+)?")}var u,h={3:"k",6:"M",9:"G",12:"T",15:"P",18:"E",21:"Z",24:"Y","-3":"m","-6":"","-9":"n","-12":"p","-15":"f","-18":"a","-21":"z","-24":"y"},d=/%$/,p=/^\(r(0[2-9]|[12]\d|3[0-6])\)/i,f=/^\(oct\)/i,m=/^\(dec\)/i,g=/^\(hex\)/i,v=/^\(bin\)/i,y=/^\(rom\)/i,b=/^(\(rom\)|\(bin\)|\(hex\)|\(dec\)|\(oct\)|\(r(0[2-9]|[12]\d|3[0-6])\))/i;return u=e.extend("NumberFormatter",{init:function(e,t,n,i,r){this.localeInfo=e,this.pattern=t,this.thousandDelimiter=n||",",this.decimalDelimiter=i||".",this.type=r||"numeric",this.abbreviations=s(e),this.prepare()},clone:function(){var e=new u(this.localeInfo,this.pattern,this.thousandDelimiter,this.decimalDelimiter,this.type);return e.subtype=this.subtype,e},format:function(e,t,n,i){return this.prepare(t,n,i),this.formatValue(e)},prepare:function(e,t,n){var i;void 0===e&&(e=this.pattern),void 0===t&&(t=this.thousandDelimiter),void 0===n&&(n=this.decimalDelimiter),e?(this._prepared={positive:{d:n,t:t,abbreviate:!1,isFunctional:!1,prefix:"",postfix:""},negative:{d:n,t:t,abbreviate:!1,isFunctional:!1,prefix:"",postfix:""}},i=this._prepared,e=e.split(";"),i.positive.pattern=e[0],i.negative.pattern=e[1],b.test(e[0])&&(i.positive.isFunctional=!0),e[1]?b.test(e[1])&&(i.negative.isFunctional=!0):i.negative=!1,i.positive.isFunctional&&(!i.negative||i.negative&&i.negative.isFunctional)||(a(i.positive,t,n),i.negative&&a(i.negative,t,n))):this._prepared={pattern:!1}},formatValue:function(e){var t,i,o,s,a,l,c,u,h,d=this._prepared,p="",f="";if(isNaN(e))return e;if(!1===d.pattern)return e.toString();if(e<0&&d.negative?(d=d.negative,e=-e):d=d.positive,a=d.d,l=d.t,d.isFunctional)e=r(e,d.pattern,a);else{if(d.percentage&&(e*=100),d.abbreviate){var m,g=this.abbreviations,v=Object.keys(g).map(function(e){return parseInt(e)}).sort(function(e,t){return e>t?1:-1}),y=v[0];for(c=0,i=Number(Number(e).toExponential().split("e")[1]);y<=i&&c<v.length;)y=v[++c];c>0&&(m=v[c-1]);var b;m&&i>0&&m>0?b=m:(i<0&&m<0||!m)&&(y<0&&y-i<=d.maxPrecision?b=y:m<=i&&!(y>0&&-i<=d.maxPrecision)&&(b=m)),b&&(p=g[b],e/=Math.pow(10,b))}if(o=Math.abs(e),t=d.temp,u=d.numericPattern,h=u.split(a)[1],"I"===this.type&&(e=Math.round(e)),s=e,h||"#"!==u.slice(-1)[0])if(o>=1e15||o>0&&o<=1e-14)e=o?o.toExponential(15).replace(/\.?0+(?=e)/,""):"0";else{var x=Number(e.toFixed(Math.min(20,h?h.length:0)).split(".")[0]),q=u.split(a)[0];if(q+=a,e=n(q,x)||"0",h){var C=Math.max(0,Math.min(14,h.length)),S=h.replace(/#+$/,"").length,w=Number((o%1).toPrecision(C)).toFixed(C);for(c=(w=w.slice(2).replace(/0+$/,"")).length;c<S;c++)w+="0";w&&(e+=a+w)}else 0===x&&(s=0)}else if(o>=Math.pow(10,t)||o<1||o<1e-4)0===e?e="0":o<1e-4||o>=1e20?(e=(e=s.toExponential(Math.max(1,Math.min(14,t))-1)).replace(/\.?0+(?=e)/,""),f=""):(e=e.toPrecision(Math.max(1,Math.min(14,t)))).indexOf(".")>=0&&(e=(e=e.replace(e.indexOf("e")<0?/0+$/:/\.?0+(?=e)/,"")).replace(".",a));else{for(u+=a,t=Math.max(0,Math.min(20,t-Math.ceil(Math.log(o)/Math.log(10)))),c=0;c<t;c++)u+="#";e=n(u,e)}e=e.replace(d.numericRegex,function(e){return e===l?d.groupTemp:e===a?d.decTemp:""}),s<0&&!/^\-/.test(e)&&(e="-"+e)}return d.prefix+e+f+p+d.postfix}}),window.NumberFormatter=u,u.getStaticFormatter=function(){return{prepare:function(){},formatValue:function(e){return e+""}}},u}),define("text!objects.views/charts/components/legend/continous-legend.ng.html",[],function(){return'<div class="qv-continous-color-legend"\n\t ng-class="cclOrientationClass"\n\t ng-style="options.titleStyle">\n\t<div class="cl-title ccl-title"\n\t\t ng-if="options.legendTitle"\n\t\t ng-class="cclOrientationClass">\n\t\t<div qva-direction x-dir-text="{{options.legendTitle}}" x-dir-setting="{{options.yMirrorMode ? \'rtl\' : \'ltr\'}}" class="ccl-title-inner"\n\t\t\t title="{{options.legendTitleTooltip}}">{{options.legendTitle}}</div>\n\t</div>\n    <div class="ccl-gradient"\n\t\t ng-class="cclOrientationClass"\n\t\t tid="ccl.gradient">\n        <div class="ccl-axis" ng-class="cclOrientationClass"  ng-style="options.labelStyle">\n\t\t\t<div ng-repeat="axisVal in axisValues track by $index" class="ccl-axis-value" ng-class="{\'first\': $first, \'last\':$last}" dir="ltr">{{axisVal}}</div>\n            \x3c!--\n                <div class="ccl-axis-top-value">{{axisValues[1]}}</div>\n                <div class="ccl-axis-bottom-value">{{axisValues[0]}}</div>\n                --\x3e\n        </div>\n\t\t<div class="ccl-gradient-color"\n\t\t\t ng-class="cclOrientationClass"\n\t\t\t qva-apply-style="cclGradientStyle">\n\t\t</div>\n\t\t<div dir="ltr" class="ccl-range"\n\t\t\t ng-show="selectionEnabled && !isLocked"\n\t\t\t ng-style="cclRangeStyle"\n\t\t\t ng-class="cclOrientationClass">\n\t\t\t<div ng-show="active" class="ccl-range-inner"\n\t\t\t\t ng-class="cclOrientationClass"\n\t\t\t\t ng-style="rangeStyle">\n\t\t\t\t<div class="ccl-axis-cover"\n\t\t\t\t\t ng-style="active && cclCoverStyle"\n\t\t\t\t\t tid="ccl.cover"\n\t\t\t\t\t ng-class="{\'active\' : activeOptions.cover}"></div>\n\t\t\t\t<div class="ccl-far-edge"\n\t\t\t\t\t tid="ccl.edge.far"\n\t\t\t\t\t ng-class="{\'active\' : activeOptions.far}">\n\t\t\t\t</div>\n\t\t\t\t<div class="ccl-near-edge"\n\t\t\t\t\t tid="ccl.edge.near"\n\t\t\t\t\t ng-class="{\'active\' : activeOptions.near}">\n\t\t\t\t</div>\n\t\t\t\t<div class="ccl-outer-bubble-wrapper"\n\t\t\t\t\t ng-class="active && cclOrientationClass">\n                    <qva-range-selection-bubble visible="active" active-component="fakeAxis" handle-points="handlePoints" horizontal="!options.vertical" far="false" data="values.start" active="activeOptions.near" tid="ccl.bubble.near"> </qva-range-selection-bubble>\n                    <qva-range-selection-bubble visible="active" active-component="fakeAxis" handle-points="handlePoints" horizontal="!options.vertical" far="true" data="values.end" active="activeOptions.far" tid="ccl.bubble.far"> </qva-range-selection-bubble>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>'}),define("general.directives/apply-style",["jquery","qvangular"],function(e,t){t.directive("qvaApplyStyle",function(){return{restrict:"A",link:function(t,n,i){t.$watch(i.qvaApplyStyle,function(t){"string"===e.type(t)&&n.attr("style",t)},!1)}}})}),define("objects.views/charts/components/legend/qv-continous-legend",["touche","qvangular","text!./continous-legend.ng.html","general.utils/shapes/point","general.directives/apply-style"],function(e,t,n,i){function r(e,t){if(!e||e.length!==t){for(var n=[],i=1/t*2,r=0;r<t/2;r++)n.push(i*r),n.push(i*(r+1));return n}return e}function o(e,t,n,i){var o="";i=r(i,e.length);for(var s=e.length,a=0;a<s-1;a+=2)o+=", "+e[a]+" "+100*i[a]+"%",o+=", "+e[a+1]+" "+100*i[a+1]+"%";return"background: linear-gradient(to "+(n?t?"bottom":"top":t?"left":"right")+o+")"}function s(e,t,n){return t?e[0][n]>e[1][n]?0:1:e[0][n]<e[1][n]?0:1}function a(e){return["left","bottom"].contains(e)}function l(e,t,n){var i=n?t.height():t.width(),r=n?"y":"x";e[0][r]=p(f(e[0][r],0),i),e[1][r]=p(f(e[1][r],0),i)}function c(e,t,n,r){var o=[];return n?(o[t]=new i(e[t].x,e[t].y+r),o[1^t]=e[1^t]):(o[t]=new i(e[t].x+r,e[t].y),o[1^t]=e[1^t]),o}function u(e,t){var n=e.find(".ccl-axis");return t?n.outerWidth():n.outerHeight()}function h(e,t){return{vertical:e.options.vertical,direction:e.options.vertical?"y":"x",grt:e.options.vertical?t:!t}}var d=".legendRangeSelection",p=Math.min,f=Math.max;t.directive("qvContinousLegend",function(){return{template:n,replace:!0,scope:!0,link:function(t,n){function r(e){if(t.positionToFormattedValue&&e){var n,i;return t.options.vertical?(n=w.rangeElement.height(),i=1-e.y/n):(n=w.rangeElement.width(),i=e.x/n),t.positionToFormattedValue(i)}return e+""}function p(){if(!S&&t.selectionEnabled){S=!0;var n,r="hey";e(w.gradient[0]).swipe({id:d,options:{preventDefault:!0},start:function(i,r){if(!t.isLocked){var o=r.pagePoints[0];n=x(o.x,o.y),e.preventGestures(this.gestureHandler),g(i,r)}},update:function(e,i){if(!t.isLocked){t.active=!0,t.swiping=!0;var r=i.pagePoints[0];t.handlePoints=[n,x(r.x,r.y)],t.updateHandlePoints(t.handlePoints),t.$digest()}},end:function(){t.isLocked?v():(t.swiping=!1,b())}}),e(w.axisCover[0]).tap({id:d,options:{preventDefault:!0},start:function(){e.preventGestures(this.gestureHandler)}}).swipe({id:d,options:{preventDefault:!0},start:function(n,i){r=t.handlePoints,e.preventGestures(this.gestureHandler),g(n,i),t.activeOptions.cover=!0},update:function(e,n){var o=t.options.vertical?n.swipe.deltaY:0,s=t.options.vertical?0:n.swipe.deltaX;t.handlePoints=[new i(r[0].x+s,r[0].y+o),new i(r[1].x+s,r[1].y+o)],t.updateHandlePoints(t.handlePoints),t.$digest()},end:function(){b(),t.activeOptions.cover=!1}}),e.utils.touch||(f(w.farEdge[0],!1),f(w.nearEdge[0],!0)),t.$broadcast("on")}}function f(n,i){var r,o,a,l=h(t,i);e(n).tap({id:d,options:{preventDefault:!0},start:function(){e.preventGestures(this.gestureHandler)}}).swipe({id:d,options:{radiusThreshold:0},start:function(n,a){l=h(t,i),o=s(t.handlePoints,l.grt,l.direction),r=t.handlePoints,e.preventGestures(this.gestureHandler),g(n,a)},update:function(e,n){t.handlePoints=c(r,o,l.vertical,l.vertical?n.swipe.deltaY:n.swipe.deltaX),t.updateHandlePoints(t.handlePoints),t.activeOptions.near=t.activeOptions.far=!1,a=s(t.handlePoints,l.grt,l.direction)?"far":"near",t.activeOptions[a]=!0,t.$digest()},end:function(){b(t.handlePoints),t.activeOptions.near=t.activeOptions.far=!1,t.$digest()}})}function m(){t.active=!1,Object.keys(w).forEach(function(t){e(w[t][0]).off("*",d)}),S=!1,t.$broadcast("off")}function g(e,n){t.$emit("rangeStart",e,n)}function v(){t.$emit("selectWhileLocked")}function y(e,n){t.$emit("rangeUpdate",e,t.options.vertical?w.rangeElement.height():w.rangeElement.width(),n)}function b(){var e;t.options.vertical&&t.handlePoints[0].y<t.handlePoints[1].y?((e=[])[1]=t.handlePoints[0],e[0]=t.handlePoints[1],t.handlePoints=e):!t.options.vertical&&t.handlePoints[0].x>t.handlePoints[1].x&&((e=[])[1]=t.handlePoints[0],e[0]=t.handlePoints[1],t.handlePoints=e),t.$emit("rangeEnd")}function x(e,t){var n=w.rangeElement.offset();return new i(e-n.left,t-n.top)}function q(e,i,r){w.nearBubbleWrapper||(w.nearBubbleWrapper=n.find(".ccl-outer-bubble-wrapper .bubble-wrapper.near"),w.nearBubble=n.find(".ccl-outer-bubble-wrapper .bubble-wrapper.near .bubble"),w.farBubbleWrapper=n.find(".ccl-outer-bubble-wrapper .bubble-wrapper.far"),w.farBubble=n.find(".ccl-outer-bubble-wrapper .bubble-wrapper.far .bubble")),w.nearBubbleWrapper.css(t.cclBubbleNearStyle),w.farBubbleWrapper.css(t.cclBubbleFarStyle);var o=C(e,r);o=o>0?o:0,r?w.nearBubble.css({"margin-left":Math.round(o)+"px"}):w.farBubble.css({"margin-right":Math.round(o)+"px"})}function C(e,t){return e?0:t?n.offset().left-(w.nearBubbleWrapper.offset().left-.5*w.nearBubbleWrapper.width()-5):w.farBubbleWrapper.offset().left-n.offset().left+1.5*w.farBubbleWrapper.width()+5-n.width()}var S=!1,w={gradient:n.find(".ccl-gradient"),rangeElement:n.find(".ccl-range"),rangeInner:n.find(".ccl-range-inner"),axisCover:n.find(".ccl-axis-cover"),nearEdge:n.find(".ccl-near-edge"),farEdge:n.find(".ccl-far-edge")};t.fakeAxis={getPositionOfValue:function(e){var n=t.viewItems[0].min,i=(e-n)/(t.viewItems[t.viewItems.length-1].max-n),r=t.options.vertical?w.rangeElement.height():w.rangeElement.width();return(t.options.vertical||!t.options.vertical&&t.options.yMirrorMode)&&(i=1-i),i*r},isDiscrete:function(){return!1}},t.activeOptions={far:!1,near:!1,cover:!1},t.values={start:{},end:{}},t.setRangeStyle=function(e){if(e&&2===e.length){t.relevantSize=u(n,t.options.vertical);var i=e[0],r=e[1],o=t.options.vertical?"y":"x";t.options.vertical?t.rangeStyle={height:Math.abs(i[o]-r[o]),top:Math.min(i[o],r[o])}:t.rangeStyle={width:Math.abs(i[o]-r[o]),left:Math.min(i[o],r[o])}}},t.updateHandleValues=function(e,n){if(l(e,w.rangeElement,t.options.vertical),t.setRangeStyle(e),t.active){var i=t.options.vertical?"y":"x",o=t.options.vertical?w.rangeElement.height():w.rangeElement.width(),c=e[s(t.handlePoints,t.options.vertical,i)],u=e[s(t.handlePoints,!t.options.vertical,i)];if(t.values.start.text=t.cclNearValueLabel=r(c),t.values.end.text=t.cclFarValueLabel=r(u),n){if(n.switch){var h=t.values.start.value;t.values.start.value=t.values.end.value,t.values.end.value=h}var d=t.viewItems[0].min,p=t.viewItems[t.viewItems.length-1].max;0===n.index?t.values.start.value=Math.max(Math.min(n.value,p),d):t.values.end.value=Math.max(Math.min(n.value,p),d)}else t.options.vertical?(t.values.start.value=t.positionToValue((o-c[i])/o),t.values.end.value=t.positionToValue((o-u[i])/o)):(t.values.start.value=t.positionToValue(c[i]/o),t.values.end.value=t.positionToValue(u[i]/o))}if(t.active&&t.options){a(t.options.dock);q(t.options.vertical,0,!1),q(t.options.vertical,0,!0)}},t.updateHandlePoints=function(e){e&&(t.updateHandleValues(e),y(t.handlePoints))},t.$on("rangeUpdate",function(e,n,i,r){isNaN(i)&&(t.handlePoints=[n[0],n[1]],t.updateHandleValues(t.handlePoints,r),t.$digest(),y(n,r),e.stopPropagation())}),t.$watchCollection("[viewItems, options.yMirrorMode, options.vertical]",function(e){var n=e[0],i=e[1],r=e[2],s=i&&!r;if(n&&n.length){for(var a=[],l=[],c=0;c<n.length;c++)a.push(n[c].colorTo),a.push(n[c].colorFrom),n[c].limits&&(l.push(n[c].limits[0]),l.push(n[c].limits[1]));t.cclGradientStyle=o(a,s,r,l);var u=[n[0].minText,n[n.length-1].maxText];r&&u.reverse(),t.axisValues=u}});var _={right:"",bottom:""},D={right:"0px",bottom:""},M={bottom:"0px",right:""};t.$watchCollection("[options.vertical, options.dock, relevantSize]",function(e){var n=e[0],i=a(e[1]),r=e[2];t.cclOrientationClass={vertical:n,horizontal:!n,near:i,far:!i},i?(t.cclCoverStyle=n?{left:"0px",width:r+"px"}:{bottom:"0px",height:r+"px"},t.cclBubbleNearStyle=n?_:M,t.cclBubbleFarStyle=n?_:M):(t.cclCoverStyle=n?{right:"0px",width:r+"px"}:{top:"0px",height:r+"px"},t.cclBubbleNearStyle=n?D:_,t.cclBubbleFarStyle=n?D:_)}),p.call(this),t.$watch("selectionEnabled",function(e){e?p.call():m.call()}),t.$on("$destroy",function(){m.call()}),t.$on("cancelSelection",function(){t.active=!1})}}})}),define("text!objects.views/charts/components/legend/discrete-legend.ng.html",[],function(){return'<div class="qv-discrete-color-legend"\n\t ng-class="{ \'vertical\': options.vertical }"\n\t ng-style="options.labelStyle">\n\t<div class="cl-title dcl-title"\n\t\t ng-if="options.legendTitle && options.legendTitle.length"\n\t\t ng-style="options.titleStyle"\n\t\t ng-class="{\'vertical\': options.vertical }">\n\t\t<div class="dcl-title-inner" title="{{options.legendTitleTooltip}}" qva-direction x-dir-text="{{options.legendTitle}}" x-dir-setting="{{options.yMirrorMode ? \'rtl\' : \'ltr\'}}">{{options.legendTitle}}</div>\n\t</div>\n\t<div class="dcl-flex" ng-class="{\'align\': align, \'vertical\': options.vertical, \'in-selections\': selectionsApi.active }"\n\t\t qv-selections-toggle-dimension-value="{ selector: \'.color-item\', itemKey: \'item\' }"\n\t\t qv-selections-on-toggle-dimension-value="selectionEnabled && !isScrolling && select($event, item)">\n\t\t<div ng-repeat="item in viewItems track by $index"\n\t\t\t ng-style="{\'height\':item.height,  \'width\': (options.vertical ? \'auto\' : options.cellWidth)}"\n\t\t\t class="color-item" ng-class="{\'selected\': item.selected}"\n\t\t\t tid="dcl.item">\n\t\t\t<div class="marker">\n\t\t\t\t<div ng-style="item.markerClass[\'glyph-triangle\']  ? {\'border-bottom-color\': item.color} : ( item.markerClass[\'glyph-inverse-triangle\'] ? {\'border-top-color\': item.color} : {background: item.color} )" ng-class="item.markerClass"></div>\n\t\t\t</div>\n\t\t\t<div qva-direction x-dir-text="{{item.text}}" class="text"\n\t\t\t\t title="{{item.tipText}}">{{item.text}}</div>\n\t\t</div>\n\t</div>\n\t<div class="dcl-buttons-v" ng-show="options.vertical && overflow">\n\t\t\x3c!--DOWN--\x3e\n\t\t<button class="dcl-down lui-fade-button" ng-disabled="!interactionEnabled || scrollAtEnd" tid="dcl.down">\n\t\t\t<span class="lui-button__icon lui-icon lui-icon--triangle-bottom"></span>\n\t\t</button>\n\t\t\x3c!--UP--\x3e\n\t\t<button class="dcl-up lui-fade-button" ng-disabled="!interactionEnabled || scrollAtStart" tid="dcl.up">\n\t\t\t<span class="lui-button__icon lui-icon lui-icon--triangle-top"></span>\n\t\t</button>\n\t</div>\n\t<div class="dcl-buttons-h" ng-show="!options.vertical && overflow">\n\t\t\x3c!--RIGHT--\x3e\n\t\t<button class="dcl-right lui-fade-button" ng-disabled="!interactionEnabled || scrollAtEnd" tid="dcl.right">\n\t\t\t<span class="lui-button__icon lui-icon lui-icon--triangle-right"></span>\n\t\t</button>\n\t\t\x3c!--LEFT--\x3e\n\t\t<button class="dcl-left lui-fade-button" ng-disabled="!interactionEnabled || scrollAtStart" tid="dcl.left">\n\t\t\t<span class="lui-button__icon lui-icon lui-icon--triangle-left"></span>\n\t\t</button>\n\t</div>\n</div>\n'}),define("objects.grid/directives/selections",["qvangular","jquery","touche"],function(e,t,n){"use strict";e.directive("qvSelectionsToggleValue",["$parse",function(e){return{restrict:"A",link:function(n,i,r){var o=e(r.qvSelectionsToggleValue)(),s=o.selector,a="."+n.$id+"-toggle-value",l=o.itemKey||"cell";i.on("qv-activate"+a,s,function(e){var i=t(e.target).closest(s),o=i.scope()[l];i.length&&o&&n.$apply(function(){var t={$event:e};t[l]=o,n.$eval(r.qvSelectionsOnToggleValue,t)})}),n.$on("$destroy",function(){i.off(a)})}}}]),e.directive("qvSelectionsToggleDimensionValue",["$parse",function(e){return{restrict:"A",link:function(n,i,r){var o=e(r.qvSelectionsToggleDimensionValue)(),s=o.selector,a="."+n.$id+"-toggle-dimension-value",l=o.itemKey||"cell";i.on("qv-activate"+a,s,function(e){var i=t(e.target).closest(s).scope()[l];n.$eval(r.qvSelectionsExcludeToggleDimensionValue,{$event:e})||i&&i.isDimensionValue&&(i.locked?n.$eval(r.qvSelectionsSelectWhileLocked):n.$apply(function(){var t={$event:e};t[l]=i,n.$eval(r.qvSelectionsOnToggleDimensionValue,t)}))}),n.$on("$destroy",function(){i.off(a)})}}}]),e.directive("qvSelectionsMultiselect",["$parse",function(e){return{restrict:"A",controller:function(){},link:function(i,r,o,s){function a(){return n(r[0]).tap({id:g,options:{preventDefault:!1},start:function(e){h=t(e.target).closest(f)}}),n(r[0]).swipe({id:g,options:{radiusThreshold:4,preventDefault:!1},start:function(e){var t,r;if(n.utils.isMouse(e)&&h.length)if((t=h.scope()[m]).isDimensionValue){if(t.locked)return i.$eval(o.qvSelectionsSelectWhileLocked),void this.cancel();d=t,(r={$event:e})[m]=t,i.$apply(i.$eval(o.qvSelectionsStartMultiselect,r))}else this.cancel();else this.cancel()},update:function(e){var n,r=t(e.target).closest(f);r.length&&(n=r.scope()[m],i.$apply(i.$eval(o.qvSelectionsUpdateMultiselect,{start:d,current:n,dataColIx:n.dataColIx})))},end:function(e){i.$apply(i.$eval(o.qvSelectionsEndMultiselect,{$event:e}))}}),function(){n(r[0]).off("*",g)}}function l(){return n(r[0]).tap({id:v,options:{touches:2,preventDefault:!1},end:function(e,n){var r,s,a,l,c,u,h,d=n.pagePoints[0],p=n.pagePoints[1];r=d?t(document.elementFromPoint(d.x,d.y)):void 0,s=p?t(document.elementFromPoint(p.x,p.y)):void 0,a=r?r.closest(f).scope():void 0,l=s?s.closest(f).scope():void 0,c=a?a[m]:void 0,u=l?l[m]:void 0,c&&u&&c.isDimensionValue&&u.isDimensionValue&&(c.locked||u.locked?i.$eval(o.qvSelectionsSelectWhileLocked):i.$apply(function(){(h={offsetLeft:r[0].offsetLeft,width:r[0].clientWidth,$event:e})[m]=c,i.$eval(o.qvSelectionsStartMultiselect,h),i.$eval(o.qvSelectionsUpdateMultiselect,{start:c,current:u,dataColIx:c.dataColIx}),i.$eval(o.qvSelectionsEndMultiselect,{$event:e})}))}}),function(){n(r[0]).off("*",v)}}var c,u,h,d,p=e(o.qvSelectionsMultiselect)(),f=p.selector,m=p.itemKey||"cell",g=i.$id+"-multiselect",v=i.$id+"-2finger-multiselect";s.on=function(){c||(c=a()),u||(u=l())},s.off=function(){c&&(c(),c=void 0),u&&(u(),u=void 0)},i.$watch("interactive",function(e){void 0!==e&&(e?s.on():s.off())}),i.$on("$destroy",function(){s.off()})}}}])}),define("objects.views/charts/components/legend/qv-discrete-legend",["assets/qvangular/qvangular-core","text!./discrete-legend.ng.html","touche","objects.utils/event-utils","client.utils/rtl/rtl-util","objects.grid/directives/selections"],function(e,t,n,i,r){var o=5,s=10,a=".discretelegend";e.directive("qvDiscreteLegend",["$timeout",function(e){return{template:t,replace:!0,scope:!0,link:function(t,l){function c(e,n){var i=t.viewItems;if(!i)return 0;var r=0,o=0;if(n)for(;o!==e&&o<i.length;)r+=i[o].height,o++;else r=e*t.options.cellWidth;return r}function u(){return t.options.vertical?y.scrollTop():y.scrollLeft()}function h(e){d(u(),e*(t.options.vertical?1:-1))}function d(e,n,i){var o;o=t.options.vertical?{scrollTop:e+n+"px"}:{scrollLeft:r.getScrollPos("rtl"===t.options.direction,e,n)+"px"},y.animate(o,i?200:0)}function p(e,n){var i=t.viewItems;if(!i)return null;var o,s,a=i[0],l=0,c=0;if(n){for(;l<e&&c<i.length;)l+=(a=i[c]).height,c++;e+y.height()>=y[0].scrollHeight?(l=e,o=!0):Math.abs(e-l)>Math.abs(e-(l-a.height))&&(c--,l-=a.height),s=c<=0}else l=Math.round(e/t.options.cellWidth)*t.options.cellWidth,c=Math.abs(Math.round(e/t.options.cellWidth)),e+y.width()>=y[0].scrollWidth&&(l=e,c++),"rtl"!==t.options.direction||"default"===r.scrollImplementation?(o=y.width()/t.options.cellWidth>=i.length/Math.floor(y.height()/t.options.cellHeight)-c,s=l<=0):(s=y.width()/t.options.cellWidth>=i.length/Math.floor(y.height()/t.options.cellHeight)-c,o=c>=0);return{position:l,index:c,end:o,start:s}}function f(n,i,r){r=r||0;var o=u(),s=p(o+r,n);s&&(s.position!==o&&(y.stop(!0),d(s.position,0,i)),e(function(){t.scrollAtEnd=s.end,t.scrollAtStart=s.start}),t.$emit("scrollPositionChanged",s.index))}function m(e,i,r){var c=!1,u=l.find(e).first();n(l.find(e)[0]).longtap({id:a,options:{timeThreshold:1e4},update:function(e,a){a.percentage>2&&t.interactionEnabled&&(g(i*(r?o:s)),c=!0,u.addClass("lui-active"),n.preventGestures(this.gestureHandler))},end:function(){c=!1,u.removeClass("lui-active"),n.preventGestures(this.gestureHandler)},cancel:function(){u.removeClass("lui-active"),n.preventGestures(this.gestureHandler)}}).tap({end:function(){t.interactionEnabled&&(c?f(r,!0):(g(i*(r?t.options.cellHeight:t.options.cellWidth)),f(r,!1)),c=!1)}})}function g(e){h(e)}function v(e){n(y[0]).off(),n(e.find(".dcl-up")[0]).off(),n(e.find(".dcl-down")[0]).off(),n(e.find(".dcl-left")[0]).off(),n(e.find(".dcl-right")[0]).off()}var y=l.find(".dcl-flex");t.$watch("viewItems",function(e){e&&e.forEach(function(e){for(var t={},n=Array.isArray(e.marker)?e.marker:[e.marker],i=0;i<n.length;i++)switch(n[i]){case"line":case"!line":t["glyph-line"]=!0;break;case"triangle":case"!triangle":t["glyph-triangle"]=!0;break;case"inverse-triangle":case"!inverse-triangle":t["glyph-inverse-triangle"]=!0;break;case"diamond":case"!diamond":t["glyph-diamond"]=!0;break;case"circle":case"!circle":t["glyph-circle"]=!0;break;case"rect":case"!rect":default:t["glyph-rect"]=!0}e.markerClass=t})}),t.$on("clearSelection",function(){if(t.viewItems){t.selectedValues=[];for(var e=0;e<t.viewItems.length;e++)t.viewItems[e].selected=!1}}),t.$on("invalidateSelections",function(){if(t.viewItems){t.selectedValues=[];for(var e=0;e<t.viewItems.length;e++){var n=t.viewItems[e];"dimension"===n.type&&(t.selectionsCache?n.selected=t.selectionsCache.isValueSelected(n.id[0]):"dimension"===n.type&&n.cacheItems&&n.cacheItems[0]&&(n.selected=n.cacheItems[0].selected))}}t.$digest()}),t.select=function(e,n){"others"!==n.type&&("range"===n.type&&(n.selected=!n.selected),t.$emit("toggleSelect",e,[n]),"dimension"===n.type&&t.selectionsCache&&(n.selected=t.selectionsCache.isValueSelected(n.id[0])))},t.$on("$destroy",function(){v(l)}),t.$watch("explicitScrollPosition",function(e){t.explicitScrollPosition=e}),t.$on("updateSize",function(){if(f(t.options.vertical,!0),void 0!==t.explicitScrollPosition){var e=c(t.explicitScrollPosition,t.options.vertical);t.options.vertical?y.scrollTop(e):y.scrollLeft(e)}t.options.vertical?t.overflow=y[0].scrollHeight-y.height()>1:t.overflow=y[0].scrollWidth-y.width()>1}),function(e,t){var r=null,o=i.throttle(function(e){if(t.interactionEnabled){var n;n=(i.getMouseWheelData(e.originalEvent).delta>0?-1:1)*(t.options.vertical?t.options.cellHeight:t.options.cellWidth),t.options.yMirrorMode&&!t.options.vertical&&(n=-n),f(t.options.vertical,!1,n)}},20);y.on("mousewheel"+a+" DOMMouseScroll"+a,function(e){o(e),e.preventDefault(),e.stopPropagation()}),m(".dcl-up",-1,!0),m(".dcl-down",1,!0),m(".dcl-left",-1,!1),m(".dcl-right",1,!1),n(y[0]).swipe({options:{useMomentum:!0,inertia:.7,preventDefault:!0},start:function(e){t.interactionEnabled&&(r=u(),t.isScrolling=!0,n.preventGestures(this.gestureHandler),e.preventDefault())},update:function(e,n){if(null!==r&&n.swipe){var i=n.swipe.distance;t.options.vertical?"up"===n.swipe.direction?d(r,-i):"down"===n.swipe.direction&&d(r,i):"left"===n.swipe.direction?d(r,i):"right"===n.swipe.direction&&d(r,-i)}},end:function(){null!==r&&(f(t.options.vertical,!0),t.isScrolling=!1,r=null)}})}(0,t)}}}])}),define("objects.views/charts/components/legend/basic-color-legend",["jquery","translator","./legend-data","client.utils/state","../chart-component-angular","text!./color-legend.ng.html","objects.utils/number-formatter","objects.views/charts/chart-style-service","core.utils/feature-flags","client.utils/theme/theme-module","./qv-continous-legend","./qv-discrete-legend"],function(e,t,n,i,r,o,s,a,l,c){function u(e,t){return"normal "+parseInt(e)*t+"px 'QlikView Sans'"}function h(e,t){return l.THEMING?{backgroundColor:e.getStyle("legend","backgroundColor"),label:{font:u(e.getStyle("legend.label","fontSize"),t),lineHeight:"1em"},scaledLabel:{font:u(e.getStyle("legend.label","fontSize"),t),color:e.getStyle("legend.label","color"),lineHeight:"1em"},ticks:{color:"#a6a6a6",length:8},line:{color:"#666666"},title:{font:u(e.getStyle("legend.title","fontSize"),t),lineHeight:"1em"},scaledTitle:{font:u(e.getStyle("legend.title","fontSize"),t),color:e.getStyle("legend.title","color"),lineHeight:"1.2em"}}:{backgroundColor:e.getValue(b,null,"backgroundColor"),label:{font:e.getFont(b,"label"),lineHeight:"1em"},scaledLabel:{font:e.getFont(b,"label",null,null,null,t),color:e.getValue(b,"label","color"),lineHeight:"1em"},ticks:{color:"#a6a6a6",length:8},line:{color:"#666666"},title:{font:e.getFont(b,"title"),lineHeight:"1em"},scaledTitle:{font:e.getFont(b,"title",null,null,null,t),color:e.getValue(b,"title","color"),lineHeight:"1.2em"}}}function d(e){return e&&"primary"!==e.colorMode}function p(e,t,n){var i={};return i.maxItemsPerRow=Math.floor((e.width-(n.show?n.width:0))/t.cellWidth),i.numRows=Math.ceil(t.viewItems.length/i.maxItemsPerRow),i.itemsPerRow=Math.ceil(t.viewItems.length/i.numRows),i.w=i.itemsPerRow*t.cellWidth,i.h=Math.ceil(Math.max(n.height,Math.min(t.cellHeight*v,i.numRows*t.cellHeight))),i}function f(e,t,n){return(n?Math.max(e.width,t.maxLabelWidth+y+5):Math.max(t.labelHeight+y,e.height))+20}function m(e){return i.state===i.States.analysis||i.state===i.States.play&&(!e||!e.isSnapshot)}var g,v=2,y=17,b="legend",x=c.get();return g=r.extend("BasicColorLegend",{init:function(){var e=Array.prototype.slice.call(arguments);e.push(o),this._super.apply(this,e),l.THEMING?this._styleService=x.initializeService("object."+this.options.parentType):this._styleService=a.getInstance(),this._legendContainer=this.getInnerContainer(),this._dataInvalid=!0,this.$scope=this.getInnerContainerScope(),this._scrollPosition=0,this._mode={}},release:function(){this._super(),this.$scope=null,this._legendContainer=null},setColorMap:function(e){this._colorMap=e,this.invalidateProperties("Legend.setColorMap"),this.invalidateDisplay("Legend.setColorMap")},getColorMap:function(){return this._colorMap},setProperties:function(e){return this._legendProperties=e,this._dataInvalid=!0,this.invalidateProperties("BasicColorMap.setProperties")},setExternalColorItems:function(e){if(e&&e[0]&&e[0].qMatrix&&this._colorMap){this._externalDataPage=e;var n=e[0].qMatrix,i=[];this._colorDataInfo=this._colorMap.getColorDataInfo();for(var r=0;r<n.length;r++){var o=n[r];i.push({id:[o[1].qNum],index:r,label:o[0].qText,type:"dimension"})}this._colorDataInfo&&this._colorDataInfo.hasOthers&&i.push({id:[-3],index:i.length,label:t.get("properties.dimensionLimits.others"),type:"others"}),this._externalColorItems=i}else this._externalColorItems=null;this.invalidateProperties("Legend.setExternalColorItems")},getExternalDataPage:function(){return this._externalDataPage},isVisible:function(e){return this._super(e)&&this.hasValidData()&&d(this._mode)&&this._legendProperties&&this._legendProperties.show},updateSize:function(){this._super(),this.invalidateProperties("LegendLight.calculateRelevantSize"),this.updateNow(["properties"]),this._dataInvalid=!0},_updateProperties:function(){if(!this._colorMap||!this._legendProperties)return this._clearScope(this.$scope),!1;if(this._colorDataInfo=this._colorMap.getColorDataInfo(),this._mode=this._colorDataInfo.legendMode||{},this._marker=this._colorMap.getLegendDataProvider()?this._colorMap.getLegendDataProvider().getLegendMarker():"rect",!this._mode.colorMode||this._colorDataInfo.altMode&&!this._externalColorItems&&"dimension"===this._mode.colorMode)return this._clearScope(this.$scope),!1;var t,i=h(this._styleService,this.chartScale);return this._externalColorItems&&"dimension"===this._mode.colorMode?((t=this._externalColorItems).forEach(function(e){e.color=this._colorMap.getColorFromPreScaledValue(e.id[0],e.label),e.marker=this._marker}.bind(this)),t=t.filter(function(e){return!e.color.isInvalid()}).slice(0,100)):t=(t=this._colorMap.getColorMapping().concat()).filter(function(e){return!e.color.isInvalid()}),this._mode.showTitle=this._data.legend.showTitle,this.isVisible()&&t&&t.length?(this.$scope.visible=!0,this.$scope.selectionEnabled=!1,this.$scope.interactionEnabled=m(this.backendApi),this._mode.showTitle?(this._titleMetrics=n.prepareLegendTitle(this._colorMap.getLegendTitle(),i.title),this._titleMetrics.show=this._mode.showTitle):this._titleMetrics={show:!1,width:0,height:0},this._mode.discrete?(this._legendMetrics=n.prepareDiscreteData(t,this._selectableShapes,i.label,this.rect.width-(this._mode.showTitle&&this.isHorizontal()?this._titleMetrics.width:0),this.chartScale,this._colorMap.getDimensionIndex()[0],this._colorDataInfo.attrIndex),this.$scope.viewItems=this._legendMetrics.viewItems):(this._formatter=this._colorMap.getValueFormatter()||s.getStaticFormatter(),this._formatter.prepare(),this._legendMetrics=n.prepareContinousData(t,i.label,this._formatter),this.$scope.viewItems=this._legendMetrics.viewItems),this.isHorizontal()&&(this._horizontalMetrics=p(this.rect,this._legendMetrics,this._titleMetrics),this.$scope.align=this._horizontalMetrics.numRows>=v),this.$scope.discrete=this._mode.discrete,this.$scope.options.vertical=this.isVertical(),this.$scope.options.labelStyle=i.scaledLabel,this.isDiscrete()?(this.$scope.options.titleStyle=e.extend(!0,{width:Math.ceil(this._titleMetrics.width*this.chartScale)+"px"},i.scaledTitle),this.$scope.options.titleHeight=(Math.max(this._titleMetrics.height,12)+12)*this.chartScale,this.$scope.options.legendTitle=this._titleMetrics.show?this._titleMetrics.text:null):(this.$scope.options.titleStyle=i.scaledTitle,this.$scope.options.legendTitle=this._titleMetrics.text),this.$scope.options.legendTitleTooltip=this._titleMetrics.fullText,this.$scope.options.cellWidth=Math.ceil(this._legendMetrics.cellWidth*this.chartScale),this.$scope.options.cellHeight=Math.ceil(this._legendMetrics.cellHeight*this.chartScale),this.$scope.options.yMirrorMode=this.yMirrorMode,this.$scope.options.dock=this.dock,this.$scope.isLocked=this.isSelectionLocked(),this._dataInvalid=!1,!0):(this._clearScope(this.$scope),!1)},paint:function(){this.$scope.$broadcast("invalidateSelections"),this.$scope.$broadcast("updateSize")},calculateRelevantSize:function(e){if(this._super(),this.relevantSize=0,this.invalidateProperties("Legend.calculateRelevantSize"),this.updateNow(["properties"]),this.isVisible()&&this._titleMetrics&&this._legendMetrics)if(this.isDiscrete())if(this.isHorizontal()){var t=p(e,this._legendMetrics,this._titleMetrics);this.relevantSize=t.h+(t.numRows>v?v:t.numRows)+2*n.constants.PADDING}else this.relevantSize=Math.max(this._legendMetrics.cellWidth,this._titleMetrics.width);else this.relevantSize=f(this._titleMetrics,this._legendMetrics,this.isVertical(),this._values)},isDiscrete:function(){return this._mode.discrete},clear:function(){this._super()},isSelectionLocked:function(){return this._colorDataInfo.altMode&&this._colorDataInfo.internalMode===(this._colorMap?this._colorMap.DIMENSION:"dimension")?this._colorDataInfo.altLocked:this._super()},getAttributeDimensionInfo:function(){return this._colorMap&&this._colorMap.hasAttributeDimension()?this._colorMap.getAttributeDimensionInfo():[]},_clearScope:function(e){e.visible=!1,e.viewItems=null,this._titleMetrics=null,this._legendMetrics=null},on:function(){this._super(),this.$scope.interactionEnabled=m(this.backendApi)},off:function(){this._super(),this.$scope.interactionEnabled=!1}}),Object.defineProperty(g.prototype,"className",{value:"BasicColorLegend"}),g}),define("objects.views/charts/components/legend/color-legend",["./basic-color-legend","objects.utils/number-formatter"],function(e,t){function n(e,t,n,i,r,o){var s,a,l=i[0].min,c=i[i.length-1].max,u=c-l;return n?(s=1-Math.max(e[0].y,e[1].y)/t,a=1-Math.min(e[0].y,e[1].y)/t):r?(s=1-Math.min(e[0].x,e[1].x)/t,a=1-Math.max(e[0].x,e[1].x)/t):(s=Math.min(e[0].x,e[1].x)/t,a=Math.max(e[0].x,e[1].x)/t),s=0===s?l:s*u+l,a=1===a?c:a*u+l,{idx:o,startVal:s,updateVal:a,isMax:!0}}function i(e,t,n){var i=t[0].min,r=t[t.length-1].max,o=r-i;return n&&(e=1-e),0===e?i:1===e?r:e*o+i}function r(e,t,n){for(var i,r=[],o=0;o<t.length;o++)i=t[o],r.push({idx:n,startVal:i.id[0],updateVal:i.id[1],isMax:i.isMax});return r}function o(e){return!("measure"===e.colorMode&&"item"===e.boxType)}function s(e,i,s){if(i.selectionEnabled=!!e._mode.selectionEnabled&&!!s&&e._on&&!s.handler._disableSelections,!s||!i.selectionEnabled)return e._watchers&&e._watchers.forEach(function(e){e()}),void(e._watchers=null);e._watchers||(e._watchers=[],e._watchers.push(i.$on("toggleSelect",function(t,n,a){if(s.initComponent(null,e),o(e._mode)){if("range"===e._mode.boxType){s.rangeStart();var l=r(i.viewItems,a,e._mode.rangeSelectionIndex);s.indices=[e._mode.rangeSelectionIndex],s.rangeUpdate(l,!0),s.rangeEnd()}else{if(e.$scope.isLocked)e.selections.selectWhileLocked(e._mode.altMode?s.activeComponent.getAttributeDimensionInfo():void 0);else{var c,u=a.map(function(e){return e.id[0]}),h=[],d=a.length;for(c=0;c<d;c++)a[c].cacheItems&&(h=h.concat(a[c].cacheItems));s.updateFromItems(n,h,e._mode.altMode,u)}e._mode.altMode||e.selections._selectedShapes.length||e.selectionsApi.clear()}t.preventDefault()}})),e._watchers.push(i.$on("rangeStart",function(n,i,r){r&&s.initComponent(r.pagePoints[0]),e._formatter=e._colorMap.getValueFormatter()||t.getStaticFormatter(),e._formatter.prepare(),s.rangeStart(!0),n.preventDefault()})),e._watchers.push(i.$on("rangeUpdate",function(t,i,r,o){var a=n(i,r,e.isVertical(),e.$scope.viewItems,e.yMirrorMode,e._mode.rangeSelectionIndex);s.indices=[e._mode.rangeSelectionIndex],o&&(0===o.index?a.startVal=o.value:a.updateVal=o.value),s.rangeUpdate([a]),t.preventDefault()})),e._watchers.push(i.$on("rangeEnd",function(e){s.rangeEnd(),e.preventDefault()})),e._watchers.push(i.$on("rangeEditChanged",function(t,n){e._nrEditing=n?e._nrEditing+1:e._nrEditing-1,e._nrEditing>1&&(s.confirmEdit(),e._nrEditing=1,t.targetScope.onEditBubble()),e._editing=e._nrEditing>0,s.setIsEditing(e._editing,e.$scope)})),e._watchers.push(i.$on("scrollPositionChanged",function(t,n){e._scrollPosition=n})),e._watchers.push(i.$on("selectWhileLocked",function(){e.selections&&e.selections.selectWhileLocked()})))}var a;return a=e.extend("ColorLegend",{init:function(){var e=Array.prototype.slice.call(arguments);this._super.apply(this,e),this._nrEditing=0,this.$scope.options={};var t=this;this.formatValue=function(e){return t._formatter.formatValue(e)},this.$scope.positionToFormattedValue=function(e){return t.formatValue(i(e,t.$scope.viewItems,t.yMirrorMode&&!t.isVertical()))},this.$scope.positionToValue=function(e){return i(e,t.$scope.viewItems,t.yMirrorMode&&!t.isVertical())}},setData:function(e){this._super(e),this.setProperties(e.legend)},getSelectionIndices:function(){return this._colorMap.getSelectionIndices()},setSelectableShapes:function(e){this._super(e),this._dataInvalid=!0,this.invalidateProperties("Legend.setSelectableShapes")},setHasValidData:function(e){this._super(e),e||(this.clear(),this._clearScope(this.$scope))},_updateProperties:function(){if(!this._super())return!1;this.$scope.selectionEnabled=!this.options._disableSelections&&this._mode.selectionEnabled&&this.$scope.interactionEnabled&&!!this.selections,this.$scope.selectionsApi=this.selectionsApi,this.$scope.selectionsCache=this._colorDataInfo&&this._colorDataInfo.altMode&&this.attributeSelectionsCache,s(this,this.$scope,this.selections)},on:function(){this._super(),s(this,this.$scope,this.selections)},off:function(){this._super(),s(this,this.$scope,this.selections)},getType:function(){return this.selections},getSelectionMode:function(){return this._mode.legend},clearSelection:function(){this.$scope.$broadcast("clearSelection"),this.$scope.$broadcast("cancelSelection")},cancelSelection:function(){this.$scope.$broadcast("cancelSelection")},getScrollPosition:function(){return this._scrollPosition},setScrollPosition:function(e){this.$scope.explicitScrollPosition=e}}),Object.defineProperties(a.prototype,{selections:{get:function(){return this._selections},set:function(e){this._selections=e,s(this,this.$scope,this.selections)}}}),Object.defineProperty(a.prototype,"className",{value:"ColorLegend"}),a}),define("objects.views/selections/cache-item-combo",["./cache-item-base"],function(e){"use strict";return e.extend({addShape:function(e,t,n,i){this._super(e,t,n),void 0!==i&&(this._shapeMeasures||(this._shapeMeasures=[]),this._shapeMeasures.push(i))},getMeasuresIndecies:function(e){if(this._shapeMeasures&&void 0!==this._shapeMeasures[this._shapes.indexOf(e)]){var t=this._shapeMeasures[this._shapes.indexOf(e)];return void 0!==t?[t]:[]}return this._super()}})}),define("objects.views/charts/chart-data-helper",["objects.views/charts/utils/tree-node","objects.views/selections/cache-item-combo"],function(e,t){function n(e,t){var n=e?i(e):null;if(n){var r=n.getDimensions();if(r.length)return t.qText+","+r.join(",")}return t.qText}function i(e){return"P"===e.data.qType&&e.parent?e.parent.cacheItem:e.cacheItem}function r(u,h,d,p,f){var m,g,v,y,b,x;for(p[o]||(p[o]={}),v=0;v<u.length;v++){var q=[];if("T"!==u[v].qType){if(m=new e,m.data.qType=u[v].qType,m.data.qMaxPos=u[v].qMaxPos,m.data.qMinNeg=u[v].qMinNeg,"P"===u[v].qType&&(c=u[v]),"V"===u[v].qType||"E"===u[v].qType||"P"===u[v].qType?(m.data.qText=u[v].qText,m.data.qNum=u[v].qNum,m.data.qValue=u[v].qValue,m.data.rowIndex=0,s?((g=new e).data.qType="_M",g.data.qMaxPos=m.data.qMaxPos,g.data.qMinNeg=m.data.qMinNeg,g.data.qText=a[0].qFallbackTitle,g.data.rowIndex=u[v].qRow,g.addChild(m),m=g):m.data.rowIndex=u[v].qRow):(m.data.qText="O"===u[v].qType&&l[f]?l[f].othersLabel||"":u[v].qText,l[f+1]&&(m.data.qApprMaxGlyphCount=l[f+1].qApprMaxGlyphCount),m.data.qElemNo=u[v].qElemNo,m.data.rowIndex=u[v].qRow),h.addChild(m),"V"!==u[v].qType&&"P"!==u[v].qType){var C=n(h,u[v]);if(p[o][C]&&c)b=p[o][C],m.cacheItem=b;else{b=new t(null,null,null,null,u[v].qRow,o),m.cacheItem=b,b.addDimension(m.data.qText),b.id=u[v].qElemNo,"U"!==u[v].qType&&(u[v].qAttrDims&&u[v].qAttrDims.qValues.forEach(function(e,t){b.addAttributeDimension(e.qElemNo,e.qText,l[f].qAttrDimInfo[t].label)}),u[v].qAttrExps&&u[v].qAttrExps.qValues.forEach(function(e,t){q.push({value:e.qNum,label:l[f].qAttrExprInfo[t].label})}));var S=i(h);if(S){(b=m.cacheItem).parent=S,S.children.push(b),x=b.parent.getDimensions();for(y in x)b.addDimension(x[y])}p[o][C]=b}}"V"===u[v].qType&&(b=i(h))&&(b.addMeasure(c?c.qText:m.data.qText,u[v].qValue,u[v].qText),d.contains(b)||d.push(b)),u[v].qSubNodes&&u[v].qSubNodes.length>0&&(o++,m=r(u[v].qSubNodes,m,d,p,f+("V"!==u[v].qType?1:0))),q.forEach(function(e){b.addMeasure(e.label,e.value)})}}return--o,h}var o,s,a,l,c;return{prepareData:function(t,n,i){var c,u=new e,h=[],d=[];return t&&t.length?(o=0,s=n&&n.length<2,a=n,l=i,u.data.qApprMaxGlyphCount=l[0]?l[0].qApprMaxGlyphCount:0,c=r(t[0].qSubNodes,u,h,d,0),{dimensionTree:c,cacheItems:h}):{dimensionTree:u,cacheItems:[]}}}}),define("objects.views/charts/chart-context",["./events/event-launcher","objects.views/charts/utils/tree-node","objects.views/charts/chart-data-helper","objects.views/selections/cache-item-combo"],function(e,t,n,i){"use strict";function r(e,n,i,r){var o=new t;return o.text=e,o.title=n,o.id=i,o.idx=r,o}function o(e,n){var i,r=new t;r.data.qApprMaxGlyphCount=0;for(i in n)r.data[i]=n[i];return e&&e.addChild(r),r}return e.extend({init:function(e){this._super(),this._properties={},e&&this.refresh(e)},refresh:function(e){this._data=e,this._qDataObject=e.qHyperCube?e.qHyperCube:e.qListObject;var t;if("K"===this._qDataObject.qMode&&this._qDataObject.qStackedDataPages&&this._qDataObject.qStackedDataPages.length>0)t=this._generatePivotTree();else{if(!("S"===this._qDataObject.qMode&&this._qDataObject.qDataPages&&this._qDataObject.qDataPages.length>0))return;t=this._generateDimensionTree()}this._dimensionTree=t?t.dimensionTree:null,this._cacheItems=t?t.cacheItems:null,this.fire("dimensionTreeChanged")},bindProperty:function(){throw new Error("ChartContext bindProperty: Deprecated")},unBindProperty:function(){throw new Error("ChartContext unBindProperty: Deprecated")},releaseAll:function(){throw new Error("ChartContext releaseAll: Deprecated")},release:function(){this._data=null,this._dimensionTree=null,this._cacheItems=null,this._qDataObject=null},_generateDimensionTree:function(){var e,n,s,a,l,c,u,h,d,p,f,m,g,v,y=r(),b=this.getDataMatrix(),x=this._qDataObject,q=x.qMeasureInfo,C=x.qDimensionInfo,S=x.qDataPages[0].qArea.qTop,w=x.qDataPages[0].qTails,_=q.length,D=C.length,M=b&&b[0]?b[0].length:0,A=[],E=[];for(h=0,u=0;u<D;u++)C[u].qError||(A[h]=u,h++);if(0===(D=h))return null;for(f=function(e,t){for(var n=0;n<e.length;n++)if(e[n].data.qElemNo===t)return n;return-1},u=0;u<b.length;u++){e=b[u],a=y;var I=[];for(h=0;h<D;h++){if(n=e[h],s=C[A[h]],!n)return;if(-1===(p=n.qIsOtherCell?void 0===a.data.othersIndex?-1:a.data.othersIndex:f(a.children,n.qElemNumber))){if(l=o(a,{qElemNo:e[h].qElemNumber,qText:e[h].qText,rowIndex:S+u,type:"dimension"}),void 0!==typeof e[h].qNum&&(l.data.qNum=e[h].qNum),n.qIsOtherCell&&(l.data.qIsOtherCell=!0,l.data.qText=s.othersLabel||""),n.qIsTotalCell&&(l.data.qIsTotalCell=!0),a.data.qApprMaxGlyphCount=s.qApprMaxGlyphCount,n.qIsOtherCell&&(a.data.othersIndex=a.children.length-1),m=new i([l.data.qText],null,null,null,S+u,h,l.data.qElemNo),n.qAttrDims&&s.qAttrDimInfo&&s.qAttrDimInfo.length&&n.qAttrDims.qValues.forEach(function(e,t){m.addAttributeDimension(e.qElemNo,e.qText,s.qAttrDimInfo[t].label)}),n.qAttrExps&&s.qAttrExprInfo&&s.qAttrExprInfo.length&&n.qAttrExps.qValues.forEach(function(e,t){I.push({value:e.qNum,label:s.qAttrExprInfo[t].label})}),a.cacheItem){m.parent=a.cacheItem,m.parent.children.push(m),g=m.parent.getDimensions();for(v in g)m.addDimension(g[v])}l.cacheItem=m,a=l}else a=a.children[p]}for(m=a.cacheItem,E.push(m),d=0;d<_&&D+d<M;d++)l=o(a,{qText:q[d].qFallbackTitle,qNum:e[D+d].qNum,rowIndex:S+u,type:"measure"}),a.data.qApprMaxGlyphCount=Math.max(a.qApprMaxGlyphCount,q[d].qApprMaxGlyphCount),m.addMeasure(l.data.qText,l.data.qNum,e[D+d].qText),(c=new t).data={qText:e[D+d].qText,qNum:e[D+d].qNum,qElemNo:e[D+d].qElemNumber,qState:e[D+d].qState},l.addChild(c);I.forEach(function(e){m.addMeasure(e.label,e.value)})}return w&&w[0]&&(w[0].qUp>0||w[0].qDown>0)&&(y.children[y.children.length-1].incomplete=!0),{dimensionTree:y,cacheItems:E}},_generatePivotTree:function(){return n.prepareData(this._qDataObject.qStackedDataPages[0].qData,this._qDataObject.qMeasureInfo,this._qDataObject.qDimensionInfo)},_extractProperties:function(){throw new Error("ChartContext _extractProperties: Deprecated")},_updateProperty:function(){throw new Error("ChartContext _updateProperty: Deprecated")},getDataMatrix:function(){return this._qDataObject.qDataPages[0].qMatrix},getDimensionTree:function(){return this._dimensionTree},getCacheItems:function(){return this._cacheItems}})}),define("objects.views/charts/representation/legend-data-provider",["translator","core.utils/class","objects.views/charts/utils/tree-iterator"],function(e,t,n){function i(t,i){var r,o,l,c,u,h,d,p=[],f={},m=this._qDataObject,g=this._legendMarker?this._legendMarker:"rect",v=m?m.qDimensionInfo instanceof Array?m.qDimensionInfo:[m.qDimensionInfo]:null,y=this._colorMap;if(i=void 0===i?v.length-1:i[0],r=this._dimensionTree,t)for(h=(u=m.qMeasureInfo).length,l=0;l<h;l++)p.push({label:u[l].qFallbackTitle,color:y.getColor(0,0,l),id:[-1],type:"measure",marker:this._legendMarker?this._legendMarker:this._measureLegendTypes?this._measureLegendTypes[l]||"box":"box"});else n.each.call(r,function(t){(d=n.getLevel.call(t))-1===i&&t.data.qElemNo!==a&&void 0!==t.data.qText&&void 0===f[t.data.qText]&&((c=[])[i]=t.data.qElemNo,o={label:t.data.qElemNo!==s?t.data.qText:e.get("properties.dimensionLimits.others"),color:y.getColorFromPreScaledValue(t.data.qElemNo),id:[t.data.qElemNo],index:t.data.rowIndex,type:t.data.qElemNo!==s?"dimension":"others",marker:g},p.push(o),f[t.data.qText]=o)});return p}function r(e,t){var n,i,r,o,l,c,u,h=[],d={},p=this._data.qListObject.qDataPages[0].qMatrix,f=this._qDataObject,m=f?f.qDimensionInfo instanceof Array?f.qDimensionInfo:[f.qDimensionInfo]:null,g=this._colorMap;if(t=void 0===t?m.length-1:t[0],e)for(i=(n=this._data.qListObject.qMeasureInfo).length,o=0;o<i;o++)h.push({label:n[o].qFallbackTitle,color:g.getColor(0,0,o),id:[-1],type:"measure"});else for(r=0;r<p.length;r++)(l=p[r][t]).qElemNumber!==s&&l.qElemNumbero!==a&&void 0===d[l.qText]&&((c=[])[t]=l.qElemNumber,u={label:l.qText,color:g.getColor(c,0,0,r),id:[l.qElemNumber],type:"dimension"},h.push(u),d[l.qText]=u);return h}function o(e){return e.discrete+","+e.boxType+","+e.colorMode}var s=-3,a=-2;return t.extend({init:function(e){this._data=e,this._colorMappings={}},setColorMap:function(e){this._colorMap=e},getColorMap:function(){return this._colorMap},getColorMapping:function(){if(!this._colorMap||!this._data)return[];var e,t=this._colorMap.getColorDataInfo().legendMode;return"primary"===t.colorMode?[]:this._colorMappings[o(t)]?this._colorMappings[o(t)]:(e=t.discrete&&"range"===t.boxType||!t.discrete?this._colorMap.generateScaleBasedMapping():this._data.qListObject?r.apply(this,["measure"===t.colorMode,this._colorMap.getDimensionIndex()]):i.apply(this,["measure"===t.colorMode,this._colorMap.getDimensionIndex()]),this._colorMappings[o(t)]=e,e)},setData:function(e){var t=e.qHyperCube?e.qHyperCube:e.qListObject,n=e.qHyperCube?e.qHyperCube.qDimensionInfo:[e.qListObject.qDimensionInfo];this._qDataObject=t,this._data=e,e&&t.qDataPages.length?this._others=t.qDataPages[0].qMatrix.some(function(e){return n&&n.length&&!0===e[n.length-1].qIsOtherCell}):this._others=!1,this._colorMappings={}},setDimensionTree:function(e){this._dimensionTree=e,this._colorMappings={}},setMeasureLegendTypes:function(e){this._measureLegendTypes=e},setLegendMarker:function(e){this._legendMarker=e},getLegendMarker:function(){return this._legendMarker},release:function(){this._colorMap=null,this._dimensionTree=null,this._data=null,this._qDataObject=null}})}),define("objects.views/charts/representation/color-map-util",["general.utils/color"],function(e){function t(t,n){return e.toHex(e.blend(t,n,.5))}return{setupColors:function(e,n,i){if(e.length!==n.length+1||n.length!==i.length)return!1;for(var r=[e[0]],o=[],s=n.length,a=0;a<s;a++)n[a]?(r.push(t(e[a],e[a+1])),r.push(t(e[a],e[a+1])),o.push(i[a]),a!==s-1&&(r.push(e[a+1]),r.push(e[a+1]),o.push((i[a]+i[a+1])/2))):(r.push(e[a]),r.push(e[a+1]),o.push(i[a]),a!==s-1&&n[a+1]&&(r.push(e[a+1]),r.push(e[a+1]),o.push((i[a]+i[a+1])/2)));return r.push(e[a]),{colors:r.reverse(),limits:o}},setupLegend:function(e,t,n){var i=e.getLegendParts(0),r=[],o=t.max-t.min;if(isNaN(o))return r;for(var s,a,l=t.max,c=0;c<i.length;c++)s=i[c],a=e.UNLimits?c===i.length-1?t.min:e.UNLimits[i.length-1-c-1]:l-(s.limits[1]-s.limits[0])*o,s.isMax=0===c,s.max=n.formatValue(l),s.min=n.formatValue(a),l=a,s.id=[l,a],s.type="range",r.push(s);return r}}}),define("client.services/color-map-service",["qvangular","core.models/communication","util","core.utils/deferred"],function(e,t,n,i){e.service("qvColorMapService",[function(){function e(e){var t=null;return e.getLayout().then(function(e){return e.colorMap&&(t=e.colorMap),t?n.extend(!0,{},t):null})}function r(e,t){var i=n.extend(!0,{},t);return e.getProperties().then(function(t){if(t.colorMap)return t.colorMap=i,e.setProperties(t)})}var o="ColorMapModel_";return{getColorMap:function(n,r){var s;return s=r?i.resolve(r):t.getApp(),n?s.then(function(t){return t.getObject((o+n).toString()).then(function(t){return e(t)})}).catch(function(){return null}):i.resolve(null)},setColorMap:function(e,n){var i=(o+e).toString();return t.getApp().then(function(e){return e.getObject(i).catch(function(){return e.createObject({qInfo:{qType:"ColorMap",qId:i},colorMap:{}})}).then(function(e){return r(e,n)})})},deleteColorMap:function(e){return t.getApp().then(function(t){return t.destroyObject((o+e).toString())})},getTemplate:function(){return{colors:[],nul:null,oth:null,pal:null,single:null,usePal:null,autoFill:!0}},getMeasureGradient:function(e,n){return(n?i.resolve(n):t.getApp()).then(function(t){return t.getMeasure(e).then(function(e){return e.getLayout().then(function(e){if(e&&e.qMeasure&&e.qMeasure.coloring)return e.qMeasure.coloring.gradient})})}).catch(function(){return null})}}}])}),define("objects.views/charts/representation/sequential-color-map",["jquery","qvangular","client.utils/theme/theme-module","general.utils/color-cache","core.utils/class","objects.views/charts/representation/color-scale","objects.views/charts/representation/color-map-util","core.utils/deferred","core.utils/feature-flags","client.services/color-map-service"],function(e,t,n,i,r,o,s,a,l){"use strict";function c(e,t){var n,i,r,s=new o;if(t){for(i=0;i<e.length;i++)if(r=e[i])for(n=0;n<r.length;n+=2)s.addColorPart(r[n],r[n+1],i)}else for(n=0;n<e.length;n+=2)s.addColorPart(e[n],e[n+1]);return s}function u(e,t,n,i,r){var o,s,a,l,c=0,h=[];if(0==(o=(e-t)/(i+1)))return 1;for(s=0;s<n.length;s++)a=.99*(n[s]-t),l=n[s]>e?Math.floor(e/o):n[s]<t?0:Math.floor(a/o),isNaN(l)||(h[l]?h[l]++:h[l]=1);for(s=0;s<h.length;s++)h[s]&&c++;return c<=i||c>=r?Math.max(c,i):u(e,t,n,++i,r)}function h(e){var t,n=[];for(t=0;t<e.length;t++)e[t]?n.push(d(e[t],!1)):n.push(null);return n}function d(e,t){var n=1,i=[];for(i.push(e[0]),t||i.push(e[0]);n<e.length-1;n++)i.push(e[n]),i.push(e[n]);return n<e.length&&(i.push(e[n]),t||i.push(e[n])),i}function p(e,t,n){var i={limits:[],colors:[]},r=!1;return e.forEach(function(o,s){o>=n.min&&!r?o<n.max?(i.limits.push(o),i.colors.push(t[s]),s===e.length-1&&(r=!0)):o>n.max?e.indexOf(o)==s&&(i.colors.push(t[s]),r=!0):o==n.max&&e.indexOf(o)==s&&(i.colors.push(t[s]),i.limits.push(o),r=!0):o!=n.min||r||(i.limits.push(o),i.colors.push(t[s])),r&&n.max>=o&&i.colors.push(t[s+1]),s!=e.length-1||r||i.colors.push(t[s+1])}),i}function f(e){var t=this._sequentialScales={},n=0;e.scales.forEach(function(e){t[e.propertyValue]={type:e.type,scale:c("class-pyramid"===e.type?h(e.scale):d(e.scale,"gradient"===e.type),"class-pyramid"===e.type)},n=Math.max(e.scale.length,n)}),this._largestScaleSize=n,this._wrangled=[],this._defaultScaleObj=this._sequentialScales[e.scales[0].propertyValue],this._activeScale=this._defaultScaleObj.scale}var m=n.get();return r.extend({init:function(e,t,n){f.call(this,m),this.app=n,this._themeChangeWatcher=function(){f.call(this,m)}.bind(this),m.ThemeChanged.bind(this._themeChangeWatcher),this._measure=0,this.minMax={min:null,max:null},this.setData(e)},release:function(){m.ThemeChanged.unbind(this._themeChangeWatcher)},setData:function(e,n,i){function r(){f._activeScale.setMaxMinValues(b.max,b.min),void 0!==g.reverseScheme&&f._activeScale.setReverse(!0===g.reverseScheme)}function o(e){return e.some(function(e){return e})}function h(e){if(e){var t,n,i,r=e.colors.map(m.resolveColor),o=e.limits,a=null,l={min:b.min,max:b.max};if("absolute"===e.limitType){o=(a=p(o,r,l)).limits;var u=l.max-l.min,h=.001*u;i=o.concat(),o.length&&o[0]===l.min&&(b.min=l.min-h),o.length&&o[o.length-1]===l.max&&(b.max=l.max+h);var d=b.max-b.min;o=l.min===l.max?o.map(function(e){return(e-l.min)/l.min}):o.map(function(e){return(e-l.min)/(l.max-l.min)});for(var g=0;g<o.length;g++)0!==d&&d!==u&&(o[g]*=u/(d+h*(1-(g+1)/o.length)));t=o.map(function(){return!1})||o.map(function(){return 0}),n=s.setupColors(a.colors,t,o)}else"percent"===e.limitType&&(o=o.map(function(e){return Math.max(Math.min(e,1),0)}),t=e.breakTypes||o.map(function(){return 0}),n=s.setupColors(r,t,o));n&&(f._activeScale=c(n.colors,!1),f._activeScale.setLimits(n.limits),f._activeScale.UNLimits=i,f._customScale=!0,f._classes=!0)}f._measureGradient=e}function d(e){if(e){var t=e.colors.map(m.resolveColor),n=e.limits;"absolute"===e.limitType&&(n=b.max===b.min?n.map(function(e){return(e-b.min)/b.max}):n.map(function(e){return(e-b.min)/(b.max-b.min)})),n=n.map(function(e){return Math.max(Math.min(e,1),0)});var i=e.breakTypes||n.map(function(){return 0}),r=s.setupColors(t,i,n);r&&(f._activeScale=c(r.colors,!1),f._activeScale.setLimits(r.limits),f._customScale=!0,f._classes=!1)}f._measureGradient=e}this._data=e,this._colorDataInfo=n,this._customScale=!1,this._invalidSpan=!1;var f=this;if(e){if(!n.valid)return this._legendTitle="",void(this._wrangled=[]);var g=e.color||{},v=e.qHyperCube?e.qHyperCube:e.qListObject;if(this._qDataObject=v,this._validColorInformation=this._colorDataInfo.valid&&!this._colorDataInfo.allNaN,this._byExpression="byExpression"===g.mode,this._legendTitle=this._colorDataInfo.legendTitle,void 0!==g.measureScheme){var y=this._sequentialScales[g.measureScheme]||this._defaultScaleObj;this._activeScale=y.scale,this._classes="class-pyramid"===y.type;var b=this._getMinMax();if(this._invalidSpan=!b,!this._invalidSpan&&this._validColorInformation){if(this._wrangled=this._colorDataInfo.wrangled.map(function(e){return e.elemValue}),this._numUsedColors=this._colorDataInfo.persistentColors?[Math.min(this.getLargestScaleSize(),this._colorDataInfo.dimSize)]:[u(b.max,b.min,this._wrangled,1,this.getLargestScaleSize())],n.attrInfo&&n.useMeasureGradient&&l.MES_COL)return i&&i.content&&i.content.chartData?a.resolve(i.content.chartData.measureGradient).then(d).then(r):t.getService("qvColorMapService").getMeasureGradient(n.attrInfo.colorMapRef,this.app).then(function(e){o(e.breakTypes)?d(e):h(e)}).then(r);r()}}}},getColor:function(e,t,n,r){return r=this._byExpression||void 0===this._wrangled[t]?r:this._wrangled[t],this._byExpression||!this._invalidSpan&&!isNaN(r)&&this._validColorInformation?this._activeScale.getColor(r,this._getNumUsedColors(0)):i.retriveColor(m.dataColors.nullColor)},getColorFromPreScaledValue:function(e){return this._activeScale.getColor(e,this._getNumUsedColors(0))},getActiveScale:function(){return this._activeScale},getLargestScaleSize:function(){return this._largestScaleSize||0},generateScaleBasedMapping:function(){var t,n,i,r,o,a,l,c,u,h,d=this.getValueFormatter();if(h=this._activeScale,this.minMax=t=this._getMinMax(),this._customScale)return s.setupLegend(h,t,d);if(u=[],l=h.getLegendParts(this._getNumUsedColors(0)),!t)return u;if(n=t.max-t.min,isNaN(n))return u;for(r=n/(o=l.length),a=t.max,!isNaN(t.measureMax)&&this._classes&&((c=e.extend(!0,{},l[0])).isMax=!0,c.min=d.formatValue(a),c.id=[t.measureMax,a],c.type="range",u.push(c)),i=0;i<o-1;i++)(c=l[i]).isMax=0===i,c.max=d.formatValue(a),c.min=d.formatValue(a-r),c.id=[a,a-r],c.type="range",a-=r,u.push(c);return c=l[i],c.max=d.formatValue(a),c.min=d.formatValue(t.min),c.id=[a,t.min],c.type="range",u.push(c),!isNaN(t.measureMin)&&this._classes&&((c=e.extend(!0,{},l[i])).max=d.formatValue(t.min),c.min=void 0,c.id=[t.min,t.measureMin],c.type="range",u.push(c)),u},getColorMapping:function(){return this.generateScaleBasedMapping()},getLegendMode:function(){return[this._classes?"box":"scale",this._classes?"range":"item","measure"]},getLegendTitle:function(){return this._legendTitle},setMeasureFormatters:function(e){this._measureFormatters=e},setGenericFormatter:function(e){this._formatter=e},getValueFormatter:function(){return this._measureFormatters&&this._measureFormatters[0]&&!this._byExpression?this._measureFormatters[0]:{formatValue:function(e){return e}}},_getMinMax:function(){var e;return!1===this._data.color.autoMinMax?(e={min:this._data.color.measureMin||0,max:this._data.color.measureMax||0}).max>=e.min?e:null:this._validColorInformation&&this._colorDataInfo.minMax?e=this._colorDataInfo.minMax:null},_getNumUsedColors:function(e){return this._numUsedColors?this._numUsedColors[e]:0},calculateNumberOfUsedColors:u,filterLimitsAndColorsBasedOnMinMax:p,getMeasureGradient:function(){return this._measureGradient}})}),define("objects.views/charts/representation/color-map-data-wrangler",[],function(){function e(t,n,i){if(n===i)return[t];var r=[];return"U"!==t.qType&&"O"!==t.qType&&"T"!==t.qType&&t.qSubNodes.forEach(function(t){r=r.concat(e(t,n+1,i))}),r}function t(e){return e.some(function(e){return e.qElemNumber===r||e.qElemNumber===i})}function n(e,t,n,i){e[t]={},e[t].elemValue=n[i],e[t].text=n.qText}var i=-3,r=-2;return{wrangleData:function(i,r,o,s,a,l){r=r||0,o=o||0,l=l||o;var c,u=0,h=[],d=[];if(i){if(i.qDataPages[0]){var p=i.qDataPages[0].qMatrix;u=i.qDataPages[0].qArea.qTop||u,p.forEach(function(e,n){!a&&t(e)||(d[n]=e[o])}),c=a?s?"qElemNo":"qElemNumber":"qNum"}else if(i.qStackedDataPages[0]){var f=i.qStackedDataPages[0].qData[0];d=e(f,0,o+1);var m=[];l>o?d.forEach(function(t){e(t,0,l-o).forEach(function(e){m[e.qRow]=t})}):(m=[],d.forEach(function(e){m[e.qRow]=e})),d=m,c=a?"qElemNo":s?"qNum":"qValue"}s?d.forEach(function(e,t){n(h,u+t,e[s].qValues[r],c)}):d.forEach(function(e,t){n(h,u+t,e,c)})}return h}}}),define("objects.utils/date-formatter",["core.utils/class"],function(e){"use strict";function t(e,t){for(var n=e.length;n<t;n++)e="0"+e;return e}function n(e,t){var n=e.getHours(),i=e.getDay()-1;return t&&((n%=12)||(n=12)),i<0&&(i=6),{year:e.getFullYear(),month:e.getMonth(),day:i,date:e.getDate(),h:n,m:e.getMinutes(),s:e.getSeconds(),f:e.getMilliseconds(),t:e.getHours()>=12?"pm":"am"}}function i(e){var t=e.toString().split(".");return t[1]?t=Number("0."+t[1]):0}function r(e){var t=e,n=24*i(t),r=60*i(n),o=60*i(r),s=1e3*i(o);return{d:Math.floor(t),h:Math.floor(n),m:Math.floor(r),s:Math.floor(o),f:Math.round(s)}}function o(e,t){var n,i=r(e),o=i.d,s=i.h,a=i.m,l=i.s,c=i.f,u=0;return/w+|t+/gi.test(t)&&(n=new Date(1899,11,30+Math.floor(e),0,0,86400*(e-Math.floor(e))),isNaN(n.getTime())&&(n=null)),/D+/gi.test(t)||(s+=24*o),/h+/gi.test(t)||(a+=60*s),/m+/gi.test(t)||(l+=60*a),/w+/gi.test(t)&&(u=n?n.getDay()-1:0)<0&&(u=6),{year:0,month:0,day:u,date:o,h:s,m:a,s:l,f:c,t:n?n.getHours()>=12?"pm":"am":""}}function s(e,n){return{"Y+|y+":{Y:Number((n.year+"").slice(-2))+"",YY:t((n.year+"").slice(-2),2),YYY:t((n.year+"").slice(-3),3),def:function(e){return t(n.year+"",e.length)}},"M+":{M:n.month+1,MM:t(n.month+1+"",2),MMM:e.locale_months_abbr[n.month],def:e.locale_months[n.month]},"W+|w+":{W:n.day,WW:t(n.day+"",2),WWW:e.locale_days_abbr[n.day],def:e.locale_days[n.day]},"D+|d+":{D:n.date,def:function(e){return t(n.date+"",e.length)}},"h+|H+":{h:n.h,def:function(e){return t(n.h+"",e.length)}},"m+":{m:n.m,def:function(e){return t(n.m+"",e.length)}},"s+|S+":{s:n.s,def:function(e){return t(n.s+"",e.length)}},"f+|F+":{def:function(e){var t=n.f+"",i=e.length-t.length;if(i>0)for(var r=0;r<i;r++)t+="0";else i<0&&(t=t.slice(0,e.length));return t}},"t{1,2}|T{1,2}":{def:function(e){var t=n.t;return e[0].toUpperCase()===e[0]&&(t=t.toUpperCase()),t=t.slice(0,e.length)}}}}var a,l=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],c=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],u=["January","February","March","April","May","June","July","August","September","October","November","December"],h=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return a=e.extend({init:function(e,t){var n=e||{};n.qCalendarStrings||(n.qCalendarStrings={qLongDayNames:l,qDayNames:c,qLongMonthNames:u,qMonthNames:h}),this.localeInfo=n,this.locale_days=n.qCalendarStrings.qLongDayNames.slice(),this.locale_days_abbr=n.qCalendarStrings.qDayNames.slice(),this.locale_months=n.qCalendarStrings.qLongMonthNames.slice(),this.locale_months_abbr=n.qCalendarStrings.qMonthNames.slice(),this.pattern=t},clone:function(){var e=new a(this.localeInfo,this.pattern);return e.subtype=this.subtype,e},format:function(e,t){t||(t=this.pattern?this.pattern:"YYYY-MM-DD hh:mm:ss"),t=t.replace(/\[.+\]|\[|\]/g,"");var i,r=/t+/gi.test(t);e instanceof Date?i=n(e,r):(e<0&&(e=-e,t="-"+t),i=o(e,t));var a=s(this,i),l=[];for(var c in a)l.push(c);var u=new RegExp(l.join("|"),"g");return t.replace(u,function(e){var t;for(var n in a)if((t=new RegExp(n)).test(e))break;if(!t)return"";var i;for(var r in a[n])if(r===e||r.toLowerCase()===e){void 0===(i=a[n][r])&&(i=a[n][r.toLowerCase()]);break}return void 0===i&&(i=a[n].def),"function"==typeof i&&(i=i(e)),i})}}),a.parseInterval=r,a}),define("objects.utils/num-date-time-formatter",["objects.utils/number-formatter","objects.utils/date-formatter"],function(e,t){"use strict";function n(e){if(isNaN(e)||!isFinite(e))return 1;var t=Number(e).toExponential().split("e"),n=1;return"+"===t[1][0]&&(n+=Number(t[1])),n}function i(e){if(isNaN(e)||!isFinite(e))return 0;var t,n=Number(e).toExponential().split("e"),i=0;return"-"===n[1][0]?(i=Math.abs(Number(n[1])),(n=n[0].split("."))[1]&&(i+=n[1].length)):(t=Number(n[1]),i=(n=n[0].split("."))[1]?n[1].length-t:0),i}var r,o={AUTO:"U",INTEGER:"I",NUMBER:"R",FIXED_TO:"F",MONEY:"M",DATE:"D",TIME:"T",DATE_TIME:"TS",INTERVAL:"IV"};return r=e.extend("QFormatter",{init:function(n,i,r,s,a){var l=n||{};this.localeInfo=l,this.pattern=i||"",this.decimalDelimiter="string"==typeof s?s:"string"==typeof l.qDecimalSep?l.qDecimalSep:".",this.thousandDelimiter="string"==typeof r?r:"string"==typeof l.qThousandSep&&this.decimalDelimiter!==l.qThousandSep?l.qThousandSep:"",this.type=a||o.AUTO,a===o.AUTO&&(this.pattern="#"+this.decimalDelimiter+"##A"),this._numberFormatter=new e(n),this._dateFormatter=new t(n),this.prepare()},clone:function(){return new r(this.localeInfo,this.pattern,this.thousandDelimiter,this.decimalDelimiter,this.type)},prepare:function(e,t,n){if(e||(e=this.pattern),!e)switch(this.type){case o.INTEGER:e="##############";break;case o.NUMBER:e=Array(this.localeInfo.qnDec||11).join("#");break;case o.FIXED_TO:e="#"+this.localeInfo.qDecimalSep||"."+Array(this.localeInfo.qnDec||4).join("#");break;case o.MONEY:e=this.localeInfo.qMoneyFmt,n||(n=this.localeInfo.qMoneyDecimalSep||"."),t||n===this.localeInfo.qMoneyThousandSep||(t=this.localeInfo.qMoneyThousandSep);break;case o.DATE:e=this.localeInfo.qDateFmt||"YYYY-MM-DD";break;case o.DATE_TIME:e=this.localeInfo.qTimestampFmt||"YYYY-MM-DD hh:mm:ss";break;case o.TIME:case o.INTERVAL:e=this.localeInfo.qTimeFmt||"hh:mm:ss";break;default:e="##########"}this._numberFormatter.pattern=this.pattern,this._dateFormatter.pattern=this.pattern,this._numberFormatter.thousandDelimiter=this.thousandDelimiter,this._numberFormatter.decimalDelimiter=this.decimalDelimiter,this._numberFormatter.type=this.type,this._numberFormatter.prepare(e,t,n),this._prepared={pattern:e,t:t,d:n}},formatValue:function(e,t){var n,i=this._prepared;if("NaN"===e||"number"==typeof e&&isNaN(e))return"-";if(isNaN(e)||"number"!=typeof e)return e+"";switch(this.type){case o.DATE:case o.TIME:case o.DATE_TIME:return n=new Date(1899,11,30+Math.floor(e),0,0,86400*(e-Math.floor(e))),isNaN(n.getTime())?this._numberFormatter.format(e,"0",i.t,i.d):this._dateFormatter.format(n,t||i.pattern);case o.INTERVAL:return this._dateFormatter.format(e,i.pattern);default:return this._numberFormatter.formatValue(e)}},format:function(e,t,n,i){return"NaN"===e||"number"==typeof e&&isNaN(e)?"-":isNaN(e)||"number"!=typeof e?e+"":(this.prepare(t,n,i),this.formatValue(e))},createPatternFromRange:function(e,t,n){var i,r,o="",s=Number(Number(e).toExponential().split("e")[1]),a=Number(Number(t).toExponential().split("e")[1]),l=Math.min(Math.abs(s),Math.abs(a)),c=Math.abs(t-e),u=Number(Number(c/50).toExponential().split("e")[1]);if(r=Math.abs(u),0===c)return"0"+this.decimalDelimiter+"##"+(n?"A":"");if(u>=0?r=n?Math.max(2,l-u):0:r-=(n?l-l%3:0)*(a<0?1:-1),this.thousandDelimiter?o+="#"+this.thousandDelimiter+"##0":o+="0",r)for(o+=this.decimalDelimiter,i=0;i<r;i++)o+="#";return o+(n?"A":"")}}),r.getSignificantIntegers=function(e){return n(e)},r.getSignificantDecimals=function(e){return i(e)},r}),define("objects.views/charts/representation/expression-color-map",["client.utils/theme/theme-module","general.utils/color-cache","objects.views/charts/representation/sequential-color-map","objects.views/charts/representation/color-map-data-wrangler","general.utils/attribute-expression-util","objects.utils/num-date-time-formatter","translator"],function(e,t,n,i,r,o,s){"use strict";function a(e,t){var n,i=-Number.MAX_VALUE,r=Number.MAX_VALUE,o=!0;return!1===t.color.autoMinMax?{min:t.color.measureMin||0,max:t.color.measureMax||0}:e?(e.forEach(function(e){n=e.value,isNaN(n)||(i=Math.max(i,n),r=Math.min(r,n),o=!1)}),o?null:{min:r,max:i}):null}function l(e){var n=[];return e.forEach(function(e,i){n[i]={color:t.retriveColor(isNaN(e.elemValue)?e.text:e.elemValue,"argb"),value:e.elemValue}}),n}var c=e.get();return n.extend({init:function(e,t,n){this._formatter=new o(null),this._super(e,t,n)},setData:function(e,t,n){var o=this._super(e,t,n?{content:{chartData:n}}:e?e.snapshotData:null);if(this._wrangledMapping=[],e){var c=e.color||{},u=e.qHyperCube?e.qHyperCube:e.qListObject;if(this._qDataObject=u,this._data=e,this._isColorExpression=!1!==c.expressionIsColor,this._byExpression="byExpression"===c.mode,this._expressionLabel=c.expressionLabel&&""!==c.expressionLabel?c.expressionLabel:s.get("Object.ChartTooltip.ColorExpression"),this._byExpression){var h=-1,d=-1,p=!1;if(u.qDimensionInfo.concat(u.qMeasureInfo).forEach(function(e,t){e.qAttrExprInfo&&e.qAttrExprInfo.every(function(e,n){return!(e.id===r.IDMAP.COLOR_BY_EXPRESSION&&!p)||(h=t,d=n,p=!0,!1)})}),!(h>=0&&d>=0))return;var f=i.wrangleData(u,d,h,"qAttrExps",!1,u.qDimensionInfo.length-1,!1);if(this._wrangledMapping=l(f),this._minMax=a(this._wrangledMapping,e),!this._minMax)return;var m=this._wrangledMapping;this._numUsedColors=[this.calculateNumberOfUsedColors(this._minMax.max,this._minMax.min,m.map(function(e){return e.value}),1,this.getLargestScaleSize())],this._formatter.pattern=this._formatter.createPatternFromRange(this._minMax.min,this._minMax.max,!0),this._formatter.prepare(),this._activeScale.setMaxMinValues(this._minMax.max,this._minMax.min)}else this._minMax=null,this._mapping=null,this._formatter.pattern=this._formatter.createPatternFromRange(0,1,!0),this._formatter.prepare()}return o},getColor:function(e,n,i,r){if(!this._byExpression)return this._super(e,n,i,r);var o=this._wrangledMapping?this._wrangledMapping[n]:null;return!o||o.color.isInvalid()&&this._isColorExpression?t.retriveColor(c.dataColors.nullColor):this._isColorExpression?o.color:this._super(e,n,0,o.value)},getExpressionValue:function(e){return!this._wrangledMapping[e]||this._isColorExpression?void 0:this._wrangledMapping[e].value},getLegendTitle:function(){return this._byExpression?this._expressionLabel:this._super()},getLegendMode:function(){return this._byExpression?this._isColorExpression?["box","item","primary",!0]:[this._classes?"box":"scale",this._classes?"range":"item","measure",!0]:this._super()},getValueFormatter:function(){return this._colorDataInfo&&this._colorDataInfo.altMode&&void 0!==this._colorDataInfo.matchingDataMeasure?this._measureFormatters&&this._measureFormatters[this._colorDataInfo.matchingDataMeasure]?this._measureFormatters[this._colorDataInfo.matchingDataMeasure]:this._formatter:this._byExpression||this._colorDataInfo&&this._colorDataInfo.altMode?this._formatter:this._measureFormatters&&this._measureFormatters[0]?this._measureFormatters[0]:this._formatter},setGenericFormatter:function(e){this._super(e),this._byExpression&&this._minMax?(this._formatter.pattern=this._formatter.createPatternFromRange(this._minMax.min,this._minMax.max,!0),this._formatter.prepare()):this._formatter.pattern=this._formatter.createPatternFromRange(0,1,!0),this._formatter.prepare()},getGenericFormatter:function(){return this._formatter},_getMinMax:function(e,t){return this._byExpression?this._minMax?{min:this._minMax.min,max:this._minMax.max}:null:this._super(e,t)}})}),define("objects.views/charts/representation/qualitative-color-map",["translator","client.utils/theme/theme-module","general.utils/color-cache","core.utils/class"],function(e,t,n,i){"use strict";function r(e,t){return u.resolveColor(t||e)}function o(e,t){var n=t||0,i=[];return e.forEach(function(e){void 0===i[e]&&e>=0&&(i[e]=n,n++)}),i}function s(e){return this._persistColors||this._measureMode?e:this._reMappedIndeces[e]}function a(){l={},u.dataPalettes.forEach(function(e){l[e.propertyValue]={type:e.type,scale:e.scale}}),c=l[u.dataPalettes[0].propertyValue]}var l,c,u=t.get();return i.extend({init:function(e,t){t=t||{},this._primaryColorMode=t.colorBy||"auto",this._autoMode=t.autoMode||"auto",this._primaryColor=u.dataColors.primaryColor,this._persistColors=!0,this._wrangled=[],this._dimIndex=0,a(),this._themeChangeWatcher=function(){a()},u.ThemeChanged.bind(this._themeChangeWatcher),e&&this.setData(e)},release:function(){u.ThemeChanged.unbind(this._themeChangeWatcher)},setData:function(t,n){if(this._data=t,this._colorDataInfo=n,!n.valid)return this._dimLabel="",void(this._wrangled=[]);var i=t.color||{},s=t.qHyperCube?t.qHyperCube:t.qListObject,a=s&&s.qMeasureInfo?s.qMeasureInfo.length:0;this._colorMode=i.auto?"auto":i.mode||"primary",this._internalMode=this._colorDataInfo.internalMode,this._measureMode="multiple"===this._internalMode||"byMultiple"===this._colorMode||"meas_master"===this._internalMode||"dim_master"===this._internalMode,this._persistColors=this._colorDataInfo.persistentColors,this._dimIndex=this._colorDataInfo.dimIndex||0,this._measureMode?this._dimLabel=e.get("Common.Measures"):this._dimLabel=this._colorDataInfo.legendTitle,this._wrangled=this._colorDataInfo.wrangled.map(function(e){return e.elemValue}),this._dimSize=this._measureMode?a:this._colorDataInfo.dimSize,this._persistColors||(this._reMappedIndeces=o(this._wrangled,this._colorDataInfo.top)),this._primaryColor=r(i.singleColor,i.paletteColor),"none"===this._primaryColor&&(this._primaryColor="rgba(0,0,0,0)");var u=this._colorDataInfo.dimensionScheme&&l[this._colorDataInfo.dimensionScheme]||c;if("auto"===this._colorMode&&(u=c),"pyramid"===u.type){var h=Math.max(Math.min(u.scale.length-1,this._dimSize-1)%u.scale.length,0);this._qualitativeScale=u.scale[h]}else this._qualitativeScale=u.scale},getColor:function(e,t,i){var r=this._measureMode?i:this._wrangled[t];return"primary"===this._internalMode&&"auto"===this._colorMode?n.retriveColor(u.dataColors.primaryColor):"primary"===this._internalMode?n.retriveColor(this._primaryColor):isNaN(r)||-2===r?n.retriveColor(u.dataColors.nullColor):(r=s.call(this,r),n.retriveColor(this._qualitativeScale[r%this._qualitativeScale.length]))},getLegendMode:function(){var e="primary"===this._internalMode||"dim_master"===this._internalMode?"primary":"measure"===this._autoMode||this._measureMode?"measure":"dimension";return["box","item",e,"measure"===e]},getColorFromPreScaledValue:function(e){return e=s.call(this,e),n.retriveColor(this._qualitativeScale[e%this._qualitativeScale.length])},getDimensionIndex:function(){return this._colorDataInfo?this._dimIndex:0},getLegendTitle:function(){return this._dimLabel}})}),define("objects.views/charts/representation/combo-color-map-tooltip-util",[],function(){return{createLegendTemplate:function(e,t){return'<div class="color-template-wrapper"><div class="color-dot" style="background:'+t+'"></div><span dir="ltr">'+e+"</span></div>"}}}),define("objects.views/charts/representation/special-colors",["general.utils/color-cache","client.utils/theme/theme-module"],function(e,t){function n(){this._colors={others:e.retriveColor(i.dataColors.othersColor),null:e.retriveColor(i.dataColors.nullColor),error:e.retriveColor(i.dataColors.errorColor)},this._wrangled=[]}var i=t.get();return n.prototype.setProperties=function(t,n){if(this._dimIndex=t.dimIndex||0,this._wrangled=t.wrangled||[],this._colorMode=t.internalMode,this._colors={others:e.retriveColor(i.dataColors.othersColor),null:e.retriveColor(i.dataColors.nullColor),error:e.retriveColor(i.dataColors.errorColor)},n&&"dimension"===t.internalMode&&t.useDimColVal){var r;n.oth&&((r=e.retriveColor(i.resolveColor(n.oth))).isInvalid()||(this._colors.others=r)),n.nul&&((r=e.retriveColor(i.resolveColor(n.nul))).isInvalid()||(this._colors.null=r))}},n.prototype.getColor=function(e,t){var n=Array.isArray(e)?this._dimIndex>=0?e[this._dimIndex]:void 0:e,i="measure"!==this._colorMode&&this._wrangled[t]?this._wrangled[t].elemValue:void 0;return!Array.isArray(e)&&isNaN(e)?this._colors.error:-3===n||Array.isArray(e)&&-1!==e.indexOf(-3)?this._colors.others:(-2===n||-2===i)&&this._colors.null},n}),define("objects.views/charts/representation/dim-values-color-map",["core.utils/class","qvangular","client.utils/theme/theme-module","core.utils/deferred","client.services/color-map-service"],function(e,t,n,i){"use strict";function r(e){var t={};return e&&e.forEach(function(e){t[e.value]=e.baseColor}),t}function o(e,t){var n={};return t.forEach(function(e){n[e.text]||(n[e.text]=[]),n[e.text].push(e)}),e.forEach(function(e){n[e.value]&&n[e.value].forEach(function(t){t.baseColor=e.baseColor})}),t.map(function(e){return e.baseColor})}function s(e){var t=[];return e.forEach(function(e,n){var i=a(e);t[i]=n}),t}function a(e){return e.elemValue}function l(e,t,n,i,r){if(i){if(!0===r){var o=c();return o[a(i)%o.length]}if(e&&n)return n[a(i)%n.length]}var s=u.resolveColor(t);return"none"===s?u.dataColors.primaryColor:s}function c(e,t){return u.getPaletteScale(e||"",t)}var u=n.get();return e.extend({init:function(e){this.colors={},this.filler={},this.reverseMapping=[],this.fieldValueMap={},this.app=e},release:function(){this.colors=null,this.filler=null},setData:function(e,n,a,l){function u(e){var t=e||{};return h.fieldValueMap=r(t.colors),h.colors=o(t.colors||[],n.wrangled||[]),h.filler=t.single,h.palette=c(t.pal),h.usePalette=t.usePal,h.reverseMapping=s(n.wrangled||[]),h._dimValCols=e,h.autoFill=t.autoFill,e}var h=this;this.wrangled=n.wrangled;var d=n.altMode?n.attrInfo.colorMapRef:a&&a.coloring?a.coloring.colorMapRef:"";return l?i.resolve(l.dimValsData).then(u):t.getService("qvColorMapService").getColorMap(d,this.app).then(u)},getColor:function(e){return this.colors[e]?u.resolveColor(this.colors[e]):l(this.usePalette,this.filler,this.palette,this.wrangled[e],this.autoFill)},getColorFromPreScaledValue:function(e,t){var n=this.reverseMapping[e];return this.colors[n]?u.resolveColor(this.colors[n]):this.fieldValueMap[t]?u.resolveColor(this.fieldValueMap[t]):this.usePalette||this.autoFill?l(this.usePalette,this.filler,this.palette,{elemValue:e},this.autoFill):"none"},getDimValsData:function(){return this._dimValCols}})}),define("objects.views/charts/representation/dimension-color-util",[],function(){function e(e){return void 0!==e&&-1!==e}function t(t){return"byDimension"===t.mode&&t.byDimDef&&e(t.byDimDef.activeDimensionIndex)}return{isByNthDimension:t,useFallback:function(e,n){return n.auto||t(n)}}}),define("objects.views/charts/representation/combo-color-map-util",["client.utils/color-support"],function(e){function t(e){return!!e&&(e.coloring&&e.coloring.baseColor&&e.coloring.baseColor.color?e.coloring.baseColor:!(!e.baseColor||!e.baseColor.color)&&e.baseColor)}function n(e){return e.filter(function(e){return t(e)}).length>0}var i="primary",r="dimension",o="measure",s="expression",a="multiple",l="master",c="dim_master",u="meas_master",h="auto",d=e.baseColor;return{determineInternalMode:function(e,t,p,f,m){var g,v,y,b=Array.isArray(p.qDimensionInfo)?p.qDimensionInfo.length:1,x=p.qMeasureInfo?p.qMeasureInfo.length:0;return v="measure"===f&&n(p.qMeasureInfo),y="dimension"===f&&n(p.qDimensionInfo),g=v||y,e&&e!==h?"byMultiple"===e?e=g?l:a:"byDimension"===e?e=r:"byMeasure"===e?e=o:"byExpression"===e?e=s:e===i&&(y?e=c:v&&d.isSupported(m)&&(e=u)):e=b>1&&t!==i||t===r?r:n(p.qDimensionInfo)&&(1===b||t===i)&&(x<=1||t===i)?c:n(p.qMeasureInfo)&&(b<=1||t===i)&&d.isSupported(m)?u:t===i||t===h&&b<=1&&x<=1?i:x>1?a:r,e===l&&(e=v?u:c),e}}}),define("objects.views/charts/representation/combo-color-map",["translator","core.utils/class","core.utils/deferred","objects.views/charts/representation/legend-data-provider","objects.views/charts/representation/expression-color-map","objects.views/charts/representation/qualitative-color-map","objects.views/charts/representation/combo-color-map-tooltip-util","objects.views/charts/representation/color-map-data-wrangler","objects.views/charts/representation/special-colors","objects.views/charts/representation/dim-values-color-map","objects.views/charts/representation/dimension-color-util","general.utils/attribute-expression-util","general.utils/color-cache","client.utils/theme/theme-module","client.utils/color-support","objects.views/charts/representation/combo-color-map-util"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){function g(e){var t=-Number.MAX_VALUE,n=Number.MAX_VALUE,i=!0;return e.forEach(function(e){isNaN(e.elemValue)||(t=Math.max(e.elemValue,t),n=Math.min(e.elemValue,n),i=!1)}),{min:i?0:n,max:i?10:t}}function v(e){return e&&e.length&&1===(e=e.filter(function(e){return"N"===e.qType})).length&&"V"!==e[0].qSubNodes[0].qType?1+v(e[0].qSubNodes):0}function y(e,t,n,i){var r=e.auto,o=e.dimensionID;if(!r&&u.isByNthDimension(e))return e.byDimDef.activeDimensionIndex;var s=0,a=Array.isArray(t),l=a?t.length:1;if(o&&!r)for(s;s<l;++s)if((a?t[s].cId:t.cId)===o)return s;var c=i.qStackedDataPages&&i.qStackedDataPages.length&&i.qStackedDataPages[0].qData&&i.qStackedDataPages[0].qData.length?i.qStackedDataPages[0].qData[0].qSubNodes:null;return n===T?v(c):l-1}function b(e,t,n,i,r){return t===M?e||n.qDimensionInfo.length>1||r&&n.qSize.qcy>i.qArea.qHeight:t===A&&("K"===n.qMode||n.qSize.qcy>i.qMatrix.length)}function x(e,t,n){var i=0;if(0===n){for(;e&&e.parent;)e=e.parent;return e}for(;t;){if(e.getDimensions().length-1===n)return e;if(e.getDimensions().length-1-i===n)return t;t=t.parent,i++}}function q(e){return!!e&&(e.coloring&&e.coloring.baseColor&&e.coloring.baseColor.color?e.coloring.baseColor:!(!e.baseColor||!e.baseColor.color)&&e.baseColor)}function C(e,t,n){n=Array.isArray(n)?n:[n];var i=e.qHyperCube.qMeasureInfo;return!(-1!==n.indexOf(L)||-1!==n.indexOf(k))&&P.isSupported(e.visualization)&&!!q(i[t])}function S(e,t){var n=-1!==(t=Array.isArray(t)?t:[t]).indexOf(L)||-1!==t.indexOf(k),i=e.qHyperCube.qDimensionInfo.filter(function(e){return!!q(e)}).length>0;return!n&&i}function w(e){return q(e.filter(function(e){return!!q(e)})[0])}var _,D="primary",M="dimension",A="measure",E="dim_master",I="meas_master",T="first",L=-3,k=-2,O=p.get(),P=f.baseColor;return _=t.extend({init:function(e,t){e=e||{},this._autoMode=e.autoMode||"auto",this._multiDimScheme=e.multiDimScheme||"last",this._qualitativeMap=new o(null,e),this._sequentialMap=new r(null,e,t),this._legendDataProvider=new i,this._legendDataProvider.setColorMap(this),this._specialColorMap=new l,this._dimValsMap=new c(t),this._enableAltMode=!0,this._colorDataInfo={dimIndex:0,wrangled:[],valid:!1,legendMode:{}},this._title="DEBUG"},getColor:function(e,t,n,i){var r=this._specialColorMap.getColor(e,i);return r||(this._colorDataInfo.internalMode===M&&this._colorDataInfo.useDimColVal?d.retriveColor(this._dimValsMap.getColor(i)):"error"===this._colorDataInfo.internalMode?this._qualitativeMap.getColor(k):"measure"===this._colorMode||"expression"===this._colorMode?this._sequentialMap.getColor(e,i,n,t):this._colorDataInfo.internalMode===I&&C(this._data,n,e)?d.retriveColor(O.resolveColor(q(this._data.qHyperCube.qMeasureInfo[n]))):this._colorDataInfo.internalMode===E&&S(this._data,e)?d.retriveColor(O.resolveColor(w(this._data.qHyperCube.qDimensionInfo))):this._qualitativeMap.getColor(e,i,n,t))},getColorScale:function(){return this._qualitativeMap},getColorFromPreScaledValue:function(e,t){if("measure"===this._colorMode||"expression"===this._colorMode)return this._sequentialMap.getColorFromPreScaledValue(e);var n=this._specialColorMap.getColor(e);return n||(this._colorDataInfo.internalMode===M&&this._colorDataInfo.useDimColVal?d.retriveColor(this._dimValsMap.getColorFromPreScaledValue(e,t)):this._qualitativeMap.getColorFromPreScaledValue(e))},getTooltipContent:function(t,n){var i,r,o,a,l,c=null;if(this._colorDataInfo.valid)if("expression"===this._colorMode&&(r=i=this._sequentialMap.getExpressionValue(void 0===n?t.row:n),void 0!==i&&(this._sequentialMap.getValueFormatter&&(o=this._sequentialMap.getValueFormatter())&&(i=o.formatValue(i)),c={label:this.getLegendTitle(),template:s.createLegendTemplate(i,this._sequentialMap.getColor(t.id,void 0===n?t.row:n,0,i)),num:r})),this._colorDataInfo.altMode){var u=!0;if("dimension"===this._colorDataInfo.internalMode){var h=t._attrDims[this._colorDataInfo.attrIndex];if(!h)return;t.id===L?(l=t.id===L?e.get("properties.dimensionLimits.others"):h.label?h.label:"",a=this.getColorFromPreScaledValue(L)):h.value===k?(l=h.value===k?"-":h.label?h.label:"",a=this.getColorFromPreScaledValue(k)):(l=h.label?h.label:"",u=!(a=this.getColorFromPreScaledValue(h.value)).isInvalid())}else"measure"===this._colorDataInfo.internalMode&&(r=i=void 0!==n?this._colorDataInfo.wrangled[n].elemValue:t.values[this._colorDataInfo.legendMode.rangeSelectionIndex],u=void 0!==i,l=this._sequentialMap.getGenericFormatter&&(o=this._sequentialMap.getGenericFormatter())?o.formatValue(i):i,a=this.getColorFromPreScaledValue(i));u&&(c={label:this.getLegendTitle(),value:l+"",num:r,template:s.createLegendTemplate(l,a)})}else if("dimension"===this._colorDataInfo.internalMode){var d=t.getDimensions(),p=d[d.length-this._colorDataInfo.dimIndex-1];if(!p)return;l=p;var f=x(t,t,this._colorDataInfo.dimIndex);(a=this.getColorFromPreScaledValue(f.id)).isInvalid()||(c={label:this.getLegendTitle(),template:s.createLegendTemplate(l,a)})}return c},getColorMapping:function(){return this._legendDataProvider.getColorMapping()},generateScaleBasedMapping:function(){return this._sequentialMap.generateScaleBasedMapping()},getSelectionIndices:function(){return this.getDimensionIndex()},getLegendTitle:function(){return"measure"===this._colorMode||"expression"===this._colorMode?this._sequentialMap.getLegendTitle():this._qualitativeMap.getLegendTitle()},getDimensionIndex:function(){return"measure"===this._colorMode?[0]:[this._qualitativeMap.getDimensionIndex()]},setData:function(e,t){function i(t){var n;n=l.internalMode===I&&1===o._data.qHyperCube.qMeasureInfo.length||l.internalMode===E&&1===o._data.qHyperCube.qDimensionInfo.length?D:t[2],l.legendMode={discrete:"scale"!==t[0],boxType:t[1],colorMode:n,selectionEnabled:!t[3],altMode:l.altMode,rangeSelectionIndex:l.altMode?o._data.qHyperCube.qMeasureInfo.length:0},l.altMode&&l.internalMode===M&&l.valid&&"dimension"===l.legendMode.colorMode&&(l.legendPath="/qHyperCubeDef/qDimensions/"+x+"/qAttributeDimensions/"+T,l.legendPages=[{qTop:0,qLeft:0,qWidth:2,qHeight:3e3}],l.altLocked=f.qLocked),o._legendDataProvider.setData(e)}function r(){return o._colorDataInfo=l,o._colorDataInfo}var o=this,s=[];this._colorMode="qualitative",this._data=e,this._colorDataInfo={dimIndex:0,wrangled:[],valid:!1,legendMode:{}};var l={dimIndex:0,wrangled:[],valid:!1,legendMode:{}};if(e.color){var c=e.color,d=e.qHyperCube,p="";if(!d)return n.resolve().then(r);p=e.qInfo&&e.qInfo.qType?e.qInfo.qType:t,l.internalMode=m.determineInternalMode(c.auto?"auto":c.mode||"auto",this._autoMode,d,c.useBaseColors,p),l.useDimColVal=c.useDimColVal||c.auto&&l.internalMode===M,l.useMeasureGradient=c.useMeasureGradient||c.auto&&l.internalMode===A;var f,v,x=this._data.qHyperCube.qDimensionInfo.length-1,q=this._data.qHyperCube.qDataPages[0]||this._data.qHyperCube.qStackedDataPages[0]||{qArea:{qHeight:0},qMatrix:[]},C=e.qHyperCube.qDimensionInfo[x],S=e.qHyperCube.qMeasureInfo[0],w=x,_=x,T=-1;l.internalMode===M?(T=h.getIndexById(C.qAttrDimInfo,h.IDMAP.COLOR_BY_ALTERNATIVE),f=-1!==T?C.qAttrDimInfo[T]:null,v="qAttrDims",u.useFallback(f,c)&&(T=-1,f=null)):l.internalMode===A&&(T=h.getIndexById(C.qAttrExprInfo,h.IDMAP.COLOR_BY_ALTERNATIVE),f=-1!==T?C.qAttrExprInfo[T]:null,v="qAttrExps"),l.altMode=this._enableAltMode&&!!f&&x>=0&&T>=-1;var L=!l.altMode&&l.internalMode===A&&!S;if(l.valid=(l.altMode&&f&&!f.qError||!l.altMode&&!!C)&&!L,!l.valid)return l.internalMode="error",l.allNaN=!0,n.resolve().then(r);if(l.dimIndex=x,l.attrIndex=T,l.hasOthers=!!e.qHyperCube.qHasOtherValues,l.persistentColors=b(c.persistent,l.internalMode,d,q,l.altMode),l.top=q.qArea.qTop,l.attrInfo=f,l.altMode?(l.internalMode===A?(l.minMax={min:f.qMin||0,max:f.qMax||10},l.matchingDataMeasure=f.matchMeasure,l.dimSize=!1===c.autoMinMax?C.qCardinal:e.qHyperCube.qSize.qcy):l.internalMode===M&&(l.dimSize=l.persistentColors?f.qCardinal:f.qSize.qcy),l.legendTitle=f.label||f.qFallbackTitle):l.internalMode===A?(w=x+1,l.minMax=isNaN(S.qMin)||isNaN(S.qMax)?null:{min:S.qMin||0,max:S.qMax||10},l.legendTitle=S.qFallbackTitle,l.dimSize=!1===c.autoMinMax?C.qCardinal:e.qHyperCube.qSize.qcy):l.internalMode===M?(l.dimIndex=x=w=y(c,d.qDimensionInfo,this._multiDimScheme,d),C=e.qHyperCube.qDimensionInfo[x],l.legendTitle=C.qFallbackTitle,l.dimSize=l.persistentColors?C.qCardinal:e.qHyperCube.qSize.qcy):"expression"===l.internalMode&&(l.dimSize=!1===c.autoMinMax?C.qCardinal:e.qHyperCube.qSize.qcy),l.internalMode!==A&&l.internalMode!==M||(l.wrangled=a.wrangleData(e.qHyperCube,T,w,!(!l.altMode||!l.valid)&&v,l.internalMode===M,_),l.allNaN=l.altMode&&0===l.wrangled.filter(function(e){return l.internalMode===M?e.elemValue!==k&&!isNaN(e.elemValue):!isNaN(e.elemValue)}).length),l.internalMode!==A||l.persistentColors||(l.minMax=g(l.wrangled)),e.color.auto)this._colorMode="auto";else switch(l.internalMode){case A:this._colorMode="measure";break;case"expression":this._colorMode="expression";break;case D:this._colorMode="primary"}l.dimensionScheme=e.color.dimensionScheme,l.internalMode!==I&&l.internalMode!==E||(l.dimensionScheme=O.dataPalettes[0].propertyValue);var P;"measure"===this._colorMode||"expression"===this._colorMode?s.push(n.resolve(this._sequentialMap.setData(e,l,this._snapshotChartData)).then(function(){i(P=o._sequentialMap.getLegendMode())})):(this._qualitativeMap.setData(e,l),i(P=this._qualitativeMap.getLegendMode()))}return l.internalMode===M&&l.useDimColVal?this._dimValsMap.setData(c,l,C,this._snapshotChartData).then(function(e){return o._specialColorMap.setProperties(l,e),e?l.persistentColors=!0:l.useDimColVal=!1,r()}):(this._specialColorMap.setProperties(l),n.all(s).then(r))},hasAttributeDimension:function(){return this._colorDataInfo.altMode&&!!this._colorDataInfo.legendPath},getAttributeDimensionInfo:function(){return this.hasAttributeDimension()?[this._colorDataInfo.attrInfo]:[]},getColorDataInfo:function(){return this._colorDataInfo},setAltModeEnabled:function(e){this._enableAltMode=e},setMeasureFormatters:function(e){this._measureFormatters=e,this._sequentialMap.setMeasureFormatters(e)},setGenericFormatter:function(e){this._sequentialMap.setGenericFormatter(e)},getValueFormatter:function(){return this._measureFormatters?this._measureFormatters[0]:null},setDimensionTree:function(e){this._dimensionTree=e,this._legendDataProvider.setDimensionTree(e)},getLegendDataProvider:function(){return this._legendDataProvider},setSnapshotChartData:function(e){this._snapshotChartData=e},getSnapshotChartData:function(){var e=[],t=this._dimValsMap.getDimValsData();t&&e.push({key:"dimValsData",data:t});var n=this._sequentialMap&&this._sequentialMap._measureGradient?this._sequentialMap._measureGradient:null;return n&&e.push({key:"measureGradient",data:n}),e},release:function(){this._qualitativeMap.release&&this._qualitativeMap.release(),this._sequentialMap.release&&this._sequentialMap.release(),this._legendDataProvider.release&&this._legendDataProvider.release(),this._dimensionTree=null,this._legendDataProvider=null,this._sequentialMap=null,this._qualitativeMap=null}}),Object.defineProperties(_.prototype,{mode:{get:function(){return this._colorMode}}}),Object.defineProperties(_,{AUTO:{value:"auto",writable:!1},PRIMARY:{value:"primary",writable:!1},MEASURE:{value:"measure",writable:!1},EXPRESSION:{value:"expression",writable:!1},QUALITATIVE:{value:"qualitative",writable:!1},DIMENSION:{value:M,writable:!1}}),Object.defineProperties(_.prototype,{AUTO:{value:"auto",writable:!1},PRIMARY:{value:"primary",writable:!1},MEASURE:{value:"measure",writable:!1},EXPRESSION:{value:"expression",writable:!1},QUALITATIVE:{value:"qualitative",writable:!1},DIMENSION:{value:M,writable:!1}}),_}),define("objects.views/charts/events/chart-event",["core.utils/class"],function(e){"use strict";return e.extend({init:function(e){this._type=e},getType:function(){return this._type}})}),define("objects.views/charts/events/property-change-event",["objects.views/charts/events/chart-event"],function(e){"use strict";return e.extend({init:function(e,t,n){this._super("propertyChange"),this.property=e,this.oldValue=t,this.newValue=n}})}),define("objects.views/charts/utils/binding",["core.utils/class","objects.views/charts/events/event-launcher","objects.views/charts/events/property-change-event"],function(e,t,n){function i(){var e,t,n,i,o,c,u,h;for(4===arguments.length?(n=new a(arguments[0]),e=arguments[1],t=arguments[2],c=arguments[3]):(n=new a(arguments[0],arguments[1]),e=arguments[2],t=arguments[3],c=arguments[4]),o=(i=t.split("."))[0],h=0;h<i.length;h++)u=new s(e,o),n.add(u),e=e&&"function"==typeof e[r(o)]?e[r(o)]():void 0,o=i[h+1];return n.startObserving(c),new l(n)}function r(e){return"get"+e.substring(0,1).toUpperCase()+e.substring(1)}function o(e,t){var i,r,o=t.substring(0,1).toUpperCase()+t.substring(1);"function"==typeof e["set"+o]&&(e[u]||(e[u]={}),void 0===e[u][t]?(i=e["set"+o],r=e.hasOwnProperty("set"+o),e["set"+o]=function(r){var s="function"==typeof e["get"+o]?e["get"+o]():void 0;"function"!=typeof e["get"+o]||r!==s?(i.call(e,r),e.fire(new n(t,s,r))):i.call(e,r)},e[u][t]={observers:1,original:i,isOriginalOwn:r,keep:!1}):e[u][t].observers++)}var s,a,l,c,u="__setters";return s=t.extend("Link",{init:function(e,t){this._super(),this._property=t,this._host=e},setHost:function(e){this._host===e&&this._hostObserved||(this.unobserve(),this._host=e,this.observe())},observe:function(e){if(this._host){o(this._host,this._property);var t=this,n=r(this._property);this._callback=function(e){e.property===t._property&&t.fire("hostPropertyValueChanged",[e.newValue])},this._callbackSimple=function(){"function"==typeof this[n]&&t.fire("hostPropertyValueChanged",[this[n]()])},e||"function"!=typeof this._host[n]||t.fire("hostPropertyValueChanged",[this._host[n]()]),this._host.listen("propertyChange",this._callback),this._host.listen(this._property+"Changed",this._callbackSimple),this._hostObserved=!0}else this.fire("hostPropertyValueChanged",[void 0])},unobserve:function(){if(this._host){if(this._callback&&this._host.stopListen("propertyChange",this._callback),this._callbackSimple&&this._host.stopListen(this._property+"Changed",this._callbackSimple),this._host[u]&&this._host[u][this._property]){var e,t=this._host[u][this._property];t.observers--,t.observers<=0&&(e="set"+this._property.substring(0,1).toUpperCase()+this._property.substring(1),t.isOriginalOwn?this._host[e]=t.original:(this._host[e]=null,delete this._host[e]),t.original=null,this._host[u][this._property]=null,delete this._host[u][this._property])}this._host=void 0,this._callback=void 0,this._callbackSimple=void 0,this._hostObserved=!1}}}),a=e.extend("Chain",{init:function(e,t){this._links=[],1===arguments.length&&"function"==typeof e?this._setter=e:(this._wannabe=e,this._wannabeProp=t)},add:function(e){var t,n=this;e.listen("hostPropertyValueChanged",function(e){if((t=n._links.indexOf(this))===n._links.length-1)if(n._setter)n._setter(e);else{var i="set"+n._wannabeProp.substring(0,1).toUpperCase()+n._wannabeProp.substring(1);"function"==typeof n._wannabe[i]&&n._wannabe[i](e)}else n._links[t+1].setHost(e)}),this._links.push(e)},startObserving:function(e){this._links[0].observe(e)},isBroken:function(){return this._isBroken},unwatch:function(){for(var e=this._links.pop();e;)e.unobserve(),e.stopListen("hostPropertyValueChanged"),e=this._links.pop();this._setter=void 0,this._wannabe=void 0,this._wannabeProp=void 0}}),l=e.extend("ChangeWatcher",{init:function(e){this._chain=e},unbind:function(){this._chain.unwatch()}}),c={},c.bindProperty=function(e,t,n,r,o){return i(e,t,n,r,o)},c.bindSetter=function(e,t,n,r){return i(e,t,n,r)},c.getter=r,c}),define("objects.views/charts/components/mini-chart",["./chart-component","../components/axis/continuous-axis","../components/data-area","../chart-context","objects.views/charts/representation/combo-color-map","objects.views/charts/utils/binding","general.utils/color","core.utils/deferred"],function(e,t,n,i,r,o,s,a){function l(e){var t=[],n=[];return e.qHyperCube.qMeasureInfo.forEach(function(e){e.series&&"bar"!==e.series.type&&1===e.series.axis?n.push(e):t.push(e)}),{primaryMeasures:t,secondaryMeasures:n}}function c(e,t){var n,i={};if(t)for(n in e)i[n]="qHyperCube"===n?{qDataPages:[],qDimensionInfo:e.qHyperCube.qDimensionInfo.slice(),qMeasureInfo:e.qHyperCube.qMeasureInfo.slice(),qStackedDataPages:[],qMode:"S",qSize:e.qHyperCube.qSize}:e[n];else{if(!e.reducedHyperCube)return e;i={};for(n in e)i[n]="qHyperCube"===n?e.reducedHyperCube:e[n]}return i}var u;return u=e.extend("MiniChart",{init:function(e,t){this._super.apply(this,Array.prototype.slice.call(arguments)),this.components={},this._changeWatchers=[],this.options=t,this._chartContext=new i,this._createComponents();this._colorMap=void 0,this._constantColorMap={getColorByNode:function(){return new s(12303291)},getColor:function(){return new s(12303291)}},this.components.dataArea.setColorMap&&this.components.dataArea.setColorMap(this._constantColorMap),this.components.continuousAxis&&this.components.dataArea.setContinuousAxis(this.components.continuousAxis),this.components.dataArea.setLayoutMode(3),this._changeWatchers.push(o.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree")),this._logScale=!1},setYMirrorMode:function(e){if(this.yMirrorMode!==e){this.yMirrorMode=e;for(var t in this.components)this.components[t].setYMirrorMode(e)}},setData:function(e,t){if(!e||!e.qHyperCube)return a.resolve();if(this.isDimensionContinuous=t,this.components.dataArea.setIsDimensionContinuous&&this.components.dataArea.setIsDimensionContinuous(t),t)return this._data=e,this.invalidateProperties("Mini-chart: setData");this._data=null;var n,i,r=e.qHyperCube,o=this,s=Math.min(2e3,1e4/(r.qMeasureInfo.length+1)),l=("linechart"===e.visualization||"barchart"===e.visualization&&e.barGrouping&&"stacked"===e.barGrouping.grouping)&&r.qDimensionInfo.length>1&&"K"===r.qMode?1:0;return"function"!=typeof this.backendApi.getReducedData?(this._data=c(e),this.invalidateProperties()):(n=c(e,!0),e.reducedHyperCube=n.qHyperCube,i=e.reducedHyperCube,this.backendApi.getReducedData([{qTop:0,qLeft:l,qWidth:e.qHyperCube.qDimensionInfo.length+e.qHyperCube.qMeasureInfo.length+l,qHeight:s}],-1).then(function(e){return i.qDataPages=e,o._data=n,l&&e&&(e[0].isReduced||e[0].qIsReduced)&&(i.qDimensionInfo=r.qDimensionInfo.slice(0,1),i.qMeasureInfo=[r.qMeasureInfo[0],r.qMeasureInfo[0]]),o.invalidateProperties()}))},calculateRelevantSize:function(){this.relevantSize=Math.max(30,Math.min(40,this.outerRect[this.isVertical()?"width":"height"]/8))},setRect:function(e,t,n,i){this.rect.width===n&&this.rect.height===i||this.invalidateDisplay(),this._super(e,t,n,i);for(var r in this.components)this.components[r].setRect(0,0,n,i);this.updateSize()},setOuterRect:function(e,t,n,i){this._super(e,t,n,i);for(var r in this.components)this.components[r].setOuterRect(e,t,n,i)},setLayoutToContainerRatios:function(e,t){this._super(e,t);for(var n in this.components)this.components[n].setLayoutToContainerRatios(e,t)},setContainerRect:function(e,t,n,i){this._super(e,t,n,i);for(var r in this.components)this.components[r].setContainerRect(e,t,n,i)},updateSize:function(){this._super();for(var e in this.components)this.components[e].updateSize()},isVisible:function(e){return this._super(e)&&this.rect&&this.rect.width>0&&this.rect.height>0},setLogScale:function(e){this._logScale=e,!0!==this._logScale&&(this._logScale=!1)},getLogScale:function(){return this._logScale},setHasValidData:function(e){this._super(e),Object.keys(this.components).forEach(function(t){this.components[t].setHasValidData(e)},this)},setDock:function(e){this._super(e),this.isVertical()?(this.components.measureAxis.setDock("top"),this.components.dimensionAxis.setDock("left")):(this.components.measureAxis.setDock("left"),this.components.dimensionAxis.setDock("bottom"))},paint:function(e,t){if(!t||!this.isVisible())return a.resolve();this._super(e,t);var n,i=[];this.components.dataArea.rect=this.rect.clone(),this.components.dimensionAxis.rect=this.components.dataArea.rect,this.components.measureAxis.rect=this.components.dataArea.rect,this.components.dataArea.rect.x=0,this.components.dataArea.rect.y=0,this.components.dimensionAxis.invalidateProperties("MiniChart.paint"),this.components.dimensionAxis.updateNow(["properties"]),this.components.measureAxis.invalidateProperties("MiniChart.paint"),this.components.measureAxis.updateNow(["properties"]),this.components.dimensionAxis.calculateValuePositionMappingInfo(),this.components.measureAxis.calculateValuePositionMappingInfo();for(n in this.components)i.push(this.components[n].invalidateDisplay("MiniChart.paint"));return a.all(i)},_createComponents:function(){var e=this.components,i=this.options;Object.keys(i.components).forEach(function(r){var o,s=[this.testId||"component",r].join("."),a=i.components[r];if(a.label=r,"function"==typeof i.components[r].clazz)o=i.components[r].clazz;else switch(r){case"dataArea":o=n;break;case"yAxis":case"measureAxis":o=t}o&&(e[r]=new o(this.container,a,s)),e[r].setUseTransition&&e[r].setUseTransition(!1)},this)},setActiveDimensionAxis:function(e){this.components[e]&&(this._activeDimAxis=this.components[e],this.components.dataArea&&this.components.dataArea.setActiveDimensionAxis(this.components[e]))},updateAxis:function(e){var t,n,i,r,o,s,a,c,u,h;"combochart"===e.visualization?(a=e.qHyperCube.qMeasureInfo.filter(function(e){return!e.series||"bar"===e.series.type}),u=(c=l(e)).primaryMeasures,h=c.secondaryMeasures,o=Math.min.apply(this,h.filter(function(e){return!isNaN(e.qMin)}).map(function(e){return e.qMin})),s=Math.max.apply(this,h.filter(function(e){return!isNaN(e.qMax)}).map(function(e){return e.qMax})),this.components.secondaryMeasureAxis.setDataRange(o,s),o=Math.min.apply(this,u.filter(function(e){return!isNaN(e.qMin)}).map(function(e){return e.qMin})),s=Math.max.apply(this,u.filter(function(e){return!isNaN(e.qMax)}).map(function(e){return e.qMax}))):(o=Math.min.apply(this,e.qHyperCube.qMeasureInfo.filter(function(e){return!isNaN(e.qMin)}).map(function(e){return e.qMin})),s=Math.max.apply(this,e.qHyperCube.qMeasureInfo.filter(function(e){return!isNaN(e.qMax)}).map(function(e){return e.qMax}))),t=this.components.measureAxis,n=this.components.dimensionAxis,t.setNiceNumberEnabled(!1),t.setLogScale(this._logScale),"barchart"===e.visualization&&(s=Math.max(0,s),o=Math.min(0,o)),(r=this.components.dataArea.getMinorAxisData())&&("combochart"===e.visualization&&u.forEach(function(e){a.indexOf(e)<0&&!isNaN(e.qMin)&&(r.min=Math.min(e.qMin,r.min),r.max=Math.max(e.qMax,r.max))}),s=r.max,o=r.min),o===s&&0===s||isNaN(o)&&isNaN(s)?(s=10,o=-10,t.setDataRange(o,s)):(r||this.isDimensionContinuous)&&t.setDataRange(o,s),this.isDimensionContinuous?e.qHyperCube.qDimensionInfo&&(o=e.qHyperCube.qDimensionInfo[0].qMin,s=e.qHyperCube.qDimensionInfo[0].qMax,this._activeDimAxis.setDataRange(o,s),this._activeDimAxis.setPlotMin(o),this._activeDimAxis.setPlotMax(s)):(i=this.components.dataArea.getMajorAxisData())?n.setDataRange(i.data,i.info):n.setDataRange([],[])},setBackendApi:function(e){this.backendApi=e},setColorMap:function(e){this._colorMap=e},getColorMap:function(){return this._colorMap},setSnapshotChartData:function(e){this._snapshotChartData=e},setOrientation:function(e){this._orientation=e||"horizontal"},_updateProperties:function(){function e(){n._chartContext.refresh(t),n._miniColorMap&&n._miniColorMap.setDimensionTree(n._chartContext.getDimensionTree()),n.components.dataArea.setData(t),n.components.dataArea.updateNow(["properties"]),n.updateAxis(t),n.invalidateDisplay("MiniChart._updateProperties")}if(this._data){var t=this._data,n=this;if(t&&t.qHyperCube&&t.qHyperCube.qDimensionInfo[0]){var i=t.qHyperCube.qDataPages[0]&&t.qHyperCube.qDataPages[0].qIsReduced;if(this.components.dataArea.setColorMap){if(this.isDimensionContinuous||!i&&(t.color.auto||"byExpression"!==t.color.mode))return this._miniColorMap||(this._miniColorMap=new r(null,this.backendApi.model.app)),this._colorMap&&(t.color.persistent=!!this._colorMap.getColorDataInfo().persistentColors),this.components.dataArea.setColorMap(this._miniColorMap),this._miniColorMap.setSnapshotChartData(this._snapshotChartData),this._miniColorMap.setData(t).then(e);this.components.dataArea.setColorMap(this._constantColorMap)}}return e()}},clear:function(){Object.keys(this.components).forEach(function(e){this.components[e].clear()},this)},release:function(){for(this._super(),Object.keys(this.components).forEach(function(e){this.components[e].release()},this),this._miniColorMap&&this._miniColorMap.release();this._changeWatchers.length;)this._changeWatchers.pop().unbind();this._chartContext.release()},showComponent:function(){if(this._super.apply(this),this.components.dataArea&&this.components.dataArea.renderers)for(var e in this.components.dataArea.renderers)this.components.dataArea.renderers[e].show()},hideComponent:function(){if(this._super.apply(this),this.components.dataArea&&this.components.dataArea.renderers)for(var e in this.components.dataArea.renderers)this.components.dataArea.renderers[e].hide()}}),Object.defineProperty(u.prototype,"className",{value:"MiniChart"}),u}),define("objects.views/charts/utils/chart-formatting",["jquery","core.utils/class","objects.utils/num-date-time-formatter","objects.utils/number-formatter"],function(e,t,n){"use strict";function i(e){return!!e.qIsAutoFormat&&["M","D","T","TS","IV"].indexOf(e.qNumFormat.qType)<0}return t.extend("ChartFormatting",{init:function(t,n){this.localeInfo=t;var i=this.getFormattersForMeasures(n),r=e.extend(!0,[],i);if(r&&1===r.length&&n[0].isCustomFormatted)r=null;else{for(var o=0,s=0;s<r.length;s++)n[s].isCustomFormatted&&(r[s]=null,o++);o===r.length&&(r=null)}this.measureFormatters=r,this.combinedMeasuresFormatter=this.getFormatterFromFormatters(i)},createFormatter:function(){return new n(this.localeInfo)},getLocaleInfo:function(){return this.localeInfo||{}},getFormatters:function(){return this.measureFormatters||[]},getMeasureFormatter:function(e){if(this.measureFormatters&&this.measureFormatters[e])return this.measureFormatters[e]},getCombinedMeasuresFormatter:function(){return this.combinedMeasuresFormatter},formatMeasure:function(e,t){var n=this.measureFormatters[t];return n?n.format(e):e},getFormatterFromFormatters:function(e){var t,i,r,o,s,a=0,l=0,c=0,u=e?e.filter(function(e){return!!e.values&&!isNaN(e.values.range)}):[];return e&&e.length&&(e.forEach(function(e){return"U"===e.type||e.values&&isNaN(e.values.range)?l++:["D","T","TS","IV"].contains(e.type)?a=1:c=1,e.prepare(),e}),u.length&&(t=u.reduce(function(e,t){return Math.min(t.values.min,e)},u[0].values.min),i=u.reduce(function(e,t){return Math.max(t.values.max,e)},u[0].values.max),r=Math.abs(i-t)),a+c>1?(s=e.filter(function(e){return"datetime"!==e.type})[0]||{},o=new n(this.localeInfo,s.pattern,s.thousandDelimiter,s.decimalDelimiter,"U"),isNaN(r)||(o.pattern=o.createPatternFromRange(t,i,!0))):a+c===1&&0===l?(s=e[0]||{},o=new n(this.localeInfo,s.pattern,s.thousandDelimiter,s.decimalDelimiter,s.type)):(s=(s=e.filter(function(e){return"U"!==e.type})).length?s[0]:e[0]||{},o=new n(this.localeInfo,s.pattern,s.thousandDelimiter,s.decimalDelimiter,s.type),isNaN(r)||"U"!==s.type||(o.pattern=o.createPatternFromRange(t,i,!0))),o.prepare()),o||(o=new n(this.localeInfo,"0")),o},getFormattersForMeasures:function(e,t){var r=[];return e&&e.length&&(r=(t?e.filter(function(e,n){return t.indexOf(n)>=0}):e).map(function(e){var t=i(e),r=new n(this.localeInfo,e.qNumFormat.qFmt,e.qNumFormat.qThou,e.qNumFormat.qDec,t?"U":e.qNumFormat.qType),o=Math.abs(e.qMax-e.qMin),s=isNaN(o);return r.values={min:e.qMin,max:e.qMax,range:o},!s&&t&&(r.pattern=r.createPatternFromRange(e.qMin,e.qMax,!0)),r.prepare(),r},this)),r}})}),define("objects.views/selections/selections-cache",["core.utils/class"],function(e){function t(e,t,n){var i=t.indexOf(e);-1===i&&!1!==n?t.push(e):-1===i||n||t.splice(i,1)}function n(e){var t,n=[];return e.forEach(function(e){e.split(";").forEach(function(e){t=e.split(":"),n[+t[0]]||(n[+t[0]]=[]),-1===n[t[0]].indexOf(+t[1])&&n[t[0]].push(+t[1])})}),n}function i(e){e._dirty&&(e.columns=n(e.values)),e._dirty=!1}function r(e,t){var n=[];do{t&&-1===t.indexOf(e.col)||n.push(e.col+":"+e.id)}while((e=e.parent)&&void 0!==e.col&&void 0!==e.id);return n.join(";")}var o,s={ROW:1,VALUE:2};return o=e.extend({init:function(){this.rows=[],this.values=[],this.columns=[],this.indicesToTrack=null,this._dirty=!1,this.selectionMode=s.ROW|s.VALUE},clear:function(){this.clearRows(),this.clearValues()},toggle:function(e,t){this.toggleRow(e.row,t),this.toggleValue(e.value,e.col,t)},toggleByCacheItem:function(e){this.toggleRow(e.rowIndex||e.row||0,e.selected);var n=r(e,this.indicesToTrack);n&&t(n,this.values,e.selected),this._dirty=!0},toggleRow:function(e,n){t(e,this.rows,n)},toggleValue:function(e,n,i){t((n||0)+":"+e,this.values,i),this._dirty=!0},isRowSelected:function(e){return!!(this.selectionMode&s.ROW)&&-1!==this.rows.indexOf(e)},isValueSelected:function(e,t){return!!(this.selectionMode&s.VALUE)&&(i(this),void 0!==this.columns[t||0]&&-1!==this.columns[t||0].indexOf(e))},isValueChainSelected:function(e){if(!(this.selectionMode&s.VALUE))return!1;if(this.indicesToTrack){i(this);var t=r(e,this.indicesToTrack).split(";");return t.length&&!t.some(function(e){var t=e.split(":");return!(void 0!==this.columns[+t[0]||0]&&-1!==this.columns[+t[0]||0].indexOf(+t[1]))},this)}return-1!==this.values.indexOf("string"==typeof e?e:r(e,this.indicesToTrack))},isCacheItemSelected:function(e){return this.isValueChainSelected(e)||this.isRowSelected(e.rowIndex||e.row||0)},hasSelections:function(){return!!(this.selectionMode&s.ROW)&&this.rows.length>0||!!(this.selectionMode&s.VALUE)&&this.values.length>0},setRows:function(e){this.rows=e.slice()},setValues:function(e,t){this.values=e.map(function(e){return(t||0)+":"+e}),this._dirty=!0},getSelectedColumns:function(){i(this);var e=this.columns;return e.filter(function(e){return void 0!==e}).map(function(t){return e.indexOf(t)})},getSelectedValuesInColumn:function(e){return i(this),this.columns[e||0]||[]},getSelectedValues:function(){return i(this),this.columns},clearRows:function(){this.rows.length=0},clearValues:function(){this.values=[],this.columns.length=0,this._dirty=!1},setSelectionMode:function(e){this.selectionMode=e},trackByIndices:function(e){this.indicesToTrack=Array.isArray(e)?e.slice():null}}),o.SELECTION_MODE=o.prototype.SELECTION_MODE=s,o}),define("objects.views/selections/attribute-selections-cache",["objects.views/selections/selections-cache"],function(e){return e.extend("AttributeSelectionsCache",{isCacheItemSelected:function(e){var t=e.getAttributeDimensions();return t&&1===t.length&&this.isValueSelected(t[0])}})}),define("objects.views/selections/cache-collection",[],function(){function e(e){this.collection=e||[]}return e.prototype={clear:function(){this.collection.forEach(function(e){e.clear()})},add:function(e){-1===this.collection.indexOf(e)&&this.collection.push(e)},remove:function(e){var t=this.collection.indexOf(e);-1!==t&&this.collection.splice(t,1)},isCacheItemSelected:function(e){return this.collection.some(function(t){return t.isCacheItemSelected(e)})}},e}),define("text!objects.views/charts/disclaimers/chart-disclaimer.ng.html",[],function(){return'<div class="qv-viz-disclaimer"\n\t ng-if="visible && (attributes.limitedData || attributes.onlyNullColor || attributes.hasNegativeOrZeroData || attributes.hasDataRangeIncludingZero) && !attributes.doesNotFit"\n\t style="font-size: 1em;"\n\t qva-direction x-dir-setting="{{direction}}" x-dir-text="{{languageString}}">\n\t<span class="ltr-star">*</span>\n\t<span ng-if="attributes.limitedData" q-translation="Object.Disclaimer.LimitedData" q-title-translation="Object.Disclaimer.LimitedData"></span>\n\t<span ng-if="attributes.onlyNullColor" q-translation="Object.Disclaimer.OnlyNanColor" q-title-translation="Object.Disclaimer.OnlyNanColor"></span>\n\t<span ng-if="attributes.hasNegativeOrZeroData" q-translation="Object.Disclaimer.NegativeOrZeroValues" q-title-translation="Object.Disclaimer.NegativeOrZeroValues"></span>\n\t<span ng-if="attributes.hasDataRangeIncludingZero" q-translation="Object.Disclaimer.DataRangeIncludingZero" q-title-translation="Object.Disclaimer.DataRangeIncludingZero"></span>\n\t<span class="rtl-star">*</span>\n</div>\n'}),define("objects.views/charts/disclaimers/chart-disclaimer-directive",["qvangular","text!./chart-disclaimer.ng.html","translator"],function(e,t,n){e.directive("qvaChartDisclaimer",function(){return{template:t,scope:{attributes:"=",visible:"=",direction:"="},link:function(e){e.languageString=n.get("Object.Disclaimer.LimitedData")}}})}),define("objects.views/charts/chart",["jquery","./events/event-launcher","./layout-engine","./components/data-area","./components/axis/axis","./components/axis/discrete-axis","./components/axis/continuous-axis","./components/legend/color-legend","./components/legend/basic-color-legend","./components/mini-chart","./representation/combo-color-map","./chart-context","general.utils/shapes/rect","objects.utils/layout","objects.views/charts/utils/binding","objects.views/charts/utils/chart-formatting","objects.extension/default-view","objects.utils/event-utils","core.utils/deferred","objects.views/selections/selections-cache","objects.views/selections/attribute-selections-cache","objects.views/selections/cache-collection","objects.views/charts/disclaimers/chart-disclaimer-directive"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,x,q){"use strict";function C(e){this._chartScale!==e&&(this._chartScale=e,this.$scope.dataAttributes.chartScale=e,Object.keys(this.components).forEach(function(e){this.components[e].chartScale=this._chartScale},this))}function S(){var e,t,n,i,r,o,s,a,l=this.container.parentElement,c="",u="";if(l.style.height="100%",l.style.width="",l.style.left="",l.style.top="",this._readStoredData&&!this.options.freeResize){e=this.container.clientWidth,t=this.container.clientHeight;var h=(n=(s=this._data.snapshotData.content.size).w)/(i=s.h);h<=e/t?(a=t/i,e=100*(r=t*h/e)+"%",t="100%",c=50*(1-r)+"%"):(a=e/n,t=100*(o=e/h/t)+"%",e="",u=50*(1-o)+"%"),C.call(this,a),l.style.width=e,l.style.height=t,l.style.left=c,l.style.top=u}else C.call(this,1)}function w(){this._sizeChanged=!1,S.call(this);var e,t,n=this.rect,i=this.container.clientWidth,r=this.container.clientHeight,o=new d(0,0,i,r);if(this.containerRect=new d(0,0,i,r),this._readStoredData&&!this.options.freeResize&&(t={width:this._data.snapshotData.content.size.w,height:this._data.snapshotData.content.size.h}),t&&(o=new d(0,0,t.width,t.height)),!n||n.width!==o.width||n.height!==o.height){for(e in this.components)this.components[e].setOuterRect(o.x+1,o.y+1,o.width-2,o.height-2);this.rect=o,this._updateLayoutMode(this.rect.width,this.rect.height),this._sizeChanged=!0}}function _(e,t){Object.keys(this.components).forEach(function(n){["colorLegend","xAxis","dimensionAxis","timeAxis","continuousAxis","dataArea"].contains(n)&&this.components[n].setGlobalOpacity(e,t||!1)},this)}function D(){var e;this.chartFormatter=new m(this.backendApi.localeInfo,this._data.qHyperCube.qMeasureInfo);for(e in this.components)this.components[e].chartFormatter=this.chartFormatter,this.components[e].measureFormatters=this.chartFormatter.getFormatters(),this.components[e].combinedMeasuresFormatter=this.chartFormatter.getCombinedMeasuresFormatter()}function M(){var e=this;this.backendApi.clearSelections(),this.components.dataArea.getSelectableShapes().forEach(function(t){t.selected=!1,e.onSelection.ToggleShape.call(e,t)}),this.selectionsCacheCollection.clear(),this.onSelection.scheduleInvalidation.call(this)}var A,E;return A={debug:!0,components:{}},E=g.extend(function(){var e,n={};for(e in t.prototype)t.prototype.hasOwnProperty(e)&&"init"!==e&&(n[e]=t.prototype[e]);return n}()),E.extend({refreshSelections:function(){this.specialCaseForSingleSelect=!1},initialize:function(){this._super(),this._initiateBindings()},init:function(i,r,o,s,a){t.prototype.init.call(this),o=e.extend(!0,o||{},{},A);var l=r.find(".qv-viz");this._super(i,l,o,s),this.container=l[0],this.backendApi=s,this.selectionsApi=a,this.layoutEngine=new n,this.components={},this.providers={},this._changeWatchers=[],this._createComponents(),this._createProviders(),this._chartScale=1,this.chartFormatter=new m(this.backendApi.localeInfo),this.selectionsCache=new b,this.attributeSelectionsCache=new x,this.selectionsCacheCollection=new q([this.selectionsCache,this.attributeSelectionsCache]),this.selectionsCache.setSelectionMode(b.SELECTION_MODE.VALUE),this._chartContext=new h,this._layoutMode=p.LayoutMode.FULL,this.$scope.dataAttributes={},this.resize(),this.specialCaseForSingleSelect=!1,this._navigation=o.navigation},clearSelections:M,selectionModeAlpha:.5,getVerticalComponents:function(){var e=[];return this._data&&this._data.legend&&this.components&&this.components.colorLegend&&this.components.colorLegend.isVertical()&&e.push({comp:this.components.colorLegend,dock:this._data.legend.dock}),e},setYMirrorMode:function(e){if(this.yMirrorMode!==e){this.yMirrorMode=e;for(var t in this.components)this.components[t].setYMirrorMode(e);this.tooltips&&(this.tooltips.yMirrorMode=e),this.updateVerticalComponentsDock()}},updateVerticalComponentsDock:function(){var e,t,n,i,r;for(this._verticalComponents=this.getVerticalComponents(),t=this._verticalComponents?this._verticalComponents.length:0,e=0;e<t;e++)i=(n=this._verticalComponents[e]).comp,"far"!==n.dock&&"near"!==n.dock&&"auto"!==n.dock||(r="far"===n.dock||"auto"===n.dock,i.setDock(this.yMirrorMode?r?"left":"right":r?"right":"left"))},setMinimumRequirements:function(e,t){this._requirements={dimensions:{min:e},measures:{min:t}}},onToggleLasso:function(e){this.toggleLasso=e},isLassoDisabled:function(){return!this.selections.allowLasso},onSelection:{ToggleShape:function(e){var t=this.$scope.layout.layers?this.$scope.layout.layers[0]:this.$scope.layout,n=t.qListObject?t.qListObject:t.qHyperCube;e.selected||1!==n.qSize.qcy?(this.toggleCacheItem?this.toggleCacheItem(e):this.onSelection.scheduleInvalidation.call(this),(e.id<-2||e.id>-1)&&(this.selections.getActiveType().activeComponent&&this.selectionsCache.trackByIndices(this.selections.getActiveType().activeComponent.getSelectionIndices()),this.selectionsCache.toggleByCacheItem(e)),this.specialCaseForSingleSelect=!1,this._haveToggledShapes=this.selectionsCache.hasSelections()):this.specialCaseForSingleSelect=!0},Activated:function(){_.apply(this,[this.selectionModeAlpha]),this._haveToggledShapes=!1},Deactivated:function(){_.apply(this,[1]),this.selectionsCacheCollection.clear(),this.toggleLasso=!1},Select:function(e,t,n,i){var r=this;if(!this.specialCaseForSingleSelect){var o=Array.isArray(n)?n:[n||0];if(this.selectionsCache.hasSelections()){var s=this.selectionsCache.getSelectedValuesInColumn(o[0]),a=-1;"K"===this._data.qHyperCube.qMode&&(a=s.indexOf(-3)),(1===o.length&&-1===a?this.backendApi.selectValues(o[0],s,!1):this.backendApi.select(this.selectionsCache.rows,o,i)).then(function(e){e||M.call(r)}).catch(function(e){e.isHandled=!0})}else e.length&&e.every(function(e){return!e.selected})&&this.selectionsApi.clear()}},SelectAttributeDim:function(e,t){var n,i,r=this;e.forEach(function(e){this.attributeSelectionsCache.toggleValue(e,!!t&&void 0)},this),n=this.attributeSelectionsCache.getSelectedValuesInColumn(0),(i=this.providers.colorMap&&this.providers.colorMap.getColorDataInfo())&&i.legendPath&&this.backendApi.selectValues(0,n,!1,i.legendPath).then(function(e){e||M.call(r)})},SelectRange:function(e,t){var n=this;e&&0!==e.length?"dimension"===e[0].type?this.backendApi.selectDimensionRange(e).then(function(e){e||M.call(n)}):this.backendApi.selectRange(e,t).then(function(e){e||M.call(n)}):this.selectionsApi.clear()},Confirm:function(){},Cancel:function(){this.selectionsCacheCollection.clear()},Clear:function(){this.selectionsCacheCollection.clear()},scheduleInvalidation:function(){var e=this;this._invalidationTimer||(this._invalidationTimer=setTimeout(function(){e.onSelection.invalidate.call(e),e._invalidationTimer=null},10))},cancelInvalidation:function(){clearTimeout(this._invalidationTimer),this._invalidationTimer=null},invalidate:function(){this.components.dataArea.invalidateDisplay("Chart.onSelection.invalidate"),this.components.colorLegend&&this.components.colorLegend.invalidateDisplay("Chart.onSelection.invalidate"),Object.keys(this.components).forEach(function(e){(this.components[e]instanceof o||this.components[e]instanceof s&&this.components[e].isDimension)&&this.components[e].invalidateDisplay("Chart.onSelection.invalidate")},this)}},getLayoutMode:function(){return this._layoutMode},getVerticalLayoutMode:function(){return this._verticalLayoutMode},getHorizontalLayoutMode:function(){return this._horizontalLayoutMode},setLayoutMode:function(e){this._explicitLayoutMode=e,this._layoutMode!==e&&(this._layoutMode=e,this.fire("layoutModeChanged"))},getSnapshotSize:function(){return this.rect?{w:this.rect.width,h:this.rect.height}:{w:0,h:0}},_updateLayoutMode:function(e,t){this._explicitLayoutMode||(this._layoutMode=p.getLayoutMode(e,t),this._horizontalLayoutMode=p.getHorizontalLayoutMode(e),this._verticalLayoutMode=p.getVerticalLayoutMode(t),this.fire("layoutModeChanged"),this.fire("verticalLayoutModeChanged"),this.fire("horizontalLayoutModeChanged"))},_createProviders:function(){var e=this.options;e.providers.colorMap&&(this.providers.colorMap="function"==typeof e.providers.colorMap.clazz?new e.providers.colorMap.clazz(e.providers.colorMap,this.backendApi.model.app):new u(e.providers.colorMap,this.backendApi.model.app),this.components.dataArea&&this.components.dataArea.setColorMap(this.providers.colorMap),this.components.colorLegend&&this.components.colorLegend.setColorMap(this.providers.colorMap))},_initiateBindings:function(){this._changeWatchers||(this._changeWatchers=[]),Object.keys(this.components).forEach(function(e){this._changeWatchers.push(f.bindProperty(this.components[e],"layoutMode",this,"layoutMode")),this._changeWatchers.push(f.bindProperty(this.components[e],"verticalLayoutMode",this,"verticalLayoutMode")),this._changeWatchers.push(f.bindProperty(this.components[e],"horizontalLayoutMode",this,"horizontalLayoutMode"))},this),this.components.dataArea&&this._changeWatchers.push(f.bindSetter(this._updateSelectionCache.bind(this),this.components.dataArea,"selectableShapes"))},_updateSelectionCache:function(e){var t=this.selections&&this.selections.cache||this.tooltips&&this.tooltips.cache;if(t){e=e||this.components.dataArea.getSelectableShapes();var n=this.selectionsCacheCollection,i=!(!this.selections||!this.selections.getActiveType)&&this.selections.getActiveType(),o=!!i;t.clear(),e.forEach(function(e){t.add(e)}),o&&(/^item/.test(i.getActiveMode())?e.forEach(function(e){e.selected=n.isCacheItemSelected(e)}):(i.activeComponent instanceof r&&"range.measure"===i.getActiveMode()||i.activeComponent instanceof a&&"range"===i.getActiveMode())&&i.updateShapesState()),Object.keys(this.components).forEach(function(t){["colorLegend","xAxis","dimensionAxis"].contains(t)&&this.components[t].setSelectableShapes(e)},this)}},_createComponents:function(){var e,t,n,r=this,o=this.components,s=this.options;Object.keys(s.components).map(function(e){return{sortKey:s.components[e].sortKey||0,cmpKey:e}}).sort(function(e,t){return e.sortKey-t.sortKey}).forEach(function(u){var h=u.cmpKey;if(e=["component",h].join("."),t=s.components[h],t.label=h,n=null,"function"==typeof s.components[h].clazz)n=s.components[h].clazz;else switch(h){case"dataArea":case"dataArea2":n=i;break;case"colorLegend":n=a;break;case"basicColorLegend":n=l}n&&(t.parentType=r.constructor.name.charAt(0).toLowerCase()+r.constructor.name.slice(1),t._disableSelections=s._disableSelections,o[h]=new n(this.container,t,e),o[h].selectionsApi=r.selectionsApi,o[h].backendApi=r.backendApi,o[h]instanceof c||this.layoutEngine.addComponent(o[h]))},this)},preLayout:function(){},layout:function(e,t){this.layoutEngine.layout(this.rect,this._layoutMode,this.containerRect,e,t)},resize:function(){return this._data&&this.isDataValid(this._data)?(this.prePaint(this._data),this._paint()):y.resolve()},setSnapshotData:function(e,t){var n=this.getSnapshotSize(),i={};Object.keys(this.components).forEach(function(e){i[e]={visible:this.components[e].isVisible(),dock:this.components[e].dock,size:{w:this.components[e].rect.width,h:this.components[e].rect.height}}},this),e.snapshotData.content={chartData:this.getSnapshotChartData(t),size:{w:n.w,h:n.h},components:i,v:.96}},getSnapshotChartData:function(){var e={};if(this.components.colorLegend){e.legendScrollOffset=this.components.colorLegend.getScrollPosition();var t=this.components.colorLegend.getExternalDataPage();t&&(e.legendDataPage=t)}return this.providers.colorMap&&this.providers.colorMap.getSnapshotChartData().forEach(function(t){e[t.key]=t.data}),e},getSnapshotStoredChartData:function(){if(this._data&&this._data.snapshotData&&this._data.snapshotData.content)return this._data.snapshotData.content.chartData},setInteractionState:function(e,t){this._super(e,t);var n=this;Object.keys(this.components).forEach(function(e){n.components[e].setUseTransition(n._navigation&&(n._inAnalysisState||n._inEditState))})},_postResize:function(){this._data.legend&&this.components.colorLegend&&this._updateLegendDock(this.components.colorLegend,this._data)},_paint:function(){if(!this.isValid(this._data))return this.clear().then(function(){return{invalid:!0}});var e=this.getSnapshotStoredChartData();return this.components.colorLegend&&(this.components.colorLegend.pagingMode=this._pagingMode||0,this._readStoredData&&e&&this.components.colorLegend.setScrollPosition(e.legendScrollOffset||0)),w.call(this),this.$scope.dataAttributes.doesNotFit=this.rect.height<10,this._sizeChanged&&this._postResize(),y.resolve()},paint:function(e){return e.qSelectionInfo&&e.qSelectionInfo.qInSelections||!this.isValid(this._data)?y.resolve():this._paint()},suppressOnPaint:function(e){var t=this._super(e);return t&&this.prePaint(e),t},prePaint:function(){return this.$scope.dataAttributes.layoutMode=this._layoutMode,this.$scope.dataAttributes.onlyNullColor=!1,this._super()},_preUpdateData:function(e){return this.providers.colorMap?(this._readStoredData?(this.providers.colorMap.setSnapshotChartData(e.snapshotData.content.chartData),this.components.miniChart&&this.components.miniChart.setSnapshotChartData(e.snapshotData.content.chartData)):(this.providers.colorMap.setSnapshotChartData(),this.components.miniChart&&this.components.miniChart.setSnapshotChartData()),this.providers.colorMap.setData(e).then(function(){return e})):y.resolve(e)},updateData:function(e){var t,n=this,i=n.isValid(e);for(t in n.components)n.components[t].setHasValidData(i);return i?(this._readStoredData=this.options._readStoredData||e&&e.snapshotData&&e.snapshotData.content,this._preUpdateData(e).then(function(e){function t(){if(n.providers.colorMap){var e=n.providers.colorMap.getColorDataInfo();return n.components.colorLegend&&e&&e.legendPath?n._readStoredData?(n.components.colorLegend.setExternalColorItems(n._data.snapshotData.content.chartData.legendDataPage),y.resolve()):y.all([n.backendApi.getData(e.legendPages,e.legendPath).then(function(e){n.components.colorLegend.setExternalColorItems(e)})]):(n.components.colorLegend.setExternalColorItems(null),y.resolve())}return y.resolve()}n._data=e;var i=n._updateData(e);return n.setYMirrorMode(n.options&&"rtl"===n.options.direction&&!(n._data&&n._data.reverseRtl)),i&&"function"==typeof i.then?i.then(t):i=t()})):(n.updateSelectableState(e),n._updateSelectionCache([]),n.clear())},_updateData:function(e){var t;this._data=e,this._readStoredData=this.options._readStoredData||e&&e.snapshotData&&e.snapshotData.content,this.selectionsCacheCollection.clear(),e.legend&&this.components.colorLegend&&(this.components.colorLegend[(e.legend.auto||e.legend.show?"show":"hide")+"Component"](),this.components.colorLegend.attributeSelectionsCache=this.attributeSelectionsCache,this._updateLegendDock(this.components.colorLegend,e)),D.call(this),this.providers.colorMap&&(this.providers.colorMap.setMeasureFormatters(this.chartFormatter.getFormatters()),this.providers.colorMap.setGenericFormatter(this.chartFormatter.createFormatter())),this.tooltips&&(this.tooltips.measureFormatters=this.chartFormatter.getFormatters(),this.tooltips.parentScope=this.$scope,this.tooltips.colorMap=this.providers.colorMap),this._chartContext.refresh(e);var n=this.isValid(this._data);for(t in this.components)this.components[t]._hasValidData=n;return this.updateSelectableState(),y.resolve()},_updateLegendDock:function(e,t){t.legend&&t.legend.dock&&"auto"!==t.legend.dock?e.setDock(t.legend.dock):e.setDock(e.outerRect.height/e.outerRect.width<1?this.yMirrorMode?"left":"right":"bottom")},destroy:function(){for(this.off();this._changeWatchers.length;)this._changeWatchers.pop().unbind();var e;for(e in this.components)this.components[e].release();for(e in this.providers)this.providers[e].release&&this.providers[e].release();this.$scope.dataAttributes={},this.selections&&(this.selections.cache.clear(),this.selections.release(),this.selections=null),this.tooltips&&(this.tooltips.release(),this.tooltips=null),this._chartContext.release(),this._super.apply(this,arguments)},clear:function(){var e=[];return Object.keys(this.components).forEach(function(t){e.push(this.components[t].clear())},this),y.all(e)},isValid:function(e){return this.isDataValid(e)},isDataValid:function(e){return!!e&&!!e.qHyperCube&&e.qHyperCube.qDimensionInfo.length&&!e.qHyperCube.qDimensionInfo.some(function(e){return!!e.qError})&&e.qHyperCube.qMeasureInfo.length&&!e.qHyperCube.qMeasureInfo.some(function(e){return!!e.qError})},isDataSelectable:function(e,t){return!(!this.isValid(this._data)||!this._inAnalysisState)&&(void 0!==t?!0!==e.qHyperCube.qDimensionInfo[t].qLocked:e.qHyperCube.qDimensionInfo.some(function(e){return!0!==e.qLocked}))},updateSelectableState:function(e){if(this.selections){var t=!this.isDataSelectable(e||this._data);Object.keys(this.components).forEach(function(e){this.components[e].setSelectionLocked(t)},this),this.selections&&this.selections.setLocked(t)}},on:function(){this._navigation&&Object.keys(this.components).forEach(function(e){this.components[e].on()},this),this._super(),this.updateSelectableState(this._data)},off:function(){this._navigation&&Object.keys(this.components).forEach(function(e){this.components[e].off()},this),this._super()},selectWhileLocked:function(e){v.showLockedFeedback(e||this._data.qHyperCube.qDimensionInfo)},getPreferredSize:function(){return this._super()}})}),define("objects.views/charts/components/ref-lines",["./chart-component","client.utils/theme/theme-module","objects.views/charts/chart-style-service","objects.views/charts/utils/canvas-renderer","core.utils/feature-flags"],function(e,t,n,i,r){"use strict";function o(e){return Number(void 0!==e.value?e.value:e)}function s(e,t){return e&&(e.paletteColor||e.color)?e.paletteColor?u.resolveColor(e.paletteColor):u.resolveColor(e.color,u.deprecatedPalette):t}function a(){if(!this._numRefLinesDataAxes||!this._numAxes)return!1;var e,t,n,i,r,s,a;for(e=0;e<this._numAxes;e+=1)for(s=(n=this._axes[e]).getPlotMin(),a=n.getPlotMax(),this._axisPlotMinValues[e]=s,this._axisPlotMaxValues[e]=a,i=this._data[e]||[],t=0;t<i.length;t+=1)if(r=o(i[t].refLineExpr),i[t]&&i[t].show&&void 0!==i[t].refLineExpr&&null!==r&&!isNaN(r)&&r>=s&&r<=a)return!0;return!1}function l(){var e,t,n,i;for(e=0;e<this._numAxes;e+=1)if(t=this._axes[e],n=t.getPlotMin(),i=t.getPlotMax(),this._axisPlotMinValues[e]!==n||this._axisPlotMaxValues[e]!==i)return!0;return!1}function c(){var e,t;for(e=0;e<this._numAxes;e+=1)t=this._axes[e],this._axisPlotMinValues[e]=t.getPlotMin(),this._axisPlotMaxValues[e]=t.getPlotMax()}var u=t.get();return e.extend("RefLines",{init:function(){this._super.apply(this,arguments),this.renderer=new i(this.container),this.renderer.edgeBleed={top:1,left:1,right:0,bottom:0},this._$renderAreaWrap.addClass("qv-chart-component-reflines"),this._hasVisibleRefLines=!1,this._styleService=r.THEMING?u.initializeService("object."+this.options.parentType):n.getInstance(),this._numAxes=0,this.renderers={lines:this.renderer}},setData:function(){this._super.apply(this,arguments),this._numRefLinesDataAxes=void 0===this._data?0:this._data.length,this._hasVisibleRefLines=a.call(this),c.call(this)},setAxes:function(e){var t=this;this._axes&&this._axes.forEach(function(e){e.stopListen("changed",t.invalidateDisplay,t)}),this._axes=e,this._axes.forEach(function(e){e.listen("changed",t.invalidateDisplay,t)}),this._numAxes=void 0===e?0:e.length,void 0!==this._axisPlotMinValues&&this._axisPlotMinValues.length===this._numAxes||(this._axisPlotMinValues=new Array(this._numAxes)),void 0!==this._axisPlotMaxValues&&this._axisPlotMaxValues.length===this._numAxes||(this._axisPlotMaxValues=new Array(this._numAxes))},isVisible:function(){return!!(this._super.apply(this,arguments)&&this._numAxes&&this._numRefLinesDataAxes)},hasValidData:function(){return this._super()&&this._numRefLinesDataAxes&&this._numAxes},paint:function(){var e=this._styleService.getStyle("referenceLine.label.name","color");if(this._super.apply(this,[].slice.call(arguments)),l.call(this)&&(this._hasVisibleRefLines=a.call(this),c.call(this)),!this._hasVisibleRefLines)return this.renderer.shapes=[],void this.renderer.clear();var t,n,i,r,o,u,h,d,p,f,m,g,v,y=[];for(t=0;t<this._numRefLinesDataAxes;t+=1)for(i=this._data[t],r=this._axes[t],o=this._axisPlotMinValues[t],u=this._axisPlotMaxValues[t],n=0;n<i.length;n+=1)i[n].show&&void 0!==i[n].refLineExpr&&(null===(h=this._currentProperties["value"+t+n])||isNaN(h)||h>u||h<o||(d=r.getPositionOfValue(h),d=Math.floor(d)-.5,r.isVertical()?(p=0,f=d,m=this.rect.width,g=d):(p=d,f=0,m=d,g=this.rect.height),v=s(i[n],e),y.push({type:"line",stroke:v,strokeWidth:1,shape:{x1:p,y1:f,x2:m,y2:g}})));this.renderer.shapes=y,this.renderer.render()},_updateProperties:function(){if(this._data){var e,t,n=this._data,i=n.length;for(e=0;e<i;e++)if(void 0!==n[e])for(t=0;t<n[e].length;t++)this._transitionProperties["value"+e+t]=n[e][t].refLineExpr.value;this._super()}}})}),define("objects.views/charts/components/data-title/data-title-handler",["objects.views/charts/renderers/canvas-renderer","core.utils/deferred"],function(e,t){function n(e,t){return e&&e.qHyperCubeDef&&e.qHyperCubeDef[t].length>0}function i(t,n){var i=0;return t.forEach(function(t){"string"==typeof t&&(i+=e.getTextWidth(t,n))}),i||null}var r={hasAlternatives:n,getTitlesApproxWidth:i};return{getTitleDataFromHyperCube:function(e,t,n){var i,r,o,s=[],a="dimension"===t?e.qDimensionInfo:e.qMeasureInfo,l=!1;if(t){for(o=0;o<a.length;o++)r=(l=(i=a[o]).qGroupFallbackTitles&&i.qGroupFallbackTitles.length>1)?i.qGroupFallbackTitles.slice(0,i.qGroupPos+1):[i.qFallbackTitle],s.push({labels:r,label:r[r.length-1],locked:i.qLocked&&n,isDrill:l&&n,currentDrillDownLevels:i.qGroupPos,wrapperStyle:{},index:o});return s}},modelHasAlternatives:function(e,n){if(!e||!e.getProperties)return t.resolve();var i="dimension"===n?"qDimensions":"qMeasures";return e.getProperties().then(function(t){return t.qExtendsId?e.app.getObject(t.qExtendsId).then(function(e){return e.getProperties()}):t}).then(function(e){return r.hasAlternatives(e.qHyperCubeDef&&e.qHyperCubeDef.qLayoutExclude,i)})},setWrapperStyle:function(e,t,n,i){if(t.width()){"top-to-bottom"===n||"bottom-to-top"===n?(e.width=t.height(),e.height=t.width(),"top-to-bottom"===n?(e.marginTop=-e.width+e.height,e.marginLeft=e.height):(e.marginTop=e.width+e.height,e.marginLeft=0)):(e.width=t.width(),e.height=t.height(),e.marginLeft=0,e.marginTop=0);var o=i?i.map(function(e){return e.label}):[];r.getTitlesApproxWidth(o,e.font)>e.width?(e.justifyContent="flex-start",e.minWidth=70):(e.justifyContent="center",e.minWidth="auto")}},getTitlesApproxWidth:i,hasAlternatives:n}}),define("text!objects.views/charts/components/data-title/data-title.ng.html",[],function(){return'<div ng-show="visible"\n     class="qva-chart-data-title">\n     <div class="qva-chart-data-title-rotate" ng-style="fontStyle" ng-class="direction" qva-direction x-dir-setting="{{options.direction}}">\n          <div class="qva-chart-data-title-align ellips-text">\n               <div class="qva-chart-data-title-wrapper ellips-text" ng-repeat-start="titleData in titles" ng-style="titleData.wrapperStyle" >\n                    <qva-breadcrumb-bar ng-if="titleData.isDrill" data="titleData" model="model" disabled="disabled || object.selectionsApi.active" type="type" dock="dock" column-index="$index" options="options"></qva-breadcrumb-bar>\n                    <qva-default-data-title ng-if="!titleData.isDrill" data="titleData" model="model" disabled="disabled || object.selectionsApi.active" type="type" dock="dock" options="options"></qva-default-data-title>\n               </div>\n               <span ng-repeat-end ng-if="!$last">, &nbsp;</span>\n          </div>\n\n     </div>\n</div>\n'}),define("text!objects.views/charts/components/data-title/default-data-title.ng.html",[],function(){return'<div class="default-data-title-wrapper ellips-text">\n     <qva-simple-data-title ng-if="!data.hasAlternatives" label="data.label" locked="data.locked" options="options"></qva-simple-data-title>\n     <qva-dropdown-data-title ng-if="data.hasAlternatives" data="data" model="model" disabled="disabled" type="type" dock="dock" options="options"></qva-dropdown-data-title>\n</div>'}),define("text!objects.views/charts/components/data-title/simple-data-title.ng.html",[],function(){return'<div class="chart-data-title ellips-text" qva-direction x-dir-text="{{label}}" x-dir-setting="{{options.direction}}" >\n     <i ng-if="locked" class="icon-toolbar-locked" title="{{lockedTooltip}}"></i>\n     <span class="chart-data-title-label" title="{{label}}" qva-direction x-dir-text="{{label}}" x-dir-setting="{{options.direction}}">{{label}}</span>\n</div>'}),define("text!objects.views/charts/components/data-title/dropdown-data-title/dropdown-data-title.ng.html",[],function(){return'<div class="qva-dropdown-data-title">\n     <div class="dropdown-data-title-wrapper" ng-class="{\'interactive\' : !disabled, \'active\': isMenuOpen}" qva-activate="openAlternativePopover()" qva-outside-ignore-for="{{\'dataTitle-\' + $id}}">\n          <qva-simple-data-title locked="data.locked" label="data.label" options="options"></qva-simple-data-title>\n          <span class="dropdown-arrow"></span>\n     </div>\n</div>'}),define("text!objects.views/charts/components/data-title/dropdown-data-title/dropdown-data-title-popover.ng.html",[],function(){return'<lui-popover class="qva-alternative-data-picker"\n\t\t\t\t\t  align-to="alignTo"\n\t\t\t\t\t  position="position"\n\t\t\t\t\t  collision="\'flip fit\'"\n\t\t\t\t\t  height="\'auto\'"\n\t\t\t\t\t  on-close-view="closePopover();"\n\t\t\t\t\t  qva-outside-ignore-for="{{qvaOutsideIgnoreFor}}">\n\t<div class="em-section-content em-alternative-data qva-alternative-data-picker-list" qva-direction x-dir-setting="{{options.direction}}">\n\t\t<div hypercube-data-item ng-repeat="alternative in item.alternatives" item="item"></div>\n\t</div>\n</lui-popover>\n'}),define("text!client.soft-property-panel/components/hypercube-data/hypercube-data-item.ng.html",[],function(){return'<li class="em-item lui-list__item" qva-activate="alternativeItemClicked($event,item,alternative);">\n\t<i ng-if="alternative.hasIcon" class="em-item-icon lui-icon icon-tick lui-list__aside" ng-class="{\'em-invisible\': !alternative.selected}"></i>\n\t<span class="lui-list__text lui-list__text--ellipsis" qva-direction x-dir-text="{{alternative.title()}}"  title="{{alternative.title()}}">{{alternative.title()}}&nbsp;</span>\n</li>'}),define("objects.picasso/title/alternative-title-retriever",["core.utils/deferred","translator","objects.utils/data-properties/library-utils"],function(e,t,n){"use strict";function i(){this.titles={}}function r(e,t,n,i){var r=o(e,this.titles);return r?r.promise:(r=s(e,this.titles),r.promise=a(e,t,n,i),r.promise)}function o(e,t){return t[l(e)]}function s(e,t){var n=l(e),i={id:n,promise:null};return t[n]=i,i}function a(i,r,o,s){var a="H"===i.qDef.qGrouping,l=!!i.qLibraryId;if(a)return e.when(i.qData.title);if(l)return(s?r.getDimensionList:r.getMeasureList).call(r).then(function(e){var r=(s?n.findLibraryDimension:n.findLibraryMeasure)(i.qLibraryId,e),a=r&&r.qData.labelExpression;return r?!o&&a?a:r.qData.title:t.get(s?"Object.ErrorMessage.MissingDimension":"Object.ErrorMessage.MissingMeasure")});var c=i.qDef.qLabelExpression;if(!!c)return o?e.when(c):r.evaluate(c);var u;if(s){var h=i.qDef.qFieldLabels[0];u=h||i.qDef.qFieldDefs[0]}else u=i.qDef.qLabel||i.qDef.qDef;return e.when(u)}function l(e){return e.qDef.cId}function c(e){if(!e)throw new Error("AlternativeTitleRetriever: Called without a context")}return i.prototype.getDimensionTitle=function(e,t,n){return c(this),r.call(this,e,t,n,!0)},i.prototype.getMeasureTitle=function(e,t,n){return c(this),r.call(this,e,t,n,!1)},i.prototype.resetTitles=function(){this.titles={}},i}),define("objects.picasso/title/alternative-title-retriever-factory",["objects.picasso/title/alternative-title-retriever"],function(e){"use strict";return{create:function(){return new e}}}),define("objects.picasso/title/caching-alternative-title-retriever",["objects.picasso/title/alternative-title-retriever-factory"],function(e){"use strict";function t(){this.alternativeTitleRetriever=e.create(),this.cache={}}function n(e,t){return e[t]||""}function i(e,t,n){e[t]=n}return t.prototype.getDimensionTitle=function(e,t,n){var r=this;return this.alternativeTitleRetriever.getDimensionTitle(e,t,n).then(function(t){return i(r.cache,e.qDef.cId,t),t})},t.prototype.getCachedDimensionTitle=function(e){return n(this.cache,e.qDef.cId)},t.prototype.getMeasureTitle=function(e,t,n){var r=this;return this.alternativeTitleRetriever.getMeasureTitle(e,t,n).then(function(t){return i(r.cache,e.qDef.cId,t),t})},t.prototype.getCachedMeasureTitle=function(e){return n(this.cache,e.qDef.cId)},t.prototype.resetTitles=function(){this.alternativeTitleRetriever.resetTitles()},t}),define("objects.picasso/title/caching-alternative-title-retriever-factory",["objects.picasso/title/caching-alternative-title-retriever"],function(e){"use strict";return{create:function(){return new e}}}),define("client.soft-property-panel/components/hypercube-data/hypercube-data-handler",["qvangular","core.utils/class","client.utils/property-resolver","client.utils/property-hypercube-helper","objects.utils/data-properties/library-utils","general.utils/attribute-expression-util","client.utils/color-support","translator","text!./hypercube-data-item.ng.html","core.utils/feature-flags","objects.picasso/title/caching-alternative-title-retriever-factory"],function(e,t,n,i,r,o,s,a,l,c,u){return e.directive("hypercubeDataItem",function(){return{restrict:"A",template:l,replace:!0}}),t.extend({init:function(e,t,n){this._props=e,this._app=t,this._hyperCubePath=n,this.libraryTitles={},this.cachingAlternativeTitleRetriever=u.create()},setProperties:function(e){this._props=e,this.cachingAlternativeTitleRetriever.resetTitles()},updateAlternativeItem:function(e,t,i,r,a){var l=n.getValue(this._props,r,[]),c=n.getValue(this._props,i,[]),u=l[t.index];if(!t.selected){t.original&&(u=n.getValue(this._props,i,[])[t.index]),u.qAttributeExpressions=o.moveById(e.data.qAttributeExpressions,u.qAttributeExpressions,o.IDMAP.COLOR_BY_EXPRESSION);var h,d,p,f;if(a)for(h=0;h<a.length;h++)f=a[h],d=n.getValue(c[e.index],f.path,[]),p=n.getValue(l[t.index],f.path,[]),d&&d.hasOwnProperty(f.property)&&p&&p.hasOwnProperty(f.property)&&(p[f.property]=d[f.property]);l.splice(t.index,1,c[e.index]),c.splice(e.index,1,u),s.colorByUpdater(this._props,"qHyperCubeDef.")}},getDimensionOptions:function(e,t,n,r,o){var s=this;return e.concat(t).filter(function(e){return e.qDef.cId===n.qDef.cId||!i.getDimensionLayout(e.qDef.cId,r,s._hyperCubePath)}).map(function(i){var r="";return c.LABEL_EXPR&&(r=s.cachingAlternativeTitleRetriever.getCachedDimensionTitle(i),s.cachingAlternativeTitleRetriever.getDimensionTitle(i,s._app).then(function(e){r=e})),{id:i.qDef.cId,index:-1!==e.indexOf(i)?e.indexOf(i):t.indexOf(i),original:-1!==e.indexOf(i),ref:"dimensions",selected:i.qDef.cId===n.qDef.cId,hasIcon:o,title:function(){return c.LABEL_EXPR?r:s.getTitle(i,!0)}}})},getMeasureOptions:function(e,t,n,r,o){var s=this;return e.concat(t).filter(function(e){return e.qDef.cId===n.qDef.cId||!i.getMeasureLayout(e.qDef.cId,r,s._hyperCubePath)}).map(function(i){var r="";return c.LABEL_EXPR&&(r=s.cachingAlternativeTitleRetriever.getCachedMeasureTitle(i),s.cachingAlternativeTitleRetriever.getMeasureTitle(i,s._app).then(function(e){r=e})),{id:i.qDef.cId,index:-1!==e.indexOf(i)?e.indexOf(i):t.indexOf(i),original:-1!==e.indexOf(i),ref:"measures",selected:i.qDef.cId===n.qDef.cId,hasIcon:o,title:function(){return c.LABEL_EXPR?r:s.getTitle(i,!1)}}})},getTitle:function(e,t){var n=e.qLibraryId,i=this,o=a.get(t?"Object.ErrorMessage.MissingDimension":"Object.ErrorMessage.MissingMeasure");return n?void 0!==this.libraryTitles[n]?null===this.libraryTitles[n]?o:"string"!=typeof this.libraryTitles[n]?"":this.libraryTitles[n]:(this.libraryTitles[n]=(t?i._app.getDimensionList().then(function(e){return r.findLibraryDimension(n,e)}):i._app.getMeasureList().then(function(e){return r.findLibraryMeasure(n,e)})).then(function(e){return e?(i.libraryTitles[n]=e.qData.title,i.libraryTitles[n]):(i.libraryTitles[n]=null,o)}),this.libraryTitles[n]):t?e.qDef.qFieldLabels[0]||e.qDef.qFieldDefs[0]:e.qDef.qLabel||e.qDef.qDef}})}),define("general.utils/expression-validator",["core.utils/notification","core.utils/class","core.models/app"],function(e,t,n){var i={Expression:0,NumberOrExpression:1};return{ExpressionValidator:t.extend("ExpressionValidator",{init:function(t,r){this.currentExpr=null,this.nextExpr=null,this.hasOutstandingCall=!1,this.app=t||n.current&&n.current.enigmaModel,this.mode=r||i.Expression,e.create(this,"Update")},onResponse:function(e){var t,n,i,r,o;if(this.hasOutstandingCall=!1,this.nextExpr)t=this.nextExpr,n=this.nextLabels,this.nextExpr=null,this.nextLabels=null,this.callEngine(t,n);else{for(t=this.currentExpr,i=!e.qErrorMsg&&0===e.qBadFieldNames.length,r=0;r<e.qBadFieldNames.length;r++)(o=e.qBadFieldNames[r]).name=t.substr(o.qFrom||0,o.qCount);this.Update.emit({valid:i,data:{error:e.qErrorMsg,bad:e.qBadFieldNames}})}},callEngine:function(e,t){var n=this;if(this.hasOutstandingCall)throw new Error("Invalid state");this.currentExpr=e,this.hasOutstandingCall=!0;(this.mode===i.NumberOrExpression?this.app.checkNumberOrExpression(e):this.app.checkExpression(e,t||[])).then(function(e){n.onResponse(e)},function(){n.onResponse({qErrorMsg:"Error",qBadFieldNames:[]})})},validate:function(e,t){this.hasOutstandingCall?(this.nextExpr=e,this.nextLabels=t):this.callEngine(e,t)}}),Modes:i}}),define("text!assets/client/dialogs/expression-dialog/expression-dialog.ng.html",[],function(){return'<lui-dialog id="expression-editor-wrapper" qva-outside-ignore-for="allOutside">\n\t<lui-dialog-header>\n\t\t<h1 q-translation="{{input.title}}"></h1>\n\t</lui-dialog-header>\n\t<lui-dialog-body class="expression-editor-body" qv-cancel="cancel()" qv-confirm="confirm()">\n\t\t<section id="expression-editor-panel" class="qribby-accordion-pp">\n\t\t\t<ul class="lui-list">\n\t\t\t\t<li class="lui-list__header">\n\t\t\t\t\t<h1 class="lui-list__text" q-translation="Common.Fields"></h1>\n\t\t\t\t</li>\n\t\t\t\t<div class="qribby-accordion-section-content">\n\n\t\t\t\t\t<div id="expression-editor-toolbar-table">\n\t\t\t\t\t\t<label q-translation="Assets.FieldsTab.Table"></label>\n\t\t\t\t\t\t<lui-select\n\t\t\t\t\t\t\t\tid="expression-dialog-fields-tab-select-field"\n\t\t\t\t\t\t\t\tx-model="controller.selectedTable"\n\t\t\t\t\t\t\t\tx-options="table for table in controller.tableNames">\n\t\t\t\t\t\t</lui-select>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div id="expression-editor-toolbar-field">\n\t\t\t\t\t\t<label q-translation="Common.Field"></label>\n\t\t\t\t\t\t<lui-select\n\t\t\t\t\t\t\t\tid="expression-dialog-functions-common-select-field"\n\t\t\t\t\t\t\t\tx-model="controller.selectedField"\n\t\t\t\t\t\t\t\tx-options="field for field in controller.fieldNames">\n\t\t\t\t\t\t</lui-select>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div id="expression-editor-toolbar-functions">\n\t\t\t\t\t\t<lui-select id="expression-dialog-fields-tab-select-aggregation" x-model="controller.selectedCommonFunction">\n\t\t\t\t\t\t\t<option q-translation="ExpressionEditor.FieldsTab.SelectAggregationHint" value=""></option>\n\t\t\t\t\t\t\t<option ng-repeat="func in controller.commonFunctions" value="{{func}}">{{func}}</option>\n\t\t\t\t\t\t</lui-select>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div id="expression-editor-toolbar-insert">\n\t\t\t\t\t\t<lui-button\n\t\t\t\t\t\t\t\tng-disabled="!controller.previewText()"\n\t\t\t\t\t\t\t\ttype="button"\n\t\t\t\t\t\t\t\tng-click="insertTextHandler($event)"\n\t\t\t\t\t\t\t\tq-title-translation="Tooltip.ExpressionEditor.InsertExpression">\n\t\t\t\t\t\t\t<span q-translation="ExpressionEditor.Insert"></span>\n\t\t\t\t\t\t</lui-button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</ul>\n\t\t</section>\n\t\t<section id="expression-editor-content">\n\t\t\t<main class="dm-main">\n\t\t\t\t<div id="expression-editor-container">\n\t\t\t\t\t<div qv-extract="resizeCounter" id="expression-editor-stage" data-help="Panel.Stage" ng-class="{ invalid: !validity.expression }">\n\t\t\t\t\t\t<qv-codearea\n\t\t\t\t\t\t\t\tdata-show-breakpoint-gutter="true"\n\t\t\t\t\t\t\t\tdata-disabled="false"\n\t\t\t\t\t\t\t\tdata-resize-trigger="resizeCounter"\n\t\t\t\t\t\t\t\tdata-mode="qlikviewReloadScriptMode"\n\t\t\t\t\t\t\t\tclass="expression-dialog-code-mirror"\n\t\t\t\t\t\t\t\tqva-outside-ignore-for="allOutside"\n\t\t\t\t\t\t\t\tqv-codearea-code-container="codearea"\n\t\t\t\t\t\t\t\tqv-codearea-exposed-context-api="codearea.contextApi"\n\t\t\t\t\t\t\t\tqv-codearea-function-tip="functionTipOptions"\n\t\t\t\t\t\t\t\tqv-codearea-limit="stringLimits.expression"\n\t\t\t\t\t\t\t\tqv-codearea-autocomplete="autocompleteOptions"\n\t\t\t\t\t\t\t\tqv-codearea-help-mode="false"\n\t\t\t\t\t\t\t\tqv-codearea-help-mode-options="helpModeOptions"\n\t\t\t\t\t\t></qv-codearea>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div id="expression-editor-status" ng-class="info.status" >\n\t\t\t\t\t<i ng-class="{ disabled: !info.extraErrorMsg }"\n\t\t\t\t\t   class="lui-icon lui-icon--info"\n\t\t\t\t\t   ng-click="showErrorMessage( info.extraErrorMsg, $event )"></i>\n\t\t\t\t\t<span translate="info.errorMsg" ng-show="info.errorMsg"></span>\n\t\t\t\t</div>\n\t\t\t</main>\n\t\t</section>\n\t</lui-dialog-body>\n\t<lui-dialog-footer>\n\t\t<button class="lui-button close button" ng-click="cancel()" name="cancelButton" q-translation="Common.Cancel">Cancel</button>\n\t\t<button class="lui-button confirm button" ng-click="confirm()"  qv-confirm="confirm()" name="confirmButton" q-translation="Common.Apply">Confirm</button>\n\t</lui-dialog-footer>\n</lui-dialog>'}),define("assets/client/dialogs/expression-dialog/expression-dialog-controller",["util"],function(e){"use strict";function t(){return["Sum","Count","Avg","Min","Max"]}function n(){var t;return t=this.selectedField||"",t=e.escapeField(t),this.selectedCommonFunction?this.selectedCommonFunction+"("+t+")":t}function i(e){return e.map(function(e){return e.qName})}function r(e,t){return e.filter(function(e){return-1!==e.qSrcTables.indexOf(t)})}function o(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}function s(e){var t,n,i=[];for(t=0;t<e.length;++t)for(n=0;n<e[t].qSrcTables.length;++n)-1===i.indexOf(e[t].qSrcTables[n])&&i.push(e[t].qSrcTables[n]);return i.sort(o),i}function a(e,t,n){n!==e.allTablesText&&(t=r(t,n)),e.fieldNames=i(t),l(e)}function l(e){-1===e.fieldNames.indexOf(e.selectedField)&&(e.selectedField=e.fieldNames[0])}return{create:function(e){var r=e.translator,o=e.fields.slice();o.sort(function(e,t){return e.qName.toLowerCase().localeCompare(t.qName.toLowerCase())});var c=r.get("Common.All.Tables"),u={allTablesText:c,commonFunctions:t(),selectedCommonFunction:"",setTableFilter:function(e){a(u,o,e)},selectedTable:c,tableNames:[c].concat(s(o)),fieldNames:i(o),selectedField:"",previewText:n};return l(u),u}}}),define("assets/client/dialogs/expression-dialog/expression-validation-info",[],function(){"use strict";function e(e,t){if(e.status=t.valid?i:r,e.errorMsg=t.valid?"Common.OK":"Expression.Validation.InvalidExpression",e.extraErrorMsg="",t.data)if(t.data.bad.length>0){var n=t.data.bad.map(function(e){return e.name});e.errorMsg={id:"Expression.Validation.BadFieldName",value:[n.join(", ")]}}else t.data.error&&(e.extraErrorMsg=t.data.error)}function t(e,t,i,o){""!==i.replace(/\s+/g,"")?(e.status=n,t.validate(i,o)):(e.status=r,e.errorMsg="",e.extraErrorMsg="")}var n="validating",i="valid",r="invalid";return{create:function(i){var r=i.validator,o={errorMsg:"",extraErrorMsg:"",status:n,setExpr:function(e){t(o,r,e,i.labels)}};return r.Update.bind(function(t){e(o,t)}),o}}}),define("client.services/validation",[],function(){function e(e){return e.replace(/^=+/,"")}function t(e,t){return e.validity.name=!!e.name&&!!e.name.trim()&&e.name.length<=t.name,e.validity.name}return{validateMetadata:function(e,n){return t(e,n),e.description?e.validity.description=e.description.length<=n.description:e.validity.description=!0,e.validity.name&&e.validity.description},validateMetadataName:t,validateExpr:function(t,n){var i=t.expression,r="string"==typeof i&&i.trim().length>0&&i.length<=n.expression;return i&&(t.expression=e(i)),t.validity.expression=r,r},validateFieldsInDimension:function(e){var t=e.selectedFields,n=!1;return!!t&&("single"===e.type?n=1===t.length:"drilldown"===e.type&&(n=t.length>1),e.validity.selectedFields=n,n)}}}),define("text!general.components/function-tip-view/function-tip-view.html",[],function(){return'<qui-float qui-offset="offset" qui-resize-on-change="content" class="qv-function-tip-container">\n\t<div class=\'qv-function-tip-view\' ng-show=\'content\'>{{content}}</div>\n</qui-float>\n'}),define("general.components/function-tip-view/function-tip-view",["text!./function-tip-view.html"],function(e){"use strict";return{scope:{offset:"=",content:"="},template:e,controller:[function(){}]}}),define("assets/client/dialogs/expression-dialog/expression-bnf",["core.utils/deferred","client.assets/tab-contents/fields/assets-field-list-model","general.models/bnf-model","util"],function(e,t,n,i){function r(e,t){return"field"===e?{text:t,type:e,value:i.escapeField(t)}:{text:t,type:e}}function o(e){function t(e){return n.isFunction(e)}var n=e.bnf,i=s(),o=e.fields,a=e.variables,l=c.map(r.bind(null,"keyword")),u=Object.keys(a).map(r.bind(null,"variable")),h=Object.keys(o).map(r.bind(null,"field")),d=n.getAllFunctions().map(r.bind(null,"function")),p=l.concat(u,h,d);return{getAutocompleteList:function(){return p},getFunctionTip:function(e){return n.getFunctionTip(e)},isFunction:t,isField:function(e){return!!o[e]},isKeyword:function(e){return!!i[e.toLowerCase()]||t(e)},isVariable:function(e){return!!a[e]}}}function s(){for(var e={},t=0;t<c.length;++t)e[c[t]]=!0;return e}function a(e){return e.enigmaModel.getFieldList().then(function(e){e=t.expand(e);for(var n={},i=0;i<e.length;++i)n[e[i].qName]=!0;return n})}function l(e){return e.enigmaModel.getVariableList().then(function(e){for(var t={},n=0;n<e.length;++n)t[e[n].qName]=!0;return t})}var c=["like","not","and","or","xor","follows","precedes","bitnot","bitand","bitor","bitxor","$","$1","$2","$3","$4","$5","$_1","$_2","$_3","$_4","$_5","total","distinct","nodistinct","all","include","must_include"];return{get:function(t){return e.all({bnf:n.getExpressionBnfModel(),fields:a(t),variables:l(t)}).then(o)}}}),define("general.components/extract",["jquery","qvangular","core.utils/resize","general.services/aligner/aligner","general.utils/android-keyboard-fix"],function(e,t,n,i,r){t.directive("qvExtract",["$timeout","$parse",function(t,o){return{restrict:"A",transclude:!0,link:function(s,a,l,c,u){function h(){d.update(),++f,p.assign&&p.assign(s,f)}var d=new i({container:e("<div style='position:absolute'>"),body:document.body,alignAgainst:a}),p=o(l.qvExtract),f=0;d.showTranscluded(u),d.update(),t(function(){h()}),(r.isNeeded()?new r:null)&&window.addEventListener("resize",h,!1),s.$on("$destroy",function(){d.hide(),n.off("end",h)})}}}])}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("cm",t):e.CodeMirror=t()}(this,function(){"use strict";function e(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}function t(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function n(e,n){return t(e).appendChild(n)}function i(e,t,n,i){var r=document.createElement(e);if(n&&(r.className=n),i&&(r.style.cssText=i),"string"==typeof t)r.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)r.appendChild(t[o]);return r}function r(e,t,n,r){var o=i(e,t,n,r);return o.setAttribute("role","presentation"),o}function o(e,t){if(3==t.nodeType&&(t=t.parentNode),e.contains)return e.contains(t);do{if(11==t.nodeType&&(t=t.host),t==e)return!0}while(t=t.parentNode)}function s(){var e;try{e=document.activeElement}catch(t){e=document.body||null}for(;e&&e.shadowRoot&&e.shadowRoot.activeElement;)e=e.shadowRoot.activeElement;return e}function a(t,n){var i=t.className;e(n).test(i)||(t.className+=(i?" ":"")+n)}function l(t,n){for(var i=t.split(" "),r=0;r<i.length;r++)i[r]&&!e(i[r]).test(n)&&(n+=" "+i[r]);return n}function c(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function u(e,t,n){t||(t={});for(var i in e)!e.hasOwnProperty(i)||!1===n&&t.hasOwnProperty(i)||(t[i]=e[i]);return t}function h(e,t,n,i,r){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var o=i||0,s=r||0;;){var a=e.indexOf("\t",o);if(a<0||a>=t)return s+(t-o);s+=a-o,s+=n-s%n,o=a+1}}function d(e,t){for(var n=0;n<e.length;++n)if(e[n]==t)return n;return-1}function p(e,t,n){for(var i=0,r=0;;){var o=e.indexOf("\t",i);-1==o&&(o=e.length);var s=o-i;if(o==e.length||r+s>=t)return i+Math.min(s,t-r);if(r+=o-i,r+=n-r%n,i=o+1,r>=t)return i}}function f(e){for(;Fs.length<=e;)Fs.push(m(Fs)+" ");return Fs[e]}function m(e){return e[e.length-1]}function g(e,t){for(var n=[],i=0;i<e.length;i++)n[i]=t(e[i],i);return n}function v(e,t,n){for(var i=0,r=n(t);i<e.length&&n(e[i])<=r;)i++;e.splice(i,0,t)}function y(){}function b(e,t){var n;return Object.create?n=Object.create(e):(y.prototype=e,n=new y),t&&u(t,n),n}function x(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||js.test(e))}function q(e,t){return t?!!(t.source.indexOf("\\w")>-1&&x(e))||t.test(e):x(e)}function C(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}function S(e){return e.charCodeAt(0)>=768&&Vs.test(e)}function w(e,t,n){for(;(n<0?t>0:t<e.length)&&S(e.charAt(t));)t+=n;return t}function _(e,t,n){for(;;){if(Math.abs(t-n)<=1)return e(t)?t:n;var i=Math.floor((t+n)/2);e(i)?n=i:t=i}}function D(e,t,n){var o=this;this.input=n,o.scrollbarFiller=i("div",null,"CodeMirror-scrollbar-filler"),o.scrollbarFiller.setAttribute("cm-not-content","true"),o.gutterFiller=i("div",null,"CodeMirror-gutter-filler"),o.gutterFiller.setAttribute("cm-not-content","true"),o.lineDiv=r("div",null,"CodeMirror-code"),o.selectionDiv=i("div",null,null,"position: relative; z-index: 1"),o.cursorDiv=i("div",null,"CodeMirror-cursors"),o.measure=i("div",null,"CodeMirror-measure"),o.lineMeasure=i("div",null,"CodeMirror-measure"),o.lineSpace=r("div",[o.measure,o.lineMeasure,o.selectionDiv,o.cursorDiv,o.lineDiv],null,"position: relative; outline: none");var s=r("div",[o.lineSpace],"CodeMirror-lines");o.mover=i("div",[s],null,"position: relative"),o.sizer=i("div",[o.mover],"CodeMirror-sizer"),o.sizerWidth=null,o.heightForcer=i("div",null,null,"position: absolute; height: "+ks+"px; width: 1px;"),o.gutters=i("div",null,"CodeMirror-gutters"),o.lineGutter=null,o.scroller=i("div",[o.sizer,o.heightForcer,o.gutters],"CodeMirror-scroll"),o.scroller.setAttribute("tabIndex","-1"),o.wrapper=i("div",[o.scrollbarFiller,o.gutterFiller,o.scroller],"CodeMirror"),cs&&us<8&&(o.gutters.style.zIndex=-1,o.scroller.style.paddingRight=0),hs||os&&xs||(o.scroller.draggable=!0),e&&(e.appendChild?e.appendChild(o.wrapper):e(o.wrapper)),o.viewFrom=o.viewTo=t.first,o.reportedViewFrom=o.reportedViewTo=t.first,o.view=[],o.renderedView=null,o.externalMeasured=null,o.viewOffset=0,o.lastWrapHeight=o.lastWrapWidth=0,o.updateLineNumbers=null,o.nativeBarWidth=o.barHeight=o.barWidth=0,o.scrollbarsClipped=!1,o.lineNumWidth=o.lineNumInnerWidth=o.lineNumChars=null,o.alignWidgets=!1,o.cachedCharWidth=o.cachedTextHeight=o.cachedPaddingH=null,o.maxLine=null,o.maxLineLength=0,o.maxLineChanged=!1,o.wheelDX=o.wheelDY=o.wheelStartX=o.wheelStartY=null,o.shift=!1,o.selForContextMenu=null,o.activeTouch=null,n.init(o)}function M(e,t){if((t-=e.first)<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var n=e;!n.lines;)for(var i=0;;++i){var r=n.children[i],o=r.chunkSize();if(t<o){n=r;break}t-=o}return n.lines[t]}function A(e,t,n){var i=[],r=t.line;return e.iter(t.line,n.line+1,function(e){var o=e.text;r==n.line&&(o=o.slice(0,n.ch)),r==t.line&&(o=o.slice(t.ch)),i.push(o),++r}),i}function E(e,t,n){var i=[];return e.iter(t,n,function(e){i.push(e.text)}),i}function I(e,t){var n=t-e.height;if(n)for(var i=e;i;i=i.parent)i.height+=n}function T(e){if(null==e.parent)return null;for(var t=e.parent,n=d(t.lines,e),i=t.parent;i;t=i,i=i.parent)for(var r=0;i.children[r]!=t;++r)n+=i.children[r].chunkSize();return n+t.first}function L(e,t){var n=e.first;e:do{for(var i=0;i<e.children.length;++i){var r=e.children[i],o=r.height;if(t<o){e=r;continue e}t-=o,n+=r.chunkSize()}return n}while(!e.lines);for(var s=0;s<e.lines.length;++s){var a=e.lines[s].height;if(t<a)break;t-=a}return n+s}function k(e,t){return t>=e.first&&t<e.first+e.size}function O(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function P(e,t,n){if(void 0===n&&(n=null),!(this instanceof P))return new P(e,t,n);this.line=e,this.ch=t,this.sticky=n}function N(e,t){return e.line-t.line||e.ch-t.ch}function R(e,t){return e.sticky==t.sticky&&0==N(e,t)}function F(e){return P(e.line,e.ch)}function j(e,t){return N(e,t)<0?t:e}function V(e,t){return N(e,t)<0?e:t}function H(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function B(e,t){if(t.line<e.first)return P(e.first,0);var n=e.first+e.size-1;return t.line>n?P(n,M(e,n).text.length):z(t,M(e,t.line).text.length)}function z(e,t){var n=e.ch;return null==n||n>t?P(e.line,t):n<0?P(e.line,0):e}function $(e,t){for(var n=[],i=0;i<t.length;i++)n[i]=B(e,t[i]);return n}function U(){Hs=!0}function G(){Bs=!0}function W(e,t,n){this.marker=e,this.from=t,this.to=n}function X(e,t){if(e)for(var n=0;n<e.length;++n){var i=e[n];if(i.marker==t)return i}}function Y(e,t){for(var n,i=0;i<e.length;++i)e[i]!=t&&(n||(n=[])).push(e[i]);return n}function K(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.attachLine(e)}function Q(e,t,n){var i;if(e)for(var r=0;r<e.length;++r){var o=e[r],s=o.marker;if(null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t)||o.from==t&&"bookmark"==s.type&&(!n||!o.marker.insertLeft)){var a=null==o.to||(s.inclusiveRight?o.to>=t:o.to>t);(i||(i=[])).push(new W(s,o.from,a?null:o.to))}}return i}function Z(e,t,n){var i;if(e)for(var r=0;r<e.length;++r){var o=e[r],s=o.marker;if(null==o.to||(s.inclusiveRight?o.to>=t:o.to>t)||o.from==t&&"bookmark"==s.type&&(!n||o.marker.insertLeft)){var a=null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t);(i||(i=[])).push(new W(s,a?null:o.from-t,null==o.to?null:o.to-t))}}return i}function J(e,t){if(t.full)return null;var n=k(e,t.from.line)&&M(e,t.from.line).markedSpans,i=k(e,t.to.line)&&M(e,t.to.line).markedSpans;if(!n&&!i)return null;var r=t.from.ch,o=t.to.ch,s=0==N(t.from,t.to),a=Q(n,r,s),l=Z(i,o,s),c=1==t.text.length,u=m(t.text).length+(c?r:0);if(a)for(var h=0;h<a.length;++h){var d=a[h];if(null==d.to){var p=X(l,d.marker);p?c&&(d.to=null==p.to?null:p.to+u):d.to=r}}if(l)for(var f=0;f<l.length;++f){var g=l[f];null!=g.to&&(g.to+=u),null==g.from?X(a,g.marker)||(g.from=u,c&&(a||(a=[])).push(g)):(g.from+=u,c&&(a||(a=[])).push(g))}a&&(a=ee(a)),l&&l!=a&&(l=ee(l));var v=[a];if(!c){var y,b=t.text.length-2;if(b>0&&a)for(var x=0;x<a.length;++x)null==a[x].to&&(y||(y=[])).push(new W(a[x].marker,null,null));for(var q=0;q<b;++q)v.push(y);v.push(l)}return v}function ee(e){for(var t=0;t<e.length;++t){var n=e[t];null!=n.from&&n.from==n.to&&!1!==n.marker.clearWhenEmpty&&e.splice(t--,1)}return e.length?e:null}function te(e,t,n){var i=null;if(e.iter(t.line,n.line+1,function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var n=e.markedSpans[t].marker;!n.readOnly||i&&-1!=d(i,n)||(i||(i=[])).push(n)}}),!i)return null;for(var r=[{from:t,to:n}],o=0;o<i.length;++o)for(var s=i[o],a=s.find(0),l=0;l<r.length;++l){var c=r[l];if(!(N(c.to,a.from)<0||N(c.from,a.to)>0)){var u=[l,1],h=N(c.from,a.from),p=N(c.to,a.to);(h<0||!s.inclusiveLeft&&!h)&&u.push({from:c.from,to:a.from}),(p>0||!s.inclusiveRight&&!p)&&u.push({from:a.to,to:c.to}),r.splice.apply(r,u),l+=u.length-3}}return r}function ne(e){var t=e.markedSpans;if(t){for(var n=0;n<t.length;++n)t[n].marker.detachLine(e);e.markedSpans=null}}function ie(e,t){if(t){for(var n=0;n<t.length;++n)t[n].marker.attachLine(e);e.markedSpans=t}}function re(e){return e.inclusiveLeft?-1:0}function oe(e){return e.inclusiveRight?1:0}function se(e,t){var n=e.lines.length-t.lines.length;if(0!=n)return n;var i=e.find(),r=t.find(),o=N(i.from,r.from)||re(e)-re(t);if(o)return-o;var s=N(i.to,r.to)||oe(e)-oe(t);return s||t.id-e.id}function ae(e,t){var n,i=Bs&&e.markedSpans;if(i)for(var r=void 0,o=0;o<i.length;++o)(r=i[o]).marker.collapsed&&null==(t?r.from:r.to)&&(!n||se(n,r.marker)<0)&&(n=r.marker);return n}function le(e){return ae(e,!0)}function ce(e){return ae(e,!1)}function ue(e,t,n,i,r){var o=M(e,t),s=Bs&&o.markedSpans;if(s)for(var a=0;a<s.length;++a){var l=s[a];if(l.marker.collapsed){var c=l.marker.find(0),u=N(c.from,n)||re(l.marker)-re(r),h=N(c.to,i)||oe(l.marker)-oe(r);if(!(u>=0&&h<=0||u<=0&&h>=0)&&(u<=0&&(l.marker.inclusiveRight&&r.inclusiveLeft?N(c.to,n)>=0:N(c.to,n)>0)||u>=0&&(l.marker.inclusiveRight&&r.inclusiveLeft?N(c.from,i)<=0:N(c.from,i)<0)))return!0}}}function he(e){for(var t;t=le(e);)e=t.find(-1,!0).line;return e}function de(e){for(var t;t=ce(e);)e=t.find(1,!0).line;return e}function pe(e){for(var t,n;t=ce(e);)e=t.find(1,!0).line,(n||(n=[])).push(e);return n}function fe(e,t){var n=M(e,t),i=he(n);return n==i?t:T(i)}function me(e,t){if(t>e.lastLine())return t;var n,i=M(e,t);if(!ge(e,i))return t;for(;n=ce(i);)i=n.find(1,!0).line;return T(i)+1}function ge(e,t){var n=Bs&&t.markedSpans;if(n)for(var i=void 0,r=0;r<n.length;++r)if((i=n[r]).marker.collapsed){if(null==i.from)return!0;if(!i.marker.widgetNode&&0==i.from&&i.marker.inclusiveLeft&&ve(e,t,i))return!0}}function ve(e,t,n){if(null==n.to){var i=n.marker.find(1,!0);return ve(e,i.line,X(i.line.markedSpans,n.marker))}if(n.marker.inclusiveRight&&n.to==t.text.length)return!0;for(var r=void 0,o=0;o<t.markedSpans.length;++o)if((r=t.markedSpans[o]).marker.collapsed&&!r.marker.widgetNode&&r.from==n.to&&(null==r.to||r.to!=n.from)&&(r.marker.inclusiveLeft||n.marker.inclusiveRight)&&ve(e,t,r))return!0}function ye(e){for(var t=0,n=(e=he(e)).parent,i=0;i<n.lines.length;++i){var r=n.lines[i];if(r==e)break;t+=r.height}for(var o=n.parent;o;n=o,o=n.parent)for(var s=0;s<o.children.length;++s){var a=o.children[s];if(a==n)break;t+=a.height}return t}function be(e){if(0==e.height)return 0;for(var t,n=e.text.length,i=e;t=le(i);){var r=t.find(0,!0);i=r.from.line,n+=r.from.ch-r.to.ch}for(i=e;t=ce(i);){var o=t.find(0,!0);n-=i.text.length-o.from.ch,n+=(i=o.to.line).text.length-o.to.ch}return n}function xe(e){var t=e.display,n=e.doc;t.maxLine=M(n,n.first),t.maxLineLength=be(t.maxLine),t.maxLineChanged=!0,n.iter(function(e){var n=be(e);n>t.maxLineLength&&(t.maxLineLength=n,t.maxLine=e)})}function qe(e,t,n,i){if(!e)return i(t,n,"ltr");for(var r=!1,o=0;o<e.length;++o){var s=e[o];(s.from<n&&s.to>t||t==n&&s.to==t)&&(i(Math.max(s.from,t),Math.min(s.to,n),1==s.level?"rtl":"ltr"),r=!0)}r||i(t,n,"ltr")}function Ce(e,t,n){var i;zs=null;for(var r=0;r<e.length;++r){var o=e[r];if(o.from<t&&o.to>t)return r;o.to==t&&(o.from!=o.to&&"before"==n?i=r:zs=r),o.from==t&&(o.from!=o.to&&"before"!=n?i=r:zs=r)}return null!=i?i:zs}function Se(e,t){var n=e.order;return null==n&&(n=e.order=$s(e.text,t)),n}function we(e,t,n){var i=w(e.text,t+n,n);return i<0||i>e.text.length?null:i}function _e(e,t,n){var i=we(e,t.ch,n);return null==i?null:new P(t.line,i,n<0?"after":"before")}function De(e,t,n,i,r){if(e){var o=Se(n,t.doc.direction);if(o){var s,a=r<0?m(o):o[0],l=r<0==(1==a.level)?"after":"before";if(a.level>0){var c=Kt(t,n);s=r<0?n.text.length-1:0;var u=Qt(t,c,s).top;s=_(function(e){return Qt(t,c,e).top==u},r<0==(1==a.level)?a.from:a.to-1,s),"before"==l&&(s=we(n,s,1))}else s=r<0?a.to:a.from;return new P(i,s,l)}}return new P(i,r<0?n.text.length:0,r<0?"before":"after")}function Me(e,t,n,i){var r=Se(t,e.doc.direction);if(!r)return _e(t,n,i);n.ch>=t.text.length?(n.ch=t.text.length,n.sticky="before"):n.ch<=0&&(n.ch=0,n.sticky="after");var o=Ce(r,n.ch,n.sticky),s=r[o];if("ltr"==e.doc.direction&&s.level%2==0&&(i>0?s.to>n.ch:s.from<n.ch))return _e(t,n,i);var a,l=function(e,n){return we(t,e instanceof P?e.ch:e,n)},c=function(n){return e.options.lineWrapping?(a=a||Kt(e,t),gn(e,t,a,n)):{begin:0,end:t.text.length}},u=c("before"==n.sticky?l(n,-1):n.ch);if("rtl"==e.doc.direction||1==s.level){var h=1==s.level==i<0,d=l(n,h?1:-1);if(null!=d&&(h?d<=s.to&&d<=u.end:d>=s.from&&d>=u.begin)){var p=h?"before":"after";return new P(n.line,d,p)}}var f=function(e,t,i){for(var o=function(e,t){return t?new P(n.line,l(e,1),"before"):new P(n.line,e,"after")};e>=0&&e<r.length;e+=t){var s=r[e],a=t>0==(1!=s.level),c=a?i.begin:l(i.end,-1);if(s.from<=c&&c<s.to)return o(c,a);if(c=a?s.from:l(s.to,-1),i.begin<=c&&c<i.end)return o(c,a)}},m=f(o+i,i,u);if(m)return m;var g=i>0?u.end:l(u.begin,-1);return null==g||i>0&&g==t.text.length||!(m=f(i>0?0:r.length-1,i,c(g)))?null:m}function Ae(e,t){return e._handlers&&e._handlers[t]||Us}function Ee(e,t,n){if(e.removeEventListener)e.removeEventListener(t,n,!1);else if(e.detachEvent)e.detachEvent("on"+t,n);else{var i=e._handlers,r=i&&i[t];if(r){var o=d(r,n);o>-1&&(i[t]=r.slice(0,o).concat(r.slice(o+1)))}}}function Ie(e,t){var n=Ae(e,t);if(n.length)for(var i=Array.prototype.slice.call(arguments,2),r=0;r<n.length;++r)n[r].apply(null,i)}function Te(e,t,n){return"string"==typeof t&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),Ie(e,n||t.type,e,t),Re(t)||t.codemirrorIgnore}function Le(e){var t=e._handlers&&e._handlers.cursorActivity;if(t)for(var n=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),i=0;i<t.length;++i)-1==d(n,t[i])&&n.push(t[i])}function ke(e,t){return Ae(e,t).length>0}function Oe(e){e.prototype.on=function(e,t){Gs(this,e,t)},e.prototype.off=function(e,t){Ee(this,e,t)}}function Pe(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function Ne(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function Re(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function Fe(e){Pe(e),Ne(e)}function je(e){return e.target||e.srcElement}function Ve(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),qs&&e.ctrlKey&&1==t&&(t=3),t}function He(e){if(null==Ts){var t=i("span","");n(e,i("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(Ts=t.offsetWidth<=1&&t.offsetHeight>2&&!(cs&&us<8))}var r=Ts?i("span",""):i("span","",null,"display: inline-block; width: 1px; margin-right: -1px");return r.setAttribute("cm-text",""),r}function Be(e){if(null!=Ls)return Ls;var i=n(e,document.createTextNode("AA")),r=_s(i,0,1).getBoundingClientRect(),o=_s(i,1,2).getBoundingClientRect();return t(e),!(!r||r.left==r.right)&&(Ls=o.right-r.right<3)}function ze(e){if(null!=Qs)return Qs;var t=n(e,i("span","x")),r=t.getBoundingClientRect(),o=_s(t,0,1).getBoundingClientRect();return Qs=Math.abs(r.left-o.left)>1}function $e(e,t){arguments.length>2&&(t.dependencies=Array.prototype.slice.call(arguments,2)),Zs[e]=t}function Ue(e){if("string"==typeof e&&Js.hasOwnProperty(e))e=Js[e];else if(e&&"string"==typeof e.name&&Js.hasOwnProperty(e.name)){var t=Js[e.name];"string"==typeof t&&(t={name:t}),(e=b(t,e)).name=t.name}else{if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return Ue("application/xml");if("string"==typeof e&&/^[\w\-]+\/[\w\-]+\+json$/.test(e))return Ue("application/json")}return"string"==typeof e?{name:e}:e||{name:"null"}}function Ge(e,t){t=Ue(t);var n=Zs[t.name];if(!n)return Ge(e,"text/plain");var i=n(e,t);if(ea.hasOwnProperty(t.name)){var r=ea[t.name];for(var o in r)r.hasOwnProperty(o)&&(i.hasOwnProperty(o)&&(i["_"+o]=i[o]),i[o]=r[o])}if(i.name=t.name,t.helperType&&(i.helperType=t.helperType),t.modeProps)for(var s in t.modeProps)i[s]=t.modeProps[s];return i}function We(e,t){u(t,ea.hasOwnProperty(e)?ea[e]:ea[e]={})}function Xe(e,t){if(!0===t)return t;if(e.copyState)return e.copyState(t);var n={};for(var i in t){var r=t[i];r instanceof Array&&(r=r.concat([])),n[i]=r}return n}function Ye(e,t){for(var n;e.innerMode&&(n=e.innerMode(t))&&n.mode!=e;)t=n.state,e=n.mode;return n||{mode:e,state:t}}function Ke(e,t,n){return!e.startState||e.startState(t,n)}function Qe(e,t,n,i){var r=[e.state.modeGen],o={};ot(e,t.text,e.doc.mode,n,function(e,t){return r.push(e,t)},o,i);for(var s=n.state,a=0;a<e.state.overlays.length;++a)!function(i){var s=e.state.overlays[i],a=1,l=0;n.state=!0,ot(e,t.text,s.mode,n,function(e,t){for(var n=a;l<e;){var i=r[a];i>e&&r.splice(a,1,e,r[a+1],i),a+=2,l=Math.min(e,i)}if(t)if(s.opaque)r.splice(n,a-n,e,"overlay "+t),a=n+2;else for(;n<a;n+=2){var o=r[n+1];r[n+1]=(o?o+" ":"")+"overlay "+t}},o)}(a);return n.state=s,{styles:r,classes:o.bgClass||o.textClass?o:null}}function Ze(e,t,n){if(!t.styles||t.styles[0]!=e.state.modeGen){var i=Je(e,T(t)),r=t.text.length>e.options.maxHighlightLength&&Xe(e.doc.mode,i.state),o=Qe(e,t,i);r&&(i.state=r),t.stateAfter=i.save(!r),t.styles=o.styles,o.classes?t.styleClasses=o.classes:t.styleClasses&&(t.styleClasses=null),n===e.doc.highlightFrontier&&(e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier))}return t.styles}function Je(e,t,n){var i=e.doc,r=e.display;if(!i.mode.startState)return new ia(i,!0,t);var o=st(e,t,n),s=o>i.first&&M(i,o-1).stateAfter,a=s?ia.fromSaved(i,s,o):new ia(i,Ke(i.mode),o);return i.iter(o,t,function(n){et(e,n.text,a);var i=a.line;n.stateAfter=i==t-1||i%5==0||i>=r.viewFrom&&i<r.viewTo?a.save():null,a.nextLine()}),n&&!e.doc.mode.noUpdateFrontier&&(i.modeFrontier=a.line),a}function et(e,t,n,i){var r=e.doc.mode,o=new ta(t,e.options.tabSize,n);for(o.start=o.pos=i||0,""==t&&tt(r,n.state);!o.eol();)nt(r,o,n.state),o.start=o.pos}function tt(e,t){if(e.blankLine)return e.blankLine(t);if(e.innerMode){var n=Ye(e,t);return n.mode.blankLine?n.mode.blankLine(n.state):void 0}}function nt(e,t,n,i){for(var r=0;r<10;r++){i&&(i[0]=Ye(e,n).mode);var o=e.token(t,n);if(t.pos>t.start)return o}throw new Error("Mode "+e.name+" failed to advance stream.")}function it(e,t,n,i){var r,o,s=e.doc,a=s.mode,l=M(s,(t=B(s,t)).line),c=Je(e,t.line,n),u=new ta(l.text,e.options.tabSize,c);for(i&&(o=[]);(i||u.pos<t.ch)&&!u.eol();)u.start=u.pos,r=nt(a,u,c.state),i&&o.push(new ra(u,r,Xe(s.mode,c.state)));return i?o:new ra(u,r,c.state)}function rt(e,t){if(e)for(;;){var n=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!n)break;e=e.slice(0,n.index)+e.slice(n.index+n[0].length);var i=n[1]?"bgClass":"textClass";null==t[i]?t[i]=n[2]:new RegExp("(?:^|s)"+n[2]+"(?:$|s)").test(t[i])||(t[i]+=" "+n[2])}return e}function ot(e,t,n,i,r,o,s){var a=n.flattenSpans;null==a&&(a=e.options.flattenSpans);var l,c=0,u=null,h=new ta(t,e.options.tabSize,i),d=e.options.addModeClass&&[null];for(""==t&&rt(tt(n,i.state),o);!h.eol();){if(h.pos>e.options.maxHighlightLength?(a=!1,s&&et(e,t,i,h.pos),h.pos=t.length,l=null):l=rt(nt(n,h,i.state,d),o),d){var p=d[0].name;p&&(l="m-"+(l?p+" "+l:p))}if(!a||u!=l){for(;c<h.start;)r(c=Math.min(h.start,c+5e3),u);u=l}h.start=h.pos}for(;c<h.pos;){var f=Math.min(h.pos,c+5e3);r(f,u),c=f}}function st(e,t,n){for(var i,r,o=e.doc,s=e.doc.mode.preciseStartState||n?-1:t-(e.doc.mode.innerMode?1e3:100),a=t;a>s;--a){if(a<=o.first)return o.first;var l=M(o,a-1),c=l.stateAfter;if(c&&(!n||a+(c instanceof na?c.lookAhead:0)<=o.modeFrontier))return a;var u=h(l.text,null,e.options.tabSize);(null==r||i>u)&&(r=a-1,i=u)}return r}function at(e,t){if(e.modeFrontier=Math.min(e.modeFrontier,t),!(e.highlightFrontier<t-10)){for(var n=e.first,i=t-1;i>n;i--){var r=M(e,i).stateAfter;if(r&&(!(r instanceof na)||i+r.lookAhead<t)){n=i+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,n)}}function lt(e,t,n,i){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),ne(e),ie(e,n);var r=i?i(e):1;r!=e.height&&I(e,r)}function ct(e){e.parent=null,ne(e)}function ut(e,t){if(!e||/^\s*$/.test(e))return null;var n=t.addModeClass?la:aa;return n[e]||(n[e]=e.replace(/\S+/g,"cm-$&"))}function ht(e,t){var n=r("span",null,null,hs?"padding-right: .1px":null),i={pre:r("pre",[n],"CodeMirror-line"),content:n,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:(cs||hs)&&e.getOption("lineWrapping")};t.measure={};for(var o=0;o<=(t.rest?t.rest.length:0);o++){var s=o?t.rest[o-1]:t.line,a=void 0;i.pos=0,i.addToken=pt,Be(e.display.measure)&&(a=Se(s,e.doc.direction))&&(i.addToken=mt(i.addToken,a)),i.map=[],vt(s,i,Ze(e,s,t!=e.display.externalMeasured&&T(s))),s.styleClasses&&(s.styleClasses.bgClass&&(i.bgClass=l(s.styleClasses.bgClass,i.bgClass||"")),s.styleClasses.textClass&&(i.textClass=l(s.styleClasses.textClass,i.textClass||""))),0==i.map.length&&i.map.push(0,0,i.content.appendChild(He(e.display.measure))),0==o?(t.measure.map=i.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(i.map),(t.measure.caches||(t.measure.caches=[])).push({}))}if(hs){var c=i.content.lastChild;(/\bcm-tab\b/.test(c.className)||c.querySelector&&c.querySelector(".cm-tab"))&&(i.content.className="cm-tab-wrap-hack")}return Ie(e,"renderLine",e,t.line,i.pre),i.pre.className&&(i.textClass=l(i.pre.className,i.textClass||"")),i}function dt(e){var t=i("span","","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t.setAttribute("aria-label",t.title),t}function pt(e,t,n,r,o,s,a){if(t){var l,c=e.splitSpaces?ft(t,e.trailingSpace):t,u=e.cm.state.specialChars,h=!1;if(u.test(t)){l=document.createDocumentFragment();for(var d=0;;){u.lastIndex=d;var p=u.exec(t),m=p?p.index-d:t.length-d;if(m){var g=document.createTextNode(c.slice(d,d+m));cs&&us<9?l.appendChild(i("span",[g])):l.appendChild(g),e.map.push(e.pos,e.pos+m,g),e.col+=m,e.pos+=m}if(!p)break;d+=m+1;var v=void 0;if("\t"==p[0]){var y=e.cm.options.tabSize,b=y-e.col%y;(v=l.appendChild(i("span",f(b),"cm-tab"))).setAttribute("role","presentation"),v.setAttribute("cm-text","\t"),e.col+=b}else"\r"==p[0]||"\n"==p[0]?((v=l.appendChild(i("span","\r"==p[0]?"":"","cm-invalidchar"))).setAttribute("cm-text",p[0]),e.col+=1):((v=e.cm.options.specialCharPlaceholder(p[0])).setAttribute("cm-text",p[0]),cs&&us<9?l.appendChild(i("span",[v])):l.appendChild(v),e.col+=1);e.map.push(e.pos,e.pos+1,v),e.pos++}}else e.col+=t.length,l=document.createTextNode(c),e.map.push(e.pos,e.pos+t.length,l),cs&&us<9&&(h=!0),e.pos+=t.length;if(e.trailingSpace=32==c.charCodeAt(t.length-1),n||r||o||h||a){var x=n||"";r&&(x+=r),o&&(x+=o);var q=i("span",[l],x,a);return s&&(q.title=s),e.content.appendChild(q)}e.content.appendChild(l)}}function ft(e,t){if(e.length>1&&!/  /.test(e))return e;for(var n=t,i="",r=0;r<e.length;r++){var o=e.charAt(r);" "!=o||!n||r!=e.length-1&&32!=e.charCodeAt(r+1)||(o=""),i+=o,n=" "==o}return i}function mt(e,t){return function(n,i,r,o,s,a,l){r=r?r+" cm-force-border":"cm-force-border";for(var c=n.pos,u=c+i.length;;){for(var h=void 0,d=0;d<t.length&&!((h=t[d]).to>c&&h.from<=c);d++);if(h.to>=u)return e(n,i,r,o,s,a,l);e(n,i.slice(0,h.to-c),r,o,null,a,l),o=null,i=i.slice(h.to-c),c=h.to}}}function gt(e,t,n,i){var r=!i&&n.widgetNode;r&&e.map.push(e.pos,e.pos+t,r),!i&&e.cm.display.input.needsContentAttribute&&(r||(r=e.content.appendChild(document.createElement("span"))),r.setAttribute("cm-marker",n.id)),r&&(e.cm.display.input.setUneditable(r),e.content.appendChild(r)),e.pos+=t,e.trailingSpace=!1}function vt(e,t,n){var i=e.markedSpans,r=e.text,o=0;if(i)for(var s,a,l,c,u,h,d,p=r.length,f=0,m=1,g="",v=0;;){if(v==f){l=c=u=h=a="",d=null,v=1/0;for(var y=[],b=void 0,x=0;x<i.length;++x){var q=i[x],C=q.marker;"bookmark"==C.type&&q.from==f&&C.widgetNode?y.push(C):q.from<=f&&(null==q.to||q.to>f||C.collapsed&&q.to==f&&q.from==f)?(null!=q.to&&q.to!=f&&v>q.to&&(v=q.to,c=""),C.className&&(l+=" "+C.className),C.css&&(a=(a?a+";":"")+C.css),C.startStyle&&q.from==f&&(u+=" "+C.startStyle),C.endStyle&&q.to==v&&(b||(b=[])).push(C.endStyle,q.to),C.title&&!h&&(h=C.title),C.collapsed&&(!d||se(d.marker,C)<0)&&(d=q)):q.from>f&&v>q.from&&(v=q.from)}if(b)for(var S=0;S<b.length;S+=2)b[S+1]==v&&(c+=" "+b[S]);if(!d||d.from==f)for(var w=0;w<y.length;++w)gt(t,0,y[w]);if(d&&(d.from||0)==f){if(gt(t,(null==d.to?p+1:d.to)-f,d.marker,null==d.from),null==d.to)return;d.to==f&&(d=!1)}}if(f>=p)break;for(var _=Math.min(p,v);;){if(g){var D=f+g.length;if(!d){var M=D>_?g.slice(0,_-f):g;t.addToken(t,M,s?s+l:l,u,f+M.length==v?c:"",h,a)}if(D>=_){g=g.slice(_-f),f=_;break}f=D,u=""}g=r.slice(o,o=n[m++]),s=ut(n[m++],t.cm.options)}}else for(var A=1;A<n.length;A+=2)t.addToken(t,r.slice(o,o=n[A]),ut(n[A+1],t.cm.options))}function yt(e,t,n){this.line=t,this.rest=pe(t),this.size=this.rest?T(m(this.rest))-n+1:1,this.node=this.text=null,this.hidden=ge(e,t)}function bt(e,t,n){for(var i,r=[],o=t;o<n;o=i){var s=new yt(e.doc,M(e.doc,o),o);i=o+s.size,r.push(s)}return r}function xt(e){ca?ca.ops.push(e):e.ownsGroup=ca={ops:[e],delayedCallbacks:[]}}function qt(e){var t=e.delayedCallbacks,n=0;do{for(;n<t.length;n++)t[n].call(null);for(var i=0;i<e.ops.length;i++){var r=e.ops[i];if(r.cursorActivityHandlers)for(;r.cursorActivityCalled<r.cursorActivityHandlers.length;)r.cursorActivityHandlers[r.cursorActivityCalled++].call(null,r.cm)}}while(n<t.length)}function Ct(e,t){var n=e.ownsGroup;if(n)try{qt(n)}finally{ca=null,t(n)}}function St(e,t){var n=Ae(e,t);if(n.length){var i,r=Array.prototype.slice.call(arguments,2);ca?i=ca.delayedCallbacks:ua?i=ua:(i=ua=[],setTimeout(wt,0));for(var o=0;o<n.length;++o)!function(e){i.push(function(){return n[e].apply(null,r)})}(o)}}function wt(){var e=ua;ua=null;for(var t=0;t<e.length;++t)e[t]()}function _t(e,t,n,i){for(var r=0;r<t.changes.length;r++){var o=t.changes[r];"text"==o?Et(e,t):"gutter"==o?Tt(e,t,n,i):"class"==o?It(e,t):"widget"==o&&Lt(e,t,i)}t.changes=null}function Dt(e){return e.node==e.text&&(e.node=i("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),cs&&us<8&&(e.node.style.zIndex=2)),e.node}function Mt(e,t){var n=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(n&&(n+=" CodeMirror-linebackground"),t.background)n?t.background.className=n:(t.background.parentNode.removeChild(t.background),t.background=null);else if(n){var r=Dt(t);t.background=r.insertBefore(i("div",null,n),r.firstChild),e.display.input.setUneditable(t.background)}}function At(e,t){var n=e.display.externalMeasured;return n&&n.line==t.line?(e.display.externalMeasured=null,t.measure=n.measure,n.built):ht(e,t)}function Et(e,t){var n=t.text.className,i=At(e,t);t.text==t.node&&(t.node=i.pre),t.text.parentNode.replaceChild(i.pre,t.text),t.text=i.pre,i.bgClass!=t.bgClass||i.textClass!=t.textClass?(t.bgClass=i.bgClass,t.textClass=i.textClass,It(e,t)):n&&(t.text.className=n)}function It(e,t){Mt(e,t),t.line.wrapClass?Dt(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");var n=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=n||""}function Tt(e,t,n,r){if(t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null),t.gutterBackground&&(t.node.removeChild(t.gutterBackground),t.gutterBackground=null),t.line.gutterClass){var o=Dt(t);t.gutterBackground=i("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(e.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px; width: "+r.gutterTotalWidth+"px"),e.display.input.setUneditable(t.gutterBackground),o.insertBefore(t.gutterBackground,t.text)}var s=t.line.gutterMarkers;if(e.options.lineNumbers||s){var a=Dt(t),l=t.gutter=i("div",null,"CodeMirror-gutter-wrapper","left: "+(e.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px");if(e.display.input.setUneditable(l),a.insertBefore(l,t.text),t.line.gutterClass&&(l.className+=" "+t.line.gutterClass),!e.options.lineNumbers||s&&s["CodeMirror-linenumbers"]||(t.lineNumber=l.appendChild(i("div",O(e.options,n),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+r.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),s)for(var c=0;c<e.options.gutters.length;++c){var u=e.options.gutters[c],h=s.hasOwnProperty(u)&&s[u];h&&l.appendChild(i("div",[h],"CodeMirror-gutter-elt","left: "+r.gutterLeft[u]+"px; width: "+r.gutterWidth[u]+"px"))}}}function Lt(e,t,n){t.alignable&&(t.alignable=null);for(var i=t.node.firstChild,r=void 0;i;i=r)r=i.nextSibling,"CodeMirror-linewidget"==i.className&&t.node.removeChild(i);Ot(e,t,n)}function kt(e,t,n,i){var r=At(e,t);return t.text=t.node=r.pre,r.bgClass&&(t.bgClass=r.bgClass),r.textClass&&(t.textClass=r.textClass),It(e,t),Tt(e,t,n,i),Ot(e,t,i),t.node}function Ot(e,t,n){if(Pt(e,t.line,t,n,!0),t.rest)for(var i=0;i<t.rest.length;i++)Pt(e,t.rest[i],t,n,!1)}function Pt(e,t,n,r,o){if(t.widgets)for(var s=Dt(n),a=0,l=t.widgets;a<l.length;++a){var c=l[a],u=i("div",[c.node],"CodeMirror-linewidget");c.handleMouseEvents||u.setAttribute("cm-ignore-events","true"),Nt(c,u,n,r),e.display.input.setUneditable(u),o&&c.above?s.insertBefore(u,n.gutter||n.text):s.appendChild(u),St(c,"redraw")}}function Nt(e,t,n,i){if(e.noHScroll){(n.alignable||(n.alignable=[])).push(t);var r=i.wrapperWidth;t.style.left=i.fixedPos+"px",e.coverGutter||(r-=i.gutterTotalWidth,t.style.paddingLeft=i.gutterTotalWidth+"px"),t.style.width=r+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-i.gutterTotalWidth+"px"))}function Rt(e){if(null!=e.height)return e.height;var t=e.doc.cm;if(!t)return 0;if(!o(document.body,e.node)){var r="position: relative;";e.coverGutter&&(r+="margin-left: -"+t.display.gutters.offsetWidth+"px;"),e.noHScroll&&(r+="width: "+t.display.wrapper.clientWidth+"px;"),n(t.display.measure,i("div",[e.node],null,r))}return e.height=e.node.parentNode.offsetHeight}function Ft(e,t){for(var n=je(t);n!=e.wrapper;n=n.parentNode)if(!n||1==n.nodeType&&"true"==n.getAttribute("cm-ignore-events")||n.parentNode==e.sizer&&n!=e.mover)return!0}function jt(e){return e.lineSpace.offsetTop}function Vt(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function Ht(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=n(e.measure,i("pre","x")),r=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,o={left:parseInt(r.paddingLeft),right:parseInt(r.paddingRight)};return isNaN(o.left)||isNaN(o.right)||(e.cachedPaddingH=o),o}function Bt(e){return ks-e.display.nativeBarWidth}function zt(e){return e.display.scroller.clientWidth-Bt(e)-e.display.barWidth}function $t(e){return e.display.scroller.clientHeight-Bt(e)-e.display.barHeight}function Ut(e,t,n){var i=e.options.lineWrapping,r=i&&zt(e);if(!t.measure.heights||i&&t.measure.width!=r){var o=t.measure.heights=[];if(i){t.measure.width=r;for(var s=t.text.firstChild.getClientRects(),a=0;a<s.length-1;a++){var l=s[a],c=s[a+1];Math.abs(l.bottom-c.bottom)>2&&o.push((l.bottom+c.top)/2-n.top)}}o.push(n.bottom-n.top)}}function Gt(e,t,n){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};for(var i=0;i<e.rest.length;i++)if(e.rest[i]==t)return{map:e.measure.maps[i],cache:e.measure.caches[i]};for(var r=0;r<e.rest.length;r++)if(T(e.rest[r])>n)return{map:e.measure.maps[r],cache:e.measure.caches[r],before:!0}}function Wt(e,t){var i=T(t=he(t)),r=e.display.externalMeasured=new yt(e.doc,t,i);r.lineN=i;var o=r.built=ht(e,r);return r.text=o.pre,n(e.display.lineMeasure,o.pre),r}function Xt(e,t,n,i){return Qt(e,Kt(e,t),n,i)}function Yt(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[_n(e,t)];var n=e.display.externalMeasured;return n&&t>=n.lineN&&t<n.lineN+n.size?n:void 0}function Kt(e,t){var n=T(t),i=Yt(e,n);i&&!i.text?i=null:i&&i.changes&&(_t(e,i,n,xn(e)),e.curOp.forceUpdate=!0),i||(i=Wt(e,t));var r=Gt(i,t,n);return{line:t,view:i,rect:null,map:r.map,cache:r.cache,before:r.before,hasHeights:!1}}function Qt(e,t,n,i,r){t.before&&(n=-1);var o,s=n+(i||"");return t.cache.hasOwnProperty(s)?o=t.cache[s]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(Ut(e,t.view,t.rect),t.hasHeights=!0),(o=en(e,t,n,i)).bogus||(t.cache[s]=o)),{left:o.left,right:o.right,top:r?o.rtop:o.top,bottom:r?o.rbottom:o.bottom}}function Zt(e,t,n){for(var i,r,o,s,a,l,c=0;c<e.length;c+=3)if(a=e[c],l=e[c+1],t<a?(r=0,o=1,s="left"):t<l?o=(r=t-a)+1:(c==e.length-3||t==l&&e[c+3]>t)&&(r=(o=l-a)-1,t>=l&&(s="right")),null!=r){if(i=e[c+2],a==l&&n==(i.insertLeft?"left":"right")&&(s=n),"left"==n&&0==r)for(;c&&e[c-2]==e[c-3]&&e[c-1].insertLeft;)i=e[2+(c-=3)],s="left";if("right"==n&&r==l-a)for(;c<e.length-3&&e[c+3]==e[c+4]&&!e[c+5].insertLeft;)i=e[(c+=3)+2],s="right";break}return{node:i,start:r,end:o,collapse:s,coverStart:a,coverEnd:l}}function Jt(e,t){var n=ha;if("left"==t)for(var i=0;i<e.length&&(n=e[i]).left==n.right;i++);else for(var r=e.length-1;r>=0&&(n=e[r]).left==n.right;r--);return n}function en(e,t,n,i){var r,o=Zt(t.map,n,i),s=o.node,a=o.start,l=o.end,c=o.collapse;if(3==s.nodeType){for(var u=0;u<4;u++){for(;a&&S(t.line.text.charAt(o.coverStart+a));)--a;for(;o.coverStart+l<o.coverEnd&&S(t.line.text.charAt(o.coverStart+l));)++l;if((r=cs&&us<9&&0==a&&l==o.coverEnd-o.coverStart?s.parentNode.getBoundingClientRect():Jt(_s(s,a,l).getClientRects(),i)).left||r.right||0==a)break;l=a,a-=1,c="right"}cs&&us<11&&(r=tn(e.display.measure,r))}else{a>0&&(c=i="right");var h;r=e.options.lineWrapping&&(h=s.getClientRects()).length>1?h["right"==i?h.length-1:0]:s.getBoundingClientRect()}if(cs&&us<9&&!a&&(!r||!r.left&&!r.right)){var d=s.parentNode.getClientRects()[0];r=d?{left:d.left,right:d.left+bn(e.display),top:d.top,bottom:d.bottom}:ha}for(var p=r.top-t.rect.top,f=r.bottom-t.rect.top,m=(p+f)/2,g=t.view.measure.heights,v=0;v<g.length-1&&!(m<g[v]);v++);var y=v?g[v-1]:0,b=g[v],x={left:("right"==c?r.right:r.left)-t.rect.left,right:("left"==c?r.left:r.right)-t.rect.left,top:y,bottom:b};return r.left||r.right||(x.bogus=!0),e.options.singleCursorHeightPerLine||(x.rtop=p,x.rbottom=f),x}function tn(e,t){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!ze(e))return t;var n=screen.logicalXDPI/screen.deviceXDPI,i=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*n,right:t.right*n,top:t.top*i,bottom:t.bottom*i}}function nn(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function rn(e){e.display.externalMeasure=null,t(e.display.lineMeasure);for(var n=0;n<e.display.view.length;n++)nn(e.display.view[n])}function on(e){rn(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function sn(){return ps&&bs?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function an(){return ps&&bs?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function ln(e,t,n,i,r){if(!r&&t.widgets)for(var o=0;o<t.widgets.length;++o)if(t.widgets[o].above){var s=Rt(t.widgets[o]);n.top+=s,n.bottom+=s}if("line"==i)return n;i||(i="local");var a=ye(t);if("local"==i?a+=jt(e.display):a-=e.display.viewOffset,"page"==i||"window"==i){var l=e.display.lineSpace.getBoundingClientRect();a+=l.top+("window"==i?0:an());var c=l.left+("window"==i?0:sn());n.left+=c,n.right+=c}return n.top+=a,n.bottom+=a,n}function cn(e,t,n){if("div"==n)return t;var i=t.left,r=t.top;if("page"==n)i-=sn(),r-=an();else if("local"==n||!n){var o=e.display.sizer.getBoundingClientRect();i+=o.left,r+=o.top}var s=e.display.lineSpace.getBoundingClientRect();return{left:i-s.left,top:r-s.top}}function un(e,t,n,i,r){return i||(i=M(e.doc,t.line)),ln(e,i,Xt(e,i,t.ch,r),n)}function hn(e,t,n,i,r,o){function s(t,s){var a=Qt(e,r,t,s?"right":"left",o);return s?a.left=a.right:a.right=a.left,ln(e,i,a,n)}function a(e,t,n){var i=l[t].level%2!=0;return s(n?e-1:e,i!=n)}i=i||M(e.doc,t.line),r||(r=Kt(e,i));var l=Se(i,e.doc.direction),c=t.ch,u=t.sticky;if(c>=i.text.length?(c=i.text.length,u="before"):c<=0&&(c=0,u="after"),!l)return s("before"==u?c-1:c,"before"==u);var h=Ce(l,c,u),d=zs,p=a(c,h,"before"==u);return null!=d&&(p.other=a(c,d,"before"!=u)),p}function dn(e,t){var n=0;t=B(e.doc,t),e.options.lineWrapping||(n=bn(e.display)*t.ch);var i=M(e.doc,t.line),r=ye(i)+jt(e.display);return{left:n,right:n,top:r,bottom:r+i.height}}function pn(e,t,n,i,r){var o=P(e,t,n);return o.xRel=r,i&&(o.outside=!0),o}function fn(e,t,n){var i=e.doc;if((n+=e.display.viewOffset)<0)return pn(i.first,0,null,!0,-1);var r=L(i,n),o=i.first+i.size-1;if(r>o)return pn(i.first+i.size-1,M(i,o).text.length,null,!0,1);t<0&&(t=0);for(var s=M(i,r);;){var a=vn(e,s,r,t,n),l=ce(s),c=l&&l.find(0,!0);if(!l||!(a.ch>c.from.ch||a.ch==c.from.ch&&a.xRel>0))return a;r=T(s=c.to.line)}}function mn(e,t,n,i){var r=function(i){return ln(e,t,Qt(e,n,i),"line")},o=t.text.length,s=_(function(e){return r(e-1).bottom<=i},o,0);return o=_(function(e){return r(e).top>i},s,o),{begin:s,end:o}}function gn(e,t,n,i){return mn(e,t,n,ln(e,t,Qt(e,n,i),"line").top)}function vn(e,t,n,i,r){r-=ye(t);var o,s=0,a=t.text.length,l=Kt(e,t);if(Se(t,e.doc.direction)){if(e.options.lineWrapping){var c;s=(c=mn(e,t,l,r)).begin,a=c.end}o=new P(n,Math.floor(s+(a-s)/2));var u,h,d=hn(e,o,"line",t,l).left,p=d<i?1:-1,f=d-i,m=Math.ceil((a-s)/4);e:do{u=f,h=o;for(var g=0;g<m;++g){var v=o;if(null==(o=Me(e,t,o,p))||o.ch<s||a<=("before"==o.sticky?o.ch-1:o.ch)){o=v;break e}}if(f=hn(e,o,"line",t,l).left-i,m>1){var y=Math.abs(f-u)/m;m=Math.min(m,Math.ceil(Math.abs(f)/y)),p=f<0?1:-1}}while(0!=f&&(m>1||p<0!=f<0&&Math.abs(f)<=Math.abs(u)));if(Math.abs(f)>Math.abs(u)){if(f<0==u<0)throw new Error("Broke out of infinite loop in coordsCharInner");o=h}}else{var b=_(function(n){var o=ln(e,t,Qt(e,l,n),"line");return o.top>r?(a=Math.min(n,a),!0):!(o.bottom<=r)&&(o.left>i||!(o.right<i)&&i-o.left<o.right-i)},s,a);o=new P(n,b=w(t.text,b,1),b==a?"before":"after")}var x=hn(e,o,"line",t,l);return(r<x.top||x.bottom<r)&&(o.outside=!0),o.xRel=i<x.left?-1:i>x.right?1:0,o}function yn(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==sa){sa=i("pre");for(var r=0;r<49;++r)sa.appendChild(document.createTextNode("x")),sa.appendChild(i("br"));sa.appendChild(document.createTextNode("x"))}n(e.measure,sa);var o=sa.offsetHeight/50;return o>3&&(e.cachedTextHeight=o),t(e.measure),o||1}function bn(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=i("span","xxxxxxxxxx"),r=i("pre",[t]);n(e.measure,r);var o=t.getBoundingClientRect(),s=(o.right-o.left)/10;return s>2&&(e.cachedCharWidth=s),s||10}function xn(e){for(var t=e.display,n={},i={},r=t.gutters.clientLeft,o=t.gutters.firstChild,s=0;o;o=o.nextSibling,++s)n[e.options.gutters[s]]=o.offsetLeft+o.clientLeft+r,i[e.options.gutters[s]]=o.clientWidth;return{fixedPos:qn(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:n,gutterWidth:i,wrapperWidth:t.wrapper.clientWidth}}function qn(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function Cn(e){var t=yn(e.display),n=e.options.lineWrapping,i=n&&Math.max(5,e.display.scroller.clientWidth/bn(e.display)-3);return function(r){if(ge(e.doc,r))return 0;var o=0;if(r.widgets)for(var s=0;s<r.widgets.length;s++)r.widgets[s].height&&(o+=r.widgets[s].height);return n?o+(Math.ceil(r.text.length/i)||1)*t:o+t}}function Sn(e){var t=e.doc,n=Cn(e);t.iter(function(e){var t=n(e);t!=e.height&&I(e,t)})}function wn(e,t,n,i){var r=e.display;if(!n&&"true"==je(t).getAttribute("cm-not-content"))return null;var o,s,a=r.lineSpace.getBoundingClientRect();try{o=t.clientX-a.left,s=t.clientY-a.top}catch(t){return null}var l,c=fn(e,o,s);if(i&&1==c.xRel&&(l=M(e.doc,c.line).text).length==c.ch){var u=h(l,l.length,e.options.tabSize)-l.length;c=P(c.line,Math.max(0,Math.round((o-Ht(e.display).left)/bn(e.display))-u))}return c}function _n(e,t){if(t>=e.display.viewTo)return null;if((t-=e.display.viewFrom)<0)return null;for(var n=e.display.view,i=0;i<n.length;i++)if((t-=n[i].size)<0)return i}function Dn(e){e.display.input.showSelection(e.display.input.prepareSelection())}function Mn(e,t){for(var n=e.doc,i={},r=i.cursors=document.createDocumentFragment(),o=i.selection=document.createDocumentFragment(),s=0;s<n.sel.ranges.length;s++)if(!1!==t||s!=n.sel.primIndex){var a=n.sel.ranges[s];if(!(a.from().line>=e.display.viewTo||a.to().line<e.display.viewFrom)){var l=a.empty();(l||e.options.showCursorWhenSelecting)&&An(e,a.head,r),l||En(e,a,o)}}return i}function An(e,t,n){var r=hn(e,t,"div",null,null,!e.options.singleCursorHeightPerLine),o=n.appendChild(i("div","","CodeMirror-cursor"));if(o.style.left=r.left+"px",o.style.top=r.top+"px",o.style.height=Math.max(0,r.bottom-r.top)*e.options.cursorHeight+"px",r.other){var s=n.appendChild(i("div","","CodeMirror-cursor CodeMirror-secondarycursor"));s.style.display="",s.style.left=r.other.left+"px",s.style.top=r.other.top+"px",s.style.height=.85*(r.other.bottom-r.other.top)+"px"}}function En(e,t,n){function r(e,t,n,r){t<0&&(t=0),t=Math.round(t),r=Math.round(r),l.appendChild(i("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px;\n                             top: "+t+"px; width: "+(null==n?h-e:n)+"px;\n                             height: "+(r-t)+"px"))}function o(t,n,i){function o(n,i){return un(e,P(t,n),"div",c,i)}var s,l,c=M(a,t),d=c.text.length;return qe(Se(c,a.direction),n||0,null==i?d:i,function(e,t,a){var c,p,f,m=o(e,"left");if(e==t)c=m,p=f=m.left;else{if(c=o(t-1,"right"),"rtl"==a){var g=m;m=c,c=g}p=m.left,f=c.right}null==n&&0==e&&(p=u),c.top-m.top>3&&(r(p,m.top,null,m.bottom),p=u,m.bottom<c.top&&r(p,m.bottom,null,c.top)),null==i&&t==d&&(f=h),(!s||m.top<s.top||m.top==s.top&&m.left<s.left)&&(s=m),(!l||c.bottom>l.bottom||c.bottom==l.bottom&&c.right>l.right)&&(l=c),p<u+1&&(p=u),r(p,c.top,f-p,c.bottom)}),{start:s,end:l}}var s=e.display,a=e.doc,l=document.createDocumentFragment(),c=Ht(e.display),u=c.left,h=Math.max(s.sizerWidth,zt(e)-s.sizer.offsetLeft)-c.right,d=t.from(),p=t.to();if(d.line==p.line)o(d.line,d.ch,p.ch);else{var f=M(a,d.line),m=M(a,p.line),g=he(f)==he(m),v=o(d.line,d.ch,g?f.text.length+1:null).end,y=o(p.line,g?0:null,p.ch).start;g&&(v.top<y.top-2?(r(v.right,v.top,null,v.bottom),r(u,y.top,y.left,y.bottom)):r(v.right,v.top,y.left-v.right,v.bottom)),v.bottom<y.top&&r(u,v.bottom,null,y.top)}n.appendChild(l)}function In(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var n=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0?t.blinker=setInterval(function(){return t.cursorDiv.style.visibility=(n=!n)?"":"hidden"},e.options.cursorBlinkRate):e.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden")}}function Tn(e){e.state.focused||(e.display.input.focus(),kn(e))}function Ln(e){e.state.delayingBlurEvent=!0,setTimeout(function(){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1,On(e))},100)}function kn(e,t){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1),"nocursor"!=e.options.readOnly&&(e.state.focused||(Ie(e,"focus",e,t),e.state.focused=!0,a(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(e.display.input.reset(),hs&&setTimeout(function(){return e.display.input.reset(!0)},20)),e.display.input.receivedFocus()),In(e))}function On(e,t){e.state.delayingBlurEvent||(e.state.focused&&(Ie(e,"blur",e,t),e.state.focused=!1,As(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout(function(){e.state.focused||(e.display.shift=!1)},150))}function Pn(e){for(var t=e.display,n=t.lineDiv.offsetTop,i=0;i<t.view.length;i++){var r=t.view[i],o=void 0;if(!r.hidden){if(cs&&us<8){var s=r.node.offsetTop+r.node.offsetHeight;o=s-n,n=s}else{var a=r.node.getBoundingClientRect();o=a.bottom-a.top}var l=r.line.height-o;if(o<2&&(o=yn(t)),(l>.005||l<-.005)&&(I(r.line,o),Nn(r.line),r.rest))for(var c=0;c<r.rest.length;c++)Nn(r.rest[c])}}}function Nn(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t)e.widgets[t].height=e.widgets[t].node.parentNode.offsetHeight}function Rn(e,t,n){var i=n&&null!=n.top?Math.max(0,n.top):e.scroller.scrollTop;i=Math.floor(i-jt(e));var r=n&&null!=n.bottom?n.bottom:i+e.wrapper.clientHeight,o=L(t,i),s=L(t,r);if(n&&n.ensure){var a=n.ensure.from.line,l=n.ensure.to.line;a<o?(o=a,s=L(t,ye(M(t,a))+e.wrapper.clientHeight)):Math.min(l,t.lastLine())>=s&&(o=L(t,ye(M(t,l))-e.wrapper.clientHeight),s=l)}return{from:o,to:Math.max(s,o+1)}}function Fn(e){var t=e.display,n=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var i=qn(t)-t.scroller.scrollLeft+e.doc.scrollLeft,r=t.gutters.offsetWidth,o=i+"px",s=0;s<n.length;s++)if(!n[s].hidden){e.options.fixedGutter&&(n[s].gutter&&(n[s].gutter.style.left=o),n[s].gutterBackground&&(n[s].gutterBackground.style.left=o));var a=n[s].alignable;if(a)for(var l=0;l<a.length;l++)a[l].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=i+r+"px")}}function jn(e){if(!e.options.lineNumbers)return!1;var t=e.doc,n=O(e.options,t.first+t.size-1),r=e.display;if(n.length!=r.lineNumChars){var o=r.measure.appendChild(i("div",[i("div",n)],"CodeMirror-linenumber CodeMirror-gutter-elt")),s=o.firstChild.offsetWidth,a=o.offsetWidth-s;return r.lineGutter.style.width="",r.lineNumInnerWidth=Math.max(s,r.lineGutter.offsetWidth-a)+1,r.lineNumWidth=r.lineNumInnerWidth+a,r.lineNumChars=r.lineNumInnerWidth?n.length:-1,r.lineGutter.style.width=r.lineNumWidth+"px",Ii(e),!0}return!1}function Vn(e,t){if(!Te(e,"scrollCursorIntoView")){var n=e.display,r=n.sizer.getBoundingClientRect(),o=null;if(t.top+r.top<0?o=!0:t.bottom+r.top>(window.innerHeight||document.documentElement.clientHeight)&&(o=!1),null!=o&&!vs){var s=i("div","",null,"position: absolute;\n                         top: "+(t.top-n.viewOffset-jt(e.display))+"px;\n                         height: "+(t.bottom-t.top+Bt(e)+n.barHeight)+"px;\n                         left: "+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;");e.display.lineSpace.appendChild(s),s.scrollIntoView(o),e.display.lineSpace.removeChild(s)}}}function Hn(e,t,n,i){null==i&&(i=0);var r;e.options.lineWrapping||t!=n||(n="before"==(t=t.ch?P(t.line,"before"==t.sticky?t.ch-1:t.ch,"after"):t).sticky?P(t.line,t.ch+1,"before"):t);for(var o=0;o<5;o++){var s=!1,a=hn(e,t),l=n&&n!=t?hn(e,n):a,c=zn(e,r={left:Math.min(a.left,l.left),top:Math.min(a.top,l.top)-i,right:Math.max(a.left,l.left),bottom:Math.max(a.bottom,l.bottom)+i}),u=e.doc.scrollTop,h=e.doc.scrollLeft;if(null!=c.scrollTop&&(Kn(e,c.scrollTop),Math.abs(e.doc.scrollTop-u)>1&&(s=!0)),null!=c.scrollLeft&&(Zn(e,c.scrollLeft),Math.abs(e.doc.scrollLeft-h)>1&&(s=!0)),!s)break}return r}function Bn(e,t){var n=zn(e,t);null!=n.scrollTop&&Kn(e,n.scrollTop),null!=n.scrollLeft&&Zn(e,n.scrollLeft)}function zn(e,t){var n=e.display,i=yn(e.display);t.top<0&&(t.top=0);var r=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:n.scroller.scrollTop,o=$t(e),s={};t.bottom-t.top>o&&(t.bottom=t.top+o);var a=e.doc.height+Vt(n),l=t.top<i,c=t.bottom>a-i;if(t.top<r)s.scrollTop=l?0:t.top;else if(t.bottom>r+o){var u=Math.min(t.top,(c?a:t.bottom)-o);u!=r&&(s.scrollTop=u)}var h=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:n.scroller.scrollLeft,d=zt(e)-(e.options.fixedGutter?n.gutters.offsetWidth:0),p=t.right-t.left>d;return p&&(t.right=t.left+d),t.left<10?s.scrollLeft=0:t.left<h?s.scrollLeft=Math.max(0,t.left-(p?0:10)):t.right>d+h-3&&(s.scrollLeft=t.right+(p?0:10)-d),s}function $n(e,t){null!=t&&(Xn(e),e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+t)}function Un(e){Xn(e);var t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function Gn(e,t,n){null==t&&null==n||Xn(e),null!=t&&(e.curOp.scrollLeft=t),null!=n&&(e.curOp.scrollTop=n)}function Wn(e,t){Xn(e),e.curOp.scrollToPos=t}function Xn(e){var t=e.curOp.scrollToPos;t&&(e.curOp.scrollToPos=null,Yn(e,dn(e,t.from),dn(e,t.to),t.margin))}function Yn(e,t,n,i){var r=zn(e,{left:Math.min(t.left,n.left),top:Math.min(t.top,n.top)-i,right:Math.max(t.right,n.right),bottom:Math.max(t.bottom,n.bottom)+i});Gn(e,r.scrollLeft,r.scrollTop)}function Kn(e,t){Math.abs(e.doc.scrollTop-t)<2||(os||Ai(e,{top:t}),Qn(e,t,!0),os&&Ai(e),qi(e,100))}function Qn(e,t,n){t=Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t),(e.display.scroller.scrollTop!=t||n)&&(e.doc.scrollTop=t,e.display.scrollbars.setScrollTop(t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t))}function Zn(e,t,n,i){t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth),(n?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!i||(e.doc.scrollLeft=t,Fn(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbars.setScrollLeft(t))}function Jn(e){var t=e.display,n=t.gutters.offsetWidth,i=Math.round(e.doc.height+Vt(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?n:0,docHeight:i,scrollHeight:i+Bt(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:n}}function ei(e,t){t||(t=Jn(e));var n=e.display.barWidth,i=e.display.barHeight;ti(e,t);for(var r=0;r<4&&n!=e.display.barWidth||i!=e.display.barHeight;r++)n!=e.display.barWidth&&e.options.lineWrapping&&Pn(e),ti(e,Jn(e)),n=e.display.barWidth,i=e.display.barHeight}function ti(e,t){var n=e.display,i=n.scrollbars.update(t);n.sizer.style.paddingRight=(n.barWidth=i.right)+"px",n.sizer.style.paddingBottom=(n.barHeight=i.bottom)+"px",n.heightForcer.style.borderBottom=i.bottom+"px solid transparent",i.right&&i.bottom?(n.scrollbarFiller.style.display="block",n.scrollbarFiller.style.height=i.bottom+"px",n.scrollbarFiller.style.width=i.right+"px"):n.scrollbarFiller.style.display="",i.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(n.gutterFiller.style.display="block",n.gutterFiller.style.height=i.bottom+"px",n.gutterFiller.style.width=t.gutterWidth+"px"):n.gutterFiller.style.display=""}function ni(e){e.display.scrollbars&&(e.display.scrollbars.clear(),e.display.scrollbars.addClass&&As(e.display.wrapper,e.display.scrollbars.addClass)),e.display.scrollbars=new fa[e.options.scrollbarStyle](function(t){e.display.wrapper.insertBefore(t,e.display.scrollbarFiller),Gs(t,"mousedown",function(){e.state.focused&&setTimeout(function(){return e.display.input.focus()},0)}),t.setAttribute("cm-not-content","true")},function(t,n){"horizontal"==n?Zn(e,t):Kn(e,t)},e),e.display.scrollbars.addClass&&a(e.display.wrapper,e.display.scrollbars.addClass)}function ii(e){e.curOp={cm:e,viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++ma},xt(e.curOp)}function ri(e){Ct(e.curOp,function(e){for(var t=0;t<e.ops.length;t++)e.ops[t].cm.curOp=null;oi(e)})}function oi(e){for(var t=e.ops,n=0;n<t.length;n++)si(t[n]);for(var i=0;i<t.length;i++)ai(t[i]);for(var r=0;r<t.length;r++)li(t[r]);for(var o=0;o<t.length;o++)ci(t[o]);for(var s=0;s<t.length;s++)ui(t[s])}function si(e){var t=e.cm,n=t.display;Si(t),e.updateMaxLine&&xe(t),e.mustUpdate=e.viewChanged||e.forceUpdate||null!=e.scrollTop||e.scrollToPos&&(e.scrollToPos.from.line<n.viewFrom||e.scrollToPos.to.line>=n.viewTo)||n.maxLineChanged&&t.options.lineWrapping,e.update=e.mustUpdate&&new ga(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function ai(e){e.updatedDisplay=e.mustUpdate&&Di(e.cm,e.update)}function li(e){var t=e.cm,n=t.display;e.updatedDisplay&&Pn(t),e.barMeasure=Jn(t),n.maxLineChanged&&!t.options.lineWrapping&&(e.adjustWidthTo=Xt(t,n.maxLine,n.maxLine.text.length).left+3,t.display.sizerWidth=e.adjustWidthTo,e.barMeasure.scrollWidth=Math.max(n.scroller.clientWidth,n.sizer.offsetLeft+e.adjustWidthTo+Bt(t)+t.display.barWidth),e.maxScrollLeft=Math.max(0,n.sizer.offsetLeft+e.adjustWidthTo-zt(t))),(e.updatedDisplay||e.selectionChanged)&&(e.preparedSelection=n.input.prepareSelection(e.focus))}function ci(e){var t=e.cm;null!=e.adjustWidthTo&&(t.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<t.doc.scrollLeft&&Zn(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),!0),t.display.maxLineChanged=!1);var n=e.focus&&e.focus==s()&&(!document.hasFocus||document.hasFocus());e.preparedSelection&&t.display.input.showSelection(e.preparedSelection,n),(e.updatedDisplay||e.startHeight!=t.doc.height)&&ei(t,e.barMeasure),e.updatedDisplay&&Ti(t,e.barMeasure),e.selectionChanged&&In(t),t.state.focused&&e.updateInput&&t.display.input.reset(e.typing),n&&Tn(e.cm)}function ui(e){var t=e.cm,n=t.display,i=t.doc;e.updatedDisplay&&Mi(t,e.update),null==n.wheelStartX||null==e.scrollTop&&null==e.scrollLeft&&!e.scrollToPos||(n.wheelStartX=n.wheelStartY=null),null!=e.scrollTop&&Qn(t,e.scrollTop,e.forceScroll),null!=e.scrollLeft&&Zn(t,e.scrollLeft,!0,!0),e.scrollToPos&&Vn(t,Hn(t,B(i,e.scrollToPos.from),B(i,e.scrollToPos.to),e.scrollToPos.margin));var r=e.maybeHiddenMarkers,o=e.maybeUnhiddenMarkers;if(r)for(var s=0;s<r.length;++s)r[s].lines.length||Ie(r[s],"hide");if(o)for(var a=0;a<o.length;++a)o[a].lines.length&&Ie(o[a],"unhide");n.wrapper.offsetHeight&&(i.scrollTop=t.display.scroller.scrollTop),e.changeObjs&&Ie(t,"changes",t,e.changeObjs),e.update&&e.update.finish()}function hi(e,t){if(e.curOp)return t();ii(e);try{return t()}finally{ri(e)}}function di(e,t){return function(){if(e.curOp)return t.apply(e,arguments);ii(e);try{return t.apply(e,arguments)}finally{ri(e)}}}function pi(e){return function(){if(this.curOp)return e.apply(this,arguments);ii(this);try{return e.apply(this,arguments)}finally{ri(this)}}}function fi(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);ii(t);try{return e.apply(this,arguments)}finally{ri(t)}}}function mi(e,t,n,i){null==t&&(t=e.doc.first),null==n&&(n=e.doc.first+e.doc.size),i||(i=0);var r=e.display;if(i&&n<r.viewTo&&(null==r.updateLineNumbers||r.updateLineNumbers>t)&&(r.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=r.viewTo)Bs&&fe(e.doc,t)<r.viewTo&&vi(e);else if(n<=r.viewFrom)Bs&&me(e.doc,n+i)>r.viewFrom?vi(e):(r.viewFrom+=i,r.viewTo+=i);else if(t<=r.viewFrom&&n>=r.viewTo)vi(e);else if(t<=r.viewFrom){var o=yi(e,n,n+i,1);o?(r.view=r.view.slice(o.index),r.viewFrom=o.lineN,r.viewTo+=i):vi(e)}else if(n>=r.viewTo){var s=yi(e,t,t,-1);s?(r.view=r.view.slice(0,s.index),r.viewTo=s.lineN):vi(e)}else{var a=yi(e,t,t,-1),l=yi(e,n,n+i,1);a&&l?(r.view=r.view.slice(0,a.index).concat(bt(e,a.lineN,l.lineN)).concat(r.view.slice(l.index)),r.viewTo+=i):vi(e)}var c=r.externalMeasured;c&&(n<c.lineN?c.lineN+=i:t<c.lineN+c.size&&(r.externalMeasured=null))}function gi(e,t,n){e.curOp.viewChanged=!0;var i=e.display,r=e.display.externalMeasured;if(r&&t>=r.lineN&&t<r.lineN+r.size&&(i.externalMeasured=null),!(t<i.viewFrom||t>=i.viewTo)){var o=i.view[_n(e,t)];if(null!=o.node){var s=o.changes||(o.changes=[]);-1==d(s,n)&&s.push(n)}}}function vi(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function yi(e,t,n,i){var r,o=_n(e,t),s=e.display.view;if(!Bs||n==e.doc.first+e.doc.size)return{index:o,lineN:n};for(var a=e.display.viewFrom,l=0;l<o;l++)a+=s[l].size;if(a!=t){if(i>0){if(o==s.length-1)return null;r=a+s[o].size-t,o++}else r=a-t;t+=r,n+=r}for(;fe(e.doc,n)!=n;){if(o==(i<0?0:s.length-1))return null;n+=i*s[o-(i<0?1:0)].size,o+=i}return{index:o,lineN:n}}function bi(e,t,n){var i=e.display;0==i.view.length||t>=i.viewTo||n<=i.viewFrom?(i.view=bt(e,t,n),i.viewFrom=t):(i.viewFrom>t?i.view=bt(e,t,i.viewFrom).concat(i.view):i.viewFrom<t&&(i.view=i.view.slice(_n(e,t))),i.viewFrom=t,i.viewTo<n?i.view=i.view.concat(bt(e,i.viewTo,n)):i.viewTo>n&&(i.view=i.view.slice(0,_n(e,n)))),i.viewTo=n}function xi(e){for(var t=e.display.view,n=0,i=0;i<t.length;i++){var r=t[i];r.hidden||r.node&&!r.changes||++n}return n}function qi(e,t){e.doc.highlightFrontier<e.display.viewTo&&e.state.highlight.set(t,c(Ci,e))}function Ci(e){var t=e.doc;if(!(t.highlightFrontier>=e.display.viewTo)){var n=+new Date+e.options.workTime,i=Je(e,t.highlightFrontier),r=[];t.iter(i.line,Math.min(t.first+t.size,e.display.viewTo+500),function(o){if(i.line>=e.display.viewFrom){var s=o.styles,a=o.text.length>e.options.maxHighlightLength?Xe(t.mode,i.state):null,l=Qe(e,o,i,!0);a&&(i.state=a),o.styles=l.styles;var c=o.styleClasses,u=l.classes;u?o.styleClasses=u:c&&(o.styleClasses=null);for(var h=!s||s.length!=o.styles.length||c!=u&&(!c||!u||c.bgClass!=u.bgClass||c.textClass!=u.textClass),d=0;!h&&d<s.length;++d)h=s[d]!=o.styles[d];h&&r.push(i.line),o.stateAfter=i.save(),i.nextLine()}else o.text.length<=e.options.maxHighlightLength&&et(e,o.text,i),o.stateAfter=i.line%5==0?i.save():null,i.nextLine();if(+new Date>n)return qi(e,e.options.workDelay),!0}),t.highlightFrontier=i.line,t.modeFrontier=Math.max(t.modeFrontier,i.line),r.length&&hi(e,function(){for(var t=0;t<r.length;t++)gi(e,r[t],"text")})}}function Si(e){var t=e.display;!t.scrollbarsClipped&&t.scroller.offsetWidth&&(t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth,t.heightForcer.style.height=Bt(e)+"px",t.sizer.style.marginBottom=-t.nativeBarWidth+"px",t.sizer.style.borderRightWidth=Bt(e)+"px",t.scrollbarsClipped=!0)}function wi(e){if(e.hasFocus())return null;var t=s();if(!t||!o(e.display.lineDiv,t))return null;var n={activeElt:t};if(window.getSelection){var i=window.getSelection();i.anchorNode&&i.extend&&o(e.display.lineDiv,i.anchorNode)&&(n.anchorNode=i.anchorNode,n.anchorOffset=i.anchorOffset,n.focusNode=i.focusNode,n.focusOffset=i.focusOffset)}return n}function _i(e){if(e&&e.activeElt&&e.activeElt!=s()&&(e.activeElt.focus(),e.anchorNode&&o(document.body,e.anchorNode)&&o(document.body,e.focusNode))){var t=window.getSelection(),n=document.createRange();n.setEnd(e.anchorNode,e.anchorOffset),n.collapse(!1),t.removeAllRanges(),t.addRange(n),t.extend(e.focusNode,e.focusOffset)}}function Di(e,n){var i=e.display,r=e.doc;if(n.editorIsHidden)return vi(e),!1;if(!n.force&&n.visible.from>=i.viewFrom&&n.visible.to<=i.viewTo&&(null==i.updateLineNumbers||i.updateLineNumbers>=i.viewTo)&&i.renderedView==i.view&&0==xi(e))return!1;jn(e)&&(vi(e),n.dims=xn(e));var o=r.first+r.size,s=Math.max(n.visible.from-e.options.viewportMargin,r.first),a=Math.min(o,n.visible.to+e.options.viewportMargin);i.viewFrom<s&&s-i.viewFrom<20&&(s=Math.max(r.first,i.viewFrom)),i.viewTo>a&&i.viewTo-a<20&&(a=Math.min(o,i.viewTo)),Bs&&(s=fe(e.doc,s),a=me(e.doc,a));var l=s!=i.viewFrom||a!=i.viewTo||i.lastWrapHeight!=n.wrapperHeight||i.lastWrapWidth!=n.wrapperWidth;bi(e,s,a),i.viewOffset=ye(M(e.doc,i.viewFrom)),e.display.mover.style.top=i.viewOffset+"px";var c=xi(e);if(!l&&0==c&&!n.force&&i.renderedView==i.view&&(null==i.updateLineNumbers||i.updateLineNumbers>=i.viewTo))return!1;var u=wi(e);return c>4&&(i.lineDiv.style.display="none"),Ei(e,i.updateLineNumbers,n.dims),c>4&&(i.lineDiv.style.display=""),i.renderedView=i.view,_i(u),t(i.cursorDiv),t(i.selectionDiv),i.gutters.style.height=i.sizer.style.minHeight=0,l&&(i.lastWrapHeight=n.wrapperHeight,i.lastWrapWidth=n.wrapperWidth,qi(e,400)),i.updateLineNumbers=null,!0}function Mi(e,t){for(var n=t.viewport,i=!0;(i&&e.options.lineWrapping&&t.oldDisplayWidth!=zt(e)||(n&&null!=n.top&&(n={top:Math.min(e.doc.height+Vt(e.display)-$t(e),n.top)}),t.visible=Rn(e.display,e.doc,n),!(t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo)))&&Di(e,t);i=!1){Pn(e);var r=Jn(e);Dn(e),ei(e,r),Ti(e,r),t.force=!1}t.signal(e,"update",e),e.display.viewFrom==e.display.reportedViewFrom&&e.display.viewTo==e.display.reportedViewTo||(t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo),e.display.reportedViewFrom=e.display.viewFrom,e.display.reportedViewTo=e.display.viewTo)}function Ai(e,t){var n=new ga(e,t);if(Di(e,n)){Pn(e),Mi(e,n);var i=Jn(e);Dn(e),ei(e,i),Ti(e,i),n.finish()}}function Ei(e,n,i){function r(t){var n=t.nextSibling;return hs&&qs&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),n}for(var o=e.display,s=e.options.lineNumbers,a=o.lineDiv,l=a.firstChild,c=o.view,u=o.viewFrom,h=0;h<c.length;h++){var p=c[h];if(p.hidden);else if(p.node&&p.node.parentNode==a){for(;l!=p.node;)l=r(l);var f=s&&null!=n&&n<=u&&p.lineNumber;p.changes&&(d(p.changes,"gutter")>-1&&(f=!1),_t(e,p,u,i)),f&&(t(p.lineNumber),p.lineNumber.appendChild(document.createTextNode(O(e.options,u)))),l=p.node.nextSibling}else{var m=kt(e,p,u,i);a.insertBefore(m,l)}u+=p.size}for(;l;)l=r(l)}function Ii(e){var t=e.display.gutters.offsetWidth;e.display.sizer.style.marginLeft=t+"px"}function Ti(e,t){e.display.sizer.style.minHeight=t.docHeight+"px",e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=t.docHeight+e.display.barHeight+Bt(e)+"px"}function Li(e){var n=e.display.gutters,r=e.options.gutters;t(n);for(var o=0;o<r.length;++o){var s=r[o],a=n.appendChild(i("div",null,"CodeMirror-gutter "+s));"CodeMirror-linenumbers"==s&&(e.display.lineGutter=a,a.style.width=(e.display.lineNumWidth||1)+"px")}n.style.display=o?"":"none",Ii(e)}function ki(e){var t=d(e.gutters,"CodeMirror-linenumbers");-1==t&&e.lineNumbers?e.gutters=e.gutters.concat(["CodeMirror-linenumbers"]):t>-1&&!e.lineNumbers&&(e.gutters=e.gutters.slice(0),e.gutters.splice(t,1))}function Oi(e){var t=e.wheelDeltaX,n=e.wheelDeltaY;return null==t&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(t=e.detail),null==n&&e.detail&&e.axis==e.VERTICAL_AXIS?n=e.detail:null==n&&(n=e.wheelDelta),{x:t,y:n}}function Pi(e){var t=Oi(e);return t.x*=ya,t.y*=ya,t}function Ni(e,t){var n=Oi(t),i=n.x,r=n.y,o=e.display,s=o.scroller,a=s.scrollWidth>s.clientWidth,l=s.scrollHeight>s.clientHeight;if(i&&a||r&&l){if(r&&qs&&hs)e:for(var c=t.target,u=o.view;c!=s;c=c.parentNode)for(var h=0;h<u.length;h++)if(u[h].node==c){e.display.currentWheelTarget=c;break e}if(i&&!os&&!fs&&null!=ya)return r&&l&&Kn(e,Math.max(0,s.scrollTop+r*ya)),Zn(e,Math.max(0,s.scrollLeft+i*ya)),(!r||r&&l)&&Pe(t),void(o.wheelStartX=null);if(r&&null!=ya){var d=r*ya,p=e.doc.scrollTop,f=p+o.wrapper.clientHeight;d<0?p=Math.max(0,p+d-50):f=Math.min(e.doc.height,f+d+50),Ai(e,{top:p,bottom:f})}va<20&&(null==o.wheelStartX?(o.wheelStartX=s.scrollLeft,o.wheelStartY=s.scrollTop,o.wheelDX=i,o.wheelDY=r,setTimeout(function(){if(null!=o.wheelStartX){var e=s.scrollLeft-o.wheelStartX,t=s.scrollTop-o.wheelStartY,n=t&&o.wheelDY&&t/o.wheelDY||e&&o.wheelDX&&e/o.wheelDX;o.wheelStartX=o.wheelStartY=null,n&&(ya=(ya*va+n)/(va+1),++va)}},200)):(o.wheelDX+=i,o.wheelDY+=r))}}function Ri(e,t){var n=e[t];e.sort(function(e,t){return N(e.from(),t.from())}),t=d(e,n);for(var i=1;i<e.length;i++){var r=e[i],o=e[i-1];if(N(o.to(),r.from())>=0){var s=V(o.from(),r.from()),a=j(o.to(),r.to()),l=o.empty()?r.from()==r.head:o.from()==o.head;i<=t&&--t,e.splice(--i,2,new xa(l?a:s,l?s:a))}}return new ba(e,t)}function Fi(e,t){return new ba([new xa(e,t||e)],0)}function ji(e){return e.text?P(e.from.line+e.text.length-1,m(e.text).length+(1==e.text.length?e.from.ch:0)):e.to}function Vi(e,t){if(N(e,t.from)<0)return e;if(N(e,t.to)<=0)return ji(t);var n=e.line+t.text.length-(t.to.line-t.from.line)-1,i=e.ch;return e.line==t.to.line&&(i+=ji(t).ch-t.to.ch),P(n,i)}function Hi(e,t){for(var n=[],i=0;i<e.sel.ranges.length;i++){var r=e.sel.ranges[i];n.push(new xa(Vi(r.anchor,t),Vi(r.head,t)))}return Ri(n,e.sel.primIndex)}function Bi(e,t,n){return e.line==t.line?P(n.line,e.ch-t.ch+n.ch):P(n.line+(e.line-t.line),e.ch)}function zi(e,t,n){for(var i=[],r=P(e.first,0),o=r,s=0;s<t.length;s++){var a=t[s],l=Bi(a.from,r,o),c=Bi(ji(a),r,o);if(r=a.to,o=c,"around"==n){var u=e.sel.ranges[s],h=N(u.head,u.anchor)<0;i[s]=new xa(h?c:l,h?l:c)}else i[s]=new xa(l,l)}return new ba(i,e.sel.primIndex)}function $i(e){e.doc.mode=Ge(e.options,e.doc.modeOption),Ui(e)}function Ui(e){e.doc.iter(function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)}),e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first,qi(e,100),e.state.modeGen++,e.curOp&&mi(e)}function Gi(e,t){return 0==t.from.ch&&0==t.to.ch&&""==m(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function Wi(e,t,n,i){function r(e){return n?n[e]:null}function o(e,n,r){lt(e,n,r,i),St(e,"change",e,t)}function s(e,t){for(var n=[],o=e;o<t;++o)n.push(new oa(c[o],r(o),i));return n}var a=t.from,l=t.to,c=t.text,u=M(e,a.line),h=M(e,l.line),d=m(c),p=r(c.length-1),f=l.line-a.line;if(t.full)e.insert(0,s(0,c.length)),e.remove(c.length,e.size-c.length);else if(Gi(e,t)){var g=s(0,c.length-1);o(h,h.text,p),f&&e.remove(a.line,f),g.length&&e.insert(a.line,g)}else if(u==h)if(1==c.length)o(u,u.text.slice(0,a.ch)+d+u.text.slice(l.ch),p);else{var v=s(1,c.length-1);v.push(new oa(d+u.text.slice(l.ch),p,i)),o(u,u.text.slice(0,a.ch)+c[0],r(0)),e.insert(a.line+1,v)}else if(1==c.length)o(u,u.text.slice(0,a.ch)+c[0]+h.text.slice(l.ch),r(0)),e.remove(a.line+1,f);else{o(u,u.text.slice(0,a.ch)+c[0],r(0)),o(h,d+h.text.slice(l.ch),p);var y=s(1,c.length-1);f>1&&e.remove(a.line+1,f-1),e.insert(a.line+1,y)}St(e,"change",e,t)}function Xi(e,t,n){function i(e,r,o){if(e.linked)for(var s=0;s<e.linked.length;++s){var a=e.linked[s];if(a.doc!=r){var l=o&&a.sharedHist;n&&!l||(t(a.doc,l),i(a.doc,e,l))}}}i(e,null,!0)}function Yi(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,Sn(e),$i(e),Ki(e),e.options.lineWrapping||xe(e),e.options.mode=t.modeOption,mi(e)}function Ki(e){("rtl"==e.doc.direction?a:As)(e.display.lineDiv,"CodeMirror-rtl")}function Qi(e){hi(e,function(){Ki(e),mi(e)})}function Zi(e){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e||1}function Ji(e,t){var n={from:F(t.from),to:ji(t),text:A(e,t.from,t.to)};return sr(e,n,t.from.line,t.to.line+1),Xi(e,function(e){return sr(e,n,t.from.line,t.to.line+1)},!0),n}function er(e){for(;e.length&&m(e).ranges;)e.pop()}function tr(e,t){return t?(er(e.done),m(e.done)):e.done.length&&!m(e.done).ranges?m(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),m(e.done)):void 0}function nr(e,t,n,i){var r=e.history;r.undone.length=0;var o,s,a=+new Date;if((r.lastOp==i||r.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&e.cm&&r.lastModTime>a-e.cm.options.historyEventDelay||"*"==t.origin.charAt(0)))&&(o=tr(r,r.lastOp==i)))s=m(o.changes),0==N(t.from,t.to)&&0==N(t.from,s.to)?s.to=ji(t):o.changes.push(Ji(e,t));else{var l=m(r.done);for(l&&l.ranges||or(e.sel,r.done),o={changes:[Ji(e,t)],generation:r.generation},r.done.push(o);r.done.length>r.undoDepth;)r.done.shift(),r.done[0].ranges||r.done.shift()}r.done.push(n),r.generation=++r.maxGeneration,r.lastModTime=r.lastSelTime=a,r.lastOp=r.lastSelOp=i,r.lastOrigin=r.lastSelOrigin=t.origin,s||Ie(e,"historyAdded")}function ir(e,t,n,i){var r=t.charAt(0);return"*"==r||"+"==r&&n.ranges.length==i.ranges.length&&n.somethingSelected()==i.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}function rr(e,t,n,i){var r=e.history,o=i&&i.origin;n==r.lastSelOp||o&&r.lastSelOrigin==o&&(r.lastModTime==r.lastSelTime&&r.lastOrigin==o||ir(e,o,m(r.done),t))?r.done[r.done.length-1]=t:or(t,r.done),r.lastSelTime=+new Date,r.lastSelOrigin=o,r.lastSelOp=n,i&&!1!==i.clearRedo&&er(r.undone)}function or(e,t){var n=m(t);n&&n.ranges&&n.equals(e)||t.push(e)}function sr(e,t,n,i){var r=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,n),Math.min(e.first+e.size,i),function(n){n.markedSpans&&((r||(r=t["spans_"+e.id]={}))[o]=n.markedSpans),++o})}function ar(e){if(!e)return null;for(var t,n=0;n<e.length;++n)e[n].marker.explicitlyCleared?t||(t=e.slice(0,n)):t&&t.push(e[n]);return t?t.length?t:null:e}function lr(e,t){var n=t["spans_"+e.id];if(!n)return null;for(var i=[],r=0;r<t.text.length;++r)i.push(ar(n[r]));return i}function cr(e,t){var n=lr(e,t),i=J(e,t);if(!n)return i;if(!i)return n;for(var r=0;r<n.length;++r){var o=n[r],s=i[r];if(o&&s)e:for(var a=0;a<s.length;++a){for(var l=s[a],c=0;c<o.length;++c)if(o[c].marker==l.marker)continue e;o.push(l)}else s&&(n[r]=s)}return n}function ur(e,t,n){for(var i=[],r=0;r<e.length;++r){var o=e[r];if(o.ranges)i.push(n?ba.prototype.deepCopy.call(o):o);else{var s=o.changes,a=[];i.push({changes:a});for(var l=0;l<s.length;++l){var c=s[l],u=void 0;if(a.push({from:c.from,to:c.to,text:c.text}),t)for(var h in c)(u=h.match(/^spans_(\d+)$/))&&d(t,Number(u[1]))>-1&&(m(a)[h]=c[h],delete c[h])}}}return i}function hr(e,t,n,i){if(i){var r=e.anchor;if(n){var o=N(t,r)<0;o!=N(n,r)<0?(r=t,t=n):o!=N(t,n)<0&&(t=n)}return new xa(r,t)}return new xa(n||t,t)}function dr(e,t,n,i,r){null==r&&(r=e.cm&&(e.cm.display.shift||e.extend)),yr(e,new ba([hr(e.sel.primary(),t,n,r)],0),i)}function pr(e,t,n){for(var i=[],r=e.cm&&(e.cm.display.shift||e.extend),o=0;o<e.sel.ranges.length;o++)i[o]=hr(e.sel.ranges[o],t[o],null,r);yr(e,Ri(i,e.sel.primIndex),n)}function fr(e,t,n,i){var r=e.sel.ranges.slice(0);r[t]=n,yr(e,Ri(r,e.sel.primIndex),i)}function mr(e,t,n,i){yr(e,Fi(t,n),i)}function gr(e,t,n){var i={ranges:t.ranges,update:function(t){var n=this;this.ranges=[];for(var i=0;i<t.length;i++)n.ranges[i]=new xa(B(e,t[i].anchor),B(e,t[i].head))},origin:n&&n.origin};return Ie(e,"beforeSelectionChange",e,i),e.cm&&Ie(e.cm,"beforeSelectionChange",e.cm,i),i.ranges!=t.ranges?Ri(i.ranges,i.ranges.length-1):t}function vr(e,t,n){var i=e.history.done,r=m(i);r&&r.ranges?(i[i.length-1]=t,br(e,t,n)):yr(e,t,n)}function yr(e,t,n){br(e,t,n),rr(e,e.sel,e.cm?e.cm.curOp.id:NaN,n)}function br(e,t,n){(ke(e,"beforeSelectionChange")||e.cm&&ke(e.cm,"beforeSelectionChange"))&&(t=gr(e,t,n)),xr(e,Cr(e,t,n&&n.bias||(N(t.primary().head,e.sel.primary().head)<0?-1:1),!0)),n&&!1===n.scroll||!e.cm||Un(e.cm)}function xr(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=e.cm.curOp.selectionChanged=!0,Le(e.cm)),St(e,"cursorActivity",e))}function qr(e){xr(e,Cr(e,e.sel,null,!1))}function Cr(e,t,n,i){for(var r,o=0;o<t.ranges.length;o++){var s=t.ranges[o],a=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[o],l=wr(e,s.anchor,a&&a.anchor,n,i),c=wr(e,s.head,a&&a.head,n,i);(r||l!=s.anchor||c!=s.head)&&(r||(r=t.ranges.slice(0,o)),r[o]=new xa(l,c))}return r?Ri(r,t.primIndex):t}function Sr(e,t,n,i,r){var o=M(e,t.line);if(o.markedSpans)for(var s=0;s<o.markedSpans.length;++s){var a=o.markedSpans[s],l=a.marker;if((null==a.from||(l.inclusiveLeft?a.from<=t.ch:a.from<t.ch))&&(null==a.to||(l.inclusiveRight?a.to>=t.ch:a.to>t.ch))){if(r&&(Ie(l,"beforeCursorEnter"),l.explicitlyCleared)){if(o.markedSpans){--s;continue}break}if(!l.atomic)continue;if(n){var c=l.find(i<0?1:-1),u=void 0;if((i<0?l.inclusiveRight:l.inclusiveLeft)&&(c=_r(e,c,-i,c&&c.line==t.line?o:null)),c&&c.line==t.line&&(u=N(c,n))&&(i<0?u<0:u>0))return Sr(e,c,t,i,r)}var h=l.find(i<0?-1:1);return(i<0?l.inclusiveLeft:l.inclusiveRight)&&(h=_r(e,h,i,h.line==t.line?o:null)),h?Sr(e,h,t,i,r):null}}return t}function wr(e,t,n,i,r){var o=i||1,s=Sr(e,t,n,o,r)||!r&&Sr(e,t,n,o,!0)||Sr(e,t,n,-o,r)||!r&&Sr(e,t,n,-o,!0);return s||(e.cantEdit=!0,P(e.first,0))}function _r(e,t,n,i){return n<0&&0==t.ch?t.line>e.first?B(e,P(t.line-1)):null:n>0&&t.ch==(i||M(e,t.line)).text.length?t.line<e.first+e.size-1?P(t.line+1,0):null:new P(t.line,t.ch+n)}function Dr(e){e.setSelection(P(e.firstLine(),0),P(e.lastLine()),Ps)}function Mr(e,t,n){var i={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){return i.canceled=!0}};return n&&(i.update=function(t,n,r,o){t&&(i.from=B(e,t)),n&&(i.to=B(e,n)),r&&(i.text=r),void 0!==o&&(i.origin=o)}),Ie(e,"beforeChange",e,i),e.cm&&Ie(e.cm,"beforeChange",e.cm,i),i.canceled?null:{from:i.from,to:i.to,text:i.text,origin:i.origin}}function Ar(e,t,n){if(e.cm){if(!e.cm.curOp)return di(e.cm,Ar)(e,t,n);if(e.cm.state.suppressEdits)return}if(!(ke(e,"beforeChange")||e.cm&&ke(e.cm,"beforeChange"))||(t=Mr(e,t,!0))){var i=Hs&&!n&&te(e,t.from,t.to);if(i)for(var r=i.length-1;r>=0;--r)Er(e,{from:i[r].from,to:i[r].to,text:r?[""]:t.text});else Er(e,t)}}function Er(e,t){if(1!=t.text.length||""!=t.text[0]||0!=N(t.from,t.to)){var n=Hi(e,t);nr(e,t,n,e.cm?e.cm.curOp.id:NaN),Lr(e,t,n,J(e,t));var i=[];Xi(e,function(e,n){n||-1!=d(i,e.history)||(Rr(e.history,t),i.push(e.history)),Lr(e,t,null,J(e,t))})}}function Ir(e,t,n){if(!e.cm||!e.cm.state.suppressEdits||n){for(var i,r=e.history,o=e.sel,s="undo"==t?r.done:r.undone,a="undo"==t?r.undone:r.done,l=0;l<s.length&&(i=s[l],n?!i.ranges||i.equals(e.sel):i.ranges);l++);if(l!=s.length){for(r.lastOrigin=r.lastSelOrigin=null;(i=s.pop()).ranges;){if(or(i,a),n&&!i.equals(e.sel))return void yr(e,i,{clearRedo:!1});o=i}var c=[];or(o,a),a.push({changes:c,generation:r.generation}),r.generation=i.generation||++r.maxGeneration;for(var u=ke(e,"beforeChange")||e.cm&&ke(e.cm,"beforeChange"),h=i.changes.length-1;h>=0;--h){var p=function(n){var r=i.changes[n];if(r.origin=t,u&&!Mr(e,r,!1))return s.length=0,{};c.push(Ji(e,r));var o=n?Hi(e,r):m(s);Lr(e,r,o,cr(e,r)),!n&&e.cm&&e.cm.scrollIntoView({from:r.from,to:ji(r)});var a=[];Xi(e,function(e,t){t||-1!=d(a,e.history)||(Rr(e.history,r),a.push(e.history)),Lr(e,r,null,cr(e,r))})}(h);if(p)return p.v}}}}function Tr(e,t){if(0!=t&&(e.first+=t,e.sel=new ba(g(e.sel.ranges,function(e){return new xa(P(e.anchor.line+t,e.anchor.ch),P(e.head.line+t,e.head.ch))}),e.sel.primIndex),e.cm)){mi(e.cm,e.first,e.first-t,t);for(var n=e.cm.display,i=n.viewFrom;i<n.viewTo;i++)gi(e.cm,i,"gutter")}}function Lr(e,t,n,i){if(e.cm&&!e.cm.curOp)return di(e.cm,Lr)(e,t,n,i);if(t.to.line<e.first)Tr(e,t.text.length-1-(t.to.line-t.from.line));else if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var r=t.text.length-1-(e.first-t.from.line);Tr(e,r),t={from:P(e.first,0),to:P(t.to.line+r,t.to.ch),text:[m(t.text)],origin:t.origin}}var o=e.lastLine();t.to.line>o&&(t={from:t.from,to:P(o,M(e,o).text.length),text:[t.text[0]],origin:t.origin}),t.removed=A(e,t.from,t.to),n||(n=Hi(e,t)),e.cm?kr(e.cm,t,i):Wi(e,t,i),br(e,n,Ps)}}function kr(e,t,n){var i=e.doc,r=e.display,o=t.from,s=t.to,a=!1,l=o.line;e.options.lineWrapping||(l=T(he(M(i,o.line))),i.iter(l,s.line+1,function(e){if(e==r.maxLine)return a=!0,!0})),i.sel.contains(t.from,t.to)>-1&&Le(e),Wi(i,t,n,Cn(e)),e.options.lineWrapping||(i.iter(l,o.line+t.text.length,function(e){var t=be(e);t>r.maxLineLength&&(r.maxLine=e,r.maxLineLength=t,r.maxLineChanged=!0,a=!1)}),a&&(e.curOp.updateMaxLine=!0)),at(i,o.line),qi(e,400);var c=t.text.length-(s.line-o.line)-1;t.full?mi(e):o.line!=s.line||1!=t.text.length||Gi(e.doc,t)?mi(e,o.line,s.line+1,c):gi(e,o.line,"text");var u=ke(e,"changes"),h=ke(e,"change");if(h||u){var d={from:o,to:s,text:t.text,removed:t.removed,origin:t.origin};h&&St(e,"change",e,d),u&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(d)}e.display.selForContextMenu=null}function Or(e,t,n,i,r){if(i||(i=n),N(i,n)<0){var o=i;i=n,n=o}"string"==typeof t&&(t=e.splitLines(t)),Ar(e,{from:n,to:i,text:t,origin:r})}function Pr(e,t,n,i){n<e.line?e.line+=i:t<e.line&&(e.line=t,e.ch=0)}function Nr(e,t,n,i){for(var r=0;r<e.length;++r){var o=e[r],s=!0;if(o.ranges){o.copied||((o=e[r]=o.deepCopy()).copied=!0);for(var a=0;a<o.ranges.length;a++)Pr(o.ranges[a].anchor,t,n,i),Pr(o.ranges[a].head,t,n,i)}else{for(var l=0;l<o.changes.length;++l){var c=o.changes[l];if(n<c.from.line)c.from=P(c.from.line+i,c.from.ch),c.to=P(c.to.line+i,c.to.ch);else if(t<=c.to.line){s=!1;break}}s||(e.splice(0,r+1),r=0)}}}function Rr(e,t){var n=t.from.line,i=t.to.line,r=t.text.length-(i-n)-1;Nr(e.done,n,i,r),Nr(e.undone,n,i,r)}function Fr(e,t,n,i){var r=t,o=t;return"number"==typeof t?o=M(e,H(e,t)):r=T(t),null==r?null:(i(o,r)&&e.cm&&gi(e.cm,r,n),o)}function jr(e){var t=this;this.lines=e,this.parent=null;for(var n=0,i=0;i<e.length;++i)e[i].parent=t,n+=e[i].height;this.height=n}function Vr(e){var t=this;this.children=e;for(var n=0,i=0,r=0;r<e.length;++r){var o=e[r];n+=o.chunkSize(),i+=o.height,o.parent=t}this.size=n,this.height=i,this.parent=null}function Hr(e,t,n){ye(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&$n(e,n)}function Br(e,t,n,i){var r=new qa(e,n,i),o=e.cm;return o&&r.noHScroll&&(o.display.alignWidgets=!0),Fr(e,t,"widget",function(t){var n=t.widgets||(t.widgets=[]);if(null==r.insertAt?n.push(r):n.splice(Math.min(n.length-1,Math.max(0,r.insertAt)),0,r),r.line=t,o&&!ge(e,t)){var i=ye(t)<e.scrollTop;I(t,t.height+Rt(r)),i&&$n(o,r.height),o.curOp.forceUpdate=!0}return!0}),St(o,"lineWidgetAdded",o,r,"number"==typeof t?t:T(t)),r}function zr(e,t,n,i,o){if(i&&i.shared)return $r(e,t,n,i,o);if(e.cm&&!e.cm.curOp)return di(e.cm,zr)(e,t,n,i,o);var s=new Sa(e,o),a=N(t,n);if(i&&u(i,s,!1),a>0||0==a&&!1!==s.clearWhenEmpty)return s;if(s.replacedWith&&(s.collapsed=!0,s.widgetNode=r("span",[s.replacedWith],"CodeMirror-widget"),i.handleMouseEvents||s.widgetNode.setAttribute("cm-ignore-events","true"),i.insertLeft&&(s.widgetNode.insertLeft=!0)),s.collapsed){if(ue(e,t.line,t,n,s)||t.line!=n.line&&ue(e,n.line,t,n,s))throw new Error("Inserting collapsed marker partially overlapping an existing one");G()}s.addToHistory&&nr(e,{from:t,to:n,origin:"markText"},e.sel,NaN);var l,c=t.line,h=e.cm;if(e.iter(c,n.line+1,function(e){h&&s.collapsed&&!h.options.lineWrapping&&he(e)==h.display.maxLine&&(l=!0),s.collapsed&&c!=t.line&&I(e,0),K(e,new W(s,c==t.line?t.ch:null,c==n.line?n.ch:null)),++c}),s.collapsed&&e.iter(t.line,n.line+1,function(t){ge(e,t)&&I(t,0)}),s.clearOnEnter&&Gs(s,"beforeCursorEnter",function(){return s.clear()}),s.readOnly&&(U(),(e.history.done.length||e.history.undone.length)&&e.clearHistory()),s.collapsed&&(s.id=++Ca,s.atomic=!0),h){if(l&&(h.curOp.updateMaxLine=!0),s.collapsed)mi(h,t.line,n.line+1);else if(s.className||s.title||s.startStyle||s.endStyle||s.css)for(var d=t.line;d<=n.line;d++)gi(h,d,"text");s.atomic&&qr(h.doc),St(h,"markerAdded",h,s)}return s}function $r(e,t,n,i,r){(i=u(i)).shared=!1;var o=[zr(e,t,n,i,r)],s=o[0],a=i.widgetNode;return Xi(e,function(e){a&&(i.widgetNode=a.cloneNode(!0)),o.push(zr(e,B(e,t),B(e,n),i,r));for(var l=0;l<e.linked.length;++l)if(e.linked[l].isParent)return;s=m(o)}),new wa(o,s)}function Ur(e){return e.findMarks(P(e.first,0),e.clipPos(P(e.lastLine())),function(e){return e.parent})}function Gr(e,t){for(var n=0;n<t.length;n++){var i=t[n],r=i.find(),o=e.clipPos(r.from),s=e.clipPos(r.to);if(N(o,s)){var a=zr(e,o,s,i.primary,i.primary.type);i.markers.push(a),a.parent=i}}}function Wr(e){for(var t=0;t<e.length;t++)!function(t){var n=e[t],i=[n.primary.doc];Xi(n.primary.doc,function(e){return i.push(e)});for(var r=0;r<n.markers.length;r++){var o=n.markers[r];-1==d(i,o.doc)&&(o.parent=null,n.markers.splice(r--,1))}}(t)}function Xr(e){var t=this;if(Qr(t),!Te(t,e)&&!Ft(t.display,e)){Pe(e),cs&&(Ma=+new Date);var n=wn(t,e,!0),i=e.dataTransfer.files;if(n&&!t.isReadOnly())if(i&&i.length&&window.FileReader&&window.File)for(var r=i.length,o=Array(r),s=0,a=0;a<r;++a)!function(e,i){if(!t.options.allowDropFileTypes||-1!=d(t.options.allowDropFileTypes,e.type)){var a=new FileReader;a.onload=di(t,function(){var e=a.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(e)&&(e=""),o[i]=e,++s==r){var l={from:n=B(t.doc,n),to:n,text:t.doc.splitLines(o.join(t.doc.lineSeparator())),origin:"paste"};Ar(t.doc,l),vr(t.doc,Fi(n,ji(l)))}}),a.readAsText(e)}}(i[a],a);else{if(t.state.draggingText&&t.doc.sel.contains(n)>-1)return t.state.draggingText(e),void setTimeout(function(){return t.display.input.focus()},20);try{var l=e.dataTransfer.getData("Text");if(l){var c;if(t.state.draggingText&&!t.state.draggingText.copy&&(c=t.listSelections()),br(t.doc,Fi(n,n)),c)for(var u=0;u<c.length;++u)Or(t.doc,"",c[u].anchor,c[u].head,"drag");t.replaceSelection(l,"around","paste"),t.display.input.focus()}}catch(e){}}}}function Yr(e,t){if(cs&&(!e.state.draggingText||+new Date-Ma<100))Fe(t);else if(!Te(e,t)&&!Ft(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setDragImage&&!ms)){var n=i("img",null,null,"position: fixed; left: 0; top: 0;");n.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",fs&&(n.width=n.height=1,e.display.wrapper.appendChild(n),n._top=n.offsetTop),t.dataTransfer.setDragImage(n,0,0),fs&&n.parentNode.removeChild(n)}}function Kr(e,t){var r=wn(e,t);if(r){var o=document.createDocumentFragment();An(e,r,o),e.display.dragCursor||(e.display.dragCursor=i("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),e.display.lineSpace.insertBefore(e.display.dragCursor,e.display.cursorDiv)),n(e.display.dragCursor,o)}}function Qr(e){e.display.dragCursor&&(e.display.lineSpace.removeChild(e.display.dragCursor),e.display.dragCursor=null)}function Zr(e){if(document.getElementsByClassName)for(var t=document.getElementsByClassName("CodeMirror"),n=0;n<t.length;n++){var i=t[n].CodeMirror;i&&e(i)}}function Jr(){Aa||(eo(),Aa=!0)}function eo(){var e;Gs(window,"resize",function(){null==e&&(e=setTimeout(function(){e=null,Zr(to)},100))}),Gs(window,"blur",function(){return Zr(On)})}function to(e){var t=e.display;t.lastWrapHeight==t.wrapper.clientHeight&&t.lastWrapWidth==t.wrapper.clientWidth||(t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,t.scrollbarsClipped=!1,e.setSize())}function no(e){var t=e.split(/-(?!$)/);e=t[t.length-1];for(var n,i,r,o,s=0;s<t.length-1;s++){var a=t[s];if(/^(cmd|meta|m)$/i.test(a))o=!0;else if(/^a(lt)?$/i.test(a))n=!0;else if(/^(c|ctrl|control)$/i.test(a))i=!0;else{if(!/^s(hift)?$/i.test(a))throw new Error("Unrecognized modifier name: "+a);r=!0}}return n&&(e="Alt-"+e),i&&(e="Ctrl-"+e),o&&(e="Cmd-"+e),r&&(e="Shift-"+e),e}function io(e){var t={};for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];if(/^(name|fallthrough|(de|at)tach)$/.test(n))continue;if("..."==i){delete e[n];continue}for(var r=g(n.split(" "),no),o=0;o<r.length;o++){var s=void 0,a=void 0;o==r.length-1?(a=r.join(" "),s=i):(a=r.slice(0,o+1).join(" "),s="...");var l=t[a];if(l){if(l!=s)throw new Error("Inconsistent bindings for "+a)}else t[a]=s}delete e[n]}for(var c in t)e[c]=t[c];return e}function ro(e,t,n,i){var r=(t=lo(t)).call?t.call(e,i):t[e];if(!1===r)return"nothing";if("..."===r)return"multi";if(null!=r&&n(r))return"handled";if(t.fallthrough){if("[object Array]"!=Object.prototype.toString.call(t.fallthrough))return ro(e,t.fallthrough,n,i);for(var o=0;o<t.fallthrough.length;o++){var s=ro(e,t.fallthrough[o],n,i);if(s)return s}}}function oo(e){var t="string"==typeof e?e:Ea[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t}function so(e,t,n){var i=e;return t.altKey&&"Alt"!=i&&(e="Alt-"+e),(Ds?t.metaKey:t.ctrlKey)&&"Ctrl"!=i&&(e="Ctrl-"+e),(Ds?t.ctrlKey:t.metaKey)&&"Cmd"!=i&&(e="Cmd-"+e),!n&&t.shiftKey&&"Shift"!=i&&(e="Shift-"+e),e}function ao(e,t){if(fs&&34==e.keyCode&&e.char)return!1;var n=Ea[e.keyCode];return null!=n&&!e.altGraphKey&&so(n,e,t)}function lo(e){return"string"==typeof e?ka[e]:e}function co(e,t){for(var n=e.doc.sel.ranges,i=[],r=0;r<n.length;r++){for(var o=t(n[r]);i.length&&N(o.from,m(i).to)<=0;){var s=i.pop();if(N(s.from,o.from)<0){o.from=s.from;break}}i.push(o)}hi(e,function(){for(var t=i.length-1;t>=0;t--)Or(e.doc,"",i[t].from,i[t].to,"+delete");Un(e)})}function uo(e,t){var n=M(e.doc,t),i=he(n);return i!=n&&(t=T(i)),De(!0,e,i,t,1)}function ho(e,t){var n=M(e.doc,t),i=de(n);return i!=n&&(t=T(i)),De(!0,e,n,t,-1)}function po(e,t){var n=uo(e,t.line),i=M(e.doc,n.line),r=Se(i,e.doc.direction);if(!r||0==r[0].level){var o=Math.max(0,i.text.search(/\S/)),s=t.line==n.line&&t.ch<=o&&t.ch;return P(n.line,s?0:o,n.sticky)}return n}function fo(e,t,n){if("string"==typeof t&&!(t=Oa[t]))return!1;e.display.input.ensurePolled();var i=e.display.shift,r=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),n&&(e.display.shift=!1),r=t(e)!=Os}finally{e.display.shift=i,e.state.suppressEdits=!1}return r}function mo(e,t,n){for(var i=0;i<e.state.keyMaps.length;i++){var r=ro(t,e.state.keyMaps[i],n,e);if(r)return r}return e.options.extraKeys&&ro(t,e.options.extraKeys,n,e)||ro(t,e.options.keyMap,n,e)}function go(e,t,n,i){var r=e.state.keySeq;if(r){if(oo(t))return"handled";Pa.set(50,function(){e.state.keySeq==r&&(e.state.keySeq=null,e.display.input.reset())}),t=r+" "+t}var o=mo(e,t,i);return"multi"==o&&(e.state.keySeq=t),"handled"==o&&St(e,"keyHandled",e,t,n),"handled"!=o&&"multi"!=o||(Pe(n),In(e)),r&&!o&&/\'$/.test(t)?(Pe(n),!0):!!o}function vo(e,t){var n=ao(t,!0);return!!n&&(t.shiftKey&&!e.state.keySeq?go(e,"Shift-"+n,t,function(t){return fo(e,t,!0)})||go(e,n,t,function(t){if("string"==typeof t?/^go[A-Z]/.test(t):t.motion)return fo(e,t)}):go(e,n,t,function(t){return fo(e,t)}))}function yo(e,t,n){return go(e,"'"+n+"'",t,function(t){return fo(e,t,!0)})}function bo(e){var t=this;if(t.curOp.focus=s(),!Te(t,e)){cs&&us<11&&27==e.keyCode&&(e.returnValue=!1);var n=e.keyCode;t.display.shift=16==n||e.shiftKey;var i=vo(t,e);fs&&(Na=i?n:null,!i&&88==n&&!Ks&&(qs?e.metaKey:e.ctrlKey)&&t.replaceSelection("",null,"cut")),18!=n||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||xo(t)}}function xo(e){function t(e){18!=e.keyCode&&e.altKey||(As(n,"CodeMirror-crosshair"),Ee(document,"keyup",t),Ee(document,"mouseover",t))}var n=e.display.lineDiv;a(n,"CodeMirror-crosshair"),Gs(document,"keyup",t),Gs(document,"mouseover",t)}function qo(e){16==e.keyCode&&(this.doc.sel.shift=!1),Te(this,e)}function Co(e){var t=this;if(!(Ft(t.display,e)||Te(t,e)||e.ctrlKey&&!e.altKey||qs&&e.metaKey)){var n=e.keyCode,i=e.charCode;if(fs&&n==Na)return Na=null,void Pe(e);if(!fs||e.which&&!(e.which<10)||!vo(t,e)){var r=String.fromCharCode(null==i?n:i);"\b"!=r&&(yo(t,e,r)||t.display.input.onKeyPress(e))}}}function So(e,t){var n=+new Date;return ja&&ja.compare(n,e,t)?(Fa=ja=null,"triple"):Fa&&Fa.compare(n,e,t)?(ja=new Ra(n,e,t),Fa=null,"double"):(Fa=new Ra(n,e,t),ja=null,"single")}function wo(e){var t=this,n=t.display;if(!(Te(t,e)||n.activeTouch&&n.input.supportsTouch()))if(n.input.ensurePolled(),n.shift=e.shiftKey,Ft(n,e))hs||(n.scroller.draggable=!1,setTimeout(function(){return n.scroller.draggable=!0},100));else if(!Lo(t,e)){var i=wn(t,e),r=Ve(e),o=i?So(i,r):"single";window.focus(),1==r&&t.state.selectingText&&t.state.selectingText(e),i&&_o(t,r,i,o,e)||(1==r?i?Mo(t,i,o,e):je(e)==n.scroller&&Pe(e):2==r?(i&&dr(t.doc,i),setTimeout(function(){return n.input.focus()},20)):3==r&&(Ms?ko(t,e):Ln(t)))}}function _o(e,t,n,i,r){var o="Click";return"double"==i?o="Double"+o:"triple"==i&&(o="Triple"+o),o=(1==t?"Left":2==t?"Middle":"Right")+o,go(e,so(o,r),r,function(t){if("string"==typeof t&&(t=Oa[t]),!t)return!1;var i=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),i=t(e,n)!=Os}finally{e.state.suppressEdits=!1}return i})}function Do(e,t,n){var i=e.getOption("configureMouse"),r=i?i(e,t,n):{};if(null==r.unit){var o=Cs?n.shiftKey&&n.metaKey:n.altKey;r.unit=o?"rectangle":"single"==t?"char":"double"==t?"word":"line"}return(null==r.extend||e.doc.extend)&&(r.extend=e.doc.extend||n.shiftKey),null==r.addNew&&(r.addNew=qs?n.metaKey:n.ctrlKey),null==r.moveOnDrag&&(r.moveOnDrag=!(qs?n.altKey:n.ctrlKey)),r}function Mo(e,t,n,i){cs?setTimeout(c(Tn,e),0):e.curOp.focus=s();var r,o=Do(e,n,i),a=e.doc.sel;e.options.dragDrop&&Ws&&!e.isReadOnly()&&"single"==n&&(r=a.contains(t))>-1&&(N((r=a.ranges[r]).from(),t)<0||t.xRel>0)&&(N(r.to(),t)>0||t.xRel<0)?Ao(e,i,t,o):Io(e,i,t,o)}function Ao(e,t,n,i){var r=e.display,o=!1,s=di(e,function(t){hs&&(r.scroller.draggable=!1),e.state.draggingText=!1,Ee(document,"mouseup",s),Ee(document,"mousemove",a),Ee(r.scroller,"dragstart",l),Ee(r.scroller,"drop",s),o||(Pe(t),i.addNew||dr(e.doc,n,null,null,i.extend),hs||cs&&9==us?setTimeout(function(){document.body.focus(),r.input.focus()},20):r.input.focus())}),a=function(e){o=o||Math.abs(t.clientX-e.clientX)+Math.abs(t.clientY-e.clientY)>=10},l=function(){return o=!0};hs&&(r.scroller.draggable=!0),e.state.draggingText=s,s.copy=!i.moveOnDrag,r.scroller.dragDrop&&r.scroller.dragDrop(),Gs(document,"mouseup",s),Gs(document,"mousemove",a),Gs(r.scroller,"dragstart",l),Gs(r.scroller,"drop",s),Ln(e),setTimeout(function(){return r.input.focus()},20)}function Eo(e,t,n){if("char"==n)return new xa(t,t);if("word"==n)return e.findWordAt(t);if("line"==n)return new xa(P(t.line,0),B(e.doc,P(t.line+1,0)));var i=n(e,t);return new xa(i.from,i.to)}function Io(e,t,n,i){function r(t){if(0!=N(v,t))if(v=t,"rectangle"==i.unit){for(var r=[],o=e.options.tabSize,s=h(M(c,n.line).text,n.ch,o),a=h(M(c,t.line).text,t.ch,o),l=Math.min(s,a),m=Math.max(s,a),g=Math.min(n.line,t.line),y=Math.min(e.lastLine(),Math.max(n.line,t.line));g<=y;g++){var b=M(c,g).text,x=p(b,l,o);l==m?r.push(new xa(P(g,x),P(g,x))):b.length>x&&r.push(new xa(P(g,x),P(g,p(b,m,o))))}r.length||r.push(new xa(n,n)),yr(c,Ri(f.ranges.slice(0,d).concat(r),d),{origin:"*mouse",scroll:!1}),e.scrollIntoView(t)}else{var q,C=u,S=Eo(e,t,i.unit),w=C.anchor;N(S.anchor,w)>0?(q=S.head,w=V(C.from(),S.anchor)):(q=S.anchor,w=j(C.to(),S.head));var _=f.ranges.slice(0);_[d]=new xa(B(c,w),q),yr(c,Ri(_,d),Ns)}}function o(t){var n=++b,a=wn(e,t,!0,"rectangle"==i.unit);if(a)if(0!=N(a,v)){e.curOp.focus=s(),r(a);var u=Rn(l,c);(a.line>=u.to||a.line<u.from)&&setTimeout(di(e,function(){b==n&&o(t)}),150)}else{var h=t.clientY<y.top?-20:t.clientY>y.bottom?20:0;h&&setTimeout(di(e,function(){b==n&&(l.scroller.scrollTop+=h,o(t))}),50)}}function a(t){e.state.selectingText=!1,b=1/0,Pe(t),l.input.focus(),Ee(document,"mousemove",x),Ee(document,"mouseup",q),c.history.lastSelOrigin=null}var l=e.display,c=e.doc;Pe(t);var u,d,f=c.sel,m=f.ranges;if(i.addNew&&!i.extend?(d=c.sel.contains(n),u=d>-1?m[d]:new xa(n,n)):(u=c.sel.primary(),d=c.sel.primIndex),"rectangle"==i.unit)i.addNew||(u=new xa(n,n)),n=wn(e,t,!0,!0),d=-1;else{var g=Eo(e,n,i.unit);u=i.extend?hr(u,g.anchor,g.head,i.extend):g}i.addNew?-1==d?(d=m.length,yr(c,Ri(m.concat([u]),d),{scroll:!1,origin:"*mouse"})):m.length>1&&m[d].empty()&&"char"==i.unit&&!i.extend?(yr(c,Ri(m.slice(0,d).concat(m.slice(d+1)),0),{scroll:!1,origin:"*mouse"}),f=c.sel):fr(c,d,u,Ns):(d=0,yr(c,new ba([u],0),Ns),f=c.sel);var v=n,y=l.wrapper.getBoundingClientRect(),b=0,x=di(e,function(e){Ve(e)?o(e):a(e)}),q=di(e,a);e.state.selectingText=q,Gs(document,"mousemove",x),Gs(document,"mouseup",q)}function To(e,t,n,i){var r,o;try{r=t.clientX,o=t.clientY}catch(t){return!1}if(r>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;i&&Pe(t);var s=e.display,a=s.lineDiv.getBoundingClientRect();if(o>a.bottom||!ke(e,n))return Re(t);o-=a.top-s.viewOffset;for(var l=0;l<e.options.gutters.length;++l){var c=s.gutters.childNodes[l];if(c&&c.getBoundingClientRect().right>=r)return Ie(e,n,e,L(e.doc,o),e.options.gutters[l],t),Re(t)}}function Lo(e,t){return To(e,t,"gutterClick",!0)}function ko(e,t){Ft(e.display,t)||Oo(e,t)||Te(e,t,"contextmenu")||e.display.input.onContextMenu(t)}function Oo(e,t){return!!ke(e,"gutterContextMenu")&&To(e,t,"gutterContextMenu",!1)}function Po(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),on(e)}function No(e){Li(e),mi(e),Fn(e)}function Ro(e,t,n){if(!t!=!(n&&n!=Va)){var i=e.display.dragFunctions,r=t?Gs:Ee;r(e.display.scroller,"dragstart",i.start),r(e.display.scroller,"dragenter",i.enter),r(e.display.scroller,"dragover",i.over),r(e.display.scroller,"dragleave",i.leave),r(e.display.scroller,"drop",i.drop)}}function Fo(e){e.options.lineWrapping?(a(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth="",e.display.sizerWidth=null):(As(e.display.wrapper,"CodeMirror-wrap"),xe(e)),Sn(e),mi(e),on(e),setTimeout(function(){return ei(e)},100)}function jo(e,t){var n=this;if(!(this instanceof jo))return new jo(e,t);this.options=t=t?u(t):{},u(Ha,t,!1),ki(t);var i=t.value;"string"==typeof i&&(i=new Da(i,t.mode,null,t.lineSeparator,t.direction)),this.doc=i;var r=new jo.inputStyles[t.inputStyle](this),o=this.display=new D(e,i,r);o.wrapper.CodeMirror=this,Li(this),Po(this),t.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),ni(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new Is,keySeq:null,specialChars:null},t.autofocus&&!xs&&o.input.focus(),cs&&us<11&&setTimeout(function(){return n.display.input.reset(!0)},20),Vo(this),Jr(),ii(this),this.curOp.forceUpdate=!0,Yi(this,i),t.autofocus&&!xs||this.hasFocus()?setTimeout(c(kn,this),20):On(this);for(var s in Ba)Ba.hasOwnProperty(s)&&Ba[s](n,t[s],Va);jn(this),t.finishInit&&t.finishInit(this);for(var a=0;a<za.length;++a)za[a](n);ri(this),hs&&t.lineWrapping&&"optimizelegibility"==getComputedStyle(o.lineDiv).textRendering&&(o.lineDiv.style.textRendering="auto")}function Vo(e){function t(){r.activeTouch&&(o=setTimeout(function(){return r.activeTouch=null},1e3),(s=r.activeTouch).end=+new Date)}function n(e){if(1!=e.touches.length)return!1;var t=e.touches[0];return t.radiusX<=1&&t.radiusY<=1}function i(e,t){if(null==t.left)return!0;var n=t.left-e.left,i=t.top-e.top;return n*n+i*i>400}var r=e.display;Gs(r.scroller,"mousedown",di(e,wo)),cs&&us<11?Gs(r.scroller,"dblclick",di(e,function(t){if(!Te(e,t)){var n=wn(e,t);if(n&&!Lo(e,t)&&!Ft(e.display,t)){Pe(t);var i=e.findWordAt(n);dr(e.doc,i.anchor,i.head)}}})):Gs(r.scroller,"dblclick",function(t){return Te(e,t)||Pe(t)}),Ms||Gs(r.scroller,"contextmenu",function(t){return ko(e,t)});var o,s={end:0};Gs(r.scroller,"touchstart",function(t){if(!Te(e,t)&&!n(t)){r.input.ensurePolled(),clearTimeout(o);var i=+new Date;r.activeTouch={start:i,moved:!1,prev:i-s.end<=300?s:null},1==t.touches.length&&(r.activeTouch.left=t.touches[0].pageX,r.activeTouch.top=t.touches[0].pageY)}}),Gs(r.scroller,"touchmove",function(){r.activeTouch&&(r.activeTouch.moved=!0)}),Gs(r.scroller,"touchend",function(n){var o=r.activeTouch;if(o&&!Ft(r,n)&&null!=o.left&&!o.moved&&new Date-o.start<300){var s,a=e.coordsChar(r.activeTouch,"page");s=!o.prev||i(o,o.prev)?new xa(a,a):!o.prev.prev||i(o,o.prev.prev)?e.findWordAt(a):new xa(P(a.line,0),B(e.doc,P(a.line+1,0))),e.setSelection(s.anchor,s.head),e.focus(),Pe(n)}t()}),Gs(r.scroller,"touchcancel",t),Gs(r.scroller,"scroll",function(){r.scroller.clientHeight&&(Kn(e,r.scroller.scrollTop),Zn(e,r.scroller.scrollLeft,!0),Ie(e,"scroll",e))}),Gs(r.scroller,"mousewheel",function(t){return Ni(e,t)}),Gs(r.scroller,"DOMMouseScroll",function(t){return Ni(e,t)}),Gs(r.wrapper,"scroll",function(){return r.wrapper.scrollTop=r.wrapper.scrollLeft=0}),r.dragFunctions={enter:function(t){Te(e,t)||Fe(t)},over:function(t){Te(e,t)||(Kr(e,t),Fe(t))},start:function(t){return Yr(e,t)},drop:di(e,Xr),leave:function(t){Te(e,t)||Qr(e)}};var a=r.input.getField();Gs(a,"keyup",function(t){return qo.call(e,t)}),Gs(a,"keydown",di(e,bo)),Gs(a,"keypress",di(e,Co)),Gs(a,"focus",function(t){return kn(e,t)}),Gs(a,"blur",function(t){return On(e,t)})}function Ho(e,t,n,i){var r,o=e.doc;null==n&&(n="add"),"smart"==n&&(o.mode.indent?r=Je(e,t).state:n="prev");var s=e.options.tabSize,a=M(o,t),l=h(a.text,null,s);a.stateAfter&&(a.stateAfter=null);var c,u=a.text.match(/^\s*/)[0];if(i||/\S/.test(a.text)){if("smart"==n&&((c=o.mode.indent(r,a.text.slice(u.length),a.text))==Os||c>150)){if(!i)return;n="prev"}}else c=0,n="not";"prev"==n?c=t>o.first?h(M(o,t-1).text,null,s):0:"add"==n?c=l+e.options.indentUnit:"subtract"==n?c=l-e.options.indentUnit:"number"==typeof n&&(c=l+n),c=Math.max(0,c);var d="",p=0;if(e.options.indentWithTabs)for(var m=Math.floor(c/s);m;--m)p+=s,d+="\t";if(p<c&&(d+=f(c-p)),d!=u)return Or(o,d,P(t,0),P(t,u.length),"+input"),a.stateAfter=null,!0;for(var g=0;g<o.sel.ranges.length;g++){var v=o.sel.ranges[g];if(v.head.line==t&&v.head.ch<u.length){var y=P(t,u.length);fr(o,g,new xa(y,y));break}}}function Bo(e){$a=e}function zo(e,t,n,i,r){var o=e.doc;e.display.shift=!1,i||(i=o.sel);var s=e.state.pasteIncoming||"paste"==r,a=Xs(t),l=null;if(s&&i.ranges.length>1)if($a&&$a.text.join("\n")==t){if(i.ranges.length%$a.text.length==0){l=[];for(var c=0;c<$a.text.length;c++)l.push(o.splitLines($a.text[c]))}}else a.length==i.ranges.length&&e.options.pasteLinesPerSelection&&(l=g(a,function(e){return[e]}));for(var u,h=i.ranges.length-1;h>=0;h--){var d=i.ranges[h],p=d.from(),f=d.to();d.empty()&&(n&&n>0?p=P(p.line,p.ch-n):e.state.overwrite&&!s?f=P(f.line,Math.min(M(o,f.line).text.length,f.ch+m(a).length)):$a&&$a.lineWise&&$a.text.join("\n")==t&&(p=f=P(p.line,0))),u=e.curOp.updateInput;var v={from:p,to:f,text:l?l[h%l.length]:a,origin:r||(s?"paste":e.state.cutIncoming?"cut":"+input")};Ar(e.doc,v),St(e,"inputRead",e,v)}t&&!s&&Uo(e,t),Un(e),e.curOp.updateInput=u,e.curOp.typing=!0,e.state.pasteIncoming=e.state.cutIncoming=!1}function $o(e,t){var n=e.clipboardData&&e.clipboardData.getData("Text");if(n)return e.preventDefault(),t.isReadOnly()||t.options.disableInput||hi(t,function(){return zo(t,n,0,null,"paste")}),!0}function Uo(e,t){if(e.options.electricChars&&e.options.smartIndent)for(var n=e.doc.sel,i=n.ranges.length-1;i>=0;i--){var r=n.ranges[i];if(!(r.head.ch>100||i&&n.ranges[i-1].head.line==r.head.line)){var o=e.getModeAt(r.head),s=!1;if(o.electricChars){for(var a=0;a<o.electricChars.length;a++)if(t.indexOf(o.electricChars.charAt(a))>-1){s=Ho(e,r.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(M(e.doc,r.head.line).text.slice(0,r.head.ch))&&(s=Ho(e,r.head.line,"smart"));s&&St(e,"electricInput",e,r.head.line)}}}function Go(e){for(var t=[],n=[],i=0;i<e.doc.sel.ranges.length;i++){var r=e.doc.sel.ranges[i].head.line,o={anchor:P(r,0),head:P(r+1,0)};n.push(o),t.push(e.getRange(o.anchor,o.head))}return{text:t,ranges:n}}function Wo(e,t){e.setAttribute("autocorrect","off"),e.setAttribute("autocapitalize","off"),e.setAttribute("spellcheck",!!t)}function Xo(){var e=i("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),t=i("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return hs?e.style.width="1000px":e.setAttribute("wrap","off"),ys&&(e.style.border="1px solid black"),Wo(e),t}function Yo(e,t,n,i,r){function o(){var i=t.line+n;return!(i<e.first||i>=e.first+e.size)&&(t=new P(i,t.ch,t.sticky),c=M(e,i))}function s(i){var s;if(null==(s=r?Me(e.cm,c,t,n):_e(c,t,n))){if(i||!o())return!1;t=De(r,e.cm,c,t.line,n)}else t=s;return!0}var a=t,l=n,c=M(e,t.line);if("char"==i)s();else if("column"==i)s(!0);else if("word"==i||"group"==i)for(var u=null,h="group"==i,d=e.cm&&e.cm.getHelper(t,"wordChars"),p=!0;!(n<0)||s(!p);p=!1){var f=c.text.charAt(t.ch)||"\n",m=q(f,d)?"w":h&&"\n"==f?"n":!h||/\s/.test(f)?null:"p";if(!h||p||m||(m="s"),u&&u!=m){n<0&&(n=1,s(),t.sticky="after");break}if(m&&(u=m),n>0&&!s(!p))break}var g=wr(e,t,a,l,!0);return R(a,g)&&(g.hitSide=!0),g}function Ko(e,t,n,i){var r,o=e.doc,s=t.left;if("page"==i){var a=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),l=Math.max(a-.5*yn(e.display),3);r=(n>0?t.bottom:t.top)+n*l}else"line"==i&&(r=n>0?t.bottom+3:t.top-3);for(var c;(c=fn(e,s,r)).outside;){if(n<0?r<=0:r>=o.height){c.hitSide=!0;break}r+=5*n}return c}function Qo(e,t){var n=Yt(e,t.line);if(!n||n.hidden)return null;var i=M(e.doc,t.line),r=Gt(n,i,t.line),o=Se(i,e.doc.direction),s="left";o&&(s=Ce(o,t.ch)%2?"right":"left");var a=Zt(r.map,t.ch,s);return a.offset="right"==a.collapse?a.end:a.start,a}function Zo(e){for(var t=e;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return!0;return!1}function Jo(e,t){return t&&(e.bad=!0),e}function es(e,t,n,i,r){function o(e){return function(t){return t.id==e}}function s(){u&&(c+=h,u=!1)}function a(e){e&&(s(),c+=e)}function l(t){if(1==t.nodeType){var n=t.getAttribute("cm-text");if(null!=n)return void a(n||t.textContent.replace(/\u200b/g,""));var c,d=t.getAttribute("cm-marker");if(d){var p=e.findMarks(P(i,0),P(r+1,0),o(+d));return void(p.length&&(c=p[0].find())&&a(A(e.doc,c.from,c.to).join(h)))}if("false"==t.getAttribute("contenteditable"))return;var f=/^(pre|div|p)$/i.test(t.nodeName);f&&s();for(var m=0;m<t.childNodes.length;m++)l(t.childNodes[m]);f&&(u=!0)}else 3==t.nodeType&&a(t.nodeValue)}for(var c="",u=!1,h=e.doc.lineSeparator();l(t),t!=n;)t=t.nextSibling;return c}function ts(e,t,n){var i;if(t==e.display.lineDiv){if(!(i=e.display.lineDiv.childNodes[n]))return Jo(e.clipPos(P(e.display.viewTo-1)),!0);t=null,n=0}else for(i=t;;i=i.parentNode){if(!i||i==e.display.lineDiv)return null;if(i.parentNode&&i.parentNode==e.display.lineDiv)break}for(var r=0;r<e.display.view.length;r++){var o=e.display.view[r];if(o.node==i)return ns(o,t,n)}}function ns(e,t,n){function i(t,n,i){for(var r=-1;r<(h?h.length:0);r++)for(var o=r<0?u.map:h[r],s=0;s<o.length;s+=3){var a=o[s+2];if(a==t||a==n){var l=T(r<0?e.line:e.rest[r]),c=o[s]+i;return(i<0||a!=t)&&(c=o[s+(i?1:0)]),P(l,c)}}}var r=e.text.firstChild,s=!1;if(!t||!o(r,t))return Jo(P(T(e.line),0),!0);if(t==r&&(s=!0,t=r.childNodes[n],n=0,!t)){var a=e.rest?m(e.rest):e.line;return Jo(P(T(a),a.text.length),s)}var l=3==t.nodeType?t:null,c=t;for(l||1!=t.childNodes.length||3!=t.firstChild.nodeType||(l=t.firstChild,n&&(n=l.nodeValue.length));c.parentNode!=r;)c=c.parentNode;var u=e.measure,h=u.maps,d=i(l,c,n);if(d)return Jo(d,s);for(var p=c.nextSibling,f=l?l.nodeValue.length-n:0;p;p=p.nextSibling){if(d=i(p,p.firstChild,0))return Jo(P(d.line,d.ch-f),s);f+=p.textContent.length}for(var g=c.previousSibling,v=n;g;g=g.previousSibling){if(d=i(g,g.firstChild,-1))return Jo(P(d.line,d.ch+v),s);v+=g.textContent.length}}var is=navigator.userAgent,rs=navigator.platform,os=/gecko\/\d/i.test(is),ss=/MSIE \d/.test(is),as=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(is),ls=/Edge\/(\d+)/.exec(is),cs=ss||as||ls,us=cs&&(ss?document.documentMode||6:+(ls||as)[1]),hs=!ls&&/WebKit\//.test(is),ds=hs&&/Qt\/\d+\.\d+/.test(is),ps=!ls&&/Chrome\//.test(is),fs=/Opera\//.test(is),ms=/Apple Computer/.test(navigator.vendor),gs=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(is),vs=/PhantomJS/.test(is),ys=!ls&&/AppleWebKit/.test(is)&&/Mobile\/\w+/.test(is),bs=/Android/.test(is),xs=ys||bs||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(is),qs=ys||/Mac/.test(rs),Cs=/\bCrOS\b/.test(is),Ss=/win/i.test(rs),ws=fs&&is.match(/Version\/(\d*\.\d*)/);ws&&(ws=Number(ws[1])),ws&&ws>=15&&(fs=!1,hs=!0);var _s,Ds=qs&&(ds||fs&&(null==ws||ws<12.11)),Ms=os||cs&&us>=9,As=function(t,n){var i=t.className,r=e(n).exec(i);if(r){var o=i.slice(r.index+r[0].length);t.className=i.slice(0,r.index)+(o?r[1]+o:"")}};_s=document.createRange?function(e,t,n,i){var r=document.createRange();return r.setEnd(i||e,n),r.setStart(e,t),r}:function(e,t,n){var i=document.body.createTextRange();try{i.moveToElementText(e.parentNode)}catch(e){return i}return i.collapse(!0),i.moveEnd("character",n),i.moveStart("character",t),i};var Es=function(e){e.select()};ys?Es=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:cs&&(Es=function(e){try{e.select()}catch(e){}});var Is=function(){this.id=null};Is.prototype.set=function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)};var Ts,Ls,ks=30,Os={toString:function(){return"CodeMirror.Pass"}},Ps={scroll:!1},Ns={origin:"*mouse"},Rs={origin:"+move"},Fs=[""],js=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,Vs=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,Hs=!1,Bs=!1,zs=null,$s=function(){function e(e){return e<=247?n.charAt(e):1424<=e&&e<=1524?"R":1536<=e&&e<=1785?i.charAt(e-1536):1774<=e&&e<=2220?"r":8192<=e&&e<=8203?"w":8204==e?"b":"L"}function t(e,t,n){this.level=e,this.from=t,this.to=n}var n="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",i="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111",r=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,o=/[stwN]/,s=/[LRr]/,a=/[Lb1n]/,l=/[1n]/;return function(n,i){var c="ltr"==i?"L":"R";if(0==n.length||"ltr"==i&&!r.test(n))return!1;for(var u=n.length,h=[],d=0;d<u;++d)h.push(e(n.charCodeAt(d)));for(var p=0,f=c;p<u;++p){var g=h[p];"m"==g?h[p]=f:f=g}for(var v=0,y=c;v<u;++v){var b=h[v];"1"==b&&"r"==y?h[v]="n":s.test(b)&&(y=b,"r"==b&&(h[v]="R"))}for(var x=1,q=h[0];x<u-1;++x){var C=h[x];"+"==C&&"1"==q&&"1"==h[x+1]?h[x]="1":","!=C||q!=h[x+1]||"1"!=q&&"n"!=q||(h[x]=q),q=C}for(var S=0;S<u;++S){var w=h[S];if(","==w)h[S]="N";else if("%"==w){var _=void 0;for(_=S+1;_<u&&"%"==h[_];++_);for(var D=S&&"!"==h[S-1]||_<u&&"1"==h[_]?"1":"N",M=S;M<_;++M)h[M]=D;S=_-1}}for(var A=0,E=c;A<u;++A){var I=h[A];"L"==E&&"1"==I?h[A]="L":s.test(I)&&(E=I)}for(var T=0;T<u;++T)if(o.test(h[T])){var L=void 0;for(L=T+1;L<u&&o.test(h[L]);++L);for(var k="L"==(T?h[T-1]:c),O=k==("L"==(L<u?h[L]:c))?k?"L":"R":c,P=T;P<L;++P)h[P]=O;T=L-1}for(var N,R=[],F=0;F<u;)if(a.test(h[F])){var j=F;for(++F;F<u&&a.test(h[F]);++F);R.push(new t(0,j,F))}else{var V=F,H=R.length;for(++F;F<u&&"L"!=h[F];++F);for(var B=V;B<F;)if(l.test(h[B])){V<B&&R.splice(H,0,new t(1,V,B));var z=B;for(++B;B<F&&l.test(h[B]);++B);R.splice(H,0,new t(2,z,B)),V=B}else++B;V<F&&R.splice(H,0,new t(1,V,F))}return 1==R[0].level&&(N=n.match(/^\s+/))&&(R[0].from=N[0].length,R.unshift(new t(0,0,N[0].length))),1==m(R).level&&(N=n.match(/\s+$/))&&(m(R).to-=N[0].length,R.push(new t(0,u-N[0].length,u))),"rtl"==i?R.reverse():R}}(),Us=[],Gs=function(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else if(e.attachEvent)e.attachEvent("on"+t,n);else{var i=e._handlers||(e._handlers={});i[t]=(i[t]||Us).concat(n)}},Ws=function(){if(cs&&us<9)return!1;var e=i("div");return"draggable"in e||"dragDrop"in e}(),Xs=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,n=[],i=e.length;t<=i;){var r=e.indexOf("\n",t);-1==r&&(r=e.length);var o=e.slice(t,"\r"==e.charAt(r-1)?r-1:r),s=o.indexOf("\r");-1!=s?(n.push(o.slice(0,s)),t+=s+1):(n.push(o),t=r+1)}return n}:function(e){return e.split(/\r\n?|\n/)},Ys=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(e){return!1}}:function(e){var t;try{t=e.ownerDocument.selection.createRange()}catch(e){}return!(!t||t.parentElement()!=e)&&0!=t.compareEndPoints("StartToEnd",t)},Ks=function(){var e=i("div");return"oncopy"in e||(e.setAttribute("oncopy","return;"),"function"==typeof e.oncopy)}(),Qs=null,Zs={},Js={},ea={},ta=function(e,t,n){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=n};ta.prototype.eol=function(){return this.pos>=this.string.length},ta.prototype.sol=function(){return this.pos==this.lineStart},ta.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},ta.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},ta.prototype.eat=function(e){var t=this.string.charAt(this.pos);if("string"==typeof e?t==e:t&&(e.test?e.test(t):e(t)))return++this.pos,t},ta.prototype.eatWhile=function(e){for(var t=this.pos;this.eat(e););return this.pos>t},ta.prototype.eatSpace=function(){for(var e=this,t=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++e.pos;return this.pos>t},ta.prototype.skipToEnd=function(){this.pos=this.string.length},ta.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},ta.prototype.backUp=function(e){this.pos-=e},ta.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=h(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?h(this.string,this.lineStart,this.tabSize):0)},ta.prototype.indentation=function(){return h(this.string,null,this.tabSize)-(this.lineStart?h(this.string,this.lineStart,this.tabSize):0)},ta.prototype.match=function(e,t,n){if("string"!=typeof e){var i=this.string.slice(this.pos).match(e);return i&&i.index>0?null:(i&&!1!==t&&(this.pos+=i[0].length),i)}var r=function(e){return n?e.toLowerCase():e};if(r(this.string.substr(this.pos,e.length))==r(e))return!1!==t&&(this.pos+=e.length),!0},ta.prototype.current=function(){return this.string.slice(this.start,this.pos)},ta.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}},ta.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)};var na=function(e,t){this.state=e,this.lookAhead=t},ia=function(e,t,n,i){this.state=t,this.doc=e,this.line=n,this.maxLookAhead=i||0};ia.prototype.lookAhead=function(e){var t=this.doc.getLine(this.line+e);return null!=t&&e>this.maxLookAhead&&(this.maxLookAhead=e),t},ia.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},ia.fromSaved=function(e,t,n){return t instanceof na?new ia(e,Xe(e.mode,t.state),n,t.lookAhead):new ia(e,Xe(e.mode,t),n)},ia.prototype.save=function(e){var t=!1!==e?Xe(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new na(t,this.maxLookAhead):t};var ra=function(e,t,n){this.start=e.start,this.end=e.pos,this.string=e.current(),this.type=t||null,this.state=n},oa=function(e,t,n){this.text=e,ie(this,t),this.height=n?n(this):1};oa.prototype.lineNo=function(){return T(this)},Oe(oa);var sa,aa={},la={},ca=null,ua=null,ha={left:0,right:0,top:0,bottom:0},da=function(e,t,n){this.cm=n;var r=this.vert=i("div",[i("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),o=this.horiz=i("div",[i("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");e(r),e(o),Gs(r,"scroll",function(){r.clientHeight&&t(r.scrollTop,"vertical")}),Gs(o,"scroll",function(){o.clientWidth&&t(o.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,cs&&us<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};da.prototype.update=function(e){var t=e.scrollWidth>e.clientWidth+1,n=e.scrollHeight>e.clientHeight+1,i=e.nativeBarWidth;if(n){this.vert.style.display="block",this.vert.style.bottom=t?i+"px":"0";var r=e.viewHeight-(t?i:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+r)+"px"}else this.vert.style.display="",this.vert.firstChild.style.height="0";if(t){this.horiz.style.display="block",this.horiz.style.right=n?i+"px":"0",this.horiz.style.left=e.barLeft+"px";var o=e.viewWidth-e.barLeft-(n?i:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+o)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&e.clientHeight>0&&(0==i&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:n?i:0,bottom:t?i:0}},da.prototype.setScrollLeft=function(e){this.horiz.scrollLeft!=e&&(this.horiz.scrollLeft=e),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},da.prototype.setScrollTop=function(e){this.vert.scrollTop!=e&&(this.vert.scrollTop=e),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},da.prototype.zeroWidthHack=function(){var e=qs&&!gs?"12px":"18px";this.horiz.style.height=this.vert.style.width=e,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new Is,this.disableVert=new Is},da.prototype.enableZeroWidthBar=function(e,t,n){function i(){var r=e.getBoundingClientRect();("vert"==n?document.elementFromPoint(r.right-1,(r.top+r.bottom)/2):document.elementFromPoint((r.right+r.left)/2,r.bottom-1))!=e?e.style.pointerEvents="none":t.set(1e3,i)}e.style.pointerEvents="auto",t.set(1e3,i)},da.prototype.clear=function(){var e=this.horiz.parentNode;e.removeChild(this.horiz),e.removeChild(this.vert)};var pa=function(){};pa.prototype.update=function(){return{bottom:0,right:0}},pa.prototype.setScrollLeft=function(){},pa.prototype.setScrollTop=function(){},pa.prototype.clear=function(){};var fa={native:da,null:pa},ma=0,ga=function(e,t,n){var i=e.display;this.viewport=t,this.visible=Rn(i,e.doc,t),this.editorIsHidden=!i.wrapper.offsetWidth,this.wrapperHeight=i.wrapper.clientHeight,this.wrapperWidth=i.wrapper.clientWidth,this.oldDisplayWidth=zt(e),this.force=n,this.dims=xn(e),this.events=[]};ga.prototype.signal=function(e,t){ke(e,t)&&this.events.push(arguments)},ga.prototype.finish=function(){for(var e=this,t=0;t<this.events.length;t++)Ie.apply(null,e.events[t])};var va=0,ya=null;cs?ya=-.53:os?ya=15:ps?ya=-.7:ms&&(ya=-1/3);var ba=function(e,t){this.ranges=e,this.primIndex=t};ba.prototype.primary=function(){return this.ranges[this.primIndex]},ba.prototype.equals=function(e){var t=this;if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var n=0;n<this.ranges.length;n++){var i=t.ranges[n],r=e.ranges[n];if(!R(i.anchor,r.anchor)||!R(i.head,r.head))return!1}return!0},ba.prototype.deepCopy=function(){for(var e=this,t=[],n=0;n<this.ranges.length;n++)t[n]=new xa(F(e.ranges[n].anchor),F(e.ranges[n].head));return new ba(t,this.primIndex)},ba.prototype.somethingSelected=function(){for(var e=this,t=0;t<this.ranges.length;t++)if(!e.ranges[t].empty())return!0;return!1},ba.prototype.contains=function(e,t){var n=this;t||(t=e);for(var i=0;i<this.ranges.length;i++){var r=n.ranges[i];if(N(t,r.from())>=0&&N(e,r.to())<=0)return i}return-1};var xa=function(e,t){this.anchor=e,this.head=t};xa.prototype.from=function(){return V(this.anchor,this.head)},xa.prototype.to=function(){return j(this.anchor,this.head)},xa.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},jr.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var n=this,i=e,r=e+t;i<r;++i){var o=n.lines[i];n.height-=o.height,ct(o),St(o,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,n){var i=this;this.height+=n,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var r=0;r<t.length;++r)t[r].parent=i},iterN:function(e,t,n){for(var i=this,r=e+t;e<r;++e)if(n(i.lines[e]))return!0}},Vr.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){var n=this;this.size-=t;for(var i=0;i<this.children.length;++i){var r=n.children[i],o=r.chunkSize();if(e<o){var s=Math.min(t,o-e),a=r.height;if(r.removeInner(e,s),n.height-=a-r.height,o==s&&(n.children.splice(i--,1),r.parent=null),0==(t-=s))break;e=0}else e-=o}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof jr))){var l=[];this.collapse(l),this.children=[new jr(l)],this.children[0].parent=this}},collapse:function(e){for(var t=this,n=0;n<this.children.length;++n)t.children[n].collapse(e)},insertInner:function(e,t,n){var i=this;this.size+=t.length,this.height+=n;for(var r=0;r<this.children.length;++r){var o=i.children[r],s=o.chunkSize();if(e<=s){if(o.insertInner(e,t,n),o.lines&&o.lines.length>50){for(var a=o.lines.length%25+25,l=a;l<o.lines.length;){var c=new jr(o.lines.slice(l,l+=25));o.height-=c.height,i.children.splice(++r,0,c),c.parent=i}o.lines=o.lines.slice(0,a),i.maybeSpill()}break}e-=s}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=new Vr(e.children.splice(e.children.length-5,5));if(e.parent){e.size-=t.size,e.height-=t.height;var n=d(e.parent.children,e);e.parent.children.splice(n+1,0,t)}else{var i=new Vr(e.children);i.parent=e,e.children=[i,t],e=i}t.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,n){for(var i=this,r=0;r<this.children.length;++r){var o=i.children[r],s=o.chunkSize();if(e<s){var a=Math.min(t,s-e);if(o.iterN(e,a,n))return!0;if(0==(t-=a))break;e=0}else e-=s}}};var qa=function(e,t,n){var i=this;if(n)for(var r in n)n.hasOwnProperty(r)&&(i[r]=n[r]);this.doc=e,this.node=t};qa.prototype.clear=function(){var e=this,t=this.doc.cm,n=this.line.widgets,i=this.line,r=T(i);if(null!=r&&n){for(var o=0;o<n.length;++o)n[o]==e&&n.splice(o--,1);n.length||(i.widgets=null);var s=Rt(this);I(i,Math.max(0,i.height-s)),t&&(hi(t,function(){Hr(t,i,-s),gi(t,r,"widget")}),St(t,"lineWidgetCleared",t,this,r))}},qa.prototype.changed=function(){var e=this,t=this.height,n=this.doc.cm,i=this.line;this.height=null;var r=Rt(this)-t;r&&(I(i,i.height+r),n&&hi(n,function(){n.curOp.forceUpdate=!0,Hr(n,i,r),St(n,"lineWidgetChanged",n,e,T(i))}))},Oe(qa);var Ca=0,Sa=function(e,t){this.lines=[],this.type=t,this.doc=e,this.id=++Ca};Sa.prototype.clear=function(){var e=this;if(!this.explicitlyCleared){var t=this.doc.cm,n=t&&!t.curOp;if(n&&ii(t),ke(this,"clear")){var i=this.find();i&&St(this,"clear",i.from,i.to)}for(var r=null,o=null,s=0;s<this.lines.length;++s){var a=e.lines[s],l=X(a.markedSpans,e);t&&!e.collapsed?gi(t,T(a),"text"):t&&(null!=l.to&&(o=T(a)),null!=l.from&&(r=T(a))),a.markedSpans=Y(a.markedSpans,l),null==l.from&&e.collapsed&&!ge(e.doc,a)&&t&&I(a,yn(t.display))}if(t&&this.collapsed&&!t.options.lineWrapping)for(var c=0;c<this.lines.length;++c){var u=he(e.lines[c]),h=be(u);h>t.display.maxLineLength&&(t.display.maxLine=u,t.display.maxLineLength=h,t.display.maxLineChanged=!0)}null!=r&&t&&this.collapsed&&mi(t,r,o+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,t&&qr(t.doc)),t&&St(t,"markerCleared",t,this,r,o),n&&ri(t),this.parent&&this.parent.clear()}},Sa.prototype.find=function(e,t){var n=this;null==e&&"bookmark"==this.type&&(e=1);for(var i,r,o=0;o<this.lines.length;++o){var s=n.lines[o],a=X(s.markedSpans,n);if(null!=a.from&&(i=P(t?s:T(s),a.from),-1==e))return i;if(null!=a.to&&(r=P(t?s:T(s),a.to),1==e))return r}return i&&{from:i,to:r}},Sa.prototype.changed=function(){var e=this,t=this.find(-1,!0),n=this,i=this.doc.cm;t&&i&&hi(i,function(){var r=t.line,o=T(t.line),s=Yt(i,o);if(s&&(nn(s),i.curOp.selectionChanged=i.curOp.forceUpdate=!0),i.curOp.updateMaxLine=!0,!ge(n.doc,r)&&null!=n.height){var a=n.height;n.height=null;var l=Rt(n)-a;l&&I(r,r.height+l)}St(i,"markerChanged",i,e)})},Sa.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=d(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},Sa.prototype.detachLine=function(e){if(this.lines.splice(d(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}},Oe(Sa);var wa=function(e,t){var n=this;this.markers=e,this.primary=t;for(var i=0;i<e.length;++i)e[i].parent=n};wa.prototype.clear=function(){var e=this;if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var t=0;t<this.markers.length;++t)e.markers[t].clear();St(this,"clear")}},wa.prototype.find=function(e,t){return this.primary.find(e,t)},Oe(wa);var _a=0,Da=function(e,t,n,i,r){if(!(this instanceof Da))return new Da(e,t,n,i,r);null==n&&(n=0),Vr.call(this,[new jr([new oa("",null)])]),this.first=n,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=n;var o=P(n,0);this.sel=Fi(o),this.history=new Zi(null),this.id=++_a,this.modeOption=t,this.lineSep=i,this.direction="rtl"==r?"rtl":"ltr",this.extend=!1,"string"==typeof e&&(e=this.splitLines(e)),Wi(this,{from:o,to:o,text:e}),yr(this,Fi(o),Ps)};Da.prototype=b(Vr.prototype,{constructor:Da,iter:function(e,t,n){n?this.iterN(e-this.first,t-e,n):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var n=0,i=0;i<t.length;++i)n+=t[i].height;this.insertInner(e-this.first,t,n)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=E(this,this.first,this.first+this.size);return!1===e?t:t.join(e||this.lineSeparator())},setValue:fi(function(e){var t=P(this.first,0),n=this.first+this.size-1;Ar(this,{from:t,to:P(n,M(this,n).text.length),text:this.splitLines(e),origin:"setValue",full:!0},!0),this.cm&&Gn(this.cm,0,0),yr(this,Fi(t),Ps)}),replaceRange:function(e,t,n,i){Or(this,e,t=B(this,t),n=n?B(this,n):t,i)},getRange:function(e,t,n){var i=A(this,B(this,e),B(this,t));return!1===n?i:i.join(n||this.lineSeparator())},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(k(this,e))return M(this,e)},getLineNumber:function(e){return T(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=M(this,e)),he(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return B(this,e)},getCursor:function(e){var t=this.sel.primary();return null==e||"head"==e?t.head:"anchor"==e?t.anchor:"end"==e||"to"==e||!1===e?t.to():t.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:fi(function(e,t,n){mr(this,B(this,"number"==typeof e?P(e,t||0):e),null,n)}),setSelection:fi(function(e,t,n){mr(this,B(this,e),B(this,t||e),n)}),extendSelection:fi(function(e,t,n){dr(this,B(this,e),t&&B(this,t),n)}),extendSelections:fi(function(e,t){pr(this,$(this,e),t)}),extendSelectionsBy:fi(function(e,t){pr(this,$(this,g(this.sel.ranges,e)),t)}),setSelections:fi(function(e,t,n){var i=this;if(e.length){for(var r=[],o=0;o<e.length;o++)r[o]=new xa(B(i,e[o].anchor),B(i,e[o].head));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),yr(this,Ri(r,t),n)}}),addSelection:fi(function(e,t,n){var i=this.sel.ranges.slice(0);i.push(new xa(B(this,e),B(this,t||e))),yr(this,Ri(i,i.length-1),n)}),getSelection:function(e){for(var t,n=this,i=this.sel.ranges,r=0;r<i.length;r++){var o=A(n,i[r].from(),i[r].to());t=t?t.concat(o):o}return!1===e?t:t.join(e||this.lineSeparator())},getSelections:function(e){for(var t=this,n=[],i=this.sel.ranges,r=0;r<i.length;r++){var o=A(t,i[r].from(),i[r].to());!1!==e&&(o=o.join(e||t.lineSeparator())),n[r]=o}return n},replaceSelection:function(e,t,n){for(var i=[],r=0;r<this.sel.ranges.length;r++)i[r]=e;this.replaceSelections(i,t,n||"+input")},replaceSelections:fi(function(e,t,n){for(var i=this,r=[],o=this.sel,s=0;s<o.ranges.length;s++){var a=o.ranges[s];r[s]={from:a.from(),to:a.to(),text:i.splitLines(e[s]),origin:n}}for(var l=t&&"end"!=t&&zi(this,r,t),c=r.length-1;c>=0;c--)Ar(i,r[c]);l?vr(this,l):this.cm&&Un(this.cm)}),undo:fi(function(){Ir(this,"undo")}),redo:fi(function(){Ir(this,"redo")}),undoSelection:fi(function(){Ir(this,"undo",!0)}),redoSelection:fi(function(){Ir(this,"redo",!0)}),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,n=0,i=0;i<e.done.length;i++)e.done[i].ranges||++t;for(var r=0;r<e.undone.length;r++)e.undone[r].ranges||++n;return{undo:t,redo:n}},clearHistory:function(){this.history=new Zi(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:ur(this.history.done),undone:ur(this.history.undone)}},setHistory:function(e){var t=this.history=new Zi(this.history.maxGeneration);t.done=ur(e.done.slice(0),null,!0),t.undone=ur(e.undone.slice(0),null,!0)},setGutterMarker:fi(function(e,t,n){return Fr(this,e,"gutter",function(e){var i=e.gutterMarkers||(e.gutterMarkers={});return i[t]=n,!n&&C(i)&&(e.gutterMarkers=null),!0})}),clearGutter:fi(function(e){var t=this;this.iter(function(n){n.gutterMarkers&&n.gutterMarkers[e]&&Fr(t,n,"gutter",function(){return n.gutterMarkers[e]=null,C(n.gutterMarkers)&&(n.gutterMarkers=null),!0})})}),lineInfo:function(e){var t;if("number"==typeof e){if(!k(this,e))return null;if(t=e,!(e=M(this,e)))return null}else if(null==(t=T(e)))return null;return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:fi(function(t,n,i){return Fr(this,t,"gutter"==n?"gutter":"class",function(t){var r="text"==n?"textClass":"background"==n?"bgClass":"gutter"==n?"gutterClass":"wrapClass";if(t[r]){if(e(i).test(t[r]))return!1;t[r]+=" "+i}else t[r]=i;return!0})}),removeLineClass:fi(function(t,n,i){return Fr(this,t,"gutter"==n?"gutter":"class",function(t){var r="text"==n?"textClass":"background"==n?"bgClass":"gutter"==n?"gutterClass":"wrapClass",o=t[r];if(!o)return!1;if(null==i)t[r]=null;else{var s=o.match(e(i));if(!s)return!1;var a=s.index+s[0].length;t[r]=o.slice(0,s.index)+(s.index&&a!=o.length?" ":"")+o.slice(a)||null}return!0})}),addLineWidget:fi(function(e,t,n){return Br(this,e,t,n)}),removeLineWidget:function(e){e.clear()},markText:function(e,t,n){return zr(this,B(this,e),B(this,t),n,n&&n.type||"range")},setBookmark:function(e,t){var n={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};return e=B(this,e),zr(this,e,e,n,"bookmark")},findMarksAt:function(e){var t=[],n=M(this,(e=B(this,e)).line).markedSpans;if(n)for(var i=0;i<n.length;++i){var r=n[i];(null==r.from||r.from<=e.ch)&&(null==r.to||r.to>=e.ch)&&t.push(r.marker.parent||r.marker)}return t},findMarks:function(e,t,n){e=B(this,e),t=B(this,t);var i=[],r=e.line;return this.iter(e.line,t.line+1,function(o){var s=o.markedSpans;if(s)for(var a=0;a<s.length;a++){var l=s[a];null!=l.to&&r==e.line&&e.ch>=l.to||null==l.from&&r!=e.line||null!=l.from&&r==t.line&&l.from>=t.ch||n&&!n(l.marker)||i.push(l.marker.parent||l.marker)}++r}),i},getAllMarks:function(){var e=[];return this.iter(function(t){var n=t.markedSpans;if(n)for(var i=0;i<n.length;++i)null!=n[i].from&&e.push(n[i].marker)}),e},posFromIndex:function(e){var t,n=this.first,i=this.lineSeparator().length;return this.iter(function(r){var o=r.text.length+i;if(o>e)return t=e,!0;e-=o,++n}),B(this,P(n,t))},indexFromPos:function(e){var t=(e=B(this,e)).ch;if(e.line<this.first||e.ch<0)return 0;var n=this.lineSeparator().length;return this.iter(this.first,e.line,function(e){t+=e.text.length+n}),t},copy:function(e){var t=new Da(E(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,n=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<n&&(n=e.to);var i=new Da(E(this,t,n),e.mode||this.modeOption,t,this.lineSep,this.direction);return e.sharedHist&&(i.history=this.history),(this.linked||(this.linked=[])).push({doc:i,sharedHist:e.sharedHist}),i.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],Gr(i,Ur(this)),i},unlinkDoc:function(e){var t=this;if(e instanceof jo&&(e=e.doc),this.linked)for(var n=0;n<this.linked.length;++n)if(t.linked[n].doc==e){t.linked.splice(n,1),e.unlinkDoc(t),Wr(Ur(t));break}if(e.history==this.history){var i=[e.id];Xi(e,function(e){return i.push(e.id)},!0),e.history=new Zi(null),e.history.done=ur(this.history.done,i),e.history.undone=ur(this.history.undone,i)}},iterLinkedDocs:function(e){Xi(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){return this.lineSep?e.split(this.lineSep):Xs(e)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:fi(function(e){"rtl"!=e&&(e="ltr"),e!=this.direction&&(this.direction=e,this.iter(function(e){return e.order=null}),this.cm&&Qi(this.cm))})}),Da.prototype.eachLine=Da.prototype.iter;for(var Ma=0,Aa=!1,Ea={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Ia=0;Ia<10;Ia++)Ea[Ia+48]=Ea[Ia+96]=String(Ia);for(var Ta=65;Ta<=90;Ta++)Ea[Ta]=String.fromCharCode(Ta);for(var La=1;La<=12;La++)Ea[La+111]=Ea[La+63235]="F"+La;var ka={};ka.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},ka.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},ka.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},ka.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},ka.default=qs?ka.macDefault:ka.pcDefault;var Oa={selectAll:Dr,singleSelection:function(e){return e.setSelection(e.getCursor("anchor"),e.getCursor("head"),Ps)},killLine:function(e){return co(e,function(t){if(t.empty()){var n=M(e.doc,t.head.line).text.length;return t.head.ch==n&&t.head.line<e.lastLine()?{from:t.head,to:P(t.head.line+1,0)}:{from:t.head,to:P(t.head.line,n)}}return{from:t.from(),to:t.to()}})},deleteLine:function(e){return co(e,function(t){return{from:P(t.from().line,0),to:B(e.doc,P(t.to().line+1,0))}})},delLineLeft:function(e){return co(e,function(e){return{from:P(e.from().line,0),to:e.from()}})},delWrappedLineLeft:function(e){return co(e,function(t){var n=e.charCoords(t.head,"div").top+5;return{from:e.coordsChar({left:0,top:n},"div"),to:t.from()}})},delWrappedLineRight:function(e){return co(e,function(t){var n=e.charCoords(t.head,"div").top+5,i=e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:n},"div");return{from:t.from(),to:i}})},undo:function(e){return e.undo()},redo:function(e){return e.redo()},undoSelection:function(e){return e.undoSelection()},redoSelection:function(e){return e.redoSelection()},goDocStart:function(e){return e.extendSelection(P(e.firstLine(),0))},goDocEnd:function(e){return e.extendSelection(P(e.lastLine()))},goLineStart:function(e){return e.extendSelectionsBy(function(t){return uo(e,t.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(e){return e.extendSelectionsBy(function(t){return po(e,t.head)},{origin:"+move",bias:1})},goLineEnd:function(e){return e.extendSelectionsBy(function(t){return ho(e,t.head.line)},{origin:"+move",bias:-1})},goLineRight:function(e){return e.extendSelectionsBy(function(t){var n=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:n},"div")},Rs)},goLineLeft:function(e){return e.extendSelectionsBy(function(t){var n=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:n},"div")},Rs)},goLineLeftSmart:function(e){return e.extendSelectionsBy(function(t){var n=e.cursorCoords(t.head,"div").top+5,i=e.coordsChar({left:0,top:n},"div");return i.ch<e.getLine(i.line).search(/\S/)?po(e,t.head):i},Rs)},goLineUp:function(e){return e.moveV(-1,"line")},goLineDown:function(e){return e.moveV(1,"line")},goPageUp:function(e){return e.moveV(-1,"page")},goPageDown:function(e){return e.moveV(1,"page")},goCharLeft:function(e){return e.moveH(-1,"char")},goCharRight:function(e){return e.moveH(1,"char")},goColumnLeft:function(e){return e.moveH(-1,"column")},goColumnRight:function(e){return e.moveH(1,"column")},goWordLeft:function(e){return e.moveH(-1,"word")},goGroupRight:function(e){return e.moveH(1,"group")},goGroupLeft:function(e){return e.moveH(-1,"group")},goWordRight:function(e){return e.moveH(1,"word")},delCharBefore:function(e){return e.deleteH(-1,"char")},delCharAfter:function(e){return e.deleteH(1,"char")},delWordBefore:function(e){return e.deleteH(-1,"word")},delWordAfter:function(e){return e.deleteH(1,"word")},delGroupBefore:function(e){return e.deleteH(-1,"group")},delGroupAfter:function(e){return e.deleteH(1,"group")},indentAuto:function(e){return e.indentSelection("smart")},indentMore:function(e){return e.indentSelection("add")},indentLess:function(e){return e.indentSelection("subtract")},insertTab:function(e){return e.replaceSelection("\t")},insertSoftTab:function(e){for(var t=[],n=e.listSelections(),i=e.options.tabSize,r=0;r<n.length;r++){var o=n[r].from(),s=h(e.getLine(o.line),o.ch,i);t.push(f(i-s%i))}e.replaceSelections(t)},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){return hi(e,function(){for(var t=e.listSelections(),n=[],i=0;i<t.length;i++)if(t[i].empty()){var r=t[i].head,o=M(e.doc,r.line).text;if(o)if(r.ch==o.length&&(r=new P(r.line,r.ch-1)),r.ch>0)r=new P(r.line,r.ch+1),e.replaceRange(o.charAt(r.ch-1)+o.charAt(r.ch-2),P(r.line,r.ch-2),r,"+transpose");else if(r.line>e.doc.first){var s=M(e.doc,r.line-1).text;s&&(r=new P(r.line,1),e.replaceRange(o.charAt(0)+e.doc.lineSeparator()+s.charAt(s.length-1),P(r.line-1,s.length-1),r,"+transpose"))}n.push(new xa(r,r))}e.setSelections(n)})},newlineAndIndent:function(e){return hi(e,function(){for(var t=e.listSelections(),n=t.length-1;n>=0;n--)e.replaceRange(e.doc.lineSeparator(),t[n].anchor,t[n].head,"+input");t=e.listSelections();for(var i=0;i<t.length;i++)e.indentLine(t[i].from().line,null,!0);Un(e)})},openLine:function(e){return e.replaceSelection("\n","start")},toggleOverwrite:function(e){return e.toggleOverwrite()}},Pa=new Is,Na=null,Ra=function(e,t,n){this.time=e,this.pos=t,this.button=n};Ra.prototype.compare=function(e,t,n){return this.time+400>e&&0==N(t,this.pos)&&n==this.button};var Fa,ja,Va={toString:function(){return"CodeMirror.Init"}},Ha={},Ba={};jo.defaults=Ha,jo.optionHandlers=Ba;var za=[];jo.defineInitHook=function(e){return za.push(e)};var $a=null,Ua=function(e){this.cm=e,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Is,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};Ua.prototype.init=function(e){function t(e){if(!Te(r,e)){if(r.somethingSelected())Bo({lineWise:!1,text:r.getSelections()}),"cut"==e.type&&r.replaceSelection("",null,"cut");else{if(!r.options.lineWiseCopyCut)return;var t=Go(r);Bo({lineWise:!0,text:t.text}),"cut"==e.type&&r.operation(function(){r.setSelections(t.ranges,0,Ps),r.replaceSelection("",null,"cut")})}if(e.clipboardData){e.clipboardData.clearData();var n=$a.text.join("\n");if(e.clipboardData.setData("Text",n),e.clipboardData.getData("Text")==n)return void e.preventDefault()}var s=Xo(),a=s.firstChild;r.display.lineSpace.insertBefore(s,r.display.lineSpace.firstChild),a.value=$a.text.join("\n");var l=document.activeElement;Es(a),setTimeout(function(){r.display.lineSpace.removeChild(s),l.focus(),l==o&&i.showPrimarySelection()},50)}}var n=this,i=this,r=i.cm,o=i.div=e.lineDiv;Wo(o,r.options.spellcheck),Gs(o,"paste",function(e){Te(r,e)||$o(e,r)||us<=11&&setTimeout(di(r,function(){return n.updateFromDOM()}),20)}),Gs(o,"compositionstart",function(e){n.composing={data:e.data,done:!1}}),Gs(o,"compositionupdate",function(e){n.composing||(n.composing={data:e.data,done:!1})}),Gs(o,"compositionend",function(e){n.composing&&(e.data!=n.composing.data&&n.readFromDOMSoon(),n.composing.done=!0)}),Gs(o,"touchstart",function(){return i.forceCompositionEnd()}),Gs(o,"input",function(){n.composing||n.readFromDOMSoon()}),Gs(o,"copy",t),Gs(o,"cut",t)},Ua.prototype.prepareSelection=function(){var e=Mn(this.cm,!1);return e.focus=this.cm.state.focused,e},Ua.prototype.showSelection=function(e,t){e&&this.cm.display.view.length&&((e.focus||t)&&this.showPrimarySelection(),this.showMultipleSelections(e))},Ua.prototype.showPrimarySelection=function(){var e=window.getSelection(),t=this.cm,n=t.doc.sel.primary(),i=n.from(),r=n.to();if(t.display.viewTo==t.display.viewFrom||i.line>=t.display.viewTo||r.line<t.display.viewFrom)e.removeAllRanges();else{var o=ts(t,e.anchorNode,e.anchorOffset),s=ts(t,e.focusNode,e.focusOffset);if(!o||o.bad||!s||s.bad||0!=N(V(o,s),i)||0!=N(j(o,s),r)){var a=t.display.view,l=i.line>=t.display.viewFrom&&Qo(t,i)||{node:a[0].measure.map[2],offset:0},c=r.line<t.display.viewTo&&Qo(t,r);if(!c){var u=a[a.length-1].measure,h=u.maps?u.maps[u.maps.length-1]:u.map;c={node:h[h.length-1],offset:h[h.length-2]-h[h.length-3]}}if(l&&c){var d,p=e.rangeCount&&e.getRangeAt(0);try{d=_s(l.node,l.offset,c.offset,c.node)}catch(e){}d&&(!os&&t.state.focused?(e.collapse(l.node,l.offset),d.collapsed||(e.removeAllRanges(),e.addRange(d))):(e.removeAllRanges(),e.addRange(d)),p&&null==e.anchorNode?e.addRange(p):os&&this.startGracePeriod()),this.rememberSelection()}else e.removeAllRanges()}}},Ua.prototype.startGracePeriod=function(){var e=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){e.gracePeriod=!1,e.selectionChanged()&&e.cm.operation(function(){return e.cm.curOp.selectionChanged=!0})},20)},Ua.prototype.showMultipleSelections=function(e){n(this.cm.display.cursorDiv,e.cursors),n(this.cm.display.selectionDiv,e.selection)},Ua.prototype.rememberSelection=function(){var e=window.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastFocusNode=e.focusNode,this.lastFocusOffset=e.focusOffset},Ua.prototype.selectionInEditor=function(){var e=window.getSelection();if(!e.rangeCount)return!1;var t=e.getRangeAt(0).commonAncestorContainer;return o(this.div,t)},Ua.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()||this.showSelection(this.prepareSelection(),!0),this.div.focus())},Ua.prototype.blur=function(){this.div.blur()},Ua.prototype.getField=function(){return this.div},Ua.prototype.supportsTouch=function(){return!0},Ua.prototype.receivedFocus=function(){function e(){t.cm.state.focused&&(t.pollSelection(),t.polling.set(t.cm.options.pollInterval,e))}var t=this;this.selectionInEditor()?this.pollSelection():hi(this.cm,function(){return t.cm.curOp.selectionChanged=!0}),this.polling.set(this.cm.options.pollInterval,e)},Ua.prototype.selectionChanged=function(){var e=window.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset},Ua.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var e=window.getSelection(),t=this.cm;if(bs&&ps&&this.cm.options.gutters.length&&Zo(e.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(!this.composing){this.rememberSelection();var n=ts(t,e.anchorNode,e.anchorOffset),i=ts(t,e.focusNode,e.focusOffset);n&&i&&hi(t,function(){yr(t.doc,Fi(n,i),Ps),(n.bad||i.bad)&&(t.curOp.selectionChanged=!0)})}}},Ua.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var e=this.cm,t=e.display,n=e.doc.sel.primary(),i=n.from(),r=n.to();if(0==i.ch&&i.line>e.firstLine()&&(i=P(i.line-1,M(e.doc,i.line-1).length)),r.ch==M(e.doc,r.line).text.length&&r.line<e.lastLine()&&(r=P(r.line+1,0)),i.line<t.viewFrom||r.line>t.viewTo-1)return!1;var o,s,a;i.line==t.viewFrom||0==(o=_n(e,i.line))?(s=T(t.view[0].line),a=t.view[0].node):(s=T(t.view[o].line),a=t.view[o-1].node.nextSibling);var l,c,u=_n(e,r.line);if(u==t.view.length-1?(l=t.viewTo-1,c=t.lineDiv.lastChild):(l=T(t.view[u+1].line)-1,c=t.view[u+1].node.previousSibling),!a)return!1;for(var h=e.doc.splitLines(es(e,a,c,s,l)),d=A(e.doc,P(s,0),P(l,M(e.doc,l).text.length));h.length>1&&d.length>1;)if(m(h)==m(d))h.pop(),d.pop(),l--;else{if(h[0]!=d[0])break;h.shift(),d.shift(),s++}for(var p=0,f=0,g=h[0],v=d[0],y=Math.min(g.length,v.length);p<y&&g.charCodeAt(p)==v.charCodeAt(p);)++p;for(var b=m(h),x=m(d),q=Math.min(b.length-(1==h.length?p:0),x.length-(1==d.length?p:0));f<q&&b.charCodeAt(b.length-f-1)==x.charCodeAt(x.length-f-1);)++f;if(1==h.length&&1==d.length&&s==i.line)for(;p&&p>i.ch&&b.charCodeAt(b.length-f-1)==x.charCodeAt(x.length-f-1);)p--,f++;h[h.length-1]=b.slice(0,b.length-f).replace(/^\u200b+/,""),h[0]=h[0].slice(p).replace(/\u200b+$/,"");var C=P(s,p),S=P(l,d.length?m(d).length-f:0);return h.length>1||h[0]||N(C,S)?(Or(e.doc,h,C,S,"+input"),!0):void 0},Ua.prototype.ensurePolled=function(){this.forceCompositionEnd()},Ua.prototype.reset=function(){this.forceCompositionEnd()},Ua.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},Ua.prototype.readFromDOMSoon=function(){var e=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout(function(){if(e.readDOMTimeout=null,e.composing){if(!e.composing.done)return;e.composing=null}e.updateFromDOM()},80))},Ua.prototype.updateFromDOM=function(){var e=this;!this.cm.isReadOnly()&&this.pollContent()||hi(this.cm,function(){return mi(e.cm)})},Ua.prototype.setUneditable=function(e){e.contentEditable="false"},Ua.prototype.onKeyPress=function(e){0!=e.charCode&&(e.preventDefault(),this.cm.isReadOnly()||di(this.cm,zo)(this.cm,String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),0))},Ua.prototype.readOnlyChanged=function(e){this.div.contentEditable=String("nocursor"!=e)},Ua.prototype.onContextMenu=function(){},Ua.prototype.resetPosition=function(){},Ua.prototype.needsContentAttribute=!0;var Ga=function(e){this.cm=e,this.prevInput="",this.pollingFast=!1,this.polling=new Is,this.hasSelection=!1,this.composing=null};Ga.prototype.init=function(e){function t(e){if(!Te(r,e)){if(r.somethingSelected())Bo({lineWise:!1,text:r.getSelections()});else{if(!r.options.lineWiseCopyCut)return;var t=Go(r);Bo({lineWise:!0,text:t.text}),"cut"==e.type?r.setSelections(t.ranges,null,Ps):(i.prevInput="",s.value=t.text.join("\n"),Es(s))}"cut"==e.type&&(r.state.cutIncoming=!0)}}var n=this,i=this,r=this.cm,o=this.wrapper=Xo(),s=this.textarea=o.firstChild;e.wrapper.insertBefore(o,e.wrapper.firstChild),ys&&(s.style.width="0px"),Gs(s,"input",function(){cs&&us>=9&&n.hasSelection&&(n.hasSelection=null),i.poll()}),Gs(s,"paste",function(e){Te(r,e)||$o(e,r)||(r.state.pasteIncoming=!0,i.fastPoll())}),Gs(s,"cut",t),Gs(s,"copy",t),Gs(e.scroller,"paste",function(t){Ft(e,t)||Te(r,t)||(r.state.pasteIncoming=!0,i.focus())}),Gs(e.lineSpace,"selectstart",function(t){Ft(e,t)||Pe(t)}),Gs(s,"compositionstart",function(){var e=r.getCursor("from");i.composing&&i.composing.range.clear(),i.composing={start:e,range:r.markText(e,r.getCursor("to"),{className:"CodeMirror-composing"})}}),Gs(s,"compositionend",function(){i.composing&&(i.poll(),i.composing.range.clear(),i.composing=null)})},Ga.prototype.prepareSelection=function(){var e=this.cm,t=e.display,n=e.doc,i=Mn(e);if(e.options.moveInputWithCursor){var r=hn(e,n.sel.primary().head,"div"),o=t.wrapper.getBoundingClientRect(),s=t.lineDiv.getBoundingClientRect();i.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,r.top+s.top-o.top)),i.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,r.left+s.left-o.left))}return i},Ga.prototype.showSelection=function(e){var t=this.cm.display;n(t.cursorDiv,e.cursors),n(t.selectionDiv,e.selection),null!=e.teTop&&(this.wrapper.style.top=e.teTop+"px",this.wrapper.style.left=e.teLeft+"px")},Ga.prototype.reset=function(e){if(!this.contextMenuPending&&!this.composing){var t=this.cm;if(t.somethingSelected()){this.prevInput="";var n=t.getSelection();this.textarea.value=n,t.state.focused&&Es(this.textarea),cs&&us>=9&&(this.hasSelection=n)}else e||(this.prevInput=this.textarea.value="",cs&&us>=9&&(this.hasSelection=null))}},Ga.prototype.getField=function(){return this.textarea},Ga.prototype.supportsTouch=function(){return!1},Ga.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!xs||s()!=this.textarea))try{this.textarea.focus()}catch(e){}},Ga.prototype.blur=function(){this.textarea.blur()},Ga.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},Ga.prototype.receivedFocus=function(){this.slowPoll()},Ga.prototype.slowPoll=function(){var e=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){e.poll(),e.cm.state.focused&&e.slowPoll()})},Ga.prototype.fastPoll=function(){function e(){n.poll()||t?(n.pollingFast=!1,n.slowPoll()):(t=!0,n.polling.set(60,e))}var t=!1,n=this;n.pollingFast=!0,n.polling.set(20,e)},Ga.prototype.poll=function(){var e=this,t=this.cm,n=this.textarea,i=this.prevInput;if(this.contextMenuPending||!t.state.focused||Ys(n)&&!i&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq)return!1;var r=n.value;if(r==i&&!t.somethingSelected())return!1;if(cs&&us>=9&&this.hasSelection===r||qs&&/[\uf700-\uf7ff]/.test(r))return t.display.input.reset(),!1;if(t.doc.sel==t.display.selForContextMenu){var o=r.charCodeAt(0);if(8203!=o||i||(i=""),8666==o)return this.reset(),this.cm.execCommand("undo")}for(var s=0,a=Math.min(i.length,r.length);s<a&&i.charCodeAt(s)==r.charCodeAt(s);)++s;return hi(t,function(){zo(t,r.slice(s),i.length-s,null,e.composing?"*compose":null),r.length>1e3||r.indexOf("\n")>-1?n.value=e.prevInput="":e.prevInput=r,e.composing&&(e.composing.range.clear(),e.composing.range=t.markText(e.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},Ga.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},Ga.prototype.onKeyPress=function(){cs&&us>=9&&(this.hasSelection=null),this.fastPoll()},Ga.prototype.onContextMenu=function(e){function t(){if(null!=s.selectionStart){var e=r.somethingSelected(),t=""+(e?s.value:"");s.value="",s.value=t,i.prevInput=e?"":"",s.selectionStart=1,s.selectionEnd=t.length,o.selForContextMenu=r.doc.sel}}function n(){if(i.contextMenuPending=!1,i.wrapper.style.cssText=u,s.style.cssText=c,cs&&us<9&&o.scrollbars.setScrollTop(o.scroller.scrollTop=l),null!=s.selectionStart){(!cs||cs&&us<9)&&t();var e=0,n=function(){o.selForContextMenu==r.doc.sel&&0==s.selectionStart&&s.selectionEnd>0&&""==i.prevInput?di(r,Dr)(r):e++<10?o.detectingSelectAll=setTimeout(n,500):(o.selForContextMenu=null,o.input.reset())};o.detectingSelectAll=setTimeout(n,200)}}var i=this,r=i.cm,o=r.display,s=i.textarea,a=wn(r,e),l=o.scroller.scrollTop;if(a&&!fs){r.options.resetSelectionOnContextMenu&&-1==r.doc.sel.contains(a)&&di(r,yr)(r.doc,Fi(a),Ps);var c=s.style.cssText,u=i.wrapper.style.cssText;i.wrapper.style.cssText="position: absolute";var h=i.wrapper.getBoundingClientRect();s.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-h.top-5)+"px; left: "+(e.clientX-h.left-5)+"px;\n      z-index: 1000; background: "+(cs?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";var d;if(hs&&(d=window.scrollY),o.input.focus(),hs&&window.scrollTo(null,d),o.input.reset(),r.somethingSelected()||(s.value=i.prevInput=" "),i.contextMenuPending=!0,o.selForContextMenu=r.doc.sel,clearTimeout(o.detectingSelectAll),cs&&us>=9&&t(),Ms){Fe(e);var p=function(){Ee(window,"mouseup",p),setTimeout(n,20)};Gs(window,"mouseup",p)}else setTimeout(n,50)}},Ga.prototype.readOnlyChanged=function(e){e||this.reset(),this.textarea.disabled="nocursor"==e},Ga.prototype.setUneditable=function(){},Ga.prototype.needsContentAttribute=!1,function(e){function t(t,i,r,o){e.defaults[t]=i,r&&(n[t]=o?function(e,t,n){n!=Va&&r(e,t,n)}:r)}var n=e.optionHandlers;e.defineOption=t,e.Init=Va,t("value","",function(e,t){return e.setValue(t)},!0),t("mode",null,function(e,t){e.doc.modeOption=t,$i(e)},!0),t("indentUnit",2,$i,!0),t("indentWithTabs",!1),t("smartIndent",!0),t("tabSize",4,function(e){Ui(e),on(e),mi(e)},!0),t("lineSeparator",null,function(e,t){if(e.doc.lineSep=t,t){var n=[],i=e.doc.first;e.doc.iter(function(e){for(var r=0;;){var o=e.text.indexOf(t,r);if(-1==o)break;r=o+t.length,n.push(P(i,o))}i++});for(var r=n.length-1;r>=0;r--)Or(e.doc,t,n[r],P(n[r].line,n[r].ch+t.length))}}),t("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,function(e,t,n){e.state.specialChars=new RegExp(t.source+(t.test("\t")?"":"|\t"),"g"),n!=Va&&e.refresh()}),t("specialCharPlaceholder",dt,function(e){return e.refresh()},!0),t("electricChars",!0),t("inputStyle",xs?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),t("spellcheck",!1,function(e,t){return e.getInputField().spellcheck=t},!0),t("rtlMoveVisually",!Ss),t("wholeLineUpdateBefore",!0),t("theme","default",function(e){Po(e),No(e)},!0),t("keyMap","default",function(e,t,n){var i=lo(t),r=n!=Va&&lo(n);r&&r.detach&&r.detach(e,i),i.attach&&i.attach(e,r||null)}),t("extraKeys",null),t("configureMouse",null),t("lineWrapping",!1,Fo,!0),t("gutters",[],function(e){ki(e.options),No(e)},!0),t("fixedGutter",!0,function(e,t){e.display.gutters.style.left=t?qn(e.display)+"px":"0",e.refresh()},!0),t("coverGutterNextToScrollbar",!1,function(e){return ei(e)},!0),t("scrollbarStyle","native",function(e){ni(e),ei(e),e.display.scrollbars.setScrollTop(e.doc.scrollTop),e.display.scrollbars.setScrollLeft(e.doc.scrollLeft)},!0),t("lineNumbers",!1,function(e){ki(e.options),No(e)},!0),t("firstLineNumber",1,No,!0),t("lineNumberFormatter",function(e){return e},No,!0),t("showCursorWhenSelecting",!1,Dn,!0),t("resetSelectionOnContextMenu",!0),t("lineWiseCopyCut",!0),t("pasteLinesPerSelection",!0),t("readOnly",!1,function(e,t){"nocursor"==t&&(On(e),e.display.input.blur()),e.display.input.readOnlyChanged(t)}),t("disableInput",!1,function(e,t){t||e.display.input.reset()},!0),t("dragDrop",!0,Ro),t("allowDropFileTypes",null),t("cursorBlinkRate",530),t("cursorScrollMargin",0),t("cursorHeight",1,Dn,!0),t("singleCursorHeightPerLine",!0,Dn,!0),t("workTime",100),t("workDelay",100),t("flattenSpans",!0,Ui,!0),t("addModeClass",!1,Ui,!0),t("pollInterval",100),t("undoDepth",200,function(e,t){return e.doc.history.undoDepth=t}),t("historyEventDelay",1250),t("viewportMargin",10,function(e){return e.refresh()},!0),t("maxHighlightLength",1e4,Ui,!0),t("moveInputWithCursor",!0,function(e,t){t||e.display.input.resetPosition()}),t("tabindex",null,function(e,t){return e.display.input.getField().tabIndex=t||""}),t("autofocus",null),t("direction","ltr",function(e,t){return e.doc.setDirection(t)},!0)}(jo),function(e){var t=e.optionHandlers,n=e.helpers={};e.prototype={constructor:e,focus:function(){window.focus(),this.display.input.focus()},setOption:function(e,n){var i=this.options,r=i[e];i[e]==n&&"mode"!=e||(i[e]=n,t.hasOwnProperty(e)&&di(this,t[e])(this,n,r),Ie(this,"optionChange",this,e))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](lo(e))},removeKeyMap:function(e){for(var t=this.state.keyMaps,n=0;n<t.length;++n)if(t[n]==e||t[n].name==e)return t.splice(n,1),!0},addOverlay:pi(function(t,n){var i=t.token?t:e.getMode(this.options,t);if(i.startState)throw new Error("Overlays may not be stateful.");v(this.state.overlays,{mode:i,modeSpec:t,opaque:n&&n.opaque,priority:n&&n.priority||0},function(e){return e.priority}),this.state.modeGen++,mi(this)}),removeOverlay:pi(function(e){for(var t=this,n=this.state.overlays,i=0;i<n.length;++i){var r=n[i].modeSpec;if(r==e||"string"==typeof e&&r.name==e)return n.splice(i,1),t.state.modeGen++,void mi(t)}}),indentLine:pi(function(e,t,n){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),k(this.doc,e)&&Ho(this,e,t,n)}),indentSelection:pi(function(e){for(var t=this,n=this.doc.sel.ranges,i=-1,r=0;r<n.length;r++){var o=n[r];if(o.empty())o.head.line>i&&(Ho(t,o.head.line,e,!0),i=o.head.line,r==t.doc.sel.primIndex&&Un(t));else{var s=o.from(),a=o.to(),l=Math.max(i,s.line);i=Math.min(t.lastLine(),a.line-(a.ch?0:1))+1;for(var c=l;c<i;++c)Ho(t,c,e);var u=t.doc.sel.ranges;0==s.ch&&n.length==u.length&&u[r].from().ch>0&&fr(t.doc,r,new xa(s,u[r].to()),Ps)}}}),getTokenAt:function(e,t){return it(this,e,t)},getLineTokens:function(e,t){return it(this,P(e),t,!0)},getTokenTypeAt:function(e){e=B(this.doc,e);var t,n=Ze(this,M(this.doc,e.line)),i=0,r=(n.length-1)/2,o=e.ch;if(0==o)t=n[2];else for(;;){var s=i+r>>1;if((s?n[2*s-1]:0)>=o)r=s;else{if(!(n[2*s+1]<o)){t=n[2*s+2];break}i=s+1}}var a=t?t.indexOf("overlay "):-1;return a<0?t:0==a?null:t.slice(0,a-1)},getModeAt:function(t){var n=this.doc.mode;return n.innerMode?e.innerMode(n,this.getTokenAt(t).state).mode:n},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var i=this,r=[];if(!n.hasOwnProperty(t))return r;var o=n[t],s=this.getModeAt(e);if("string"==typeof s[t])o[s[t]]&&r.push(o[s[t]]);else if(s[t])for(var a=0;a<s[t].length;a++){var l=o[s[t][a]];l&&r.push(l)}else s.helperType&&o[s.helperType]?r.push(o[s.helperType]):o[s.name]&&r.push(o[s.name]);for(var c=0;c<o._global.length;c++){var u=o._global[c];u.pred(s,i)&&-1==d(r,u.val)&&r.push(u.val)}return r},getStateAfter:function(e,t){var n=this.doc;return e=H(n,null==e?n.first+n.size-1:e),Je(this,e+1,t).state},cursorCoords:function(e,t){var n,i=this.doc.sel.primary();return n=null==e?i.head:"object"==typeof e?B(this.doc,e):e?i.from():i.to(),hn(this,n,t||"page")},charCoords:function(e,t){return un(this,B(this.doc,e),t||"page")},coordsChar:function(e,t){return e=cn(this,e,t||"page"),fn(this,e.left,e.top)},lineAtHeight:function(e,t){return e=cn(this,{top:e,left:0},t||"page").top,L(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t,n){var i,r=!1;if("number"==typeof e){var o=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>o&&(e=o,r=!0),i=M(this.doc,e)}else i=e;return ln(this,i,{top:0,left:0},t||"page",n||r).top+(r?this.doc.height-ye(i):0)},defaultTextHeight:function(){return yn(this.display)},defaultCharWidth:function(){return bn(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,n,i,r){var o=this.display,s=(e=hn(this,B(this.doc,e))).bottom,a=e.left;if(t.style.position="absolute",t.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(t),o.sizer.appendChild(t),"over"==i)s=e.top;else if("above"==i||"near"==i){var l=Math.max(o.wrapper.clientHeight,this.doc.height),c=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==i||e.bottom+t.offsetHeight>l)&&e.top>t.offsetHeight?s=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=l&&(s=e.bottom),a+t.offsetWidth>c&&(a=c-t.offsetWidth)}t.style.top=s+"px",t.style.left=t.style.right="","right"==r?(a=o.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==r?a=0:"middle"==r&&(a=(o.sizer.clientWidth-t.offsetWidth)/2),t.style.left=a+"px"),n&&Bn(this,{left:a,top:s,right:a+t.offsetWidth,bottom:s+t.offsetHeight})},triggerOnKeyDown:pi(bo),triggerOnKeyPress:pi(Co),triggerOnKeyUp:qo,triggerOnMouseDown:pi(wo),execCommand:function(e){if(Oa.hasOwnProperty(e))return Oa[e].call(null,this)},triggerElectric:pi(function(e){Uo(this,e)}),findPosH:function(e,t,n,i){var r=this,o=1;t<0&&(o=-1,t=-t);for(var s=B(this.doc,e),a=0;a<t&&!(s=Yo(r.doc,s,o,n,i)).hitSide;++a);return s},moveH:pi(function(e,t){var n=this;this.extendSelectionsBy(function(i){return n.display.shift||n.doc.extend||i.empty()?Yo(n.doc,i.head,e,t,n.options.rtlMoveVisually):e<0?i.from():i.to()},Rs)}),deleteH:pi(function(e,t){var n=this.doc.sel,i=this.doc;n.somethingSelected()?i.replaceSelection("",null,"+delete"):co(this,function(n){var r=Yo(i,n.head,e,t,!1);return e<0?{from:r,to:n.head}:{from:n.head,to:r}})}),findPosV:function(e,t,n,i){var r=this,o=1,s=i;t<0&&(o=-1,t=-t);for(var a=B(this.doc,e),l=0;l<t;++l){var c=hn(r,a,"div");if(null==s?s=c.left:c.left=s,(a=Ko(r,c,o,n)).hitSide)break}return a},moveV:pi(function(e,t){var n=this,i=this.doc,r=[],o=!this.display.shift&&!i.extend&&i.sel.somethingSelected();if(i.extendSelectionsBy(function(s){if(o)return e<0?s.from():s.to();var a=hn(n,s.head,"div");null!=s.goalColumn&&(a.left=s.goalColumn),r.push(a.left);var l=Ko(n,a,e,t);return"page"==t&&s==i.sel.primary()&&$n(n,un(n,l,"div").top-a.top),l},Rs),r.length)for(var s=0;s<i.sel.ranges.length;s++)i.sel.ranges[s].goalColumn=r[s]}),findWordAt:function(e){var t=M(this.doc,e.line).text,n=e.ch,i=e.ch;if(t){var r=this.getHelper(e,"wordChars");"before"!=e.sticky&&i!=t.length||!n?++i:--n;for(var o=t.charAt(n),s=q(o,r)?function(e){return q(e,r)}:/\s/.test(o)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!q(e)};n>0&&s(t.charAt(n-1));)--n;for(;i<t.length&&s(t.charAt(i));)++i}return new xa(P(e.line,n),P(e.line,i))},toggleOverwrite:function(e){null!=e&&e==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?a(this.display.cursorDiv,"CodeMirror-overwrite"):As(this.display.cursorDiv,"CodeMirror-overwrite"),Ie(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==s()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:pi(function(e,t){Gn(this,e,t)}),getScrollInfo:function(){var e=this.display.scroller;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-Bt(this)-this.display.barHeight,width:e.scrollWidth-Bt(this)-this.display.barWidth,clientHeight:$t(this),clientWidth:zt(this)}},scrollIntoView:pi(function(e,t){null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:P(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line?Wn(this,e):Yn(this,e.from,e.to,e.margin)}),setSize:pi(function(e,t){var n=this,i=function(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e};null!=e&&(this.display.wrapper.style.width=i(e)),null!=t&&(this.display.wrapper.style.height=i(t)),this.options.lineWrapping&&rn(this);var r=this.display.viewFrom;this.doc.iter(r,this.display.viewTo,function(e){if(e.widgets)for(var t=0;t<e.widgets.length;t++)if(e.widgets[t].noHScroll){gi(n,r,"widget");break}++r}),this.curOp.forceUpdate=!0,Ie(this,"refresh",this)}),operation:function(e){return hi(this,e)},startOperation:function(){return ii(this)},endOperation:function(){return ri(this)},refresh:pi(function(){var e=this.display.cachedTextHeight;mi(this),this.curOp.forceUpdate=!0,on(this),Gn(this,this.doc.scrollLeft,this.doc.scrollTop),Ii(this),(null==e||Math.abs(e-yn(this.display))>.5)&&Sn(this),Ie(this,"refresh",this)}),swapDoc:pi(function(e){var t=this.doc;return t.cm=null,Yi(this,e),on(this),this.display.input.reset(),Gn(this,e.scrollLeft,e.scrollTop),this.curOp.forceScroll=!0,St(this,"swapDoc",this,t),t}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Oe(e),e.registerHelper=function(t,i,r){n.hasOwnProperty(t)||(n[t]=e[t]={_global:[]}),n[t][i]=r},e.registerGlobalHelper=function(t,i,r,o){e.registerHelper(t,i,o),n[t]._global.push({pred:r,val:o})}}(jo);var Wa="iter insert remove copy getEditor constructor".split(" ");for(var Xa in Da.prototype)Da.prototype.hasOwnProperty(Xa)&&d(Wa,Xa)<0&&(jo.prototype[Xa]=function(e){return function(){return e.apply(this.doc,arguments)}}(Da.prototype[Xa]));return Oe(Da),jo.inputStyles={textarea:Ga,contenteditable:Ua},jo.defineMode=function(e){jo.defaults.mode||"null"==e||(jo.defaults.mode=e),$e.apply(this,arguments)},jo.defineMIME=function(e,t){Js[e]=t},jo.defineMode("null",function(){return{token:function(e){return e.skipToEnd()}}}),jo.defineMIME("text/plain","null"),jo.defineExtension=function(e,t){jo.prototype[e]=t},jo.defineDocExtension=function(e,t){Da.prototype[e]=t},jo.fromTextArea=function(e,t){function n(){e.value=l.getValue()}if(t=t?u(t):{},t.value=e.value,!t.tabindex&&e.tabIndex&&(t.tabindex=e.tabIndex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),null==t.autofocus){var i=s();t.autofocus=i==e||null!=e.getAttribute("autofocus")&&i==document.body}var r;if(e.form&&(Gs(e.form,"submit",n),!t.leaveSubmitMethodAlone)){var o=e.form;r=o.submit;try{var a=o.submit=function(){n(),o.submit=r,o.submit(),o.submit=a}}catch(e){}}t.finishInit=function(t){t.save=n,t.getTextArea=function(){return e},t.toTextArea=function(){t.toTextArea=isNaN,n(),e.parentNode.removeChild(t.getWrapperElement()),e.style.display="",e.form&&(Ee(e.form,"submit",n),"function"==typeof e.form.submit&&(e.form.submit=r))}},e.style.display="none";var l=jo(function(t){return e.parentNode.insertBefore(t,e.nextSibling)},t);return l},function(e){e.off=Ee,e.on=Gs,e.wheelEventPixels=Pi,e.Doc=Da,e.splitLines=Xs,e.countColumn=h,e.findColumn=p,e.isWordChar=x,e.Pass=Os,e.signal=Ie,e.Line=oa,e.changeEnd=ji,e.scrollbarModel=fa,e.Pos=P,e.cmpPos=N,e.modes=Zs,e.mimeModes=Js,e.resolveMode=Ue,e.getMode=Ge,e.modeExtensions=ea,e.extendMode=We,e.copyState=Xe,e.startState=Ke,e.innerMode=Ye,e.commands=Oa,e.keyMap=ka,e.keyName=ao,e.isModifierKey=oo,e.lookupKey=ro,e.normalizeKeyMap=io,e.StringStream=ta,e.SharedTextMarker=wa,e.TextMarker=Sa,e.LineWidget=qa,e.e_preventDefault=Pe,e.e_stopPropagation=Ne,e.e_stop=Fe,e.addClass=a,e.contains=o,e.rmClass=As,e.keyNames=Ea}(jo),jo.version="5.28.0",jo}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("cm")):"function"==typeof define&&define.amd?define("cm.matchbrackets",["cm"],e):e(CodeMirror)}(function(e){function t(e,t,i,r){var o=e.getLineHandle(t.line),l=t.ch-1,c=l>=0&&a[o.text.charAt(l)]||a[o.text.charAt(++l)];if(!c)return null;var u=">"==c.charAt(1)?1:-1;if(i&&u>0!=(l==t.ch))return null;var h=e.getTokenTypeAt(s(t.line,l+1)),d=n(e,s(t.line,l+(u>0?1:0)),u,h||null,r);return null==d?null:{from:s(t.line,l),to:d&&d.pos,match:d&&d.ch==c.charAt(0),forward:u>0}}function n(e,t,n,i,r){for(var o=r&&r.maxScanLineLength||1e4,l=r&&r.maxScanLines||1e3,c=[],u=r&&r.bracketRegex?r.bracketRegex:/[(){}[\]]/,h=n>0?Math.min(t.line+l,e.lastLine()+1):Math.max(e.firstLine()-1,t.line-l),d=t.line;d!=h;d+=n){var p=e.getLine(d);if(p){var f=n>0?0:p.length-1,m=n>0?p.length:-1;if(!(p.length>o))for(d==t.line&&(f=t.ch-(n<0?1:0));f!=m;f+=n){var g=p.charAt(f);if(u.test(g)&&(void 0===i||e.getTokenTypeAt(s(d,f+1))==i))if(">"==a[g].charAt(1)==n>0)c.push(g);else{if(!c.length)return{pos:s(d,f),ch:g};c.pop()}}}}return d-n!=(n>0?e.lastLine():e.firstLine())&&null}function i(e,n,i){for(var r=e.state.matchBrackets.maxHighlightLineLength||1e3,a=[],l=e.listSelections(),c=0;c<l.length;c++){var u=l[c].empty()&&t(e,l[c].head,!1,i);if(u&&e.getLine(u.from.line).length<=r){var h=u.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";a.push(e.markText(u.from,s(u.from.line,u.from.ch+1),{className:h})),u.to&&e.getLine(u.to.line).length<=r&&a.push(e.markText(u.to,s(u.to.line,u.to.ch+1),{className:h}))}}if(a.length){o&&e.state.focused&&e.focus();var d=function(){e.operation(function(){for(var e=0;e<a.length;e++)a[e].clear()})};if(!n)return d;setTimeout(d,800)}}function r(e){e.operation(function(){l&&(l(),l=null),l=i(e,!1,e.state.matchBrackets)})}var o=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),s=e.Pos,a={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},l=null;e.defineOption("matchBrackets",!1,function(t,n,i){i&&i!=e.Init&&t.off("cursorActivity",r),n&&(t.state.matchBrackets="object"==typeof n?n:{},t.on("cursorActivity",r))}),e.defineExtension("matchBrackets",function(){i(this,!0)}),e.defineExtension("findMatchingBracket",function(e,n,i){return t(this,e,n,i)}),e.defineExtension("scanForBracket",function(e,t,i,r){return n(this,e,t,i,r)})}),define("general.components/codearea/qlikview-script-mode-constants",[],function(){return{REGEXP_WORD:/[^\s\(\)\"\'\,\+\$\*\-\<\>\=\&\/\!\{\}\;\:\@\`\\[\]]/,REGEXP_WORD_SEPARATOR:/[\s\(\)\"\'\,\+\$\*\-\<\>\=\&\/\!\{\}\;\:\@\`\\[\]]/}}),define("general.components/codearea/qlikview-script-mode",["./qlikview-script-mode-constants","cm"],function(e,t){var n=e.REGEXP_WORD;return t.defineMode("qlikviewscript",function(e,t){function i(e,t,n){return t.tokenize=n,n(e,t)}function r(e,t){for(var n;null!=(n=e.next());)if(n==t)return!1;return!1}function o(e,t,n){return q=e,C=n,t}function s(e,r){if(e.eatSpace())return q="whitespace",null;q="any";var s=e.next();if(w.test(s))return"["===s?i(e,r,l("]")):i(e,r,l(s));if(/[\[\]{}\(\),;\:]/.test(s))return o(s);if("0"==s&&e.eat(/x/i))return e.eatWhile(/[\da-f]/i),o("number","number");if(/[\.\d]/.test(s))return e.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),!e.eol()&&(s=e.peek(),/[A-z]/.test(s))?"normaltext":"number";if("/"===s)return e.eat("*")?i(e,r,c):e.eat("/")?(e.skipToEnd(),"comment"):(e.eatWhile(S),"operator");if(S.test(s))return e.eatWhile(S),o(s,"operator");if("$"===s&&e.match(/^\(=/,!1,!0))return o("$");if("$"===s&&e.match(/^\((MUST_INCLUDE|INCLUDE)=/i,!1,!0))return o("$");if("$"===s&&e.match(/^\(/,!1,!0))return r.tokenize=h,o("$(");e.eatWhile(n);var a=e.current(),d=a.toLowerCase();return"rem"===d?i(e,r,u):t.service.isFunction(d)&&e.match(/(^\s*\()/,!1,!0)?o("function","keyword",d):t.service.isField(a)?o("field","field"):t.service.isVariable(a)?o("variable","variable"):t.service.isKeyword(d)?o("keyword","keyword"):"normaltext"}function a(e){return e.substr(1,e.length-2)}function l(e){return function(n,i){if(!r(n,e)&&(i.tokenize=s,"'"!==e)){var l=a(n.current(),e);if(t.service.isField(l))return o("field","field");if(t.service.isVariable(l))return o("variable","variable")}return o("string","string")}}function c(e,t){for(var n,i=!1;n=e.next();){if("/"==n&&i){t.tokenize=s;break}i="*"==n}return o("comment","comment")}function u(e,t){for(var n;n=e.next();)if(";"==n){t.tokenize=s;break}return o("comment","comment")}function h(e,n){q="any";var i=e.next();if(")"==i&&(n.tokenize=s),/[\(\),]/.test(i))return o(i);e.eatWhile(/[^(),]/);var r=e.current();return!/^\d/.test(r)&&t.service.isVariable(r)?o("variable","variable"):"normaltext"}function d(e,t,n,i){this.type=e,this.prev=t,this.info=n,this.pos=i}function p(e,t,n,i,r){var o=e.cc;for(_.state=e,_.stream=r,_.marked=null,_.cc=o;;)if((o.length?o.pop():x)(n,i)){for(;o.length&&o[o.length-1].lex;)o.pop()();return _.marked?_.marked:t}}function f(){for(var e=arguments.length-1;e>=0;e--)_.cc.push(arguments[e])}function m(){return f.apply(null,arguments),!0}function g(e,t){var n=function(){var n=_.state;n.lexical=new d(e,n.lexical,t,_.stream.pos)};return n.lex=!0,n}function v(){var e=_.state;e.lexical.prev&&(e.lexical=e.lexical.prev)}function y(e){return function(t){return t==e?m():";"==e?f():m(arguments.callee)}}function b(e,t){return function n(i){return i==t?m():f(e,n)}}function x(e){return"function"==e?m(g("qvfunction",C),y("("),b(x,")"),v):"("===e?m(b(x,")")):"$("===e?m(y("("),b(x,")")):m()}var q,C,S=/[+\-*&=<>]/,w=/[\u0022\u0027\u0060\u00b4[]/,_={state:null,column:null,marked:null,cc:null};return v.lex=!0,{startState:function(){return{tokenize:s,lastType:null,cc:[],lexical:new d("block")}},token:function(e,t){var n=t.tokenize(e,t);return"comment"==q?n:(t.lastType=q,p(t,n,q,C,e))},lineComment:"//"}}),{REGEXP_WORD:n}}),define("general.components/codearea/codearea-function-tip",["qvangular","general.services/show-service/show-service"],function(e,t){"use strict";e.directive("qvCodeareaFunctionTip",function(){return{restrict:"A",require:"qvCodearea",link:function(n,i,r,o){var s,a,l=22,c=n.$watch(r.qvCodeareaFunctionTip,function(i){function r(){var e=o.codemirror.getCursor(),t=o.codemirror.getTokenAt(e,!0);if("comment"!==t.type){for(var n=0,i=t.state.lexical;i&&"qvfunction"!==i.type||0===n&&i.info&&t.string.toLowerCase()===i.info.toLowerCase();)i=i.prev,n++;return i}}function u(e,t){for(var n,i=o.codemirror.getCursor(),r={line:i.line,ch:i.ch};r.line>=0;){if(n=o.codemirror.getLine(r.line).toLowerCase(),n.substring(e.pos-t.length,e.pos)===t){r.ch=e.pos-t.length;break}r.line-=1}var s=o.codemirror.charCoords(r);return s.top-=o.codemirror.defaultTextHeight()+l,s}function h(){var n=r(),o=n?n.info:void 0,a=o?i.service.getFunctionTip(o):void 0;e.$apply(e.$rootScope,function(){if(d(),a){var e=u(n,o);m(),s=t.show(i.view,{content:a,offset:e})}})}function d(){g(),s&&(s.destroy(),s=void 0)}function p(){clearTimeout(a),a=setTimeout(h,250)}function f(){d()}function m(){o.codemirror.addKeyMap(v)}function g(){o.codemirror.removeKeyMap(v)}var v={Esc:function(){n.$apply(function(){d()})}};i&&(o.codemirror.on("blur",f),o.codemirror.on("cursorActivity",p),n.$on("$destroy",function(){o.codemirror.off("blur",f),o.codemirror.off("cursorActivity",p),d()}),c())},!0)}}})}),define("text!general.components/autocomplete-view/autocomplete-view.ng.html",[],function(){return'<div class="qv-autocomplete-container">\n\t<ul class="codearea-autocomplete-hints">\n\t\t<li ng-repeat="item in state.hints track by item.text"\n\t\t\tqva-scroll-into-view="{ scroll: state.selectedHint == $index, scrollSelector: \'.codearea-autocomplete-hints\' }"\n\t\t\tclass="codearea-autocomplete-hint"\n\t\t\tng-class="{ \'codearea-autocomplete-hint-active\': state.selectedHint == $index }"\n\t\t\tng-mouseover="state.selectedHint = $index;"\n\t\t\tqva-activate="state.choose( $index )">\n\n\t\t\t<div class="codearea-autocomplete-hint-text">{{item.text}}</div>\n\t\t\t<div ng-repeat="type in item.types track by $index"\n\t\t\t\t class="codearea-autocomplete-hint-type {{type.id}}"\n\t\t\t\t q-translation="{{type.key}}"></div>\n\t\t</li>\n\t</ul>\n</div>\n'}),define("general.components/autocomplete-view/autocomplete-view",["text!./autocomplete-view.ng.html","jquery"],function(e,t){"use strict";function n(e,t,n){var i=n.bottom+e.height<=t.height?n.bottom:n.top-e.height,r=Math.max(0,n.left+e.width-t.width);return{top:i,left:n.left-r}}function i(e,t){e.$$postDigest(function(){e.$$postDigest(t)})}return{scope:{state:"="},template:e,controller:["$scope","$element",function(e,r){function o(){var t={width:a.width(),height:a.height()},i=n(s[0].getBoundingClientRect(),t,e.state.cursorPos);s.css({left:i.left,top:i.top})}var s=r.find(".qv-autocomplete-container"),a=t(window);e.$watch("state.hints.length",function(){i(e,o)})}]}}),define("general.components/codearea/codearea-autocomplete",["jquery","qvangular","general.services/show-service/show-service","general.components/autocomplete-view/autocomplete-view","core.utils/resize","general.components/codearea/qlikview-script-mode-constants"],function(e,t,n,i,r,o){"use strict";function s(e){var t=e.getTokenAt(e.getCursor()).type;return"keyword"===t||"field"===t||"variable"===t}function a(e,t,n){if(e.somethingSelected()||s(e)&&!n||t.disabled)return null;var i=t.getHints(e),r=i.list;if(0===r.length)return null;r.length>d&&(r=r.slice(0,d));var o=e.cursorCoords(!1!==t.alignWithWord?i.from:null);return{from:i.from,to:i.to,hints:r,selectedHint:n?n.selectedHint:0,cursorPos:o}}function l(e,n){this.dialogHandle=null,this.dialogOptions={},this.state=null,this.options=n,this.cm=e,this.currentOptions=null,this.once=null,this.closingOnBlur=null,this.bound={cursorActivity:this.cursorActivity.bind(this),pick:this.pick.bind(this),close:this.close.bind(this),onBlur:this.onBlur.bind(this),onFocus:this.onFocus.bind(this),choose:this.choose.bind(this),showHint:this.showHint.bind(this)};var i=this;this.ourMap={Up:function(){i.changeActive(i.state.selectedHint-1),t.$rootScope.$apply()},Down:function(){i.changeActive(i.state.selectedHint+1),t.$rootScope.$apply()},PageUp:function(){i.changeActive(i.state.selectedHint-8),t.$rootScope.$apply()},PageDown:function(){i.changeActive(i.state.selectedHint+8),t.$rootScope.$apply()},Home:function(){i.changeActive(0),t.$rootScope.$apply()},End:function(){i.changeActive(i.state.hints.length-1),t.$rootScope.$apply()},Enter:this.bound.pick,Tab:this.bound.pick,Esc:this.bound.close}}function c(e){return"["+e.replace(/\]/g,"]]")+"]"}function u(e,t){var n={},i=[],r=e.toLowerCase(),o="["===e[0];return!o&&p.test(e)||/^\d+$/.test(e)?[]:(""!==e&&(t.forEach(function(e){"string"==typeof e&&(e={text:e});var t=e.text;if(o){if(!f[e.type]||!f[e.type].allowQuote)return;t=c(t)}t&&0===t.toLowerCase().indexOf(r)&&(n[t]||(n[t]={text:e.text,types:[],value:e.value||t},i.push(n[t])),f[e.type]&&n[t].types.push({id:e.type,key:f[e.type].translation}))}),i.sort(function(e,t){var n=e.text.toLowerCase(),i=t.text.toLowerCase();return n===i?0:n>i?1:-1})),1===i.length&&e===i[0].value&&(i=[]),i)}function h(e,t){var n=e.getCursor(),i=e.getTokenAt(n);return{list:u(i.string,t),from:{line:n.line,ch:i.start},to:{line:n.line,ch:i.end}}}var d=100,p=o.REGEXP_WORD_SEPARATOR;l.prototype.cursorActivity=function(){var e=t.getService("$timeout");e.cancel(this.once),this.once=null,this.cm.getCursor().line!==this.startLine||this.cm.somethingSelected()?this.close():this.once=e(this.bound.showHint,70)},l.prototype.choose=function(e){this.changeActive(e),this.pick()},l.prototype.pick=function(){this.cm.replaceRange(this.state.hints[this.state.selectedHint].value,this.state.from,this.state.to),this.cm.focus(),this.close(),t.$apply(t.$rootScope)},l.prototype.onBlur=function(){var e=t.getService("$timeout");this.closingOnBlur=e(this.bound.close,300)},l.prototype.onFocus=function(){t.getService("$timeout").cancel(this.closingOnBlur),this.closingOnBlur=null},l.prototype.changeActive=function(e){this.state&&(e=Math.max(0,Math.min(e,this.state.hints.length-1)),this.state.selectedHint!==e&&(this.state.selectedHint=e))},l.prototype.close=function(){var e=t.getService("$timeout");e.cancel(this.once),e.cancel(this.startTimeout),this.dialogHandle&&(this.dialogHandle.destroy(),this.dialogHandle=null,this.cm.removeKeyMap(this.ourMap),this.cm.off("cursorActivity",this.bound.cursorActivity),this.cm.off("blur",this.bound.onBlur),this.cm.off("focus",this.bound.onFocus),this.cm.off("scroll",this.bound.close),this.state=null,t.$apply(t.$rootScope))},l.prototype.open=function(){this.dialogHandle=n.show(this.options.view,this.dialogOptions),this.startLine=this.cm.getCursor().line,this.cm.addKeyMap(this.ourMap),this.cm.on("cursorActivity",this.bound.cursorActivity),this.cm.on("blur",this.bound.onBlur),this.cm.on("focus",this.bound.onFocus),this.cm.on("scroll",this.bound.close)},l.prototype.showHint=function(){var e=this.state;this.state=a(this.cm,this.options,e),this.state?(this.state.choose=this.bound.choose,this.dialogOptions.state=this.state,e||this.open()):e&&this.close()},l.prototype.start=function(){var e=t.getService("$timeout");this.state||(this.startTimeout&&e.cancel(this.startTimeout),this.startTimeout=e(this.bound.showHint,500))};var f={keyword:{translation:"Common.Keyword",allowQuote:!1},variable:{translation:"Common.Variable",allowQuote:!0},field:{translation:"Common.Field",allowQuote:!0},function:{translation:"Common.Function",allowQuote:!1}};return t.directive("qvCodeareaAutocomplete",function(){return{restrict:"A",require:"qvCodearea",link:function(t,n,o,s){var a=[37,38,39,40,33,34,27],c=t.$watch(o.qvCodeareaAutocomplete,function(n){function o(){d.start()}function u(t,n){-1===e.inArray(n.which,a)&&o()}if(n){n.view||(n.view=i),n.getHints||(n.getHints=function(e){return h(e,n.service.getAutocompleteList())});var d=new l(s.codemirror,n),p=d.close.bind(d);s.codemirror.on("focus",o),s.codemirror.on("keyup",u),r.on("end",p),t.$on("$destroy",function(){s.codemirror.off("focus",o),s.codemirror.off("keyup",u),r.off("end",p),d.close()}),c()}},!0)}}}),{getCompletions:u}}),define("general.components/codearea/search-cursor",["cm"],function(e){function t(e,t,i,r){if(this.atOccurrence=!1,this.cm=e,r||"string"!=typeof t||(r=!1),i=i?e.clipPos(i):n(0,0),this.pos={from:i,to:i},t||(t=""),"string"!=typeof t)t.global||(t=new RegExp(t.source,t.ignoreCase?"ig":"g")),this.matches=function(i,r){var o,s,a;if(i){for(t.lastIndex=0,o=e.getLine(r.line).slice(0,r.ch),s=t.exec(o),a=0;s;){a+=s.index+1,o=o.slice(a),t.lastIndex=0;var l=t.exec(o);if(!l)break;s=l}a--}else t.lastIndex=r.ch,o=e.getLine(r.line),a=(s=t.exec(o))&&s.index;if(s&&s[0])return{from:n(r.line,a),to:n(r.line,a+s[0].length),match:s}};else{r||(t=t.toLowerCase());var o=r?function(e){return e}:function(e){return e.toLowerCase()},s=t.split("\n");1==s.length?t.length?this.matches=function(i,r){var s,a=o(e.getLine(r.line)),l=t.length;if(i?r.ch>=l&&-1!=(s=a.lastIndexOf(t,r.ch-l)):-1!=(s=a.indexOf(t,r.ch)))return{from:n(r.line,s),to:n(r.line,s+l)}}:this.matches=function(){}:this.matches=function(t,i){var r=i.line,a=t?s.length-1:0,l=s[a],c=o(e.getLine(r)),u=t?c.indexOf(l)+l.length:c.lastIndexOf(l);if(!(t?u>=i.ch||u!=l.length:u<=i.ch||u!=c.length-l.length))for(;;){if(t?!r:r==e.lineCount()-1)return;if(c=o(e.getLine(r+=t?-1:1)),l=s[t?--a:++a],!(a>0&&a<s.length-1)){var h=t?c.lastIndexOf(l):c.indexOf(l)+l.length;if(t?h!=c.length-l.length:h!=l.length)return;var d=n(i.line,u),p=n(r,h);return{from:t?p:d,to:t?d:p}}if(c!=l)return}}}}var n=e.Pos;return t.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){function t(e){var t=n(e,0);return i.pos={from:t,to:t},i.atOccurrence=!1,!1}for(var i=this,r=this.cm.clipPos(e?this.pos.from:this.pos.to);;){if(this.pos=this.matches(e,r))return this.pos.from&&this.pos.to||window.console.log(this.matches,this.pos),this.atOccurrence=!0,this.pos.match||!0;if(e){if(!r.line)return t(0);r=n(r.line-1,this.cm.getLine(r.line-1).length)}else{var o=this.cm.lineCount();if(r.line==o-1)return t(o);r=n(r.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(t){if(this.atOccurrence){var i=e.splitLines(t);this.cm.replaceRange(i,this.pos.from,this.pos.to),this.pos.to=n(this.pos.from.line+i.length-1,i[i.length-1].length+(1==i.length?this.pos.from.ch:0))}}},{getSearchCursor:function(e,n,i,r){return new t(e,n,i,r)}}}),define("general.components/codearea/search-util",["general.utils/string-util"],function(e){"use strict";var t=2e3;return{MAX_NBR_OF_HITS:t,getMaxNumberOfHits:function(n,i,r){var o=e.occurrencesRE(n,i,r);return o>=t?t:o}}}),define("general.components/codearea/searcher",["./search-cursor","./search-util"],function(e,t){"use strict";function n(){this.posFrom=this.posTo=this.query=null,this.marked=[]}return{createSingleCodeareaSearcher:function(i){function r(t,n,r){return e.getSearchCursor(i,t,n,r)}function o(e){f.validQuery=!0;try{return e}catch(t){return f.validQuery=!1,e}}function s(){i.operation(function(){var e;if(p.query){for(p.query=null,e=0;e<p.marked.length;++e)p.marked[e].clear();p.marked.length=0}}),a()}function a(){d&&d.clear()}function l(){a(),d=i.markText(h.from(),h.to(),{className:"cm-current"}),i.setCursor(h.to()),p.posFrom=h.from(),p.posTo=h.to()}function c(e,t){var n=h.find(e);return n?(l(),i.scrollIntoView(h.from(),i.getScrollInfo().clientHeight/2)):t&&t(),n}function u(e){return h=r(p.query,{line:0,ch:0},e),c(!1)}var h,d,p=new n,f={doSearch:function(e,n,a,l){var u=0;return s(),e?(i.operation(function(){p.query=o(e);var s={line:0,ch:0};if(!n&&h&&h.from()&&(s=h.from()),h=r(p.query,{line:0,ch:0},l),u=t.getMaxNumberOfHits(i.getValue(),e,l),i.lineCount()<2e3)for(;h.findNext();)p.marked.push(i.markText(h.from(),h.to(),{className:"cm-searching"}));p.posFrom=p.posTo=i.getCursor(),h=r(p.query,s,l)}),a&&c(),f.hits=u,u):(f.hits=0,0)},clearMarkedSearch:s,doFindNext:c,doFindFirst:u,doFindLast:function(e){var t=i.lastLine(),n=i.getLine(t).length;return h=r(p.query,{line:t,ch:n},e),c(!0)},doReplaceAll:function(e,t,n){if(e){var s=0;return e=o(e),i.operation(function(){for(h=r(e,void 0,n);h.findNext();){s++;var i="string"==typeof p.query?t:h.pos.match[0].replace(p.query,t);h.replace(i)}}),f.hits=0,s}},doReplace:function(e,t,n,i){var r="string"==typeof p.query?t:h.pos.match[0].replace(p.query,t);h.atOccurrence||u(n),h.replace(r),f.hits--,h.find(e)?l():i&&i()},hits:0,validQuery:!0};return f}}}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("cm")):"function"==typeof define&&define.amd?define("cm.comment",["cm"],e):e(CodeMirror)}(function(e){"use strict";function t(e){var t=e.search(i);return-1==t?0:t}var n={},i=/[^\s\u00a0]/,r=e.Pos;e.commands.toggleComment=function(e){e.toggleComment()},e.defineExtension("toggleComment",function(e){e||(e=n);for(var t=this,i=1/0,o=this.listSelections(),s=null,a=o.length-1;a>=0;a--){var l=o[a].from(),c=o[a].to();l.line>=i||(c.line>=i&&(c=r(i,0)),i=l.line,null==s?t.uncomment(l,c,e)?s="un":(t.lineComment(l,c,e),s="line"):"un"==s?t.uncomment(l,c,e):t.lineComment(l,c,e))}}),e.defineExtension("lineComment",function(e,o,s){s||(s=n);var a=this,l=a.getModeAt(e),c=s.lineComment||l.lineComment;if(c){if(null!=a.getLine(e.line)){var u=Math.min(0!=o.ch||o.line==e.line?o.line+1:o.line,a.lastLine()+1),h=null==s.padding?" ":s.padding,d=s.commentBlankLines||e.line==o.line;a.operation(function(){if(s.indent){for(var n=null,o=e.line;o<u;++o){var l=(p=a.getLine(o)).slice(0,t(p));(null==n||n.length>l.length)&&(n=l)}for(o=e.line;o<u;++o){var p=a.getLine(o),f=n.length;(d||i.test(p))&&(p.slice(0,f)!=n&&(f=t(p)),a.replaceRange(n+c+h,r(o,0),r(o,f)))}}else for(o=e.line;o<u;++o)(d||i.test(a.getLine(o)))&&a.replaceRange(c+h,r(o,0))})}}else(s.blockCommentStart||l.blockCommentStart)&&(s.fullLines=!0,a.blockComment(e,o,s))}),e.defineExtension("blockComment",function(e,t,o){o||(o=n);var s=this,a=s.getModeAt(e),l=o.blockCommentStart||a.blockCommentStart,c=o.blockCommentEnd||a.blockCommentEnd;if(l&&c){var u=Math.min(t.line,s.lastLine());u!=e.line&&0==t.ch&&i.test(s.getLine(u))&&--u;var h=null==o.padding?" ":o.padding;e.line>u||s.operation(function(){if(0!=o.fullLines){var n=i.test(s.getLine(u));s.replaceRange(h+c,r(u)),s.replaceRange(l+h,r(e.line,0));var d=o.blockCommentLead||a.blockCommentLead;if(null!=d)for(var p=e.line+1;p<=u;++p)(p!=u||n)&&s.replaceRange(d+h,r(p,0))}else s.replaceRange(c,t),s.replaceRange(l,e)})}else(o.lineComment||a.lineComment)&&0!=o.fullLines&&s.lineComment(e,t,o)}),e.defineExtension("uncomment",function(e,t,o){o||(o=n);var s,a=this,l=a.getModeAt(e),c=Math.min(0!=t.ch||t.line==e.line?t.line:t.line-1,a.lastLine()),u=Math.min(e.line,c),h=o.lineComment||l.lineComment,d=[],p=null==o.padding?" ":o.padding;e:if(h){for(var f=u;f<=c;++f){var m=a.getLine(f),g=m.indexOf(h);if(g>-1&&!/comment/.test(a.getTokenTypeAt(r(f,g+1)))&&(g=-1),-1==g&&(f!=c||f==u)&&i.test(m))break e;if(g>-1&&i.test(m.slice(0,g)))break e;d.push(m)}if(a.operation(function(){for(var e=u;e<=c;++e){var t=d[e-u],n=t.indexOf(h),i=n+h.length;n<0||(t.slice(i,i+p.length)==p&&(i+=p.length),s=!0,a.replaceRange("",r(e,n),r(e,i)))}}),s)return!0}var v=o.blockCommentStart||l.blockCommentStart,y=o.blockCommentEnd||l.blockCommentEnd;if(!v||!y)return!1;var b=o.blockCommentLead||l.blockCommentLead,x=a.getLine(u),q=c==u?x:a.getLine(c),C=x.indexOf(v),S=q.lastIndexOf(y);if(-1==S&&u!=c&&(q=a.getLine(--c),S=q.lastIndexOf(y)),-1==C||-1==S||!/comment/.test(a.getTokenTypeAt(r(u,C+1)))||!/comment/.test(a.getTokenTypeAt(r(c,S+1))))return!1;var w=x.lastIndexOf(v,e.ch),_=-1==w?-1:x.slice(0,e.ch).indexOf(y,w+v.length);if(-1!=w&&-1!=_&&_+y.length!=e.ch)return!1;_=q.indexOf(y,t.ch);var D=q.slice(t.ch).lastIndexOf(v,_-t.ch);return w=-1==_||-1==D?-1:t.ch+D,(-1==_||-1==w||w==t.ch)&&(a.operation(function(){a.replaceRange("",r(c,S-(p&&q.slice(S-p.length,S)==p?p.length:0)),r(c,S+y.length));var e=C+v.length;if(p&&x.slice(e,e+p.length)==p&&(e+=p.length),a.replaceRange("",r(u,C),r(u,e)),b)for(var t=u+1;t<=c;++t){var n=a.getLine(t),o=n.indexOf(b);if(-1!=o&&!i.test(n.slice(0,o))){var s=o+b.length;p&&n.slice(s,s+p.length)==p&&(s+=p.length),a.replaceRange("",r(t,o),r(t,s))}}}),!0)})}),define("general.components/codearea/codearea-exposed-context-api",["qvangular","cm","cm.comment"],function(e,t){var n="\r\n";e.directive("qvCodeareaExposedContextApi",["$parse","$timeout",function(e,i){return{require:["qvCodearea","qvCodeareaExposedContextApi"],link:function(t,n,i,r){var o=r[0],s=r[1];s._connectCodeArea(o);var a=e(i.qvCodeareaExposedContextApi);a.assign(t,s),t.$on("$destroy",function(){a.assign(t,void 0),s._connectCodeArea(void 0)})},controller:function(){function e(){r.focus()}var r,o={applyToSelection:function(e){var t=e(r.codemirror.getDoc().getSelection());r.codemirror.replaceSelection(t)},focus:e,undo:function(){r.codemirror.undo()},redo:function(){r.codemirror.redo()},comment:function(){t.commands.toggleComment(r.codemirror),e()},indent:function(){r.codemirror.indentSelection("add"),e()},outdent:function(){r.codemirror.indentSelection("subtract"),e()},insertCode:function(e){r.codemirror.setCursor(r.codemirror.getCursor("end"));var t=r.codemirror.getCursor().line,i=r.codemirror.getCursor().ch,o=r.codemirror.getLine(t).length;o>0&&(i===o?(r.codemirror.setCursor(t,o),r.codemirror.replaceSelection(n)):(r.codemirror.setCursor(r.codemirror.lineCount(),0),e=n+n+e)),r.codemirror.setCursor(r.codemirror.getCursor("end")),r.codemirror.replaceSelection(e),r.focus()},replaceSelection:function(e){r.codemirror.replaceSelection(e,"end"),r.focus()},getFunctionNameUnderCursor:function(){for(var e=r.codemirror.getTokenAt(r.codemirror.getCursor()),t=0,n=e.state.lexical;n&&"qvfunction"!==n.type||0===t&&n.info&&e.string.toLowerCase()===n.info.toLowerCase();)n=n.prev,t++;return!!n&&n.info},gotoLine:function(e){i(function(){var t=r.codemirror.lineCount();e<t?r.codemirror.setCursor(e-1,0):r.codemirror.setCursor(t-2,0),r.focus()})},isReadOnly:function(){return r.codemirror.options.readOnly},_connectCodeArea:function(e){r=e},codemirror:void 0};return Object.defineProperty(o,"canUndo",{get:function(){return r&&r.codemirror&&r.codemirror.historySize().undo>0},enumerable:!0}),Object.defineProperty(o,"canRedo",{get:function(){return r&&r.codemirror&&r.codemirror.historySize().redo>0},enumerable:!0}),o}}}])}),define("general.components/codearea/codearea-exposed-touch-api",["jquery","qvangular"],function(e,t){function n(e,t){var n,i=e.length,r=t.length,o=Math.min(e.length,t.length);for(n=0;n<o&&e.charAt(n)===t.charAt(n);n++);if(n!==e.length||n!==t.length){var s,a,l=n;for(n=0;n<o&&(s=i-n-1,a=r-n-1,!(s<l||a<l))&&e.charAt(i-n-1)===t.charAt(r-n-1);n++);return{start:l,targetRange:{from:l,to:i-n-1+1},sourceRange:{from:l,to:r-n-1+1}}}}return t.directive("qvCodeareaExposedTouchApi",["$parse","$timeout",function(t,i){return{require:["qvCodearea","qvCodeareaExposedTouchApi"],link:function(e,n,r,o){var s=o[0],a=o[1];a._connectCodeArea(s);var l=t(r.qvCodeareaExposedTouchApi);l.assign(e,a),e.$on("$destroy",function(){l.assign(e,void 0),i(function(){a._connectCodeArea(void 0)})})},controller:["$scope",function(t){var r,o;return{_connectCodeArea:function(e){r=e},scrollTo:function(e,t){r.codemirror.scrollTo(t,e)},onScroll:function(n){function i(){var t=e(r.codemirror.getScrollerElement());n(t.scrollTop(),t.scrollLeft())}r.codemirror.on("scroll",i),t.$on("$destroy",function(){r.codemirror.off("scroll",i),n=void 0})},setOverlayFocuser:function(e){r.setCustomFocusFn(e)},replicateSelection:function(e,t,n){r&&r.codemirror.setSelection(e,t,n)},replicateContent:function(e,t){var i=n(r.codemirror.getValue("\n"),t);if(i){var s=t.substring(i.sourceRange.from,i.sourceRange.to),a=r.codemirror.posFromIndex(i.targetRange.from),l=r.codemirror.posFromIndex(i.targetRange.to);o=!0,r.codemirror.replaceRange(s,a,l),o=!1}},onNewContent:function(e){function n(){var t={anchor:r.codemirror.indexFromPos(r.codemirror.getCursor("anchor")),head:r.codemirror.indexFromPos(r.codemirror.getCursor("head"))};e(r.codemirror.getValue(),t)}function i(){o||n()}n(),r.codemirror.on("change",i),t.$on("$destroy",function(){r.codemirror.off("change",i),e=void 0})},onResize:function(n){t.$watch(function(){return String(r.codemirror.lineCount()).length},function(){i(function(){var t=e(r.codemirror.getGutterElement()).outerWidth();n({top:0,left:t,bottom:0,right:0})})}),t.$on("$destroy",function(){n=void 0})},disableSelections:function(){r.cssClasses["qv-codearea-disable-selection"]=!0},restoreSelections:function(){r.cssClasses["qv-codearea-disable-selection"]=!1}}}]}}]),{diff:n}}),define("general.components/codearea/codearea-exposed-search-api",["qvangular","general.components/codearea/searcher"],function(e,t){e.directive("qvCodeareaExposedSearchApi",["$parse",function(e){return{require:"qvCodearea",link:function(n,i,r,o){var s=e(r.qvCodeareaExposedSearchApi);s.assign(n,t.createSingleCodeareaSearcher(o.codemirror)),n.$on("$destroy",function(){s.assign(n,void 0)})},controller:function(){}}}])}),define("general.components/codearea/codearea-accelerators",["qvangular"],function(e){e.directive("qvCodeareaAccelerators",function(){return{require:["qvCodearea","qvCodeareaExposedContextApi"],link:function(t,n,i,r){function o(e,t){return e.keyCode===t.keyCode&&e.ctrlKey===(t.ctrlKey||!1)&&e.shiftKey===(t.shiftKey||!1)}function s(n,r){var s=t.$eval(i.qvCodeareaAccelerators);for(var a in s){var u=s[a];if(o(r,u)&&(!u.previous||o(c,u.previous)))return e.$apply(e.$rootScope,function(){u.fn(l)}),c={keyCode:void 0,ctrlKey:void 0,shiftKey:void 0},void r.preventDefault()}c={keyCode:r.keyCode,ctrlKey:r.ctrlKey,shiftKey:r.shiftKey}}var a=r[0],l=r[1],c={keyCode:void 0,ctrlKey:void 0,shiftKey:void 0};a.codemirror.on("keydown",s),t.$on("$destroy",function(){a.codemirror.off("keydown",s)})}}})}),define("general.components/codearea/codearea-breakpoints",["jquery","qvangular"],function(e,t){function n(t){var n=e("<div class='qv-codearea-breakpoint-marker' data-icon='debugger-breakpoint'></div>");return n.data("breakpoint",t),n[0]}function i(t,n){n.enabled?(e(t).addClass("qv-codearea-breakpoint-marker-enabled"),e(t).removeClass("qv-codearea-breakpoint-marker-disabled")):(e(t).addClass("qv-codearea-breakpoint-marker-disabled"),e(t).removeClass("qv-codearea-breakpoint-marker-enabled"))}t.directive("qvCodeareaBreakpoints",function(){return{require:"qvCodearea",link:function(r,o,s,a){function l(e){if(e){p=e;for(var t=a.codemirror.getDoc().lineCount(),r=0;r<t;r++){var o=e[r+1],s=a.codemirror.lineInfo(r).gutterMarkers,l=s&&s["qv-codearea-breakpoint"];o?(l||(l=n(o),a.codemirror.setGutterMarker(r,"qv-codearea-breakpoint",l)),i(l,o)):l&&a.codemirror.setGutterMarker(r,"qv-codearea-breakpoint",null)}}}function c(e){for(var t=a.codemirror.getDoc().lineCount(),n=e.from.line;n<t;n++){var i=a.codemirror.lineInfo(n).gutterMarkers;if(i&&i["qv-codearea-breakpoint"])return!0}return!1}function u(e){return e.text.length!==e.removed.length}function h(n,i){!a.supressChangeEvent&&u(i)&&c(i)&&t.$apply(t.$rootScope,function(){var t=p;for(var n in t)t.hasOwnProperty(n)&&delete t[n];for(var i=a.codemirror.getDoc().lineCount(),r=0;r<i;r++){var o=r+1,s=a.codemirror.lineInfo(r).gutterMarkers,l=s&&s["qv-codearea-breakpoint"];if(l){var c=e(l).data("breakpoint");c.lineNbr=o,t[o]=c}}})}function d(e,t){a.disabled||r.$apply(function(){var e=t+1;p[e]?delete p[e]:p[e]={enabled:!0,lineNbr:e}})}var p;r.$watch(s.qvCodeareaBreakpoints,l),r.$watch(s.qvCodeareaBreakpoints,l,!0),a.codemirror.on("change",h),a.codemirror.on("gutterClick",d);var f={F9:function(){d(a.codemirror,a.codemirror.getCursor().line)}};a.codemirror.addKeyMap(f),r.$on("$destroy",function(){a.codemirror.off("change",h),a.codemirror.off("gutterClick",d),a.codemirror.removeKeyMap(f)})}}})}),define("general.components/codearea/codearea-debug-location",["qvangular"],function(e){e.directive("qvCodeareaDebugLocation",function(){return{require:"qvCodearea",link:function(e,t,n,i){var r;e.$watch(n.qvCodeareaDebugLocation,function(e){if(e){var t=i.codemirror.lastLine()+1,n=e.lineNbr;n>t&&(n=t),r&&(i.codemirror.removeLineClass(r,"background","qv-codearea-current-debug-line"),i.codemirror.removeLineClass(r,"background","qv-codearea-current-debug-line-error")),n>0&&n<=t&&(i.codemirror.addLineClass(n-1,"background","qv-codearea-current-debug-line"),e.errorMessage&&i.codemirror.addLineClass(n-1,"background","qv-codearea-current-debug-line-error"),i.codemirror.scrollIntoView({line:n-1,ch:0},200),r=i.codemirror.getLineHandle(n-1))}},!0)}}})}),define("general.components/codearea/codearea-errors",["qvangular"],function(e){e.directive("qvCodeareaErrors",function(){return{require:"qvCodearea",link:function(e,t,n,i){var r=[];e.$watch(n.qvCodeareaErrors+".content",function(e){if(e){var t;for(t=0;t<r.length;t++)r[t].clear();for(t=0;t<e.length;t++){var n=e[t],o={line:n.qLineInTab,ch:n.qColInLine},s={line:n.qLineInTab,ch:n.qColInLine+n.qErrLen},a=i.codemirror.markText(o,s,{className:"cm-servererror"});r.push(a)}}},!0),e.$on("$destroy",function(){r=[]})}}})}),define("general.components/codearea/codemirror-change-limiter",[],function(){return function(e,t,n){var i=t.text.join("\n"),r=e.getRange(t.from,t.to).length,o=i.length,s=o-r,a=e.getValue().length;a>=n&&0===r?t.cancel():a+s>n&&(o=Math.max(0,n-a+r),i=i.substr(0,o),t.update(null,null,i.split("\n")))}}),define("general.components/codearea/codearea-limit",["qvangular","general.components/codearea/codemirror-change-limiter"],function(e,t){e.directive("qvCodeareaLimit",function(){return{require:"qvCodearea",link:function(e,n,i,r){function o(n,r){var o=e.$eval(i.qvCodeareaLimit);o&&o>0&&t(n,r,o)}r.codemirror.on("beforeChange",o),e.$on("$destroy",function(){r.codemirror.off("beforeChange",o)})}}})}),define("general.components/codearea/codearea-help-mode",["qvangular","jquery","core.utils/help-url","underscore"],function(e,t,n,i){function r(e,t){var n,i,r,o=[];for(i=0;i<e.length;i++)for(n=e[i].split(" "),r=0;r<n.length;r++)n[r].toLowerCase()===t.toLowerCase()&&(u||(u=n.length>1,h=r>0),o.push(e[i]));return o}function o(e,t,n){if(" "===n.string){var i=e.getTokenAt({ch:n.end+1,line:t.line});if(i.string.length>1)return i}return n}function s(e,t,n,i){var r=i?t.end-(t.string.length+1):t.end+2;return e.getTokenAt({ch:r,line:n.line})}function a(e,t,n,i){var r={left:t.pageX,top:t.pageY},o=e.coordsChar(r,"window");return c(e,e.getTokenAt(o),n,i)}function l(e,t,n,i){return c(e,e.getTokenAt(e.getCursor()),n,i)}function c(e,t,a,l){u=!1,h=!1,a=a||"scriptsyntax";var c,p,f=n.path+a+".",m=[];return("keyword"===t.type||"function"===t.type)&&(t=o(e,e.getCursor(),t),m=r(i.pluck(l.getAutocompleteList(),"text"),t.string),c=u&&r(m,(p=s(e,t,e.getCursor(),h)).string).length>0&&p.string!==t.string?h?p.string+"_"+t.string:t.string+"_"+p.string:t.string,f+=c,/firefox/.test(window.navigator.userAgent.toLocaleLowerCase())&&d&&d.close(),d=window.open(f,"__qlikviewhelp"),!0)}var u,h,d;e.directive("qvCodeareaHelpMode",["$parse",function(e){return{require:"qvCodearea",link:function(n,i,r,o){var s,c=n.$watch(r.qvCodeareaHelpModeOptions,function(u){function h(t){s&&(t.preventDefault(),a(o.codemirror,t,u.syntax,u.service)&&n.$apply(function(){e(r.qvCodeareaHelpMode).assign(n,!1)}))}function d(e,t){72!==t.keyCode&&104!==t.keyCode||!t.ctrlKey||(t.preventDefault(),l(o.codemirror,t,u.syntax,u.service))}c(),n.$watch(r.qvCodeareaHelpMode,function(e){s=e,o.cssClasses["qv-codearea-help-mode"]=e}),t(i).on("click",h),o.codemirror.on("keydown",d),n.$on("$destroy",function(){t(i).off("click",h),o.codemirror.off("keydown",d)})})}}}])}),define("general.components/codearea/codearea-touch-overlay",["qvangular"],function(e){e.directive("qvCodeareaTouchOverlay",function(){return{restrict:"E",replace:!0,scope:{codeareaTouchApi:"=",enabled:"=",helpMode:"="},template:'<div class="qv-codearea-touch-overlay-container" ng-style="containerStyle"><textarea class="qv-codearea-touch-overlay" autocorrect="off" autocapitalize="off" autocomplete="off" spellcheck="false" wrap="off"></textarea></div>',link:function(e,t){function n(t){function n(e,t){var n=e.substring(0,t).split("\n");return{line:n.length-1,ch:n[n.length-1].length}}function o(){var e=i.val(),r=i[0].selectionStart,o=i[0].selectionEnd,s=n(e,r),a=n(e,o);t.replicateSelection(s,a,{scroll:!1})}function s(){r||(i[0].selectionStart===a&&i[0].selectionEnd===l||(a=i[0].selectionStart,l=i[0].selectionEnd,o()),setTimeout(s,200))}/iPad|iPhone|iPod/.test(navigator.userAgent)&&i.css("padding-left","1px"),t.disableSelections(),e.$on("$destroy",function(){t.restoreSelections()}),t.onNewContent(function(e,t){i.val(e),i[0]===document.activeElement&&(i[0].selectionStart===t.anchor&&i[0].selectionEnd===t.head||(i[0].selectionStart=t.anchor,i[0].selectionEnd=t.head))}),t.setOverlayFocuser(function(){}),t.onResize(function(t){e.containerStyle.left=t.left}),t.onScroll(function(e,t){i.scrollTop(e),i.scrollLeft(t),document.activeElement===i[0]&&(""===i[0].style.textShadow?i[0].style.textShadow="rgba(0,0,0,0) 0 0 0":i[0].style.textShadow="")}),i.on("scroll",function(){t.scrollTo(i.scrollTop(),i.scrollLeft())}),i.on("input",function(e){var n=i.val();t.replicateContent(e,n)});var a,l;setTimeout(s,200)}var i=t.find("textarea"),r=!1;e.containerStyle={},e.$watch("helpMode",function(e){e?t.hide():t.show()});var o=e.$watch("codeareaTouchApi",function(e){e&&(n(e),o())});e.$on("$destroy",function(){r=!0,i=void 0})}}})}),define("general.components/codearea/codearea-block-large-pastes",["qvangular"],function(e){"use strict";e.directive("qvCodeareaBlockLargePastes",function(){var e=function(e){return""===e||isNaN(e)?1e6:e},t=function(e){return e.originalEvent.clipboardData?e.originalEvent.clipboardData.getData("text/plain").length:window.clipboardData.getData("Text").length};return{restrict:"A",controller:["$scope","$element","$attrs",function(n,i,r){i.find("textarea").on("paste",function(n){t(n)>e(r.qvCodeareaBlockLargePastes)&&n.preventDefault()}),n.$on("$destroy",function(){i.find("textarea").off("paste")})}]}})}),define("general.components/codearea/codearea-exposed-gutter-width",["jquery","qvangular"],function(e,t){t.directive("qvCodeareaExposedGutterWidth",["$parse","$timeout",function(t,n){return{require:"qvCodearea",link:function(i,r,o,s){var a=t(o.qvCodeareaExposedGutterWidth);i.$watch(function(){return String(s.codemirror.lineCount()).length},function(){var t=e(s.codemirror.getGutterElement()).outerWidth();a.assign(i,t),n(function(){var t=e(s.codemirror.getGutterElement()).outerWidth();a.assign(i,t)})}),i.$on("$destroy",function(){a.assign(i,void 0)})},controller:function(){}}}])}),define("general.components/codearea/codearea-composition-event",["qvangular","jquery","cm"],function(e,t,n){"use strict";function i(e){var t,n,i,r;for(i=0,r=(n=e.getAllMarks()).length;i<r;i++)null!=(t=n[i])&&t.className===g&&t.clear();return!0}function r(e,r){function g(){return window.navigator.userAgent.indexOf("MSIE ")>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)}var y=r;e.options.enableCompositionMod=!0,c=function(){u&&u(),e.display.input.blur(),e.display.input.focus()},l=function(t){if(h=t.char,u&&u(),e.display.inCompositionMode){var n=e.getCursor(),i=e.display.compositionHead,r=e.charCoords(n).left-e.charCoords(i).left;r+=void 0!==h?30:1,e.display.input.style.width=r+"px"}},o=function(){e.options.enableCompositionMod&&(m.disabled=!0,e.display.inCompositionMode=!0,p=y.offset(),e.display.inputDiv.classList.add("CodeMirror-input-wrapper"),e.display.inputDiv.classList.add("in-composition"),e.setOption("readOnly",!0),e.somethingSelected()&&e.replaceSelection(""),e.display.compositionHead=e.getCursor(),void 0===h?e.display.input.value="":" "===h&&s({data:" "}))},s=function(t){var n,i;if(e.options.enableCompositionMod&&e.display.inCompositionMode){var r=e.display.compositionHead;e.display.textMarkerInComposition?(n=e.display.textMarkerInComposition.find())&&(e.replaceRange(t.data,r,n.to),e.display.textMarkerInComposition.clear(),e.display.textMarkerInComposition=void 0):e.replaceRange(t.data,r,r);var o=e.getCursor();i=e.charCoords(o).left-e.charCoords(r).left,void 0===h&&(i+=1),e.display.input.style.width=i+"px",e.display.textMarkerInComposition=e.markText(r,o,v),d()}},a=function(t){var r;e.options.enableCompositionMod&&e.display.inCompositionMode&&(g()?"\b"===h&&s(t):s(t),e.display.inCompositionMode=!1,e.display.compositionHead=void 0,null!=(r=e.display.textMarkerInComposition)&&r.clear(),e.display.textMarkerInComposition=void 0,e.setOption("readOnly",!1),e.display.inputDiv.classList.remove("in-composition"),e.display.inputDiv.classList.remove("CodeMirror-input-wrapper"),i(e),u=function(){m.disabled=!1,n.off(e.display.input,"input",u),e.display.inCompositionMode||(e.display.input.value="",e.display.input.style.width="0px",u=void 0)},n.on(e.display.input,"input",u))},d=function(){if(e.display.inCompositionMode){var t=e.charCoords(e.display.compositionHead).top-p.top;void 0!==h&&(t-=1),e.display.inputDiv.style.top=t+"px";var n=e.charCoords(e.display.compositionHead).left-p.left;e.display.inputDiv.style.left=n+"px"}},f=function(n){var i=t(e.display.scroller);i.scrollTop(i.scrollTop()-n.wheelDelta)}}var o,s,a,l,c,u,h,d,p,f,m,g="CodeMirror-text-in-composition",v={inclusiveLeft:!0,inclusiveRight:!0,className:g};e.directive("qvCodeareaCompositionEvent",function(){return{restrict:"A",require:"qvCodearea",link:function(e,i,h,p){r(p.codemirror,i);var g=p.codemirror.display.input,v=e.$watch(h.qvCodeareaAutocomplete,function(e){m=e,v()});v=e.$watch("codeareaTouchApi",function(e){e&&(e.onResize(function(){d()}),e.onScroll(function(){d()}),v())}),t(window).on("resize",d),n.on(p.codemirror,"mousedown",c),n.on(g,"keydown",l),n.on(g,"compositionstart",o),n.on(g,"compositionupdate",s),n.on(g,"compositionend",a),n.on(g,"mousedown",c),n.on(g,"mousewheel",f),e.$on("$destroy",function(){t(window).off("resize",d),n.off(p.codemirror,"mousedown",c),n.off(g,"compositionstart",o),n.off(g,"keydown",l),n.off(g,"compositionupdate",s),n.off(g,"compositionend",a),n.off(g,"input",u),n.off(g,"mousedown",c),n.off(g,"mousewheel",f)})}}})}),define("general.components/codearea/codearea",["jquery","qvangular","cm","cm.matchbrackets","general.components/codearea/qlikview-script-mode","general.components/codearea/codearea-function-tip","general.components/codearea/codearea-autocomplete","general.components/codearea/searcher","general.components/codearea/codearea-exposed-context-api","general.components/codearea/codearea-exposed-touch-api","general.components/codearea/codearea-exposed-search-api","general.components/codearea/codearea-accelerators","general.components/codearea/codearea-breakpoints","general.components/codearea/codearea-debug-location","general.components/codearea/codearea-errors","general.components/codearea/codearea-limit","general.components/codearea/codearea-help-mode","general.components/codearea/codearea-touch-overlay","general.components/codearea/codearea-block-large-pastes","general.components/codearea/codearea-exposed-gutter-width","general.components/codearea/codearea-composition-event"],function(){}),define("assets/client/dialogs/expression-dialog/expression-dialog",["jquery","core.models/communication","core.utils/deferred","client.assets/tab-contents/fields/assets-field-list-model","general.utils/expression-validator","qvangular","text!assets/client/dialogs/expression-dialog/expression-dialog.ng.html","client.utils/state","assets/client/dialogs/expression-dialog/expression-dialog-controller","assets/client/dialogs/expression-dialog/expression-validation-info","general.utils/string-limits","client.services/validation","translator","general.components/function-tip-view/function-tip-view","touche","assets/client/dialogs/expression-dialog/expression-bnf","general.components/extract","general.components/codearea/codearea"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){function g(){q&&(q.close(),q=null)}function v(e,t){t.preventDefault();var n=e.controller.previewText();e.codearea.contextApi.replaceSelection(n)}function y(e,t){e.functionTipOptions={service:t,view:p}}function b(t,n,i,r){function s(){a(),n.codearea.contextApi.focus()}function a(){e(document).off("keydown",s),e(document).off("mouseup",s),g()}i&&(q?a():(i=i.replace(/\n/g," "),/^(input|textarea)$/i.test(document.activeElement.tagName)&&e.support.touch&&document.activeElement.blur(),(q=o.getService("luiPopover").show({template:"<lui-popover><lui-popover-body><p>{{input.text}}</p></lui-popover-body></lui-popover>",input:{text:i},controller:["$element",function(e){e.css("z-index","1022")}],alignTo:r.target,closeOnEscape:!0,closeOnOutside:!0,dock:"top",autoFocus:!1})).closed.then(function(){a()}),e(document).one("keydown",{self:this},s),e(document).one("mouseup",{self:this},s)))}function x(e,t){var n={expression:e,validity:t.validity};return h.validateExpr(n,u)}var q=null,C=!1,S={template:s,controller:["$scope","$element",function(e,t){function n(e){return e.replace(/(\r\n|\r|\n)/,"\r\n")}e.stringLimits=u,e.controller=e.input.controller,e.codearea={content:e.input.expr};var i=new r.ExpressionValidator(e.input.app,e.input.mode);e.validity={expression:!0},e.enableTouchOverlay=f.utils.touch,e.insertTextHandler=v.bind(null,e),e.$watch("controller.selectedTable",function(t){e.controller.setTableFilter(t)}),e.info=c.create({validator:i,labels:e.input.labels}),e.info.setExpr(e.input.expr),e.showErrorMessage=b.bind(null,t,e),e.qlikviewReloadScriptMode={name:"qlikviewscript",service:e.input.expressionBnfModel},e.helpModeOptions={syntax:"chartsyntax",service:e.input.expressionBnfModel},e.autocompleteOptions={completeSingle:!1,service:e.input.expressionBnfModel},y(e,e.input.expressionBnfModel),e.cancel=function(){e.close(),e.$destroy()},e.confirm=function(){var t=n(e.codearea.content);(x(t,e)||e.input.allowEmpty&&""===t)&&e.close(t)},a.StateChanged.bind(e.cancel),e.$watch("codearea.content",function(t){t=n(t),e.info.setExpr(t),e.validity.expression||x(t,e)}),e.$on("$destroy",function(){g(),C=!1,a.StateChanged.unbind(e.cancel)})}]};return{_insertTextHandler:v,show:function(e){return(e.app?n.resolve(e.app.enigmaModel):t.getApp()).then(function(t){return n.all({bnf:m.get(t),fields:t.getFieldList()}).then(function(r){if(C)return n.reject();var s=r.bnf,a=i.expand(r.fields),c=String(e.expr||""),u={title:e.title,allowEmpty:e.allowEmpty,labels:e.labels,expr:c,mode:e.mode,controller:l.create({fields:a,translator:d}),app:t,expressionBnfModel:s};return C=!0,o.getService("luiDialog").show({template:S.template,controller:S.controller,input:u,closeOnOutside:!1,showArrow:!1}).closed.then(function(e){return void 0===e?n.reject():e})})})},isOpen:function(){return C}}}),define("client.property-panel/property-panel-directives",["jquery","angular","qvangular","core.utils/resize","client.property-panel/component-utils","general.utils/expression-validator","assets/client/dialogs/expression-dialog/expression-dialog","util","general.utils/dom-util","general.utils/support","jqueryui"],function(e,t,n,i,r,o,s,a,l,c){function u(e){return"ValueExpr"===e||"ValueExpression"===e?o.Modes.NumberOrExpression:o.Modes.Expression}function h(e){return"="===(e=e||"")[0]?e:"="+e}return n.directive("ppSortable",[function(){return{scope:"=",link:function(t,n,i){t.$watch(i.ppSortable,function(i){if(i){var r;i=a.extend({},{handle:"[pp-sortable-handle]",start:function(e,t){t.item.data("startPos",t.item.index())},scrollSpeed:c.treatAsDesktop()?25:60,distance:c.treatAsDesktop()?10:0,items:"> :not(.locked)",cancel:".locked",update:function(e,n){var r=n.item.index(),o=n.item.data("startPos");t.$apply(function(){i.onMove(o,r)})},stop:function(){c.treatAsDesktop()||n.sortable("option","disabled",!0)}},i),(r=n.closest(".pp-section")).length&&(i.containment=r),n.sortable(i),c.treatAsDesktop()||n.sortable("option","disabled",!0),t.enableTouchDrag=function(){var t;n.sortable("option","disabled",!1),(t=e.Event(window.event,{type:"mousedown"})).which=1,t.pageX=window.event.pageX,t.pageY=window.event.pageY,t.target=window.event.target,e.ui.mouse.prototype._touchStart.call(n.data("ui-sortable"),t)}}})}}}]),n.directive("ppSlider",[function(){return{require:"?ngModel",link:function(e,i,r,o){e.$watch(r.ppSlider,function(r){r&&(r.range?(r=a.extend({},{min:0,max:10,step:1,values:o.$modelValue,stop:function(t,i){n.$apply(e,function(){o.$setViewValue(i.values)})}},r),e.$watchCollection(function(){return o.$modelValue},function(e,n){t.equals(e,n)||i.slider("values",e)})):(r=a.extend({},{min:0,max:10,step:1,value:o.$modelValue,stop:function(t,i){n.$apply(e,function(){o.$setViewValue(i.value)})}},r),e.$watch(function(){return o.$modelValue},function(e,t){e!==t&&i.slider("value",e)})),i.slider(r))})}}}]),n.directive("ppPlaceholder",function(){return{link:function(e,t,n){function i(){var i=e.$eval(n.ppPlaceholder);e.$eval(n.ppPlaceholderSuppressEqual)&&"="===i[0]&&(i=i.substr(1)),t.attr("placeholder",i)}t.on("focus",function(){t.attr("placeholder","")}),t.on("blur",function(){i()}),e.$watch(n.ppPlaceholder,function(){i()})}}}),n.directive("ppHeaderWithSwitch",function(){return{scope:{definition:"=",data:"=",args:"="}}}),n.directive("ppAccordion",function(){return{template:"<div ng-transclude></div>",transclude:!0,scope:{ppAccordion:"=",definition:"=",args:"="},controller:["$scope","$element","$timeout",function(t,n,r){function o(){l=r(function(){n.accordion("refresh"),l=null})}function s(e){var n=-1;return e=e.split(".")[0],Object.keys(t.definition.items||{}).filter(function(e){return!1!==t.definition.items[e].show}).forEach(function(t,i){if(t===e)return n=i,!1}),n}var a=t.args.cache,l=null,u="accordion_path";t.definition.cacheKey&&(u=u+"_"+t.definition.cacheKey),this.loadit=function(r){var l=a.get(u),h=void 0!==t.definition.defaultActiveTabIndex?t.definition.defaultActiveTabIndex:-1;l&&(h=s(l)),r===t.ppAccordion.length-1&&(n.accordion({header:".pp-section-header",active:h,heightStyle:"fill",animate:!!c.treatAsDesktop()&&"swing",activate:function(n,i){var r=e(i.newPanel).attr("x-path");a.put(u,r),t.$broadcast("ppAccordionNewPath",r)}}),i.on("end",o))},t.$on("pp-open-path",function(e,t){var i=s(t);i>=0&&n.accordion("option","active",i)}),t.$on("$destroy",function(){l&&(r.cancel(l),l=null),i.off("end",o)})}]}}),n.directive("ppAccordionItem",function(){return{require:"^ppAccordion",link:function(e,t,n,i){i.loadit(e.$index)}}}),n.directive("ppInputValidator",["$parse",function(e){return{require:"ngModel",link:function(t,n,i,s){function l(e,t){if(void 0===e)return!1;if("always"===m.expression)return!0;switch(t){case"StringExpression":return 0===e.indexOf("=");case"ValueExpression":return"string"==typeof e&&0===e.indexOf("=");case"StringExpr":return 0===e.indexOf("=");case"ValueExpr":case"dimension":case"measure":return!0;default:return!1}}function c(n){i.ppValidationOnResult?e(i.ppValidationOnResult)(t,{isValid:n}):t.invalid=!n}function h(e){c(e.valid)}function d(e){if("measure"===g)if(""===e)c(!0);else{var n=t.args?t.args.handler.getLabels():[];f.validate(e,n)}else"dimension"===g?""===e?c(!1):(e&&"="!==e[0]&&(e="="+a.escapeField(e)),f.validate(e)):f.validate(e)}function p(e){l(e,g)?d(e):c(r.validateType(e,m,t.data,t.args))}var f=null,m=t.definition,g=i.expressionType;if(g){var v=t.args?t.args.app:t.app;(f=new o.ExpressionValidator(v,u(g))).Update.bind(h)}t.$on("datachanged",function(){p(s.$modelValue)}),t.$on("pp-revalidate",function(){p(s.$modelValue)}),t.$watch(function(){return s.$modelValue},function(e){p(e)}),t.$on("$destroy",function(){f&&f.Update.unbind(h)})}}}]),n.directive("ppExpressionEditor",["$parse","$timeout",function(n,i){return{link:function(r,o,c){function d(e,t){if(void 0===e)return!1;switch(t){case"StringExpression":case"ValueExpression":return"object"==typeof e;case"StringExpr":return"object"==typeof e&&0===e.qv.indexOf("=");case"ValueExpr":return"object"==typeof e;case"dimension":case"measure":return!0;default:return!1}}function p(e){return"'"!==e[0]&&"'"!==e[e.length-1]&&-1===e.indexOf("(")&&-1===e.indexOf(")")&&!a.isNumeric(e)}function f(){var e=n(c.ppExpressionEditor)(r),i=c.expressionType,o=u(i),l=e,f=[],m=d(e,i);"object"==typeof e&&("StringExpression"===i?e=h(e.qStringExpression.qExpr):"ValueExpression"===i?e=h(e.qValueExpression.qExpr):"StringExpr"===i?e=e.qv:"ValueExpr"===i&&(e=e.qv)),"dimension"===i&&e.length?"="!==e[0]&&(e="="+a.escapeField(e)):"measure"===i?f=r.args?r.args.handler.getLabels():[]:m||"StringExpr"!==i&&"StringExpression"!==i||("StringExpr"===i&&e.qv&&(e=e.qv),e&&p(e)&&(e="='"+e.replace(/'/g,"''")+"'")),s.show({expr:e,title:e?"Dimension.Expression.Dialog.Edit.Title":"Dimension.Expression.Dialog.Add.Title",allowEmpty:!0,mode:o,labels:f,app:r.args?r.args.app:r.app}).then(function(e){"ValueExpression"===i&&e.length?e={qValueExpression:{qExpr:e}}:"StringExpression"===i&&e.length?e={qStringExpression:{qExpr:e}}:"ValueExpr"===i?e={qv:e}:"StringExpr"===i?("="!==e[0]&&(e="="+e),e={qv:e}):"dimension"===i&&e.length&&"="!==e[0]&&(e="="+e),c.ppExpressionEditorOnApply?n(c.ppExpressionEditorOnApply)(r,{value:e}):t.equals(l,e)||(r.value=e,r.change())},function(){})}o.on("keypress.pp-expression",function(t){13!==t.which&&32!==t.which||e(t.target).trigger("qv-activate")}),o.on("qv-activate.pp-expression",function(){var t;c.editorDisabled&&n(c.editorDisabled)(r)||(l.isInput(document.activeElement)?((t=e(document.activeElement)).on("blur.pp-expression",function(){i(function(){f()}),t.off("blur.pp-expression")}),t.blur()):f())}),r.$on("$destroy",function(){o.off(".pp-expression")})}}}]),n.componentDirective("includePpComponent",{definition:"=",data:"=",args:"="}),{}}),define("objects.views/charts/components/data-title/dropdown-data-title/dropdown-data-title",["qvangular","util","text!./dropdown-data-title.ng.html","text!./dropdown-data-title-popover.ng.html","client.soft-property-panel/default-explore-properties","assets/client/soft-property-panel/soft-property-handler","client.soft-property-panel/components/hypercube-data/hypercube-data-handler","client.utils/property-resolver","core.utils/deferred","core.utils/resize","client.property-panel/property-panel-directives"],function(e,t,n,i,r,o,s,a,l,c){"use strict";function u(e){return{left:"right",right:"left",top:"bottom",bottom:"top"}[e]}var h,d;h={template:i,controller:["$scope",function(e){e.position||(e.position="right");var t=new s(e.args.effectiveProperties,e.args.model.app),n=new o(e.args.model);e.alternativeItemClicked=function(i,r,o){i.stopPropagation(),t.updateAlternativeItem(r,o,e.definition.items[o.ref].ref,e.definition.items[o.ref].alternativeRef,[{path:"qDef",property:"series"}]),n.saveSoftProperties(e.args.prevEffectiveProperties,e.args.effectiveProperties),e.closePopover()}}],scope:{alignTo:"=",position:"=",args:"=",definition:"=",item:"=",type:"=",closePopover:"=",qvaOutsideIgnoreFor:"=",options:"="}},e.directive("qvaDropdownDataTitle",[function(){return{replace:!0,template:n,restrict:"E",scope:{model:"=",type:"=",data:"=",disabled:"=",dock:"=",options:"="},link:function(n,i){var o=e.getService("$cacheFactory").get("em-object"),p={},f=n.model,m=new s(null,f.app);n.closePopover=function(){n.isMenuOpen&&(n.isMenuOpen=!1,d&&(d.close(),d=null))},n.openAlternativePopover=function(){var t=u(n.dock);n.disabled||(n.isMenuOpen?n.closePopover():(n.isMenuOpen=!0,(d=e.getService("luiPopover").show({template:h.template,controller:h.controller,input:n.popoverSettings,alignTo:i[0],dock:t,variant:"inverse",closeOnOutside:!0,closeOnEscape:!0,outsideIgnore:"dataTitle-"+n.$id})).closed.then(function(){n.isMenuOpen=!1})))},n.refreshItems=function(){l.all({effectiveProperties:f.getEffectiveProperties(),properties:f.getProperties().then(function(e){return e.qExtendsId?f.app.getObject(e.qExtendsId).then(function(e){return e.getProperties()}):e}),layout:f.getLayout()}).then(function(e){n.destroyed||(p.args={layout:e.layout,model:f,properties:e.properties,effectiveProperties:t.extend(!0,{},e.effectiveProperties),prevEffectiveProperties:t.extend(!0,{},e.effectiveProperties),cache:o},p.data=e.effectiveProperties,p.definition=r.data,p.item=n.getAlternativeItem(p),n.popoverSettings={args:p.args,item:p.item,type:p.type,definition:p.definition,closePopover:n.closePopover,qvaOutsideIgnoreFor:"dataTitle-"+n.$id,options:n.options},n.isMenuOpen&&n.closePopover())})},n.refreshItems(),n.$on("datachanged",function(){n.refreshItems()}),n.getAlternativeItem=function(e){var t,i,r,o,s,l=n.data.index;if("dimension"===n.type?(s=e.data.qHyperCubeDef.qDimensions[l],o=m.getDimensionOptions,r="dimensions"):(s=e.data.qHyperCubeDef.qMeasures[l],o=m.getMeasureOptions,r="measures"),s)return t=a.getValue(e.data,e.definition.items[r].alternativeRef,[]),i=a.getValue(e.data,e.definition.items[r].ref,[]),t=o.call(m,i,t,s,e.args.layout,!0),{alternatives:t,index:isNaN(n.data.index)?0:n.data.index,data:s}},c.on("end",n.closePopover),n.$on("$destroy",function(){c.off("end",n.closePopover),n.destroyed=!0,n.closePopover()})}}}])}),define("text!objects.views/charts/components/data-title/breadcrumb-bar/breadcrumb-bar.ng.html",[],function(){return'<div class="qv-breadcrumb">\n\t<div class="qv-breadcrumb-container">\n\t\t<span class="icon-dimension-drilldown" title="{{drillDownTooltip}}"></span>\n\t\t\t<span class="crumb-item" ng-repeat="label in data.labels track by $index">\n\n\t\t\t\t<div ng-style="getCrumbStyle(hoverIndex === $index, $last, disabled)"\n\t\t\t\t\t ng-mouseover="hoverIndex = $index"\n\t\t\t\t\t ng-mouseout="hoverIndex = -1"\n\t\t\t\t\t ng-class="{\'crumb-button\' : !$last, \'disabled\' : disabled}"\n\t\t\t\t\t qva-activate="onClick($event, $index, $last)">\n\n\t\t\t\t\t<div ng-if="!$last" class="chart-data-title" >\n\t\t\t\t\t\t<span qva-direction x-dir-text="{{label}}" class="chart-data-title-label" title="{{label}}">{{label}}</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<qva-default-data-title ng-if="$last" data="data" model="model" disabled="disabled" type="type" direction="direction" dock="dock" options="options"></qva-default-data-title>\n\n\t\t\t\t\t<span class="lui-icon lui-icon--triangle-left" ng-if="!$last"></span>\n\t\t\t\t\t<span class="lui-icon lui-icon--triangle-right" ng-if="!$last"></span>\n\t\t\t\t</div>\n\t\t\t</span>\n\t</div>\n</div>'}),define("objects.views/charts/components/data-title/breadcrumb-bar/breadcrumb-bar",["qvangular","general.utils/color","text!./breadcrumb-bar.ng.html","objects.views/charts/chart-style-service","core.utils/feature-flags","client.utils/theme/theme-module","translator","touche"],function(e,t,n,i,r,o,s){function a(e){var n,i,o;if(r.THEMING){var s=l.initializeService("object."+(e.options.parentType||""));n=s.getStyle("","backgroundColor");var a=s.getStyle("axis.title","color"),h=s.getStyle("axis.title.disabled","color");u.crumbColor={color:a},u.crumbButtonColor={color:h},u.crumbButtonHoverColor={color:a},u.crumbButtonLockedColor={color:a},u.crumbButtonDisabledColor={color:h}}else n=c.getValue("",null,"backgroundColor","#ffffff"),u.crumbColor={color:c.getValue("","axis.title","color")},u.crumbButtonColor={color:c.getValue("","axis.title","color","inactive")},u.crumbButtonHoverColor={color:c.getValue("","axis.title","color","active")},u.crumbButtonLockedColor={color:c.getValue("","axis.title","color","locked")},u.crumbButtonDisabledColor={color:c.getValue("","axis.title","color","disabled")};i=t.toRGBA(n,0),o=t.toRGBA(n,1),e.faderStyle={background:"linear-gradient(to right, "+o+", "+i+")"}}var l=o.get(),c=i.getInstance(),u={};e.directive("qvaBreadcrumbBar",function(){return{template:n,restrict:"E",replace:!0,scope:{data:"=",type:"=?",model:"=?",disabled:"=?",dock:"=?",columnIndex:"=",options:"="},link:function(e,t){e.hoverIndex=-1,e.height=t.width(),e.singleLabelMode=!0,e.onClick=function(t,n,i){e.disabled||i||(e.$emit("drill-up",e.columnIndex,n),t.stopImmediatePropagation())},e.drillDownTooltip=s.get("Tooltip.dimensions.drilldown"),e.getCrumbStyle=function(e,t,n){return n?u.crumbButtonDisabledColor:t?{}:e?u.crumbButtonHoverColor:u.crumbButtonColor},a(e)}}})}),define("objects.views/charts/components/data-title/data-title",["qvangular","translator","core.utils/deferred","objects.views/charts/components/chart-component-angular","objects.views/charts/utils/canvas-renderer","objects.views/charts/components/data-title/data-title-handler","text!./data-title.ng.html","text!./default-data-title.ng.html","text!./simple-data-title.ng.html","objects.views/charts/chart-style-service","core.utils/feature-flags","client.utils/theme/theme-module","objects.views/charts/components/data-title/dropdown-data-title/dropdown-data-title","objects.views/charts/components/data-title/breadcrumb-bar/breadcrumb-bar"],function(e,t,n,i,r,o,s,a,l,c,u,h){"use strict";function d(e){this.relevantSize=this._titleFontHeight+m+(e?this._extraSizeWhenAlternatives:0)}function p(e,t){return"normal "+parseInt(e)*t+"px 'QlikView Sans'"}function f(){var e=v.layoutMap[this._layoutMode]||"medium",t="full"===e?this._layoutMode:"medium";if(u.THEMING){this._innerScope.options.parentType=this.options.parentType;var n=g.initializeService("object."+this.options.parentType),i=n.getStyle("axis.title","fontSize"),o=p(n.scaleFontSize(i,t),this._innerScope.fontScale);this._innerScope.fontStyle.font=o,this._innerScope.fontStyle.color=n.getStyle("axis.title","color"),this._titleFontHeight=r.getFontHeight(o)}else this._innerScope.fontStyle.font=v.getFont("","axis.title",e,null,null,this._innerScope.fontScale),this._titleFontHeight=r.getFontHeight(v.getFont("","axis.title",e,null,null))}var m=3,g=h.get(),v=c.getInstance();return e.directive("qvaSimpleDataTitle",[function(){return{replace:!0,template:l,restrict:"E",scope:{label:"=",locked:"=?",options:"="},link:function(e){e.lockedTooltip=t.get("Tooltip.selections.locked")}}}]),e.directive("qvaDefaultDataTitle",[function(){return{replace:!0,template:a,restrict:"E",scope:{data:"=",type:"=?",model:"=?",disabled:"=?",dock:"=?",options:"="}}}]),i.extend("DataTitle",{init:function(){var e=Array.prototype.slice.call(arguments),t=this;e.push(s),this._super.apply(this,e),this._showTitle=!0,this._innerScope.fontScale=1,this._currentDrillDownLevels=[],this._innerScope.disabled=!0,this._selectionsEnabled=!0,this._innerScope.fontStyle={font:"12px 'QlikView Sans'"},f.call(this),this._extraSizeWhenAlternatives=10,this.drillUpRef=this._innerScope.$on("drill-up",function(e,n,i){t._currentDrillDownLevels[n]-i>0&&t.fire("drill-up",[e,n,t._currentDrillDownLevels[n]-i])})},calculateRelevantSize:function(){this._super(),f.call(this),d.call(this,this._hasAlternatives)},setShowStrategy:function(e){this._showTitle=["all","title"].contains(e)},setDock:function(e){this._super(e),this._innerScope.direction="right"===e?"top-to-bottom":"left"===e?"bottom-to-top":"",this._innerScope.dock=e},setType:function(e){this._innerScope.type=e},setModel:function(e){this._innerScope.model=e},setSelectionsEnabled:function(e){this._selectionsEnabled=e,this._changed=!0,this.invalidateProperties("dataTitle.setSelectionsEnabled")},setData:function(e){if(this._super(e),e){var t=this,i=this._innerScope.model;return!i||i.layout&&i.layout.snapshotData?(t._changed=!0,n.resolve()):o.modelHasAlternatives(this._innerScope.model,this._innerScope.type).then(function(e){return t._hasAlternatives=e,t._changed=!0,t.invalidateProperties("dataTitle.setData")})}},_updateProperties:function(){if(this._super(),this._changed&&this._data){var e=this._data;if(e.qHyperCube&&this._innerScope.type&&(e=o.getTitleDataFromHyperCube(e.qHyperCube,this._innerScope.type,this._selectionsEnabled),this._currentDrillDownLevels=e.map(function(e){return e.currentDrillDownLevels})),!this._innerScope)return;e.forEach(function(e){e.hasAlternatives=this._hasAlternatives},this),this._innerScope.titles=e,this._innerScope.$broadcast("datachanged"),o.setWrapperStyle(this._innerScope.fontStyle,this._innerContainer,this._innerScope.direction,this._innerScope.titles)}this._changed=!1},isVisible:function(){return this._super.apply(this,arguments)&&this._showTitle},on:function(){this._innerScope.disabled=!1},off:function(){this._innerScope.disabled=!0},paint:function(){this._innerScope.visible=!0,this._innerScope.fontScale=this.chartScale,f.call(this),this._innerScope.$digest(),o.setWrapperStyle(this._innerScope.fontStyle,this._innerContainer,this._innerScope.direction,this._innerScope.titles)},release:function(){this._super(),this.drillUpRef()},clear:function(){this._super(),this._innerScope.visible=!1}})}),define("objects.views/charts/components/grid",["./chart-component","objects.views/charts/utils/canvas-renderer","objects.views/charts/chart-style-service","client.utils/theme/modern/theme","core.utils/feature-flags"],function(e,t,n,i,r){function o(e,t,n,i,r,o,s){var a,l,c,u;return s?(a=0,l=i,c=e,u=e):(a=e,l=e,c=0,u=r),{type:"line",opacity:n,strokeWidth:o,shape:{x1:a,x2:l,y1:c,y2:u},stroke:t}}function s(e,t){var n,i,r,s,a=e.ticks,l=e.minorTicks,u=a?a.length:0,h=l?l.length:0,d=e.getSpacingMode()===c.DENSE||e.isDimension,p=e.getSpacingMode()===c.SPARSE?2:1,f=t.rect.height,m=t.rect.width,g=t.style,v=[];if(e.getSpacingMode()===c.NONE||!a)return[];for(s=0;s<u;s+=1)i=a[s].position,n=a[s].value,r=a[s].opacity,s%p!=0&&0!==n||(0===n?v.push(o(i,g.zero.color,r,m,f,g.zero.width,e.isVertical())):v.push(o(i,g.major.color,r,m,f,g.major.width,e.isVertical())));if(d&&l)for(s=0;s<h;s+=1)i=l[s].position,v.push(o(i,g.minor.color,1,m,f,g.minor.width,e.isVertical()));return v}function a(e,t){var n,i;return r.THEMING?i={ticks:{major:{color:e.getStyle("line.major","color")},minor:{color:e.getStyle("line.minor","color")},zero:{color:e.getStyle("line.highContrast","color")}}}:(n=e.layoutMap[t]||"medium",i={ticks:{major:{color:e.getValue("","axis.grid.major","color",n),width:e.getValue("","axis.grid.major","width",n)},minor:{color:e.getValue("","axis.grid.minor","color",n),width:e.getValue("","axis.grid.major","width",n)},zero:{color:e.getValue("","axis.grid.zero","color",n),width:e.getValue("","axis.grid.major","width",n)}}}),i}function l(){this.invalidateDisplay("Grid.setAxes")}var c={NONE:0,SPARSE:1,NORMAL:1,DENSE:3};return e.extend("Grid",{init:function(){this._super.apply(this,Array.prototype.slice.call(arguments)),this._styleService=r.THEMING?i.initializeService("object.grid"):n.getInstance(),this._renderer=new t(this.container),this._renderer.edgeBleed={top:1,left:1,bottom:0,right:0},this._$renderAreaWrap.addClass("qv-chart-component-grid"),this.renderers={gridlines:this._renderer}},afterRenderLines:function(){},setAxes:function(e,t){this._primaryHorizontalAxis!==e&&(this._primaryHorizontalAxis&&this._primaryHorizontalAxis.stopListen("changed",l,this),this._primaryHorizontalAxis=e,this._primaryHorizontalAxis&&this._primaryHorizontalAxis.listen("changed",l,this)),this._primaryVerticalAxis!==t&&(this._primaryVerticalAxis&&this._primaryVerticalAxis.stopListen("changed",l,this),this._primaryVerticalAxis=t,this._primaryVerticalAxis&&this._primaryVerticalAxis.listen("changed",l,this))},hasValidData:function(){return this._super()&&(this._primaryVerticalAxis||this._primaryHorizontalAxis)},paint:function(e,t){this._super(e,t);var n=[];return this._style=a(this._styleService,this._layoutMode),this._primaryVerticalAxis&&(this._primaryVerticalAxis.updateNow(),n=s(this._primaryVerticalAxis,{rect:this.rect,style:this._style.ticks})),this._primaryHorizontalAxis&&(this._primaryHorizontalAxis.updateNow(),n=n.concat(s(this._primaryHorizontalAxis,{rect:this.rect,style:this._style.ticks}))),this.afterRenderLines(n),this._renderer.shapes=n,this._renderer.render(),this},release:function(){this._super(),this._styleService=null,this._primaryHorizontalAxis&&this._primaryHorizontalAxis.stopListen("changed",null,this),this._primaryVerticalAxis&&this._primaryVerticalAxis.stopListen("changed",null,this)}})}),define("objects.views/charts/axis-chart",["jquery","objects.views/charts/chart","objects.views/charts/components/chart-component","objects.views/charts/components/ref-lines","objects.views/charts/components/axis/continuous-axis","objects.views/charts/components/data-title/data-title","objects.views/charts/components/grid"],function(e,t,n,i,r,o,s){"use strict";return t.extend({init:function(t,a,l,c,u){var h=e.extend(!0,{components:{grid:{show:!0,dock:"center",showFlag:n.prototype.ShowFlags.XSMALL,clazz:s},refLines:{clazz:i},colorLegend:{show:!0,order:4,reductionOrder:1,dock:"right",relevantSize:126,showFlag:n.prototype.ShowFlags.MEDIUM},xAxis:{show:!0,order:1,dock:"bottom",relevantSize:120,showFlag:n.prototype.ShowFlags.XSMALL,clazz:r},yAxis:{show:!0,order:1,dock:"left",relevantSize:90,reductionOrder:2,showFlag:n.prototype.ShowFlags.XSMALL,clazz:r},yAxisTitle:{show:!0,order:1.1,dock:"left",relevantSize:30,reductionOrder:1,showFlag:n.prototype.ShowFlags.SMALL,clazz:o},xAxisTitle:{show:!0,order:1.1,dock:"bottom",relevantSize:30,reductionOrder:1,showFlag:n.prototype.ShowFlags.SMALL,clazz:o}}},l||{});this._super(t,a,h,c,u)},getVerticalComponents:function(){var e=this._super();return this._data&&this.components&&(this.components.xAxis&&this.components.xAxis.isVertical()&&this._data.xAxis&&(e.push({comp:this.components.xAxis,dock:this._data.xAxis.dock}),this.components.xAxisTitle&&e.push({comp:this.components.xAxisTitle,dock:this._data.xAxis.dock})),this.components.yAxis&&this.components.yAxis.isVertical()&&this._data.yAxis&&(e.push({comp:this.components.yAxis,dock:this._data.yAxis.dock}),this.components.yAxisTitle&&e.push({comp:this.components.yAxisTitle,dock:this._data.yAxis.dock}))),e},_updateData:function(e,t){this._super.apply(this,[].slice.call(arguments)),this.updateDataArea(e,t),this.updateAxis(e,t),this.updateGrid(e,t),this.updateRefLines(e,t),this.updateVerticalComponentsDock()},updateDataArea:function(e,t){var n,i;for(n in t.axes)(i=t.axes[n]).component.setDataIndices(i.dataIndices||[i.dataIndex||0]),i.component.setCurrentDataIndices(i.currentDataIndices||i.dataIndices||[i.dataIndex||0])},setAxisDataRange:function(e,t,n,i,r,o){var s,a;null!==i&&null!==r||null===i&&null===r?(s=n,a=t):null!==i&&i<=n?(s=i-o,a=t):null!==r&&r>=t?(s=n,a=r+o):(s=n,a=t),e.setDataRange(s,a),this.components.miniChart&&this.components.miniChart.components.measureAxis.setDataRange(s,a)},updateAxis:function(e,t){var n,i,r,o=t.axes,s=this.components.miniChart;for(n in t.axes)(i=o[n]).component.setTitle(i.title),i.component.setShowStrategy(i.data.show),i.component.setLabelMode(i.data.label),i.component.setLockedInfo&&i.component.setLockedInfo(e.qHyperCube.qDimensionInfo.map(function(e){return!0===e.qLocked})),i.component.setPlotMin&&!i.component.isDimension&&(r=this.getAxisOptions(i),i.component.setPlotMin(r.min),i.component.setPlotMax(r.max),i.component.setTickMultiplier(i.data.spacing),i.component.setLogScale(i.data.logarithmic),s&&s.components[n]&&(r=this.getAxisOptions(i),s.components[n].setPlotMin(r.min),s.components[n].setPlotMax(r.max))),i.component.isVertical()?i.component.setDock("far"===i.data.dock?"right":"left"):i.component.setDock("far"===i.data.dock?"top":"bottom");for(n in t.axisTitles)(i=t.axisTitles[n]).component.setShowStrategy(i.data.show),i.component.isVertical()?i.component.setDock("far"===i.data.dock?"right":"left"):i.component.setDock("far"===i.data.dock?"top":"bottom")},getAxisOptions:function(e){if(e&&e.data)return e.data.autoMinMax?{min:null,max:null}:{min:["min","minMax"].contains(e.data.minMax)?Number(e.data.min):null,max:["max","minMax"].contains(e.data.minMax)?Number(e.data.max):null}},updateGrid:function(e,t){if(this.components.grid){var n,i;if(e.gridLine&&"number"==typeof e.gridLine.spacing){i=e.gridLine.auto?2:e.gridLine.spacing;for(n in t.axes)t.axes[n].component.setSpacingMode&&t.axes[n].component.setSpacingMode(i)}}},updateRefLines:function(e,t){var n,i=t.refLineLabels,r=[],o=[];for(n in i)i[n].component&&(i[n].component.setData(i[n].data),i[n].component.setAxis(i[n].axis),i[n].component.setDock(i[n].axis.getOppositeDock()),o.push(i[n].axis),r.push(i[n].data));t.refLines&&t.refLines.component&&(t.refLines.component.setAxes(o),t.refLines.component.setData(r))}})}),define("objects.views/charts/utils/time-scale-utils",[],function(){return{dateToQlikTimestamp:function(e){return e.getTime()/1e3/86400-e.getTimezoneOffset()/60/24+25569},getUnixDate:function(e){return new Date(1899,11,30+e)},calculateTicks:function(e,t,n,i,r,o){var s,a,l=this.getUnixDate(t),c=l.getFullYear(),u=l.getMonth(),h=l.getDate(),d=n-t,p=e/(i-n),f=p/1440,m=p/86400,g=366*p,v=3*p*30,y=r.second/m,b=r.minute/f,x=r.date/v,q=r.year/g,C=0,S=0,w=null,_=null,D=null,M=null,A=null,E=null,I={plotMin:n,plotMax:i,tickMin:0,tickMax:0,mainTickValues:[],mainDates:[],secondaryTickValues:[],secondaryDates:[]};for(y<1?(w=1,S=1/86400):y<2?(w=2,S=1/86400*2):y<5?(w=5,S=1/86400*5):y<10?(w=10,S=1/86400*10):y<30?(w=30,S=1/86400*30):b<1?(_=1,S=1/1440):b<2?(_=2,S=1/1440*2):b<5?(_=5,S=1/1440*5):b<10?(_=10,S=1/1440*10):b<30?(_=30,S=1/1440*30):b<60?(D=1,S=1/24):b<120?(D=2,S=2/24):b<360?(D=6,S=.25):b<720?(D=12,S=.5):x<1/90?S=M=1:x<2/90?S=M=2:x<7/90?S=M=7:x<31/90?(A=1,S=31):x<1?(A=3,S=90):q<1?(E=1,S=366):q<2?(E=2,S=732):q<5?(E=5,S=1826.25):(E=10,S=3652.5),a=Math.floor((d+t%1)/S);C<i;){s=E?new Date(c+a*E,0,1):A?new Date(c,u+a*A,1):M?new Date(c,u,h+a*M):D?new Date(c,u,h,0+a*D):_?new Date(c,u,h,0,0+a*_):new Date(c,u,h,0,0,0+a*w),C=this.dateToQlikTimestamp(s),I.secondaryDates.push(s),I.secondaryTickValues.push(C);var T=Math.floor(C);o||E||A||M||I.mainTickValues[I.mainTickValues.length-1]===T||(I.mainDates.push(this.getUnixDate(T)),I.mainTickValues.push(T)),a++}return I.tickSpacing=S,I.tickMinValue=I.secondaryTickValues[0],I.tickMaxValue=I.secondaryTickValues[I.secondaryTickValues.length-1],I}}}),define("objects.views/charts/components/axis/time-scale",["./linear-scale","../../utils/time-scale-utils"],function(e,t){"use strict";return e.extend("TimeScale",{init:function(){this._super.apply(this,arguments),this.mainDates=[],this.secondaryDates=[]},calculateTicks:function(e,n){var i,r,o,s,a;r=isNaN(this._realDataMin)?this._dataMin:this._realDataMin,i=t.calculateTicks(this._calculationSize,r,this._explicitPlotMin,this._explicitPlotMax,e,n),this._mergeResult(i),0!==this.secondaryValues.length||isNaN(this.plotMin)||(this.secondaryValues=[this.plotMin],this.secondaryDates=[t.getUnixDate(this.plotMin)]),0===this._tickSpacing&&(this._tickSpacing=1),this._showExplicitMinMax&&(s=this.secondaryValues[0],a=this.secondaryDates[0],this.secondaryValues[0]=i.plotMin,this.secondaryDates[0]=t.getUnixDate(i.plotMin),s-i.plotMin>=i.tickSpacing/2&&(this.secondaryValues.splice(1,0,s),this.secondaryDates.splice(1,0,a)),o=i.mainTickValues[i.mainTickValues.length-1],i.plotMax-o<=i.tickSpacing/2?(this.secondaryValues[i.mainTickValues.length-1]=i.plotMax,this.secondaryDates[i.secondaryDates.length-1]=t.getUnixDate(i.plotMax)):(this.secondaryValues.push(i.plotMax),this.secondaryDates.push(t.getUnixDate(i.plotMax))))},_mergeResult:function(e){this._tickSpacing=e.tickSpacing,this.plotMin=e.plotMin,this.plotMax=e.plotMax,this.plotRange=this.plotMax-this.plotMin,this.tickMin=e.tickMinValue,this.tickMax=e.tickMaxValue,this.mainValues=e.mainTickValues,this.mainDates=e.mainDates,this.secondaryValues=e.secondaryTickValues,this.secondaryDates=e.secondaryDates},getValues:function(){return{mainValues:this.mainValues,mainDates:this.mainDates,secondaryValues:this.secondaryValues,secondaryDates:this.secondaryDates}}})}),define("objects.views/charts/components/axis/time-axis",["./continuous-axis","./time-scale","util","./axis-utils"],function(e,t,n,i){"use strict";function r(){var e,t=this._scale.getValues(),n=t.secondaryValues,i=t.secondaryDates,r=[];for(e=0;e<n.length;e++)r.push({position:0,value:n[e],opacity:1,label:n[e]});var o=this._getLabels(r,!0);o.labelsBetweenTicks=!0,o.align=this.yMirrorMode?"right":"left",o.dates=i,this._levels.splice(1),this._levels.unshift(o)}function o(e,t,n,i){for(var r=n.length*i,o=0,s=e._formatter,a=e._renderer,l=e._style.label.font,c=0;c<n.length;c++)if(t[c]<p?o++:t[c]<f&&s&&a.getTextWidth(s.formatValue(n[c]),l)>t[c]-2*e._labelPadding&&o++,o>r)return!1;return!0}function s(e,t){var n;for(n=0;n<e.length;++n){var r=e[n];if(o(t,r.widths,r.labels,.1))break;if(o(t,r.widths.map(function(e){return 1.1*e}),r.labels,.1)){++n;break}}if(t.indicators=n>0&&n<e.length?e[n-1]:null,t.indicators){var s=i.getAvgTickWidth(t.indicators.positions)||t._plotSize,a=i.getAvgTickWidth(e[n].positions)||t._plotSize;s<m||a<g?t.indicators=null:t._snapTicksAvgWidth=s}return e.slice(n,n+2)}function a(e,t){var n=e.map(function(e){var n,r,o=e.qTicks,s=[],a=[],l=[],c=[],u=[],h=[],p=!0;return o.forEach(function(e){n=e.qStart,s.push(n),c.push(t.isLabelSelected(e.qStart,e.qEnd)?1:t._globalAlpha),u.push(e.qText),h.push(e.qualifiedText),r=t.getPositionOfValue(n),a.push(Math.abs(r-t.getPositionOfValue(e.qEnd))),r=i.roundToHalf(r),l.push(r),e.qStart!==e.qEnd-1&&(p=!1)}),o.length>0&&(n=o[o.length-1].qEnd,s.push(n),r=t.getPositionOfValue(n),r=i.roundToHalf(r),l.push(r)),{align:t.yMirrorMode?"right":"left",labelsBetweenTicks:!0,values:s,widths:a,positions:l,opacities:c,labels:u,qualifiedLabels:h[0]?h:null,labelMode:d,labelSpace:t._wantedLabelSpacePerLevel,dayLevel:p,rangeLabels:!0,explicitLabels:!0}});return n=s(n,t)}function l(e){var t,n,i,r,o=[];for(t=0;t<e.length;t++)for(i=e[t].qTicks,n=0;n<e.length;n++)r=e[n].qTicks,t!==n&&i[0]&&r[0]&&"string"!=typeof i[0].qualifiedText&&"string"!=typeof r[0].qualifiedText&&i.length===r.length&&i.every(function(e,t){return e.qStart===r[t].qStart&&e.qEnd===r[t].qEnd})&&(e[t].qTags.contains("$qualified")?(r.forEach(function(e,t){e.qualifiedText=i[t].qText}),o.push(t)):(i.forEach(function(e,t){e.qualifiedText=r[t].qText}),o.push(n)));o.sort(function(e,t){return t-e}),o.forEach(function(t){e.splice(t,1)})}function c(){for(var e=0;e<this._levels.length;++e)for(var t=this._levels[e],n=0;n<t.values.length;++n){var r=t.values[n],o=this.getPositionOfValue(r);if(t.positions[n]=i.roundToHalf(o),n<t.values.length-1){var s=this.isLabelSelected(r,t.values[n+1]);t.opacities[n]=s?1:this._globalAlpha}}}function u(){this._formatter.localeInfo&&(this._levelFormattingPatterns=[],this._labelGranularity===v.YEAR?this._levelFormattingPatterns.push("YYYY"):this._labelGranularity===v.DATE?this._levelFormattingPatterns.push(this._formatter.localeInfo.qDateFmt):this._labelGranularity===v.MINUTE?this._levelFormattingPatterns.push(this._timeformatPatterns.minuteLevel):this._labelGranularity===v.SECOND&&this._levelFormattingPatterns.push(this._timeformatPatterns.secondLevel),this._levelFormattingPatterns.push(this._formatter.localeInfo.qDateFmt))}function h(e,t){var n=t/e,i=3*n*30,r=n/2;n/24/60/2>this._approxLabelWidths.second?this._labelGranularity=v.SECOND:r>this._approxLabelWidths.minute?this._labelGranularity=v.MINUTE:i>this._approxLabelWidths.date?this._labelGranularity=v.DATE:this._labelGranularity=v.YEAR}var d=1,p=30,f=150,m=5,g=80,v={YEAR:1,DATE:2,MINUTE:3,SECOND:4};return e.extend("TimeAxis",{init:function(){this._super.apply(this,[].slice.call(arguments)),this._approxLabelWidths={year:60,date:60,minute:60,second:60},this._levelFormattingPatterns=["YYYY","YYYY-mm-yy"],this._labelGranularity=v.YEAR,this._timeformatPatterns={minuteLevel:"hh:mm",secondLevel:"hh:mm:ss"}},_initScales:function(){this._scale=new t},_generateExplicitLabels:function(){var e=!1;return this._explicitLabels.length&&(this._levels=a(this._explicitLabels,this),this._levels.length&&(this._calculationSize/(this._scaleDetails.explicitPlotMax-this._scaleDetails.explicitPlotMin)/2>this._approxLabelWidths.minute&&r.call(this),e=!0,this._levels.length>1&&(this._levels[1].qualifiedLabels&&(this._levels[1].labels=this._levels[1].qualifiedLabels),this._levels[1].outOfSyncWithLevelBelow=!this._levels[1].dayLevel&&!this._levels[1].values.every(function(e){return e<this._scale._dataMin||e>this._scale._dataMax||this._levels[0].values.indexOf(e)>-1}.bind(this))),this.ticks=i.getTicks(this._levels[0].values,this._padding,this._plotSize),this.minorTicks=[],this._levels.length>1&&(this.minorTicks=this.ticks.filter(function(e){return-1===this._levels[1].values.indexOf(e.value)},this),this.ticks=this.ticks.filter(function(e){return-1!==this._levels[1].values.indexOf(e.value)},this)))),e},calculatePreliminaryLabelSpace:function(){var e=this._super.apply(this,arguments);return e.relevantLabelSize*=2,e},calculateLabelSpace:function(){var e=this._super.apply(this,arguments);return e.relevantLabelSize*=2,e},_initLevels:function(){this.useExplicitLabels?(c.call(this),this._levels[0].formatPattern=this._levelFormattingPatterns[0]):(this._levels=[this._getLabels(this.minorTicks,!0)],this._levels[0].labelsBetweenTicks=!0,this._levels[0].align=this.yMirrorMode?"right":"left",this._levels[0].dates=this._minorTickDates,this._levels[0].formatPattern=this._levelFormattingPatterns[0],this.ticks.length&&(this._levels.push(this._getLabels(this.ticks,!0)),this._levels[1].labelsBetweenTicks=!0,this._levels[1].align=this.yMirrorMode?"right":"left",this._levels[1].dates=this._tickDates,this._levels[1].formatPattern=this._levelFormattingPatterns[1]))},_calculateScale:function(e){if(0!==e){var t,n=this._scaleDetails,i=isNaN(n.realDataMin)?n.dataMin:n.realDataMin,r=isNaN(n.realDataMax)?n.dataMax:n.realDataMax,o=isNaN(n.explicitPlotMin)||null===n.explicitPlotMin?i:n.explicitPlotMin,s=isNaN(n.explicitPlotMax)||null===n.explicitPlotMax?r:n.explicitPlotMax;t=this.isRadial()?96:Math.max(60,this._getApproximateLabelWidth(o,s,this._levelFormattingPatterns[0])+this._labelPadding);var a=this.isVertical()?4*this._fontHeight:t;a=e/(Math.max(2,e/a/n.tickMultiplier+1)-1),n.usedDataMin=i,n.usedDataMax=r,n.minTickSpacingInPixel=a,n.plotSize=this._plotSize,n.calculationSize=void 0!==e?e:this._calculationSize,n.fontHeight=this._fontHeight,n.showExplicitMinMax=!1,Object.keys(n).forEach(function(e){this._scale["_"+e]=n[e]},this),this._scale.calculateTicks(this._approxLabelWidths,"T"===this._formatter.type)}},_generateTickObjects:function(e,t){if(this.useExplicitLabels=this._generateExplicitLabels(),!this.useExplicitLabels){var n=e.getValues();this.ticks=i.getTicks(n.mainValues,this._padding,t),this.minorTicks=i.getTicks(n.secondaryValues,this._padding,t),this._tickDates=n.mainDates,this._minorTickDates=n.secondaryDates}},_updateTickFormatting:function(e,t){var n,i,r,o;for(n=0;n<e.length;n++)if(!e[n].explicitLabels)for(r=e[n].dates&&e[n].values.length!==e[n].dates.length,o=t._dateFormatter&&e[n].dates&&e[n].dates.length&&!r,i=0;i<e[n].values.length;i++)e[n].labels[i]=o?t._dateFormatter.format(e[n].dates[i],e[n].formatPattern):t.formatValue(e[n].values[i])},formatValue:function(e){if(this._discrete||!this._formatter)return e+"";var t="YYYY"===this._levels[0].formatPattern?void 0:this._levels[0].formatPattern;return this._formatter.formatValue(e,t)},setLabels:function(e){this._explicitLabels=n.extend(!0,[],e).reverse(),l(this._explicitLabels)},updateFormatter:function(){if(this._super(),this._formatter.localeInfo){var e=/t+/gi.test(this._formatter.localeInfo.qTimestampFmt);this._timeformatPatterns.minuteLevel=e?"h:mm tt":"hh:mm",this._timeformatPatterns.secondLevel=e?"h:mm:ss tt":"hh:mm:ss";this._approxLabelWidths={year:Math.max(60,this._renderer.getTextWidth(this._formatter.formatValue(41000.2343433,"YYYY"),this._style.label.font)+this._labelPadding+20),date:Math.max(60,this._renderer.getTextWidth(this._formatter.formatValue(41000.2343433,this._formatter.localeInfo.qDateFmt),this._style.label.font)+this._labelPadding+20),minute:Math.max(60,this._renderer.getTextWidth(this._formatter.formatValue(41000.2343433,this._timeformatPatterns.minuteLevel),this._style.label.font)+this._labelPadding+20),second:Math.max(60,this._renderer.getTextWidth(this._formatter.formatValue(41000.2343433,this._timeformatPatterns.secondLevel),this._style.label.font)+this._labelPadding+20)}}},_updateScaleAndTicks:function(){this._scaleDetails.calculationSize&&(h.call(this,this._scaleDetails.explicitPlotMax-this._scaleDetails.explicitPlotMin,this._scaleDetails.calculationSize),u.call(this)),this._super()}})}),define("objects.views/charts/components/scroll-area",["./chart-component","general.utils/shapes/rect","jquery","touche","general.utils/color","core.utils/feature-flags","client.utils/theme/theme-module"],function(e,t,n,i,r,o,s){function a(e){var n,i,r,o=this,s=this.isVertical(),a={size:s?"height":"width",pos:s?"y":"x",coord:s?"pageY":"pageX"},l=new t(0,0,0,0),c=o._$renderAreaWrap.offset();l.x=c.left,l.y=c.top,l.width=o._$renderAreaWrap.width(),l.height=o._$renderAreaWrap.height(),this.fire("scrollStart"),r=o.scrollRect[a.size]*l[a.size],i=e.points[0][a.pos]-l[a.pos],this.yMirrorMode&&!s&&(i=l.width-i),n=i-r/2,o.scrollRect[a.pos]=Math.max(0,Math.min(l[a.size]*(1-o.scrollRect[a.size]),n))/l[a.size],o.setOffset(o.scrollRect[a.pos]*o.fullState.max)}function l(e){var n=this,i=this.isVertical(),r={size:i?"height":"width",pos:i?"y":"x",coord:i?"pageY":"pageX"},o=this.yMirrorMode&&!i,s=n._$renderAreaWrap.offset();this._containerRect=new t(0,0,0,0),this._containerRect.x=s.left,this._containerRect.y=s.top,this._containerRect.width=n._$renderAreaWrap.width(),this._containerRect.height=n._$renderAreaWrap.height(),n.scrollRect[r.size]=n.viewState.range/n.fullState.max,this._rp=e.points[0][r.pos]-this._containerRect[r.pos]-n.scrollRect[r.pos]*this._containerRect[r.size],o&&(this._rp=n.scrollRect[r.size]*this._containerRect[r.size]-this._rp),n.startScrollPos=n.scrollRect[r.pos],n.startScrollSize=n.scrollRect[r.size],this._rp<0?(n.scrollRect[r.pos]=Math.max(0,n.scrollRect[r.pos]-this._rp/this._containerRect[r.size]),this._rp=0):this._rp/this._containerRect[r.size]>n.scrollRect[r.size]&&(n.scrollRect[r.pos]=Math.min(1,this._rp/this._containerRect[r.size])-n.scrollRect[r.size],this._rp=n.scrollRect[r.size]*this._containerRect[r.size]),this.fire("scrollStart")}function c(e){var t=this,n=this.options,i=this.isVertical(),r="function"==typeof n.onScroll?n.onScroll:function(){},o={size:i?"height":"width",pos:i?"y":"x",coord:i?"pageY":"pageX"},s=e.points[0][o.pos]-this._containerRect[o.pos],a=this.yMirrorMode&&!i;if(this.allowResize){var l=(s-this._rp)/this._containerRect[o.size]-t.startScrollPos,c=t.startScrollPos,u=c+t.startScrollSize;/start/.test(e.relatedTarget.className)?(e.relatedTarget.classList.add("active"),c=Math.max(0,Math.min(u-1e-5,c+l))):/end/.test(e.relatedTarget.className)?(e.relatedTarget.classList.add("active"),u=Math.min(1,Math.max(c+1e-5,u+l))):(c=Math.min(1-t.startScrollSize,Math.max(0,c+l)),u=Math.min(1,Math.max(0+t.startScrollSize,u+l))),t.setViewRange((u-c)*t.fullState.max),a?t.setOffset((1-u)*t.fullState.max):t.setOffset(c*t.fullState.max),t.fire("offsetChanged")}else a&&(s=this.rect.width-s),t.scrollRect[o.pos]=Math.max(0,Math.min(this._containerRect[o.size]*(1-t.scrollRect[o.size]),s-this._rp))/this._containerRect[o.size],t.setOffset(t.scrollRect[o.pos]*t.fullState.max);r()}function u(){if(this.miniChart){var e=this;i(this.miniChart.container).tap({id:g,end:function(t,n){a.call(e,n)}}),i(this.miniChart.container).swipe({id:g,options:{radiusThreshold:1},start:function(t,n){l.call(e,n)},update:function(t,n){c.call(e,n)},end:function(e,t){t.relatedTarget.classList.remove("active")}})}}function h(){this.miniChart&&(n(this.miniChart.container).off(g),i(this.miniChart.container).off("*",g))}function d(){this.miniChart&&(this._internalUseMiniChart?this.miniChart.showComponent():this.miniChart.hideComponent())}function p(e,t){var n=this.viewState.min,i=this._relativeOffset?this._explicitOffset*(this.fullState.max-this.viewState.range):this._explicitOffset||0;this.viewState.min=Math.max(0,Math.min(i||0,(this.fullState.max||0)-(this.viewState.range||0))),this.viewState.min!==n&&(this.invalidateDisplay(e),t&&this.fire("offsetChanged"))}function f(e,t,n){(Array.isArray(e)?e:[e]).forEach(function(e){n.forEach(function(t){e.style[t]=""}),e.className=t})}var m,g=".scrollarea",v=s.get();return m=e.extend("ScrollArea",{init:function(){this._super.apply(this,Array.prototype.slice.call(arguments)),this._useMiniChart=!0,this._internalUseMiniChart=!0,this._miniChartThreshold=.5,this._miniChartMinimunNumberOfBars=3,this.scrollRect=new t(0,0,0,0),this.fullState={min:0,max:20},this.viewState={min:0,range:10},this.allowResize=!1,this._$renderAreaWrap.addClass("qv-chart-component-scroll-area"),this.before=document.createElement("div"),this.bar=document.createElement("div"),this.after=document.createElement("div"),this.before.style.position="absolute",this.bar.style.position="absolute",this.after.style.position="absolute",this.before.style.backgroundColor=this.after.style.backgroundColor="rgba(0,0,0,0.1)",this.bar.style.marginTop="-1px",n(this.before).attr("tid","component.scrollArea.before"),n(this.bar).attr("tid","component.scrollArea.bar"),n(this.after).attr("tid","component.scrollArea.after"),n(this.bar).append('<div class="q-resize-handle q-resize-handle-start">'),n(this.bar).append('<div class="q-resize-handle q-resize-handle-end">'),this.container.appendChild(this.before),this.container.appendChild(this.after),this.container.appendChild(this.bar),o.THEMING&&(this._styleService=v.initializeService("object."+this.options.parentType),this.before.style.backgroundColor=this.after.style.backgroundColor=this._styleService.getStyle("","color"),this.before.style.opacity=this.after.style.opacity=.1)},on:function(){var e=this;this._super(),i(this.container).tap({id:g,end:function(t,n){a.call(e,n)}}),i(this.container).swipe({id:g,options:{radiusThreshold:1},start:function(t,n){l.call(e,n)},update:function(t,n){c.call(e,n)},end:function(e,t){t.relatedTarget.classList.remove("active")}}),u.call(this),this._on&&this.allowResize&&this.container.classList.add("q-allow-resize")},off:function(){this._super(),n(this.container).off(g),i(this.container).off("*",g),h.call(this),this.container.classList.remove("q-allow-resize")},setAllowResize:function(e){this.allowResize=e,this.container.classList[e&&this._on?"add":"remove"]("q-allow-resize")},calculateRelevantSize:function(){var e,t=i.utils.touch?32:16;this.miniChart&&this._useMiniChart&&(this.miniChart.calculateRelevantSize(),e=this.miniChart.relevantSize,this._internalUseMiniChart=!0,d.apply(this)),this.relevantSize=this._internalUseMiniChart?e||16:t},insertAdjacentTo:function(){this._super.apply(this,[].slice.apply(arguments)),this.miniChart&&this.miniChart.setRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)},setRect:function(){this._super.apply(this,[].slice.apply(arguments)),this.miniChart&&this.miniChart.setRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)},setDock:function(e){this._super(e),this.miniChart&&this.miniChart.setDock(e)},getOffset:function(){return this.viewState.min},setRelativeOffset:function(e){this._explicitOffset=e,this._relativeOffset=!0,p.call(this,"ScrollArea.setOffset",!0)},setOffset:function(e){this._explicitOffset=e,this._relativeOffset=!1,p.call(this,"ScrollArea.setOffset")},setMiniChart:function(e){this.miniChart&&h.call(this),this.miniChart=e,this.miniChart.setDock(this.options.dock),d.apply(this),this._on&&u.call(this),this.invalidateDisplay("ScrollArea.setMiniChart")},setUseMiniChart:function(e){this._useMiniChart=e,this._internalUseMiniChart=e,d.apply(this),this.invalidateDisplay("ScrollArea.setUseMiniChart")},getUseMiniChart:function(){return this._useMiniChart},setViewRange:function(e){this.viewState.range=e,p.call(this,"ScrollArea.setViewRange",!0),this.invalidateDisplay("ScrollArea.setViewRange")},getViewRange:function(){return this.viewState.range},setSpaces:function(e){this._spaces=e},setDataRange:function(e){this.dataRange=e,this.invalidateDisplay("ScrollArea.setDataRange")},getDataRange:function(){return this.dataRange},setFullRange:function(e){this.fullState.max=e,p.apply(this,["ScrollArea.setFullRange",!0]),this.invalidateDisplay("ScrollArea.setFullRange")},getFullRange:function(){return this.fullState.max},isVisible:function(e){return this._super(e)&&(this.viewState.range<this.fullState.max||this.allowResize)},setOuterRect:function(e,t,n,i){this._super(e,t,n,i),this.miniChart&&this.miniChart.setOuterRect(e,t,n,i)},setLayoutToContainerRatios:function(e,t){this._super(e,t),this.miniChart&&this.miniChart.setLayoutToContainerRatios(e,t)},setContainerRect:function(e,t,n,i){this._super(e,t,n,i),this.miniChart&&this.miniChart.setContainerRect(e,t,n,i)},updateSize:function(){this._super();var e="#000000";o.THEMING&&(e=this._styleService.getStyle("","color")),this.miniChart&&this._internalUseMiniChart&&this.miniChart.isVisible()?(this.before.style.display="block",this.bar.style.border="1px solid "+r.toRGBA(e,.4),this.bar.style.backgroundColor="transparent",this.after.style.display="block",this.isVertical()?f.apply(this,[[this.before,this.bar,this.after],"qv-chart-scrollable-mini-chart-vertical",["width","left"]]):(f.apply(this,[[this.before,this.after],"qv-chart-scrollable-mini-chart-horizontal",["height","top"]]),f.apply(this,[this.bar,"qv-chart-scrollable-mini-chart-bar-horizontal",["height","top"]]))):(this.before.style.display="none",this.bar.style.backgroundColor=r.toRGBA(e,.2),this.bar.style.boxShadow="none",this.bar.style.border="none",this.after.style.display="none",this.isVertical()?f.apply(this,[this.bar,"qv-chart-scrollable-vertical",["width","left"]]):f.apply(this,[this.bar,"qv-chart-scrollable-horizontal",["height","top"]]))},paint:function(e,t){var i;o.THEMING&&(this.before.style.backgroundColor=this.after.style.backgroundColor=this._styleService.getStyle("","color"),this.before.style.opacity=this.after.style.opacity=.1),this.container.style.display="block",this._super(e,t),this.scrollRect[this.isVertical()?"height":"width"]=this.viewState.range/this.fullState.max,this.scrollRect[this.isVertical()?"y":"x"]=this.viewState.min/this.fullState.max,this.yMirrorMode&&!this.isVertical()&&(this.scrollRect.x=1-this.scrollRect.width-this.scrollRect.x),i=100*(i=(i=this.scrollRect[this.isVertical()?"height":"width"]*this.rect[this.isVertical()?"height":"width"])<1?1:i)/this.rect[this.isVertical()?"height":"width"],this.isVertical()?(n(this.before).css({height:100*this.scrollRect.y+"%",top:"0%"}),n(this.bar).css({top:100*this.scrollRect.y+"%",height:i+"%"}),n(this.after).css({top:100*this.scrollRect.y+i+"%",height:100-(100*this.scrollRect.y+i)+"%"})):(n(this.before).css({width:100*this.scrollRect.x+"%",left:"0%"}),n(this.bar).css({left:100*this.scrollRect.x+"%",width:i+"%"}),n(this.after).css({left:100*this.scrollRect.x+i+"%",width:100-(100*this.scrollRect.x+i)+"%"}))},clear:function(){this.container.style.display="none"}}),Object.defineProperty(m.prototype,"className",{value:"ScrollArea"}),m}),define("objects.views/charts/utils/label-positioner",[],function(){"use strict";return{positionRectanglesAlongAxis:function(e,t,n,i,r){function o(){var i,r,o,s,a;for(r=e[0].position,o=e[0].size,r=Math.max(n,r-o/2)+o/2,e[0].newPosition=r,i=1;i<m;i++)s=e[i-1].newPosition,a=e[i-1].size,r=e[i].position,o=e[i].size,r=Math.max(s+a/2+t,r-o/2)+o/2,e[i].newPosition=r}function s(){var r,o,s,a,l;if(o=e[m-1].newPosition,s=e[m-1].size,o+s/2>i)for(e[m-1].newPosition=i-s/2-n,r=m-2;r>=0;r--)a=e[r+1].newPosition,l=e[r+1].size,o=e[r].newPosition,s=e[r].size,o=Math.min(a-l/2-t,o+s/2)-s/2,e[r].newPosition=o}function a(){var i,r,o,s=e[0].newPosition,a=e[0].size;if(s-a/2<n)return!0;if(s-a/2>n)return!1;for(i=1;i<m;i++)if(r=e[i-1].newPosition,o=e[i-1].size,s=e[i].newPosition,a=e[i].size,r+o/2+t<s-a/2)return!1;return!0}function l(){var t,n,i,r,o,s,a,l,c,u,h,d;for(y&&y.length===v||(y=new Array(v)),t=0;t<v;t+=1)i=(n=g[t])[0],r=n[n.length-1],o=e[i],s=e[r],c=o.position,a=o.size,h=o.newPosition-a/2,u=s.position,l=s.size,d=s.newPosition+l/2,y[t]={firstPosition:c,lastPosition:u,minPosition:h,maxPosition:d}}function c(){u(0,n);for(var e=1;e<v;e++)u(e,y[e-1].maxPosition+t)}function u(e,t){g[e].length%2==0?h(e,t):d(e,t)}function h(t,n){var i,r,o,s,a,l,c,u,h,d;r=(i=g[t])[0],o=i[i.length/2-1],s=i[i.length/2],a=e[r],l=e[o],c=e[s],h=a.newPosition,u=a.size,d=(l.position+c.position)/2,p(t,h,h-((l.newPosition+c.newPosition)/2-d),u,n)}function d(t,n){var i,r,o,s,a,l,c,u;r=(i=g[t])[0],o=i[(i.length-1)/2],s=e[r],a=e[o],l=s.newPosition,c=s.size,u=a.position,p(t,l,l-(a.newPosition-u),c,n)}function p(e,t,n,i,r){if(!(n>=t)){var o=t-(n=Math.max(r+i/2,n));y[e].minPosition-=o,y[e].maxPosition-=o,f(e,o)}}function f(t,n){var i,r,o=g[t],s=o?o.length:0;for(i=0;i<s;i++)r=o[i],e[r].newPosition-=n}var m,g,v,y;m=e?e.length:0,!0!==r&&e.sort(function(e,t){return e.position>t.position?1:-1}),function(){if(0===m)return g=[],void(v=0);var n,i,r;for(g=[[0]],n=1;n<m;n++)i=e[n].position,r=e[n].size,e[n-1].position+e[n-1].size/2+t>i-r/2?g[g.length-1].push(n):g.push([n]);v=g?g.length:0}(),0!==m&&(o(),s(),l(),a()||c())}}}),define("objects.views/charts/components/ref-line-label-tooltip",["jquery","qvangular","core.utils/class","general.utils/support","general.utils/shapes/point"],function(e,t,n,i,r){"use strict";function o(e,t,n){var i=e.offset();return new r(t-i.left,n-i.top)}function s(e,t,n){var i=e.offset();return new r(i.left+t,i.top+n)}function a(e,t){return e.shapeWrapper.getBoundingRect().pointInside(t.x,t.y)}function l(e,t){return e.filter(function(e){return a(e,t)})[0]}function c(e,t){return{positions:[s(t,e.x+e.width/2,e.y),s(t,e.x+e.width,e.y+e.height/2),s(t,e.x,e.y+e.height/2),s(t,e.x+e.width/2,e.y+e.height)],directions:["top","right","left","bottom"]}}function u(){h&&(h=null)}var h,d=e(document);return n.extend("RefLineLabelTooltip",{init:function(t){this.$container=e(t)},setLabelObjects:function(e){this._labelObjects=e},on:function(){var e=this;this._onMouseMove=function(n){if(e._labelObjects){var i=o(e.$container,n.pageX,n.pageY),r=l(e._labelObjects,i);if(r&&h!==r){h=r;var s=c(r.shapeWrapper.getLocalBoundingRect(),e.$container);t.getService("qvChartTooltipService").open({content:[{rows:r.tooltipRows}],position:s.positions,direction:s.directions,hideCallback:u},7e3,500)}else r||(h=null,t.getService("qvChartTooltipService").close())}},this._onMouseLeave=function(){h=null,t.getService("qvChartTooltipService").close()},i.treatAsDesktop()&&(this.$container.on("mousemove",this._onMouseMove),this.$container.on("mouseleave",this._onMouseLeave),d.on("mouseleave.refLineLabels",this._onMouseLeave))},off:function(){this.$container.off("mousemove",this._onMouseMove),this.$container.off("mouseleave",this._onMouseLeave),d.off("mouseleave.refLineLabels",this._onMouseLeave)},release:function(){this.$container=null}})}),define("objects.views/charts/components/ref-line-labels",["./chart-component","client.utils/theme/theme-module","objects.views/charts/renderers/canvas-renderer","objects.views/charts/utils/label-positioner","objects.views/charts/chart-style-service","./ref-line-label-tooltip","objects.views/charts/shapes/text","objects.views/charts/shapes/circle","objects.views/charts/shapes/polygon","util","client.utils/rtl/rtl-util","core.utils/feature-flags"],function(e,t,n,i,r,o,s,a,l,c,u,h){"use strict";function d(e){e.forEach(function(e){e.size=e.shapeWrapper.measure().height})}function p(e,t){return e&&(e.paletteColor||e.color)?e.paletteColor?B.resolveColor(e.paletteColor):B.resolveColor(e.color,B.deprecatedPalette):t}function f(e,t,n,i,r,o){void 0===r&&(r=Number.MAX_VALUE),void 0===o&&(o=1);var a=new s;return a.setText(e),a.font=t,a.x=n,a.y=i,a.maxWidth=r,a.maxNumLines=o,a.align=V,a.baseline=H,a}function m(e){return void 0===e||""===e?0:(P.setText(e),P.measure().width)}function g(e){return void 0===e||""===e?0:(R.setText(e),R.measure())}function v(e){return void 0===e||""===e?0:(N.setText(e),N.measure().width)}function y(e,t){return void 0===e||""===e?{numLines:0,width:0,height:0,lines:[]}:(N.setText(e),N.maxWidth=t,N.measure())}function b(e,t){if(void 0===e||""===e)return{index:-1,width1:0,width2:0,width:0};void 0===t&&(t=m(e));for(var n,i,r,o,s=Number.MAX_VALUE,a=e.length,l=Math.floor(a/2),c=e.substring(0,l),u=0,h=!0,d=c.lastIndexOf(" ");d>-1&&h;)i=t-(n=m(c=e.substring(0,d)))-F,s<(r=Math.max(n,i))?h=!1:(u++,o={index:d,width1:n,width2:i,width:s=r},d=c.lastIndexOf(" "));if(u>1)return o;for(d=e.indexOf(" ",l),u=0;d>-1;){if(c=e.substring(d+1),i=m(c),n=t-i-F,r=Math.max(n,i),s<r)return o;u++,o={index:d,width1:n,width2:i,width:s=r},d=e.indexOf(" ",d+1)}return void 0===o&&(o={index:-1,width1:0,width2:t,width:t}),o}function x(e,t){if(void 0===e||""===e)return{index1:-1,index2:-1,width1:0,width2:0,width3:0,width:0};void 0===t&&(t=m(e));for(var n,i,r,o,s,a,l,c=Number.MAX_VALUE,u=e.length,h=Math.floor(u/3),d=e.substring(0,h),p=0,f=!0,g=d.lastIndexOf(" ");g>-1&&f;)d=e.substring(0,g),i=t-(r=m(n=e.substring(g+1)))-F,s=(a=b(n,r)).width,c<(o=Math.max(i,s))?f=!1:(c=o,p++,l={index1:g,index2:a.index,width1:i,width2:a.width1,width3:a.width2,width:c},g=d.lastIndexOf(" "));if(p>1)return l;for(g=e.indexOf(" ",h),p=0;g>-1;){if(n=e.substring(g+1),r=m(n),i=t-r-F,a=b(n,r),s=a.width,o=Math.max(i,s),c<o)return l;c=o,p++,l={index1:g,index2:a.index,width1:i,width2:a.width1,width3:a.width2,width:c},g=e.indexOf(" ",g+1)}return void 0===l&&(l={index1:-1,index2:-1,width1:0,width2:0,width3:t,width:t}),l}function q(e,t,n){var i;if(t<=n)return{minTextWidth:t,level:1};if(t<=2*n){if((i=b(e,t)).width<=n)return{minTextWidth:i.width,level:0===i.width1?3:2};if(0===i.width1)return{minTextWidth:Math.ceil(i.width/2)+j,level:3}}return t<3*n?0===(i=x(e,t)).width1&&0===i.width2?{minTextWidth:Math.min(Math.ceil(i.width/3)+Math.ceil(3*j/2),n),level:3}:{minTextWidth:Math.min(i.width,n),level:3}:{minTextWidth:n,level:3}}function C(e,t,n,i,r){e.size=t,e.size2=n,e.numLines=i,e.level=r}function S(e,t,n){if(!(e.size/2<=t||3===e.numLines||3===e.level)){var i,r;if(2===e.numLines)return i=x(e.text,e.singleLineTextWidth),r=y(e.text,i.width),void C(e,i.width,r.height,r.numLines,3);if(0!==(i=b(e.text,e.singleLineTextWidth)).width1){if(i.width/2<=t||!0===n)return r=y(e.text,i.width),void C(e,i.width,r.height,r.numLines,2);i=x(e.text,e.singleLineTextWidth),r=y(e.text,i.width),C(e,i.width,r.height,r.numLines,3)}}}function w(e,t,n){var i,r;e.position+e.size/2+n>t.position-t.size/2&&(e.size>t.size?(i=e,r=t.position-t.size/2-n-e.position):(i=t,r=t.position-(e.position+e.size/2+n)),S(i,r,!0))}function _(e,t,n,i,r,o){e.singleLineTextWidth=t,e.size=n,e.size2=i,e.numLines=r,e.level=o}function D(e){return String(void 0!==e.label?e.label:e)}function M(e,t){var n=e,i=c.escapeRegExp("+-"+(this.chartFormatter.getLocaleInfo().qDecimalSep||"")+(this.chartFormatter.getLocaleInfo().qThousandSep||"")),r=n.replace(new RegExp("[0-9e"+i+"]","g"),"");return r=r.length?n:this._axis.format(t)}function A(e){if(this._axis&&this._data){this._axis.updateFormatter();var t,n,i,r,o,s,a,l=this._data?this._data.length:0,c=[],h=this._axis.getPlotMin(),d=this._axis.getPlotMax(),p=[],f=[],m=-Number.MAX_VALUE,g=Number.MAX_VALUE,v=0,y=0;for(this._plotMinValueForRelevantSize=h,this._plotMaxValueForRelevantSize=d,this._maxLowerLabelIndex=void 0,this._minUpperLabelIndex=void 0,t=0;t<l;t+=1)this._data[t]&&this._data[t].show&&void 0!==this._data[t].refLineExpr&&(n=D(this._data[t].refLineExpr),null===(i=e?this._currentProperties["value"+t]:this._data[t].refLineExpr.value)||isNaN(i)||(r=this._data[t].label,o=M.apply(this,[n,i]),s=" "+u.lrm+"("+o+")"+u.lrm,i<h?(v++,f.push({label:r,value:o}),m<i&&(this._maxLowerLabelIndex=t)):i>d?(y++,p.push({label:r,value:o}),g>i&&(this._minUpperLabelIndex=t)):(a=r+s,c.push({index:t,text:a,value:i,text1:r,text2:s,tooltipRows:[{label:r,value:o}]}))));y>0&&c.push({index:-1,text:y<10?y.toString():"9+",value:"max",type:1,tooltipRows:p}),v>0&&c.push({index:-2,text:v<10?v.toString():"9+",value:"min",type:-1,tooltipRows:f}),this._labelObjects=c,this._numLabelObjects=this._labelObjects?this._labelObjects.length:0,this._labelsMaxWidthNeedToUpdate=!0,this._labelsMaxHeightNeedToUpdate=!0,this._labelObjectsNeedToUpdate=!1,this._numLowerLabels=v,this._numUpperLabels=y}}function E(){if(this._labelsMaxWidthNeedToUpdate){this._labelsMaxWidthNeedToUpdate=!1;var e,t,n=0;for(N.maxWidth=this._labelMaxWidthForYAxis,e=0;e<this._numLabelObjects;e++)if(void 0!==this._labelObjects[e].type?(t=L(g(this._labelObjects[e].text)),n=Math.max(n,t+4)):n=Math.max(n,v(this._labelObjects[e].text)+4),n>=this._labelMaxWidthForYAxis)return void(this._labelsMaxWidth=this._labelMaxWidthForYAxis);this._labelsMaxWidth=n}}function I(e){return"max"===e?Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMax()))-.5+(this.isVertical()?-.1:.1):"min"===e?Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMin()))-.5+(this.isVertical()?.1:-.1):Math.floor(this._axis.getPositionOfValue(e))-.5}function T(){var e,t,n;for(e=0;e<this._numLabelObjects;e+=1)t=this._labelObjects[e],n=I.call(this,t.value),t.position=n}function L(e){return Math.sqrt(e.width*e.width+e.height*e.height)}function k(){if(this._labelsMaxHeightNeedToUpdate){this._labelsMaxHeightNeedToUpdate=!1,T.call(this);var e,t,n=0;for(this.calculateLabelWidths(this._labelObjects,this._componentWidth,this._horizontalLabelGap,this._boundaryGap,this._labelMaxWidthForXAxis),i.positionRectanglesAlongAxis(this._labelObjects,this._horizontalLabelGap,this._boundaryGap,this._componentWidth,!0),e=0;e<this._numLabelObjects;e+=1)void 0!==this._labelObjects[e].type?(t=L(g(this._labelObjects[e].text)),n=Math.max(n,t)):n=Math.max(n,this._labelObjects[e].size2);this._labelsMaxHeight=n}}function O(e,t){var n,i=e.layoutMap[t]||"medium";return n=h.THEMING?{label:{color:e.getStyle("referenceLine.label.name","color"),font:"normal "+e.scaleFontSize(e.getStyle("referenceLine.label.name","fontSize"),t,null)+" 'QlikView Sans'"},outOfBounds:{color:e.getStyle("referenceLine.outOfBounds","color"),backgroundColor:e.getStyle("referenceLine.outOfBounds","backgroundColor"),font:"normal "+e.scaleFontSize(e.getStyle("referenceLine.outOfBounds","fontSize"),t,null)+" 'QlikView Sans'"}}:{label:{color:e.getValue("","referenceLine.label","color"),font:e.getFont("","referenceLine.label",i)},outOfBounds:{color:e.getValue("","referenceLine.outOfBounds","color"),backgroundColor:e.getValue("","referenceLine.outOfBounds","backgroundColor"),font:e.getFont("","referenceLine.outOfBounds",i)}},P=f("",n.label.font,0,0,Number.MAX_VALUE,1),N=f("",n.label.font,0,0,Number.MAX_VALUE,3),R=f("",n.outOfBounds.font,0,0,Number.MAX_VALUE,1),F=m("m m")-m("mm"),j=m("m"),n}var P,N,R,F,j,V="center",H="bottom",B=t.get();return e.extend("RefLineLabels",{init:function(){this._super.apply(this,arguments),this.renderer=new n(this.container),this._tooltips=new o(this.container),this._currentProperties={},this._transitionProperties={},this.renderers={labels:this.renderer},this._$renderAreaWrap.addClass("qv-chart-component-reflinelabels"),this._hasVisibleRefLines=!1,this._styleService=h.THEMING?B.initializeService("object."+this.options.parentType):r.getInstance(),this._style=O(this._styleService),this._labelMargin=4,this._labelMaxWidthForYAxis=70,this._labelMaxWidthForXAxis=100,this._labelMaxHeightForXAxis=50,this._verticaLabelGap=4,this._horizontalLabelGap=6,this._boundaryGap=4},calculateRelevantSize:function(){if(this._super(),A.call(this),this.isVertical())E.call(this),this.relevantSize=this._labelsMaxWidth+this._labelMargin;else{var e=this.rect.width?this.rect.width:this._axis._plotSize;this._componentWidth!==e&&(this._componentWidth=e,this._labelsMaxHeightNeedToUpdate=!0),k.call(this),this.relevantSize=this._labelsMaxHeight+this._labelMargin}},calculatePreliminaryRelevantSize:function(){this.relevantSize=this.isVertical()?this._labelMaxWidthForYAxis:this._labelMaxHeightForXAxis},setData:function(){this._super.apply(this,arguments),this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues(),this._labelObjectsNeedToUpdate=!0},setAxis:function(e){var t=this;this._axis&&this._axis.stopListen("changed",t.invalidateDisplay,t),this._axis=e,this._axis.listen("changed",t.invalidateDisplay,t),this._labelObjectsNeedToUpdate=!0},isVisible:function(){return!!this._super.apply(this,arguments)&&(this._axis&&(this._plotMinValue===this._axis.getPlotMin()&&this._plotMaxValue===this._axis.getPlotMax()||(this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues())),this._hasVisibleRefLines)},calculateLabelWidths:function(e,t,n,i,r){var o,s,a,l,c,u,h,d=e?e.length:0;if(0!==d){for(o=0;o<d;o++)void 0===(l=(a=e[o]).text)||""===l?_(a,0,0,0,0,0):(h=y(l,(u=q(l,c=m(l),r)).minTextWidth),_(a,c,u.minTextWidth,h.height,h.numLines,u.level));for(e.sort(function(e,t){return e.position>t.position?1:-1}),void 0!==(a=e[d-1]).text&&""!==a.text&&S(a,t-a.position-i),void 0!==(a=e[0]).text&&""!==a.text&&S(a,a.position-i),o=0;o<d-1;o++)if(void 0!==e[o].text&&""!==e[o].text&&void 0!==e[o+1].text&&""!==e[o+1].text)for(s=0;s<4;s++)w(e[o],e[o+1],n)}},checkIfHavingVisibleRefLines:function(){if(!this._data||0===this._data.length||!this._axis)return!1;var e;for(e=0;e<this._data.length;e+=1)if(this._data[e]&&this._data[e].show&&void 0!==this._data[e].refLineExpr){if("value"in this._data[e].refLineExpr&&(null===this._data[e].refLineExpr.value||isNaN(this._data[e].refLineExpr.value)))continue;return!0}return!1},updateLocalPlotMaxMinValues:function(){this._axis&&(this._plotMinValue=this._axis.getPlotMin(),this._plotMaxValue=this._axis.getPlotMax())},setLabelMargin:function(e){this._labelMargin=void 0===e?4:e},hasValidData:function(){return this._super()&&this._data&&this._axis},paint:function(){if(this._super.apply(this,arguments),this._style=O(this._styleService),this._plotMinValue===this._axis.getPlotMin()&&this._plotMaxValue===this._axis.getPlotMax()||(this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues()),this._hasVisibleRefLines){A.call(this,!0);var e,t,n,r,o,c,u,h,f,m,g,v,y,b,x,q,C,S,w,_=this.isVertical()?"middle":"top"===this.dock?"bottom":"top",D=this.rect.width,M=this.rect.height,E="top"===this.dock?M-this._labelMargin:this._labelMargin,T=new Array(this._numLabelObjects),k=this._labelMaxWidthForYAxis,P=this._style.label.font,N="top"===this.dock?(M-this._labelMargin)/2:(M+this._labelMargin)/2;for(this.yMirrorMode?(h=.7,f=.3,m=D/2-(this._labelMargin/2+1)):(h=.3,f=.7,m=D/2+this._labelMargin/2+1),w=m,e=0;e<this._numLabelObjects;e+=1)t=(C=this._labelObjects[e]).index,n=I.call(this,C.value),this.isVertical()?(r=m,o=n):(r=n,o=void 0!==C.type?N:E),g=t>-1?p(this._data[t],this._style.label.color):this._style.label.color,void 0!==C.type?(P=this._style.outOfBounds.font,S="middle",g=this._style.outOfBounds.color):(P=this._style.label.font,S=_),(v=new s).fill=g,v.x=r,v.y=o,v.align=V,v.baseline=S,v.font=P,v.maxWidth=k,v.maxHeight=92,v.maxNumLines=3,v.ellipsis=" "+C.text2,v.setText(C.text),T[e]=v,C.position=n,C.shapeWrapper=v;if(0!==this._numLabelObjects){if(this.isVertical()){for(d(this._labelObjects),this._numUpperLabels>0&&(n=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMax()))-.7,this._labelObjects.push({position:n,size:2})),this._numLowerLabels>0&&(n=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMin()))-.3,this._labelObjects.push({position:n,size:2})),i.positionRectanglesAlongAxis(this._labelObjects,this._verticaLabelGap,this._boundaryGap,this.rect.height,!1),e=this._labelObjects.length-1;e>-1;e--)void 0===this._labelObjects[e].shapeWrapper&&this._labelObjects.splice(e,1);for(e=0;e<this._numLabelObjects;e+=1)(y=(C=this._labelObjects[e]).shapeWrapper).y=C.newPosition,1===C.type&&(b=C.shapeWrapper.measure(),x={cx:y.x,cy:y.y,r:L(b)/2}),-1===C.type&&(b=C.shapeWrapper.measure(),q={cx:y.x,cy:y.y,r:L(b)/2})}else{for(this.calculateLabelWidths(this._labelObjects,this.rect.width,this._horizontalLabelGap,this._boundaryGap,this._labelMaxWidthForXAxis),this._numUpperLabels>0&&(n=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMax()))-h,this._labelObjects.push({position:n,size:2})),this._numLowerLabels>0&&(n=Math.floor(this._axis.getPositionOfValue(this._axis.getPlotMin()))-f,this._labelObjects.push({position:n,size:2})),i.positionRectanglesAlongAxis(this._labelObjects,this._horizontalLabelGap,this._boundaryGap,this.rect.width,!1),e=this._labelObjects.length-1;e>-1;e--)void 0===this._labelObjects[e].shapeWrapper&&this._labelObjects.splice(e,1);for(e=0;e<this._numLabelObjects;e+=1)(y=(C=this._labelObjects[e]).shapeWrapper).x=C.newPosition,y.maxWidth=C.size,1===C.type&&(b=C.shapeWrapper.measure(),x={cx:y.x,cy:N,r:L(b)/2}),-1===C.type&&(b=C.shapeWrapper.measure(),q={cx:y.x,cy:N,r:L(b)/2})}this._numLowerLabels>0&&(this.isVertical()?v=new l([{x:w-3,y:M-5.2},{x:w,y:M},{x:w+3,y:M-5.2}]):(c=this.yMirrorMode?D-5.2:5.2,u=this.yMirrorMode?D:0,v=new l([{x:c,y:N-3},{x:u,y:N},{x:c,y:N+3}])),v.fill=this._style.label.color,T.push(v),(v=new a(q.cx,q.cy,q.r)).fill=this._style.outOfBounds.backgroundColor,T.splice(0,0,v)),this._numUpperLabels>0&&(this.isVertical()?v=new l([{x:w-3,y:5.2},{x:w,y:0},{x:w+3,y:5.2}]):(c=this.yMirrorMode?5.2:D-5.2,u=this.yMirrorMode?0:D,v=new l([{x:c,y:N-3},{x:u,y:N},{x:c,y:N+3}])),v.fill=this._style.label.color,T.push(v),(v=new a(x.cx,x.cy,x.r)).fill=this._style.outOfBounds.backgroundColor,T.splice(0,0,v)),this.renderer.stage.removeChildren(),this.renderer.stage.addChildren(T),this.renderer.render(),this._tooltips.setLabelObjects(this._labelObjects)}else this._clearLabels()}else this._clearLabels()},release:function(){this._super(),this._axis&&this._axis.stopListen("changed",null,this),this._tooltips.release(),this._tooltips=null},on:function(){this._super(),this._tooltips.on()},off:function(){this._super(),this._tooltips.off()},_updateProperties:function(){if(this._data){var e,t,n=this._data,i=n.length;for(t=0;t<i;t++)e="value"+t,this._transitionProperties[e]=n[t].refLineExpr.value;this.calculateRelevantSize(),this._super()}},_clearLabels:function(){this.renderer.stage.removeChildren(),this.renderer.clear()}})}),define("objects.views/charts/utils/continuous-chart-util",["util"],function(e){return{getFocusRange:function(e,t,n,i){var r,o={},s=t<1?0:t-1,a=e.length-n-1;if(i<2)o[e[0][1].qElemNumber]={lower:null,upper:null};else for(var l=0;l<e.length;l++)o[e[l][1]]||(o[e[l][1].qElemNumber]={lower:null,upper:null});for(l=t-1;l>=0;l--)(r=o[e[l][1].qElemNumber])&&!r.lower&&(r.lower=l);for(l=e.length-n;l<e.length;l++)(r=o[e[l][1].qElemNumber])&&!r.upper&&(r.upper=l);return Object.keys(o).forEach(function(e){o[e].lower<s&&(s=o[e].lower),o[e].upper>a&&(a=o[e].upper)}),{lower:s,upper:a}},getFullContinuousRange:function(e){var t=e.qHyperCube.qDimensionInfo[0].qMin,n=e.qHyperCube.qDimensionInfo[0].qMax;return n<t||"NaN"===n?t=n="NaN":t===n&&(t-=.5,n+=.5),{min:t,max:n}},addContinuousDataToLayout:function(t,n){return t=e.extend({},t),t.qHyperCube=e.extend({},t.qHyperCube,{qMode:"S"}),t.qHyperCube.qDataPages=n.qDataPages,t.qHyperCube.qAxisData=n.qAxisData,t}}}),define("objects.views/charts/utils/pan-scroll-controller",["jquery","core.utils/notification","objects.utils/event-utils","general.utils/shapes/point","objects.views/selections/interaction-handler","objects.views/selections/interaction-type"],function(e,t,n,i,r,o){"use strict";var s=3;return o.extend("PanScrollController",{init:function(r,o,a){function l(e,t){h._panning=!0,h._panX=t.points[0].x,h._panY=t.points[0].y,h.PanStart.emit()}function c(e,t){h._panning||(h._panning=!0,h._panX=t.points[0].x,h._panY=t.points[0].y);var n=t.swipe&&t.swipe.currentPoint?t.swipe.currentPoint:new i(e.pageX,e.pageY),r=new i(n.x-h._panX,n.y-h._panY);h._panX=n.x,h._panY=n.y,h.PanUpdate.emit(r)}function u(){h._panning=!1,h.PanEnd.emit()}t.mixin(this),this.notification("PanStart"),this.notification("PanUpdate"),this.notification("PanWheel"),this.notification("PanEnd"),this._$dataAreaContainer=r,this._$fullContainer=o;var h=this;this._options=e.extend(!0,{preventDefault:!0},a),this._eventHandlers={swipe:{start:l,update:c,end:u},swipetwo:{start:l,update:c,end:u},mousewheel:n.throttle(function(e){var t=n.getMouseWheelData(e.originalEvent);if(t.delta){var i=t.delta>0?s:-s;h.PanWheel.emit(i)}},20),wheelswipe:{start:function(e){h._panning=!0,h._panX=e.pageX,h._panY=e.pageY,h.PanStart.emit()},update:c,end:u},exclusive:function(){return!1},active:function(){return!0}}},on:function(){this._isOn||(r.addInteraction(this._eventHandlers,this._$dataAreaContainer,2,["swipe","swipetwo"],this._options.preventDefault),r.addInteraction(this._eventHandlers,this._$fullContainer,2,["mousewheel","wheelswipe"],this._options.preventDefault),this._isOn=!0)},off:function(){this._isOn&&(r.removeInteraction(this._eventHandlers),this._isOn=!1)}})}),define("objects.views/charts/utils/unit-projection",["core.utils/class"],function(e){return e.extend("UnitProjection",{init:function(){},getProjectionType:function(){return"Unit"},project:function(e){return e},invProject:function(e){return e}})}),define("objects.views/charts/utils/viewport-projection",["objects.views/charts/events/event-launcher","general.utils/shapes/point","general.utils/shapes/rect","objects.views/charts/utils/unit-projection","objects.views/charts/utils/matrix"],function(e,t,n,i,r){function o(e){return this._originalProjectedDataCenterIsZeroPoint?e:new t(e.x-this._originalProjectedDataCenter.x,e.y-this._originalProjectedDataCenter.y)}function s(e){return this._originalProjectedDataCenterIsZeroPoint?e:new t(e.x+this._originalProjectedDataCenter.x,e.y+this._originalProjectedDataCenter.y)}function a(e,n){var i=Math.pow(2,n+8)/this._projectedDataSize;return new t(e.x*i,e.y*i)}function l(e,n){var i=Math.pow(2,n+8)/this._projectedDataSize;return new t(e.x/i,e.y/i)}function c(){if(this._projection&&this._projectedDataBoundingBox){var e,t,n,i,r;(!this._currentProjectedDataDataCenter||this._projectionChanged||this._currentDataCenterChanged)&&(this._currentProjectedDataDataCenter=void 0===this._currentDataCenter?this._originalProjectedDataCenter:this._projection.project(this._currentDataCenter)),this._transformMatrixForZoomLevel.identity(),this._transformMatrixForZoomLevel.translate(this._viewportSize.x/2,this._viewportSize.y/2),this._mirrorYAxis&&this._transformMatrixForZoomLevel.scale(1,-1),e=Math.pow(2,this._zoomLevel+8)/this._projectedDataSize,this._transformMatrixForZoomLevel.scale(e,e),this._transformMatrixForZoomLevel.translate(-this._originalProjectedDataCenter.x,-this._originalProjectedDataCenter.y),t=this._transformMatrixForZoomLevel.transformPoint(this._originalProjectedDataCenter),n=this._transformMatrixForZoomLevel.transformPoint(this._currentProjectedDataDataCenter),i=t.x-n.x,r=t.y-n.y,this._transformMatrix.identity(),this._transformMatrix.translate(i,r),this._transformMatrix.multiply(this._transformMatrixForZoomLevel.elements),this._invTransformMatrix=this._transformMatrix.clone(),this._invTransformMatrix.invert(),this._projectionChanged=!1,this._currentDataCenterChanged=!1,this.enabledChangeEvent&&this.fire("changed")}}function u(){var e,t,i,r,o,s;e={x:this._boundingBox.x,y:this._boundingBox.y},t={x:this._boundingBox.x+this._boundingBox.width,y:this._boundingBox.y+this._boundingBox.height},i=this._projection.project(e),r=this._projection.project(t),o=Math.min(i.x,r.x),s=Math.min(i.y,r.y),this._projectedDataBoundingBox=new n(o,s,Math.abs(r.x-i.x),Math.abs(r.y-i.y)),this._projectedDataSize=Math.max(this._projectedDataBoundingBox.width,this._projectedDataBoundingBox.height),this._originalProjectedDataCenter=this._projectedDataBoundingBox.getCenterPoint(),this._originalProjectedDataCenterIsZeroPoint=0===this._originalProjectedDataCenter.x&&0===this._originalProjectedDataCenter.y}var h=new t(0,0),d=Math.log(2);return e.extend("ViewportProjection",{init:function(){this._super(),this._fractionalZoomMode=!0,this._viewportSize=new t(256,256),this._zoomLevel=0,this._maxZoomLevel=22,this._minZoomLevel=0,this._translation=new t(0,0),this._unitProjection=new i,this._projection=this._unitProjection,this._originalProjectedDataCenter=new t(0,0),this._boundingBox=new n(0,0,256,256),u.call(this),this._originalProjectedDataCenterIsZeroPoint=!0,this._transformMatrixForZoomLevel=new r,this._transformMatrix=new r,this._invTransformMatrix=new r,this.enabledChangeEvent=!0,this._mirrorYAxis=!1,this.helpFunctions={translateProjectedDataCenterToZeroPoint:o,invTranslateProjectedDataCenterToZeroPoint:s,scaleProjectedDataToZoomLevel:a,invScaleProjectedDataToZoomLevel:l,updateProjectedDataBoundingBox:u}},setProjection:function(e){return(!this._projection||!e||this._projection.getProjectionType()!==e.getProjectionType())&&(this._projection=e,this._projection||(this._projection=this._unitProjection),u.call(this),this._projectionChanged=!0,c.call(this),!0)},getProjection:function(){return this._projection},getUnitProjection:function(){return this._unitProjection},setBoundingBox:function(e){this._boundingBox&&this._boundingBox.equal&&this._boundingBox.equal(e)||(this._boundingBox=new n(e.x,e.y,e.width,e.height),u.call(this),c.call(this))},getBoundingBox:function(){return this._boundingBox},setSize:function(e){return!(this._viewportSize&&this._viewportSize.equal&&this._viewportSize.equal(e))&&(this._viewportSize=new t(e.x,e.y),c.call(this),!0)},getSize:function(){return this._viewportSize},setZoomLevel:function(e){return!isNaN(e)&&(this._fractionalZoomMode||(e=Math.round(e)),e=Math.max(Math.min(e,this._maxZoomLevel),this._minZoomLevel),Math.abs(e-this._minZoomLevel)<.001?e=this._minZoomLevel:Math.abs(e-this._maxZoomLevel)<.001&&(e=this._maxZoomLevel),!(Math.abs(this._zoomLevel-e)<.001)&&(this._zoomLevel=e,c.call(this),!0))},getZoomLevel:function(){return this._zoomLevel},setDataCenter:function(e){return!!e&&(!(this._currentDataCenter&&this._currentDataCenter.closeTo&&this._currentDataCenter.closeTo(e,1e-9))&&(this._currentDataCenterChanged=!0,this._currentDataCenter=new t(e.x,e.y),c.call(this),!0))},getDataCenter:function(){return this._currentDataCenter},setFractionalZoomMode:function(e){this._fractionalZoomMode=e},getFractionalZoomMode:function(){return this._fractionalZoomMode},project:function(e){var t;return t=this._projection.project(e),this.transform(t)},fromDataRectToViewportRect:function(e){var i,r;return i=this.project(new t(e.x,e.y)),r=this.project(new t(e.x+e.width,e.y+e.height)),new n(i.x,i.y,r.x-i.x,r.y-i.y)},invProject:function(e){var t;return t=this.invTransform(e),this._projection.invProject(t)},fromViewportRectToDataRect:function(e){var i,r;return i=this.invProject(new t(e.x,e.y)),r=this.invProject(new t(e.x+e.width,e.y+e.height)),new n(i.x,i.y,r.x-i.x,r.y-i.y)},getDataRectOfViewport:function(){var e,t;return e=this.invProject(h),t=this.invProject(this._viewportSize),new n(e.x,e.y,t.x-e.x,t.y-e.y)},getDataRectOfViewportIfZoomOnADataRect:function(e){var t=this.enabledChangeEvent;this.enabledChangeEvent=!1;var n=this.getZoomLevel(),i=this.getDataCenter();this.zoomOnDataRectangle(e);var r=this.getDataRectOfViewport();return this.setZoomLevel(n),this.setDataCenter(i),this.enabledChangeEvent=t,r},transform:function(e){var n=this._transformMatrix.transformPoint(e);return new t(n.x,n.y)},invTransform:function(e){var n=this._invTransformMatrix.transformPoint(e);return new t(n.x,n.y)},fromDataPointToPixel:function(e,n){var i,r,s,l=Math.pow(2,n+7);return i=this._projection.project(e),r=o.call(this,i),s=a.apply(this,[r,n]),new t(s.x+l,l-s.y)},fromPixelToDataPoint:function(e,n){var i,r,o,a=Math.pow(2,n+7);return o=new t(e.x-a,a-e.y),r=l.apply(this,[o,n]),i=s.call(this,r),this._projection.invProject(i)},calculateZoomLevelForDataRectangle:function(e){if(e){var n,i,r,o,s,a,l,c,u;return n=new t(e.x,e.y),i=new t(e.x+e.width,e.y+e.height),r=this.fromDataPointToPixel(n,0),o=this.fromDataPointToPixel(i,0),s=Math.abs(r.x-o.x),a=Math.abs(r.y-o.y),l=0===s?Number.MAX_VALUE:this._viewportSize.x/s,c=0===a?Number.MAX_VALUE:this._viewportSize.y/a,(u=Math.min(l,c))===Number.MAX_VALUE?20:Math.log(u)/Math.LN2}},calculateCenterPointForDataRectangle:function(e){if(e){var n,i,r,o,s;return n=new t(e.x,e.y),i=new t(e.x+e.width,e.y+e.height),r=this.fromDataPointToPixel(n,0),o=this.fromDataPointToPixel(i,0),s=new t((r.x+o.x)/2,(r.y+o.y)/2),this.fromPixelToDataPoint(s,0)}},moveViewport:function(e,n){this.setDataCenter(this.invProject(new t(this._viewportSize.x/2-e,this._viewportSize.y/2-n)))},zoom:function(e){e>0&&this.setZoomLevel(this.getZoomLevel()+Math.log(e)/Math.LN2)},zoomOnPixel:function(e,t){if(t>0){var n,i,r;n=this.invTransform(e),r=Math.log(t)/Math.LN2,this.setZoomLevel(this.getZoomLevel()+r),i=this.transform(n),this.moveViewport(e.x-i.x,e.y-i.y)}},zoomOnDataRectangle:function(e,t){if(e){var n,i;n=this.calculateZoomLevelForDataRectangle(e),this._fractionalZoomMode||(n=t?Math.round(n):Math.floor(n)),this.setZoomLevel(n),i=this.calculateCenterPointForDataRectangle(e),this.setDataCenter(i)}},setMaxZoomLevel:function(e){this._maxZoomLevel=e},setMinZoomLevel:function(e){this._minZoomLevel=e},getTransformMatrix:function(){return this._transformMatrix},setTransformMatrix:function(e){var n,i,r;this._invTransformMatrix=e.clone().invert(),n=Math.abs(e.elements[0][0]),i=Math.log(n*this._projectedDataSize)/d-8,r=this.invProject(new t(this._viewportSize.x/2,this._viewportSize.y/2)),this.setZoomLevel(i),this.setDataCenter(r)},getInvTransformMatrix:function(){return this._invTransformMatrix}})}),define("objects.views/charts/utils/pan-zoom-controller",["core.utils/class","objects.utils/event-utils","general.utils/shapes/point","general.utils/shapes/rect","objects.views/charts/utils/matrix","objects.views/charts/utils/viewport-projection","objects.views/selections/interaction-type","objects.views/selections/interaction-handler","touche"],function(e,t,n,i,r,o,s,a,l){"use strict";function c(e){e=Math.min(Math.max(e,this._minZoomLevel),this._maxZoomLevel),this._viewportProjection.setZoomLevel(e)}function u(e,t,n,i){var o,s,a,l,c,u=new r,h=n/i;a=t.x-e.x,l=t.y-e.y,o=this._localMatrix.clone().invert().transformPoint(e),u.translate(o.x,o.y),u.scale(h,h),u.translate(-o.x,-o.y),this._localMatrix=this._localMatrix.multiply(u),c=this._localMatrix.elements,this._localMatrix.translate(a/c[0][0],l/c[1][1]),d.call(this),u.identity(),s=this._globalMatrix.clone().invert().transformPoint(e),u.translate(s.x,s.y),u.scale(h,h),u.translate(-s.x,-s.y),this._globalMatrix=this._globalMatrix.multiply(u),c=this._globalMatrix.elements,this._globalMatrix.translate(a/c[0][0],l/c[1][1])}function h(e){if(!this._setTransformOrigin){var t="top left";e.style["-webkit-transform-origin"]=t,e.style["-moz-transform-origin"]=t,e.style["-o-transform-origin"]=t,e.style["-ms-transform-origin"]=t,e.style["transform-origin"]=t,this._setTransformOrigin=!0}}function d(){var e=this._localMatrix.elements,t="matrix("+e[0][0]+",0,0,"+e[1][1]+","+e[0][2]+","+e[1][2]+")";this.helpFunctions.setTransform(this._$element[0],t)}function p(e,t){this.helpFunctions.onInteractionStart(),f.call(this,e,t)}function f(e,t){if(!this._disableZoomOnMouseWheel){this._disableZoomOnMouseWheel=!0;var n,i=this,o=new r;if(setTimeout(function(){i._disableZoomOnMouseWheel=!1},i._mouseWheelTimeoutPeriod),this._zoomPanByWebkitTransform){var s;this._zooming=!0,s=this._localMatrix.clone().invert().transformPoint(e),o.translate(s.x,s.y),o.scale(t,t),o.translate(-s.x,-s.y),this._localMatrix=this._localMatrix.multiply(o),d.call(this)}else x.call(this,e,t);this._zoomCancelled||(o.identity(),n=this._globalMatrix.clone().invert().transformPoint(e),o.translate(n.x,n.y),o.scale(t,t),o.translate(-n.x,-n.y),this._globalMatrix=this._globalMatrix.multiply(o),this._updateCallback()),this._zoomCancelled=!1}}function m(){this._zooming=!1,this.helpFunctions.onInteractionEnd()}function g(e,t){this.helpFunctions.onInteractionStart(),v.call(this,e,t)}function v(e,t){var n;this._zoomPanByWebkitTransform?(this._panning=!0,n=this._localMatrix.elements,this._localMatrix.translate(e/n[0][0],t/n[1][1]),d.call(this)):b.call(this,e,t),n=this._globalMatrix.elements,this._globalMatrix.translate(e/n[0][0],t/n[1][1]),this._updateCallback()}function y(){this._panning=!1,this.helpFunctions.onInteractionEnd()}function b(e,t){this._viewportProjection.enabledChangeEvent=!1,this.moveViewport(e,t),this._viewportProjection.enabledChangeEvent=!0}function x(e,t){this._viewportProjection.enabledChangeEvent=!1,this.zoomOnPixel(e,t),this._viewportProjection.enabledChangeEvent=!0}var q=e.extend("PanZoomController",{init:function(e,t,n,s){var a=this;this._minZoomLevel=-3,this._maxZoomLevel=22,this._interactionStarted=!1,this._zoomPanByWebkitTransform=!1,this._fractionalZoomMode=!0,this._defaultScale=Math.pow(2,.5),this._invDefaultScale=1/this._defaultScale,this._mouseWheelTimeoutPeriod=50,this._viewportProjection=s||new o,this._viewportProjection.setMinZoomLevel(this._minZoomLevel),this._viewportProjection.setMaxZoomLevel(this._maxZoomLevel),this._localMatrix=new r,this._$element=e,this._offset=e.offset(),this._startCallback=function(){t.start&&t.start(this._viewportProjection._transformMatrix)},this._updateCallback=function(){t.update&&t.update(this._viewportProjection._transformMatrix)},this._endCallback=function(){t.end&&t.end(this._viewportProjection._transformMatrix)},this._resetCallback=function(){t.reset&&t.reset(this._viewportProjection._transformMatrix)},this._enabled=!0,this._defaultBounds=this._viewportProjection.getBoundingBox(),this._dataBounds=n?new i(n.x,n.y,n.width,n.height):this._defaultBounds,this.helpFunctions={setTransform:function(e,t){e.style["-webkit-transform"]=t,e.style["-moz-transform"]=t,e.style["-o-transform"]=t,e.style["-ms-transform"]=t,e.style.transform=t},onInteractionStart:function(){a._interactionStarted||(a._startCallback(),a.reset(),a._interactionStarted=!0)},onInteractionEnd:function(){a._zooming||a._panning||a._pinching||!a._interactionStarted||(a.helpFunctions.setTransform(a._$element[0],"matrix(1,0,0,1,0,0)"),a._viewportProjection.enabledChangeEvent=!1,a._viewportProjection.setTransformMatrix(a._globalMatrix),a._endCallback(),a._viewportProjection.enabledChangeEvent=!0,a._interactionStarted=!1)}}},reset:function(){this._localMatrix.identity(),this._globalMatrix=this._viewportProjection.getTransformMatrix().clone(),this._zoomPanByWebkitTransform&&this.helpFunctions.setTransform(this._$element[0],"matrix(1,0,0,1,0,0)")},setOffset:function(e){this._offset=e},navigate:function(e,t){var n,i=this;switch(e){case"resetZoom":i.zoomOnDataBounds();break;case"zoomIn":if(void 0===(n=i.getZoomLevel())||null===n||n===i._maxZoomLevel)return;p.call(i,{x:this._$element.width()/2,y:this._$element.height()/2},i._defaultScale),m.call(i);break;case"zoomOut":if(void 0===(n=i.getZoomLevel())||null===n||n===i._minZoomLevel)return;p.call(i,{x:this._$element.width()/2,y:this._$element.height()/2},i._invDefaultScale),m.call(i);break;case"navUp":g.call(i,0,200),y.call(i);break;case"navDown":g.call(i,0,-200),y.call(i);break;case"navLeft":g.call(i,200,0),y.call(i);break;case"navRight":g.call(i,-200,0),y.call(i);break;case"jumpTo":g.call(i,t.x,t.y),y.call(i);break;case"startAt":g.call(i,t.x,t.y);break;case"moveTo":v.call(i,t.x,t.y);break;case"endAt":y.call(i)}},onPan:function(e,t,n){var i=this;switch(e){case"start":g.call(i,n.swipe.deltaX,n.swipe.deltaY);break;case"update":v.call(i,n.swipe.curDeltaX,n.swipe.curDeltaY);break;case"end":y.call(i)}},on:function(e,i){var r,o,c,d,b=this,x=!1,q=i||this._$element[0],C=!1;this.container=q,this.namespace=e,h.call(this,this._$element[0]);var S=function(e){var i,r,o,s,a=t.getMouseWheelData(e.originalEvent);i=a.x-b._offset.left,r=a.y-b._offset.top,o=new n(i,r),s=a.delta>0?b._defaultScale:b._invDefaultScale,C?f.call(b,o,s):p.call(b,o,s),C=!0,null!==d&&clearTimeout(d),d=setTimeout(function(){d=null,m.call(b),C=!1},250)},w=function(e,t){2===t.pagePoints.length?(this.pinch={start:{},current:{}},this.pinch.start.point1=t.pagePoints[0],this.pinch.start.point2=t.pagePoints[1],t.centerPoint=new n((this.pinch.start.point1.x+this.pinch.start.point2.x)/2,(this.pinch.start.point1.y+this.pinch.start.point2.y)/2),t.scale=1,(o={}).x=(this.pinch.start.point1.x+this.pinch.start.point2.x)/2-b._offset.left,o.y=(this.pinch.start.point1.y+this.pinch.start.point2.y)/2-b._offset.top,c={x:t.centerPoint.x-b._offset.left,y:t.centerPoint.y-b._offset.top},b.helpFunctions.onInteractionStart(),r=t.scale,o=c):b.onPan("start",e,t),l.preventGestures(this.gestureHandler)},_=function(e,t){2===t.pagePoints.length?this.pinch.start.point2?(t.centerPoint||(t.centerPoint=new n((this.pinch.start.point1.x+this.pinch.start.point2.x)/2,(this.pinch.start.point1.y+this.pinch.start.point2.y)/2)),this.pinch.current.point1=t.pagePoints[0],this.pinch.current.point2=t.pagePoints[1],this.startDistance=this.pinch.start.point2.distanceTo(this.pinch.start.point1),this.lastDistance=this.currentDistance,this.currentDistance=this.pinch.current.point2.distanceTo(this.pinch.current.point1),this.pinchLength=Math.abs(this.startDistance-this.currentDistance),this.scale=this.currentDistance/this.startDistance,t.scale=this.scale,t.delta=this.currentDistance-this.lastDistance,t.centerPoint.x=(this.pinch.current.point1.x+this.pinch.current.point2.x)/2,t.centerPoint.y=(this.pinch.current.point1.y+this.pinch.current.point2.y)/2,c={x:t.centerPoint.x-b._offset.left,y:t.centerPoint.y-b._offset.top},b._pinching=!0,b._zoomPanByWebkitTransform?(u.call(b,o,c,t.scale,r),r=t.scale):(Math.abs(t.scale-r)>.1&&(f.call(b,c,t.scale-r+1),r=t.scale),v.call(b,c.x-o.x,c.y-o.y)),o=c):this.pinch.start.point2=t.pagePoints[1]:b.onPan("update",e,t),l.preventGestures(this.gestureHandler)},D=function(e,t){b._pinching=!1,this._zoomPanByWebkitTransform||(this._zooming=!1),b.onPan("end",e,t)},M=t.throttle(function(e){S(e)},20);this._eventHandlers=s.extend({mousewheel:function(e){M(e),e.preventDefault()},swipe:{start:function(e,t){w.call(this,e,t)},update:function(e,t){_.call(this,e,t)},end:function(e,t){D.call(this,e,t)}},swipetwo:{start:function(e,t){w.call(this,e,t)},update:function(e,t){_.call(this,e,t)},end:function(e,t){D.call(this,e,t)}},tapthree:{end:function(){b.zoomOnDataBounds(),a.preventGestures(this)}},wheelswipe:{start:function(e){b._panX=e.pageX,b._panY=e.pageY,x=!1},update:function(e){var t,n,i,r,o;t=e.pageX,n=e.pageY,i=t-b._panX,r=n-b._panY,o=x,!x&&(Math.abs(i)>3||Math.abs(r)>3)&&(x=!0),x&&(b._panX=t,b._panY=n,o?v.call(b,i,r):g.call(b,i,r))},end:function(){x?y.call(b):b.zoomOnDataBounds(),x=!1}},active:function(){return b._enabled}}),a.addInteraction(this._eventHandlers,q,2,["tapthree","swipe","swipetwo","wheelswipe","mousewheel"],!1)},off:function(){a.removeInteraction(this._eventHandlers)},setMaxZoomLevel:function(e){this._maxZoomLevel=e,this._viewportProjection&&this._viewportProjection.setMaxZoomLevel(e)},setMinZoomLevel:function(e){this._minZoomLevel=e,this._viewportProjection&&this._viewportProjection.setMinZoomLevel(e)},setCenter:function(e){this._viewportProjection&&this._viewportProjection.setDataCenter(e)},getCenter:function(){return this._viewportProjection?this._viewportProjection.getDataCenter():null},setZoomLevel:function(e){!isNaN(e)&&isFinite(e)&&(Math.abs(e-Math.round(e))<1e-6&&(e=Math.round(e)),c.call(this,e))},getZoomLevel:function(){return this._viewportProjection?this._viewportProjection.getZoomLevel():0},moveViewport:function(e,t){var i=this._viewportProjection.getSize();this.setCenter(this._viewportProjection.invProject(new n(i.x/2-e,i.y/2-t)))},zoom:function(e){if(e>0){var t=Math.log(e)/Math.LN2;Math.abs(t-Math.round(t))<1e-6&&(t=Math.round(t)),this.setZoomLevel(this.getZoomLevel()+t)}},zoomOnPixel:function(e,t){var n,i,r=this.getZoomLevel();r<=this._minZoomLevel&&t<=1||r>=this._maxZoomLevel&&t>=1?this._zoomCancelled=!0:(n=Math.pow(2,this._minZoomLevel-r),i=Math.pow(2,this._maxZoomLevel-r),t=Math.min(Math.max(t,n),i),this._viewportProjection.zoomOnPixel(e,t))},zoomOnDataRectangle:function(e,t){this._viewportProjection.zoomOnDataRectangle(e,t)},zoomOnViewportRectangle:function(e,t){var n=this._viewportProjection.fromViewportRectToDataRect(e);this.zoomOnDataRectangle(n,t)},setBounds:function(e,t,n,r){isNaN(e)||isNaN(t)||isNaN(n)||isNaN(r)||(this._dataBounds=new i(e,t,n,r))},setBoundsRect:function(e){!e||this._dataBounds&&this._dataBounds.equal(e)||(this._dataBounds=e.clone())},zoomOnDataBounds:function(){var e=this._dataBounds&&!this._dataBounds.hasNaN()?this._dataBounds:this._defaultBounds;if(e)return this.zoomOnDataRectangle(e,!1),this._resetCallback(),this._viewportProjection.fire("resetZoomFinished"),!0},setFractionalZoomMode:function(e){this._fractionalZoomMode=e,this._defaultScale=this._fractionalZoomMode?Math.pow(2,.5):2,this._invDefaultScale=1/this._defaultScale,this._mouseWheelTimeoutPeriod=this._fractionalZoomMode?50:100,this._viewportProjection&&this._viewportProjection.setFractionalZoomMode(e)},getFractionalZoomMode:function(){return this._fractionalZoomMode},setZoomPanByWebkitTransform:function(e){this._zoomPanByWebkitTransform=e},getZoomPanByWebkitTransform:function(){return this._zoomPanByWebkitTransform},release:function(){this._viewportProjection=null,this._$element=null}});return Object.defineProperties(q.prototype,{enabled:{set:function(e){this._enabled=e},get:function(){return this._enabled}}}),q}),define("objects.views/charts/scrollable-chart",["jquery","util","./axis-chart","objects.views/charts/components/axis/discrete-axis","objects.views/charts/components/axis/continuous-axis","objects.views/charts/components/axis/time-axis","objects.views/charts/components/chart-component","objects.views/charts/components/scroll-area","objects.views/charts/components/mini-chart","objects.views/charts/components/ref-line-labels","objects.views/charts/representation/combo-color-map","objects.views/charts/utils/binding","objects.views/charts/utils/continuous-chart-util","objects.views/charts/utils/time-utils","general.utils/shapes/rect","objects.utils/event-utils","objects.utils/num-date-time-formatter","core.utils/deferred","objects.backend-api/stacked-cube-slicer","objects.views/charts/utils/pan-scroll-controller","objects.views/charts/utils/pan-zoom-controller"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,x){function q(e){var t=this.components.scrollArea.getOffset()-e/(this.components.dimensionAxis._discreteSpacing||28);t=t<0?0:t,this.components.scrollArea.setOffset(t)}function C(){if(!this._disableZoom){var e=this._panZoomController._viewportProjection,t=this._activeDimAxis.getDataMin(),n=this._activeDimAxis.getDataMax(),i=n-t,r=this._activeDimAxis.getPlotSize();e.setSize({x:r,y:1}),e.setBoundingBox(new f(t,0,n-t,1)),this._panZoomController.setOffset(this._panZoomController._$element.offset());var o=this.components.scrollArea.getOffset(),s=this.components.scrollArea.getViewRange();this.yMirrorMode&&(o=i-s-o);var a=e.getTransformMatrix();a.identity(),a.scale(r/s,1),a.translate(-o,0),e.setTransformMatrix(a),D(this.selections)}}function S(e,t){var n=this.components.scrollArea.getOffset(),i=this.components.scrollArea.getViewRange();(Math.abs(e-n)>N||Math.abs(t-i)>N)&&(this.components.scrollArea.setViewRange(t),this.components.scrollArea.setOffset(e),this.components.scrollArea.fire("offsetChanged"))}function w(){if(!this._disableZoom){var e=this._panZoomController._viewportProjection,t=this._activeDimAxis.getPlotSize(),n=this._activeDimAxis.getDataMin(),i=this._activeDimAxis.getDataMax()-n,r=e.invTransform({x:0,y:0}).x,o=e.invTransform({x:t,y:0}).x,s=Math.min(o-r,i),a=Math.min(Math.max(r,0),i-s);this.yMirrorMode&&(a=i-s-a),S.call(this,a,s)}}function _(){var e=this._activeDimAxis.getDataMin(),t=this._activeDimAxis.getDataMax();S.call(this,0,t-e)}function D(e,t){var n=e&&e.getActiveType();n&&"range.discrete"===n.getActiveMode()&&n.cancel(!0),t&&t.clearSelection()}function M(e,t,n,o){var s,a,l=[],c=[];Object.keys(this.components).forEach(function(e){this.components[e]instanceof i||this.components[e].isDimension?l.push(this.components[e]):this.components[e]instanceof r&&!this.components[e].isStacked&&c.push(this.components[e])}.bind(this)),a="x"===(s=["top","bottom"].contains(this._activeDimAxis.dock)?"x":"y")?"y":"x",this.selections.types.range.setComponent(s,l),this.tooltips.setComponent(s,l),this.selections.types.range.setComponent(a,c),n&&(e>1||t>1)?(this.selections.types.range.setComponent(a,[]),"byMeasure"===o?this.selections.types.colorLegend.removeComponent("colorLegend",this.components.colorLegend):this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend)):this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend)}function A(){this._isPagingTransitionEnabled&&(this.components.measureAxis.setDataRangeTransition(!1),this.components.measureAxis.stopListen("endTransition",E,this),this.components.measureAxis.stopListen("startTransition",I,this),clearTimeout(this._pagingTransitionTimer),delete this.components.measureAxis.setDataRange,this._isPagingTransitionEnabled=!1)}function E(){this.components.refLineLabels&&this.layout();for(var e in this.components)this.components[e].invalidateDisplay("ScrollableChart.onAxisTransitionEnded")}function I(){this._visibleRefLines=this.components.refLineLabels.isVisible()}function T(){if(!this._isPagingTransitionEnabled&&!this.isDimensionContinuous){this._isPagingTransitionEnabled=!0;var e=this,t=this.components.measureAxis,n=t.setDataRange;t.listen("endTransition",E,this),t.listen("startTransition",I,this),this._pagingTransitionTimer=null,this.components.measureAxis.setDataRange=function(i,r){clearTimeout(e._pagingTransitionTimer),e._pagingTransitionTimer=setTimeout(function(){var o;t.setDataRangeTransition(!0),n.apply(t,[i,r]),e.layout();for(o in e.components)e.components[o].invalidateDisplay()},500)}}}function L(){var e,t,n,i=this.components.scrollArea,r=this.yMirrorMode,o=this._scrollableHint,s=[];this._scrollAffordance||(this._scrollAffordance={canIncrease:!1,canDecrease:!1,yMirrorMode:r}),e=(n=i.getOffset())+i.getViewRange()<i.fullState.max-N,(t=n>N)===this._scrollAffordance.canDecrease&&e===this._scrollAffordance.canIncrease&&r===this._scrollAffordance.yMirrorMode||(this._scrollAffordance.canIncrease=e,this._scrollAffordance.canDecrease=t,this._scrollAffordance.yMirrorMode=r,t&&s.push(i.isVertical()?"up":this.yMirrorMode?"right":"left"),e&&s.push(i.isVertical()?"down":this.yMirrorMode?"left":"right"),this.yMirrorMode&&s.reverse(),o.attr("class",function(e,t){return t.replace(/\bqv-chart-scrollable-\S+/g,"")}),o.addClass("qv-chart-scrollable-"+s.join("-")))}function k(){var e=this;this._debounceUpdateHandle={},this._debouncedUpdate=m.debounce(function(){var t=this._activeDimAxis.getPlotMin(),n=this._activeDimAxis.getPlotMax();e.updateFocusedContinuousData(t,n).then(function(){e.partialUpdate(e._data)})},400,this._debounceUpdateHandle),this._changeWatchers.push(h.bindSetter(function(){if(e.isDimensionContinuous){var t=e._activeDimAxis.getDataMin()+e.components.scrollArea.getOffset(),n=t+e.components.scrollArea.getViewRange();e._activeDimAxis.setPlotMin(t),e._activeDimAxis.setPlotMax(n),e._activeDimAxis.invalidateDisplay(),e.components.dataArea.invalidateDisplay(),e.components.grid.invalidateDisplay(),e._debouncedUpdate()}},this.components.scrollArea,"offset"))}function O(e,t,n,i){for(var r,o,s=0;s<n.length;s++)for(var a=0;a<i.length;a++)if(n[s].qName===i[a].qName){r=i[a].qTicks.filter(function(t){return t.qEnd+1<e}),o=i[a].qTicks.filter(function(e){return e.qStart+1>t}),n[s].qTicks=r.concat(n[s].qTicks,o);break}}var P={NONE:0,ONE_DIM:1,TWO_DIM:2},N=1e-6;return n.extend("ScrollableChart",{init:function(t,n,d,p,m){var g=this,v=e.extend(!0,{providers:{colorMap:{clazz:u,multiDimScheme:"last"}},components:{refLines:{sortKey:5,show:!0,dock:"center",showFlag:s.prototype.ShowFlags.SPARK},dataArea:{sortKey:10,show:!0,dock:"center",showFlag:s.prototype.ShowFlags.SPARK},miniChart:{show:!0,clazz:l,components:{dimensionAxis:{show:!1,clazz:i},measureAxis:{show:!1},dataArea:{isMini:!0,show:!0},continuousAxis:{show:!1,clazz:r,dock:"bottom"}}},xAxis:{clazz:i,reductionOrder:10,shrinkToFitThreshold:.85,showFlag:{whenVertical:{vertical:s.prototype.ShowFlags.XSMALL,horizontal:s.prototype.ShowFlags.SMALL},whenHorizontal:{vertical:s.prototype.ShowFlags.SMALL,horizontal:s.prototype.ShowFlags.XSMALL}},titleShowFlag:{whenVertical:{vertical:s.prototype.ShowFlags.XSMALL,horizontal:s.prototype.ShowFlags.MEDIUM},whenHorizontal:{vertical:s.prototype.ShowFlags.MEDIUM,horizontal:s.prototype.ShowFlags.XSMALL}}},xAxisTitle:{showFlag:{whenVertical:{vertical:s.prototype.ShowFlags.XSMALL,horizontal:s.prototype.ShowFlags.MEDIUM},whenHorizontal:{vertical:s.prototype.ShowFlags.MEDIUM,horizontal:s.prototype.ShowFlags.XSMALL}},reductionOrder:1},timeAxis:{show:!0,isDimension:!0,order:1,dock:"bottom",relevantSize:90,reductionOrder:2,clazz:o,showFlag:{whenHorizontal:{vertical:s.prototype.ShowFlags.SMALL,horizontal:s.prototype.ShowFlags.XSMALL},whenVertical:{vertical:s.prototype.ShowFlags.XSMALL,horizontal:s.prototype.ShowFlags.SMALL}}},continuousAxis:{show:!0,isDimension:!0,order:1,dock:"bottom",relevantSize:90,reductionOrder:2,clazz:r,showFlag:{whenHorizontal:{vertical:s.prototype.ShowFlags.SMALL,horizontal:s.prototype.ShowFlags.XSMALL},whenVertical:{vertical:s.prototype.ShowFlags.XSMALL,horizontal:s.prototype.ShowFlags.SMALL}}},scrollArea:{sortKey:2,show:!0,dock:"bottom",order:2,relevantSize:20,reductionOrder:10.1,showFlag:s.prototype.ShowFlags.XSMALL,clazz:a},refLineLabels:{show:!0,dock:"right",order:3,reductionOrder:3,showFlag:{whenVertical:{vertical:s.prototype.ShowFlags.XSMALL,horizontal:s.prototype.ShowFlags.SMALL},whenHorizontal:{vertical:s.prototype.ShowFlags.MEDIUM,horizontal:s.prototype.ShowFlags.XSMALL}},clazz:c}}},d||{});this._super(t,n,v,p,m),this._scrollableHint=e("<div class='qv-chart-scrollable'>").appendTo(this.components.dataArea.container),this._changeWatchers=this._changeWatchers||[],this._pagingInfo=new f(0,0,0,0),this.components.measureAxis=this.components.yAxis,this.components.dimensionAxis=this.components.xAxis,this.components.dimensionAxisTitle=this.components.xAxisTitle,this.components.measureAxisTitle=this.components.yAxisTitle,delete this.components.xAxisTitle,delete this.components.yAxisTitle,delete this.components.xAxis,delete this.components.yAxis,this.components.dimensionAxisTitle.setType("dimension"),this.components.dimensionAxisTitle.listen("drill-up",function(e,t,n){g.backendApi.drillUp(t,n)}),this.components.dimensionAxisTitle.setModel(t.ext.model),this.components.measureAxisTitle.setType("measure"),this.components.measureAxisTitle.setModel(t.ext.model),this.components.scrollArea.listen("scrollStart",function(){D(this.selections,this.tooltips)}.bind(this)),this._showLegend=!1,this.scrollMultiplicator=1,this.components.dataArea.setMinorAxis(this.components.measureAxis),this.components.dataArea.setMajorAxis(this.components.dimensionAxis),this.components.dataArea.setTimeAxis(this.components.timeAxis),this.components.dataArea.setContinuousAxis(this.components.continuousAxis),this._setActiveDimensionAxis(t.layout),this.components.grid.setAxes(this.components.dimensionAxis,this.components.measureAxis),this.components.dimensionAxis.setMinDiscreteUnitSize(28),this._changeWatchers.push(h.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(h.bindProperty(this.providers.colorMap,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(h.bindSetter(function(){g.isDimensionContinuous||g.components.dimensionAxis.setOffset(g.components.scrollArea.getOffset())},this.components.scrollArea,"offset")),this._changeWatchers.push(h.bindSetter(function(e){g.isDimensionContinuous||null===e||g.components.scrollArea.setFullRange(e)},this.components.dimensionAxis,"numDiscreteUnits")),this._changeWatchers.push(h.bindSetter(function(e){g.isDimensionContinuous||g.components.scrollArea.setViewRange(g._pagingMode===P.TWO_DIM?e/2:e)},this.components.dimensionAxis,"numDiscreteUnitsInView")),[this.components.timeAxis,this.components.continuousAxis].forEach(function(e){e&&e.listen("rendered",function(){var e=g.selections&&g.selections.getActiveType&&g.selections.getActiveType();e&&"range.dimension"===e.getActiveMode()&&(e.refreshContainer(),e.updateRangeProjection(),e.updateRangeDisplay())})}),(this.components.timeAxis||this.components.continuousAxis)&&k.call(this,this.components.continuousAxis),this._changeWatchers.push(h.bindSetter(function(){!1!==g._checkPage&&g.checkPage(),L.call(g)},this.components.dimensionAxis,"offset")),this._scrollController=new b(this.components.dataArea.container,this.container,this.components.scrollArea),this._scrollController.PanStart.bind(function(){D(g.selections)}),this._scrollController.PanUpdate.bind(function(e){var t=g.components.scrollArea.isHorizontal()?"x":"y";g.yMirrorMode&&(e.x=-e.x),q.call(g,e[t])}),this._scrollController.PanWheel.bind(function(e){D(g.selections),q.call(g,e*g.components.dimensionAxis._discreteSpacing)}),this._panZoomController=new x(e(this.components.dataArea.container),{start:function(){C.call(g)},update:function(){w.call(g)},end:function(){w.call(g)},reset:function(){_.call(g)}}),this._panZoomController.setZoomPanByWebkitTransform(!1),this.isDimensionContinuous&&this._panZoomController.setMaxZoomLevel(27)},setYMirrorMode:function(e){this._super(e),this.updateVerticalComponentsDock()},getVerticalComponents:function(){var e,t=this._super();return this._data&&this.components&&(this.components.dimensionAxis&&this.components.dimensionAxis.isVertical()&&this._data.dimensionAxis&&(t.push({comp:this.components.dimensionAxis,dock:this._data.dimensionAxis.dock}),this.components.dimensionAxisTitle&&t.push({comp:this.components.dimensionAxisTitle,dock:this._data.dimensionAxis.dock})),this.components.measureAxis&&this.components.measureAxis.isVertical()&&this._data.measureAxis&&(e=this._data.measureAxes&&this._data.measureAxes[0]?this._data.measureAxes[0].dock:this._data.measureAxis.dock,t.push({comp:this.components.measureAxis,dock:e}),this.components.measureAxisTitle&&t.push({comp:this.components.measureAxisTitle,dock:e})),this.components.refLineLabels&&this.components.refLineLabels.isVertical()&&this._data.measureAxis&&t.push({comp:this.components.refLineLabels,dock:"far"===this._data.measureAxis.dock?"near":"far"}),this.components.scrollArea&&this.components.scrollArea.isVertical()&&t.push({comp:this.components.scrollArea,dock:"far"})),t},initSelections:function(){this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend),this.options._disableSelections||(this.selections.types.range.setComponent("dataArea",this.components.dataArea),this.selections.Activated.bind(this.onSelection.Activated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Deactivated.bind(this.onSelection.Deactivated.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.SelectAttributeDim.bind(this.onSelection.SelectAttributeDim.bind(this)),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.Clear.bind(this.onSelection.Clear.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)))},initTooltips:function(){this.tooltips.setComponent("dataArea",this.components.dataArea)},getSnapshotSize:function(){var e=0,t=0;return this.rect&&(e=this.rect.width,t=this.rect.height),!this.getSnapshotChartData().hasMiniChart&&this.components.scrollArea.isVisible()&&(this.components.scrollArea.isVertical()?e-=this.components.scrollArea.rect.width:t-=this.components.scrollArea.rect.height),{w:e,h:t}},getSnapshotChartData:function(t){var n=e.extend(!0,this._super()||{},{scrollOffset:t&&t.ignoreReducedData?0:this.components.scrollArea.getOffset(),discreteSpacing:this.components.dimensionAxis.getDiscreteSpacing(),axisInnerOffset:t&&t.ignoreReducedData?0:this.components.dimensionAxis.getInnerOffset(),hasMiniChart:this.components.miniChart&&!!this.components.miniChart.isVisible(),viewRange:this.components.scrollArea.getViewRange()});return t&&t.ignoreReducedData&&this.components.measureAxis.isStacked&&(n.dataRanges=[{min:this.components.measureAxis.getPlotMin(),max:this.components.measureAxis.getPlotMax()}]),n},setSnapshotData:function(t,n){function i(){var e=this.components.scrollArea,n=e.getOffset()/this.scrollMultiplicator,i=Math.round(n),r=this.components.dimensionAxis._discreteSpacing,o=e.getViewRange()/this.scrollMultiplicator,s=Math.round(o-(i-n)),a=Math.min(8,r/2),l=this._pagingInfo.y;if(isNaN(s)&&(s=10),this._data.barGrouping&&"grouped"===this._data.barGrouping.grouping&&this._data.qHyperCube.qMeasureInfo.length>1){i=Math.floor(n),s=Math.ceil(o-(i-n)),t.snapshotData.content.chartData.scrollOffset=e.getOffset()%this.scrollMultiplicator,i=(Math.ceil(n)-n)*r*this.scrollMultiplicator-r/2<a?Math.ceil(n):Math.floor(n),s=Math.round(n+o);var c=n+o;s=(c=(c-Math.floor(c))*r*this.scrollMultiplicator-r/2<a?Math.floor(c):Math.ceil(c))-i}else if(this._data.barGrouping&&"grouped"===this._data.barGrouping.grouping&&this._data.qHyperCube.qDimensionInfo.length>1){var u=this.components.dataArea._tree;if(i=Math.max(Math.round(n-.5),l),s=Math.round(this.components.dimensionAxis.getNumDiscreteUnitsInView()-(i-(n-.5))),u){var h,d=0,p=0,f=0,m=l;if(l!==i){for(d=0;d<u.children.length&&m<i;d++,m++)for(h=u.children[d],p=0;p<h.children.length&&m<i;p++,++m)f++;i=l+f,d=Math.max(0,d-1),p=Math.max(0,p-1)}for(f=0,m=0;d<u.children.length&&m<s;d++,m++){for(h=u.children[d],p;p<h.children.length&&m<s;p++,++m)f++;p=0}s=f}else s*=2}return{qTop:i,qLeft:0,qWidth:this._data.qHyperCube.qSize.qcx,qHeight:s||0}}this._super(t,n);var r,o=v();if(!n||!n.ignoreReducedData)return this.isDimensionContinuous&&(t.qHyperCube.qDataPages=this._data.qHyperCube.qDataPages,t.qHyperCube.qAxisData=this._data.qHyperCube.qAxisData),this.components.miniChart.isVisible()||delete t.reducedHyperCube,o.resolve(t),o.promise;if(delete t.reducedHyperCube,this.isDimensionContinuous)return r=t.qHyperCube,r.qDataPages=[e.extend(!0,{},this._data.qHyperCube.qDataPages[0])],this._upperFocusIndex?r.qDataPages[0].qMatrix=r.qDataPages[0].qMatrix.slice(this._lowerFocusIndex,this._upperFocusIndex+1):r.qDataPages[0].qMatrix=r.qDataPages[0].qMatrix,r.qAxisData=this._cachedFocusAxisData,r.qDimensionInfo[0].qMin=this._activeDimAxis.getPlotMin(),r.qDimensionInfo[0].qMax=this._activeDimAxis.getPlotMax(),o.resolve(t),o.promise;if(r=t.qHyperCube,this.providers.colorMap&&this.providers.colorMap.getColorDataInfo()&&(t.color.persistent=!!this.providers.colorMap.getColorDataInfo().persistentColors),"K"===r.qMode){var s=new y;s.store(r.qStackedDataPages);var a=s.get([i.call(this)]);r.qSize.qcy=a[0].qArea.qHeight,a[0]&&a[0].qData[0]&&(a[0].qData[0].qDown=0,a[0].qData[0].qUp=0),r.qStackedDataPages=a,o.resolve(t)}else this.backendApi.getData([i.call(this)]).then(function(e){"S"===r.qMode?r.qDataPages=e:r.qStackedDataPages=e,r.qSize.qcy=e[0].qArea.qHeight,r.qDimensionInfo[0].qStateCounts&&(r.qDimensionInfo[0].qStateCounts.qOption=r.qSize.qcy,r.qDimensionInfo[0].qStateCounts.qSelected=0),o.resolve(t)});return o.promise},getViewState:function(){return{scrollOffset:this.components.scrollArea.getOffset(),axisInnerOffset:this.components.dimensionAxis.getInnerOffset(),viewRange:this.components.scrollArea.getViewRange()}},checkPage:function(e){if(!this.isValid(this._data)||!this._pagingMode)return!1;var t=this.components.scrollArea,n=Math.floor(t.getOffset()/this.scrollMultiplicator),i=this._pagingInfo.y,r=this._pagingInfo.height,o=this._pagingMode===P.TWO_DIM?0:20,s=Math.ceil(t.getViewRange()/this.scrollMultiplicator);return isNaN(s)&&(s=500),this._pagingMode===P.TWO_DIM&&(s*=2),n+s>i+r||Math.max(0,n)<i?this.pageData(Math.floor(Math.max(0,n-o)),s+2*o,e):void 0},pageData:function(e,t,n){if("function"!=typeof this.backendApi.getReducedData)return!1;var i=v();if(this._data.qHyperCube){var r,o=this;r="K"===this._data.qHyperCube.qMode?this._data.qHyperCube.qStackedDataPages[0]&&this._data.qHyperCube.qStackedDataPages[0].qData&&this._data.qHyperCube.qStackedDataPages[0].qData.length>0:this._data.qHyperCube.qDataPages[0]&&this._data.qHyperCube.qDataPages[0].qMatrix.length>0,t<=0?("S"===o._data.qHyperCube.qMode?o._data.qHyperCube.qDataPages=[]:o._data.qHyperCube.qStackedDataPages=[],o._pagingInfo.set(e,0,this._data.qHyperCube.qSize.qcx,t)):this.backendApi.getData([{qTop:e,qLeft:0,qWidth:this._data.qHyperCube.qSize.qcx,qHeight:t}]).then(function(s){if("S"===o._data.qHyperCube.qMode){o._data.qHyperCube.qDataPages=s;var a=s[0].qArea;o._pagingInfo.set(a.qLeft,a.qTop,a.qWidth,a.qHeight)}else o._data.qHyperCube.qStackedDataPages=s,o._pagingInfo.set(0,e,o._data.qHyperCube.qSize.qcx,t);n||!r?(o._chartContext.refresh(o._data),o.paint(o._data).then(function(){i.resolve()})):o.partialUpdate(o._data).then(function(){i.resolve()})})}else i.resolve();return i.promise},partialUpdate:function(e){var t,n,i,r,o=[];return T.call(this),n=e.qHyperCube.qStackedDataPages.length>0?this._pagingInfo.y:e.qHyperCube.qDataPages[0].qArea.qTop,this.components.dimensionAxis.setInnerOffset(n*this.scrollMultiplicator),this.providers.colorMap.setData(e).then(function(){this._chartContext.refresh(e);for(t in this.components)"miniChart"!==t&&t.indexOf("AxisTitle")<0&&this.components[t].invalidateProperties("ScrollableChart.partialUpdate");return this.components.dataArea.updateNow(["properties"]),i=this.components.dataArea.getMajorAxisData(),!(r=this.components.dataArea.getMinorAxisData())||this._readStoredData&&this.getSnapshotStoredChartData().dataRanges||this.components.measureAxis.setDataRange(r.min,r.max),this.components.dimensionAxis.setDataRange(i.data,i.info),this.components.dimensionAxis.updateLevels(),this.components.colorLegend.invalidateProperties("ScrollableChart.partialUpdate"),this.components.colorLegend.updateNow(["properties"]),this.isDimensionContinuous&&this.layout(),o.push(this.components.colorLegend.invalidateDisplay("ScrollableChart.partialUpdate")),o.push(this.components.dataArea.invalidateDisplay("ScrollableChart.partialUpdate")),this.isDimensionContinuous?(o.push(this.components.timeAxis.invalidateDisplay("ScrollableChart.partialUpdate")),o.push(this.components.continuousAxis.invalidateDisplay("ScrollableChart.partialUpdate")),o.push(this.components.measureAxis.invalidateDisplay("ScrollableChart.partialUpdate"))):o.push(this.components.dimensionAxis.invalidateDisplay("ScrollableChart.partialUpdate")),v.all(o)}.bind(this))},getApproriateNrOfBins:function(e){var t=e.qHyperCube.qMeasureInfo.length||1,n=4+2*(t-1);return e.qHyperCube.qDimensionInfo.length>1&&(t=Math.max(1,Math.min(p.maxNumberOfLines,e.qHyperCube.qDimensionInfo[1].qStateCounts.qLocked+e.qHyperCube.qDimensionInfo[1].qStateCounts.qOption+e.qHyperCube.qDimensionInfo[1].qStateCounts.qSelected)),n=4),Math.ceil(2e3/(t*n))},getHyperCubeContinousData:function(e){if(e.qStart>e.qEnd||isNaN(e.qStart)||isNaN(e.qEnd))return v.resolve({qAxisData:{qAxis:[]},qDataPages:[{qMatrix:[],qTails:!1,qArea:{qLeft:0,qTop:0,qRight:0,qBottom:0}}]});var t=this;return this.backendApi.getHyperCubeContinousData(e,!1).then(function(e){return t.cancelPromises?v.reject():e})},getFullContinousData:function(e,n,i){return this.getHyperCubeContinousData({qStart:n,qEnd:i,qNbrPoints:this.getApproriateNrOfBins(e),qMaxNbrTicks:300,qMaxNumberLines:p.maxNumberOfLines}).then(function(n){return this._cachedContinousMatrix=n.qDataPages[0].qMatrix,e.qHyperCube.qDimensionInfo[0].qIsCyclic||(this._cachedContinousAxisData=n.qAxisData),this._cachedFocusAxisData=t.extend(!0,{},n.qAxisData),this._lowerFocusIndex=null,this._upperFocusIndex=null,n}.bind(this))},getFocusedContinousData:function(e,n,i){return this.getHyperCubeContinousData({qStart:e,qEnd:n,qNbrPoints:this.getApproriateNrOfBins(i),qMaxNbrTicks:300,qMaxNumberLines:p.maxNumberOfLines}).then(function(i){if(this._cachedContinousMatrix&&!this._readStoredData){i.qDataPages[0]&&i.qDataPages[0].qMatrix.length&&(e=Math.min(e,i.qDataPages[0].qMatrix[0][0].qNum),n=Math.max(n,i.qDataPages[0].qMatrix[i.qDataPages[0].qMatrix.length-1][0].qNum));var r=this._cachedContinousMatrix.filter(function(t){return t[0].qNum<e}),o=this._cachedContinousMatrix.filter(function(e){return e[0].qNum>n});i.qDataPages[0].qMatrix=r.concat(i.qDataPages[0].qMatrix,o);var s=d.getFocusRange(i.qDataPages[0].qMatrix,r.length,o.length,this._data.qHyperCube.qDimensionInfo.length);this._lowerFocusIndex=s.lower,this._upperFocusIndex=s.upper}return this._cachedContinousAxisData&&!this._readStoredData&&(this._cachedFocusAxisData=t.extend(!0,{},i.qAxisData),O(e,n,i.qAxisData.qAxis,this._cachedContinousAxisData.qAxis)),i}.bind(this))},updateFocusedContinuousData:function(e,t){var n=this,i=this._data;return this.getFocusedContinousData(e,t,i).then(function(e){i.qHyperCube.qDataPages=e.qDataPages,i.qHyperCube.qAxisData=e.qAxisData;var t=0===i.qHyperCube.qDataPages[0].qMatrix.length;n._activeDimAxis.setLabels(t?[]:i.qHyperCube.qAxisData.qAxis);var r=n._activeDimAxis.getUseTransition();n._activeDimAxis.setUseTransition(!1),n._activeDimAxis.updateSize(),n._activeDimAxis.setUseTransition(r)})},_preUpdateData:function(t){var n=this,i=this._super,r=d.getFullContinuousRange(t),o=r.min,s=r.max;return n.isDimensionContinuous?n.getFullContinousData(t,o,s).then(function(r){return n.isDimensionContinuous?(t=d.addContinuousDataToLayout(t,r),n._activeDimAxis.setDataRange(o,s),n.components.scrollArea.setFullRange(s-o),n.components.scrollArea.setViewRange(s-o),n._activeDimAxis.setPlotMin(o),n._activeDimAxis.setPlotMax(s),m.cancelDebounce(n._debounceUpdateHandle),i.call(n,t).then(function(t){var i=e.extend(!0,{},t);return n.components.miniChart.setData(i,!0),t})):t}):this._super(t)},_updateData:function(e){if(this._super.apply(this,[].slice.call(arguments)),this._pagingInfo.set(0,0,0,0),this.isValid(e)){var t,n=e.qHyperCube.qStackedDataPages[e.qHyperCube.qStackedDataPages.length-1];t=n&&n.qData?n.qData.length?{qLeft:0,qTop:0,qWidth:e.qHyperCube.qSize.qcx,qHeight:n.qData[0].qSubNodes.length}:n.qArea:e.qHyperCube.qDataPages[0].qArea,this._pagingInfo.set(t.qLeft,t.qTop,t.qWidth,t.qHeight),this.components.dimensionAxis.setInnerOffset(t.qTop*this.scrollMultiplicator)}},updateGrid:function(e,t){this._super(e,t),this.components.grid.setAxes(this._activeDimAxis,this.components.measureAxis)},_setActiveDimensionAxis:function(e){var t,n=this.isDimensionContinuous;p.isTimeDimension(n,e.qHyperCube.qDimensionInfo[0])?(this._activeDimAxis=this.components.timeAxis,t="continuousAxis"):n?(this._activeDimAxis=this.components.continuousAxis,t="continuousAxis"):(this._activeDimAxis=this.components.dimensionAxis,t="dimensionAxis"),this.components.miniChart&&this.components.miniChart.setActiveDimensionAxis(t),this.components.dataArea&&this.components.dataArea.setActiveDimensionAxis(this._activeDimAxis)},updateAxis:function(e){if(this._super.apply(this,[].slice.call(arguments)),this._readStoredData&&this.options.hideChartScrollWithoutMiniChart&&!this.components.scrollArea.getUseMiniChart()?this.components.scrollArea.hideComponent():this.components.scrollArea.showComponent(),this.selections){var t="S"!==e.qHyperCube.qMode||this.isDimensionContinuous&&e.qHyperCube.qDimensionInfo.length>1;M.apply(this,[e.qHyperCube.qDimensionInfo.length,e.qHyperCube.qMeasureInfo.length,t,e.color?e.color.mode:null])}this.tooltips&&this.tooltips.setComponent(["top","bottom"].contains(this.components.dimensionAxis.dock)?"y":"x",this.components.dimensionAxis),this._updateMinDiscreteUnitSize(this.components.dimensionAxis)},updateTimeAxis:function(){if(this.isDimensionContinuous){var e=this._data.qHyperCube.qDimensionInfo[0].qStateCounts,t=e.qLocked+e.qOption+e.qSelected>1;this._disableZoom=!t,p.isTimeDimension(!0,this._data.qHyperCube.qDimensionInfo[0])?(this.components.timeAxis.showComponent(),this.components.continuousAxis.hideComponent(),this.components.timeAxis.setLabels(this._data.qHyperCube.qAxisData?this._data.qHyperCube.qAxisData.qAxis:null)):(this.components.continuousAxis.showComponent(),this.components.timeAxis.hideComponent()),p.hasTimeTag(this._data.qHyperCube.qDimensionInfo[0])?this._activeDimAxis.dimensionFormatter=new g(this.backendApi.localeInfo,this.backendApi.localeInfo.qDateFmt,null,null,"TS"):this._activeDimAxis.dimensionFormatter=this.chartFormatter.getFormattersForMeasures(this._data.qHyperCube.qDimensionInfo,[0])[0],t?this.components.scrollArea.showComponent():this.components.scrollArea.hideComponent(),this.components.dimensionAxis.hideComponent()}else this.components.dimensionAxis.showComponent(),this.components.dimensionAxis.setOffset(this.components.scrollArea.getOffset()),this.components.timeAxis.hideComponent(),this.components.continuousAxis.hideComponent()},_disablePagingTransitions:function(){A.call(this)},_enablePagingTransitions:function(){T.call(this)},_postResize:function(){this._super(),this.components.dimensionAxis&&this._updateMinDiscreteUnitSize(this.components.dimensionAxis)},_updateMinDiscreteUnitSize:function(e){var t=this._data.qHyperCube.qSize.qcy,n=this._data.qHyperCube,i="S"===n.qMode?"qDataPages":"qStackedDataPages";(n[i]&&n[i][0]?n[i][0].qArea.qHeight:0)>=t&&!1===this.options.components.scrollArea.show?e.setMinDiscreteUnitSize(null):!e.isVisible(this._layoutMode)||"title"===this._data.dimensionAxis.show||"all"===this._data.dimensionAxis.show&&"none"===this._data.dimensionAxis.label?this._layoutMode===s.prototype.ShowFlags.SPARK?e.setMinDiscreteUnitSize(7):e.setMinDiscreteUnitSize(20):e.setMinDiscreteUnitSize(28)},layout:function(){var e;if(!1===this.options.components.scrollArea.show){var t=this.components.dimensionAxis;t._hideMyLabels=!1,e=function(){if(t._discreteSpacing*(t._groupSize||1)<20)return t._hideMyLabels=!0,!0}}this._super(this.components.dimensionAxis.isVertical()?"vertical":"horizontal",e),L.call(this)},setIsDimensionContinuous:function(e){this.isDimensionContinuous!==e&&(this.isDimensionContinuous=e,this.components.scrollArea.setAllowResize(e),this._on&&this._navigation&&(this.isDimensionContinuous?(this._scrollController.off(),this._panZoomController.on(this.namespace)):(this._panZoomController.off(),this._scrollController.on())))},on:function(){this._on||(this._super(),this._navigation&&(this.isDimensionContinuous?this._panZoomController.on(this.namespace):this._scrollController.on()))},off:function(){this._on&&(this._navigation&&(this._scrollController.off(),this._panZoomController.off()),this._super())},destroy:function(){this._super(),this.cancelPromises=!0,this._disablePagingTransitions(),this.components.scrollArea.stopListen("scrollStart"),this.components.dimensionAxisTitle.stopListen("drill-up"),this._panZoomController.release(),this.components.timeAxis&&this.components.timeAxis.stopListen("rendered"),this.components.continuousAxis&&this.components.continuousAxis.stopListen("rendered")}})}),define("objects.backend-api/hypercube-api",["./backend-api"],function(e){"use strict";return e.extend("HyperCube",{init:function(e,t){this._super(e,"/qHyperCubeDef",t),this.cacheCube.setMethodName("getHyperCubeData")},updateCache:function(e){e&&e.qHyperCube?(this.cacheCube.set(e.qHyperCube.qDataPages),this.cacheCube.setCubeSize(e.qHyperCube.qSize)):this.cacheCube.clear()},getData:function(e,t){return t?this.model.getHyperCubeData(t,e):this.cacheCube.getData(e)},getHyperCubeBinnedData:function(e,t,n,i){return this.model.getHyperCubeBinnedData(this.path,e,{width:0,height:0},t,n,i,0)},getHyperCubeContinousData:function(e,t){return this.model.getHyperCubeContinuousData(this.path,e,t)},getReducedData:function(e,t,n){return n=void 0!==n?n:"D1",this.model.getHyperCubeReducedData(this.path,e,t,n)},selectDimensionRange:function(e){var t=e.map(function(e){return{qDimIx:e.idx,qRange:{qMin:e.range.min,qMax:e.range.max,qMinInclEq:!0,qMaxInclEq:e.range.maxIncluded}}});return this.model.selectHyperCubeContinuousRange(this.path,t)},selectRange:function(e,t,n){var i;return t=!!t,n=n||[],i=e.map(function(e){return{qMeasureIx:e.idx,qRange:{qMin:e.range.min,qMax:e.range.max,qMinInclEq:!1!==e.range.minInclEq,qMaxInclEq:!1!==e.range.maxInclEq}}}),this.model.rangeSelectHyperCubeValues(this.path,i,n,t)},selectRects:function(e,t){var n;return t=t||[],n=e.map(function(e){var n=e[0],i=e[1];return{qRanges:[{qMeasureIx:n.idx,qRange:{qMin:n.range.min,qMax:n.range.max,qMinInclEq:!1!==n.range.minInclEq,qMaxInclEq:!1!==n.range.maxInclEq}},{qMeasureIx:i.idx,qRange:{qMin:i.range.min,qMax:i.range.max,qMinInclEq:!1!==i.range.minInclEq,qMaxInclEq:!1!==i.range.maxInclEq}}],qColumnToSelect:t}}),this.model.multiRangeSelectHyperCubeValues(this.path,n,!1)},select:function(e,t){return this.model.selectHyperCubeCells(this.path,e,t)},selectValues:function(e,t,n,i){return this.model.selectHyperCubeValues(i||this.path,e,t,n)},getProperties:function(){return this.model.getProperties()},getDimensionInfos:function(){return this.model.layout.qHyperCube.qDimensionInfo},getMeasureInfos:function(){return this.model.layout.qHyperCube.qMeasureInfo},clearSelections:function(){return this.model.resetMadeSelections()},hasSelections:function(){return this.model.layout.qSelectionInfo.qMadeSelections}})}),define("objects.backend-api/stacked-api",["./hypercube-api"],function(e){"use strict";function t(e,t,n){var i,r,o,s=[];for(r=0;r<t.length;r++)for(i=0;i<e.length;i++)o={qType:n,qCol:t[r],qRow:e[i]},s.push(o);return s}return e.extend("StackedApi",{init:function(){this._super.apply(this,arguments),this.backendStackThrottle.setMethodName("getHyperCubeStackData")},updateCache:function(e){e&&e.qHyperCube&&"S"===e.qHyperCube.qMode?(this.cacheCube.set(e.qHyperCube.qDataPages),this.cacheCube.setCubeSize(e.qHyperCube.qSize)):this.cacheCube.clear(),this.backendStackThrottle.clear()},getData:function(e,t,n){switch((n||this.model.layout.qHyperCube).qMode){case"P":return this.model.getHyperCubePivotData(this.path,e);case"S":return this._super(e,t);case"K":return t?this._super(e,t):this.backendStackThrottle.getData(e);default:return this._super(e,t)}},getReducedData:function(e,t,n){return n=void 0!==n?n:"D1",this.model.getHyperCubeReducedData(this.path,e,t,n)},select:function(e,n,i){switch(this.model.layout.qHyperCube.qMode){case"P":case"K":return this.model.selectPivotCells(this.path,t(e,n,i));default:return this.model.selectHyperCubeCells(this.path,e,n)}}})}),define("objects.views/charts/disclaimers/chart-utils",["util"],function(e){function t(e,t){var n,i,r,o,s,a=t.length;for(e&&(i=!(e.autoMinMax||"min"!==e.minMax&&"minMax"!==e.minMax||null===e.min||isNaN(e.min)),r=!(e.autoMinMax||"max"!==e.minMax&&"minMax"!==e.minMax||null===e.max||isNaN(e.max))),o=Number.MAX_VALUE,s=-Number.MAX_VALUE,n=0;n<a;n++)if(o=Math.min(o,t[n].qMin),s=Math.max(s,t[n].qMax),o<=0&&s>=0)return!0;return o=i?e.min:o,s=r?e.max:s,o<=0&&s>=0}return{applyDisclaimerAttributes:function(n,i,r,o,s){i||(i={});var a=e.extend({limitedData:!1,hasNegativeOrZeroData:!1,onlyNegativeOrZero:!1,onlyNanData:!1,onlyNullColor:!1,hasDataRangeIncludingZero:!1},i);return e.extend(i,a),i.noDataExist=s.qHyperCube.qSize.qcy*s.qHyperCube.qSize.qcx==0,i.noDataExist?(r.toggleClass("qv-viz-with-disclaimer",!1),i):(n=n||{},n.overlay=n.overlay||!1,n.supportNegative=void 0===n.supportNegative||n.supportNegative,n.supportRangeOverZero=void 0===n.supportRangeOverZero||n.supportRangeOverZero,s.qHyperCube.qDataPages[0]&&!0!==n.explicitLimitedData?i.limitedData=!n.paging&&s.qHyperCube.qSize.qcy>s.qHyperCube.qDataPages[0].qMatrix.length:i.limitedData=!0===n.explicitLimitedData,i.hasNegativeOrZeroData=!n.supportNegative&&s.qHyperCube.qMeasureInfo.some(function(e){return e.qMin<=0}),i.onlyNegativeOrZero=!n.supportNegative&&s.qHyperCube.qMeasureInfo.every(function(e){return e.qMax<=0&&e.qMax>=e.qMin})||0===s.qHyperCube.qSize.qcy,i.onlyNanData=s.qHyperCube.qMeasureInfo.every(function(e){return e.qMax<e.qMin||"NaN"===e.qMax}),i.hasDataRangeIncludingZero=!n.supportRangeOverZero&&t(s.measureAxis,s.qHyperCube.qMeasureInfo,s.lineType),i.onlyNegativeOrZero&&n.overlay||!(i.limitedData||i.hasNegativeOrZeroData&&!n.supportNegative||i.hasDataRangeIncludingZero||i.onlyNullColor)?(r.toggleClass("qv-viz-with-disclaimer",!1),o.options.showDisclaimerStar=!1):(r.toggleClass("qv-viz-with-disclaimer",n.bottom),o.options.showDisclaimerStar=!0),i)}}}),define("text!extensions.qliktech/barchart/barchart.ng.html",[],function(){return'<div class="qv-viz"></div>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist  && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist" dir="ltr"></span>\n<div qva-chart-disclaimer attributes="dataAttributes" visible="!dataAttributes.noDataExist" direction="options.direction"></div>'}),define("extensions.qliktech/barchart/barchart-constants",[],function(){return{INITIAL_FETCH:500,PAGING:{NONE:0,ONE_DIM:1,TWO_DIM:2}}}),define("extensions.qliktech/barchart/barchart",["jquery","util","core.utils/deferred","extensions.qliktech/barchart/bararea","extensions.qliktech/barchart/barchart-properties","extensions.qliktech/barchart/barchart-data","extensions.qliktech/barchart/barchart-explore-properties","objects.views/charts/scrollable-chart","objects.backend-api/stacked-api","objects.views/charts/disclaimers/chart-utils","objects.views/charts/utils/time-utils","objects.views/charts/components/axis/axis-utils","text!./barchart.ng.html","objects.extension/object-conversion","objects.utils/continuous-utils","extensions.qliktech/barchart/barchart-constants"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){"use strict";function g(e,t,n,i,r,o,s){var a,l=["bottom","top"],c=["left","right"];"horizontal"===s?(a=l,l=c,c=a,r.setDock("right")):r.setDock("bottom"),e.setDock("far"===o.dimensionAxis.dock?l[1]:l[0]),t.setDock("far"===o.dimensionAxis.dock?l[1]:l[0]),i.setDock("far"===o.measureAxis.dock?c[1]:c[0]),n.setDock("far"===o.measureAxis.dock?c[1]:c[0])}var v,y=m.INITIAL_FETCH,b=m.PAGING;return v=a.extend("BarChart",{namespace:".barchart",init:function(t,n,r,o,s){var a,l=e.extend(!0,{},r);this.$scope=t,r=e.extend(!0,r||{},{components:{dataArea:{clazz:i},miniChart:{components:{dataArea:{clazz:i}}}}},l),this._super(t,n,r,o,s),this._data={},this._tree=null,this.components.dimensionAxis.setMaxDiscreteUnitSize(64),a=this.components.miniChart,this.components.miniChart&&(this.components.miniChart.setBackendApi(this.backendApi),this.components.scrollArea.setUseMiniChart(!0),this.components.scrollArea.setMiniChart(this.components.miniChart),a.components.measureAxis.setDock("left"),a.components.dimensionAxis.setDock("bottom"),a.components.dataArea.setMinorAxis(a.components.measureAxis),a.components.dataArea.setMajorAxis(a.components.dimensionAxis),a.components.dataArea.setShowDataPoints(!1),a.setColorMap(this.providers.colorMap)),this._orientation="vertical"},initSelections:function(){if(!this.options._disableSelections){this.selections.Select.bind(function(e,t){var n=this.selections.getActiveType().activeComponent.getSelectionIndices()||[];this.onSelection.Select.apply(this,[e,t,n,"L"])}.bind(this));var e=function(e){this.onSelection.scheduleInvalidation.call(this),this.components.timeAxis.setSelectedRanges(e),this.components.dataArea.updateRangeSelection(e),this.components.miniChart.components.dataArea.updateRangeSelection(e)};this.selections.UpdateRanges.bind(e.bind(this)),this.selections.Clear.bind(e.bind(this,[])),this.selections.Deactivated.bind(e.bind(this,[]))}this._super()},isValid:function(e){return this._super(e)&&!this.supressChartRendering},_paint:function(){if(!this.isValid(this._data))return this.clear();this._super();var e,t=this._data,i=this.isDimensionContinuous||"vertical"===t.orientation,r=this.components.scrollArea,o=this.getSnapshotStoredChartData(),s=i?this.rect.height:this.rect.width,a=0,l=[];this._cutMode?((this._cutMode.positive||this._cutMode.negative)&&(a=this._layoutMode>=15?32:this._layoutMode>=7?16:8),i?this.components.measureAxis.setPadding(this._cutMode.positive?a:0,0,this._cutMode.negative?a:0,0):this.components.measureAxis.setPadding(0,this._cutMode.positive?a:0,0,this._cutMode.negative?a:0)):this.components.measureAxis.setPadding(0,0,0,0),this.components.dimensionAxis.setMaxDiscreteUnitSize(Math.max(1,Math.ceil(s/4)));var c=this.components.dataArea.getMajorAxisData().info.map(function(e){return e.show});if(this.components.colorLegend.updateNow(["properties"]),t.qHyperCube.qDimensionInfo.length>1&&"grouped"===t.barGrouping.grouping&&this.components.colorLegend.isVisible(this._layoutMode)&&this.providers.colorMap){var u=this.providers.colorMap.getColorDataInfo();u&&"dimension"===u.legendMode.colorMode&&(c[this.providers.colorMap.getDimensionIndex()]=!1)}this.components.dimensionAxis.setLabelLevelVisibility(c),this.layout(),!this.isDimensionContinuous&&this._dataForMiniChartChanged&&this.components.scrollArea.isVisible()&&this.components.scrollArea.getUseMiniChart()&&this.components.miniChart&&(l.push(this.components.miniChart.setData(t)),this._dataForMiniChartChanged=!1),this._readStoredData?(this.components.dimensionAxis.setInnerOffset(o.axisInnerOffset),this.components.scrollArea.setOffset(o.scrollOffset),this.components.scrollArea.setViewRange(o.viewRange)):this.options.viewState&&(this.components.dimensionAxis.setInnerOffset(this.options.viewState.axisInnerOffset),this.components.scrollArea.setOffset(this.options.viewState.scrollOffset),this.components.scrollArea.setViewRange(this.options.viewState.viewRange));var h=this.checkPage();h?l.push(h):r.viewState.min+r.viewState.range>r.fullState.max&&r.setOffset(r.fullState.max-r.viewState.range);for(e in this.components)l.push(this.components[e].invalidateDisplay("BarChart.paint"));return n.all(l)},prePaint:function(e){this._super(e);var t=!1;if(f.isContinuousChart(e)&&2===e.qHyperCube.qDimensionInfo.length){var n=e.qHyperCube.qDimensionInfo[1];t=n.qStateCounts.qLocked+n.qStateCounts.qOption+n.qStateCounts.qSelected>u.maxNumberOfLines}c.applyDisclaimerAttributes({paging:!0,bottom:!0,explicitLimitedData:t},this.$scope.dataAttributes,this.$element,this.$scope,e),this.supressChartRendering=this.$scope.dataAttributes.noDataExist},updateData:function(e){return this.setIsDimensionContinuous(f.isContinuousChart(e)),this._setActiveDimensionAxis(e),this._super(e)},_updateData:function(e){var t=[];this._checkPage=!1,this._disablePagingTransitions.call(this),this._data=e,this.isDimensionContinuous||(this._dataForMiniChartChanged=!0),this.isStacked=("stacked"===e.barGrouping.grouping||this.isDimensionContinuous)&&(e.qHyperCube.qDimensionInfo.length>1||e.qHyperCube.qMeasureInfo.length>1),this.components.measureAxis.isStacked=this.isStacked,this.components.scrollArea.setUseMiniChart(!0),t.push(this.components.dataArea.setData(e)),t.push(this.components.colorLegend.setData(e)),t.push(this.components.dimensionAxisTitle.setData(e)),t.push(this.components.measureAxisTitle.setData(e));var i=this.isDimensionContinuous?"vertical":e.orientation;i&&this.components.miniChart?(this._orientation!==i&&(this.components.miniChart.clear(),this._orientation=i),this.components.miniChart.setOrientation(i)):this._orientation=i;var r={axes:{measureAxis:{component:this.components.measureAxis},dimensionAxis:{component:this.components.dimensionAxis},timeAxis:{component:this.components.timeAxis,data:e.dimensionAxis},continuousAxis:{component:this.components.continuousAxis,data:e.dimensionAxis}},axisTitles:{dimensionAxisTitle:{component:this.components.dimensionAxisTitle},measureAxisTitle:{component:this.components.measureAxisTitle}},refLineLabels:{labels:{data:e.refLine.refLines,component:this.components.refLineLabels}},refLines:{component:this.components.refLines}},o=this.getSnapshotStoredChartData();return this.components.dataArea.setIsDimensionContinuous(this.isDimensionContinuous),this.scrollMultiplicator=e.qHyperCube.qDimensionInfo.length<2&&"grouped"===e.barGrouping.grouping&&e.qHyperCube.qMeasureInfo.length>1?e.qHyperCube.qMeasureInfo.length+1:1,this.components.dataArea._allowInnerSelection=!1,this._applyDimAxisSettings(e),this._super(e,r),this._readStoredData&&o?(this.components.dimensionAxis.setInnerOffset(o.axisInnerOffset),this.components.scrollArea.setOffset(o.scrollOffset),this.components.scrollArea.setViewRange(o.viewRange)):this.options.viewState?(this.components.dimensionAxis.setInnerOffset(this.options.viewState.axisInnerOffset),this.components.scrollArea.setOffset(this.options.viewState.scrollOffset),this.components.scrollArea.setViewRange(this.options.viewState.viewRange)):isNaN(e.scrollStartPos)?this.isDimensionContinuous||(this.components.dimensionAxis.setInnerOffset(0),this.components.scrollArea.setOffset(0)):this.components.scrollArea.setRelativeOffset(e.scrollStartPos),this.isDimensionContinuous||(this._checkPage=!0),n.all(t)},_applyDimAxisSettings:function(e){var t=null;this._pagingMode=b.NONE,e.qHyperCube.qDimensionInfo.length>1?(this.components.dataArea._allowInnerSelection=e.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+e.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected<=1,"grouped"===e.barGrouping.grouping?e.qHyperCube.qSize.qcy>y&&(this._pagingMode=b.TWO_DIM,t=e.qHyperCube.qSize.qcy):(t=this.isStacked?e.qHyperCube.qStackedDataPages&&e.qHyperCube.qStackedDataPages.length&&e.qHyperCube.qStackedDataPages[0].qData&&e.qHyperCube.qStackedDataPages[0].qData.length?e.qHyperCube.qStackedDataPages[0].qData[0].qSubNodes.length+e.qHyperCube.qStackedDataPages[0].qData[0].qDown:e.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+e.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected:e.qHyperCube.qDataPages[0].qMatrix.length+e.qHyperCube.qDimensionInfo[0].qStateCounts.qOption+e.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected,this._pagingMode=b.ONE_DIM)):(t=e.qHyperCube.qSize.qcy,this._pagingMode=b.ONE_DIM,"grouped"===e.barGrouping.grouping&&e.qHyperCube.qMeasureInfo.length>1&&(this.scrollMultiplicator=e.qHyperCube.qMeasureInfo.length+1,t*=this.scrollMultiplicator)),this.components.dimensionAxis.isDiscrete()&&!this.isDimensionContinuous||(this._pagingMode=b.NONE),this.components.dimensionAxis.setNumDiscreteUnits(t)},updateDataArea:function(e){this.components.dataArea.setShowDataPoints(e.dataPoint.showLabels);var t=this.isDimensionContinuous?"stacked":e.barGrouping.grouping;this.components.dataArea.setGroupingMode(t),this.components.miniChart&&this.components.miniChart.components.dataArea.setGroupingMode(t),this.components.dataArea.updateNow(["properties"])},updateAxis:function(n,i){var r,o,s,a,l,c,u,d,p,f,m,v,y=this.getSnapshotStoredChartData();this.components.timeAxis.setData(n);var b=n.qHyperCube.qMeasureInfo.filter(function(e){return!isNaN(e.qMin)}).map(function(e){return{min:e.qMin,max:e.qMax,index:n.qHyperCube.qMeasureInfo.indexOf(e)}});d=b.reduce(function(e,t){return e.min<t.min?e:t},b[0]),p=b.reduce(function(e,t){return e.max>t.max?e:t},b[0]),f=d?d.min:void 0,m=p?p.max:void 0,t.isNumeric(f)||(f=0),t.isNumeric(m)||(m=1),r=this.components.measureAxis,o=this.components.dimensionAxis,s=this.components.dimensionAxisTitle,a=this.components.measureAxisTitle;var x=this.components.dataArea.getMajorAxisData(),q=this.components.dataArea.getMinorAxisData();o.setDataRange(x.data,x.info),s.setSelectionsEnabled(!!this.selections),a.setSelectionsEnabled(!!this.selections),e.extend(i.axes.measureAxis,{data:e.extend(!0,{},n.measureAxis,{logarithmic:!1}),dataIndices:n.qHyperCube.qMeasureInfo.map(function(e,t){return t})}),e.extend(i.axes.dimensionAxis,{data:n.dimensionAxis,dataIndices:n.qHyperCube.qDimensionInfo.map(function(e,t){return t}),currentDataIndices:[0]}),e.extend(i.axisTitles.dimensionAxisTitle,{data:n.dimensionAxis}),e.extend(i.axisTitles.measureAxisTitle,{data:n.measureAxis}),u=i.axes.measureAxis,v=this.getAxisOptions(u),i.refLineLabels.labels.axis=r,g.apply(this,[o,s,r,a,this.components.scrollArea,n,this._orientation]),this._super(n,i);for(c in i.axes)(l=i.axes[c]).component.setDataIndices(l.dataIndices||[l.dataIndex||0]),l.component.setCurrentDataIndices(l.currentDataIndices||l.dataIndices||[l.dataIndex||0]);m<f?(m=10,f=-10):f===m&&0===m&&(m=10,f=-10),m=Math.max(0,m),f=Math.min(0,f),d&&p?(this._cutMode=this.getSpikeSettings(n,d,p,f,m,v),m=this._cutMode.max,f=this._cutMode.min):this._cutMode={positive:!1,negative:!1},this._readStoredData&&y.dataRanges&&y.dataRanges[0]?this.setAxisDataRange(r,y.dataRanges[0].max,y.dataRanges[0].min,v.max,v.min,1):q?this.setAxisDataRange(r,q.max,q.min,v.max,v.min,1):this.setAxisDataRange(r,m,f,v.max,v.min,1),"none"===n.measureAxis.show?o.setUnitAlignment("center"):this.components.dimensionAxis.setUnitAlignment(h.getAxisUnitAlignment(n.measureAxis.dock,o.isHorizontal())),this.updateTimeAxis()},getSpikeSettings:function(e,t,n,i,r,o){for(var s,a,l=0,c=0,u=0,h=0,d=!1,p=!1,f=n.index+e.qHyperCube.qDimensionInfo.length,m=t.index+e.qHyperCube.qDimensionInfo.length,g=e.qHyperCube.qDataPages[0]?e.qHyperCube.qDataPages[0].qMatrix:[],v=0;v<g.length;v++)(a=(s=g[v])[f].qNum)>0&&!isNaN(a)&&(s[0].qIsOtherCell||s[1].qIsOtherCell?u=Math.max(a,u):l=Math.max(a,l)),(a=s[m].qNum)<0&&!isNaN(a)&&(s[0].qIsOtherCell||s[1].qIsOtherCell?h=Math.min(a,h):c=Math.min(a,c));return this.isStacked&&e.qHyperCube.qMeasureInfo.length+e.qHyperCube.qDimensionInfo.length>2||(null!==o.max&&o.max<r?d=o.max>0:l>0&&u/l>5&&(d=(r=l)>=0),null!==o.min&&o.min>i?p=o.min<0:c<0&&h/c>5&&(p=(i=c)<0)),{max:r,min:i,positive:d,negative:p}},getPreferredSize:function(){return this._super()},setOrientation:function(e){this._orientation=e||"horizontal"},getOrientation:function(){return this._orientation}}),{type:"barchart",BackendApi:l,template:d,View:v,definition:r,softDefinition:s,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qMode:"S",qAlwaysFullyExpanded:!0,qInitialDataFetch:[{qTop:0,qHeight:y,qLeft:0,qWidth:17}],qSuppressZero:!1,qSuppressMissing:!0}},support:{cssScaling:!1,snapshot:!0,export:!0,exportData:!0,sharing:!0,viewData:!0},options:{selections:{dataArea:{},range:{},colorLegend:{}},tooltips:{}},data:o,importProperties:function(e,t,n){var i=p.axisChart.importProperties.apply(p,[e,t,n]),r=i.qProperty;return r.qHyperCubeDef.qDimensions.length>1&&"stacked"===r.barGrouping.grouping&&(r.qHyperCubeDef.qMode="K"),i},exportProperties:p.axisChart.exportProperties.bind(p)}}),define("extensions.qliktech/piechart/piechart-label-modes",[],function(){"use strict";return{NONE:0,SHARE:1,VALUE:2}}),define("extensions.qliktech/piechart/piearea-helper",["objects.views/charts/renderers/canvas-renderer","objects.views/charts/components/axis/radial-axis-helper","general.utils/color","extensions.qliktech/piechart/piechart-label-modes"],function(e,t,n,i){function r(t,n,i,r,o){var s=i.radius,a=r.split("px")[1],l=e.measureText(n,r),c=Math.min(2*s/l.width,8),u=Math.min(100,Math.max(s/10*c*.3,11))+"px"+a;return t.fill=o,t.text=n,t.font=u,t.align="center",t.baseline="bottom",t.x=0,t.y=0,t.maxWidth=1.3*s,t.visible=!0,t}function o(e,t){return e?"center":t<Math.PI/2||t>1.5*Math.PI?"right":"left"}function s(t,n,i,r,o){if(!r)return t;var s,a=i.radius,l=r.split("px"),c=l[0],u=l[1],h=.8*c,d=h+"px"+u,p=e.measureText(n,d);return p.width>1.2*a&&(s=1.2*a/p.width,d=(h=Math.max(h*s,10))+"px"+u),t.fill=o,t.text=n,t.font=d,t.align="center",t.baseline="top",t.maxWidth=1.3*a,t.x=i.cx,t.y=i.cy,t}function a(e,n,i){var r,o,s,a,p,f,m,g,v,y,b,x,q,C,S=20;for(v=0;v<e.length;v++){f=(r=e[v].label).x,m=r.y,s=t.getPolPos({x:f,y:m}),a=r.arcCenter<Math.PI/2||r.arcCenter>3*Math.PI/2,S=Math.max(Math.min(S,s.r/15),5),f=(p=t.getCartPos({r:s.r+S,a:s.a})).x,m=p.y,0!==v&&(g=(o=e[v-1].label).y),o&&h(r.quartile,o.quartile)?(x=u(m,g,r.quartile,o.quartile,a,r.laHeight),q=Math.abs(x),g=m+x+2*(x>0?1:-1)):(b=r.arcLength*n/3,g=m+((q=r.laHeight-b)>0?q*(1===r.quartile||2===r.quartile?1:-1):0)),q>10?(C={x:r.x,y:r.y},l(e[v],C,{x:f,y:g})):e[v].line.strokeWidth=0,r.x=f,r.y=g,(r=c(r,i)).maxWidth=r.width,r.width=null,"center"===e[v].label.textAlign&&q>10&&(e[v].line.x1+=Math.cos(e[v].label.arcLength)*(a?1:-1)*e[v].label.maxWidth/2,e[v].line.x2+=(a?1:-1)*e[v].label.maxWidth/4,e[v].line.y1+=Math.sin(e[v].label.arcLength)*(a?1:-1)*r.laHeight/2,e[v].line.y2+=(a?1:-1)*r.laHeight/2,e[v].line.strokeWidth=1);var w=-(y=r.y+i.height/2+r.laHeight*(d(r.quartile)?.5:-.5))>0||y-i.height>0;e[v].label.visible=!w,e[v].line.visible=!w}return e}function l(e,t,n){var i,r,o,s,a={r:Math.sqrt(t.x*t.x+t.y*t.y),a:Math.atan2(t.y,t.x)},l={r:Math.sqrt(n.x*n.x+n.y*n.y),a:Math.atan2(n.y,n.x)},c=e.label.textAlign;return i=(a.r+2)*Math.cos(a.a),r=(a.r+2)*Math.sin(a.a),o=(l.r-3)*Math.cos(l.a),s=(l.r-3)*Math.sin(l.a),e.line.x1=i+("right"===c?e.label.width:0),e.line.y1=r,e.line.x2=o+("right"===c?e.label.width:0),e.line.y2=s,e}function c(e,t){var n={x:t.width/2,y:t.height/2};switch(e.textAlign){case"left":e.x+e.width>t.width-n.x&&(e.width-=e.x+e.width-(t.width-n.x));break;case"right":e.x<-n.x&&(e.width+=e.x+n.x,e.x=-n.x);break;case"center":e.x<-n.x?(e.width+=e.x+n.x,e.x=-n.x):e.x+e.width>t.width-n.x&&(e.width-=e.x+e.width-(t.width-n.x))}return e}function u(e,t,n,i,r,o){return(e-t)*(1===i||2===n?1:-1)<o?t-e+o*(r&&3===n||!r&&4===n?-1:1):0}function h(e,t){return e===t||3===e&&2===t}function d(e){return 1===e||2===e}function p(e){var t=1;return e>=1.5*Math.PI?t=2:e<=Math.PI/2?t=3:e>Math.PI/2&&e<Math.PI&&(t=4),t}return{getFormattedPercentageValue:function(e,t){return Math.round(100*e*Math.pow(10,t))/Math.pow(10,t)},getRadianOffset:function(e){return e/360*Math.PI*2%(2*Math.PI)},updateNameLabel:function(t,n,i,s,a,l,c,u){if(u)return r(t,n,i,a,l);var h,d,p,f,m,g=i.end-i.start,v=i.radius,y=(i.arcCenter+s)%(2*Math.PI),b=(y+Math.PI)%(2*Math.PI);return m=t.font===a&&t.text===n?t.pieLabelMeasures:e.measureText(n,a),g<0&&(g+=2*Math.PI),h=o(g>.4&&m.width<g*v,b),d="center"===h,p=v*Math.cos(y)+(d?Math.cos(y)*m.width/2:0)+(d?-m.width/2:"right"===h?-m.width:0),f=v*Math.sin(y)+(d?Math.sin(y)*m.height/2:0),t.baseline="middle",t.align="left",t.fill=l,t.font=a,t.text=n,t.textAlign=h,t.x=p,t.y=f,t.width=m.width,t.laHeight=m.height,t.arcCenter=b,t.arcLength=g,t.pieLabelMeasures=m,t},updateValueLabel:function(t,n,i,r,o,a,l,c,u,h){if(u)return s(t,n,r,h,i);var d,p,f,m,g,v,y=(r.arcCenter+o)%(2*Math.PI),b=(y+Math.PI)%(2*Math.PI),x=c||e.measureText(n,l);return g=a?r.innerRadius:r.radius,d=b<Math.PI/2||b>1.5*Math.PI,p=b>Math.PI,v=.07*(d?1:-1)*(p?1:-1)*Math.abs(Math.sin(b)),f=.95*g*Math.cos(y)+r.cx-(d?-1:1)*(Math.abs(Math.cos(b))*x.width/2),m=.95*g*Math.sin(y+v)+r.cy-(p?1:-1)*(Math.abs(Math.sin(b))*x.height/2),t.fill=i,t.x=f,t.y=m,t.text=n,t.font=l,t.align="center",t.baseline="middle",t.maxWidth=1.4*x.width,t},getLabelColor:function(e,t,i,r,o){return i||n.useDarkLabel(r,o)?t:e},improveNameLabelPositions:function(e,t,n){if(e.length<2)return[];var i,r,o,s,l=Math.min(n.width,n.height),c=[],u=[],h=[],d=[],f=[],m=[];for(o=0;o<e.length;o++)m.push({label:e[o],line:t[o]});for(m.sort(function(e,t){return e.label.arcCenter>t.label.arcCenter?1:-1}),o=0;o<e.length;o++)switch(r=m[o],i=r.label,s=i.arcCenter,i.quartile=p(s),i.quartile){case 1:c.push(r);break;case 2:u.push(r);break;case 3:h.push(r);break;case 4:d.push(r)}return f=c.concat(u.reverse()).concat(h).concat(d.reverse()),f=a(f,l,n)},updateLabel:l,checkQuartile:p,isBottomQuartile:d,checkRelevantQuartile:h,checkInterference:u,checkEllipsis:c,updateDivider:function(e,i,r,o,s){var a,l;return a=t.getCartPos({r:s.radius-1,a:s.start+s.radianOffset},{x:s.cx,y:s.cy}),l=t.getCartPos({r:s.innerRadius+1,a:s.start+s.radianOffset},{x:s.cx,y:s.cy}),e.x1=a.x,e.y1=a.y,e.x2=l.x,e.y2=l.y,e.strokeWidth=1,r&&n.getContrast(i,r)>1.2?e.stroke=i.toHex():e.stroke=i.isDark()?"#ccc":"#333",e},getValueText:function(e,t,n,r){return t&&r||n===i.VALUE?e.pieData.label:e.pieData.formattedShare.toString()+" %"}}}),define("extensions.qliktech/piechart/piearea",["objects.views/charts/components/chart-component","objects.views/charts/shapes/arc","objects.views/charts/shapes/circle","objects.views/charts/shapes/line","objects.views/charts/shapes/text","objects.views/charts/shapes/container","objects.views/charts/utils/tree-iterator","objects.views/charts/renderers/canvas-renderer","objects.views/charts/chart-style-service","client.utils/theme/modern/theme","extensions.qliktech/piechart/piearea-helper","translator","general.utils/color","extensions.qliktech/piechart/piechart-label-modes","core.utils/deferred","core.utils/feature-flags"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){"use strict";function g(e,t){var n={backgroundColor:m.THEMING?e.getStyle("","backgroundColor"):e.getValue(C,null,"backgroundColor"),dataPoint:{},dataValue:{},shape:{},line:{}};return m.THEMING?(n.dataPoint.label={font:"normal "+b(e.getStyle("label.name","fontSize"),t)+" 'QlikView Sans'",color:{dark:e.getStyle("label.name","color"),light:e.getStyle("label.name","color")}},n.dataValue.label={font:"normal "+b(e.getStyle("label.value","fontSize"),t)+" 'QlikView Sans'",color:{dark:"#333333",light:"#E6E6E6"}},n.shape={border:{width:1},selected:{border:{width:2,color:"#333333"}}},n.line={color:e.getStyle("label.name","color"),width:1}):(n.dataPoint.label={font:e.getFont(C,"item.name",t),color:{dark:e.getValue(C,"item.name","color","dark"),light:e.getValue(C,"item.name","color","light")}},n.dataValue.label={font:e.getFont(C,"item.value",t),color:{dark:e.getValue(C,"item.value","color","dark"),light:e.getValue(C,"item.value","color","light")}},n.shape={border:{width:e.getValue(C,"item.shape.border","width")},selected:{border:{width:e.getValue(C,"item.shape.border","width","selected"),color:e.getValue(C,"item.shape.border","color","selected")}}},n.line={color:e.getValue(C,"item.line","color"),width:e.getValue(C,"item.line","width")}),n}function v(e,t,n,i,r,o){e?(n.strokeWidth=t.shape.selected.border.width,n.stroke=t.shape.selected.border.color,n.opacity=S,n.zIndex=1,i.opacity=1,o.opacity=1,r.opacity=1):(n.opacity=void 0,n.strokeWidth=void 0,n.stroke=void 0,n.zIndex=void 0,i.opacity=void 0,o.opacity=void 0,r.opacity=void 0)}function y(e){this._fontSize=e>300?"large":e>200?"medium":e>100?"small":"tiny"}function b(e,t){var n={tiny:.75,small:.9,medium:1,large:1.2};return n[t]?Math.floor(parseInt(e)*n[t])+"px":parseInt(e)+"px"}function x(e,t,n){return n<1e-6&&(n=0),e.set(0,0,this._showAsDonut?this._innerRadius:0,this._radius,t,t+n,this._radianOffset),e}function q(){if(!this._data||!this._tree)return f.resolve();var e,t,n,i,r,o,s,l,c,h,m,g,v,y,b,q,C,S,w,_,D,M=this._tree,A=this._itemData.length,E=M.children.length,I=0,T=0,L=[],k=[],O=this._styles,P=this,N=new d(O.backgroundColor).isDark();this.beforeRenderPie(this._tree,p),this._radianOffset=u.getRadianOffset(this._currentProperties.rotation+90);var R=(this._radianOffset<0?this._radianOffset+2*Math.PI:this._radianOffset)%(2*Math.PI);if(w={nameLabel:{font:O.dataPoint.label.font,color:"#f00"},dataLabel:{font:O.dataValue.label.font,color:"#f00"}},E){for(b=1===this._numSlices,t=0;t<A;t++){if(!(n=this._itemData[t]).pieData||n.pieData.value<=0)return f.resolve();T=Math.min(2*Math.PI*n.pieData.share,2*Math.PI),o=P._arcs[n.pieData.shpIndex],s=n.parent.cacheItem.selected,x.apply(P,[o,I-Math.PI,T]),S={border:{color:"white",width:0}},b&&!P._showAsDonut?(m=P._singleItemCircle).set(0,0,o.radius):m=o,(v=P._dividers[n.pieData.shpIndex]).visible=!1,s||b||((v=P._dividers[n.pieData.shpIndex]).visible=!0,u.updateDivider.call(this,v,n.pieData.color,r,S.border,m),P.dividerAddedToRender(v)),P.pieAddedToRender(n,m),P._showDimensionValues&&(i=b?u.getLabelColor(O.dataPoint.label.color.light,O.dataPoint.label.color.dark,P._showAsDonut,n.pieData.color,N):N?O.dataPoint.label.color.light:O.dataPoint.label.color.dark,l=u.updateNameLabel(P._nameLabels[n.pieData.shpIndex],n.pieData.title,o,R,w.nameLabel.font,i,P.rect,b),L.push(l),(g=P._lines[n.pieData.shpIndex]).stroke=O.line.color,g.strokeWidth=O.line.width,g.x1=0,g.y1=0,g.x2=0,g.y2=0,k.push(g)),I+=T,r=n.pieData.color}if(this._valueLabelContainer.removeChildren(),!this._data.dataPoint.auto||this._layoutMode>3)for(e=0;e<this._sortedIndices.length;e++){if(!(y=this._itemData[this._sortedIndices[e].idx]).pieData||y.pieData.value<=0)return f.resolve();q=(o=P._arcs[y.pieData.shpIndex]).start,C=o.end,C+=q*C<0?2*Math.PI:0,h=u.getValueText(y,this._data.dataPoint.auto,this._dataPointsLabelMode,b),(c=P._valueLabels[y.pieData.shpIndex]).text!==h||w.dataLabel.font!==c.font?(c.text=h,_=a.measureText(h,w.dataLabel.font)):_=c.pieLabelMeasures,c.pieLabelMeasures=_,D=((o.arcCenter+o.radianOffset)%(2*Math.PI)+Math.PI)%(2*Math.PI);var F=C===q?2*Math.PI:C>=q?C-q:q-C,j=Math.abs(Math.cos(D))*_.height*2+Math.abs(Math.sin(D))*_.width*2;if(!(this._dataPointsLabelMode!==p.NONE&&o.radius*F>j))break;i=u.getLabelColor(O.dataValue.label.color.light,O.dataValue.label.color.dark,this._showAsDonut,y.pieData.color,N),(c=u.updateValueLabel(c,h,i,o,R,this._showAsDonut,w.dataLabel.font,_,b,l?l.font:null)).maxWidth<(this._showAsDonut?o.innerRadius:o.radius)*(b?2:1)&&this._valueLabelContainer.addChild(c)}}u.improveNameLabelPositions(L.concat(),k,P.rect),this._nameLabelContainer.removeChildren(),this._lineContainer.removeChildren();var V=[],H=[];for(e=0;e<L.length;e++)!1!==L[e].visible&&V.push(L[e]),!1!==k[e].visible&&H.push(k[e]);return this._nameLabelContainer.addChildren(V),this._lineContainer.addChildren(H),this._prevRect&&this._prevRect.w===this.rect.width&&this._prevRect.h===this.rect.height||(this._prevRect={w:this.rect.width,h:this.rect.height},this._renderRoot.clearTransform(),this._renderRoot.translate(this.rect.width/2,this.rect.height/2)),this.renderers.pie.render(!0)}var C="pieChart",S=1;return e.extend({init:function(){this._super.apply(this,arguments),this._data=null,this._arcs=[],this._nameLabels=[],this._valueLabels=[],this._lines=[],this._dividers=[],this._itemData=[],this._labelRects=[],this._cacheItems=[],this.renderers={pie:new a(this.container,{name:"pie"})},this.renderers.pie.setCompositingEnabled(!1),this._renderRoot=new o,this._rotationContainer=new o,this._arcContainer=new o,this._dividerContainer=new o,this._nameLabelContainer=new o,this._valueLabelContainer=new o,this._lineContainer=new o,this._rowToShapeMapping={},this._dividerContainer.strokeWidth=1,this._arcContainer.lineJoin="round",this._rotationContainer.addChildren([this._arcContainer,this._dividerContainer]),this._renderRoot.addChildren([this._rotationContainer,this._nameLabelContainer,this._valueLabelContainer,this._lineContainer]),this.renderers.pie.stage.addChild(this._renderRoot),this._singleItemCircle=new n(0,0,0),this._singleItemCircle.type="circle",this._fontSize="large",this._styles={},m.THEMING?this._styleService=c.initializeService("object.pieChart"):this._styleService=l.getInstance(),this._transitionHelper.setTransitionCurve("easeout"),this._maxSizeRatio=.8,this._showValueTextInsideSlice=!1,this._showDimensionValues=!0,this._showAsDonut=!1,this._showLabels=!0,this._recalculcating=!1,this._currentProperties.rotation=0,this._transitionProperties.rotation=0,this._hasNegativeValues=!1,this._innerRadiusRatio=.7},beforeRenderPie:function(){},pieAddedToRender:function(){},dividerAddedToRender:function(){},afterPaint:function(){return f.resolve()},setShowDimensionValues:function(e){this._showDimensionValues=e,this.invalidateDisplay("setShowDimensionValues")},getShowDimensionValues:function(){return this._showDimensionValues},setRotation:function(e){this._transitionProperties.rotation=e,this._transition()},getRotation:function(){return this._transitionProperties.rotation},setScaleRatio:function(e){this._maxSizeRatio=e,this.invalidateDisplay("setScaleRatio")},getScaleRatio:function(){return this._maxSizeRatio},setShowAsDonut:function(e){this._showAsDonut=e,this.invalidateDisplay("setShowAsDonut")},getShowAsDonut:function(){return this._showAsDonut},setColorMap:function(e){this._colorMap=e},getColorMap:function(){return this._colorMap},setDataPointsLabelMode:function(e){switch(e){case"value":this._dataPointsLabelMode=p.VALUE;break;case"share":this._dataPointsLabelMode=p.SHARE;break;default:this._dataPointsLabelMode=p.NONE}this.invalidateDisplay("setDataPointsLabelMode")},getDataPointsLabelMode:function(){return this._dataPointsLabelMode},setDimensionTree:function(e){this._tree=e,this.invalidateProperties(),this.invalidateDisplay("setDimensionTree")},updateSize:function(){this._super()},_updateProperties:function(){if(this._data&&this._tree){this._itemData=[];var e,n,o,a,l,c,d=[],p=this._data.qHyperCube.qDimensionInfo.length,f=this._tree,m=p+1,g=0,y=this._arcs.length,b=f.children.length,x=this.measureFormatters[0],q=this,C=this.selectionIdentifier?this.selectionIdentifier:"dataArea";this._numSlices=0,this._arcContainer.removeChildren(),this._dividerContainer.removeChildren(),this._rowToShapeMapping={};var S,w,_,D,M,A=this._arcContainer,E=this._dividerContainer;b&&(s.each.call(f,function(u,h){if(n=s.getLevel.call(u),u.idx=h,n===m){if(o=u.data.qNum,isNaN(o)||o<=0)return void((p<=1||h<=0)&&(e=u.parent.cacheItem,d.push(e)));q._numSlices++,l=u.parent.data.qText,c=x&&"U"===x.type?x.formatValue(u.data.qNum):u.children[0].data.qText,u.pieData={value:o,title:l,color:null,label:c},u.pieData.shpIndex=g++,a=null!=q._colorMap?q._colorMap.getColor(u.parent.data.qElemNo,o,0,u.parent.idx):null,u.pieData.color=a,y<g?(S=new t(0,0,0,0,0,0,0),M=new i(0,0,0,0),w=new r,_=new r,D=new i(0,0,0,0),q._arcs.push(S),q._nameLabels.push(w),q._valueLabels.push(_),q._lines.push(D),q._dividers.push(M)):(S=q._arcs[u.pieData.shpIndex],w=q._nameLabels[u.pieData.shpIndex],_=q._valueLabels[u.pieData.shpIndex],D=q._lines[u.pieData.shpIndex],M=q._dividers[u.pieData.shpIndex]),q._rowToShapeMapping[u.data.rowIndex]=u.pieData.shpIndex,v(!1,q._styles,S,w,_,D),S.fill=a.toRGBA(),A.addChild(S),E.addChild(M),(e=u.parent.cacheItem).addShape(C,S),e.addShape(C,w),d.push(e),q._itemData.push(u)}}),this._singleItemCircle.opacity=void 0,this._singleItemCircle.strokeWidth=0,this._singleItemCircle.stroke="white",1!==q._itemData.length||q._showAsDonut||(this._singleItemCircle.fill=q._itemData[0].pieData.color.toRGBA(),A.removeChildren(),A.addChild(this._singleItemCircle),E.removeChildren(),e=d[q._itemData[0].parent.idx],w=e.getShapes()[1],e.clearShapes(C),e.addShape(C,this._singleItemCircle),w&&e.addShape(C,w))),this.setSelectableShapes(d),this._sortedIndices=this._itemData.map(function(e,t){return{value:e.pieData.value,idx:t}}),this._sortedIndices.sort(function(e,t){return e.value<t.value?1:-1});var I,T,L=0;this._numNonZero=0,this._itemData.forEach(function(e){L+=e.pieData.value,q._numNonZero+=e.pieData.value>0?1:0}),this._itemData.forEach(function(e){I=e.pieData.value/L,e.pieData.share=I,T=u.getFormattedPercentageValue(I,q._data.dataPoint.sharePrecision?q._data.dataPoint.sharePrecision:1),e.pieData.formattedShare=T,e.parent.cacheItem.addMeasure(h.get("properties.dataPoints.labelmode.share"),T+" %",T+" %")}),this._super()}},hasValidData:function(){return this._super()&&this._data&&this._tree},_onAnimatitonEnd:function(){this._super(),this.getRotation()%360==0&&(this._currentProperties.rotation=this._transitionProperties.rotation=0)},paint:function(){return this._super(this._layoutMode,this._data),this._radius=this._maxSizeRatio*Math.min(this.rect.width,this.rect.height)/2,this.renderers.pie.stage.opacity=this._globalAlpha||1,this._dividerContainer.opacity=.4*this._globalAlpha,y.apply(this,[this._radius]),this._styles=g(this._styleService,this._fontSize),this._innerRadius=this._innerRadiusRatio*this._radius,q.call(this).then(function(){return this.afterPaint()}.bind(this))},toggleCacheItem:function(e){var t=!0,n=this._styles;this.renderers.pie.stage.opacity!==this._globalAlpha&&(t=!1,this.renderers.pie.stage.opacity=this._globalAlpha);var i=this._rowToShapeMapping[e.row],r=this._arcs[i],o=this._nameLabels[i],s=this._valueLabels[i],a=this._lines[i];r&&(v(e.selected,n,r,o,s,a),t&&(r.invalidate(),o.invalidate(),a.invalidate(),s.invalidate())),1===this._itemData.length&&(e.selected?(this._singleItemCircle.opacity=S,this._singleItemCircle.strokeWidth=n.shape.selected.border.width,this._singleItemCircle.stroke=n.shape.selected.border.color):(this._singleItemCircle.opacity=void 0,this._singleItemCircle.strokeWidth=0,this._singleItemCircle.stroke="white"),t&&this._singleItemCircle.invalidate()),t||this.renderers.pie.render(!0)}})}),define("extensions.qliktech/piechart/piechart-properties",["client.utils/property-resolver","client.utils/default-property-logic"],function(e,t){var n=t.getLogicFor("hard","piechart");return{type:"items",component:"accordion",items:{data:{uses:"data",items:{dimensions:{uses:"dimensions"},measures:{uses:"measures",items:{numberFormatting:{items:{percentOfPieMessage:{component:"text",translation:"properties.numberFormatting.pieMessage",show:function(t,n){return n&&(e.getValue(n,"properties.dataPoint.auto")||"share"===e.getValue(n,"properties.dataPoint.labelMode"))}}}}}}}},sorting:{uses:"sorting"},addons:{type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{suppressZero:null,calcCond:{uses:"calcCond"}}}}},settings:{uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{showAsDonut:{ref:"donut.showAsDonut",type:"boolean",component:"item-selection-list",defaultValue:!1,horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.pie",value:!1},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.donut",value:!0}]},labels:{type:"items",snapshot:{tid:"property-labels"},items:{dimensionTitle:{ref:"dimensionTitle",type:"boolean",component:"switch",translation:"properties.dataPoints.dimensionlabels",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},valuesAuto:{ref:"dataPoint.auto",type:"boolean",translation:"properties.dataPoints.labelmode",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},labelMode:{ref:"dataPoint.labelMode",type:"string",component:"dropdown",options:[{value:"none",translation:"Common.None"},{value:"share",translation:"properties.dataPoints.labelmode.share"},{value:"value",translation:"properties.dataPoints.labelmode.value"}],defaultValue:"share",show:function(t){return!e.getValue(t,"dataPoint.auto")}}}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{legend:{show:n.legend.show,items:{show:{defaultValue:!1,snapshot:{tid:"property-legend"}},showTitle:{show:n.legend.showTitle.show},dock:{show:n.legend.dock.show}}}}}}}}}}),define("extensions.qliktech/piechart/piechart-data",["client.utils/property-resolver"],function(e){function t(e){1===e.getDimensions().length&&1===e.getMeasures().length&&(e.getMeasures()[0].qSortBy.qSortByNumeric=-1,1!==e.getSorting()[0]&&e.changeSorting(1,0))}function n(t,n){var i=n.getMeasures();"byExpression"===e.getValue(t,"color.mode")&&0===i.length&&e.setValue(t,"color.mode","primary")}function i(e,n){e.qOtherTotalSpec.qOtherMode="OTHER_COUNTED",e.qOtherTotalSpec.qOtherCounted={qv:"10"},t(n)}return{dimensions:{min:1,max:1,description:function(){return"Slices"},add:function(e,t,n){i(e,n)},move:function(e,t,n){i(e,n)},replace:function(e,t,n,r,o){i(e,o)}},measures:{min:1,max:1,description:function(){return"Angle"},add:function(e,n,i){t(i)},remove:function(e,t,i){n(t,i)}}}}),define("extensions.qliktech/piechart/piechart-explore-properties",[],function(){return{type:"items",component:"accordion",items:{data:{uses:"data"},sort:{uses:"sort"},presentation:{uses:"presentation",items:{showAsDonut:{ref:"donut.showAsDonut",type:"boolean",component:"item-selection-list",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.pie",value:!1},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.donut",value:!0}]},labelMode:{type:"items",items:{labelMode:{type:"string",component:"radio-list",translation:"properties.dataPoints.labelmode",diffs:["dataPoint.auto:false","dataPoint.labelMode"],options:function(){return[{value:"none",translation:"Common.None"},{value:"share",translation:"properties.dataPoints.labelmode.share"},{value:"value",translation:"properties.dataPoints.labelmode.value"}]},setPropertyValue:function(e,t){e.dataPoint.auto=!1,e.dataPoint.labelMode=t},getValue:function(e){return e.dataPoint.auto?"":e.dataPoint.labelMode}}}}}},color:{uses:"color"}}}}),define("text!extensions.qliktech/piechart/piechart.ng.html",[],function(){return'<div class="qv-viz"></div>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNegativeOrZero" q-translation="Object.Disclaimer.OnlyNegativeOrZeroValues" q-title-translation="Object.Disclaimer.OnlyNegativeOrZeroValues" dir="ltr"></span>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist" dir="ltr"></span>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNanData" q-translation="Object.Disclaimer.OnlyNanData" q-title-translation="Object.Disclaimer.OnlyNanData" dir="ltr"></span>\n<div qva-chart-disclaimer attributes="dataAttributes" visible="!dataAttributes.onlyNegativeOrZero" direction="options.direction"></div>'}),define("extensions.qliktech/piechart/piechart",["jquery","core.utils/deferred","objects.views/charts/chart","objects.views/charts/components/chart-component","objects.views/charts/components/data-title/data-title","./piearea","objects.views/charts/representation/combo-color-map","objects.backend-api/hypercube-api","extensions.qliktech/piechart/piechart-properties","extensions.qliktech/piechart/piechart-data","extensions.qliktech/piechart/piechart-explore-properties","text!./piechart.ng.html","objects.utils/event-utils","objects.views/charts/disclaimers/chart-utils","objects.extension/object-conversion","objects.views/selections/interaction-handler","objects.views/selections/interaction-type"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g){"use strict";function v(e){var t=e.getRotation(),n=t%360,i=n>180?t+360-n:t-n;e.setRotation(i)}function y(e){void 0!==e&&this.components.dataArea.setRotation(e)}function b(e){return e&&!(e.qHyperCube.qMeasureInfo.every(function(e){return e.qMax<=0&&e.qMax>=e.qMin})||0===e.qHyperCube.qSize.qcy)}var x;return x=n.extend("PieChart",{init:function(t,n,a,l,c){var u=this,h=e.extend(!0,{},a);a=e.extend(!0,a||{},{debug:!0,providers:{colorMap:{clazz:s,autoMode:"dimension"}},components:{xAxisTitle:{show:!0,order:1,dock:"top",relevantSize:30,showFlag:i.prototype.ShowFlags.SMALL,clazz:r},dataArea:{sortKey:1e3,show:!0,dock:"center",clazz:o,showFlag:i.prototype.ShowFlags.SPARK},colorLegend:{show:!0,dock:"right",relevantSize:126,label:"colorLegend",showFlag:i.prototype.ShowFlags.MEDIUM}}},h),this._super(t,n,a,l,c),this.components.dimensionAxisTitle=this.components.xAxisTitle,this.components.dimensionAxisTitle.listen("drill-up",function(e,t,n){u.backendApi.drillUp(t,n)}),this.components.dimensionAxisTitle.setModel(this.$scope.ext.model),this.components.dimensionAxisTitle.setDock(this.components.xAxisTitle.dock),delete this.components.xAxisTitle,this._lastRotation=0},initSelections:function(){this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend),this.options._disableSelections||(this.selections.Activated.bind(this.onSelection.Activated.bind(this)),this.selections.Deactivated.bind(this.onSelection.Deactivated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Select.bind(this.onSelection.Select.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.SelectAttributeDim.bind(this.onSelection.SelectAttributeDim.bind(this)),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)))},initTooltips:function(){this.tooltips&&this.tooltips.setComponent("dataArea",this.components.dataArea)},on:function(){if(this._super(),this._navigation){var e=this;this._eventHandlers=g.extend({mousewheel:function(t){var n=d.getMouseWheelData(t.originalEvent);y.apply(e,[e.components.dataArea.getRotation()+5*n.delta]),t.preventDefault()},rotate:{start:function(){e._lastRotation=0,e.components.dataArea.setUseTransition(!1),m.preventGestures(this)},update:function(t,n){y.apply(e,[e.components.dataArea.getRotation()+n.rotation-e._lastRotation]),e._lastRotation=n.rotation,m.preventGestures(this)},end:function(){e.components.dataArea.setUseTransition(!0),m.preventGestures(this)}},tapthree:{end:function(){v(e.components.dataArea),m.preventGestures(this)}},mouseup:function(t){2===t.which&&(t.preventDefault(),v(e.components.dataArea))},exclusive:function(){return!1},active:function(){return!0}}),m.addInteraction(this._eventHandlers,this.components.dataArea.container,2,["mousewheel","tapthree","rotate","mouseup"])}this._on=!0},off:function(){this._navigation&&m.removeInteraction(this._eventHandlers),this._super()},getSnapshotChartData:function(){return e.extend(!0,this._super()||{},{rotation:this.components.dataArea._currentProperties.rotation})},getViewState:function(){return{rotation:this.components.dataArea._currentProperties.rotation}},_paint:function(){var e,n=[];if(!this.isValid(this._data))return this.clear();this._super(),this.layout(),this.components.dataArea.setShowDimensionValues(this._layoutMode>i.prototype.ShowFlags.SPARK);for(e in this.components)n.push(this.components[e].invalidateDisplay("PieChart._paint"));return t.all(n)},isValid:function(e){return this._super(e)&&!this.supressChartRendering},prePaint:function(e){this._super(e),p.applyDisclaimerAttributes({title:!0,bottom:!0,overlay:!0,supportNegative:!1},this.$scope.dataAttributes,this.$element,this.$scope,e),this.supressChartRendering=this.$scope.dataAttributes.onlyNanData||this.$scope.dataAttributes.noDataExist||this.$scope.dataAttributes.onlyNegativeOrZero},_updateData:function(e){this._data=e;var n=this.getSnapshotStoredChartData();this._super(e),this.isDataSelectable(e)&&(this.selections&&this.selections.on(),!this._on&&this.inAnalysisState()&&this.on());var i=[];return i.push(this.components.dataArea.setData(e)),i.push(this.components.colorLegend.setData(e)),this.components.dimensionAxisTitle.setType("dimension"),i.push(this.components.dimensionAxisTitle.setData(e)),this.providers.colorMap.setDimensionTree(this._chartContext.getDimensionTree()),this.components.dataArea.setDimensionTree(this._chartContext.getDimensionTree()),e.dataPoint&&this.components.dataArea.setDataPointsLabelMode(e.dataPoint.auto?"share":e.dataPoint.labelMode),e.donut&&this.components.dataArea.setShowAsDonut(e.donut.showAsDonut),e.scale&&this.components.dataArea.setScaleRatio(e.scale),this._readStoredData&&n?this.components.dataArea.setRotation(n.rotation):this.options.viewState?this.components.dataArea.setRotation(this.options.viewState.rotation):e.rotation?this.components.dataArea.setRotation(e.rotation):v(this.components.dataArea),!1!==e.dimensionTitle?this.components.dimensionAxisTitle.showComponent():this.components.dimensionAxisTitle.hideComponent(),t.all(i)},toggleCacheItem:function(e){this.components.dataArea.toggleCacheItem(e),this.components.colorLegend.invalidateDisplay("PieChart#toggleCacheItem")},getPreferredSize:function(){return this._super()},destroy:function(){this._super(),this.components.dimensionAxisTitle&&this.components.dimensionAxisTitle.stopListen("drill-up")}}),{type:"piechart",BackendApi:a,template:h,View:x,definition:l,softDefinition:u,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:10,qHeight:500}],qSuppressZero:!1,qSuppressMissing:!0}},data:c,support:{cssScaling:!1,snapshot:b,export:b,exportData:!0,sharing:b,viewData:!0},options:{selections:{dataArea:{},colorLegend:{}},tooltips:{}},importProperties:f.colorChart.importProperties.bind(f),exportProperties:f.colorChart.exportProperties.bind(f)}}),define("extensions.qliktech/scatterplot/scatter-helper",["general.utils/shapes/circle","general.utils/shapes/rect","general.utils/shapes/polygon"],function(e,t,n){function i(e,t,n,i,r){var o;return isNaN(e)||null===e?NaN:t===n?(i+r)/2:e<=t?i:e>=n?r:(o=(e-t)/(n-t),i+(r-i)*Math.sqrt(o))}function r(e,t,n){var i;for(i=0;i<n.length;i++)if(e[n[i]]!==t[n[i]])return!1;return!0}return{createShape:function(i,r){var o;switch(i){case"circle":o=new e(r[0],r[1],r[2],r[3]);break;case"rect":o=new t(r[0],r[1],r[2],r[3]);break;case"polygon":o=new n}return o},checkClearNodes:function(e,t){return e?[]:t},checkNodeValid:function(e){return!(!e.dotData||"NaN"===e.dotData.xValue||"NaN"===e.dotData.yValue)},checkSelected:function(e){return!!(e&&e.cacheItem&&e.cacheItem.selected)},checkShouldRender:function(e,t){return!t||!!e.selected||!!e.highlighted},getRadius:function(e,t,n,r){return(t?i(e,n.sizeDataMin,n.sizeDataMax,n._minDotSize,n._maxDotSize):n._minDotSize)*r},getDotRadius:i,outOfBounds:function(e,t,n,i,r){var o=isNaN(n)||void 0===n?0:n;return e<-o||e>i+o||t<-o||t>r+o},outOfBoundsPosition:function(e,t,n){return e<0?-10+n:e>t?t-n+10:e},isSame:r,updateCross:function(e,t,n,i,r){return 13!==e.length?null:(e[0].x=t-i+r/2,e[0].y=n-i-r/2,e[1].x=t-i-r/2,e[1].y=n-i+r/2,e[2].x=t-r,e[2].y=n,e[3].x=t-i-r/2,e[3].y=n+i-r/2,e[4].x=t-i+r/2,e[4].y=n+i+r/2,e[5].x=t,e[5].y=n+r,e[6].x=t+i-r/2,e[6].y=n+i+r/2,e[7].x=t+i+r/2,e[7].y=n+i-r/2,e[8].x=t+r,e[8].y=n,e[9].x=t+i+r/2,e[9].y=n-i+r/2,e[10].x=t+i-r/2,e[10].y=n-i-r/2,e[11].x=t,e[11].y=n-r,e[12].x=t-i+r/2,e[12].y=n-i-r/2,e)},checkOverlapping:function(e,t){var n,i,o=!1;for(i=0;i<e.length;i++)if("circle"===(n=e[i]).type){if(r(n,t,["cx","cy","r"])){o=!0;break}}else if(r(n,t,["cx","cy"])){o=!0;break}return o},sortObjectsForLabels:function(e,t){var n,i;return n=e.cacheItem.getShapes("dataArea")[0],i=t.cacheItem.getShapes("dataArea")[0],n.cy-n.r>i.cy-i.r?1:n.cy-n.r<i.cy-i.r?-1:n.cx-n.r>i.cx-i.r?1:n.cx-n.r<i.cx-i.r?-1:n.r>i.r?-1:n.r<i.r?1:e.cacheItem.id<t.cacheItem.id?-1:1},getComparableObject:function(e,t){return 0===t?e[1]?e[1]:null:e[t-1]},checkLabelInterference:function(e,t,n,i){var r,o={x:!1,y:!1};return isNaN(i.cx)||isNaN(i.cy)?(o.y=!0,o):(r=-(t.y-e.y))<0?o:(r<2*e.height+i.r+n.r&&(o.y=!0,Math.abs(t.x-e.x)<e.width/2+t.width/2&&(o.x=!0)),o)},checkEllipsis:function(e,t){var n=e.x-e.width/2;return e.maxWidth=e.width,n<0&&(e.maxWidth+=2*n,e.x=e.maxWidth/2),(n=e.x+e.width/2-t)>0&&(e.maxWidth-=2*n),e.maxWidth=Math.max(e.maxWidth,0),e},centerLabel:function(e,t){return e.x=t.x-t.width/2,e.y=t.y-t.height,e.width=t.maxWidth,e.height=t.height,e}}}),define("extensions.qliktech/scatterplot/scatter-circle",["objects.views/charts/renderers/canvas-renderer","objects.views/charts/renderers/canvas/circle","objects.views/charts/renderers/canvas/polygon","objects.views/charts/shapes/circle"],function(e,t,n,i){function r(e){var t,n=[];for(t=0;t<e;t++)n.push({x:0,y:0});return n}function o(e,t,n,i,r){return 13!==e.length?null:(e[0].x=t-i+r/2,e[0].y=n-i-r/2,e[1].x=t-i-r/2,e[1].y=n-i+r/2,e[2].x=t-r,e[2].y=n,e[3].x=t-i-r/2,e[3].y=n+i-r/2,e[4].x=t-i+r/2,e[4].y=n+i+r/2,e[5].x=t,e[5].y=n+r,e[6].x=t+i-r/2,e[6].y=n+i+r/2,e[7].x=t+i+r/2,e[7].y=n+i-r/2,e[8].x=t+r,e[8].y=n,e[9].x=t+i+r/2,e[9].y=n-i+r/2,e[10].x=t+i-r/2,e[10].y=n-i-r/2,e[11].x=t,e[11].y=n-r,e[12].x=t-i+r/2,e[12].y=n-i-r/2,e)}var s=i.extend("ScatterCircle",{init:function(e,t,n,i,r){this._super(e,t,n),this.type="circle",this.saltireSize=i,this.saltireWidth=r},set:function(e,t,n,i,s){this.saltireSize=this.saltireSize||i,this.saltireWidth=this.saltireWidth||s,this._saltire=o(this._saltire||r(13),e,t,this.saltireSize,this.saltireWidth),this._polygons=[{points:this._saltire}],this._super(e,t,n)}});return e._registerRenderFn(function(e,i,r){"saltire"===this.type?n.render.apply(this,[e,i,r]):t.render.apply(this,[e,i,r])},s),s}),define("extensions.qliktech/scatterplot/heat-map-light",["core.utils/class","objects.views/charts/shapes/rect","objects.views/charts/shapes/text","general.utils/color","objects.utils/number-formatter","objects.views/charts/renderers/canvas-renderer","objects.views/selections/cache-item-combo","translator"],function(e,t,n,i,r,o,s,a){function l(e){var t=new n;return t.text=this._numberFormatter.format(e.qNum,this._defaultPattern),t.align="center",t.font="11px 'QlikView Sans'",t}function c(e,t,n){e.x=t.x+t.width/2,e.y=t.y+t.height/2+4,e.fill=n?"#fff":"#444"}function u(e,t){if(e&&t){var n,i,r,o,s,a=this._binGapCompensation,l=this._rtlBinGapCompensation;n=t.qText,i=this._xAxis.getPositionOfValue(n[0]),o=this._yAxis.getPositionOfValue(n[1]),r=this._xAxis.getPositionOfValue(n[2]),s=this._yAxis.getPositionOfValue(n[3]),e.set(i-a,o-a,r-i+l,s-o+a)}}function h(e,t,n){u.call(this,e,t),e.fill=n.toRGBA()}function d(e){var n,r,o=this._data[e],s=new i(this._colorMap.getColor(null,o.qNum/this._maxNrInBin));this._rectShapes[e]||(this._rectShapes[e]=new t(0,0,0,0),this._heatContainer.addChild(this._rectShapes[e]),this._labelShapes[e]=l.call(this,o),this._heatContainer.addChild(this._labelShapes[e])),n=this._rectShapes[e],h.call(this,n,o,s),r=this._labelShapes[e],c.call(this,r,n,s.isDark()),r.visible=n.width>40&&n.height>15}function p(){if(this._binShapes.length===this._data.length){var e,t=this._binShapes.length;for(e=0;e<t;e++)u.call(this,this._binShapes[e],this._data[e])}}function f(){for(var e=0;e<this._numBins;e++)d.call(this,e)}return e.extend("HeatMapLight",{init:function(e,t,n){this._renderer=e,this._heatContainer=t,this._selectedRenderer=n,this._numberFormatter=new r,this._defaultPattern="#.#A",this._binGapCompensation=.5,this._rtlBinGapCompensation=this._binGapCompensation,this._binShapes=[]},setYMirrorMode:function(e){this.yMirrorMode=e,this._rtlBinGapCompensation=this.yMirrorMode?-this._binGapCompensation:this._binGapCompensation},setData:function(e){this._data=e[0].concat(),this._metaData=this._data.splice(0,1)[0],this._maxNrInBin=this._metaData.qNum,this._numBins=this._data?this._data.length:0,this._rectShapes=[],this._labelShapes=[],this._selectedShapes={},this._needToClearShapes=!0},getData:function(){return this._data},setColorMap:function(e){this._colorMap=e},getColorMap:function(){return this._colorMap},hasValidData:function(){return this._data&&this._metaData},setXAxis:function(e){this._xAxis=e},setYAxis:function(e){this._yAxis=e},setCacheItems:function(e){this._cacheItems=e},createCacheItems:function(e){var n,i,r,o,l=[];for(n=0;n<this._numBins;n++)i=this._data[n],this._binShapes.length>n?r=this._binShapes[n]:(r=new t(0,0,0,0),this._binShapes[n]=r),(o=new s([0],[],[],[],n,0,i.qElemNumber))._dimensions[0]=a.get("properties.compression.density")+": "+i.qNum,o.addShape(e,r,!0),l[l.length]=o;return this._binShapes.length>this._numBins&&(this._binShapes=this._binShapes.slice(0,this._numBins)),this._cacheItems=l,l},toggleCacheItem:function(e){var n=e.row;if(e.selected){var r,o,s=this._data[n],a=new i(this._colorMap.getColor(null,s.qNum/this._maxNrInBin));r=new t(0,0,0,0),h.call(this,r,s,a),r.stroke="#333",r.strokeWidth=2,this._selectedRenderer.stage.addChild(r),this._selectedShapes[n]={rect:r},r.invalidate(),r.width>40&&r.height>15&&(o=l.call(this,s),c.call(this,o,r,a.isDark()),this._selectedRenderer.stage.addChild(o),this._selectedShapes[n].label=o,o.invalidate())}else this._selectedShapes[n].rect&&(this._selectedShapes[n].rect.invalidate(),this._selectedRenderer.stage.removeChild(this._selectedShapes[n].rect)),this._selectedShapes[n].label&&(this._selectedShapes[n].label.invalidate(),this._selectedRenderer.stage.removeChild(this._selectedShapes[n].label)),this._selectedShapes[n]=void 0},draw:function(){if(this._data&&this._data.length&&!(this._data.length<1))return this._pixelRatio=o.getDevicePixelToBackingStoreRatio(),this._needToClearShapes&&(this._heatContainer.removeChildren(),this._needToClearShapes=!1),p.call(this),f.call(this),this._renderer.render()},copyHeatMap:function(){return this._renderer._canvas.width&&this._renderer._canvas.height&&(this._imageData=this._renderer._canvas.getContext("2d").getImageData(0,0,this._renderer._canvas.width,this._renderer._canvas.height),this._selectedRenderer&&this._selectedRenderer._updateSize()),this._imageData},getHeatMapCanvas:function(){return this._renderer._canvas},clipSelected:function(e){this._renderer._canvas.width&&this._renderer._canvas.height&&(this._selectedRenderer.clear(),this._selectedRenderer._canvas.getContext("2d").putImageData(this._imageData,0,0,e.x*this._pixelRatio,e.y*this._pixelRatio,e.width*this._pixelRatio,e.height*this._pixelRatio))},clearSelection:function(){this._selectedRenderer.stage.removeChildren(),this._selectedRenderer.clear()},release:function(){this._renderer=null,this._heatContainer=null,this._selectedRenderer=null}})}),define("extensions.qliktech/scatterplot/scatterarea",["objects.views/charts/components/chart-component","extensions.qliktech/scatterplot/scatter-helper","objects.views/charts/renderers/canvas-renderer","./scatter-circle","objects.views/charts/shapes/text","objects.views/charts/shapes/rect","objects.views/charts/shapes/line","objects.views/charts/utils/tree-iterator","objects.views/charts/chart-style-service","general.utils/color","core.utils/deferred","extensions.qliktech/scatterplot/heat-map-light","objects.views/charts/shapes/container","client.utils/theme/modern/theme","core.utils/feature-flags"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f){"use strict";function m(e,t,n,i){return e.set(t,n,i),e}function g(e){var t,n=e.length;for(t=0;t<n;t++)e[t].renderer.setAttribute("style",{opacity:e[t].visible?1:0});setTimeout(function(){for(t=0;t<n;t++)e[t].renderer.setAttribute("style",{visibility:e[t].visible?"":"hidden"})},500)}function v(e){var t="scatterPlot";return f.THEMING?{backgroundColor:e.getStyle("","backgroundColor"),dataPoint:{label:{color:e.getStyle("label.value","color"),font:"normal "+e.getStyle("label.value","fontSize")+" 'QlikView Sans'",background:e.getStyle("","backgroundColor")}},line:{color:e.getStyle("label.value","color"),width:1},shape:{border:{width:1},selected:{border:{color:"rgba(0,0,0,0.7)",width:2}},outOfBounds:{opacity:.3}}}:{backgroundColor:e.getValue(t,null,"backgroundColor"),dataPoint:{label:{color:e.getValue(t,"value","color"),font:e.getFont(t,"value"),background:e.getValue(t,"value","background")}},shape:{border:{width:e.getValue(t,"shape.border","width")},selected:{border:{color:e.getValue(t,"shape.border","color"),width:e.getValue(t,"shape.border","width","selected")}},outOfBounds:{opacity:e.getValue(t,"shape.outOfBounds","opacity")}},line:{color:e.getValue(t,"line","color"),width:e.getValue(t,"line","width")}}}function y(e){var n,r,o,s,a,l,c,h,d,p,f,v,y,b=this._tree,x=this._tree.children.length,q=t.createShape("circle",[0,0,0,0]),C=this.rect.width,S=this.rect.height,w=this._dots,_=this,D=[],M=[],A=3,E=this._canvasShapes,I=this._data.qHyperCube.qMeasureInfo.length>2&&!this._data.qHyperCube.qIsReduced,T=Math.min(this.rect.height,this.rect.width)/300,L=this.selectionIdentifier?this.selectionIdentifier:"dataArea",k=this._styles;if(x){if(this._renderedNodes=t.checkClearNodes(!e,this._renderedNodes),b.children.forEach(function(u){if(t.checkNodeValid(u)&&(l=!1,s=t.checkSelected(u),u.selected=s,u.highlighted=u.cacheItem.highlighted,d=s?k.shape.selected.border.width:k.shape.border.width,p=s?.9:void 0,"dimension"===u.data.type)){if(!t.checkShouldRender(u,e)||!_._currentProperties.values)return;if(!(f=_._currentProperties.values[u.data.qElemNo]))return;if(n=_._xAxis.getPositionOfValue(f.xValue),r=_._yAxis.getPositionOfValue(f.yValue),o=t.getRadius(f.rValue,I,_._currentProperties,T),isNaN(n)||isNaN(r))return;A=(o=o<.5?.5:o)<A?o:A,c=isNaN(o)||void 0===o,u.dotData.outOfBounds=l=t.outOfBounds(n,r,o,C,S),l&&(o=A,n=t.outOfBoundsPosition(n,C,o),r=t.outOfBoundsPosition(r,S,o)),h=c&&!l,q=m(w[u.dotData.dotIndex],n,r,h?6:o),(a=u.cacheItem).clearShapes(L),a.addShape(L,q,!0),u.dotData.color=_._colorMap.getColor(u.data.qElemNo,u._children[0].data.qNum,0,u.data.rowIndex),y=!1,u.selected||(y=t.checkOverlapping(l?M:D,q,n,r,1)),y||((v=E[u.idx])?v.fill=u.dotData.color.toRGBA():((v=new i(0,0,0,3,1)).fill=u.dotData.color.toRGBA(),v.strokeWidth=d,v.opacity=p,v.stroke=s?k.shape.selected.border.color:_._sheetBackgroundColor.toRGBA(),v.data.label=u.data.qText?u.data.qText.substr(0,128):"",E[u.idx]=v),l?_._isBigData||(v.set(q.cx,q.cy,q.r),v.type="circle",M.push(v)):(v.set(q.cx,q.cy,q.r),v.type=c?"saltire":"circle",e||(D.push(v),_._renderedNodes.push(u))))}}),!e){var O=[];return this.renderers.dots.stage.removeChildren(),this.renderers.dots.stage.addChildren(D),O.push(this.renderers.dots.render()),this._isBigData?g.call(this,[{renderer:this.renderers.oob,visible:!1}]):(g.call(this,[{renderer:this.renderers.oob,visible:!0}]),this.renderers.oob.stage.removeChildren(),this.renderers.oob.stage.addChildren(M),O.push(this.renderers.oob.render())),u.all(O)}}else this.clear()}function b(){var e,n,i,a,l,c,u,h,d,p,f,m,g,v=this._renderedNodes.length,y=this,b=[],q=this._labelShapes,C=this.renderers.labels,S=this._styles,w=this.selectionIdentifier?this.selectionIdentifier:"dataArea";return v&&(c=this._renderedNodes.sort(t.sortObjectsForLabels)).forEach(function(v,C){if(q[v.data.rowIndex]&&(q[v.data.rowIndex].visible=!1),a=v.cacheItem,n=v.dotData.label,e=a.getShapes(w)[0],l=a.toggleShapes[0],p=C-1,u=t.getComparableObject(c,C),n.x=e.cx,n.y=e.cy-e.r-5,n&&!v.dotData.outOfBounds){if(y._labelMode===x.AUTO&&u){if(h=u.cacheItem.getShapes(w)[0],i=u.dotData.label,(d=t.checkLabelInterference(n,i,e,h)).x&&d.y)return void(l.width=0);for(;d.y&&p>0;)if(p--,u=0!==C?c[p]:null,h=u.cacheItem.getShapes(w)[0],i=u.dotData.label,(d=t.checkLabelInterference(n,i,e,h)).x&&d.y)return void(l.width=0)}n.y-n.height<0||n.y>y.rect.height?l.set(0,0,0,0):(n=t.checkEllipsis(n,y.rect.width),(l=t.centerLabel(l,n)).width&&(q[v.data.rowIndex]?(m=q[v.data.rowIndex].rect,f=q[v.data.rowIndex].text,g=q[v.data.rowIndex].line,q[v.data.rowIndex].visible=!0):(m=new o,f=new r,g=new s,q[v.data.rowIndex]={visible:!0,rect:m,text:f,line:g},m.fill=S.dataPoint.label.background,f.fill=S.dataPoint.label.color,f.align="center",f.font=S.dataPoint.label.font,f.baseline="bottom",g.stroke=S.line.color),f.setText(n.text),f.x=n.x,f.y=n.y,f.maxWidth=n.maxWidth,m.x=f.x-f.maxWidth/2-2,m.y=l.y,m.width=l.width+4,m.height=l.height,g.set(n.x,n.y-2,n.x,n.y+3),b.push(m),b.push(f),b.push(g)))}else l.set(0,0,0,0)}),C.stage.removeChildren(),C.stage.addChildren(b),C.render()}var x;return x={NONE:0,AUTO:1,ALL:2},e.extend({init:function(){this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._dots=[],this._binShapes=[],this._labelRects=[],this._cacheItems=[],this._renderedNodes=[],this._showDataPoints=!0,this._colorMap=null,this._navigationVisible=!1,this._globalAlpha=1,this._canvasShapes={},this._labelMode=x.AUTO,this._transitionProperties._minDotSize=2,this._transitionProperties._maxDotSize=10,this._style={dataPoints:{color:"#666",font:"12px 'QlikView Sans'"}},this._styles={},this._styleService=f.THEMING?p.initializeService("object.scatterPlot"):l.getInstance(),this._styles=v(this._styleService),this._sheetBackgroundColor=new c(this._styles.backgroundColor),this._sheetBackgroundColor.setAlpha(.3),this.renderers={heat:new n(this.container,{name:"heat"}),selectedHeat:new n(this.container,{name:"selectedHeat"}),dots:new n(this.container,{name:"dots"}),labels:new n(this.container,{name:"labels"}),oob:new n(this.container,{name:"oob"})},this._heatContainer=new d,this.renderers.heat.stage.addChild(this._heatContainer),this._heatMap=new h(this.renderers.heat,this._heatContainer,this.renderers.selectedHeat),this._heatMap.setColorMap(this._heatColorMap);this.renderers.heat.setAttribute("style",{webkitTransition:"opacity 0.5s linear",mozTransition:"opacity 0.5s linear",transition:"opacity 0.5s linear"}),this.renderers.dots.setAttribute("style",{webkitTransition:"opacity 0.5s linear",mozTransition:"opacity 0.5s linear",transition:"opacity 0.5s linear"}),this.renderers.labels.setAttribute("style",{webkitTransition:"opacity 0.5s linear",mozTransition:"opacity 0.5s linear",transition:"opacity 0.5s linear"}),this.perpendicularlyRelevantSpacing={top:10,left:10,right:10,bottom:10},this._transitionHelper.setTransitionTime(500,0)},setYMirrorMode:function(e){this.yMirrorMode=e,this._heatMap&&this._heatMap.setYMirrorMode(e)},setUseTransition:function(e){this._savedUseTransition=e,this._super(e&&!this._isBigData)},setIsBigData:function(e){e!==this._isBigData&&(this._isBigData=e,this.setUseTransition(this._savedUseTransition))},getIsBigData:function(){return this._isBigData},setIsReduced:function(e){e!==this._isReduced&&(this._reducedModeChanged=!0,this._isReduced=e)},getIsReduced:function(){return this._isReduced},setHeatMapData:function(e){this._heatMap.setData(e)},getHeatMapData:function(){return this._heatMap.getData()},setColorMap:function(e){this._colorMap=e},getColorMap:function(){return this._colorMap},setHeatColorMap:function(e){this._heatColorMap=e,this._heatMap&&this._heatMap.setColorMap(this._heatColorMap)},getHeatColorMap:function(){return this._heatColorMap},setXAxis:function(e){this._xAxis=e,this._heatMap.setXAxis(e),this._xAxis.listen("changed",function(){this.invalidateDisplay()},this)},setYAxis:function(e){this._yAxis=e,this._heatMap.setYAxis(e),this._yAxis.listen("changed",function(){this.invalidateDisplay()},this)},setDimensionTree:function(e){this._tree=e,this.invalidateProperties(),this.invalidateDisplay()},setMinDotSize:function(e){this._transitionProperties._minDotSize=e,this.invalidateDisplay()},setMaxDotSize:function(e){this._transitionProperties._maxDotSize=e,this.invalidateDisplay()},setLabelMode:function(e){this._labelMode=e,this.invalidateDisplay()},setNavigation:function(e){this._navigationVisible=e,this.invalidateDisplay()},preRelevantSizeCalculation:function(){this.perpendicularlyRelevantSpacing={top:10,left:10,right:10,bottom:10}},_updateSize:function(){this.invalidateDisplay()},setData:function(e){this._super(e)},_updateProperties:function(){if(this._data&&(this._isReduced||this._tree)){this._canvasShapes={},this._labelShapes={};var e,n,i,r,o,s,l,c=[],u=this._data.qHyperCube.qDimensionInfo.length,h=this._data.qHyperCube.qMeasureInfo.length,d=this._tree,p=this,f=this._dots,m=this._labelRects,g=0,v=this._dots.length,y=u+1,b=this.renderers.dots,q=this._style.dataPoints,C=this.selectionIdentifier?this.selectionIdentifier:"dataArea";return this._onlySelected=!1,p._transitionProperties.values={},p._transitionProperties.nodes={},h>2&&(p._transitionProperties.sizeDataMin=this._data.qHyperCube.qMeasureInfo[2].qMin,p._transitionProperties.sizeDataMax=this._data.qHyperCube.qMeasureInfo[2].qMax),!this._isReduced&&this._tree?(d.children.length&&a.each.call(d,function(h,d){if(l=a.getLevel.call(h),h.idx=d,l===y-1){if(u>1&&d>0)return;r=h.children[0].data.qNum,o=h.children[1].data.qNum,s=h.children.length>2?h.children[2].data.qNum:.5,h.dotData={color:null,label:null},u<=1&&(h.dotData.dotIndex=g++,v<g?(e=t.createShape("circle",[0,0,0,0]),n=t.createShape("rect",[0,0,0,0]),f.push(e),m.push(n)):((e=p._dots[h.dotData.dotIndex]).cx=NaN,e.cy=NaN,n=p._labelRects[h.dotData.dotIndex]),p._labelMode===x.NONE&&(n.width=NaN,n.height=NaN),(i=h.cacheItem).addShape(C,e,!0),i.toggleShapes=[n],c.push(i),p._transitionProperties.values[h.data.qElemNo]={xValue:r,yValue:o,rValue:s}),h.dotData.label={x:0,y:0,width:0,height:0,text:h.data.qText},h.dotData.label.width=b.getTextWidth(h.dotData.label.text,q.font),h.dotData.label.height=b.getFontHeight(q.font)}}),this._dots.length>g&&(this._dots=this._dots.slice(0,g),this._labelRects=this._labelRects.slice(0,g)),this._heatMap.setCacheItems()):c=this._heatMap.createCacheItems(C),this._cacheItems=c,this.setSelectableShapes(c),this._super()}},hasValidData:function(){return this._super()&&this._data&&(this._tree||this._isReduced&&this._heatMap.hasValidData())&&this._xAxis&&this._yAxis},paint:function(){var e=this;if(this._super(this._layoutMode,this._data),this._xAxis&&this._yAxis&&this._data&&this.renderers){if(this._xAxis.updateNow(),this._yAxis.updateNow(),this.renderers.oob.edgeBleed={left:10,right:10,bottom:10,top:10},this._styles=v(this._styleService),!this._renderData)return this.clear();if(this.renderers.dots.stage.opacity=this._globalAlpha||1,this.renderers.labels.stage.opacity=this._globalAlpha||1,this.renderers.heat.setAttribute("style",{opacity:this._globalAlpha||1}),this._isReduced)return this._reducedModeChanged?(this._reducedModeChanged=!1,g.call(this,[{renderer:this.renderers.heat,visible:!0},{renderer:this.renderers.selectedHeat,visible:!0},{renderer:this.renderers.dots,visible:!1},{renderer:this.renderers.labels,visible:!1},{renderer:this.renderers.oob,visible:!1}]),this._heatMap.draw()):(this.renderers.labels.stage.removeChildren(),this.renderers.labels.clear(),this.renderers.dots.stage.removeChildren(),this.renderers.dots.clear(),this.renderers.oob.stage.removeChildren(),this.renderers.oob.clear(),this._heatMap.draw());if(this._tree.children.length>0){var t=function(){var t,n,i=[];return(t=y.apply(e,[e._onlySelected]))&&i.push(t),e._onlySelected=!1,e._labelMode>x.NONE&&e._layoutMode>e.ShowFlags.XSMALL?(n=b.apply(e,[]))&&i.push(n):(e.renderers.labels.stage.removeChildren(),i.push(e.renderers.labels.clear())),u.all(i)};return this._reducedModeChanged?(this._reducedModeChanged=!1,g.call(this,[{renderer:this.renderers.heat,visible:!1},{renderer:this.renderers.selectedHeat,visible:!1},{renderer:this.renderers.dots,visible:!0},{renderer:this.renderers.labels,visible:!0}]),t()):(this.renderers.selectedHeat.clear(),this.renderers.selectedHeat.stage.removeChildren(),t())}}},clear:function(){return this._transitionHelper.clear(),this._super()},toggleCacheItem:function(e){if(this._isReduced)this._heatMap.toggleCacheItem(e);else{var t=!0,n=this._styles,i=this;this.renderers.dots.stage.opacity!==this._globalAlpha&&(t=!1,this.renderers.dots.stage.opacity=this._globalAlpha,this.renderers.labels.stage.opacity=this._globalAlpha);var r=this._canvasShapes[e.row],o=this._labelShapes[e.row];r&&(e.selected?(r.strokeWidth=2,r.stroke=n.shape.selected.border.color,r.opacity=.9,r.zIndex=1,o&&o.visible&&(o.text.opacity=1,o.line.opacity=1,o.zIndex=1)):(r.opacity=void 0,r.stroke=i._sheetBackgroundColor.toRGBA(),r.strokeWidth=1,r.zIndex=void 0,o&&o.visible&&(o.text.opacity=void 0,o.line.opacity=void 0,o.zIndex=void 0)),t&&(r.invalidate(),o&&o.visible&&o.text.invalidate())),t||(this.renderers.dots.render(),this.renderers.labels.render(),this.renderers.oob.render())}},updateRangeSelection:function(e){this._heatMap.copyHeatMap(e),this._heatMap.clipSelected(e)},startRangeSelection:function(e){this._heatMap.copyHeatMap(e)},copyHeatMap:function(){return this._heatMap.copyHeatMap()},getHeatMapCanvas:function(){return this._heatMap.getHeatMapCanvas()},clearSelection:function(){this._heatMap.clearSelection()},setRenderData:function(e){this._renderData=e},release:function(){this._super(),this._styleService=null,this._styles=null,this._sheetBackgroundColor=null,this._heatMap.release(),this._heatContainer.removeChildren(),this.renderers=null,this._heatContainer=null,this._heatMap=null}})}),define("objects.views/charts/representation/basic-color-map",["core.utils/class","general.utils/color-cache","objects.views/charts/representation/color-scale","client.utils/theme/theme-module"],function(e,t,n,i){function r(e,t){return e&&e.length>1&&t&&t.length&&(e.length===t.length+1||e.length/2===t.length+1)}function o(e,n,i){return e.gradient?[t.retriveBlend(n,i,.5),i]:[i,i]}function s(e,n){var i=n.map(function(e){return t.retriveColor(e)});if(void 0!==e[0].value){var r=[];e[0].gradient?Array.prototype.push.apply(r,[i[0],t.retriveBlend(i[0],i[1],.5)]):Array.prototype.push.apply(r,[i[0],i[0]]);for(var s=1;s<i.length;s++)Array.prototype.push.apply(r,o(e[s-1],i[s-1],i[s]));return{colors:r,limits:e.map(function(e){return e.value})}}return{colors:i,limits:e}}var a=i.get();return e.extend("BasicColorMap",{init:function(e){this.setColorScheme(e)},setColorScheme:function(e){if(this._valid=r(e.colors,e.limits),this._max=isNaN(e.max)?1:e.max,this._min=e.min||0,this._valid){var t=s(e.limits.reverse(),e.colors.reverse());this._colorScale=new n,this._colorScale.setMaxMinValues(this._max,this._min),this._colorScale.setLimits(t.limits);for(var i=0;i<t.colors.length;i+=2)this._colorScale.addColorPart(t.colors[i],t.colors[i+1])}},setMaxMin:function(e,t){this._max=e,this._min=t},getColor:function(e,n){return this._valid?this._colorScale.getColor(n):t.retriveColor(a.dataColors.nullColor)},getColorMapping:function(){var e,t,n=this._colorScale.getLegendParts(),i=this._max-this._min,r=n.length,o=i/r,s=this._max,a=[];for(t=0;t<r-1;t++)(e=n[t]).isMax=0===t,e.max=s,e.min=s-o,e.id=[s,s-o],e.type="range",s-=o,a.push(e);return e=n[t],e.max=s,e.min=this._min,e.id=[s,this._min],e.type="range",a.push(e),a},getSelectionIndices:function(){return[0]},getValueFormatter:function(){return null},getColorDataInfo:function(){return{legendMode:{discrete:!1,boxType:null,colorMode:"expression",selectionEnabled:!1,altMode:!1}}},getColorFromPreScaledValue:function(e){return this._colorScale.getColor(e)},getLegendDataProvider:function(){return null},setLegendTitle:function(e){this._legendTitle=e},getLegendTitle:function(){return this._legendTitle},getLegendMode:function(){return["scale",null,"expression",!0]}})}),define("extensions.qliktech/scatterplot/scatterplot-properties",["translator","client.utils/default-property-logic"],function(e,t){var n,i,r=t.getLogicFor("hard","scatterplot");return n={type:"items",component:"expandable-items",translation:"properties.addons",items:{refLinesX:{uses:"reflines",ref:"refLine.refLinesX",translation:"properties.referenceLinesX"},refLinesY:{uses:"reflines",ref:"refLine.refLinesY",translation:"properties.referenceLinesY"},dataHandling:{uses:"dataHandling",items:{calcCond:{uses:"calcCond"}}}}},{type:"items",component:"accordion",items:{data:{uses:"data"},addons:n,settings:{uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{showNavigation:{ref:"navigation",type:"boolean",translation:"Common.Navigation",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},bubbleSizeItems:{type:"items",items:{bubbleSizes:{type:"integer",component:"slider",ref:"dataPoint.bubbleSizes",translation:"properties.dataPoints.bubbleSizes",min:1,max:20,step:1,defaultValue:5,show:function(e){return e.qHyperCubeDef.qMeasures.length<3}},rangeBubbleSizes:{type:"array",component:"slider",ref:"dataPoint.rangeBubbleSizes",translation:"properties.dataPoints.bubbleSizes",min:1,max:20,step:1,defaultValue:[2,8],show:function(e){return e.qHyperCubeDef.qMeasures.length>=3}},rangeBubbleCompressionNote:i={component:"text",translation:"properties.compression.willNotAffect",show:function(e,t){return r.helpers.showCompressionResolution(t.layout)}}}},label:{type:"items",items:{labelMode:{ref:"labels.mode",translation:"properties.labels",type:"string",component:"dropdown",defaultValue:1,options:[{value:1,translation:"Common.Auto"},{value:2,translation:"Common.All"},{value:0,translation:"Common.None"}],snapshot:{tid:"property-labels"}},labelModeCompressionNote:i}},queryLevel:{type:"integer",component:"slider",ref:"compressionResolution",translation:"properties.compression.resolution",min:4,max:8,step:1,defaultValue:5,show:function(e,t){return r.helpers.showCompressionResolution(t.layout)}},gridLines:{type:"items",snapshot:{tid:"property-gridLines"},items:{showGridLines:{ref:"gridLine.auto",type:"boolean",translation:"properties.gridLine.spacing",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},gridSpacing:{ref:"gridLine.spacing",type:"number",component:"dropdown",defaultValue:2,options:[{value:0,translation:"properties.gridLine.noLines"},{value:1,translation:"properties.gridLine.wide"},{value:2,translation:"properties.gridLine.medium"},{value:3,translation:"properties.gridLine.narrow"}],show:function(e){return!e.gridLine.auto}}}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{autoColor:{},colorsAnLegendCompressionNote:i,colorMode:{defaultValue:"primary",options:r.color.colorMode.options},persistentColors:{show:r.color.persistentColors.show}}},legend:{show:r.legend.show,items:{show:{snapshot:{tid:"property-legend"}},showTitle:{show:r.legend.showTitle.show},dock:{show:r.legend.dock.show}}}}},xAxis:{type:"items",uses:"axis.measureAxis",label:function(t,n){var i=n.getMeasureLayouts()[0];return i&&!i.qError?e.get("properties.xAxisWithInfo",[i.qFallbackTitle]):e.get("properties.xAxis")},items:{axis:{items:{show:{ref:"xAxis.show",snapshot:{title:"properties.xAxis",tid:"property-xAxis"}},dock:{ref:"xAxis.dock",show:function(e){return"none"!==e.xAxis.show},options:[{value:"near",translation:"Common.Bottom"},{value:"far",translation:"Common.Top"}]},spacing:{ref:"xAxis.spacing",show:function(e){return"none"!==e.xAxis.show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"xAxis.autoMinMax"},minMax:{ref:"xAxis.minMax",show:function(e){return!e.xAxis.autoMinMax}},min:{ref:"xAxis.min",show:function(e){return["min","minMax"].contains(e.xAxis.minMax)&&!e.xAxis.autoMinMax},invalid:function(e){return"minMax"===e.xAxis.minMax&&e.xAxis.min>=e.xAxis.max}},max:{ref:"xAxis.max",show:function(e){return["max","minMax"].contains(e.xAxis.minMax)&&!e.xAxis.autoMinMax},invalid:function(e){return"minMax"===e.xAxis.minMax&&e.xAxis.min>=e.xAxis.max}}}}}},yAxis:{type:"items",uses:"axis.measureAxis",label:function(t,n){var i=n.getMeasureLayouts()[1];return i&&!i.qError?e.get("properties.yAxisWithInfo",[i.qFallbackTitle]):e.get("properties.yAxis")},items:{axis:{items:{show:{ref:"yAxis.show",snapshot:{title:"properties.yAxis",tid:"property-yAxis"}},dock:{ref:"yAxis.dock",show:function(e){return"none"!==e.yAxis.show},options:[{value:"near",translation:"properties.dock.left"},{value:"far",translation:"properties.dock.right"}]},spacing:{ref:"yAxis.spacing",show:function(e){return"none"!==e.yAxis.show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"yAxis.autoMinMax"},minMax:{ref:"yAxis.minMax",show:function(e){return!e.yAxis.autoMinMax}},min:{ref:"yAxis.min",show:function(e){return["min","minMax"].contains(e.yAxis.minMax)&&!e.yAxis.autoMinMax},invalid:function(e){return"minMax"===e.yAxis.minMax&&e.yAxis.min>=e.yAxis.max}},max:{ref:"yAxis.max",show:function(e){return["max","minMax"].contains(e.yAxis.minMax)&&!e.yAxis.autoMinMax},invalid:function(e){return"minMax"===e.yAxis.minMax&&e.yAxis.min>=e.yAxis.max}}}}}}}}}}}),define("extensions.qliktech/scatterplot/scatterplot-explore-properties",["client.utils/default-property-logic","client.utils/property-hypercube-helper"],function(e,t){var n=e.getLogicFor("explore","scatterplot");return{type:"items",component:"accordion",items:{data:{uses:"data"},presentation:{uses:"presentation",items:{showNavigation:{type:"boolean",translation:"Common.Navigation",component:"switch",ref:"navigation",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},showLabels:{component:"radio-list",translation:"properties.labels",type:"number",ref:"labels.mode",options:function(){return[{value:1,translation:"Common.Auto"},{value:2,translation:"Common.All"},{value:0,translation:"Common.None"}]}},bubbleSizes:{type:"integer",component:"slider",ref:"dataPoint.bubbleSizes",translation:"properties.dataPoints.bubbleSizes",min:1,max:20,step:1,show:function(e){return t.getNumMeasures(e)<3}},rangeBubbleSizes:{type:"array",component:"slider",ref:"dataPoint.rangeBubbleSizes",translation:"properties.dataPoints.bubbleSizes",min:1,max:20,step:1,show:function(e){return t.getNumMeasures(e)>2}},queryLevel:{type:"integer",component:"slider",ref:"compressionResolution",translation:"properties.compression.resolution",min:4,max:8,step:1,show:function(e,t){return n.helpers.showCompressionResolution(t)}}}},color:{uses:"color",items:{mode:{options:n.color.colorMode.options},dimension:{items:{colorScheme:{show:function(e,i){var r=t.getDimensionLayouts(i)[0],o=e.color&&"byDimension"===e.color.mode&&e.color.useDimColVal&&n.color.useDimColVal.show(e);return!(r&&r.qCardinal<=12||o)}},persistentColors:{show:function(e){return!(e.color&&"byDimension"===e.color.mode&&e.color.useDimColVal&&n.color.useDimColVal.show(e))}}}}}}}}}),define("extensions.qliktech/scatterplot/scatterplot-data",["client.utils/property-resolver"],function(e){function t(e){var t=e.getMeasures();2===t.length?e.setSorting([2,1,0]):3===t.length&&e.setSorting([3,2,1,0])}function n(t,n){var i=n.getMeasures();"byExpression"===e.getValue(t,"color.mode")&&0===i.length&&e.setValue(t,"color.mode","primary")}return{dimensions:{min:1,max:1,description:function(){return"Bubbles"}},measures:{min:2,max:3,description:function(e,t){return 0===t?"X-axis":1===t?"Y-axis":"Size"},add:function(e,n,i){t(i),e.qSortBy.qSortByNumeric=-1},remove:function(e,i,r){t(r),n(i,r)}}}}),define("text!extensions.qliktech/scatterplot/scatterplot.ng.html",[],function(){return'<div class="qv-viz" style="position: relative;"></div>\n<span class="qv-viz-disclaimer"\n\t  ng-if="dataAttributes.reduceDataDisc  && dataAttributes.layoutMode > 2"\n\t  qva-direction x-dir-setting="{{options.direction}}" x-dir-text="{{reducedDataNote}}">\n\t<span class="ltr-star">*</span>\n\t<span>{{ reducedDataNote }}</span>\n\t<span class="rtl-star">*</span>\n</span>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist  && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist" dir="ltr"></span>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNanData  && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.OnlyNanData" q-title-translation="Object.Disclaimer.OnlyNanData" dir="ltr"></span>\n<div qva-zoom-pan-navigation></div>\n<div qva-scatter-mini-map ng-show="showMiniMap" ng-style="miniMapStyle" colorMap="colorMap"></div>\n'}),define("objects.utils/chart-style-utils",["general.utils/color","core.utils/feature-flags","client.utils/theme/modern/theme","client.utils/theme/theme-module","objects.views/charts/chart-style-service"],function(e,t,n,i,r){var o={Theme:i.get(),TRANSPARENT_BLACK:"rgba( 0,0,0,0.2 )",TRANSPARENT_WHITE:"rgba( 255,255,255,0.7 )",LIGHT_GREY:"#ccc",DARK_GREY:"#666",BLACK:"#000",WHITE:"#fff",getInverse:function(t){var n=new e(t);return 0===n.getAlpha()?this.BLACK:n.isDark()?this.WHITE:this.BLACK},getContrastingGrey:function(t){var n=new e(t);return 0===n.getAlpha()?this.DARK_GREY:e.getBestContrast(n,s,a)},getBestContrast:function(t,n,i){return e.getBestContrast(new e(t),new e(n),new e(i))},getContrastingTransparent:function(t){var n=new e(t);return 0===n.getAlpha()||"none"===t?this.TRANSPARENT_BLACK:n.isDark()?this.TRANSPARENT_WHITE:this.TRANSPARENT_BLACK},getStyle:function(e,i,o){return e=e||"",this[e+"StyleService"]||(this[e+"StyleService"]=t.THEMING?n.initializeService("object."+e):r.getInstance()),t.THEMING?this[e+"StyleService"].getStyle(i,o):this[e+"StyleService"].getValue(e,i,o)},getFontSize:function(e,i,o){this[(e=e||"")+"StyleService"]||(this[e+"StyleService"]=t.THEMING?n.initializeService("object."+e):r.getInstance());var s=this[e+"StyleService"];if(t.THEMING)return s.scaleFontSize(s.getStyle(i,"fontSize"),o);var a=s.layoutMap[o]||"medium";return s.getFont(e,i,a,null,null,1).split(" ")[1]}},s=new e(o.LIGHT_GREY),a=new e(o.DARK_GREY);return o}),define("text!objects.views/charts/components/zoom-pan-navigation/zoom-pan-navigation.ng.html",[],function(){return'<div class="qv-zoom-pan-nav" ng-style="navigationStyle">\n\t<div ng-show="navigationHomeOnly && navigationVisible" class="qv-zoom-pan-nav-homeonly">\n\t\t<button class="qv-zoom-pan-nav-home  lui-fade-button  lui-fade-button--large" qva-activate="onHomePressed()" ng-disabled="navigationDefaultPosition || navigationDisabled" q-title-translation="Object.Navigation.ResetZoom">\n\t\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--large  lui-icon--home"></span>\n\t\t\t</button>\n\t</div>\n\t<div ng-show="!navigationHomeOnly && navigationVisible" class="qv-zoom-pan-nav-fullnav">\n\t\t<div class="qv-zoom-pan-nav-top">\n\t\t\t<button class="qv-zoom-pan-nav-up  lui-fade-button  lui-fade-button--large" qva-activate="onNavigationPressed(\'navUp\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanUp">\n\t\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--large  lui-icon--triangle-top"></span>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="qv-zoom-pan-nav-middle">\n\t\t\t<button class="qv-zoom-pan-nav-left  lui-fade-button  lui-fade-button--large" qva-activate="onNavigationPressed(\'navLeft\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanLeft">\n\t\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--large  lui-icon--triangle-left"></span>\n\t\t\t</button>\n\t\t\t<button class="qv-zoom-pan-nav-home  lui-fade-button  lui-fade-button--large" qva-activate="onHomePressed()" ng-disabled="navigationDefaultPosition || navigationDisabled" q-title-translation="Object.Navigation.ResetZoom">\n\t\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--large  lui-icon--home"></span>\n\t\t\t</button>\n\t\t\t<button class="qv-zoom-pan-nav-right  lui-fade-button  lui-fade-button--large" qva-activate="onNavigationPressed(\'navRight\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanRight">\n\t\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--large  lui-icon--triangle-right"></span>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="qv-zoom-pan-nav-bottom">\n\t\t\t<button class="qv-zoom-pan-nav-down  lui-fade-button  lui-fade-button--large" qva-activate="onNavigationPressed(\'navDown\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.PanDown">\n\t\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--large  lui-icon--triangle-bottom"></span>\n\t\t\t</button>\n\t\t\t<button class="qv-zoom-pan-nav-in  lui-fade-button  lui-fade-button--large" qva-activate="onNavigationPressed(\'zoomIn\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.ZoomIn">\n\t\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--large  lui-icon--zoom-in"></span>\n\t\t\t</button>\n\t\t\t<button class="qv-zoom-pan-nav-out  lui-fade-button  lui-fade-button--large" qva-activate="onNavigationPressed(\'zoomOut\')" ng-disabled="navigationDisabled" q-title-translation="Object.Navigation.ZoomOut">\n\t\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--large  lui-icon--zoom-out"></span>\n\t\t\t</button>\n\t\t</div>\n\t</div>\n</div>'}),define("objects.views/charts/components/zoom-pan-navigation/zoom-pan-navigation",["qvangular","text!./zoom-pan-navigation.ng.html"],function(e,t){e.directive("qvaZoomPanNavigation",function(){return{template:t,replace:!0,link:function(e){e.onHomePressed=function(){e.$broadcast("navigationPressed","resetZoom")},e.onNavigationPressed=function(t){e.$broadcast("navigationPressed",t)}}}})}),define("extensions.qliktech/scatterplot/axis-light",["core.utils/class"],function(e){return e.extend("AxisLight",{init:function(e,t,n,i){this._values={min:e,max:t},this._positions={min:n,max:i}},setYMirrorMode:function(e){this.yMirrorMode=e},setValues:function(e){this._values=e},getValues:function(){return this._values},setPositions:function(e){this._positions=e},getPositions:function(){return this._positions},getPositionOfValue:function(e){var t=(e-this._values.min)/(this._values.max-this._values.min),n=this._positions.max-this._positions.min;return this.yMirrorMode?this._positions.max-n*t:this._positions.min+n*t}})}),define("text!extensions.qliktech/scatterplot/directives/mini-map/scatterplot-mini-map.ng.html",[],function(){return'<div class="qv-scatter-mini-map">\n\t<div class="scatter-mini-map"></div>\n\t<div class="scatter-mini-map-focus" ng-style="focusStyle"></div>\n</div>'}),define("extensions.qliktech/scatterplot/directives/mini-map/scatterplot-mini-map",["qvangular","objects.views/charts/renderers/canvas-renderer","extensions.qliktech/scatterplot/axis-light","extensions.qliktech/scatterplot/heat-map-light","text!./scatterplot-mini-map.ng.html","objects.views/charts/shapes/container","touche"],function(e,t,n,i,r,o,s){e.directive("qvaScatterMiniMap",function(){return{template:r,replace:!0,link:function(e,r){function a(t){if(p){var n=v.getPositionOfValue(p.xMin),i=y.getPositionOfValue(p.yMax),r=v.getPositionOfValue(p.xMax)-v.getPositionOfValue(p.xMin),o=y.getPositionOfValue(p.yMin)-y.getPositionOfValue(p.yMax),s=t.width-2,a=t.height-2;n<0?(r+=n,n=0):n>s&&(n=s,r=0),i<0?(o+=i,i=0):i>a&&(i=a,o=0),n+r>s&&(r=s-n),i+o>a&&(o=a-i),o=o>a?a:o,r=r>s?s:r,e.focusStyle={left:n,top:i,width:r,height:o}}}function l(t,n){f=r.offset();var i=e.focusStyle.width,o=e.focusStyle.height,s={x:n.pagePoints[0].x-f.left,y:n.pagePoints[0].y-f.top},a={x:e.focusStyle.left+i/2,y:e.focusStyle.top+o/2},l=(s.x-a.x)/(p.scale*r.width()),c=(s.y-a.y)/(p.scale*r.height());e.$broadcast("navigationPressed","jumpTo",{x:-l*d.width,y:-c*d.height})}function c(){s(r[0]).tap({id:g,end:function(e,t){l(e,t)}});var t;s(r[0]).swipe({id:g,start:function(){f=r.offset();var n=e.focusStyle.width,i=e.focusStyle.height;t={x:e.focusStyle.left+n/2,y:e.focusStyle.top+i/2},e.$broadcast("navigationPressed","startAt",{x:0,y:0})},update:function(n,i){var o={x:i.pagePoints[0].x-f.left,y:i.pagePoints[0].y-f.top},s=(o.x-t.x)/(p.scale*r.width()),a=(o.y-t.y)/(p.scale*r.height());e.$broadcast("navigationPressed","moveTo",{x:-s*d.width,y:-a*d.height}),t=o},end:function(){e.$broadcast("navigationPressed","endAt")}})}function u(){s(r[0]).off("*",g)}var h,d,p,f,m=r.find(".scatter-mini-map"),g=".scatterplot-mini-map",v=new n,y=new n,b=new t(m[0],{name:"overview"}),x=new o;b.stage.addChild(x),(h=new i(b,x)).setXAxis(v),h.setYAxis(y),h.setColorMap(e.colorMap);var q=[];q.push(e.$on("onUpdateMiniMapData",function(e,t){h.setData(t)})),q.push(e.$on("onYMirrorModeChange",function(e,t){h.setYMirrorMode(t),v.setYMirrorMode(t)})),q.push(e.$on("onResizeMiniMap",function(e,t,n){v.setPositions({min:0,max:t.width}),y.setPositions({min:t.height,max:0}),b.setDimensions(0,0,t.width,t.height),a({width:t.width,height:t.height}),d=n,h.draw()})),q.push(e.$on("onUpdateMiniMap",function(e,t){var n=r.width(),i=r.height();v.setValues(t.x),v.setPositions({min:0,max:n}),y.setValues(t.y),y.setPositions({min:i,max:0}),b.setDimensions(0,0,r.width(),r.height()),h.draw()})),q.push(e.$on("onUpdateMiniMapFocus",function(e,t,n,i,o){var s=v.getValues();p={xMin:t,yMin:i,xMax:n,yMax:o,scale:(n-t)/(s.max-s.min)},h.yMirrorMode&&(p.scale=-p.scale),a({width:r.width(),height:r.height()})})),q.push(e.$on("onResetMiniMapFocus",function(){e.focusStyle={left:0,top:0,width:r.width(),height:r.height()}})),q.push(e.$on("onUpdateColorMap",function(){h.setColorMap(e.colorMap)})),e.$on("$destroy",function(){for(u();q.length;)q.pop()();x.removeChildren(),b.release(),h.release(),v=null,y=null,g=null,b=null,x=null,h=null}),e.$watch("interactive",function(e){e?c():u()})}}})}),define("extensions.qliktech/scatterplot/scatterplot",["jquery","core.utils/deferred","translator","objects.views/charts/axis-chart","objects.views/charts/components/chart-component","objects.views/charts/components/ref-line-labels","objects.views/charts/utils/binding","./scatterarea","objects.views/charts/representation/basic-color-map","objects.backend-api/hypercube-api","extensions.qliktech/scatterplot/scatterplot-properties","extensions.qliktech/scatterplot/scatterplot-explore-properties","extensions.qliktech/scatterplot/scatterplot-data","text!./scatterplot.ng.html","objects.utils/event-utils","objects.views/charts/disclaimers/chart-utils","objects.extension/object-conversion","objects.utils/number-formatter","objects.views/charts/utils/pan-zoom-controller","touche","objects.utils/chart-style-utils","general.utils/color","objects.views/charts/components/zoom-pan-navigation/zoom-pan-navigation","extensions.qliktech/scatterplot/directives/mini-map/scatterplot-mini-map"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,x,q){"use strict";function C(){}function S(e){var t,n=[],i=e[0].qMatrix;if(n.push(i[0][0]),e[0].reformatted)for(t=1;t<i.length;t++)try{n.push(i[t][0])}catch(e){}else{for(t=1;t<i.length;t++)try{i[t][0].qText=JSON.parse(i[t][0].qText),n.push(i[t][0])}catch(e){}e[0].reformatted=!0}return[n]}function w(){var e=this.selections&&this.selections.getActiveType();e&&!/^item/.test(e.getActiveMode())&&e.clearSelection(),this.selections&&this.selections.enabled&&(this._selectionsOffDuringPanZoom=!0,this.selections.enabled=!1),this.tooltips&&(this.tooltips.clearSelection(),this.tooltips.enabled=!1)}function _(){this._selectionsOffDuringPanZoom&&(this._selectionsOffDuringPanZoom=!1,this.selections&&(this.selections.enabled=!0),this.tooltips&&(this.tooltips.enabled=!0))}function D(e,t,n){return void 0===n&&(n=0),0===e?Math.abs(t)<=n:Math.abs(t/e-1)<=n}function M(e,t,n,i,r){void 0===r&&(r=0);var o=Math.abs(t-e)*r;return Math.abs(n-e)<=o&&Math.abs(i-t)<=o}function A(e,t,n,i,r,o,s){return this._axisInfoAtHomeState&&M(this._axisInfoAtHomeState.x.min,this._axisInfoAtHomeState.x.max,e,t,s)&&M(this._axisInfoAtHomeState.y.min,this._axisInfoAtHomeState.y.max,n,i,s)&&(void 0===r||void 0===o||D(this._axisInfoAtHomeState.x.size,r,s)&&D(this._axisInfoAtHomeState.y.size,o,s))}function E(){var e=this.components.xAxis,t=this.components.yAxis;if(this._isHomeState=A.call(this,e.getPlotMin(),e.getPlotMax(),t.getPlotMin(),t.getPlotMax(),e.getPlotSize(),t.getPlotSize(),te),this.rect&&this._data){var n=this.rect.width>=400&&this.rect.height>=400,i=this._layoutMode>=3,r=this.inAnalysisState()||this.inEditState(),o=this._data.navigation?i&&!n:i,s=this._navigation&&(!this._isHomeState||r&&i&&!!this._data.navigation),a=this;this.$scope.navigationHomeOnly=o,this.$scope.navigationVisible=s,this.$scope.navigationDefaultPosition=this._isHomeState,this.yMirrorMode?this.$scope.navigationStyle={top:this.components.dataArea.rect.y+5+"px",left:this.components.dataArea.rect.x+17+"px"}:this.$scope.navigationStyle={top:this.components.dataArea.rect.y+5+"px",right:this.rect.width-this.components.dataArea.rect.x-this.components.dataArea.rect.width+5+"px"},setTimeout(function(){a.$scope.$apply()})}}function I(){var e=this.components.dataArea,t=e._xAxis,n=e._yAxis;this._axisInfo.x.min=!this._data.xAxis.autoMinMax&&["min","minMax"].contains(this._data.xAxis.minMax)?Number(this._data.xAxis.min):null,this._axisInfo.x.max=!this._data.xAxis.autoMinMax&&["max","minMax"].contains(this._data.xAxis.minMax)?Number(this._data.xAxis.max):null,this._axisInfo.y.min=!this._data.yAxis.autoMinMax&&["min","minMax"].contains(this._data.yAxis.minMax)?Number(this._data.yAxis.min):null,this._axisInfo.y.max=!this._data.yAxis.autoMinMax&&["max","minMax"].contains(this._data.yAxis.minMax)?Number(this._data.yAxis.max):null,t.setPlotMin(this._axisInfo.x.min),t.setPlotMax(this._axisInfo.x.max),n.setPlotMin(this._axisInfo.y.min),n.setPlotMax(this._axisInfo.y.max)}function T(){var e=this.components.dataArea,t=e._xAxis,n=e._yAxis;this._axisInfoAtHomeState={x:{size:t.getPlotSize(),max:t.getPlotMax(),min:t.getPlotMin()},y:{size:n.getPlotSize(),max:n.getPlotMax(),min:n.getPlotMin()}}}function L(){this.$scope.navigationDisabled=this.navigationDisabled||this._disabledPanZoom}function k(e){this._disabledPanZoom=e,this.$scope&&L.call(this)}function O(){if(!this._disabledPanZoom){var e=this.components.dataArea,t=e._xAxis,n=e._yAxis,i=this;w.call(this),t.setUseTransition(this._oldUseTransition),n.setUseTransition(this._oldUseTransition),I.call(this),this._axisInfoAtHomeStateNeedToUpdate=!0,this._isHomeState=!0,C.call(this),this._paint(),setTimeout(function(){i._debouncedUpdateLayout.call(i),i.$scope.$emit("onResetMiniMapFocus"),i.$scope.showMiniMap=!1},1e3)}}function P(){this._disabledPanZoom||(this._cancelDebounce(this),this._inPanZoom=!0,this._axisInfoAtHomeStateNeedToUpdate&&T.call(this),this._axisInfoAtHomeStateNeedToUpdate=!1,this.components.xAxis.setUseTransition(!1),this.components.yAxis.setUseTransition(!1),w.call(this))}function N(e,t){if(!this._disabledPanZoom){var n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,v=this,y=this.components.xAxis,b=this.components.yAxis;this._isHomeState&&this._needUpdateMiniMap&&U.call(this),e.identityIfClose(ee),this._plotMaxMinNeedToUpdate&&(this._xAxisMin=y.getPlotMin(),this._xAxisMax=y.getPlotMax(),this._yAxisMin=b.getPlotMin(),this._yAxisMax=b.getPlotMax(),this._plotMaxMinNeedToUpdate=!1),m=y.getPlotSize(),g=b.getPlotSize(),this.yMirrorMode?(i={x:m,y:g},r={x:0,y:0}):(i={x:0,y:g},r={x:m,y:0}),o=e.transformPoint(i),a=(s=e.transformPoint(r)).x-o.x,l=s.y-o.y,c=this._xAxisMax-this._xAxisMin,u=this._yAxisMax-this._yAxisMin,h=this._xAxisMin-o.x/a*c,d=this._xAxisMin+(m-o.x)/a*c,p=this._yAxisMax-(s.y-g)/l*u,f=this._yAxisMax-s.y/l*u,t&&this._axisInfoAtHomeState&&A.call(this,h,d,p,f,void 0,void 0,ne)&&(h=this._axisInfoAtHomeState.x.min,d=this._axisInfoAtHomeState.x.max,p=this._axisInfoAtHomeState.y.min,f=this._axisInfoAtHomeState.y.max),y.setPlotMin(h),y.setPlotMax(d),b.setPlotMin(p),b.setPlotMax(f),this.components.dataArea.clearSelection(),this.components.dataArea.getIsReduced()&&this.components.dataArea.renderers.heat.transformScene(e),v.$scope.$emit("onUpdateMiniMapFocus",h,d,p,f);for(n in this.components)"dataArea"===n&&this.components.dataArea.getIsReduced()||this.components[n].invalidateDisplay();E.call(this)}}function R(){this._disabledPanZoom||(this._inPanZoom=!1,this._debouncedUpdateLayout())}function F(){var e=this._panZoomController._viewportProjection.getTransformMatrix();if(!e.isIdentity()){var t=this._xAxisOldSize,n=this._yAxisOldSize;if(t&&n){var i=this.components.xAxis,r=this.components.yAxis,o=i.getPlotSize(),s=r.getPlotSize();if(t!==o||n!==s){var a,l,c,u;this.yMirrorMode?(a=this._xAxisMax,l=this._xAxisMin,c=i.getPlotMax(),u=i.getPlotMin()):(a=this._xAxisMin,l=this._xAxisMax,c=i.getPlotMin(),u=i.getPlotMax());var h=this._yAxisMin,d=this._yAxisMax,p=r.getPlotMin(),f=r.getPlotMax(),m=e.clone(),g=e.clone(),v=l-a,y=d-h,b=u-c,x=f-p;m.set([[o/v,0,-o*a/v],[0,-s/y,s*d/y],[0,0,1]]),g.set([[o/b,0,-o*c/b],[0,-s/x,s*f/x],[0,0,1]]),m.invert(),(e=g.multiply(m)).identityIfClose(ee),this._panZoomController._viewportProjection.setTransformMatrix(e),this._panZoomController.reset()}}}}function j(){this._plotMaxMinNeedToUpdate=!0;var e=this._panZoomController._viewportProjection;e.setTransformMatrix(e.getTransformMatrix().identity())}function V(e,i,r,o,s){if(!this._inPanZoom){var a=t();if(this._ready=a.promise,!this._data||isNaN(e)||isNaN(i)||isNaN(r)||isNaN(o))return this._fetchedData=!0,this.$scope.throbberApi.hide(),t.resolve();var l=this,c=this._data.compressionResolution?this._data.compressionResolution:Z,u=s?s-1:0,h=Math.min(c+u,J),d=function(){return l._fetchedData=!0,l.prePaint(l._data),t.all([l._updateData(l._data)]).then(function(){a.resolve(),l.$scope.throbberApi.hide(),l.backendApi.isSnapshot&&(l._isBigData=!!l._data.dataPages&&l._data.dataPages.length>0&&l._data.dataPages[0].qMatrix.length>0,l.components.dataArea.setIsBigData(l._isBigData))})};return this.backendApi.getHyperCubeBinnedData(void 0===l._data?void 0:[{qTop:0,qLeft:0,qWidth:l._data.qHyperCube.qSize.qcx,qHeight:l._data.qHyperCube.qSize.qcy}],[{qLeft:e,qTop:i,qWidth:r,qHeight:o}],1e3,h).then(function(e){if(!l._inPanZoom){if(!l._data||!e||l._destroyed)return l._fetchedData=!0,void l.$scope.throbberApi.hide();if(j.call(l),l.components.dataArea.setIsBigData(!0),e[0].qMatrix.length>0){l._isReduced=!0,l._data.qHyperCube.isReduced=!0;var t=S([e[0]]);l.components.dataArea.setHeatMapData(t),l._heatMapData=l.components.dataArea.getHeatMapData(),l._heatColorMap.setMaxMin(t[0][0].qNum,0),l._needUpdateMiniMap&&l.$scope.$emit("onUpdateMiniMapData",t),l.components.dataArea.setIsReduced(!0),l.$scope.reducedDataNote=n.get("properties.compression.providingOverviewOf",[l._numberFormatter.format(l._data.qHyperCube.qSize.qcy,l._defaultPattern)])}else l._isReduced=!1,l._data.qHyperCube.isReduced=!1,l._data.qHyperCube.qDataPages=[e[1]],l.components.dataArea.setIsReduced(!1);return d()}})}}function H(){this._layoutMode<=3?this.$scope.miniMapStyle={display:"none"}:this.$scope.miniMapStyle={display:"block",left:this.yMirrorMode?this.components.dataArea.rect.x+10:this.components.dataArea.rect.x+.85*this.components.dataArea.rect.width-10,top:this.components.dataArea.rect.y+.85*this.components.dataArea.rect.height-10,width:.15*this.components.dataArea.rect.width,height:.15*this.components.dataArea.rect.height}}function B(){this.$scope.showMiniMap=!(!this._isBigData||this._isHomeState||this.components.xAxis.getPlotMin()<=this._resettedAxisInfo.x.min&&this.components.xAxis.getPlotMax()>=this._resettedAxisInfo.x.max&&this.components.yAxis.getPlotMin()<=this._resettedAxisInfo.y.min&&this.components.yAxis.getPlotMax()>=this._resettedAxisInfo.y.max)}function z(){var e=this.components.dataArea.rect.width,t=this.components.dataArea.rect.height;H.call(this),B.call(this),this.$scope.$emit("onResizeMiniMap",this.$scope.miniMapStyle,{width:e,height:t})}function $(){var e=x.Theme.dataColors.primaryColor,t=new q(e).toHSVComponents(),i=new q("hsv("+t.h+","+t.s+",20)"),r={colors:[new q("hsv("+t.h+","+t.s+",80)"),i],limits:[{value:.5,gradient:!0}],min:0,max:1};this._heatColorMap=new l(r),this.$scope.colorMap=this._heatColorMap,this.$scope.$emit("onUpdateColorMap"),this._heatColorMap.setLegendTitle(n.get("properties.compression.density")),this.components.dataArea&&this.components.dataArea.setHeatColorMap(this._heatColorMap)}function U(){this._resettedAxisInfo.x.min=this.components.xAxis.getPlotMin(),this._resettedAxisInfo.x.max=this.components.xAxis.getPlotMax(),this._resettedAxisInfo.y.min=this.components.yAxis.getPlotMin(),this._resettedAxisInfo.y.max=this.components.yAxis.getPlotMax(),this.$scope.$emit("onUpdateMiniMap",this._resettedAxisInfo),this.$scope.showMiniMap=!1,this._needUpdateMiniMap=!1}function G(e,t){if(0===e.length)return[];var n,i,r,o,s,a,l,c,u=e.length,h=[],d=0;for(s=t+"Min",a=t+"Max",l=(o="x"===t?"y":"x")+"Min",c=o+"Max",e.sort(function(e,t){return e[s]>t[s]?1:e[s]!==t[s]?-1:e[s]===t[s]?e[l]-t[l]:void 0}),n=e[0],h[d]=i={xMin:n.xMin,xMax:n.xMax,yMin:n.yMin,yMax:n.yMax},r=1;r<u;r++)n=e[r],i[s]===n[s]&&i[a]===n[a]&&i[c]===n[l]?i[c]=n[c]:h[++d]=i={xMin:n.xMin,xMax:n.xMax,yMin:n.yMin,yMax:n.yMax};return h}function W(e){var t,n,i,r,o,s,a,l,c,u,h,d=e?e.length:0,p=new Array(d),f=[];for(t=0;t<d;t++)n=this._heatMapData[e[t]].qText,i=Math.min(n[0],n[2]),o=Math.min(n[1],n[3]),r=Math.max(n[0],n[2]),s=Math.max(n[1],n[3]),p[t]={xMin:i,xMax:r,yMin:o,yMax:s};for(c=G(G(p,"x"),"y"),u=G(G(p,"y"),"x"),d=(h=c.length>u.length?u:c).length,t=0;t<d;t++)a={idx:0,range:{max:(n=h[t]).xMax,min:n.xMin},type:"measure"},l={idx:1,range:{max:n.yMax,min:n.yMin},type:"measure"},f[t]=[a,l];return f}function X(){var e=this.components.dataArea._cacheItems.filter(function(e){return e.selected}).map(function(e){return e.row}),t=W.call(this,e);t&&0!==t.length?(Y.call(this,t),k.call(this,!0)):(this.backendApi.clearSelections(),k.call(this,!1))}function Y(e){var t=this;this.backendApi.selectRects(e,!1).then(function(e){e||(t.backendApi.clearSelections(),K.call(t,!1))})}function K(){this.components.dataArea.getIsReduced()&&this.components.dataArea.clearSelection(),k.call(this,!1)}var Q,Z=6,J=8,ee=1e-9,te=1e-5,ne=1e-4;return Q=i.extend("ScatterPlot",{init:function(t,n,i,l,c){var u=this;i=e.extend(!0,i||{},{providers:{colorMap:{autoMode:"primary"}},components:{refLines:{sortKey:5,show:!0,dock:"center",showFlag:r.prototype.ShowFlags.SPARK},dataArea:{sortKey:10,show:!0,dock:"center",clazz:a,showFlag:r.prototype.ShowFlags.SPARK},grid:{showFlag:r.prototype.ShowFlags.XSMALL},refLineLabelsX:{show:!0,dock:"top",order:3,showFlag:r.prototype.ShowFlags.XSMALL,clazz:o},refLineLabelsY:{show:!0,dock:"right",order:3,showFlag:r.prototype.ShowFlags.XSMALL,clazz:o}}}),this._resettedAxisInfo={x:{min:0,max:0},y:{min:0,max:0}},this._axisInfo={x:{min:null,max:null},y:{min:null,max:null}},this._super(t,n,i,l,c),this.backendApi.setCacheOptions({enabled:!1}),this._numberFormatter=new v,this._defaultPattern="#.#A",this._oldUseTransition=this.components.xAxis.getUseTransition(),this.components.dataArea.setYAxis(this.components.yAxis),this.components.dataArea.setXAxis(this.components.xAxis),this.components.xAxisTitle.setType("measure"),this.components.yAxisTitle.setType("measure"),this.components.xAxisTitle.setModel(t.ext.model),this.components.yAxisTitle.setModel(t.ext.model),this.components.yAxis.setShowExplicitMinMax(!1),this.components.xAxis.setShowExplicitMinMax(!1),this.components.grid.setAxes(this.components.xAxis,this.components.yAxis),this.providers.colorMap.getLegendDataProvider().setLegendMarker("circle"),this.createHeatColorMap=$.bind(this),this.createHeatColorMap(),x.Theme.ThemeChanged.bind(this.createHeatColorMap),this.components.xAxis.getTransitionHelper().setTransitionTime(700),this.components.yAxis.getTransitionHelper().setTransitionTime(700),this.components.dataArea.getTransitionHelper().setTransitionTime(700),this._changeWatchers.push(s.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(s.bindProperty(this.providers.colorMap,"dimensionTree",this._chartContext,"dimensionTree")),this._panZoomController=new y(e(this.components.dataArea.container),{start:function(){P.call(u)},update:function(e){N.call(u,e)},end:function(e){N.call(u,e,!0),R.call(u)},reset:function(){O.call(u)}}),this._panZoomController.setZoomPanByWebkitTransform(!1),this._debouncedUpdateLayout=f.debounce(function(){if(!this._inPanZoom){var e=this.isBigData(this._data)&&!this.backendApi.isSnapshot,t=this.components.xAxis.getPlotMin(),n=this.components.xAxis.getPlotMax(),i=this.components.yAxis.getPlotMin(),r=this.components.yAxis.getPlotMax(),o=Math.floor(Math.sqrt((this._data.qHyperCube.qMeasureInfo[1].qMax-this._data.qHyperCube.qMeasureInfo[1].qMin)/(r-i)));e?(this._dataUpdatedOnPanOrZoom=!0,V.call(this,t,r,n-t,r-i,o).then(this._paintWithTransition.bind(this))):this._paintWithTransition.call(this)}},400,this),this._cancelDebounce=f.cancelDebounce,this.onNavigationPressed=t.$on("navigationPressed",function(e,t,n){e.preventDefault(),!u._disabledPanZoom&&u._panZoomController.navigate(t,n)}),this.navigationDisabled=!0,L.call(this)},_paintWithTransition:function(){C.call(this),this._paint().then(function(){this.components.xAxis.setUseTransition(this._oldUseTransition),this.components.yAxis.setUseTransition(this._oldUseTransition)}.bind(this))},getVerticalComponents:function(){var e=this._super();return this.components&&this.components.refLineLabelsY&&this._data&&this._data.yAxis&&e.push({comp:this.components.refLineLabelsY,dock:"far"===this._data.yAxis.dock?"near":"far"}),e},setYMirrorMode:function(e){this.yMirrorMode!==e&&(this._super(e),this.$scope.$emit("onYMirrorModeChange",e),this.updateVerticalComponentsDock())},initSelections:function(){var e=this,t=this.components.dataArea;this.selections._disableSelections=this.options._disableSelections,this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend),this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.options._disableSelections||(this.selections.types.range.setComponent("dataArea",this.components.dataArea),this.selections.types.range.setComponent("x",this.components.xAxis),this.selections.types.range.setComponent("y",this.components.yAxis),this.selections.Activated.bind(function(){t.getIsReduced()&&t.copyHeatMap(),e._inSelectionMode=!0,e.onSelection.Activated.call(e)}),this.selections.Deactivated.bind(function(){e._inSelectionMode=!1,e.onSelection.Deactivated.call(e)}),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Select.bind(this.Select.bind(this)),this.selections.SelectRange.bind(e.onSelection.SelectRange.bind(this)),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Confirm.bind(this.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.Clear.bind(this.Clear.bind(this)),this.selections.SelectAttributeDim.bind(this.onSelection.SelectAttributeDim.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)),this.selections.ResetSelections.bind(function(){t.getIsReduced()&&t.clearSelection()}))},initTooltips:function(){this.tooltips.setComponent("dataArea",this.components.dataArea)},Select:function(e,t){this._isReduced?X.call(this,e):this.onSelection.Select.apply(this,[e,t,0,"",this.isBigData(this._data)])},Clear:function(){this.onSelection.Clear.call(this),K.call(this)},Confirm:function(){this.onSelection.Confirm.call(this),K.call(this)},_paint:function(){var n=this;return this._super().then(function(i){if(!i||!i.invalid)return n._ready.then(function(){if(n._destroyed)return t.resolve();var i,r=[];this.components.dataArea&&(this._offset=e(this.components.dataArea.container).offset());var o=this.components.xAxis,s=this.components.yAxis;this._xAxisOldSize=o?o.getPlotSize():void 0,this._yAxisOldSize=s?s.getPlotSize():void 0,this.layout(),this.components.dataArea&&this._panZoomController.setOffset(e(this.components.dataArea.container).offset());for(i in this.components)r.push(this.components[i].invalidateDisplay());return this._axisInfoAtHomeStateNeedToUpdate&&T.call(this),E.call(this),F.call(this),z.call(this),_.call(this),t.all(r)}.bind(this))}.bind(this))},on:function(){if(!this._on&&(this._super(),this._navigation)){if(E.call(this),this.supressDotRendering)return void(this.selections&&this.selections.off());this._panZoomController.on(".scatterplot"),this.$scope.interactive=!0,this.navigationDisabled=!1,L.call(this)}},off:function(){this.navigationDisabled=!0,L.call(this),this.$scope.interactive=!1,this._on&&(this._navigation&&(E.call(this),this._panZoomController.off(),b(this.components.dataArea.container).off("*",".scatterplot"),b(this.container).off("*",".scatterplot"),e(this.components.dataArea.container).off(".scatterplot"),e(this.container).off(".scatterplot")),this._super())},isValid:function(e){return this._super(e)&&e.qHyperCube.qMeasureInfo.length>=2&&!this.supressChartRendering},resize:function(){var e=new t,n=this;return this._isHomeState&&!this.backendApi.isSnapshot&&(I.call(this),this._axisInfoAtHomeStateNeedToUpdate=!0),this._super().then(function(){n.rect&&C.call(n),e.resolve()}),e.promise},prePaint:function(e){this._super(e),this.$scope.dataAttributes.limitedData=this.isBigData(e),this.$scope.dataAttributes.reduceDataDisc=this.$scope.dataAttributes.limitedData,m.applyDisclaimerAttributes({title:!1,bottom:!0,overlay:!1,explicitLimitedData:this.$scope.dataAttributes.limitedData,direction:this.$scope.options.direction},this.$scope.dataAttributes,this.$element,this.$scope,e),this.$scope.dataAttributes.noDataExist||(this.$scope.dataAttributes.onlyNanData=e.qHyperCube.qMeasureInfo.slice(0,2).some(function(e){return e.qMax<e.qMin||"NaN"===e.qMax})),this.supressChartRendering=this.$scope.dataAttributes.onlyNanData||this.$scope.dataAttributes.noDataExist,this.supressDotRendering=this.supressChartRendering},setInteractionState:function(e,t){this._super(e,t),this._oldUseTransition=this.components.xAxis.getUseTransition()},_updateHyperCube:function(e){var n,i=[];return this._dataUpdatedOnPanOrZoom||(this._isHomeState=!0),this.providers.colorMap.setData(e).then(function(){i.push(this.components.dataArea.setData(e)),i.push(this.components.colorLegend.setData(e)),i.push(this.components.xAxisTitle.setData([{label:e.qHyperCube.qMeasureInfo[0].qFallbackTitle,index:0}])),i.push(this.components.yAxisTitle.setData([{label:e.qHyperCube.qMeasureInfo[1].qFallbackTitle,index:1}])),n=this.getSnapshotStoredChartData();var r=this.options.viewState;return this._readStoredData&&n?(this.components.xAxis.setPlotMin(n.xAxisMin),this.components.xAxis.setPlotMax(n.xAxisMax),this.components.yAxis.setPlotMin(n.yAxisMin),this.components.yAxis.setPlotMax(n.yAxisMax)):r&&(this.components.xAxis.setPlotMin(r.xAxisMin),this.components.xAxis.setPlotMax(r.xAxisMax),this.components.yAxis.setPlotMin(r.yAxisMin),this.components.yAxis.setPlotMax(r.yAxisMax)),e.legend&&this.components.colorLegend[(this.supressDotRendering||!e.legend.auto&&!e.legend.show?"hide":"show")+"Component"](),t.all(i)}.bind(this))},isBigData:function(e){return e.qHyperCube.qSize.qcy>1e3},_preUpdateData:function(e){if(this.providers.colorMap)return this._readStoredData?this.providers.colorMap.setSnapshotChartData(e.snapshotData.content.chartData):this.providers.colorMap.setSnapshotChartData(),t.resolve(e)},_updateData:function(e){var n,i=this;this._data=e;var r=this.selectionsCache.getSelectedValuesInColumn(0).slice();if(this._fetchedData)return n={axes:{xAxis:{component:this.components.xAxis,data:e.xAxis,title:"",dataIndices:[0]},yAxis:{component:this.components.yAxis,data:e.yAxis,title:"",dataIndices:[1]}},refLineLabels:{x:{axis:this.components.xAxis,data:e.refLine?e.refLine.refLinesX:"",component:this.components.refLineLabelsX},y:{axis:this.components.yAxis,data:e.refLine?e.refLine.refLinesY:"",component:this.components.refLineLabelsY}},axisTitles:{xAxisTitle:{component:this.components.xAxisTitle},yAxisTitle:{component:this.components.yAxisTitle}},refLines:{component:this.components.refLines}},this._super(e,n),r&&this.selectionsCache.setValues(r),this._fetchedData=!1,this.components.colorLegend.setColorMap(this._isReduced?this._heatColorMap:this.providers.colorMap),this._updateHyperCube(e);if(this._dataUpdatedOnPanOrZoom=!1,this._axisInfoAtHomeStateNeedToUpdate=!0,this._isBigData=this.isBigData(e),this._needUpdateMiniMap=!0,this._isBigData){var o=e.xAxis.autoMinMax||"min"!==e.xAxis.minMax&&"minMax"!==e.xAxis.minMax?e.qHyperCube.qMeasureInfo[0].qMin:e.xAxis.min,s=e.xAxis.autoMinMax||"max"!==e.xAxis.minMax&&"minMax"!==e.xAxis.minMax?e.qHyperCube.qMeasureInfo[0].qMax:e.xAxis.max,a=e.yAxis.autoMinMax||"min"!==e.yAxis.minMax&&"minMax"!==e.yAxis.minMax?e.qHyperCube.qMeasureInfo[1].qMin:e.yAxis.min,l=e.yAxis.autoMinMax||"max"!==e.yAxis.minMax&&"minMax"!==e.yAxis.minMax?e.qHyperCube.qMeasureInfo[1].qMax:e.yAxis.max;this.$scope.throbberApi.show(),V.call(this,o,l,s-o,l-a)}else{var c=t();this._ready=c.promise,this._isReduced=!1,e.qHyperCube.isReduced=!1,this.backendApi.getData([{qTop:0,qLeft:0,qWidth:e.qHyperCube.qSize.qcx,qHeight:1e3}]).then(function(e){if(i._destroyed)return c.resolve();i._data.qHyperCube.qDataPages=e,i._fetchedData=!0,i.components.dataArea.setIsBigData(!1),i.components.dataArea.setIsReduced(!1),j.call(i),i.prePaint(i._data),t.all([i._updateData(i._data)]).then(function(){c.resolve()})})}return this._ready},updateDataArea:function(e,t){this._super(e,t),e.qHyperCube.qMeasureInfo.length>2&&e.dataPoint.rangeBubbleSizes?e.dataPoint.rangeBubbleSizes.length>0&&(this.components.dataArea.setMinDotSize(e.dataPoint.rangeBubbleSizes[0]),e.dataPoint.rangeBubbleSizes.length>1&&this.components.dataArea.setMaxDotSize(e.dataPoint.rangeBubbleSizes[1])):e.dataPoint.bubbleSizes&&this.components.dataArea.setMinDotSize(e.dataPoint.bubbleSizes),null!==e.labels.mode&&this.components.dataArea.setLabelMode(e.labels.mode),this.components.dataArea.setRenderData(!this.supressDotRendering),this.supressDotRendering?(this.selections&&this.selections.off(),this._on&&this.off()):!this.supressDotRendering&&this.isDataSelectable(e)&&(this.selections&&this.selections.on(),this._on||this.inEditState()||this.on())},updateAxis:function(t,n){if(!this._dataUpdatedOnPanOrZoom){e.extend(n.axisTitles.xAxisTitle,{data:t.xAxis}),e.extend(n.axisTitles.yAxisTitle,{data:t.yAxis}),this._super(t,n);var i,r,o,s,a,l,c,u,h=0;for(s in n.axes)o=(i=n.axes[s]).dataIndices[0],r=i.component,a=t.qHyperCube.qMeasureInfo[o].qMin,l=t.qHyperCube.qMeasureInfo[o].qMax,c=!i.data.autoMinMax&&["min","minMax"].contains(i.data.minMax)?Number(i.data.min):null,u=!i.data.autoMinMax&&["max","minMax"].contains(i.data.minMax)?Number(i.data.max):null,l<a?(l=10,a=-10):a===l&&0===l||isNaN(a)&&isNaN(l)?(l=10,a=-10):h=Math.abs(l!==a?.02*(l-a):.1*l),this.setAxisDataRange(r,Math.max(a,l+h),a-h,u,c,h)}},updateRefLines:function(e,t){this._super(e,t);for(var n in t.refLineLabels)t.refLineLabels[n].component.setLabelMargin(10)},toggleCacheItem:function(e){this.components.dataArea.toggleCacheItem(e),this.components.colorLegend.invalidateDisplay("ScatterPlot#toggleCacheItem")},getSnapshotData:function(e,t,n,i,r,o){var s=this._data&&this._data.compressionResolution?this._data.compressionResolution:Z,a=o?o-1:0;return this.backendApi.getHyperCubeBinnedData([{qTop:0,qLeft:0,qWidth:e.qHyperCube.qSize.qcx,qHeight:e.qHyperCube.qSize.qcy}],[{qLeft:t,qTop:n,qWidth:i,qHeight:r}],1e3,Math.min(s+a,J)).then(function(t){e.dataPages=t,e.foo="custom"})},setSnapshotData:function(e){if(this._super(e),!this._isReduced&&!this.isBigData(e))return t.resolve();var n=this.components.xAxis.getPlotMin(),i=this.components.xAxis.getPlotMax(),r=this.components.yAxis.getPlotMin(),o=this.components.yAxis.getPlotMax(),s=Math.floor(Math.sqrt((this._data.qHyperCube.qMeasureInfo[1].qMax-this._data.qHyperCube.qMeasureInfo[1].qMin)/(o-r)));return this.getSnapshotData(e,n,o,i-n,o-r,s)},getSnapshotChartData:function(){return e.extend(!0,this._super()||{},{xAxisMin:this.components.xAxis.getPlotMin(),xAxisMax:this.components.xAxis.getPlotMax(),yAxisMin:this.components.yAxis.getPlotMin(),yAxisMax:this.components.yAxis.getPlotMax()})},getViewState:function(){return{xAxisMin:this.components.xAxis.getPlotMin(),xAxisMax:this.components.xAxis.getPlotMax(),yAxisMin:this.components.yAxis.getPlotMin(),yAxisMax:this.components.yAxis.getPlotMax()}},getPreferredSize:function(){return this._super()},clear:function(){return this.$scope.navigationVisible=!1,this._super()},destroy:function(){this._super(),this.onNavigationPressed(),this._panZoomController.release(),x.Theme.ThemeChanged.unbind(this.createHeatColorMap),this._destroyed=!0}}),{type:"scatterplot",BackendApi:c,template:p,View:Q,definition:u,softDefinition:h,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qSuppressMissing:!0}},data:d,support:{cssScaling:!1,snapshot:!0,export:!0,exportData:!0,sharing:!0,viewData:!0},options:{selections:{dataArea:{},range:{},colorLegend:{}},tooltips:{}},importProperties:g.colorChart.importProperties.bind(g),exportProperties:g.colorChart.exportProperties.bind(g)}}),define("extensions.qliktech/linechart/line-objects-model",["core.utils/class","util"],function(e,t){function n(e,t,n,i){return n<e||i>t}function i(e){return e.color.byMeasureDef&&e.color.byMeasureDef.activeMeasureIndex>=0&&1===e.qHyperCube.qMeasureInfo.length}var r={LINE:"line",AREA:"area",STACKED:"stackedArea"},o={GAP:"gap",CONNECT:"connect",ZERO:"zero"};return e.extend("LineObjectsModel",{init:function(){this._lineObjectSettings=[]},update:function(e,n){this._updateLineObjectsSettings(e,t.extend({selections:this._getSelected(e,n.numDimensions)},n))},getLineObjectsSettings:function(){return this._lineObjectSettings},getPointsOutOfRange:function(){return this._outOfRange.points},_updateLineObjectsSettings:function(e,n){var i,r,o,s,a,l,c,u=e?e.length:0;for(this._outOfRange={up:{},down:{},points:[]},this._lineObjectSettings=[],i=0;i<u;i++)r=e[i],o=n.minorAxes[n.measureToAxisIndex[r.measureIdx]],s=n.axesSettings[n.measureToAxisIndex[r.measureIdx]],a=this._getColorSettings(n.colorMap,s,o),l=[],this._updateLinePoints(e[i].points,l,this._outOfRange,t.extend({majorAxis:n.majorAxis,minorAxis:o,measureIdx:r.measureIdx,axisSettings:s,isLineSelected:n.selections.lines.indexOf(i)>=0},n)),c=t.extend({info:e.info,colors:a,clippings:this._getClippings(o,n.rect),idx:e.idx,points:l},n),this._lineObjectSettings.push(c)},_updateLinePoints:function(e,t,i,s){var a,l,c,u,h,d,p,f,m,g,v,y,b,x=s.style.line.width%2==0?0:.5,q=e?e.length:0,C=1===q,S=s.yMirrorMode,w=s.rect.width,_=s.rect.height;for(p=0,l=0;l<q;l++)if(e[l]&&(a=e[l],c=a.idx,u={x:s.isNumeric?s.numericAxis.getPositionOfValue(a.dimValue):s.majorAxis.getPositionOfValue(c,0),y:s.minorAxis.zeroPos},(h=a.cacheCircle)&&(h.cx=u.x,h.cy=u.y),!C||!(u.x<0||u.x>w))){if(a.isNaN&&!a.hasRightNeighbour&&"number"!=typeof a.nearestRightNeighbour)break;if(a.isNaN&&s.lineType===r.STACKED&&s.nullMode===o.CONNECT&&!0!==a.isInterpolationOffset);else if(a.isNaN&&!0!==a.isInterpolationOffset){t.push(!1);continue}if(f=a.hasRightNeighbour?e[l+1].idx:a.nearestRightNeighbour,d=void 0!==f?s.isNumeric?e[f]?s.numericAxis.getPositionOfValue(e[f].dimValue):NaN:s.majorAxis.getPositionOfValue(f,0):NaN,!S&&n(0,w,d,p)||S&&n(0,w,p,d))t.push(!1);else{var D=!(m=a.cacheItem&&a.cacheItem.selected)&&s.isLineSelected&&s.selections.synqronize&&this._isSelectedIndirectly(c,s.selections.lines,s.selections.points),M=s.minorAxis.getPositionOfValue(a.aggregated.end);u.y=Math.floor(M)-x,u.y<-1e5&&(u.y=-1e5),u.y>_+1e5&&(u.y=_+1e5),h&&(h.r=Math.max(s.style.dataPoints.size.normal/2,8),h.cy=Math.max(s.axisSettings.topCutoff,Math.min(s.axisSettings.bottomCutoff,u.y))),a.isNaN||(p=u.x),g=a.cacheItem&&(a.cacheItem.parent?[a.cacheItem.parent.id,a.cacheItem.id]:a.cacheItem.id),v=s.colorMap.getColor(g,a.aggregated.end,s.measureIdx,a.rowIndex).toRGBA(),C?b=!0:(b=!a.hasLeftNeighbour&&!a.hasRightNeighbour&&s.nullMode===o.GAP)&&s.isNumeric&&(b=(0==l||e[l-1])&&(l===q-1||e[l+1])),((y={size:m?s.style.dataPoints.size.selected:s.style.dataPoints.size.normal,selected:m||D,selectedIndirectly:D,text:a.cacheItem?a.cacheItem.getDimensions()[0]:"",measureIdx:a.measureIdx,label:a.label,value:a.aggregated.end,isNaN:a.isNaN,isInterpolationOffset:a.isInterpolationOffset,color:v,outOfRangeUp:M<s.axisSettings.topCutoff,outOfRangeDown:M>s.axisSettings.bottomCutoff,outOfDimensionBounds:u.x<0||u.x>w,outOfBounds:u.x<0||u.x>w||a.aggregated.end>s.axisSettings.plotMax||a.aggregated.end<s.axisSettings.plotMin,dataIndex:c,isSingle:b,hidden:a.hidePoint,x:u.x,y:u.y,y1:0===a.aggregated.start?s.axisSettings.areaStartBase:s.minorAxis.getPositionOfValue(a.aggregated.start),cacheItem:a.cacheItem,isNull:a.cacheItem&&-2===a.cacheItem.id}).outOfRangeUp||y.outOfRangeDown)&&(y.outOfRangeUp&&!i.up[y.x]?(i.points.push(y),i.up[y.x]=!0):y.outOfRangeDown&&!i.down[y.x]&&(i.points.push(y),i.down[y.x]=!0)),t[c]=y}}},_getSelected:function(e,t){var n,i,r,o=[],s=[],a=e.length;if(t)for(n=0;n<a;n++)for(r=e[n].points,i=0;i<r.length;i++)r[i]&&r[i].cacheItem&&r[i].cacheItem.selected&&(-1===o.indexOf(n)?(o.push(n),s[n]=[r[i].idx]):s[n].push(r[i].idx));return{lines:o,points:s,synqronize:o.length>1}},_isSelectedIndirectly:function(e,t,n){var i,r,o,s=t?t.length:0,a=!1;for(i=0;i<s;i++)for(o=n[t[i]],r=0;r<o.length;r++)if(e===o[r]){a=!0;break}return a},_getMeasureGradient:function(e,t,n){var i={gradient:{colors:[],limits:[],x0:0,x1:0,y0:e.posMin,y1:e.posMax}};return t.getColorMapping().slice().reverse().forEach(function(e){i.gradient.colors.push(e.grad[1].toRGBA()),i.gradient.colors.push(e.grad[0].toRGBA()),i.gradient.limits.push(Math.min(1,Math.max(0,n.getNormalizedValue(e.id[1])))),i.gradient.limits.push(Math.min(1,Math.max(0,n.getNormalizedValue(e.id[0]))))}),i},_getClippings:function(e,t){var n=e.getPadding(),i=n.top-1,r=e.rect.height-n.bottom;return{areaClip:{x:0,y:i,width:t.width,height:r-i},lineClip:{x:0,y:i,width:t.width,height:r-i-.5}}},_getColorSettings:function(e,t,n){var r=.3,o=!1,s=!1;return e.mode&&e.mode===e.MEASURE&&!isNaN(t.posMin)&&i(e._data)?(r=.6,s=this._getMeasureGradient(t,e,n)):(e.mode&&e.mode===e.EXPRESSION||e.mode===e.MEASURE&&!isNaN(t.posMin))&&(o=!0,r=.6),{isExpression:o,areaAlpha:r,varyingPointColors:o,gradient:s}}})}),define("extensions.qliktech/linechart/layers/shapes/points",["objects.views/charts/shapes/container","objects.views/charts/shapes/circle","objects.views/charts/shapes/polygon","objects.views/charts/shapes/rect"],function(e,t,n,i){function r(e){switch(e){case"diamond":case"triangle":return new n;case"circle":return new t;case"line":default:return new i}}function o(e,t,n,i,r){var o=i;switch(r){case"circle":e.set(t,n,.5*o);break;case"diamond":e.set([{x:t,y:n-o/2},{x:t-o/2,y:n},{x:t,y:n+o/2},{x:t+o/2,y:n}]);break;case"triangle":e.set([{x:t,y:n-o/2},{x:t-o/2,y:n+o/2},{x:t+o/2,y:n+o/2}]);break;default:o=i,e.set(t-o/2,n-o/2,o,o)}}return e.extend("Points",{init:function(e){this._super(),this._symbol=e||"circle"},update:function(e){var t,n,i,s=e.points?e.points:[],a=0,l=!1,c=s?s.length:0;for(n=0;n<c;n++)!(i=s[n])||i.outOfDimensionBounds||i.isNaN||((t=this._children[a++])||(t=r(this._symbol),this.addChild(t)),o(t,i.x,i.y,i.size,this._symbol),t.fill=i.selectedIndirectly?"white":i.color,t.stroke=i.selectedIndirectly?i.color:!!i.selected&&"white",t.opacity=i.selected||i.selectedIndirectly?1:e.globalAlpha,t.strokeWidth=1.5,t.visible=!i.outOfBounds&&!i.isNaN&&!i.hidden&&(e.showDataPoints||i.isSingle||i.keep||i.selected),t.visible&&!l&&(l=t.true),t.data.outOfBounds=i.outOfBounds,t.data.value=i.value,t.data.label=i.label,t.data.dataIndex=i.dataIndex,t.data.text=i.text);return a<this._children.length&&this.removeChildren(this._children.slice(a-this._children.length)),this.visible=l,this._selectedSize=e.style.dataPoints.size.selected,this},getFromRange:function(e,n,i){return this.children.filter(function(t){return i?t.cx>=e&&t.cx<=n&&t.visible:t.cx>=e&&t.cx<n&&t.visible}).map(function(e){var n=new t(e.cx,e.cy,.5*this._selectedSize);return n.fill=e.fill,n.stroke="white",n.opacity=1,n.strokeWidth=1.5,n},this)}})}),define("extensions.qliktech/linechart/layers/shapes/poly-line",["objects.views/charts/shapes/container","objects.views/charts/shapes/polygon","objects.views/charts/shapes/line"],function(e,t,n){"use strict";function i(e){var t,n=[];for(t=0;t<e.length;t++)n=n.concat(r(e[t]));return n}function r(e){var t,n,i,s,a,l,c,u=[],h=e._polygons[0].points;if(!h||h.length<2)return u;for(e.data.selected=h[0].selected&&h[1].selected,l=null,c=h.length-1,a=1;a<h.length;a++)if(h[a-1].selected&&h[a].selected){l=a-1;break}if(null!==l){for(a=l;a<h.length;a++)if(!h[a].selected){c=a-1;break}n=h.slice(0,l+1),i=h.slice(l,c+1),s=h.slice(c),n&&n.length>1&&(t=o(n,e),u.push(t)),i&&i.length>1&&((t=o(i,e)).data.selected=!0,u.push(t)),s&&s.length>1&&(t=o(s,e),u=u.concat(r(t)))}else u.push(e);return u}function o(e,n){var i=new t(e);return i.opacity=n.opacity,i.close=!1,i.stroke=n.stroke,i.strokeWidth=n.strokeWidth,i.lineJoin=n.lineJoin,i.lineCap=n.lineCap,i}function s(e,n,r,o){var s,a,c,u,h,d,p=[];for(u=n?n.length:0,h=[],s=0;s<u;s++)if(!(d=n[s])||d.isNaN&&!0!==d.isInterpolationOffset)void 0===d&&e.isNumeric||r!==l.GAP||!c||!p.length||(c.set(p),h.push(c),c=null,p=[]);else{if(!c&&(c=new t,c.close=!1,c.stroke=o||d.color||"#333333",c.lineJoin="round",c.lineCap="round",c.opacity=1,p=[],d.isNull&&!o&&n[s+1]&&(c.stroke=n[s+1].color||"#333333"),d.hidden&&!o))for(a=1;a<u-s;++a)if(n[s+a]&&!n[s+a].hidden){c.stroke=n[s+a].color||"#333333";break}p.push({x:d.x,y:d.y,selected:d.selected,dataIndex:d.dataIndex,y_:d.y1})}for(c&&p.length>1&&(c.set(p),h.push(c)),u=(h=i(h)).length,s=0;s<u;s++)h[s].strokeWidth=e.style.line.width*(h[s].data.selected?2:1),h[s].opacity=h[s].data.selected?1:e.globalAlpha;return h}var a,l={GAP:"gap",CONNECT:"connect",ZERO:"zero"};return a=e.extend("PolyLine",{init:function(){this._super(),this.lineJoin="round",this.lineCap="round"},update:function(e){this.clip=e.clippings.lineClip,this.removeChildren(),e.colors.varyingPointColors?this.addChildren(a.getLines(e,e.points,e.nullMode,n)):this.addChildren(s.call(this,e,e.points,e.nullMode,e.colors.gradient))},getLineInRange:function(e,t){var n=new a;return this.children.forEach(function(i){var r=i.getPartialFromRange(e,t);r&&(r.stroke=i.stroke,r.strokeWidth=3,r.close=i.close,n.addChildren([r]))}),n}}),a.getLines=function(e,t,n,i){var r,o,s,a=t?t.length:0,c=e.interpolateVaryingColors,u=[],h=null;for(r=0;r<a;r++)!(o=t[r])||o.isNaN&&!0!==o.isInterpolationOffset?void 0===o&&e.isNumeric||n!==l.GAP||(s=null):s?((h=new i(s.x,s.y,o.x,o.y)).data.selected=s.selected&&o.selected,h.data.y1_=s.y1,h.data.y2_=o.y1,s.color!==o.color?h.stroke={gradient:{x0:s.x,y0:0,x1:o.x,y1:0,limits:c?[0,1]:[0,.5,.5,1],colors:c?[s.color||"#333333",o.color||"#333333"]:[s.color||"#333333",s.color||"#333333",o.color||"#333333",o.color||"#333333"]}}:h.stroke=o.color,h.opacity=h.data.selected?1:e.globalAlpha,h.strokeWidth=e.style.line.width*(h.data.selected?2:1),u.push(h),s=o):s=o;return u},a}),define("extensions.qliktech/linechart/layers/shapes/poly-area",["objects.views/charts/shapes/container","objects.views/charts/shapes/polygon","objects.views/charts/shapes/line"],function(e,t,n){function i(e){return{x:e.x,y:e.y_}}function r(e,r){var o,s,a,l,c,u=[],h=r?r.length:0;for(o=0;o<h;o++)r[o]instanceof t?(a=r[o]._polygons[0].points,(s=new t(a.concat(a.map(i).reverse()))).fill=e.colors.gradient||r[o].stroke,s.opacity=e.colors.areaAlpha*(r[o].data.selected?1:e.globalAlpha)):r[o]instanceof n&&(l=Math.floor(r[o].x1),c=Math.floor(r[o].x2),a=[{x:l,y:r[o].y1},{x:l,y:r[o].data.y1_},{x:c,y:r[o].data.y2_},{x:c,y:r[o].y2}],s=new t(a),r[o].stroke.gradient?s.fill={gradient:{colors:r[o].stroke.gradient.colors,limits:r[o].stroke.gradient.limits,x0:r[o].stroke.gradient.x0,x1:r[o].stroke.gradient.x1,y0:0,y1:0}}:r[o].stroke?s.fill=r[o].stroke||"#eeeeee":s.fill=e.colors.gradient||"#eeeeee",s.opacity=e.colors.areaAlpha*(r[o].data.selected?1:e.globalAlpha)),s&&u.push(s);return u}return e.extend("PolyArea",{getAreaFromSegments:function(t){var n=new e;return n.addChildren(r(this.__data,t)),n},update:function(e,t){this.__data=e,this.clip=e.clippings.areaClip,this.removeChildren(),this.addChildren(r(e,t))}})}),define("extensions.qliktech/linechart/layers/shapes/line-object",["objects.views/charts/shapes/container","./points","./poly-line","./poly-area"],function(e,t,n,i){return e.extend("LineObject",{init:function(e,r){this._super(),this.data.label=e.info.label,r.showArea&&(this._areaLayer=new i,this.addChild(this._areaLayer)),this._lineLayer=new n,this.addChild(this._lineLayer),this._pointLayer=new t("circle"),this.addChild(this._pointLayer)},update:function(e){this._pointLayer.update(e),this._lineLayer.update(e),this.visible=this._pointLayer.visible||this._lineLayer.visible,this._areaLayer&&(this._areaLayer.update(e,this._lineLayer.children),this._areaLayer.visible&&(this.visible=!0))},getLinesInRange:function(t,n,i){var r=new e,o=this._lineLayer.getLineInRange(t,n);if(this._areaLayer){var s=this._areaLayer.getAreaFromSegments(o.children);r.addChildren([s])}return r.addChildren([o]),r.addChildren(this._pointLayer.getFromRange(t,n,i)),r}})}),define("extensions.qliktech/linechart/layers/line-objects-layer",["./layer","./shapes/line-object"],function(e,t){return e.extend("LineObjectLayer",{init:function(e){this._super(e,{name:"line-objects-layer"})},updateInstances:function(e,n){var i,r=e?e.length:0,o=[];for(this.renderer.stage.removeChildren(),i=0;i<r;i++)o.push(new t(e[i],{showArea:n.showArea}));this.renderer.stage.addChildren(o),this._lineObjects=o},getLineObjects:function(){return this._lineObjects},getPolyLinesInRange:function(e,t,n){return this._lineObjects.map(function(i){return i.getLinesInRange(e,t,n)})},update:function(e){var t,n=this._lineObjects?this._lineObjects.length:0;for(t=0;t<n;t++)this._lineObjects[t].update(e[t])}})}),define("extensions.qliktech/linechart/layers/oob-layer",["./layer","objects.views/charts/shapes/polygon"],function(e,t){function n(e,t,n,i,r){var o=[];return"left"===r?(o.push({x:e,y:t+n/2}),o.push({x:e,y:t-n/2}),o.push({x:e-i,y:t})):"right"===r?(o.push({x:e,y:t+n/2}),o.push({x:e,y:t-n/2}),o.push({x:e+i,y:t})):"up"===r?(o.push({x:e-n/2,y:t}),o.push({x:e+n/2,y:t}),o.push({x:e,y:t-i})):"down"===r&&(o.push({x:e-n/2,y:t}),o.push({x:e+n/2,y:t}),o.push({x:e,y:t+i})),o}return e.extend("OutOfBoundsLayer",{init:function(e){this._super(e,{name:"out-of-bounds-layer"}),this._markerSize=8},update:function(e,i){var r,o,s,a,l,c,u=this.renderer.stage,h=u.children,d=i.markerSize||this._markerSize,p=e?e.length:0;for(c=0;c<p;c++)r=h[c],a=o=e[c],o.data&&(a=o.data),l=i.axesSettings[i.measureToAxisIndex[a.measureIdx]],s=n(a.x,a.outOfRangeUp?l.topCutoff+d:l.bottomCutoff-d,d,d,a.outOfRangeUp?"up":"down"),r?r.set(s):(r=new t(s),u.addChild(r)),r.fill=i.style.outOfRange.color,r.opacity=a.selected?1:i.globalAlpha;p<h.length&&u.removeChildren(h.slice(p-h.length))}})}),define("extensions.qliktech/linechart/layers/label-layer",["./layer","objects.views/charts/utils/canvas-renderer","general.utils/shapes/geometry-math"],function(e,t,n){function i(){var e,t,n,i,r,o,s,a,l,c={},u=this.combinedMeasuresFormatter;for(this._allDataLineObjectsLength=this._allDataLineObjects?this._allDataLineObjects.length:0,this._dataLabelsOfLines=new Array(this._allDataLineObjectsLength),this._allDataPointLabels=[],e=0;e<this._allDataLineObjectsLength;e++)for(this._dataLabelsOfLines[e]=[],i=(r=this._allDataLineObjects[e].find("Points [visible='true']"))?r.length:0,t=0;t<i;t++)(l=(s=(o=r[t].getLocalBoundingRect()).x+o.width/2)+";"+(a=o.y+o.height/2))in c||(c[l]=!0,n={text:this._lineType===T.STACKED&&this._allDataLineObjectsLength>1?u.formatValue(r[t].value):r[t].data.label,x0:s,y0:a,align:"center",font:this._style.dataPoints.font,maxWidth:512,maxNumLines:1,line:e},this._dataLabelsOfLines[e].push(n),this._allDataPointLabels.push(n));this._numAllDataPointLabels=this._allDataPointLabels.length}function r(){var e;for(e=0;e<this._numAllDataPointLabels;e++)this._allDataPointLabels[e].size=t.measureTextObject({type:"text",shape:this._allDataPointLabels[e]})}function o(){r.call(this);var e,t,n,i,o,s,a,l=this._discreteSpacing/2,c="leftDx",u="leftDy",h="rightDx",d="rightDy",p=1;for(this.yMirrorMode&&(c="rightDx",u="rightDy",h="leftDx",d="leftDy",p=-1),e=0;e<this._allDataLineObjectsLength;e++)if(i=this._dataLabelsOfLines[e],0!==(n=i.length))if(1!==n){for((o=i[0]).priority=6,a=i[1],o[c]=l,o[u]=0,o[h]=(a.x0-o.x0)*p,o[d]=o.y0-a.y0,t=1;t<n-1;t++)o=i[t],s=i[t-1],a=i[t+1],o[c]=s[h],o[u]=-s[d],o[h]=(a.x0-o.x0)*p,o[d]=o.y0-a.y0,s.y0<o.y0?o.y0<a.y0?o.priority=1:o.y0===a.y0?o.priority=2:o.priority=3:s.y0===o.y0?o.y0<a.y0?o.priority=2:o.y0===a.y0?o.priority=0:o.priority=2:o.y0<a.y0?o.priority=4:o.y0===a.y0?o.priority=2:o.priority=1;o=i[n-1],s=i[n-2],o[c]=s[h],o[u]=-s[d],o[h]=l,o[d]=0,o.priority=5}else(o=i[0])[c]=l,o[u]=0,o[h]=l,o[d]=0}function s(){void 0!==this._usedDataMax&&this._usedDataMax===this._usedDataMin?this._allDataPointLabels.sort(function(e,t){return e.x0<t.x0?-1:1}):this._allDataPointLabels.sort(function(e,t){return e.priority>t.priority?-1:e.priority===t.priority?6===e.priority?e.x0===t.x0?e.y0>t.y0?1:-1:e.x0>t.x0?1:-1:5===e.priority?e.x0===t.x0?e.y0>t.y0?1:-1:e.x0>t.x0?-1:1:4===e.priority?e.y0>t.y0?1:-1:3===e.priority?e.y0>t.y0?-1:1:e.y0===t.y0?e.x0>t.x0?-1:1:e.y0<t.y0?-1:1:1})}function a(){var e,t,n,i,r,o=[];for(e=0;e<this._allDataLineObjectsLength;e++)for(i=(n=this._allDataLineObjects[e].find("PolyLine [stroke]"))?n.length:0,t=0;t<i;t++)r=n[t].getLocalPoints(),o.push(r);return o}function l(e,t){return!(e.minX2>t.maxX2||e.maxX2<t.minX2||e.minY2>t.maxY2||e.maxY2<t.minY2)}function c(e){var t=this._allDataPointLabels[e],n=this.rect.width,i=this.rect.height;return t.x0>=0&&t.x0<=n&&t.minX>=0&&t.maxX<=n&&t.minY>=0&&t.maxY<=i}function u(e){return!n.checkPolylinesIntersectingRectDefinedByMaxMin(this._polylines,this._allDataPointLabels[e])}function h(e){var t,n,i=this._allDataPointLabels[e],r=(i.minX+i.maxX)/2,o=(i.minY+i.maxY)/2,s=Math.pow(r-i.x0,2)+Math.pow(o-i.y0,2);for(n=0;n<this._numAllDataPointLabels;n++)if(t=this._allDataPointLabels[n],n!==e&&s>=Math.pow(r-t.x0,2)+Math.pow(o-t.y0,2))return!1;return!0}function d(e){var t,n=this._allDataPointLabels[e];for(t=0;t<e;t++)if(this._allDataPointLabels[t].status&&l(n,this._allDataPointLabels[t]))return!1;return!0}function p(e){return!!c.call(this,e)&&(!!h.call(this,e)&&(!!u.call(this,e)&&d.call(this,e)))}function f(e){var t,n,i,r=this._dataLabelHorizontalGap/2,o=this._dataLabelVerticalGap/2;n=(t=e.size.width/2)+r,e.minX=e.x-t,e.maxX=e.x+t,e.minX2=e.x-n,e.maxX2=e.x+n,i=e.size.height,"top"===e.baseline&&(e.minY=e.y,e.maxY=e.y+i,e.maxY2=e.maxY+o,e.minY2=e.minY-o),"bottom"===e.baseline&&(e.maxY=e.y,e.minY=e.y-i,e.maxY2=e.maxY+o,e.minY2=e.minY-o),"middle"===e.baseline&&(e.maxY=e.y+i/2,e.minY=e.y-i/2,e.maxY2=e.maxY+o,e.minY2=e.minY-o)}function m(e){6===e.priority&&e.x-e.size.width/2<0&&(e.x=e.size.width/2+1),5===e.priority&&e.x+e.size.width/2>this.rect.width&&(e.x=this.rect.width-e.size.width/2-1)}function g(e){return e.baseline="middle",e.x=e.x0-e.size.width/2-this._dataLabelHorizontalGap,e.y=e.y0,!0}function v(e){return e.baseline="middle",e.x=e.x0+e.size.width/2+this._dataLabelHorizontalGap,e.y=e.y0,!0}function y(e){return e.baseline="bottom",e.x=e.x0,e.y=e.y0-this._dataLabelMargin,m.call(this,e),!0}function b(e){return e.baseline="top",e.x=e.x0,e.y=e.y0+this._dataLabelMargin,m.call(this,e),!0}function x(e){var t,n,i,r,o,s=e.leftDx,a=e.rightDx,l=e.leftDy,c=e.rightDy;return(l>0||c>0)&&(l=Math.max(l,1e-9),c=Math.max(c,1e-9),t=e.size.width+2*this._horizontalDistanceFromLine,(i=t/(s/l+a/c))<=this._maxDataLabelMargin)&&(e.baseline="bottom",i=Math.max(i,this._dataLabelMargin),e.y=e.y0-i,r=i*s/l,o=i*a/c,n=t/2,r<n?e.x=e.x0+(n-r):o<n&&(e.x=e.x0-(n-o)),!0)}function q(e){var t,n,i,r,o,s=e.leftDx,a=e.rightDx,l=-e.leftDy,c=-e.rightDy;return(l>0||c>0)&&(l=Math.max(l,1e-9),c=Math.max(c,1e-9),t=e.size.width+2*this._horizontalDistanceFromLine,(i=t/(s/l+a/c))<=this._maxDataLabelMargin)&&(e.baseline="top",i=Math.max(i,this._dataLabelMargin),e.y=e.y0+i,r=i*s/l,o=i*a/c,n=t/2,r<n?e.x=e.x0+(n-r):o<n&&(e.x=e.x0-(n-o)),!0)}function C(e){var t,n,i=e.leftDx,r=e.leftDy;return e.baseline="middle",t=e.size.height/2+this._horizontalDistanceFromLine,n=Math.abs(this._dataLabelHorizontalGap*r/i),e.x=e.x0-e.size.width/2-this._dataLabelHorizontalGap,e.y=e.y0+(n>=t?0:r>0?t-n:n-t),!0}function S(e){var t,n,i=e.rightDx,r=e.rightDy;return e.baseline="middle",t=e.size.height/2+this._horizontalDistanceFromLine,n=Math.abs(this._dataLabelHorizontalGap*r/i),e.x=e.x0+e.size.width/2+this._dataLabelHorizontalGap,e.y=e.y0+(n>=t?0:r>0?t-n:n-t),!0}function w(e){var t,n,i,r,o=this.rect.width;return e.priority>3?(e.baseline="middle",e.x0-0<=o-e.x0?(e.x=e.x0+9+e.size.width/2,e.y=e.y0):(e.x=e.x0-9-e.size.width/2,e.y=e.y0)):3===e.priority&&(t=e.leftDy/e.leftDx,(n=e.rightDy/e.rightDx)>=t?(i=(e.size.height/2+1)/n)<=18?(e.baseline="middle",e.y=e.y0,e.x=e.x0+Math.max(i,9)+e.size.width/2):(r=18*n-1,e.baseline="top",e.y=e.y0-r,e.x=e.x0+18+e.size.width/2):(i=(e.size.height/2+1)/t)<=18?(e.baseline="middle",e.y=e.y0,e.x=e.x0-Math.max(i,9)-e.size.width/2):(r=18*t-1,e.baseline="top",e.y=e.y0-r,e.x=e.x0-18-e.size.width/2)),!0}function _(e){var t;return e.rightDy<=0?(e.baseline="bottom",e.x=e.x0+e.size.width/2,e.y=e.y0+1):e.rightDy<=e.rightDx?(e.baseline="bottom",e.x=e.x0+e.size.width/2,e.y=e.y0-e.size.width*Math.abs(e.rightDy/e.rightDx)-1):(e.baseline="top",t=Math.max(0,e.size.height+1-this.rect.height+e.y0),e.x=e.x0+e.size.width/2+t*Math.abs(e.rightDx/e.rightDy),e.y=e.y0-t+1),!0}function D(e){var t;return e.leftDy<=0?(e.baseline="bottom",e.x=e.x0-e.size.width/2,e.y=e.y0+1):e.leftDy<=e.leftDx?(e.baseline="bottom",e.x=e.x0-e.size.width/2,e.y=e.y0-e.size.width*Math.abs(e.leftDy/e.leftDx)-1):(e.baseline="top",t=Math.max(0,e.size.height+1-this.rect.height+e.y0),e.x=e.x0-e.size.width/2-t*Math.abs(e.leftDx/e.leftDy),e.y=e.y0-t+1),!0}function M(e,t){var n=this._allDataPointLabels[t];!n.status&&e.call(this,n)&&(f.call(this,n),n.status=p.call(this,t))}function A(e){var t=this._allDataPointLabels[e];this._allDataLineObjectsLength>1?(6===t.priority&&M.apply(this,[g,e]),5===t.priority&&M.apply(this,[v,e]),M.apply(this,[y,e]),M.apply(this,[b,e])):(M.apply(this,[y,e]),M.apply(this,[b,e]),6===t.priority&&M.apply(this,[g,e]),5===t.priority&&M.apply(this,[v,e])),t.status||(t.rightDy+Math.abs(t.rightDx)*t.leftDy/Math.abs(t.leftDx)>=0?(M.apply(this,[q,e]),M.apply(this,[x,e])):(M.apply(this,[x,e]),M.apply(this,[q,e]))),t.status||(t.rightDy+Math.abs(t.rightDx)*t.leftDy/Math.abs(t.leftDx)>=0?(M.apply(this,[C,e]),M.apply(this,[S,e])):(M.apply(this,[S,e]),M.apply(this,[C,e]))),M.apply(this,[w,e]),t.status||6!==t.priority||M.apply(this,[_,e]),t.status||5!==t.priority||M.apply(this,[D,e])}function E(){var e;for(e=0;e<this._numAllDataPointLabels;e++)A.call(this,e)}function I(){var e,t,n,i=[];for(e=0;e<this._numAllDataPointLabels;e++)(t=this._allDataPointLabels[e]).status&&(n={type:"text",fill:this._style.dataPoints.color,shape:t},i.push(n));this.renderer.shapes=i}var T={LINE:"line",AREA:"area",STACKED:"stackedArea"};return e.extend("LabelLayer",{init:function(e){this.wrapper=document.createElement("div"),this.wrapper.style.position="absolute",this.renderer=new t(this.wrapper),this.minorAxis=null,this.majorAxis=null,e.appendChild(this.wrapper),this._dataLabelMargin=6,this._maxDataLabelMargin=12,this._dataLabelHorizontalGap=6,this._dataLabelVerticalGap=3,this._horizontalDistanceFromLine=2},setYMirrorMode:function(e){this.yMirrorMode=e},update:function(e,t){this.combinedMeasuresFormatter=t.combinedMeasuresFormatter,this._allDataLineObjects=e,this._lineType=t.lineType,this._discreteSpacing=t.majorAxis.getDiscreteSpacing(),this._style=t.style,this.rect=t.rect,this.renderer.shapes=[],i.call(this),o.call(this),s.call(this),this._polylines=a.call(this),E.call(this),I.call(this)}})}),define("extensions.qliktech/linechart/layers/line-highlight-layer",["./layer","./shapes/line-object"],function(e){return e.extend("LineHighlightLayer",{init:function(){this._super.apply(this,arguments),this.ranges=[]},getLineObjects:function(){return this._lineObjects},setRanges:function(e){this.ranges=e},update:function(e,t){var n=[];this.ranges.forEach(function(i){var r=e.getPositionOfValue(i.min),o=e.getPositionOfValue(i.max);n=n.concat(t.getPolyLinesInRange(r,o,i.maxIncluded))},this),this.renderer.stage.removeChildren(),n.length?(this.renderer.stage.addChildren(n),this.show()):this.hide()}})}),define("extensions.qliktech/linechart/linearea",["objects.views/charts/components/chart-component","general.utils/shapes/circle","./line-objects-model","./layers/line-objects-layer","./layers/oob-layer","./layers/label-layer","./layers/line-highlight-layer","./layers/selection-highlight-layer","objects.views/charts/chart-style-service","client.utils/theme/modern/theme","core.utils/deferred","core.utils/feature-flags"],function(e,t,n,i,r,o,s,a,l,c,u,h){"use strict";function d(e){return!!e}function p(e,t){for(var n,i=Object.keys(e),r=i.length,o=i.map(function(t){return e[t].points}),s=Math.max.apply(null,o.map(function(e){return e.length})),a=0;a<s;++a){var l=!1,c=!1;for(n=0;n<r;++n)l=l||o[n][a],c=c||!o[n][a];if(l&&c)for(n=0;n<r;++n)o[n][a]||(o[n][a]={idx:l.idx,dimValue:l.dimValue,measureIdx:l.measureIdx,aggregated:{start:0,end:0},hasLeftNeighbour:!!o[n][a-1]&&!o[n][a-1].isNaN,hasRightNeighbour:!!o[n][a+1]&&!o[n][a+1].isNaN,isNaN:!t,value:t?0:NaN,text:t?"0":"",hidePoint:!0,color:null,label:""})}}function f(e){var t,n,i,r,o,s=e?e.length:0;for(t=0;t<s;t++)if((o=e[t])&&!o.hasRightNeighbour){for(n=t+1;n<s;n++)if(e[n]&&!e[n].isNaN){o.nearestRightNeighbour=n;break}if(!o.isNaN){if(!isNaN(o.nearestRightNeighbour))for(r=n-t,i=1;i<r;i++)e[t+i]&&(e[t+i].nearestRightNeighbour=o.nearestRightNeighbour,e[t+i].nearestLeftNeighbour=t);t=n-1}}}function m(e){var t,n,i,r,o,s,a,l,c,u=e?e.length:0,h=this.isDimensionContinuous;for(t=0;t<u;t++)if((c=e[t])&&!c.hasRightNeighbour&&!c.isNaN&&!isNaN(c.nearestRightNeighbour))for(n=c.nearestRightNeighbour,o=c.value,s=e[n].value,l=n-t,a=h?e[n].dimValue-c.dimValue:n-t,i=1;i<l;i++)r=(h?e[t+i].dimValue-c.dimValue:i)/a,e[t+i]&&(e[t+i].interpolatedValue=o*(1-r)+s*r)}function g(e,t){var n,i,r,o,s,a=[],l=e?e.length:0;for(n=0;n<l;n++)i=e[n].points,Object.keys(i).forEach(function(e){var n=!1;s=i[e].idx,a[s]||(a[s]={pos:0,neg:0,total:0}),(o=i[e])&&(r=o.isNaN?isNaN(o.interpolatedValue)?0:o.interpolatedValue:o.value,isNaN(r)||(t?(0===r?o.hasLeftNeighbour&&i[e-1]?n=i[e-1].aggregated.end<0:o.hasRightNeighbour&&i[e+1]&&(n=i[e+1].aggregated.end<0):n=r<0,n?(o.aggregated.start=a[s].neg,a[s].neg+=r,o.aggregated.end=a[s].neg):(o.aggregated.start=a[s].pos,a[s].pos+=r,o.aggregated.end=a[s].pos)):(o.aggregated.start=a[s].total,a[s].total+=r,a[s].pos=Math.max(a[s].pos,a[s].total),a[s].neg=Math.min(a[s].neg,a[s].total),o.aggregated.end=a[s].total),"number"==typeof o.interpolatedValue&&(o.interpolatedValue=o.aggregated.end,o.isInterpolationOffset=!0)))});return{pos:Math.max.apply(null,a.filter(function(e){return!!e}).map(function(e){return e.pos})),neg:Math.min.apply(null,a.filter(function(e){return!!e}).map(function(e){return e.neg}))}}function v(e,t){var n=e.layoutMap[t]||"medium";return h.THEMING?{dataPoints:{color:e.getStyle("label.value","color"),font:"normal "+e.getStyle("label.value","fontSize")+" 'QlikView Sans'",size:{normal:6,selected:10}},outOfRange:{color:e.getStyle("outOfRange","color")},line:{width:"full"===n?2:1}}:{dataPoints:{color:e.getValue(b,"item.value","color"),font:e.getFont(b,"item.value",n),size:{normal:e.getValue(b,"item.shape","size"),selected:e.getValue(b,"item.shape","size","selected")}},outOfRange:{color:e.getValue(b,"item.outOfRange","color")},line:{width:e.getValue(b,"item.line","width",n)}}}function y(){if(!this._data||!this._tree)return[];var e,t=this._data.qHyperCube.qDimensionInfo,n=t.length,i=[],r=0;return this._tree.children.forEach(function(o){o.id=t[0].cId+"_"+o.data.qElemNo,e={label:o.data.qText||"",cacheIndex:[],id:o.id},i.push(e),1===n&&(e.cacheIndex[0]=r++),n>1&&o.children.forEach(function(t){t.children[0]&&t.children[0].isBranch&&(-2!==t.data.qElemNo&&e.cacheIndex.push(r),r++)},this)},this),{data:i,info:[{qApprMaxGlyphCount:this._tree.data.qApprMaxGlyphCount}],groupSize:null}}var b="lineChart",x={LINE:"line",AREA:"area",STACKED:"stackedArea"},q={GAP:"gap",CONNECT:"connect",ZERO:"zero"};return e.extend("LineArea",{init:function(){this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._shapes=[],this._generatedCacheItems=[],this._showDataPoints=!0,this._colorMap=null,this._showDataPoints=!1,this._lineType=x.LINE,this._nullMode=q.GAP,this._separateStacking=!0,this._globalAlpha=1,this._dataLabelMargin=6,this._maxDataLabelMargin=12,this._dataLabelHorizontalGap=6,this._dataLabelVerticalGap=3,this._horizontalDistanceFromLine=2,this.interpolateVaryingColors=!0,h.THEMING?this._styleService=c.initializeService("object.lineChart"):this._styleService=l.getInstance(),this._lineObjectsModel=new n,this._edgeBleed=0,this._lineLayer=new i(this.container),this.layers=[this._lineLayer],this.isMini?(this._rangeSelectionLayer=new a(this.container),this.layers.push(this._rangeSelectionLayer)):(this._oobLayer=new r(this.container),this.layers.push(this._oobLayer),this._labelLayer=new o(this.container),this.layers.push(this._labelLayer),this._rangeSelectionLayer=new s(this.container),this.layers.push(this._rangeSelectionLayer))},setYMirrorMode:function(e){this.yMirrorMode=e,this._labelLayer&&this._labelLayer.setYMirrorMode(e)},preRender:function(){},afterPaint:function(){return u.resolve()},setColorMap:function(e){this._colorMap=e},getColorMap:function(){return this._colorMap},setShowDataPoints:function(e){this._showDataPoints=e},getShowDataPoints:function(){return this._showDataPoints},setMajorAxis:function(e){this._majorAxis=e,this._majorAxis.listen("changed",function(){this.invalidateDisplay()},this)},setMinorAxis:function(e){this._minorAxis=e,this._minorAxis.listen("changed",function(){this.invalidateDisplay()},this)},setTimeAxis:function(e){this.timeAxis=e,this.timeAxis.listen("changed",function(){this.invalidateDisplay()},this)},setContinuousAxis:function(e){this.continuousAxis=e,this.continuousAxis.listen("changed",function(){this.invalidateDisplay()},this)},setActiveDimensionAxis:function(e){this._activeDimAxis=e},setSecondaryMinorAxis:function(e){this._secondaryMinorAxis=e,this._secondaryMinorAxis.listen("changed",function(){this.invalidateDisplay()},this)},setIsDimensionContinuous:function(e){this.isDimensionContinuous=e,this._edgeBleed=this.isDimensionContinuous?5:0},setDimensionTree:function(e){this._tree=e,this.invalidateProperties("linearea: setDimensionTree")},setLineType:function(e){this._lineType=e},setNullMode:function(e){this._nullMode=e},setSeparateStacking:function(e){this._separateStacking=e},setShowDataPointLabels:function(e){this._showDataPointLabels=e},getShowDataPointLabels:function(){return this._showDataPointLabels},freezeZOrdering:function(){this._zOrderFreezed=!0},unFreezeZOrdering:function(){this._zOrderFreezed=!1},setColorMappings:function(e){this._colorMappings=e},_updateSize:function(){this.invalidateDisplay()},getCacheItems:function(){return this._cacheItems},setCacheItems:function(e){this._cacheItems=e},getGeneratedCacheItems:function(){return this._generatedCacheItems||[]},setMeasureIndices:function(e){this._measureIndices=e},getMajorAxisData:function(){return this._majorAxisData},getMinorAxisData:function(){return this._minorAxisData},renderRangeSelections:function(){return this._rangeSelectionLayer.update(this._activeDimAxis,this._lineLayer),this._rangeSelectionLayer.render()},updateRangeSelection:function(e){this._rangeSelectionLayer.setRanges(e),this.renderRangeSelections()},_updateProperties:function(){if(this._data&&this._tree){this._minorAxes=[this._minorAxis],this._secondaryMinorAxis&&this._minorAxes.push(this._secondaryMinorAxis),this._majorAxisData=y.call(this),this._minorAxisData=null;var e,n,i,r,o,s,a,l=[],c=this._data.qHyperCube.qDimensionInfo,u=c.length,h=this._measureIndices?this._measureIndices.length:this._data.qHyperCube.qMeasureInfo.length,v=this._data.qHyperCube.qMeasureInfo,b=this._tree,C=this._shapes,S=b.children.length,w=0,_=this._shapes.length,D={},M=this.measureFormatters,A=this.selectionIdentifier?this.selectionIdentifier:"dataArea",E=this._minorAxes,I=[],T=[];if(this._measureIndices)T=this._measureIndices;else if(h>0&&h<20)for(;T.length<h;)T.push(T.slice(-1)[0]+1||0);if(T.forEach(function(e){I[e]=E.filter(function(t){return!t._dataIndices||t._dataIndices.indexOf(e)>=0})[0]}),this._measureToAxis=I,this._measureToAxisIndex=I.map(function(e){return E.indexOf(e)}),this._polysData=[],S&&T||T.length){b.children.forEach(function(h,d){h.id=c[0].cId+"_"+h.data.qElemNo,h.children.forEach(function(p,f){if(u>1)e=h.id+";"+c[1].cId+"_"+p.data.qElemNo,(a=D[p.data.qText])||(D[p.data.qText]={info:{label:p.data.qText},points:[],values:[],measureIdx:u>1?0:f},a=D[p.data.qText]),p=p.children[0],s=M[0];else{if(this._measureIndices&&this._measureIndices.indexOf(f)<0)return;e=h.id,(a=D[f])||(D[f]={info:{label:v[f].qFallbackTitle},measureIdx:f,points:[],values:[]},a=D[f]),s=M[f]}(i=p?p.children[0]:void 0)&&(n=void 0!==i.data.qValue?i.data.qValue:i.data.qNum,o=isNaN(n),this._nullMode===q.ZERO&&o&&(n=0,o=!1),p.chartData={value:n,isNaN:o,idx:d,measureIdx:u>1?0:f,hasLeftNeighbour:!!a.points[d-1]&&!a.points[d-1].isNaN,hasRightNeighbour:!1,color:null,text:i.data.qText,label:i.data.qText?s&&("U"===s.type||isNaN(i.data.qNum))?s.formatValue(n):i.data.qText:"",rowIndex:p.data.rowIndex,dimValue:h.data.qNum,id:e,aggregated:{}},p.chartData.isNaN||(p.chartData.aggregated.start=0,p.chartData.aggregated.end=n,a.values.push(n)),a.points[d]=p.chartData,a.points[d-1]&&(a.points[d-1].hasRightNeighbour=!p.chartData.isNaN),p.chartData.shapeIndex=w++,_<w&&C.push(new t(NaN,NaN,NaN)),p.chartData.cacheCircle=C[p.chartData.shapeIndex],(r=p.parent).cacheItem&&(l.indexOf(r.cacheItem)<0&&l.push(r.cacheItem),p.chartData.cacheItem=r.cacheItem,r.cacheItem.addShape(A,p.chartData.cacheCircle,!0),r.cacheItem.calculateTooltipPosition=!0))},this)},this);var L=[],k=h>1||u>1,O=(this._nullMode===q.CONNECT||this.isDimensionContinuous)&&this._lineType===x.STACKED&&k,P=this._nullMode===q.ZERO&&k&&!this.isDimensionContinuous;if((O||P)&&p.call(this,D,P),Object.keys(D).forEach(function(e){(O||this._nullMode!==q.ZERO)&&f.call(this,D[e].points),O&&m.call(this,D[e].points),this.isDimensionContinuous||(D[e].points=D[e].points.filter(d)),L.push(D[e])},this),this._polysData=L,this._zOrderFreezed){var N=this._sortedOrder;this._polysData.forEach(function(e,t){e.idx=t}),this._polysData.sort(function(e,t){return N.indexOf(e.idx)-N.indexOf(t.idx)})}else this._lineType===x.AREA?(this._polysData.forEach(function(e,t){e.idx=t,e.values.sort(function(e,t){return t-e}),e.absMedian=Math.abs(e.values[Math.floor(e.values.length/2)])}),this._polysData.sort(function(e,t){return t.absMedian-e.absMedian})):this._polysData.forEach(function(e,t){e.idx=t}),this._sortedOrder=this._polysData.map(function(e){return e.idx});if(this._lineType===x.STACKED&&(h>1||u>1)){var R=g.apply(this,[L,this._separateStacking]);this._minorAxisData={min:R.neg>=0?0:R.neg,max:R.pos<0?0:R.pos}}}this._shapes.length>w&&(this._shapes=this._shapes.slice(0,w)),this.setSelectableShapes(l),this._lineLayer.updateInstances(this._polysData,{showArea:[x.AREA,x.STACKED].contains(this._lineType)})}},hasValidData:function(){return this._super()&&this._majorAxis&&this._minorAxis&&this._data&&this._tree},updateSize:function(){this._super(),this.layers.forEach(function(e){e.rect=this.rect,e.renderer.setDimensions(0,-1,this.rect.width,this.rect.height+1),e.renderer.setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y)},this),this._style=v(this._styleService,this._layoutMode)},preRelevantSizeCalculation:function(){this.perpendicularlyRelevantSpacing={left:this._edgeBleed,right:this._edgeBleed,top:1,bottom:this._edgeBleed}},release:function(){this.layers.forEach(function(e){e.release()}),this._super(),this._majorAxis&&this._majorAxis.stopListen("changed",null,this),this._minorAxis&&this._minorAxis.stopListen("changed",null,this),this._secondaryMinorAxis&&this._secondaryMinorAxis.stopListen("changed",null,this),this.timeAxis&&this.timeAxis.stopListen("changed",null,this),this.continuousAxis&&this.continuousAxis.stopListen("changed",null,this)},beforeLayerUpdates:function(){},paint:function(){this._majorAxis.updateNow(),this._minorAxis.updateNow(),this._activeDimAxis&&this._activeDimAxis.updateNow();var e={numDimensions:this._data.qHyperCube.qDimensionInfo.length,showDataPoints:this._showDataPoints&&this._layoutMode>this.ShowFlags.SPARK,nullMode:this._nullMode,globalAlpha:this._globalAlpha,majorAxis:this._majorAxis,minorAxes:this._minorAxes,numericAxis:this._activeDimAxis,isNumeric:this.isDimensionContinuous,measureToAxisIndex:this._measureToAxisIndex,axesSettings:this._minorAxes.map(this._getAxisDetails),combinedMeasuresFormatter:this.combinedMeasuresFormatter,interpolateVaryingColors:this.interpolateVaryingColors,colorMap:this._colorMap,rect:this.rect,style:this._style,markerSize:Math.min(8,this._majorAxis.getDiscreteSpacing()/2),yMirrorMode:this.yMirrorMode},t=this,n=[];return this._lineObjectsModel.update(this._polysData,e),this.beforeLayerUpdates(this._lineObjectsModel.getLineObjectsSettings()),this._lineLayer.renderer.edgeBleed={left:this._edgeBleed,right:this._edgeBleed,top:1,bottom:this._edgeBleed},this._lineLayer.update(this._lineObjectsModel.getLineObjectsSettings()),this.preRender(this._lineLayer._lineObjects),n.push(this._lineLayer.render()),this._oobLayer&&(this._oobLayer.renderer.edgeBleed={left:this._edgeBleed,right:this._edgeBleed,top:0,bottom:this._edgeBleed},this._oobLayer.update(this._lineObjectsModel.getPointsOutOfRange(),e),n.push(this._oobLayer.render())),this._labelLayer&&(this._layoutMode>this.ShowFlags.XSMALL&&this._showDataPointLabels&&this._showDataPoints?(this._labelLayer.renderer.edgeBleed={left:this._edgeBleed,right:this._edgeBleed,top:0,bottom:this._edgeBleed},this._labelLayer.update(this._lineLayer.getLineObjects(),e),this._labelLayer.show(),n.push(this._labelLayer.render())):this._labelLayer.hide()),this._rangeSelectionLayer&&n.push(this.renderRangeSelections()),u.all(n).then(function(){return t.afterPaint(e.axesSettings[0].topCutoff,e.axesSettings[0].bottomCutoff)})},clear:function(){this._super(),this.layers.forEach(function(e){e.clear()})},_getAxisDetails:function(e){var t=e.getPlotMin(),n=e.getPlotMax(),i=n-t,r=e.getPadding(),o=r.top,s=e.rect.height-r.bottom,a=0;return a=t>0?s:n<0?o:Math.ceil(e.getPositionOfValue(0)+1e-5),{plotMin:t,plotMax:n,posMin:e.getPositionOfValue(t),posMax:e.getPositionOfValue(n),plotRange:i,topCutoff:o,bottomCutoff:s,areaStartBase:a,zeroPos:Math.floor(e.getPositionOfValue(0))-.5}}})}),define("extensions.qliktech/linechart/linechart-properties",["client.utils/default-property-logic","objects.utils/continuous-utils","client.property-panel/default-axis-properties-logic"],function(e,t,n){function i(e,t){var n=t.getDimensions(),i=t.getMeasures();return"area"===e.lineType&&n.length+i.length>2}return{type:"items",component:"accordion",items:{data:{uses:"data",items:{dimensions:{items:{nullSuppression:{show:function(e,i,r){var o=n.isFirstDimension(e,i),s=t.isContinuousChart(r.layout);return!(o&&s)}}}}}},sorting:{type:"items",translation:"properties.sorting",items:{noContinuousSortingMessage:{component:"text",translation:"properties.sorting.noContinuousSortingMessage",show:function(e,n,i){return t.isContinuousChart(i.layout)}},defaultSorting:{uses:"sorting",show:function(e,n,i){return!t.isContinuousChart(i.layout)},items:{dimensions:{locked:function(e,t,n){return 1===n.getMeasures().length&&2===n.getDimensions().length}},measures:{locked:function(e,t,n){return 1===n.getMeasures().length&&2===n.getDimensions().length}}}}}},addons:{type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{calcCond:{uses:"calcCond"}}},refLines:{uses:"reflines"}}},settings:{uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{lineType:{ref:"lineType",type:"string",component:"item-selection-list",defaultValue:"line",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.line",value:"line"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.area",value:"area"}]},stackedProps:{type:"items",grouped:!1,items:{stackedArea:{ref:"stackedArea",translation:"properties.style.stackedArea",type:"boolean",defaultValue:!1,show:function(e,t){return i(e,t)}},separateStacking:{ref:"separateStacking",translation:"properties.separateStacking",type:"boolean",defaultValue:!0,readOnly:function(e){return!e.stackedArea},show:function(e,t){return i(e,t)}}}},scrollStartPos:{ref:"scrollStartPos",type:"number",translation:"properties.ScrollAlignment",component:"dropdown",defaultValue:0,options:[{value:0,translation:"properties.ScrollAlignStart"},{value:1,translation:"properties.ScrollAlignEnd"}],show:function(e,n,i){return!t.isContinuousChart(i.layout)}},nullMode:{type:"string",component:"dropdown",ref:"nullMode",translation:"properties.nullMode",options:[{value:"gap",translation:"properties.nullMode.gap"},{value:"connect",translation:"properties.nullMode.connect"},{value:"zero",translation:"properties.nullMode.zero"}],defaultValue:"gap"},dataPointSettings:{type:"items",grouped:!1,snapshot:{tid:"property-dataPoint"},items:{dataPoints:{ref:"dataPoint.show",translation:"properties.dataPoints.showDataPoints",type:"boolean",defaultValue:!1},showDataPointLabels:{ref:"dataPoint.showLabels",translation:"properties.dataPoints.labelmode",type:"boolean",component:"switch",defaultValue:!1,show:function(e){return e.dataPoint&&e.dataPoint.show},options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]}}},gridLines:{type:"items",snapshot:{tid:"property-gridLines"},items:{showGridLines:{ref:"gridLine.auto",type:"boolean",translation:"properties.gridLine.spacing",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},gridSpacing:{type:"number",component:"dropdown",ref:"gridLine.spacing",defaultValue:2,options:[{value:0,translation:"properties.gridLine.noLines"},{value:1,translation:"properties.gridLine.wide"},{value:2,translation:"properties.gridLine.medium"},{value:3,translation:"properties.gridLine.narrow"}],show:function(e){return e.gridLine&&!e.gridLine.auto}}}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{colorMode:{options:e.getLogicFor("hard","linechart").color.colorMode.options}}},legend:{items:{show:{snapshot:{tid:"property-legend"}}}}}},dimensionAxis:{uses:"axis.dimensionAxis"},measureAxis:{uses:"axis.flippableMeasureAxis",items:{scale:{type:"items",items:{logScale:{ref:"measureAxis.logarithmic",translation:"properties.axis.logarithmicScale",type:"boolean"},label:{component:"text",translation:"properties.axis.logarithmicScaleNote",show:function(e){return e.measureAxis&&e.measureAxis.logarithmic}}}}}}}}}}}),define("extensions.qliktech/linechart/linechart-data",["client.utils/property-resolver"],function(e){function t(e){var t,n=e.getDimensions(),i=e.getMeasures();1===n.length&&1===i.length?0!==e.getSorting()[0]&&e.changeSorting(1,0):n.length>1&&1===i.length&&0!==(t=e.getSorting().indexOf(0))&&e.changeSorting(t,0)}function n(t,n){var i=n.getDimensions(),r=n.getMeasures(),o=e.getValue(t,"color.mode");i.length>1&&e.setValue(t,"color.persistent",!0),"byMeasure"===o&&i.length>1?e.setValue(t,"color.mode","byDimension"):"byDimension"===o&&i.length<=1&&r.length<=1?e.setValue(t,"color.mode","primary"):"byExpression"===o&&0===r.length&&e.setValue(t,"color.mode","primary")}return{dimensions:{min:1,max:function(e){return e>=2?1:2},description:function(e,t,n){return n>1?0===t?"area"===e.lineType&&!0===e.stackedArea?"Stacks":"Groups":"area"===e.lineType?"Areas":"Lines":"area"===e.lineType?"Area":"Line"},add:function(e,i,r){r.getDimensions().length>1&&(i.qHyperCubeDef.qMode="K",i.qHyperCubeDef.qAlwaysFullyExpanded=!0),t(r),n(i,r)},move:function(e,i,r){r.getDimensions().length>1&&(i.qHyperCubeDef.qMode="K",i.qHyperCubeDef.qAlwaysFullyExpanded=!0),t(r),n(i,r)},remove:function(e,t,i){var r=i.getDimensions();n(t,i),1===r.length&&(t.qHyperCubeDef.qMode="S")},autoSort:function(e,t,n,i){n&&(-1!==n.indexOf("$numeric")||-1!==n.indexOf("$date")||-1!==n.indexOf("$timestamp")?i.qSortByNumeric=1:-1===n.indexOf("$text")&&-1===n.indexOf("$ascii")||(i.qSortByAscii=1))}},measures:{min:1,max:function(e){return e>=2?1:15},description:function(){return"Height"},add:function(e,i,r){t(r),n(i,r)},move:function(e,i,r){t(r),n(i,r)},remove:function(e,t,i){var r=i.getDimensions();n(t,i),r.length>1?(t.qHyperCubeDef.qMode="K",t.qHyperCubeDef.qAlwaysFullyExpanded=!0):1===r.length&&(t.qHyperCubeDef.qMode="S")}}}}),define("extensions.qliktech/linechart/linechart-explore-properties",["client.utils/default-property-logic","client.utils/property-hypercube-helper","objects.utils/continuous-utils"],function(e,t,n){var i=e.getLogicFor("explore","linechart");return{type:"items",component:"accordion",items:{data:{uses:"data"},sort:{uses:"sort",show:function(e,t){return!n.isContinuousChart(t)},items:{dimensions:{locked:function(e,n){return 1===t.getNumMeasures(n)&&2===t.getNumDimensions(n)&&0===e}}}},presentation:{uses:"presentation",items:{valueLabels:{type:"boolean",component:"switch",translation:"properties.dataPoints.labelmode",diffs:["dataPoint.show","dataPoint.showLabels"],options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],setPropertyValue:function(e,t){e.dataPoint.show=t,e.dataPoint.showLabels=t},getValue:function(e){return e.dataPoint.show&&e.dataPoint.showLabels}},lineType:{ref:"lineType",type:"string",component:"item-selection-list",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.line",value:"line"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.area",value:"area"}]},logarithmic:{type:"boolean",component:"switch",translation:"properties.axis.logarithmicScale",ref:"measureAxis.logarithmic",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]}}},color:{uses:"color",items:{mode:{options:i.color.colorMode.options},colorMode:{ref:"color.mode",type:"string",component:"dropdown",options:i.color.colorMode.options,defaultValue:"primary",show:i.color.colorMode.show,globalChange:function(e,t){i.color.colorBy.globalChange(e,t,"qHyperCubeDef.")}}}}}}}),define("text!extensions.qliktech/linechart/linechart.ng.html",[],function(){return'<div class="qv-viz"></div>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist" dir="ltr"></span>\r\n<span class="qv-viz-center-disclaimer" ng-if="!dataAttributes.noDataExist && dataAttributes.onlyNanDim && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.OnlyNanData" q-title-translation="Object.Disclaimer.OnlyNanData" dir="ltr"></span>\n<div qva-chart-disclaimer attributes="dataAttributes" visible="!dataAttributes.noDataExist" direction="options.direction"></div>\n'}),define("extensions.qliktech/linechart/linechart",["jquery","util","core.utils/deferred","objects.views/charts/scrollable-chart","objects.views/charts/components/chart-component","./linearea","extensions.qliktech/linechart/linechart-properties","extensions.qliktech/linechart/linechart-data","extensions.qliktech/linechart/linechart-explore-properties","objects.backend-api/stacked-api","text!./linechart.ng.html","objects.views/charts/disclaimers/chart-utils","objects.views/charts/utils/time-utils","objects.extension/object-conversion","objects.utils/continuous-utils"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f){"use strict";function m(e){var t,n,i=0,o=0;t=this.components.measureAxis,!e.dataPoint.show||this._layoutMode<=r.prototype.ShowFlags.XSMALL?(i=0,o=0):e.dataPoint.show&&(n=15,e.dataPoint.showLabels&&(i=n+7,o=0)),["near","bottom"].contains(this.components.dimensionAxis.dock)?t.setPadding(i,0,o,0):t.setPadding(o,0,i,0)}function g(e,t,n){return e===t&&(e>0&&(e+=n),t<0&&(t-=n)),t>=1?t=1:t>0?t=Math.pow(10,Math.floor(Math.log(t)/Math.log(10))):e<=-1?e=-1:e<0&&(e=-Math.pow(10,Math.floor(Math.log(-e)/Math.log(10)))),{max:e,min:t}}var v,y={NONE:0,ONE_DIM:1,TWO_DIM:2};return v=i.extend("LineChart",{namespace:".linechart",init:function(t,n,i,r,s){var a,l=e.extend(!0,{},i);i=e.extend(!0,i||{},{components:{dataArea:{clazz:o},miniChart:{components:{dataArea:{clazz:o}}}}},l),this._super(t,n,i,r,s),this.components.miniChart&&(a=this.components.miniChart,this.components.miniChart.setBackendApi(this.backendApi),this.components.scrollArea.setMiniChart(a),a.setColorMap(this.providers.colorMap),a.components.measureAxis.setDock("left"),a.components.dimensionAxis.setDock("bottom"),a.components.dataArea.setMinorAxis(a.components.measureAxis),a.components.dataArea.setMajorAxis(a.components.dimensionAxis),a.setOrientation("vertical"))},initSelections:function(){if(!this.options._disableSelections){this.selections.types.range.setComponent("x",this.components.dimensionAxis),this.selections.types.range.setComponent("y",this.components.measureAxis),this.selections.Select.bind(function(e,t){this.onSelection.Select.apply(this,[e,t,this.selections.getActiveType().activeComponent.getSelectionIndices(),"L"])}.bind(this));var e=function(e){this.onSelection.scheduleInvalidation.call(this),this._activeDimAxis.setSelectedRanges(e),this.components.dataArea.updateRangeSelection(e),this.components.miniChart.components.dataArea.updateRangeSelection(e)};this.selections.UpdateRanges.bind(e.bind(this)),this.selections.Clear.bind(e.bind(this,[])),this.selections.Deactivated.bind(e.bind(this,[]))}this._super()},_postResize:function(){this.components.measureAxis.setNiceNumberEnabled(this._layoutMode>r.prototype.ShowFlags.XSMALL),this._super()},partialUpdate:function(){return this.components.dataArea.freezeZOrdering(),this._super.apply(this,[].slice.call(arguments))},isValid:function(e){return this._super(e)&&!this.supressChartRendering},_paint:function(){if(!this.isValid(this._data))return this.clear();this._super();var e,t=this.components.scrollArea,i=[];m.call(this,this._data),this.layout(),!this.isDimensionContinuous&&this._dataForMiniChartChanged&&this.components.scrollArea.isVisible()&&this.components.scrollArea.getUseMiniChart()&&this.components.miniChart&&(i.push(this.components.miniChart.setData(this._data)),this._dataForMiniChartChanged=!1);var r=this.checkPage();if(r)i.push(r);else{for(e in this.components)i.push(this.components[e].invalidateDisplay("LineChart.paint"));t.viewState.min+t.viewState.range>t.fullState.max&&t.setOffset(t.fullState.max-t.viewState.range)}return n.all(i)},prePaint:function(e){this._super(e);var t=!1,n=f.isContinuousChart(e);if(2===e.qHyperCube.qDimensionInfo.length)if(!n&&e.qHyperCube.qStackedDataPages[0]){var i=e.qHyperCube.qStackedDataPages[0].qData[0];i&&(t=i.qSubNodes.some(function(e){return e.qDown>0}))}else{var r=e.qHyperCube.qDimensionInfo[1];t=r.qStateCounts.qLocked+r.qStateCounts.qOption+r.qStateCounts.qSelected>d.maxNumberOfLines}h.applyDisclaimerAttributes({title:e.qHyperCube.qDimensionInfo.length>1,bottom:!0,supportRangeOverZero:!e.measureAxis.logarithmic,paging:1===e.qHyperCube.qDimensionInfo.length,explicitLimitedData:t},this.$scope.dataAttributes,this.$element,this.$scope,e);var o=e.qHyperCube.qDimensionInfo[0];this.$scope.dataAttributes.onlyNanDim=!!n&&!!o&&(o.qMax<o.qMin||"NaN"===o.qMax),this.supressChartRendering=this.$scope.dataAttributes.noDataExist||this.$scope.dataAttributes.onlyNanDim},updateData:function(e){return this.setIsDimensionContinuous(f.isContinuousChart(e)),this._setActiveDimensionAxis(e),this.selectionsCache.setSelectionMode(this.isDimensionContinuous?this.selectionsCache.SELECTION_MODE.VALUE:this.selectionsCache.SELECTION_MODE.VALUE|this.selectionsCache.SELECTION_MODE.ROW),this._super(e)},_updateData:function(e){var t=[];this._checkPage=!1,this._data=e,this.isDimensionContinuous||(this._dataForMiniChartChanged=!0),this._disablePagingTransitions(),this.components.dataArea.unFreezeZOrdering(),this.isStacked=("stackedArea"===e.lineType||"area"===e.lineType&&e.stackedArea)&&(e.qHyperCube.qDimensionInfo.length>1||e.qHyperCube.qMeasureInfo.length>1),this.components.measureAxis.isStacked=this.isStacked,!this.isDimensionContinuous&&e.qHyperCube.qDimensionInfo.length>1&&!this.isStacked?this.components.scrollArea.setUseMiniChart(!1):this.components.scrollArea.setUseMiniChart(!0);var i=null;if(this._pagingMode=y.NONE,this.components.dataArea.setSelectionIndices([0]),e.qHyperCube.qDimensionInfo.length>1){var r=e.qHyperCube.qDimensionInfo[1].qStateCounts.qOption+e.qHyperCube.qDimensionInfo[1].qStateCounts.qSelected;i=e.qHyperCube.qStackedDataPages&&e.qHyperCube.qStackedDataPages.length&&e.qHyperCube.qStackedDataPages[0].qData&&e.qHyperCube.qStackedDataPages[0].qData[0]?e.qHyperCube.qStackedDataPages[0].qData[0].qSubNodes.length+e.qHyperCube.qStackedDataPages[0].qData[0].qDown+e.qHyperCube.qStackedDataPages[0].qData[0].qUp:null,this.components.dimensionAxis.setSelectionIndices([0]),!e.qHyperCube.qDimensionInfo[1].qLocked&&r>1?this.components.dataArea.setSelectionIndices([1]):this.components.dataArea.setSelectionIndices([0]),this._pagingMode=y.ONE_DIM,this.isStacked=!0}else i=e.qHyperCube.qSize.qcy,e.qHyperCube.qSize.qcy>e.qHyperCube.qDataPages[0].qArea.qHeight&&(this._pagingMode=y.ONE_DIM);this.components.dataArea.setIsDimensionContinuous(this.isDimensionContinuous),this.isDimensionContinuous?this._pagingMode=y.NONE:(this.components.dimensionAxis.isDiscrete()||(this._pagingMode=y.NONE),this.components.dimensionAxis.setNumDiscreteUnits(i));var o,s={axes:{measureAxis:{component:this.components.measureAxis,data:e.measureAxis,dataIndices:e.qHyperCube.qMeasureInfo.map(function(e,t){return t})},dimensionAxis:{component:this.components.dimensionAxis,data:e.dimensionAxis,dataIndices:e.qHyperCube.qDimensionInfo.map(function(e,t){return t})},timeAxis:{component:this.components.timeAxis,data:e.dimensionAxis},continuousAxis:{component:this.components.continuousAxis,data:e.dimensionAxis}},refLineLabels:{labels:{data:e.refLine.refLines,component:this.components.refLineLabels,axis:this.components.measureAxis}},refLines:{component:this.components.refLines},axisTitles:{dimensionAxisTitle:{component:this.components.dimensionAxisTitle,data:e.dimensionAxis},measureAxisTitle:{component:this.components.measureAxisTitle,data:e.measureAxis}}},a=this.components.dimensionAxisTitle,l=this.components.measureAxisTitle;t.push(this.components.dataArea.setData(e)),t.push(this.components.colorLegend.setData(e)),this.providers.colorMap.getLegendDataProvider().setLegendMarker(e.dataPoint.show?["line","circle"]:["line"]),t.push(a.setData(e)),t.push(l.setData(e)),this._super(e,s),o=this.getSnapshotStoredChartData();var c=this.options.viewState;return this._readStoredData&&o?(this.components.dimensionAxis.setInnerOffset(o.axisInnerOffset),this.components.scrollArea.setOffset(o.scrollOffset),this.components.scrollArea.setViewRange(o.viewRange)):c?(this.components.dimensionAxis.setInnerOffset(c.axisInnerOffset),this.components.scrollArea.setOffset(c.scrollOffset),this.components.scrollArea.setViewRange(c.viewRange)):isNaN(e.scrollStartPos)?this.isDimensionContinuous||(this.components.dimensionAxis.setInnerOffset(0),this.components.scrollArea.setOffset(0)):this.components.scrollArea.setRelativeOffset(e.scrollStartPos),this.isDimensionContinuous||(this._checkPage=!0),n.all(t)},updateDataArea:function(e){var t="stackedArea"===e.lineType||"area"===e.lineType&&e.stackedArea?"stackedArea":e.lineType;this._super.apply(this,[].slice.call(arguments)),this.components.dataArea.setLineType(t),"byExpression"===e.color.mode?this.components.dataArea.interpolateVaryingColors=!e.color.expressionIsColor&&-1!==["sg","dg"].indexOf(e.color.measureScheme):this.components.dataArea.interpolateVaryingColors=!1,this.components.miniChart&&(this.components.miniChart.components.dataArea.setLineType(t),this.components.miniChart.components.dataArea.setNullMode(e.nullMode),this.components.miniChart.components.dataArea.setSeparateStacking(e.separateStacking),this.components.miniChart.setLogScale(e.measureAxis.logarithmic)),this.components.dataArea.setShowDataPoints(e.dataPoint.show),this.components.dataArea.setNullMode(e.nullMode),this.components.dataArea.setSeparateStacking(e.separateStacking),this.components.dataArea.setShowDataPointLabels(e.dataPoint.showLabels),this.components.dataArea.updateNow(["properties"])},updateAxis:function(e,n){this._super(e,n);var i,r,o,s,a,l,c,u=this.getSnapshotStoredChartData();this.components.dimensionAxis.setData(e),this._activeDimAxis.setData(e),o=Math.min.apply(this,e.qHyperCube.qMeasureInfo.filter(function(e){return!isNaN(e.qMin)}).map(function(e){return e.qMin})),s=Math.max.apply(this,e.qHyperCube.qMeasureInfo.filter(function(e){return!isNaN(e.qMax)}).map(function(e){return e.qMax})),t.isNumeric(o)||(o=-1),t.isNumeric(s)||(s=1),l=!(a=n.axes.measureAxis).data.autoMinMax&&["min","minMax"].contains(a.data.minMax)?Number(a.data.min):null,c=!a.data.autoMinMax&&["max","minMax"].contains(a.data.minMax)?Number(a.data.max):null,(i=this.components.measureAxis).setWhiteSpaceOptimizingEnabled(!0),i.setRealDataRange(void 0,void 0);var h=this.components.dataArea.getMajorAxisData(),d=this.components.dataArea.getMinorAxisData();if(this.components.dimensionAxis.setDataRange(h.data,h.info),r=0,s<o?(s=10,o=-10):s===o&&(s?r=Math.abs(s?.2*s:0):(s=10,o=-10)),this._readStoredData&&u&&u.dataRanges)this.setAxisDataRange(i,u.dataRanges[0].max,u.dataRanges[0].min,c,l,r);else if(d&&("stackedArea"===e.lineType||"area"===e.lineType&&e.stackedArea)&&(e.qHyperCube.qMeasureInfo.length>1||e.qHyperCube.qDimensionInfo.length>1))this.setAxisDataRange(i,d.max,d.min,c,l,r);else if("line"!==e.lineType)if(this._data.measureAxis.logarithmic){var p=g(s,o,r);this.setAxisDataRange(i,p.max,p.min,c,l,r)}else this.setAxisDataRange(i,s>0?s+r:0,o<0?o-r:0,c,l,r);else this.setAxisDataRange(i,s>0?s+r:Math.min(0,s+r),o<0?o-r:Math.max(0,o-r),c,l,r);this.updateTimeAxis(),m.call(this,e),this.components.dimensionAxisTitle.setSelectionsEnabled(!!this.selections),this.components.measureAxisTitle.setSelectionsEnabled(!!this.selections)},getPreferredSize:function(){return this._super()},destroy:function(){return this._super()}}),{type:"linechart",BackendApi:c,template:u,View:v,definition:s,softDefinition:l,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qMode:"S",qAlwaysFullyExpanded:!0,qInitialDataFetch:[{qTop:0,qHeight:500,qLeft:0,qWidth:17}],qSuppressZero:!1,qSuppressMissing:!0}},data:a,support:{cssScaling:!1,snapshot:!0,export:!0,exportData:!0,sharing:!0,viewData:!0},options:{selections:{dataArea:{},range:{},colorLegend:{}},tooltips:{}},importProperties:function(e,t,n){var i=p.axisChart.importProperties.apply(p,[e,t,n]),r=i.qProperty;return r.qHyperCubeDef.qDimensions.length>1&&(r.qHyperCubeDef.qMode="K"),r.color&&"byDimension"===r.color.mode&&r.qHyperCubeDef.qDimensions.length<=1&&r.qHyperCubeDef.qMeasures.length<=1&&p.changeProperty("color.mode","primary",i),i},exportProperties:p.axisChart.exportProperties.bind(p)}}),define("extensions.qliktech/treemap/treemap-node",["objects.views/charts/shapes/container","objects.views/charts/shapes/display-object","objects.views/charts/renderers/canvas-renderer","objects.views/charts/renderers/canvas/rect","objects.views/charts/shapes/rect","general.utils/shapes/rect"],function(e,t,n,i,r,o){var s=e.extend("TreemapNode",{init:function(e,t,n){this._super(),this.x=0,this.y=0,this.width=0,this.height=0,this.data.area=0,this.data.value=t||0,this.data.label=e||"",this.data.valueLabel=n||"",o.apply(this,[0,0,0,0])},pointInside:t.prototype.pointInside,containsPoint:r.prototype.containsPoint,intersectsLocalLine:r.prototype.intersectsLocalLine,getLocalPoints:r.prototype.getLocalPoints,getLocalBoundingRect:r.prototype.getLocalBoundingRect,_calculateBounds:t.prototype._calculateBounds});return Object.keys(r.prototype).forEach(function(e){!s.prototype.hasOwnProperty(e)&&["pointInside","intersectsLine","getBoundingRect","getPoints"].indexOf(e)<0&&(s.prototype[e]=r.prototype[e])}),n._registerRenderFn(i.render,s),s}),define("extensions.qliktech/treemap/treemap-layout",["core.utils/class","extensions.qliktech/treemap/treemap-node","translator"],function(e,t,n){function i(e,t){var n,r;for(n=0;n<e.length;n++)(r=e[n]).x=t-r.x-r.width,r._children&&r._children.length&&i(r._children,t)}function r(e,t){var n,i;for(n=0;n<e.length;n++)(i=e[n]).y=t-i.y-i.height,i._children&&i._children.length&&r(i._children,t)}var o,s={NONE:0,NONE_COLLAPSED:.1,LEAF:1,HEADER:2,OVERLAY:3};return o=e.extend("TreemapLayout",{init:function(){this.cellPadding=2,this.collapseHeadersOnSmallBranches=!0,this.labeling={},this.othersLabel=n.get("properties.dimensionLimits.others")},sort:function(){return this},weigh:function(e,n,i){if(!e||!e.length)return this;i=i||0;for(var r,o,s=e.length,a=0,l=0,c=e[0].parent.data.value;s;)a+=e[--s].data.value;for(s=e.length,r=Math.max(a,c);s;)e[--s].data.weight=r?e[s].data.value/r:0,l+=e[s].data.weight,e[s].isBranch&&this.weigh(e[s].children,n,i+1);return 1-l>1e-5&&((o=new t).data.label="",o.data.weight=1-l,o.x=0,o.y=0,o.width=0,o.height=0,o.data.qElemNo=-3,o.data.qType="O",o.data.isFakeOthers=!0,o.data.value=c-a,o.data.depth=(e[0].parent.data.depth||0)+1,e[0].parent.addChild(o),e[0].parent.children!==e&&e.push(o)),this},layout:function(){return this},arrange:function(e,t,n,o,a,l,c,u){if(!e||!e.length)return this;this.layout(e,t,n,o,a);var h,d,p,f=this.cellPadding;for(p=0;p<e.length;p++)(h=e[p]).visible=h.width>0&&h.height>0,h.isBranch?(h.width=Math.max(0,h.width-f),h.height=Math.max(0,h.height-f),h.x+=.5*f,h.y+=.5*f,h.visible=h.width>0&&h.height>0,h.data.labelType=this._getLabelType(l,!0,h.data.area),d=h.data.labelType!==s.HEADER?0:24,h.data.labelType===s.NONE_COLLAPSED&&(d=4,h.data.labelType=s.NONE),this.arrange(h.children,h.width,h.height-d,h.x,h.y+d,l+1)):h.data.labelType=this._getLabelType(l,!1,h.data.area);return 0===l&&(1===c&&i(e,t),1===u&&r(e,n)),this},_getLabelType:function(e,t,n){return t?e>this.labeling.headers.numLevels?s.NONE:e===this.labeling.headers.numLevels?this.labeling.overlay.show&&n>=4e3?s.OVERLAY:s.NONE:this.collapseHeadersOnSmallBranches&&n<8e3?s.NONE_COLLAPSED:n<4e3?s.NONE:s.HEADER:n<4e3||"none"===this.labeling.leaves.type?s.NONE:s.LEAF}}),o.LABEL=s,o}),define("extensions.qliktech/treemap/treemap-squarified-layout",["extensions.qliktech/treemap/treemap-layout"],function(e){"use strict";function t(e,t,n){var r,o,s,a=n.x,l=n.y,c=n.shortSide,u=e.length,h=0;if(n.direction===i){for(;h<u;h++)(s=e[h]).data.area<=0?(o=0,r=c):(o=c*s.data.area/t,r=s.data.area/o),s.x=Number(a.toFixed(5)),s.y=Number(l.toFixed(5)),s.width=Number(r.toFixed(5)),s.height=Number(o.toFixed(5)),l+=o;n.x+=r,n.width-=r}else{for(;h<u;h++)(s=e[h]).data.area<=0?(r=0,o=c):(r=c*s.data.area/t,o=s.data.area/r),s.x=Number(a.toFixed(5)),s.y=Number(l.toFixed(5)),s.width=Number(r.toFixed(5)),s.height=Number(o.toFixed(5)),a+=r;n.y+=o,n.height-=o}}function n(e,t,n,i){for(var r,o=Number.MAX_VALUE,s=0,a=t*t,l=n*n,c=e.length;c;)e[--c].data.area<o&&(o=e[c].data.area),e[c].data.area>s&&(s=e[c].data.area);return r=Math.max(a*s/l,l/(a*o)),i.data.area<o&&(o=i.data.area),i.data.area>s&&(s=i.data.area),l=(n+i.data.area)*(n+i.data.area),Math.max(a*s/l,l/(a*o))<=r}var i=0;return e.extend({init:function(){this._super()},sort:function(e){var t,n;if(!e||!e.length)return this;for(e.sort(function(e,t){return"O"===t.data.qType?-1:"O"===e.data.qType?1:t.data.weight-e.data.weight}),n=e.length,t=0;t<n;t++)e[t].isBranch&&this.sort(e[t].children);return this},layout:function(e,r,o,s,a){if(!e||!e.length)return this;var l,c,u,h,d={x:s,y:a,width:r,height:o,direction:o<=r?i:1,shortSide:Math.min(o,r)},p=0,f=[],m=r*o;for(c=e.length;c;)e[--c].data.area=m*e[c].data.weight;for(c=0;c<e.length;)l=e[c],d.direction===i?(h=d.height*l.data.area/(p+l.data.area),u=l.data.area/h):(u=d.width*l.data.area/(p+l.data.area),h=l.data.area/u),!f.length||n(f,d.shortSide,p,l)?(p+=l.data.area,f.push(l),c++):(t(f,p,d),p=0,f=[],d.shortSide=Math.min(d.width,d.height),d.direction=d.height<=d.width?i:1);return f.length&&t(f,p,d),this}})}),define("extensions.qliktech/treemap/treemap-hierarchy",["core.utils/class","extensions.qliktech/treemap/treemap-node"],function(e,t){"use strict";function n(e,i,o,s,a,l,c){var u,h,d,p,f,m=i?i.length:0;for(s=s||0,c=c||0,f=0;f<m;f++)u=null,h=(d=i[f]).children,d.data.qType===r.PSEUDO&&(c=f),d.data.qType!==r.TOTAL&&(h.length||"N"===d.data.qType?1===h.length&&h[0].data.qType===r._MEASURE?(p=(p=h[0].children)?p[0]:null)&&!isNaN(p.data.qValue)&&p.data.qValue>0&&((u=new t(d.data.qText,p.data.qValue,l?l.formatValue(p.data.qValue):p.data.qText)).data.row=d.data.rowIndex,u.data.qType=d.data.qType,u.data.qElemNo=d.data.qElemNo,d.cacheItem&&d.cacheItem.addShape("dataArea",u),u.data.cacheItem=d.cacheItem):1===h.length&&h[0].data.qType===r.VALUE?!isNaN(h[0].data.qValue)&&h[0].data.qValue>0&&((u=new t(d.data.qText,h[0].data.qValue,l?l.formatValue(h[0].data.qValue):h[0].data.qText)).data.row=d.data.rowIndex,u.data.qType=d.data.qType,u.data.qElemNo=d.data.qElemNo,d.cacheItem&&d.cacheItem.addShape("dataArea",u),u.data.cacheItem=d.cacheItem):d.data.qMaxPos>0&&((u=new t(d.data.qText,d.data.qMaxPos)).data.qElemNo=d.data.qElemNo,u.data.row=d.data.rowIndex,u.data.qType=d.data.qType,u.data.cacheItem=d.cacheItem,u.data.addMeasures=!0,d.cacheItem&&d.cacheItem.addShape("dataArea",u),h.length&&n(u,h,o,s+1,a,l,c)):!isNaN(d.data.qValue)&&d.data.qValue>0&&((u=new t(d.data.qText,d.data.qValue,d.data.qText)).data.qType=d.data.qType,u.data.qElemNo=d.data.qElemNo,u.data.row=d.data.rowIndex,u.data.isMeasure=s===o,d.cacheItem&&d.cacheItem.addShape("dataArea",u),u.data.cacheItem=d.cacheItem),u&&(u.data.depth=s,isNaN(c)||(u.data.measureIndex=c),e.addChild(u)))}function i(e){var t=[];return e.forEach(function(e){t=t.concat(e.children)}),t}var r={PSEUDO:"P",TOTAL:"T",VALUE:"V",NORMAL:"N",OTHERS:"O",ROOT:"R",_MEASURE:"_M"};return e.extend("TreemapHierarchy",{init:function(e){this.root=e||new t,this._pseudoDimPos=0,this.labeling={values:{show:!1}}},setData:function(e,t){this._pseudoDimPos=e.pseudoDimPos||0,this._numMeasures=e.qHyperCube.qMeasureInfo.length,this._numDimensions=e.qHyperCube.qDimensionInfo.length,this._dimensionLocks=e.qHyperCube.qDimensionInfo.map(function(e){return e.qLocked}),this._selectionStates=e.qHyperCube.qDimensionInfo.map(function(e){return e.qStateCounts});var i=this.labeling.values.show&&this.measureFormatters&&this.measureFormatters[0]&&"U"===this.measureFormatters[0].type?this.measureFormatters[0]:null,o=e.qHyperCube.qStackedDataPages[0].qData,s=e.qHyperCube.qMeasureInfo.map(function(e){return e.qFallbackTitle}),a=e.qHyperCube.qMeasureInfo.length>1?this._pseudoDimPos:-1;this.root.removeChildren(),o&&o.length&&(this.root.data.value=o[0].qMaxPos,this.root.data.qType=r.ROOT,n(this.root,t.children,a,0,s,i))},getDimensionIndexFromNode:function(e){var t,n,i=0;if(!e)return-2;if(e.data.qType===r.PSEUDO)return-1;for(n=(t=e).parent;t&&n&&n!==this.root;)n=(t=n).parent,t.data.qType!==r.PSEUDO&&i++;return i},getSelectableCacheItems:function(e){if(!e||!e.length)return[];var t,n=e[0],o=n.children,s=this.getDimensionIndexFromNode(n);return n.data.qType===r.PSEUDO?o.length?this.getSelectableCacheItems(i(e)):[]:this._dimensionLocks[s]?o.length?this.getSelectableCacheItems(i(e)):[]:(t=this.getCacheItemsFromNodes(e)).length<=1&&this._selectionStates[s].qSelected&&!this._selectionStates[s].qOption&&o.length?this.getSelectableCacheItems(i(e)):t},getCacheItemsFromNodes:function(e){var t,n=e?e.length:0,i=[];for(t=0;t<n;t++)e[t].data.cacheItem&&i.indexOf(e[t].data.cacheItem)<0&&i.push(e[t].data.cacheItem);return i}})}),define("extensions.qliktech/treemap/treemap-area",["general.utils/color","./treemap-squarified-layout","./treemap-hierarchy","client.utils/property-resolver","objects.views/charts/renderers/canvas-renderer","objects.views/charts/shapes/rect","objects.views/charts/shapes/container","objects.views/charts/shapes/text","objects.views/charts/components/chart-component","objects.views/charts/chart-style-service","core.utils/deferred","client.utils/theme/modern/theme","core.utils/feature-flags"],function(e,t,n,i,r,o,s,a,l,c,u,h,d){"use strict";function p(t,n){return S.width=8,S.height=8,w.save(),w.fillStyle=e.toRGBA(t),w.strokeStyle=e.toRGBA(t,n),w.lineWidth=2,w.scale(1,1),w.beginPath(),w.moveTo(5,-1),w.lineTo(-1,5),w.moveTo(9,3),w.lineTo(3,9),w.stroke(),w.restore(),w.createPattern(S,"repeat")}function f(t,n){var i,r,o,s,l,c,u,h=t?t.length:0,p="leaf",m=new e(this._style.overlay.label.color.light),g=new e(this._style.overlay.label.color.dark);for(i=0;i<h;i++)if(r=t[i],p=r.data.labelType,r.isBranch?(f.apply(this,[t[i].children,n+1]),c=this._branchLabelContainer):c=this._leafLabelContainer,r.data.labelType){switch((s=r.data.label)&&s.length>512&&(s=s.substr(0,256)),this.labeling.values.show&&1===p&&r.data.valueLabel&&(s=[s,r.data.valueLabel]),r.data.labelShape?r.data.labelShape.parent||c.addChild(r.data.labelShape):(r.data.labelShape=new a,r.data.labelShape.setText(s),c.addChild(r.data.labelShape)),l={x:r.x,y:r.y,width:r.width,height:r.height,maxHeight:r.height-4,maxWidth:r.width-8,align:this.yMirrorMode?"right":"left",baseline:"top"},p){case 3:r.data.labelFill||(u=r.descendants,r.data.labelFill=u.reduce(function(e,t){return t.data.isColorDark?e+t.data.value:e},0)>r.data.value/2?m:g,r.data.labelStroke=r.data.labelFill===m?"rgba(33, 33, 33, 0.4)":"rgba(230, 230, 230, 0.4)",r.data.labelFill=r.data.labelFill.toRGBA(),r.data.labelShape.strokeFirst=!0),l.fill=r.data.labelFill,l.stroke=r.data.labelStroke,l.maxNumLines=/\s+/.test(r.data.label)?2:1,o=Math.round(.1*Math.sqrt(2*r.data.area)),d.THEMING?l.font="bold "+o+"px 'QlikView Sans'":l.font=this._styleService.getFont(y,"overlay.label",null,null,o),l.strokeWidth=o>64?2:1,l.align="center",l.baseline="middle";break;case 2:l.fill=this._style.branch.label.color,l.stroke=void 0,l.x+=4,l.width-=8,l.font=this._style.branch.label.font,l.baseline="middle",l.maxNumLines=1,l.height=b;break;default:l.fill=r.data.isColorDark?this._style.leaf.label.color.light:this._style.leaf.label.color.dark,l.x+=4,l.y+=4,l.width-=8,l.height-=8,l.font=this.labeling.leaves.type===x.DYNAMIC?this._styleService.getFont(y,"leaf.label",null,null,Math.round(.1*Math.sqrt(2*r.area))):this._style.leaf.label.font,l.baseline="top",l.maxNumLines=this.labeling.values.show?[-1,1]:[-1]}r.data.labelShape.attrs(l)}else r.data.labelShape&&r.data.labelShape.detach()}function m(t){var n,i,r,o=t?t.length:0,s=this._colorMap;for(n=0;n<o;n++)t[n].isBranch?(t[n].fill=this._style.branch.fill,t[n].stroke=null,m.call(this,t[n].children)):t[n].data.isInitiated||(r=[],"P"!==t[n].data.qType&&void 0!==t[n].data.qElemNo&&r.push(t[n].data.qElemNo),t[n].ancestors.forEach(function(e){["A","N","O"].contains(e.data.qType)&&r.push(e.data.qElemNo)}),r.reverse(),t[n].data.isInitiated=!0,t[n].data.color=s.getColor(r,t[n].data.value,t[n].data.measureIndex||0,t[n].data.row),i=t[n].data.isFakeOthers?this._branchColorAtDepth[t[n].data.depth]:t[n].data.color,t[n].data.isColorDark=e.getBestContrast(i,q,C)===q,t[n].fill=t[n].data.isFakeOthers?this._fakeOthersPatternAtDepth[t[n].data.depth]:t[n].data.color.toRGBA(),t[n].stroke=this._sheetBackgroundStroke,t[n].strokeWidth=1)}function g(e){return d.THEMING?{backgroundColor:e.getStyle("","backgroundColor"),branch:{fill:e.getStyle("branch","backgroundColor"),label:{color:e.getStyle("branch.label","color"),font:"normal "+e.getStyle("branch.label","fontSize")+" 'QlikView Sans'"}},leaf:{border:{width:{selected:2},color:{selected:"#000000"}},label:{font:"normal "+e.getStyle("leaf.label","fontSize")+" 'QlikView Sans'",color:{light:"#E6E6E6",dark:"#595959"}}},overlay:{label:{color:{light:"rgba(222,222,222,0.4)",dark:"rgba(33,33,33,0.4)"}}}}:{backgroundColor:e.getValue(y,null,"backgroundColor"),branch:{fill:e.getValue(y,"branch","fill"),label:{color:e.getValue(y,"branch.label","color"),font:e.getFont(y,"branch.label")}},leaf:{border:{width:{selected:e.getValue(y,"leaf.border","width","selected")},color:{selected:e.getValue(y,"leaf.border","color","selected")}},label:{font:e.getFont(y,"leaf.label"),color:{light:e.getValue(y,"leaf.label","color","light"),dark:e.getValue(y,"leaf.label","color","dark")}}},overlay:{label:{color:{light:e.getValue(y,"overlay.label","color","light"),dark:e.getValue(y,"overlay.label","color","dark")}}}}}function v(t,n){var i=t._a+n._a*(1-t._a),r=(t._r*t._a+n._r*n._a*(1-t._a))/i,o=(t._g*t._a+n._g*n._a*(1-t._a))/i,s=(t._b*t._a+n._b*n._a*(1-t._a))/i;return 0===i&&(r=o=s=0),new e(r,o,s,1)}var y="treemap",b=24,x={NONE:"none",STATIC:"static",DYNAMIC:"dynamic"},q=new e("#eee"),C=new e("#666"),S=document.createElement("canvas"),w=S.getContext("2d");return l.extend("TreeMapArea",{init:function(){this._super.apply(this,arguments),this.renderers={cells:new r(this.container,{name:"cell-layer"}),labels:new r(this.container,{name:"label-layer"}),selections:new r(this.container,{name:"selection-layer"})},this._layout=new t,this._hierarchy=new n(this.renderers.cells.stage),this._pseudoDimPos=0,this._labelSettings={values:{show:!1},headers:{show:!0,numLevels:1},overlay:{show:!0},leaves:{show:!0,type:"static"}},this._styleService=d.THEMING?h.initializeService("object.treemap"):c.getInstance(),this._style=g(this._styleService),this._sheetBackgroundColor=new e(this._style.backgroundColor),this._sheetBackgroundStroke=e.toRGBA(this._sheetBackgroundColor,.5),this.labeling=this._labelSettings},cellPadding:2,setYMirrorMode:function(e){this.yMirrorMode!==e&&(this.yMirrorMode=e,this._yMirrorModeChanged=!0)},setColorMap:function(e){this._colorMap=e},getColorMap:function(){return this._colorMap},setPseudoDimPos:function(e){this._pseudoDimPos=e},setGlobalOpacity:function(e,t){e<1?(this._globalAlpha=e,this.toggleCacheItem()):this._super(e,t)},setDimensionTree:function(e){this._tree=e,this.invalidateProperties(),this.invalidateDisplay()},_updateSize:function(){this.invalidateDisplay()},_updateProperties:function(){if(this._data){this._style=g(this._styleService),this._sheetBackgroundColor=new e(this._style.backgroundColor),this._sheetBackgroundStroke=e.toRGBA(this._sheetBackgroundColor,.5),i.getValue(this._data,"labels.auto")?(this.labeling.overlay.show=!0,this.labeling.headers.numLevels=0,this.labeling.leaves.type=x.STATIC):(this.labeling.overlay.show=i.getValue(this._data,"labels.overlay",!0),this.labeling.headers.numLevels=i.getValue(this._data,"labels.headers")&&this._layoutMode>3?1:0,this.labeling.leaves.type=i.getValue(this._data,"labels.leaves")?x.STATIC:x.NONE),this.labeling.values.show=i.getValue(this._data,"labels.values",!1),this._layout.labeling=this.labeling,this._hierarchy.measureFormatters=this.measureFormatters;var t=this._hierarchy.root.children;this._hierarchy.labeling=this.labeling,this._hierarchy.setData(this._data,this._tree),this._dimension=0;var n=this.renderers.labels.stage;n.removeChildren();var r=new s;n.addChild(r);var o=new s;n.addChild(o);var a=this._data.qHyperCube.qDimensionInfo.map(function(e){return e.supressOthers});this._layout.othersLabelByDimension=this._data.qHyperCube.qDimensionInfo.map(function(e){return e.othersLabel}),this._layout.weigh(t,a).sort(t),this._leafLabelContainer=r,this._branchLabelContainer=o;var l=this._hierarchy.getSelectableCacheItems(t),c=this.selectionIdentifier?this.selectionIdentifier:"dataArea",u=0,h=0,d=l[0]?l[0].getShapes(c)[0]:null;d&&d.ancestors.forEach(function(e){e.parent&&("N"===e.data.qType&&u++,h++)}),this.setSelectionIndices([u]),this._dimension=h,this.setSelectableShapes(l);var f=new e(this._style.branch.fill),y=this._data.qHyperCube.qDimensionInfo.length+1;this._branchColorAtDepth=[v(f,this._sheetBackgroundColor)],this._fakeOthersPatternAtDepth=[];for(var b=1;b<y;b++)this._branchColorAtDepth.push(v(f,this._branchColorAtDepth[b-1]));for(b=0;b<y;b++)this._fakeOthersPatternAtDepth.push(p(this._colorMap.getColor([-3]),.1));this._dataChanged=!0,m.call(this,t),this.renderers.selections.stage.doInvalidate=!1,this.renderers.selections.stage.removeChildren()}},hasValidData:function(){return this._super()&&this._data},paint:function(){this._super(this._layoutMode,this._data);var e=this._hierarchy.root.children;return this.renderers.cells.stage.opacity=this._globalAlpha||1,this.renderers.labels.stage.opacity=this._globalAlpha||1,this.renderers.selections.stage.opacity=1,this._layout.cellPadding=this.cellPadding*Math.sqrt(this.rect.width*this.rect.height)/500,this.labeling.headers.numLevels=(i.getValue(this._data,"labels.auto",!0)||i.getValue(this._data,"labels.headers"))&&this._layoutMode>3?1:0,e.length&&(this._dataChanged||this._yMirrorModeChanged||this._oldW!==this.rect.width||this._oldH!==this.rect.height)&&(this._layout.arrange(e,this.rect.width-4,this.rect.height-4,this.yMirrorMode?-2:2,2,0,this.yMirrorMode?1:0),f.apply(this,[e,0])),this._dataChanged=!1,this._yMirrorModeChanged=!1,this._oldW=this.rect.width,this._oldH=this.rect.height,u.all([this.renderers.cells.render(!0),this.renderers.labels.render(!0),this.renderers.selections.render(!0)])},release:function(){for(var e in this.renderers)this.renderers[e].release();this._selectableShapes=[],this.renderers={},this._hierarchy=null,this._layout=null,this._super()},toggleCacheItem:function(e){var t=!0;this.renderers.cells.stage.opacity!==this._globalAlpha?(t=!1,this.renderers.cells.stage.opacity=this._globalAlpha,this.renderers.labels.stage.opacity=this._globalAlpha,this.renderers.selections.stage.doInvalidate=!1):this.renderers.selections.stage.doInvalidate=!0,e&&e.getShapes(this.selectionIdentifier?this.selectionIdentifier:"dataArea").forEach(function(n){e.selected?(n.data.borderShape||(n.data.borderShape=new o(n.x,n.y,n.width,n.height),n.data.borderShape.strokeWidth=this._style.leaf.border.width.selected,n.data.borderShape.stroke=this._style.leaf.border.color.selected,this.renderers.selections.stage.addChild(n.data.borderShape)),n.opacity=1,n.find("[data.labelShape]").forEach(function(e){e.data.labelShape.opacity=1,t&&e.data.labelShape.invalidate()}),n.data.labelShape&&(n.data.labelShape.opacity=1,t&&n.data.labelShape.invalidate())):(n.data.borderShape&&(n.data.borderShape.detach(),n.data.borderShape=null),n.opacity=void 0,n.data.labelShape&&(n.data.labelShape.opacity=void 0,t&&n.data.labelShape.invalidate()),n.find("[data.labelShape]").forEach(function(e){e.data.labelShape.opacity=void 0,t&&e.data.labelShape.invalidate()})),t&&n.invalidate()},this),t||(this.renderers.cells.render(),this.renderers.labels.render(),this.renderers.selections.render())}})}),define("text!extensions.qliktech/treemap/treemap.ng.html",[],function(){return'<div class="qv-viz"></div>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNegativeOrZero && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.OnlyNegativeOrZeroValues" q-title-translation="Object.Disclaimer.OnlyNegativeOrZeroValues" dir="ltr"></span>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist" dir="ltr"></span>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.onlyNanData && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.OnlyNanData" q-title-translation="Object.Disclaimer.OnlyNanData" dir="ltr"></span>\n<div qva-chart-disclaimer attributes="dataAttributes" visible="!dataAttributes.onlyNegativeOrZero" direction="options.direction"></div>'}),define("extensions.qliktech/treemap/treemap-properties",["client.utils/property-resolver"],function(e){function t(e,t){var n=t.getDimensions();return t.getMeasures().length+n.length>2}return{type:"items",component:"accordion",items:{data:{uses:"data",items:{dimensions:{},measures:{}}},addons:{type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{suppressZero:null,calcCond:{uses:"calcCond"}}}}},settings:{uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!1,items:{labels:{type:"items",items:{auto:{ref:"labels.auto",type:"boolean",translation:"properties.dataPoints.headersAndLabels",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],snapshot:{tid:"property-dataPoints"}},headers:{ref:"labels.headers",translation:"properties.dataPoints.headers",type:"boolean",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(n,i){return!e.getValue(n,"labels.auto")&&t(0,i)}},overlay:{ref:"labels.overlay",type:"boolean",component:"switch",translation:"properties.dataPoints.overlayLabels",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(t,n){return!e.getValue(t,"labels.auto")&&n.getDimensions().length-(e.getValue(t,"labels.headers")?1:0)>1}},leaves:{ref:"labels.leaves",type:"string",translation:"properties.dataPoints.leafLabels",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(t){return!e.getValue(t,"labels.auto")},snapshot:{tid:"property-leafLabels"}},values:{ref:"labels.values",type:"boolean",component:"switch",translation:"properties.dataPoints.labelmode",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(t){return e.getValue(t,"labels.auto")||e.getValue(t,"labels.leaves")}}}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{legend:{items:{show:{defaultValue:!1}}}}}}}}}}),define("extensions.qliktech/treemap/treemap-explore-properties",["client.utils/property-resolver"],function(e){return{type:"items",component:"accordion",items:{data:{uses:"data"},presentation:{uses:"presentation",type:"items",translation:"properties.presentation",grouped:!1,items:{labels:{type:"items",items:{auto:{ref:"labels.auto",type:"boolean",translation:"properties.dataPoints.headersAndLabels",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},headers:{ref:"labels.headers",translation:"properties.dataPoints.headers",type:"boolean",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(t,n){return!e.getValue(t,"labels.auto")&&n.qHyperCube.qMeasureInfo.length+n.qHyperCube.qDimensionInfo.length>2}},overlay:{ref:"labels.overlay",type:"boolean",component:"switch",translation:"properties.dataPoints.overlayLabels",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(t,n){return!e.getValue(t,"labels.auto")&&n.qHyperCube.qDimensionInfo.length-(e.getValue(t,"labels.headers")?1:0)>1}},leaves:{ref:"labels.leaves",type:"string",translation:"properties.dataPoints.leafLabels",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(t){return!e.getValue(t,"labels.auto")}},values:{ref:"labels.values",type:"boolean",component:"switch",translation:"properties.dataPoints.labelmode",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],show:function(t){return e.getValue(t,"labels.auto")||e.getValue(t,"labels.leaves")}}}}}}}}}),define("extensions.qliktech/treemap/treemap-data",["client.utils/property-resolver"],function(e){function t(t,n){var i=n.getDimensions(),r=n.getMeasures(),o=e.getValue(t,"color.mode");i.length>1&&t.color?t.color.persistent=!0:"byExpression"===o&&0===r.length&&e.setValue(t,"color.mode","primary")}function n(e){var t;e.getDimensions().length>1&&0!==(t=e.getSorting().indexOf(0))&&e.changeSorting(t,0)}function i(t,n){e.setValue(n,"color.dimensionId",void 0)}return{dimensions:{min:1,max:15,description:function(){return"Rectangle"},add:function(e,n,i){t(n,i)},move:function(e,i,r){n(r),t(i,r)},remove:function(e,n,r){i(0,n),t(n,r)},replace:function(t,n,i,r){e.getValue(r,"color.dimensionId")===n.qDef.cId&&e.setValue(r,"color.dimensionId",t.qDef.cId)}},measures:{min:1,max:1,description:function(){return"Size"},add:function(e,n,i){t(n,i)},move:function(e,n,i){t(n,i)},remove:function(e,n,i){t(n,i)}}}}),define("extensions.qliktech/treemap/treemap",["jquery","./treemap-area","text!./treemap.ng.html","objects.views/charts/chart","objects.backend-api/stacked-api","objects.views/charts/disclaimers/chart-utils","extensions.qliktech/treemap/treemap-properties","extensions.qliktech/treemap/treemap-explore-properties","extensions.qliktech/treemap/treemap-data","objects.views/charts/components/chart-component","objects.views/charts/representation/combo-color-map","core.utils/deferred","objects.extension/object-conversion","objects.views/charts/utils/tree-node","touche"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f){"use strict";function m(e){return e&&!(e.qHyperCube.qMeasureInfo.every(function(e){return e.qMax<=0&&e.qMax>=e.qMin})||0===e.qHyperCube.qSize.qcy)}function g(e){if(e&&e.length)for(var t=0;t<=e.length;)e[t]&&0===e[t].data.qMaxPos&&0===e[t].data.qMinNeg&&"N"===e[t].data.qType?(e.splice(t,1),t--):t++;if(1===e.length){if("undefined"===e||!e.length||"undefined"===e[0]._children||"_M"===e[0].data.qType)return}else if("undefined"===e||!e.length||"undefined"===e[0]||"undefined"===e[0]._children||0===e[0]._children.length||"undefined"===e[0]._children[0]||"undefined"===e[0].data||"undefined"===e[0]._children[0].data||"_M"===e[0].data.qType)return;for(var n=0;n<e.length;n++)g(1===e.length?e[0]._children:e[n]._children)}var v;return v=i.extend("Treemap",{init:function(n,i,r,o,s){this._data={},r=e.extend(!0,r||{},{debug:!0,providers:{colorMap:{clazz:u,multiDimScheme:"first"}},components:{dataArea:{clazz:t,show:!0,dock:"center",showFlag:c.prototype.ShowFlags.SPARK},colorLegend:{show:!0,dock:"right",relevantSize:126,label:"colorLegend",showFlag:c.prototype.ShowFlags.MEDIUM}}}),this._super(n,i,r,o,s)},off:function(){f(this.container).off("*",".treemap"),this._super()},initSelections:function(){this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend),this.options._disableSelections||(this.selections.Activated.bind(this.onSelection.Activated.bind(this)),this.selections.Deactivated.bind(this.onSelection.Deactivated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Select.bind(function(e){var t=this.components.dataArea.getSelectionIndices();this.selections.getActiveType().components.colorLegend&&(t=t.concat(this.components.colorLegend.getSelectionIndices())),this.selectionsCache.hasSelections()?this.onSelection.Select.apply(this,[e,!0,t,"L"]):e.length&&e.every(function(e){return!e.selected})&&this.selectionsApi.clear()}.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.SelectAttributeDim.bind(this.onSelection.SelectAttributeDim.bind(this)),this.selections.ToggleShape.bind(this.onSelection.ToggleShape.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.onSelection.Cancel.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)))},initTooltips:function(){this.tooltips.setComponent("dataArea",this.components.dataArea)},_updateSelectionCache:function(e){this._super(e),e=e||this.components.dataArea.getSelectableShapes();var t=[],n=this.providers.colorMap.getDimensionIndex()[0],i=this.providers.colorMap.getColorDataInfo().attrIndex>=0;if(n>0&&i)for(;n>0;){for(var r=0;r<e.length;r++)t=t.concat(e[r].children);e=t,n--}this.components.colorLegend.setSelectableShapes(e)},_paint:function(){var e=this;return this._super().then(function(t){if(!t||!t.invalid){e.layout();var n,i=[];for(n in e.components)i.push(e.components[n].invalidateDisplay("Treemap.paint"));return h.all(i)}})},isValid:function(e){return this._super(e)&&!this.supressChartRendering},prePaint:function(e){this._super(e),o.applyDisclaimerAttributes({title:!0,bottom:!0,overlay:!0,supportNegative:!1},this.$scope.dataAttributes,this.$element,this.$scope,e),this.supressChartRendering=this.$scope.dataAttributes.onlyNanData||this.$scope.dataAttributes.noDataExist||this.$scope.dataAttributes.onlyNegativeOrZero},_updateData:function(t){this._data=t,this._super(t),this.components.dataArea.setData(t),this.components.colorLegend.setData(t),t.color&&"byMeasure"!==t.color.mode?this.selections&&this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend):this.selections&&this.selections.types.colorLegend.removeComponent("colorLegend",this.components.colorLegend);for(var n=e.extend(!0,{},this._chartContext.getDimensionTree()),i=new p;n._children&&n._children.length;)i._children.push(n._children.shift());g(i._children),this.providers.colorMap.setDimensionTree(i),this.components.dataArea.setDimensionTree(i),this.components.dataArea.cellPadding=2,this.components.dataArea.setPseudoDimPos(0)},toggleCacheItem:function(e){for(var t in this.components)this.components[t].toggleCacheItem?this.components[t].toggleCacheItem(e):this.components[t].invalidateDisplay("Treemap#toggleCacheItem")},getPreferredSize:function(){return this._super()}}),{type:"treemap",BackendApi:r,template:n,View:v,definition:s,softDefinition:a,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qMode:"K",qNoOfLeftDims:-1,qSortbyYValue:-1,qIndentMode:!0,qShowTotalsAbove:!0,qMaxStackedCells:3e3,qAlwaysFullyExpanded:!0,qInitialDataFetch:[{qTop:0,qHeight:3e3,qLeft:0,qWidth:30}],qSuppressZero:!1,qSuppressMissing:!0}},data:l,support:{cssScaling:!1,snapshot:m,export:m,exportData:!0,sharing:m,viewData:!0},options:{selections:{dataArea:{},colorLegend:{}},tooltips:{}},importProperties:d.colorChart.importProperties.bind(d),exportProperties:d.colorChart.exportProperties.bind(d)}}),define("objects.utils/font-manager",["core.utils/class"],function(e){function t(e,t,n){return e<t?0:e>n?1:(e-t)/(n-t)}return e.extend("FontManager",{init:function(){this._minFontSize=10,this._maxFontSize=20,this._minRectSize=100,this._maxRectSize=900,this._fontWeight="normal",this._fontFamily="QlikView Sans",this._fontSize=10},setFontWeight:function(e){this._fontWeight=e},setFontFamily:function(e){this._fontFamily=e},setRectLimits:function(e,t){this._minRectSize=e,this._maxRectSize=t},getFont:function(e,n){var i=Math.min(e.height,e.width),r=n&&n.minFontSize?n.minFontSize:this._minFontSize,o=n&&n.maxFontSize?n.maxFontSize:this._maxFontSize,s=t(i,this._minRectSize,this._maxRectSize);return this._fontSize=r+Math.round(s*(o-r)),this._fontWeight+" "+this._fontSize+"px "+this._fontFamily},getFontSize:function(e,n){var i=Math.min(e.height,e.width),r=n&&n.minFontSize?n.minFontSize:this._minFontSize,o=n&&n.maxFontSize?n.maxFontSize:this._maxFontSize,s=t(i,this._minRectSize,this._maxRectSize);return r+Math.round(s*(o-r))}})}),define("extensions.qliktech/gauge/gauge-helper",["core.utils/class","objects.views/charts/shapes/rect","objects.views/charts/shapes/line","objects.views/charts/shapes/arc","objects.views/charts/shapes/polygon","objects.views/charts/shapes/text","general.utils/color","objects.views/charts/components/axis/radial-axis-helper","objects.utils/font-manager","core.utils/feature-flags"],function(e,t,n,i,r,o,s,a,l,c){function u(e,t,n){return{x0:e.x0,y0:e.y0,x1:e.x1,y1:e.y1,limits:t,colors:n}}function h(e){return e?e.paletteColors||e.colors:[]}var d=[0,1],p=[0,.5,1];return e.extend("GaugeHelper",{init:function(){this._padding=0,this._colorWidth=50,this._maxWidth=50,this._labelPadding=10,this._fontManager=new l,this._fontManager.setRectLimits(100,1e3),this._bigValuesSettings={minFontSize:12,maxFontSize:60}},createBarSegments:function(e,n,i,r,o,a){var l=h(e);if(0===l.length)return{shapes:[]};var c,f,m,g,v,y,b,x,q,C,S,w,_=[],D=e.limits,M=this._colorWidth,A={},E=!1,I={value:0,gradient:!1},T=new s,L=a&&!i;for(o=Math.min(Math.max(o,0),1),D=D.map(function(e){return{value:(e.value-n.getPlotMin())/(n.getPlotMax()-n.getPlotMin()),gradient:e.gradient}}),c=0;c<l.length;c++)m=(x=D[c]?D[c]:{value:1,gradient:!1}).value,g=0===c?0:D[c-1].value,q=n.getPositionOfNormalizedValue(m),S=n.getPositionOfNormalizedValue(g),A.current=new s(l[c].color),A.next=new s(l[c+1]?l[c+1].color:l[c].color),E=(C=(o-g)/(m-g))>=0&&C<=1,i?(M=r.width<10?r.width:this._colorWidth,f=new t(this._relevantPos,q,M,S-q)):(M=this._colorWidth,f=new t(S,this._relevantPos,q-S,M)),w={x0:f.x,y0:f.y+(i?f.height:0),x1:f.x+(i?0:f.width),y1:f.y},I&&I.gradient&&!x.gradient?(A.last=s.getBlend(A.current,A.last,.5),v={gradient:u(w,d,L?[A.current.toRGBA(),A.last.toRGBA()]:[A.last.toRGBA(),A.current.toRGBA()])},y=A.last,b=A.current):x.gradient?(A.next=s.getBlend(A.current,A.next,.5),I.gradient?(A.last=s.getBlend(A.current,A.last,.5),v={gradient:u(w,p,L?[A.next.toRGBA(),A.current.toRGBA(),A.last.toRGBA()]:[A.last.toRGBA(),A.current.toRGBA(),A.next.toRGBA()])},C>.5?(C=(C-.5)/.5,y=A.last,b=A.current):(C/=.5,y=A.current,b=A.next)):(v={gradient:u(w,d,L?[A.next,A.current]:[A.current,A.next])},y=A.current,b=A.next)):v=A.current.toRGBA(),E&&(T=v.gradient?s.getBlend(y,b,C):A.current),f.opacity=1,f.fill=v,f.stroke=v,_.push(f),A.last=A.current,I=x;return{shapes:_,pointerBgColor:T}},createBarProgress:function(e,n,i,r,o){var a,l,c,u,h,d,p=[],f=new s(i),m=new s(this.style.area.color);return e=isNaN(e)?0:e>1?1:e<0?0:e,l=n.getPositionOfValue(n.getPlotMin()),c=n.getPositionOfValue(n.getPlotMax()),u=n.getPositionOfValue((n.getPlotMax()-n.getPlotMin())*e+n.getPlotMin()),this._labelPadding=this._colorWidth/2,h=this._colorWidth,d=this._relevantPos,a=r?new t(d,u,h,o.height):new t(l,d,u-l,h),a.opacity=1,a.fill=f.toHex(),a.stroke=f.createShiftedColor().toHex(),a.strokeWidth=1,p.push(a),a=r?new t(d,0,h,u):new t(u,d,c-u,h),a.opacity=1,a.fill=m.toHex(),a.stroke=m.createShiftedColor(.1).toHex(),a.strokeWidth=1,p.push(a),p},createGaugeMeterValue:function(e,t,n,i,r,s,a,l){var c=new o;return c.text=t,c.ColorWidth=200,c.font=a,c.opacity=1,c.fill=this.style.value.color,i?(e+s/2>r.height?(c.baseline="bottom",e=r.height):e<s/2?(c.baseline="top",e=0):c.baseline="middle",c.x=l?this._relevantPos-this._labelPadding:this._relevantPos+this._colorWidth+this._labelPadding,c.maxWidth=r.width-c.x,c.y=e,c.align=l?"right":"left"):(c.y=this._relevantPos+this._colorWidth+this._labelPadding+s,c.x=Math.max(Math.min(r.width-n/2,e),n/2),c.align="center",c.baseline="bottom"),c},createGaugeMeterPointer:function(e,t,i,o,s){var a,l=e>1?1:e<0?-1:0,c=[],u=this._relevantPos,h=Math.max(Math.round(this._colorWidth/25),2),d=u<50?10:this._colorWidth,p=Math.max(d,10)/6,f=o.isDark()?this.style.pointer.color.light:this.style.pointer.color.dark,m=new r,g=new n,v=!i&&s?1:-1;return g.opacity=1,g.stroke=f,g.strokeWidth=h,m.opacity=1,m.fill=f,m.strokeWidth=h,e=e>1?1:e<0?0:e,a=t.getPositionOfValue((t.getPlotMax()-t.getPlotMin())*e+t.getPlotMin()),i?(0!==l&&(m.set([{x:u+d/2,y:a},{x:u-p+d/2,y:l*p*2+a},{x:u+p+d/2,y:l*p*2+a}]),c.push(m)),g.set(u,a,u+d,a)):(0!==l&&(m.set([{y:u+d/2,x:a},{y:u-p+d/2,x:v*l*p*2+a},{y:u+p+d/2,x:v*l*p*2+a}]),c.push(m)),g.set(a,u,a,u+d)),c.push(g),c},updateLabelStyle:function(e,t,n,i,r){this._bigValuesSettings={minFontSize:this.style.value.minFontSize,maxFontSize:this.style.value.maxFontSize},c.THEMING?e.value.font="normal "+this._fontManager.getFontSize(t,this._bigValuesSettings)+"px 'QlikView Sans'":e.value.font=n.getFont(i,r,null,null,this._fontManager.getFontSize(t,this._bigValuesSettings))},createRadialSegments:function(e,t){var n=h(e);if(0===n.length)return[];var r,o,a,l,c,f,m,g,v=[],y=e.limits,b=this._colorWidth,x=n[0].color,q={value:0,gradient:!1},C=t.getAngleOfNormalizedValue(0),S=this._paddingToAxis;if(y=y.map(function(e){return{value:(e.value-t.getPlotMin())/(t.getPlotMax()-t.getPlotMin()),gradient:e.gradient}}),b=this._colorWidth*(t._relevantAngle>Math.PI?1:Math.sin(t._relevantAngle/4)),this._colorWidth=b,t._radius-b-S<0)return v;for(r=0;r<n.length;r++)a=y[r]?y[r]:{value:1,gradient:!1},f=n[r+1]?n[r+1].color:n[r].color,o=n[r].color,c=t.getAngleOfNormalizedValue(a.value),g={x0:(l=new i(t._centerPoint.x,t._centerPoint.y,t._radius-b-S,t._radius-S,Math.min(C,c),Math.max(C,c),0)).x3,y0:l.y3,x1:l.x4,y1:l.y4},q&&q.gradient&&!a.gradient?(f=new s(o).blend(new s(x),.5),m={gradient:u(g,d,[f,o])}):a.gradient?(f=new s(o).blend(new s(f),.5),q.gradient?(x=new s(o).blend(new s(x),.5),m={gradient:u(g,p,[x,o,f])}):m={gradient:u(g,d,[o,f])}):m=o,l.opacity=1,l.fill=m,l.stroke=m,v.push(l),C=c,q=a,x=o;return v},createRadialGaugeMeter:function(e,t){var n,i,o,s=a.getAngleOfNormalizedValue(e,t),l=Math.max(this._colorWidth,10)/6,c=e>1?-1:1;return e>1||e<0?(i=this._colorWidth*(t._relevantAngle>Math.PI?1:Math.sin(t._relevantAngle/4)),this._colorWidth=i,o=new r([{x:2*l+2,y:n=-i*c/2},{x:2,y:l+n},{x:2,y:-l+n}])):o=new r([{x:.5*-l+4,y:0},{x:8*-l,y:l},{x:8*-l,y:-l}]),o.opacity=1,o.translate(t._centerPoint.x+Math.cos(s)*t._radius,t._centerPoint.y+Math.sin(s)*t._radius),o.rotate(s),(e>1||e<0)&&o.rotate(-c*Math.PI/2),o.fill=this.style.pointer.color.dark,o},createRadialProgress:function(e,t,n,o){var l,c,u,h,d=Math.min(n._radialOptions.start,n._radialOptions.end),p=isNaN(e)?d:a.getAngleOfNormalizedValue(e,n),f=Math.max(n._radialOptions.start,n._radialOptions.end),m=Math.min(o.width,o.height),g=[],v=(m>500?this._maxWidth:Math.max(m/500*this._maxWidth,10))/6,y=this._paddingToAxis,b=new s(this.style.area.color);return t=new s(t),c=this._colorWidth*(n._relevantAngle>Math.PI?1:Math.sin(n._relevantAngle/4)),this._colorWidth=c,n._radius-c-y<0?g:((e>1||e<0)&&((l=new r([{x:2*v+2,y:u=-c*(h=e>1?-1:1)/2},{x:2,y:v+u},{x:2,y:-v+u}])).opacity=1,l.translate(n._centerPoint.x+Math.cos(p)*n._radius,n._centerPoint.y+Math.sin(p)*n._radius),l.rotate(p-h*Math.PI/2),l.fill=t.toHex(),g.push(l)),d<p&&((l=new i(0,0,n._radius-c-y,n._radius-y,d,p,0)).opacity=1,l.translate(n._centerPoint.x,n._centerPoint.y),l.fill=t.toHex(),l.stroke=t.createShiftedColor().toHex(),g.push(l)),f>p&&((l=new i(0,0,n._radius-c-y,n._radius-y,p,f,0)).opacity=1,l.translate(n._centerPoint.x,n._centerPoint.y),l.fill=b.toHex(),l.stroke=b.createShiftedColor(.1).toHex(),g.push(l)),g)},createRadialGaugeValue:function(e,t,n,i,r,s){var a=new o;return a.text=t,a.x=i.width/2,a.y=.5*i.height-s/2+.05*Math.min(i.width,i.height),a.align="center",a.font=r,a.baseline="middle",a.maxWidth=1.4*n._radius,a.opacity=1,a.fill=this.style.value.color,[a]},createRadialSpark:function(e,t,n,i){var o,s,l=.4*Math.min(i.width,i.height),c=a.getAngleOfNormalizedValue(e,n)+Math.PI/2,u=0,h=new r;if(h.opacity=1,"string"!=typeof t)if(1===t.colors.length)h.fill=t.colors[0].color;else for(o=0;o<t.colors.length;o++){if(s=t.limits[o]?(t.limits[o].value-n.getPlotMin())/(n.getPlotMax()-n.getPlotMin()):1,e>=u&&e<s){h.fill=t.colors[o].color;break}u=s}else h.fill=t;return i.width<i.height?h.set([{x:0,y:-l},{x:-l/2,y:+l/2},{x:l/2,y:+l/2},{x:0,y:-l}]):h.set([{x:-l/2,y:l/2},{x:0,y:-l},{x:+l/2,y:l/2},{x:-l/2,y:l/2}]),h.translate(n._centerPoint.x,n._centerPoint.y),h.rotate(c),[h]},getGaugeWidth:function(e,t){var n;return e&&(n=t?"width":"height",this._colorWidth=e[n]>500?this._maxWidth:Math.max(e[n]/500*this._maxWidth,10)),this._colorWidth},updateSize:function(e,t,n){var i,r=Math.min(e.width,e.height);i=n?r:t?e.width:e.height,this._colorWidth=i>500?this._maxWidth:Math.max(i/500*this._maxWidth,10),this._relevantPos=(i-this._colorWidth)/2,this._paddingToAxis=Math.min(6,r/200)},getPaddingToAxis:function(){return this._paddingToAxis},getRelevantPos:function(){return this._relevantPos},getPadding:function(){return this._padding}})}),define("extensions.qliktech/gauge/gauge-utils",["client.utils/theme/theme-module","client.utils/default-property-logic"],function(e,t){"use strict";function n(t){return e.get().resolveColor(t)}return{getProgressColor:function(e,t,i){var r=(t||{}).baseColor;return r&&r.color&&e.color&&"measure"===e.color.useBaseColors?n(r):i},getSegmentColors:function(e){return e.paletteColors&&e.paletteColors.length?e.paletteColors:e.colors&&e.colors.length?e.colors:void 0},resolveColor:n,resolveColorSegment:function(e,t){return n(e.paletteColors&&e.paletteColors[t]?e.paletteColors[t]:e.colors[t].color)},getPropertyLogic:function(){return t.getLogicFor("hard","default")}}}),define("extensions.qliktech/gauge/gaugearea",["objects.views/charts/components/chart-component","objects.views/charts/renderers/canvas-renderer","objects.views/charts/chart-style-service","extensions.qliktech/gauge/gauge-helper","extensions.qliktech/gauge/gauge-utils","client.utils/theme/theme-module","general.utils/color","core.utils/deferred","core.utils/feature-flags"],function(e,t,n,i,r,o,s,a,l){"use strict";function c(e,n){if(!this._axis||!this._segmentInfo||void 0===this._axis.getPlotMin()||void 0===this._axis.getPlotMax())return a.resolve();var i,r=this._axis,o=this._style.value.font,l=r.isVertical(),c=t.getFontHeight(o),u=this.renderers.gauge.getTextWidth(e,o),h=this._axis.getPositionOfValue(n),d=(n-r.getPlotMin())/(r.getPlotMax()-r.getPlotMin()),p=[];return this._data.useSegments?p=(p=(i=this._gaugeHelper.createBarSegments(this._segmentInfo,r,l,this.rect,d,this.yMirrorMode)).shapes).concat(this._gaugeHelper.createGaugeMeterPointer(d,r,l,i.pointerBgColor,this.yMirrorMode)):(p=this._gaugeHelper.createBarProgress(d,r,this._progressColor,l,this.rect),(d>1||d<0)&&(p=p.concat(this._gaugeHelper.createGaugeMeterPointer(d,r,l,new s(d>1?this._progressColor:this._style.area.color),this.yMirrorMode)))),!isNaN(d)&&(l&&this.rect.width>100||!l&&this.rect.height>100)&&p.push(this._gaugeHelper.createGaugeMeterValue(h,e,u,l,this.rect,c,o,this.yMirrorMode)),this.renderers.gauge.stage.removeChildren(),this.renderers.gauge.stage.addChildren(p),this.renderers.gauge.render()}function u(e,n){if(!this._axis||!this._segmentInfo&&this._data.useSegments||this._axis._radius<=0)return a.resolve();var i=this._axis,r=this._style.value.font,o=t.getFontHeight(r),s=Math.min(this.rect.height,this.rect.width),l=(n-i.getPlotMin())/(i.getPlotMax()-i.getPlotMin()),c=[];return s<50?c=this._gaugeHelper.createRadialSpark(l,this._data.useSegments?this._segmentInfo:this._progressColor,i,this.rect):(this._data.useSegments?(c=this._gaugeHelper.createRadialSegments(this._segmentInfo,i),isNaN(l)||c.push(this._gaugeHelper.createRadialGaugeMeter(l,i))):c=this._gaugeHelper.createRadialProgress(l,this._progressColor,i,this.rect),c=c.concat(this._gaugeHelper.createRadialGaugeValue(n,e,i,this.rect,r,o))),this.renderers.gauge.stage.removeChildren(),this.renderers.gauge.stage.addChildren(c),this.renderers.gauge.render()}function h(e){return l.THEMING?{value:{color:e.getStyle("label.value","color"),font:"normal "+e.getStyle("label.value","fontSize")+" 'QlikView Sans'",minFontSize:12,maxFontSize:60},area:{color:"#eeeeee"},pointer:{color:{light:"#E6E6E6",dark:"#595959"}}}:{value:{color:e.getValue(p,"value","color"),font:e.getFont(p,"value"),minFontSize:e.getValue(p,"value","minFontSize"),maxFontSize:e.getValue(p,"value","maxFontSize")},area:{color:e.getValue(p,"area","backgroundColor")},pointer:{color:{light:e.getValue(p,"pointer","color","light"),dark:e.getValue(p,"pointer","color","dark")}}}}var d,p="gauge",f=o.get(),m=r.getPropertyLogic();return d=e.extend({init:function(){this._super.apply(this,arguments),this._gaugeHelper=new i,this._type="bar",this._currentProperties={},this._transitionProperties={},this._inTransition=!1,this._cacheItems=[],this.renderers={gauge:new t(this.container)},l.THEMING?this._styleService=f.initializeService("object.gauge"):this._styleService=n.getInstance()},_updateSize:function(){this.invalidateDisplay("Gauge._updateSize")},_updateProperties:function(){if(this._data){var e=this._data;if(this._segmentInfo={},e.segmentInfo&&e.segmentInfo.limits&&(this._segmentInfo.limits=e.segmentInfo.limits.concat().sort(function(e,t){return e.value-t.value})),e.segmentInfo){var t=r.getSegmentColors(e.segmentInfo);t&&(this._segmentInfo.colors=t.map(function(t,n){return{color:r.resolveColorSegment(e.segmentInfo,n)}}))}var n=this._data.paletteProgressColor||this._data.progressColor||m.color.paletteColor.defaultValue();this._progressColor=r.getProgressColor(e,e.qHyperCube.qMeasureInfo[0].coloring,r.resolveColor(n)),this._orientation=e.orientation,this._type=e.gaugetype,this._transitionProperties={value:e.qHyperCube.qDataPages[0].qMatrix[0][0].qNum,text:e.qHyperCube.qDataPages[0].qMatrix[0][0].qText},this._super()}},hasValidData:function(){return this._super()&&this._data},setAxis:function(e){this._axis=e,this._axis.listen("changed",function(){this.invalidateDisplay()},this)},setRefLines:function(e){this._refLines=e},setRefLineLabels:function(e){this._refLineLabels=e},setColorMap:function(e){this._colorMap=e},getColorMap:function(){return this._colorMap},paint:function(){if(!this._axis)return a.resolve();this._style=h(this._styleService),this._gaugeHelper.style=this._style;var e=[];this._gaugeHelper.updateSize(this.rect,this._axis.isVertical(),this._axis.isRadial()),this._refLines&&(this._refLines.setPaddingToAxis(this._gaugeHelper.getPaddingToAxis()),this._refLines.setRelevantPos(this._gaugeHelper.getRelevantPos())),this._refLineLabels&&(this._refLineLabels.setPaddingToAxis(this._gaugeHelper.getPaddingToAxis()),this._refLineLabels.setRelevantPos(this._gaugeHelper.getRelevantPos())),this._gaugeHelper.updateLabelStyle(this._style,this.rect,this._styleService,p,"value");var t=this._data.qHyperCube.qDataPages[0].qMatrix[0][0],n=this.measureFormatters[0],i=n&&"U"===n.type?n.formatValue(t.qNum):t.qText,r=this._currentProperties.value;return this._inTransition&&n&&(i=n.format(r)),this._axis.isRadial()?e.push(u.apply(this,[i,r])):e.push(c.apply(this,[i,r])),this._currentValue=r,this._refLines&&this._refLineLabels&&(this._refLines.setGaugeWidth(this._gaugeHelper.getGaugeWidth()),this._refLineLabels.setGaugeWidth(this._gaugeHelper.getGaugeWidth())),a.all(e)},afterPaint:function(){},clear:function(){},getGaugeWidth:function(e,t){return this._gaugeHelper.getGaugeWidth(e,t)}}),Object.defineProperty(d.prototype,"className",{value:"GaugeArea"}),d}),define("extensions.qliktech/gauge/gauge-ref-lines",["objects.views/charts/components/ref-lines","client.utils/theme/theme-module"],function(e,t){"use strict";function n(e){return e&&(e.paletteColor||e.color)?e.paletteColor?i.resolveColor(e.paletteColor):i.resolveColor(e.color,i.deprecatedPalette):"#000000"}var i=t.get();return e.extend("GaugeRefLines",{namespace:".gaugereflines",init:function(){this._super.apply(this,arguments),this._width=50},paint:function(){if(this._super.apply(this,[].slice.call(arguments)),this._hasVisibleRefLines){var e,t,i,r,o,s,a,l,c,u,h,d,p,f,m,g=[],v=this._paddingToAxis,y=this._relevantPos;for(e=0;e<this._numRefLinesDataAxes;e+=1)for(i=this._data[e],r=this._axes[e],o=this._axisPlotMinValues[e],s=this._axisPlotMaxValues[e],t=0;t<i.length;t+=1)i[t].show&&void 0!==i[t].refLineExpr&&((a=this._currentProperties["value"+e+t])>s||a<o||(r.isRadial()?(f=r._radius,m=r.getAngleOfValue(a),c=r._centerPoint.x+Math.cos(m)*(f-v),u=r._centerPoint.y+Math.sin(m)*(f-v),h=r._centerPoint.x+Math.cos(m)*(f-v-this._width),d=r._centerPoint.y+Math.sin(m)*(f-v-this._width)):(l=r.getPositionOfValue(a),l=Math.floor(l)-.5,r.isVertical()?(c=y,u=l,h=y+this._width,d=l):(c=l,u=y,h=l,d=y+this._width)),p=n(i[t]),g.push({type:"line",stroke:p,strokeWidth:1,shape:{x1:c,y1:u,x2:h,y2:d}})));this.renderer.shapes=g,this.renderer.render()}},setGaugeWidth:function(e){this._width=e,this.updateSize(),this.invalidateDisplay()},setPaddingToAxis:function(e){this._paddingToAxis=e},setRelevantPos:function(e){this._relevantPos=e}})}),define("extensions.qliktech/gauge/gauge-ref-line-labels",["objects.views/charts/components/ref-line-labels","objects.views/charts/shapes/text","client.utils/theme/theme-module"],function(e,t,n){"use strict";function i(e){return String(void 0!==e.label?e.label:e)}function r(e){return e&&(e.paletteColor||e.color)?e.paletteColor?o.resolveColor(e.paletteColor):o.resolveColor(e.color,o.deprecatedPalette):"#000000"}var o=n.get();return e.extend("GaugeRefLineLabels",{init:function(){this._super.apply(this,arguments)},paint:function(){if(this._axis)if(this._axis.updateNow(["properties"]),this._plotMinValue===this._axis.getPlotMin()&&this._plotMaxValue===this._axis.getPlotMax()||(this._hasVisibleRefLines=this.checkIfHavingVisibleRefLines(),this.updateLocalPlotMaxMinValues.call(this)),this._hasVisibleRefLines){var e,n,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,x,q="bottom",C=this._relevantPos,S=[],w=[],_=this._axis;for(e=0;e<this._data.length;e+=1)this._data[e].show&&void 0!==this._data[e].refLineExpr&&(n=this._currentProperties["value"+e],o=i(this._data[e].refLineExpr),void 0===n||isNaN(n)||n<this._axis.getPlotMin()||n>this._axis.getPlotMax()||((g=new t).font=this._style.label.font,g.maxWidth=this._labelMaxWidthForYAxis,g.maxNumLines=3,h=(h=(d=o).replace(/[0-9]|\.|\-|\+|e/g,"")).length?d:_.format(n),c=this._data[e].label+" ("+h+")",u=r(this._data[e]),g.setText(c),g.ellipsis=" ("+h+")",y=g.measure(),_.isRadial()?(f=_._radius,m=_.getAngleOfValue(n),a=_._centerPoint.x+Math.cos(m)*f,l=_._centerPoint.y+Math.sin(m)*f,p=m>Math.PI/2&&m<3*Math.PI/2?"right":"left",q=m>Math.PI&&m<2*Math.PI?"bottom":"top",a-(v=y.width)<0?(g.maxWidth+=a-v,a=g.maxWidth):a+v>this.rect.width&&(g.maxWidth=v+(this.rect.width-(a+v)))):(s=_.getPositionOfValue(n),s=Math.floor(s)-.5,x=y.height/2,_.isVertical()?(p=this.yMirrorMode?"right":"left",q="middle",a=this.yMirrorMode?C-4:C+this._width+4,l=s<x?s+(x-s+4):s>this.rect.height-x?s-(s-(this.rect.height-x-4)):s):(p="center",l=C+this._width,q="top",a=s<(b=y.width/2)?s+(b-s+4):s>this.rect.width-b?s-(s-(this.rect.width-b-4)):s)),g.x=a,g.y=l,g.align=p,g.baseline=q,g.fill=u,w.push(g),S.push({position:s,shapeWrapper:g,tooltipRows:[{label:this._data[e].label,value:h}]})));0!==(S?S.length:0)?(this.renderer.stage.removeChildren(),this.renderer.stage.addChildren(w),this.renderer.render(),this._tooltips.setLabelObjects(S)):this._clearLabels()}else this._clearLabels();else this._clearLabels()},setGaugeWidth:function(e){this._width=e,this.invalidateDisplay()},setPaddingToAxis:function(e){this._paddingToAxis=e},setRelevantPos:function(e){this._relevantPos=e}})}),define("text!extensions.qliktech/gauge/gauge.ng.html",[],function(){return'<div class="qv-viz"></div>\n<div qva-popup-disclaimer ng-if="!!dataAttributes.popupDisclaimer.show" pop-close="dataAttributes.popupDisclaimer.onPopClose" pop-message="dataAttributes.popupDisclaimer.message" pop-title="dataAttributes.popupDisclaimer.title" />\n'}),define("extensions.qliktech/gauge/gauge-properties",["translator","client.utils/theme/theme-module","client.utils/property-resolver","extensions.qliktech/gauge/gauge-utils"],function(e,t,n,i){var r,o,s,a=t.get(),l=i.getPropertyLogic();return r={uses:"data",items:{measures:{disabledRef:""},dimensions:{disabledRef:""}}},o={type:"items",uses:"settings",component:"expandable-items",translation:"Common.Appearance",items:{presentation:{type:"items",grouped:!0,translation:"properties.presentation",items:{rangeLimits:{type:"items",items:{text:{component:"text",translation:"properties.axis.rangeLimits",style:"sHeader"},min:{ref:"measureAxis.min",translation:"properties.axis.min",type:"number",expression:"optional",invalid:function(e){return e.measureAxis&&e.measureAxis.min>=e.measureAxis.max},change:function(e){n.setValue(e,"disclaimerClosed",!0)}},max:{ref:"measureAxis.max",translation:"Common.Max",type:"number",expression:"optional",defaultValue:100,invalid:function(e){return e.measureAxis&&e.measureAxis.min>=e.measureAxis.max},change:function(e){n.setValue(e,"disclaimerClosed",!0)}}}},type:{ref:"gaugetype",type:"string",component:"item-selection-list",defaultValue:"radial",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.gauge.radial",value:"radial"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.gauge.bar",value:"bar"}],change:function(e){"radial"===e.gaugetype?(s=e.orientation,e.orientation="horizontal"):e.orientation=s}},autoOrientation:{ref:"autoOrientation",translation:"properties.orientation",type:"boolean",defaultValue:!0,component:"switch",undefinedValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],show:function(e){return"bar"===e.gaugetype}},orientation:{ref:"orientation",type:"string",component:"item-selection-list",defaultValue:"horizontal",horizontal:!0,items:[{component:"icon-item",icon:"",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}],show:function(e){return"bar"===e.gaugetype&&!e.autoOrientation}},angle:{ref:"angle",translation:"properties.gauge.angle",type:"number",component:"slider",min:.2,max:.98,step:.1,defaultValue:.7,show:function(){return!1}},segments:{type:"items",items:{useSegments:{ref:"useSegments",type:"boolean",defaultValue:!1,translation:"properties.gauge.useSegments",change:function(e){var t=i.getSegmentColors(e.segmentInfo);e.useSegments&&1===t.length?e.segmentInfo.paletteColors=[e.paletteProgressColor||e.progressColor]:e.paletteProgressColor=t[0]}},useBaseColor:{ref:"color.useBaseColors",type:"string",defaultValue:"measure",translation:"properties.useLibraryMeasureColors",component:"switch",show:function(e,t){return e.color||(e.color={}),e.color.useBaseColors||(e.color.useBaseColors="off"),l.color.baseColor.hasMeasureColor(t)&&!e.useSegments},globalChange:function(e){n.getValue(e,"useSegments")&&n.setValue(e,"color.useBaseColors","off")},options:[{value:"off",translation:"properties.off"},{value:"measure",translation:"properties.on"}]},paletteProgressColor:{component:"color-picker",translation:"properties.color",ref:"paletteProgressColor",type:"object",dualOutput:!0,defaultValue:l.color.paletteColor.defaultValue,show:function(e,t){if(!n.getValue(e,"paletteProgressColor")){var i=a.resolveColor(n.getValue(e,"progressColor")),r=-1;i&&"none"!==i||(r=(i=l.color.paletteColor.defaultValue()).index),n.setValue(e,"paletteProgressColor",{index:r,color:i})}return!(e.useSegments||"measure"===n.getValue(e,"color.useBaseColors")&&l.color.baseColor.hasMeasureColor(t))}},valueMode:{ref:"valueMode",translation:"properties.value",type:"string",component:"dropdown",options:[{value:"absolute",translation:"properties.gauge.absolute"},{value:"relative",translation:"properties.gauge.relative"}],show:function(){return!1},defaultValue:"absolute"},maxSegments:{ref:"maxSegments",type:"number",defaultValue:6,show:!1},segmentInfo:{ref:"segments",type:"items",component:"color-scale-creator",show:function(e){return e.useSegments},items:{limits:{ref:"segmentInfo.limits",type:"array",items:{value:{ref:"value",type:"number",expression:"optional",invalid:function(e,t){return"number"==typeof e.value&&(e.value<t.measureAxis.min||e.value>t.measureAxis.max)},defaultValue:1},gradient:{translation:"properties.gradient",ref:"gradient",type:"boolean",show:!1}}},paletteColors:{items:{color:{ref:"color",type:"string"},index:{ref:"index",type:"integer",defaultValue:6}},type:"array",ref:"segmentInfo.paletteColors"}}}}},disclaimerClosed:{ref:"disclaimerClosed",type:"boolean",defaultValue:!1,show:!1}}},measureAxis:{type:"items",label:function(t,n){var i=n.getMeasureLayouts()[0];return i?e.get("properties.measureAxisWithInfo",[i.qFallbackTitle]):e.get("properties.measureAxis")},grouped:!0,items:{axis:{type:"items",snapshot:{title:"properties.measureAxis",tid:"property-yAxis"},items:{show:{ref:"measureAxis.show",translation:"properties.axis.labelsAndTitle",type:"string",component:"dropdown",options:[{value:"all",translation:"properties.axis.show.all"},{value:"labels",translation:"properties.axis.show.labels"},{value:"title",translation:"properties.axis.show.title"},{value:"none",translation:"Common.None"}],defaultValue:"all"},spacing:{ref:"measureAxis.spacing",translation:"properties.axis.scale",type:"number",component:"dropdown",defaultValue:1,show:function(e){return e.measureAxis&&"none"!==e.measureAxis.show&&"title"!==e.measureAxis.show},options:[{value:2,translation:"properties.gridLine.wide"},{value:1,translation:"properties.gridLine.medium"},{value:.5,translation:"properties.gridLine.narrow"}]}}}}}}},{type:"items",component:"accordion",items:{data:r,addons:{type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{suppressZero:null,calcCond:{uses:"calcCond"}}},refLines:{uses:"reflines"}}},settings:o}}}),define("text!extensions.qliktech/gauge/popup-disclaimer.ng.html",[],function(){return'<div class="qv-popup-disclaimer">\n\t<div class="close-icon  lui-icon  lui-icon--remove" qva-activate="onClose()"></div>\n\t<header class="dm-header">{{popTitle}}</header>\n\t<main class="dm-main">\n\t\t<p class="dm-p">{{popMessage}}</p>\n\t</main>\n</div>'}),define("extensions.qliktech/gauge/popup-disclaimer",["assets/qvangular/qvangular-core","text!extensions.qliktech/gauge/popup-disclaimer.ng.html"],function(e,t){e.directive("qvaPopupDisclaimer",function(){return{template:t,replace:!0,scope:{popMessage:"=",popTitle:"=",popClose:"="},link:function(e){e.onClose=function(){e.popClose()}}}})}),define("extensions.qliktech/gauge/gauge",["jquery","translator","objects.views/charts/chart","core.utils/deferred","extensions.qliktech/gauge/gaugearea","extensions.qliktech/gauge/gauge-ref-lines","extensions.qliktech/gauge/gauge-ref-line-labels","objects.views/charts/components/chart-component","objects.views/charts/components/axis/continuous-axis","objects.backend-api/hypercube-api","text!./gauge.ng.html","extensions.qliktech/gauge/gauge-properties","objects.extension/object-conversion","extensions.qliktech/gauge/popup-disclaimer"],function(e,t,n,i,r,o,s,a,l,c,u,h,d){"use strict";function p(){var e,t,n;e=-Math.PI*(this._data.angle+.5),t=Math.PI*(this._data.angle-.5),t+=e<0?2*Math.PI:0,e+=e<0?2*Math.PI:0,n=this.yMirrorMode&&"radial"!==this._type,this.components.axis.setRadial("radial"===this._type,n?{start:t,end:e}:{start:e,end:t})}function f(){var t=this.components.dataArea,n=t.rect,i=e.extend({},n),r=this.components.axis,o=r.relevantSize,s=t.getGaugeWidth(t.rect,"vertical"===this._orientation)/2;r.setAlignment("near"),"vertical"===this._orientation?(this.yMirrorMode?(i.x=n.width/2+s,r.setAlignment("far")):i.x=n.width/2-s-o,i.x<0?(i.width=o+i.x,i.x=0):i.width=o):(i.y=n.height/2-s-o,i.y<0?(i.height=o+i.y,i.y=0):i.height=o),(n.width<80||n.height<80)&&(i["vertical"===this._orientation?"width":"height"]=0),r.rect=i}var m;return m=n.extend("Gauge",{namespace:".gauge",init:function(n,i,c,u){var h=this;c=e.extend(!0,c||{},{providers:{},components:{axis:{show:!0,order:0,dock:"center",showFlag:a.prototype.ShowFlags.SPARK,clazz:l},dataArea:{show:!0,order:1,dock:"center",clazz:r,showFlag:a.prototype.ShowFlags.SPARK},gaugeRefLines:{sortKey:5,show:!0,dock:"center",showFlag:a.prototype.ShowFlags.XSMALL},gaugeRefLineLabels:{show:!0,dock:"center",order:3,showFlag:a.prototype.ShowFlags.XSMALL}}}),this._type="vertical",this._orientation="horizontal",this._super(n,i,c,u),this.components.dataArea.setAxis(this.components.axis),this.components.axis.setAlignment("near"),this.components.axis.setDataRangeTransition(!0),this.components.axis.setShowLine(!1),this.components.gaugeRefLines=new o(this.container),this.components.gaugeRefLines.showFlag=a.prototype.ShowFlags.XSMALL,this.components.gaugeRefLines.setUseTransition(!0),this.components.dataArea.setRefLines(this.components.gaugeRefLines),this.layoutEngine.addComponent(this.components.gaugeRefLines),this.components.gaugeRefLineLabels=new s(this.container),this.components.gaugeRefLineLabels.showFlag=a.prototype.ShowFlags.SMALL,this.components.gaugeRefLineLabels.setUseTransition(!0),this.components.dataArea.setRefLineLabels(this.components.gaugeRefLineLabels),this.layoutEngine.addComponent(this.components.gaugeRefLineLabels),this.$scope.dataAttributes.popupDisclaimer={show:!1,message:t.get("Object.Gauge.RangeIsDefault"),title:t.get("Object.Gauge.RangeIsDefaultTitle"),onPopClose:function(){h.$scope.backendApi.model.getProperties().then(function(e){e.disclaimerClosed=!0,h.$scope.backendApi.model.setProperties(e)})}}},_updateData:function(e){if(this._type=e.gaugetype,this._orientation=e.autoOrientation&&"bar"===e.gaugetype?this.components.dataArea.rect.height>this.components.dataArea.rect.width?"vertical":"horizontal":e.orientation,e.refLine){var t={axes:{axis:{component:this.components.axis,data:e.axis,dataIndices:e.qHyperCube.qMeasureInfo.map(function(e,t){return t})}},refLineLabels:{labels:{data:e.refLine.refLines,component:this.components.gaugeRefLineLabels,axis:this.components.axis}},refLines:{component:this.components.gaugeRefLines}};this._super(e,t),this.components.dataArea.setData(e),this.updateAxis(e,this.options),this.updateRefLines(e,t)}else this.components.dataArea.setData(e),this.updateAxis(e,this.options),this._super(e)},updateRefLines:function(e,t){var n,i=t.refLineLabels,r=[],o=[];for(n in i)i[n].component&&(i[n].component.setData(i[n].data),i[n].component.setAxis(i[n].axis),i[n].component.setDock(i[n].axis.getOppositeDock()),o.push(i[n].axis),r.push(i[n].data));t.refLines&&t.refLines.component&&(t.refLines.component.setAxes([t.axes.axis.component]),t.refLines.component.setData([e.refLine.refLines]))},isValid:function(e){var t,n=this.isDataValid(e);for(t in this.components)this.components[t].setHasValidData(n);return n},isDataValid:function(e){return!!e&&!!e.qHyperCube&&e.qHyperCube.qMeasureInfo.length&&!e.qHyperCube.qMeasureInfo.some(function(e){return!!e.qError})},updateAxis:function(e){var t,n,i,r,o=e.measureAxis,s=this.components.axis;t=Math.min.apply(this,e.qHyperCube.qMeasureInfo.filter(function(e){return!isNaN(e.qMin)}).map(function(e){return e.qMin})),n=Math.max.apply(this,e.qHyperCube.qMeasureInfo.filter(function(e){return!isNaN(e.qMax)}).map(function(e){return e.qMax})),i=e.qHyperCube.qMeasureInfo.map(function(e){return e.qFallbackTitle}).join(", "),s.setData(e),s.setTitle(i),s.setShowStrategy(o.show),s.setLabelMode(o.label),s.setOrientation("bar"===this._type?this._orientation:"horizontal"),s.setPlotMin&&(r=this.getAxisOptions(o),s.setPlotMin(r.min),s.setPlotMax(r.max),s.setTickMultiplier(o.spacing),s.setLogScale(o.logarithmic)),t===n&&0===n&&(n=1,t=0),n=Math.max(0,n),t=Math.min(0,t),this.setAxisDataRange(s,n,t,r.max,r.min,1),p.call(this)},getAxisOptions:function(e){if(e)return{min:Number(e.min),max:Number(e.max)}},setAxisDataRange:function(e,t,n,i,r,o){null!==i&&null!==r||null===i&&null===r?e.setDataRange(n,t):null!==i&&i<=n?e.setDataRange(i-o,t):null!==r&&r>=t?e.setDataRange(n,r+o):e.setDataRange(n,t)},_paint:function(){var e,t=[];if(!this.isValid(this._data))return this.clear();if(this._super(),p.call(this),this.layout(),this.$scope.dataAttributes.popupDisclaimer){var n=this._data.disclaimerClosed||this._data.maxMinChanged;!this.inEditState()||this._layoutMode<7||n?this.$scope.dataAttributes.popupDisclaimer.show=!1:this.$scope.dataAttributes.popupDisclaimer.show=!0}for(e in this.components)t.push(this.components[e].invalidateDisplay());return i.all(t)},layout:function(){var e=this.components.axis,t=e.updateSize;e.updateSize=function(){},this.layoutEngine.layout(this.rect,this._layoutMode,this.containerRect),e.updateSize=t,this._data&&this._data.autoOrientation&&"bar"===this._data.gaugetype&&(this._orientation=this.components.dataArea.rect.height>this.components.dataArea.rect.width?"vertical":"horizontal",this.components.axis.setOrientation(this._orientation)),e.preRelevantSizeCalculation(),e.calculatePreliminaryRelevantSize(this.components.dataArea.rect,this.components.dataArea.rect),e.calculateRelevantSize(this.components.dataArea.rect,this.components.dataArea.rect),this.components.axis.isRadial()||f.call(this),e.updateSize()},getPreferredSize:function(){return this._super()}}),{type:"gauge",BackendApi:c,template:u,View:m,definition:h,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:1,qHeight:1}],qSuppressMissing:!0},segmentInfo:{limits:[],colors:[{color:3}]}},data:{measures:{min:1,max:1,description:function(){return"KPI"}}},support:{cssScaling:!1,snapshot:!0,export:!0,exportData:!0,sharing:!0},getDropFieldOptions:function(e,t,n,i,r){e.AddFieldAsMeasure(n,t,r),i()},getDropDimensionOptions:function(e,t,n,i){i()},importProperties:d.axisChart.importProperties.bind(d),exportProperties:d.axisChart.exportProperties.bind(d)}}),define("text!extensions.qliktech/kpi/kpi.ng.html",[],function(){return'<div class="qv-viz" ng-class="{link : linkInteractionOn}">\n\t<div class="kpi-data" qva-activate="onShowVerifyDialog()">\n\t\t<div ng-show="baseLayoutInfo.components[0].show" class="measure-wrapper" ng-class="textAlign" ng-style="measureTitleStyle">\n\t\t\t<div class="measure-title ellips-text" title="{{measureTitle}}">\n\t\t\t\t<span ng-bind="measureTitle"></span>\n\t\t\t\t<i class="info-icon  lui-icon  lui-icon--external-link" ng-if="linkInteractionOn" title="{{sheetLinkTitle}}"></i>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="value-wrapper" ng-class="textAlign">\n\t\t\t<div class="ellips-text" ng-class="{ \'no-shrink\' : secondaryValues.length && baseLayoutInfo.components[1].components[1].components[0].show}">\n\t\t\t\t<qv-kpi-value value="mainValue.value" formatted-value="mainValue.formattedValue" value-style="mainValue.style" formatter="mainValue.formatter" css-class="mainValue.cssClass" show-glyph="mainValue.showGlyph" />\n\t\t\t</div>\n\t\t\t<div ng-show="baseLayoutInfo.components[1].components[1].components[0].show" class="secondary-wrapper ellips-text" ng-repeat="secondaryValue in secondaryValues">\n\t\t\t\t<qv-kpi-value value="secondaryValue.value" formatted-value="secondaryValue.formattedValue" value-style="secondaryValue.style" title-style="secondaryValue.titleStyle" formatter="secondaryValue.formatter" css-class="secondaryValue.cssClass" show-glyph="secondaryValue.showGlyph" measure-title="secondaryValue.measureTitle" />\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t\x3c!--\n\t<div ng-show="useViz" class="visualization">\n\t\t<qv-object class="cell-content" model="viz.model" options="viz.options"></qv-object>\n\t</div>\n\t--\x3e\n\t<div class="click-again-overlay" ng-class="{show : showVerifyDialog}" ng-style="verifyDialogStyle" qva-activate="linkToSheet()">\n\t\t<span ng-if="!sheetIsMissing" q-translation="properties.kpi.verifyToGoSheet"></span>\n\t\t<span class="sheetLinkTitle ellips-text" ng-bind="sheetLinkTitle"></span>\n\t</div>\n\n</div>\n'}),define("extensions.qliktech/kpi/kpi-properties",["client.utils/theme/theme-module","client.utils/property-resolver","client.utils/default-property-logic"],function(e,t,n){var i,r,o=e.get(),s=n.getLogicFor("hard","default");return i={uses:"data",addTranslation:"Properties.AddData",items:{measures:{disabledRef:"",items:{measureAxisMin:{type:"items",ref:"qDef.measureAxis.min",defaultValue:0},measureAxisMax:{type:"items",ref:"qDef.measureAxis.max",defaultValue:100},conditionalColoringUseConditionalColoring:{type:"items",ref:"qDef.conditionalColoring.useConditionalColoring",defaultValue:!1},conditionalColoringUseSingleColor:{type:"items",ref:"qDef.conditionalColoring.singleColor",defaultValue:3},conditionalColoringPaletteSingleColor:{type:"items",ref:"qDef.conditionalColoring.paletteSingleColor",defaultValue:s.color.paletteColor.defaultValue},limits:{type:"items",ref:"qDef.conditionalColoring.segments.limits",defaultValue:[]},paletteColors:{type:"items",ref:"qDef.conditionalColoring.segments.paletteColors",defaultValue:[{index:6}]}}}}},r={type:"items",uses:"settings",component:"expandable-items",translation:"Common.Appearance",items:{presentation:{type:"items",grouped:!1,translation:"properties.presentation",items:{showMeasureTitle:{ref:"showMeasureTitle",component:"checkbox",translation:"properties.ShowTitle",defaultValue:!0},textAlign:{ref:"textAlign",type:"string",component:"dropdown",translation:"properties.Alignment",options:[{value:"left",translation:"properties.dock.left"},{value:"center",translation:"Common.Center"},{value:"right",translation:"properties.dock.right"}],defaultValue:"center"},fontSize:{ref:"fontSize",type:"string",component:"dropdown",translation:"MediaTool.Toolbar.FontSize",options:[{value:"S",translation:"Common.Small"},{value:"M",translation:"Common.Medium"},{value:"L",translation:"Common.Large"}],defaultValue:"M"},linkToSheet:{type:"items",items:{useLink:{ref:"useLink",type:"boolean",component:"switch",translation:"properties.kpi.linkToSheet",defaultValue:!1,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}]},kpiLink:{ref:"sheetLink",type:"string",component:"sheet-dropdown",show:function(e){return e.useLink}},openUrlInNewTab:{ref:"openUrlInNewTab",type:"boolean",component:"switch",translation:"properties.kpi.openUrlInNewTab",defaultValue:!0,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],show:function(e){return e.useLink}}}}}},color:{type:"items",grouped:!1,translation:"properties.color",items:{useBaseColor:{ref:"color.useBaseColors",type:"string",defaultValue:"measure",translation:"properties.useLibraryMeasureColors",component:"switch",show:function(e,t){return e.color||(e.color={}),e.color.useBaseColors||(e.color.useBaseColors="off"),s.color.baseColor.hasMeasureColor(t)},options:[{value:"off",translation:"properties.off"},{value:"measure",translation:"properties.on"}]},conditionalColoring:{type:"array",component:"measures-tab",ref:"qHyperCubeDef.qMeasures",show:function(e,t){return!s.color.baseColor.hasMeasureColor(t)||e.color&&"measure"!==e.color.useBaseColors},items:{useConditionalColoring:{ref:"qDef.conditionalColoring.useConditionalColoring",component:"switch",type:"boolean",options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],translation:"properties.kpi.conditionalColoring",defaultValue:!1,change:function(e){var n=t.getValue(e,"qDef.conditionalColoring"),i=t.getValue(e,"qDef.conditionalColoring.segments.paletteColors")||t.getValue(e,"qDef.conditionalColoring.segments.colors");n&&n.useConditionalColoring&&1===i.length?e.qDef.conditionalColoring.segments.paletteColors=[{index:-1,color:o.resolveColor(e.qDef.conditionalColoring.paletteSingleColor||e.qDef.conditionalColoring.singleColor)}]:e.qDef.conditionalColoring.paletteSingleColor={index:-1,color:o.resolveColor(i[0].color)}}},paletteSingleColor:{component:"color-picker",translation:"properties.color",ref:"qDef.conditionalColoring.paletteSingleColor",type:"object",dualOutput:!0,defaultValue:s.color.paletteColor.defaultValue,show:function(e){if(!t.getValue(e,"qDef.conditionalColoring.paletteSingleColor")){var n={index:-1,color:o.resolveColor(t.getValue(e,"qDef.conditionalColoring.singleColor"))};t.setValue(e,"qDef.conditionalColoring.paletteSingleColor",n)}return e.qDef.conditionalColoring&&!e.qDef.conditionalColoring.useConditionalColoring}},rangeLimits:{type:"items",items:{min:{ref:"qDef.measureAxis.min",translation:"properties.axis.min",type:"number"},max:{ref:"qDef.measureAxis.max",translation:"Common.Max",type:"number",defaultValue:100}},show:function(){return!1}},segmentInfo:{ref:"qDef.conditionalColoring.segments",type:"items",component:"color-scale-creator",conditionalColoringRef:{props:"qHyperCubeDef.qMeasures",layout:"qHyperCube.qMeasureInfo"},useGlyph:!0,useAutoMinMax:!0,show:function(e){return e.qDef.conditionalColoring.useConditionalColoring},items:{limits:{ref:"qDef.conditionalColoring.segments.limits",type:"array",items:{value:{ref:"value",type:"number",expression:"optional",invalid:function(e){return isNaN(e.value)},defaultValue:1},gradient:{translation:"properties.gradient",ref:"gradient",type:"boolean",show:!1}}},paletteColors:{type:"array",ref:"qDef.conditionalColoring.segments.paletteColors",defaultValue:[{index:6}],items:{color:{ref:"color",type:"string",defaultValue:""},index:{ref:"index",type:"integer"},icon:{ref:"icon",type:"string",defaultValue:""}}}}}}}}}}},{type:"items",component:"accordion",items:{data:i,addons:{type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{suppressZero:null,calcCond:{uses:"calcCond"}}}}},settings:r}}}),define("client.property-panel/components/color-scale-creator/color-scale-creator-utils",["client.utils/theme/theme-module","general.utils/color","jquery"],function(e,t,n){function i(e,t){return e.paletteColors?e.paletteColors[t]:e.colors[t].color}function r(e,t,i){var r;(r=n.extend(!0,{},e))&&r.limits&&(r.limits=r.limits.concat().sort(function(e,t){return e.value-t.value}),r.limits.forEach(function(e){e.value=(e.value-t)/(i-t)}));var o=r.paletteColors||r.colors;return r&&o&&(r.localColors=o.concat().map(function(e,t){return{color:s(r,t)}})),r}function o(e,t,n){var i,r,o=e.limits.concat().sort(function(e,t){return e.value-t.value}),s=t>0?o[t-1]:{value:0,gradient:!1},a=e.localColors[t-(t>0?1:0)],l=o[t]?o[t]:{value:1,gradient:!1},c=e.localColors[t+(t<e.localColors.length-1?1:0)],u=n===l.value?1:(n-s.value)/(l.value-s.value);return s&&s.gradient&&l&&l.gradient?n-s.value<l.value-n?(i=a.color,r=.5-u):(i=c.color,r=u-.5):s&&s.gradient?(i=a.color,r=1-(.5+u/2)):l&&l.gradient?(i=c.color,r=u/2):(i=e.localColors[t].color,r=n),{color:i,t:r}}function s(e,t){return a.resolveColor(i(e,t))}var a={blendValue:function(e,n,i,s){var a,l,c,u,h=0,d=r(e,i,s);if(n<=0)return d.localColors[0].color;if(n>=1)return d.localColors[d.localColors.length-1].color;for(c=0;c<d.localColors.length;c++){if(l=d.limits[c]?d.limits[c].value:1,n>=h&&n<l){a=o(d,c,n,i,s),u=new t(d.localColors[c].color).blend(new t(a.color),a.t);break}h=l}return u},getIcon:function(e,t){return e.paletteColors?e.paletteColors[t].icon:e.colors[t].icon},getSegmentIndex:function(e,t,n){if(isNaN(t))return 0;var i,r,o=n?Math.min(n,t):0,s=e.segments.limits.concat().sort(function(e,t){return e.value-t.value}),a=e.segments.paletteColors||e.segments.colors;for(r=0;r<a.length;r++){if(r===a.length-1)return r;if(i=s[r].value,t<i&&t>=o)return r;o=i}return 0},shouldBlend:function(e,t){if(0!==e.limits.length)return 0===t?e.limits[t].gradient:t===e.limits.length?e.limits[t-1].gradient:e.limits[t].gradient||e.limits[t-1].gradient},resolveColorSegment:s,resolveColor:function(e){return l.resolveColor(e)},_getBlendInfo:o},l=e.get();return a}),define("extensions.qliktech/kpi/kpi-layout",["objects.views/charts/utils/canvas-renderer"],function(e){function t(e,t,n){var i=e.ratio?e.ratio:1,r=t/n;return e.direction===p.ROW?i>r?p.COLUMN:p.ROW:i>r?p.ROW:p.COLUMN}function n(e){if(!e.components||0===e.components.length)return e;var i,r,o,s,a,l=0,c=e.boundingBox.height,u=e.boundingBox.width,h=e.direction,d=t(e,c,u);for(e.components.forEach(function(e){e.direction=e.direction?e.direction:d,i=e.size.min?e.size.min:e.size?e.size:0,"function"==typeof e.isVisible&&!e.isVisible()||i*c<(e.size.treshold&&e.size.treshold.height?e.size.treshold.height:10)||u<(e.size.treshold&&e.size.treshold.width?e.size.treshold.width:10)?e.show=!1:(l+=i,e.show=!0)}),o=e.components.length-1;o>=0;o--)s=e.components[o],l<1?s.size.stretch&&(s.size.value=s.size.min+(1-l)):s.size.value=null;return e.components.forEach(function(e){r=e.size.value?e.size.value:e.size.min?e.size.min:e.size,a={},h===p.ROW?(a.height=c,a.width=u*r):(a.width=u,a.height=c*r),e.boundingBox=a}),e.components.forEach(function(e){n(e)}),e}function i(e,t,n,s,a,l){var c,u,p;u=e.boundingBox.width,p=e.boundingBox.height,e.components&&e.components.forEach(function(t){i(t,e,u,p,a,l)}),"function"==typeof e.getText&&(a===d.MAX?c=o(e.getText(),u,p):a===d.SCALE&&(c=r(e,u,p)),l===h.ADJUSTTOTEXT&&(e.boundingBox={height:c.height,width:c.width}),e.fontSizes||(e.fontSizes={}),e.fontSizes.fontSize=10*c.fontSize+"%")}function r(e,t,n){if(!e.fontSizes)return{fontSize:"10px"};var i=e.getText(),r=e.fontSizes.min,s=e.fontSizes.max,a=o(i,t,n,e.fontSizes.maxNrChars),l=Math.min((n-r.height)/(s.height-r.height),1),c=r.fontSize+l*(s.fontSize-r.fontSize);return{fontSize:Math.max(Math.min(a.fontSize,c),r.fontSize)}}function o(e,t,n,i){var r=i?i*c:s.getTextWidth(e,a),o=1.2*l,h=Math.min(t/r,n/o);return{fontSize:Math.max(9*h,u)}}var s=new e,a="10px 'QlikView Sans'",l=s.getFontHeight(a)+1,c=s.getTextWidth("M",a),u=10,h={NONE:0,ADJUSTTOTEXT:1},d={NONE:0,SCALE:1,MAX:2},p={ROW:"row",COLUMN:"column"};return{checkLayout:n,getDirection:t,sizeComponent:i,TextScaleMode:d,ElementScaleMode:h,Direction:p,FixedMobileHeight:150}}),define("text!extensions.qliktech/kpi/value.ng.html",[],function(){return'<div class="ellips-text">\n\t<div class="kpi-value" ng-style="valueStyle">\n\t\t<div class="ellips-text">\n\t\t\t<span ng-bind="currentFormattedValue" title="{{currentFormattedValue}}"></span>\n\t\t</div>\n\t\t<div class="glyph-wrapper" ng-if="showGlyph">\n\t\t\t<span ng-class="cssClass" class="lui-icon"></span>\n\t\t</div>\n\t</div>\n\t<div class="kpi-title ellips-text" ng-style="titleStyle" ng-bind="measureTitle"></div>\n</div>\n'}),define("extensions.qliktech/kpi/value",["qvangular","text!./value.ng.html","util","objects.views/charts/utils/tween"],function(e,t,n,i){e.directive("qvKpiValue",[function(){return{replace:!0,template:t,restrict:"E",scope:{value:"=",formattedValue:"=",valueStyle:"=",formatter:"=",cssClass:"=",showGlyph:"=",measureTitle:"=",titleStyle:"="},link:function(e){function t(t,n,r,o){s&&s.destroy(),s=new i(t,{currentValue:n},400).progress(function(){t.currentFormattedValue=o?o.formatValue(t.currentValue):t.currentValue,e.$digest()}).then(function(){t.currentFormattedValue="U"!==o.type?r:o.formatValue(t.currentValue)})}function r(){isNaN(e.formattedValue)||!e.formatter?e.currentFormattedValue=e.formattedValue:"U"===e.formatter.type?(e.tweenFormatter||(e.tweenFormatter=e.formatter.clone()),e.tweenFormatter.pattern=o(e.formattedValue,!0),e.tweenFormatter.prepare(),t(e,e.value,e.formattedValue,e.tweenFormatter)):t(e,e.value,e.formattedValue,e.formatter)}function o(e,t){var i,r,o="0",s=e.match(/(?:-?\d+)([^\d](?=\d))/),a=s?s[1]:"",l=0;if(a&&(r=new RegExp("(?:"+n.escapeRegExp(a)+")(\\d+)"),l=(s=e.match(r))?s[1].length:0),l)for(o+=a,i=0;i<l;i++)o+="0";return t&&(o+="A"),o}var s;e.$watchCollection("[formattedValue,formatter]",function(){r()})}}}])}),define("client.services/glyph-service",["qvangular"],function(e){e.service("qvGlyphService",[function(){var e=["","m","","R","S","T","U","P","Q","","",""],t=[{key:"m",value:"lui-icon--tick"},{key:"",value:"lui-icon--star"},{key:"R",value:"lui-icon--triangle-top"},{key:"S",value:"lui-icon--triangle-bottom"},{key:"T",value:"lui-icon--triangle-left"},{key:"U",value:"lui-icon--triangle-right"},{key:"P",value:"lui-icon--plus"},{key:"Q",value:"lui-icon--minus"},{key:"",value:"lui-icon--warning-triangle"},{key:"",value:"lui-icon--hand"},{key:"",value:"lui-icon--flag"}],n=t.length;return{getIconClass:function(e){var i,r=null;if(void 0!==e&&null!==e)if(0===e.length)r="";else for(i=0;i<n;i++)if(t[i].key===e){r=t[i].value;break}return r},getDefaultGlyphs:function(){return e.map(function(e){return{icon:e}})}}}])}),define("extensions.qliktech/kpi/kpi",["jquery","qvangular","translator","core.utils/environment","objects.extension/default-view","objects.backend-api/hypercube-api","text!./kpi.ng.html","extensions.qliktech/kpi/kpi-properties","objects.views/charts/utils/chart-formatting","client.property-panel/components/color-scale-creator/color-scale-creator-utils","core.utils/deferred","extensions.qliktech/kpi/kpi-layout","client.utils/routing","client.utils/state","client.models/sheet","objects.extension/object-conversion","core.utils/bind-layout","client.utils/theme/theme-module","extensions.qliktech/kpi/value","client.services/glyph-service"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,v){"use strict";function y(e){var t=this.$scope,i=this;f.get(e).then(function(e){t.sheet=e,g(t,"sheet",function(e){var n=e&&e.labelExpression,r=e&&e.qMeta&&e.qMeta.title;t.sheetLinkTitle=n||r||"",t.sheetIsMissing=!1,i.updateStyles()})}).catch(function(){t.sheetLinkTitle=n.get("Bookmarks.SheetMissingDialogTitle"),t.sheetIsMissing=!0,i.updateStyles()})}function b(e,t){var n=e.qHyperCube.qMeasureInfo[t];return n.coloring&&n.coloring.baseColor&&n.coloring.baseColor.color}var x,q=v.get();return x=r.extend("kpi",{namespace:".kpi",init:function(e,i,r,o){var s,a=this,l=t.getService("$timeout"),c=function(){t.$apply(e,function(){e.showVerifyDialog=!1})};this._super(e,i,r,o);var u=i.find(".qv-viz");this._$element=u,this.$scope.mainValueStyle={},this.$scope.measureTitleStyle={},this.$scope.viz={},this.$scope.secondaryValues=[],this.$scope.secondaryLayouts=[],this.$scope.showSecondaryValues=!1,this.$scope.mainValue={formattedValue:"",value:null,style:null},e.showVerifyDialog=!1,e.onShowVerifyDialog=function(){e.linkInteractionOn&&(t.$apply(e,function(){e.showVerifyDialog=!0,e.updateVerifyDialogFontSize()}),s=l(c,3e3))},e.linkToSheet=function(){if(e.linkInteractionOn&&!e.sheetIsMissing&&e.showVerifyDialog){var t=d.getUrlForSheet(e.layout.sheetLink,"analysis");e.layout.openUrlInNewTab||void 0===e.layout.openUrlInNewTab?window.open(t):d.goToSheet(e.layout.sheetLink,p.States.ANALYSIS),l.cancel(s),c()}},e.updateVerifyDialogFontSize=function(){if(e.showVerifyDialog){var t=e.verifyDialogLayoutInfo.components[0];h.checkLayout(e.verifyDialogLayoutInfo),h.sizeComponent(t,e.verifyDialogLayoutInfo,e.verifyDialogLayoutInfo.boundingBox.width,e.verifyDialogLayoutInfo.boundingBox.height,h.TextScaleMode.SCALE,h.ElementScaleMode.NONE),e.verifyDialogStyle={fontSize:t.fontSizes.fontSize}}},this.$scope.baseLayoutInfo={direction:h.Direction.COLUMN,ratio:1e9,boundingBox:{width:u.width(),height:u.height()},components:[{size:{min:.5,treshold:{width:50,height:12}},getText:function(){return e.measureTitle},fontSizes:{maxNrChars:15,min:{fontSize:10,height:12},max:{fontSize:40,height:80}},isVisible:function(){return e.showMeasureTitle}},{size:{min:.8,stretch:!0},ratio:1,components:[{size:{min:.5,stretch:!0},getText:function(){return a.$scope.mainValue.formattedValue+(a.$scope.mainValue.glyph?a.$scope.mainValue.glyph:"")},fontSizes:{maxNrChars:4,min:{fontSize:10,height:10},max:{fontSize:500,height:500}}},{size:.5,components:this.$scope.secondaryLayouts,isVisible:function(){return a.$scope.secondaryLayouts.length>0}}]}]},this.$scope.secondaryLayoutInfo={size:{min:1,treshold:{width:50,height:30}},direction:h.Direction.COLUMN,components:[{size:{min:.6,stretch:!0},fontSizes:{maxNrChars:8,min:{fontSize:10,height:20},max:{fontSize:500,height:500}}},{size:{min:.4},fontSizes:{maxNrChars:15,min:{fontSize:10,height:20},max:{fontSize:30,height:500}}}]},this.$scope.verifyDialogLayoutInfo={size:{min:1,width:20,height:20},boundingBox:{width:0,height:0},components:[{size:{min:.2,treshold:{width:100,height:100}},getText:function(){return n.get("properties.kpi.verifyToGoSheet")},fontSizes:{maxNrChars:16,min:{fontSize:10,height:20},max:{fontSize:13,height:50}}}]},e.$on("$destroy",function(){s&&l.cancel(s)})},isValid:function(e){return!!e&&!!e.qHyperCube&&e.qHyperCube.qMeasureInfo.length&&!e.qHyperCube.qMeasureInfo.some(function(e){return!!e.qError})},updateData:function(e){if(!this.isValid(e))return u.resolve();this._data=e;var t,n,r,o,s,a,l,c=e.qHyperCube.qDataPages[0].qMatrix[0],h=e.qHyperCube.qMeasureInfo.length,d=i.inClient(),p=h-1,f=this.getFormatterForMeasures(e.qHyperCube.qMeasureInfo.length),m=this.$scope.secondaryValues,g=this.$scope.secondaryLayouts,v=this.$scope.sheet&&this.$scope.sheet.qMetaDef&&this.$scope.sheet.qMetaDef.title?this.$scope.sheet.qMetaDef.title:null;for(this.$scope.showMeasureTitle=e.showMeasureTitle,this.$scope.textAlign=e.textAlign,this.$scope.baseLayoutInfo.components[1].components[0].fontSizes.maxNrChars="S"===e.fontSize?7:"L"===e.fontSize?3:4,this.$scope.useLink=e.useLink,d&&this.$scope.useLink&&e.sheetLink&&(!v||e.sheetLink!==v)&&y.call(this,e.sheetLink),this.$scope.mainValue.value=e.qHyperCube.qDataPages[0].qMatrix[0][0].qNum,this.$scope.mainValue.formattedValue=f[0]&&"U"===f[0].type&&!isNaN(e.qHyperCube.qDataPages[0].qMatrix[0][0].qNum)?f[0].formatValue(this.$scope.mainValue.value):e.qHyperCube.qDataPages[0].qMatrix[0][0].qText,this.$scope.mainValue.formatter=f[0],l=0;l<p;l++)r=c[l+1].qText,s=c[l+1].qNum,o=!f[l+1]||"U"!==f[l+1].type||isNaN(s)?r:f[l+1].formatValue(s),a=e.qHyperCube.qMeasureInfo[l+1].qFallbackTitle,m[l]||(t={style:(n=this.createSecondaryValue(function(){return o},function(){return a})).layoutInfo.components[0].fontSizes.value,titleStyle:n.layoutInfo.components[1].fontSizes.value},m.push(t),g.push(n.layoutInfo)),(t=m[l]).value=s,t.formattedValue=o,t.formatter=f[l+1],t.measureTitle=a,g[l].components[0].fontSizes.maxNrChars="S"===e.fontSize?14:"L"===e.fontSize?6:8;return m.length>p&&(g.splice(p,m.length-p),m.splice(p,m.length-p)),this.$scope.measureTitle=e.qHyperCube.qMeasureInfo[0].qFallbackTitle,this.$scope.showSecondaryValues=m.length>0,u.resolve()},updateStyles:function(){if(!this._data)return u.resolve();var e,n,r=this,o=this._data,s=i.inClient(),a=function(e,t){var n,i=o.qHyperCube.qMeasureInfo[t].conditionalColoring,r=o.qHyperCube.qMeasureInfo[t].measureAxis,s=Math.abs(e),a=r&&!isNaN(r.min)?r.min:e-s,l=r&&!isNaN(r.max)?r.max:e+s,u=(e-a)/(l-a),h=c.getSegmentIndex(i,e,a),d=c.getIcon(i.segments,h)||"";return n=o.color&&"measure"===o.color.useBaseColors&&b(o,t)?q.resolveColor(o.qHyperCube.qMeasureInfo[t].coloring.baseColor):i.useConditionalColoring?c.shouldBlend(i.segments,h)?c.blendValue(i.segments,u,a,l):c.resolveColorSegment(i.segments,h):c.resolveColor(i.paletteSingleColor||i.singleColor),{color:n,icon:d,useCondColor:i.useConditionalColoring}};this.$scope.linkInteractionOn=s&&this._navigation&&this.$scope.layout.useLink&&!!this.$scope.layout.sheetLink,this.$scope.verifyDialogLayoutInfo.boundingBox.width=this._$element.width(),this.$scope.verifyDialogLayoutInfo.boundingBox.height=this._$element.height(),this.$scope.baseLayoutInfo.boundingBox=this.getBoundingBox(),h.checkLayout(this.$scope.baseLayoutInfo),this.$scope.baseLayoutInfo.components.forEach(function(e){var t=r.backendApi.isSnapshot&&r._data&&!r.options.freeResize?r._data.snapshotData.isZoomed:r.options.isZoomed;h.sizeComponent(e,r.$scope.baseLayoutInfo,r.$scope.baseLayoutInfo.boundingBox.width,r.$scope.baseLayoutInfo.boundingBox.height,0===r.$scope.secondaryValues.length&&t?h.TextScaleMode.MAX:h.TextScaleMode.SCALE,0===r.$scope.secondaryValues.length&&t?h.ElementScaleMode.ADJUSTTOTEXT:h.ElementScaleMode.NONE)});var l=t.getService("qvGlyphService");n=a(this.$scope.mainValue.value,0),this.$scope.mainValue.cssClass=l.getIconClass(n.icon),this.$scope.mainValue.showGlyph=n.useCondColor&&n.icon&&""!==n.icon,e=this.$scope.baseLayoutInfo.components[1].components[0],this.$scope.mainValue.style={color:n.color,fontSize:e.fontSizes.fontSize},e=this.$scope.baseLayoutInfo.components[0],this.$scope.measureTitleStyle={fontSize:e.fontSizes.fontSize};for(var d=1;d<o.qHyperCube.qMeasureInfo.length;d++)e=this.$scope.baseLayoutInfo.components[1].components[1].components[d-1].components[0],n=a(this.$scope.secondaryValues[d-1].value,d),this.$scope.secondaryValues[d-1].style={color:n.color,fontSize:e.fontSizes.fontSize},e=this.$scope.baseLayoutInfo.components[1].components[1].components[d-1].components[1],this.$scope.secondaryValues[d-1].titleStyle={fontSize:e.fontSizes.fontSize},this.$scope.secondaryValues[d-1].cssClass=l.getIconClass(n.icon),this.$scope.secondaryValues[d-1].showGlyph=n.useCondColor&&n.icon&&""!==n.icon;this.$scope.updateVerifyDialogFontSize();var p=u();return t.getService("$timeout")(function(){p.resolve()},0,!1),p.promise},createSecondaryValue:function(t,n){var i=e.extend({},this.$scope.secondaryLayoutInfo);return i.components[0].getText=t,i.components[1].getText=n,{layoutInfo:i,text:t()}},paint:function(){return this.updateStyles()},resize:function(e,t){return this.paint(e,t)},getFormatterForMeasures:function(e){for(var t,n,i=this._data,r=new l(this.backendApi.localeInfo,i.qHyperCube.qMeasureInfo),o=[],s=0;s<e;s++)t=i.qHyperCube.qMeasureInfo[s],(n=r.getMeasureFormatter(s))&&"U"===n.type&&(n.pattern=n.createPatternFromRange(t.qMax,t.qMax,!0),Math.floor(Math.log(Math.abs(t.qMax))/Math.log(10))%3==2&&(n.pattern=n.pattern.substr(0,n.pattern.length-2),n.pattern+="A"),n.prepare()),o.push(n);return o},on:function(){this.options.navigation&&(this._navigation=!0),this._super(),this.updateStyles()},off:function(){this.options.navigation&&(this._navigation=!1),this._super(),this.updateStyles()},getBoundingBox:function(){return this.backendApi.isSnapshot&&this._data&&!this.options.freeResize&&this._data.snapshotData.elementRatio?{width:this._data.snapshotData.object.size.w,height:this._data.snapshotData.object.size.w*this._data.snapshotData.elementRatio}:{width:this._$element.width(),height:this._$element.height()}},setSnapshotData:function(e){this._super(),e.snapshotData.isZoomed=this.options.isZoomed,e.snapshotData.elementRatio=this._$element.height()/this._$element.width()},getPreferredSize:function(){var e=u();return e.resolve({w:this._$element.width(),h:h.FixedMobileHeight}),e.promise}}),{type:"kpi",BackendApi:o,template:s,View:x,definition:a,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:500,qHeight:10}],qSuppressMissing:!0},showTitles:!1},data:{measures:{min:1,max:2,description:function(e,t){return 0===t?"First KPI":"Second KPI"}}},support:{cssScaling:!1,snapshot:!0,export:!0,exportData:!0,sharing:!1},getDropFieldOptions:function(e,t,n,i,r){e.AddFieldAsMeasure(n,t,r),i()},getDropDimensionOptions:function(e,t,n,i){i()},importProperties:function(e,t,n){var i,r,o,s=m.hypercube.importProperties.apply(m,[e,t,n]),a=s.qProperty.qHyperCubeDef.qMeasures;if(a)for(r=0,i=a.length;r<i;r++)(o=a[r].qDef).conditionalColoring||(o.conditionalColoring={useConditionalColoring:!1,singleColor:3,segments:{limits:[],colors:[{color:2}],paletteColors:[{index:6}]}});return s},exportProperties:m.hypercube.exportProperties.bind(m)}}),define("extensions.qliktech/mapchart/Utils",["require","exports","./LayerType"],function(e,t,n){"use strict";var i;return function(e){function t(e){var t=r.indexOf(e);return-1===t?9999:t}var i=[],r=[n.POINT,n.AREA,n.GEODATA];e.registerMapChart=function(e){i.push(e)},e.getMapChart=function(e){var t=null;return i.forEach(function(n){n.id===e&&(t=n)}),t},e.getLayerFromFeature=function(e,t){for(var n=0;n<t.length;n++)if(t[n].dataset===e.getDataset())return t[n];return null},e.getLayerFromId=function(e,t){for(var n=0;n<t.length;n++)if(t[n].id===e)return t[n];return null},e.insertLayer=function(e,n){for(var i=t(e.type),r=0;r<n.length;r++)if(t(n[r].type)>=i)return n.splice(r,0,e),r;return n.push(e),n.length-1},e.isExcluded=function(e){var t=e.getAttribute("excluded");return void 0!==t&&!1!==t}}(i||(i={})),i}),define("extensions.qliktech/mapchart/GeoUtils",["require","exports"],function(e,t){"use strict";var n;return function(e){function t(e){if(e.length>=2){var t=e[0];e[0]=e[1],e[1]=t}}function n(e,i){var r=i=i||0;if(Array.isArray(e[0]))for(var o=0;o<e.length;o++)r=Math.max(n(e[o],i+1),r);else t(e);return r}e.shiftBounds=function(e,t,n){return{min:[e.min[0]+n,e.min[1]+t],max:[e.max[0]+n,e.max[1]+t]}},e.mergeBounds=function(e,t){return{min:[Math.min(e.min[0],t.min[0]),Math.min(e.min[1],t.min[1])],max:[Math.max(e.max[0],t.max[0]),Math.max(e.max[1],t.max[1])]}},e.getNarrowestBounds=function(t,n){return e.getBoundsWidth(t)>e.getBoundsWidth(n)?n:t},e.getBoundsWidth=function(e){return e.max[1]-e.min[1]},e.mergeBoundsArray=function(t,n){var i=t.reduce(function(t,i){if(!i)return t;if(!t)return i;if(t.min[1]<i.min[1]){var r=t;t=i,i=r}return isNaN(n)?e.mergeBounds(t,i):e.getNarrowestBounds(e.mergeBounds(t,i),e.mergeBounds(t,e.shiftBounds(i,2*n,0)))},null);return i&&i.max[1]-i.min[1]>=2*n*.95&&(i.min[1]=-n,i.max[1]=n),i},e.switchCoordinates=n,e.parseGeometryString=function(t){var n=JSON.parse(t);return e.switchCoordinates(n)>2?[].concat.apply([],n):n}}(n||(n={})),n}),define("extensions.qliktech/mapchart/legends/Sidebar",["require","exports","core.utils/deferred"],function(e,t,n){"use strict";return function(){function e(t,n){this.height=e.INITIAL_HEIGHT,this.parent=t,this.element=$(".sidebar",this.parent),n.find("div:first-child").css({flex:"1",width:"inherit",height:"inherit"}),this.setAlignment(n,"auto",!1)}return e.prototype.addLegend=function(e){this.element.append(e.getElement())},e.prototype.removeLegend=function(e){e.getElement().remove()},e.prototype.setAlignment=function(t,n,i){this.alignment=n;var r=this.parent.removeClass("sbHidden sbLeft sbRight sbTop sbBottom sbVertical sbHorizontal");if(i){switch(n){case"top":r.addClass("sbTop sbHorizontal");break;case"bottom":r.addClass("sbBottom sbHorizontal");break;case"left":r.addClass("sbLeft sbVertical");break;case"right":r.addClass("sbRight sbVertical");break;case"auto":default:var o=t.parents("article").first();o.width()>=o.height()?r.addClass("sbRight sbVertical"):r.addClass("sbBottom sbHorizontal")}this.isHorizontal()?this.element.css("max-height",e.HORIZONTAL_HEIGHT):this.element.css("max-height","none")}else r.addClass("sbHidden")},e.prototype.isHorizontal=function(){return this.parent.hasClass("sbHorizontal")},e.prototype.update=function(t){var i=this;if(this.parent.hasClass("sbHidden"))t.map.repaint();else{var r=t.mapDiv;"auto"===this.alignment&&this.setAlignment(r,"auto",!0);var o=this.isHorizontal(),s=!this.element.is(":visible"),a=t.chartScale,l=(e.MINIMUM_MAP_SIZE+(s?o?e.HORIZONTAL_HEIGHT:e.VERTICAL_WIDTH:0))*a;if(this.element.is(":empty")||!o&&r.width()<l||o&&r.height()<l)this.element.hide();else{var c=(o?this.height:e.VERTICAL_WIDTH)*a;this.element.css("flex-basis",c+"px"),this.element.show();var u=[];t.layers.forEach(function(e){try{u.push(e.legend.update())}catch(e){}}),o?n.all(u).then(function(n){var r=Math.min(e.HORIZONTAL_HEIGHT,Math.max.apply(null,n.map(function(e){return e.height})));0===r&&(r=e.INITIAL_HEIGHT,i.element.hide()),r!==i.height&&(i.height=r,i.element.css("flex-basis",r*a+"px"),setTimeout(function(){return i.update(t)})),t.map.repaint()}):this.element.css("flex-basis",c+"px")}t.map.repaint()}},e.VERTICAL_WIDTH=150,e.HORIZONTAL_HEIGHT=150,e.INITIAL_HEIGHT=60,e.MINIMUM_MAP_SIZE=150,e}()}),define("extensions.qliktech/mapchart/ColorMap",["require","exports","objects.views/charts/representation/combo-color-map","general.utils/color","./DataUtils"],function(e,t,n,i,r){"use strict";return function(){function e(e){this.comboColorMap=new n({autoMode:"primary"},e)}return e.prototype.setData=function(e){return"byExpression"===e.color.mode&&!e.color.auto&&e.color.measureMax<=e.color.measureMin&&(e.color.measureMax=10,e.color.measureMin=0),this.colorProps=e.color,this.comboColorMap.setData(e)},e.prototype.getColor=function(t,n,r){var o;return(o=new i("X"===t.state?e.defaultExcludedColor:this.comboColorMap.getColor(t.id,n,0,r).toRGBA())).setAlpha(this.colorProps.opacity*o.getAlpha()),o.toRGBA()},e.prototype.getComboColorMap=function(){return this.comboColorMap},e.prototype.getColorProperties=function(){return this.colorProps},e.prototype.getOutlineColor=function(){var e=new i(this.colorProps.outline.color);return e.setAlpha(this.colorProps.opacity),e.toRGBA()},e.prototype.getColorLegendInfo=function(e){var t=this.comboColorMap.getColorDataInfo(),i=t.legendMode,o=t.valid,s=void 0;if(o){var a=void 0;a=t.internalMode===n.EXPRESSION?"colorByExpression":"colorByAlternative";var l=r.getDimensionExpressionIndex(a,e);null!=l&&(s="qDimensionInfo/"+l.dimensionIndex+"/"+(l.isDim?"qAttrDimInfo/":"qAttrExprInfo/")+l.index)}return{discrete:i.discrete,valid:o,title:this.comboColorMap.getLegendTitle(),path:s,colorMode:i.colorMode,colorMapping:o?this.comboColorMap.getColorMapping():[],persistentColors:t.persistentColors,activeScale:this.comboColorMap._sequentialMap.getActiveScale(),qualitativeScale:this.comboColorMap.getColorScale()._qualitativeScale,wrangled:t.wrangled}},e.defaultExcludedColor="#ddd",e}()}),define("extensions.qliktech/mapchart/Layer",["require","exports","core.utils/deferred","./LayerProperties"],function(e,t,n,i){"use strict";return function(){function e(e,t,n,i){var r=this;this.listenerIds=[],this.excludeLayout=i,this.map=e,this.layout=t,this.id=n,this.addMapListener("idle",function(){if(r.layer&&r.legend){var e=r.map.layout.snapshotData,t=r.layout.cId&&e&&e.layers&&e.layers[r.layout.cId]&&e.layers[r.layout.cId].visible;t&&r.map.extensionObject.backendApi.isSnapshot?r.legend.setDimmed(!t):r.legend.setDimmed(!r.layer.isVisible()||!r.isInVisibleRange())}})}return e.prototype.addMapListener=function(e,t){this.listenerIds.push(this.map.map.addListener(e,t))},e.prototype.paint=function(e){this.prePaint(),this.isVisible()?(this.layer.setVisible(!0),this.doPaint(e||[])):(this.layer.setVisible(!1),this.done())},e.prototype.updateData=function(){return(new n).resolve()},e.prototype.prePaint=function(){if(this.layout.zoomRange){var e=this.translateZoomRange(this.layout.showInAllLevels,this.layout.zoomRange,this.map.map),t=e[0],n=e[1];this.layer.setMinRes(t),this.layer.setMaxRes(n)}var r=this.map.layout.snapshotData;if(this.layout.cId&&r&&r.layers&&r.layers[this.layout.cId]&&r.layers[this.layout.cId].visible&&this.map.extensionObject.backendApi.isSnapshot){var o=this.translateZoomRange(!0,[i.ZOOM_RANGE_MIN,i.ZOOM_RANGE_MAX],this.map.map),t=o[0],n=o[1];this.layer.setMinRes(t),this.layer.setMaxRes(n)}},e.prototype.remove=function(){var e=this;this.listenerIds.forEach(function(t){try{e.map.map.removeListener(t)}catch(e){}}),this.legend.remove(),this.doRemove()},e.prototype.clear=function(){},e.prototype.done=function(){this.deferred&&this.deferred.resolve()},e.prototype.setIndex=function(e){this.index=e,this.layer.setDrawOrder(100-e),this.legend.setDrawOrder(e)},e.prototype.hasFeatures=function(){return!1},e.prototype.isVisible=function(){return this.layout.showLayer},e.prototype.isInVisibleRange=function(){if(!this.layout.showInAllLevels&&this.map.map.setMinResolution&&this.layout.zoomRange){var e=this.translateZoomRange(this.layout.showInAllLevels,this.layout.zoomRange,this.map.map),t=e[0],n=e[1],i=this.map.map.getResolution();if(i<t||i>n)return!1}return!0},e.prototype.getBounds=function(){return this.isVisible()&&this.hasFeatures()?this.dataset.getAlternateBounds():null},e.prototype.translateZoomRange=function(e,t,n){var r=t[0],o=t[1];if(!n.getMinLevel)return[0,16e4];if(e)return[Math.floor(n.getZoomLevelResolution(i.ZOOM_RANGE_MAX)),Math.ceil(n.getZoomLevelResolution(i.ZOOM_RANGE_MIN))];var s=0,a=0;return r===i.ZOOM_RANGE_MIN?r=Math.ceil(n.getZoomLevelResolution(r)):(a=n.getZoomLevelResolution(r-1),r=(s=n.getZoomLevelResolution(r))+(a-s)/2),o===i.ZOOM_RANGE_MAX?o=Math.floor(n.getZoomLevelResolution(o)):(a=n.getZoomLevelResolution(o),o=(s=n.getZoomLevelResolution(o+1))+(a-s)/2),[o,r]},e}()}),define("extensions.qliktech/mapchart/MapStandardErrors",["require","exports"],function(e,t){"use strict";var n;return function(e){e.INVALID_GEOMETRY="geo.error.invalidGeometry",e.FAILED_LOOKUP="geo.error.failedLookup",e.LIMITED_DATA="Object.Disclaimer.LimitedData",e.UNSUCCESFULL_LOOKUP="geo.error.unsuccessfulLookup",e.AMBIGUOUS_LOOKUP="geo.error.ambiguousLookup"}(n||(n={})),n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions.qliktech/mapchart/DataLayer",["require","exports","./ColorMap","./Layer","./DataUtils","./MapStandardErrors","core.utils/deferred","objects.views/charts/utils/chart-formatting","util"],function(e,t,n,i,r,o,s,a,l){"use strict";return function(e){function t(t,i,r,o){var s=e.call(this,t,i,r,o)||this;return s.hardLimit=1e4,s.featureTable={},s.colorElemNos=new Set,s.colorMap=new n(s.map.extensionObject.backendApi.model.app),s}return __extends(t,e),t.prototype.clearData=function(){this.dataset&&this.dataset.removeAll()},t.prototype.updateData=function(){var e=this,t=new s;if(this.excludeLayout.qHyperCube.qDimensionInfo.length<1)return this.legend.update(),t.resolve();if(!this.isVisible())return this.layer.setVisible(!1),this.legend.update(),this.clearData(),this.map.errorHandler.clearqError(this),t.resolve();this.layer.setVisible(!0);var n=this.map.extensionObject.backendApi,i="/qUndoExclude/gaLayers/"+this.index+"/qHyperCubeDef";n.setPath(i);var r=n.getSize().qcy,a=Math.min(this.hardLimit,void 0!==this.layout.maxObjects?this.layout.maxObjects:1e3),l=this.excludeLayout.qHyperCube.qDataPages,c=l.length?l[0]:null,u=null!=c?c.qArea.qHeight:0,h=function(t){t.resolve(),l.length=0;var n=-1;e.layout.qHyperCube.qError?(n=e.layout.qHyperCube.qError.qErrorCode,e.map.errorHandler.handleqError(n,e)):e.map.errorHandler.handleqError(-1,e)};if(this.layout.qHyperCube.qError)return h(t),t.resolve();if(this.map.errorHandler.clearqError(this),c&&(u>a||u===a&&r>a))return c.qArea.qHeight=a,c.qMatrix=c.qMatrix.slice(0,a),this.map.addError(o.LIMITED_DATA,this),t.resolve();if(r>u&&!n.isSnapshot){var d=u,p=[{qTop:d,qLeft:0,qWidth:10,qHeight:Math.min(r,Math.min(1e3,a-d))}],f=function(s){if(e.layout.qHyperCube.qError)h(t);else{e.map.errorHandler.clearqError(e);var u=s[0];d+=u.qArea.qHeight,c?(c.qMatrix=c.qMatrix.concat(u.qMatrix),c.qArea.qHeight=d):(c=u,l.push(c));try{d>=a||d>=r?(t.resolve(),r>a&&e.map.addError(o.LIMITED_DATA,e)):(p[0].qTop=d,p[0].qHeight=Math.min(Math.min(r,a)-d,1e3),n.getData(i,p).then(f))}catch(e){h(t)}}};n.getData(i,p).then(f)}else t.resolve();return t.promise},t.prototype.prePaint=function(){e.prototype.prePaint.call(this),this.createFormatters()},t.prototype.paint=function(){var t=this,n=this.hyperCubeLayout.qDimensionInfo.length>0;if(this.isVisible()&&n){var i=this.hyperCubeLayout.qDataPages,o=this.excludeLayout.qHyperCube.qDimensionInfo[0].qStateCounts;if(o&&o.qAlternative+o.qExcluded+o.qLockedExcluded+o.qSelectedExcluded>0){var s=r.getDimensionExpressionIndex("colorByAlternative",this.excludeLayout.qHyperCube);s||(s=r.getDimensionExpressionIndex("colorByExpression",this.excludeLayout.qHyperCube)),s&&this.excludeLayout.qHyperCube.qDataPages[0].qMatrix.forEach(function(e){"X"===e[0].qState&&(s.isDim?e[s.dimensionIndex].qAttrDims.qValues[s.index].qText="":(e[s.dimensionIndex].qAttrExps.qValues[s.index].qNum=NaN,e[s.dimensionIndex].qAttrExps.qValues[s.index].qText=""))})}this.colorMap.setData(this.excludeLayout).then(function(){e.prototype.paint.call(t,i),t.legend.update(i)})}else n||this.clearData(),this.done()},t.prototype.clear=function(){this.dataset&&this.dataset.removeAll()},t.prototype.getPath=function(){return"/qUndoExclude/gaLayers/"+this.map.layers.indexOf(this)+"/qHyperCubeDef"},t.prototype.createFormatters=function(){if(this.hyperCubeLayout.qDimensionInfo.length){for(var e={},t=this.createMockMeasureInfo(),n=this.map.extensionObject.backendApi.localeInfo,i=0;i<t.length;i++){this.chartFormatter=new a(n,t[i]);for(var r=this.hyperCubeLayout.qDimensionInfo[i].qAttrExprInfo,o=this.chartFormatter.getFormatters(),s=0;s<r.length;s++)o[s]&&(e[r[s].id]=o[s])}this.expressionFormatters=e}},t.prototype.createMockMeasureInfo=function(){for(var e,t=[],n=0;n<this.hyperCubeLayout.qDimensionInfo.length;n++){for(var i=this.hyperCubeLayout.qDimensionInfo[n].qAttrExprInfo,r=[],o=0;o<i.length;o++)(e=JSON.parse(JSON.stringify(this.hyperCubeLayout.qDimensionInfo[n]))).qMax=i[o].qMax,e.qMin=i[o].qMin,e.qFallbackTitle=i[o].qFallbackTitle,r.push(e);t.push(r)}return t},t.prototype.getGeometry=function(e){if(!this.layout.qHyperCube.qDimensionInfo[0])return[];var t=this.layout.isLatLong;if(!t&&this.layout.locationOrLatitude&&this.layout.locationOrLatitude.key.trim().length>0){var n=r.getStringOrNumber("locationOrLatitude",e,this.hyperCubeLayout);return 0===n.length?this.getLocationFromDimension(e):n}return t?this.getLatLong(e):this.getLocationFromDimension(e)},t.prototype.getColorValues=function(e){var t=e.qMatrix,n=this.layout.color,i=n?n.mode:"",o=[],s=this.layout.qHyperCube.qDimensionInfo.length-1,a=null;"byMeasure"===i?(a=r.getDimensionExpressionIndex("colorByAlternative",this.layout.qHyperCube))&&a.isDim&&(a=null):a="byExpression"===i?r.getDimensionExpressionIndex("colorByExpression",this.layout.qHyperCube):r.getDimensionExpressionIndex("colorByAlternative",this.layout.qHyperCube);var l=a&&a.isDim,c="byMeasure"===i&&a&&!a.isDim,u="byExpression"===i&&a,h=0;a&&(h=a.index,s=a.dimensionIndex);for(var d=0;d<t.length;d++){var p=t[d],f=p[s].qAttrExps,m=p[s].qAttrDims;try{if(l&&m){var g=m.qValues[h];o.push({elemNo:g.qElemNo,value:g.qText||""})}else(c||u)&&f?o.push({value:f.qValues[h].qNum}):o.push({value:null})}catch(e){o.push({value:null})}}return o},t.prototype.getLocationFromDimension=function(e){for(var t=e.qMatrix,n=[],i=0;i<t.length;i++)try{var r=t[i],o=null;r[0].qText?o=r[0].qText:r[0].qNum&&(o=r[0].qNum),n.push(o)}catch(e){n.push(null)}return n},t.prototype.getLatLong=function(e){var t=e.qMatrix,n=[],i=r.getDimensionExpressionIndex("locationOrLatitude",this.hyperCubeLayout),o=r.getDimensionExpressionIndex("longitude",this.hyperCubeLayout);if(null==i||null==o)return n;for(var s=i.index,a=o.index,l=0;l<t.length;l++)try{var c=t[l][0].qAttrExps,u=t[l][0].qAttrDims,h=void 0,d=void 0,p=0,f=0;if(i.isDim){if(!(h=u.qValues[s].qText)){n.push(null);continue}p=parseFloat(h.replace(/,/,"."))}else p=c.qValues[s].qNum;if(o.isDim){if(!(d=u.qValues[a].qText)){n.push(null);continue}f=parseFloat(d.replace(/,/,"."))}else f=c.qValues[a].qNum;n.push([p,f])}catch(e){n.push(null)}return n},t.prototype.addLocationSuffix=function(e,t){if(this.layout.locationNamesAuto)return e;var n=this.layout.locationType,i=e.length,o=r.getStringData("country",t,this.hyperCubeLayout);if(o.length>0){var s=r.getStringData("admin1",t,this.hyperCubeLayout);if(s.length>0){var a=r.getStringData("admin2",t,this.hyperCubeLayout);if(a.length>0)for(l=0;l<i;l++)e[l]+=","+a[l];for(l=0;l<i;l++)e[l]+=","+s[l]}for(l=0;l<i;l++)e[l]+=","+o[l]}if(n&&n.length>0)for(var l=0;l<i;l++)e[l]+=":"+n;return e},t.generateAttributeObject=function(e,t,n,i,r,o){return l.extend(!0,{id:String(e),name:t,color:i,label:n,excluded:r},o||{})},t.generateAttributeArray=function(e,t,n,i,r,o,s){return[e,String(t),n,r,i,o].concat(s||[])},t.prototype.hasFeatures=function(){var e=this.dataset?this.dataset.getAll():null;return null!==e&&e.length>0},t.isLocationDataset=function(e){return e instanceof idevio.map.RemoteServiceLocationDataset||e instanceof idevio.map.FileLocationDataset},t.prototype.isVisible=function(){return!!this.isDrillDownLevelVisible()&&e.prototype.isVisible.call(this)},t.prototype.isDrillDownLevelVisible=function(){if(this.layout.drillDown.auto)return!0;if("H"===this.layout.qHyperCube.qDimensionInfo[0].qGrouping){var e=this.layout.qHyperCube.qDimensionInfo[0].qGroupPos;return!this.layout.drillDown.hasOwnProperty("showLevel"+e)||this.layout.drillDown["showLevel"+e]}return!0},t.prototype.makeOrChangeDataset=function(e,t,n,i){function r(e){if(!e.dataset||!e.dataset.getAll()||!(e.dataset instanceof idevio.map.LocationDataset||e.dataset instanceof idevio.map.RemoteServiceLocationDataset)){var n={columnNames:t,name:e.id,onload:function(){var t=e.dataset.getAll();t&&t.forEach(function(t){var n=t.getAttribute("id");e.featureTable[n]=t;var i=t.getAttribute("color")||{};null!=i.elemNo&&e.colorElemNos.add(i.elemNo)}),e.legend.update(),e.done()},onerror:function(t){if("Error"===t.type){n=t.message.trim().split(/\n/g);e.map.addError(o.FAILED_LOOKUP,e,n)}else{var n=t.message.trim().split(/\n/g);e.map.addError(o.UNSUCCESFULL_LOOKUP,e,n)}}};e.dataset=idevio.map.LocationDataset.create("Area"===i?"i:///areageom/default":"i:///pointgeom/default","SERVICE",n),e.layer.setDataset(e.dataset)}}if(this.featureTable={},this.colorElemNos.clear(),n)return this.dataset&&this.dataset instanceof idevio.map.MemoryDataset||(this.dataset=new idevio.map.MemoryDataset({name:name}),this.layer.setDataset(this.dataset)),"LATLONGS";for(var s=e.length,a=0;a<s;a++)if(null!=e[a]&&"-"!==e[a])return"string"==typeof e[a]&&"["===e[a].charAt(0)?(this.dataset&&this.dataset instanceof idevio.map.MemoryDataset||(this.dataset=new idevio.map.MemoryDataset({name:this.name}),this.layer.setDataset(this.dataset)),"STRINGCOORDS"):(r(this),"NAMES");return"UNKNOWN"},t.DEFAULT_COLUMNS=["geoname","id","name","color","label","excluded"],t}(i)}),define("objects.picasso/scroll/scroll-actions",[],function(){var e="scrollbar";return function(t){function n(n,i){if(!i||!t())return!1;var r={x:i.center.x-i.deltaX,y:i.center.y-i.deltaY};return this.chart.componentsFromPoint(r).some(function(t){return t.settings.key===e})}return[{type:"Tap",options:{enable:n},events:{tap:function(t){this.chart.component(e).emit("tap",t)}}},{type:"Pan",options:{enable:n},events:{panstart:function(t){this.chart.component(e).emit("panStart",t)},pan:function(t){this.chart.component(e).emit("panMove",t)},panend:function(t){this.chart.component(e).emit("panEnd",t)},pancancel:function(t){this.chart.component(e).emit("panCancel",t)}}}]}}),define("objects.picasso/chart-builder/components/util/axis-dock-util",[],function(){"use strict";function e(e,i,r){return"y"===e?t(i,r):n(i)}function t(e,t){var n=e||"near";return t&&"near"===n||!t&&"far"===n?"right":"left"}function n(e){return"far"===e?"top":"bottom"}return{getAxisDock:e,getOppositeAxisDock:function(t,n,i){return e(t,"far"===n?"near":"far",i)},getYAxisDock:t}}),define("objects.picasso/chart-builder/components/util/ref-line-util",["util","core.utils/feature-flags","objects.utils/chart-style-utils"],function(e,t,n){"use strict";return{lineSettings:function(t,i){var r={value:0,line:{stroke:void 0!==i.paletteColor?n.Theme.resolveColor(i.paletteColor):"transparent"}};return e.extend(!0,r,t||{})},lineLabelSettings:function(i,r){var o,s,a,l=r&&r.chartID;t.THEMING?(a=n.getStyle(l,"referenceLine.label.name","color"),s=n.getFontSize(l,"referenceLine.label.name","fontSize"),o="QlikView Sans"):(a=n.getStyle("","referenceLine.label","color"),s=n.getFontSize("","referenceLine.label","fontSize"),o=n.getStyle("","referenceLine.label","fontFamily")),r.paletteColor?a=n.Theme.resolveColor(r.paletteColor):a||(a="transparent");var c={value:0,line:{stroke:"transparent"},label:{align:"center",vAlign:"middle",text:"",fill:a,fontFamily:o,fontSize:s,maxWidthPx:135}};return e.extend(!0,c,i||{})}}}),define("objects.picasso/chart-builder/presets/dimension-measure-chart/layout-settings",[],function(){"use strict";return{lasso:{displayOrder:1e4},rangeDim:{displayOrder:1e4},rangeMeasure:{displayOrder:1e4},rangeMinor:{displayOrder:1e4},scrollBar:{minimumLayoutMode:"SPARK",prioOrder:-1,displayOrder:100},refLines:{minimumLayoutMode:"SPARK",prioOrder:60,displayOrder:-10},measureAxisTitle:{minimumLayoutMode:"XSMALL",prioOrder:30,displayOrder:90},dimensionAxisTitle:{minimumLayoutMode:"XSMALL",prioOrder:30,displayOrder:90},measureAxis:{minimumLayoutMode:"XSMALL",prioOrder:10,displayOrder:80},dimensionAxis:{minimumLayoutMode:"XSMALL",prioOrder:10,displayOrder:80},gridLines:{minimumLayoutMode:"XSMALL",displayOrder:-100},refLinesLabels:{minimumLayoutMode:"SMALL",prioOrder:60,displayOrder:0}}}),define("objects.picasso/chart-builder/presets/dimension-measure-chart/constants",["objects.picasso/chart-builder/presets/dimension-measure-chart/layout-settings"],function(e){"use strict";var t={SHOW_AXIS_LABELS_OPTIONS:["all","labels"],SHOW_TITLE_OPTIONS:["all","title"],HORIZONTAL:"horizontal",VERTICAL:"vertical",LAYOUTSETTINGS:e};return t.DEFAULT_CHART_ORIENTATION=t.HORIZONTAL,t}),define("objects.picasso/chart-builder/presets/dimension-measure-chart/dimension-measure-chart",["util","objects.picasso/scroll/scroll-actions","objects.picasso/chart-builder/components/util/axis-dock-util","objects.picasso/chart-builder/components/util/ref-line-util","objects.picasso/chart-builder/presets/dimension-measure-chart/constants"],function(e,t,n,i,r){"use strict";function o(e,t){return e.addInteraction({},{gestures:t})}function s(e,t){t.forEach(function(t){e.push(t)})}function a(t,n,i,r){var o=n.measureScaleSettings,s={isRtl:n.isRtl,source:n.measureSource,orientation:i,measureAxisProperties:r};r&&r.spacing>0&&(o=e.extend(!0,o||{},{component:{ticks:{distance:r.spacing*w}}})),t.addScale("measure-scale",o,s)}function l(t,n,i,o){var s={scale:"measure",forceBounds:o&&!o.autoMinMax&&o.showBounds};s=e.extend(s,r.LAYOUTSETTINGS.measureAxis);var a=x(n,i);t.addComponent(i+"-axis",s,a)}function c(t,n,i){var o={text:n.measureTitleText};o=e.extend(o,r.LAYOUTSETTINGS.measureAxisTitle);var s=q(n,i);t.addComponent(i+"-axis-title",o,s)}function u(e,t,n){var i={isRtl:t.isRtl,source:t.dimensionSource,orientation:n===r.HORIZONTAL?r.VERTICAL:r.HORIZONTAL};e.addScale("dimension-scale",t.dimensionScaleSettings,i)}function h(t,n,i){var o={scale:"dimension"};o=e.extend(o,r.LAYOUTSETTINGS.dimensionAxis);var s=C(n,i);e.extend(!0,o,n.dimensionAxisSettings||{}),t.addComponent(i+"-axis",o,s)}function d(t,n,i){var o={text:n.dimensionTitleText};o=e.extend(o,r.LAYOUTSETTINGS.dimensionAxisTitle);var s=S(n,i);t.addComponent(i+"-axis-title",o,s)}function p(t,n,i){var o={ticks:{show:!0},minorTicks:{show:!n.auto&&!n.auto&&3===n.spacing}};(o=e.extend(o,r.LAYOUTSETTINGS.gridLines))[i]={scale:"measure"},t.addComponent("grid-line",o)}function f(n,i,o,a){n.getSettings().scroll={dimension:{viewSize:o.scrollSettings&&o.scrollSettings.viewSize||0,max:o.scrollSettings&&o.scrollSettings.max||0}};var l={isRtl:o.isRtl,chartID:o.chartID,isHorizontal:!a},c=e.extend({},r.LAYOUTSETTINGS.scrollBar);n.addComponent("scrollbar",c,l),s(i,t(o.isNavigationEnabledFn))}function m(t,o,s,a){var l=n.getAxisDock(s,a.dock,o.isRtl),c={key:"ref-line",style:{oob:{show:!1}},lines:{x:[],y:[]}};c=e.extend(c,r.LAYOUTSETTINGS.refLines);var u={key:"ref-line-labels-"+e.generateId(),require:["renderer","chart"],dock:n.getOppositeAxisDock(s,a.dock,o.isRtl),preferredSize:function(){if("x"===s)return 26;for(var e=this.renderer.measureText,n=this.chart.formatter({data:t.settings.scales.measure.data}),i=u.lines.y.map(function(t){var i="("+n(t.value)+")",r=t.label.text+" "+i,o=t.label.text?" "+i:i;return{wanted:e({text:r,fontSize:t.fontSize,fontFamily:t.fontFamily}).width,required:e({text:o,fontSize:t.fontSize,fontFamily:t.fontFamily}).width}}),r=i[0],o=1;o<i.length;o++)i[o].wanted>r.wanted&&(r.wanted=i[o].wanted),i[o].required>r.required&&(r.required=i[o].required);return r.required+12>100?r.required+12:Math.min(r.wanted+12,100)},lines:{x:[],y:[]}};u=e.extend(u,r.LAYOUTSETTINGS.refLinesLabels),o.refLines.forEach(function(t){if(t.show){var n=t.refLineExpr&&t.refLineExpr.value,r=e.extend(!0,{},o,{paletteColor:t.paletteColor}),a=i.lineSettings({scale:"measure",dir:s,value:n},r);c.lines[s].push(a);var h=i.lineLabelSettings({scale:"measure",value:n,label:{text:t.label}},r);"x"===s?h.label.vAlign="near"===l?1:0:h.label.align="near"===l?0:1,u.lines[s].push(h)}}),t.addComponent("ref-line",c,{}),t.addComponent("ref-line",u,{})}function g(e,t){var n={brushKey:t.brushKey,brushComponents:t.brushComponents,brushData:t.brushData};e.addComponent("lasso",r.LAYOUTSETTINGS.lasso,n)}function v(t,n,i,o,s){var a={key:"rangeDim"};a=e.extend(a,r.LAYOUTSETTINGS.rangeDim);var l={brushKey:n.brushKey,brushAxis:n.brushAxis,brushArea:n.brushArea,brushScale:n.brushScale,isHorizontal:!i,dock:o,isRtl:s};t.addComponent("range",a,l)}function y(t,n,i,o,s){var a={key:"rangeMeasure"};a=e.extend(a,r.LAYOUTSETTINGS.rangeMeasure);var l={brushKey:n.brushKey,brushAxis:n.brushAxis,brushArea:n.brushArea,brushScale:n.brushScale,multiple:n.multiple,isHorizontal:i,dock:o,isRtl:s};t.addComponent("range",a,l)}function b(t,n,i,o,s){var a={key:"rangeMinor"};a=e.extend(a,r.LAYOUTSETTINGS.rangeMinor);var l={brushKey:n.brushKey,brushAxis:n.brushAxis,brushData:n.brushData,brushArea:n.brushArea,brushComponents:n.brushComponents,brushScale:n.brushScale,multiple:n.multiple,isHorizontal:"measure"===n.brushScale?i:!i,dock:o,isRtl:s,chartInstance:n.chartInstance};t.addComponent("range-area",a,l)}function x(e,t){return{dock:e.measureAxisProperties&&e.measureAxisProperties.dock,direction:t,isRtl:e.isRtl}}function q(e,t){return x(e,t)}function C(e,t){return{dock:e.dimensionAxisProperties&&e.dimensionAxisProperties.dock,direction:t,isRtl:e.isRtl}}function S(e,t){return C(e,t)}var w=100;return function(e,t){var n=t||{},i=n.measureAxisProperties||{},q=n.dimensionAxisProperties||{},S=n.orientation||r.DEFAULT_CHART_ORIENTATION,w=S===r.HORIZONTAL,_=w?"x":"y",D=w?"y":"x",M=r.SHOW_AXIS_LABELS_OPTIONS,A=r.SHOW_TITLE_OPTIONS,E=M.contains(i.show),I=!!n.measureTitleText&&A.contains(i.show),T=n.includeDimensionAxis&&M.contains(q.show),L=n.includeDimensionAxis&&!!n.dimensionTitleText&&A.contains(q.show),k=n.gridlines&&!(!n.gridlines.auto&&0===n.gridlines.spacing),O=n.refLines&&n.refLines.some(function(e){return e.show}),P=[];E&&l(e,n,_,i),I&&c(e,n,_),a(e,n,S,i),T&&h(e,n,D),L&&d(e,n,D),n.includeDimensionAxis&&u(e,n,S),k&&p(e,n.gridlines,_),n.hasNavigation&&f(e,P,n,w),O&&m(e,n,_,i),n.enableLasso&&n.selectionsEnabled&&g(e,n.lasso||{}),n.enableDimRange&&n.includeDimensionAxis&&n.selectionsEnabled&&v(e,n.dimRange||{},w,C(n,D).dock,n.isRtl),n.enableMeasureRange&&n.selectionsEnabled&&y(e,n.measureRange||{},w,x(n,_).dock,n.isRtl),n.enableAreaRange&&n.selectionsEnabled&&b(e,n.areaRange||{},w,C(n,D).dock,n.isRtl),n.brushActions&&s(P,n.brushActions),P.length&&o(e,P)}}),define("objects.picasso/chart-builder/chart-presets",["objects.picasso/chart-builder/presets/dimension-measure-chart/dimension-measure-chart"],function(e){"use strict";return function(t,n,i){switch(t){case"dimension-measure-chart":e(n,i);break;default:throw Error("There is no chart preset with that type")}}}),define("objects.picasso/chart-builder/scale",["util"],function(e){"use strict";function t(t,n){var i=n||{},r=!i.orientation||"horizontal"===i.orientation,o=!!i.isRtl,s={name:i.name||"scale",component:{invert:r&&o,minorTicks:{count:1},range:i.range||null,domain:i.domain||null,trackBy:i.trackBy||"id"}};return e.extend(!0,{},s,t||{})}return t.measureScale=function(n,i){var r=(i||{}).source||[];"string"==typeof r&&(r=[r]);var o={name:"measure",component:{expand:.1,data:{fields:r.map(function(e){return{field:e}})}}},s=i&&i.measureAxisProperties;s&&!s.autoMinMax&&(["min","minMax"].contains(s.minMax)&&(o.component.min=s.min),["max","minMax"].contains(s.minMax)&&(o.component.max=s.max));var a=t(e.extend(!0,o,n||{}),i);return!(n&&n.component&&void 0!==n.component.invert)&&i&&"vertical"===i.orientation&&(a.component.invert=!a.component.invert),a},t.dimensionScale=function(n,i){var r={name:"dimension",component:{trackBy:"id",type:"band",data:{extract:{field:i&&i.source||"",props:{label:function(e){return e.qText||""}}}},label:function(e){return e.label.value}}};return t(e.extend(!0,r,n||{}),i)},t}),define("objects.picasso/chart-builder/components/axis",["objects.utils/chart-style-utils","objects.picasso/chart-builder/components/util/axis-dock-util","core.utils/feature-flags","util"],function(e,t,n,i){"use strict";function r(r,o){var s,a,l,c,u,h,d,p=o&&o.chartID,f=o&&o.layoutMode,m=o&&o.dock,g=o&&o.direction,v=o&&o.isRtl;n.THEMING?(s=e.getStyle(p,"axis.line.major","color"),a=e.getFontSize(p,"axis.title",f),c=e.getStyle(p,"axis.title","color"),u=e.getStyle(p,"axis.label.name","color"),h=e.getFontSize(p,"axis.label.name",f),l="QlikView Sans",d="QlikView Sans"):(s=e.getStyle("","axis.line","color"),a=e.getFontSize("","axis.title",f),l=e.getStyle("","axis.title","fontFamily"),c=e.getStyle("","axis.title.color","default"),u=e.getStyle("","","color"),h=e.getFontSize("","axis.label",f),d=e.getStyle("","axis.label","fontFamily"));var y={key:"axis",type:"axis",dock:t.getAxisDock(g,m,v),brush:{trigger:[],consume:[]},settings:{title:{fontSize:a,fontFamily:l,fill:c},line:{show:!0,strokeWidth:1,stroke:s},labels:{fill:u,fontSize:h,fontFamily:d,tiltAngle:v?-40:40,maxEdgeBleed:75,maxSize:150,mode:"auto"},ticks:{stroke:s},minorTicks:{stroke:s}}};return i.extend(!0,{},y,r||{})}return r.xAxis=function(e,t){var n={key:"x-axis",scale:"x"};return r(i.extend(!0,n,e||{}),t)},r.yAxis=function(e,n){var o=n&&n.dock,s=n&&n.isRtl,a={key:"y-axis",scale:"y",dock:t.getYAxisDock(o,s)};return r(i.extend(!0,a,e||{}),n)},r}),define("objects.picasso/chart-builder/components/box-marker",["util"],function(e){"use strict";return function(t){var n={key:"box-marker",type:"box-marker",settings:{minor:{scale:"x"},orientation:"horizontal"},brush:{trigger:[],consume:[]}};return e.extend(!0,{},n,t||{})}}),define("objects.picasso/chart-builder/components/event-area",["util"],function(e){"use strict";return function(t){var n={type:"event-area",key:"event-area"};return e.extend(!0,{},n,t||{})}}),define("objects.picasso/chart-builder/components/grid-line",["objects.utils/chart-style-utils","core.utils/feature-flags","util"],function(e,t,n){"use strict";return function(i,r){var o,s=r&&r.chartID,a={displayOrder:-1,key:"grid-line",type:"grid-line",x:null,y:null,ticks:{stroke:o=t.THEMING?e.getStyle(s,"grid.line.major","color"):e.getStyle("","grid.line","color")},minorTicks:{stroke:o}};return n.extend(!0,{},a,i||{})}}),define("objects.picasso/chart-builder/components/interaction",["util"],function(e){"use strict";return function(t,n){var i={type:"hammer",key:"hammered",gestures:n&&n.gestures||[]};return e.extend(!0,{},i,t||{})}}),define("objects.picasso/chart-builder/components/point-marker",["util"],function(e){"use strict";return function(t){var n={key:"point-marker",type:"point-marker",settings:{},brush:{trigger:[],consume:[]}};return e.extend(!0,{},n,t||{})}}),define("objects.picasso/chart-builder/components/scrollbar",["util","objects.utils/chart-style-utils"],function(e,t){"use strict";return function(n,i){var r=i&&i.isRtl,o=i&&i.chartID,s=i&&i.isHorizontal,a={key:"scrollbar",type:"scrollbar",scroll:"dimension",dock:s?"bottom":r?"left":"right",settings:{backgroundColor:t.getStyle(o,"","backgroundColor"),invert:r&&s}};return e.extend(!0,{},a,n||{})}}),define("objects.picasso/chart-builder/components/text",["objects.utils/chart-style-utils","objects.picasso/chart-builder/components/util/axis-dock-util","core.utils/feature-flags","util"],function(e,t,n,i){"use strict";function r(r,o){var s,a,l,c=o&&o.chartID,u=o&&o.layoutMode,h=o&&o.dock,d=o&&o.direction,p=o&&o.isRtl,f=31===u?u:"medium";n.THEMING?(s=e.getFontSize(c,"axis.title",f),l=e.getStyle(c,"axis.title","color"),a="QlikView Sans"):(s=e.getFontSize("","axis.title",u),a=e.getStyle("","axis.title","fontFamily"),l=e.getStyle("","axis.title.color","default"));var m={key:"text",type:"text",dock:t.getAxisDock(d,h,p)||"bottom",displayOrder:0,settings:{style:{fontSize:s,fontFamily:a,fill:l}}};return i.extend(!0,{},m,r||{})}return r.xAxisTitle=function(e,t){var n={key:"x-axis-title"};return r(i.extend(!0,n,e||{}),t)},r.yAxisTitle=function(e,n){var o=n&&n.dock,s=n&&n.isRtl,a={key:"y-axis-title",dock:t.getYAxisDock(o,s)||"left"};return r(i.extend(!0,a,e||{}),n)},r}),define("objects.picasso/chart-builder/components/lasso",["util"],function(e){"use strict";return function(t,n){var i=n&&n.brushKey,r=n&&n.brushComponents?n.brushComponents:[],o=n&&n.brushData?n.brushData:["elemNo"],s={type:"brush-lasso",key:"lasso",displayOrder:99,settings:{brush:{components:[]},lasso:{fill:"rgba(0, 0, 0, 0)",stroke:"rgba(102,102,102,1)",strokeWidth:2,opacity:1,strokeDasharray:null},startPoint:{r:10,fill:"rgba(77, 192, 78, 1)",strokeWidth:0,opacity:1}}};return r.forEach(function(e){s.settings.brush.components.push({contexts:i?[i]:void 0,key:e,data:o})}),e.extend(!0,{},s,t||{})}}),define("objects.picasso/chart-builder/components/util/range-util",[],function(){"use strict";return{getBublesAlign:function(e,t,n){var i=e&&"far"!==t||!e&&"far"===t;return!e&&n&&(i=!i),i?"start":"end"},getDock:function(e,t){var n,i=[];return e&&i.push("@"+e),t&&i.push("@"+t),i.length&&(n=i.join(",")),n}}}),define("objects.picasso/chart-builder/components/range",["util","objects.picasso/chart-builder/components/util/range-util"],function(e,t){"use strict";return function(n,i){var r=i&&i.brushKey,o=i&&i.brushAxis,s=i&&i.brushArea,a=i&&i.brushScale,l=i&&i.isHorizontal,c=i&&i.dock,u=i&&i.isRtl,h={type:"brush-range",key:"range",displayOrder:99,dock:t.getDock(o,s),settings:{brush:r,fill:"rgba(0, 0, 0, 0)",scale:a,multiple:!i||!1!==i.multiple||i.multiple,direction:l?"horizontal":"vertical",target:{component:o,fill:"rgba( 82, 204, 82, 0.2 )",fillActive:"rgba(82, 204, 82, 0.4)"},bubbles:{align:t.getBublesAlign(l,c,u)}}};return e.extend(!0,{},h,n||{})}}),define("objects.picasso/chart-builder/components/ref-line",["util","core.utils/feature-flags","objects.utils/chart-style-utils"],function(e,t,n){"use strict";return function(i,r){var o,s,a=r&&r.chartID;t.THEMING?(o=n.getStyle(a,"referenceLine.outOfBounds","color"),s=n.getStyle(a,"referenceLine.outOfBounds","backgroundColor")):(o=n.getStyle("","referenceLine.outOfBounds","color"),s=n.getStyle("","referenceLine.outOfBounds","backgroundColor"));var l={key:"ref-line",type:"ref-line",dock:"center",prioOrder:-1,lines:{x:[],y:[]},style:{oob:{width:7,fill:s,text:{fill:o},padding:{x:7,y:5}}}};return e.extend(!0,{},l,i||{})}}),define("objects.picasso/chart-builder/layout-modes",[],function(){"use strict";function e(){return t}var t={SPARK:{width:0,height:0},XSMALL:{width:150,height:75},SMALL:{width:300,height:150},MEDIUM:{width:400,height:220},FULL:{width:550,height:450}};return e.getLayoutModeKeys=function(){var e,n=[];for(e in t)n.push(e);return n},e}),define("objects.picasso/chart-builder/components/labels",["util","objects.utils/chart-style-utils","core.utils/feature-flags"],function(e,t,n){"use strict";function i(e){var t=e.data.end;return e.dataset(t.source.key).field(t.source.field).formatter()(t.value)}return function(r,o){var s,a,l,c=o&&o.chartID,u=o&&o.layoutMode;n.THEMING?(s=t.getStyle(c,"label.value","color"),a=t.getFontSize(c,"label.value",u),l="QlikView Sans"):(s=t.getStyle("","","color"),a=t.getFontSize("","axis.label",u),l=t.getStyle("","axis.label","fontFamily"));var h={key:"labels",type:"labels",displayOrder:1,settings:{sources:[{component:"box-marker",selector:"rect",strategy:{type:"bar",settings:{direction:"up",fontFamily:l,fontSize:parseFloat(a),align:.5,labels:[{placements:[{position:"outside",fill:s,justify:0},{position:"inside",fill:r&&r.settings.sources[0].strategy.settings.labels[0].placements[1].fill,justify:1}],label:i}]}}}]}};return e.extend(!0,{},h,r||{})}}),define("objects.picasso/chart-builder/components/categorical-legend",["objects.utils/chart-style-utils","core.utils/feature-flags","util"],function(e,t,n){"use strict";return function(i,r){var o=r&&r.chartID,s=r&&r.layoutMode,a=r&&r.isRtl,l=r&&r.dock||"auto",c=r&&r.show;"auto"===l&&(l=r.chartHeight/r.chartWidth<1?a?"left":"right":"bottom");var u,h,d,p,f,m;t.THEMING?(d=e.getStyle(o,"legend.title","color"),u=e.getStyle(o,"legend.title","fontSize"),p=e.getStyle(o,"legend.label","color"),f=e.getStyle(o,"legend.label","fontSize"),h="QlikView Sans",m="QlikView Sans"):(d=e.getStyle("","legend.title","color"),u=e.getFontSize("","legend.title",s),h=e.getStyle("","legend.title","fontFamily"),p=e.getStyle("","legend.label","color"),f=e.getFontSize("","legend.label",s),m=e.getStyle("","legend.label","fontFamily"));var g={key:"legend",type:"legend-cat",dock:l,show:c,scale:{type:"color"},settings:{anchor:a?"right":"left",item:{label:{fontSize:f,fontFamily:m,fill:p,lineHeight:1,wordBreak:"break-word"},margin:{top:5,left:10,right:10,bottom:10},shape:{type:r.type?r.type:"square",size:parseInt(f,10)}},title:{show:r.showTitle,fontSize:u,fontFamily:h,fill:d},buttons:{show:!0}}};return r.tableMode&&(g.settings.layout={mode:"table",size:"top"===l||"bottom"===l?2:1}),n.extend(!0,{},g,i)}}),define("objects.picasso/chart-builder/components/sequential-legend",["objects.utils/chart-style-utils","core.utils/feature-flags","util"],function(e,t,n){"use strict";return function(i,r){function o(e){switch(e){case"left":return 0;case"right":return 1;case"middle":default:return.5}}var s=r&&r.chartID,a=r&&r.layoutMode,l=r&&r.isRtl,c=r.dock||"auto";"auto"===c&&(c=r.chartHeight<r.chartWidth?l?"left":"right":"bottom");var u,h,d,p,f,m;t.THEMING?(d=e.getStyle(s,"legend.title","color"),u=e.getFontSize(s,"legend.title",a),h="QlikView Sans",p=e.getStyle(s,"legend.label","color"),f=e.getFontSize(s,"legend.label",a),m="QlikView Sans"):(d=e.getStyle("","legend.title","color"),u=e.getFontSize("","legend.title",a),h=e.getStyle("","legend.title","fontFamily"),p=e.getStyle("","legend.label","color"),f=e.getFontSize("","legend.label",a),m=e.getStyle("","legend.label","fontFamily"));var g={key:"seqlegend",type:"legend-seq",dock:c,displayOrder:200,minimumLayoutMode:"MEDIUM",prioOrder:0,settings:{align:o(l?"right":"left"),major:{invert:"left"===c||"right"===c||l},title:{show:r.showTitle,fontSize:u,fontFamily:h,fill:d},tick:{fill:p,fontSize:f,fontFamily:m}}};return n.extend(!0,{},g,i)}}),define("objects.picasso/chart-builder/components/range-area",["util","objects.picasso/chart-builder/components/util/range-util"],function(e,t){"use strict";return function(n,i){var r=i&&i.brushKey,o=i&&i.brushAxis,s=i&&i.brushComponents?i.brushComponents:[],a=i&&i.brushData?i.brushData:["elemNo"],l=i&&i.brushArea,c=i&&i.isHorizontal,u=i&&i.dock,h=i&&i.isRtl,d=i&&i.chartInstance,p=!0,f={type:"brush-area-dir",key:"area",displayOrder:99,dock:t.getDock(o,l),settings:{brush:{components:[]},direction:c?"horizontal":"vertical",target:{component:o,fill:"rgba( 82, 204, 82, 0.2 )",fillActive:"rgba(82, 204, 82, 0.4)"},bubbles:{align:t.getBublesAlign(c,u,h),label:function(e){return p?(p=!1,d.dataset(e.binStart.source.key).field(e.binStart.source.field).formatter()(e.binStart.value)):(p=!0,d.dataset(e.binEnd.source.key).field(e.binEnd.source.field).formatter()(e.binEnd.value))}},multiple:!i||!1!==i.multiple||i.multiple}};return s.forEach(function(e){f.settings.brush.components.push({contexts:r?[r]:void 0,key:e,data:a,action:"add"})}),e.extend(!0,{},f,n||{})}}),define("objects.picasso/chart-builder/chart-builder",["objects.picasso/chart-builder/chart-presets","objects.picasso/chart-builder/scale","objects.picasso/chart-builder/components/axis","objects.picasso/chart-builder/components/box-marker","objects.picasso/chart-builder/components/event-area","objects.picasso/chart-builder/components/grid-line","objects.picasso/chart-builder/components/interaction","objects.picasso/chart-builder/components/point-marker","objects.picasso/chart-builder/components/scrollbar","objects.picasso/chart-builder/components/text","objects.picasso/chart-builder/components/lasso","objects.picasso/chart-builder/components/range","objects.picasso/chart-builder/components/ref-line","objects.picasso/chart-builder/layout-modes","objects.picasso/chart-builder/components/labels","objects.picasso/chart-builder/components/categorical-legend","objects.picasso/chart-builder/components/sequential-legend","objects.picasso/chart-builder/components/range-area","util"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,v,y){"use strict";function b(e,p,y){switch(e){case"scale":return t(p,y);case"measure-scale":return t.measureScale(p,y);case"dimension-scale":return t.dimensionScale(p,y);case"axis":return n(p,y);case"box-marker":return i(p,y);case"point-marker":return a(p,y);case"scrollbar":return l(p,y);case"text":return c(p,y);case"lasso":return u(p,y);case"range":return h(p,y);case"range-area":return v(p,y);case"categorical-legend":return m(p,y);case"sequential-legend":return g(p,y);case"x-axis":return n.xAxis(p,y);case"y-axis":return n.yAxis(p,y);case"x-axis-title":return c.xAxisTitle(p,y);case"y-axis-title":return c.yAxisTitle(p,y);case"grid-line":return o(p,y);case"interaction":return s(p,y);case"ref-line":return d(p,y);case"event-area":return r(p,y);case"labels":return f(p,y)}}function x(e){this.options=e||{},this.settings={dockLayout:{layoutModes:p()},components:[],scales:{}}}return x.prototype.addComponent=function(e,t,n){var i=b(e,t,y.extend(!0,{},this.options,n||{}));return this.settings.components.push(i),i},x.prototype.addInteraction=function(e,t){var n=b("interaction",e,y.extend(!0,{},this.options,t||{}));return this.settings.interactions||(this.settings.interactions=[]),this.settings.interactions.push(n),n},x.prototype.addScale=function(e,t,n){var i=b(e,t,y.extend(!0,{},this.options,n||{}));this.settings.scales[i.name]=i.component},x.prototype.getSettings=function(){return this.settings},x.prototype.getComponent=function(e){return this.settings.components.filter(function(t){return t.key===e})[0]},x.prototype.addPreset=function(t,n){e(t,this,n)},x.validateComponentKeys=function(e){var t={};return e.map(function(e){var n=e.key;return n?t[n]?"Duplicate key for component "+e.type:(t[n]=!0,null):"Missing key for component "+e.type}).filter(function(e){return!!e})},x.create=function(e){return new x(e)},x.createComponent=b,x}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("assets/external/picasso/picasso",t):e.picasso=t()}(this,function(){"use strict";function e(){return Qc}function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.dock,n=void 0===t?"":t,i=e.displayOrder,r=void 0===i?0:i,o=e.prioOrder,s=void 0===o?0:o,a=e.requiredSize,l=void 0===a?function(){return 0}:a,c=e.minimumLayoutMode,u=e.show,h=void 0===u||u,d=function(){};return d.requiredSize=function(e){return"function"==typeof e?(l=e,this):l},d.dock=function(e){return void 0===e?n:(n=e,this)},d.displayOrder=function(e){return void 0===e?r:(r=e,this)},d.prioOrder=function(e){return void 0===e?s:(s=e,this)},d.minimumLayoutMode=function(e){return void 0===e?c:(c=e,this)},d.show=function(e){return void 0===e?h:(h=!!e,this)},d}function n(e){e.x=Math.ceil(e.x),e.y=Math.ceil(e.y),e.width=Math.ceil(e.width),e.height=Math.ceil(e.height)}function i(e,t){var i={x:0,y:0,width:0,height:0},r={x:0,y:0,width:0,height:0};if("function"==typeof e.getBoundingClientRect){var o=e.getBoundingClientRect();i.width=o.width,i.height=o.height}else i.width=e.width||0,i.height=e.height||0;return void 0!==t.size&&(i.width=isNaN(t.size.width)?i.width:t.size.width,i.height=isNaN(t.size.height)?i.height:t.size.height),void 0!==t.logicalSize?(r.width=isNaN(t.logicalSize.width)?i.width:t.logicalSize.width,r.height=isNaN(t.logicalSize.height)?i.height:t.logicalSize.height,r.align=isNaN(t.logicalSize.align)?.5:Math.min(Math.max(t.logicalSize.align,0),1),r.preserveAspectRatio=t.logicalSize.preserveAspectRatio):(r.width=i.width,r.height=i.height,r.preserveAspectRatio=!1),n(r),n(i),[r,i]}function r(e,t){return i(e,t)}function o(e){var t={logicalSize:{preserveAspectRatio:!1},center:{minWidthRatio:.5,minHeightRatio:.5,minWidth:0,minHeight:0}};return Yc(!0,t,e),t.center.minWidthRatio=Math.min(Math.max(t.center.minWidthRatio,0),1),t.center.minHeightRatio=Math.min(Math.max(t.center.minHeightRatio,0),1),t.center.minWidth=Math.max(t.center.minWidth,0),t.center.minHeight=Math.max(t.center.minHeight,0),t}function s(e,t){return{x:e.x+t.x,y:e.y+t.y}}function a(e,t){return{x:e.x-t.x,y:e.y-t.y}}function l(e,t){return{x:e.x*t,y:e.y*t}}function c(e,t){return e.x-t.x}function u(e,t){return e.y-t.y}function h(e,t){return Math.pow(c(e,t),2)+Math.pow(u(e,t),2)}function d(e,t){return Math.sqrt(h(e,t))}function p(e,t){return e.x*t.x+e.y*t.y}function f(e,t){var n=p(e,t)/p(t,t)||1;return{x:t.x*n,y:t.y*n}}function m(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0},i=Math.cos(t),r=Math.sin(t),o=a(e,n);return s({x:i*o.x-r*o.y,y:r*o.x+i*o.y},n)}function g(e,t,n){return s(f(a(n,e),a(t,e)),e)}function v(e,t,n){return d(e,n)+d(t,n)-d(e,t)<au}function y(e){return[{x:e.x1||0,y:e.y1||0},{x:e.x2||0,y:e.y2||0}]}function b(e){return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}]}function x(e){for(var t=e.length,n=NaN,i=NaN,r=NaN,o=NaN,s=0;s<t;s++)n=isNaN(n)?e[s].x:Math.min(n,e[s].x),i=isNaN(i)?e[s].x:Math.max(i,e[s].x),r=isNaN(r)?e[s].y:Math.min(r,e[s].y),o=isNaN(o)?e[s].y:Math.max(o,e[s].y);return[n,r,i,o]}function q(e){var t=x(e),n=ou(t,4),i=n[0],r=n[1];return{x:i,y:r,width:n[2]-i,height:n[3]-r}}function C(e,t){return{cx:e[0].x,cy:e[0].y,r:t}}function S(e){return{x1:e[0].x,y1:e[0].y,x2:e[1].x,y2:e[1].y}}function w(e){["resize"].forEach(function(t){if("function"!=typeof e[t])throw new Error('Component is missing required function "'+t+'"')})}function _(e,t,n){if(void 0===e.cachedSize){var i=e.config.requiredSize()(t,n);"object"===(void 0===i?"undefined":Zc(i))?(e.cachedSize=Math.ceil(i.size),e.edgeBleed=i.edgeBleed):e.cachedSize=Math.ceil(i)}return e.cachedSize}function D(e,t,n){var i=Math.min(n.center.minWidth,e.width)||Math.max(e.width*n.center.minWidthRatio,1),r=Math.min(n.center.minHeight,e.height)||Math.max(e.height*n.center.minHeightRatio,1);return t.width>=i&&t.height>=r}function M(e,t){switch(t.config.dock()){case"top":e.y+=t.cachedSize,e.height-=t.cachedSize;break;case"bottom":e.height-=t.cachedSize;break;case"left":e.x+=t.cachedSize,e.width-=t.cachedSize;break;case"right":e.width-=t.cachedSize}}function A(e,t){var n=t.edgeBleed;n&&(e.left=Math.max(e.left,n.left||0),e.right=Math.max(e.right,n.right||0),e.top=Math.max(e.top,n.top||0),e.bottom=Math.max(e.bottom,n.bottom||0))}function E(e,t,n){t.x<n.left&&(t.width-=n.left-t.x,t.x=n.left);var i=e.width-(t.x+t.width);i<n.right&&(t.width-=n.right-i),t.y<n.top&&(t.height-=n.top-t.y,t.y=n.top);var r=e.height-(t.y+t.height);r<n.bottom&&(t.height-=n.bottom-r)}function I(e,t,n,i,r){var o=Yc({},t),s=Yc({},n);return M(o,i),A(s,i),E(e,o,s),!!D(e,o,r)&&(M(t,i),A(n,i),!0)}function T(e,t,n,i){var r={x:e.x,y:e.y,width:e.width,height:e.height},o={left:0,right:0,top:0,bottom:0},s=t.slice();s.sort(function(e,t){return e.config.prioOrder()-t.config.prioOrder()});for(var a=0;a<s.length;++a){var l=s[a];_(l,r,e),I(e,r,o,l,i)||(s.splice(a,1),n.push(l.instance),--a)}var c=t.filter(function(e){return-1!==s.indexOf(e)});return t.length=0,t.push.apply(t,su(c)),E(e,r,o),r}function L(e,t,n,i){var r={x:i.width/n.width,y:i.height/n.height},o={left:0,top:0};if(n.preserveAspectRatio){var s=r.x<r.y,a=Math.min(r.x,r.y);r.x=a,r.y=a;var l=s?"height":"width",c=(i[l]-n[l]*r.x)*n.align;o.left=s?0:c,o.top=s?c:0}e.scaleRatio=r,e.margin=o,t.scaleRatio=r,t.margin=o,n.scaleRatio=r,n.margin=o}function k(e){var t;return q((t=[]).concat.apply(t,su(e.map(b))))}function O(e,t,n,i){var r={x:n.x,y:n.y,width:n.width,height:n.height},o={x:n.x,y:n.y,width:n.width,height:n.height},s={};e.sort(function(e,t){return/^@/.test(t.config.dock())?-1:/^@/.test(e.config.dock())?1:e.config.displayOrder()-t.config.displayOrder()}).forEach(function(e){var a={},l={},c=e.config.dock();switch(c){case"top":a.height=l.height=e.cachedSize,a.width=t.width,l.width=r.width,a.x=t.x,l.x=r.x,a.y=l.y=r.y-e.cachedSize,r.y-=e.cachedSize,r.height+=e.cachedSize;break;case"bottom":a.x=t.x,l.x=r.x,a.y=l.y=r.y+r.height,a.width=t.width,l.width=r.width,a.height=l.height=e.cachedSize,r.height+=e.cachedSize;break;case"left":a.x=l.x=o.x-e.cachedSize,a.y=t.y,l.y=o.y,a.width=l.width=e.cachedSize,a.height=t.height,l.height=o.height,o.x-=e.cachedSize,o.width+=e.cachedSize;break;case"right":a.x=l.x=o.x+o.width,a.y=t.y,l.y=o.y,a.width=l.width=e.cachedSize,a.height=t.height,l.height=o.height,o.width+=e.cachedSize;break;default:a.x=l.x=n.x,a.y=l.y=n.y,a.width=l.width=n.width,a.height=l.height=n.height}if(/^@/.test(c)){var u=c.split(",").map(function(e){return s[e.replace("@","")]}).filter(function(e){return!!e});u.length>0&&(a=k(u.map(function(e){return e.outerRect})),l=k(u.map(function(e){return e.rect})))}else e.key&&(s[e.key]={rect:l,outerRect:a});L(l,a,t,i),e.instance.resize(l,a,t),e.cachedSize=void 0})}function P(e,t,n,i){for(var r=n.layoutModes||{},o=0;o<e.length;++o){var s=e[o],a=s.config.minimumLayoutMode(),l=s.config.show();l&&"object"===(void 0===a?"undefined":Zc(a))?l=r[a.width]&&r[a.height]&&i.width>=r[a.width].width&&i.height>=r[a.height].height:l&&void 0!==a&&(l=r[a]&&i.width>=r[a].width&&i.height>=r[a].height),l||(e.splice(o,1),t.push(s.instance),--o)}}function N(e){var n=[],i=[],s=o(e),a=function(){};return a.addComponent=function(e,i){w(e),a.removeComponent(e),n.push({instance:e,key:i,config:"function"==typeof e.dockConfig?e.dockConfig:t(e.dockConfig)})},a.removeComponent=function(e){var t=n.map(function(e){return e.instance}).indexOf(e);t>-1&&n.splice(t,1)},a.layout=function(e){var t=r(e,s),o=ou(t,2),a=o[0],l=o[1];P(n,i,s,a);var c=T(a,n,i,s);return O(n,a,c,l),{visible:n.map(function(e){return e.instance}),hidden:i}},a.settings=function(e){s=o(e)},a}function R(e){return"ontouchstart"in e&&"ontouchend"in e}function F(e){return!!e.changedTouches}function j(e,t){var n=F(e),i=n?e.changedTouches[0]:e,r=Date.now()-t.time,o=isNaN(t.x)?0:Math.abs(i.clientX-t.x),s=isNaN(t.y)?0:Math.abs(i.clientY-t.y);return(0===e.button||n)&&!t.multiTouch&&o<=12&&s<=12&&r<=300}function V(e){return"number"==typeof e&&!isNaN(e)}function H(e){var t=e||{},n=t.x,i=t.y,r=t.width,o=t.height,s=t.x1,a=t.x2,l=t.y1,c=t.y2,u=t.cx,h=t.cy,d=t.r,p=t.vertices;return V(u)&&V(h)&&V(d)?"circle":V(s)&&V(a)&&V(l)&&V(c)?"line":V(n)&&V(i)&&V(r)&&V(o)?"rect":V(n)&&V(i)?"point":Array.isArray(p)?"polygon":null}function B(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n="",i=0;i<e.length;i++){var r=e[i];n+=0===i?"M"+r.x+" "+r.y:"L"+r.x+" "+r.y,n+=" "}return t&&(n+="Z"),n}function z(e,t){var n=t.types,i=t.logger,r={},o=[];Array.isArray(e)?o.push.apply(o,su(e)):(i.warn('Deprecated: "data-source" configuration"'),o.push(e)),o.forEach(function(e,t){var i=n(e.type);if(i){var o=i({key:e.key||t,data:e.data,config:e.config});r[e.key||t]=o}});return function(e){return e?r[e]:r[Object.keys(r)[0]]}}function $(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function U(){return new $}function G(e){return e>1?0:e<-1?xu:Math.acos(e)}function W(e){return e>=1?qu:e<=-1?-qu:Math.asin(e)}function X(e){return e.innerRadius}function Y(e){return e.outerRadius}function K(e){return e.startAngle}function Q(e){return e.endAngle}function Z(e){return e&&e.padAngle}function J(e,t,n,i,r,o,s,a){var l=n-e,c=i-t,u=s-r,h=a-o,d=(u*(t-o)-h*(e-r))/(h*l-u*c);return[e+d*l,t+d*c]}function ee(e,t,n,i,r,o,s){var a=e-n,l=t-i,c=(s?o:-o)/yu(a*a+l*l),u=c*l,h=-c*a,d=e+u,p=t+h,f=n+u,m=i+h,g=(d+f)/2,v=(p+m)/2,y=f-d,b=m-p,x=y*y+b*b,q=r-o,C=d*m-f*p,S=(b<0?-1:1)*yu(mu(0,q*q*x-C*C)),w=(C*b-y*S)/x,_=(-C*y-b*S)/x,D=(C*b+y*S)/x,M=(-C*y+b*S)/x,A=w-g,E=_-v,I=D-g,T=M-v;return A*A+E*E>I*I+T*T&&(w=D,_=M),{cx:w,cy:_,x01:-u,y01:-h,x11:w*(r/q-1),y11:_*(r/q-1)}}function te(e){this._context=e}function ne(e){return e[0]}function ie(e){return e[1]}function re(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function oe(e){this._context=e}function se(e,t,n){e._context.bezierCurveTo(e._x1+e._k*(e._x2-e._x0),e._y1+e._k*(e._y2-e._y0),e._x2+e._k*(e._x1-t),e._y2+e._k*(e._y1-n),e._x2,e._y2)}function ae(e,t){this._context=e,this._k=(1-t)/6}function le(e,t,n){var i=e._x1,r=e._y1,o=e._x2,s=e._y2;if(e._l01_a>bu){var a=2*e._l01_2a+3*e._l01_a*e._l12_a+e._l12_2a,l=3*e._l01_a*(e._l01_a+e._l12_a);i=(i*a-e._x0*e._l12_2a+e._x2*e._l01_2a)/l,r=(r*a-e._y0*e._l12_2a+e._y2*e._l01_2a)/l}if(e._l23_a>bu){var c=2*e._l23_2a+3*e._l23_a*e._l12_a+e._l12_2a,u=3*e._l23_a*(e._l23_a+e._l12_a);o=(o*c+e._x1*e._l23_2a-t*e._l12_2a)/u,s=(s*c+e._y1*e._l23_2a-n*e._l12_2a)/u}e._context.bezierCurveTo(i,r,o,s,e._x2,e._y2)}function ce(e,t){this._context=e,this._alpha=t}function ue(e){return e<0?-1:1}function he(e,t,n){var i=e._x1-e._x0,r=t-e._x1,o=(e._y1-e._y0)/(i||r<0&&-0),s=(n-e._y1)/(r||i<0&&-0),a=(o*r+s*i)/(i+r);return(ue(o)+ue(s))*Math.min(Math.abs(o),Math.abs(s),.5*Math.abs(a))||0}function de(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function pe(e,t,n){var i=e._x0,r=e._y0,o=e._x1,s=e._y1,a=(o-i)/3;e._context.bezierCurveTo(i+a,r+a*t,o-a,s-a*n,o,s)}function fe(e){this._context=e}function me(e){this._context=new ge(e)}function ge(e){this._context=e}function ve(e){this._context=e}function ye(e){var t,n,i=e.length-1,r=new Array(i),o=new Array(i),s=new Array(i);for(r[0]=0,o[0]=2,s[0]=e[0]+2*e[1],t=1;t<i-1;++t)r[t]=1,o[t]=4,s[t]=4*e[t]+2*e[t+1];for(r[i-1]=2,o[i-1]=7,s[i-1]=8*e[i-1]+e[i],t=1;t<i;++t)n=r[t]/o[t-1],o[t]-=n,s[t]-=n*s[t-1];for(r[i-1]=s[i-1]/o[i-1],t=i-2;t>=0;--t)r[t]=(s[t]-r[t+1])/o[t];for(o[i-1]=(e[i]+r[i-1])/2,t=0;t<i-1;++t)o[t]=2*e[t+1]-r[t+1];return[r,o]}function be(e,t){this._context=e,this._t=t}function xe(e,t){return e[t]}function qe(e){for(var t,n=0,i=-1,r=e.length;++i<r;)(t=+e[i][1])&&(n+=t);return n}function Ce(e){function t(e,t){if(!e||"string"!=typeof e)throw new TypeError("Invalid argument: key must be a non-empty string");return!(e in o)&&(o[e]=t,!0)}function n(e){return o[e]||s.get(e)}function i(e,i){return void 0!==i?t(e,i):n(e||r)}var r=void 0,o={},s=e||{get:function(){},has:function(){return!1},default:function(){}};return r=s.default(),i.add=t,i.get=n,i.has=function(e){return!!o[e]||s.has(e)},i.remove=function(e){var t=o[e];return delete o[e],t},i.getKeys=function(){return Object.keys(o)},i.getValues=function(){return Object.keys(o).map(function(e){return o[e]})},i.default=function(e){return void 0!==e&&(r=e),r},i.register=t,i}function Se(e){return new we(e)}function we(e){if(!(t=zu.exec(e)))throw new Error("invalid format: "+e);var t,n=t[1]||" ",i=t[2]||">",r=t[3]||"-",o=t[4]||"",s=!!t[5],a=t[6]&&+t[6],l=!!t[7],c=t[8]&&+t[8].slice(1),u=t[9]||"";"n"===u?(l=!0,u="g"):Bu[u]||(u=""),(s||"0"===n&&"="===i)&&(s=!0,n="0",i="="),this.fill=n,this.align=i,this.sign=r,this.symbol=o,this.zero=s,this.width=a,this.comma=l,this.precision=c,this.type=u}function _e(e,t,n,i){function r(t){return e(t=new Date(+t)),t}return r.floor=r,r.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},r.round=function(e){var t=r(e),n=r.ceil(e);return e-t<n-e?t:n},r.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},r.range=function(n,i,o){var s,a=[];if(n=r.ceil(n),o=null==o?1:Math.floor(o),!(n<i&&o>0))return a;do{a.push(s=new Date(+n)),t(n,o),e(n)}while(s<n&&n<i);return a},r.filter=function(n){return _e(function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)},function(e,i){if(e>=e)if(i<0)for(;++i<=0;)for(;t(e,-1),!n(e););else for(;--i>=0;)for(;t(e,1),!n(e););})},n&&(r.count=function(t,i){return Ju.setTime(+t),eh.setTime(+i),e(Ju),e(eh),Math.floor(n(Ju,eh))},r.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?r.filter(i?function(t){return i(t)%e==0}:function(t){return r.count(0,t)%e==0}):r:null}),r}function De(e){return _e(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+7*t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*nh)/ih})}function Me(e){return _e(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+7*t)},function(e,t){return(t-e)/ih})}function Ae(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Ee(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Ie(e){return{y:e,m:0,d:1,H:0,M:0,S:0,L:0}}function Te(e){function t(e,t){return function(n){var i,r,o,s=[],a=-1,l=0,c=e.length;for(n instanceof Date||(n=new Date(+n));++a<c;)37===e.charCodeAt(a)&&(s.push(e.slice(l,a)),null!=(r=bh[i=e.charAt(++a)])?i=e.charAt(++a):r="e"===i?" ":"0",(o=t[i])&&(i=o(n,r)),s.push(i),l=a+1);return s.push(e.slice(l,a)),s.join("")}}function n(e,t){return function(n){var r,o,s=Ie(1900);if(i(s,e,n+="",0)!=n.length)return null;if("Q"in s)return new Date(s.Q);if("p"in s&&(s.H=s.H%12+12*s.p),"V"in s){if(s.V<1||s.V>53)return null;"w"in s||(s.w=1),"Z"in s?(r=(o=(r=Ee(Ie(s.y))).getUTCDay())>4||0===o?hh.ceil(r):hh(r),r=ch.offset(r,7*(s.V-1)),s.y=r.getUTCFullYear(),s.m=r.getUTCMonth(),s.d=r.getUTCDate()+(s.w+6)%7):(r=(o=(r=t(Ie(s.y))).getDay())>4||0===o?sh.ceil(r):sh(r),r=rh.offset(r,7*(s.V-1)),s.y=r.getFullYear(),s.m=r.getMonth(),s.d=r.getDate()+(s.w+6)%7)}else("W"in s||"U"in s)&&("w"in s||(s.w="u"in s?s.u%7:"W"in s?1:0),o="Z"in s?Ee(Ie(s.y)).getUTCDay():t(Ie(s.y)).getDay(),s.m=0,s.d="W"in s?(s.w+6)%7+7*s.W-(o+5)%7:s.w+7*s.U-(o+6)%7);return"Z"in s?(s.H+=s.Z/100|0,s.M+=s.Z%100,Ee(s)):t(s)}}function i(e,t,n,i){for(var r,o,s=0,a=t.length,l=n.length;s<a;){if(i>=l)return-1;if(37===(r=t.charCodeAt(s++))){if(r=t.charAt(s++),!(o=w[r in bh?t.charAt(s++):r])||(i=o(e,n,i))<0)return-1}else if(r!=n.charCodeAt(i++))return-1}return i}var r=e.dateTime,o=e.date,s=e.time,a=e.periods,l=e.days,c=e.shortDays,u=e.months,h=e.shortMonths,d=Oe(a),p=Pe(a),f=Oe(l),m=Pe(l),g=Oe(c),v=Pe(c),y=Oe(u),b=Pe(u),x=Oe(h),q=Pe(h),C={a:function(e){return c[e.getDay()]},A:function(e){return l[e.getDay()]},b:function(e){return h[e.getMonth()]},B:function(e){return u[e.getMonth()]},c:null,d:tt,e:tt,f:st,H:nt,I:it,j:rt,L:ot,m:at,M:lt,p:function(e){return a[+(e.getHours()>=12)]},Q:Nt,s:Rt,S:ct,u:ut,U:ht,V:dt,w:pt,W:ft,x:null,X:null,y:mt,Y:gt,Z:vt,"%":Pt},S={a:function(e){return c[e.getUTCDay()]},A:function(e){return l[e.getUTCDay()]},b:function(e){return h[e.getUTCMonth()]},B:function(e){return u[e.getUTCMonth()]},c:null,d:yt,e:yt,f:St,H:bt,I:xt,j:qt,L:Ct,m:wt,M:_t,p:function(e){return a[+(e.getUTCHours()>=12)]},Q:Nt,s:Rt,S:Dt,u:Mt,U:At,V:Et,w:It,W:Tt,x:null,X:null,y:Lt,Y:kt,Z:Ot,"%":Pt},w={a:function(e,t,n){var i=g.exec(t.slice(n));return i?(e.w=v[i[0].toLowerCase()],n+i[0].length):-1},A:function(e,t,n){var i=f.exec(t.slice(n));return i?(e.w=m[i[0].toLowerCase()],n+i[0].length):-1},b:function(e,t,n){var i=x.exec(t.slice(n));return i?(e.m=q[i[0].toLowerCase()],n+i[0].length):-1},B:function(e,t,n){var i=y.exec(t.slice(n));return i?(e.m=b[i[0].toLowerCase()],n+i[0].length):-1},c:function(e,t,n){return i(e,r,t,n)},d:Ue,e:Ue,f:Qe,H:We,I:We,j:Ge,L:Ke,m:$e,M:Xe,p:function(e,t,n){var i=d.exec(t.slice(n));return i?(e.p=p[i[0].toLowerCase()],n+i[0].length):-1},Q:Je,s:et,S:Ye,u:Re,U:Fe,V:je,w:Ne,W:Ve,x:function(e,t,n){return i(e,o,t,n)},X:function(e,t,n){return i(e,s,t,n)},y:Be,Y:He,Z:ze,"%":Ze};return C.x=t(o,C),C.X=t(s,C),C.c=t(r,C),S.x=t(o,S),S.X=t(s,S),S.c=t(r,S),{format:function(e){var n=t(e+="",C);return n.toString=function(){return e},n},parse:function(e){var t=n(e+="",Ae);return t.toString=function(){return e},t},utcFormat:function(e){var n=t(e+="",S);return n.toString=function(){return e},n},utcParse:function(e){var t=n(e,Ee);return t.toString=function(){return e},t}}}function Le(e,t,n){var i=e<0?"-":"",r=(i?-e:e)+"",o=r.length;return i+(o<n?new Array(n-o+1).join(t)+r:r)}function ke(e){return e.replace(Ch,"\\$&")}function Oe(e){return new RegExp("^(?:"+e.map(ke).join("|")+")","i")}function Pe(e){for(var t={},n=-1,i=e.length;++n<i;)t[e[n].toLowerCase()]=n;return t}function Ne(e,t,n){var i=xh.exec(t.slice(n,n+1));return i?(e.w=+i[0],n+i[0].length):-1}function Re(e,t,n){var i=xh.exec(t.slice(n,n+1));return i?(e.u=+i[0],n+i[0].length):-1}function Fe(e,t,n){var i=xh.exec(t.slice(n,n+2));return i?(e.U=+i[0],n+i[0].length):-1}function je(e,t,n){var i=xh.exec(t.slice(n,n+2));return i?(e.V=+i[0],n+i[0].length):-1}function Ve(e,t,n){var i=xh.exec(t.slice(n,n+2));return i?(e.W=+i[0],n+i[0].length):-1}function He(e,t,n){var i=xh.exec(t.slice(n,n+4));return i?(e.y=+i[0],n+i[0].length):-1}function Be(e,t,n){var i=xh.exec(t.slice(n,n+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function ze(e,t,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function $e(e,t,n){var i=xh.exec(t.slice(n,n+2));return i?(e.m=i[0]-1,n+i[0].length):-1}function Ue(e,t,n){var i=xh.exec(t.slice(n,n+2));return i?(e.d=+i[0],n+i[0].length):-1}function Ge(e,t,n){var i=xh.exec(t.slice(n,n+3));return i?(e.m=0,e.d=+i[0],n+i[0].length):-1}function We(e,t,n){var i=xh.exec(t.slice(n,n+2));return i?(e.H=+i[0],n+i[0].length):-1}function Xe(e,t,n){var i=xh.exec(t.slice(n,n+2));return i?(e.M=+i[0],n+i[0].length):-1}function Ye(e,t,n){var i=xh.exec(t.slice(n,n+2));return i?(e.S=+i[0],n+i[0].length):-1}function Ke(e,t,n){var i=xh.exec(t.slice(n,n+3));return i?(e.L=+i[0],n+i[0].length):-1}function Qe(e,t,n){var i=xh.exec(t.slice(n,n+6));return i?(e.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function Ze(e,t,n){var i=qh.exec(t.slice(n,n+1));return i?n+i[0].length:-1}function Je(e,t,n){var i=xh.exec(t.slice(n));return i?(e.Q=+i[0],n+i[0].length):-1}function et(e,t,n){var i=xh.exec(t.slice(n));return i?(e.Q=1e3*+i[0],n+i[0].length):-1}function tt(e,t){return Le(e.getDate(),t,2)}function nt(e,t){return Le(e.getHours(),t,2)}function it(e,t){return Le(e.getHours()%12||12,t,2)}function rt(e,t){return Le(1+rh.count(lh(e),e),t,3)}function ot(e,t){return Le(e.getMilliseconds(),t,3)}function st(e,t){return ot(e,t)+"000"}function at(e,t){return Le(e.getMonth()+1,t,2)}function lt(e,t){return Le(e.getMinutes(),t,2)}function ct(e,t){return Le(e.getSeconds(),t,2)}function ut(e){var t=e.getDay();return 0===t?7:t}function ht(e,t){return Le(oh.count(lh(e),e),t,2)}function dt(e,t){var n=e.getDay();return e=n>=4||0===n?ah(e):ah.ceil(e),Le(ah.count(lh(e),e)+(4===lh(e).getDay()),t,2)}function pt(e){return e.getDay()}function ft(e,t){return Le(sh.count(lh(e),e),t,2)}function mt(e,t){return Le(e.getFullYear()%100,t,2)}function gt(e,t){return Le(e.getFullYear()%1e4,t,4)}function vt(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Le(t/60|0,"0",2)+Le(t%60,"0",2)}function yt(e,t){return Le(e.getUTCDate(),t,2)}function bt(e,t){return Le(e.getUTCHours(),t,2)}function xt(e,t){return Le(e.getUTCHours()%12||12,t,2)}function qt(e,t){return Le(1+ch.count(ph(e),e),t,3)}function Ct(e,t){return Le(e.getUTCMilliseconds(),t,3)}function St(e,t){return Ct(e,t)+"000"}function wt(e,t){return Le(e.getUTCMonth()+1,t,2)}function _t(e,t){return Le(e.getUTCMinutes(),t,2)}function Dt(e,t){return Le(e.getUTCSeconds(),t,2)}function Mt(e){var t=e.getUTCDay();return 0===t?7:t}function At(e,t){return Le(uh.count(ph(e),e),t,2)}function Et(e,t){var n=e.getUTCDay();return e=n>=4||0===n?dh(e):dh.ceil(e),Le(dh.count(ph(e),e)+(4===ph(e).getUTCDay()),t,2)}function It(e){return e.getUTCDay()}function Tt(e,t){return Le(hh.count(ph(e),e),t,2)}function Lt(e,t){return Le(e.getUTCFullYear()%100,t,2)}function kt(e,t){return Le(e.getUTCFullYear()%1e4,t,4)}function Ot(){return"+0000"}function Pt(){return"%"}function Nt(e){return+e}function Rt(e){return Math.floor(+e/1e3)}function Ft(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.id,i=void 0===n?wh.id:n,r=t.key,o=void 0===r?wh.key:r,s=t.min,a=void 0===s?wh.min:s,l=t.max,c=void 0===l?wh.max:l,u=t.type,h=void 0===u?wh.type:u,d=t.tags,p=void 0===d?wh.tags:d,f=t.title,m=void 0===f?wh.title:f,g=t.values,v=void 0===g?wh.values:g,y=t.value,b=void 0===y?wh.value:y,x=t.label,q=void 0===x?wh.label:x,C=t.formatter,S=void 0===C?wh.formatter:C;return{id:function(){return i(e)},key:function(){return o(e)},raw:function(){return e},tags:function(){return p(e)},type:function(){return h(e)},min:function(){return a(e)},max:function(){return c(e)},title:function(){return m(e)},items:function(){return v(e)},formatter:function(){return S(e)},value:b,label:q}}function jt(e,t,n){for(var i={},r=t.stackKey,o=t.value,s=t.startProp||"start",a=t.endProp||"end",l=t.offset||"none",c=t.order||"none",u=t.valueRef||"",h=0,d={},p=0;p<e.items.length;p++){var f=e.items[p],m=u?f[u]:null;if(m&&m.source){var g=(m.source.key||"")+"/"+m.source.field;d[g]||(d[g]=m.source)}var v=r(f);i[v]=i[v]||{items:[]},i[v].items.push(f),h=Math.max(h,i[v].items.length)}for(var y=Array.apply(null,{length:h}).map(Number.call,Number),b=Object.keys(i).map(function(e){return i[e].items}),x=Nu().keys(y).value(function(e,t){return e[t]?o(e[t]):0}).order(Dh[c]).offset(_h[l])(b),q=[],C=0;C<x.length;C++)for(var S=x[C],w=0;w<S.length;w++){var _=S[w],D=S[w].data[S.key];D&&(D[s]={value:_[0]},D[a]={value:_[1]},q.push(_[0],_[1]))}var M=Object.keys(d).map(function(e){var t=n(d[e].key);return t?t.field(d[e].field):null}).filter(function(e){return!!e}),A=Ft({title:M.map(function(e){return e.title()}).join(", "),min:Math.min.apply(Math,q),max:Math.max.apply(Math,q),type:"measure",formatter:M[0]?M[0].formatter:void 0});e.fields.push(A)}function Vt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={},i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).logger;if(Array.isArray(e))n.items=e.map(function(e){return{value:e,label:String(e)}});else if(e){if("collection"in e)return t.collection(e.collection);var r=t.dataset?t.dataset(e.source):null,o=e.value||function(e){return e},s=e.label||function(e){return e};if(e.groupBy||e.mapTo)i.warn('Deprecated "data" configuration',e),n.items=[];else if(e.hierarchy)n.root=r.hierarchy?r.hierarchy(e.hierarchy):null;else if(e.items)n.items=e.items.map(function(e){return{value:o(e),label:String(s(e))}});else if(e.extract){var a=Array.isArray(e.extract)?e.extract:[e.extract];n.items=[];var l=[];if(a.forEach(function(e){var i,o=e.source?t.dataset(e.source):r;o&&((i=n.items).push.apply(i,su(o.extract(e))),e.field&&l.push(o.field(e.field)))}),l.length&&(n.fields=l),e.amend&&Array.isArray(e.amend)){var c;(c=n.items).push.apply(c,su(e.amend))}}else if(void 0!==e.field&&r){var u=r.field(e.field);u&&(n.fields||(n.fields=[]),n.fields.push(u),"value"in e||(o=u.value||function(e){return e},s=u.label||function(e){return e},n.value=o),n.items=u.items().map(function(t){return{value:o(t),label:String(s(t)),source:{field:e.field}}}))}else e.fields&&e.fields.forEach(function(e){var i="object"===(void 0===e?"undefined":Zc(e))&&e.source?t.dataset(e.source):r;if(i){var o=void 0;(o="object"===(void 0===e?"undefined":Zc(e))&&void 0!==e.field?i.field(e.field):i.field(e))&&(n.fields||(n.fields=[]),n.fields.push(o))}});n.items&&e.map&&(n.items=n.items.map(e.map))}return e&&e.stack&&jt(n,e.stack,t.dataset),n}function Ht(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Vt,r={};(e||[]).forEach(function(e){if(!e.key)throw new Error('Data collection is missing "key" property');if("object"===Zc(e.data)&&"collection"in e.data)throw new Error("Data config for collections may not reference other collections");r[e.key]=i(e.data,t,n)});return function(e){var t=void 0,n=void 0;if("string"==typeof e?t=e:"object"===(void 0===e?"undefined":Zc(e))&&(t=e.key,n=e),!(t in r))throw new Error("Unknown data collection: "+t);var i=r[t];if(n&&n.fields&&n.fields.filter){var o=i.fields.filter(n.fields.filter);i.fields.length!==o.length&&(i=Yc(i,{fields:o}))}return i}}function Bt(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Vt;if(e.data){var r=i(e.data,t,n);if(r&&r.fields&&r.fields[0])return r.fields[0].formatter()}var o=void 0;if(o=e.formatter?e.formatter+"-"+(e.type||"number"):e.type||"d3-number",n.formatter.has(o))return n.formatter.get(o)(e.format||"");throw new Error("Formatter of type '"+o+"' was not found")}function zt(e,t,n){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=Bt(e[r],t,n));return i}function $t(e,t,n,i){var r=void 0;return"string"==typeof e&&t[e]?r=t[e]:"object"===(void 0===e?"undefined":Zc(e))&&"formatter"in e&&t[e.formatter]?r=t[e.formatter]:"object"===(void 0===e?"undefined":Zc(e))&&"type"in e&&t[e.type]&&(r=t[e.type]),r||Bt(e,n,i)}function Ut(e){return function(t,n){return Mh(e(t),n)}}function Gt(e,t,n){var i=(t-e)/Math.max(0,n),r=Math.floor(Math.log(i)/Math.LN10),o=i/Math.pow(10,r);return r>=0?(o>=Ih?10:o>=Th?5:o>=Lh?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(o>=Ih?10:o>=Th?5:o>=Lh?2:1)}function Wt(e,t,n){var i=Math.abs(t-e)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),o=i/r;return o>=Ih?r*=10:o>=Th?r*=5:o>=Lh&&(r*=2),t<e?-r:r}function Xt(){}function Yt(e,t){var n=new Xt;if(e instanceof Xt)e.each(function(e,t){n.set(t,e)});else if(Array.isArray(e)){var i,r=-1,o=e.length;if(null==t)for(;++r<o;)n.set(r,e[r]);else for(;++r<o;)n.set(t(i=e[r],r,e),i)}else if(e)for(var s in e)n.set(s,e[s]);return n}function Kt(){}function Qt(e){function t(t){var o=t+"",s=n.get(o);if(!s){if(r!==Fh)return r;n.set(o,s=i.push(t))}return e[(s-1)%e.length]}var n=Yt(),i=[],r=Fh;return e=null==e?[]:Rh.call(e),t.domain=function(e){if(!arguments.length)return i.slice();i=[],n=Yt();for(var r,o,s=-1,a=e.length;++s<a;)n.has(o=(r=e[s])+"")||n.set(o,i.push(r));return t},t.range=function(n){return arguments.length?(e=Rh.call(n),t):e.slice()},t.unknown=function(e){return arguments.length?(r=e,t):r},t.copy=function(){return Qt().domain(i).range(e).unknown(r)},t}function Zt(){function e(){var e=r().length,i=s[1]<s[0],h=s[i-0],d=s[1-i];t=(d-h)/Math.max(1,e-l+2*c),a&&(t=Math.floor(t)),h+=(d-h-t*(e-l))*u,n=t*(1-l),a&&(h=Math.round(h),n=Math.round(n));var p=Eh(e).map(function(e){return h+t*e});return o(i?p.reverse():p)}var t,n,i=Qt().unknown(void 0),r=i.domain,o=i.range,s=[0,1],a=!1,l=0,c=0,u=.5;return delete i.unknown,i.domain=function(t){return arguments.length?(r(t),e()):r()},i.range=function(t){return arguments.length?(s=[+t[0],+t[1]],e()):s.slice()},i.rangeRound=function(t){return s=[+t[0],+t[1]],a=!0,e()},i.bandwidth=function(){return n},i.step=function(){return t},i.round=function(t){return arguments.length?(a=!!t,e()):a},i.padding=function(t){return arguments.length?(l=c=Math.max(0,Math.min(1,t)),e()):l},i.paddingInner=function(t){return arguments.length?(l=Math.max(0,Math.min(1,t)),e()):l},i.paddingOuter=function(t){return arguments.length?(c=Math.max(0,Math.min(1,t)),e()):c},i.align=function(t){return arguments.length?(u=Math.max(0,Math.min(1,t)),e()):u},i.copy=function(){return Zt().domain(r()).range(s).round(a).paddingInner(l).paddingOuter(c).align(u)},e()}function Jt(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function en(){}function tn(e){var t;return e=(e+"").trim().toLowerCase(),(t=zh.exec(e))?(t=parseInt(t[1],16),new an(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1)):(t=$h.exec(e))?nn(parseInt(t[1],16)):(t=Uh.exec(e))?new an(t[1],t[2],t[3],1):(t=Gh.exec(e))?new an(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Wh.exec(e))?rn(t[1],t[2],t[3],t[4]):(t=Xh.exec(e))?rn(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Yh.exec(e))?ln(t[1],t[2]/100,t[3]/100,1):(t=Kh.exec(e))?ln(t[1],t[2]/100,t[3]/100,t[4]):Qh.hasOwnProperty(e)?nn(Qh[e]):"transparent"===e?new an(NaN,NaN,NaN,0):null}function nn(e){return new an(e>>16&255,e>>8&255,255&e,1)}function rn(e,t,n,i){return i<=0&&(e=t=n=NaN),new an(e,t,n,i)}function on(e){return e instanceof en||(e=tn(e)),e?(e=e.rgb(),new an(e.r,e.g,e.b,e.opacity)):new an}function sn(e,t,n,i){return 1===arguments.length?on(e):new an(e,t,n,null==i?1:i)}function an(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}function ln(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new un(e,t,n,i)}function cn(e){if(e instanceof un)return new un(e.h,e.s,e.l,e.opacity);if(e instanceof en||(e=tn(e)),!e)return new un;if(e instanceof un)return e;var t=(e=e.rgb()).r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),o=Math.max(t,n,i),s=NaN,a=o-r,l=(o+r)/2;return a?(s=t===o?(n-i)/a+6*(n<i):n===o?(i-t)/a+2:(t-n)/a+4,a/=l<.5?o+r:2-o-r,s*=60):a=l>0&&l<1?0:s,new un(s,a,l,e.opacity)}function un(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function hn(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function dn(e){if(e instanceof pn)return new pn(e.l,e.a,e.b,e.opacity);if(e instanceof bn){var t=e.h*Zh;return new pn(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}e instanceof an||(e=on(e));var n=vn(e.r),i=vn(e.g),r=vn(e.b),o=fn((.4124564*n+.3575761*i+.1804375*r)/ed),s=fn((.2126729*n+.7151522*i+.072175*r)/td);return new pn(116*s-16,500*(o-s),200*(s-fn((.0193339*n+.119192*i+.9503041*r)/nd)),e.opacity)}function pn(e,t,n,i){this.l=+e,this.a=+t,this.b=+n,this.opacity=+i}function fn(e){return e>sd?Math.pow(e,1/3):e/od+id}function mn(e){return e>rd?e*e*e:od*(e-id)}function gn(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function vn(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function yn(e){if(e instanceof bn)return new bn(e.h,e.c,e.l,e.opacity);e instanceof pn||(e=dn(e));var t=Math.atan2(e.b,e.a)*Jh;return new bn(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}function bn(e,t,n,i){this.h=+e,this.c=+t,this.l=+n,this.opacity=+i}function xn(e){if(e instanceof Cn)return new Cn(e.h,e.s,e.l,e.opacity);e instanceof an||(e=on(e));var t=e.r/255,n=e.g/255,i=e.b/255,r=(fd*i+dd*t-pd*n)/(fd+dd-pd),o=i-r,s=(hd*(n-r)-cd*o)/ud,a=Math.sqrt(s*s+o*o)/(hd*r*(1-r)),l=a?Math.atan2(s,o)*Jh-120:NaN;return new Cn(l<0?l+360:l,a,r,e.opacity)}function qn(e,t,n,i){return 1===arguments.length?xn(e):new Cn(e,t,n,null==i?1:i)}function Cn(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}function Sn(e,t){return function(n){return e+n*t}}function wn(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function _n(e){return 1==(e=+e)?Dn:function(t,n){return n-t?wn(t,n,e):md(isNaN(t)?n:t)}}function Dn(e,t){var n=t-e;return n?Sn(e,n):md(isNaN(e)?t:e)}function Mn(e){return function(){return e}}function An(e){return function(t){return e(t)+""}}function En(e){return function t(n){function i(t,i){var r=e((t=qn(t)).h,(i=qn(i)).h),o=Dn(t.s,i.s),s=Dn(t.l,i.l),a=Dn(t.opacity,i.opacity);return function(e){return t.h=r(e),t.s=o(e),t.l=s(Math.pow(e,n)),t.opacity=a(e),t+""}}return n=+n,i.gamma=t,i}(1)}function In(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:Md(t)}function Tn(e){return function(t,n){var i=e(t=+t,n=+n);return function(e){return e<=t?0:e>=n?1:i(e)}}}function Ln(e){return function(t,n){var i=e(t=+t,n=+n);return function(e){return e<=0?t:e>=1?n:i(e)}}}function kn(e,t,n,i){var r=e[0],o=e[1],s=t[0],a=t[1];return o<r?(r=n(o,r),s=i(a,s)):(r=n(r,o),s=i(s,a)),function(e){return s(r(e))}}function On(e,t,n,i){var r=Math.min(e.length,t.length)-1,o=new Array(r),s=new Array(r),a=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<r;)o[a]=n(e[a],e[a+1]),s[a]=i(t[a],t[a+1]);return function(t){var n=Ah(e,t,1,r)-1;return s[n](o[n](t))}}function Pn(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp())}function Nn(e,t){function n(){return r=Math.min(a.length,l.length)>2?On:kn,o=s=null,i}function i(t){return(o||(o=r(a,l,u?Tn(e):e,c)))(+t)}var r,o,s,a=Ed,l=Ed,c=wd,u=!1;return i.invert=function(e){return(s||(s=r(l,a,In,u?Ln(t):t)))(+e)},i.domain=function(e){return arguments.length?(a=Nh.call(e,Ad),n()):a.slice()},i.range=function(e){return arguments.length?(l=Rh.call(e),n()):l.slice()},i.rangeRound=function(e){return l=Rh.call(e),c=_d,n()},i.clamp=function(e){return arguments.length?(u=!!e,n()):u},i.interpolate=function(e){return arguments.length?(c=e,n()):c},n()}function Rn(e){var t=e.domain;return e.ticks=function(e){var n=t();return kh(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){return Id(t(),e,n)},e.nice=function(n){null==n&&(n=10);var i,r=t(),o=0,s=r.length-1,a=r[o],l=r[s];return l<a&&(i=a,a=l,l=i,i=o,o=s,s=i),(i=Gt(a,l,n))>0?i=Gt(a=Math.floor(a/i)*i,l=Math.ceil(l/i)*i,n):i<0&&(i=Gt(a=Math.ceil(a*i)/i,l=Math.floor(l*i)/i,n)),i>0?(r[o]=Math.floor(a/i)*i,r[s]=Math.ceil(l/i)*i,t(r)):i<0&&(r[o]=Math.ceil(a*i)/i,r[s]=Math.floor(l*i)/i,t(r)),e},e}function Fn(){var e=Nn(In,bd);return e.copy=function(){return Pn(e,Fn())},Rn(e)}function jn(){function e(e){if(e<=e)return n[Ah(t,e,0,i)]}var t=[.5],n=[0,1],i=1;return e.domain=function(r){return arguments.length?(t=Rh.call(r),i=Math.min(t.length,n.length-1),e):t.slice()},e.range=function(r){return arguments.length?(n=Rh.call(r),i=Math.min(t.length,n.length-1),e):n.slice()},e.invertExtent=function(e){var i=n.indexOf(e);return[t[i-1],t[i]]},e.copy=function(){return jn().domain(t).range(n)},e}function Vn(e,t){var n=e&&void 0!==e.min,i=e&&void 0!==e.max,r=n?+e.min:0,o=i?+e.max:1;if(t&&t.length){if(!n){var s=t.map(Ld).filter(Od);r=s.length?Math.min.apply(Math,su(s)):r}if(!i){var a=t.map(kd).filter(Od);o=a.length?Math.max.apply(Math,su(a)):o}}return[r,o]}function Hn(e){return"number"!=typeof e||isNaN(e)}function Bn(e){var t=(.5*(Math.floor(e/Math.PI*2)+2)+.25)*Math.PI,n=Math.cos(Math.abs(t-e))*Math.sqrt(2),i=n*Math.cos(e),r=n*Math.sin(e);return{x1:i<0?1:0,y1:r<0?1:0,x2:i>=0?i:i+1,y2:r>=0?r:r+1}}function zn(e){return-e/180*Math.PI}function $n(e){return Bn(zn(e))}function Un(e){return void 0===e?function(e){return e}:function(t){return e(t)}}function Gn(e){return Math.max(0,Math.min(1,e))}function Wn(e){return"object"===(void 0===e?"undefined":Zc(e))}function Xn(e,t,n){for(var i=Math.abs(t-n)/(e+1),r=[],o=1;o<=e;o++){var s=o*i;r.push(t<n?t+s:t-s)}return r}function Yn(e,t,n){if(1===e.length)return e;for(var i=e.concat([]),r=0;r<e.length;r++){var o=e[r],s=e[r+1];0===r&&o!==n.start()?(i.push.apply(i,su(Xn(t,o,s))),o-=s-o,s=e[r],i.push.apply(i,su(Xn(t,o,s)))):r===e.length-1&&s!==n.end()?(s=o+(o-e[r-1]),i.push.apply(i,su(Xn(t,o,s)))):i.push.apply(i,su(Xn(t,o,s)))}return i.filter(function(e){return e>=n.min()&&e<=n.max()})}function Kn(e){var t=e.distance,n=e.scale,i=e.minorCount,r=void 0===i?0:i,o=e.unitDivider,s=void 0===o?100:o,a=e.formatter,l=void 0===a?void 0:a,c=Hn(s)||Hn(t)?2:Math.max(t/s,2),u=Math.min(1e3,Math.round(c)),h=n.ticks(u);h.length<=1&&(h=n.ticks(u+1));var d=r>0?Yn(h,r,n):h;d.sort(function(e,t){return e-t});var p=d.map(Un(l));return d.map(function(e,t){var i=n(e);return{position:i,start:i,end:i,label:p[t],value:e,isMinor:-1===h.indexOf(e)}})}function Qn(e){var t=e.distance,n=e.scale,i=e.minorCount,r=void 0===i?0:i,o=e.unitDivider,s=void 0===o?100:o,a=e.formatter,l=void 0===a?void 0:a,c=Hn(s)||Hn(t)?2:Math.max(t/s,2),u=Math.min(1e3,Math.round(c)),h=u>10?10:u;n.nice(h);var d=n.ticks(u),p=r>0?Yn(d,r,n):d;p.sort(function(e,t){return e-t});var f=p.map(Un(l));return p.map(function(e,t){var i=n(e);return{position:i,start:i,end:i,label:f[t],value:e,isMinor:-1===d.indexOf(e)}})}function Zn(e){var t=e.count,n=e.minorCount,i=e.scale,r=e.formatter;return i.ticks((t-1)*n+t).map(function(e,t){var o=i(e);return{position:o,start:o,end:o,label:r(e),isMinor:t%(n+1)!=0,value:e}})}function Jn(e){var t=e.values,n=e.scale,i=e.formatter,r=void 0===i?function(e){return e}:i;return t.sort(function(e,t){return(Wn(e)?e.value:e)-(Wn(t)?t.value:t)}).filter(function(e,t,i){var r=Wn(e)?e.value:e;return r<=n.max()&&r>=n.min()&&i.indexOf(e)===t}).map(function(e){var t=Wn(e)?e.value:e,i=n(t);return{position:i,value:t,label:Wn(e)&&void 0!==e.label?e.label:r(t),isMinor:!1,start:Wn(e)&&!isNaN(e.start)?Gn(n(e.start)):i,end:Wn(e)&&!isNaN(e.end)?Gn(n(e.end)):i}})}function ei(e,t,n){var i=e.map(function(e){return e.position}),r=t.range();-1===i.indexOf(r[0])?e.splice(0,0,{position:r[0],start:r[0],end:r[0],label:n(t.start()),isMinor:!1,value:t.start()}):e[0]&&e[0].isMinor&&(e[0].isMinor=!1);var o=e[e.length-1];-1===i.indexOf(r[1])?e.push({position:r[1],start:r[1],end:r[1],label:n(t.end()),isMinor:!1,value:t.end()}):o&&o.isMinor&&(o.isMinor=!1)}function ti(e){var t=e.settings,n=e.scale,i=e.distance,r=e.formatter,o=void 0,s=t.minorTicks&&!Hn(t.minorTicks.count)?Math.min(100,t.minorTicks.count):0;return Array.isArray(t.ticks.values)?o=Jn({values:t.ticks.values.filter(function(e){return"object"===(void 0===e?"undefined":Zc(e))?!Hn(e.value):!Hn(e)}),scale:n.copy(),formatter:r}):Hn(t.ticks.count)?(o=(t.ticks.tight?Qn:Kn)({distance:i,minorCount:s,unitDivider:t.ticks.distance,scale:n,formatter:r}),t.ticks.forceBounds&&ei(o,n,r)):o=Zn({count:Math.min(1e3,t.ticks.count),minorCount:s,scale:n.copy(),formatter:r}),o}function ni(e){var t=e.scale,n=t.domain(),i=t.data().items,r=t.labels?t.labels():n,o=t.bandwidth();return n.map(function(e,n){var s=t(e);return{position:s+o/2,label:""+r[n],data:i?i[n]:void 0,start:s,end:s+o}})}function ii(){return{ticks:{tight:!1,forceBounds:!1,distance:100},minorTicks:{count:3}}}function ri(e,t,n){return"function"==typeof e[n]?e[n](t):e[n]}function oi(e,t){var n={};return Pd.forEach(function(i){n[i]=ri(e,t,i)}),n}function si(e,t){var n=+e.min,i=+e.max,r=0,o=1;if(t&&t[0]){var s=t.map(function(e){return e.min()}).filter(function(e){return!isNaN(e)}),a=t.map(function(e){return e.max()}).filter(function(e){return!isNaN(e)});if(r=s.length?Math.min.apply(Math,su(s)):Number.NaN,o=a.length?Math.max.apply(Math,su(a)):Number.NaN,isNaN(r)||isNaN(o))r=-1,o=1;else if(r===o&&0===r)r=-1,o=1;else if(r===o&&r)r-=Math.abs(.1*r),o+=Math.abs(.1*o);else if(!isNaN(e.expand)){var l=o-r;r-=l*e.expand,o+=l*e.expand}if(Array.isArray(e.include)){var c=e.include.filter(function(e){return!isNaN(e)});r=Math.min.apply(Math,su(c).concat([r])),o=Math.max.apply(Math,su(c).concat([o]))}}return{mini:isNaN(n)?r:n,maxi:isNaN(i)?o:i}}function ai(e,t){e.instance||(e.instance=t.copy(),e.instance.domain([t.start(),t.end()]),e.instance.clamp(!0),e.instance.range(e.invert?[1,0]:[0,1]))}function li(e,t){function n(e){return Hn(e)?NaN:i(e)}var i=Fn(),r={instance:null,invert:!1},o=void 0;if(n.data=function(){return t},n.invert=function(e){return i.invert(e)},n.rangeRound=function(e){return i.rangeRound(e),n},n.clamp=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return i.clamp(e),n},n.cachedTicks=function(){return o},n.clearTicksCache=function(){return o=void 0,this},n.ticks=function(t){return null!==t&&"object"===(void 0===t?"undefined":Zc(t))?(t.settings=t.settings||{},t.settings=Yc(!0,ii(),e,t.settings),t.scale=n,o=ti(t)):o=i.ticks(t)},n.nice=function(e){return i.nice(e),n},n.tickFormat=function(e,t){return i.tickFormat(e,t)},n.interpolate=function(e){return i.interpolate(e),n},n.domain=function(e){return arguments.length?(i.domain(e),r.instance&&r.instance.domain([n.start(),n.end()]),n):i.domain()},n.range=function(e){return arguments.length?(i.range(e),n):i.range()},n.start=function(){return n.domain()[0]},n.end=function(){return n.domain()[this.domain().length-1]},n.min=function(){return Math.min(this.start(),this.end())},n.max=function(){return Math.max(this.start(),this.end())},n.classify=function(e){for(var t=(n.start()-n.end())/e,i=[n.end()],r=[],o=t/2,s=0;s<e;s++){var a=i[i.length-1]||0,l=a+t,c=n(a+o);i.push.apply(i,[l,l]),r.push.apply(r,[c,c])}return i.pop(),n.domain(i),n.range(r),n},n.copy=function(){var r=li(e,t);return r.domain(n.domain()),r.range(n.range()),r.clamp(i.clamp()),r},n.norm=function(e){return ai(r,n),r.instance(e)},n.normInvert=function(e){return ai(r,n),r.instance.invert(e)},e){var s=oi(e,t?t.fields:[]),a=si(s,t?t.fields:[]),l=a.mini,c=a.maxi;n.domain([l,c]),n.range(s.invert?[1,0]:[0,1]),r.invert=s.invert}return n}function ci(e,t,n){return"function"==typeof e[n]?e[n](t):e[n]}function ui(e,t){var n={};return Nd.forEach(function(i){n[i]=ci(e,t,i)}),n}function hi(){function e(e,t){e.data=function(){return n},e.datum=function(e){return s[a[e]]},e.start=function(){return e.domain()[0]},e.end=function(){return e.domain()[e.domain().length-1]},e.labels=function(){return c},e.ticks=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.scale=e,ni(n,t.trackBy||"label")}}for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Zt(),r="function"==typeof t.value?t.value:function(e){return e.value},o="function"==typeof t.label?t.label:function(e){return e.label},s=n.items||[],a={},l=[],c=[],u=0;u<s.length;u++){var h=r(s[u]);-1===l.indexOf(h)&&(l.push(h),c.push(o(s[u])))}e(i,t);var d=ui(t||{},n.fields);return i.pxScale=function(n){var r=d.maxPxStep;if(isNaN(r))return i;var o=i.domain().length,s=Math.max(1,o-i.paddingInner()+2*i.paddingOuter());if(s*r>=n)return i;var a=i.copy();a.type=i.type,e(a,t);var l=s*r/n,c=(1-l)*i.align();return a.range(d.invert?[l+c,c]:[c,l+c]),a},i.domain(l),i.range(d.invert?[1,0]:[0,1]),i.padding(isNaN(d.padding)?0:d.padding),isNaN(d.paddingInner)||i.paddingInner(d.paddingInner),isNaN(d.paddingOuter)||i.paddingOuter(d.paddingOuter),i.align(isNaN(d.align)?.5:d.align),i}function di(e,t){return e.ancestors().map(function(e){return t(e.data)}).reverse().slice(1).toString()}function pi(e,t){var n="object"===Zc(t.ticks)?t.ticks.depth:null,i="function"==typeof t.value?t.value:function(e){return e.value},r="function"==typeof t.label?t.label:i,o=[],s=[],a={},l=[],c=0;if(!e)return{values:o,labels:s,items:a,ticks:l};e.eachAfter(function(e){if(e.depth>0){var t=di(e,i),u=e.leaves()||[e],h=i(e.data),d=r(e.data),p=Array.isArray(e.children),f={key:t,count:u.length,value:h,label:d,leftEdge:di(u[0],i),rightEdge:di(u[Math.max(u.length-1,0)],i),node:e};p?(o.push("SPACER_"+c+"_SPACER"),c++):(o.push(t),s.push(d)),(null===n&&!p||e.depth===n)&&l.push(f),a[t]=f}});var u=e.height-1;return u>0&&o.splice(-u),{values:o,labels:s,items:a,ticks:l}}function fi(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=hi(e),i=pi(t.root,e),r=i.values,o=i.labels,s=i.items,a=i.ticks,l=function(t){var i=String(t),r=s[i];return n(r?e.invert?r.rightEdge:r.leftEdge:i)};Yc(!0,l,n),l.bandwidth=function(e){var t=s[String(e)],i=n.bandwidth();if(t&&!t.isLeaf){var r=l(t.leftEdge),o=l(t.rightEdge);return Math.abs(r-o)+i}return i},l.step=function(e){var t=s[String(e)],i=t?t.count:1,r=n.step();return r*=i},l.data=function(){return t},l.datum=function(e){var t=s[String(e)];return t?t.node.data:null},l.copy=function(){return fi(e,t)},l.labels=function(){return o},l.ticks=function(){return a.map(function(e){var t=l(e.key),n=l.bandwidth(e.key);return{position:t+n/2,label:e.label,data:e.node.data,start:t,end:t+n}})};var c=n.pxScale;return l.pxScale=function(e){return n=c(e),l},l.domain(r),l}function mi(e,t,n){var i=e.length;if(2===i)return[t,n];var r=[],o=(n-t)/(i-1);r.push(t);for(var s=1;s<i-1;s++)r.push(t+o*s);return r.push(n),r}function gi(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).theme,i=li(e,t,{}).clamp(!0).interpolate(gd),r=i;Yc(!0,r,i);var o=Vn(e,t?t.fields:[]),s=ou(o,2),a=s[0],l=s[1],c=e.domain?e.domain.length:-1,u=n?n.palette("sequential",c>0?c:2):[],h="function"==typeof e.range?e.range(t,{theme:n}):e.range||u;return r.range(e.invert?h.slice().reverse():h.slice()),r.domain(e.domain||mi(r.range(),a,l)),r}function vi(e,t,n){var i=e.length;if(2===i)return[t+(n-t)/2];for(var r=[],o=(n-t)/i,s=1;s<i;s++)r.push(t+o*s);return r}function yi(e){for(var t=[],n=0;n<e.length-1;n++)t.push((e[n]+e[n+1])/2);return t}function bi(e,t,n,i){n=e[0],i=e&&e.length>=2?e[e.length-1]:i;var r=gi().domain([n,i]).range(t);return[n].concat(su(yi(e)),[i]).map(function(e){return r(e)})}function xi(e,t,n){var i=2===e.length?10:Math.max(1,e.length),r=Fn().domain([t,n]).nice([i]).ticks([i]);if(!e||!e.length)return r;for(var o=Math.max(0,e.length-1);r.length>o;)r[0]-t<=n-r[r.length-1]?r.shift():r.pop();return r}function qi(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=Qt(),i="function"==typeof e.value?e.value:function(e){return e.value},r="function"==typeof e.label?e.label:function(e){return e.label},o=t.items||[],s={},a=[],l=[],c=0;c<o.length;c++){var u=i(o[c]);-1===a.indexOf(u)&&(a.push(u),l.push(r(o[c])),s[u]=c)}return n.data=function(){return t},n.labels=function(){return l},n.label=function(e){var t=a.indexOf(e);return l[t]},n.datum=function(e){return o[s[e]]},e.range&&n.range(e.range),e.domain?n.domain(e.domain):n.domain(a),n}function Ci(e){return-1!==e.map(function(e){return"dimension"===e.type()?"band":"linear"}).indexOf("linear")?"linear":"band"}function Si(e){return e.root?"h-band":e.fields&&e.fields[0]?Ci(e.fields):"linear"}function wi(e,t,n){var i=e.data;e.source&&(n.logger.warn("Deprecated: Scale data source configuration"),i={extract:[]},(Array.isArray(e.source)?e.source:[e.source]).forEach(function(e){i.extract.push({field:e})}));var r=Vt(i,t,n),o=e.type||Si(r),s=void 0;return"color"===o&&(o=r.fields&&r.fields[0]&&"dimension"===r.fields[0].type()?"categorical-color":"sequential-color"),n.scale.has(o)&&((s=(s=n.scale.get(o))(e,r,n)).type=o),s}function _i(e,t,n,i){var r=void 0;return"string"==typeof e&&t[e]?r=t[e]:"object"===(void 0===e?"undefined":Zc(e))&&"scale"in e&&t[e.scale]&&(r=t[e.scale]),r||wi(e,n,i)}function Di(e,t,n){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=wi(e[r],t,n));return i}function Mi(){Mi.init.call(this)}function Ai(){var e=0,t=0,n=0,i=0;n=n||e;var r={move:function(e){this.moveTo(n+e)},moveTo:function(o){var s=Math.max(e,Math.min(t-i,o));n!==s&&(n=s,r.emit("update"))},update:function(o){var s=!1,a=o.min;e=void 0===a?e:a;var l=o.max;t=void 0===l?t:l,void 0!==o.viewSize&&o.viewSize!==i&&(i=o.viewSize,s=!0);var c=Math.max(e,Math.min(t-i,n));n!==c&&(n=c,s=!0),s&&r.emit("update")},getState:function(){return{min:e,max:t,start:n,viewSize:i}}};return Vd.mixin(r),r}function Ei(e,t){var n=e.min||0,i=e.max||0,r=e.viewSize||0,o=t||Ai();return o.update({min:n,max:i,viewSize:r}),o}function Ii(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=Ei(e[i],t?t[i]:null));return n}function Ti(e,t){return t[e]||(t[e]=Ai()),t[e]}function Li(e,t,n){for(var i=0;i<e.length&&t>e[i];)++i;return e[i]===t&&n&&++i,i}function ki(e,t){for(var n=e.length,i=1;i<n;i+=2)if(e[i-1]<=t&&t<=e[i])return!0;return!1}function Oi(){function e(){}var t=[];return e.add=function(e){var n,i=e.min,r=e.max,o=Li(t,i),s=Li(t,r,!0),a=[o,s-o];o%2==0&&a.push(i),s%2==0&&a.push(r);var l=t.join(",");return(n=t).splice.apply(n,a),l!==t.join(",")},e.remove=function(e){var n,i=e.min,r=e.max,o=Li(t,i),s=Li(t,r,!0),a=[o,s-o];o%2==1&&a.push(i),s%2==1&&a.push(r);var l=t.join(",");return(n=t).splice.apply(n,a),l!==t.join(",")},e.set=function(n){var i=t.join(",");return t=[],Array.isArray(n)?n.forEach(e.add):e.add(n),i!==t.join(",")},e.clear=function(){var e=t.length>0;return t=[],e},e.containsValue=function(e){return ki(t,e)},e.containsRange=function(e){var n=e.min,i=e.max,r=Li(t,n,!0),o=Li(t,i);return r===o&&o%2==1},e.toggle=function(t){return e.containsRange(t)?e.remove(t):e.add(t)},e.ranges=function(){for(var e=[],n=1;n<t.length;n+=2)e.push({min:t[n-1],max:t[n]});return e},e}function Pi(){function e(){}var t=[];return e.add=function(e){return-1===t.indexOf(e)&&(t.push(e),!0)},e.remove=function(e){var n=t.indexOf(e);return-1!==n&&(t.splice(n,1),!0)},e.contains=function(e){return-1!==t.indexOf(e)},e.values=function(){return t.slice()},e.clear=function(){return t=[]},e}function Ni(e){for(var t=e.items,n=e.values,i=e.vc,r={},o=[],s=void 0,a=void 0,l=0,c=t.length;l<c;l++)s=t[l].key,a=t[l].value,n[s]||(n[s]=i()),n[s].add(a)&&(r[s]=r[s]||[],r[s].push(a));for(var u=Object.keys(r),h=0,d=u.length;h<d;h++)s=u[h],o.push({id:s,values:r[s]});return o}function Ri(e){for(var t=e.items,n=e.values,i={},r=[],o=void 0,s=void 0,a=0,l=t.length;a<l;a++)o=t[a].key,s=t[a].value,n[o]&&n[o].remove(s)&&(i[o]=i[o]||[],i[o].push(s));for(var c=Object.keys(i),u=0,h=c.length;u<h;u++)o=c[u],r.push({id:o,values:i[o]});return r}function Fi(e){for(var t={},n=void 0,i=void 0,r=0,o=e.length;r<o;r++)n=e[r].key,i=e[r].value,t[n]||(t[n]=[]),-1===t[n].indexOf(i)&&t[n].push(i);return t}function ji(e){var t=e.key,n=e.collection,i=e.obj,r=e.fn,o=e.value;n[t]||(n[t]=r()),i[t]=i[t]||[],i[t].push(o),n[t].add(o)}function Vi(e){for(var t=e.items,n=e.values,i=e.vc,r={},o={},s=[],a=[],l=Fi(t),c=void 0,u=void 0,h=void 0,d=Object.keys(l),p=0,f=d.length;p<f;p++)for(var m=0,g=(h=l[c=d[p]]).length;m<g;m++)u=h[m],n[c]&&n[c].contains(u)?n[c]&&n[c].contains(u)&&(o[c]=o[c]||[],o[c].push(u),n[c].remove(u)):ji({key:c,value:u,collection:n,obj:r,fn:i});for(var v=Object.keys(r),y=0,b=v.length;y<b;y++)c=v[y],s.push({id:c,values:r[c]});for(var x=Object.keys(o),q=0,C=x.length;q<C;q++)c=x[q],a.push({id:c,values:o[c]});return[s,a]}function Hi(e,t){for(var n=[],i=Object.keys(e),r=void 0,o=void 0,s=0,a=i.length;s<a;s++)r=i[s],t[r]?(o=e[r].filter(function(e){return-1===t[r].indexOf(e)})).length&&n.push({id:r,values:o}):n.push({id:r,values:e[r]});return n}function Bi(e){for(var t=e.items,n=e.vCollection,i=e.vc,r={},o=Fi(t),s=[],a=[],l=void 0,c={},u=Object.keys(n),h=0,d=u.length;h<d;h++)c[l=u[h]]=n[l].values().slice(),delete n[l];for(var p=Object.keys(o),f=0,m=p.length;f<m;f++)o[l=p[f]].forEach(function(e){n[l]&&n[l].contains(e)||ji({key:l,value:e,collection:n,obj:r,fn:i})});return a=Hi(c,r),s=Hi(r,c),[s,a]}function zi(e,t){if(!Object.keys(t).length)return e;for(var n=e.length,i=Array(n),r=0;r<n;r++)i[r]=e[r].key in t?Yc({},e[r],{key:t[e[r].key]}):e[r];return i}function $i(e,t,n){var i=zi(t,n);return e&&e.length?e.reduce(function(e,t){return t(e)},i):i}function Ui(e){return e.replace(/(-[a-z])/g,function(e){return e.toUpperCase().replace("-","")})}function Gi(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function Wi(e,t,n){var i=n.ranges,r=n.interceptors,o=n.rc,s=n.aliases,a=!1;return $i(r[t+"Ranges"],e,s).forEach(function(e){var n=e.key;i[n]||(i[n]=o()),a=i[n][t](e.range)||a}),a}function Xi(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.vc,n=void 0===t?Pi:t,i=e.rc,r=void 0===i?Oi:i,o=!1,s={},a={},l={},c={addValues:[],removeValues:[],toggleValues:[],setValues:[],addRanges:[],setRanges:[],removeRanges:[],toggleRanges:[]},u={};return u.start=function(){o||(o=!0,u.emit("start"))},u.end=function(){o&&(o=!1,s={},a={},u.emit("end"))},u.isActive=function(){return o},u.clear=function(){var e=u.brushes().filter(function(e){return"value"===e.type&&e.brush.values().length}).map(function(e){return{id:e.id,values:e.brush.values()}}),t=Object.keys(s).length>0||e.length;s={},a={},t&&u.emit("update",[],e)},u.brushes=function(){var e=[];return e=e.concat(Object.keys(s).map(function(e){return{type:"range",id:e,brush:s[e]}})),e=e.concat(Object.keys(a).map(function(e){return{type:"value",id:e,brush:a[e]}}))},u.addValue=function(e,t){u.addValues([{key:e,value:t}])},u.addValues=function(e){var t=$i(c.addValues,e,l),i=Ni({vc:n,values:a,items:t});u.emit("add-values",t),i.length&&(o||(o=!0,u.emit("start")),u.emit("update",i,[]))},u.setValues=function(e){var t=$i(c.setValues,e,l),i=Bi({items:t,vCollection:a,vc:n});u.emit("set-values",t),(i[0].length>0||i[1].length>0)&&(o||(o=!0,u.emit("start")),u.emit("update",i[0],i[1]))},u.removeValue=function(e,t){u.removeValues([{key:e,value:t}])},u.removeValues=function(e){var t=$i(c.removeValues,e,l),n=Ri({values:a,items:t});u.emit("remove-values",t),n.length&&u.emit("update",[],n)},u.addAndRemoveValues=function(e,t){var i=$i(c.addValues,e,l),r=$i(c.removeValues,t,l),s=Ni({vc:n,values:a,items:i}),h=Ri({values:a,items:r});u.emit("add-values",i),u.emit("remove-values",r),(s.length||h.length)&&(o||(o=!0,u.emit("start")),u.emit("update",s,h))},u.toggleValue=function(e,t){u.toggleValues([{key:e,value:t}])},u.toggleValues=function(e){var t=$i(c.toggleValues,e,l),i=Vi({items:t,values:a,vc:n});u.emit("toggle-values",t),(i[0].length>0||i[1].length>0)&&(o||(o=!0,u.emit("start")),u.emit("update",i[0],i[1]))},u.containsValue=function(e,t){var n=l[e]||e;return!!a[n]&&a[n].contains(t)},u.addRange=function(e,t){u.addRanges([{key:e,range:t}])},u.addRanges=function(e){Wi(e,"add",{ranges:s,rc:r,interceptors:c,aliases:l})&&(o||(o=!0,u.emit("start")),u.emit("update",[],[]))},u.removeRange=function(e,t){u.removeRanges([{key:e,range:t}])},u.removeRanges=function(e){Wi(e,"remove",{ranges:s,rc:r,interceptors:c,aliases:l})&&(o||(o=!0,u.emit("start")),u.emit("update",[],[]))},u.setRange=function(e,t){u.setRanges([{key:e,range:t}])},u.setRanges=function(e){Wi(e,"set",{ranges:s,rc:r,interceptors:c,aliases:l})&&(o||(o=!0,u.emit("start")),u.emit("update",[],[]))},u.toggleRange=function(e,t){u.toggleRanges([{key:e,range:t}])},u.toggleRanges=function(e){Wi(e,"toggle",{ranges:s,rc:r,interceptors:c,aliases:l})&&(o||(o=!0,u.emit("start")),u.emit("update",[],[]))},u.containsRangeValue=function(e,t){var n=l[e]||e;return!!s[n]&&s[n].containsValue(t)},u.containsRange=function(e,t){var n=l[e]||e;return!!s[n]&&s[n].containsRange(t)},u.containsMappedData=function(e,t,n){for(var i=[],r=Object.keys(e),o=void 0,c=void 0,u=void 0,h=void 0,d=0,p=r.length;d<p;d++){if("value"===(o=r[d]))c=e,i[d]={key:"",i:d,bool:!1};else{if("source"===o)continue;c=e[o],i[d]={key:o,i:d,bool:!1}}void 0!==(u=c.source&&c.source.field)&&(void 0!==c.source.key&&(u=c.source.key+"/"+u),u in l&&(u=l[u]),h=c.value,s[u]?i[d].bool=Array.isArray(h)?s[u].containsRange({min:h[0],max:h[1]}):s[u].containsValue(h):a[u]&&a[u].contains(h)&&(i[d].bool=!0))}return t?(i=i.filter(function(e){return-1!==t.indexOf(e.key)}),"and"===n?!!i.length&&!i.some(function(e){return!1===e.bool}):"xor"===n?!!i.length&&i.some(function(e){return e.bool})&&i.some(function(e){return!1===e.bool}):i.some(function(e){return e.bool})):i.some(function(e){return e.bool})},u.intercept=function(e,t){var n=Ui(e);c[n]&&c[n].push(t)},u.removeInterceptor=function(e,t){var n=Ui(e);if(c[n]){var i=c[n].indexOf(t);-1!==i&&c[n].splice(i,1)}},u.removeAllInterceptors=function(e){var t=[];if(e){var n=Ui(e);c[n]&&c[n].length&&t.push({name:e,handlers:c[n]})}else Object.keys(c).forEach(function(e){c[e].length&&t.push({name:Gi(e),handlers:c[e]})});t.forEach(function(e){e.handlers.slice().forEach(function(t){return u.removeInterceptor(e.name,t)})})},u.addKeyAlias=function(e,t){l[e]=t},u.removeKeyAlias=function(e){delete l[e]},Vd.mixin(u),u}function Yi(e){return Bd.concat(Hd.get(e)||[])}function Ki(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}function Qi(e,t){return e.data?e.data.value:"text"===e.type?e.text:t}function Zi(e,t,n){var i=e.old,r=e.current,o=t.renderer,s=void 0,a=[],l={nodes:[],ips:[]},c={nodes:[],ips:[]},u={nodes:[],ips:[]},h=[],d=n.trackBy||Qi,p={start:function(){var e={};i.forEach(function(t,n){var i=d(t,n);e[i]=t}),r.forEach(function(t,n){var i=d(t,n);e[i]?(u.ips.push(xd(e[i],t)),u.nodes.push(t),a.push(e[i]),e[i]=!1):(l.nodes.push(t),l.ips.push(xd({r:.001,opacity:0},t)))}),Object.keys(e).forEach(function(t){e[t]&&(c.nodes.push(e[t]),c.ips.push(xd(e[t],Yc({},e[t],{r:1e-4,opacity:0}))))}),c.ips.length&&h.push({easing:Ki,duration:200,tweens:c.ips,nodes:[].concat(a)}),u.ips.length&&h.push({easing:Ki,duration:400,tweens:u.ips,nodes:[]}),l.ips.length&&h.push({easing:$d,duration:1200,tweens:l.ips,nodes:[].concat(su(u.nodes))}),h.length&&(h[0].started=Date.now(),"undefined"!=typeof window&&(s=window.requestAnimationFrame(p.tick)))},tick:function(){var e=h[0];e||p.stop(),e.started||(e.started=Date.now());var t=(Date.now()-e.started)/e.duration,n=[],i=e.tweens.map(function(n){return n(e.easing(Math.min(1,t)))});n.push.apply(n,su(i)),n.push.apply(n,su(e.nodes)),o.render(n),t>=1&&(h.shift(),h.length||p.stop()),s&&(s=window.requestAnimationFrame(p.tick))},stop:function(){s&&(window.cancelAnimationFrame(s),s=!1)}};return p}function Ji(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).reduce(function(e,t){return Array.isArray(t.children)?e.concat(Ji(t.children)):(e.push(t),e)},[])}function er(e,t){var n=t.context,i=t.data,r=t.style,o=e.chart.brush(n),s=i,a=r.active||{},l=r.inactive||{},c=[];Object.keys(a).forEach(function(e){c.push(e)}),Object.keys(l).forEach(function(e){-1===c.indexOf(e)&&c.push(e)});var u=[],h=!1,d=function(){for(var t=Ji(e.nodes),n=t.length,i=void 0,r=!1,d=0;d<n;d++){(function(e){if(!(i=t[e].data))return"continue";t[e].__style||(t[e].__style={},c.forEach(function(n){t[e].__style[n]=t[e][n]}));var n=o.containsMappedData(i,s),d=u.indexOf(t[e]),p=!1;n&&-1===d?(u.push(t[e]),p=!0):n||-1===d||(u.splice(d,1),p=!0),(p||h)&&(c.forEach(function(i){n&&i in a?t[e][i]=a[i]:!n&&i in l?t[e][i]=l[i]:(t[e].__style||(t[e].__style=t[e].__style||{},c.forEach(function(n){t[e].__style[n]=t[e][n]})),t[e][i]=t[e].__style[i])}),r=!0)})(d)}return h=!1,r},p=function(){for(var t=Ji(e.nodes),n=t.length,i=0;i<n;i++)!function(e){t[e].__style=t[e].__style||{},c.forEach(function(n){t[e].__style[n]=t[e][n]})}(i);h=!0,u.length=0,e.renderer.render(e.nodes)},f=function(){for(var t=Ji(e.nodes),n=t.length,i=0;i<n;i++)!function(e){t[e].__style&&(Object.keys(t[e].__style).forEach(function(n){t[e][n]=t[e].__style[n]}),t[e].__style=void 0)}(i);u.length=0,e.renderer.render(e.nodes)},m=function(){d()&&e.renderer.render(e.nodes)};return o.on("start",p),o.on("end",f),o.on("update",m),{isActive:function(){return o.isActive()},update:function(){u.length=0,h=!0,d()},cleanUp:function(){o.removeListener("start",p),o.removeListener("end",f),o.removeListener("update",m)}}}function tr(e){var t=e.dataPoints,n=e.action,i=e.chart,r=e.trigger;if(r){var o=r.data||[""],s={items:[],actionFn:"toggleRanges"},a={items:[],actionFn:"toggleValues"};-1!==["add","remove","set","toggle"].indexOf(n)&&(s.actionFn=n+"Ranges",a.actionFn=n+"Values");for(var l=0;l<t.length;l++){(function(e){var n=t[e];if(!n)return"continue";o.forEach(function(e){var t=n&&!e?n:n[e];if(t){var i={key:t.source.field};void 0!==t.source.key&&(i.key=t.source.key+"/"+t.source.field),Array.isArray(t.value)?(i.range={min:t.value[0],max:t.value[1]},s.items.push(i)):(i.value=t.value,a.items.push(i))}})})(l)}r.contexts.forEach(function(e){s.items.length?i.brush(e)[s.actionFn](s.items):i.brush(e)[a.actionFn](a.items)})}}function nr(e){for(var t=e.nodes,n=e.action,i=e.chart,r=e.trigger,o=[],s=0;s<t.length;s++){var a=t[s].data;null!==a&&o.push(a)}tr({dataPoints:o,action:n,chart:i,trigger:r})}function ir(e){var t=e.collisions,n=e.t,i=e.config,r=e.action,o=[],s=!1;return t.length>0&&(o=t,s=!0,"stop"===n.propagation&&(o=[t[t.length-1]])),nr({nodes:o.map(function(e){return e.node}),action:r,chart:i.chart,data:i.data,trigger:n}),s}function rr(e,t){return 1!==e.changedTouches.length?null:{x:e.changedTouches[0].clientX-t.left,y:e.changedTouches[0].clientY-t.top}}function or(e,t){return{x:e.clientX-t.left,y:e.clientY-t.top}}function sr(e,t,n){var i=n.element().getBoundingClientRect(),r=F(e)?rr(e,i):or(e,i);return null===r||r.x<0||r.y<0||r.x>i.width||r.y>i.height?[]:(t.touchRadius>0&&F(e)&&(r={cx:r.x,cy:r.y,r:t.touchRadius}),n.itemsAt(r))}function ar(e,t,n){return e?"function"==typeof e?e(t):e:n}function lr(e){var t=e.e,n=e.t,i=e.config;return ir({collisions:sr(t,n,i.renderer),t:n,config:i,action:ar(n.action,t,"toggle")})}function cr(e){var t=e.e,n=e.t,i=e.config;return ir({collisions:sr(t,n,i.renderer),t:n,config:i,action:ar(n.action,t,"set")})}function ur(e,t,n){var i=t.require,r=void 0===i?[]:i,o=t.mediator||{},s=n.settings,a=n.formatter,l=n.scale,c=n.data,u=n.renderer,h=n.chart,d=n.dockConfig,p=n.mediator,f=n.instance,m=n.style,g=n.update;Object.defineProperty(e,"settings",{get:s}),Object.defineProperty(e,"data",{get:c}),Object.defineProperty(e,"formatter",{get:a}),Object.defineProperty(e,"scale",{get:l}),Object.defineProperty(e,"mediator",{get:p}),Object.defineProperty(e,"style",{get:m}),Object.keys(t).forEach(function(n){Ud(n)||("function"==typeof t[n]?e[n]=t[n].bind(e):e[n]=t[n])}),r.forEach(function(t){"renderer"===t?Object.defineProperty(e,"renderer",{get:u}):"chart"===t?Object.defineProperty(e,"chart",{get:h}):"dockConfig"===t?Object.defineProperty(e,"dockConfig",{get:d}):"instance"===t?Object.defineProperty(e,"instance",{get:f}):"update"===t&&g&&Object.defineProperty(e,"update",{get:g})}),Object.keys(o).forEach(function(t){e.mediator.on(t,o[t].bind(e))})}function hr(e,t){return e.displayOrder=t.displayOrder,e.dock=t.dock,e.prioOrder=t.prioOrder,e.minimumLayoutMode=t.minimumLayoutMode,e.show=t.show,e}function dr(e,t,n){Object.keys(n.on||{}).forEach(function(i){e.eventListeners=e.eventListeners||[];var r=n.on[i].bind(e);e.eventListeners.push({event:i,listener:r}),t.on(i,r)}),e.emit=function(e){for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return t.emit.apply(t,[e].concat(i))}}function pr(e){function t(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return function(){for(var i=arguments.length,r=Array(i),o=0;o<i;o++)r[o]=arguments[o];var s="function"==typeof e[t],a="function"==typeof h[t],l=void 0;if(s){var c;l=(c=e[t]).call.apply(c,[w].concat(r))}if("function"==typeof h[t]){var u;l=(u=h[t]).call.apply(u,[_].concat(r))}return s||a||(l=n.call.apply(n,[w].concat(r))),S.forEach(function(e){if(e[t]){var n;(n=e[t]).call.apply(n,[_].concat(r))}}),l}}var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.defaultSettings,r=void 0===i?{}:i,o=n.chart,s=n.container,a=n.mediator,l=n.registries,c=n.theme,u=n.renderer,h=n.settings||{},d=Vd.mixin({}),p=Yc(!0,{},r,h),f=[],m=void 0,g=void 0,v=void 0,y=void 0,b=void 0,x={nodes:[],chart:o,config:p.brush||{},renderer:null},q={tap:[],over:[]},C=[],S=Yi(p.type),w={},_=Yc({},h,S.filter(function(e){return!Ud(e)})),D=t("preferredSize",function(){return 0}),M=t("resize",function(e){return e.inner}),A=t("created"),E=t("beforeMount"),I=t("mounted"),T=t("beforeUpdate"),L=t("updated"),k=t("beforeRender"),O=t("beforeDestroy"),P=t("destroyed"),N=e.render,R=function(){p.brush&&(p.brush.consume||[]).forEach(function(e){e.context&&e.style&&C.push(er(x,e))})},F=function(){p.brush&&(p.brush.trigger||[]).forEach(function(e){"over"===e.on?q.over.push(e):q.tap.push(e)})};Object.defineProperty(x,"data",{get:function(){return f}});var j=p.renderer||e.renderer,V=j?u||l.renderer(j)():u||l.renderer()();x.renderer=V;var H={requiredSize:function(e,t){return D({inner:e,outer:t,dock:H.dock})}};hr(H,p);var B=function(){};B.dockConfig=H,B.set=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.settings&&(p=Yc(!0,{},r,e.settings),hr(H,p)),p.scale&&(m=o.scale(p.scale)),f=p.data?Vt(p.data,{dataset:o.dataset,collection:o.dataCollection},{logger:o.logger()},o.dataCollection):m?m.data():[],"string"==typeof p.formatter?g=o.formatter(p.formatter):"object"===Zc(p.formatter)?g=o.formatter(p.formatter):m&&m.data().fields&&(g=m.data().fields[0].formatter()),b=c.style(p.style||{})},B.resize=function(e,t){var n=M({inner:e,outer:t});n?(V.size(n),y=n):(V.size(e),y=e),_.rect=e},B.getRect=function(){return _.rect};var z=function(){var e=V.renderArgs?V.renderArgs.slice(0):[];return e.push({data:f}),e};B.beforeMount=E,B.beforeRender=function(){k({size:y})};var $=void 0;B.render=function(){var e=x.nodes=N.call.apply(N,[w].concat(su(z())));V.render(e),$=e},B.hide=function(){B.unmount(),V.size({x:0,y:0,width:0,height:0}),V.clear()},B.beforeUpdate=function(){T({settings:p,data:f})};var U=void 0;B.update=function(){U&&U.stop();var e=x.nodes=N.call.apply(N,[w].concat(su(z())));C.forEach(function(e){return e.cleanUp()}),C.length=0,q.tap=[],q.over=[],p.brush&&(R(),F()),C.forEach(function(e){e.isActive()&&e.update()}),$&&p.animations&&p.animations.enabled?(U=Zi({old:$,current:e},{renderer:V},p.animations)).start():V.render(e),$=e},B.updated=L,B.destroy=function(){B.unmount(),O(v),V.destroy(),P(),v=null};var G=function(e){x.nodes=e,C.forEach(function(e){e.isActive()&&e.update()}),V.render(e)};return ur(w,e,{settings:function(){return p},data:function(){return f},scale:function(){return m},formatter:function(){return g},renderer:function(){return V},chart:function(){return o},dockConfig:function(){return H},mediator:function(){return a},instance:function(){return _},style:function(){return b},update:function(){return G}}),ur(_,h,{settings:function(){return p},data:function(){return f},scale:function(){return m},formatter:function(){return g},renderer:function(){return V},chart:function(){return o},dockConfig:function(){return H},mediator:function(){return a},style:function(){return b}}),B.getBrushedShapes=function(e,t,n){var i=[];if(p.brush&&p.brush.trigger){var r=o.brush(e),s=V.findShapes("*");p.brush.trigger.forEach(function(e){s.forEach(function(o){var s=o.data;s&&r.containsMappedData(s,n||e.data,t)&&i.push(o)})})}return i},B.findShapes=function(e){for(var t=V.findShapes(e),n=0,i=t.length;n<i;n++)t[n].key=p.key;return t},B.shapesAt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=V.itemsAt(e),i=void 0;i=t&&"stop"===t.propagation&&n.length>0?[n.pop().node]:n.map(function(e){return e.node});for(var r=0,o=i.length;r<o;r++)i[r].key=p.key;return i},B.brushFromShapes=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.contexts=Array.isArray(t.contexts)?t.contexts:[],nr({nodes:e,action:t.action||"toggle",trigger:t,chart:o,data:x.data})},B.mount=function(){v=V.element&&V.element()?v:V.appendTo(s),p.brush&&(R(),F()),dr(_,d,h),dr(w,d,e)},B.mounted=function(){return I(v)},B.unmount=function(){[_,w].forEach(function(e){(e.eventListeners||[]).forEach(function(e){var t=e.event,n=e.listener;d.removeListener(t,n)})}),q.tap=[],q.over=[],C.forEach(function(e){e.cleanUp()}),C.length=0},B.onBrushTap=function(e){q.tap.forEach(function(t){lr({e:e,t:t,config:x})&&"stop"===t.globalPropagation&&o.toggleBrushing(!0)})},B.onBrushOver=function(e){q.over.forEach(function(t){cr({e:e,t:t,config:x})&&"stop"===t.globalPropagation&&o.toggleBrushing(!0)})},B.def=w,B.ctx=_,B.renderer=function(){return V},B.set({settings:h}),A(),B}function fr(){var e={};return Vd.mixin(e),e}function mr(e){return e.x1===e.x2&&e.y1===e.y2}function gr(e){return e.width<=0||e.height<=0}function vr(e){return e.r<=0}function yr(e){return e.edges.length<=2}function br(e,t,n){var i=e,r=Yc(!0,{},t,e),o={};if(e[Xd]){var s=e[Xd];if(-1!==n.indexOf(s))throw new Error('Cyclical reference for "'+s+'"');var a=n.slice();a.push(s),i=Yc(!0,{},br(r[s],t,a),e)}return Object.keys(i).forEach(function(e){var t=n.slice();if(e!==Xd&&!Wd.test(e)){o[e]=i[e];var s=o[e];if(Wd.test(s)&&s in r){if(-1!==n.indexOf(s))throw new Error('Cyclical reference for "'+s+'"');t.push(s),"object"===(void 0===(s=r[s])?"undefined":Zc(s))?o[e]=br(s,r,t):o[e]=s}else"object"===(void 0===s?"undefined":Zc(s))&&(o[e]=br(s,r,t))}}),o}function xr(e,t){return br(e,t,[])}function qr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).forEach(function(e){t[e.key]={colors:e.colors,sizes:e.colors.map(function(e){return e.length})}});var n=function(e,n){var i=t[e];if(!i)return[];for(var r=i.sizes,o=0;o<r.length;o++)if(n<=r[o])return i.colors[o];return i.colors[r.length-1]};return{palette:function(e,t){return n(e,t)},style:function(t){return xr(t,e)}}}function Cr(e,t,n){var i=t.left-n.left,r=t.top-n.top,o=H(e),s=Yc(!0,{},e);switch(o){case"circle":s.cx+=i,s.cy+=r;break;case"polygon":for(var a=0,l=s.vertices.length;a<l;a++){var c=s.vertices[a];c.x+=i,c.y+=r}break;case"line":s.x1+=i,s.y1+=r,s.x2+=i,s.y2+=r;break;case"point":case"rect":s.x+=i,s.y+=r}return s}function Sr(t,n){function i(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return function(){for(var i=arguments.length,r=Array(i),o=0;o<i;o++)r[o]=arguments[o];var s=void 0;if("function"==typeof t[e]){var a;s=(a=t[e]).call.apply(a,[v].concat(r))}else s=n.call.apply(n,[v].concat(r));return m.forEach(function(t){if(t[e]){var n;(n=t[e]).call.apply(n,[v].concat(r))}}),s}}function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={},n=e.filter(function(e){return!!e.key}).map(function(e){return e.key});w.forEach(function(e){e.key&&-1!==n.indexOf(e.key)?t[e.key]=e:e.destroy()}),w=e.map(function(e){var n=e.key&&t[e.key]?t[e.key]:d.interaction(e.type)(v,y,o);return n.set(e),n})}var o=t.element,s=t.data,a=void 0===s?[]:s,l=t.settings,c=void 0===l?{}:l,u=t.on,h=void 0===u?{}:u,d=n.registries,p=n.logger,f=qr(n.style,n.palettes),m=e(),g=[],v=Yc({},t,m.filter(function(e){return!Yd(e)})),y=fr(),b=[],x=[],q=null,C=null,S=null,w=[],_=function(){},D=function(){},M={},A=!1,E=function(e,t){return{instance:pr(d.component(e.type),{settings:e,chart:v,mediator:y,registries:d,theme:f,container:t}),settings:Yc(!0,{},e),key:e.key,hasKey:void 0!==e.key}},I=function(e){for(var t=0;t<b.length;t++)if(b[t].instance===e)return b[t];return null},T=function(e){for(var t=0;t<b.length;t++){var n=b[t];if(n.hasKey&&n.key===e)return t}return-1},L=function(e){var t=N(c.dockLayout);e.forEach(function(e){t.addComponent(e.instance,e.key)});var n=t.layout(o),i=n.visible,r=n.hidden;return{visible:i.map(function(e){return I(e)}),hidden:r.map(function(e){return I(e)})}},k=function(e,t){var n=e.instance.renderer().element();if(!isNaN(t)&&n&&o&&o.childNodes){var i=o.childNodes,r=Math.min(i.length-1,Math.max(t,0)),s=i[r];o.insertBefore&&void 0!==s&&o.insertBefore(n,i[r])}},O=i("created"),P=i("beforeMount"),F=i("mounted"),V=i("beforeUpdate"),H=i("updated"),B=i("beforeRender"),$=i("beforeDestroy"),U=i("destroyed"),G=function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).partialData,i=t.formatters,r=void 0===i?{}:i,o=t.scales,s=void 0===o?{}:o,a=t.scroll,l=void 0===a?{}:a;_=z(e,{logger:p,types:d.data}),n||Object.keys(M).forEach(function(e){return M[e].clear()}),D=Ht(t.collections,{dataset:_},{logger:p}),q=Di(s,{dataset:_,collection:D},{scale:d.scale,theme:f,logger:p}),C=zt(r,{dataset:_,collection:D},{formatter:d.formatter,theme:f,logger:p}),S=Ii(l,S)},W=function(){var e=c.components,t=void 0===e?[]:e;B(),G(a,c),b=t.map(function(e){return E(e,o)});var n=L(b),i=n.visible,r=n.hidden;x=i,r.forEach(function(e){e.instance.hide(),e.visible=!1}),i.forEach(function(e){return e.instance.beforeMount()}),i.forEach(function(e){return e.instance.mount()}),i.forEach(function(e){return e.instance.beforeRender()}),i.forEach(function(e){return e.instance.render()}),i.forEach(function(e){return e.instance.mounted()}),i.forEach(function(e){e.visible=!0})},X=function(e){var t=o.getBoundingClientRect(),n="clientX"in e?e.clientX:e.x,i="clientY"in e?e.clientY:e.y,r={x:n-t.left,y:i-t.top},s=[];return x.forEach(function(e){var t=e.instance.getRect();Gd.testRectPoint(t,r)&&s.push(e)}),s},Y=function(){g.forEach(function(e){var t=e.key,n=e.listener;return o.removeEventListener(t,n)}),r()};return v.update=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.partialData;e.data&&(a=e.data),e.settings&&(c=e.settings,r(e.settings.interactions)),V(),G(a,c,{partialData:t});for(var n=c,i=n.formatters,s=n.scales,l=n.components,u=void 0===l?[]:l,h=b.length-1;h>=0;h--)!function(e){var t=b[e];u.some(function(e){return t.hasKey&&t.key===e.key})||(b.splice(e,1),t.instance.destroy())}(h);(b=u.map(function(e){var t=T(e.key);return-1===t?E(e,o):(b[t].updateWith={formatters:i,scales:s,data:a,settings:e},b[t])})).forEach(function(e){e.updateWith&&e.instance.set(e.updateWith)}),b.forEach(function(e){e.updateWith&&e.instance.beforeUpdate()});var d=[],p=[];if(t)b.forEach(function(e){e.updateWith&&e.visible&&d.push(e)});else{var f=L(b),m=f.visible,g=f.hidden;x=m,m.forEach(function(e){e.updateWith&&e.visible?d.push(e):p.push(e)}),g.forEach(function(e){e.instance.hide(),e.visible=!1,delete e.updateWith})}p.forEach(function(e){return e.instance.beforeMount()}),p.forEach(function(e){return e.instance.mount()}),p.forEach(function(e){return e.instance.beforeRender()}),d.forEach(function(e){return e.instance.beforeRender()}),p.forEach(function(e){return e.instance.render()}),d.forEach(function(e){return e.instance.update()}),x.forEach(function(e,t){return k(e,t)}),p.forEach(function(e){return e.instance.mounted()}),d.forEach(function(e){return e.instance.updated()}),x.forEach(function(e){delete e.updateWith,e.visible=!0}),H()},v.destroy=function(){$(),b.forEach(function(e){return e.instance.destroy()}),b=[],Y(),delete v.update,delete v.destroy,U()},v.getAffectedShapes=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"and",n=arguments[2],i=arguments[3],r=[];return b.filter(function(e){return void 0===i||null===i||e.key===i}).forEach(function(i){r.push.apply(r,su(i.instance.getBrushedShapes(e,t,n)))}),r},v.findShapes=function(e){var t=[];return x.forEach(function(n){t.push.apply(t,su(n.instance.findShapes(e)))}),t},v.componentsFromPoint=function(e){return X(e).map(function(e){return e.instance.ctx})},v.shapesAt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],i=o.getBoundingClientRect(),r=x;if(Array.isArray(t.components)&&t.components.length>0){var s=t.components.map(function(e){return e.key});r=x.filter(function(e){return-1!==s.indexOf(e.key)}).map(function(e){return{instance:e.instance,opts:t.components[s.indexOf(e.key)]}})}for(var a=r.length-1;a>=0;a--){var l=r[a],c=Cr(e,i,l.instance.renderer().element().getBoundingClientRect()),u=l.instance.shapesAt(c,l.opts),h=u.length>0&&"stop"===t.propagation;if(n.push.apply(n,su(u)),n.length>0&&h)return n}return n},v.brushFromShapes=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{components:[]},n=t.components.map(function(e){return e.key});x.forEach(function(i){var r=n.indexOf(i.key);if(-1!==r){for(var o=[],s=0,a=e.length;s<a;s++){var l=e[s];l.key===i.key&&o.push(l)}i.instance.brushFromShapes(o,t.components[r])}})},v.scroll=function(){return Ti(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",S)},v.dataset=function(e){return _(e)},v.dataCollection=function(e){return D(e)},v.scales=function(){return q},v.formatters=function(){return C},v.brush=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";return M[e]||(M[e]=Xi()),M[e]},v.scale=function(e){return _i(e,q,{dataset:_,collection:D},{scale:d.scale,theme:f,logger:p})},v.formatter=function(e){return $t(e,C,{dataset:_,collection:D},{formatter:d.formatter,theme:f,logger:p})},v.toggleBrushing=function(e){A=void 0!==e?e:!A},v.component=function(e){var t=T(e);if(-1!==t)return b[t].instance.ctx},v.logger=function(){return p},Object.defineProperty(v,"interactions",{get:function(){return{instances:w,on:function(){w.forEach(function(e){return e.on()})},off:function(){w.forEach(function(e){return e.off()})}}}}),O(),o&&(P(),function(){o.innerHTML="",W(),Object.keys(h).forEach(function(e){var t=h[e].bind(v);o.addEventListener(e,t),g.push({key:e,listener:t})});var e={},t=function(t){t.touches?(e.x=t.touches[0].clientX,e.y=t.touches[0].clientY,e.multiTouch=t.touches.length>1):(e.x=t.clientX,e.y=t.clientY,e.multiTouch=!1),e.time=Date.now(),e.comps=X(e)},n=function(t){if("touchend"===t.type&&t.preventDefault(),j(t,e))for(var n=e.comps||X(t),i=n.length-1;i>=0;i--)if(n[i].instance.onBrushTap(t),A){A=!1;break}},i=[];i.push({key:"mousedown",listener:t}),i.push({key:"mouseup",listener:n}),R(o)&&(i.push({key:"touchstart",listener:t}),i.push({key:"touchend",listener:n})),i.push({key:"mousemove",listener:function(e){for(var t=X(e),n=t.length-1;n>=0;n--)if(t[n].instance.onBrushOver(e),A){A=!1;break}}}),i.forEach(function(e){o.addEventListener(e.key,e.listener),g.push(e)}),r(c.interactions)}(),F(o),v.element=o),v}function wr(e,t){"/"===e.charAt(0)&&(e=e.substring(1));for(var n=e.split("/"),i=void 0,r=t,o=0;o<n.length;o++){if("*"===n[o]&&Array.isArray(r)){var s=[];i=n.slice(o+1).join("/");for(var a=0;a<r.length;a++)s.push.apply(s,su(wr(i,r[a])));return s}if(!n[o]&&Array.isArray(r)){var l=new Array(r.length);i=n.slice(o+1).join("/");for(var c=0;c<r.length;c++)l[c]=wr(i,r[c]);return l}n[o]in r&&(r=r[n[o]])}return r}function _r(e,t){var n=t.cache;if("number"==typeof e)return n.fields[e];for(var i=0;i<n.fields.length;i++)if(n.fields[i].title()===e)return n.fields[i];return null}function Dr(e,t,n,i){var r={},o=i.field||(void 0!==e.field?t.field(e.field):null);return Object.keys(n).forEach(function(s){var a=n[s],l=r[s]={};-1!==["number","string","boolean"].indexOf(void 0===a?"undefined":Zc(a))?(l.type="primitive",l.value=a):"function"==typeof a?(l.type="function",l.value=a,l.label=a,l.field=o):"object"===(void 0===a?"undefined":Zc(a))&&(a.fields?l.fields=a.fields.map(function(n){return Dr(e,t,{main:n},i).main}):void 0!==a.field?(l.type="field",l.field=t.field(a.field),l.value=l.field.value,l.label=l.field.label):o&&(l.value=o.value,l.label=o.label,l.field=o),"function"==typeof a.filter&&(l.filter=a.filter),void 0!==a.value&&(l.value=a.value),void 0!==a.label&&(l.label=a.label),"function"==typeof a.reduce?l.reduce=a.reduce:a.reduce?l.reduce=ep[a.reduce]:l.field&&l.field.reduce&&(l.reduce="string"==typeof l.field.reduce?ep[l.field.reduce]:l.field.reduce))}),r}function Mr(e,t){var n=Dr(e,t,{main:{value:e.value,label:e.label,reduce:e.reduce,filter:e.filter}},{}).main;return{props:Dr(e,t,e.props||{},n),main:n}}function Ar(e,t){var n=t.main,i=t.propsArr,r=t.props,o=[],s=n.field.formatter()||function(e){return e},a={};return i.forEach(function(e){a[e]=r[e].field?r[e].field.formatter():function(e){return e}}),o.push.apply(o,su(e.map(function(e){var t=e.items.map(function(e){return e.value}),o=n.reduce,l={value:o?o(t):t,source:e.items[0].source};return l.label=s(l.value),i.forEach(function(t){var n=[];n=e.items.map(function(e){return e[t].value});var i=r[t].reduce;l[t]={value:i?i(n):n},l[t].label=String(a[t](l[t].value)),e.items[0][t].source&&(l[t].source=e.items[0][t].source)}),l}))),o}function Er(e){var t=e.cfg,n=e.itemData,i=e.obj,r=e.target,o=e.tracker,s="function"===e.trackType?t.trackBy(n):n[t.trackBy],a=o[s];a||(a=o[s]={items:[],id:s},r.push(a)),a.items.push(i)}function Ir(e,t,n){var i=n.key,r={value:"function"==typeof e.value?e.value(t):void 0!==e.value?e.value:t};return r.label="function"==typeof e.label?e.label(t):void 0!==e.label?String(e.label):String(r.value),e.field&&(r.source={key:i,field:e.field.key()}),r}function Tr(e,t){var n=[];return(Array.isArray(e)?e:[e]).forEach(function(e){void 0!==e.field&&function(){var i=t.field(e.field),r=t.key();if(!i)throw Error("Field '"+e.field+"' not found");for(var o=Mr(e,t),s=o.props,a=o.main,l=Object.keys(s),c=!!e.trackBy,u=Zc(e.trackBy),h={},d=[],p=i.items(),f=[],m=0;m<p.length;m++){(function(t){var n=p[t];if(a.filter&&!a.filter(n))return"continue";var i=Ir(a,n,{key:r});l.forEach(function(e){var o=s[e],a=o.field?o.field.items()[t]:n;i[e]=Ir(o,a,{key:r})}),c&&Er({cfg:e,itemData:n,obj:i,target:d,tracker:h,trackType:u}),f.push(i)})(m)}c?n.push.apply(n,su(Ar(d,{main:a,propsArr:l,props:s}))):n.push.apply(n,f)}()}),n}function Lr(e,t){var n=t.cache;if(e){var i=e[0],r=e.slice(1);i.forEach(function(e,t){var o=wr("//"+t,r),s=tp.numeric(o),a=s.length>0,l=a?"measure":"dimension",c=a?Math.min.apply(Math,su(s)):NaN,u=a?Math.max.apply(Math,su(s)):NaN;n.fields.push(Ft({title:i[t],values:o,min:c,max:u,type:l,value:function(e){return e},label:function(e){return e}}))})}}function kr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.key,n=e.data,i={fields:[]},r={key:function(){return t},raw:function(){return n},field:function(e){return _r(e,{cache:i,matrix:n})},fields:function(){return i.fields.slice()},extract:function(e){return Tr(e,r,i)},hierarchy:function(){return null}};return Lr(n,{cache:i}),r}function Or(e){var t=e.document.createElement("canvas").getContext("2d"),n=new e.Path2D("M0 0 L1 1");return t.strokeStyle="red",t.lineWidth=1,t.stroke(n),255===t.getImageData(0,0,1,1).data[0]}function Pr(e){function t(){return t.settings=e||{style:{}},t}return t.style=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Yc(e,n[t]||{})},t.horizontalLine=function(e,n,i,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t.style({type:"line",y1:n,x1:e-i/2,y2:n,x2:e+i/2},r,o)},t.verticalLine=function(e,n,i,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t.style({type:"line",y1:n,x1:e,y2:i,x2:e},r,o)},t.whisker=function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{whisker:{}},r=i.whisker.width||1;return t.style({type:"line",y1:n,x1:e-r/2,cx:e,cy:n,r:r/2,y2:n,x2:e+r/2},"whisker",i)},t.openwhisker=function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{whisker:{}},r=i.whisker.width||1;return t.whisker(e-r/2,n,i)},t.closewhisker=function(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{whisker:{}},r=i.whisker.width||1;return t.whisker(e+r/2,n,i)},t.box=function(e,n,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{box:{}},o=r.box.width||1;return t.style({type:"rect",x:e-o/2,y:n,height:i,width:o},"box",r)},t()}function Nr(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(op,[null].concat(t)))}function Rr(e){var t=void 0===e?"undefined":Zc(e);return"object"!==t&&"function"!==t&&"undefined"!==t}function Fr(e,t,n){var i=Yc({},e),r=Yc({},t);return Object.keys(i).forEach(function(e){r[e]={};var o=i[e],s=void 0===o?"undefined":Zc(o);if("function"==typeof o)r[e].fn=o;else if(Rr(o)){var a=t[e];"string"==typeof a&&ap.test(a)&&(a=sp[a]);var l=void 0===a?"undefined":Zc(a);r[e]="undefined"===l?o:l===s?o:a}else o&&"object"===(void 0===o?"undefined":Zc(o))&&("function"==typeof o.fn&&(r[e].fn=o.fn),void 0!==o.scale&&(r[e].scale=n.scale(o.scale)),"string"==typeof o.ref&&(r[e].ref=o.ref))}),Object.keys(t).forEach(function(e){if(!(e in i)){var n=t[e];"string"===(void 0===n?"undefined":Zc(n))&&ap.test(n)?r[e]=sp[n]:r[e]=n}}),r}function jr(e,t,n){for(var i={},r=Object.keys(t),o=r.length,s=e,a=0;a<o;a++){var l=r[a],c=t[l],u=void 0!==c,h=u&&"string"==typeof c.ref,d=u&&l in e,p=h?e[c.ref]:d?e[l]:s;if(Rr(c))i[l]=c;else if(u&&c.fn){var f={data:e};c.scale&&(f.scale=c.scale);var m=n?n.indexOf(e):-1;i[l]=c.fn.call(f,h&&e?e[c.ref]:void 0,m,n)}else u&&c.scale&&p?(i[l]=c.scale(p.value),c.scale.bandwidth&&(i[l]+=c.scale.bandwidth()/2)):i[l]=h?p.value:c}return i}function Vr(e,t,n){var i=e[t];i&&i.scale&&i.scale.pxScale?i.scale=i.scale.pxScale(n):i&&i.pxScale&&(e[t]=i.pxScale(n))}function Hr(e,t){return e.pxScale?e.pxScale(t):e}function Br(e,t,n){var i={};return Object.keys(t).forEach(function(r){i[r]=Fr(e[r],t[r],n)}),i}function zr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=t,r=n,o=void 0,s=void 0,a=void 0,l=void 0,c=void 0,u=void 0,h=void 0,d=void 0,p=void 0,f=function e(){return e};return f.updateSettings=function(n,h){r=n.settings,i=Yc(!0,{},t,h),p=Fr({major:r.major},{major:.5},e),o=p.major.scale,s=r.minor?e.scale(r.minor):null,a=0,l=null,c=Nr(),u=Pr(r)},f.onData=function(t,n){h=[],d=Br(r,i,e);var a="horizontal"===r.orientation,c=a?n.height:n.width,u=a?n.width:n.height;Vr(p,"major",c),o=p.major.scale,s&&s.pxScale&&(s=s.pxScale(u));var f=r.major?r.major.ref||"":"",m="object"===(void 0===f?"undefined":Zc(f))?r.major.ref.start:null,g="object"===(void 0===f?"undefined":Zc(f))?r.major.ref.end:null;if(o&&!o.bandwidth&&"string"==typeof f){var v=t.items.map(function(e){return""===f?e.value:e[f].value});v.sort(function(e,t){return e-t});for(var y=v[v.length-1],b=0;b<v.length;b++)v[b]&&v[b-1]&&(null===y||y>v[b]-v[b-1])&&(y=v[b]-v[b-1]);l=y}t.items.forEach(function(e,t,n){var i={};Object.keys(d).forEach(function(t){i[t]=jr(e,d[t],n)});var r={style:i,majorStart:o&&e[m]?o(e[m].value):null,majorEnd:o&&e[g]?o(e[g].value):null,min:s&&"min"in e?s(e.min.value):null,max:s&&"max"in e?s(e.max.value):null,start:s&&"start"in e?s(e.start.value):null,end:s&&"end"in e?s(e.end.value):null,med:s&&"med"in e?s(e.med.value):null,data:e};null!==r.majorStart?r.major=(r.majorStart+r.majorEnd)/2:r.major=jr(e,p,n).major,h.push(r)})},f.items=function(){return h},f.bandwidth=function(){return a},f.doodle=function(){return u},f.blueprint=function(){return c},f.render=function(e,t){if(null!==l){0===l&&(l=1e-9);var n=o(o.domain()[0])-o(o.domain()[0]+l);a=Math.abs(n)}else a=o&&o.bandwidth?o.bandwidth():1;c.reset(),c.width=e.width,c.height=e.height,c.x=e.x,c.y=e.y,c.flipXY="horizontal"===r.orientation,c.crisp=!0;var i=[];return h.forEach(function(e){var n=t({item:e,blueprint:c,doodle:u});n.forEach(function(t){t.data=e.data,t.collider={type:null}}),i.push.apply(i,su(n))}),0===i.length?i:h.map(function(e){for(var t={type:"container",data:e.data,collider:{type:"bounds"},children:[]},n=0;n<i.length;n++){var r=i[n];r.data===t.data&&(t.children.push(r),i.splice(n,1),n--)}return t})},f()}function $r(e,t,n){return Math.max(e,Math.min(t,n))}function Ur(e,t){Object.keys(up).forEach(function(n){var i=t[n];if(void 0!==i){var r=up[n];e[r]=i}})}function Gr(e,t,n,i){var r=n/2,o=e-i/2,s=t-i/2,a=e-r,l=t-r;return[{x:o,y:s},{x:o,y:l},{x:o+i,y:l},{x:o+i,y:s},{x:a+n,y:s},{x:a+n,y:s+i},{x:o+i,y:s+i},{x:o+i,y:l+n},{x:o,y:l+n},{x:o,y:s+i},{x:a,y:s+i},{x:a,y:s}]}function Wr(e){var t=e.size,n={x:e.x,y:e.y},i=hp[e.direction]||0,r=t/2,o=e.x-r,s=e.y-r,a=[{x:o,y:s+t},{x:o+r,y:s},{x:o+t,y:s+t},{x:o,y:s+t}],l=zn(i);return a=a.map(function(e){return m(e,l,n)}),{type:"path",fill:"black",d:B(a)}}function Xr(e){var t=e.x,n=e.y,i=e.size,r=i/2;return{type:"rect",x:t-r,y:n-r,width:i,height:i}}function Yr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.keys(t).forEach(function(n){void 0!==up[n]&&"transform"!==n&&(e[n]=t[n])})}function Kr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=dp.get(e.type);if(t){var n=t(e);return n.collider||(n.collider=Xr(e)),Yr(n,e),void 0!==e.data&&(n.data=e.data),n}return t}function Qr(e,t){return e&&"function"==typeof e.bandwidth?{isBandwidth:!0,value:Math.max(1,e.bandwidth()*t)}:{isBandwidth:!1,value:Math.max(1,t)}}function Zr(e,t,n,i,r){var o=Qr(e?e.scale:void 0,n,r),s=Qr(t?t.scale:void 0,i,r),a=Math.min(o.value*r[o.isBandwidth?"maxRelDiscrete":"maxRelExtent"],s.value*r[s.isBandwidth?"maxRelDiscrete":"maxRelExtent"]),l=Math.min(o.value*r[o.isBandwidth?"minRelDiscrete":"minRelExtent"],s.value*r[s.isBandwidth?"minRelDiscrete":"minRelExtent"]);return{min:Math.max(1,Math.floor(l)),max:Math.max(1,Math.floor(a)),maxGlobal:r.maxPx,minGlobal:r.minPx}}function Jr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=Fr(e,Yc({},fp,n.item),t);return i.errorShape=Fr(e.errorShape,pp.errorShape,t),i}function eo(e,t,n,i){t.x,t.y;var r=t.width,o=t.height;return e.filter(function(e){return!isNaN(e.x+e.y)}).map(function(e){var t=Hn(e.size)?e.errorShape:e,s=n.min+t.size*(n.max-n.min),a={type:"rect"===t.shape?"square":t.shape,label:e.label,x:e.x*r,y:e.y*o,fill:t.fill,size:Math.min(n.maxGlobal,Math.max(n.minGlobal,s)),stroke:t.stroke,strokeWidth:t.strokeWidth,strokeDasharray:t.strokeDasharray,opacity:t.opacity};t===e.errorShape&&(a.width=t.width);var l=i(a);return l.data=e.data,l})}function to(e,t,n,i){var r=ou(e,2),o=r[0],s=r[1],a=Math.sqrt(o*o+s*s),l=n-i;return{x:(o/=a)*t*l,y:(s/=a)*t*l}}function no(e,t,n){var i=t.x,r=t.y,o=t.width,s=t.height,a=Su(),l={x:i+o/2,y:r+s/2},c=Math.min(o,s)/2,u=Math.min(o,s)/2,h=u/100;return e.map(function(e,t){var i=n[t];i.type="path";var r=u*i.outerRadius,o=c*i.innerRadius;a.innerRadius(o),a.outerRadius(r),a.cornerRadius(h*i.cornerRadius),i.d=a(e);var s=a.centroid(e),d=i.offset?to(s,i.offset,r,o):{x:0,y:0};return i.transform="translate("+d.x+", "+d.y+") translate("+l.x+", "+l.y+")",i})}function io(e,t){return e&&t?e.cachedTicks&&e.cachedTicks()||e.ticks({distance:t}):[]}function ro(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"bottom";if(n*=.8,"left"===i||"right"===i){var r="right"===i;return"\n      M "+e+" "+(t-n)+"\n      A "+1.25*n+" "+1.25*n+", 0, 1, "+(r?0:1)+", "+e+" "+(t+n)+"\n      L "+(r?e+n:e-n)+" "+t+" Z\n    "}var o="bottom"===i;return"\n    M "+(e-n)+" "+t+"\n    A "+1.25*n+" "+1.25*n+", 0, 1, "+(o?1:0)+", "+(e+n)+" "+t+"\n    L "+e+" "+(o?t+n:t-n)+" Z\n  "}function oo(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"bottom";if(n*=.75,"left"===i||"right"===i){var r="right"===i;return"\n      M "+(e+=r?1.5*n:-1.5*n)+" "+(t-n)+"\n      L "+e+" "+(t+n)+"\n      L "+(r?e+n:e-n)+" "+t+" Z\n    "}var o="bottom"===i;return t+=o?1.5*n:-1.5*n,"\n    M "+(e-n)+" "+t+"\n    L "+(e+n)+" "+t+"\n    L "+e+" "+(o?t+n:t-n)+" Z\n  "}function so(e){for(var t=e.blueprint,n=e.oob,i=e.settings,r=e.items,o=Object.keys(n),s=i.style.oob||{},a=0,l=o.length;a<l;a++)!function(e,i){var a=o[e],l=n[a];if(l.length>0){var c=a.charAt(1),u="y"===a.charAt(0),h=s.padding.x+s.width,d=s.padding.y+s.width,p="bottom";p=u?"1"===c?"bottom":"top":"1"===c?"right":"left";var f=t.processItem({fn:function(e){var t=e.width,n=e.height,i=c*t+("1"===c?-h:h),r=u?d:n-d;return"arc"===s.type?{type:"path",d:ro(u?r:i,u?i:r,s.width,p),x:i,y:r,stroke:s.stroke,fill:s.fill,strokeWidth:s.strokeWidth||0}:{type:"circle",cx:i,cy:r,r:s.width,stroke:s.stroke,fill:s.fill,strokeWidth:s.strokeWidth||0,opacity:s.opacity,data:l}},flipXY:u}),m=f.cx||f.x,g=f.cy||f.y,v={type:"text",text:l.length||"",x:m-.4*s.width,y:g+.4*s.width,fontFamily:s.text.fontFamily,fontSize:1.3*s.width+"px",stroke:s.text.stroke,fill:s.text.fill,strokeWidth:s.text.strokeWidth||0,opacity:s.text.opacity},y={type:"path",d:oo(m,g,s.width,p),x:m,y:g,stroke:s.triangle.stroke,fill:s.triangle.fill,strokeWidth:s.triangle.strokeWidth||0,opacity:s.triangle.opacity};r.push(f,v,y)}}(a)}function ao(){return{fill:"#000",fontFamily:"Arial",fontSize:"12px",opacity:1,maxWidth:1,maxWidthPx:9999,padding:5,background:{fill:"#fff",stroke:"transparent",strokeWidth:0,opacity:.5}}}function lo(e){if(void 0===e)return 0;if("number"==typeof e&&isFinite(e))return e;if("string"==typeof e)switch(e){case"center":case"middle":return.5;case"bottom":case"right":return 1;case"top":case"left":default:return 0}return 0}function co(e){var t=e.chart,n=e.blueprint,i=e.renderer,r=e.p,o=e.settings,s=e.items,a=!0,l=!1,c=!1,u=!1,h=!1,d=Yc(!0,{},o.style.line,r.line||{});if(l=n.processItem({type:"line",x1:r.position,y1:0,x2:r.position,y2:1,stroke:d.stroke||"black",strokeWidth:d.strokeWidth||1,flipXY:r.flipXY||!1}),r.label){var p=Yc(!0,ao(),o.style.label||{},{fill:d.stroke},r.label),f=void 0,m={width:0,height:0},g="";if("string"==typeof r.formatter)f=t.formatter(r.formatter);else if("object"===Zc(r.formatter))f=t.formatter(r.formatter);else if(void 0!==r.scale&&r.scale.data){var v=r.scale.data()&&r.scale.data().fields;f=v&&v[0]?v[0].formatter():null}f?g=" ("+f(r.value)+")":r.scale&&(g=" ("+r.value+")"),g&&(m=i.measureText({text:g,fontFamily:p.fontFamily,fontSize:p.fontSize}));var y=i.measureText({text:p.text||"",fontFamily:p.fontFamily,fontSize:p.fontSize}),b={width:y.width+m.width,height:Math.max(y.height,m.height)},x=p.padding,q=lo(r.flipXY?p.vAlign:p.align),C=lo(r.flipXY?p.align:p.vAlign),S=Math.min(1+b.width+2*x,p.maxWidth*n.width,p.maxWidthPx),w=b.height+2*x,_=r.flipXY?w:S,D=r.flipXY?S:w;if((c=n.processItem({fn:function(e){var t=e.width,i=e.height,o=r.position*t-(r.flipXY?w:S)*(1-q);return{type:"rect",x:o=r.flipXY?o:Math.max(o,0),y:Math.max(Math.abs(C*i-D*C),0),width:r.flipXY?_:Math.min(_,n.width-o),height:D,stroke:p.background.stroke,strokeWidth:p.background.strokeWidth,fill:p.background.fill,opacity:p.background.opacity}},flipXY:r.flipXY||!1})).x<-1||c.x+c.width>n.width+1||c.y<-1||c.y+c.height>n.height+1)c=void 0;else{u={type:"text",text:p.text||"",fill:p.fill,opacity:p.opacity,fontFamily:p.fontFamily,fontSize:p.fontSize,x:c.x+x,y:c.y+c.height/2+b.height/3,maxWidth:c.width-2*x-m.width,anchor:"start"},g&&(h={type:"text",text:g||"",fill:p.fill,opacity:p.opacity,fontFamily:p.fontFamily,fontSize:p.fontSize,x:u.x+3+(c.width-(m.width+2*x)),y:u.y});for(var M=0,A=s.length;M<A;M++){var E=s[M];"rect"===E.type?Gd.testRectRect(c,E)&&(a=!1):"line"===E.type&&r.flipXY===E.flipXY&&Gd.testRectLine(c,E)&&(a=!1)}}}s.push(l),a&&c&&u&&(s.push(c,u),h&&s.push(h))}function uo(e){var t={value:e.value};return e.label&&(t.label=e.label.text),t}function ho(e){return void 0!==e.value}function po(e,t){Yc(e,t.style);var n=e.strokeWidth/2;"top"===t.align?(e.y1-=n,e.y2-=n):"bottom"===t.align?(e.y1+=n,e.y2+=n):"left"===t.align?(e.x1-=n,e.x2-=n):"right"===t.align&&(e.x1+=n,e.x2+=n)}function fo(e){var t={type:"line",x1:0,x2:0,y1:0,y2:0,collider:{type:null}};return"top"===e.align||"bottom"===e.align?(t.x1=e.innerRect.x-e.outerRect.x,t.x2=e.innerRect.width+e.innerRect.x,t.y1=t.y2="top"===e.align?e.innerRect.height-e.padding:e.padding):(t.x1=t.x2="left"===e.align?e.innerRect.width-e.padding:e.padding,t.y1=e.innerRect.y-e.outerRect.y,t.y2=e.innerRect.height+e.innerRect.y),po(t,e),t}function mo(e){return"string"==typeof e||"number"==typeof e?e:"-"}function go(e,t){["fill","fontSize","fontFamily"].forEach(function(n){e[n]=t.style[n]})}function vo(e,t){if(!t.tilted&&!t.stepSize){if("top"===t.align||"bottom"===t.align){var n=t.outerRect.width,i=Math.min(.75*t.maxWidth/2,t.textRect.width/2),r=e.x-i,o=e.x+i;r<0?(e.anchor="start",e.x=t.innerRect.x-t.outerRect.x,e.maxWidth*=.75):o>n&&(e.anchor="end",e.x=t.innerRect.width+t.innerRect.x,e.maxWidth*=.75)}else{var s=t.outerRect.height,a=t.maxHeight/2,l=e.y-a,c=e.y+a;l<0?(e.y=t.innerRect.y-t.outerRect.y,e.baseline="text-before-edge"):c>s&&(e.y=t.innerRect.height+(t.innerRect.y-t.outerRect.y),e.baseline="text-after-edge")}}}function yo(e,t){"top"===t.align?e.y-=t.padding:"bottom"===t.align?e.y+=t.padding+t.maxHeight:"left"===t.align?e.x-=t.padding:"right"===t.align&&(e.x+=t.padding)}function bo(e,t){if(t.tilted){var n=-t.angle,i=n*(Math.PI/180);"bottom"===t.align?(e.x-=t.maxHeight*Math.sin(i)/2,e.y-=t.maxHeight,e.y+=t.maxHeight*Math.cos(i)/2):e.x-=t.maxHeight*Math.sin(i)/3,e.transform="rotate("+n+", "+e.x+", "+e.y+")",e.anchor="bottom"===t.align==t.angle<0?"start":"end";var r=Math.cos(i)*t.maxWidth;if("bottom"===t.align==t.angle<0){var o=t.outerRect.width-t.paddingEnd;e.x+r>o&&(e.maxWidth=(o-e.x-10)/Math.cos(i))}else{var s=t.paddingEnd;e.x-r<s&&(e.maxWidth=(e.x-s-10)/Math.cos(i))}}}function xo(e,t,n){if("bottom"===n.align||"top"===n.align){var i=e.position*n.innerRect.width+(n.innerRect.x-n.outerRect.x-n.stepSize/2);t.collider={type:"rect",x:i,y:0,width:i<0?n.stepSize+i:n.stepSize,height:n.innerRect.height}}else{var r=e.position*n.innerRect.height+(n.innerRect.y-n.outerRect.y-n.stepSize/2);t.collider={type:"rect",x:0,y:r,width:n.innerRect.width,height:r<0?n.stepSize+r:n.stepSize}}var o=t.collider;o.x=Math.max(o.x,0),o.y=Math.max(o.y,0);var s=o.x+o.width-(n.outerRect.x+n.outerRect.width);o.width=s>0?o.width-s:o.width;var a=o.y+o.height-(n.outerRect.y+n.outerRect.height);o.height=a>0?o.height-a:o.height}function qo(e,t){t.collider={type:"polygon",vertices:[{x:t.boundingRect.x,y:t.boundingRect.y},{x:t.boundingRect.x+t.boundingRect.width,y:t.boundingRect.y},{x:t.boundingRect.x+t.boundingRect.width,y:t.boundingRect.y+t.boundingRect.height},{x:t.boundingRect.x,y:t.boundingRect.y+t.boundingRect.height}]}}function Co(e,t,n){var i=n.angle*(Math.PI/180),r=Math.max(n.stepSize/2,t.boundingRect.height/2),o="start"===t.anchor,s="end"===t.anchor&&i<0,a="start"===t.anchor&&i>=0,l=t.boundingRect.y+(a||s?t.boundingRect.height:0),c=[{x:t.x-r,y:l},{x:t.x+r,y:l}].map(function(e){return m(e,i,{x:t.x,y:t.y})}),u={x:o?t.boundingRect.x+t.boundingRect.width+10:t.boundingRect.x-10,y:t.boundingRect.y+t.boundingRect.height},h={x:o?t.boundingRect.x+t.boundingRect.width+10:t.boundingRect.x-10,y:t.boundingRect.y},d=i>=0?[u,h]:[h,u];c.push.apply(c,d),t.collider={type:"polygon",vertices:c}}function So(e,t,n){n.layered||!n.stepSize?qo(e,t):n.tilted?Co(e,t,n):xo(e,t,n)}function wo(e,t){e.boundingRect=t.textBounds(e)}function _o(e,t){var n=isNaN(e.style.align)?.5:Math.min(Math.max(e.style.align,0),1),i=0;if(e.tilted)i=e.stepSize*n;else{var r=t?e.textRect.height:e.textRect.width;i=Math.max(0,e.stepSize-r)*n}return i}function Do(e,t){var n={type:"text",text:mo(e.label),x:0,y:0,maxWidth:t.maxWidth,maxHeight:t.maxHeight};return"top"===t.align||"bottom"===t.align?(n.x=e.start*t.innerRect.width+(t.innerRect.x-t.outerRect.x)+_o(t,!1),n.y="top"===t.align?t.innerRect.height:0,n.anchor=t.stepSize?"start":"middle"):(n.y=e.start*t.innerRect.height+(t.innerRect.y-t.outerRect.y)+_o(t,!0),n.x="left"===t.align?t.innerRect.width:0,n.anchor="left"===t.align?"end":"start",n.baseline=t.stepSize?"text-before-edge":"central"),go(n,t),vo(n,t),yo(n,t),bo(n,t),wo(n,t),So(e,n,t),n}function Mo(e,t){Yc(e,t.style)}function Ao(e,t){"top"===t.align?(e.y1-=t.padding,e.y2-=t.padding):"bottom"===t.align?(e.y1+=t.padding,e.y2+=t.padding):"left"===t.align?(e.x1-=t.padding,e.x2-=t.padding):"right"===t.align&&(e.x1+=t.padding,e.x2+=t.padding)}function Eo(e,t){var n=e.strokeWidth/2;e.x1===t.innerRect.width?(e.x1-=n,e.x2-=n):0===e.x1?(e.x1+=n,e.x2+=n):e.y1===t.innerRect.height?(e.y1-=n,e.y2-=n):0===e.y1&&(e.y1+=n,e.y2+=n)}function Io(e,t){var n={type:"line",x1:0,x2:0,y1:0,y2:0,collider:{type:null}};return"top"===t.align||"bottom"===t.align?(n.x1=n.x2=e.position*t.innerRect.width+(t.innerRect.x-t.outerRect.x),n.y1="top"===t.align?t.innerRect.height:0,n.y2="top"===t.align?n.y1-t.tickSize:n.y1+t.tickSize):(n.y1=n.y2=e.position*t.innerRect.height+(t.innerRect.y-t.outerRect.y),n.x1="left"===t.align?t.innerRect.width:0,n.x2="left"===t.align?n.x1-t.tickSize:n.x1+t.tickSize),Mo(n,t),Ao(n,t),Eo(n,t),n}function To(e){return!e.isMinor}function Lo(e){var t=e.majorTicks,n=e.measureText,i=e.rect.height,r=n("M").height;return!(t.length<2)&&i*Math.abs(t[0].position-t[1].position)<r}function ko(e){for(var t=e.majorTicks,n=e.measureText,i=e.rect,r="layered"===e.state.labels.activeMode?2:1,o=i.width,s=t.map(function(e){return e.label}).map(function(e){return e.slice(0,1)+(e.length>1?"":"")}).map(n).map(function(e){return e.width}),a=0;a<t.length;++a){var l=t[a];if(r*o*Math.abs(l.start-l.end)<s[a])return!0}return!1}function Oo(e){var t=e.majorTicks,n=e.measure,i=e.rect,r=e.state,o=e.settings.labels.maxGlyphCount,s="layered"===r.labels.activeMode?2:1,a=n("").width,l=i.width,c=0;if(isNaN(o))for(var u=0;u<t.length;u++){var h=t[u],d=h.label,p=n(d).width*(d.length>1?.7:1);if(c=s*l*Math.abs(h.start-h.end),p+a>c)return!0}else if(c=s*l*t.reduce(function(e,t){return Math.min(Math.abs(t.start-t.end),e)},1/0),.7*n("M").width*o+a>c)return!0;return!1}function Po(e){var t=e.majorTicks,n=e.measureText,i=e.rect,r=e.bleedSize,o=e.angle;if(t.length<2)return!1;if(0===o)return!0;var s=Math.abs(o),a=1/((i.width-r)*Math.abs(t[0].position-t[1].position));return n("M").height>Math.sin(s*(Math.PI/180))/a}function No(e){var t=e.rect,n=e.state,i=e.majorTicks,r=e.measure;return e.horizontal?ko({majorTicks:i,measureText:r,rect:t,state:n}):Lo({majorTicks:i,measureText:r,rect:t,state:n})}function Ro(e){var t=e.value,n=e.maxValue,i=e.minValue,r=e.range,o=e.modifier;return isNaN(r)||isNaN(o)||(t=r*o),t>n&&(t=n),t<i&&(t=i),t}function Fo(e){var t=e.isDiscrete,n=e.rect,i=e.formatter,r=e.measureText,o=e.scale,s=e.settings,a=e.state,l=0,c={left:0,top:0,right:0,bottom:0},u=s.labels,h=u.maxLengthPx,d=u.minLengthPx;if(s.labels.show){var p=s.align,f="top"===p||"bottom"===p,m=f?n.width:n.height,g=o.ticks({settings:s,distance:m,formatter:i}).filter(To),v=function(e){var t=r({text:e,fontSize:s.labels.fontSize,fontFamily:s.labels.fontFamily});return t.width=Ro({value:t.width,maxValue:h,minValue:d}),t};if(t&&f&&"auto"===s.labels.mode&&(Oo({majorTicks:g,measure:v,rect:n,state:a,settings:s})?a.labels.activeMode="tilted":a.labels.activeMode="horizontal"),t&&"tilted"!==a.labels.activeMode&&No({rect:n,state:a,majorTicks:g,measure:v,horizontal:f}))return{size:Math.max(n.width,n.height),isToLarge:!0};var y=void 0;if("tilted"===a.labels.activeMode){var b=Math.abs(s.labels.tiltAngle)*(Math.PI/180);y=function(e){return Ro({value:e.width,maxValue:h,minValue:d})*Math.sin(b)+e.height*Math.cos(b)}}else y=f?function(e){return e.height}:function(e){return Ro({value:e.width,maxValue:h,minValue:d})};var x=void 0;if(f&&"tilted"!==a.labels.activeMode)x=["M"];else if(isNaN(s.labels.maxGlyphCount))x=g.map(function(e){return e.label});else{for(var q="",C=0;C<s.labels.maxGlyphCount;C++)q+="M";x=[q]}var S=x.map(v),w=S.map(y),_=Math.max.apply(Math,su(w).concat([0]));if(l+=_,l+=s.labels.margin,"layered"===a.labels.activeMode&&(l*=2),"tilted"===a.labels.activeMode){var D="bottom"===s.align==s.labels.tiltAngle>=0,M=Math.abs(s.labels.tiltAngle)*(Math.PI/180),A=(_-r("M").height*Math.cos(M))/Math.sin(M),E=Math.min(s.labels.maxEdgeBleed,Math.max.apply(Math,su(S.map(function(e){return Math.min(A,e.width)*Math.cos(M)+e.height}).map(function(e,t){var i=g[t]?g[t].position:0;return D?e-i*n.width:e-(1-i)*n.width})).concat([0])))+s.paddingEnd;if(c[D?"left":"right"]=E,t&&Po({majorTicks:g,measureText:r,rect:n,bleedSize:E,angle:s.labels.tiltAngle}))return{size:Math.max(n.width,n.height),isToLarge:!0}}}return{size:l,edgeBleed:c}}function jo(e){var t=0;return t+=e.paddingStart,t+=e.line.show?e.line.strokeWidth:0,t+=e.ticks.show?e.ticks.margin:0}function Vo(e){return e.line.strokeWidth+e.minorTicks.margin}function Ho(e){var t=0;return t+=e.ticks.show?e.ticks.tickSize:0,t+=jo(e)+e.labels.margin}function Bo(e){var t=e.style;return(0,e.measureText)({text:e.tick.label,fontSize:t.fontSize,fontFamily:t.fontFamily})}function zo(e){return e.filter(function(e){return!e.isMinor})}function $o(e){return e.filter(function(e){return e.isMinor})}function Uo(e,t){return e.map(function(e){return Io(e,t)})}function Go(e,t){return t?Math.abs(t.end-t.start):e.bandwidth()}function Wo(e,t,n){return e.map(function(e){n(e);var i=Do(e,t);return i.data=e.data,i})}function Xo(e,t,n,i){var r=t.padding,o=Ho(n);return e.map(function(e,s){i(e);var a=o+t.maxHeight+n.labels.margin;t.layer=s%2,t.padding=s%2==0?r:a;var l=Do(e,t);return l.data=e.data,l})}function Yo(e,t){for(var n=0;n<=e.length-1;n++)for(var i=n+1;i<=Math.min(n+5,n+(e.length-1));i++)e[n]&&e[i]&&function(e,t){var n=e.boundingRect,i=t.boundingRect;return Gd.testRectRect(n,i)}(e[n],e[i])&&(i===e.length-1?(e.splice(n,1),t&&t.splice(n,1)):(e.splice(i,1),t&&t.splice(i,1)),i--,n--)}function Ko(e){var t=e.measureText,n=e.settings,i=e.innerRect,r=e.scale,o=e.tilted,s=e.layered,a=e.tick,l=t({text:"M",fontSize:n.labels.fontSize,fontFamily:n.labels.fontFamily}).height,c=Go(r,a),u={width:0,height:l};if("left"===n.align||"right"===n.align)u.width=i.width-Ho(n)-n.paddingEnd;else if(s)u.width=c*i.width*2;else if(o){var h=Math.abs(n.labels.tiltAngle)*(Math.PI/180);u.width=(i.height-Ho(n)-n.paddingEnd-l*Math.cos(h))/Math.sin(h)}else u.width=c*i.width;return u.width=Ro({value:u.width,maxValue:n.labels.maxLengthPx,minValue:n.labels.minLengthPx}),u}function Qo(e){var t=e.measureText,n=e.settings,i=e.innerRect,r=e.ticks,o=e.tilted,s=e.layered,a=t({text:"M",fontSize:n.labels.fontSize,fontFamily:n.labels.fontFamily}).height,l={width:0,height:a};if("left"===n.align||"right"===n.align)l.width=i.width-Ho(n)-n.paddingEnd;else if(s)l.width=i.width/zo(r).length*.75*2;else if(o){var c=Math.abs(n.labels.tiltAngle)*(Math.PI/180);l.width=(i.height-Ho(n)-n.paddingEnd-a*Math.cos(c))/Math.sin(c)}else l.width=i.width/zo(r).length*.75;return l.width=Ro({value:l.width,maxValue:n.labels.maxLengthPx,minValue:n.labels.minLengthPx}),l}function Zo(e){var t=e.innerRect,n=e.scale,i=e.settings,r=e.tick;return("top"===i.align||"bottom"===i.align?t.width:t.height)*Go(n,r)}function Jo(e){function t(){return r=Qo,o=!0,t}function n(){return r=Ko,n}function i(e){var t=e.settings,n=e.scale,i=e.innerRect,s=e.outerRect,a=e.measureText,l=e.ticks,c=e.state,u=e.textBounds,h=[],d=zo(l),p=$o(l),f={innerRect:i,align:t.align,outerRect:s},m="tilted"===c.labels.activeMode,g="layered"===c.labels.activeMode,v=void 0;if(t.line.show&&(f.style=t.line,f.padding=t.paddingStart,h.push(fo(f))),t.ticks.show&&(f.style=t.ticks,f.tickSize=t.ticks.tickSize,f.padding=jo(t),v=Uo(d,f)),t.labels.show){var y=Ho(t);f.style=t.labels,f.padding=y,f.tilted=m,f.layered=g,f.angle=t.labels.tiltAngle,f.paddingEnd=t.paddingEnd,f.textBounds=u;var b=function(e){var o=r({measureText:a,settings:t,innerRect:i,ticks:l,scale:n,tilted:m,layered:g,tick:e});f.maxWidth=o.width,f.maxHeight=o.height,f.textRect=Bo({tick:e,measureText:a,style:f.style}),f.stepSize=Zo({innerRect:i,scale:n,ticks:l,settings:t,tick:e})},x=[];x=!g||"top"!==t.align&&"bottom"!==t.align?Wo(d,f,b):Xo(d,f,t,b),o&&!f.tilted&&Yo(x,v),h.push.apply(h,su(x))}return t.minorTicks&&t.minorTicks.show&&p.length>0&&(f.style=t.minorTicks,f.tickSize=t.minorTicks.tickSize,f.padding=Vo(t),h.push.apply(h,su(Uo(p,f)))),v&&h.push.apply(h,su(v)),h}var r=void 0,o=!1;return t.build=i,n.build=i,e?n():t()}function es(e){var t=e.isDiscrete,n=e.rect,i=e.formatter,r=e.measureText,o=e.scale,s=e.settings,a=0,l=Fo({isDiscrete:t,rect:n,formatter:i,measureText:r,scale:o,settings:s,state:e.state}),c=l.size,u=l.edgeBleed;if(a+=c,l.isToLarge)return{size:a};if(s.ticks.show&&(a+=s.ticks.margin,a+=s.ticks.tickSize),s.minorTicks&&s.minorTicks.show){var h=s.minorTicks.margin+s.minorTicks.tickSize;h>a&&(a=h)}return s.line.show&&(a+=s.line.strokeWidth),a+=s.paddingStart,a+=s.paddingEnd,{size:a,edgeBleed:u}}function ts(e,t){for(var n=e,i=0;i<t.length;i++){if(!n[t[i]])return;n=n[t[i]]}return n}function ns(e,t){return null===t&&e?e:t}function is(e,t,n,i){for(var r=arguments.length,o=Array(r>4?r-4:0),s=4;s<r;s++)o[s-4]=arguments[s];var a=n?n.call.apply(n,[i].concat(o)):null;return void 0!==a?ns(e,a):t&&"function"==typeof t.fn?t.fn.apply(t,[i].concat(o)):t}function rs(e,t,n,i){var r=e[i],o=Cp[t];if(!r)return n;var s=Zc(r[t]);if("undefined"===s)return i<e.length-1?rs(e,t,n,i+1):n;if(Zc(r[t])===(void 0===n?"undefined":Zc(n))||null===r[t])return ns(o,r[t]);if("function"===s){var a=rs(e,t,n,i+1);return r[t].fn=function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];return is.apply(void 0,[o,a,r[t]].concat(n))},r[t]}return"object"===s?r[t]:n}function os(e,t,n,i){for(var r=t.length,o=[];r>=0;)o.push(ts(e,t)),t.pop(),r--;return rs(o,n,i,0)}function ss(e,t,n){var i=n?n.split("."):[],r={};return Object.keys(e).forEach(function(n){var o=null===e[n]&&void 0!==Cp[n]?Cp[n]:e[n];r[n]=os(t,i.concat(),n,o)}),r}function as(e,t,n){var i={};return t?Object.keys(e).forEach(function(r){i[r]=e[r]&&"function"==typeof e[r].fn?e[r].fn(void 0,t[r][n],n,t[r]):e[r]}):Object.keys(e).forEach(function(t){i[t]=e[t]&&"function"==typeof e[t].fn?e[t].fn():e[t]}),i}function ls(e){return"object"!==(void 0===e?"undefined":Zc(e))}function cs(e,t,n,i,r){var o={};return Object.keys(e).forEach(function(s){var a=void 0!==e[s],l=a&&"function"==typeof e[s].scale,c=a&&!!e[s].ref,u=a&&e[s].ref?t[e[s].ref]:t;if("function"==typeof e[s]){var h=Yc({},{data:t},r);l&&(h.scale=e[s].scale),"function"==typeof e[s].fn?o[s]=e[s].fn(h,c?t[e[s].ref]:void 0,n,i):o[s]=e[s].call(h,c?t[e[s].ref]:void 0,n,i)}else l?(o[s]=e[s].scale(ls(u)?u:u.value),e[s].scale.bandwidth&&(o[s]+=e[s].scale.bandwidth()/2)):o[s]=c?u:e[s]}),o}function us(e,t,n,i){var r=Yc(!0,{},e),o=i?r[i]:r,s=i?t[i]:t;return o&&Object.keys(o).forEach(function(e){if(o[e])if(!o[e].source&&!o[e].scale||o[e].fn)o[e].fn&&(o[e]=o[e].fn);else{var t=n.scale(o[e]);t&&(o[e]=t)}}),ss(s,r,i)}function hs(e){var t=e.align,n=e.inner;return"left"===t?{x:n.width+n.x}:"right"===t||"bottom"===t?n:{y:n.y+n.height}}function ds(e,t){var n=["top","bottom"],i=["left","right"];return-1!==n.indexOf(e)&&-1===i.indexOf(t)?e:-1!==i.indexOf(e)&&-1===n.indexOf(t)?e:t}function ps(e,t,n){var i={};return Object.keys(t).forEach(function(r){i[r]=us(e,t,n,r)}),i}function fs(e,t,n){var i=t.labels.mode;return n&&e.isHorizontal?"auto"===i?e.labels.activeMode:-1!==["layered","tilted"].indexOf(t.labels.mode)&&-1!==["top","bottom"].indexOf(t.dock)?i:"horizontal":"horizontal"}function ms(e,t,n){var i="";return"function"==typeof e?i=e():"string"==typeof e?i=e:n&&(i=(n.data().fields||[]).map(function(e){return e.title()}).join(t)),i}function gs(e,t){var n="middle";return"left"===e?"top"===t?n="end":"bottom"===t&&(n="start"):"right"===e?"top"===t?n="start":"bottom"===t&&(n="end"):"left"===t?n="start":"right"===t&&(n="end"),n}function vs(e){var t=e.title,n=e.definitionSettings,i=e.dock,r=e.rect,o=e.measureText,s={type:"text",text:t,x:0,y:0,dx:0,dy:0,anchor:gs(i,n.anchor),baseline:"alphabetical"};Yc(s,n.style);var a=o(s);if("top"===i||"bottom"===i){var l=r.width/2;"left"===n.anchor?l=n.paddingLeft||0:"right"===n.anchor&&(l=r.width-(n.paddingRight||0)),s.x=l,s.y="top"===i?r.height-n.paddingStart:n.paddingStart+a.height,s.dy="top"===i?-a.height/6:-a.height/3,s.maxWidth=.8*r.width}else{var c=r.height/2;"top"===n.anchor?c=n.paddingStart:"bottom"===n.anchor&&(c=r.height-n.paddingStart),s.y=c,s.x="left"===i?r.width-n.paddingStart:n.paddingStart,s.dx="left"===i?-a.height/3:a.height/3;var u="left"===i?270:90;s.transform="rotate("+u+", "+(s.x+s.dx)+", "+(s.y+s.dy)+")",s.maxWidth=.8*r.height}return isNaN(n.maxLengthPx)||(s.maxWidth=Math.min(s.maxWidth,n.maxLengthPx)),s}function ys(e,t){var n=e.settings.dock,i=e.settings.settings.invert,r="top"===n||"bottom"===n,o=r?"width":"height",s=e.rect[o],a=e.chart.scroll(e.settings.scroll),l=void 0,c=t[r?"x":"y"];i&&(c=s-c);var u=a.getState();l={startOffset:c,startScroll:u.start,swipe:!1};var h=c/s*(u.max-u.min)+u.min;h<u.start?l.startScroll=h:h>u.start+u.viewSize&&(l.startScroll=h-u.viewSize);return{update:function(e){var t=e[r?"x":"y"];if(i&&(t=s-t),!l.swipe){if(Math.abs(l.startOffset-t)<=1)return;l.swipe=!0}var n=a.getState(),o=(t-l.startOffset)/s*(n.max-n.min),c=l.startScroll+o;a.moveTo(c)},end:function(e){var t=e[r?"x":"y"];i&&(t=s-t);var n=a.getState();if(l.swipe){var o=(t-l.startOffset)/s*(n.max-n.min),c=l.startScroll+o;a.moveTo(c)}else{var u=t/s*(n.max-n.min)+n.min-n.viewSize/2;a.moveTo(u)}}}}function bs(e,t){var n=t.element().getBoundingClientRect();return{x:e.center.x-n.left,y:e.center.y-n.top}}function xs(e){var t=e.h,n=e.isVertical,i=e.value,r=e.pos,o=e.align,s=e.borderHit,a=e.state,l="end"!==o,c={left:"0",top:"0"},u={right:"0",bottom:"0"},h=l?c:u,d=0,p="100%",f="100%";return a.targetRect&&"start"===a.settings.bubbles.align?(p=a.targetRect.x+a.targetRect.width+"px",f=a.targetRect.y+a.targetRect.height+"px"):a.targetRect&&"end"===a.settings.bubbles.align&&(d=n?a.targetRect.x:a.targetRect.y,p=a.rect.width-d+"px",f=a.rect.height-d+"px"),l||(r-=s),t("div",{on:{mouseover:function(){this.children[0].elm.style.backgroundColor="#000",this.children[0].elm.style[n?"height":"width"]="2px"},mouseout:function(){this.children[0].elm.style.backgroundColor="rgba(50, 50, 50, 0.8)",this.children[0].elm.style[n?"height":"width"]="1px"}},attrs:{"data-value":i},style:{cursor:n?"ns-resize":"ew-resize",position:"absolute",left:n?d+"px":r+"px",top:n?r+"px":d+"px",height:n?s+"px":f,width:n?p:s+"px",pointerEvents:"auto"}},[t("div",{style:Yc({backgroundColor:"rgba(50, 50, 50, 0.8)",position:"absolute",height:n?"1px":"100%",width:n?"100%":"1px"},h)})])}function qs(e){var t,n=e.h,i=e.isVertical,r=e.label,o=e.otherValue,s=e.idx,a=e.pos,l=e.align,c=e.style,u="end"!==l,h="outside"===e.state.settings.bubbles.placement,d="none",p=void 0;return i?(p=u?"left":"right",h&&(d=u?"translate(-100%,  0px)":"translate(100%,  0px)")):(p=u?"top":"bottom",h&&(d=u?"translate(0px, -100%)":"translate(0px,  100%)")),n("div",{style:(t={position:"absolute"},tu(t,p,"0"),tu(t,i?"top":"left",a+"px"),tu(t,"transform",d),t)},[n("div",{attrs:{"data-other-value":o,"data-idx":s},style:Yc({position:"relative",borderRadius:"6px",border:"1px solid #666",backgroundColor:"#fff",padding:"5px 9px",textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"150px",minWidth:"50px",minHeight:"1em",pointerEvents:"auto",transform:i?"translate(0,-50%)":"translate(-50%,0)"},c)},[r])])}function Cs(e){var t=e.h,n=e.isVertical,i=e.top,r=e.height,o=e.color,s=e.on;return t("div",{style:{backgroundColor:o,position:"absolute",left:n?0:i+"px",top:n?i+"px":0,height:n?r+"px":"100%",width:n?"100%":r+"px",pointerEvents:"auto"},on:s},[])}function Ss(e){var t=e.borderHit,n=e.els,i=e.isVertical,r=e.state,o=e.vStart,s=e.vEnd,a=e.idx,l=0;r.targetRect&&(l=i?r.targetRect.y:r.targetRect.x);var c=!!r.scale,u=c?r.scale.norm(o)*r.size:o,h=c?r.scale.norm(s)*r.size:s,d=Math.abs(u-h),p=Math.min(u,h)+l,f=p+d;if(r.targetRect){var m=r.targetFillRect||r.targetRect,g=i?m.height:m.width,v=c?r.scale.norm(o)*g:o,y=c?r.scale.norm(s)*g:s,b=Math.abs(v-y),x=Math.min(v,y),q={h:r.h,isVertical:i,top:x,height:b,color:r.settings.target.fill};void 0!==r.settings.target.fillActive&&(q.on={mouseover:function(){this.elm.style.backgroundColor=r.settings.target.fillActive||r.settings.target.fill},mouseout:function(){this.elm.style.backgroundColor=r.settings.target.fill}}),n.push(r.h("div",{style:{position:"absolute",left:m.x+"px",top:m.y+"px",height:m.height+"px",width:m.width+"px"}},[Cs(q)]))}n.push(xs({h:r.h,isVertical:i,borderHit:t,value:u<h?o:s,pos:p,align:"start",state:r})),n.push(xs({h:r.h,isVertical:i,borderHit:t,value:u<h?s:o,pos:f,align:"end",state:r}));var C=r.settings.bubbles;if(C&&C.show){var S={fontSize:C.fontSize,fontFamily:C.fontFamily,color:C.fill},w=[o,s];n.push(qs({h:r.h,isVertical:i,align:C.align,style:S,idx:a,otherValue:u<h?s:o,label:""+r.format(u<h?o:s,w),pos:p,state:r})),n.push(qs({h:r.h,isVertical:i,align:C.align,style:S,idx:a,otherValue:u<h?o:s,label:""+r.format(u<h?s:o,w),pos:f,state:r}))}}function ws(e){var t=e.active.limitHigh-e.active.end,n=e.active.limitLow-e.active.start,i=e.current-e.start;return i=i<0?Math.max(i,n):Math.min(i,t)}function _s(e){if(!e.active)return[];var t=e.start,n=e.current;if(-1!==e.active.idx)if("foo"===e.active.mode)t=Math.min(e.active.start,e.active.end),n=Math.max(e.active.start,e.active.end);else if("modify"===e.active.mode)t=Math.min(e.start,e.current),n=Math.max(e.start,e.current);else{var i=ws(e);t=e.active.start+i,n=e.active.end+i}var r=[],o=e.direction===Mp;return e.ranges.forEach(function(t,n){n!==e.active.idx&&Ss({borderHit:Dp,els:r,isVertical:o,state:e,vStart:Math.min(t.min,t.max),vEnd:Math.max(t.min,t.max),idx:n})}),Ss({borderHit:Dp,els:r,isVertical:o,state:e,vStart:t,vEnd:n,idx:e.active.idx}),r}function Ds(e){return{min:e.scale.min(),max:e.scale.max()}}function Ms(e){return{min:0,max:e.direction?e.rect.width:e.rect.height}}function As(e,t,n){var i=e.ranges,r=void 0,o=-1;for(r=0;r<i.length;r++){if(i[r].min<=t&&t<=i[r].max){o=r,n.min=r?i[r-1].max:n.min,n.max=r+1<i.length?i[r+1].min:n.max;break}if(t<i[r].min){n.max=i[r].min,n.min=r?i[r-1].max:n.min;break}}-1===o&&i.length&&r>=i.length&&(n.min=i[i.length-1].max);var s=void 0;-1!==o&&(s={idx:o,start:i[o].min,end:i[o].max,limitLow:n.min,limitHigh:n.max,mode:"foo"}),e.active=s}function Es(e){var t=e.state,n=e.e,i=e.renderer,r=e.ranges,o=e.targetSize;if(!t.started){var s=n.center.x-n.deltaX,a=n.center.y-n.deltaY,l=document.elementFromPoint(s,a);i.element().contains(l)||(l=null);var c={started:!0};t.offset=i.element().getBoundingClientRect(),t.ranges=r(t);var u=s-t.offset.left,h=a-t.offset.top,d=n.center[t.cssCoord.coord]-n[t.cssCoord.pos]-t.offset[t.cssCoord.offset],p=n.center[t.cssCoord.coord]-t.offset[t.cssCoord.offset],f=p,m=d;c.start=d,c.current=p;var g=t.ranges,v=Ms(t),y=void 0,b=-1;if(l&&l.hasAttribute("data-idx"))b=parseInt(l.getAttribute("data-idx"),10),v.min=b>0?g[b-1].max:v.min,v.max=b+1<g.length?g[b+1].min:v.max;else{for(y=0;y<g.length;y++){if(g[y].min<=m&&m<=g[y].max){b=y,v.min=y?g[y-1].max:v.min,v.max=y+1<g.length?g[y+1].min:v.max;break}if(m<g[y].min){v.max=g[y].min,v.min=y?g[y-1].max:v.min;break}}-1===b&&g.length&&y>=g.length&&(v.min=g[g.length-1].max)}-1!==b||t.multi||(c.ranges=[],v.min=0,v.max=t.direction?t.rect.width:t.rect.height);var x=void 0;if(-1!==b)if(x={idx:b,start:g[b].min,end:g[b].max,limitLow:v.min,limitHigh:v.max,mode:"move"},l&&l.hasAttribute("data-other-value"))c.start=parseFloat(l.getAttribute("data-other-value")),x.mode="modify";else{var q=x.start,C=x.end;Math.abs(d-q)<=o?(c.start=x.end,x.mode="modify"):Math.abs(d-C)<=o&&(c.start=x.start,x.mode="modify")}else x={idx:-1,start:m,end:f,limitLow:v.min,limitHigh:v.max,mode:"current"};c.active=x,"modify"!==x.mode&&t.targetRect&&!Gd.testRectPoint(t.targetRect,{x:u,y:h})||Object.keys(c).forEach(function(e){return t[e]=c[e]})}}function Is(e){var t=e.state,n=e.e,i=e.renderer,r=e.ranges,o=e.targetSize;if(!t.started){var s=n.center.x-n.deltaX,a=n.center.y-n.deltaY,l=document.elementFromPoint(s,a);i.element().contains(l)||(l=null);var c={started:!0};t.offset=Yc({},i.element().getBoundingClientRect());var u=s-t.offset.left,h=a-t.offset.top;t.offset.left+=t.targetRect?t.targetRect.x:0,t.offset.top+=t.targetRect?t.targetRect.y:0,t.ranges=r(t,t.fauxBrushInstance||t.brushInstance);var d=n.center[t.cssCoord.coord]-n[t.cssCoord.pos]-t.offset[t.cssCoord.offset],p=n.center[t.cssCoord.coord]-t.offset[t.cssCoord.offset];c.current=t.scale.normInvert(p/t.size),c.start=t.scale.normInvert(d/t.size);var f=t.ranges,m=Ds(t),g=void 0,v=-1;if(l&&l.hasAttribute("data-idx"))v=parseInt(l.getAttribute("data-idx"),10),m.min=v>0?f[v-1].max:m.min,m.max=v+1<f.length?f[v+1].min:m.max;else{for(g=0;g<f.length;g++){if(f[g].min<=c.start&&c.start<=f[g].max){v=g,m.min=g?f[g-1].max:m.min,m.max=g+1<f.length?f[g+1].min:m.max;break}if(c.start<f[g].min){m.max=f[g].min,m.min=g?f[g-1].max:m.min;break}}-1===v&&f.length&&g>=f.length&&(m.min=f[f.length-1].max)}-1!==v||t.multi||(c.ranges=[],m.min=t.scale.min(),m.max=t.scale.max());var y=void 0;if(-1!==v)if(y={idx:v,start:f[v].min,end:f[v].max,limitLow:m.min,limitHigh:m.max,mode:"move"},l&&l.hasAttribute("data-other-value"))c.start=parseFloat(l.getAttribute("data-other-value")),y.mode="modify";else{var b=t.scale.norm(y.start)*t.size,x=t.scale.norm(y.end)*t.size;Math.abs(d-b)<=o?(c.start=y.end,y.mode="modify"):Math.abs(d-x)<=o&&(c.start=y.start,y.mode="modify")}else y={idx:-1,start:c.start,end:c.current,limitLow:m.min,limitHigh:m.max,mode:"current"};c.active=y,"modify"!==y.mode&&t.targetRect&&!Gd.testRectPoint(t.targetRect,{x:u,y:h})||Object.keys(c).forEach(function(e){return t[e]=c[e]})}}function Ts(e,t){e.started=!1,e.ranges=t(e,e.fauxBrushInstance||e.brushInstance);var n=Ds(e);As(e,e.current,n)}function Ls(e,t){e.started=!1,e.ranges=t(e);var n=Ms(e);As(e,e.current,n)}function ks(e,t){var n=(t.center[e.cssCoord.coord]-e.offset[e.cssCoord.offset])/e.size,i=e.scale.normInvert(n);e.current=Math.max(Math.min(i,e.active.limitHigh),e.active.limitLow)}function Os(e,t){var n=t.center[e.cssCoord.coord]-e.offset[e.cssCoord.offset];e.current=Math.max(Math.min(n,e.active.limitHigh),e.active.limitLow)}function Ps(e){e.renderer.render(_s(e))}function Ns(e,t){if(!t||!t.isActive())return[];var n=e.scale.data(),i=(n?n.fields||[]:[]).map(function(e){return e.id()}),r=t.brushes().filter(function(e){return"range"===e.type&&-1!==i.indexOf(e.id)})[0];return r?r.brush.ranges():[]}function Rs(e){var t=e.ranges.map(function(e){return{min:e.min,max:e.max}});if(-1!==e.active.idx)if("modify"===e.active.mode)t[e.active.idx].min=Math.min(e.start,e.current),t[e.active.idx].max=Math.max(e.start,e.current);else{var n=ws(e);t[e.active.idx].min+=n,t[e.active.idx].max+=n}else t.push({min:Math.min(e.start,e.current),max:Math.max(e.start,e.current)});var i=e.scale.data();i&&i.fields&&i.fields.forEach(function(n){if(e.fauxBrushInstance){var i=Ns(e,e.fauxBrushInstance),r=e.findValues(i),o=e.findValues(t),s=o.filter(function(e){return-1===r.indexOf(e)}),a=r.filter(function(e){return-1===o.indexOf(e)}),l=s.map(function(e){return{key:n.id(),value:e}}),c=a.map(function(e){return{key:n.id(),value:e}});e.brushInstance.addAndRemoveValues(l,c),e.fauxBrushInstance.setRange(n.id(),t)}else e.brushInstance.setRange(n.id(),t)})}function Fs(e,t){for(var n=void 0,i=1/0,r=t.domain(),o=t.bandwidth()/2,s=0;s<r.length;++s){var a=Math.abs(e-o-t(r[s]));a<i&&(i=a,n=r[s])}return n}function js(e,t){var n=t.ticks(),i=t.domain().indexOf(Fs(e,t));return-1!==i?n[i].label:"-"}function Vs(e,t){return Math.min.apply(Math,su(e))<=Math.max.apply(Math,su(t))&&Math.max.apply(Math,su(e))>=Math.min.apply(Math,su(t))}function Hs(e,t){var n=t.domain(),i=t.range(),r=[];return e.forEach(function(e){if(Vs(i,[e.min,e.max])){var o=n.indexOf(Fs(e.min,t)),s=n.indexOf(Fs(e.max,t));r.push.apply(r,n.slice(Math.min(o,s),Math.max(o,s)+1))}}),r}function Bs(e){return q(e.reduce(function(e,t){return e.push.apply(e,su(b(t.bounds))),e},[]))}function zs(e){var t={targetRect:null,targetFillRect:null,scale:null,size:null},n=e.settings.settings,i=n.target?e.chart.component(n.target.component):null,r=n.target&&n.target.selector?e.chart.findShapes(n.target.selector):[],o=n.target&&n.target.fillSelector?e.chart.findShapes(n.target.fillSelector):[];if(r.length>0){var s=Bs(r);if(t.size=s[e.state.direction===Mp?"height":"width"],t.scale=Hr(e.chart.scale(n.scale),t.size),t.targetRect=s,o.length>0){var a=Bs(o);t.targetFillRect=a}}else i&&i.rect&&(t.targetRect={x:i.rect.x-e.state.rect.x,y:i.rect.y-e.state.rect.y,width:i.rect.width,height:i.rect.height});return t}function $s(e){e.renderer.render(_s(e))}function Us(e){return e.rc.ranges()}function Gs(e,t){var n={x:e.direction?t.min+e.rect.x:e.rect.x,y:e.direction?e.rect.y:t.min+e.rect.y,width:e.direction?t.max-t.min:e.rect.width+e.rect.x,height:e.direction?e.rect.height+e.rect.y:t.max-t.min};return e.chart.shapesAt(n,e.settings.brush)}function Ws(e,t){e.chart.brushFromShapes(t,e.settings.brush)}function Xs(e){var t=e.ranges.map(function(e){return{min:e.min,max:e.max}});if(-1!==e.active.idx)if("modify"===e.active.mode)t[e.active.idx].min=Math.min(e.start,e.current),t[e.active.idx].max=Math.max(e.start,e.current);else{var n=ws(e);t[e.active.idx].min=e.active.start+n,t[e.active.idx].max=e.active.end+n}else t.push({min:Math.min(e.start,e.current),max:Math.max(e.start,e.current)});e.rc.set(t);var i=[];t.forEach(function(t){i.push.apply(i,su(Gs(e,t)))}),Ws(e,i)}function Ys(e,t,n){var i=Math.min.apply(Math,su(n)),r=Math.max.apply(Math,su(n)),o={x:e.direction?i+e.rect.x:e.rect.x,y:e.direction?e.rect.y:i+e.rect.y,width:e.direction?r-i:e.rect.width+e.rect.x,height:e.direction?e.rect.height+e.rect.y:r-i},s=e.chart.shapesAt(o,e.settings.brush);if(0===s.length)return"-";var a=s.reduce(function(n,r){return t===i?n.collider[e.cssCoord.coord]<=r.collider[e.cssCoord.coord]?n:r:n.collider[e.cssCoord.coord]+n.collider[e.cssCoord.area]>=r.collider[e.cssCoord.coord]+r.collider[e.cssCoord.area]?n:r}),l=e.settings.brush.components.reduce(function(e,t){return e.key===a.key?e:t}).data||["self"];return"function"==typeof e.settings.bubbles.label?e.settings.bubbles.label(a.data):a.data[l[0]].label}function Ks(e){var t=e.brush;if(!t||!t.isActive())return[];var n=e.scale.data(),i=(n?n.fields||[]:[]).map(function(e){return e.id()}),r=t.brushes().filter(function(e){return"range"===e.type&&-1!==i.indexOf(e.id)})[0];return r?r.brush.ranges():[]}function Qs(e){var t="vertical"===e.direction,n=e.rect[t?"height":"width"],i=e.rect[t?"width":"height"];return Ks(e).map(function(r){var o=e.scale(r.min)*n,s=e.scale(r.max)*n,a=Math.min(o,s),l=Math.abs(o-s);return{type:"rect",fill:e.fill,opacity:e.opacity,x:t?0:a,width:t?i:l,y:t?a:0,height:t?l:i}})}function Zs(e){e.renderer.render(Qs(e))}function Js(e){e.renderer.render(Qs(e))}function ea(e){e.renderer.render(Qs(e))}function ta(e,t,n,i){function r(){Zs(e)}function o(){Js(e)}function s(){ea(e)}e.brush=t,t&&(t.on("start",r),t.on("update",o),t.on("end",s),e.start=r,e.update=o,e.end=s,e.brush=t,e.scale=n,e.renderer=i)}function na(e){e.brush&&(e.brush.removeListener("start",e.start),e.brush.removeListener("update",e.update),e.brush.removeListener("end",e.end)),e.start=void 0,e.update=void 0,e.end=void 0,e.brush=void 0,e.scale=void 0,e.renderer=void 0}function ia(e,t){var n=t.center.x,i=t.center.y;return{x:n-e.left,y:i-e.top}}function ra(e,t,n){return h(e,t.points[0])<Math.pow(n.settings.snapIndicator.threshold,2)}function oa(e,t){null==e.path.d?e.path.d="M"+t.x+" "+t.y+" ":e.path.d+="L"+t.x+" "+t.y+" ",e.points.push(t)}function sa(e,t){var n=[e.startPoint,e.path,e.snapIndicator].filter(function(e){return e.visible});t.render(n)}function aa(e){var t=e.state,n=e.start,i=void 0===n?null:n,r=e.end,o=void 0===r?null:r;null!==i&&(t.snapIndicator.x1=i.x,t.snapIndicator.y1=i.y),null!==o&&(t.snapIndicator.x2=o.x,t.snapIndicator.y2=o.y)}function la(e,t){e.snapIndicator.visible=t}function ca(e,t){e.startPoint.cx=t.x,e.startPoint.cy=t.y}function ua(e,t){var n=e.element.getBoundingClientRect();return{x:t.left-n.left,y:t.top-n.top}}function ha(e,t){if(e.active){var n=e.points[e.points.length-2],i=e.points[e.points.length-1];e.lineBrushShape.x1=n.x+e.componentDelta.x,e.lineBrushShape.y1=n.y+e.componentDelta.y,e.lineBrushShape.x2=i.x+e.componentDelta.x,e.lineBrushShape.y2=i.y+e.componentDelta.y;var r=t.shapesAt(e.lineBrushShape,{components:e.brushConfig});t.brushFromShapes(r,{components:e.brushConfig})}}function da(e,t){if(e.active){var n=e.componentDelta.x,i=e.componentDelta.y,r=e.points.map(function(e){return{x:e.x+n,y:e.y+i}}),o=t.shapesAt({vertices:r},{components:e.brushConfig});t.brushFromShapes(o,{components:e.brushConfig})}}function pa(e){return{visible:!0,type:"path",d:null,fill:e.fill,stroke:e.stroke,strokeWidth:e.strokeWidth,opacity:e.opacity,strokeDasharray:e.strokeDasharray,collider:{type:null}}}function fa(e){return{visible:!1,type:"line",x1:0,y1:0,x2:0,y2:0,strokeDasharray:e.strokeDasharray,stroke:e.stroke,strokeWidth:e.strokeWidth,opacity:e.opacity,collider:{type:null}}}function ma(e){return{visible:!0,type:"circle",cx:0,cy:0,r:e.r,fill:e.fill,opacity:e.opacity,stroke:e.stroke,strokeWidth:e.strokeWidth,collider:{type:null}}}function ga(e){return e.settings.brush.components.map(function(e){return{key:e.key,contexts:e.contexts||["lassoBrush"],data:e.data||[""],action:e.action||"add"}})}function va(e,t){e.brushConfig.forEach(function(e){e.contexts.forEach(function(e){t.brush(e).end()})})}function ya(e,t){return{node:e,data:e.data,scale:t.scale,formatter:t.formatter,dataset:t.dataset}}function ba(e,t,n){var i={type:"text",text:t,maxWidth:n.rotate?e.height:e.width,x:0,y:e.y,dx:0,dy:0,fill:n.fill,anchor:n.rotate?"end":"start",baseline:"alphabetical",fontSize:n.fontSize+"px",fontFamily:n.fontFamily},r=n.textMetrics;if(e.width<n.fontSize||e.height<r.height)return!1;if(n.rotate){var o=Math.max(0,e.width-r.height/(.8*Lp)),s=Math.max(0,e.height-r.width);i.x=e.x+r.height/Lp+n.align*o,i.y=e.y+n.justify*s,i.transform="rotate(-90, "+(i.x+i.dx)+", "+(i.y+i.dy)+")"}else{var a=Math.max(0,e.width-r.width),l=Math.max(0,e.height-r.height/(.8*Lp));i.x=e.x+n.align*a,i.y=e.y+r.height/Lp+n.justify*l}return i}function xa(e,t){var n=Math.max(0,Math.min(e.y,t.height)),i=Math.max(0,Math.min(e.y+e.height,t.height)),r=Math.max(0,Math.min(e.x,t.width)),o=Math.max(0,Math.min(e.x+e.width,t.width));e.x=r,e.width=o-r,e.y=n,e.height=i-n}function qa(e,t){e.x+=t,e.width-=2*t,e.y+=t,e.height-=2*t}function Ca(e){var t=e.bar,n=e.view,i=e.direction,r=e.position,o=e.padding,s=void 0===o?kp:o,a={};if(Yc(a,t),r&&"inside"!==r)if("up"===i||"down"===i){var l=Math.max(0,Math.min(t.y,n.height)),c=Math.max(0,Math.min(t.y+t.height,n.height));"outside"===r&&"up"===i||"opposite"===r&&"down"===i?(a.y=0,a.height=l):("outside"===r&&"down"===i||"opposite"===r&&"up"===i)&&(a.y=c,a.height=n.height-c)}else{var u=Math.max(0,Math.min(t.x,n.width)),h=Math.max(0,Math.min(t.x+t.width,n.width));"outside"===r&&"left"===i||"opposite"===r&&"right"===i?(a.x=0,a.width=u):("outside"===r&&"right"===i||"opposite"===r&&"left"===i)&&(a.x=h,a.width=n.width-h)}else;return xa(a,n),qa(a,s),a}function Sa(e){var t=e.direction,n=e.fitsHorizontally,i=e.lblStngs,r=e.measured,o=e.node,s=e.orientation,a=e.placementSettings,l=e.rect,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ca,u=void 0,h=void 0,d=void 0,p=void 0,f=void 0,m=[];for(f=0;f<a.length;f++){if(d=a[f],p=c({bar:o.localBounds,view:l,direction:t,position:d.position}),m.push(p),u=!f||p.height>u.height?p:u,"v"===s&&(n&&p.height>r.height*Lp||!n&&p.height>r.width)){h=p;break}if("h"===s&&p.height>r.height&&p.width>r.width){h=p;break}}return"v"===s&&!n&&!h&&u.height>2*i.fontSize?(h=u,f=m.indexOf(h)):"h"===s&&!h&&u.height>2*i.fontSize&&(h=u,f=m.indexOf(h)),d=a[f],{bounds:h,placement:d}}function wa(e){for(var t=e.chart,n=e.nodes,i=e.placementSettings,r=e.labelSettings,o=e.measurements,s=e.texts,a=e.directions,l=e.rect,c=e.fitsHorizontally,u=e.collectiveOrientation,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Sa,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ba,p=[],f=void 0,m=void 0,g=void 0,v=void 0,y=void 0,b=void 0,x=void 0,q=void 0,C=void 0,S=void 0,w=void 0,_=void 0,D=void 0,M=void 0,A=0,E=n.length;A<E;A++){y=null,D=ya(m=n[A],t),S=s[A],M="left"===(q=a[A])||"right"===q?"h":"v";for(var I=0;I<S.length;I++)if(g=S[I]){var T=h({direction:q,fitsHorizontally:c,lblStngs:C=r[I],measured:x=o[A][I],node:m,orientation:M,placements:_=C.placements,placementSettings:i[I],rect:l});y=T.bounds,w=T.placement,y&&w&&(v=w.justify,b="function"==typeof w.fill?w.fill(D,A):w.fill,"up"===q&&(v=1-v),"opposite"===w.position&&(v=1-v),(f=d(y,g,{fill:b,justify:"h"===M?w.align:v,align:"h"===M?v:w.align,fontSize:C.fontSize,fontFamily:C.fontFamily,textMetrics:x,rotate:!("h"===u||c)}))&&p.push(f))}}return p}function _a(e){for(var t=e.nodes,n=e.rect,i=e.chart,r=e.labelSettings,o=e.settings,s=e.renderer,a=[],l=[],c={},u=[],h=!0,d=!1,p=void 0,f=void 0,m=void 0,g=void 0,v=void 0,y=void 0,b=0,x=t.length;b<x;b++)if(p=t[b],m=p.localBounds,Gd.testRectRect(m,n)){l[b]=[],a[b]=[];for(var q=ya(p,i),C=0;C<r.length;C++)(f="function"==typeof(v=r[C]).label?v.label(q,b):"")&&(y="function"==typeof o.direction?o.direction(q,b):o.direction||"up",d=d||"left"===y||"right"===y,c.fontFamily=v.fontFamily,c.fontSize=v.fontSize+"px",c.text=f,g=s.measureText(c),a[b][C]=g,l[b][C]=f,u[b]=y,h=h&&g.width<=m.width-2*kp)}return{measurements:a,texts:l,directions:u,fitsHorizontally:h,hasHorizontalDirection:d}}function Da(e,t){var n=e.chart,i=e.source,r=e.rect,o=e.renderer,s=e.style;if(!n.component(i.component))return[];var a=n.findShapes(i.selector).filter(function(e){return e.key===i.component});return t({chart:n,settings:i.strategy.settings,nodes:a,rect:{x:0,y:0,width:r.width,height:r.height},renderer:o,style:s})}function Ma(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=0;return r=n-t,r*=Math.min(1,Math.max(i,0))}function Aa(e){if("object"===(void 0===e?"undefined":Zc(e))&&null!==e){var t={};return t.top=parseFloat(e.top||0),t.right=parseFloat((void 0===e.right||isNaN(e.right)?t.top:e.right)||0),t.bottom=parseFloat((void 0===e.bottom||isNaN(e.bottom)?t.top:e.bottom)||0),t.left=parseFloat((void 0===e.left||isNaN(e.left)?t.right:e.left)||0),t.width=t.left+t.right,t.height=t.top+t.bottom,t}if("number"==typeof e)return{top:e,right:e,bottom:e,left:e,width:2*e,height:2*e};if("string"==typeof e){var n=e.replace(/px/gi,"").split(" ");return Aa({top:n[0],right:n[1],bottom:n[2],left:n[3]})}return{top:0,right:0,bottom:0,left:0,width:0,height:0}}function Ea(e){var t=e.x,n=e.y,i=e.maxInnerWidth,r=void 0===i?0:i,o=e.maxInnerHeight,s=void 0===o?0:o,a=e.color,l=e.label,c=e.labelBounds,u=e.labelMeasure,h=e.anchor,d=void 0===h?"left":h,p=e.renderingArea,f=void 0===p?{x:0,y:0,width:0,height:0}:p,m=e.margin,g=e.symbolPadding,v=void 0===g?0:g,y=e.shape,b=e.shapeSize,x=void 0===b?0:b,q=e.maxShapeSize,C=void 0===q?x:q,S=e.data,w=e.justify,_=void 0===w?0:w,D=e.align,M=void 0===D?0:D,A=e.isStacked,E=void 0!==A&&A,I=e.isHorizontal,T=void 0===I||I;m=Aa(m);var L="left"===d,k=Yc({},l,{type:"text",data:S,collider:{type:null}}),O=r,P=s,N=s,R=C;E&&(O=c.width+x+v,P=Math.max(c.height,x),T?R=x:N=Math.max(c.height,x));var F=O+m.left+m.right,j=P+m.top+m.bottom,V={type:"container",x:L?t:f.width-t-F,y:n,width:F,height:j,innerWidth:O,innerHeight:P,data:S,children:[]};if(V.collider={type:"rect",x:L||!T?t:V.x,y:n,width:E&&!T?r+m.left+m.right:V.width,height:E&&T?s+m.top+m.bottom:V.height},y){var H=x/2,B=L?V.x+m.left+H:V.x+F-m.right-H,z=V.y+H+m.top,$=Ma(B,x,R,L?M:1-M);B+=L?$:-$,z+=Ma(z,x,N,_);var U=void 0;U="object"!==(void 0===y?"undefined":Zc(y))?{type:y}:y;var G=Kr(Yc({size:x,fill:a,stroke:a},U,{x:B,y:z,data:S,collider:{type:null}}));V.children.push(G)}return k.x=L?V.x+m.left+R+v:V.x+F-m.right-R-v,k.y=V.y+m.top+u.height,k.y+=Ma(k.y,c.height,N||P,_),V.children.push(k),V}function Ia(e){var t=e.x,n=e.y,i=e.width,r=e.height,o=e.direction,s=e.action,a=e.rect,l=e.symbol,c=Yc({type:"rect",x:t,y:n,width:i,height:r,fill:"transparent",stroke:"grey",strokeWidth:1,opacity:1},a),u=Wr({x:t+i/2,y:n+r/2,size:Math.min(i,r)*Math.max(0,Math.min(l.size||.5,1)),direction:o});u.fill=l.fill,u.stroke=l.stroke,u.strokeWidth=l.strokeWidth;var h={type:"container",x:t,y:n,width:i,height:r};return h.collider=Yc({},h,{type:"rect"}),h.children=[c,u],h.desc={action:s},h.tag="scroll-button",h}function Ta(e){var t=e.HORIZONTAL,n=e.rect,i=e.state,r=e.buttonRectMinus,o=e.buttonRectPlus,s=e.buttonSymbolMinus,a=e.buttonSymbolPlus,l=e.anchor,c=[],u=i.buttonDefs.width,h=i.buttonDefs.height,d=i.buttonDefs.buttonSpacing/2,p="left"===l;if(t){var f=(i.maxOuterHeight||n.height)/2,m=p?n.width-i.buttonDefs.spacing-u:i.buttonDefs.spacing;c.push(Ia({x:m,y:f+d,width:u,height:h,action:"-",direction:p?"left":"right",rect:r,symbol:s})),c.push(Ia({x:m,y:f-h-d,width:u,height:h,action:"+",direction:p?"right":"left",rect:o,symbol:a}))}else{var g=(i.maxOuterWidth||n.width)/2,v=n.height-i.buttonDefs.spacing-h;c.push(Ia({x:p?g+d:n.width-g-d-u,y:v,width:u,height:h,action:"-",direction:"up",rect:r,symbol:s})),c.push(Ia({x:p?g-d-u:n.width-g+d,y:v,width:u,height:h,action:"+",direction:"down",rect:o,symbol:a}))}return c}function La(e,t){var n=e.defs,i=e.titleDef,r=0,o=0,s=0,a=0,l=0,c=0,u=0,h=0,d=0,p=0,f=0;i.show&&(r=h=i.margin.left+i.margin.right+i.labelBounds.width,o=d=i.margin.top+i.margin.bottom+i.labelBounds.height),e.buttonDefs.show&&(p=(t.isHorizontal?e.buttonDefs.spacing:0)+e.buttonDefs.buttonSpacing+2*e.buttonDefs.width,f=(t.isHorizontal?0:e.buttonDefs.spacing)+e.buttonDefs.buttonSpacing+2*e.buttonDefs.height,r=t.isHorizontal?r:Math.max(r,p),o=t.isHorizontal?Math.max(o,f):o),n.forEach(function(e){u=Math.max(u,e.shapeSize||0)});for(var m=0,g=n.length;m<g;m++){var v=n[m];if(v.show){var y=v.labelBounds.width+u+v.symbolPadding,b=Math.max(v.labelBounds.height,u),x=v.margin.left+v.margin.right+y,q=v.margin.top+v.margin.bottom+b;l=Math.max(l,y),c=Math.max(c,b),s=Math.max(s,x),a=Math.max(a,q),r=Math.max(r,x+(t.isHorizontal?h+p:0)),o=Math.max(o,q+(t.isHorizontal?0:d+f))}}return{maxOuterWidth:r,maxOuterHeight:o,maxItemOuterWidth:s,maxItemOuterHeight:a,maxInnerWidth:l,maxInnerHeight:c,maxShapeSize:u}}function ka(e){var t=cs(e.buttons.rect,{},0,[]),n=cs(e.buttons.symbol,{},0,[]),i=cs(e.buttons["rect:disabled"],{},0,[]),r=cs(e.buttons["symbol:disabled"],{},0,[]);return Yc({},e.buttons,{rect:t,symbol:n,"rect:disabled":i,"symbol:disabled":r})}function Oa(e){var t=e.settings,n=e.local,i=e.renderer,r=void 0;r=t.title.text?t.title.text:n.sourceTitle;var o={show:t.title.show,margin:Aa(t.title.margin),label:{text:r,fontSize:t.title.fontSize,fontFamily:t.title.fontFamily,fill:t.title.fill,wordBreak:t.title.wordBreak,hyphens:t.title.hyphens,maxLines:t.title.maxLines,lineHeight:t.title.lineHeight,maxWidth:t.title.maxWidth,anchor:"left"===n.anchor?"start":"end"}};return o.labelMeasure=i.measureText(o.label),o.labelBounds=i.textBounds(o.label),o}function Pa(e){for(var t=e.scale,n=e.settings,i=e.renderer,r=e.local,o=[],s=t.domain(),a=t.data(),l=0;l<Math.min(1500,s.length);l++){var c=s[l],u=t.label?t.label(c):"",h=t.datum?t.datum(c):{};r.isThreshold&&(h={value:[c,s[l+1]],source:{field:r.sourceField.id()}},!t.label&&r.formatter&&(u=r.formatter(c)));var d=cs(n.item,h,l,a,{formatter:r.formatter});!1!==d.show&&("object"===Zc(n.item.shape)&&(d.shape=cs(n.item.shape,h,l,a),d.shapeSize=d.shape.size),d.margin=Aa(d.margin),d.label=Yc({},d.label),d.label.anchor="left"===r.anchor?"start":"end",d.label.text=u||c,d.labelMeasure=i.measureText(d.label),d.shapeSize=d.shapeSize||d.labelMeasure.height,d.labelBounds=i.textBounds(d.label),d.color=t(c),d.data=h,o.push(d))}return o}function Na(e){var t=e.settings,n=e.chart,i=e.rect,r=e.local,o=e.state,s=[],a={},l={},c=0,u=0,h=r.isHorizontal?i.width-o.buttonDefs.width-o.buttonDefs.spacing:i.height-o.buttonDefs.height-o.buttonDefs.spacing;o.titleDef.show&&(l=a=Ea(Yc(o.titleDef,{x:a.width||c,y:a.height||u,anchor:r.anchor,renderingArea:i,isStacked:!0,isHorizontal:r.isHorizontal,maxInnerWidth:o.titleDef.labelBounds.width,maxInnerHeight:o.titleDef.labelBounds.height})),s.push(a),h-=r.isHorizontal?a.width:a.height);var d=!1;o.pageSize=0;for(var p=0,f=0,m=h,g=0;g<r.size;g++){for(var v=o.index+o.pageSize;v<o.defs.length;v++){var y=o.defs[v];if(c+=a.width||0,u+=a.height||0,y.x=r.isHorizontal?c:p,y.y=r.isHorizontal?f:u,y.maxInnerWidth=o.maxInnerWidth,y.maxInnerHeight=o.maxInnerHeight,a=Ea(Yc(y,{anchor:r.anchor,renderingArea:i,maxShapeSize:o.maxShapeSize,isStacked:r.isStacked,isHorizontal:r.isHorizontal})),(h-=r.isHorizontal?a.width:a.height)<0){r.size<=1&&(d=!0);break}s.push(a),o.pageSize++}if(o.index+o.pageSize>=o.defs.length&&o.pageSize<o.defs.length){d=!0;break}if(r.isHorizontal?f+=o.maxItemOuterHeight:p+=o.maxItemOuterWidth,h=m,a=l,u=0,c=0,o.index+o.pageSize<o.defs.length){if(p+o.maxItemOuterWidth>i.width){d=!0;break}if(f+o.maxItemOuterHeight>i.height){d=!0;break}}}return t.buttons.show&&!r.hasKey&&n.logger().warn("legend-cat requires a key for the index to be preserved when paging. Disable buttons or add a key to the item."),o.pageMax=Math.max(0,o.defs.length-o.pageSize),o.pageMin=0,d&&t.buttons.show&&s.push.apply(s,su(Ta({HORIZONTAL:r.isHorizontal,rect:i,state:o,buttonRectMinus:o.index<=0?o.buttonDefs["rect:disabled"]:o.buttonDefs.rect,buttonRectPlus:o.index>=o.pageMax?o.buttonDefs["rect:disabled"]:o.buttonDefs.rect,buttonSymbolMinus:o.index<=0?o.buttonDefs["symbol:disabled"]:o.buttonDefs.symbol,buttonSymbolPlus:o.index>=o.pageMax?o.buttonDefs["symbol:disabled"]:o.buttonDefs.symbol,anchor:r.anchor}))),s}function Ra(e,t,n){if(e.size<=1)return 1;if(e.isHorizontal){var i=t.maxItemOuterWidth*t.defs.length,r=n.width;return Math.min(e.size,Math.ceil(i/r))*t.maxItemOuterHeight}var o=t.maxItemOuterHeight*t.defs.length,s=n.height;return Math.min(e.size,Math.ceil(o/s))*t.maxItemOuterWidth}function Fa(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=e.state,i=isNaN(t)?3:Math.round(t);n.index=Math.max(n.pageMin,Math.min(n.pageMax,n.index+i));var r=Na({chart:e.chart,settings:e.settings.settings,scale:e.scale,rect:e.rect,local:e.local,state:e.state});e.update(r)}function ja(e,t){var n=0,i={type:e.state.isVertical?"justify":"align",coord:e.state.isVertical?"y":"x",pos:e.state.isVertical?"height":"width",fn:e.state.isVertical?"requiredHeight":"requiredWidth"};n=e.state.rect[i.pos]-e.state.legend.length()-e.state.title[i.fn](),n*=Math.min(1,Math.max(e.stgns[i.type],0)),t[i.coord]+=n}function Va(e){var t=e.state.legend.fillScale,n=e.state.legend.majorScale;return t.domain().map(function(e){return{type:"stop",color:t(e),offset:Math.min(1,Math.max(0,n.norm(e)))}}).sort(function(e,t){return e.offset-t.offset})}function Ha(e){var t=e.state,n=e.stgns,i="left"===t.ticks.anchor,r="top"===t.ticks.anchor,o=t.rect.x,s=t.rect.y,a="start";"left"===t.title.anchor?(o+=t.title.requiredWidth()-n.title.padding,s+=t.title.textMetrics.height,s+=r?t.rect.height-t.title.textBounds.height:0,a="end"):"right"===t.title.anchor?(o+=t.legend.length(),o+=n.title.padding,s+=t.title.textMetrics.height,s+=r?t.rect.height-t.title.textBounds.height:0):"top"===t.title.anchor&&(o+=i?t.rect.width:0,s+=t.title.textMetrics.height,a=i?"end":"start");var l={type:"text",x:o,y:Math.min(s,t.rect.y+t.rect.height),text:n.title.text,fill:n.title.fill,fontSize:n.title.fontSize,fontFamily:n.title.fontFamily,maxWidth:n.title.maxLengthPx,maxLines:n.title.maxLines,wordBreak:n.title.wordBreak,hyphens:n.title.hyphens,lineHeight:n.title.lineHeight,anchor:a};return ja(e,l),l}function Ba(e,t){var n=e.state,i=e.stgns,r=n.rect,o=r.x,s=r.y,a=n.isVertical?i.size:n.legend.length(),l=n.isVertical?n.legend.length():i.size;"left"===n.ticks.anchor?o+=n.rect.width-i.size:"top"===n.ticks.anchor&&(s+=n.rect.height-i.size),"top"===n.title.anchor?s+=n.title.requiredHeight():"left"===n.title.anchor&&(o+=n.title.requiredWidth());var c={type:"rect",x:o,y:s,width:a,height:l,fill:{type:"gradient",stops:t,degree:n.isVertical?90:180}};return ja(e,c),c}function za(e,t){var n=e.state,i=e.stgns,r="start",o={type:"rect",x:t.x,y:t.y,width:n.isVertical?0:t.width,height:n.isVertical?t.height:0,fill:"transparent"},s=n.ticks.values.map(function(s){var a=0,l=0,c=0;return n.isVertical?(l=t.y+t.height*s.pos,c=1===s.pos?-s.textMetrics.height/5:s.textMetrics.height):a=t.x+t.width*s.pos,"right"===n.ticks.anchor?(a=t.x+i.size+i.tick.padding,o.x=t.x+t.width):"left"===n.ticks.anchor?(a=t.x-i.tick.padding,r="end"):"top"===n.ticks.anchor?(l=t.y-i.tick.padding,c-=.25*s.textMetrics.height,r=0===s.pos?"start":"end"):"bottom"===n.ticks.anchor&&(l=t.y+t.height+i.tick.padding,c=.8*s.textMetrics.height,r=0===s.pos?"start":"end",o.y=t.y+t.height),{type:"text",x:a,y:l,dx:0,dy:c,text:s.label,fontSize:i.tick.fontSize,fontFamily:i.tick.fontFamily,fill:i.tick.fill,maxWidth:n.isVertical?i.tick.maxLengthPx:Math.min(i.tick.maxLengthPx,n.legend.length()/2),anchor:r,textBoundsFn:e.renderer.textBounds}});return{type:"container",id:"legend-seq-ticks",children:[].concat(su(s),[o])}}function $a(e,t,n){var i=n[e];return"object"===(void 0===i?"undefined":Zc(i))?-1!==i.valid.indexOf(t)?t:i.default:n.default}function Ua(e){return $a(e.dock,e.settings.tick.anchor,{left:{valid:["left","right"],default:"left"},right:{valid:["left","right"],default:"right"},top:{valid:["top","bottom"],default:"top"},bottom:{valid:["top","bottom"],default:"bottom"},default:"right"})}function Ga(e){var t={left:{valid:["top"],default:"top"},right:{valid:["top"],default:"top"},top:{valid:["left","right"],default:"left"},bottom:{valid:["left","right"],default:"left"},default:"top"};return $a(e.dock,e.settings.title.anchor,t)}function Wa(e,t){var n={x:0,y:0,width:0,height:0},i=e.stgns.padding;return n.x=i.left,n.y=i.top,n.width=t.width-i.left-i.right,n.height=t.height-i.top-i.bottom,n}function Xa(e,t){var n=t.domain(),i=n,r=e.stgns.tick.label;return!r&&e.formatter?r=e.formatter:!r&&t.data().fields&&(r=t.data().fields[0].formatter()),"function"==typeof r&&(i=n.map(r).map(String)),n.map(function(n,r){var o=i[r];return{value:n,label:o,pos:t.norm(parseFloat(n,10)),textMetrics:e.renderer.measureText({text:o,fontSize:e.stgns.tick.fontSize,fontFamily:e.stgns.tick.fontFamily})}})}function Ya(e){var t="top"!==e.settings.dock&&"bottom"!==e.settings.dock,n=e.stgns.title,i=e.renderer.measureText({text:n.text,fontSize:n.fontSize,fontFamily:n.fontFamily}),r=e.renderer.textBounds({text:n.text,fontSize:n.fontSize,fontFamily:n.fontFamily,maxLines:n.maxLines,maxWidth:n.maxLengthPx,wordBreak:n.wordBreak,hyphens:n.hyphens,lineHeight:n.lineHeight}),o=e.chart.scale(e.stgns.fill),s=e.chart.scale(e.stgns.major),a=Xa(e,s),l=Ua(e.settings),c={isVertical:t,nodes:[],title:{anchor:Ga(e.settings),textMetrics:i,textBounds:r,requiredWidth:function(){if(!n.show)return 0;var e=r.width,i=n.maxLengthPx;return t||(e+=n.padding,i+=n.padding),Math.min(e,i,c.rect.width)},requiredHeight:function(){if(!n.show)return 0;var e=r.height;return t&&(e+=n.padding),Math.min(e,c.rect.height)}},ticks:{values:a,anchor:l,length:Math.min(Math.max.apply(Math,su(a.map(function(e){return e.textMetrics.width}))),e.stgns.tick.maxLengthPx),requiredHeight:function(){return"top"===l?Math.max.apply(Math,su(c.ticks.values.map(function(e){return e.textMetrics.height})))+e.stgns.tick.padding:0},height:Math.max.apply(Math,su(a.map(function(e){return e.textMetrics.height})))},legend:{fillScale:o,majorScale:s,length:function(){var n=t?"height":"width",i=t?"requiredHeight":"requiredWidth",r=Math.min(c.rect[n],c.rect[n]*e.stgns.length)-c.title[i]();return Math.max(0,Math.min(r,e.stgns.maxLengthPx))}}};return c}function Ka(e){var t=e[0],n=e[e.length-1];t.x===n.x&&t.y===n.y||e.push(t)}function Qa(e){for(var t=0;t<e.length-1;t++){var n=e[t],i=e[t+1];n.x===i.x&&n.y===i.y&&(e.splice(t,1),t--)}}function Za(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(Wp,[null].concat(t)))}function Ja(e,t){return Xp.get(e)(t)}function el(e){for(var t=void 0,n=[];null!==(t=Kp.exec(e));){var i=t[2].trim(),r=-1===i.indexOf(",")?i.split(" "):i.split(",");n.push({cmd:t[1],args:r.filter(function(e){return e.trim().length>0}).map(function(e){return Number(e)})})}return n}function tl(e,t){var n=t.args[0]*(Math.PI/180);if(t.args.length>2){var i=t.args[1],r=t.args[2];e.translate(i,r),e.rotate(n),e.translate(-i,-r)}else 1===t.args.length&&e.rotate(n)}function nl(e,t){var n=t.args[0],i=isNaN(t.args[1])?t.args[0]:t.args[1];e.scale(n,i)}function il(e,t){var n=t.args[0],i=isNaN(t.args[1])?0:t.args[1];e.translate(n,i)}function rl(e,t){t.args.length>=6&&e.transform.apply(e,su(t.args))}function ol(e,t){for(var n=el(e),i=void 0,r=0,o=n.length;r<o;r++)"rotate"===(i=n[r]).cmd?tl(t,i):"scale"===i.cmd?nl(t,i):"matrix"===i.cmd?rl(t,i):"translate"===i.cmd&&il(t,i)}function sl(e,t){if(!t||!t.length||!e||"function"!=typeof Zp[e.type])return[];switch(e.type){case"type":return Zp[e.type](e.value,t);case"attr":return Zp[e.type](e.attribute,e.operator,e.attributeValue,t);case"universal":return Zp[e.type](t);case"tag":return Zp[e.type](e.value,t);default:return[]}}function al(e){var t=[],n=void 0,i=void 0,r=void 0,o=void 0;return e.split(/\s*,\s*/).forEach(function(e){e=e.trim(),n=[];for(;e&&(o=!1,(r=e.match(/^\s*([>+~]|\s)\s*/))&&(o=!0,n.push({type:" ",value:r[0]}),e=e.slice(r[0].length)),Object.keys(Qp).forEach(function(t){(r=e.match(Qp[t]))&&(o=!0,e=e.slice(r[0].length),i={type:t,value:r[0]},"attr"===t&&(r=r[0].match(/\[(\w[\w\._-]+)?(?:([!]?=)['\"]([\w\s#_-]*)['\"])?\]/),i.attribute=r[1],i.operator=r[2],i.attributeValue=r[3]),n.push(i))}),n&&n.length&&t.indexOf(n)<0&&t.push(n),o););}),t}function ll(e,t){var n=e.collider();if(n&&n.fn){for(var i=e.modelViewMatrix,r=n.type,o=n.fn.points(),s=0,a=(o=i?i.transformPoints(o):o).length;s<a;s++)o[s].x/=t,o[s].y/=t;if("rect"===r||"bounds"===r){var l=q(o);return l.type="rect",l}if("circle"===r){var c=C(o,n.fn.r);return c.type="circle",c}if("line"===r){var u=S(o);return u.type="line",u}if("polygon"===r)return{type:"path",d:B(o)}}return null}function cl(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(ef,[null].concat(t)))}function ul(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(tf,[null].concat(t)))}function hl(e,t){var n=e.parent;if(n&&"stage"!==n.type){t.parent=ul(n);var i=n.parent;i&&"stage"!==i.type&&hl(i,t.parent)}}function dl(e,t){for(var n=0,i=t.length;n<i;n++)t[n].input=e}function pl(e,t,n){for(var i=e.descendants.length-1;i>=0;i--){var r=e.descendants[i],o=r._collider;if(o&&o.fn[t](n)){var s=ul(r);return hl(r,s),s}}return null}function fl(e,t,n){var i=e._collider.fn,r=n;if(Array.isArray(n.vertices)&&(r=Za(n)),i[t](r)){var o=ul(e);return hl(e,o),o}return null}function ml(e,t,n){var i={};if(e.modelViewMatrix)if(Array.isArray(n))i=e.inverseModelViewMatrix.transformPoints(n);else if(isNaN(n.r))Array.isArray(n.vertices)?i.vertices=e.inverseModelViewMatrix.transformPoints(n.vertices):i=e.inverseModelViewMatrix.transformPoint(n);else{var r={x:n.cx,y:n.cy},o=e.inverseModelViewMatrix.transformPoint(r);i.cx=o.x,i.cy=o.y,i.r=n.r}else i=n;if(Array.isArray(i.vertices)&&(i=Za(i)),e._collider.fn[t](i)){var s=ul(e);return hl(e,s),s}return null}function gl(e,t,n){var i=e._collider;return null===i?null:"frontChild"===i.type?pl(e,t,n):"bounds"===i.type?fl(e,t,n):ml(e,t,n)}function vl(e,t,n,i){for(var r=e.length,o=0;o<r;o++){var s=e[o],a=gl(s,t,i);a&&n.push(a),!s.children||a||s._collider||vl(s.children,t,n,i)}}function yl(e,t,n){for(var i=e.length,r=0;r<i;r++){var o=e[r];if(null!==gl(o,t,n))return!0;if(o.children&&!o._collider)return yl(o.children,t,n)}return!1}function bl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e||{},i=n.x,r=n.y,o=n.width,s=n.height,a=n.x1,c=n.x2,u=n.y1,h=n.y2,d=n.cx,p=n.cy,f=n.r,m=n.vertices,g={},v=function(e){return"number"==typeof e&&!isNaN(e)};return v(d)&&v(p)&&v(f)?(g.cx=d*t,g.cy=p*t,g.r=f,["intersectsCircle",g]):v(a)&&v(c)&&v(u)&&v(h)?(g=y(e).map(function(e){return l(e,t)}),["intersectsLine",g]):v(i)&&v(r)&&v(o)&&v(s)?(g=b(e).map(function(e){return l(e,t)}),["intersectsRect",g]):v(i)&&v(r)?(g=l(e,t),["containsPoint",g]):Array.isArray(m)?(g.vertices=m.map(function(e){return l(e,t)}),["intersectsPolygon",g]):[]}function xl(e,t){var n=bl(t,e.dpi),i=ou(n,2),r=i[0],o=i[1],s=[];return r&&(vl([e],r,s,o),dl(t,s)),s}function ql(e,t){var n=bl(t,e.dpi),i=ou(n,2);return yl([e],i[0],i[1])}function Cl(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0!==t.bounds){var i=t.bounds(n),r=ou(i,3),o=r[0],s=r[2],a=o.x,l=o.y,c=s.x,u=s.y,h=isNaN(e._boundingRect.width)?c:Math.max(c,e._boundingRect.width+e._boundingRect.x),d=isNaN(e._boundingRect.height)?u:Math.max(u,e._boundingRect.height+e._boundingRect.y);e._boundingRect.x=isNaN(e._boundingRect.x)?a:Math.min(a,e._boundingRect.x),e._boundingRect.y=isNaN(e._boundingRect.y)?l:Math.min(l,e._boundingRect.y),e._boundingRect.width=h-e._boundingRect.x,e._boundingRect.height=d-e._boundingRect.y}}function Sl(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(uf,[null].concat(t)))}function wl(e){if("string"!=typeof e)return[];for(var t=e.match(/[a-z][^a-z]*/gi),n=void 0,i=[],r=0;r<t.length;r++){var o=t[r].match(/([mlz])\s?(\S+)?(?:\s|,)?(\S+)?/i);if(Array.isArray(o)&&!isNaN(o[2])&&!isNaN(o[3])){var s=o[1],a=+o[2],l=+o[3];switch(s){case"M":case"L":n={x:a,y:l};break;case"m":case"l":n={x:n.x+a,y:n.y+l};break;default:continue}i.push(n)}}return i}function _l(e,t){return gf.get(e)(t)}function Dl(e,t){if(Array.isArray(t))for(var n=0,i=t.length;n<i;n++)t[n](e)}function Ml(e,t,n){e.node=n[t],e.index=t}function Al(e,t,n,i){for(var r={siblings:e,node:null,index:0},o=0,s=e.length;o<s;o++)if(Ml(r,o,e),Dl(r,i.create),!("function"==typeof r.node.disabled?r.node.disabled():r.node.disabled)){r.node=vf.save(r.node);var a=_l(r.node.type,r.node);a&&(r.node.transform&&(n.save(),ol(r.node.transform,n)),n.isIdentity()||(a.modelViewMatrix=n.clone()),t.addChild(a),r.node.children&&Al(r.node.children,a,n,i),r.node.transform&&n.restore()),vf.restore()}}function El(e){var t=e.items,n=e.stage,i=e.dpi,r=e.on,o=void 0===r?{}:r;return n||(n=_l("stage",i)),Al(t,n,new Yp,o),n}function Il(e){return"string"==typeof e?-1!==e.search(yf):-1!==String(e).search(yf)}function Tl(e){return-1!==e.search(bf)}function Ll(e){return-1!==e.search(xf)}function kl(e,t,n,i,r){return i.some(function(i){return i(e,t,n)})?Cf:r.some(function(i){return i(e,t,n)})?qf:Sf}function Ol(e){""===e[0]&&e.shift(),""===e[e.length-1]&&e.pop()}function Pl(e,t,n){return Math.max(t,Math.min(n,e))}function Nl(e,t,n){return e?t>=0:t<n}function Rl(){function e(e){var t=Pl(e,0,y-1),n=v[t],i=l(n),r=kl(n,t,v,u,d);return{index:t,value:n,breakOpportunity:r,suppress:f.some(function(e){return e(n,t,v)}),hyphenation:g.some(function(e){return e(n,t,v)}),width:i.width,height:i.height,done:!1}}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.string,i=t.separator,r=void 0===i?"":i,o=t.reverse,s=void 0!==o&&o,a=t.measureText,l=void 0===a?function(e){return{width:e.length,height:1}}:a,c=t.mandatoryBreakIdentifiers,u=void 0===c?[Il]:c,h=t.noBreakAllowedIdentifiers,d=void 0===h?[]:h,p=t.suppressIdentifier,f=void 0===p?[Tl,Il,function(e){return""===e}]:p,m=t.hyphenationIdentifiers,g=void 0===m?[Ll]:m,v=String(n).split(r);Ol(v);var y=v.length,b=s?y:-1;return{next:function(t){return isNaN(t)?s?b--:b++:b=Pl(t,0,y-1),Nl(s,b,y)?e(b):{done:!0}},peek:e,length:y}}function Fl(e,t){var n=e.maxHeight,i=Math.max(e.maxLines,1)||1/0;if(isNaN(n))return i;var r=t*(e.lineHeight||wf);return Math.max(1,Math.min(Math.floor(n/r),i))}function jl(e,t){return{lines:[],line:"",width:0,maxLines:Fl(e,t(e.text).height),maxWidth:e.maxWidth,hyphens:{enabled:"auto"===e.hyphens,char:_f,metrics:t(_f)}}}function Vl(e){e.lines.push(e.line),e.line="",e.width=0}function Hl(e,t){e.line+=t.value,e.width+=t.width}function Bl(e,t,n){if(t.width>e.maxWidth)return t;for(var i=t.index,r=1;r<5;r++){var o=n.peek(t.index-1);if(!t.hyphenation||!o.hyphenation||0===t.index)return t;if(e.width+e.hyphens.metrics.width<=e.maxWidth)return e.line+=e.hyphens.char,t;if(1===e.line.length)return t;t=n.next(i-r),e.line=e.line.slice(0,-1),e.width-=t.width}return t}function zl(e,t,n){for(var i=Rl({string:t.value,measureText:n});e.lines.length<e.maxLines;){var r=i.next();if(r.done)break;e.width+r.width>e.maxWidth&&r.breakOpportunity===Sf&&e.line.length>0?(r=e.hyphens.enabled?Bl(e,r,i):r,Vl(e),Hl(e,r)):Hl(e,r)}}function $l(e,t){for(var n=Rl({string:e.text,separator:"",measureText:t,noBreakAllowedIdentifiers:[function(e,t){return 0===t}]}),i=jl(e,t),r=!0;i.lines.length<i.maxLines;){var o=n.next();if(o.done){Vl(i),r=!1;break}o.breakOpportunity===Cf?Vl(i):i.width+o.width>i.maxWidth&&o.breakOpportunity===Sf?o.suppress?i.width+=o.width:(o=i.hyphens.enabled?Bl(i,o,n):o,Vl(i),Hl(i,o)):Hl(i,o)}return{lines:i.lines,reduced:r}}function Ul(e,t){for(var n=Rl({string:e.text,separator:/(\s|-|\u2010)/,measureText:t}),i=jl(e,t),r=!0;i.lines.length<i.maxLines;){var o=n.next();if(o.done){Vl(i),r=!1;break}o.breakOpportunity===Cf?Vl(i):i.width+o.width>i.maxWidth&&o.breakOpportunity===Sf?o.suppress?Vl(i):o.width>i.maxWidth?zl(i,o,t):(Vl(i),Hl(i,o)):Hl(i,o)}return{lines:i.lines,reduced:r}}function Gl(e,t,n){var i={type:"container",children:[]};void 0!==t.id&&(i.id=t.id);var r=0;return e.lines.forEach(function(o,s){var a=Yc({},t);a.text=o,a._lineBreak=!0,e.reduced&&s===e.lines.length-1?a.text+=Df:delete a.maxWidth,a.dy=isNaN(a.dy)?r:a.dy+r,r+=n,i.children.push(a)}),i}function Wl(e){return"text"===e.type&&!e._lineBreak}function Xl(e,t){return function(n){return t({text:n,fontSize:e.fontSize,fontFamily:e.fontFamily})}}function Yl(e){return{"break-all":$l,"break-word":Ul}[e.wordBreak]}function Kl(e){return function(t){var n=t.node;if(Wl(n)){var i=Yl(n);if(!i)return;var r=e(n);if(r.width<=n.maxWidth&&!Il(n.text))return;var o=r.height*(n.lineHeight||wf),s=i(n,Xl(n,e));t.node=Gl(s,n,o)}}}function Ql(e,t){var n=e.text,i=e["font-size"],r=e["font-family"],o=e.maxWidth;if(n="string"==typeof n?n:""+n,void 0===o)return n;var s=t({text:n,fontSize:i,fontFamily:r}).width;if(s<=o)return n;for(var a=0,l=n.length-1;a<=l;){var c=Math.floor((a+l)/2);(s=t({text:n.substr(0,c)+Df,fontSize:i,fontFamily:r}).width)<=o?a=c+1:l=c-1}return n.substr(0,l)+Df}function Zl(e){var t=e.baseline||e["dominant-baseline"],n=0,i=parseInt(e.fontSize||e["font-size"],10)||0;switch(t){case"hanging":n=.75*i;break;case"text-before-edge":n=.85*i;break;case"middle":n=.25*i;break;case"central":n=.35*i;break;case"mathemetical":n=i/2;break;case"text-after-edge":case"ideographic":n=.2*-i;break;default:n=0}return n}function Jl(e){var t=e.text,n=e.fontSize,i=e.fontFamily,r=Af[t+n+i];if(void 0!==r)return r;var o=(Ef=Ef||document.createElement("canvas")).getContext("2d");o.font=n+" "+i;var s=o.measureText(t).width;return Af[t+n+i]=s,s}function ec(e){var t=e.fontSize,n=e.fontFamily,i=Mf[t+n];if(void 0!==i)return i;var r=1.2*Jl({text:"M",fontSize:t,fontFamily:n});return Mf[t+n]=r,r}function tc(e){var t=e.text,n=e.fontSize,i=e.fontFamily;return{width:Jl({text:t,fontSize:n,fontFamily:i}),height:ec({fontSize:n,fontFamily:i})}}function nc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tc,n=e["font-size"]||e.fontSize,i=e["font-family"]||e.fontFamily,r=t({text:e.text,fontFamily:i,fontSize:n}),o=Math.min(e.maxWidth||r.width,r.width),s=e.x||0,a=e.y||0,l=e.dx||0,c={x:0,y:a+((e.dy||0)+Zl(e))-.75*r.height,width:o,height:r.height},u=e["text-anchor"]||e.anchor;return c.x="middle"===u?s+l-o/2:"end"===u?s+l-o:s+l,c}function ic(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tc,n=Yl(e);if(n){for(var i=e["font-size"]||e.fontSize,r=e["font-family"]||e.fontFamily,o=n(e,function(e){return t({text:e,fontFamily:r,fontSize:i})}),s=Yc({},e),a=0,l="",c=0,u=o.lines.length;c<u;c++){var h=o.lines[c];h+=c===u-1&&o.reduced?Df:"";var d=t({text:h,fontSize:i,fontFamily:r}).width;d>=a&&(a=d,l=h)}s.text=l;var p=nc(s,t),f=e.lineHeight||wf;return p.height=p.height*o.lines.length*f,p}return nc(e,t)}function rc(e,t,n){var i=n.orientation,r=n.degree,o=n.stops,s=void 0===o?[]:o,a=null;if("radial"===i){var l=t.width||0,c=t.height||0,u=void 0!==t.x?t.x:t.cx,h=void 0!==t.y?t.y:t.cy;a=e.createRadialGradient(u+l/2,h+c/2,1,u+l/2,h+c/2,t.r||Math.max(t.width,t.height)/2)}else{var d=$n(r),p=t.width||2*t.r,f=t.height||2*t.r,m=void 0!==t.x?t.x:t.cx-t.r,g=void 0!==t.y?t.y:t.cy-t.r;a=e.createLinearGradient(m+d.x1*p,g+d.y1*f,m+d.x2*p,g+d.y2*f)}for(var v=0,y=s.length;v<y;v++){var b=s[v];a.addColorStop(b.offset,b.color)}return a}function oc(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.x,n=e.y,i=e.width,r=e.height,o=e.scaleRatio,s=e.margin,a={x:0,y:0,width:0,height:0,scaleRatio:{x:1,y:1},margin:{left:0,top:0}};return a.x=isNaN(t)?a.x:t,a.y=isNaN(n)?a.y:n,a.width=isNaN(i)?a.width:i,a.height=isNaN(r)?a.height:r,void 0!==o&&(a.scaleRatio.x=isNaN(o.x)?a.scaleRatio.x:o.x,a.scaleRatio.y=isNaN(o.y)?a.scaleRatio.y:o.y),void 0!==s&&(a.margin.left=isNaN(s.left)?0:s.left,a.margin.top=isNaN(s.top)?0:s.top),a}function sc(e){return Array.isArray(e)?e:"string"==typeof e?-1!==e.indexOf(",")?e.split(","):e.split(" "):[]}function ac(e){return("undefined"==typeof window?1:window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1)}function lc(e,t){t.setTransform(e[0][0],e[1][0],e[0][1],e[1][1],e[0][2],e[1][2])}function cc(e,t,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=Object.keys(i),o=0,s=n.length;o<s;o++){var a=n[o],l=a[0],c=a[1],u=a[2];if(l in t.attrs&&!(c in i)&&e[c]!==t.attrs[l]){var h=u?u(t.attrs[l]):t.attrs[l];"function"==typeof e[c]?e[c](h):e[c]=h}}for(var d=0,p=r.length;d<p;d++){var f=r[d];e[f]=i[f]}}function uc(e,t,n){for(var i=0,r=e.length;i<r;i++){var o=e[i],s={};t.save(),o.attrs&&(o.attrs.fill||o.attrs.stroke)&&(o.attrs.fill&&"object"===Zc(o.attrs.fill)&&"gradient"===o.attrs.fill.type&&(s.fillStyle=rc(t,o.attrs,o.attrs.fill)),o.attrs.stroke&&"object"===Zc(o.attrs.stroke)&&"gradient"===o.attrs.stroke.type&&(s.strokeStyle=rc(t,o.attrs,o.attrs.stroke))),cc(t,o,n,s),o.modelViewMatrix&&lc(o.modelViewMatrix.elements,t),If.has(o.type)&&If.get(o.type)(o.attrs,{g:t,doFill:"fill"in o.attrs&&"none"!==o.attrs.fill,doStroke:"stroke"in o.attrs&&0!==o.attrs["stroke-width"]}),o.children&&uc(o.children,t,n),t.restore()}}function hc(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:El,t=void 0,n=void 0,i=!1,r=oc(),o=[["fill","fillStyle"],["stroke","strokeStyle"],["opacity","globalAlpha"],["globalAlpha","globalAlpha"],["stroke-width","lineWidth"],["stroke-dasharray","setLineDash",sc]],s=function(){};return s.element=function(){return t},s.root=function(){return t},s.appendTo=function(e){return t||((t=e.ownerDocument.createElement("canvas")).style.position="absolute",t.style["-webkit-font-smoothing"]="antialiased",t.style["-moz-osx-font-smoothing"]="antialiased",t.style.pointerEvents="none"),e.appendChild(t),t},s.render=function(a){if(!t)return!1;var l=t.getContext("2d"),c=ac(l),u=r.scaleRatio.x,h=r.scaleRatio.y;i&&(t.style.left=Math.round(r.margin.left+r.x*u)+"px",t.style.top=Math.round(r.margin.top+r.y*h)+"px",t.style.width=Math.round(r.width*u)+"px",t.style.height=Math.round(r.height*h)+"px",t.width=Math.round(r.width*c*u),t.height=Math.round(r.height*c*h));var d={type:"container",children:a};1===c&&1===u&&1===h||(d.transform="scale("+c*u+", "+c*h+")");var p=e({items:[d],dpi:c,on:{create:[Kl(tc)]}}),f=!n||!p.equals(n),m=i||f;return m&&(s.clear(),uc(p.children,l,o)),i=!1,n=p,m},s.itemsAt=function(e){return n?n.getItemsFrom(e):[]},s.findShapes=function(e){return n?n.findShapes(e).map(function(e){return e.element=s.element(),e}):[]},s.clear=function(){t&&(t.width=t.width)},s.size=function(e){if(e){var t=oc(e);JSON.stringify(r)!==JSON.stringify(t)&&(i=!0,r=t)}return r},s.destroy=function(){t&&(t.parentElement&&t.parentElement.removeChild(t),t=null),n=null},s.measureText=function(e){return tc({text:e.text,fontSize:e.fontSize,fontFamily:e.fontFamily})},s.textBounds=function(e){return ic(e)},s}function dc(e,t){If.add(e,t)}function pc(e){return Tf.test(e)}function fc(e){return Lf.test(e)||kf.test(e)}function mc(e){var t=e?e.length:0,n=void 0,i=void 0;for(n=0;n<t;n++){if(i=e[n],pc(i))return"ltr";if(fc(i))return"rtl"}return"ltr"}function gc(e,t){return"rtl"===t?Of[e]:e}function vc(e,t){var n=[],i=void 0,r=[],o=[],s=[],a=void 0,l=void 0,c=function(e){return e.id},u=function(e,t){var n=void 0;return n="object"===(void 0===e?"undefined":Zc(e))?"id"in e?e.id:t:e,{content:e,id:n+"__"+(e.type||"")}};e.isTree||(e=e.map(u)),t=t.map(u),a=e.map(c),l=t.map(c);for(var h=0,d=t.length;h<d;h++)-1===a.indexOf(t[h].id)?n.push(t[h]):o.push(t[h]);for(var p=0,f=e.length;p<f;p++)-1===l.indexOf(e[p].id)?r.push(e[p]):s.push(e[p]);for(var m=0,g=n.length;m<g;m++)n[m].content.children&&(n[m].diff=vc([],n[m].content.children),n[m].children=n[m].diff.updatedNew.concat(n[m].diff.added),n[m].children.isTree=!0);for(var v=0,y=o.length;v<y;v++)o[v].diff=vc(s[v].children||[],o[v].content.children||[]),o[v].object=s[v].object,o[v].children=o[v].diff.items;return i=o.concat(n),n.isTree=!0,r.isTree=!0,o.isTree=!0,s.isTree=!0,i.isTree=!0,{added:n,updatedNew:o,updatedOld:s,removed:r,items:i}}function yc(e,t,n){for(var i=0,r=e.length;i<r;i++)e[i].object=n(e[i].content.type,t)}function bc(e,t){for(var n=0,i=e.length;n<i;n++)null!==e[n].object&&void 0!==e[n].object&&(t(e[n].object),e[n].object=null)}function xc(e,t,n,i){for(var r=void 0,o=0,s=e.length;o<s;o++)null!==(r=e[o]).object&&void 0!==r.object&&(n(r.object,r.content),r.diff&&(yc(r.diff.added,r.object,t),bc(r.diff.removed,i),xc(r.diff.items,t,n,i)))}function qc(e,t,n,i,r,o){var s=vc(e,t);return yc(s.added,n,i),bc(s.removed,o),xc(s.items,i,r,o),s.items}function Cc(){return new jf(qc,Nf,Ff,Rf)}function Sc(e){var t=0,n=void 0,i=void 0;if(0===(e=JSON.stringify(e)).length)return t;for(n=0,i=e.length;n<i;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t}function wc(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fill",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=Sc(e[t]),r="";if(void 0!==Hf[i])r=Hf[i];else{var o=e[t],s=o.orientation,a=o.degree,l=o.stops,c=void 0===l?[]:l,u={};void 0===a&&(a=90),"radial"===s?u.type="radialGradient":(u=$n(a)).type="linearGradient",u.id="picasso-gradient-"+i,u.children=c.map(function(e){return{type:"stop",offset:100*e.offset+"%",style:"stop-color:"+e.color+";stop-opacity:"+(e.opacity||1)}}),Vf.push(u),Hf[i]=u.id,r=u.id}return"url("+n+"#"+r+")"}function _c(){Vf=[],Hf={}}function Dc(e){var t="";"undefined"!=typeof window&&(t=window.location.href.split("#")[0]);var n=e.node;n.fill&&"object"===Zc(n.fill)&&"gradient"===n.fill.type&&(n.fill=wc(n,"fill",t)),n.stroke&&"object"===Zc(n.stroke)&&"gradient"===n.stroke.type&&(n.stroke=wc(n,"stroke",t))}function Mc(){return{type:"defs",children:Vf,disabled:function(){return 0===Vf.length}}}function Ac(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Cc,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Pf,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:El,i=e(),r=void 0,o=void 0,s=!1,a=oc(),l=void 0,c=function(){};return c.element=function(){return r},c.root=function(){return o},c.appendTo=function(e){return r||((r=e.ownerDocument.createElementNS(t,"svg")).style.position="absolute",r.style["-webkit-font-smoothing"]="antialiased",r.style["-moz-osx-font-smoothing"]="antialiased",r.style.pointerEvents="none",r.setAttribute("xmlns",t),(o=e.ownerDocument.createElementNS(t,"g")).style.pointerEvents="auto",r.appendChild(o)),e.appendChild(r),r},c.render=function(e){if(!r)return!1;var t=a.scaleRatio.x,u=a.scaleRatio.y;s&&(r.style.left=Math.round(a.margin.left+a.x*t)+"px",r.style.top=Math.round(a.margin.top+a.y*u)+"px",r.setAttribute("width",Math.round(a.width*t)),r.setAttribute("height",Math.round(a.height*u))),_c();var h={type:"container",children:Array.isArray(e)?[].concat(su(e),[Mc()]):e};1===t&&1===u||(h.transform="scale("+t+", "+u+")");var d=n({items:[h],on:{create:[Dc,Kl(tc)]}}),p=!l||!d.equals(l),f=s||p;return f&&(c.clear(),i.render(d.children,o)),s=!1,l=d,f},c.itemsAt=function(e){return l?l.getItemsFrom(e):[]},c.findShapes=function(e){return l?l.findShapes(e).map(function(e){return e.element=c.element(),e}):[]},c.clear=function(){if(!o)return c;var e=o.cloneNode(!1);return r.replaceChild(e,o),o=e,c},c.destroy=function(){r&&r.parentElement&&r.parentElement.removeChild(r),r=null,o=null},c.size=function(e){if(e){var t=oc(e);JSON.stringify(a)!==JSON.stringify(t)&&(s=!0,a=t)}return a},c.measureText=function(e){return tc({text:e.text,fontSize:e.fontSize,fontFamily:e.fontFamily})},c.textBounds=function(e){return ic(e)},c}function Ec(e){return void 0===e}function Ic(e){return void 0!==e}function Tc(e,t){return e.key===t.key&&e.sel===t.sel}function Lc(e,t,n){var i,r,o={};for(i=t;i<=n;++i)Ic(r=e[i].key)&&(o[r]=i);return o}function kc(e,t){var n,i,r,o=t.elm,s=e.data.attrs,a=t.data.attrs;if(s||a){s=s||{},a=a||{};for(n in a)i=a[n],s[n]!==i&&(!i&&Kf[n]?o.removeAttribute(n):(r=n.split(":")).length>1&&Xf.hasOwnProperty(r[0])?o.setAttributeNS(Xf[r[0]],n,i):o.setAttribute(n,i));for(n in s)n in a||o.removeAttribute(n)}}function Oc(e,t){var n,i,r=t.elm,o=e.data.class,s=t.data.class;if(o||s){o=o||{},s=s||{};for(i in o)s[i]||r.classList.remove(i);for(i in s)(n=s[i])!==o[i]&&r.classList[n?"add":"remove"](i)}}function Pc(e,t,n){nm(function(){e[t]=n})}function Nc(e,t){var n,i,r=t.elm,o=e.data.style,s=t.data.style;if(o||s){o=o||{},s=s||{};var a="delayed"in o;for(i in o)s[i]||(r.style[i]="");for(i in s)if(n=s[i],"delayed"===i)for(i in s.delayed)n=s.delayed[i],a&&n===o.delayed[i]||Pc(r.style,i,n);else"remove"!==i&&n!==o[i]&&(r.style[i]=n)}}function Rc(e,t,n){if("function"==typeof e)e.call(t,n,t);else if("object"==typeof e)if("function"==typeof e[0])if(2===e.length)e[0].call(t,e[1],n,t);else{var i=e.slice(1);i.push(n),i.push(t),e[0].apply(t,i)}else for(var r=0;r<e.length;r++)Rc(e[r])}function Fc(e,t){var n=e.type,i=t.data.on;i&&i[n]&&Rc(i[n],t,e)}function jc(){return function e(t){Fc(t,e.vnode)}}function Vc(e,t){var n,i=e.data.on,r=e.listener,o=e.elm,s=t&&t.data.on,a=t&&t.elm;if(i!==s){if(i&&r)if(s)for(n in i)s[n]||o.removeEventListener(n,r,!1);else for(n in i)o.removeEventListener(n,r,!1);if(s){var l=t.listener=e.listener||jc();if(l.vnode=t,i)for(n in s)i[n]||a.addEventListener(n,l,!1);else for(n in s)a.addEventListener(n,l,!1)}}}function Hc(e,t,n){if(e.ns="http://www.w3.org/2000/svg","foreignObject"!==n&&void 0!==t)for(var i=0;i<t.length;++i)Hc(t[i].data,t[i].children,t[i].sel)}function Bc(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).createElement,t=void 0===e?document.createElement.bind(document):e,n=void 0,i=oc(),r=void 0,o=function(){};return o.element=function(){return n},o.root=function(){return n},o.itemsAt=function(){return[]},o.findShapes=function(){return[]},o.appendTo=function(e){return n||((n=t("div")).style.position="absolute",n.style["-webkit-font-smoothing"]="antialiased",n.style["-moz-osx-font-smoothing"]="antialiased",n.style.pointerEvents="none"),e.appendChild(n),n},o.render=function(e){if(!n)return!1;var t=i.scaleRatio.x,o=i.scaleRatio.y;n.style.left=Math.round(i.margin.left+i.x*t)+"px",n.style.top=Math.round(i.margin.left+i.y*o)+"px",n.style.width=Math.round(i.width*t)+"px",n.style.height=Math.round(i.height*o)+"px";var s=om("div",{},Array.isArray(e)?e:[e]);return r?sm(r,s):sm(n,s),r=s,!0},o.renderArgs=[om],o.clear=function(){if(n){for(var e=n.firstChild;e;)n.removeChild(e),e=n.firstChild;r=null}},o.destroy=function(){n&&n.parentElement&&n.parentElement.removeChild(n),n=null},o.size=function(e){return e&&(i=oc(e)),i},o.measureText=function(e){return tc({text:e.text,fontSize:e.fontSize,fontFamily:e.fontFamily})},o.textBounds=function(){return{x:0,y:0,width:0,height:0}},o}function zc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(arguments[2],t)}function $c(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return $c({palettes:t.palettes.concat(e.palettes||[]),style:Yc({},t.style,e.style),logger:e.logger||t.logger,renderer:e.renderer||t.renderer},r)}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=um(t.logger),r={component:Ce(n.component),data:Ce(n.data),formatter:Ce(n.formatter),interaction:Ce(n.interaction),renderer:Kd(n.renderer),scale:Ce(n.scale),symbol:Ce(n.symbol),logger:i};return t.renderer&&t.renderer.prio&&r.renderer.default(t.renderer.prio[0]),e.use=function(e){return zc(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r)},e.chart=function(e){return Sr(e,{registries:r,logger:i,style:t.style,palettes:t.palettes})},e.config=function(){return t},Object.keys(r).forEach(function(t){e[t]=r[t]}),e.version=Kc.version,e}var Uc=Object.prototype.hasOwnProperty,Gc=Object.prototype.toString,Wc=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===Gc.call(e)},Xc=function(e){if(!e||"[object Object]"!==Gc.call(e))return!1;var t=Uc.call(e,"constructor"),n=e.constructor&&e.constructor.prototype&&Uc.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!n)return!1;var i;for(i in e);return void 0===i||Uc.call(e,i)},Yc=function e(){var t,n,i,r,o,s,a=arguments[0],l=1,c=arguments.length,u=!1;for("boolean"==typeof a&&(u=a,a=arguments[1]||{},l=2),(null==a||"object"!=typeof a&&"function"!=typeof a)&&(a={});l<c;++l)if(null!=(t=arguments[l]))for(n in t)i=a[n],a!==(r=t[n])&&(u&&r&&(Xc(r)||(o=Wc(r)))?(o?(o=!1,s=i&&Wc(i)?i:[]):s=i&&Xc(i)?i:{},a[n]=e(u,s,r)):void 0!==r&&(a[n]=r));return a},Kc={version:"0.40.0"},Qc=[],Zc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jc=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},eu=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),tu=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},nu=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var s=r.get;if(void 0!==s)return s.call(i)},iu=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},ru=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},ou=function(){function e(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(r)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),su=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},au=1e-12,lu=Math.PI,cu=2*lu,uu=cu-1e-6;$.prototype=U.prototype={constructor:$,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,i){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+i)},bezierCurveTo:function(e,t,n,i,r,o){this._+="C"+ +e+","+ +t+","+ +n+","+ +i+","+(this._x1=+r)+","+(this._y1=+o)},arcTo:function(e,t,n,i,r){e=+e,t=+t,n=+n,i=+i,r=+r;var o=this._x1,s=this._y1,a=n-e,l=i-t,c=o-e,u=s-t,h=c*c+u*u;if(r<0)throw new Error("negative radius: "+r);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(h>1e-6)if(Math.abs(u*a-l*c)>1e-6&&r){var d=n-o,p=i-s,f=a*a+l*l,m=d*d+p*p,g=Math.sqrt(f),v=Math.sqrt(h),y=r*Math.tan((lu-Math.acos((f+h-m)/(2*g*v)))/2),b=y/v,x=y/g;Math.abs(b-1)>1e-6&&(this._+="L"+(e+b*c)+","+(t+b*u)),this._+="A"+r+","+r+",0,0,"+ +(u*d>c*p)+","+(this._x1=e+x*a)+","+(this._y1=t+x*l)}else this._+="L"+(this._x1=e)+","+(this._y1=t);else;},arc:function(e,t,n,i,r,o){e=+e,t=+t;var s=(n=+n)*Math.cos(i),a=n*Math.sin(i),l=e+s,c=t+a,u=1^o,h=o?i-r:r-i;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+l+","+c:(Math.abs(this._x1-l)>1e-6||Math.abs(this._y1-c)>1e-6)&&(this._+="L"+l+","+c),n&&(h<0&&(h=h%cu+cu),h>uu?this._+="A"+n+","+n+",0,1,"+u+","+(e-s)+","+(t-a)+"A"+n+","+n+",0,1,"+u+","+(this._x1=l)+","+(this._y1=c):h>1e-6&&(this._+="A"+n+","+n+",0,"+ +(h>=lu)+","+u+","+(this._x1=e+n*Math.cos(r))+","+(this._y1=t+n*Math.sin(r))))},rect:function(e,t,n,i){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +i+"h"+-n+"Z"},toString:function(){return this._}};var hu=function(e){return function(){return e}},du=Math.abs,pu=Math.atan2,fu=Math.cos,mu=Math.max,gu=Math.min,vu=Math.sin,yu=Math.sqrt,bu=1e-12,xu=Math.PI,qu=xu/2,Cu=2*xu,Su=function(){function e(){var e,c,u=+t.apply(this,arguments),h=+n.apply(this,arguments),d=o.apply(this,arguments)-qu,p=s.apply(this,arguments)-qu,f=du(p-d),m=p>d;if(l||(l=e=U()),h<u&&(c=h,h=u,u=c),h>bu)if(f>Cu-bu)l.moveTo(h*fu(d),h*vu(d)),l.arc(0,0,h,d,p,!m),u>bu&&(l.moveTo(u*fu(p),u*vu(p)),l.arc(0,0,u,p,d,m));else{var g,v,y=d,b=p,x=d,q=p,C=f,S=f,w=a.apply(this,arguments)/2,_=w>bu&&(r?+r.apply(this,arguments):yu(u*u+h*h)),D=gu(du(h-u)/2,+i.apply(this,arguments)),M=D,A=D;if(_>bu){var E=W(_/u*vu(w)),I=W(_/h*vu(w));(C-=2*E)>bu?(E*=m?1:-1,x+=E,q-=E):(C=0,x=q=(d+p)/2),(S-=2*I)>bu?(I*=m?1:-1,y+=I,b-=I):(S=0,y=b=(d+p)/2)}var T=h*fu(y),L=h*vu(y),k=u*fu(q),O=u*vu(q);if(D>bu){var P=h*fu(b),N=h*vu(b),R=u*fu(x),F=u*vu(x);if(f<xu){var j=C>bu?J(T,L,R,F,P,N,k,O):[k,O],V=T-j[0],H=L-j[1],B=P-j[0],z=N-j[1],$=1/vu(G((V*B+H*z)/(yu(V*V+H*H)*yu(B*B+z*z)))/2),X=yu(j[0]*j[0]+j[1]*j[1]);M=gu(D,(u-X)/($-1)),A=gu(D,(h-X)/($+1))}}S>bu?A>bu?(g=ee(R,F,T,L,h,A,m),v=ee(P,N,k,O,h,A,m),l.moveTo(g.cx+g.x01,g.cy+g.y01),A<D?l.arc(g.cx,g.cy,A,pu(g.y01,g.x01),pu(v.y01,v.x01),!m):(l.arc(g.cx,g.cy,A,pu(g.y01,g.x01),pu(g.y11,g.x11),!m),l.arc(0,0,h,pu(g.cy+g.y11,g.cx+g.x11),pu(v.cy+v.y11,v.cx+v.x11),!m),l.arc(v.cx,v.cy,A,pu(v.y11,v.x11),pu(v.y01,v.x01),!m))):(l.moveTo(T,L),l.arc(0,0,h,y,b,!m)):l.moveTo(T,L),u>bu&&C>bu?M>bu?(g=ee(k,O,P,N,u,-M,m),v=ee(T,L,R,F,u,-M,m),l.lineTo(g.cx+g.x01,g.cy+g.y01),M<D?l.arc(g.cx,g.cy,M,pu(g.y01,g.x01),pu(v.y01,v.x01),!m):(l.arc(g.cx,g.cy,M,pu(g.y01,g.x01),pu(g.y11,g.x11),!m),l.arc(0,0,u,pu(g.cy+g.y11,g.cx+g.x11),pu(v.cy+v.y11,v.cx+v.x11),m),l.arc(v.cx,v.cy,M,pu(v.y11,v.x11),pu(v.y01,v.x01),!m))):l.arc(0,0,u,q,x,m):l.lineTo(k,O)}else l.moveTo(0,0);if(l.closePath(),e)return l=null,e+""||null}var t=X,n=Y,i=hu(0),r=null,o=K,s=Q,a=Z,l=null;return e.centroid=function(){var e=(+t.apply(this,arguments)+ +n.apply(this,arguments))/2,i=(+o.apply(this,arguments)+ +s.apply(this,arguments))/2-xu/2;return[fu(i)*e,vu(i)*e]},e.innerRadius=function(n){return arguments.length?(t="function"==typeof n?n:hu(+n),e):t},e.outerRadius=function(t){return arguments.length?(n="function"==typeof t?t:hu(+t),e):n},e.cornerRadius=function(t){return arguments.length?(i="function"==typeof t?t:hu(+t),e):i},e.padRadius=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:hu(+t),e):r},e.startAngle=function(t){return arguments.length?(o="function"==typeof t?t:hu(+t),e):o},e.endAngle=function(t){return arguments.length?(s="function"==typeof t?t:hu(+t),e):s},e.padAngle=function(t){return arguments.length?(a="function"==typeof t?t:hu(+t),e):a},e.context=function(t){return arguments.length?(l=null==t?null:t,e):l},e};te.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};var wu=function(e){return new te(e)},_u=function(){function e(e){var a,l,c,u=e.length,h=!1;for(null==r&&(s=o(c=U())),a=0;a<=u;++a)!(a<u&&i(l=e[a],a,e))===h&&((h=!h)?s.lineStart():s.lineEnd()),h&&s.point(+t(l,a,e),+n(l,a,e));if(c)return s=null,c+""||null}var t=ne,n=ie,i=hu(!0),r=null,o=wu,s=null;return e.x=function(n){return arguments.length?(t="function"==typeof n?n:hu(+n),e):t},e.y=function(t){return arguments.length?(n="function"==typeof t?t:hu(+t),e):n},e.defined=function(t){return arguments.length?(i="function"==typeof t?t:hu(!!t),e):i},e.curve=function(t){return arguments.length?(o=t,null!=r&&(s=o(r)),e):o},e.context=function(t){return arguments.length?(null==t?r=s=null:s=o(r=t),e):r},e},Du=function(){function e(e){var t,u,h,d,p,f=e.length,m=!1,g=new Array(f),v=new Array(f);for(null==a&&(c=l(p=U())),t=0;t<=f;++t){if(!(t<f&&s(d=e[t],t,e))===m)if(m=!m)u=t,c.areaStart(),c.lineStart();else{for(c.lineEnd(),c.lineStart(),h=t-1;h>=u;--h)c.point(g[h],v[h]);c.lineEnd(),c.areaEnd()}m&&(g[t]=+n(d,t,e),v[t]=+r(d,t,e),c.point(i?+i(d,t,e):g[t],o?+o(d,t,e):v[t]))}if(p)return c=null,p+""||null}function t(){return _u().defined(s).curve(l).context(a)}var n=ne,i=null,r=hu(0),o=ie,s=hu(!0),a=null,l=wu,c=null;return e.x=function(t){return arguments.length?(n="function"==typeof t?t:hu(+t),i=null,e):n},e.x0=function(t){return arguments.length?(n="function"==typeof t?t:hu(+t),e):n},e.x1=function(t){return arguments.length?(i=null==t?null:"function"==typeof t?t:hu(+t),e):i},e.y=function(t){return arguments.length?(r="function"==typeof t?t:hu(+t),o=null,e):r},e.y0=function(t){return arguments.length?(r="function"==typeof t?t:hu(+t),e):r},e.y1=function(t){return arguments.length?(o=null==t?null:"function"==typeof t?t:hu(+t),e):o},e.lineX0=e.lineY0=function(){return t().x(n).y(r)},e.lineY1=function(){return t().x(n).y(o)},e.lineX1=function(){return t().x(i).y(r)},e.defined=function(t){return arguments.length?(s="function"==typeof t?t:hu(!!t),e):s},e.curve=function(t){return arguments.length?(l=t,null!=a&&(c=l(a)),e):l},e.context=function(t){return arguments.length?(null==t?a=c=null:c=l(a=t),e):a},e},Mu=function(e,t){return t<e?-1:t>e?1:t>=e?0:NaN},Au=function(e){return e},Eu=function(){function e(e){var a,l,c,u,h,d=e.length,p=0,f=new Array(d),m=new Array(d),g=+r.apply(this,arguments),v=Math.min(Cu,Math.max(-Cu,o.apply(this,arguments)-g)),y=Math.min(Math.abs(v)/d,s.apply(this,arguments)),b=y*(v<0?-1:1);for(a=0;a<d;++a)(h=m[f[a]=a]=+t(e[a],a,e))>0&&(p+=h);for(null!=n?f.sort(function(e,t){return n(m[e],m[t])}):null!=i&&f.sort(function(t,n){return i(e[t],e[n])}),a=0,c=p?(v-d*b)/p:0;a<d;++a,g=u)l=f[a],u=g+((h=m[l])>0?h*c:0)+b,m[l]={data:e[l],index:a,value:h,startAngle:g,endAngle:u,padAngle:y};return m}var t=Au,n=Mu,i=null,r=hu(0),o=hu(Cu),s=hu(0);return e.value=function(n){return arguments.length?(t="function"==typeof n?n:hu(+n),e):t},e.sortValues=function(t){return arguments.length?(n=t,i=null,e):n},e.sort=function(t){return arguments.length?(i=t,n=null,e):i},e.startAngle=function(t){return arguments.length?(r="function"==typeof t?t:hu(+t),e):r},e.endAngle=function(t){return arguments.length?(o="function"==typeof t?t:hu(+t),e):o},e.padAngle=function(t){return arguments.length?(s="function"==typeof t?t:hu(+t),e):s},e},Iu=Array.prototype.slice;oe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:re(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:re(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};ae.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:se(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2,this._x1=e,this._y1=t;break;case 2:this._point=3;default:se(this,e,t)}this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Tu=function e(t){function n(e){return new ae(e,t)}return n.tension=function(t){return e(+t)},n}(0);ce.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){if(e=+e,t=+t,this._point){var n=this._x2-e,i=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3;default:le(this,e,t)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=t}};var Lu=function e(t){function n(e){return t?new ce(e,t):new ae(e,0)}return n.alpha=function(t){return e(+t)},n}(.5);fe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:pe(this,this._t0,de(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,e!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,pe(this,de(this,n=he(this,e,t)),n);break;default:pe(this,this._t0,n=he(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(me.prototype=Object.create(fe.prototype)).point=function(e,t){fe.prototype.point.call(this,t,e)},ge.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,i,r,o){this._context.bezierCurveTo(t,e,i,n,o,r)}},ve.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,n=e.length;if(n)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),2===n)this._context.lineTo(e[1],t[1]);else for(var i=ye(e),r=ye(t),o=0,s=1;s<n;++o,++s)this._context.bezierCurveTo(i[0][o],r[0][o],i[1][o],r[1][o],e[s],t[s]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};be.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var n=this._x*(1-this._t)+e*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,t)}}this._x=e,this._y=t}};var ku,Ou=function(e,t){if((r=e.length)>1)for(var n,i,r,o=1,s=e[t[0]],a=s.length;o<r;++o)for(i=s,s=e[t[o]],n=0;n<a;++n)s[n][1]+=s[n][0]=isNaN(i[n][1])?i[n][0]:i[n][1]},Pu=function(e){for(var t=e.length,n=new Array(t);--t>=0;)n[t]=t;return n},Nu=function(){function e(e){var o,s,a=t.apply(this,arguments),l=e.length,c=a.length,u=new Array(c);for(o=0;o<c;++o){for(var h,d=a[o],p=u[o]=new Array(l),f=0;f<l;++f)p[f]=h=[0,+r(e[f],d,f,e)],h.data=e[f];p.key=d}for(o=0,s=n(u);o<c;++o)u[s[o]].index=o;return i(u,s),u}var t=hu([]),n=Pu,i=Ou,r=xe;return e.keys=function(n){return arguments.length?(t="function"==typeof n?n:hu(Iu.call(n)),e):t},e.value=function(t){return arguments.length?(r="function"==typeof t?t:hu(+t),e):r},e.order=function(t){return arguments.length?(n=null==t?Pu:"function"==typeof t?t:hu(Iu.call(t)),e):n},e.offset=function(t){return arguments.length?(i=null==t?Ou:t,e):i},e},Ru=function(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]},Fu=function(e){return(e=Ru(Math.abs(e)))?e[1]:NaN},ju=function(e,t){return function(n,i){for(var r=n.length,o=[],s=0,a=e[0],l=0;r>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),o.push(n.substring(r-=a,r+a)),!((l+=a+1)>i));)a=e[s=(s+1)%e.length];return o.reverse().join(t)}},Vu=function(e){return function(t){return t.replace(/[0-9]/g,function(t){return e[+t]})}},Hu=function(e,t){var n=Ru(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")},Bu={"":function(e,t){e:for(var n,i=(e=e.toPrecision(t)).length,r=1,o=-1;r<i;++r)switch(e[r]){case".":o=n=r;break;case"0":0===o&&(o=r),n=r;break;case"e":break e;default:o>0&&(o=0)}return o>0?e.slice(0,o)+e.slice(n+1):e},"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.round(e).toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return Hu(100*e,t)},r:Hu,s:function(e,t){var n=Ru(e,t);if(!n)return e+"";var i=n[0],r=n[1],o=r-(ku=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,s=i.length;return o===s?i:o>s?i+new Array(o-s+1).join("0"):o>0?i.slice(0,o)+"."+i.slice(o):"0."+new Array(1-o).join("0")+Ru(e,Math.max(0,t+o-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}},zu=/^(?:(.)?([<>=^]))?([+\-\( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?([a-z%])?$/i;Se.prototype=we.prototype,we.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(null==this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(null==this.precision?"":"."+Math.max(0,0|this.precision))+this.type};var $u,Uu,Gu,Wu=function(e){return e},Xu=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"],Yu=function(e){function t(e){function t(e){var t,i,s,u=g,x=v;if("c"===m)x=y(e)+x,e="";else{var q=(e=+e)<0;if(e=y(Math.abs(e),f),q&&0==+e&&(q=!1),u=(q?"("===c?c:"-":"-"===c||"("===c?"":c)+u,x=x+("s"===m?Xu[8+ku/3]:"")+(q&&"("===c?")":""),b)for(t=-1,i=e.length;++t<i;)if(48>(s=e.charCodeAt(t))||s>57){x=(46===s?r+e.slice(t+1):e.slice(t))+x,e=e.slice(0,t);break}}p&&!h&&(e=n(e,1/0));var C=u.length+e.length+x.length,S=C<d?new Array(d-C+1).join(a):"";switch(p&&h&&(e=n(S+e,S.length?d-x.length:1/0),S=""),l){case"<":e=u+e+x+S;break;case"=":e=u+S+e+x;break;case"^":e=S.slice(0,C=S.length>>1)+u+e+x+S.slice(C);break;default:e=S+u+e+x}return o(e)}var a=(e=Se(e)).fill,l=e.align,c=e.sign,u=e.symbol,h=e.zero,d=e.width,p=e.comma,f=e.precision,m=e.type,g="$"===u?i[0]:"#"===u&&/[boxX]/.test(m)?"0"+m.toLowerCase():"",v="$"===u?i[1]:/[%p]/.test(m)?s:"",y=Bu[m],b=!m||/[defgprs%]/.test(m);return f=null==f?m?6:12:/[gprs]/.test(m)?Math.max(1,Math.min(21,f)):Math.max(0,Math.min(20,f)),t.toString=function(){return e+""},t}var n=e.grouping&&e.thousands?ju(e.grouping,e.thousands):Wu,i=e.currency,r=e.decimal,o=e.numerals?Vu(e.numerals):Wu,s=e.percent||"%";return{format:t,formatPrefix:function(e,n){var i=t((e=Se(e),e.type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(Fu(n)/3))),o=Math.pow(10,-r),s=Xu[8+r/3];return function(e){return i(o*e)+s}}}};!function(e){$u=Yu(e),Uu=$u.format,Gu=$u.formatPrefix}({decimal:".",thousands:",",grouping:[3],currency:["$",""]});var Ku=function(e){return Math.max(0,-Fu(Math.abs(e)))},Qu=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Fu(t)/3)))-Fu(Math.abs(e)))},Zu=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Fu(t)-Fu(e))+1},Ju=new Date,eh=new Date,th=_e(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});th.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?_e(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):th:null};var nh=6e4,ih=6048e5,rh=(_e(function(e){e.setTime(1e3*Math.floor(e/1e3))},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getUTCSeconds()}),_e(function(e){e.setTime(Math.floor(e/nh)*nh)},function(e,t){e.setTime(+e+t*nh)},function(e,t){return(t-e)/nh},function(e){return e.getMinutes()}),_e(function(e){var t=e.getTimezoneOffset()*nh%36e5;t<0&&(t+=36e5),e.setTime(36e5*Math.floor((+e-t)/36e5)+t)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getHours()}),_e(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*nh)/864e5},function(e){return e.getDate()-1})),oh=De(0),sh=De(1),ah=(De(2),De(3),De(4)),lh=(De(5),De(6),_e(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())},function(e){return e.getMonth()}),_e(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()}));lh.every=function(e){return isFinite(e=Math.floor(e))&&e>0?_e(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,n){t.setFullYear(t.getFullYear()+n*e)}):null};_e(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+t*nh)},function(e,t){return(t-e)/nh},function(e){return e.getUTCMinutes()}),_e(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getUTCHours()});var ch=_e(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/864e5},function(e){return e.getUTCDate()-1}),uh=Me(0),hh=Me(1),dh=(Me(2),Me(3),Me(4)),ph=(Me(5),Me(6),_e(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())},function(e){return e.getUTCMonth()}),_e(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()}));ph.every=function(e){return isFinite(e=Math.floor(e))&&e>0?_e(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)}):null};var fh,mh,gh,vh,yh,bh={"-":"",_:" ",0:"0"},xh=/^\s*\d+/,qh=/^%/,Ch=/[\\^$*+?|[\]().{}]/g;!function(e){fh=Te(e),mh=fh.format,gh=fh.parse,vh=fh.utcFormat,yh=fh.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});Date.prototype.toISOString||vh("%Y-%m-%dT%H:%M:%S.%LZ"),+new Date("2000-01-01T00:00:00.000Z")||yh("%Y-%m-%dT%H:%M:%S.%LZ");var Sh=Ce();Sh("d3-number",function(e,t,n){function i(e){return s(e)}function r(){i.locale({decimal:n||".",thousands:t||",",grouping:[3],currency:["$",""]})}var o=void 0,s=void 0;return i.locale=function(t){return o=Yu(t),s=o.format(e),this},r(),i.format=function(e,i,s,a){return(s||a)&&(t=s,n=a,r()),o.format(e)(i)},i.pattern=function(t){return t&&(e=t,s=o.format(t)),e},i}),Sh("d3-time",function(e){function t(e){return i(e)}var n=Te({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}),i=n.format(e);return t.format=function(e,t){return n.format(e)(t)},t.locale=function(){return n=Te.apply(void 0,arguments),i=n.format(e),this},t.parse=function(e,t){return n.parse(e)(t)},t.parsePattern=function(e){return n.parse(e)},t});var wh={id:function(e){return e.source+"/"+e.title},key:function(e){return e.title},tags:function(e){return e.tags},min:function(e){return e.min},max:function(e){return e.max},type:function(e){return e.type},title:function(e){return e.title},values:function(e){return e.values},value:function(e){return e},label:function(e){return e},formatter:function(e){return e.formatter&&e.formatter()||Sh("d3-number")("")}},_h={diverging:function(e,t){if((a=e.length)>1)for(var n,i,r,o,s,a,l=0,c=e[t[0]].length;l<c;++l)for(o=s=0,n=0;n<a;++n)(r=(i=e[t[n]][l])[1]-i[0])>=0?(i[0]=o,i[1]=o+=r):r<0?(i[1]=s,i[0]=s+=r):i[0]=o},none:Ou,silhouette:function(e,t){if((n=e.length)>0){for(var n,i=0,r=e[t[0]],o=r.length;i<o;++i){for(var s=0,a=0;s<n;++s)a+=e[s][i][1]||0;r[i][1]+=r[i][0]=-a/2}Ou(e,t)}},expand:function(e,t){if((i=e.length)>0){for(var n,i,r,o=0,s=e[0].length;o<s;++o){for(r=n=0;n<i;++n)r+=e[n][o][1]||0;if(r)for(n=0;n<i;++n)e[n][o][1]/=r}Ou(e,t)}},wiggle:function(e,t){if((r=e.length)>0&&(i=(n=e[t[0]]).length)>0){for(var n,i,r,o=0,s=1;s<i;++s){for(var a=0,l=0,c=0;a<r;++a){for(var u=e[t[a]],h=u[s][1]||0,d=(h-(u[s-1][1]||0))/2,p=0;p<a;++p){var f=e[t[p]];d+=(f[s][1]||0)-(f[s-1][1]||0)}l+=h,c+=d*h}n[s-1][1]+=n[s-1][0]=o,l&&(o-=c/l)}n[s-1][1]+=n[s-1][0]=o,Ou(e,t)}}},Dh={ascending:function(e){var t=e.map(qe);return Pu(e).sort(function(e,n){return t[e]-t[n]})},insideout:function(e){var t,n,i=e.length,r=e.map(qe),o=Pu(e).sort(function(e,t){return r[t]-r[e]}),s=0,a=0,l=[],c=[];for(t=0;t<i;++t)n=o[t],s<a?(s+=r[n],l.push(n)):(a+=r[n],c.push(n));return c.reverse().concat(l)},none:Pu,reverse:function(e){return Pu(e).reverse()}},Mh=function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN},Ah=function(e){return 1===e.length&&(e=Ut(e)),{left:function(t,n,i,r){for(null==i&&(i=0),null==r&&(r=t.length);i<r;){var o=i+r>>>1;e(t[o],n)<0?i=o+1:r=o}return i},right:function(t,n,i,r){for(null==i&&(i=0),null==r&&(r=t.length);i<r;){var o=i+r>>>1;e(t[o],n)>0?r=o:i=o+1}return i}}}(Mh).right,Eh=function(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=0|Math.max(0,Math.ceil((t-e)/n)),o=new Array(r);++i<r;)o[i]=e+i*n;return o},Ih=Math.sqrt(50),Th=Math.sqrt(10),Lh=Math.sqrt(2),kh=function(e,t,n){var i,r,o,s,a=-1;if(t=+t,e=+e,n=+n,e===t&&n>0)return[e];if((i=t<e)&&(r=e,e=t,t=r),0===(s=Gt(e,t,n))||!isFinite(s))return[];if(s>0)for(e=Math.ceil(e/s),t=Math.floor(t/s),o=new Array(r=Math.ceil(t-e+1));++a<r;)o[a]=(e+a)*s;else for(e=Math.floor(e*s),t=Math.ceil(t*s),o=new Array(r=Math.ceil(e-t+1));++a<r;)o[a]=(e-a)/s;return i&&o.reverse(),o};Xt.prototype=Yt.prototype={constructor:Xt,has:function(e){return"$"+e in this},get:function(e){return this["$"+e]},set:function(e,t){return this["$"+e]=t,this},remove:function(e){var t="$"+e;return t in this&&delete this[t]},clear:function(){for(var e in this)"$"===e[0]&&delete this[e]},keys:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)"$"===t[0]&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)"$"===t[0]&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)"$"===t[0]&&++e;return e},empty:function(){for(var e in this)if("$"===e[0])return!1;return!0},each:function(e){for(var t in this)"$"===t[0]&&e(this[t],t.slice(1),this)}};var Oh=Yt.prototype;Kt.prototype=function(e,t){var n=new Kt;if(e instanceof Kt)e.each(function(e){n.add(e)});else if(e){var i=-1,r=e.length;if(null==t)for(;++i<r;)n.add(e[i]);else for(;++i<r;)n.add(t(e[i],i,e))}return n}.prototype={constructor:Kt,has:Oh.has,add:function(e){return e+="",this["$"+e]=e,this},remove:Oh.remove,clear:Oh.clear,values:Oh.keys,size:Oh.size,empty:Oh.empty,each:Oh.each};var Ph=Array.prototype,Nh=Ph.map,Rh=Ph.slice,Fh={name:"implicit"},jh=function(e,t,n){e.prototype=t.prototype=n,n.constructor=e},Vh="\\s*([+-]?\\d+)\\s*",Hh="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Bh="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",zh=/^#([0-9a-f]{3})$/,$h=/^#([0-9a-f]{6})$/,Uh=new RegExp("^rgb\\("+[Vh,Vh,Vh]+"\\)$"),Gh=new RegExp("^rgb\\("+[Bh,Bh,Bh]+"\\)$"),Wh=new RegExp("^rgba\\("+[Vh,Vh,Vh,Hh]+"\\)$"),Xh=new RegExp("^rgba\\("+[Bh,Bh,Bh,Hh]+"\\)$"),Yh=new RegExp("^hsl\\("+[Hh,Bh,Bh]+"\\)$"),Kh=new RegExp("^hsla\\("+[Hh,Bh,Bh,Hh]+"\\)$"),Qh={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};jh(en,tn,{displayable:function(){return this.rgb().displayable()},toString:function(){return this.rgb()+""}}),jh(an,sn,Jt(en,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new an(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new an(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},toString:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}})),jh(un,function(e,t,n,i){return 1===arguments.length?cn(e):new un(e,t,n,null==i?1:i)},Jt(en,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new un(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new un(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new an(hn(e>=240?e-240:e+120,r,i),hn(e,r,i),hn(e<120?e+240:e-120,r,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));var Zh=Math.PI/180,Jh=180/Math.PI,ed=.95047,td=1,nd=1.08883,id=4/29,rd=6/29,od=3*rd*rd,sd=rd*rd*rd;jh(pn,function(e,t,n,i){return 1===arguments.length?dn(e):new pn(e,t,n,null==i?1:i)},Jt(en,{brighter:function(e){return new pn(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker:function(e){return new pn(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb:function(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return e=td*mn(e),t=ed*mn(t),n=nd*mn(n),new an(gn(3.2404542*t-1.5371385*e-.4985314*n),gn(-.969266*t+1.8760108*e+.041556*n),gn(.0556434*t-.2040259*e+1.0572252*n),this.opacity)}})),jh(bn,function(e,t,n,i){return 1===arguments.length?yn(e):new bn(e,t,n,null==i?1:i)},Jt(en,{brighter:function(e){return new bn(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker:function(e){return new bn(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb:function(){return dn(this).rgb()}}));var ad=-.14861,ld=1.78277,cd=-.29227,ud=-.90649,hd=1.97294,dd=hd*ud,pd=hd*ld,fd=ld*cd-ud*ad;jh(Cn,qn,Jt(en,{brighter:function(e){return e=null==e?1/.7:Math.pow(1/.7,e),new Cn(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?.7:Math.pow(.7,e),new Cn(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=isNaN(this.h)?0:(this.h+120)*Zh,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),i=Math.cos(e),r=Math.sin(e);return new an(255*(t+n*(ad*i+ld*r)),255*(t+n*(cd*i+ud*r)),255*(t+n*(hd*i)),this.opacity)}}));var md=function(e){return function(){return e}},gd=function e(t){function n(e,t){var n=i((e=sn(e)).r,(t=sn(t)).r),r=i(e.g,t.g),o=i(e.b,t.b),s=Dn(e.opacity,t.opacity);return function(t){return e.r=n(t),e.g=r(t),e.b=o(t),e.opacity=s(t),e+""}}var i=_n(t);return n.gamma=e,n}(1),vd=function(e,t){var n,i=t?t.length:0,r=e?Math.min(i,e.length):0,o=new Array(r),s=new Array(i);for(n=0;n<r;++n)o[n]=wd(e[n],t[n]);for(;n<i;++n)s[n]=t[n];return function(e){for(n=0;n<r;++n)s[n]=o[n](e);return s}},yd=function(e,t){var n=new Date;return e=+e,t-=e,function(i){return n.setTime(e+t*i),n}},bd=function(e,t){return e=+e,t-=e,function(n){return e+t*n}},xd=function(e,t){var n,i={},r={};null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={});for(n in t)n in e?i[n]=wd(e[n],t[n]):r[n]=t[n];return function(e){for(n in i)r[n]=i[n](e);return r}},qd=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Cd=new RegExp(qd.source,"g"),Sd=function(e,t){var n,i,r,o=qd.lastIndex=Cd.lastIndex=0,s=-1,a=[],l=[];for(e+="",t+="";(n=qd.exec(e))&&(i=Cd.exec(t));)(r=i.index)>o&&(r=t.slice(o,r),a[s]?a[s]+=r:a[++s]=r),(n=n[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:bd(n,i)})),o=Cd.lastIndex;return o<t.length&&(r=t.slice(o),a[s]?a[s]+=r:a[++s]=r),a.length<2?l[0]?An(l[0].x):Mn(t):(t=l.length,function(e){for(var n,i=0;i<t;++i)a[(n=l[i]).i]=n.x(e);return a.join("")})},wd=function(e,t){var n,i=typeof t;return null==t||"boolean"===i?md(t):("number"===i?bd:"string"===i?(n=tn(t))?(t=n,gd):Sd:t instanceof tn?gd:t instanceof Date?yd:Array.isArray(t)?vd:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?xd:bd)(e,t)},_d=function(e,t){return e=+e,t-=e,function(n){return Math.round(e+t*n)}};En(function(e,t){var n=t-e;return n?Sn(e,n>180||n<-180?n-360*Math.round(n/360):n):md(isNaN(e)?t:e)});var Dd=En(Dn),Md=function(e){return function(){return e}},Ad=function(e){return+e},Ed=[0,1],Id=function(e,t,n){var i,r=e[0],o=e[e.length-1],s=Wt(r,o,null==t?10:t);switch((n=Se(null==n?",f":n)).type){case"s":var a=Math.max(Math.abs(r),Math.abs(o));return null!=n.precision||isNaN(i=Qu(s,a))||(n.precision=i),Gu(n,a);case"":case"e":case"g":case"p":case"r":null!=n.precision||isNaN(i=Zu(s,Math.max(Math.abs(r),Math.abs(o))))||(n.precision=i-("e"===n.type));break;case"f":case"%":null!=n.precision||isNaN(i=Ku(s))||(n.precision=i-2*("%"===n.type))}return Uu(n)},Td=function(e){return e.match(/.{6}/g).map(function(e){return"#"+e})};Td("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf"),Td("393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6"),Td("3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9"),Td("1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5"),Dd(qn(300,.5,0),qn(-240,.5,1));Dd(qn(-100,.75,.35),qn(80,1.5,.8)),Dd(qn(260,.75,.35),qn(80,1.5,.8)),qn();var Ld=function(e){return e.min()},kd=function(e){return e.max()},Od=function(e){return"number"==typeof e&&!isNaN(e)},Pd=["min","max","expand","include","invert"],Nd=["padding","paddingOuter","paddingInner","align","invert","maxPxStep"],Rd=Ce();Rd("linear",li),Rd("band",hi),Rd("h-band",fi),Rd("sequential-color",gi),Rd("threshold-color",function(){function e(e){return Hn(e)?NaN:r(e)}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).theme,r=jn();Object.keys(r).forEach(function(t){return e[t]=r[t]});var o=Vn(t,n.fields),s=ou(o,2),a=s[0],l=s[1],c=t.domain?t.domain.length:-1,u=i.palette("sequential",c>0?c:2),h=t.range||u,d=t.domain||(t.nice?xi(h,a,l):[a+(l-a)/2]);return h.length>d.length+1?d=vi(h,a,l):h.length<d.length+1&&(h=bi(d,h,a,l)),e.data=function(){return n},e.range(h),e.range(t.invert?e.range().reverse():e.range()),e.domain(d),e}),Rd("categorical-color",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).theme,i=qi(e,t),r=void 0;if(r=e.range?e.range.slice():n?n.palette("categorical",i.domain().length).slice():[],e.unknown)i.unknown(e.unknown);else if(n&&n.palette("unknown")){var o=n.palette("unknown");i.unknown(o[0])}if(e.explicit&&e.explicit.domain){var s=i.domain().slice(),a=e.explicit.domain||[];if(a.length){for(var l=Math.floor(s.length/r.length),c=1;c<l+1;c*=2)r=r.concat(r);var u=e.explicit.range||[];a.map(function(e,t){return[s.indexOf(e),e,u[t]]}).sort(function(e,t){return e[0]-t[0]}).forEach(function(e){var t=s.indexOf(e[1]);-1!==t&&r.splice(t,0,e[2])}),r.length=s.length}}return i.range(r),i});var Fd={};Fd.isObject=function(e){return"object"==typeof e&&null!==e},Fd.isNumber=function(e){return"number"==typeof e},Fd.isUndefined=function(e){return void 0===e},Fd.isFunction=function(e){return"function"==typeof e};var jd=Mi;Mi.EventEmitter=Mi,Mi.prototype._events=void 0,Mi.prototype._maxListeners=void 0,Mi.defaultMaxListeners=10,Mi.init=function(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0},Mi.prototype.setMaxListeners=function(e){if(!Fd.isNumber(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},Mi.prototype.emit=function(e){var t,n,i,r,o,s;if(this._events||(this._events={}),"error"===e&&!this._events.error)throw(t=arguments[1])instanceof Error?t:Error('Uncaught, unspecified "error" event.');if(n=this._events[e],Fd.isUndefined(n))return!1;if(Fd.isFunction(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,r=new Array(i-1),o=1;o<i;o++)r[o-1]=arguments[o];n.apply(this,r)}else if(Fd.isObject(n)){for(i=arguments.length,r=new Array(i-1),o=1;o<i;o++)r[o-1]=arguments[o];for(i=(s=n.slice()).length,o=0;o<i;o++)s[o].apply(this,r)}return!0},Mi.prototype.addListener=function(e,t){if(!Fd.isFunction(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,Fd.isFunction(t.listener)?t.listener:t),this._events[e]?Fd.isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,Fd.isObject(this._events[e])&&!this._events[e].warned){var n;(n=Fd.isUndefined(this._maxListeners)?Mi.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,Fd.isFunction(console.error)&&console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),Fd.isFunction(console.trace)&&console.trace())}return this},Mi.prototype.on=Mi.prototype.addListener,Mi.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!Fd.isFunction(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},Mi.prototype.removeListener=function(e,t){var n,i,r,o;if(!Fd.isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],r=n.length,i=-1,n===t||Fd.isFunction(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(Fd.isObject(n)){for(o=r;o-- >0;)if(n[o]===t||n[o].listener&&n[o].listener===t){i=o;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},Mi.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],Fd.isFunction(n))this.removeListener(e,n);else if(Array.isArray(n))for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},Mi.prototype.listeners=function(e){return this._events&&this._events[e]?Fd.isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},Mi.listenerCount=function(e,t){return e._events&&e._events[t]?Fd.isFunction(e._events[t])?1:e._events[t].length:0};var Vd={mixin:function(e){return Object.keys(jd.prototype).forEach(function(t){e[t]=jd.prototype[t]}),jd.init(e),e}},Hd=(Ce(),Ce()),Bd=[],zd=(function e(t){function n(e){return Math.pow(e,t)}return t=+t,n.exponent=e,n}(3),function e(t){function n(e){return 1-Math.pow(1-e,t)}return t=+t,n.exponent=e,n}(3),function e(t){function n(e){return((e*=2)<=1?Math.pow(e,t):2-Math.pow(2-e,t))/2}return t=+t,n.exponent=e,n}(3),function e(t){function n(e){return e*e*((t+1)*e-t)}return t=+t,n.overshoot=e,n}(1.70158),function e(t){function n(e){return--e*e*((t+1)*e+t)+1}return t=+t,n.overshoot=e,n}(1.70158),function e(t){function n(e){return((e*=2)<1?e*e*((t+1)*e-t):(e-=2)*e*((t+1)*e+t)+2)/2}return t=+t,n.overshoot=e,n}(1.70158),2*Math.PI),$d=(function e(t,n){function i(e){return t*Math.pow(2,10*--e)*Math.sin((r-e)/n)}var r=Math.asin(1/(t=Math.max(1,t)))*(n/=zd);return i.amplitude=function(t){return e(t,n*zd)},i.period=function(n){return e(t,n)},i}(1,.3),function e(t,n){function i(e){return 1-t*Math.pow(2,-10*(e=+e))*Math.sin((e+r)/n)}var r=Math.asin(1/(t=Math.max(1,t)))*(n/=zd);return i.amplitude=function(t){return e(t,n*zd)},i.period=function(n){return e(t,n)},i}(1,.3)),Ud=(function e(t,n){function i(e){return((e=2*e-1)<0?t*Math.pow(2,10*e)*Math.sin((r-e)/n):2-t*Math.pow(2,-10*e)*Math.sin((r+e)/n))/2}var r=Math.asin(1/(t=Math.max(1,t)))*(n/=zd);return i.amplitude=function(t){return e(t,n*zd)},i.period=function(n){return e(t,n)},i}(1,.3),function(e){return["on","preferredSize","created","beforeMount","mounted","resize","beforeUpdate","updated","beforeRender","render","beforeDestroy","destroyed","defaultSettings","data","settings","formatter","scale","chart","dockConfig","mediator","style"].some(function(t){return t===e})}),Gd=function(){function e(){Jc(this,e)}return eu(e,null,[{key:"testCirclePoint",value:function(e,t){return!vr(e)&&h({x:e.cx,y:e.cy},t)<=Math.pow(e.r,2)}},{key:"testCircleRect",value:function(e,t){if(gr(t)||vr(e))return!1;var n=t.width/2,i=t.height/2,r=t.x+n,o=t.y+i,s=e.r,a=e.cx,l=e.cy,c=Math.abs(a-r),u=Math.abs(l-o);return!(c>n+s||u>i+s)&&(c<=n||u<=i||Math.pow(c-n,2)+Math.pow(u-i,2)<=Math.pow(s,2))}},{key:"testCircleLine",value:function(t,n){if(vr(t)||mr(n))return!1;var i=y(n),r=ou(i,2),o=r[0],s=r[1];if(e.testCirclePoint(t,o)||e.testCirclePoint(t,s))return!0;var a={x:t.cx,y:t.cy},l=g(o,s,a);return h(l,a)<=Math.pow(t.r,2)&&v(o,s,l)}},{key:"testCircleCircle",value:function(e,t){if(vr(e)||vr(t))return!1;var n=e.cx-t.cx,i=e.cy-t.cy;return Math.pow(n,2)+Math.pow(i,2)<=Math.pow(e.r+t.r,2)}},{key:"testCirclePolygon",value:function(t,n){if(yr(n)||vr(t))return!1;var i={x:t.cx,y:t.cy};if(e.testPolygonPoint(n,i))return!0;for(var r=n.edges.length,o=0;o<r;o++){var s=S(n.edges[o]);if(e.testCircleLine(t,s))return!0}return!1}},{key:"testPolygonPoint",value:function(t,n){if(yr(t)||!e.testRectPoint(q(t.bounds()),n))return!1;for(var i=!0,r=t.vertices.length,o=x(t.vertices),s={x:ou(o,1)[0]-1,y:n.y},a=0;a<r-1;a++){var l=S(t.edges[a]);l.y1<n.y&&l.y2<n.y||l.y1>n.y&&l.y2>n.y||(i=e.testLineLine(l,S([s,n]))?!i:i)}return!i}},{key:"testPolygonLine",value:function(t,n){if(yr(t))return!1;for(var i=0,r=t.edges.length;i<r;i++){var o=S(t.edges[i]);if(e.testLineLine(n,o))return!0}var s=y(n),a=ou(s,2),l=a[0],c=a[1];return e.testPolygonPoint(t,l)||e.testPolygonPoint(t,c)}},{key:"testPolygonRect",value:function(t,n){if(yr(t))return!1;for(var i=0,r=t.edges.length;i<r;i++){var o=S(t.edges[i]);if(e.testRectLine(n,o))return!0}var s=b(n),a=ou(s,4),l=a[0],c=a[1],u=a[2],h=a[3];return e.testPolygonPoint(t,l)||e.testPolygonPoint(t,c)||e.testPolygonPoint(t,u)||e.testPolygonPoint(t,h)}},{key:"testRectRect",value:function(e,t){return!gr(e)&&!gr(t)&&(e.x<=t.x+t.width&&t.x<=e.x+e.width&&e.y<=t.y+t.height&&t.y<=e.y+e.height)}},{key:"testRectPoint",value:function(e,t){return!gr(e)&&(t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height)}},{key:"testRectLine",value:function(t,n){if(mr(n)||gr(t))return!1;var i=y(n),r=ou(i,2),o=r[0],s=r[1];if(e.testRectPoint(t,o)||e.testRectPoint(t,s))return!0;for(var a=b(t),l=a.length,c=0;c<l;c++){var u=S([a[c],a[3!==c?c+1:0]]);if(e.testLineLine(u,n))return!0}return!1}},{key:"testLineLine",value:function(e,t){var n=y(e),i=ou(n,2),r=i[0],o=i[1],s=y(t),a=ou(s,2),l=a[0],h=a[1],d=c(o,r),p=u(o,r),f=c(h,l),m=u(h,l),g=c(r,l),v=u(r,l),b=m*d-f*p,x=f*v-m*g,q=d*v-p*g,C=void 0,S=void 0;if(0===d&&0===p)return!1;if(0===f&&0===m)return!1;if(0===b){if(0===x&&0===q){if(0===d){if(0===p)return r.x===o.x&&r.y===o.y;C=u(l,r)/p,S=u(h,r)/p}else C=(l.x-r.x)/d,S=(h.x-r.x)/d;return!(C<0&&S<0||C>1&&S>1)}return!1}var w=x/b;return b=q/b,w>=0&&w<=1&&b>=0&&b<=1}},{key:"testLinePoint",value:function(e,t){if(mr(e))return!1;var n=y(e),i=ou(n,2);return v(i[0],i[1],t)}}]),e}(),Wd=/^\$/,Xd="@extend",Yd=function(e){return["on","created","beforeMount","mounted","resize","beforeUpdate","updated","beforeRender","render","beforeDestroy","destroyed","data","settings"].some(function(t){return t===e})};Sr.mixin=function(e){Qc.push(e)};var Kd=function(e){var t=Ce(e);return t.prio=function(e){return e?t.default(e[0]):[t.default()]},t.types=function(){return t.getKeys()},t},Qd=Ce(),Zd={numeric:function(e){return e.filter(function(e){return"number"==typeof e&&!isNaN(e)})}},Jd={sum:function(e){return e.reduce(function(e,t){return e+t},0)}},ep={first:function(e){return e[0]},last:function(e){return e[e.length-1]},min:function(e){var t=Zd.numeric(e);return t.length?Math.min.apply(null,t):NaN},max:function(e){var t=Zd.numeric(e);return t.length?Math.max.apply(null,t):NaN},sum:function(e){var t=Zd.numeric(e);return t.length?t.reduce(function(e,t){return e+t},0):NaN},avg:function(e){var t=Zd.numeric(e),n=t.length;return n?Jd.sum(t)/n:NaN}},tp={numeric:function(e){return e.filter(function(e){return"number"==typeof e&&!isNaN(e)})}};kr.util={normalizeConfig:Mr,collect:Ar,track:Er};var np=Ce();np.default("matrix"),np("matrix",kr),np("default",kr);var ip=Ce();ip("native",function(e,t,n){function i(e){c=e.key,(l=e).events=l.events||[],void 0===l.enable&&(l.enable=!0)}function r(){"function"==typeof l.enable&&(l.enable=l.enable.bind(s)()),l.enable&&Object.keys(l.events).forEach(function(e){var t=l.events[e].bind(s);n.addEventListener(e,t),a.push({key:e,listener:t})})}function o(){a.forEach(function(e){var t=e.key,i=e.listener;n.removeEventListener(t,i)}),a=[]}var s={chart:e,mediator:t,element:n},a=[],l=void 0,c=void 0,u=!0;return{get key(){return c},set:function(e){i(e),o(),u&&r()},off:function(){u=!1,o()},on:function(){u=!0,0===a.length&&r()},destroy:function(){o(),s=null,l=null}}}),"undefined"!=typeof window&&function(e){function t(e){var t=e.match(c);return t?t.map(Number):[]}function n(e){var n=[];return e.replace(l,function(e,i,r){var o=i.toLowerCase();for(r=t(r),"m"===o&&r.length>2&&(n.push([i].concat(r.splice(0,2))),o="l",i="m"===i?"l":"L");r.length!==a[o];){if(r.length<a[o])throw new Error("malformed path data");n.push([i].concat(r.splice(0,a[o])))}return r.unshift(i),n.push(r)}),n}function i(e){this.segments=[],e&&(this.segments=n(e))}function r(e,t){var n=e.x*Math.cos(t)-e.y*Math.sin(t),i=e.y*Math.cos(t)+e.x*Math.sin(t);e.x=n,e.y=i}function o(e,t,n){e.x+=t,e.y+=n}function s(e,t){var n=void 0,i=void 0,s=void 0,a=void 0,l=void 0,c=void 0,u=void 0,h=void 0,d=void 0,p=void 0,f=void 0,m=void 0,g={x:0,y:0};e.beginPath();for(var v=0;v<t.length;++v){var y=t[v];switch(f=y[0]){case"m":case"M":"m"===f?(u=g.x+y[1],h=g.y+y[2]):(u=y[1],h=y[2]),e.moveTo(u,h),g.x=u,g.y=h;break;case"l":case"L":"l"===f?(u=g.x+y[1],h=g.y+y[2]):(u=y[1],h=y[2]),e.lineTo(u,h),g.x=u,g.y=h;break;case"a":case"A":"a"===f?(u=g.x+y[6],h=g.y+y[7]):(u=y[6],h=y[7]),d=y[1],s=y[4],a=y[5],o(l={x:u,y:h},-g.x,-g.y),r(l,-(c=Math.atan2(l.y,l.x))),p=l.x/2,(m={x:0,y:0}).x=l.x/2,m.y=a&&!s||!a&&s?Math.sqrt(d*d-p*p):-Math.sqrt(d*d-p*p),i=Math.atan2(-m.y,-m.x),n=Math.atan2(l.y-m.y,l.x-m.x),i+=c,n+=c,r(l,c),r(m,c),o(l,g.x,g.y),o(m,g.x,g.y),e.arc(m.x,m.y,d,i,n,!a),g.x=u,g.y=h;break;case"z":case"Z":e.closePath();break;default:throw new Error(f+" is not implemented")}}}if(e&&(!e.Path2D||!Or(e))){var a={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},l=/([astvzqmhlc])([^astvzqmhlc]*)/gi,c=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;i.prototype.moveTo=function(e,t){this.segments.push(["M",e,t])},i.prototype.lineTo=function(e,t){this.segments.push(["L",e,t])},i.prototype.arc=function(e,t,n,i,r,o){this.segments.push(["AC",e,t,n,i,r,!!o])},i.prototype.closePath=function(){this.segments.push(["Z"])};var u=e.CanvasRenderingContext2D.prototype.fill,h=e.CanvasRenderingContext2D.prototype.stroke;e.CanvasRenderingContext2D.prototype.fill=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i="nonzero";0===t.length||1===t.length&&"string"==typeof t[0]?u.apply(this,t):(2===arguments.length&&(i=t[1]),s(this,t[0].segments),u.call(this,i))},e.CanvasRenderingContext2D.prototype.stroke=function(e){e?(s(this,e.segments),h.call(this)):h.call(this)},e.Path2D=i}}(window);var rp=function(e){function t(t){if(e[t.type]&&e[t.type].condition(t)){var n=e[t.type],i=void 0===n.conditionAppend||n.conditionAppend(t);n.items.forEach(function(e){var n=Math.round(t[e.key]),r=t[e.key]-n;t[e.key]=n,i&&"append"===e.type&&(r>0?t[e.key]+=.5:t[e.key]-=.5)})}}return void 0===e&&((e={}).line={append:["x1","x2","y1","y2"],round:[],condition:function(e){return e.x1===e.x2||e.y1===e.y2},conditionAppend:function(e){return e.strokeWidth%2!=0}},e.rect={append:["x","y"],round:["width","height"],condition:function(){return!0},conditionAppend:function(e){return e.strokeWidth%2!=0}}),Object.keys(e).forEach(function(t){var n=e[t];n.items=[],n.append.forEach(function(e){n.items.push({key:e,type:"append"})}),n.round.forEach(function(e){n.items.push({key:e,type:"round"})})}),t.multiple=function(e){return e.forEach(function(e){return t(e)})},t}(),op=function(){function e(){Jc(this,e),this.reset(),this.push.apply(this,arguments)}return eu(e,[{key:"transposeCoordinate",value:function(e,t,n){if("number"==typeof t&&isFinite(t)){var i=e.substring(0,1);if("x"===i||"cx"===e)return t*this.width;if("width"===e)return t*this.width;if("r"===e)return t*(n?this.height:this.width);if("y"===i||"cy"===e)return t*this.height;if("height"===e)return t*this.height}return t}},{key:"push",value:function(){var e;return(e=this.storage).push.apply(e,arguments),this}},{key:"processItem",value:function(t){var n={},i=void 0!==t.flipXY?t.flipXY:this.flipXY,r=void 0!==t.crisp?t.crisp:this.crisp;if(t.fn&&"function"==typeof t.fn){var o=i?this.height:this.width,s=i?this.width:this.height;t=t.fn({width:o,height:s,flipXY:i});for(var a=Object.keys(t),l=0,c=a.length;l<c;l++){var u=a[l];n[e.evaluateKey(u,i)]=t[u]}}else for(var h=Object.keys(t),d=0,p=h.length;d<p;d++){var f=h[d],m=e.evaluateKey(f,i),g=this.transposeCoordinate(m,t[f],i);n[m]=g}return r&&rp(n),n}},{key:"output",value:function(){for(var e=[],t=0,n=this.storage.length;t<n;t++){var i=this.processItem(this.storage[t]);e.push(i)}return e}},{key:"reset",value:function(){this.storage=[],this.flipXY=!1,this.crisp=!1,this.width=0,this.height=0}}],[{key:"evaluateKey",value:function(e,t){if(t){var n=e.substring(0,1),i=e.substring(1);if("x"===n)return"y"+i;if("y"===n)return"x"+i;if("cx"===e)return"cy";if("cy"===e)return"cx";if("width"===e)return"height";if("height"===e)return"width"}return e}}]),e}(),sp={fontFamily:"Arial",fontSize:"13px",color:"#595959",backgroundColor:"#ffffff",stroke:"#000000",strokeWidth:0,$fill:"#333333"},ap=/^\$/,lp={line:{show:!0,stroke:"#000",strokeWidth:1},median:{show:!0,stroke:"#000",strokeWidth:1},whisker:{show:!0,stroke:"#000",strokeWidth:1,fill:"",type:"line",width:1},box:{show:!0,fill:"#fff",stroke:"#000",strokeWidth:1,width:1,maxWidthPx:100,minWidthPx:1,minHeightPx:1}},cp={require:["chart"],defaultSettings:{settings:{},data:{},style:{box:"$shape",line:"$shadow-line",whisker:"$shadow-line",median:{"@extend":"$shadow-line",stroke:"$primary-overlay"}}},created:function(){this.rect={x:0,y:0,width:0,height:0},this.dispersion=zr(this.chart,lp,this.settings.settings),this.updateSettings(this.settings)},updateSettings:function(e){this.dispersion.updateSettings(e,this.style),void 0===this.settings.settings.orientation&&(this.settings.settings.orientation="vertical"),void 0===this.settings.settings.whiskers&&(this.settings.settings.whiskers=!0)},beforeRender:function(e){this.rect=e.size},render:function(e){var t=e.data;return this.boxWidth=this.dispersion.bandwidth()*this.rect.width,this.dispersion.onData(t,this.rect),this.dispersion.render(this.rect,this.buildShapes)},beforeUpdate:function(e){var t=e.settings;this.updateSettings(t)},buildShapes:function(e){function t(e){var t=Math.floor(l*e),i=Math.floor((l+n.style.box.width*s)*e);return{majorStartModified:t,majorEnd:i,boxWidth:$r(n.style.box.minWidthPx,n.style.box.maxWidthPx,i-t)}}var n=e.item,i=e.blueprint,r=e.doodle;if(Hn(n.major))return[];var o=[],s=this.dispersion.bandwidth(),a=n.majorEnd-n.majorStart,l=n.major;if(null===n.majorStart||isNaN(a)||(l=n.majorStart+.5*a,s=Math.abs(a)),n.style.box.show&&!Hn(n.start)&&!Hn(n.end)){var c=Math.max(n.start,n.end),u=Math.min(n.start,n.end);o.push(i.processItem({fn:function(e){var i=e.width,o=e.height,s=$r(-100,o+200,Math.floor(c*o)),a=$r(-100,o+200,Math.floor(u*o)),l=t(i),h=l.majorStartModified,d=l.boxWidth,p=s-a,f=Math.max(n.style.box.minHeightPx,p),m=(f-p)/2;return Yc(!0,r.style({},"box",n.style),{type:"rect",x:h-Math.floor(d/2),y:a-m,height:f,width:d})},crisp:!0}))}return!n.style.line.show||Hn(n.min)||Hn(n.start)||o.push(i.processItem({fn:function(e){var i=e.width,o=e.height,s=t(i).majorStartModified;return Yc(r.style({},"line",n.style),{type:"line",y1:Math.floor(n.start*o),x1:s,y2:Math.floor(n.min*o),x2:s})},crisp:!0})),!n.style.line.show||Hn(n.max)||Hn(n.end)||o.push(i.processItem({fn:function(e){var i=e.width,o=e.height,s=t(i).majorStartModified;return Yc(r.style({},"line",n.style),{type:"line",y1:Math.floor(n.max*o),x1:s,y2:Math.floor(n.end*o),x2:s})},crisp:!0})),n.style.median.show&&!Hn(n.med)&&o.push(i.processItem({fn:function(e){var i=e.width,o=e.height,s=t(i),a=s.majorStartModified,l=s.boxWidth;return Yc(r.style({},"median",n.style),{type:"line",y1:n.med*o,x1:a-Math.floor(l/2),y2:n.med*o,x2:a+Math.floor(l/2)})},crisp:!0})),n.style.whisker.show&&(Hn(n.min)||o.push(i.processItem({fn:function(e){var i=e.width,o=e.height,s=t(i),a=s.majorStartModified,l=s.boxWidth*n.style.whisker.width;return Yc(r.style({type:"line"},"whisker",n.style),{y1:Math.floor(n.min*o),x1:a-Math.floor(l/2),y2:Math.floor(n.min*o),x2:a+Math.floor(l/2),cx:a,cy:Math.floor(n.min*o),width:l,r:l/2})},crisp:!0})),Hn(n.max)||o.push(i.processItem({fn:function(e){var i=e.width,o=e.height,s=t(i),a=s.majorStartModified,l=s.boxWidth*n.style.whisker.width;return Yc(r.style({type:"line"},"whisker",n.style),{y1:Math.floor(n.max*o),x1:a-Math.floor(l/2),y2:Math.floor(n.max*o),x2:a+Math.floor(l/2),cx:a,cy:Math.floor(n.max*o),width:l,r:l/2})},crisp:!0}))),o}},up={fill:"fill",stroke:"stroke",opacity:"opacity",strokeWidth:"stroke-width",fontFamily:"font-family",fontSize:"font-size",baseline:"dominant-baseline",dominantBaseline:"dominant-baseline",anchor:"text-anchor",textAnchor:"text-anchor",maxWidth:"maxWidth",transform:"transform",strokeDasharray:"stroke-dasharray",id:"id"},hp={up:0,down:180,left:90,right:-90},dp=Ce();dp.add("circle",function(e){return{type:"circle",fill:"black",cx:e.x,cy:e.y,r:e.size/2,collider:{type:"circle"}}}),dp.add("diamond",function(e){var t=e.size,n=e.x-t/2,i=e.y-t/2;return{type:"path",fill:"black",d:B([{x:n,y:i+t/2},{x:n+t/2,y:i},{x:n+t,y:i+t/2},{x:n+t/2,y:i+t},{x:n,y:i+t/2}])}}),dp.add("saltire",function(e){var t=zn(45),n=e.size/2,i=isNaN(e.width)?n/2:e.width,r=Math.min(i,n),o=e.size,s=Math.sin(Math.asin(-t))*(r/2);o+=2*(n/Math.sin(-t)-n),o-=2*s;var a={x:e.x,y:e.y};return{type:"path",fill:"black",d:B(Gr(e.x,e.y,o,r).map(function(e){return m(e,t,a)}))}}),dp.add("square",function(e){var t=e.size;return{type:"rect",fill:"black",x:e.x-t/2,y:e.y-t/2,width:t,height:t}}),dp.add("triangle",Wr),dp.add("line",function(e){var t="vertical"===e.direction,n=e.size/2,i=e.x,r=e.y;return{type:"line",stroke:"black",strokeWidth:1,x1:i-(t?0:n),y1:r-(t?n:0),x2:i+(t?0:n),y2:r+(t?n:0)}}),dp.add("star",function(e){for(var t=e.size,n=[],i=t/2,r=e.points||5,o=Math.min(e.innerRadius||t/2,t)/2,s=isNaN(e.startAngle)?90:e.startAngle,a=360/r,l=1;l<=r;l++){var c=a*l+s,u=zn(c),h=zn(c+a/2),d=Math.sin(u),p=Math.cos(u),f=Math.sin(h),m=Math.cos(h);n.push({x:e.x+p*i,y:e.y+d*i}),n.push({x:e.x+m*o,y:e.y+f*o})}return{type:"path",fill:"black",d:B(n)}}),dp.add("n-polygon",function(e){for(var t=[],n=e.size/2,i=Math.max(isNaN(e.sides)?6:e.sides,3),r=360/i,o=isNaN(e.startAngle)?0:e.startAngle,s=1;s<=i;s++){var a=zn(r*s+o),l=Math.sin(a),c=Math.cos(a);t.push({x:e.x+c*n,y:e.y+l*n})}return{type:"path",fill:"black",d:B(t)}}),dp.add("cross",function(e){var t=e.x,n=e.y,i=e.size/2,r=isNaN(e.width)?i/2:e.width,o=Math.min(r,i);return{type:"path",fill:"black",d:B(Gr(t,n,e.size,o))}}),dp.add("bar",function(e){var t={x:e.x,y:e.y},n="vertical"===e.direction,i=e.size/2,r=i/2/2,o=[{x:t.x-i,y:t.y+r},{x:t.x-i,y:t.y-r},{x:t.x+i,y:t.y-r},{x:t.x+i,y:t.y+r}];if(n){var s=zn(90);o=o.map(function(e){return m(e,s,t)})}var a=q(o);return a.type="rect",a.fill="black",a.collider={type:"rect"},a});var pp={errorShape:{shape:"saltire",width:2,size:.5,fill:"#333",stroke:"#333",strokeWidth:0}},fp={shape:"circle",label:"",fill:"#333",stroke:"#ccc",strokeWidth:0,opacity:1,x:.5,y:.5,size:1,strokeDasharray:""},mp={maxPx:1e4,minPx:1,maxRelExtent:.1,minRelExtent:.01,maxRelDiscrete:1,minRelDiscrete:.1},gp={require:["chart"],defaultSettings:{settings:{},data:{},animations:{enabled:!1,trackBy:function(e){return e.data.value}},style:{item:"$shape"}},created:function(){this.rect={x:0,y:0,width:0,height:0},this.updateSettings(this.settings)},updateSettings:function(e){var t=this.chart;this.local=Jr(e.settings,t,this.style)},beforeUpdate:function(e){this.updateSettings(e.settings)},beforeRender:function(e){this.rect=e.size},render:function(e){var t=this,n=e.data,i=this.rect,r=i.width,o=i.height;Vr(this.local,"x",r),Vr(this.local,"y",o);var s=Yc({},mp,this.settings.settings.sizeLimits),a=(n.items||[]).map(function(e,n,i){var r=jr(e,t.local,i);return r.errorShape=jr(e,t.local.errorShape,i),r.data=e,r}),l=Zr(this.local.x,this.local.y,r,o,s);return eo(a,this.rect,l,this.settings.shapeFn||Kr)}},vp="point-marker",yp={shape:"pie",label:"",fill:"#999",stroke:"#ccc",strokeWidth:1,opacity:1,arc:.25,innerRadius:0,outerRadius:.5,cornerRadius:1,offset:0},bp={require:["chart"],defaultSettings:{settings:{startAngle:0,endAngle:2*Math.PI,padAngle:0,slice:{}},data:{}},created:function(){this.rect={x:0,y:0,width:0,height:0},this.updateSettings(this.settings)},updateSettings:function(e){var t=this.chart;this.local=Fr(e.settings.slice,yp,t)},beforeUpdate:function(e){this.updateSettings(e)},beforeRender:function(e){this.rect=e.size},render:function(e){var t=this,n=e.data;this.updateSettings(this.settings);var i=[],r=this.settings.settings,o=(n.items||[]).map(function(e,n,r){var o=jr(e,t.local,r);return o.data=e,i.push(e.arc.value),o}),s=Eu().sortValues(null);return s.startAngle(r.startAngle),s.endAngle(r.endAngle),s.padAngle(r.padAngle),no(s(i),this.rect,o)}},xp={created:function(){},require:["chart","renderer"],defaultSettings:{displayOrder:0,styles:{}},beforeRender:function(e){this.rect=e.size,this.blueprint=Nr(),this.blueprint.width=this.rect.width,this.blueprint.height=this.rect.height,this.blueprint.x=this.rect.x,this.blueprint.y=this.rect.y,this.blueprint.crisp=!0},render:function(){var e=this;if(this.x=this.settings.x?this.chart.scale(this.settings.x):null,this.y=this.settings.y?this.chart.scale(this.settings.y):null,Vr(this,"x",this.rect.width),Vr(this,"y",this.rect.height),!this.x&&!this.y)return[];var t={labels:{show:!0,tiltAngle:40,maxEdgeBleed:1/0,fontFamily:"Arial",fontSize:"12px",fill:"#595959",margin:4,maxLengthPx:150,mode:"horizontal"},line:{show:!0,strokeWidth:1,stroke:"#cccccc"},ticks:{show:!0,margin:0,tickSize:8,stroke:"#cccccc",strokeWidth:1},minorTicks:{show:!1,margin:0,tickSize:3,stroke:"#E6E6E6",strokeWidth:1}};this.settings.ticks=Yc({},t.ticks,this.settings.ticks||{}),this.settings.minorTicks=Yc({},t.minorTicks,this.settings.minorTicks||{}),this.lines={x:[],y:[]},this.lines.x=io(this.x,this.rect.width),this.lines.y=io(this.y,this.rect.height),this.lines.y=this.lines.y.map(function(e){return Yc(e,{flipXY:!0})});var n={};return[].concat(su(this.lines.x),su(this.lines.y)).forEach(function(t){(n=t.isMinor?e.settings.minorTicks:e.settings.ticks).show&&e.blueprint.push({type:"line",x1:t.position,y1:0,x2:t.position,y2:1,stroke:n.stroke||"black",strokeWidth:n.strokeWidth||1,flipXY:t.flipXY||!1})}),this.blueprint.output()}},qp={require:["chart","renderer","dockConfig"],defaultSettings:{displayOrder:0,style:{oob:{show:!0,width:10,fill:"#1A1A1A",stroke:"transparent",strokeWidth:0,opacity:1,text:{fontFamily:"Arial",stroke:"transparent",fill:"#fff",strokeWidth:0,opacity:1},triangle:{fill:"#4D4D4D",stroke:"transparent",strokeWidth:0,opacity:1},padding:{x:28,y:5}},line:{stroke:"#000"},label:{strokeWidth:0}}},preferredSize:function(){return 30},beforeRender:function(e){this.rect=e.size,this.blueprint=Nr(),this.blueprint.width=this.rect.width,this.blueprint.height=this.rect.height,this.blueprint.x=this.rect.x,this.blueprint.y=this.rect.y,this.blueprint.crisp=!0},render:function(){var e=this,t=this.settings;if(this.lines={x:[],y:[]},this.lines.x=t.lines&&t.lines.x||[],this.lines.y=t.lines&&t.lines.y||[],0===this.lines.x.length&&0===this.lines.y.length)return[];var n={x0:[],x1:[],y0:[],y1:[]};this.lines.x=this.lines.x.filter(ho).map(function(t){if(t.scale){var n=e.chart.scale(t.scale);return Yc(t,{scale:n,position:n(t.value)})}return Yc(t,{position:t.value})}),this.lines.y=this.lines.y.filter(ho).map(function(t){if(t.scale){var n=e.chart.scale(t.scale);return Yc(t,{scale:n,position:n(t.value),flipXY:!0})}return Yc(t,{position:t.value,flipXY:!0})}),this.lines.x=this.lines.x.filter(function(e){return!(e.position<0||e.position>1)||(n["x"+(e.position>1?1:0)].push(uo(e)),!1)}),this.lines.y=this.lines.y.filter(function(e){return!(e.position<0||e.position>1)||(n["y"+(e.position>1?1:0)].push(uo(e)),!1)});var i=[];return[].concat(su(this.lines.x),su(this.lines.y)).forEach(function(n){(!0===n.show||void 0===n.show)&&co({chart:e.chart,blueprint:e.blueprint,renderer:e.renderer,p:n,settings:t,items:i})}),t.style.oob.show&&so({blueprint:this.blueprint,oob:n,settings:t,items:i}),i}},Cp={fontFamily:"Arial",fontSize:"13px",color:"#595959",fill:"#333333",backgroundColor:"#ffffff",stroke:"#000000",strokeWidth:0},Sp={require:["chart","renderer","dockConfig"],defaultSettings:{displayOrder:0,prioOrder:0,paddingStart:0,paddingEnd:10},created:function(){this.state={isDiscrete:!!this.scale.bandwidth,isHorizontal:!1,labels:{activeMode:"horizontal"},ticks:[],innerRect:{width:0,height:0,x:0,y:0},outerRect:{width:0,height:0,x:0,y:0},defaultStyleSettings:void 0,defaultDock:void 0,concreteNodeBuilder:void 0,settings:void 0},this.state.isDiscrete?(this.state.defaultStyleSettings={labels:{show:!0,tiltAngle:40,maxEdgeBleed:1/0,fontFamily:"Arial",fontSize:"12px",fill:"#595959",margin:6,maxLengthPx:150,mode:"auto",maxGlyphCount:NaN},line:{show:!1,strokeWidth:1,stroke:"#cccccc"},ticks:{show:!1,margin:0,tickSize:4,stroke:"#cccccc",strokeWidth:1}},this.state.defaultDock="bottom"):(this.state.defaultStyleSettings={labels:{show:!0,tiltAngle:40,maxEdgeBleed:1/0,fontFamily:"Arial",fontSize:"12px",fill:"#595959",margin:4,maxLengthPx:150,mode:"horizontal"},line:{show:!0,strokeWidth:1,stroke:"#cccccc"},ticks:{show:!0,margin:0,tickSize:8,stroke:"#cccccc",strokeWidth:1},minorTicks:{show:!1,margin:0,tickSize:3,stroke:"#E6E6E6",strokeWidth:1}},this.state.defaultDock="left"),this.setState(this.settings)},setState:function(e){var t=this;this.state.isDiscrete=!!this.scale.bandwidth;var n=ps(e.settings,this.state.defaultStyleSettings,this.chart);this.state.settings=Yc(!0,{},this.settings,e.settings,n);var i=void 0!==this.state.settings.dock?this.state.settings.dock:this.state.defaultDock;this.state.concreteNodeBuilder=Jo(this.state.isDiscrete),this.state.settings.dock=i,this.state.settings.align=ds(this.state.settings.align,i),this.state.settings.labels.tiltAngle=Math.max(-90,Math.min(this.state.settings.labels.tiltAngle,90)),this.dockConfig.dock=i,Object.keys(n).forEach(function(e){t.state.settings[e]=as(t.state.settings[e])}),this.state.isHorizontal="top"===this.state.settings.align||"bottom"===this.state.settings.align,this.state.labels.activeMode=fs(this.state,this.state.settings,this.state.isDiscrete)},preferredSize:function(e){var t=this.formatter,n=this.state,i=this.scale,r=this.state.isHorizontal?e.inner.width:e.inner.height;return this.state.pxScale=Hr(i,r),es({isDiscrete:this.state.isDiscrete,rect:e.inner,formatter:t,measureText:this.renderer.measureText,scale:this.state.pxScale,settings:this.state.settings,state:n})},beforeUpdate:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).settings;this.setState(e)},resize:function(e){var t=e.inner,n=e.outer,i=Yc({},t,hs({align:this.state.settings.align,inner:t})),r=n||i;return Yc(this.state.innerRect,i),Yc(this.state.outerRect,r),n},beforeRender:function(){var e=this.scale,t=this.formatter,n=this.state.isHorizontal?this.state.innerRect.width:this.state.innerRect.height;this.state.pxScale=Hr(e,n),this.state.ticks=this.state.pxScale.ticks({distance:n,formatter:t})},render:function(){var e=this.state,t=[];return t.push.apply(t,su(this.state.concreteNodeBuilder.build({settings:this.state.settings,scale:this.state.pxScale,innerRect:this.state.innerRect,outerRect:this.state.outerRect,measureText:this.renderer.measureText,textBounds:this.renderer.textBounds,ticks:this.state.ticks,state:e}))),rp.multiple(t),t}},wp={require:["renderer","chart"],defaultSettings:{dock:"bottom",displayOrder:0,prioOrder:0,settings:{paddingStart:5,paddingEnd:5,paddingLeft:0,paddingRight:0,anchor:"center",join:", ",maxLengthPx:NaN,style:{fontSize:"15px",fontFamily:"Arial",fill:"#999"}}},created:function(){this.rect={x:0,y:0,width:0,height:0},this.definitionSettings=this.settings.settings;var e=this.settings.text,t=this.definitionSettings.join;this.title=ms(e,t,this.scale)},preferredSize:function(){return this.renderer.measureText({text:this.title,fontSize:this.definitionSettings.style.fontSize,fontFamily:this.definitionSettings.style.fontFamily}).height+this.definitionSettings.paddingStart+this.definitionSettings.paddingEnd},beforeRender:function(e){Yc(this.rect,e.size)},render:function(){var e=this.title,t=this.definitionSettings,n=this.rect,i=[];return i.push(vs({title:e,dock:this.settings.dock,definitionSettings:t,rect:n,measureText:this.renderer.measureText})),i},beforeUpdate:function(e){e.settings&&(Yc(this.settings,e.settings),this.definitionSettings=e.settings.settings);var t=this.settings.text,n=this.definitionSettings.join;this.title=ms(t,n,this.scale)}},_p={require:["chart","renderer"],on:{panStart:function(e){var t=bs(e,this.renderer),n={x:t.x-e.deltaX,y:t.y-e.deltaY};this.currentMove=ys(this,n),this.currentMove.update(t)},panMove:function(e){if(this.currentMove){var t=bs(e,this.renderer);this.currentMove.update(t)}},panEnd:function(e){if(this.currentMove){var t=bs(e,this.renderer);this.currentMove.end(t),this.currentMove=null}},panCancel:function(){this.currentMove=null},tap:function(e){var t=bs(e,this.renderer);ys(this,t).end(t)}},defaultSettings:{settings:{backgroundColor:"#eee",thumbColor:"#ccc",width:16}},created:function(){this.rect={x:0,y:0,width:0,height:0}},preferredSize:function(e){var t=this.chart.scroll(this.settings.scroll).getState();return t.viewSize>=t.max-t.min?Math.max(e.width,e.height):this.settings.settings.width},resize:function(e){var t=e.inner;return this.rect=t,t},render:function(e){var t,n=this.settings.dock,i=this.settings.settings.invert,r="top"===n||"bottom"===n,o=r?"width":"height",s=this.rect[o],a=this.chart.scroll(this.settings.scroll).getState(),l=s*(a.start-a.min)/(a.max-a.min),c=s*a.viewSize/(a.max-a.min);return i&&(l=s-l-c),e("div",{style:{position:"relative",width:"100%",height:"100%",background:this.settings.settings.backgroundColor,pointerEvents:"auto"}},[].concat(e("div",{class:{scroller:!0},style:(t={position:"absolute"},tu(t,r?"left":"top",l+"px"),tu(t,r?"top":"left","25%"),tu(t,r?"height":"width","50%"),tu(t,o,Math.max(1,c)+"px"),tu(t,"background",this.settings.settings.thumbColor),t)})))},renderer:"dom"},Dp=5,Mp=0,Ap={require:["chart","settings","renderer"],defaultSettings:{settings:{bubbles:{show:!0,align:"start",fontSize:"14px",fontFamily:"Arial",fill:"#595959"},fill:"#ccc",target:{fill:"#ccc"}}},renderer:"dom",on:{rangeStart:function(e){this.start(e)},rangeMove:function(e){this.move(e)},rangeEnd:function(e){this.end(e)},rangeClear:function(e){this.clear(e)}},created:function(){this.state={}},beforeRender:function(e){this.state.rect=e.size},render:function(e){var t=this.settings.settings;this.state.direction="vertical"===t.direction?Mp:1;var n=this.renderer.element().getBoundingClientRect(),i=this.state.rect[this.state.direction===Mp?"height":"width"],r=Hr(this.chart.scale(t.scale),i),o=zs(this);if(r=o.scale?o.scale:r,this.state.targetRect=o.targetRect,this.state.targetFillRect=o.targetFillRect,this.state.size=null===o.size?i:o.size,this.state.settings=t,this.state.offset=n,this.state.brush=t.brush,this.state.brushInstance=this.chart.brush(this.state.brush),this.state.renderer=this.renderer,this.state.multi=!!t.multiple,this.state.h=e,this.state.cssCoord={offset:this.state.direction===Mp?"top":"left",coord:this.state.direction===Mp?"y":"x",pos:this.state.direction===Mp?"deltaY":"deltaX"},{}.hasOwnProperty.call(r,"norm")){this.state.fauxBrushInstance=null,this.state.findValues=null,this.state.scale=r;var s=this.state.scale.data();s&&s.fields&&s.fields[0]&&(this.state.format=s.fields[0].formatter())}else this.state.scale=li(),this.state.scale.data=r.data,this.state.format=function(e,t){return Vs(r.range(),t)?js(e,r):"-"},this.state.fauxBrushInstance=Xi(),this.state.findValues=function(e){return Hs(e,r)};return[]},start:function(e){Is({e:e,state:this.state,renderer:this.renderer,ranges:Ns,targetSize:Dp})},end:function(){this.state.started&&(Ts(this.state,Ns),Ps(this.state))},move:function(e){this.state.started&&(ks(this.state,e),Rs(this.state),Ps(this.state))},clear:function(){this.state.fauxBrushInstance&&this.state.fauxBrushInstance.clear(),this.state.renderer.render([])}},Ep={require:["chart","settings","renderer"],defaultSettings:{settings:{bubbles:{show:!0,align:"start",fontSize:"14px",fontFamily:"Arial",fill:"#595959"},fill:"#ccc",target:{fill:"#ccc"}}},renderer:"dom",on:{areaStart:function(e){this.start(e)},areaMove:function(e){this.move(e)},areaEnd:function(e){this.end(e)},areaClear:function(e){this.clear(e)}},created:function(){this.rect={x:0,y:0,width:0,height:0},this.state={}},beforeRender:function(e){this.rect=e.size},render:function(e){this.state.rect=this.rect;var t=this.settings.settings,n="vertical"===t.direction?Mp:1,i=this.state.rect[n===Mp?"height":"width"],r=this.renderer.element().getBoundingClientRect(),o=t.target?this.chart.component(t.target.component):null;return o&&o.rect?this.state.targetRect={x:o.rect.x-this.rect.x,y:o.rect.y-this.rect.y,width:o.rect.width,height:o.rect.height}:this.state.targetRect=null,this.state.chart=this.chart,this.state.direction=n,this.state.settings=t,this.state.offset=r,this.state.rc=Oi(),this.state.renderer=this.renderer,this.state.multi=!!t.multiple,this.state.h=e,this.state.size=i,this.state.cssCoord={offset:this.state.direction===Mp?"top":"left",coord:this.state.direction===Mp?"y":"x",pos:this.state.direction===Mp?"deltaY":"deltaX",area:this.state.direction===Mp?"height":"width"},this.state.format=function(e,t){return Ys(this,e,t)},[]},start:function(e){Es({e:e,state:this.state,renderer:this.renderer,ranges:Us,targetSize:Dp})},end:function(){this.state.started&&(Ls(this.state,Us),$s(this.state))},move:function(e){this.state.started&&(Os(this.state,e),Xs(this.state),$s(this.state))},clear:function(){this.state.rc&&this.state.rc.clear(),this.state.renderer.render([])}},Ip={require:["chart","settings","renderer"],defaultSettings:{settings:{}},preferredSize:function(){return 50},created:function(){this.rect={x:0,y:0,width:0,height:0},this.state={}},beforeRender:function(e){this.rect=e.size},render:function(){var e=this.settings.settings,t=this.chart.brush(e.brush),n=e.direction||"horizontal",i="horizontal"===n?this.rect.width:this.rect.height,r=Hr(this.chart.scale(e.scale),i);return na(this.state),ta(this.state,t,r,this.renderer),this.state.rect=this.rect,this.state.fill=e.fill||"#ccc",this.state.opacity=void 0!==e.opacity?e.opacity:1,this.state.direction=n,Qs(this.state)},beforeDestroy:function(){na(this.state)}},Tp={require:["chart","renderer","settings"],defaultSettings:{displayOrder:0,settings:{brush:{components:[]},snapIndicator:{threshold:75,strokeDasharray:"5, 5",stroke:"black",strokeWidth:2,opacity:.5},lasso:{fill:"transparent",stroke:"black",strokeWidth:2,opacity:.7,strokeDasharray:"20, 10"},startPoint:{r:10,fill:"green",stroke:"black",strokeWidth:1,opacity:1}}},on:{lassoStart:function(e){this.start(e)},lassoEnd:function(e){this.end(e)},lassoMove:function(e){this.move(e)},lassoCancel:function(){this.cancel()}},created:function(){this.state={points:[],active:!1,path:null,snapIndicator:null,startPoint:null,rendererBounds:null,componentDelta:null,brushConfig:null,lineBrushShape:{x1:0,y1:0,x2:0,y2:0}}},start:function(e){this.state.active=!0,this.state.path=pa(this.settings.settings.lasso),this.state.snapIndicator=fa(this.settings.settings.snapIndicator),this.state.startPoint=ma(this.settings.settings.startPoint),this.state.rendererBounds=this.renderer.element().getBoundingClientRect(),this.state.componentDelta=ua(this.chart,this.state.rendererBounds),this.state.brushConfig=ga(this.settings);var t=ia(this.state.rendererBounds,e);oa(this.state,t),aa({state:this.state,start:t}),ca(this.state,t)},move:function(e){if(this.state.active){var t=ia(this.state.rendererBounds,e);ra(t,this.state,this.settings)?la(this.state,!0):la(this.state,!1),oa(this.state,t),aa({state:this.state,end:t}),sa(this.state,this.renderer),ha(this.state,this.chart)}},end:function(e){this.state.active&&(la(this.state,!1),ra(ia(this.state.rendererBounds,e),this.state,this.settings)&&da(this.state,this.chart),this.state={points:[],active:!1,path:null,snapIndicator:null,startPoint:null,rendererBounds:null,componentDelta:null,brushConfig:null,lineBrushShape:{x1:0,y1:0,x2:0,y2:0}},this.renderer.render([]))},cancel:function(){this.state.active&&(va(this.state,this.chart),this.state={points:[],active:!1,path:null,snapIndicator:null,startPoint:null,rendererBounds:null,componentDelta:null,brushConfig:null,lineBrushShape:{x1:0,y1:0,x2:0,y2:0}},this.renderer.render([]))},render:function(){}},Lp=1.5,kp=4,Op={bar:function(e){var t=e.settings,n=e.chart,i=e.nodes,r=e.rect,o=e.renderer,s=e.style,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wa,l=Yc({fontSize:12,fontFamily:"Arial",align:.5,justify:0,fill:"#333"},s.label);l.fontSize=parseInt(l.fontSize,10);var c=t.labels.map(function(e){return Yc({},l,t,e)}),u=t.labels.map(function(e){return e.placements.map(function(n){return Yc({},l,t,e,n)})}),h=_a({nodes:i,chart:n,renderer:o,settings:t,rect:r,labelSettings:c}),d=h.texts,p=h.measurements,f=h.fitsHorizontally,m=h.hasHorizontalDirection;return a({chart:n,nodes:i,texts:d,directions:h.directions,measurements:p,stngs:t,placementSettings:u,labelSettings:c,rect:r,fitsHorizontally:f,collectiveOrientation:m?"h":"v"})}},Pp={require:["chart","renderer","settings"],defaultSettings:{settings:{},style:{label:"$label"}},created:function(){this.rect={x:0,y:0,width:0,height:0}},beforeRender:function(e){this.rect=e.size},render:function(){var e=this,t=[];return(this.settings.settings.sources||[]).forEach(function(n){n.strategy&&Op[n.strategy.type]&&n.component&&t.push.apply(t,su(Da({chart:e.chart,rect:e.rect,renderer:e.renderer,source:n,style:e.style},Op[n.strategy.type])))}),t}},Np={require:["chart","settings","renderer","update"],defaultSettings:{settings:{direction:null,anchor:"left",layout:{mode:"stack"},item:{show:!0,justify:.5,align:.5,symbolPadding:8,label:{fontSize:"12px",fontFamily:"Arial",fill:"#595959",wordBreak:"none",hyphens:"auto",maxLines:2,maxWidth:136,lineHeight:1.2},shape:{type:"square",strokeWidth:0,size:8},margin:{top:0,bottom:8,left:8,right:8}},title:{show:!0,fontSize:"16px",fontFamily:"Arial",fill:"#595959",wordBreak:"none",hyphens:"auto",maxLines:2,maxWidth:156,lineHeight:1.25,margin:{top:4,bottom:8,left:8,right:4}},buttons:{show:!1,buttonSpacing:8,spacing:0,width:32,height:24,rect:{fill:"transparent",stroke:"transparent",strokeWidth:0},symbol:{fill:"grey",stroke:"grey",strokeWidth:0,size:.5},"rect:disabled":{fill:"transparent",stroke:"transparent",strokeWidth:0},"symbol:disabled":{fill:"lightgrey",stroke:"lightgrey",strokeWidth:0,size:.5}}}},on:{tap:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=this.renderer.element().getBoundingClientRect(),i=this.renderer.findShapes(".scroll-button"),r=0;r<i.length;r++){var o=i[r];if(Gd.testRectPoint(o.bounds,{x:e.center.x-n.left,y:e.center.y-n.top})){Fa(this,"+"===o.desc.action?t:-t);break}}},scroll:function(){Fa(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:3)},resetindex:function(){this.state.index=0}},createLocal:function(){var e=this.settings.settings,t=this.settings.dock||"center",n=e.direction||("top"===t||"bottom"===t?"horizontal":"vertical"),i="horizontal"===n,r=e.anchor,o="threshold-color"===this.scale.type,s="object"===Zc(e.layout)?e.layout:{},a="stack"===s.mode,l=void 0;this.scale&&(l=(this.scale.data().fields||[])[0]),this.local={direction:n,anchor:r,isHorizontal:i,isThreshold:o,isStacked:a,sourceTitle:l?l.title():"",sourceField:l,formatter:l?l.formatter():this.formatter,hasKey:!!this.settings.key,size:a||isNaN(s.size)?1:Math.max(Math.round(s.size),1)}},initState:function(){this.state={index:0}},resolveNodeDefs:function(){var e=this.settings,t=this.renderer,n=this.local,i=this.state,r=this.scale;i.defs=Pa({scale:r,settings:e.settings,renderer:t,local:n}),i.titleDef=Oa({settings:e.settings,local:n,renderer:t}),i.buttonDefs=ka(e.settings);var o=La(i,n),s=o.maxOuterWidth,a=o.maxOuterHeight,l=o.maxItemOuterWidth,c=o.maxItemOuterHeight,u=o.maxInnerWidth,h=o.maxInnerHeight,d=o.maxShapeSize;this.state.maxInnerWidth=u,this.state.maxInnerHeight=h,this.state.maxOuterWidth=s,this.state.maxOuterHeight=a,this.state.maxItemOuterWidth=l,this.state.maxItemOuterHeight=c,this.state.maxShapeSize=d},preferredSize:function(e){return"left"===this.settings.dock||"right"===this.settings.dock?this.state.preferredSize=Math.max(this.state.maxOuterWidth,Ra(this.local,this.state,e.inner)):this.state.preferredSize=Math.max(this.state.maxOuterHeight,Ra(this.local,this.state,e.inner)),this.local.isHorizontal&&this.state.maxOuterWidth>e.inner.width?Math.max(e.inner.width,e.inner.height):!this.local.isHorizontal&&this.state.maxOuterHeight>e.inner.height?Math.max(e.inner.width,e.inner.height):this.state.preferredSize},beforeUpdate:function(){this.createLocal(),this.resolveNodeDefs()},created:function(){this.createLocal(),this.initState(),this.resolveNodeDefs(),this.rect={x:0,y:0,width:0,height:0}},beforeRender:function(e){this.rect=e.size},render:function(){return Na({chart:this.chart,settings:this.settings.settings,scale:this.scale,rect:this.rect,local:this.local,state:this.state})}},Rp={require:["chart","settings","renderer"],defaultSettings:{displayOrder:0,dock:"right",settings:{size:15,length:.5,maxLengthPx:250,align:.5,justify:0,padding:{left:5,right:5,top:5,bottom:5},tick:{label:null,fill:"#595959",fontSize:"12px",fontFamily:"Arial",maxLengthPx:100,anchor:null,padding:5},title:{show:!0,text:"",fill:"#595959",fontSize:"12px",fontFamily:"Arial",maxLengthPx:100,padding:5,maxLines:2,wordBreak:"none",lineHeight:1.2,hyphens:"auto",anchor:null}}},preferredSize:function(e){var t=this.state;t.rect=Wa(this,e.inner);var n=this.stgns.size,i=t.isVertical?this.stgns.padding.left+this.stgns.padding.right:this.stgns.padding.top+this.stgns.padding.bottom;n+=i;var r=Math.max(e.inner.width,e.inner.height);if("left"===t.ticks.anchor||"right"===t.ticks.anchor){if(t.ticks.values.reduce(function(e,t){return e+t.textMetrics.height},0)>this.state.legend.length())return r;n+=t.ticks.length}else{if(t.ticks.length>this.state.legend.length())return r;n+=Math.max.apply(Math,su(t.ticks.values.map(function(e){return e.textMetrics.height})))}return n+=this.stgns.tick.padding,this.stgns.title.show&&(n="left"===t.title.anchor||"right"===t.title.anchor?Math.max(t.title.textBounds.height+i,n):Math.max(n,t.title.requiredWidth()+i)),this.state.preferredSize=n,n},created:function(){this.stgns=this.settings.settings,this.state=Ya(this)},beforeUpdate:function(e){this.stgns=e.settings.settings,this.state=Ya(this)},beforeRender:function(e){if(this.state.nodes=[],this.state.rect=Wa(this,e.size),this.stgns.title.show){var t=Ha(this);this.state.nodes.push(t)}var n=Ba(this,Va(this)),i={id:"legend-seq-target",type:"container",children:[n,za(this,n)]};this.state.nodes.push(i)},render:function(){return this.state.nodes}},Fp={step:function(e){return new be(e,.5)},stepAfter:function(e){return new be(e,1)},stepBefore:function(e){return new be(e,0)},linear:wu,basis:function(e){return new oe(e)},cardinal:Tu.tension(0),catmullRom:Lu,monotonex:function(e){return new fe(e)},monotoney:function(e){return new me(e)},natural:function(e){return new ve(e)}},jp={coordinates:{minor:.5,major:.5,layerId:0},orientation:"horizontal",layers:{curve:"linear",show:!0,line:{stroke:"#ccc",strokeWidth:1,opacity:1,show:!0},area:{fill:"#ccc",opacity:.8,show:!0}}},Vp={require:["chart"],created:function(){this.stngs=this.settings.settings||{}},beforeRender:function(e){var t=e.size;this.rect=t},render:function(e){for(var t=this,n=e.data,i=this.rect,r=i.width,o=i.height,s=this.stngs.orientation||"horizontal",a=Fr(this.stngs.coordinates,jp.coordinates,this.chart),l=Fr(this.stngs.layers.line,jp.layers.line,this.chart),c=Fr(this.stngs.layers.area,jp.layers.area,this.chart),u=Fr({curve:this.stngs.layers.curve,show:this.stngs.layers.show},{curve:jp.layers.curve,show:jp.layers.show},this.chart),h=void 0===this.stngs.coordinates.minor0,d={},p=0,f=0;f<n.items.length;f++){var m=n.items[f],g=jr(m,{layerId:a.layerId}).layerId;d[g]=d[g]||{order:p++,id:g,items:[],firstPoint:m},d[g].items.push(m)}var v=Object.keys(d).map(function(e){return d[e].firstPoint}),y=Object.keys(d).map(function(e){var t=d[e],n=jr(t.firstPoint,u,v);if(n&&!1===n.show)return null;for(var i=jr(t.firstPoint,l,v),r=jr(t.firstPoint,c,v),o=[],s=[],p=t.items.slice(),f=void 0,m=void 0,g=0;g<t.items.length;g++)f=jr(m=t.items[g],a,p),isNaN(f.major)||(h&&(f.minor0=a.minor.scale?a.minor.scale(m.minor0?m.minor0.value:0):0),o.push(f.minor),s.push(f));return{layerObj:n,lineObj:i,areaObj:r,median:o.sort(function(e,t){return e-t})[Math.floor((o.length-1)/2)],points:s,firstPoint:t.firstPoint}});y.sort(function(e,t){return e.median-t.median});var b=[];return y.forEach(function(e){var n=e.lineObj,i=e.layerObj,a=e.areaObj,l=e.points,c=Du(),u=void 0,d=void 0;if("vertical"===s?(c.y(function(e){return e.major*o}).x1(function(e){return e.minor*r}).x0(function(e){return e.minor0*r}).defined(function(e){return"number"==typeof e.minor&&!isNaN(e.minor)}).curve(Fp["monotone"===i.curve?"monotoney":i.curve]),u=c.lineX1(),d=c.lineX0()):(c.x(function(e){return e.major*r}).y1(function(e){return e.minor*o}).y0(function(e){return e.minor0*o}).defined(function(e){return"number"==typeof e.minor&&!isNaN(e.minor)}).curve(Fp["monotone"===i.curve?"monotonex":i.curve]),u=c.lineY1(),d=c.lineY0()),t.stngs.layers.area&&!1!==a.show){var p=c(l);b.push({type:"path",d:p,opacity:a.opacity,stroke:a.stroke,strokeWidth:a.strokeWidth,fill:a.fill,data:e.firstPoint})}if(n&&!1!==n.show){var f=u(l);b.push({type:"path",d:f,opacity:n.opacity,stroke:n.stroke,strokeWidth:n.strokeWidth,fill:"none",data:e.firstPoint}),!h&&t.stngs.layers.area&&!1!==a.show&&(f=d(l),b.push({type:"path",d:f,opacity:n.opacity,stroke:n.stroke,strokeWidth:n.strokeWidth,fill:"none",data:e.firstPoint}))}}),b}},Hp="line",Bp=[function(e){e.component("box-marker",cp)},function(e){e.component(vp,gp)},function(e){e.component("pie",bp)},function(e){e.component("grid-line",xp)},function(e){e.component("ref-line",qp)},function(e){e.component("axis",Sp)},function(e){e.component("text",wp)},function(e){e.component("scrollbar",_p)},function(e){e.component("brush-range",Ap),e.component("brush-area-dir",Ep)},function(e){e.component("range",Ip)},function(e){e.component("brush-lasso",Tp)},function(e){e.component("labels",Pp)},function(e){e.component("legend-cat",Np)},function(e){e.component("legend-seq",Rp)},function(e){e.component(Hp,Vp)}],zp=function(){function e(t){Jc(this,e),this._parent=null,this._children=[],this._ancestors=null,this.type=t,this.data=null}return eu(e,[{key:"detach",value:function(){return this._parent&&this._parent.removeChild(this),this}},{key:"equals",value:function(e){var t=this.children,n=e.children;if(t.length!==n.length)return!1;for(var i=0;i<t.length;i++)if(!t[i].equals(n[i]))return!1;return!0}},{key:"toJSON",value:function(){return{type:this.type,children:this.children.map(function(e){return e.toJSON()})}}},{key:"parent",get:function(){return this._parent}},{key:"isBranch",get:function(){return this._children&&this._children.length}},{key:"children",get:function(){return this._children}},{key:"ancestors",get:function(){if(!this._ancestors){var e=this._parent;this._ancestors=e?[e].concat(e.ancestors):[]}return this._ancestors}},{key:"descendants",get:function(){var e=[],t=void 0,n=void 0,i=void 0;for(t=0,n=this._children.length;t<n;t++)i=this._children[t],e.push(i),i._children.length&&(e=e.concat(i.descendants));return e}}]),e}(),$p=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.x,i=void 0===n?0:n,r=t.y,o=void 0===r?0:r,s=t.width,a=void 0===s?0:s,l=t.height,c=void 0===l?0:l,u=t.minWidth,h=void 0===u?0:u,d=t.minHeight,p=void 0===d?0:d;Jc(this,e),this.set({x:i,y:o,width:a,height:c,minWidth:h,minHeight:p})}return eu(e,[{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.x,n=void 0===t?0:t,i=e.y,r=void 0===i?0:i,o=e.width,s=void 0===o?0:o,a=e.height,l=void 0===a?0:a,c=e.minWidth,u=void 0===c?0:c,h=e.minHeight,d=void 0===h?0:h;s>=0?(this.x=n,this.width=Math.max(s,u)):(this.x=n+Math.min(s,-u),this.width=-Math.min(s,-u)),l>=0?(this.y=r,this.height=Math.max(l,d)):(this.y=r+Math.min(l,-d),this.height=-Math.min(l,-d))}},{key:"containsPoint",value:function(e){return Gd.testRectPoint(this,e)}},{key:"intersectsLine",value:function(e){var t=S(e);return Gd.testRectLine(this,t)}},{key:"intersectsRect",value:function(e){var t=q(e);return Gd.testRectRect(this,t)}},{key:"intersectsCircle",value:function(e){return Gd.testCircleRect(e,this)}},{key:"intersectsPolygon",value:function(e){return Gd.testPolygonRect(e,this)}},{key:"points",value:function(){return[{x:this.x,y:this.y},{x:this.x+this.width,y:this.y},{x:this.x+this.width,y:this.y+this.height},{x:this.x,y:this.y+this.height}]}}]),e}(),Up=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.cx,i=void 0===n?0:n,r=t.cy,o=void 0===r?0:r,s=t.r,a=void 0===s?0:s,l=t.minRadius,c=void 0===l?0:l;Jc(this,e),this.set({cx:i,cy:o,r:a,minRadius:c})}return eu(e,[{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.cx,n=void 0===t?0:t,i=e.cy,r=void 0===i?0:i,o=e.r,s=void 0===o?0:o,a=e.minRadius,l=void 0===a?0:a;this.cx=n,this.cy=r,this.r=Math.max(s,l),this.vector={x:this.cx,y:this.cy}}},{key:"containsPoint",value:function(e){return Gd.testCirclePoint(this,e)}},{key:"intersectsLine",value:function(e){var t=S(e);return Gd.testCircleLine(this,t)}},{key:"intersectsRect",value:function(e){var t=q(e);return Gd.testCircleRect(this,t)}},{key:"intersectsCircle",value:function(e){return Gd.testCircleCircle(this,e)}},{key:"intersectsPolygon",value:function(e){return Gd.testCirclePolygon(this,e)}},{key:"points",value:function(){return[{x:this.cx,y:this.cy}]}}]),e}(),Gp=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.x1,i=void 0===n?0:n,r=t.y1,o=void 0===r?0:r,s=t.x2,a=void 0===s?0:s,l=t.y2,c=void 0===l?0:l,u=t.tolerance,h=void 0===u?0:u;Jc(this,e),this.set({x1:i,y1:o,x2:a,y2:c,tolerance:h})}return eu(e,[{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.x1,n=void 0===t?0:t,i=e.y1,r=void 0===i?0:i,o=e.x2,s=void 0===o?0:o,a=e.y2,l=void 0===a?0:a,c=e.tolerance,u=void 0===c?0:c;this.x1=n,this.y1=r,this.x2=s,this.y2=l,this.tolerance=Math.max(0,Math.round(u)),this.vectors=this.points(),this.zeroSize=n===s&&r===l}},{key:"containsPoint",value:function(e){if(this.tolerance>0){var t={cx:e.x,cy:e.y,r:this.tolerance};return Gd.testCircleLine(t,this)}return Gd.testLinePoint(this,e)}},{key:"intersectsLine",value:function(e){var t=S(e);return Gd.testLineLine(this,t)}},{key:"intersectsRect",value:function(e){var t=q(e);return Gd.testRectLine(t,this)}},{key:"intersectsCircle",value:function(e){return Gd.testCircleLine(e,this)}},{key:"intersectsPolygon",value:function(e){return Gd.testPolygonLine(e,this)}},{key:"points",value:function(){return[{x:this.x1,y:this.y1},{x:this.x2,y:this.y2}]}}]),e}(),Wp=function(){function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).vertices,n=void 0===t?[]:t;Jc(this,e),this.set({vertices:n})}return eu(e,[{key:"set",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).vertices,t=void 0===e?[]:e;if(this.vertices=t.slice(),this.edges=[],Qa(this.vertices),!(this.vertices.length<=2)){Ka(this.vertices);for(var n=0;n<this.vertices.length-1;n++)this.edges.push([this.vertices[n],this.vertices[n+1]]);this._minMax=null,this._bounds=null}}},{key:"containsPoint",value:function(e){return Gd.testPolygonPoint(this,e)}},{key:"intersectsCircle",value:function(e){return Gd.testCirclePolygon(e,this)}},{key:"intersectsLine",value:function(e){return Gd.testPolygonLine(this,e)}},{key:"intersectsRect",value:function(e){return Gd.testPolygonRect(this,e)}},{key:"intersectsPolygon",value:function(){return!1}},{key:"points",value:function(){return this.vertices}},{key:"bounds",value:function(){if(!this._bounds){this._minMax=this._minMax?this._minMax:x(this.vertices);var e=ou(this._minMax,4),t=e[0],n=e[1],i=e[2],r=e[3];this._bounds=[{x:t,y:n},{x:i,y:n},{x:i,y:r},{x:t,y:r}]}return this._bounds}}]),e}(),Xp=Ce();Xp.add("rect",function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply($p,[null].concat(t)))}),Xp.add("circle",function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(Up,[null].concat(t)))}),Xp.add("line",function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(Gp,[null].concat(t)))}),Xp.add("polygon",Za);var Yp=function(){function e(){Jc(this,e),this._elements=[[1,0,0],[0,1,0],[0,0,1]],this._stack=[]}return eu(e,[{key:"clone",value:function(){return(new e).multiply(this)}},{key:"set",value:function(e){return this._elements=e,this}},{key:"save",value:function(){return this._stack.push(this.elements),this}},{key:"restore",value:function(){return this._stack.length&&(this._elements=this._stack.pop()),this}},{key:"add",value:function(e){var t=void 0,n=void 0;for(t=0;t<this._elements.length;t++)for(n=0;n<this._elements[t].length;n++)this._elements[t][n]+=e;return this}},{key:"translate",value:function(e,t){return this.multiply([[1,0,e],[0,1,t],[0,0,1]]),this}},{key:"rotate",value:function(e){var t=Math.cos(-e),n=Math.sin(-e);return this.multiply([[t,n,0],[-n,t,0],[0,0,1]]),this}},{key:"multiply",value:function(t){var n=void 0,i=void 0,r=void 0,o=void 0;if(t instanceof e&&(t=t._elements),Array.isArray(t)){for(r=[[0,0,0],[0,0,0],[0,0,0]],n=0;n<this._elements.length;n++)for(i=0;i<this._elements[n].length;i++)for(o=0;o<3;o++)r[n][i]+=this._elements[n][o]*t[o][i];this._elements=r}else for(n=0;n<this._elements.length;n++)for(i=0;i<this._elements[n].length;i++)this._elements[n][i]*=t;return this}},{key:"scale",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return this.multiply([[e,0,0],[0,t,0],[0,0,1]]),this}},{key:"transform",value:function(e,t,n,i,r,o){return this.multiply([[e,n,r],[t,i,o],[0,0,1]]),this}},{key:"determinant",value:function(){var e=this._elements[0][0],t=this._elements[0][1],n=this._elements[0][2],i=this._elements[1][0],r=this._elements[1][1],o=this._elements[1][2],s=this._elements[2][0],a=this._elements[2][1],l=this._elements[2][2];return e*r*l+t*o*s+n*i*a-n*r*s-t*i*l-e*o*a}},{key:"invert",value:function(){var e=this.determinant(),t=this._elements[0][0],n=this._elements[0][1],i=this._elements[0][2],r=this._elements[1][0],o=this._elements[1][1],s=this._elements[1][2],a=this._elements[2][0],l=this._elements[2][1],c=this._elements[2][2];return this._elements=[[o*c-s*l,i*l-n*c,n*s-i*o],[s*a-r*c,t*c-i*a,i*r-t*s],[r*l-o*a,a*n-t*l,t*o-n*r]],this.multiply(1/e),this}},{key:"transpose",value:function(){var e=Object.create(this._elements);return this._elements=[[e[0][0],e[1][0],e[2][0]],[e[0][1],e[1][1],e[2][1]],[e[0][2],e[1][2],e[2][2]]],this}},{key:"identity",value:function(){return this._elements=[[1,0,0],[0,1,0],[0,0,1]],this}},{key:"toString",value:function(){return""+this._elements.map(function(e){return e.join("\t")}).join("\n")}},{key:"isIdentity",value:function(){var e=this._elements;return 1===e[0][0]&&0===e[0][1]&&0===e[0][2]&&0===e[1][0]&&1===e[1][1]&&0===e[1][2]&&0===e[2][0]&&0===e[2][1]&&1===e[2][2]}},{key:"transformPoint",value:function(e){var t=[e.x,e.y,1],n=void 0,i=void 0,r=this._elements,o=[0,0,0];for(n=0;n<this._elements.length;n++)for(i=0;i<this._elements[n].length;i++)o[n]+=t[i]*r[n][i];return{x:o[0],y:o[1]}}},{key:"transformPoints",value:function(e){var t=void 0,n=void 0,i=void 0,r=void 0,o=void 0,s=this._elements,a=[];for(r=0;r<e.length;r++){for(t=[e[r].x,e[r].y,1],o=[0,0,0],n=0;n<this._elements.length;n++)for(i=0;i<this._elements[n].length;i++)o[n]+=t[i]*s[n][i];a.push({x:o[0],y:o[1]})}return a}},{key:"elements",get:function(){var e=this._elements;return[[e[0][0],e[0][1],e[0][2]],[e[1][0],e[1][1],e[1][2]],[e[2][0],e[2][1],e[2][2]]]}}]),e}(),Kp=/(translate|scale|rotate|matrix)\(([0-9,.eE+-\s]+)(?:,|\s?)+\)/g,Qp={type:/^\w[\w-]+/,attr:/^\[\w(?:[\w\._-]+)?(?:[!]?=['\"][\w\s*#_-]*['\"])?\]/,universal:/^(\*)/,tag:/^\.(\w+)/},Zp={type:function(e,t){return t.filter(function(t){var n=t.type;return!!n&&n.toLowerCase()===e.toLowerCase()})},attr:function(e,t,n,i){return i.filter(function(i){var r=i.attrs[e];if(!t)return void 0!==r;if(void 0===r)return!1;switch(t){case"=":return n===String(r);case"!=":return n!==String(r);default:return!1}})},universal:function(e){return e},tag:function(e,t){return t.filter(function(t){var n=t.tag;return!!n&&-1!==n.indexOf(e.replace(".",""))})}},Jp={find:function(e,t){var n=[],i=[],r=void 0,o=void 0;if(t.isBranch){r=al(e),o=t.descendants;for(var s=void 0,a=0,l=r.length;a<l;a++)!function(e,t){s=r[e];var n=[],a=o.slice(),l=!1;s.reverse().forEach(function(e){if(" "===e.type)return n.push(a),a=o.slice(),void(l=!1);a=sl(e,a),l=!0}),l&&n.push(a);var c=n[0].filter(function(e){for(var t=e.parent,i=void 0,r=1;r<n.length;r++){for(i=n[r].indexOf(t);t&&i<0;)t=t.parent,i=n[r].indexOf(t);if(i<0)return!1}return!0});i.push(c)}(a);for(var c=0,u=i.length;c<u;c++)for(var h=0,d=i[c].length;h<d;h++)n.indexOf(i[c][h])<0&&n.push(i[c][h])}return n||[]}},ef=function(){function e(t){var n=this;Jc(this,e),this._bounds=t.boundingRect?function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return t.boundingRect(e)}:function(){return{x:0,y:0,width:0,height:0}},this._attrs=t.attrs,this._type=t.type,this._data=t.data,this._dpi=t.stage?t.stage.dpi:1,this._collider=function(){return ll(t,n._dpi)},this._desc=t.desc,this._tag=t.tag}return eu(e,[{key:"type",get:function(){return this._type}},{key:"data",get:function(){return this._data}},{key:"attrs",get:function(){return this._attrs}},{key:"element",get:function(){return this._element},set:function(e){this._element=e}},{key:"key",get:function(){return this._key},set:function(e){this._key=e}},{key:"bounds",get:function(){var e=this._bounds();return e.x/=this._dpi,e.y/=this._dpi,e.width/=this._dpi,e.height/=this._dpi,e}},{key:"localBounds",get:function(){return this._bounds(!1)}},{key:"collider",get:function(){return this._collider()}},{key:"desc",get:function(){return this._desc}},{key:"tag",get:function(){return this._tag}}]),e}(),tf=function(){function e(t){Jc(this,e),this._node=cl(t),this._parent=null,this._input=null}return eu(e,[{key:"node",get:function(){return this._node}},{key:"parent",set:function(e){this._parent=e},get:function(){return this._parent}},{key:"input",set:function(e){this._input=e},get:function(){return this._input}}]),e}(),nf=function(e){function t(e){Jc(this,t);var n=ru(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._stage=null,n._collider=null,n._attrs={},n._node=null,n}return iu(t,zp),eu(t,[{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.node=e;var t=e.data,n=e.desc,i=e.tag;Ur(this.attrs,e),void 0!==t&&(this.data=t),"object"===(void 0===n?"undefined":Zc(n))&&(this.desc=Yc(!0,{},n)),"string"==typeof i&&(this.tag=i)}},{key:"collider",value:function(e){if(void 0===e)return this._collider;var t=e.type,n=void 0===t?null:t,i={type:n};return n?this._collider&&this._collider.type===n?this._collider.fn.set(e):"frontChild"===n?this._collider=i:"bounds"===n?(i.fn=Ja("rect",e),this._collider=i):-1!==["line","rect","circle","polygon"].indexOf(n)&&(i.fn=Ja(n,e),this._collider=i):this._collider=null,this._collider}},{key:"findShapes",value:function(e){return Jp.find(e,this).map(function(e){return cl(e)})}},{key:"getItemsFrom",value:function(e){return xl(this,e)}},{key:"containsPoint",value:function(e){return ql(this,e)}},{key:"intersectsLine",value:function(e){return ql(this,e)}},{key:"intersectsRect",value:function(e){return ql(this,e)}},{key:"intersectsCircle",value:function(e){return ql(this,e)}},{key:"intersectsPolygon",value:function(e){return ql(this,e)}},{key:"resolveLocalTransform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yp;void 0!==this.attrs.transform&&ol(this.attrs.transform,e),this.modelViewMatrix=e.clone()}},{key:"resolveGlobalTransform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yp,t=this.ancestors;if(t.length>0)for(var n=t.length-1;n>=0;n--)t[n].resolveLocalTransform(e),e=t[n].modelViewMatrix;this.resolveLocalTransform(e)}},{key:"attr",value:function(e){return this.attrs[e]}},{key:"equals",value:function(e){var n=this.attrs,i=Object.keys(n),r=e.attrs,o=Object.keys(r);if(i.length!==o.length)return!1;for(var s=0;s<i.length;s++){var a=i[s];if(!Object.hasOwnProperty.call(r,a))return!1;if(n[a]!==r[a])return!1}return nu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"equals",this).call(this,e)}},{key:"toJSON",value:function(){var e=nu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this);return e.attrs=this.attrs,e}},{key:"attrs",get:function(){return this._attrs}},{key:"stage",get:function(){return this._parent&&!this._stage?this._stage=this._parent.stage:this._parent||this._stage===this||(this._stage=null),this._stage}},{key:"modelViewMatrix",set:function(e){this._mvm=e,this._imvm=null},get:function(){return this._mvm}},{key:"inverseModelViewMatrix",get:function(){return this._imvm=this._imvm?this._imvm:this._mvm.clone().invert(),this._imvm}},{key:"node",set:function(e){this._node=e},get:function(){return this._node}}]),t}(),rf=function(e){function t(){return Jc(this,t),ru(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return iu(t,zp),eu(t,[{key:"addChild",value:function(e){if(!(e&&e instanceof zp))throw new TypeError("Expecting a Node as argument, but got "+e);if(e===this)throw new Error("Can not add itself as child!");if(e._children&&e._children.length&&this.ancestors.indexOf(e)>=0)throw new Error("Can not add an ancestor as child!");e._parent&&e._parent!==this&&e._parent.removeChild(e);var t=this._children.indexOf(e);return t>=0&&this._children.splice(t,1),this._children.push(e),e._parent=this,e._ancestors=null,this}},{key:"addChildren",value:function(e){var t=void 0,n=e?e.length:0;for(t=0;t<n;t++)this.addChild(e[t]);return this}},{key:"removeChild",value:function(e){var t=this._children.indexOf(e);return t>=0&&(this._children.splice(t,1),e._parent=null,e._ancestors=null),this}},{key:"removeChildren",value:function(e){var t=void 0,n=void 0;if(!this._children)return this;if(e)for(n=e.length,t=0;t<n;t++)this.removeChild(e[t]);else for(;this._children.length;)this.removeChild(this._children[0]);return this}}]),t}(),of=rf.prototype,sf=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Jc(this,t);var n=e.type,i=void 0===n?"container":n,r=ru(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i));return r.set(e),r._boundingRect={},r}return iu(t,nf),eu(t,[{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};nu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"set",this).call(this,e);var n=e.collider,i=Yc({type:null},n);nu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"collider",this).call(this,i)}},{key:"boundingRect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.children.length;this._boundingRect={};for(var n=0;n<t;n++)Cl(this,this.children[n],e);return Yc({x:0,y:0,width:0,height:0},this._boundingRect)}},{key:"bounds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.boundingRect(e);return[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}]}},{key:"addChild",value:function(e){var n=of.addChild.call(this,e);if(this._collider&&"bounds"===this._collider.type){Cl(this,e,!0);var i=Yc({type:"bounds",x:0,y:0,width:0,height:0},this._boundingRect);nu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"collider",this).call(this,i)}return n}},{key:"addChildren",value:function(e){var n=of.addChildren.call(this,e),i=e.length;if(this._collider&&"bounds"===this._collider.type&&i>0){for(var r=0;r<i;r++)Cl(this,e[r],!0);var o=Yc({type:"bounds",x:0,y:0,width:0,height:0},this._boundingRect);nu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"collider",this).call(this,o)}return n}},{key:"removeChild",value:function(e){e._stage=null;var n=e.descendants,i=n?n.length:0,r=void 0;for(r=0;r<i;r++)n[r]._stage=null;if(of.removeChild.call(this,e),this._collider&&"bounds"===this._collider.type){var o=Yc(this.boundingRect(!0),{type:"bounds"});nu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"collider",this).call(this,o)}return this}},{key:"removeChildren",value:function(e){if(of.removeChildren.call(this,e),this._collider&&"bounds"===this._collider.type){var n=Yc(this.boundingRect(!0),{type:"bounds"});nu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"collider",this).call(this,n)}return this}}]),t}(),af=function(e){function t(e){Jc(this,t);var n=ru(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"stage"));return n._stage=n,n._dpiRatio=e||1,n}return iu(t,sf),eu(t,[{key:"dpi",get:function(){return this._dpiRatio}}]),t}(),lf=rf.prototype,cf=["x1","x2","y1","y2","id","offset","style"],uf=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Jc(this,t);var n=e.type,i=void 0===n?"container":n,r=ru(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i));return r.set(e),r._boundingRect={},r}return iu(t,nf),eu(t,[{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};nu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"set",this).call(this,e);for(var n=this.attrs,i="",r=0,o=cf.length;r!==o;r++)e[i=cf[r]]&&(n[i]=e[i])}},{key:"addChild",value:function(e){return lf.addChild.call(this,e)}},{key:"addChildren",value:function(e){return lf.addChildren.call(this,e)}},{key:"removeChild",value:function(e){e._stage=null;var t=e.descendants,n=t?t.length:0,i=void 0;for(i=0;i<n;i++)t[i]._stage=null;return lf.removeChild.call(this,e),this}},{key:"removeChildren",value:function(e){return lf.removeChildren.call(this,e),this}}]),t}(),hf=function(e){function t(){Jc(this,t);var e=ru(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"rect"));return e.set.apply(e,arguments),e}return iu(t,nf),eu(t,[{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.x,i=void 0===n?0:n,r=e.y,o=void 0===r?0:r,s=e.width,a=void 0===s?0:s,l=e.height,c=void 0===l?0:l,u=e.collider,h=Yc({type:"rect",x:i,y:o,width:a,height:c},u);nu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"set",this).call(this,e),nu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"collider",this).call(this,h),a>=0?(this.attrs.x=i,this.attrs.width=a):(this.attrs.x=i+a,this.attrs.width=-a),c>=0?(this.attrs.y=o,this.attrs.height=c):(this.attrs.y=o+c,this.attrs.height=-c)}},{key:"boundingRect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=b(this.attrs),n=x(e&&this.modelViewMatrix?this.modelViewMatrix.transformPoints(t):t),i=ou(n,4),r=i[0],o=i[1];return{x:r,y:o,width:i[2]-r,height:i[3]-o}}},{key:"bounds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.boundingRect(e);return[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}]}}]),t}(),df=function(e){function t(){Jc(this,t);var e=ru(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"circle"));return e.set.apply(e,arguments),e}return iu(t,nf),eu(t,[{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.cx,i=void 0===n?0:n,r=e.cy,o=void 0===r?0:r,s=e.r,a=void 0===s?0:s,l=e.collider,c=Yc({type:"circle",cx:i,cy:o,r:a},l);nu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"set",this).call(this,e),nu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"collider",this).call(this,c),this.attrs.cx=i,this.attrs.cy=o,this.attrs.r=a}},{key:"boundingRect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.bounds(e);return{x:t[0].x,y:t[0].y,width:t[2].x-t[0].x,height:t[2].y-t[0].y}}},{key:"bounds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.attrs,n=t.cx,i=t.cy,r=t.r,o=t.r,s=n-r,a=i-o,l=2*r,c=2*o,u=[{x:s,y:a},{x:s+l,y:a},{x:s+l,y:a+c},{x:s,y:a+c}];if(e&&this.modelViewMatrix){var h=x(u=this.modelViewMatrix.transformPoints(u)),d=ou(h,4),p=d[0],f=d[1];return l=d[2]-p,c=d[3]-f,[{x:p,y:f},{x:p+l,y:f},{x:p+l,y:f+c},{x:p,y:f+c}]}return u}}]),t}(),pf=function(e){function t(){Jc(this,t);var e=ru(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"line"));return e.set.apply(e,arguments),e}return iu(t,nf),eu(t,[{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.x1,i=void 0===n?0:n,r=e.y1,o=void 0===r?0:r,s=e.x2,a=void 0===s?0:s,l=e.y2,c=void 0===l?0:l,u=e.collider;nu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"set",this).call(this,e),this.attrs.x1=i,this.attrs.y1=o,this.attrs.x2=a,this.attrs.y2=c;var h={type:"line",x1:i,y1:o,x2:a,y2:c};nu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"collider",this).call(this,Yc(h,u))}},{key:"boundingRect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=y(this.attrs);e&&this.modelViewMatrix&&(t=this.modelViewMatrix.transformPoints(t));var n=x(t),i=ou(n,4),r=i[0],o=i[1],s=i[2],a=i[3],l=r!==s||o!==a;return{x:r,y:o,width:l?Math.max(1,s-r):0,height:l?Math.max(1,a-o):0}}},{key:"bounds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.boundingRect(e);return[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}]}}]),t}(),ff=function(e){function t(){Jc(this,t);var e=ru(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"path"));return e.set.apply(e,arguments),e}return iu(t,nf),eu(t,[{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};nu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"set",this).call(this,e),this.attrs.d=e.d,nu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"collider",this).call(this,e.collider),this.points=null}},{key:"boundingRect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.points=this.points?this.points:wl(this.attrs.d);var t=x(e&&this.modelViewMatrix?this.modelViewMatrix.transformPoints(this.points):this.points),n=ou(t,4),i=n[0],r=n[1],o=n[2],s=n[3];return{x:i||0,y:r||0,width:o-i||0,height:s-r||0}}},{key:"bounds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.boundingRect(e);return[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}]}}]),t}(),mf=function(e){function t(){Jc(this,t);var e=ru(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"text"));return e.set.apply(e,arguments),e}return iu(t,nf),eu(t,[{key:"set",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.x,i=void 0===n?0:n,r=e.y,o=void 0===r?0:r,s=e.dx,a=void 0===s?0:s,l=e.dy,c=void 0===l?0:l,u=e.textBoundsFn,h=e.text,d=e.collider,p=e.boundingRect;nu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"set",this).call(this,e),nu(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"collider",this).call(this,d),this.attrs.x=i,this.attrs.y=o,this.attrs.dx=a,this.attrs.dy=c,this.attrs.text=h,p?this._boundingRect=p:"function"==typeof u&&(this._boundingRect=u(this.attrs))}},{key:"boundingRect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._boundingRect)return{x:0,y:0,width:0,height:0};var t=b(this._boundingRect),n=x(e&&this.modelViewMatrix?this.modelViewMatrix.transformPoints(t):t),i=ou(n,4),r=i[0],o=i[1];return{x:r,y:o,width:i[2]-r,height:i[3]-o}}},{key:"bounds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.boundingRect(e);return[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}]}}]),t}(),gf=Ce();gf.add("rect",function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(hf,[null].concat(t)))}),gf.add("circle",function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(df,[null].concat(t)))}),gf.add("text",function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(mf,[null].concat(t)))}),gf.add("line",function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(pf,[null].concat(t)))}),gf.add("path",function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(ff,[null].concat(t)))}),gf.add("stage",function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(af,[null].concat(t)))}),gf.add("container",function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(sf,[null].concat(t)))}),gf.add("defs",Sl),gf.add("linearGradient",Sl),gf.add("radialGradient",Sl),gf.add("stop",Sl);var vf=function(){function e(){return n[n.length-1]}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=[{}];return e.save=function(){for(var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e(),o={},s="",a=0;a<t.length;a++)void 0!==r[s=t[a]]&&(o[s]=r[s]);return Yc(o,i),n.push(o),e()},e.restore=function(){n.splice(n.length-1,1)},e}(["stroke","fill","strokeWidth","opacity","fontFamily","fontSize","baseline"]),yf=/\n+|\r+|\r\n/,bf=/\s/,xf=/[a-zA-Z\u00C0-\u00F6\u00F8-\u00FF\u00AD]/,qf=0,Cf=1,Sf=2,wf=1.2,_f="",Df="",Mf={},Af={},Ef=void 0,If=Ce(),Tf=new RegExp("[A-Za-z---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]"),Lf=new RegExp("[-------]"),kf=new RegExp("[-----------]"),Of={start:"end",end:"start",center:"center",middle:"middle"};dc("rect",function(e,t){var n=t.g,i=t.doFill,r=t.doStroke;n.beginPath(),n.rect(e.x,e.y,e.width,e.height),i&&n.fill(),r&&n.stroke()}),dc("circle",function(e,t){var n=t.g,i=t.doFill,r=t.doStroke;n.beginPath(),n.moveTo(e.cx+e.r,e.cy),n.arc(e.cx,e.cy,e.r,0,2*Math.PI,!1),i&&n.fill(),r&&n.stroke()}),dc("line",function(e,t){var n=t.g,i=t.doStroke;n.beginPath(),n.moveTo(e.x1,e.y1),n.lineTo(e.x2,e.y2),i&&n.stroke()}),dc("path",function(e,t){var n=t.g,i=t.doStroke,r=t.doFill,o=new Path2D(e.d);r&&n.fill(o),i&&n.stroke(o)}),dc("text",function(e,t){var n=t.g,i=Ql(e,tc);n.font=e["font-size"]+" "+e["font-family"],n.canvas.dir=mc(e.text);var r="middle"===e["text-anchor"]?"center":e["text-anchor"];n.textAlign=gc(r,n.canvas.dir);var o=Zl(e);n.fillText(i,e.x+e.dx,e.y+e.dy+o)});for(var Pf="http://www.w3.org/2000/svg",Nf=function(e,t){if(!e||"string"!=typeof e)throw new Error("Invalid type: "+e);var n=t.ownerDocument.createElementNS(Pf,"container"===e?"g":e);return t.appendChild(n),n},Rf=function(e){e.parentNode&&e.parentNode.removeChild(e)},Ff=function(e,t){for(var n in t.attrs)if("text"===n){e.setAttribute("style","white-space: pre"),e.textContent=Ql(t.attrs,tc);var i=mc(t.attrs.text);"rtl"===i&&(e.setAttribute("direction","rtl"),e.setAttribute("dir","rtl"),e.setAttribute("text-anchor",gc(e.getAttribute("text-anchor"),i)))}else if("text"!==t.type||"dy"!==n&&"dominant-baseline"!==n)e.setAttribute(n,t.attrs[n]);else{var r=+e.getAttribute(n)||0,o=0;o="dominant-baseline"===n?Zl(t.attrs):t.attrs[n],e.setAttribute("dy",o+r)}if("string"==typeof t.data||"number"==typeof t.data||"boolean"==typeof t.data)e.setAttribute("data",t.data);else if("object"===Zc(t.data)&&null!==t.data)for(var s in t.data)"string"!=typeof t.data[s]&&"number"!=typeof t.data[s]&&"boolean"!=typeof t.data[s]||e.setAttribute("data-"+s,t.data[s])},jf=function(){function e(t,n,i,r){Jc(this,e),this.create=t,this.nodeCreator=n,this.nodeMaintainer=i,this.nodeDestroyer=r}return eu(e,[{key:"render",value:function(e,t){return this.create([],e,t,this.nodeCreator,this.nodeMaintainer,this.nodeDestroyer)}}]),e}(),Vf=[],Hf={},Bf=function(e,t,n,i,r){return{sel:e,data:t,children:n,text:i,elm:r,key:void 0===t?void 0:t.key}},zf={array:Array.isArray,primitive:function(e){return"string"==typeof e||"number"==typeof e}},$f={createElement:function(e){return document.createElement(e)},createElementNS:function(e,t){return document.createElementNS(e,t)},createTextNode:function(e){return document.createTextNode(e)},appendChild:function(e,t){e.appendChild(t)},removeChild:function(e,t){e.removeChild(t)},insertBefore:function(e,t,n){e.insertBefore(t,n)},parentNode:function(e){return e.parentElement},nextSibling:function(e){return e.nextSibling},tagName:function(e){return e.tagName},setTextContent:function(e,t){e.textContent=t}},Uf=Bf("",{},[],void 0,void 0),Gf=["create","update","remove","destroy","pre","post"],Wf={init:function(e,t){function n(e){var n=e.id?"#"+e.id:"",i=e.className?"."+e.className.split(" ").join("."):"";return Bf(t.tagName(e).toLowerCase()+n+i,{},[],void 0,e)}function i(e,n){return function(){if(0==--n){var i=t.parentNode(e);t.removeChild(i,e)}}}function r(e,n){var i,o=e.data;Ic(o)&&Ic(i=o.hook)&&Ic(i=i.init)&&(i(e),o=e.data);var s,a=e.children,l=e.sel;if(Ic(l)){var c=l.indexOf("#"),u=l.indexOf(".",c),h=c>0?c:l.length,p=u>0?u:l.length,f=-1!==c||-1!==u?l.slice(0,Math.min(h,p)):l;if(s=e.elm=Ic(o)&&Ic(i=o.ns)?t.createElementNS(i,f):t.createElement(f),h<p&&(s.id=l.slice(h+1,p)),u>0&&(s.className=l.slice(p+1).replace(/\./g," ")),zf.array(a))for(i=0;i<a.length;++i)t.appendChild(s,r(a[i],n));else zf.primitive(e.text)&&t.appendChild(s,t.createTextNode(e.text));for(i=0;i<d.create.length;++i)d.create[i](Uf,e);Ic(i=e.data.hook)&&(i.create&&i.create(Uf,e),i.insert&&n.push(e))}else s=e.elm=t.createTextNode(e.text);return e.elm}function o(e,n,i,o,s,a){for(;o<=s;++o)t.insertBefore(e,r(i[o],a),n)}function s(e){var t,n,i=e.data;if(Ic(i)){for(Ic(t=i.hook)&&Ic(t=t.destroy)&&t(e),t=0;t<d.destroy.length;++t)d.destroy[t](e);if(Ic(t=e.children))for(n=0;n<e.children.length;++n)s(e.children[n])}}function a(e,n,r,o){for(;r<=o;++r){var a,l,c,u=n[r];if(Ic(u))if(Ic(u.sel)){for(s(u),l=d.remove.length+1,c=i(u.elm,l),a=0;a<d.remove.length;++a)d.remove[a](u,c);Ic(a=u.data)&&Ic(a=a.hook)&&Ic(a=a.remove)?a(u,c):c()}else t.removeChild(e,u.elm)}}function l(e,n,i,s){for(var l,u,h,d=0,p=0,f=n.length-1,m=n[0],g=n[f],v=i.length-1,y=i[0],b=i[v];d<=f&&p<=v;)Ec(m)?m=n[++d]:Ec(g)?g=n[--f]:Tc(m,y)?(c(m,y,s),m=n[++d],y=i[++p]):Tc(g,b)?(c(g,b,s),g=n[--f],b=i[--v]):Tc(m,b)?(c(m,b,s),t.insertBefore(e,m.elm,t.nextSibling(g.elm)),m=n[++d],b=i[--v]):Tc(g,y)?(c(g,y,s),t.insertBefore(e,g.elm,m.elm),g=n[--f],y=i[++p]):(Ec(l)&&(l=Lc(n,d,f)),Ec(u=l[y.key])?(t.insertBefore(e,r(y,s),m.elm),y=i[++p]):(c(h=n[u],y,s),n[u]=void 0,t.insertBefore(e,h.elm,m.elm),y=i[++p]));d>f?o(e,Ec(i[v+1])?null:i[v+1].elm,i,p,v,s):p>v&&a(e,n,d,f)}function c(e,n,i){var s,c;Ic(s=n.data)&&Ic(c=s.hook)&&Ic(s=c.prepatch)&&s(e,n);var u=n.elm=e.elm,h=e.children,p=n.children;if(e!==n){if(!Tc(e,n)){var f=t.parentNode(e.elm);return u=r(n,i),t.insertBefore(f,u,e.elm),void a(f,[e],0,0)}if(Ic(n.data)){for(s=0;s<d.update.length;++s)d.update[s](e,n);Ic(s=n.data.hook)&&Ic(s=s.update)&&s(e,n)}Ec(n.text)?Ic(h)&&Ic(p)?h!==p&&l(u,h,p,i):Ic(p)?(Ic(e.text)&&t.setTextContent(u,""),o(u,null,p,0,p.length-1,i)):Ic(h)?a(u,h,0,h.length-1):Ic(e.text)&&t.setTextContent(u,""):e.text!==n.text&&t.setTextContent(u,n.text),Ic(c)&&Ic(s=c.postpatch)&&s(e,n)}}var u,h,d={};for(Ec(t)&&(t=$f),u=0;u<Gf.length;++u)for(d[Gf[u]]=[],h=0;h<e.length;++h)void 0!==e[h][Gf[u]]&&d[Gf[u]].push(e[h][Gf[u]]);return function(e,i){var o,s,l,u=[];for(o=0;o<d.pre.length;++o)d.pre[o]();for(Ec(e.sel)&&(e=n(e)),Tc(e,i)?c(e,i,u):(s=e.elm,l=t.parentNode(s),r(i,u),null!==l&&(t.insertBefore(l,i.elm,t.nextSibling(s)),a(l,[e],0,0))),o=0;o<u.length;++o)u[o].data.hook.insert(u[o]);for(o=0;o<d.post.length;++o)d.post[o]();return i}}},Xf={xlink:"http://www.w3.org/1999/xlink"},Yf=["allowfullscreen","async","autofocus","autoplay","checked","compact","controls","declare","default","defaultchecked","defaultmuted","defaultselected","defer","disabled","draggable","enabled","formnovalidate","hidden","indeterminate","inert","ismap","itemscope","loop","multiple","muted","nohref","noresize","noshade","novalidate","nowrap","open","pauseonexit","readonly","required","reversed","scoped","seamless","selected","sortable","spellcheck","translate","truespeed","typemustmatch","visible"],Kf=Object.create(null),Qf=0,Zf=Yf.length;Qf<Zf;Qf++)Kf[Yf[Qf]]=!0;var Jf={create:kc,update:kc},em={create:Oc,update:Oc},tm="undefined"!=typeof window&&window.requestAnimationFrame||setTimeout,nm=function(e){tm(function(){tm(e)})},im={create:Nc,update:Nc,destroy:function(e){var t,n,i=e.elm,r=e.data.style;if(r&&(t=r.destroy))for(n in t)i.style[n]=t[n]},remove:function(e,t){var n=e.data.style;if(n&&n.remove){var i,r,o=e.elm,s=0,a=n.remove,l=0,c=[];for(i in a)c.push(i),o.style[i]=a[i];for(var u=(r=getComputedStyle(o))["transition-property"].split(", ");s<u.length;++s)-1!==c.indexOf(u[s])&&l++;o.addEventListener("transitionend",function(e){e.target===o&&--l,0===l&&t()})}else t()}},rm={create:Vc,update:Vc,destroy:Vc},om=function(e,t,n){var i,r,o,s={};if(void 0!==n?(s=t,zf.array(n)?i=n:zf.primitive(n)&&(r=n)):void 0!==t&&(zf.array(t)?i=t:zf.primitive(t)?r=t:s=t),zf.array(i))for(o=0;o<i.length;++o)zf.primitive(i[o])&&(i[o]=Bf(void 0,void 0,void 0,i[o]));return"s"===e[0]&&"v"===e[1]&&"g"===e[2]&&Hc(s,i,e),Bf(e,s,i,r,void 0)},sm=Wf.init([Jf,em,im,rm]),am=[function(e){e.renderer("svg",Ac)},function(e){e.renderer("canvas",hc)},function(e){e.renderer("dom",Bc)}],lm=[],cm={OFF:0,ERROR:1,WARN:2,INFO:3,DEBUG:4},um=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.level,i=void 0===n?cm.OFF:n,r=t.pipe,o=void 0===r?console:r,s=i,a=(e={},tu(e,cm.OFF,function(){}),tu(e,cm.ERROR,function(){return o.error.apply(o,arguments)}),tu(e,cm.WARN,function(){return o.warn.apply(o,arguments)}),tu(e,cm.INFO,function(){return o.info.apply(o,arguments)}),tu(e,cm.DEBUG,function(){return o.log.apply(o,arguments)}),e),l=function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];!e||s<e||(a[e]||a[cm.DEBUG]).apply(void 0,n)};return{log:l,error:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return l.apply(void 0,[cm.ERROR].concat(t))},warn:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return l.apply(void 0,[cm.WARN].concat(t))},info:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return l.apply(void 0,[cm.INFO].concat(t))},debug:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return l.apply(void 0,[cm.DEBUG].concat(t))},level:function(e){return"number"==typeof e&&(s=e),s},LOG_LEVEL:cm}},hm=$c({renderer:{prio:["svg","canvas"]},logger:{level:0},style:{"$font-family":"Arial","$font-size-m":"12px","$line-height-m":"16px",$primary:"steelblue","$primary-overlay":"white","$grey-light":"#bdbdbd",$grey:"#757575","$grey-dark":"#424242",$black:"#212121",$shape:{fill:"$primary",strokeWidth:0,stroke:"$grey-light"},"$shadow-line":{strokeWidth:1,stroke:"$grey"},$label:{fontSize:"$font-size-m",fontFamily:"$font-family",fill:"$grey-dark"}},palettes:[{key:"categorical",colors:[["#a54343","#d76c6c","#ec983d","#ecc43d","#f9ec86","#cbe989","#70ba6e","#578b60","#79d69f","#26a0a7","#138185","#65d3da"]]},{key:"diverging",colors:[["#3d52a1","#3a89c9","#77b7e5","#b4ddf7","#e6f5fe","#ffe3aa","#f9bd7e","#ed875e","#d24d3e","#ae1c3e"]]},{key:"sequential",colors:[["rgb(180,221,212)","rgb(34, 83, 90)"]]}]},{component:Qd,data:np,formatter:Sh,interaction:ip,renderer:Kd(),scale:Rd});return Bp.forEach(hm.use),am.forEach(hm.use),lm.forEach(hm.use),hm}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("assets/external/picasso-plugin-q/picasso-q",t):e.picassoQ=t()}(this,function(){"use strict";function e(e){var t=0,n=e.children,i=n&&n.length;if(i)for(;--i>=0;)t+=n[i].value;else t=1;e.value=t}function t(e,t){if(e===t)return e;var n=e.ancestors(),i=t.ancestors(),r=null;for(e=n.pop(),t=i.pop();e===t;)r=e,e=n.pop(),t=i.pop();return r}function n(e,t){var n,r,a,l,c,u=new s(e),h=+e.value&&(u.value=e.value),d=[u];for(null==t&&(t=i);n=d.pop();)if(h&&(n.value=+n.data.value),(a=t(n.data))&&(c=a.length))for(n.children=new Array(c),l=c-1;l>=0;--l)d.push(r=n.children[l]=new s(a[l])),r.parent=n,r.depth=n.depth+1;return u.eachBefore(o)}function i(e){return e.children}function r(e){e.data=e.data.data}function o(e){var t=0;do{e.height=t}while((e=e.parent)&&e.height<++t)}function s(e){this.data=e,this.depth=this.height=0,this.parent=null}function a(e,t){"/"===e.charAt(0)&&(e=e.substring(1));for(var n=e.split("/"),i=void 0,r=t,o=0;o<n.length;o++){if("*"===n[o]&&Array.isArray(r)){var s=[];i=n.slice(o+1).join("/");for(var l=0;l<r.length;l++){var c=a(i,r[l]);Array.isArray(c)?s.push.apply(s,ne(c)):s.push(c)}return s}if(!n[o]&&Array.isArray(r)){var u=new Array(r.length);i=n.slice(o+1).join("/");for(var h=0;h<r.length;h++)u[h]=a(i,r[h]);return u}n[o]in r&&(r=r[n[o]])}return r}function l(e,t){var n=e,i=t.qDimensionInfo.length,r=t.qMeasureInfo.length,o=t.qEffectiveInterColumnSortOrder;n<i&&o?n=o.indexOf(n):n>=i&&o&&r>1&&-1!==o.indexOf(-1)&&(n=o.indexOf(-1));for(var s="/qData/*/qSubNodes",a=Math.max(0,Math.min(n,i)),l=0;l<a;l++)s+="/*/qSubNodes";if(e>=i)if(r>1)for(s+="/"+(e-i)+"/qSubNodes",++l;l<=i;l++)s+="/*/qSubNodes";else s+="/"+(e-i);return s}function c(e,t,n){return"number"==typeof t?e+"/*/qAttrExps/qValues/"+t:"number"==typeof n?e+"/*/qAttrDims/qValues/"+n:e}function u(e,t){var n=t.cache,i=t.cube;if(!e)return"";var r=n.fields.indexOf(e),o=void 0,s=void 0;if(-1===r)for(var a=0;a<n.attributeDimensionFields.length;a++)if(-1!==(s=n.attributeDimensionFields[a]?n.attributeDimensionFields[a].indexOf(e):-1)){r=a;break}if(-1===r)for(var u=0;u<n.attributeExpressionFields.length;u++)if(-1!==(o=n.attributeExpressionFields[u]?n.attributeExpressionFields[u].indexOf(e):-1)){r=u;break}return c(l(r,i),o>=0?o:void 0,s>=0?s:void 0)}function h(e,t){return u(e,{cache:t.cache,cube:t.cube}).replace(/qSubNodes/g,"children").replace(/children$/g,"children/*").replace(/qData\/\*/,"")}function d(e,t,i,r){var o="/qStackedDataPages/*/qData",s=t.raw(),l=a(o,s);if(!l||!l[0])return null;for(var c=n(l[0],e.children||function(e){return e.qSubNodes}),u=c.height,d=[],p=0;p<=u;p++)!function(n){var a=r.normalizeConfig(e,t),l=a.props,c=a.main,u=Object.keys(l);d[n]={propsArr:u,props:l,main:c};var p=null,f=0===n;if(n>0){var m=s.qEffectiveInterColumnSortOrder[n-1];n>s.qEffectiveInterColumnSortOrder.length&&(m=s.qDimensionInfo.length),p=i.fields[m]}var g=p?h(p,{cube:s,cache:i}):o;u.forEach(function(e){var t=l[e];(t.fields?t.fields:[t]).forEach(function(e){if(e.field){var t=h(e.field,{cube:s,cache:i});if(t===g)e.isSame=!0;else if(f)e.isDescendant=!0,e.path=t+"/data";else{var n=t.match(/\//g).length>g.match(/\//g).length,r="";r=n?t.replace(g,"").replace(/^\/\*/,"")+"/data":Math.ceil((g.match(/\//g).length-t.match(/\//g).length)/2),e.isDescendant=n,e.path=r}}})})}(p);var f=[],m=0;return c.each(function(e){var t=f[m++]=e.data,n=d[e.depth].propsArr,i=d[e.depth].props,r=d[e.depth].main;e.data={value:"function"==typeof r.value?r.value(t):t},n.forEach(function(n){var r=i[n],o=r.fields?r.fields:[r],s=void 0;r.fields&&(s=[]),o.forEach(function(i){var o=function(e){return e},l=void 0;if("primitive"===i.type)l=i.value;else if("function"==typeof i.value&&(o=function(e,t){return i.value(e,t)}),i.field){if(i.isSame)l=t;else if(i.isDescendant)l=a(i.path,e),Array.isArray(l)&&(l=l.map(o),o=i.reduce||function(e){return e.join(", ")});else if(i.path){for(var c=i.path||0,u=e,h=0;h<c;h++)u=u.parent;l=u.data.value}}else l=t;r.fields?s.push(o(l,e)):(e.data[n]={value:o(l,e)},i.source&&(e.data[n].source={field:i.source}))}),s&&(e.data[n]={value:"function"==typeof r.value?r.value(s,e):s})})}),c}function p(e,t,n,i){var r=[];if(!e||!e.length)return r;if(t<=0){var o=i>=0?[e[i]]:e;n?r.push.apply(r,ne(o.map(function(e){return e[n]}))):r.push.apply(r,ne(o))}else for(var s=0;s<e.length;s++)e[s].children&&e[s].children.length&&r.push.apply(r,ne(p(e[s].children,t-1,n,i)));return r}function f(e,t,n,i){if(e===t){return n?Function("node","return node."+n+";"):function(e){return e}}if(e>t){var r=Math.max(0,Math.min(100,e-t)),o=[].concat(ne(Array(r))).map(String.prototype.valueOf,"parent").join(".");return n?Function("node","return node."+o+"."+n+";"):Function("node","return node."+o+";")}if(t>e){var s=Math.max(0,Math.min(100,t-e));return function(e){return p(e.children,s-1,n,i)}}return!1}function m(e,t){var n=t.cache;if("number"==typeof e)return n.fields[e];var i=n.fields.slice();if((n.attributeDimensionFields||[]).forEach(function(e){return i.push.apply(i,ne(e))}),(n.attributeExpressionFields||[]).forEach(function(e){return i.push.apply(i,ne(e))}),"function"==typeof e){for(var r=0;r<i.length;r++)if(e(i[r]))return i[r];return!1}if("string"==typeof e){for(var o=0;o<i.length;o++)if(i[o].key()===e||i[o].title()===e)return i[o]}else if(e&&-1!==i.indexOf(e))return e;throw Error("Field not found: "+e)}function g(e,t){var n=t.cube;if(!e)return-1;var i=e.key(),r=!1,o=-1,s=-1,a=-1,l=-1,c=-1,u=void 0;ie.test(i)?(r=!0,o=+ie.exec(i)[1],u=i.replace(ie,"")):re.test(i)&&(c=+re.exec(i)[1],u=i.replace(re,"")),u&&(se.exec(u)?a=+se.exec(u)[1]:oe.exec(u)&&(s=+oe.exec(u)[1]));var h=n.qEffectiveInterColumnSortOrder;return l=r?h?h.indexOf(o):o:h&&-1!==h.indexOf(-1)?h.indexOf(-1):n.qDimensionInfo.length,{fieldDepth:l+1,pseudoMeasureIndex:c,attrDimIdx:a,attrIdx:s}}function v(e,t,n){var i=f(e.fieldDepth,t.fieldDepth,n,t.pseudoMeasureIndex),r=void 0;return t.attrDimIdx>=0?r=function(e){return e.qAttrDims.qValues[t.attrDimIdx]}:t.attrIdx>=0&&(r=function(e){return e.qAttrExps.qValues[t.attrIdx]}),{nodeFn:i,attrFn:r}}function y(e,t,n){var i=n.key,r={value:"function"==typeof e.value?e.value(t):void 0!==e.value?e.value:t};return r.label="function"==typeof e.label?e.label(t):void 0!==e.label?String(e.label):String(r.value),e.field&&(r.source={key:i,field:e.field.key()}),r}function b(e,t,i,r){var o=[];return(Array.isArray(e)?e:[e]).forEach(function(e){e.field&&function(){var s=t.raw(),l=t.key(),c="object"===Q(e.field)?e.field:t.field(e.field),u=r.normalizeConfig(e,t),h=u.props,d=u.main,p=Object.keys(h);if(!i.tree){var f=a("/qStackedDataPages/*/qData",s);i.tree=n(f[0],function(e){return e.qSubNodes})}var m=g(c,{cube:s,cache:i}),b=v({fieldDepth:0},m),x=b.nodeFn,q=b.attrFn,C=!!e.trackBy,S=Q(e.trackBy),w={},_=[],D=x(i.tree);p.forEach(function(e){var t=h[e];(t.fields?t.fields:[t]).forEach(function(e){if(e.field)if(e.field===c)e.isSame=!0;else{var t=g(e.field,{cube:s,cache:i}),n=v(m,t,"data");e.accessor=n.nodeFn,e.attrAccessor=n.attrFn}})});for(var M=[],A=0;A<D.length;A++){(function(t){var n=D[t],i=q?q(n.data):n.data;if(d.filter&&!d.filter(i))return"continue";var o=y(d,i,{key:l});p.forEach(function(e){var t=h[e],r=t.fields||[t],s=void 0;t.fields&&(s=[]),r.forEach(function(r){var a=void 0,c=void 0;"primitive"===r.type?c=r.value:("function"==typeof r.value&&(a=r.value),r.accessor?(c=r.accessor(n),Array.isArray(c)?(r.attrAccessor&&(c=c.map(r.attrAccessor)),a&&(c=c.map(a),a=null),c=r.reduce?r.reduce(c):c):c=r.attrAccessor?r.attrAccessor(c):c):c=i),t.fields?s.push(a?a(c):c):(o[e]={value:a?a(c):c},o[e].label=String(o[e].value),r.field&&(o[e].source={field:r.field.key(),key:l}))}),s&&(o[e]={value:"function"==typeof t.value?t.value(s):s},o[e].label=String(o[e].value))}),C&&r.track({cfg:e,itemData:i,obj:o,target:_,tracker:w,trackType:S}),M.push(o)})(A)}C?o.push.apply(o,ne(r.collect(_,{main:d,propsArr:p,props:h}))):o.push.apply(o,M)}()}),o}function x(e,t,n){if(!e)return-1;var i=n.cache,r=i.fields.indexOf(e),o=-1,s=-1;if(-1===r)for(var a=0;a<i.attributeDimensionFields.length;a++)if(-1!==(s=i.attributeDimensionFields[a]?i.attributeDimensionFields[a].indexOf(e):-1)){r=a;break}if(-1===r)for(var l=0;l<i.attributeExpressionFields.length;l++)if(-1!==(o=i.attributeExpressionFields[l]?i.attributeExpressionFields[l].indexOf(e):-1)){r=l;break}if((r-=t.qArea.qLeft)<0||r>=t.qArea.qWidth)return-1;var c="row["+r+"]";return s>=0?Function("row","return "+c+".qAttrDims.qValues["+s+"];"):o>=0?Function("row","return "+c+".qAttrExps.qValues["+o+"];"):Function("row","return "+c+";")}function q(e,t,n){var i=n.key,r={value:"function"==typeof e.value?e.value(t):void 0!==e.value?e.value:t};return r.label="function"==typeof e.label?e.label(t):void 0!==e.label?String(e.label):String(r.value),e.field&&(r.source={key:i,field:e.field.key()}),r}function C(e){var t=e.cache,n=e.f,i=e.mainCell,r=e.p,o=e.prop,s=e.page,a=e.rowIdx,l=e.row,c=e.sourceKey,u=e.target,h=e.targetProp,d=i;if(r.field&&r.field!==n){var p=x(r.field,s,{cache:t});if(-1===p)return;d=he({qRow:a},p(l))}u[h]=q(r,d,{key:c},o)}function S(e,t,n,i){var r=[];return(Array.isArray(e)?e:[e]).forEach(function(e){if(e.field){var o=t.raw(),s=t.key(),a="object"===Q(e.field)?e.field:t.field(e.field),l=i.normalizeConfig(e,t),c=l.props,u=l.main,h=Object.keys(c),d=!!e.trackBy,p=Q(e.trackBy),f={},m=[],g=[];o.qDataPages.forEach(function(t){var r=x(a,t,{cache:n});-1!==r&&t.qMatrix.forEach(function(o,l){var v=t.qArea.qTop+l,y=he({qRow:v},r(o)),b=q(u,y,{key:s});u.filter&&!u.filter(y)||(h.forEach(function(e){var i=c[e],r=i.fields||[i];if(i.fields&&(b[e]=[]),r.forEach(function(r,l){C({cache:n,f:a,mainCell:y,p:r,prop:e,props:c,page:t,rowIdx:v,row:o,sourceKey:s,target:i.fields?b[e]:b,targetProp:i.fields?l:e})}),i.fields){var l=b[e].map(function(e){return e.value}),u=b[e].map(function(e){return e.label});b[e]={value:"function"==typeof i.value?i.value(l):void 0!==i.value?i.value:l},b[e].label="function"==typeof i.label?i.label(u):void 0!==i.label?String(i.label):String(b[e].value)}}),d&&i.track({cfg:e,itemData:y,obj:b,target:m,tracker:f,trackType:p}),g.push(b))})}),d?r.push.apply(r,ne(i.collect(m,{main:u,propsArr:h,props:c}))):r.push.apply(r,g)}}),r}function w(e){return e.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")}function _(e,t,n,i){return e=e.toString(t),n[1]===n[1].toUpperCase()&&(e=e.toUpperCase()),e.length-e.indexOf(".")>10&&(e=e.slice(0,e.indexOf(".")+11)),e.replace(".",i||".")}function D(e,t){for(var n=void 0,i="",r=Number(String(e).slice(-3)),o=(e-r)/1e3,s=[0,1,4,5,9,10,40,50,90,100,400,500,900].reverse(),a=["0","I","IV","V","IX","X","XL","L","XC","C","CD","D","CM"].reverse();r>0;)for(n=0;n<s.length;n++)if(s[n]<=r){i+=a[n],r-=s[n];break}for(n=0;n<o;n++)i="M"+i;return t[1]!==t[1].toUpperCase()&&(i=i.toLowerCase()),i}function M(e,t,n){var i=void 0;return me.test(t)?e=_(e,Number(/\d{2}/.exec(t)[0]),t,n):ge.test(t)?e=_(e,8,t,n):ve.test(t)?e=_(e,10,t,n):ye.test(t)?e=_(e,16,t,n):be.test(t)?e=_(e,2,t,n):xe.test(t)&&(i="",e<0&&(i="-",e=-e),e=0===(e=Math.floor(e))?"0":e<=5e5?i+(e=D(e,t)):t+i+e.toExponential(0)),e}function A(e,t,n){var i=w(e);return n?i:new RegExp(i||"",t)}function E(e,t){return t&&(t=w(t)),e&&(e=w(e)),new RegExp("(?:[#0]+"+e+")?[#0]+(?:"+t+"[#0]+)?")}function I(e){if(!e||!e.qNumericalAbbreviation)return pe;var t={};return e.qNumericalAbbreviation.split(";").forEach(function(e){var n=e.split(":");2===n.length&&(t[n[0]]=n[1])}),t}function T(e,t,n){var i=void 0,r=void 0,o=e.pattern,s=void 0,a=void 0,l=void 0,c=void 0,u=void 0,h=void 0,d=void 0;o.indexOf("A")>=0&&(o=o.replace("A",""),e.abbreviate=!0),d=E(t,n),a=(s=(s=o.match(d))?s[0]:"")?o.substr(0,o.indexOf(s)):o,l=s?o.substring(o.indexOf(s)+s.length):"",s||(s=o?"#":"##########"),t&&t===n&&(r=(i=s.split(n)).pop(),s=i.join("")+n+r,t=""),c=t,t=/,/.test(n)?"":",",c&&(s=s.replace(A(c,"g"),t)),u=n,n=".",u&&(s=s.replace(A(u,"g"),n)),h=(h=s.match(/#/g))?h.length:0;var p=o.split(u),f=void 0;p[1]&&(f=p[1].match(/#|0/g)),e.prefix=a||"",e.postfix=l||"",e.pattern=o,e.maxPrecision=f?f.length:2,e.percentage=fe.test(o),e.numericPattern=s||"",e.numericRegex=new RegExp(A(t,null,!0)+"|"+A(n,null,!0),"g"),e.groupTemp=c,e.decTemp=u,e.t=t,e.d=n,e.temp=h}function L(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(Ce,[null].concat(t)))}function k(e,t,n,i,r){function o(e){return s.formatValue(e)}var s=L(r,e,t,n,i);return o.format=function(e,t,n,i){return s.format(t,e,n,i)},o.pattern=function(e){return e&&(s.pattern=e,s.prepare()),s.pattern},o}function O(e,t){for(var n=e.length;n<t;n++)e="0"+e;return e}function P(e,t){var n=e.getHours(),i=e.getDay()-1;return t&&((n%=12)||(n=12)),i<0&&(i=6),{year:e.getFullYear(),month:e.getMonth(),day:i,date:e.getDate(),h:n,m:e.getMinutes(),s:e.getSeconds(),f:e.getMilliseconds(),t:e.getHours()>=12?"pm":"am"}}function N(e){var t=e.toString().split(".");return t[1]?t=Number("0."+t[1]):0}function R(e){var t=e,n=24*N(t),i=60*N(n),r=60*N(i),o=1e3*N(r);return{d:Math.floor(t),h:Math.floor(n),m:Math.floor(i),s:Math.floor(r),f:Math.round(o)}}function F(e,t){var n=R(e),i=n.d,r=n.h,o=n.m,s=n.s,a=n.f,l=0,c=void 0;/w+|t+/gi.test(t)&&(c=new Date(1899,11,30+Math.floor(e),0,0,86400*(e-Math.floor(e))),isNaN(c.getTime())&&(c=null)),/D+/gi.test(t)||(r+=24*i),/h+/gi.test(t)||(o+=60*r),/m+/gi.test(t)||(s+=60*o),/w+/gi.test(t)&&(l=c?c.getDay()-1:0)<0&&(l=6);var u="";return c&&(u=c.getHours()>=12?"pm":"am"),{year:0,month:0,day:l,date:i,h:r,m:o,s:s,f:a,t:u}}function j(e,t){return{"Y+|y+":{Y:""+Number((""+t.year).slice(-2)),YY:O((""+t.year).slice(-2),2),YYY:O((""+t.year).slice(-3),3),def:function(e){return O(""+t.year,e.length)}},"M+":{M:t.month+1,MM:O(""+(t.month+1),2),MMM:e.locale_months_abbr[t.month],def:e.locale_months[t.month]},"W+|w+":{W:t.day,WW:O(""+t.day,2),WWW:e.locale_days_abbr[t.day],def:e.locale_days[t.day]},"D+|d+":{D:t.date,def:function(e){return O(""+t.date,e.length)}},"h+|H+":{h:t.h,def:function(e){return O(""+t.h,e.length)}},"m+":{m:t.m,def:function(e){return O(""+t.m,e.length)}},"s+|S+":{s:t.s,def:function(e){return O(""+t.s,e.length)}},"f+|F+":{def:function(e){var n=""+t.f,i=e.length-n.length;if(i>0)for(var r=0;r<i;r++)n+="0";else i<0&&(n=n.slice(0,e.length));return n}},"t{1,2}|T{1,2}":{def:function(e){var n=t.t;return e[0].toUpperCase()===e[0]&&(n=n.toUpperCase()),n=n.slice(0,e.length)}}}}function V(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new(Function.prototype.bind.apply(Me,[null].concat(t)))}function H(e){return new Date(1899,11,30+Math.floor(e),0,0,0,864e5*(e-Math.floor(e)))}function B(e){function t(e){return i!==Ae.INTERVAL?H(e):e}function n(e){return e=t(e),r.format(e)}var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TS",r=V(arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e,i);return n.format=function(e,n){return n=t(n),r.format(n,e)},n.locale=function(t){return r=V(t,e,i),this},n.qtype=function(e){return void 0!==e&&(i=e),i},n}function z(e,t){if(e&&e.qNumFormat&&-1!==["D","T","TS","IV"].indexOf(e.qNumFormat.qType))return B(e.qNumFormat.qFmt,e.qNumFormat.qType,t);var n="#",i=t&&void 0!==t.qThousandSep?t.qThousandSep:",",r=t&&void 0!==t.qDecimalSep?t.qDecimalSep:".",o="U",s=e&&!!e.qIsAutoFormat;return e&&e.qNumFormat&&(n=e.qNumFormat.qFmt||n,i=e.qNumFormat.qThou||i,r=e.qNumFormat.qDec||r,o=e.qNumFormat.qType||o,s=s&&-1===["M"].indexOf(e.qNumFormat.qType)),s&&(n="#"+r+"##A",o="U"),k(n,i,r,o,t)}function $(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.meta,n=e.id,i=e.key,r=e.cube,o=e.localeInfo,s=e.fieldExtractor,a=e.value,l=void 0,c="qStateCounts"in t||"qSize"in t?"dimension":"measure",u=a||("dimension"===c?Ee(r):Ie(r)),h="dimension"===c?"first":"avg",d=z(t,o),p={id:function(){return n},key:function(){return i},raw:function(){return t},title:function(){return t.qFallbackTitle||t.label},type:function(){return c},items:function(){return l||(l=s(p)),l},min:function(){return t.qMin},max:function(){return t.qMax},value:u,label:function(e){return e.qText||""},reduce:h,formatter:function(){return d},tags:function(){return t.qTags}};return p}function U(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=arguments[2],i=arguments[3];return"K"===!t.raw().qMode?null:d(e,t,n,i)}function G(e,t,n,i){var r=t.raw();return"K"===r.qMode?b(e,t,n,i):"S"===r.qMode?S(e,t,n,i):[]}function W(e,t,n){var i=n.cache,r=n.cube,o=n.pages,s=n.fieldExtractor,a=n.key,l=n.fieldKey,c=n.localeInfo;t.qAttrDimInfo&&(i.attributeDimensionFields[e]=t.qAttrDimInfo.map(function(e,t){return e?$({meta:e,id:a+"/"+l+"/qAttrDimInfo/"+t,key:l+"/qAttrDimInfo/"+t,cube:r,pages:o,fieldExtractor:s,value:function(e){return e.qElemNo},localeInfo:c}):void 0})),t.qAttrExprInfo&&(i.attributeExpressionFields[e]=t.qAttrExprInfo.map(function(e,t){return e?$({meta:e,id:a+"/"+l+"/qAttrExprInfo/"+t,key:l+"/qAttrExprInfo/"+t,cube:r,pages:o,fieldExtractor:s,localeInfo:c}):void 0}))}function X(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.key,n=e.data,i=e.config,r=void 0===i?{}:i,o={attributeDimensionFields:[],attributeExpressionFields:[],fields:[]},s=n;if(!s.qDimensionInfo)throw new Error("The data input is not recognized as a hypercube");var a="K"===s.qMode?s.qStackedDataPages:s.qDataPages,l=X.util,c={key:function(){return t},raw:function(){return s},field:function(e){return m(e,{cache:o,cube:s,pages:a})},fields:function(){return o.fields.slice()},extract:function(e){return G(e,c,o,l)},hierarchy:function(e){return U(e,c,o,l)}},u=void 0;u="K"===s.qMode?function(e){return b({field:e},c,o,l)}:"S"===s.qMode?function(e){return S({field:e},c,o,l)}:function(){return[]};var h=s.qDimensionInfo;return h.forEach(function(e,n){var i="qDimensionInfo/"+n;o.fields.push($({meta:e,id:t+"/"+i,key:i,cube:s,pages:a,fieldExtractor:u,localeInfo:r.localeInfo})),W(n,e,{cache:o,cube:s,pages:a,fieldExtractor:u,key:t,fieldKey:i,localeInfo:r.localeInfo})}),s.qMeasureInfo.forEach(function(e,n){var i="qMeasureInfo/"+n;o.fields.push($({meta:e,id:t+"/"+i,key:i,cube:s,pages:a,fieldExtractor:u,localeInfo:r.localeInfo})),W(h.length+n,e,{cache:o,cube:s,pages:a,fieldExtractor:u,key:t,fieldKey:i,localeInfo:r.localeInfo})}),c}function Y(e,t){var n=!1,i=0,r=e,o=""+r.substr(0,r.indexOf("qHyperCube")+10),s=!0;if(Le.test(e)){i=+Le.exec(e)[1];var l=e.replace(Le,"");if(n=!0,Oe.test(l)){i=0;var c=+Oe.exec(r)[2];isNaN(c)||(i=c,r=r.replace(/\/\d+$/,"")),s=!1}else if(Pe.test(l)){var u=0;if(t){var h=a(o,t);u+=h.qMeasureInfo.length,u=h.qDimensionInfo.slice(0,i).reduce(function(e,t){return e+t.qAttrExprInfo.length},u),i=u+=+Pe.exec(r)[1],n=!1}}}else if(ke.test(e)){i=+ke.exec(e)[1],n=!1;var d=e.replace(ke,"");if(Oe.test(d)){i=0;var p=+Oe.exec(r)[2];isNaN(p)||(i=p,r=r.replace(/\/\d+$/,"")),s=!1,n=!0}else if(Pe.test(d)){var f=0;if(t){var m=a(o,t);f+=m.qMeasureInfo.length,f=m.qDimensionInfo.reduce(function(e,t){return e+t.qAttrExprInfo.length},f),f=m.qMeasureInfo.slice(0,i).reduce(function(e,t){return e+t.qAttrExprInfo.length},f),i=f+=+Pe.exec(r)[1]}}}return Te.forEach(function(e){var t=te(e,2),n=t[0],i=t[1];r=r.replace(n,i)}),s&&(r=""+r.substr(0,r.indexOf("/qHyperCubeDef")+14)),r&&"/"!==r[0]&&(r="/"+r),{index:i,path:r,type:n?"dimension":"measure"}}function K(e){X.util=e.data("matrix").util,e.data("q",X)}s.prototype=n.prototype={constructor:s,count:function(){return this.eachAfter(e)},each:function(e){var t,n,i,r,o=this,s=[o];do{for(t=s.reverse(),s=[];o=t.pop();)if(e(o),n=o.children)for(i=0,r=n.length;i<r;++i)s.push(n[i])}while(s.length);return this},eachAfter:function(e){for(var t,n,i,r=this,o=[r],s=[];r=o.pop();)if(s.push(r),t=r.children)for(n=0,i=t.length;n<i;++n)o.push(t[n]);for(;r=s.pop();)e(r);return this},eachBefore:function(e){for(var t,n,i=this,r=[i];i=r.pop();)if(e(i),t=i.children)for(n=t.length-1;n>=0;--n)r.push(t[n]);return this},sum:function(e){return this.eachAfter(function(t){for(var n=+e(t.data)||0,i=t.children,r=i&&i.length;--r>=0;)n+=i[r].value;t.value=n})},sort:function(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})},path:function(e){for(var n=this,i=t(n,e),r=[n];n!==i;)n=n.parent,r.push(n);for(var o=r.length;e!==i;)r.splice(o,0,e),e=e.parent;return r},ancestors:function(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t},descendants:function(){var e=[];return this.each(function(t){e.push(t)}),e},leaves:function(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e},links:function(){var e=this,t=[];return e.each(function(n){n!==e&&t.push({source:n.parent,target:n})}),t},copy:function(){return n(this).eachBefore(r)}};(function(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}).prototype=Object.create(s.prototype);var Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},J=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),ee=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},te=function(){function e(e,t){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{!i&&a.return&&a.return()}finally{if(r)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),ne=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},ie=/^qDimensionInfo(?:\/(\d+))?/,re=/^qMeasureInfo\/(\d+)/,oe=/\/qAttrExprInfo\/(\d+)/,se=/\/qAttrDimInfo\/(\d+)/,ae=Object.prototype.hasOwnProperty,le=Object.prototype.toString,ce=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===le.call(e)},ue=function(e){if(!e||"[object Object]"!==le.call(e))return!1;var t=ae.call(e,"constructor"),n=e.constructor&&e.constructor.prototype&&ae.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!n)return!1;var i;for(i in e);return void 0===i||ae.call(e,i)},he=function e(){var t,n,i,r,o,s,a=arguments[0],l=1,c=arguments.length,u=!1;for("boolean"==typeof a&&(u=a,a=arguments[1]||{},l=2),(null==a||"object"!=typeof a&&"function"!=typeof a)&&(a={});l<c;++l)if(null!=(t=arguments[l]))for(n in t)i=a[n],a!==(r=t[n])&&(u&&r&&(ue(r)||(o=ce(r)))?(o?(o=!1,s=i&&ce(i)?i:[]):s=i&&ue(i)?i:{},a[n]=e(u,s,r)):void 0!==r&&(a[n]=r));return a},de=("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self,function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e){!function(t,n){e.exports=n()}(0,function(){return function(e,t){if(!e||isNaN(+t))return t;var n,i,r,o,s,a,l,c,u,h,d=e.length,p=e.search(/[0-9\-\+#]/),f=p>0?e.substring(0,p):"",m=e.split("").reverse().join(""),g=m.search(/[0-9\-\+#]/),v=d-g,y=e.substring(v,v+1),b=v+("."===y||","===y?1:0),x=g>0?e.substring(b,d):"";if(e=e.substring(p,b),t="-"===e.charAt(0)?-t:+t,n=t<0?t=-t:0,i=e.match(/[^\d\-\+#]/g),r=i&&i[i.length-1]||".",o=i&&i[1]&&i[0]||",",e=e.split(r),t=t.toFixed(e[1]&&e[1].length),t=+t+"",a=e[1]&&e[1].lastIndexOf("0"),(!(c=t.split("."))[1]||c[1]&&c[1].length<=a)&&(t=(+t).toFixed(a+1)),u=e[0].split(o),e[0]=u.join(""),(s=e[0]&&e[0].indexOf("0"))>-1)for(;c[0].length<e[0].length-s;)c[0]="0"+c[0];else 0==+c[0]&&(c[0]="");if(t=t.split("."),t[0]=c[0],l=u[1]&&u[u.length-1].length){for(m="",v=(h=t[0]).length%l,d=h.length,b=0;b<d;b++)m+=h.charAt(b),!((b-v+1)%l)&&b<d-l&&(m+=o);t[0]=m}return t[1]=e[1]&&t[1]?r+t[1]:"","0"!==(i=t.join(""))&&""!==i||(n=!1),f+(n?"-":"")+i+x}})})),pe={3:"k",6:"M",9:"G",12:"T",15:"P",18:"E",21:"Z",24:"Y","-3":"m","-6":"","-9":"n","-12":"p","-15":"f","-18":"a","-21":"z","-24":"y"},fe=/%$/,me=/^\(r(0[2-9]|[12]\d|3[0-6])\)/i,ge=/^\(oct\)/i,ve=/^\(dec\)/i,ye=/^\(hex\)/i,be=/^\(bin\)/i,xe=/^\(rom\)/i,qe=/^(\(rom\)|\(bin\)|\(hex\)|\(dec\)|\(oct\)|\(r(0[2-9]|[12]\d|3[0-6])\))/i,Ce=function(){function e(t,n,i,r,o){Z(this,e),this.localeInfo=t,this.pattern=n,this.thousandDelimiter=i||",",this.decimalDelimiter=r||".",this.type=o||"numeric",this.abbreviations=I(t),this.prepare()}return J(e,[{key:"clone",value:function(){var t=new e(this.localeInfo,this.pattern,this.thousandDelimiter,this.decimalDelimiter,this.type);return t.subtype=this.subtype,t}},{key:"format",value:function(e,t,n,i){return this.prepare(t,n,i),this.formatValue(e)}},{key:"prepare",value:function(e,t,n){var i=void 0;if(void 0===e&&(e=this.pattern),void 0===t&&(t=this.thousandDelimiter),void 0===n&&(n=this.decimalDelimiter),e){this._prepared={positive:{d:n,t:t,abbreviate:!1,isFunctional:!1,prefix:"",postfix:""},negative:{d:n,t:t,abbreviate:!1,isFunctional:!1,prefix:"",postfix:""},zero:{d:n,t:t,abbreviate:!1,isFunctional:!1,prefix:"",postfix:""}},i=this._prepared;e=e.split(";"),i.positive.pattern=e[0],i.negative.pattern=e[1],i.zero.pattern=e[2],qe.test(e[0])&&(i.positive.isFunctional=!0),e[1]?qe.test(e[1])&&(i.negative.isFunctional=!0):i.negative=!1,e[2]?qe.test(e[2])&&(i.zero.isFunctional=!0):i.zero=!1,i.positive.isFunctional||T(i.positive,t,n),i.negative&&!i.negative.isFunctional&&T(i.negative,t,n),i.zero&&!i.zero.isFunctional&&T(i.zero,t,n)}else this._prepared={pattern:!1}}},{key:"formatValue",value:function(e){var t=this._prepared,n=void 0,i=void 0,r="",o=void 0,s=void 0,a="",l=void 0,c=void 0,u=void 0,h=void 0,d=void 0,p=e;if(isNaN(e))return""+p;if(e=+e,!1===t.pattern)return e.toString();if(0===e&&t.zero)return(t=t.zero).pattern;if(e<0&&t.negative?(t=t.negative,e=-e):t=t.positive,l=t.d,c=t.t,t.isFunctional)e=M(e,t.pattern,l);else{if(t.percentage&&(e*=100),t.abbreviate){var f=this.abbreviations,m=Object.keys(f).map(function(e){return parseInt(e,10)}).sort(function(e,t){return e-t}),g=void 0,v=m[0];for(u=0,i=Number(Number(e).toExponential().split("e")[1]);v<=i&&u<m.length;)v=m[++u];u>0&&(g=m[u-1]);var y=void 0;g&&i>0&&g>0?y=g:(i<0&&g<0||!g)&&(v<0&&v-i<=t.maxPrecision?y=v:g<=i&&!(v>0&&-i<=t.maxPrecision)&&(y=g)),y&&(r=f[y],e/=Math.pow(10,y))}if(o=Math.abs(e),n=t.temp,h=t.numericPattern,d=h.split(l)[1],"I"===this.type&&(e=Math.round(e)),s=e,d||"#"!==h.slice(-1)[0])if(o>=1e15||o>0&&o<=1e-14)e=o?o.toExponential(15).replace(/\.?0+(?=e)/,""):"0";else{var b=Number(e.toFixed(Math.min(20,d?d.length:0)).split(".")[0]),x=h.split(l)[0];if(x+=l,e=de(x,b)||"0",d){var q=Math.max(0,Math.min(14,d.length)),C=d.replace(/#+$/,"").length,S=("I"===this.type?0:o%1).toFixed(q).slice(2).replace(/0+$/,"");for(u=S.length;u<C;u++)S+="0";S&&(e+=l+S)}else 0===b&&(s=0)}else if(o>=Math.pow(10,n)||o<1||o<1e-4)0===e?e="0":o<1e-4||o>=1e20?(e=(e=s.toExponential(Math.max(1,Math.min(14,n))-1)).replace(/\.?0+(?=e)/,""),a=""):(e=e.toPrecision(Math.max(1,Math.min(14,n)))).indexOf(".")>=0&&(e=(e=e.replace(e.indexOf("e")<0?/0+$/:/\.?0+(?=e)/,"")).replace(".",l));else{for(h+=l,n=Math.max(0,Math.min(20,n-Math.ceil(Math.log(o)/Math.log(10)))),u=0;u<n;u++)h+="#";e=de(h,e)}e=e.replace(t.numericRegex,function(e){return e===c?t.groupTemp:e===l?t.decTemp:""}),s<0&&!/^-/.test(e)&&(e="-"+e)}return t.prefix+e+a+r+t.postfix}}],[{key:"getStaticFormatter",value:function(){return{prepare:function(){},formatValue:function(e){return""+e}}}}]),e}(),Se=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],we=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],_e=["January","February","March","April","May","June","July","August","September","October","November","December"],De=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Me=function(){function e(t,n,i){Z(this,e);var r=t||{};if(r.qCalendarStrings||(r.qCalendarStrings={qLongDayNames:Se,qDayNames:we,qLongMonthNames:_e,qMonthNames:De}),this.localeInfo=r,this.locale_days=r.qCalendarStrings.qLongDayNames.slice(),this.locale_days_abbr=r.qCalendarStrings.qDayNames.slice(),this.locale_months=r.qCalendarStrings.qLongMonthNames.slice(),this.locale_months_abbr=r.qCalendarStrings.qMonthNames.slice(),!n){var o;n=(o={},ee(o,Ae.TIME,r.qTimeFmt||"hh:mm:ss"),ee(o,Ae.DATE,r.qDateFmt||"YYYY-MM-DD"),ee(o,Ae.DATE_TIME,r.qTimestampFmt||"YYYY-MM-DD hh:mm:ss"),o)[i]}this.pattern=n}return J(e,[{key:"clone",value:function(){var t=new e(this.localeInfo,this.pattern);return t.subtype=this.subtype,t}},{key:"format",value:function(e,t){t||(t=this.pattern?this.pattern:"YYYY-MM-DD hh:mm:ss"),t=t.replace(/\[.+]|\[|]/g,"");var n=/t+/gi.test(t),i=void 0,r=j(this,i=e instanceof Date?P(e,n):F(e,t)),o=[];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&o.push(s);var a=new RegExp(o.join("|"),"g");return t.replace(a,function(e){var t=void 0,n=void 0;for(n in r)if(Object.prototype.hasOwnProperty.call(r,n)&&(t=new RegExp(n)).test(e))break;if(!t)return"";var i=void 0;for(var o in r[n])if(o===e||o.toLowerCase()===e){void 0===(i=r[n][o])&&(i=r[n][o.toLowerCase()]);break}return void 0===i&&(i=r[n].def),"function"==typeof i&&(i=i(e)),i})}}]),e}(),Ae={AUTO:"U",INTEGER:"I",NUMBER:"R",FIXED_TO:"F",MONEY:"M",DATE:"D",TIME:"T",DATE_TIME:"TS",INTERVAL:"IV"},Ee=function(e){return"S"===e.qMode?function(e){return e.qElemNumber}:function(e){return e.qElemNo}},Ie=function(e){return"S"===e.qMode?function(e){return e.qNum}:function(e){return e.qValue}},Te=[["qHyperCube","qHyperCubeDef"],["qDimensionInfo","qDimensions"],["qMeasureInfo","qMeasures"],["qAttrDimInfo","qAttributeDimensions"],["qAttrExprInfo","qAttributeExpressions"]],Le=/\/qDimensionInfo(?:\/(\d+))?/,ke=/\/qMeasureInfo\/(\d+)/,Oe=/\/qAttrDimInfo\/(\d+)(?:\/(\d+))?/,Pe=/\/qAttrExprInfo\/(\d+)/;return K.qBrushHelper=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2],i=t.byCells,r=t.primarySource,o=[],s={},a=e.isActive(),l=!1;return e.brushes().forEach(function(e){var t=Y(e.id,n);if("range"===e.type&&"measure"===t.type){var a=e.brush.ranges();a.length&&(l=!0,s.rangeSelectHyperCubeValues||(s.rangeSelectHyperCubeValues={path:t.path,ranges:[]}),a.forEach(function(e){return s.rangeSelectHyperCubeValues.ranges.push({qMeasureIx:t.index,qRange:{qMin:e.min,qMax:e.max,qMinInclEq:!0,qMaxInclEq:!0}})}))}if("range"===e.type&&"dimension"===t.type){var c=e.brush.ranges();c.length&&(l=!0,s.selectHyperCubeContinuousRange||(s.selectHyperCubeContinuousRange={path:t.path,ranges:[]}),c.forEach(function(e){return s.selectHyperCubeContinuousRange.ranges.push({qDimIx:t.index,qRange:{qMin:e.min,qMax:e.max,qMinInclEq:!0,qMaxInclEq:!1}})}))}if("value"===e.type&&"dimension"===t.type)if(i)s.selectHyperCubeCells||(s.selectHyperCubeCells={path:t.path,cols:[]}),s.selectHyperCubeCells.cols.push(t.index),e.id!==r&&(r||s.selectHyperCubeCells.values)||(s.selectHyperCubeCells.values=e.brush.values().map(function(e){return+e}).filter(function(e){return!isNaN(e)}),l=!!s.selectHyperCubeCells.values.length);else{var u=e.brush.values().map(function(e){return+e}).filter(function(e){return!isNaN(e)});l=!!u.length,o.push({params:[t.path,t.index,u,!1],method:"selectHyperCubeValues"})}}),!l&&a?[{method:"resetMadeSelections",params:[]}]:(s.rangeSelectHyperCubeValues&&o.push({method:"rangeSelectHyperCubeValues",params:[s.rangeSelectHyperCubeValues.path,s.rangeSelectHyperCubeValues.ranges,[],!0]}),s.selectHyperCubeContinuousRange&&o.push({method:"selectHyperCubeContinuousRange",params:[s.selectHyperCubeContinuousRange.path,s.selectHyperCubeContinuousRange.ranges]}),s.selectHyperCubeCells&&o.push({method:"selectHyperCubeCells",params:[s.selectHyperCubeCells.path,s.selectHyperCubeCells.values,s.selectHyperCubeCells.cols]}),o)},K}),define("objects.picasso/plugins/event-area",[],function(){return function(e){e.component("event-area",{mounted:function(e){e.classList.add("event-area"),e.style.pointerEvents="auto",e.style.zIndex=1},render:function(){return[]}})}}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("assets/external/picasso-plugin-hammer/picasso-hammer",t):e.picassoHammer=t()}(this,function(){"use strict";function e(e){return n[e]||e}function t(t,n,i){function r(e){u=e.key,l={chart:t,mediator:n,settings:a=e},a.gestures=a.gestures||[],void 0===a.enable&&(a.enable=!0)}function o(){"function"==typeof a.enable&&(a.enable=a.enable.bind(l)()),a.enable&&(a.gestures.forEach(function(t){t.options=t.options||{},void 0===t.options.enable&&(t.options.enable=!0),"function"==typeof t.options.enable&&(t.options.enable=t.options.enable.bind(l));var n=e(t.type);Hammer&&Hammer[n]&&(t.options.event=t.options.event||t.type.toLowerCase(),(c=c||new Hammer.Manager(i)).add(new Hammer[n](t.options)),Object.keys(t.events).forEach(function(e){t.events[e]=t.events[e].bind(l),c.on(e,t.events[e])}),h.push(t))}),a.gestures.forEach(function(t){var n=e(t.type);Hammer&&Hammer[n]&&(t.recognizeWith&&c.get(t.options.event).recognizeWith(t.recognizeWith.split(" ").filter(function(e){return""!==e})),t.requireFailure&&c.get(t.options.event).requireFailure(t.requireFailure.split(" ").filter(function(e){return""!==e})))}))}function s(){h.forEach(function(e){Object.keys(e.events).forEach(function(t){c.off(t,e.events[t])}),c.remove(e.options.event)}),h=[]}var a=void 0,l=void 0,c=void 0,u=void 0,h=[],d=!0;return{get key(){return u},set:function(e){r(e),s(),d&&o()},off:function(){d=!1,s()},on:function(){d=!0,0===h.length&&o()},destroy:function(){s(),c&&c.destroy(),c=null,l=null,a=null}}}var n={click:"Tap",Click:"Tap",tap:"Tap",pan:"Pan",swipe:"Swipe",rotate:"Rotate",press:"Press",pinch:"Pinch"};return function(e){e.interaction("hammer",t)}}),function(e,t,n,i){"use strict";function r(e,t,n){return setTimeout(c(e,n),t)}function o(e,t,n){return!!Array.isArray(e)&&(s(e,n[t],n),!0)}function s(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==i)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function a(t,n,i){var r="DEPRECATED METHOD: "+n+"\n"+i+" AT \n";return function(){var n=new Error("get-stack-trace"),i=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=e.console&&(e.console.warn||e.console.log);return o&&o.call(e.console,r,i),t.apply(this,arguments)}}function l(e,t,n){var i,r=t.prototype;(i=e.prototype=Object.create(r)).constructor=e,i._super=r,n&&ue(i,n)}function c(e,t){return function(){return e.apply(t,arguments)}}function u(e,t){return typeof e==pe?e.apply(t?t[0]||i:i,t):e}function h(e,t){return e===i?t:e}function d(e,t,n){s(g(t),function(t){e.addEventListener(t,n,!1)})}function p(e,t,n){s(g(t),function(t){e.removeEventListener(t,n,!1)})}function f(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function m(e,t){return e.indexOf(t)>-1}function g(e){return e.trim().split(/\s+/g)}function v(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var i=0;i<e.length;){if(n&&e[i][n]==t||!n&&e[i]===t)return i;i++}return-1}function y(e){return Array.prototype.slice.call(e,0)}function b(e,t,n){for(var i=[],r=[],o=0;o<e.length;){var s=t?e[o][t]:e[o];v(r,s)<0&&i.push(e[o]),r[o]=s,o++}return n&&(i=t?i.sort(function(e,n){return e[t]>n[t]}):i.sort()),i}function x(e,t){for(var n,r,o=t[0].toUpperCase()+t.slice(1),s=0;s<he.length;){if(n=he[s],(r=n?n+o:t)in e)return r;s++}return i}function q(){return be++}function C(t){var n=t.ownerDocument||t;return n.defaultView||n.parentWindow||e}function S(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){u(e.options.enable,[e])&&n.handler(t)},this.init()}function w(e){var t=e.options.inputClass;return new(t||(Ce?F:Se?H:qe?z:R))(e,_)}function _(e,t,n){var i=n.pointers.length,r=n.changedPointers.length,o=t&_e&&i-r==0,s=t&(Me|Ae)&&i-r==0;n.isFirst=!!o,n.isFinal=!!s,o&&(e.session={}),n.eventType=t,D(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function D(e,t){var n=e.session,i=t.pointers,r=i.length;n.firstInput||(n.firstInput=E(t)),r>1&&!n.firstMultiple?n.firstMultiple=E(t):1===r&&(n.firstMultiple=!1);var o=n.firstInput,s=n.firstMultiple,a=s?s.center:o.center,l=t.center=I(i);t.timeStamp=ge(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=O(a,l),t.distance=k(a,l),M(n,t),t.offsetDirection=L(t.deltaX,t.deltaY);var c=T(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=c.x,t.overallVelocityY=c.y,t.overallVelocity=me(c.x)>me(c.y)?c.x:c.y,t.scale=s?N(s.pointers,i):1,t.rotation=s?P(s.pointers,i):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,A(n,t);var u=e.element;f(t.srcEvent.target,u)&&(u=t.srcEvent.target),t.target=u}function M(e,t){var n=t.center,i=e.offsetDelta||{},r=e.prevDelta||{},o=e.prevInput||{};t.eventType!==_e&&o.eventType!==Me||(r=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},i=e.offsetDelta={x:n.x,y:n.y}),t.deltaX=r.x+(n.x-i.x),t.deltaY=r.y+(n.y-i.y)}function A(e,t){var n,r,o,s,a=e.lastInterval||t,l=t.timeStamp-a.timeStamp;if(t.eventType!=Ae&&(l>we||a.velocity===i)){var c=t.deltaX-a.deltaX,u=t.deltaY-a.deltaY,h=T(l,c,u);r=h.x,o=h.y,n=me(h.x)>me(h.y)?h.x:h.y,s=L(c,u),e.lastInterval=t}else n=a.velocity,r=a.velocityX,o=a.velocityY,s=a.direction;t.velocity=n,t.velocityX=r,t.velocityY=o,t.direction=s}function E(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:fe(e.pointers[n].clientX),clientY:fe(e.pointers[n].clientY)},n++;return{timeStamp:ge(),pointers:t,center:I(t),deltaX:e.deltaX,deltaY:e.deltaY}}function I(e){var t=e.length;if(1===t)return{x:fe(e[0].clientX),y:fe(e[0].clientY)};for(var n=0,i=0,r=0;r<t;)n+=e[r].clientX,i+=e[r].clientY,r++;return{x:fe(n/t),y:fe(i/t)}}function T(e,t,n){return{x:t/e||0,y:n/e||0}}function L(e,t){return e===t?Ee:me(e)>=me(t)?e<0?Ie:Te:t<0?Le:ke}function k(e,t,n){n||(n=Re);var i=t[n[0]]-e[n[0]],r=t[n[1]]-e[n[1]];return Math.sqrt(i*i+r*r)}function O(e,t,n){n||(n=Re);var i=t[n[0]]-e[n[0]],r=t[n[1]]-e[n[1]];return 180*Math.atan2(r,i)/Math.PI}function P(e,t){return O(t[1],t[0],Fe)+O(e[1],e[0],Fe)}function N(e,t){return k(t[0],t[1],Fe)/k(e[0],e[1],Fe)}function R(){this.evEl=Ve,this.evWin=He,this.pressed=!1,S.apply(this,arguments)}function F(){this.evEl=$e,this.evWin=Ue,S.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function j(){this.evTarget=We,this.evWin=Xe,this.started=!1,S.apply(this,arguments)}function V(e,t){var n=y(e.touches),i=y(e.changedTouches);return t&(Me|Ae)&&(n=b(n.concat(i),"identifier",!0)),[n,i]}function H(){this.evTarget=Ke,this.targetIds={},S.apply(this,arguments)}function B(e,t){var n=y(e.touches),i=this.targetIds;if(t&(_e|De)&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r,o,s=y(e.changedTouches),a=[],l=this.target;if(o=n.filter(function(e){return f(e.target,l)}),t===_e)for(r=0;r<o.length;)i[o[r].identifier]=!0,r++;for(r=0;r<s.length;)i[s[r].identifier]&&a.push(s[r]),t&(Me|Ae)&&delete i[s[r].identifier],r++;return a.length?[b(o.concat(a),"identifier",!0),a]:void 0}function z(){S.apply(this,arguments);var e=c(this.handler,this);this.touch=new H(this.manager,e),this.mouse=new R(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function $(e,t){e&_e?(this.primaryTouch=t.changedPointers[0].identifier,U.call(this,t)):e&(Me|Ae)&&U.call(this,t)}function U(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var i=this.lastTouches;setTimeout(function(){var e=i.indexOf(n);e>-1&&i.splice(e,1)},Qe)}}function G(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],o=Math.abs(t-r.x),s=Math.abs(n-r.y);if(o<=Ze&&s<=Ze)return!0}return!1}function W(e,t){this.manager=e,this.set(t)}function X(e){if(m(e,it))return it;var t=m(e,rt),n=m(e,ot);return t&&n?it:t||n?t?rt:ot:m(e,nt)?nt:tt}function Y(e){this.options=ue({},this.defaults,e||{}),this.id=q(),this.manager=null,this.options.enable=h(this.options.enable,!0),this.state=at,this.simultaneous={},this.requireFail=[]}function K(e){return e&dt?"cancel":e&ut?"end":e&ct?"move":e&lt?"start":""}function Q(e){return e==ke?"down":e==Le?"up":e==Ie?"left":e==Te?"right":""}function Z(e,t){var n=t.manager;return n?n.get(e):e}function J(){Y.apply(this,arguments)}function ee(){J.apply(this,arguments),this.pX=null,this.pY=null}function te(){J.apply(this,arguments)}function ne(){Y.apply(this,arguments),this._timer=null,this._input=null}function ie(){J.apply(this,arguments)}function re(){J.apply(this,arguments)}function oe(){Y.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function se(e,t){return t=t||{},t.recognizers=h(t.recognizers,se.defaults.preset),new ae(e,t)}function ae(e,t){this.options=ue({},se.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=w(this),this.touchAction=new W(this,this.options.touchAction),le(this,!0),s(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function le(e,t){var n=e.element;if(n.style){var i;s(e.options.cssProps,function(r,o){i=x(n.style,o),t?(e.oldCssProps[i]=n.style[i],n.style[i]=r):n.style[i]=e.oldCssProps[i]||""}),t||(e.oldCssProps={})}}function ce(e,n){var i=t.createEvent("Event");i.initEvent(e,!0,!0),i.gesture=n,n.target.dispatchEvent(i)}var ue,he=["","webkit","Moz","MS","ms","o"],de=t.createElement("div"),pe="function",fe=Math.round,me=Math.abs,ge=Date.now;ue="function"!=typeof Object.assign?function(e){if(e===i||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==i&&null!==r)for(var o in r)r.hasOwnProperty(o)&&(t[o]=r[o])}return t}:Object.assign;var ve=a(function(e,t,n){for(var r=Object.keys(t),o=0;o<r.length;)(!n||n&&e[r[o]]===i)&&(e[r[o]]=t[r[o]]),o++;return e},"extend","Use `assign`."),ye=a(function(e,t){return ve(e,t,!0)},"merge","Use `assign`."),be=1,xe=/mobile|tablet|ip(ad|hone|od)|android/i,qe="ontouchstart"in e,Ce=x(e,"PointerEvent")!==i,Se=qe&&xe.test(navigator.userAgent),we=25,_e=1,De=2,Me=4,Ae=8,Ee=1,Ie=2,Te=4,Le=8,ke=16,Oe=Ie|Te,Pe=Le|ke,Ne=Oe|Pe,Re=["x","y"],Fe=["clientX","clientY"];S.prototype={handler:function(){},init:function(){this.evEl&&d(this.element,this.evEl,this.domHandler),this.evTarget&&d(this.target,this.evTarget,this.domHandler),this.evWin&&d(C(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(C(this.element),this.evWin,this.domHandler)}};var je={mousedown:_e,mousemove:De,mouseup:Me},Ve="mousedown",He="mousemove mouseup";l(R,S,{handler:function(e){var t=je[e.type];t&_e&&0===e.button&&(this.pressed=!0),t&De&&1!==e.which&&(t=Me),this.pressed&&(t&Me&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:"mouse",srcEvent:e}))}});var Be={pointerdown:_e,pointermove:De,pointerup:Me,pointercancel:Ae,pointerout:Ae},ze={2:"touch",3:"pen",4:"mouse",5:"kinect"},$e="pointerdown",Ue="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&($e="MSPointerDown",Ue="MSPointerMove MSPointerUp MSPointerCancel"),l(F,S,{handler:function(e){var t=this.store,n=!1,i=e.type.toLowerCase().replace("ms",""),r=Be[i],o=ze[e.pointerType]||e.pointerType,s="touch"==o,a=v(t,e.pointerId,"pointerId");r&_e&&(0===e.button||s)?a<0&&(t.push(e),a=t.length-1):r&(Me|Ae)&&(n=!0),a<0||(t[a]=e,this.callback(this.manager,r,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),n&&t.splice(a,1))}});var Ge={touchstart:_e,touchmove:De,touchend:Me,touchcancel:Ae},We="touchstart",Xe="touchstart touchmove touchend touchcancel";l(j,S,{handler:function(e){var t=Ge[e.type];if(t===_e&&(this.started=!0),this.started){var n=V.call(this,e,t);t&(Me|Ae)&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}}});var Ye={touchstart:_e,touchmove:De,touchend:Me,touchcancel:Ae},Ke="touchstart touchmove touchend touchcancel";l(H,S,{handler:function(e){var t=Ye[e.type],n=B.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:e})}});var Qe=2500,Ze=25;l(z,S,{handler:function(e,t,n){var i="touch"==n.pointerType,r="mouse"==n.pointerType;if(!(r&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(i)$.call(this,t,n);else if(r&&G.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Je=x(de.style,"touchAction"),et=Je!==i,tt="auto",nt="manipulation",it="none",rt="pan-x",ot="pan-y",st=function(){if(!et)return!1;var t={},n=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(i){t[i]=!n||e.CSS.supports("touch-action",i)}),t}();W.prototype={set:function(e){"compute"==e&&(e=this.compute()),et&&this.manager.element.style&&st[e]&&(this.manager.element.style[Je]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return s(this.manager.recognizers,function(t){u(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),X(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var i=this.actions,r=m(i,it)&&!st[it],o=m(i,ot)&&!st[ot],s=m(i,rt)&&!st[rt];if(r){var a=1===e.pointers.length,l=e.distance<2,c=e.deltaTime<250;if(a&&l&&c)return}if(!s||!o)return r||o&&n&Oe||s&&n&Pe?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var at=1,lt=2,ct=4,ut=8,ht=ut,dt=16;Y.prototype={defaults:{},set:function(e){return ue(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(o(e,"recognizeWith",this))return this;var t=this.simultaneous;return e=Z(e,this),t[e.id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return o(e,"dropRecognizeWith",this)?this:(e=Z(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(o(e,"requireFailure",this))return this;var t=this.requireFail;return e=Z(e,this),-1===v(t,e)&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(o(e,"dropRequireFailure",this))return this;e=Z(e,this);var t=v(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){n.manager.emit(t,e)}var n=this,i=this.state;i<ut&&t(n.options.event+K(i)),t(n.options.event),e.additionalEvent&&t(e.additionalEvent),i>=ut&&t(n.options.event+K(i))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=32},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(32|at)))return!1;e++}return!0},recognize:function(e){var t=ue({},e);if(!u(this.options.enable,[this,t]))return this.reset(),void(this.state=32);this.state&(ht|dt|32)&&(this.state=at),this.state=this.process(t),this.state&(lt|ct|ut|dt)&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},l(J,Y,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,i=t&(lt|ct),r=this.attrTest(e);return i&&(n&Ae||!r)?t|dt:i||r?n&Me?t|ut:t&lt?t|ct:lt:32}}),l(ee,J,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ne},getTouchAction:function(){var e=this.options.direction,t=[];return e&Oe&&t.push(ot),e&Pe&&t.push(rt),t},directionTest:function(e){var t=this.options,n=!0,i=e.distance,r=e.direction,o=e.deltaX,s=e.deltaY;return r&t.direction||(t.direction&Oe?(r=0===o?Ee:o<0?Ie:Te,n=o!=this.pX,i=Math.abs(e.deltaX)):(r=0===s?Ee:s<0?Le:ke,n=s!=this.pY,i=Math.abs(e.deltaY))),e.direction=r,n&&i>t.threshold&&r&t.direction},attrTest:function(e){return J.prototype.attrTest.call(this,e)&&(this.state&lt||!(this.state&lt)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=Q(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),l(te,J,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[it]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&lt)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),l(ne,Y,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[tt]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,o=e.deltaTime>t.time;if(this._input=e,!i||!n||e.eventType&(Me|Ae)&&!o)this.reset();else if(e.eventType&_e)this.reset(),this._timer=r(function(){this.state=ht,this.tryEmit()},t.time,this);else if(e.eventType&Me)return ht;return 32},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===ht&&(e&&e.eventType&Me?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=ge(),this.manager.emit(this.options.event,this._input)))}}),l(ie,J,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[it]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&lt)}}),l(re,J,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Oe|Pe,pointers:1},getTouchAction:function(){return ee.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return n&(Oe|Pe)?t=e.overallVelocity:n&Oe?t=e.overallVelocityX:n&Pe&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&me(t)>this.options.velocity&&e.eventType&Me},emit:function(e){var t=Q(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),l(oe,Y,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[nt]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,i=e.distance<t.threshold,o=e.deltaTime<t.time;if(this.reset(),e.eventType&_e&&0===this.count)return this.failTimeout();if(i&&o&&n){if(e.eventType!=Me)return this.failTimeout();var s=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||k(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,a&&s?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=r(function(){this.state=ht,this.tryEmit()},t.interval,this),lt):ht}return 32},failTimeout:function(){return this._timer=r(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ht&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),se.VERSION="2.0.7",se.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[ie,{enable:!1}],[te,{enable:!1},["rotate"]],[re,{direction:Oe}],[ee,{direction:Oe},["swipe"]],[oe],[oe,{event:"doubletap",taps:2},["tap"]],[ne]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};ae.prototype={set:function(e){return ue(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var n,i=this.recognizers,r=t.curRecognizer;(!r||r&&r.state&ht)&&(r=t.curRecognizer=null);for(var o=0;o<i.length;)n=i[o],2===t.stopped||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(e),!r&&n.state&(lt|ct|ut)&&(r=t.curRecognizer=n),o++}},get:function(e){if(e instanceof Y)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(o(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(o(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=v(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==i&&t!==i){var n=this.handlers;return s(g(e),function(e){n[e]=n[e]||[],n[e].push(t)}),this}},off:function(e,t){if(e!==i){var n=this.handlers;return s(g(e),function(e){t?n[e]&&n[e].splice(v(n[e],t),1):delete n[e]}),this}},emit:function(e,t){this.options.domEvents&&ce(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](t),i++}},destroy:function(){this.element&&le(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},ue(se,{INPUT_START:_e,INPUT_MOVE:De,INPUT_END:Me,INPUT_CANCEL:Ae,STATE_POSSIBLE:at,STATE_BEGAN:lt,STATE_CHANGED:ct,STATE_ENDED:ut,STATE_RECOGNIZED:ht,STATE_CANCELLED:dt,STATE_FAILED:32,DIRECTION_NONE:Ee,DIRECTION_LEFT:Ie,DIRECTION_RIGHT:Te,DIRECTION_UP:Le,DIRECTION_DOWN:ke,DIRECTION_HORIZONTAL:Oe,DIRECTION_VERTICAL:Pe,DIRECTION_ALL:Ne,Manager:ae,Input:S,TouchAction:W,TouchInput:H,MouseInput:R,PointerEventInput:F,TouchMouseInput:z,SingleTouchInput:j,Recognizer:Y,AttrRecognizer:J,Tap:oe,Pan:ee,Swipe:re,Pinch:te,Rotate:ie,Press:ne,on:d,off:p,each:s,merge:ye,extend:ve,assign:ue,inherit:l,bindFn:c,prefixed:x}),(void 0!==e?e:"undefined"!=typeof self?self:{}).Hammer=se,"function"==typeof define&&define.amd?define("assets/external/hammerjs/hammer",[],function(){return se}):"undefined"!=typeof module&&module.exports?module.exports=se:e.Hammer=se}(window,document),define("objects.picasso/picasso-setup",["core.utils/debug-flags","assets/external/picasso/picasso","assets/external/picasso-plugin-q/picasso-q","objects.picasso/plugins/event-area","assets/external/picasso-plugin-hammer/picasso-hammer","assets/external/hammerjs/hammer"],function(e,t,n,i,r){return function(){t.renderer.prio(["canvas"]),e.DEVELOPER&&t.logger.level(t.logger.LOG_LEVEL.WARN),t.use(n),t.use(r),t.use(i)}}),define("objects.picasso/legend/legend-utils",["translator","touche"],function(e,t){function n(e){return e.label?e.label:e.min&&e.max?e.min+" - "+(e.isMax?"":"<")+e.max:e.max?"<"+e.max:">"+e.min}function i(t){var n=t.colorItems,i=t.selectionSettings,r=t.colorMap,o=t.colorDataInfo,s=r.getLegendDataProvider()?r.getLegendDataProvider().getLegendMarker():"rect",a=n.map(function(e){return Array.isArray(e.id)?e.id[0]:e.id}),d=n.map(function(e){return e.color.toRGBA()}),p=function(e){return r.getColorFromPreScaledValue(e.qElemNo)},f={extract:{source:t.source,field:"qDimensionInfo/"+(t.dimIndex||0),props:{label:function(e){return e.qText}}}};if(o.hasOthers){var m=e.get("properties.dimensionLimits.others"),g=r.getColorFromPreScaledValue([c],m);f.amend=[{value:c,label:{value:m},color:{value:g},source:{}}],a.push(c),d.push(g)}var v=function(e){return e.value};v.ref="color";var y={displayOrder:u,minimumLayoutMode:"MEDIUM",prioOrder:h,scale:{type:"categorical-color",data:f,label:function(e){return e.label.value},trackBy:"id"},settings:{title:t.title,item:{shape:{type:s}}},brush:{trigger:i&&i.trigger||[],consume:i&&i.consume||[]}};return o.altMode?(y.scale.domain=a,y.scale.range=d):(y.scale.data.extract.props.color=function(e){return p(e).toHex()},y.scale.data.extract.filter=function(e){var t=p(e);return e.qElemNo!==l&&!t.isInvalid()},y.settings.item.shape.fill=v),y}function r(e){var t=e.colorItems,i=e.colorMap,r=i.getLegendDataProvider()?i.getLegendDataProvider().getLegendMarker():"rect",o=t.map(n),s=t.map(function(e){return e.color.toRGBA()});return{displayOrder:u,minimumLayoutMode:"MEDIUM",prioOrder:h,scale:{type:"categorical-color",domain:o,range:s},settings:{title:e.title,item:{shape:{type:r}}}}}function o(e){var t=e.colorItems,n=[],i=[],r=t[t.length-1].id[1],o=t[0].id[0],s=t[t.length-1].min,a=t[0].max,l=(o-r)/1e6;return t.forEach(function(e){n.push(e.id[0]-l),n.push(e.id[1]+l)}),t.forEach(function(e){i.push(e.grad[0].toRGBA()),i.push(e.grad[1].toRGBA())}),{displayOrder:u,prioOrder:h,settings:{fill:{type:"color",range:i,domain:n,min:r,max:o},major:{type:"linear",min:r,max:o},tick:{label:function(e){return 0===e?s:a}},title:e.title}}}function s(e,t,n){return n&&"dimension"===t.colorMode?n.map(function(t,n){var i=t[1].qNum,r=t[0].qText,o=e.getColorFromPreScaledValue(i,r);return{id:t[0].qElemNumber,index:n,label:r,color:o}}).filter(function(e){return!e.color.isInvalid()}).slice(0,100):e.getColorMapping().concat().filter(function(e){return!e.color.isInvalid()})}function a(e,t){return{show:t.showTitle,text:e.getLegendTitle()}}var l=-2,c=-3,u=200,h=50;return{getLegendData:function(e){var t=e.colorMap,n=t.getColorDataInfo(),l=n.legendMode||{};if(n.valid){var c=s(t,l,e.legendData);if(0!==c.length){var u={colorMap:t,selectionSettings:e.selectionSettings,source:e.source,dimIndex:e.dimIndex,colorDataInfo:n,colorItems:c,title:a(t,l)};return l.discrete?{type:"categorical-legend",settings:"dimension"===l.colorMode?i(u):r(u)}:{type:"sequential-legend",settings:o(u)}}}},getCategoricalLegendPanGesture:function(e,n,i){function r(t,n){if(!n)return!1;var i={x:n.center.x-n.deltaX,y:n.center.y-n.deltaY};return this.chart.componentsFromPoint(i).some(function(t){return t.settings.key===e})}function o(){c&&(clearInterval(c),c=null)}var s,a,l,c;return[{type:"Pan",options:{event:"catlegendpan",threshold:1,enable:r},events:{catlegendpanstart:function(t){o(),s=void 0,a=0,s={x:t.deltaX,y:t.deltaY};var i=this.chart.findShapes("container").filter(function(t){return t.key===e&&t.collider}).map(function(e){return n?e.width:e.height});!i||i.length<3?s=void 0:l=i[i.length-3]},catlegendpanmove:function(t){if(s){var r=l||30,o=this.chart.component(e),c=n?i?t.deltaX-s.x:s.x-t.deltaX:s.y-t.deltaY,u=Math.floor(.5+c/r);o.emit("scroll",u-a),a=u}},catlegendpanend:function(){s=void 0,a=0},catlegendpancancel:function(){s=void 0,a=0}}},{type:"Press",options:{enable:r},events:{press:function(n){var i=this.chart.component(e);o(),c=setInterval(function(){i.emit("tap",n,1)},100),t.preventGestures()},pressup:function(){o()}}}]},onMouseWheel:function(e,t,n){if(n&&t.componentsFromPoint(e).some(function(e){return e.settings.key===n})){var i=t.component(n),r=e.delta>0?500:-500;return i.emit("scroll",Math.max(-1,Math.min(1,-r))),!0}}}}),define("extensions.qliktech/mapchart/legends/CategoricalLegend",["require","exports","objects.picasso/legend/legend-utils","client.utils/theme/theme-module"],function(e,t,n,i){"use strict";var r;return function(e){function t(e){return e.label?e.label:e.min&&e.max?e.min+" - "+(e.isMax?"":"<")+e.max:e.max?"<"+e.max:">"+e.min}e.add=function(e,r,o,s,a){var l,c=void 0;if(r.colorMapping.length>0)l=r.colorMapping.map(function(e){return e.color.toRGBA()}),c=r.colorMapping.map(t);else{var u=i.get(),h=[],d=r.wrangled.reduce(function(e,t){return-1===h.indexOf(t.elemValue)&&(h.push(t.elemValue),e.push(t)),e},[]).map(function(e,t){return o.colorElemNos.has(e.elemValue)?{index:t,baseColor:e.baseColor,text:e.text,elemValue:e.elemValue}:null}).filter(function(e){return null!=e}).sort(function(e,t){return(e.text||"").localeCompare(t.text||"")});l=d.map(function(e){return e.baseColor&&e.baseColor.color?u.resolveColor(e.baseColor):r.qualitativeScale[(r.persistentColors?e.elemValue:e.index)%r.qualitativeScale.length]}),c=d.map(function(e){return e.elemValue})}return e.addComponent("categorical-legend",{key:"cat-legend",scale:{type:"categorical-color",range:l,domain:c,data:{extract:{field:r.path,value:function(e){return e},props:{brush:{}},filter:function(e){return e.qElemNo>=0&&o.colorElemNos.has(e.qElemNo)}}},label:function(e){return e.value.qText},value:function(e){return e.value.qElemNo}},displayOrder:0,settings:{item:{label:{wordBreak:"break-word",maxLines:2,hyphens:"auto",maxWidth:110},shape:{size:10}}},brush:s()?{trigger:[{on:"tap",action:"toggle",data:["brush"],contexts:["itemHighlight"]}],consume:[{context:"itemHighlight",style:{inactive:{opacity:.4}}}]}:void 0},{show:!0,showTitle:!1,dock:a?"top":"center"}),s()&&(e.addInteraction({},{gestures:n.getCategoricalLegendPanGesture("cat-legend",a,!1)}),e.addInteraction({},{gestures:[{type:"Tap",options:{taps:1},events:{tap:function(e){var t=this.chart.component("cat-legend");t&&t.emit("tap",e,3)}}}]})),!0}}(r||(r={})),r}),define("extensions.qliktech/mapchart/legends/SequentialLegend",["require","exports"],function(e,t){"use strict";var n;return function(e){e.add=function(e,t,n,i,r,o){var s=t.activeScale._colorParts[0].reduce(function(e,t,n){return e.concat(t.slice(0===n?0:1,2).map(function(e){return e.toRGB()}))},[]),a=t.activeScale._min,l=t.activeScale._max;return a===l&&(l+=1e-6*l),e.addComponent("sequential-legend",{key:"seq-legend",displayOrder:0,minimumLayoutMode:"SPARK",settings:{fill:{data:{field:t.path},type:"sequential-color",range:s.reverse(),min:a,max:l},major:{data:{field:t.path},invert:!o,min:a,max:l},title:{text:"Measure",maxLines:2,wordBreak:"break-word"},length:1}},{show:!0,showTitle:!1,dock:o?"top":"center"}),e.addComponent("range",{key:"legendRangeBrush",dock:"@seq-legend",settings:{target:{selector:'[id="legend-seq-target"]',fillSelector:'[id="legend-seq-ticks"]'}}},{brushKey:"rangeHighlight",brushScale:{data:{field:t.path},invert:!o,min:a,max:l},isHorizontal:o,multiple:!1}),e.addInteraction({},{gestures:[{type:"Pan",options:{direction:o?Hammer.DIRECTION_HORIZONTAL:Hammer.DIRECTION_VERTICAL,event:"legendRange",enable:function(){return!i||i()}},events:{legendRangestart:function(e){this.chart.component("legendRangeBrush").emit("rangeStart",e)},legendRangemove:function(e){this.chart.component("legendRangeBrush").emit("rangeMove",e)},legendRangeend:function(e){r.commit(),this.chart.component("legendRangeBrush").emit("rangeEnd",e)}}}]}),!0}}(n||(n={})),n}),define("extensions.qliktech/mapchart/legends/LegendUtils",["require","exports","objects.utils/chart-style-utils","core.utils/feature-flags","./CategoricalLegend","./SequentialLegend","util"],function(e,t,n,i,r,o,s){"use strict";var a;return function(e){function t(e,t,r,o){return!1!==i.THEMING?r.settings.style={fontSize:n.getFontSize("mapChart",t,"fontSize"),fontFamily:"QlikView Sans",fill:n.getStyle("mapChart",t,"color")}:r.settings.style={fontSize:n.getFontSize("",t,"fontSize"),fontFamily:n.getStyle("",t,"fontFamily"),fill:n.getStyle("",t,"color")},e.addComponent("text",r,o)}e.addColorLegend=function(e,n,i,a,l){if(!n.valid)return!1;if(t(e,"legend.title",{text:n.title,settings:{anchor:"left",paddingLeft:5},dock:"top",displayOrder:1e3}),n.path){var c=s.getValue(i.excludeLayout.qHyperCube,n.path.replace(/\//g,"."));c&&(c.qIsAutoFormat=!0)}var u=function(){var e=i.map.extensionObject;return e.inAnalysisState()&&!1!==e.options.selections};return n.discrete?r.add(e,n,i,u,l):o.add(e,n,i,u,a,l)},e.addTextComponent=t}(a||(a={})),a}),define("extensions.qliktech/mapchart/legends/SizeLegend",["require","exports"],function(e,t){"use strict";var n;return function(e){e.add=function(e,t,n){return!1}}(n||(n={})),n}),define("extensions.qliktech/mapchart/legends/LegendSelectionHandler",["require","exports"],function(e,t){"use strict";return function(){function e(t,n){var i=this;this.mapChart=t.map,this.layer=t;var r=t.map.selectTool,o=n.brush("itemHighlight"),s=n.brush("rangeHighlight");this.brushes=[o,s],r.Cleared.bind(function(){this.end()}.bind(this)),o.on("start",function(){i.endOthers(),r.activate(),i.attach()}).on("end",function(){i.detach()}).on("update",function(){r.legendSelect(t,this)}),s.on("start",function(){i.endOthers(),r.activate(),i.attach()}).on("end",function(){i.detach(),s.clear();var e=n.component("legendRangeBrush");e&&e.emit("rangeClear")}).on("update",function(){r.legendSelect(t,this)}),this.listener=function(){this.end(),r.clearSelections()}.bind(this),e.handlers.push(this)}return e.prototype.commit=function(){this.mapChart.selectTool.commit(this.layer)},e.prototype.attach=function(){this.detach(),this.listenerId=this.mapChart.map.addListener("click",this.listener),this.mapChart.selectTool.Activated.once(this.listener)},e.prototype.detach=function(){try{this.mapChart.map.removeListener(this.listenerId)}catch(e){}this.mapChart.selectTool.Activated.unbind(this.listener)},e.prototype.endOthers=function(){var t=this;e.handlers.forEach(function(e){e!==t&&e.end()})},e.prototype.end=function(){this.brushes.forEach(function(e){return e.end()})},e.prototype.destroy=function(){this.detach()},e.handlers=[],e}()}),define("extensions.qliktech/mapchart/legends/Legend",["require","exports","objects.picasso/chart-builder/chart-builder","assets/external/picasso/picasso","objects.picasso/picasso-setup","../DataLayer","./Sidebar","objects.views/charts/representation/combo-color-map","./LegendUtils","./SizeLegend","core.utils/deferred","translator","objects.utils/event-utils","./LegendSelectionHandler"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p){"use strict";return r(),function(){function e(e,t,n){var r=this;this.isDetailed=!0,this.hasColorOrSizeLegend=!1,this.isDimmed=!1,this.height=0,this.options=n||{},this.sidebar=t.map.sidebar,this.layer=t,this.element=$("<div>").addClass("legend"),this.typeName=e,this.picassoElement=$("<div>").appendTo(this.element)[0],this.picasso=i.chart({element:this.picassoElement}),t instanceof o&&(this.selectionHandler=new p(t,this.picasso),this.element.on("mousewheel DOMMouseScroll",function(e){var n=t.map.extensionObject,i=r.picasso.component("cat-legend");if(i&&n.inAnalysisState()&&!1!==n.options.selections){var o=e.originalEvent,s=d.getMouseWheelData(o).delta>0?500:-500;i.emit("scroll",Math.max(-1,Math.min(1,-s))),o.preventDefault()}}),this.element.on("touchstart",function(e){e.preventDefault()})),this.errorDiv=$('<div class="map-error-container"><div qv-errorhandler class="object-error" tid="object.Error"><div class="object-error-content"><div class="object-error-title"/><div class="object-error-message"/></div></div></div>'),$(this.picassoElement).append(this.errorDiv),this.errorDiv.hide(),this.setDisplayMode(t.layout.displayLegend)}return e.prototype.generatePicassoSettings=function(){var t=this;this.hasColorOrSizeLegend=!1;var i=n.create({chartID:this.typeName});l.addTextComponent(i,"title.main",{key:"dimension",text:function(e){if(t.options.title)return t.options.title()||h.get("geo.dropmenu.noName");var n=t.layer.excludeLayout.qHyperCube.qDimensionInfo;return n.length?n[0].qFallbackTitle:h.get("geo.dropmenu.noName")},dock:"top",displayOrder:3e3,settings:{paddingStart:0,paddingEnd:10,paddingLeft:5,paddingRight:0,anchor:"left"}}),l.addTextComponent(i,"title.subTitle",{key:"layerType",text:h.get(this.typeName),dock:"top",displayOrder:2e3,settings:{paddingStart:5,paddingEnd:5,paddingLeft:5,paddingRight:0,anchor:"left"}});var r=this.layer.hyperCubeLayout.qDimensionInfo.length>0;if(this.isDetailed&&!this.isDimmedOrError()&&this.layer instanceof o&&r){var s=this.selectionHandler,a=null!=this.sidebar&&this.sidebar.isHorizontal();this.options.showSizeLegend&&(this.hasColorOrSizeLegend=this.hasColorOrSizeLegend||c.add(i,this.layer,a));var u=this.layer.colorMap.getColorLegendInfo(this.layer.excludeLayout.qHyperCube);e.shouldShowColorLegend(u.colorMode)&&(this.hasColorOrSizeLegend=this.hasColorOrSizeLegend||l.addColorLegend(i,u,this.layer,s,a))}var d=i.getSettings();d.dockLayout.center={minWidthRatio:0,minHeightRatio:0};var p=this.layer.map.chartScale;return d.dockLayout.logicalSize={width:this.element.width()/p,height:this.element.height()/p},d},e.prototype.update=function(e,t,n){var i=this,r=t||new u;if(this.setDisplayMode(this.layer.layout.displayLegend),n)return r.resolve(this),r.promise;if(!this.isAdded()||!this.sidebar)return this.height=0,r.resolve(this),r.promise;var o={settings:this.generatePicassoSettings()};if(e){o.data={key:"qHyperCube",type:"q",data:this.layer.excludeLayout.qHyperCube};var a=this.picasso.component("cat-legend");a&&a.emit("resetindex")}try{this.picasso.update(o)}catch(e){}this.selectionHandler&&this.selectionHandler.end();var l=!1,c=this.sidebar.isHorizontal();if(this.isExpanded()){if(this.height!==s.HORIZONTAL_HEIGHT)return this.height=s.HORIZONTAL_HEIGHT,setTimeout(function(){i.sidebar&&(i.resize(c),setTimeout(function(){return i.sidebar.update(i.layer.map)}))}),r.promise}else this.errorDiv.is(":visible")?this.height=1.2*this.errorDiv.find(".object-error-content").height():(this.height=1.3*$("canvas",this.picassoElement).get().reduce(function(e,t){return e+t.clientHeight},0),this.height<20&&(this.height=75,l=!0,n=!0));return(l=l||this.resize(c))?setTimeout(function(){i.update(void 0,r,n)}):setTimeout(function(){return r.resolve(i)}),r.promise},e.prototype.getElement=function(){return this.element},e.prototype.setDrawOrder=function(e){this.element.css("order",e)},e.prototype.setError=function(e,t,n){e&&t?(this.errorDiv.find(".object-error").addClass(e),this.errorDiv.find(".object-error-message").html(t),n&&this.errorDiv.find(".object-error-title").html(n),this.errorDiv.show(),this.update()):this.errorDiv.hide()},e.prototype.isAdded=function(){return this.element.parent().length>0},e.prototype.isExpanded=function(){return this.isDetailed&&this.hasColorOrSizeLegend&&!this.isDimmedOrError()},e.prototype.isDimmedOrError=function(){return this.isDimmed||this.errorDiv.is(":visible")},e.prototype.show=function(){this.sidebar&&!this.isAdded()&&(this.sidebar.addLegend(this),this.sidebar.update(this.layer.map))},e.prototype.hide=function(){this.sidebar&&this.isAdded()&&(this.height=0,this.sidebar.removeLegend(this),this.sidebar.update(this.layer.map))},e.prototype.resize=function(e){var t=$(this.picassoElement).parent(),n=e?"max-width":"max-height";if(this.isExpanded()){if("none"!==t.css(n))return t.css({maxHeight:"none",maxWidth:"none"}),!0}else e?(t.css("max-width","200px"),t.css("max-height",s.HORIZONTAL_HEIGHT)):(t.css("max-width","none"),t.css("max-height",this.height+"px"));return!1},e.prototype.remove=function(){this.hide(),this.sidebar=null,this.selectionHandler&&this.selectionHandler.destroy()},e.prototype.setDimmed=function(e){e!==this.isDimmed&&(this.isDimmed=e,this.element.toggleClass("dim",e),this.update())},e.prototype.setDisplayMode=function(e){if(this.sidebar)switch(e){case"none":this.hide();break;case"small":this.isDetailed=!1,this.show();break;case"full":case"auto":default:this.isDetailed=!0,this.show()}},e.shouldShowColorLegend=function(t){return-1!==e.COLOR_MODES.indexOf(t)},e.COLOR_MODES=[a.MEASURE,a.DIMENSION,a.QUALITATIVE],e}()}),define("extensions.qliktech/mapchart/Wm5Loader",["require","exports"],function(e,t){"use strict";return{load:function(t,n,i,r){r.isBuild?i():e(["./ErrorHandler"],function(t){var r=function(){"FAILED"===idevio.Connection.status?(t.mapScriptFailed({message:idevio.Connection.message||"Unknown error"}),i.error({title:"geo.error.WebMapInvalidKey",specialTitleSet:!0,showRemove:!1})):i(idevio)};if(window.onIdevioWebMapLoaded){if("mapchart"!==window.onIdevioWebMapLoaded.src&&"LOADING"===idevio.Connection.status){var o=window;return o.idevio=o.idevio||{},o.idevio.Connection=o.idevio.Connection||{},o.idevio.Connection.delayedInit=o.idevio.Connection.delayedInit||[],void o.idevio.Connection.delayedInit.push(r)}}else r.src="mapchart",window.onIdevioWebMapLoaded=window.onIdevioWebMapError=r;if("undefined"!=typeof idevio&&idevio.Connection&&idevio.Connection.status)"LOADING"!==idevio.Connection.status&&r();else{var s=function(t){var i="https://maps.qlikcloud.com",r="feb18-bxon0nKvbqJ8sn8";if(t)try{var o=JSON.parse(t);i=o.serverUrl||i,r=o.serverKey||r}catch(e){console.error("Failed to parse mapconf.json")}n([i+"/ravegeo/webmap5/script/webmap.nocache.js?key="+r+"&opt=tools,iconfactory,geojson,gml"],function(){},function(){e(["./Wm5Local"])})};e(["text!assets/mapconf.json"],s,function(){s()})}})}}}),define("extensions.qliktech/mapchart/WebMap5",["require","exports","./Wm5Loader!"],function(e,t){"use strict";return idevio});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions.qliktech/mapchart/SenseTool",["require","exports","objects.utils/interaction-states","./WebMap5"],function(e,t,n){"use strict";return function(e){function t(n,i){var r=e.call(this,i)||this;return r.validStates=t.DEFAULT_STATES,r.viewOption=null,r.mapChart=n,i&&(i.states&&(r.validStates=i.states),i.viewOption&&(r.viewOption=i.viewOption)),r}return __extends(t,e),t.prototype.isValidState=function(){var e=this.mapChart.extensionObject.options;return-1!==this.validStates.indexOf(e.interactionState)&&(!this.viewOption||!1!==e[this.viewOption])},t.prototype._addListener=function(e,t){var n=this;this._listeners.push(this._map.addListener(e,function(e){n.isActive()&&n._map&&n.isValidState()&&t.call(n,e)}))},t.patch=function(e,n,i){return Object.defineProperties(e,{viewOption:{value:i?i.viewOption:null},mapChart:{value:n},validStates:{value:i&&i.states||t.DEFAULT_STATES},isValidState:{value:t.prototype.isValidState},_addListener:{value:t.prototype._addListener}}),e},t.DEFAULT_STATES=[n.ANALYSIS],t}(idevio.map.Tool)}),define("extensions.qliktech/mapchart/MapTooltipService",["require","exports","qvangular","general.utils/shapes/point","objects.views/charts/tooltip/chart-tooltip-service"],function(e,t,n,i){"use strict";return function(){function e(){var e=this;this.opener=null,this.openedByClick=!1,this.tooltipService=n.getService("qvChartTooltipService"),this.tooltipRootElem=$("body > div#qs-chart-tooltip"),this.tooltipService.Closed.bind(function(){e.getTooltipElem().css("pointerEvents","all"),e.opener&&e.opener.clear(),e.opener=null,e.openedByClick=!1})}return e.get=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.getTooltipElem=function(){return $("div.qv-tooltip",this.tooltipRootElem)},e.prototype.isOpen=function(){return null!=this.opener},e.prototype.open=function(e,t,n,r,o,s){var a=e[0],l=e[1],c=new i(a,l);this.tooltipService.open({position:[c,c,c,c],content:t,direction:["top"],dir:n,template:void 0,numberInExcess:Math.max(0,s||0)},void 0,500),this.opener&&r!==this.opener&&this.opener.clear(),this.openedByClick=o,this.getTooltipElem().css("pointerEvents","none"),this.opener=r},e.prototype.close=function(){this.isOpen()&&this.tooltipService.close()},e.prototype.move=function(e,t){if(this.isOpen()){var n=this.getTooltipElem(),i=Number(n.css("left").replace("px","")),r=Number(n.css("top").replace("px",""));n.css({top:r+t+"px",left:i+e+"px"})}},e.instance=null,e}()});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions.qliktech/mapchart/ToolTipTool",["require","exports","./SenseTool","encoder","./DataUtils","objects.views/charts/representation/combo-color-map","./MapTooltipService","./Utils"],function(e,t,n,i,r,o,s,a){"use strict";return function(e){function t(t,n){var i=e.call(this,n,{viewOption:"tooltips"})||this;return i.tooltipService=s.get(),i.features=null,i.position=null,i.coordinate=null,i.layer=t,i.direction=n.extensionObject.options.direction,i.connectTo(n.map),i}return __extends(t,e),t.prototype.clear=function(){this.features=null,this.position=null,this.coordinate=null},t.prototype.closeTooltip=function(){this.tooltipService.close(),this.clear()},t.prototype.belongsToMyDataset=function(e){return e.getDataset()===this.layer.layer.getDataset()},t.prototype.calcGoodPosition=function(e,n){for(var i=this.mapChart.map.geoToDisplay(e[0].getCenter()),r=1;r<e.length;r++){var o=this.mapChart.map.geoToDisplay(e[r].getCenter());if(Math.sqrt(Math.pow(i[0]-o[0],2)+Math.pow(i[1]-o[1],2))>t.MULTI_CENTER_TOLERANCE_PX){i=[n.clientX,n.clientY];break}}i[0]=Math.max(0,Math.min(this.mapChart.mapDiv.width(),i[0])),i[1]=Math.max(1,Math.min(this.mapChart.mapDiv.height(),i[1])),this.position=i,this.coordinate=this.mapChart.map.displayToGeo(this.position);var s=this.mapChart.mapDiv.offset();return[s.left+i[0],s.top+i[1]]},t.prototype.openTooltip=function(e){var n=this;if(e.target){var i=this.mapChart.map.getFeaturesAt(e.clientX,e.clientY).filter(function(e){return n.belongsToMyDataset(e)});if(!(this.features&&i.length===this.features.length&&i.reduce(function(e,t){return e&&-1!==n.features.indexOf(t)},!0))){this.features=i;var r=this.features.slice(0,t.MAX_FEATURES),o=this.calcGoodPosition(r,e);this.tooltipService.open(o,this.generateContent(r),this.direction,this,"click"===e.type,i.length-t.MAX_FEATURES)}}},t.prototype.generateContent=function(e){var n=this,s={};e.forEach(function(e){var l=e.getAttribute("name"),c={header:e.getAttribute("name"),rows:{color:{},size:{}}},u=n.layer.colorMap.getComboColorMap();if(!a.isExcluded(e)){var h=e.getAttribute("color")||void 0;if(-1!==t.COLOR_MODES.indexOf(u.mode)&&h&&h.color){var d=n.layer.colorMap.getColorProperties(),p=d.expressionIsColor&&u.mode===o.EXPRESSION?"":i.encodeForHTML(h.value||"-"),f=u.getLegendTitle(),m="byExpression"===d.mode?"colorByExpression":"colorByAlternative";if(f){var g='<span dir="'+n.direction+'">'+n.formatValue(m,p)+"</span>",v="";p||(g="",v="margin-right: 0;"),c.rows.color={label:f,num:void 0,value:n.formatValue(m,p),template:'<div class="color-template-wrapper"><div class="color-dot" style="background:'+h.color+";"+v+'"></div>'+g+"</div>"}}}var y=e.getAttribute("size")||void 0;null!=y&&(f=r.getDimensionExpressionTitle("size",n.layer.hyperCubeLayout))&&(c.rows.size={label:i.encodeForHTML(f),num:y,value:n.formatValue("size",y)})}s[l]?(c.rows.color.value&&"-"!==c.rows.color.value&&(s[l].rows.color=c.rows.color),c.rows.size.value&&"-"!==c.rows.size.value&&(s[l].rows.size=c.rows.size),c.rows.size.value===c.rows.color.value&&c.rows.size.label===c.rows.size.label&&delete s[l].rows.size):(c.rows.size.value===c.rows.color.value&&c.rows.size.label===c.rows.size.label&&delete c.rows.size,s[l]=c)});var l=[],c=0;for(var u in s){var h=[];for(var d in s[u].rows)s[u].rows[d].label&&h.push(s[u].rows[d]);l.push(s[u]),l[c].rows=h,c++}return l},t.prototype.formatValue=function(e,t){try{if(!isNaN(t))return this.layer.expressionFormatters[e].format(Number(t));if("NaN"===t)return"-"}catch(e){}return String(t)},t.prototype.show=function(e){var t=e.target;t?this.belongsToMyDataset(t)&&this.layer.layout.showPopUp&&this.openTooltip(e):this.closeTooltip()},t.prototype.hover=function(e){this.tooltipService.openedByClick||this.show(e)},t.prototype.updatePosition=function(){if(this.coordinate&&this.position){var e=this.mapChart.map.geoToDisplay(this.coordinate),t=e[0],n=e[1];if(t<0||t>this.mapChart.mapDiv.width()||n<0||n>this.mapChart.mapDiv.height())this.closeTooltip();else{var i=this.position,r=i[0],o=i[1];this.tooltipService.move(t-r,n-o),this.position=[t,n]}}},t.prototype._connecting=function(){var e=this;this._addListener("click",this.show),this._addListener("move",this.hover),this._addListener("draw",this.updatePosition),this._addListener("out",function(t){var n=t.nativeEvent;if(n){var i=n.relatedTarget;if(i instanceof HTMLElement){var r=$(i);if(r.add().hasClass("qv-tooltip")||r.parents().hasClass("qv-tooltip"))return}}e.closeTooltip()}),this._addListener("basemapchanged",this.closeTooltip)},t.prototype._disconnecting=function(){this.closeTooltip()},t.MAX_FEATURES=4,t.MULTI_CENTER_TOLERANCE_PX=5,t.COLOR_MODES=[o.MEASURE,o.DIMENSION,o.QUALITATIVE,o.EXPRESSION],t}(n)}),define("extensions.qliktech/mapchart/SymbolGenerator",["require","exports"],function(e,t){"use strict";return function(){function e(e,t,n,i,r,o,s,a){this.min=e,this.max=t,this.n=n,this.minSymbol=i,this.maxSymbol=r,this.outline=o,this.shape=s,this.rotation=a,this.symbols={}}return e.prototype.key=function(e,t){var n=this.calculateSymbolSize(e),i=n.relSize+t;return this.symbols[i]||(this.symbols[i]=this.makeSymbol(n.size,t)),i},e.prototype.makeSymbol=function(t,n){if(isNaN(t))return idevio.map.IconFactory.cross?idevio.map.IconFactory.cross({radius:4,color:n,outline:this.outline,thickness:2}):idevio.map.IconFactory.circle({radius:NaN});var i=e.POLYGONS[this.shape]||e.POLYGONS.points;return idevio.map.IconFactory.polygon({sides:i.sides,color:n,radius:t,rotation:i.rotation+this.rotation*(Math.PI/180),outline:this.outline})},e.prototype.calculateSymbolSize=function(e){if(isNaN(e))return{relSize:NaN,size:NaN};var t=Math.max(this.min,Math.min(this.max,e)),n=this.max-this.min,i=0===n?this.n/2:this.n*(t-this.min)/n,r=Math.round(i/this.n*(this.maxSymbol-this.minSymbol)+this.minSymbol);return{relSize:Math.floor(i),size:r}},e.prototype.getSymbols=function(){return this.symbols},e.POLYGONS={hexagons:{sides:6,rotation:Math.PI/180*-60},pentagons:{sides:5,rotation:Math.PI/180*-90},squares:{sides:4,rotation:Math.PI/180*-45},triangles:{sides:3,rotation:Math.PI/180*-90},points:{sides:31,rotation:0},symbols:{sides:0,rotation:0}},e}()});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions.qliktech/mapchart/PointLayer",["require","exports","./DataLayer","./legends/Legend","./ToolTipTool","./SymbolGenerator","objects.utils/chart-style-utils","core.utils/feature-flags","./MapStandardErrors","./DataUtils","./GeoUtils"],function(e,t,n,i,r,o,s,a,l,c,u){"use strict";return function(e){function t(t,n,o,s){var a=e.call(this,t,n,o,s)||this;return a.layerName="geo.PointLayer",a.name=o,a.legend=new i(a.layerName,a,{showSizeLegend:!0}),a.layer=new idevio.map.FeatureLayer(a.map.map,{drawOrder:1001,pickable:!0}),a.toolTip=new r(a,t),a.dataset=a.layer.getDataset(),a}return __extends(t,e),t.prototype.doPaint=function(e){this.clearData();var t=c.getMinMax("size",this.hyperCubeLayout),i=!1===this.layout.size.autoRadiusValueRange?[this.layout.size.radiusValueMin,this.layout.size.radiusValueMax]:t||[0,0],r=Math.max(1,Math.min(this.layout.size.radiusMax-this.layout.size.radiusMin,50)),s=new o(i[0],i[1],r,this.layout.size.radiusMin,this.layout.size.radiusMax,this.colorMap.getOutlineColor(),this.layout.size.shape,0),a=Math.round((this.layout.size.radiusMin+this.layout.size.radiusMax)/2),h=[],d="",p=0;for(var f in e){var m=e[f];if(m.qMatrix){var g=c.getElemData(m),v=this.getColorValues(m),y=this.getGeometry(m),b=c.getNumericData("size",m,this.hyperCubeLayout),x=c.getStringOrNumber("label",m,this.hyperCubeLayout),q=y.length;switch("0"===f&&(d=this.makeOrChangeDataset(y,n.DEFAULT_COLUMNS.concat(["key","size","labelOffset"]),this.layout.isLatLong,"Point")),d){case"STRINGCOORDS":for(var C=y,S=0;S<q;S++)if(null!=C[S]){try{var w=g[S].id,_="X"===g[S].state,D=u.parseGeometryString(C[S]),M=v[S],A=this.colorMap.getColor(g[S],M.value,p),E=_?a:b[S]||a,I=x[S],T=s.calculateSymbolSize(E).size+2,L=new idevio.map.PointFeature(this.dataset,{coordinate:D,attributes:n.generateAttributeObject(w,g[S].dimValue,I,{color:A,value:M.value,elemNo:M.elemNo},_,{key:s.key(E,A),labelOffset:T,size:b.length?E:null})});null!=M.elemNo&&this.colorElemNos.add(M.elemNo),this.featureTable[String(w)]=L}catch(e){this.map.addError(l.INVALID_GEOMETRY,this,[C[S]])}p++}else p++;break;case"NAMES":for(var k=this.addLocationSuffix(y,m),S=0;S<q;S++)if(null!=k[S]){try{var w=g[S].id,_="X"===g[S].state,M=v[S],A=this.colorMap.getColor(g[S],M.value,p),E=_?a:b[S]||a,I=x[S],T=s.calculateSymbolSize(E).size+2;h.push(n.generateAttributeArray(k[S],w,g[S].dimValue,I,{color:A,value:M.value,elemNo:M.elemNo},_,[s.key(E,A),b.length?E:null,T]))}catch(e){this.map.addError(l.INVALID_GEOMETRY,this,[k[S]])}p++}else p++;break;case"LATLONGS":for(var O=y,S=0;S<q;S++)if(null!=O[S]){try{var w=g[S].id,_="X"===g[S].state,M=v[S],A=this.colorMap.getColor(g[S],M.value,p),E=_?a:b[S]||a,I=x[S],T=s.calculateSymbolSize(E).size+2,L=new idevio.map.PointFeature(this.dataset,{coordinate:O[S],attributes:n.generateAttributeObject(w,g[S].dimValue,I,{color:A,value:M.value,elemNo:M.elemNo},_,{key:s.key(E,A),labelOffset:T,size:b.length?E:null})});null!=M.elemNo&&this.colorElemNos.add(M.elemNo),this.featureTable[String(w)]=L}catch(e){this.map.addError(l.INVALID_GEOMETRY,this,[String(O[S])])}p++}else p++}}}"NAMES"===d&&this.dataset.addData(h),this.setStyle(s.getSymbols()),n.isLocationDataset(this.dataset)||this.done()},t.prototype.setStyle=function(e){var t={type:"symbol",icons:e,iconKey:"key"},n={type:"text",textAttribute:"label",font:"8px QlikView Sans",placement:"FIXED",anchorX:"MIDDLE",anchorY:"BOTTOM",pointDistanceKey:"labelOffset"},i=this.translateZoomRange(this.layout.label.showInAllLevels,this.layout.label.visibleRange,this.map.map),r=i[0],o=i[1];n.minRes=r,n.maxRes=o;var l="",c="",u="";a.THEMING?(l=s.getStyle("","label.value","color"),c="normal "+s.getFontSize("","label.value","fontSize")+" QlikView Sans"):(l=s.getStyle("mapChart","label.value","color"),c=s.getFontSize("mapChart","label.value","fontSize"),u=s.getStyle("","","fontFamily")),n.color=l,n.font=c+" "+u,this.layout.label.position&&(n.anchorY=this.layout.label.position),this.layer.setStyles([t,n])},t.prototype.doRemove=function(){this.dataset.removeAll(),this.toolTip.disconnect()},t}(n)});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions.qliktech/mapchart/GeodataLayer",["require","exports","./Layer","./legends/Legend"],function(e,t,n,i){"use strict";return function(e){function t(t,n,r,o,s){var a=e.call(this,t,n,r,o)||this;return a.index=s,a.name=r,a.legend=new i("geo.GeodataLayer",a,{title:function(){return a.layout.title}}),a.createLayer(),a.listenerId=a.map.map.addListener("basemapchanged",function(){a.createLayer()}),a}return __extends(t,e),t.prototype.createLayer=function(){this.layer&&this.layer.remove(),this.currentUrl=this.layout.tms.url;var e=(this.layout.tms&&this.layout.tms.url||"").trim();this.layer=new idevio.map.TiledImageLayer(this.map.map,{drawOrder:100-this.index,visible:this.isVisible()&&e.length>0,dataset:{url:e,crossOrigin:null,noTileImage:t.EMPTY_IMAGE,failedTileImage:t.FAILED_IMAGE}}),this.dataset=this.layer.getDataset()},t.prototype.doPaint=function(e){this.layout.tms.url!==this.currentUrl&&this.createLayer(),this.layer.setVisible(this.isVisible()&&(this.currentUrl||"").length>0),this.layout.tms.attribution!==this.currentAttribution&&(this.currentAttribution=this.layout.tms.attribution,this.map.setAttribution(this.id,(this.layout.tms&&this.layout.tms.attribution||"").trim())),this.done()},t.prototype.doRemove=function(){this.layer.remove();try{this.map.map.removeListener(this.listenerId)}catch(e){}},t.FAILED_IMAGE=function(){var e=new Image;return e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEAAgMAAAAhHED1AAAACVBMVEUAAAD/AAD/AADZP3bhAAAAA            3RSTlMAgLrqQQYHAAAAa0lEQVR42u3cMREAIAADsS44YMEVCw7wrwERnbjLC4iDNnXjVO2sDriZqZoAAAAAAAAAAAAAAAAAAAAAAAAAAAA            AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8DbTT/f48oO0BDHZ7DTLJsl8AAAAASUVORK5CYII=",e}(),t.EMPTY_IMAGE=function(){var e=new Image;return e.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",e}(),t}(n)});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions.qliktech/mapchart/AreaLayer",["require","exports","./DataLayer","./legends/Legend","./ToolTipTool","./MapStandardErrors","objects.utils/chart-style-utils","core.utils/feature-flags","./GeoUtils","./DataUtils"],function(e,t,n,i,r,o,s,a,l,c){"use strict";return function(e){function t(t,n,o,s){var a=e.call(this,t,n,o,s)||this;return a.layerName="geo.AreaLayer",a.name=o,a.legend=new i(a.layerName,a),a.layer=new idevio.map.FeatureLayer(a.map.map,{drawOrder:1e3,pickable:!0}),a.toolTip=new r(a,t),a.dataset=a.layer.getDataset(),a}return __extends(t,e),t.prototype.doPaint=function(e){this.clearData();var t={},i=[],r="",s=0;for(var a in e){var u=e[a];if(u.qMatrix){var h=c.getElemData(u),d=this.getGeometry(u),p=this.getColorValues(u),f=c.getStringOrNumber("label",u,this.hyperCubeLayout);switch("0"===a&&(r=this.makeOrChangeDataset(d,n.DEFAULT_COLUMNS,!1,"Area")),r){case"STRINGCOORDS":for(var m=d,g=0;g<m.length;g++)if(null!=m[g]){try{var v=l.parseGeometryString(m[g]),y=h[g].id,b=f[g],x=p[g],q=this.colorMap.getColor(h[g],x.value,s);t[String(y)]=q;var C=new idevio.map.PolygonFeature(this.dataset,{coordinates:v,attributes:n.generateAttributeObject(y,h[g].dimValue,b,{color:q,value:x.value,elemNo:x.elemNo},"X"===h[g].state)});null!=x.elemNo&&this.colorElemNos.add(x.elemNo),this.featureTable[String(y)]=C}catch(e){this.map.addError(o.INVALID_GEOMETRY,this,[m[g]])}s++}else s++;break;case"NAMES":for(var S=this.addLocationSuffix(d,u),g=0;g<d.length;g++)if(null!=S[g]){try{var y=h[g].id,w=S[g]||"",b=f[g],x=p[g],q=this.colorMap.getColor(h[g],x.value,s);t[String(y)]=q,i.push(n.generateAttributeArray(w,y,h[g].dimValue,b,{color:q,value:x.value,elemNo:x.elemNo},"X"===h[g].state))}catch(e){this.map.addError(o.INVALID_GEOMETRY,this,[S[g]])}s++}else s++}}}"NAMES"===r&&this.dataset.setData(i),this.setStyle(t,this.colorMap.getOutlineColor()),n.isLocationDataset(this.dataset)&&0!==e.length||this.done()},t.prototype.setStyle=function(e,t){var n={type:"polygon",color:"purple",colorKey:"id",colors:e,outline:t},i={type:"text",textAttribute:"label",font:"8px QlikView Sans",placement:"FIXED",anchorX:"MIDDLE",anchorY:"BOTTOM"},r=this.translateZoomRange(this.layout.label.showInAllLevels,this.layout.label.visibleRange,this.map.map),o=r[0],l=r[1];i.minRes=o,i.maxRes=l;var c="",u="",h="";a.THEMING?(c=s.getStyle("","label.value","color"),u="normal "+s.getFontSize("","label.value","fontSize")+" QlikView Sans"):(c=s.getStyle("mapChart","label.value","color"),u=s.getFontSize("mapChart","label.value","fontSize"),h=s.getStyle("","","fontFamily")),i.color=c,i.font=u+" "+h,this.layer.setStyles([n,i])},t.prototype.doRemove=function(){this.dataset.removeAll(),this.toolTip.disconnect()},t}(n)}),define("extensions.qliktech/mapchart/ZoomPanTool",["require","exports","objects.utils/interaction-states","objects.views/charts/components/zoom-pan-navigation/zoom-pan-navigation"],function(e,t,n){"use strict";return function(){function e(){}return e.init=function(t,n,i){if(t){var r=i.map;e.updateToolStatus(t,n,!0,i.extensionObject.options,!i.layout.navigation),t.$on("navigationPressed",function(e,t){e.preventDefault();var n=Math.min(r.getDiv().offsetWidth,r.getDiv().offsetHeight)/6;switch(t){case"navRight":r.pan(n,0);break;case"navLeft":r.pan(-1*n,0);break;case"navUp":r.pan(0,n);break;case"navDown":r.pan(0,-1*n);break;case"zoomIn":r.zoomInOneLevel();break;case"zoomOut":r.zoomOutOneLevel();break;case"resetZoom":i.viewBounds(),i.layout.mapSettings.initialView&&!i.layout.autoZoomOnSelection?r.viewGeoBounds(i.layout.mapSettings.initialView.bounds):i.viewBounds();var o=r.addListener("idle",function(e){r.removeListener(o),i.mapHomeBounds=r.getGeoBounds()})}})}},e.updateToolStatus=function(e,t,i,r,o){if(e){var s=!1===r.navigation;e.navigationHomeOnly=o,e.navigationDefaultPosition=i,e.navigationDisabled=!t||s||r.interactionState!==n.ANALYSIS,e.navigationVisible=t&&!s,setTimeout(function(){e.$apply()})}},e}()}),define("extensions.qliktech/mapchart/ErrorHandler",["require","exports","./MapStandardErrors","translator","autogenerated/qix/engine-enums","objects.error-handling/error-translation","objects/adapters/calc-cond-adapter"],function(e,t,n,i,r,o,s){"use strict";return function(){function e(e){var t=this;this.mapChart=e,this.errorDiv=$(".map-error-div",e.parentDiv).attr("id","mapErrordiv-"+e.id),this.contentDiv=$(".map-error-content-div",this.errorDiv),this.iconDiv=$(".map-error-icon-div",this.errorDiv),this.errorDiv.click(function(){t.contentDiv.slideToggle("fast")}),this.errorQueue=[]}return e.prototype.setMapReady=function(e){this.ready=e,e&&this.errorQueue.length>0&&this.showErrors()},e.prototype.onStateChange=function(){this.mapChart.extensionObject.inEditState()?this.showErrors():this.errorDiv.hide()},e.prototype.handleError=function(e){e.errorLabel===n.UNSUCCESFULL_LOOKUP?this.handleUnsuccessFullLookups(e):this.pushOnErrorQueue(e),this.ready&&this.isInEditMode()&&this.showErrors()},e.prototype.pushOnErrorQueue=function(e){for(var t=0,n=this.errorQueue;t<n.length;t++){var i=n[t];if(i.errorLabel===e.errorLabel&&i.layer===e.layer)return!i.parameters||!e.parameters||(i.parameters=i.parameters.concat(e.parameters),!0)}return this.errorQueue.push(e),!0},e.prototype.handleUnsuccessFullLookups=function(e){var t=[],i=[];if(e.parameters)for(var r=0,o=e.parameters;r<o.length;r++){var s=o[r];s.indexOf("Unresolved:")>-1?t.push(s.slice(12)):s.indexOf("Ambiguous:")>-1?i.push(s.slice(11)):s.length>0&&t.push(s)}if(t.length>0){var a={errorLabel:n.UNSUCCESFULL_LOOKUP,layer:e.layer,parameters:t};this.pushOnErrorQueue(a)}if(i.length>0){var l={errorLabel:n.AMBIGUOUS_LOOKUP,layer:e.layer,parameters:i};this.pushOnErrorQueue(l)}},e.prototype.isInEditMode=function(){return!!this.mapChart.extensionObject&&this.mapChart.extensionObject.inEditState()},e.prototype.showErrors=function(){this.contentDiv.empty(),this.contentDiv.append("<p>&nbsp;</p>");for(var e=0,t=!1,n=0,r=this.errorQueue;n<r.length;n++){var o=r[n],s=this.getErrorLevel(o),a="";if(o.parameters){var l=o.parameters.join(", ");l.length>200&&(l=l.substring(0,200)+"..."),l="<span class='map-error-parameters'>"+l+"</span>",a=i.get(o.errorLabel,l)}else a=i.get(o.errorLabel);e=s>e?s:e,this.getLayerDiv(o.layer).append("<p>"+a+"</p>"),t=!0}1===e?(this.iconDiv.removeClass("map-error-error"),this.iconDiv.addClass("map-error-warning")):2===e&&(this.iconDiv.removeClass("map-error-warning"),this.iconDiv.addClass("map-error-error")),!this.errorDiv.is(":visible")&&t?this.errorDiv.show():t||this.errorDiv.hide()},e.prototype.getErrorLevel=function(e){switch(e.errorLabel){case n.UNSUCCESFULL_LOOKUP:case n.LIMITED_DATA:return 0;case n.INVALID_GEOMETRY:return 1;case n.FAILED_LOOKUP:return 2}return 0},e.prototype.getLayerDiv=function(e){var t=this.contentDiv.find("#error-layer-"+e.id);if(t.length>0)return t;var n=i.get(e.layerName),r="<div id='error-layer-"+e.id+"' >";return e.layout&&e.layout.qHyperCube&&e.layout.qHyperCube.qDimensionInfo&&(r=r+"<span class='map-error-layer-name'>"+e.layout.qHyperCube.qDimensionInfo[0].qFallbackTitle+"</span>"),r=r+" - "+n+"</div>",$(r).appendTo(this.contentDiv)},e.prototype.clearErrors=function(){this.errorDiv.hide(),this.contentDiv.empty(),this.errorQueue=[]},e.prototype.clearqError=function(e){e.legend.setError()},e.prototype.handleqError=function(e,t){var n=this.getCustomErrorMessage(t.layout.qHyperCube)||o.getHyperCubeError(e);e===r.NxLocalizedErrorCode.LOCERR_CALC_EVAL_CONDITION_FAILED?t.legend.setError("soft-error",n):t.legend.setError("hard-error",n,i.get("Object.Error"))},e.prototype.getCustomErrorMessage=function(e){return e.qError.qErrorCode===r.NxLocalizedErrorCode.LOCERR_CALC_EVAL_CONDITION_FAILED?s.getLayoutMsg(e):""},e.createErrorEvent=function(e,t,n){return{errorLabel:e,layer:t,parameters:n}},e.mapScriptFailed=function(e){console.error(e.message)},e}()}),define("extensions.qliktech/mapchart/BaseMap",["require","exports","translator"],function(e,t,n){"use strict";return function(){function e(){}return e.getAvailableLanguages=function(t){var n=[];if(n.push({value:"auto",label:e.translate("auto","maplang")}),!t)return n;for(var i=t.getLayerCount(),r=0;r<i;r++){var o=t.getLayer(r);if(o.isBaseLayer){var s=o.getName();if(s.length>3&&"Eng"===s.substring(s.length-3)){n.push({value:"english",label:e.translate("english","maplang")}),n.push({value:"local",label:e.translate("local","maplang")});break}}}return n},e.getDefaultAvailableLanguages=function(){var t=[];return t.push({value:"auto",label:e.translate("auto","maplang")}),t.push({value:"english",label:e.translate("english","maplang")}),t.push({value:"local",label:e.translate("local","maplang")}),t},e.setLanguage=function(e,t){for(var n=t.getLayerCount(),i=0;i<n;i++){var r=t.getLayer(i);if(r.isBaseLayer){var o=r.getName();if(o.length>3&&"Eng"===o.substring(o.length-3)){var s=t.getLayer(o.substring(0,o.length-3));if(!s)continue;"english"===e||"auto"===e&&"PointsEng"!==o?(r.setVisible(!0),s.setVisible(!1)):(r.setVisible(!1),s.setVisible(!0))}}}},e.translate=function(e,t){var i="geo.properties."+t+"."+e,r=n.get(i);return r===i?e:r},e.getBaseMapOrEmpty=function(e){return idevio.map.WebMap.getLoadedBaseMaps().reduce(function(t,n){return t||-1!==n.indexOf(e)},!1)?e:"empty"},e.getAvailableBaseMapAndProjections=function(t){t=e.getBaseMapOrEmpty(t);var n=[];return e.getBasemaps().get(t).projections.forEach(function(t,i){n.push({value:t,label:e.translate(i,"projection")})}),n},e.getBasemapOptions=function(){var t=[],n=null;return e.getBasemaps().forEach(function(i){var r=e.BASE_MAP_IMAGES[i.name];r||(r=e.UNKNOWN_MAP_IMAGE);var o={value:i.name,label:e.translate(i.name,"basemap"),src:r};"empty"===i.name?n=o:t.push(o)}),n&&t.push(n),t},e.getBasemaps=function(){var e=["default","pale","pale_adaptive","default_adaptive","empty","emptymeters","emptydegreemercator"];try{e=idevio.map.WebMap.getLoadedBaseMaps()}catch(e){}return this.parseMaps(e)},e.parseMaps=function(e){var t=new Map;return e.sort(),e.forEach(function(e){var n,i="mercator",r=e.split("_");if(2===r.length?(n=r[0],i=r[1]):0===r[0].indexOf("empty")?(n="empty","empty"===r[0]?i="WGS-84":r[0].indexOf("meters")>r[0].indexOf("empty")?i="undefined meters":r[0].indexOf("degreemercator")>r[0].indexOf("empty")&&(i="mercator")):n=r[0].indexOf("mercator")>-1?r[0].slice(0,r[0].indexOf("mercator")):r[0].indexOf("meters")>-1?r[0].slice(0,r[0].indexOf("meters")):r[0],t.has(n))t.get(n).projections.set(i,e);else{var o=new Map;o.set(i,e),t.set(n,{name:n,projections:o})}}),t},e.BASE_MAP_IMAGES={default:"../resources/extensions/qliktech/mapchart/img/bg_default.png",tiledraster:"../resources/extensions/qliktech/mapchart/img/bg_default.png",satellite:"../resources/extensions/qliktech/mapchart/img/bg_satellite.png",empty:"../resources/extensions/qliktech/mapchart/img/bg_none.png",plain:"../resources/extensions/qliktech/mapchart/img/bg_plain.png",pale:"../resources/extensions/qliktech/mapchart/img/bg_pale.png"},e.UNKNOWN_MAP_IMAGE="../resources/extensions/qliktech/mapchart/img/bg_none.png",e}()}),define("extensions.qliktech/mapchart/selections/SelectionTool",["require","exports"],function(e,t){"use strict";return function(){function e(e){this.mapChart=e,this.div=e.mapDiv[0],this.isActive=!1}return e.prototype.activate=function(){this.canvas=this.createCanvas(),this.rectangle={min:[0,0],max:[this.div.clientWidth,this.div.clientHeight]},this.isActive=!0,this.start()},e.prototype.deactivate=function(){this.isActive=!1,$("#"+e.CANVAS_ID).remove(),delete this.startX,delete this.startY,this.stop()},e.prototype.release=function(){this.doneDrawing(),this.deactivate()},e.prototype.move=function(e,t){void 0===this.startX&&(this.startX=e),void 0===this.startY&&(this.startY=t),this.draw(e,t)},e.prototype.createCanvas=function(){$("#"+e.CANVAS_ID).remove();var t=document.createElement("canvas"),n=this.div;return t.id=e.CANVAS_ID,t.width=n.clientWidth,t.height=n.clientHeight,t.style.zIndex="10000",t.style.position="absolute",t.style.border="0px",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",$(n).append(t),t},e.CANVAS_ID="CANVAS_ID",e}()});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions.qliktech/mapchart/selections/Lasso",["require","exports","./SelectionTool"],function(e,t,n){"use strict";return function(e){function t(t,n){var i=e.call(this,t)||this;return i.selectionCallback=n,i}return __extends(t,e),t.prototype.start=function(){this.pointsDrawn=[]},t.prototype.stop=function(){this.pointsDrawn=[]},t.prototype.doneDrawing=function(){this.isPolygonClosed&&this.pointsDrawn.push(this.pointsDrawn[0]),this.selectionCallback(this.pointsDrawn,this.rectangle)},t.prototype.draw=function(e,t){var n=$(this.canvas).offset().left,i=$(this.canvas).offset().top,r=this.canvas.getContext("2d"),o=this.startX-n,s=this.startY-i,a=e-n,l=t-i;this.pointsDrawn.push([a,l]),this.rectangle.max[0]=e<this.rectangle.max[0]?this.rectangle.max[0]:e,this.rectangle.max[1]=t<this.rectangle.max[1]?this.rectangle.max[1]:t,this.rectangle.min[0]=e>this.rectangle.min[0]?this.rectangle.min[0]:e,this.rectangle.min[1]=t>this.rectangle.min[1]?this.rectangle.min[1]:t,r.clearRect(0,0,$(this.canvas).width(),$(this.canvas).height()),r.beginPath(),r.strokeStyle="black",r.arc(o,s,8,0,2*Math.PI,!1),r.fillStyle="#00bb00",r.fill(),r.strokeStyle="#00bb00",r.stroke(),r.beginPath(),r.moveTo(o,s);for(var c=0;c<this.pointsDrawn.length;c++)r.lineTo(this.pointsDrawn[c][0],this.pointsDrawn[c][1]);this.pointsDrawn[0]&&(Math.sqrt(Math.pow(this.pointsDrawn[0][0]-a,2)+Math.pow(this.pointsDrawn[0][1]-l,2))<100?(this.dashedLine(r,a,l,o,s,3),this.isPolygonClosed=!0):this.isPolygonClosed=!1),r.strokeStyle="dimgray",r.lineWidth=2,r.stroke()},t.prototype.dashedLine=function(e,t,n,i,r,o){void 0===o&&(o=2),e.moveTo(t,n);for(var s=i-t,a=r-n,l=Math.floor(Math.sqrt(s*s+a*a)/o),c=s/l,u=a/l,h=0;h++<l;)t+=c,n+=u,e[h%2==0?"moveTo":"lineTo"](t,n);e[h%2==0?"moveTo":"lineTo"](i,r)},t}(n)}),define("extensions.qliktech/mapchart/selections/SelectUtils",["require","exports"],function(e,t){"use strict";return function(){function e(){}return e.isPolygon=function(e){return e instanceof idevio.map.PolygonFeature&&!(e instanceof idevio.map.LineStringFeature)},e.isLine=function(e){return e instanceof idevio.map.LineStringFeature&&!(e instanceof idevio.map.PolygonFeature)},e.isPoint=function(e){return e instanceof idevio.map.PointFeature},e.pointInPolygon=function(e,t,n){for(var i=!1,r=0,o=n.length-1;r<n.length;o=r++)n[r][1]>t!=n[o][1]>t&&e<(n[o][0]-n[r][0])*(t-n[r][1])/(n[o][1]-n[r][1])+n[r][0]&&(i=!i);return i},e.isLassoClosed=function(e){var t=e[0][0]===e[e.length-1][0],n=e[0][1]===e[e.length-1][1];return t&&n},e.linesIntersect=function(e,t,n,i){var r=[n[0]-e[0],n[1]-e[1]],o=[t[0]-e[0],t[1]-e[1]],s=[i[0]-n[0],i[1]-n[1]],a=r[0]*o[1]-r[1]*o[0],l=r[0]*s[1]-r[1]*s[0],c=o[0]*s[1]-o[1]*s[0];if(0===a)return n[0]-e[0]<0!=n[0]-t[0]<0||n[1]-e[1]<0!=n[1]-t[1]<0;if(0===c)return!1;var u=1/c,h=l*u,d=a*u;return h>=0&&h<=1&&d>=0&&d<=1},e.distanceBetweenPoints=function(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))},e.lineCircleIntersect=function(e,t,n,i,r,o,s){return this.pointToLineDistance(e,t,n,i,r,o)<s},e.pointToLineDistance=function(e,t,n,i,r,o){var s=n-e,a=i-t,l=(r-e)*s+(o-t)*a,c=s*s+a*a,u=-1;0!==c&&(u=l/c);var h,d;u<0?(h=e,d=t):u>1?(h=n,d=i):(h=e+u*s,d=t+u*a);var p=r-h,f=o-d;return Math.sqrt(p*p+f*f)},e.getLayerFromFeature=function(e,t){for(var n=0;n<t.length;n++)if(t[n].dataset===e.getDataset())return t[n];return null},e}()});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions.qliktech/mapchart/selections/Circle",["require","exports","./SelectionTool","./SelectUtils"],function(e,t,n,i){"use strict";return function(e){function t(t,n){var i=e.call(this,t)||this;return i.radius=0,i.selectionCallback=n,i}return __extends(t,e),t.prototype.start=function(){},t.prototype.stop=function(){},t.prototype.doneDrawing=function(){var e=$(this.canvas).offset().left,t=$(this.canvas).offset().top,n=this.startX-e,i=this.startY-t;this.rectangle.max[0]=n+this.radius,this.rectangle.max[1]=i+this.radius,this.rectangle.min[0]=n-this.radius,this.rectangle.min[1]=i-this.radius,this.selectionCallback([n,i],this.radius,this.rectangle)},t.prototype.draw=function(e,n){var r=$(this.canvas).offset().left,o=$(this.canvas).offset().top,s=this.canvas.getContext("2d"),a=this.startX-r,l=this.startY-o,c=e-r,u=n-o,h=Math.sqrt(Math.pow(a-c,2)+Math.pow(l-u,2));s.clearRect(0,0,$(this.canvas).width(),$(this.canvas).height()),s.beginPath(),s.strokeStyle="black",s.arc(a,l,h,0,2*Math.PI,!1),s.stroke();var d=Math.round(this.mapChart.map.getDistanceInMeters([a,l],[c,u])),p=d.toFixed(0),f="m";this.mapChart.layout.mapSettings.useImperialUnits?(f="ft",(d*=t.FEET_IN_METER)>t.FEET_IN_MILE&&(d/=t.FEET_IN_MILE,f="mi"),p=d.toFixed(d<10?1:0)):d>1e3&&(f="km",p=(d/=1e3).toFixed(d<10?1:0)),this.radius=i.distanceBetweenPoints([this.startX,this.startY],[e,n]);var m=p+f;s.fillStyle="black",s.font="bold 11pt sans-serif",s.textAlign="center",s.textBaseline="middle",s.strokeStyle="white",s.lineWidth=1.5,s.strokeText(m,a,l),s.fillText(m,a,l)},t.FEET_IN_METER=3.28084,t.FEET_IN_MILE=5280,t}(n)});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions.qliktech/mapchart/selections/SelectionHandler",["require","exports","../DataLayer","./Lasso","../Utils","./Circle","../SenseTool","./SelectUtils","objects.extension/default-selection-toolbar","objects.views/selections/interaction-handler","touche","core.utils/notification","assets/external/picasso-plugin-q/picasso-q","../WebMap5"],function(e,t,n,i,r,o,s,a,l,c,u,h,d){"use strict";return function(e){function t(t){var n=e.call(this,t,{viewOption:"selections"})||this;return n.startPressEvent=null,n.backendApi=n.mapChart.extensionObject.backendApi,n.selectionsApi=n.mapChart.extensionObject.selectionsApi,n.selectionsApi.watchDeactivated(n.deactivatedCallback.bind(n)),n.selectionsApi.watchActivated(n.activatedCallback.bind(n)),n.selectionsApi.clear=function(){n.clearSelections()},n.lassoToggled=!1,n.circleToggled=!1,n.selected=[],n.selectedLayer=null,n.shiftButtonPressed=!1,n.clickSelected=!1,n.lasso=new i(n.mapChart,n.lassoSelectCallback.bind(n)),n.circle=new o(n.mapChart,n.circleSelectCallback.bind(n)),c.ShiftToggle.bind(n.shiftToggle.bind(n)),h.create(n,"Activated"),h.create(n,"Cleared"),n}return __extends(t,e),t.prototype.press=function(e){(this.lassoIsActive()||this.circleIsActive())&&this.mapChart.extensionObject.inAnalysisState()&&this.mapChart.hasFeatures()&&0===e.button&&(this.startPressEvent||(this.startPressEvent=e))},t.prototype.move=function(e){if((this.lassoIsActive()||this.circleIsActive())&&this.mapChart.extensionObject.inAnalysisState()&&this.mapChart.hasFeatures()&&0===e.button&&(e.stop(),this.startPressEvent)){var t=[this.startPressEvent.clientX,this.startPressEvent.clientY],n=[e.clientX,e.clientY];if(a.distanceBetweenPoints(t,n)>8){u.preventGestures(),this.activate();var i=this.getActiveSelectionTool();if(i){i.isActive||i.activate();var r=e.clientX+this.mapChart.mapDiv.offset().left,o=e.clientY+this.mapChart.mapDiv.offset().top;i.move(r,o)}}}},t.prototype.setSelectOptionsValue=function(e){this.selectionMenuConfig.value=e},t.prototype.click=function(e){0===e.button&&(this.activate(),e.target&&this.clickSelect(e.target))},t.prototype.release=function(){this.startPressEvent=null,this.lasso.isActive&&this.lasso.release(),this.circle.isActive&&this.circle.release()},t.prototype.shiftToggle=function(e){this.shiftButtonPressed=e,this.selectionsApi.refreshToolbar()},t.prototype.activate=function(){var e=this;this.mapChart.extensionObject.inAnalysisState()&&this.mapChart.hasFeatures()&&(this.Activated.emit(),this.selectionsApi.activate(),this.selectionCache=new Map,this.mapChart.layers.forEach(function(t){if(t instanceof n){var i=t.dataset.getAll();i&&(i=i.filter(function(e){return!r.isExcluded(e)})),e.selectionCache.set(t,i)}}))},t.prototype.legendSelect=function(e,t){var n=this,i=d.qBrushHelper(t),r=e.map.extensionObject.backendApi.model;if(i.length){if("resetMadeSelections"===i[0].method)return r.resetMadeSelections(),void this.clearSelections();e!==this.selectedLayer&&this.setSelectedLayer(e),i.forEach(function(i){if("selectHyperCubeValues"===i.method)n.itemSelection(i,e,r);else if("selectHyperCubeContinuousRange"===i.method){var o=t.brushes();if(!o.length)return;var s=o[0].brush.ranges()[0];s&&n.rangeHighlight(s,e)}})}},t.prototype.itemSelection=function(e,t,n){var i=this,r=e.params[0];e.params[0]="/qUndoExclude/gaLayers/"+t.index+r;var o=e.params[2];n[e.method].apply(n,e.params).then(function(e){e?(i.selectionsApi.selectionsMade=!0,i.legendHighlight(o,t,r)):(n.resetMadeSelections(),i.clearSelections())}).catch(function(e){return console.error(e)})},t.prototype.rangeHighlight=function(e,t){this.selected=t.dataset.getAll().filter(function(t){var n=t.getAttribute("color");return n&&Number(n.value)>=e.min&&Number(n.value)<=e.max}),this.updateHighlighting()},t.prototype.commit=function(e){var t=this;this.selected.length&&this.selectedLayer===e&&this.selectFeatures(this.selected,e.getPath()).then(function(e){t.selectionsApi.selectionsMade=e})},t.prototype.legendHighlight=function(e,t,n){var i=t.hyperCubeLayout.qDataPages,r=Number(n.replace(/^.*\//,"")),o=n.indexOf("qAttributeDimensions")?"qAttrDims":"qAttrExps",s=Number((/qDimensions\/(\d)\//.exec(n)||[])[1])||0;i.length&&e.length&&!isNaN(r)&&(this.selected=i[0].qMatrix.reduce(function(n,i){var a=i[s];if(!a)return n;var l=a[o];if(l&&-1!==e.indexOf(l.qValues[r].qElemNo)){var c=i[0].qElemNumber;n.push(t.featureTable[c])}return n},[]).filter(Boolean),this.updateHighlighting())},t.prototype.clickSelect=function(e){if(e){var t=a.getLayerFromFeature(e,this.mapChart.layers);if(null==this.selectedLayer&&null!=t&&this.setSelectedLayer(t),t!==this.selectedLayer)return;if(a.isPoint(e)){var n=this._map.geoToDisplay(e.getCenter()),i=n[0],r=n[1];this._map.getFeaturesAt(i,r)}var o=this.selected.indexOf(e);-1===o?this.selected.push(e):this.selected.splice(o,1),this.selected.length>0?(this.clickSelected=!0,this.selectFilteredFeatures(this.selected)):(this.clickSelected=!1,this.selectCache())}0===this.selected.length&&this.setSelectedLayer(null),this.selectionsApi.selectionsMade=this.selected.length>0,this.updateHighlighting()},t.prototype.setSelectedLayer=function(e){this.selectedLayer=e,this.setSelectOptionsValue(e&&e.id||null)},t.prototype.selectFeatures=function(e,t){var n=e.map(function(e){return parseInt(e.getAttribute("id"),10)});return this.backendApi.selectValues(0,n,!1,t)},t.prototype.selectFilteredFeatures=function(e){var t=this,n=e.filter(function(e){return e.getDataset()===t.selectedLayer.dataset}),i=this.selectedLayer.getPath()||this.backendApi.path;this.selectFeatures(n,i)},t.prototype.processSelection=function(e){var t=this;e.length>0&&(this.selectedLayer||this.setSelectedLayer(a.getLayerFromFeature(e[0],this.mapChart.layers)),this.selected=this.selected.concat(e.filter(function(e){return-1===t.selected.indexOf(e)})),this.selectionsApi.selectionsMade=this.selected.length>0,this.selected.length>0&&this.selectFilteredFeatures(this.selected),this.updateHighlighting())},t.prototype.selectCache=function(){for(var e=this.selectionCache.keys(),t=e.next();!t.done;)if(t.value===this.selectedLayer&&this.selected.length>0||t.value.layout.qHyperCube.qDimensionInfo.length<1)t=e.next();else{var n=t.value,i=this.selectionCache.get(n),r=n.layout.qHyperCube.qDimensionInfo[0].qStateCounts.qSelected;i&&this.selectFeatures(0===r?[]:i,n.getPath()),t=e.next()}},t.prototype.clearSelections=function(){this.setSelectedLayer(null),this.selectCache(),this.selectionsApi.selectionsMade=!1,this.reset()},t.prototype.reset=function(){this.selected=[],this.clickSelected=!1,this.setSelectedLayer(null),this.updateHighlighting(),this.Cleared.emit()},t.prototype.activatedCallback=function(){},t.prototype.deactivatedCallback=function(){this.reset(),this.lassoToggled=!1,this.circleToggled=!1,this.lasso.deactivate(),this.circle.deactivate()},t.prototype.updateHighlighting=function(){var e=this,t=this.selected.filter(function(t){return t.getDataset()===e.selectedLayer.dataset});this.mapChart.map.setHighlighted(t)},t.prototype._connecting=function(){var e=this;this._addListener("click",function(t){e.click(t)}),this._addListener("dblclick",function(e){}),this._addListener("press",function(t){e.press(t)}),this._addListener("move",function(t){e.move(t)}),this._addListener("release",function(t){e.release()})},t.prototype._disconnecting=function(){},t.prototype.circleSelectCallback=function(e,t,n){var i=this.mapChart.map,r=i.getFeaturesWithin(n.min[0],n.min[1],n.max[0],n.max[1]).filter(function(n){if(a.isPolygon(n)){for(var r=n.getCoordinates(),o=[],s=0;s<r.length;s++){o[s]=[];for(var l=0;l<r[s].length;l++){var c=i.geoToDisplay(r[s][l]);if(a.distanceBetweenPoints(e,c)<t)return!0;o[s].push(c)}}for(var u=0;u<o.length;u++)if(a.pointInPolygon(e[0],e[1],o[u]))return!0}else if(a.isLine(n))for(var r=n.getCoordinates(),h=e[0],d=e[1],p=0;p<r.length;p++){var f=i.geoToDisplay(r[p])[0],m=i.geoToDisplay(r[p])[1],g=i.geoToDisplay(r[Math.min(p+1,r.length-1)])[0],v=i.geoToDisplay(r[Math.min(p+1,r.length-1)])[1];if(a.lineCircleIntersect(f,m,g,v,h,d,t))return!0}else if(a.isPoint(n)){var y=i.geoToDisplay(n.getCoordinates());if(a.distanceBetweenPoints(e,y)<t)return!0}return!1});this.processSelection(r)},t.prototype.lassoSelectCallback=function(e,t){if(this.startPressEvent=null,this.mapChart.hasFeatures()){var n=a.isLassoClosed(e),i=this.mapChart.map,r=i.getFeaturesWithin(t.min[0],t.min[1],t.max[0],t.max[1]).filter(function(t){if(a.isPolygon(t)){var r=t.getCoordinates(),o=[];if(n)for(f=0;f<r.length;f++){o[f]=[];for(m=0;m<r[f].length;m++)if(o[f].push(i.geoToDisplay(r[f][m])),a.pointInPolygon(o[f][m][0],o[f][m][1],e))return!0}for(var s=0;s<e.length;s++)for(var l=0;l<r.length;l++)for(var c=i.displayToGeo(e[s]),u=i.displayToGeo(e[Math.min(s+1,e.length-1)]),h=0;h<r[l].length;h++){var d=r[l][h],p=r[l][Math.min(h+1,r[l].length-1)];if(a.linesIntersect(c,u,d,p))return!0}}else if(a.isLine(t))for(var r=t.getCoordinates(),f=1;f<r.length;f++)for(var c=i.geoToDisplay(r[f-1]),u=i.geoToDisplay(r[f]),m=1;m<e.length;m+=1){var d=e[m-1],p=e[m];if(a.linesIntersect(c,u,d,p))return!0}else if(a.isPoint(t)){var g=i.geoToDisplay(t.getCoordinates());if(n&&a.pointInPolygon(g[0],g[1],e))return!0}return!1});this.processSelection(r)}},t.prototype.getActiveSelectionTool=function(){return this.lassoIsActive()?this.lasso:this.circleIsActive()?this.circle:null},t.prototype.getSelectableLayers=function(){return this.mapChart.layers.filter(function(e){return e instanceof n})},t.prototype.selectionsExist=function(){return!!this.mapChart.layout.qSelectionInfo.qMadeSelections},t.prototype.getSelectionMenuConfig=function(){var e=this,t=this.getSelectableLayers(),n=t[0].id,i=function(t){var n=t.value,i=void 0===n?"":n;if(""!==i){var o=i,s=r.getLayerFromId(o,e.mapChart.layers);if(!s)throw new Error("Layer with id: "+o+" does not exist");e.setSelectedLayer(s),e.updateHighlighting(),e.selectCache(),e.selectFilteredFeatures(e.selected)}};return{name:"Tooltip.selectableLayers",tid:"selection-toolbar.selectableLayers",component:"select",value:this.selectedLayer?this.selectedLayer.id:n,options:t.filter(function(e){return e.layout.qHyperCube.qDimensionInfo.length>0}).map(function(e){return{label:e.layout.qHyperCube.qDimensionInfo[0].qFallbackTitle+" - "+e.layout.type,value:e.id}}),items:t.filter(function(e){return e.layout.qHyperCube.qDimensionInfo.length>0}).map(function(e){return{name:e.layout.qHyperCube.qDimensionInfo[0].qFallbackTitle+" - "+e.layout.type,action:i,value:e.id}}),show:function(n){return t.length>1&&e.selectionsExist()&&null!==n},isDisabled:function(){var t=e.mapChart.hasFeatures(),n=[];return e.selected.forEach(function(t){var i=a.getLayerFromFeature(t,e.mapChart.layers);i&&-1===n.indexOf(i)&&n.push(i)}),e.clickSelected||!t||n.length<2},action:i,isIcon:!1}},t.prototype.getSelectionToolbar=function(){var e=[],t=this;return this.selectionMenuConfig=this.getSelectionMenuConfig(),e.push(this.selectionMenuConfig),e.push({name:"Tooltip.ToggleOnLassoSelection",tid:"selection-toolbar.toggleLasso",isIcon:!0,buttonClass:"sel-toolbar-icon-toggle",iconClass:"lui-icon lui-icon--lasso",action:function(){t.toggleLasso()},isActive:function(){return this.name=t.lassoIsActive()?"Tooltip.ToggleOffLassoSelection":"Tooltip.ToggleOnLassoSelection",t.lassoIsActive()},isDisabled:function(){return!(!t.isLassoDisabled||!t.isLassoDisabled())}}),e.push({name:"Tooltip.ToggleOnCircleSelection",tid:"selection-toolbar.toggleCircle",isIcon:!0,buttonClass:"sel-toolbar-icon-toggle",iconClass:"lui-icon lui-icon--radial-select",action:function(){t.toggleCircle()},isActive:function(){return this.name=t.circleIsActive()?"Tooltip.ToggleOffCircleSelection":"Tooltip.ToggleOnCircleSelection",t.circleIsActive()},isDisabled:function(){return!(!t.isCircleDisabled||!t.isCircleDisabled())}}),this.selectionToolbar=new l(this.backendApi,this.selectionsApi,!1,!1,e,[]),this.selectionToolbar},t.prototype.lassoIsActive=function(){var e=this.mapChart.layout.mapSettings.selectionType;return(!this.lassoToggled||!this.shiftButtonPressed)&&(!("lasso"!==e||!this.shiftButtonPressed||this.lassoToggled||this.circleToggled)||this.lassoToggled)},t.prototype.toggleLasso=function(){this.lassoToggled=!this.lassoToggled,this.circleToggled=!1},t.prototype.isLassoDisabled=function(){return!1},t.prototype.circleIsActive=function(){var e=this.mapChart.layout.mapSettings.selectionType;return(!this.circleToggled||!this.shiftButtonPressed)&&(!("circle"!==e||!this.shiftButtonPressed||this.circleToggled||this.lassoToggled)||this.circleToggled)},t.prototype.toggleCircle=function(){this.circleToggled=!this.circleToggled,this.lassoToggled=!1},t.prototype.isCircleDisabled=function(){return!1},t}(s)}),define("extensions.qliktech/mapchart/MapChart",["require","exports","jquery","./Utils","./GeoUtils","./legends/Sidebar","_qlik","./PointLayer","./GeodataLayer","./AreaLayer","./ZoomPanTool","./SenseTool","./ErrorHandler","./BaseMap","core.utils/deferred","./selections/SelectionHandler","objects.utils/interaction-states","./MapStandardErrors","objects.views/charts/components/zoom-pan-navigation/zoom-pan-navigation","./WebMap5"],function(e, t, n, i, r, o, s, a, l, c, u, h, d, p, f, m, g, v){"use strict";return function(){function e(e, t, r){this.attributions={},this.dataChanged=!0,this.limitedData=!1,this.autoZoomOnes=!1,this.setInitialViewOnes=!1,this.parentDiv=e.find(".qv-viz"),this.layout=t,this.id=t.qInfo.qId,this.layers=[],this.extensionObject=r,this.mapDiv=n(".webmap-div",this.parentDiv).attr("id","mapdiv-"+this.id),this.errorHandler=new d(this),this.initialZoomLimit=[0,0],this.selectTool=new m(this),this.addSelectionStateListener(),i.registerMapChart(this),this.init(),this.map.repaint()}return e.prototype.init=function(){this.tools={scaleBar:new idevio.map.ScaleBar,panTool:h.patch(new idevio.map.PanTool({allowShift:!0}),this,{viewOption:"navigation"}),zoomTool:h.patch(new idevio.map.ZoomTool,this,{states:[g.ANALYSIS,g.EDIT],viewOption:"navigation"})};var e={div:this.mapDiv[0],baseMap:p.getBaseMapOrEmpty(this.layout.mapSettings.projection),tools:[this.tools.panTool,this.tools.zoomTool],center:[30,0],zoomLevel:3},t=this.layout.snapshotData,n=t&&t.viewFocus&&t.viewFocus.bounds;this.extensionObject.backendApi.isSnapshot&&n?e.viewBounds=n:this.layout.autoZoomOnSelection||(window.mapChartViewBounds[this.id]?(e.center=window.mapChartViewBounds[this.id].center,e.resolution=window.mapChartViewBounds[this.id].resolution):this.layout.mapSettings.initialView?this.setInitialViewOnes=!0:this.autoZoomOnes=!0),this.map=new idevio.map.WebMap(e),this.sidebar=new o(this.parentDiv,this.mapDiv),this.tools.debugLayer=new idevio.map.WebMapInfoLayer(this.map,{x:40,y:5,color:"red",font:"12px monospace",name:"Debug Info",drawOrder:9999,loading:!1,interacting:!1,ratio:!1,visible:!1}),0===e.baseMap.indexOf("empty")&&this.map.setStyle({background:idevio.map.IconFactory.cross?"transparent":"white"}),this.initialZoomLimit=[this.map.getMinResolution(),this.map.getMaxResolution()],this.selectTool.connectTo(this.map),u.init(this.extensionObject.$scope,!1,this),this.chartScale=1,this.mapHomeBounds=this.map.getGeoBounds(),this.updateChartScale()},e.prototype.addSelectionStateListener=function(){var e=this,t=s.currApp();if(t){t.selectionState().OnData.bind(function(){e.dataChanged=!0})}else this.dataChanged=!0},e.prototype.updateSettings=function(){var t=this.layout.mapSettings.projection;if(this.map.getBaseMap()!==t){var n=this.map.getCenter(),i=this.map.getResolution();this.map.setBaseMap(t),0===t.indexOf("empty")&&this.map.setStyle({background:idevio.map.IconFactory.cross?"transparent":"white"});var r=this.layout.mapSettings.zoomLimitSwitch,o=this.layout.mapSettings.zoomLimit.range,s=o[0],a=o[1];this.initialZoomLimit=[this.map.getZoomLevelResolution(r?a:e.ZOOM_LIMIT_MAX),this.map.getZoomLevelResolution(r?s:e.ZOOM_LIMIT_MIN)],this.map.setCenter(n),this.map.setResolution(i)}if(this.map.setViewBounds&&this.layout.mapSettings.panLimitSwitch){l=null;if(this.layout.mapSettings.panLimits)try{l=JSON.parse(this.layout.mapSettings.panLimits)}catch(e){}this.map.setViewBounds(l)}else{var l=null;this.map.setViewBounds(l)}if(this.map.setMinResolution)if(this.layout.mapSettings.zoomLimitSwitch){var c=this.layout.mapSettings.zoomLimit.range,s=c[0],a=c[1];this.map.setMinResolution(this.map.getZoomLevelResolution(a)),this.map.setMaxResolution(this.map.getZoomLevelResolution(s))}else this.map.setMinResolution(this.initialZoomLimit[0]),this.map.setMaxResolution(this.initialZoomLimit[1]);this.tools.scaleBar._useImperial=this.layout.mapSettings.useImperialUnits,this.layout.mapSettings.showScaleBar?this.tools.scaleBar.connectTo(this.map):this.tools.scaleBar.disconnect(),this.extensionObject.backendApi.isSnapshot&&this.viewBounds(),this.sidebar.setAlignment(this.mapDiv,this.layout.mapSettings.sidebarAlignment,this.layout.mapSettings.showLegend),this.sidebar.update(this),this.tools.debugLayer.setVisible(this.layout.mapSettings.showDebugInfo)},e.prototype.updateData=function(e){var t=this;this.layout=e,this.errorHandler.clearErrors();var n=[];this.limitedData=!1;for(var i=0;i<e.gaLayers.length;i++){var r=e.gaLayers[i],o=e.qUndoExclude.gaLayers[i],s=r.cId||"unknown",u=r.type;n.push(s);var h=this.findLayer(s);if(!h){switch(u){case"AreaLayer":h=new c(this,r,s,o),this.addLayer(h);break;case"PointLayer":h=new a(this,r,s,o),this.addLayer(h);break;case"GeodataLayer":h=new l(this,r,s,o,i),this.addLayer(h)}this.sidebar.update(this)}h&&(h.layout=r,h.excludeLayout=o,h.hyperCubeLayout=o.qHyperCube)}this.layers.forEach(function(e){-1===n.indexOf(e.id)&&t.removeLayer(e)});var d={};return this.layers.forEach(function(e){return d[e.id]=e}),this.layers=this.layout.gaLayers.map(function(e,t){var n=d[e.cId];return n.setIndex(t),n}),this.updateSettings(),this.errorHandler.setMapReady(!0),f.all(this.layers.map(function(e){return e.updateData()}))},e.prototype.paint=function(){return this.registerDeferreds(),this.layers.forEach(function(e){return e.paint()}),this.updateNavigationHome(),this.presentationReady.promise},e.prototype.findLayer=function(e){for(var t=0;t<this.layers.length;t++)if(this.layers[t].id===e)return this.layers[t];return null},e.prototype.registerDeferreds=function(){var e=this;this.presentationReady=new f;var t=this.layers.map(function(e){return e.deferred=new f,e.deferred.promise}),n=this.presentationReady;t.length>0?f.all(t).then(function(){e.finished();var t=e.map,i=t.addListener("idle",function(r){if(t.removeListener(i),e.layout.autoZoomOnSelection)e.mapHomeBounds=e.map.getGeoBounds();else if(!e.layout.autoZoomOnSelection&&!e.layout.mapSettings.initialView){var o=e.getViewBounds();o&&(e.mapHomeBounds=o)}n.resolve()})}):n.resolve()},e.prototype.finished=function(){var e=this;this.updateNavigationHome(),this.dataChanged&&(this.layout.autoZoomOnSelection||this.autoZoomOnes)?(this.autoZoomOnes=!1,this.dataChanged=!1,setTimeout(function(){e.viewBounds()},1)):this.setInitialViewOnes&&(this.map.viewGeoBounds(this.layout.mapSettings.initialView.bounds,!0),this.setInitialViewOnes=!1)},e.prototype.viewBounds=function(){var e=this.getViewBounds();if(e){var t=Boolean(this.extensionObject.backendApi.isSnapshot);this.map.viewGeoBounds(e,t)}},e.prototype.getViewBounds=function(){if(this.extensionObject.backendApi.isSnapshot){var e=this.layout.snapshotData,t=e&&e.viewFocus&&e.viewFocus.bounds;if(t)return t}var n=this.mergeBounds();if(n){var i=this.map.getWrapLongitude();if(1.1*r.getBoundsWidth(n)>=2*i){var o=(n.min[1]+n.max[1])/2;n={min:[.91*n.min[0],.91*(o-i)],max:[.91*n.max[0],.91*(o+i)]}}}return n},e.prototype.viewOrigin=function(){this.map.getGeoBounds()},e.prototype.hasFeatures=function(){for(var e=!1,t=0;t<this.layers.length;t++)if(this.layers[t].hasFeatures()){e=!0;break}return e},e.prototype.setAttribution=function(e,t){this.attributions[e]=t,this.updateAttribution()},e.prototype.updateAttribution=function(){var e=this,t=Object.keys(this.attributions).map(function(t){return e.attributions[t]}).filter(Boolean);this.map.setAttribution(t.length?t.reduce(function(e,t){return e+", "+t}):null)},e.prototype.mergeBounds=function(){return r.mergeBoundsArray(this.layers.map(function(e){return e.getBounds()}),this.map.getWrapLongitude())},e.prototype.updateChartScale=function(){if(this.extensionObject.backendApi.isSnapshot&&!this.extensionObject.options.freeResize){var e=this.layout.snapshotData.object.size.w,t=this.parentDiv[0].clientWidth,n=this.layout.snapshotData.object.size.h,i=this.parentDiv[0].clientHeight;this.chartScale=Math.min(t/e,i/n)}else this.chartScale=1},e.prototype.onResize=function(){this.updateChartScale(),this.map&&(this.extensionObject.backendApi.isSnapshot&&this.viewBounds(),this.map.repaint()),this.sidebar&&this.sidebar.update(this)},e.prototype.onStateChange=function(){this.updateNavigationHome(),this.errorHandler.onStateChange()},e.prototype.addLayer=function(e){-1===this.layers.indexOf(e)&&this.layers.push(e)},e.prototype.removeLayer=function(e){var t=this.layers.indexOf(e);-1!==t&&(this.layers.splice(t,1),e.remove()),delete this.attributions[e.id],this.updateAttribution()},e.prototype.addError=function(e,t,n){this.errorHandler&&this.errorHandler.handleError(d.createErrorEvent(e,t,n)),e===v.LIMITED_DATA&&(this.limitedData=!0,this.limitedLayout=t.layout)},e.prototype.handleqError=function(e,t){this.errorHandler&&this.errorHandler.handleqError(e,t)},e.prototype.updateNavigationHome=function(){var e=this,t=this.map;this.map.removeListener(this.idleListener),this.idleListener=t.addListener("idle",function(t){var n=e.mapHomeBounds,i=e.map.getGeoBounds(),r=e.extensionObject.$scope,o=n.max[0]===i.max[0]&&n.max[1]===i.max[1]&&n.min[0]===i.min[0]&&n.min[1]===i.min[1],s=!!e.layout.navigation||!o,a=e.extensionObject.options,l=!e.layout.navigation;u.updateToolStatus(r,s,o,a,l)})},e.prototype.isLimitedData=function(){return this.limitedData},e.prototype.getLimitedLayout=function(){return this.limitedLayout},e.ZOOM_LIMIT_MAX=20,e.ZOOM_LIMIT_MIN=0,e}()}),define("extensions.qliktech/mapchart/MapProperties",["require","exports","./MapChart","./Utils","./BaseMap","translator"],function(e,t,n,i,r,o){"use strict";var s;return function(e){function t(e){var t=i.getMapChart(e.qInfo.qId);if(null==t)throw new TypeError("Map with id '"+e.qInfo.qId+"' was not found");return t}e.getMapSettings=function(){return{translation:"geo.properties.mapsettings",type:"items",grouped:!0,items:{mapprops:{type:"items",items:{basemap:{ref:"mapSettings.baseMap",type:"string",component:"options-list",translation:"geo.properties.basemap",defaultValue:"default",change:function(e){e.mapSettings.projection=r.getAvailableBaseMapAndProjections(e.mapSettings.baseMap)[0].value,e.mapSettings.mapLanguage="auto"},labelDisclaimer:"",showValue:!0,valueTranslation:"geo.properties.basemap",entryComponentDefinition:{type:"string",component:"image-item",itemBorder:!0,itemInteractive:!0,width:"229px",height:"103px"},title:"geo.properties.basemap",optionsLabel:"geo.properties.basemapOptions",optionsRadius:3,optionsSpacing:12,options:r.getBasemapOptions},projection:{ref:"mapSettings.projection",translation:"geo.properties.projection",type:"string",component:"dropdown",defaultValue:"default",change:function(e){var n=t(e).map;r.setLanguage(e.mapSettings.mapLanguage,n)},options:function(e){var t="empty";return e&&e.mapSettings&&e.mapSettings.baseMap&&(t=e.mapSettings.baseMap),r.getAvailableBaseMapAndProjections(t)}},maplanguage:{ref:"mapSettings.mapLanguage",translation:"geo.properties.maplanguage",type:"string",component:"dropdown",defaultValue:"auto",change:function(e){var n=t(e);r.setLanguage(e.mapSettings.mapLanguage,n.map)},options:function(e){try{var n=t(e);return r.getAvailableLanguages(n.map)}catch(e){return r.getDefaultAvailableLanguages()}}},useImperialUnits:{ref:"mapSettings.useImperialUnits",translation:"geo.properties.units",type:"boolean",component:"dropdown",defaultValue:!1,options:[{value:!1,translation:"geo.properties.metric"},{value:!0,translation:"geo.properties.imperial"}]}}},selectiontypeprops:{ref:"mapSettings.selectionType",translation:"geo.properties.selectiontype",type:"string",component:"dropdown",defaultValue:"lasso",options:[{value:"lasso",translation:"geo.properties.lassoselection"},{value:"circle",translation:"geo.properties.circleselection"},{value:"none",translation:"Common.None"}]},zoompanprops:{type:"items",items:{zoomtoselection:{ref:"autoZoomOnSelection",translation:"geo.properties.autoZoom",type:"boolean",defaultValue:!0},setinitialview:{ref:"mapSettings.initialView",component:"button",label:function(e){return e.mapSettings.initialView?o.get("geo.properties.initialview.clear"):o.get("geo.properties.initialview.set")},show:function(e){return!e.autoZoomOnSelection},action:function(e){var n,i=t(e),r=i.map.getGeoBounds(),o=i.map.getCenter(),s=i.map.getResolution();n=e.mapSettings.initialView?null:{center:o,resolution:s,bounds:r};var a=i.extensionObject.backendApi;a.model.getProperties().then(function(e){e.mapSettings.initialView=n,a.model.setProperties(e)})}}}}}}},e.getSettings=function(){return{uses:"settings",items:{general:{items:{details:{show:!1}}},legend:{type:"items",translation:"properties.legend",items:{showLegend:{ref:"mapSettings.showLegend",type:"boolean",translation:"properties.legend.show",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},layerPaneAlignment:{ref:"mapSettings.sidebarAlignment",translation:"properties.legend.position",type:"string",show:function(e){return e.mapSettings.showLegend},component:"dropdown",defaultValue:"auto",options:[{value:"auto",translation:"Common.Auto"},{value:"right",translation:"properties.dock.right"},{value:"left",translation:"properties.dock.left"},{value:"top",translation:"properties.dock.top"},{value:"bottom",translation:"properties.dock.bottom"}]}}},tools:{type:"items",translation:"geo.properties.presentation",grouped:!0,items:{navAndScalebar:{type:"items",items:{showNavigation:{ref:"navigation",type:"boolean",translation:"Common.Navigation",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},showscalebar:{ref:"mapSettings.showScaleBar",translation:"geo.properties.showScaleBar",type:"boolean",defaultValue:!0}}},zoomlevels:{type:"items",items:{zoomSwitch:{ref:"mapSettings.zoomLimitSwitch",translation:"geo.properties.zoomLimitSwitch",type:"boolean",component:"switch",defaultValue:!1,options:[{value:!1,translation:"Common.No"},{value:!0,translation:"Common.Custom"}]},zoomlimits:{type:"array",component:"slider",ref:"mapSettings.zoomLimit.range",min:n.ZOOM_LIMIT_MIN,max:n.ZOOM_LIMIT_MAX,step:1,defaultValue:[n.ZOOM_LIMIT_MIN,n.ZOOM_LIMIT_MAX],label:function(e){var t=Math.abs(e.mapSettings.zoomLimit.range[0]),i=Math.abs(e.mapSettings.zoomLimit.range[1]);return t===n.ZOOM_LIMIT_MIN&&i!==n.ZOOM_LIMIT_MAX?o.get("geo.properties.zoomRangeMin",[i]):t!==n.ZOOM_LIMIT_MIN&&i===n.ZOOM_LIMIT_MAX?o.get("geo.properties.zoomRangeMax",[t]):t===n.ZOOM_LIMIT_MIN&&i===n.ZOOM_LIMIT_MAX?o.get("geo.properties.zoomRangeMinMax"):o.get("geo.properties.zoomRange",[t,i])},show:function(e){return e.mapSettings.zoomLimitSwitch}}}},pan:{type:"items",items:{panSwitch:{ref:"mapSettings.panLimitSwitch",translation:"geo.properties.panLimitSwitch",type:"boolean",component:"switch",defaultValue:!1,options:[{value:!1,translation:"Common.No"},{value:!0,translation:"Common.Custom"}]},panlimits:{ref:"mapSettings.panLimits",label:function(e){return e.mapSettings.panLimits?o.get("geo.properties.clearPanLimit"):o.get("geo.properties.setPanLimit")},component:"button",action:function(e){var n=t(e),i=null;i=e.mapSettings.panLimits?null:n.map.getGeoBounds();var r=n.extensionObject.backendApi;r.model.getProperties().then(function(e){e.mapSettings.panLimits=null===i?i:JSON.stringify(i),r.model.setProperties(e)})},show:function(e){return e.mapSettings.panLimitSwitch}}}},debug:{type:"items",items:{showdebuginfo:{ref:"mapSettings.showDebugInfo",translation:"geo.properties.showDebugInfo",type:"boolean",defaultValue:!1}}}}}}}}}(s||(s={})),s}),define("client.property-panel/components/layers/layers-util",["objects.utils/data-properties/hypercube-handler","translator","core.utils/feature-flags","objects.picasso/title/title-retriever-factory","client.utils/property-resolver"],function(e,t,n,i,r){"use strict";return{getLayersProperties:function(e,t){return r.getValue(e,t||"layers")},getDimensionTitle:function(e,r){if(!e.length)return"";var o=e[0],s=o.qDef.cId,a=r.getDimensionLayout(s);return n.LABEL_EXPR?i.create().getDimensionTitle(a,o,!0):o.qLibraryId?a&&a.qError?t.get("Object.ErrorMessage.MissingDimension"):a&&a.title||"":a&&a.qFallbackTitle||""},createHyperCubeHandler:function(t,n,i,r){var o=new e({app:r,path:t});return o.setProperties(n),o.setLayout(i),o}}}),define("extensions.qliktech/mapchart/Properties",["require","exports","./MapProperties","./LayerProperties","./LayerType","objects.picasso/advanced-colorer","util","./Utils","translator","client.property-panel/components/layers/layers-util","client.utils/property-resolver"],function(e,t,n,i,r,o,s,a,l,c,u){"use strict";function h(){return{AreaLayer:{initialProperties:i.getInitialProperties("AreaLayer"),definition:{schemaIgnore:!0,translation:"geo.AreaLayer",component:"accordion",cacheKey:"AreaLayer",title:function(e,t){var n=e.qHyperCubeDef.qDimensions;return c.getDimensionTitle(n,t)||l.get(d)},type:"items",items:{general:{show:!1},metadata:{show:!1},data:i.getDataSection(),sorting:{uses:"sorting"},location:i.getLocationSection(r.AREA),color:i.getColorSection(),options:i.getOptionsSection(!0)}}},PointLayer:{initialProperties:i.getInitialProperties("PointLayer"),definition:{schemaIgnore:!0,translation:"geo.PointLayer",component:"accordion",cacheKey:"PointLayer",title:function(e,t){var n=e.qHyperCubeDef.qDimensions;return c.getDimensionTitle(n,t)||l.get(d)},type:"items",items:{general:{show:!1},metadata:{show:!1},data:i.getDataSection(),sorting:{uses:"sorting"},location:i.getLocationSection(r.POINT),size:i.getSizeSection(),color:i.getColorSection(),options:i.getOptionsSection(!0)}}},GeodataLayer:{initialProperties:i.getInitialProperties(r.GEODATA),definition:{schemaIgnore:!0,translation:"geo.GeodataLayer",component:"accordion",cacheKey:"GeodataLayer",title:function(e){return""!==e.title?e.title:l.get(d)},type:"items",items:{general:{show:!1},metadata:{show:!1},data:i.getGeodataSection(),options:i.getOptionsSection(!1)}}}}}var d="geo.dropmenu.noName";return{type:"items",component:"accordion",items:{layers:{translation:"properties.layers",component:"items",globalChange:function(e){for(var t=0;t<e.gaLayers.length;t++)o.colorByUpdater(e,"gaLayers."+t+".qHyperCubeDef.",e.gaLayers[t].color,"gaLayers."+t+".qHyperCubeDef.")},items:{layers:{component:"layers",ref:"gaLayers",dataPath:"items.data.items.data",addTranslation:"properties.layers.add",noLayersHelpHeader:l.get("geo.properties.noLayer"),noLayersHelpText:l.get("geo.properties.noLayerText"),showAddButton:!1,deleteBtnTranslation:"geo.layer.delete",activePath:function(e){var t=u.getValue(e,"data.qHyperCubeDef.qDimensions",[]).length>0,n=u.getValue(e,"data.tms.url","").length>0;return!t&&!n&&"data"},add:function(){console.log("add layer")},remove:function(){console.log("remove layer")},move:function(){console.log("move layer")},layers:h()},addLayer:{ref:"mapSettings._layerType",type:"string",defaultValue:"",component:"options-list",translation:"properties.layers.add",change:function(e,t,n){var i=e.mapSettings._layerType;if(i&&i.length){var r=h()[i].initialProperties;r.cId=s.generateId(),e.mapSettings._layerType="",a.insertLayer(r,e.gaLayers)}},title:"properties.layers.add",optionsLabel:"geo.properties.addOptions",optionsRadius:3,optionsSpacing:12,optionsBoldSelect:!0,options:function(){var e={PointLayer:"../resources/extensions/qliktech/mapchart/img/layer_point.png",AreaLayer:"../resources/extensions/qliktech/mapchart/img/layer_area.png",GeodataLayer:"../resources/extensions/qliktech/mapchart/img/bg_default.png"},t=h();return Object.keys(t).map(function(n){var i=t[n];return i.type=n,{src:e[n],translation:i.definition.translation,value:n}})}}}},mapsettings:n.getMapSettings(),settings:n.getSettings()}}});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions.qliktech/mapchart/MapChartApi",["require","exports","objects.backend-api/backend-api","client.utils/property-resolver"],function(e,t,n,i){"use strict";return function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t)},t.prototype.getSize=function(){return i.getValue(this.model.layout,this.dataPath.replace(new RegExp("/","g"),".")).qSize},t.prototype.getRowCount=function(){return i.getValue(this.model.layout,this.dataPath.replace(new RegExp("/","g"),".")).qSize.qcy},t.prototype.getData=function(e,t){return this.model.getHyperCubeData(e,t)},t.prototype.beginSelections=function(){for(var e=this.model,t=[],n=0;n<e.layout.gaLayers.length;++n)t.push("/qUndoExclude/gaLayers/"+n+"/qHyperCubeDef");return e.app.switchModalSelection(e,t)},t.prototype.selectValues=function(e,t,n,i){return this.model.selectHyperCubeValues(i||this.path,e,t,n)},t}(n)}),define("extensions.qliktech/mapchart/MapMigrator",["require","exports","./LayerProperties","translator","objects.picasso/advanced-colorer"],function(e,t,n,i,r){"use strict";return function(){function e(){}return e.migrateProperties=function(t){if(t.gaVersion===e.VERSION)return t;if(!t.layers)return t;t.gaVersion=e.VERSION,t.gaLayers=[],t.mapSettings=e.migrateMapSettings(t);for(n=0;n<t.layers.length;n++)t.layers[n].qHyperCubeDef&&t.layers[n].qHyperCubeDef.qDimensions[0]&&t.gaLayers.push(e.migrateLayer(t.layers[n],t.color));e.migrateBackground(t);for(var n=0;n<t.gaLayers.length;n++)r.colorByUpdater(t,"gaLayers."+n+".qHyperCubeDef.",t.gaLayers[n].color,"gaLayers."+n+".qHyperCubeDef.");return t},e.migratedBasicLayerProperties=function(e,t){var i=n.getInitialProperties("point"===e.type?"PointLayer":"AreaLayer");i.cId="MIGRATED",i.showLayer=e.show,i.maxObjects=3333;var r=i.color.outline,o=i.color.opacity;return i.color=this.clone(t),i.color.outline=r,i.color.opacity=void 0===e.opacity?o:e.opacity,i},e.migrateLayer=function(e,t){var i=this.migratedBasicLayerProperties(e,t);if("point"===e.type){i.qHyperCubeDef=this.clone(e.qHyperCubeDef),i.qHyperCubeDef.qMeasures=[],i.qHyperCubeDef.qInterColumnSortOrder=[0],i.qHyperCubeDef.qSuppressZero=!1,i.qHyperCubeDef.qDimensions.length>1&&(i.qHyperCubeDef.qDimensions[1].qNullSuppression=!0);var r=e.qHyperCubeDef.qDimensions[1].qAttributeExpressions[0]?e.qHyperCubeDef.qDimensions[1].qAttributeExpressions[0].id:null;({byMeasure:"colorByAlternative",byExpression:"colorByExpression"})[t.mode]===r?i.qHyperCubeDef.qDimensions[0].qAttributeExpressions=this.clone(e.qHyperCubeDef.qDimensions[1].qAttributeExpressions):"byMeasure"===t.mode&&!i.color.byMeasureDef&&e.qHyperCubeDef.qMeasures.length>0?((a=e.qHyperCubeDef.qMeasures[0].qLibraryId)?i.color.byMeasureDef={key:e.qHyperCubeDef.qMeasures[0].qLibraryId,label:"",type:"libraryItem"}:(i.color.colorExpression=e.qHyperCubeDef.qMeasures[0].qDef.qDef,i.color.mode="byExpression"),i.color.expressionIsColor=!1):"byDimension"===t.mode&&"colorByAlternative"===(e.qHyperCubeDef.qDimensions[1].qAttributeDimensions[0]?e.qHyperCubeDef.qDimensions[1].qAttributeDimensions[0].id:null)&&(i.qHyperCubeDef.qDimensions[0].qAttributeDimensions=this.clone(e.qHyperCubeDef.qDimensions[1].qAttributeDimensions)),this.updateDimensionExpressions(i);var o=i;if(i.locationOrLatitude=this.dimension2ExpressionProp(e.qHyperCubeDef.qDimensions[1]),e.qHyperCubeDef.qMeasures[0])o.size.expression=this.measure2ExpressionProp(e.qHyperCubeDef.qMeasures[0]),o.size.radiusMin=e.rangeBubbleSizes[0],o.size.radiusMax=e.rangeBubbleSizes[1],o.size.slider=[n.getSliderValueFromSize(o.size.radiusMin),n.getSliderValueFromSize(o.size.radiusMax)],o.size.autoRadiusValueRange=e.autoMinMax,o.size.radiusValueMin=e.customMin,o.size.radiusValueMax=e.customMax;else{var s=Math.floor(e.bubbleSizes/2);o.size.radiusMin=e.bubbleSizes-s,o.size.radiusMax=e.bubbleSizes+s}}else{if(i.qHyperCubeDef=this.clone(e.geodata.qHyperCubeDef),i.qHyperCubeDef.qDimensions=[i.qHyperCubeDef.qDimensions[0]],i.qHyperCubeDef.qMeasures=[],i.qHyperCubeDef.qInterColumnSortOrder=[0],i.qHyperCubeDef.qSuppressZero=!1,i.qHyperCubeDef.qDimensions[0].qAttributeExpressions=this.clone(e.qHyperCubeDef.qDimensions[0].qAttributeExpressions),i.locationOrLatitude=this.measure2ExpressionProp(e.geodata.qHyperCubeDef.qMeasures[0]),"byMeasure"===t.mode&&!i.color.byMeasureDef&&e.qHyperCubeDef.qMeasures.length>0){var a=e.qHyperCubeDef.qMeasures[0].qLibraryId;a?i.color.byMeasureDef={key:e.qHyperCubeDef.qMeasures[0].qLibraryId,label:"",type:"libraryItem"}:(i.color.colorExpression=e.qHyperCubeDef.qMeasures[0].qDef.qDef,i.color.mode="byExpression"),i.color.expressionIsColor=!1}this.updateDimensionExpressions(i)}return i},e.updateDimensionExpressions=function(e){"byExpression"!==e.color.mode||this.haveItemWithId(e.qHyperCubeDef.qDimensions[0].qAttributeExpressions,"colorByExpression")?"byMeasure"!==e.color.mode||this.haveItemWithId(e.qHyperCubeDef.qDimensions[0].qAttributeExpressions,"colorByAlternative")||(e.color.byMeasureDef&&"libraryItem"===e.color.byMeasureDef.type?e.qHyperCubeDef.qDimensions[0].qAttributeExpressions.push({qLibraryId:e.color.byMeasureDef.key,id:"colorByAlternative"}):e.qHyperCubeDef.qDimensions[0].qAttributeExpressions.push({qExpression:e.color.byMeasureDef.key,id:"colorByAlternative"})):e.qHyperCubeDef.qDimensions[0].qAttributeExpressions.push({qExpression:e.color.colorExpression,id:"colorByExpression"})},e.haveItemWithId=function(e,t){for(var n in e)if(e[n].id&&e[n].id===t)return!0;return!1},e.clone=function(e){return JSON.parse(JSON.stringify(e))},e.dimension2ExpressionProp=function(e){return{key:e.qLibraryId?e.qLibraryId:this.bracketIfNeeded(e.qDef.qFieldDefs[0]),label:e.qDef.qFieldLabels[0]?e.qDef.qFieldLabels[0]:"",type:e.qLibraryId?"libraryItem":"expression"}},e.measure2ExpressionProp=function(e){return{key:e.qLibraryId?e.qLibraryId:e.qDef.qDef,label:e.qDef.qLabel?e.qDef.qLabel:"",type:e.qLibraryId?"libraryItem":"expression"}},e.bracketIfNeeded=function(e){return e.length>0&&"="!==e.charAt(0)&&"["!==e.charAt(0)?"["+e+"]":e},e.migrateMapSettings=function(t){var n={baseMap:"pale",mapLanguage:"auto",panLimits:null,initialView:null,projection:"pale_mercator",selectionType:"lasso",showDebugInfo:!1,showScaleBar:!1,useImperialUnits:!1,showLegend:t.legend.show,sidebarAlignment:e.legendPlacement(t),zoomLimit:{range:[0,20]},zoomLimitSwitch:!1,panLimitSwitch:!1,_layerType:""};return t.background.show&&t.background.defaultMapService||(n.baseMap="empty",n.projection="emptydegreemercator"),n},e.migrateBackground=function(t){if(t.background.show&&!t.background.defaultMapService){var r=n.getInitialProperties("GeodataLayer");if(r.cId="MIGRADED_BG",r.title=i.get("geo.GeodataLayer"),t.background.layers.length>0&&t.background.layers[0].urls.length>0){var o=t.background.layers[0];r.tms={url:o.urls[0],attribution:e.convertAttribution(o.attribution)},t.gaLayers.push(r)}}},e.convertAttribution=function(t){return e.convertLink(e.convertImage(t))},e.convertLink=function(t){var n=t.indexOf("@[");if(n<0)return t;var i=t.indexOf("](",n);if(i<0)return t;var r=t.indexOf(")",i);if(i<0)return t;var o=t.substring(n+2,i),s=t.substring(i+2,r);return t.substring(0,n)+"<a href='"+s+"' target='_blank'>"+o+"</a>"+e.convertLink(t.substring(r+1))},e.convertImage=function(t){var n=t.indexOf("![");if(n<0)return t;var i=t.indexOf("](",n);if(i<0)return t;var r=t.indexOf(")",i);return i<0?t:t.substring(0,n)+" "+e.convertImage(t.substring(r+1))},e.legendPlacement=function(e){var t=e.color;return!t.auto&&("byDimension"===t.mode||"byMeasure"===t.mode)?e.legend.dock:"hidden"},e.VERSION=2,e}()}),define("objects.picasso/disclaimer/disclaimers-config",[],function(){var e={CENTER:0,BOTTOM:1};return{DISCLAIMERS:[{label:"NoDataExist",alignment:e.CENTER,default:!0},{label:"OnlyNanData",alignment:e.CENTER,default:!0},{label:"OnlyNegativeOrZeroValues",alignment:e.CENTER,default:!1},{label:"LimitedData",alignment:e.BOTTOM,default:!1},{label:"OnlyNanColor",alignment:e.BOTTOM,default:!1},{label:"NegativeOrZeroValues",alignment:e.BOTTOM,default:!1},{label:"DataRangeIncludingZero",alignment:e.BOTTOM,default:!1}],ALIGNMENT:e}}),define("objects.picasso/disclaimer/disclaimer-attributes-util",["./disclaimers-config"],function(e){function t(e,t){var n,i,r,o,s,a=t.length;for(e&&(i=!(e.autoMinMax||"min"!==e.minMax&&"minMax"!==e.minMax||null===e.min||isNaN(e.min)),r=!(e.autoMinMax||"max"!==e.minMax&&"minMax"!==e.minMax||null===e.max||isNaN(e.max))),o=Number.MAX_VALUE,s=-Number.MAX_VALUE,n=0;n<a;n++)if(o=Math.min(o,t[n].qMin),s=Math.max(s,t[n].qMax),o<=0&&s>=0)return!0;return o=i?e.min:o,s=r?e.max:s,o<=0&&s>=0}function n(e){return e&&e[0]&&e[0].qData[0]&&e[0].qData[0].qSubNodes}return{getNoDataExistAttribute:function(e){return e.qSize.qcy*e.qSize.qcx==0},getLimitedDataAttribute:function(e,t){var i,r=!1;return e?void 0!==t.explicitLimitedData?r=!0===t.explicitLimitedData:e.qDataPages&&e.qDataPages[0]?r=!t.paging&&e.qSize.qcy>e.qDataPages[0].qMatrix.length:n(e.qStackedDataPages)&&(i=t.maxNbrOfDimensions?t.maxNbrOfDimensions:2,r=e.qDimensionInfo.length>=i?e.qStackedDataPages[0].qData[0].qSubNodes.some(function(e){return e.qDown>0}):e.qStackedDataPages[0].qData[0].qSubNodes.length<e.qStackedDataPages[0].qArea.qHeight):r=!0===t.explicitLimitedData,r},getNegativeOrZeroValuesAttribute:function(e,t){return!t.supportNegative&&e.qMeasureInfo.some(function(e){return e.qMin<=0})},getOnlyNegativeOrZeroValuesAttribute:function(e,t){return!t.supportNegative&&e.qMeasureInfo.every(function(e){return e.qMax<=0&&e.qMax>=e.qMin})||0===e.qSize.qcy},getOnlyNanDataAttribute:function(e,t){return void 0!==t.explicitOnlyNanData?t.explicitOnlyNanData:e.qMeasureInfo.every(function(e){return e.qMax<e.qMin||"NaN"===e.qMax})},getDataRangeIncludingZeroAttribute:function(e,n){return!n.supportRangeOverZero&&t(e.measureAxis,e.qHyperCube.qMeasureInfo)},applyAttributes:function(t,n){var i=t||{},r={};return i.supportNegative=void 0===i.supportNegative||i.supportNegative,i.supportRangeOverZero=void 0===i.supportRangeOverZero||i.supportRangeOverZero,e.DISCLAIMERS.forEach(function(e){r[e.label]=!1}),n&&n.qHyperCube?(r.NoDataExist=this.getNoDataExistAttribute(n.qHyperCube),r.NoDataExist?r:(r.LimitedData=this.getLimitedDataAttribute(n.qHyperCube,i),r.NegativeOrZeroValues=this.getNegativeOrZeroValuesAttribute(n.qHyperCube,i),r.OnlyNegativeOrZeroValues=this.getOnlyNegativeOrZeroValuesAttribute(n.qHyperCube,i),r.OnlyNanData=this.getOnlyNanDataAttribute(n.qHyperCube,i),r.DataRangeIncludingZero=this.getDataRangeIncludingZeroAttribute(n,i),r)):r}}}),define("text!objects.picasso/disclaimer/disclaimer-component.ng.html",[],function(){return'<span class="qv-viz-center-disclaimer" ng-if="centerDisclaimer.show" title="{{ centerDisclaimer.message }}" dir="ltr">{{ centerDisclaimer.message }}</span>\n<div class="qv-viz-disclaimer"\n\t ng-if="!centerDisclaimer.show && outerDisclaimer.show"\n\t style="font-size: 1em;"\n\t qva-direction x-dir-setting="{{direction}}" x-dir-text="{{languageString}}">\n\t<span class="ltr-star">*</span>\n\t<span class="title" title="{{ outerDisclaimer.message }}">{{ outerDisclaimer.message }}</span>\n\t<span class="rtl-star">*</span>\n</div>'}),define("objects.picasso/disclaimer/disclaimer-component-helper",[],function(){function e(e,t,n){this.disclaimersConfig=e,this.dataAttributes=t,this.supportedDisclaimers=n}function t(e,t){return e&&t&&t[e]}return e.prototype.isValidAndSupported=function(e,n){return t(e.label,this.dataAttributes)&&(e.default||t(e.label,this.supportedDisclaimers))&&void 0!==n&&e.alignment===n},e.prototype.isAnyValidDisclaimer=function(e){var t=!1,n=this;return this.disclaimersConfig.forEach(function(i){n.isValidAndSupported(i,e)&&(t=!0)}),t},e.prototype.getMessage=function(e,t){var n="",i=this;return t&&this.disclaimersConfig.forEach(function(r){i.isValidAndSupported(r,e)&&(n+=t.get("Object.Disclaimer."+r.label)+" ")}),n},e}),define("objects.picasso/disclaimer/disclaimer-component",["text!./disclaimer-component.ng.html","./disclaimers-config","./disclaimer-component-helper","translator"],function(e,t,n,i){return{template:e,scope:{dataAttributes:"=",direction:"=",supportedDisclaimers:"=",onRender:"="},controller:["$scope","$timeout",function(e,r){var o=new n(t.DISCLAIMERS,e.dataAttributes,e.supportedDisclaimers);e.centerDisclaimer={show:o.isAnyValidDisclaimer(t.ALIGNMENT.CENTER),message:o.getMessage(t.ALIGNMENT.CENTER,i)},e.outerDisclaimer={show:o.isAnyValidDisclaimer(t.ALIGNMENT.BOTTOM),message:o.getMessage(t.ALIGNMENT.BOTTOM,i)},e.languageString=i.get("Object.Disclaimer.LimitedData"),r(function(){e.onRender()},5)}]}}),define("objects.picasso/disclaimer/disclaimer",["jquery","./disclaimers-config","./disclaimer-attributes-util","./disclaimer-component","./disclaimer-component-helper"],function(e,t,n,i,r){function o(e){this.options=e,this.clear()}return o.ERRORS={SET:"Calling Disclaimer.set() without attributes",DISPLAY:"Calling Disclaimer.display() before attributes are applied"},o._applyDefaultSupport=function(e,t){var n=e;return n||(n={}),t.forEach(function(e){void 0===n[e.label]&&(n[e.label]=e.default)}),n},o.prototype.getBottomDisclaimerVisibility=function(){var e=new r(t.DISCLAIMERS,this.dataAttributes,this.vizAttributes.supportedDisclaimers);return e.isAnyValidDisclaimer(t.ALIGNMENT.BOTTOM)&&!e.isAnyValidDisclaimer(t.ALIGNMENT.CENTER)},o.prototype.toggleBottomDisclaimerVisibility=function(e,t){var n=!!(t||this.vizAttributes.options&&this.vizAttributes.options.paddingBottom);this.options.showDisclaimerStar=t,e.toggleClass("qv-viz-with-disclaimer",n)},o.prototype.display=function(n){var r;if(!(this.vizAttributes&&this.dataAttributes&&this.options))throw new Error(o.ERRORS.DISPLAY);this.vizAttributes.supportedDisclaimers=o._applyDefaultSupport(this.vizAttributes.supportedDisclaimers,t.DISCLAIMERS),(r=e(n)).siblings(".disclaimer").addClass("to-remove"),r.parent().append("<div class='disclaimer'></div>"),r.siblings(".disclaimer").last().showComponent(i,{dataAttributes:e.extend(!0,{},this.dataAttributes),direction:this.options.direction,supportedDisclaimers:e.extend(!0,{},this.vizAttributes.supportedDisclaimers),onRender:function(){r.siblings(".disclaimer.to-remove").remove()}}),this.toggleBottomDisclaimerVisibility(r,this.getBottomDisclaimerVisibility())},o.prototype.set=function(e){if(this.clear(),!e)throw new Error(o.ERRORS.SET);this.vizAttributes=e,this.dataAttributes=n.applyAttributes(this.vizAttributes.options,this.vizAttributes.data)},o.prototype.clear=function(){this.vizAttributes=null,this.dataAttributes=null},o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e, t){e.__proto__=t}||function(e, t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t, n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions.qliktech/mapchart/MapChartView",["require","exports","./DataUtils","util","_qlik","objects.extension/base-view","./MapChart","objects.utils/interaction-states","objects.picasso/derived-properties/derived-properties","./MapMigrator","./FieldManager","objects.picasso/disclaimer/disclaimer"],function(e, t, n, i, r, o, s, a, l, c, u, h){"use strict";return function(e){function t(o, s, a, u, d){var p=e.call(this,o,s,a,u,d)||this;return p._derivedProperties=new l,p.generateDerivedProperties=function(e, o){return o.gaVersion!==c.VERSION&&c.migrateProperties(o),o.qUndoExclude.gaLayers=[],o.gaLayers.forEach(function(e){var r=i.extend(!0,{},e.qHyperCubeDef);if(r.qInitialDataFetch[0]={qWidth:r.qDimensions.length,qHeight:1e3},o.qUndoExclude.gaLayers.push({qHyperCubeDef:r}),o.qUndoExclude.gaLayers[o.qUndoExclude.gaLayers.length-1].color=e.color,r.qDimensions.length>0)if(e.locationOrLatitude.key!==r.qDimensions[0].qLibraryId&&e.locationOrLatitude.key!==r.qDimensions[0].qDef.qFieldDefs[0]&&n.addExpr("locationOrLatitude",e.locationOrLatitude,r),"PointLayer"===e.type)(s=e).isLatLong?s.longitude&&n.addExpr("longitude",s.longitude,r):t.addLocationDetails(e.locationNamesAuto,s,r),n.addExpr("size",s.size.expression,r,!0),s.label.show&&n.addExpr("label",s.label.expression,r);else if("AreaLayer"===e.type){var s=e;t.addLocationDetails(e.locationNamesAuto,s,r),s.label.show&&n.addExpr("label",s.label.expression,r)}}),r.Promise.resolve()},window.mapChartViewBounds||(window.mapChartViewBounds={}),p._disclaimer=new h(a),p}return __extends(t,e),t.prototype.init=function(t,n,i,r,o){e.prototype.init.call(this,t,n,i,r,o),this.selectionsApi=o,this.element=n},t.prototype.setInteractionState=function(t){e.prototype.setInteractionState.call(this,t),this._inEditState=t===a.EDIT,this._inAnalysisState=t===a.ANALYSIS,this._inEditState&&u.load(),this._inAnalysisState&&!this._on?this.on():!this._inAnalysisState&&this._on&&this.off(),this.mapChart&&this.mapChart.onStateChange()},t.prototype.inAnalysisState=function(){return this._inAnalysisState},t.prototype.inEditState=function(){return this._inEditState},t.prototype.destroy=function(){window.mapChartViewBounds[this.mapChart.id]={center:this.mapChart.map.getCenter(),resolution:this.mapChart.map.getResolution()}},t.prototype.updateData=function(e){return this.mapChart||(this.mapChart=new s(this.element,e,this)),this.mapChart.updateData(e)},t.prototype.getDisclaimerAttributes=function(){return{data:this.mapChart.isLimitedData()?this.mapChart.getLimitedLayout():null,supportedDisclaimers:{DataRangeIncludingZero:!1,LimitedData:!0,NegativeOrZeroValues:!1,NoDataExist:!1,OnlyNanColor:!1,OnlyNanData:!1,OnlyNegativeOrZeroValues:!1},options:{bottom:!0,paddingBottom:!0,supportNegative:!0,explicitOnlyNanData:!1,explicitNoDataExist:!1,explicitLimitedData:this.mapChart.isLimitedData()}}},t.prototype.paint=function(e,t){var n=this;if(this.mapChart){var i=this.mapChart.paint(),r=this.getDisclaimerAttributes();return this._disclaimer.set(r),this._disclaimer.display(this.mapChart.mapDiv),this.mapChart.parentDiv.find(".disclaimer").toggleClass("showing",Boolean(r.data)),setTimeout(function(){return n.mapChart.map.repaint()},150),i}},t.prototype.resize=function(){this.mapChart&&this.mapChart.onResize()},t.prototype.setSnapshotData=function(e){var t=this.mapChart.layout.snapshotData;if(!(t&&t.viewFocus&&t.viewFocus.bounds&&t.layers)){var n=this.mapChart.map.getGeoBounds();n&&(e.snapshotData.viewFocus={bounds:{min:[n.min[0],n.min[1]],max:[n.max[0],n.max[1]]}});for(var i=this.mapChart.layers,r={},o=0;o<i.length;o++)r[i[o].id]={visible:i[o].isInVisibleRange()};e.snapshotData.layers=r}},t.prototype.on=function(){this._on=!0},t.prototype.off=function(){this._on=!1},t.prototype.getSelectionToolbar=function(){if(this.mapChart.selectTool)return this.mapChart.selectTool.getSelectionToolbar()},t.prototype.suppressOnPaint=function(e){return e.qSelectionInfo&&e.qSelectionInfo.qInSelections},t.prototype.initialize=function(){},t.prototype.refreshSelections=function(){},t.addLocationDetails=function(e,t,i){e||(n.addExpr("country",t.locationCountry,i),t.locationCountry.key.trim().length>0&&(n.addExpr("admin1",t.locationAdmin1,i),t.locationAdmin1.key.trim().length>0&&n.addExpr("admin2",t.locationAdmin2,i)))},t.prototype.updateDerivedProperties=function(e,t){var n={layout:t,properties:e,model:this.backendApi.model,hashData:e.gaLayers?{gaVersion:e.gaVersion,layersData:e.gaLayers.map(function(e){if("GeodataLayer"===e.type)return{};var t={dimension:e.qHyperCubeDef,location:e.locationOrLatitude,locationType:e.locationType,isLatLong:e.isLatLong,locationNamesAuto:e.locationNamesAuto,locationCountry:e.locationCountry,locationAdmin1:e.locationAdmin1,locationAdmin2:e.locationAdmin2,label:e.label,color:e.color};if("PointLayer"===e.type){var n=e;t.isLatLong=n.isLatLong,t.longitude=n.longitude,t.size=n.size.expression}return t})}:"migrated map, will generate",generateDerivedProperties:this.generateDerivedProperties};return this._derivedProperties.updateDerivedProperties(n)},t}(o)}),define("extensions.qliktech/mapchart/MapChartDropMenu",["require","exports","translator","./LayerProperties","./LayerType","util","./Utils","./FieldManager"],function(e,t,n,i,r,o,s,a){"use strict";return function(){function e(e,t,n,i,r){this.builder=e,this.mapChartHandler=t,this.model=n,this.showMenu=i,this.object=r,this.field={name:"",label:"",isMasterItem:!1,type:"",id:""},this.init(),this.createDropMenu()}return e.prototype.init=function(){"field"===this.builder.item.type?(this.field.isMasterItem=!1,this.field.name=this.builder.item.id,this.field.label=this.builder.item.name,this.field.type=this.builder.item.type):(this.field.isMasterItem=!0,this.field.name=this.builder.item.id,this.field.label=this.builder.item.name,this.field.id=this.builder.item.id,this.field.type=this.builder.item.type)},e.prototype.createDropMenu=function(){if(this.model,this.object,"measure"!==this.field.type&&"expression"!==this.field.type){var e=a.getRecommendedLayerTypeByTags(this.field.name),t=this.builder.menu.addItem({translation:"geo.dropmenu.newLayer"});for(var i in e)e[i]&&this.addMenuItem(t,["geo.dropmenu.addRecommended"+i,[]],"add",this.addNewLayer,[i]);for(var i in e)e[i]||this.addMenuItem(t,["geo.dropmenu.add"+i,[]],"add",this.addNewLayer,[i])}var r=this.builder.menu,o=this.mapChartHandler.properties.gaLayers;for(var s in o){var l=o[s],c=l.qHyperCubeDef.qDimensions[0],u=this.field.label,h=this.mapChartHandler.layout.gaLayers[s].qHyperCube.qDimensionInfo[0],d="";d=h?"H"===h.qGrouping?h.title:h.qFallbackTitle:n.get("geo.dropmenu.noName");var p=this.addSubMenu(r,["geo.dropmenu.useInLayer",[d,n.get("geo."+l.type)]],"submenu");switch(this.field.type){case"field":if(c?this.addMenuItem(p,["geo.dropmenu.replaceDimension",[d]],"replace",this.addDimensionFieldOption,[l]):this.addMenuItem(p,["geo.dropmenu.addDimension",[u]],"add",this.addDimensionFieldOption,[l]),this.addMenuItem(p,["geo.dropmenu.addLocation",[u]],"add",this.addLocationFieldOption,[l]),"PointLayer"===l.type){var f=this.addSubMenu(p,["geo.dropmenu.sizeBy",[]],"size-by");this.addExpressionFieldOptionMenu(f,"size-by",l)}var m=this.addSubMenu(p,["contextMenu.colorByFieldMenu",[]],"add");this.addMenuItem(m,["contextMenu.colorByDimension",[u]],"color-by",this.addColorByDimension,[l]);var g=this.addSubMenu(m,["contextMenu.colorByMeasure",[]],"color-by");this.addMeasureFieldOptionMenu(g,"color-by",l);break;case"dimension":c?this.addMenuItem(p,["geo.dropmenu.replaceDimension",[d]],"replace",this.addDimensionFieldOption,[l]):this.addMenuItem(p,["geo.dropmenu.addDimension",[u]],"add",this.addDimensionFieldOption,[l]),this.addMenuItem(p,["geo.dropmenu.addLocation",[u]],"add",this.addLocationFieldOption,[l]),this.addMenuItem(p,["contextMenu.colorBy",[u]],"color-by",this.addColorByDimension,[l]);break;case"measure":case"expression":"PointLayer"===l.type&&this.addMenuItem(p,["geo.dropmenu.sizeByLibraryItem",[u]],"size-by",this.addMeasureFieldOptionMasterItem,["size-by",l]),this.addMenuItem(p,["contextMenu.colorBy",[u]],"color-by",this.addMeasureFieldOptionMasterItem,["color-by",l])}}this.showMenu()},e.prototype.addSubMenu=function(e,t,i){e.addItem({translation:n.get(t[0],t[1]),tid:i});var r=e.items.length-1;return e.items[r]},e.prototype.addMenuItem=function(e,t,i,r,o){var s=this;e.addItem({translation:n.get(t[0],t[1]),tid:i,select:function(){r.apply(s,o)}})},e.prototype.createNewItem=function(){var e;switch(this.field.type){case"field":e=this.mapChartHandler.createFieldDimension(this.field.name,this.field.label);break;case"dimension":e=this.mapChartHandler.createLibraryDimension(this.field.id);break;case"measure":e=this.mapChartHandler.createLibraryMeasure(this.field.id);break;case"expression":e=this.mapChartHandler.createExpressionMeasure(this.field.name,this.field.label)}return e},e.prototype.addColorByDimension=function(e){e.color.altLabel=this.field.name,e.color.auto=!1,e.color.byDimDef={label:this.field.label,key:this.field.name,type:"expression"},e.color.colorExpression="",e.color.expressionIsColor=!0,e.color.mode="byDimension",e.color.useDimColVal=!1,this.saveModel()},e.prototype.addNewLayer=function(e){var t=this.createNewItem(),n=this.mapChartHandler.properties,l={PointLayer:r.POINT,AreaLayer:r.AREA,GeodataLayer:r.GEODATA}[e],c=i.getInitialProperties(l);c.cId=o.generateId(),s.insertLayer(c,n.gaLayers),t.qDef.cId=o.generateId(),c.qHyperCubeDef.qDimensions[0]=t,a.setDefaultLocation(t,c),t.qLibraryId?(c.label.expression.key=t.qLibraryId,c.label.expression.type="libraryItem",c.label.expression.label=""):(c.label.expression.key=t.qDef.qFieldDefs[0],c.label.expression.type="expression",c.label.expression.label="dimension.qDef.qFieldDefs[0]"),this.saveModel()},e.prototype.addDimensionFieldOption=function(e){var t=this.createNewItem();e.qHyperCubeDef.qDimensions[0]=t,e.isLatLong=!1,a.setDefaultLocation(t,e),t.qLibraryId?(e.label.expression.key=t.qLibraryId,e.label.expression.type="libraryItem",e.label.expression.label=""):(e.label.expression.key=t.qDef.qFieldDefs[0],e.label.expression.type="expression",e.label.expression.label="dimension.qDef.qFieldDefs[0]"),this.saveModel()},e.prototype.addLocationFieldOption=function(e){var t=this.createNewItem();a.setDefaultLocation(t,e),e.isLatLong=a.fieldContainsTags(this.field.name,["$numeric"])||a.fieldContainsTags(this.field.name,["$geolatitude"]),this.saveModel()},e.prototype.addMeasureFieldOptionMasterItem=function(e,t){var n,i="";switch(i=this.field.isMasterItem?"libraryItem":"expression",n={key:this.field.id,type:i},e){case"size-by":this.field.isMasterItem||(n.label=this.field.label),t.size.expression=n;break;case"color-by":t.color.auto=!1,t.color.byMeasureDef=n,t.color.mode="byMeasure";break;default:return}this.saveModel()},e.prototype.addMeasureFieldOptionMenu=function(e,t,n){for(var i=this,r=o.escapeField(this.field.name),s=["Sum","Count","Avg","Min","Max"],a=0;a<s.length;a++)!function(o){var a=s[o]+"("+r+")";e.addItem({label:a,tid:s[o].toLowerCase(),select:function(){switch(t){case"color-by":n.color.auto=!1,n.color.byMeasureDef={label:a,key:a,type:"expression"},n.color.mode="byMeasure";break;default:return}i.saveModel()}})}(a)},e.prototype.addExpressionFieldOptionMenu=function(e,t,n){for(var i=this,r=o.escapeField(this.field.name),s=["Sum","Count","Avg","Min","Max"],a=0;a<s.length;a++)!function(o){var a=s[o]+"("+r+")";e.addItem({label:a,tid:s[o].toLowerCase(),select:function(){switch(t){case"size-by":n.size.expression={label:a,key:a,type:"expression"};break;default:return}i.saveModel()}})}(a)},e.prototype.saveModel=function(){this.mapChartHandler.updateGlobalChangeListeners(),this.model.setProperties(this.mapChartHandler.properties)},e}()}),define("extensions.qliktech/mapchart/LayoutMigrator",["require","exports","./MapMigrator","./LayerProperties"],function(e,t,n,i){"use strict";return function(){function e(){}return e.migrateLayout=function(t){if(t.gaVersion!==n.VERSION){if(t.layers){t.gaVersion=n.VERSION,t.gaLayers=[],t.mapSettings=n.migrateMapSettings(t),this.migrateSnapshotData(t);for(var i=0;i<t.layers.length;i++)if(t.layers[i].qHyperCube&&t.layers[i].qHyperCube.qDimensionInfo[0]){var r=e.migrateLayer(t.layers[i],t);r&&t.gaLayers.push(r)}t.qUndoExclude||(t.qUndoExclude={}),t.qUndoExclude.gaLayers=t.gaLayers,n.migrateBackground(t)}}else t.snapshotData&&!t.snapshotData.viewFocus&&this.migrateSnapshotData(t)},e.mercatorY2Lat=function(e){return 180*(2*Math.atan(Math.exp(e*Math.PI/180))-Math.PI/2)/Math.PI},e.migrateSnapshotData=function(t){if(t.snapshotData){var n=t.snapshotData,i=n.content&&n.content.chartData&&n.content.chartData.mapRect;if(i){var r=e.mercatorY2Lat(i.y),o=e.mercatorY2Lat(i.y+i.height);n.viewFocus={bounds:{min:[r,i.x],max:[o,i.x+i.width]}}}}},e.migrateLayer=function(e,t){var r=n.migratedBasicLayerProperties(e,t.color);if(!e.qHyperCube)return null;if("point"===e.type){if(e.qHyperCube.qDimensionInfo.length<2)return null;var o=r;o.qHyperCube=e.qHyperCube,this.column2ExpressionProp(o.qHyperCube,1);var s=o.qHyperCube.qDimensionInfo[1],a={qMin:s.qMin,qMax:s.qMax,qContinuousAxes:!0,qIsCyclic:!1,qIsAutoFormat:!0,label:s.qFallbackTitle,qFallbackTitle:s.qFallbackTitle,id:"locationOrLatitude"};if(o.qHyperCube.qDimensionInfo[0].qAttrExprInfo.push(a),o.locationOrLatitude.key=o.qHyperCube.qDimensionInfo[0].qFallbackTitle,p=(d=e.qHyperCube).qMeasureInfo.length>0){this.column2ExpressionProp(o.qHyperCube,2);var l={qMin:(h=o.qHyperCube.qMeasureInfo[0]).qMin,qMax:h.qMax,qContinuousAxes:!0,qIsCyclic:!1,qIsAutoFormat:!0,label:h.qFallbackTitle,qFallbackTitle:h.qFallbackTitle,id:"size"};o.qHyperCube.qDimensionInfo[0].qAttrExprInfo.push(l),o.size.expression.key=o.qHyperCube.qMeasureInfo[0].qFallbackTitle,o.size.radiusMin=e.rangeBubbleSizes[0],o.size.radiusMax=e.rangeBubbleSizes[1],o.size.slider=[i.getSliderValueFromSize(o.size.radiusMin),i.getSliderValueFromSize(o.size.radiusMax)],o.size.autoRadiusValueRange=e.autoMinMax,o.size.radiusValueMin=e.customMin,o.size.radiusValueMax=e.customMax}else{var c=Math.floor(e.bubbleSizes/2);o.size.radiusMin=e.bubbleSizes-c,o.size.radiusMax=e.bubbleSizes+c}}else{if(0===e.qHyperCube.qDimensionInfo.length||!e.geodata||0===e.geodata.qHyperCube.qDimensionInfo.length)return null;var u=r;u.qHyperCube=e.geodata.qHyperCube,this.column2ExpressionProp(u.qHyperCube,1);var h=u.qHyperCube.qMeasureInfo[0],a={qMin:h.qMin,qMax:h.qMax,qContinuousAxes:!0,qIsCyclic:!1,qIsAutoFormat:!0,label:h.qFallbackTitle,qFallbackTitle:h.qFallbackTitle,id:"locationOrLatitude"};u.qHyperCube.qDimensionInfo[0].qAttrExprInfo.push(a),u.locationOrLatitude.key=u.qHyperCube.qMeasureInfo[0].qFallbackTitle;var d=e.qHyperCube,p=d.qMeasureInfo.length>0;p&&(u.qHyperCube.qMeasureInfo[0]=d.qMeasureInfo[0]);var f=d.qDimensionInfo[0].qAttrExprInfo.length>0;f&&u.qHyperCube.qDimensionInfo[0].qAttrExprInfo.push(d.qDimensionInfo[0].qAttrExprInfo[0]);var m=d.qDimensionInfo[0].qAttrDimInfo.length>0;m&&u.qHyperCube.qDimensionInfo[0].qAttrDimInfo.push(d.qDimensionInfo[0].qAttrDimInfo[0]);var g={};for(var v in d.qDataPages[0].qMatrix)g[(y=d.qDataPages[0].qMatrix[v])[0].qText]=y;for(var v in u.qHyperCube.qDataPages[0].qMatrix){var y=u.qHyperCube.qDataPages[0].qMatrix[v],b=y[0];if(b.qText){var x=g[b.qText];void 0!==x?(p&&(y[1]=x[1]),f&&y[0].qAttrExps.qValues.push(x[0].qAttrExps.qValues[0]),m&&(y[0].qAttrDims||(y[0].qAttrDims={qValues:[]}),y[0].qAttrDims.qValues.push(x[0].qAttrDims.qValues[0]))):(p&&(y[1]={qElemNumber:0,qNum:NaN,qState:"X",qAttrExps:null}),f&&(y[0].qAttrDims||(y[0].qAttrDims={qValues:[]}),y[0].qAttrExps.qValues.push({qNum:NaN})),m&&y[0].qAttrDims.qValues.push({qElemNo:0}))}}}return r},e.column2ExpressionProp=function(e,t){for(var n in e.qDataPages){var i=e.qDataPages[n];for(var r in i.qMatrix){var o=i.qMatrix[r],s=o[t],a=o[0];a.qAttrExps||(a.qAttrExps={qValues:[]}),s.qNum||(s.qNum=NaN),a.qAttrExps.qValues.push(s)}}},e}()}),define("text!extensions.qliktech/mapchart/mapchart.ng.html",[],function(){return'<div class="qv-viz">\n    <div class="map-content">\n        <div class="webmap-div" tid="qv-object-mapchart"></div>\n        <div class="map-error-div"><div class="map-error-icon-div">&#x221E</div><div class="map-error-content-div"></div></div>\n        <div qva-zoom-pan-navigation style="top : 17px; right : 17px;"></div>\n    </div>\n    <div class="sidebar"></div>\n</div>\n'}),define("extensions.qliktech/mapchart/Map",["require","exports","./Properties","./MapChartApi","./MapChartView","./MapChartDropMenu","./LayoutMigrator","text!./mapchart.ng.html"],function(e,t,n,i,r,o,s){"use strict";return{View:r,definition:n,template:e("text!./mapchart.ng.html"),scope:null,BackendApi:i,initialProperties:{gaVersion:2,gaLayers:[],layers:[]},exportProperties:null,importProperties:null,support:{export:!0,exportData:!1,snapshot:!0,colorBy:!0},options:{usingDerivedProperties:!0},data:{dimensions:{min:0,max:0,obsolete:!0}},hasError:function(e){return!1},showRequirements:function(e){return!1},migrate:{properties:function(e){return e},snapshot:function(e){return s.migrateLayout(e),e}},getDropFieldOptions:function(e,t,n,i,r){new o(e,t,n,i,r)},getDropDimensionOptions:function(e,t,n,i,r){new o(e,t,n,i,r)},getDropMeasureOptions:function(e,t,n,i,r){new o(e,t,n,i,r)}}}),define("objects.backend-api/map-api",["./backend-api"],function(e){"use strict";return e.extend("MapApi",{init:function(e){this._super(e)},select:function(e,t,n,i){if(t)return this.model[e](t,n,i)},selectRange:function(e,t,n){if(!(this.path.indexOf("qHyperCubeDef")<0)){var i,r=this.path.replace("/geodata","");return t=!!t,n=n||[0],i=e.map(function(e){return{qMeasureIx:e.idx,qRange:{qMin:e.range.min,qMax:e.range.max,qMinInclEq:!1!==e.range.minInclEq,qMaxInclEq:!1!==e.range.maxInclEq}}}),this.model.rangeSelectHyperCubeValues(r,i,n,t)}},selectValues:function(e,t,n,i){return this.model.selectHyperCubeValues(i||this.path,e,t,n)},updateCache:function(){},setInitialData:function(){},getData:function(e,t){return this.model.getHyperCubeData(t,e)},evaluateExpression:function(e){return this.model.app.evaluateExpression(e)},clearSelections:function(){return this.model.resetMadeSelections()},hasSelections:function(){return this.model.layout.qSelectionInfo.qMadeSelections},beginSelections:function(){var e,t,n,i=this.model,r=[];for(e=0;e<i.layout.layers.length;++e)if(t="/layers/"+e+"/","polygon"===i.layout.layers[e].type)n=t+"geodata/",t+="qHyperCubeDef",n+="qHyperCubeDef",r.push(t),r.push(n);else{if(!i.layout.layers[e].qHyperCube)continue;t+="qHyperCubeDef",r.push(t)}return i.app.switchModalSelection(i,r)}})}),define("text!extensions.qliktech/map/map.ng.html",[],function(){return'<div class="qv-viz"></div>\n<div qva-zoom-pan-navigation></div>\n<div qva-chart-disclaimer attributes="dataAttributes" visible="true" direction="options.direction"></div>'}),define("text!client.services/media-tool/media-tool.ng.html",[],function(){return'<div class="qv-st-container">\n\t<form class="qv-st-form">\n\t\t<textarea class="qv-st-instance">{{data}}</textarea>\n\t</form>\n</div>'}),define("client.services/media-tool/theme",[],function(){return{palette:["#b0afae","#7b7a78","#545352","#4477aa","#7db8da","#b6d7ea","#46c646","#f93f17","#ffcf02","#276e27","#ffffff","#000000"],fontSizes:{1:"XS",2:"S",3:"M",4:"L",5:"XL"},fontSizesPx:{10:"1",13:"2",16:"3",22:"4",32:"5"},htmlSizeToMarkdownSize:{1:1,2:2,3:3,4:4,5:5,6:5},markdownSizeToHtmlSize:{1:1,2:2,3:3,4:4,5:5}}}),define("text!client.services/media-tool/toolbar.ng.html",[],function(){return'<lui-popover ng-if="options.style === \'popover\'" style="height: 44px;" align-to="alignTo" position="\'top\'" collision="\'collision\'" width="options.width" class="lui-popover qv-texttool-toolbar"\n\t\t\t\t\t  on-close-view="closeToolbar(event)" ondragstart="return false">\n\t<div qv-media-tool-buttons class="qv-texttool-toolbar"></div>\n</lui-popover>\n\n<div ng-if="options.style === \'inline\'" qv-media-tool-buttons class="qv-texttool-toolbar"></div>\n'}),define("client.services/media-tool/text-selection",[],function(){function e(){return window.getSelection()}var t={};return t.createRange=function(e,t,n){var i=document.createRange();return t=t||0,n=void 0===n?e.childNodes.length:n,i.setStart(e,t),i.setEnd(e,n),i},t.createRangeForElement=function(e){var t=document.createRange();return t.selectNode(e),t},t.addRange=function(t,n){var i=e();n&&i.removeAllRanges(),i.addRange(t)},t.getRange=function(t){var n=window.getSelection();return t=t||0,n.rangeCount>t?e().getRangeAt(t):null},t.rangeEquals=function(e,t){return null===e&&null===t||null!==e&&null!==t&&(0===e.compareBoundaryPoints(window.Range.START_TO_START,t)&&0===e.compareBoundaryPoints(window.Range.END_TO_END,t))},t}),define("text!client.services/media-tool/link-foldout/link-foldout.ng.html",[],function(){return'<immidiate-contextual width="400" align-to="options.alignTo" position="\'bottom\'" collision="\'flipfit\'" on-close-view="closeFoldout(event)"\n\t\t\t\t\t  class="qv-link-foldout qui-immidiateContextual" tid="link-foldout">\n\t<div qva-outside-ignore-for="media-toolbar">\n\t\t<div class="link-header">\n\t\t\t<h1 class="link-header-text" ng-if="linkActive" q-translation="MediaTool.Toolbar.InsertUrlLink.Title"></h1>\n\t\t\t<h1 class="link-header-text" ng-if="!linkActive" q-translation="Common.Bookmarks"></h1>\n\t\t\t<div class="link-submenu" ng-if="inStorytelling()">\n\t\t\t\t<ul>\n\t\t\t\t\t<li class="lui-button" ng-if="!linkActive" qva-activate="toggleLink(true)" q-translation="Common.URL" ></li>\n\t\t\t\t\t<li class="lui-button" ng-if="linkActive" qva-activate="toggleLink(false)" q-translation="Common.Bookmarks" ></li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="link-content" ng-if="linkActive">\n\t\t\t<span class="link-label" q-translation="MediaTool.Toolbar.InsertUrlLink.Label"></span>\n\t\t\t<input class="link-input lui-input" maxlength="255" ng-model="link.url" style="margin-bottom: 10px" qv-enter="onEnter($event)"/>\n\t\t\t<div class="link-remove-container" ng-if="showRemove">\n\t\t\t\t<button class="lui-button" qva-activate="removeLink($event)" q-title-translation="MediaTool.Toolbar.RemoveLink">\n\t\t\t\t\t<span class="lui-button__icon  lui-icon  lui-icon--bin"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="bookmark-content" ng-if="!linkActive">\n\t\t\t<ul>\n\t\t\t\t<li ng-if="bookmarks.length < 1" class="bookmark-link-row">\n\t\t\t\t\t<span class="bookmark-link-row-content no-bookmarks" q-translation="Bookmarks.NoBookmarks"></span>\n\t\t\t\t</li>\n\t\t\t\t<li class="bookmark-link-row" ng-repeat="bookmark in bookmarks" ng-class="{ active: bookmark.active}">\n\t\t\t\t\t<span class="bookmark-link-row-content" qva-activate="insertBookmark($event, bookmark.qInfo.qId)" data-bookmark-id="{{bookmark.qInfo.qId}}">{{bookmark.qData.title}}</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t</div>\n\x3c!--</div>--\x3e\n</immidiate-contextual>\n'}),define("client.services/media-tool/link-foldout/link-foldout",["jquery","text!./link-foldout.ng.html","client.utils/state","client.models/bookmark"],function(e,t,n,i){return{template:t,scope:{alignTo:"=",options:"="},controller:["$scope","$timeout","$element",function(t,r,o){function s(){i.getList().then(function(e){e.getLayout().then(function(e){t.bookmarks=e,a()})})}function a(){t.bookmarks.forEach(function(e){e.qInfo.qId===t.link.bookmark?e.active=!0:e.active=!1})}t.link=t.options.link,t.link.url&&"#"!==t.link.url||(t.link.url=""),t.link.url=decodeURIComponent(t.link.url);var l=t.link.url;t.alignTo=t.options.alignTo,t.linkActive=!0,t.closeFoldout=function(e){var n=encodeURI(t.link.url),i=t.link.$node;t.closed=!0,n!==l&&n&&n.length>0&&-1===n.indexOf("javascript:")?(0!==n.search("[a-zA-Z0-9]+:")&&(n="http://"+n),t.options.onSave(e,n,i,{cmd:"createLink",formatter:"link"})):t.options.onCancel(e)},t.onEnter=function(e){t.closeFoldout(e)},t.showRemove=!!l,t.removeLink=function(e){t.options.onRemove(e,t.link.$node)},t.inStorytelling=function(){return n.state===n.States.editstory},t.insertBookmark=function(e,n){t.options.onSave(e,n,t.link.$node,{cmd:"createLink",formatter:"bookmark"})},t.toggleLink=function(n){t.linkActive=n,n&&setTimeout(function(){e(".link-input").focus()})},t.exposedApi.closing=function(){t.closed||t.closeFoldout()},t.$on("$destroy",function(){t.closed||t.closeFoldout()}),!t.link.url&&t.link.bookmark?(t.toggleLink(!1),s()):t.toggleLink(!0),t.$watch("linkActive",function(){t.linkActive&&s()}),r(function(){o.find(".link-input").focus()})}]}}),define("general.utils/paths",["util"],function(e){var t={};return t.stripBasePath=function(t){return t=t.replace(e.baseURI,"").replace(/^\.\.\//i,"/"),t=t.replace(location.protocol+"//"+location.host,"")},t.addBasePath=function(t){return e.baseURI+".."+t},t.getUrl=function(e){return requirejs.toUrl(".."+e)},t}),define("general.models/media-library",["general.utils/paths"],function(e){"use strict";function t(e,t,n){var i={name:e,type:t};return n&&(i.path=n.qUrl,i.pathDef=n.qUrlDef),"folder"===t&&(i.children=[]),i}function n(e,n){var i=n;return(e=e.substring(1).split("/").reverse().slice(1).reverse()).forEach(function(e){var n=!1;if(i.children.forEach(function(t){if(t.name===e)return i=t,void(n=!0)}),!n){var r=t(e,"folder");i.children.push(r),i=r}}),i}function i(e){e.sort(function(e,t){return e.name.localeCompare(t.name)}).reverse(),e.sort(function(e,t){return"folder"===e.type&&"folder"!==t.type?-1:"folder"===e.type&&"folder"===t.type?e.name.localeCompare(t.name):"folder"!==e.type&&"folder"!==t.type?e.name.localeCompare(t.name):1}),e.forEach(function(e){void 0!==e.children&&i(e.children)})}var r={};return r.createTree=function(r,o,s){o=(o||[]).join("|")||".+?";var a=t("/","folder"),l=new RegExp("\\.("+o+")$","i");return r.forEach(function(i){var r,o=i,c=o.qUrl;if(c=e.stripBasePath(c),r=decodeURIComponent((c+"").replace(/\+/g,"%20")),(r=r.split("/").splice(-1)[0]).match(l)){var u=a;s||(u=n(decodeURIComponent(c).replace(/^(\/content\/default)|(\/content\/Default)/,"").replace(/^(^\/media\/([a-z0-9-])+\/([a-z0-9-])+\/)/,"/media/"),a)),u.children.push(t(r,"file",o))}}),i(a.children),a},r.filterList=function(e){var t,n,i=[],o=e.sort(function(e,t){var n=e.qName.toLowerCase(),i=t.qName.toLowerCase();return n.localeCompare(i)});for(t=0;t<e.length;t++)if((n=e[t]).qAppSpecific){i.push(n),n.qMeta&&-1!==n.qMeta.privileges.indexOf("update")&&(r.canUpdate=!0);break}for(t=0;t<o.length;t++)(n=e[t]).qAppSpecific||i.push(n);return i},r.getRemainingSpace=function(e){for(var t=0,n=0;n<e.length;n++)if(e[n].qAppSpecific){t=parseInt(e[n].qMeta.remainingLibrarySpace||0,10);break}return t},r}),define("text!general.components/media-library/media-library.ng.html",[],function(){return'<lui-dialog id="media-library-modal" tid="media-library" qv-cancel="cancel($event)" qv-confirm="confirm()" qva-outside-ignore-for="allOutside" qva-stop-prop>\n\t<lui-dialog-header>\n\t\t<lui-dialog-title q-translation="MediaLibrary.Header"></lui-dialog-title>\n\t</lui-dialog-header>\n\t<lui-dialog-body class="dialog-body  medialib  lui-nopad">\n\t\t<div class="q-section-list" ng-if="lists.length">\n\t\t\t<ul class="side-menu lui-list" tid="menu-list">\n\t\t\t\t<li ng-repeat="list in lists track by list.qName"\n\t\t\t\t\tclass="side-menu-item  lui-list__item"\n\t\t\t\t\tng-class="{\'selected\': !isUpload && view === list.qName}"\n\t\t\t\t\tng-click="goTo(list.qName, false)">\n\t\t\t\t\t<span class="lui-list__text  lui-list__text--ellipsis" ng-if="list.qAppSpecific" q-translation="MediaLibrary.InApp" tid="goto-inapp"></span>\n\t\t\t\t\t<span class="lui-list__text  lui-list__text--ellipsis" ng-if="!list.qAppSpecific" tid="goto-library">{{ list.qName }}</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t\t<ul ng-if="canUpdate" class="q-section-upload  upload-menu lui-list">\n\t\t\t\t<li class="upload-menu-item  lui-list__item"\n\t\t\t\t\tng-class="{\'selected\': isUpload}"\n\t\t\t\t\ttid="goto-upload"\n\t\t\t\t\tng-click="goTo(\'\', true)">\n\t\t\t\t\t<div class="q-section-upload-text  lui-list__text  lui-list__text--ellipsis" q-translation="MediaLibrary.UploadMedia"></div>\n\t\t\t\t\t<div class="qv-loader  lui-list__text" ng-if="updateExp.isUploading"></div>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t\t<div class="q-empty" ng-if="state === contentState.isEmpty && !isUpload">\n\t\t\t<p q-translation="MediaLibrary.NoFilesFound" class="nff"></p>\n\t\t</div>\n\t\t<qve-media-list ng-if="state === contentState.hasFiles && !isUpload" ng-class="{\'q-image-library\': !isUpload}" class="q-images-cont" tid="media-lib-items-list"></qve-media-list>\n\t\t<div class="q-media-preview" ng-if="selectedFile && !isUpload">\n\t\t\t<div class="q-media-preview-toolbar" ng-if="canDeleteInView()">\n\t\t\t\t<button\n\t\t\t\t\tclass="lui-overlay-button"\n\t\t\t\t\ttid="delete"\n\t\t\t\t\tdata-name="delete"\n\t\t\t\t\tq-title-translation="Common.Delete"\n\t\t\t\t\tng-click="onDelete($event)">\n\t\t\t\t\t<span class="lui-overlay-button__icon  lui-icon  lui-icon--bin"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div class="q-media-preview-img-wrapper">\n\t\t\t\t<img ng-src="{{ getSrc(selectedFile) }}" class="q-media-img-list"/>\n\t\t\t</div>\n\t\t\t<div class="q-media-preview-bottom-toolbar">\n\t\t\t\t<button class="lui-button q-media-insbtn"\n\t\t\t\t\t\ttid="insert"\n\t\t\t\t\t\tdata-name="insert"\n\t\t\t\t\t\tq-translation="MediaLibrary.Insert"\n\t\t\t\t\t\tq-title-translation="MediaLibrary.Insert"\n\t\t\t\t\t\tng-click="confirm()">\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="q-images-cont" ng-if="canUpdate" ng-show="isUpload">\n\t\t\t<qv-media-update update-exp="updateExp" select-file="selectFile" selected-file="selectedFile" confirm="confirm"></qv-media-update>\n\t\t</div>\n\t</lui-dialog-body>\n\t<div class="q-media-zoomed" ng-if="inZoom">\n\t\t<div class="q-media-z-wrapper">\n\t\t\t<div class="q-media-z-cont">\n\t\t\t\t<img class="q-media-z-img" ng-src="{{ getSrc(zoomSrc) }}">\n\t\t\t</div>\n\n\t\t\t<div class="q-media-zoom-footer">\n\t\t\t\t<qv-confirm-cancel-footer light qv-confirm="confirm()" qv-cancel="closeZoom()" qv-confirm-label="Common.Apply" qv-confirm-disabled="updateExp.isUploading"></qv-confirm-cancel-footer>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<lui-dialog-footer data-tid="media-library-footer">\n\t\t<lui-button ng-click="cancel($event)" q-translation="Common.Close" tid="cancel" ng-disabled="updateExp.isUploading"></lui-button>\n\t</lui-dialog-footer>\n</lui-dialog>\n'}),define("text!general.components/media-library/media-library-list.ng.html",[],function(){return'<div>\n\t\x3c!--\n\t\t<img ng-src="{{staticSrc}}" class="q-media-img" width="100%" height="100%"/>\n\t--\x3e\n\t<ul class="q-media-list-cont  lui-list" qva-context-menu="onContextMenu($event)">\n\t\t<li ng-repeat="entry in rootEntry.children"\n\t\t\t\tclass="media-list-cont-item  lui-list__item"\n\t\t\t ng-class="{\'selected\': isSelectedImg(entry, $last, \'.selected\')}"\n\t\t\t tid="media-item" title="{{entry.name}}"\n\t\t\t ng-click="selectFile($event, entry.path, entry.pathDef)">\n\t\t\t<span class="list-name  lui-list__text  lui-list__text--ellipsis">{{entry.name}}</span>\n\t\t</li>\n\t</ul>\n</div>'}),define("general.views/bouncy-grid/bouncy-grid",["jquery","qvangular","core.utils/resize"],function(e,t,n){function i(e){return parseInt(e||0,10)}t.directive("qvBouncyGrid",[function(){return{restrict:"E",template:'<div class="qv-bouncy" ng-transclude></div>',transclude:!0,replace:!0,scope:{minWidth:"@",maxWidth:"@",padding:"@",selector:"@",listLen:"="},controller:["$scope","$element",function(t,r){function o(e){clearTimeout(a),a=setTimeout(s,e||50)}function s(){var e,n,s,a,d=i(t.padding);h?(e=h,n=Math.ceil(r.width()/e),s=Math.floor(r.width()/n),a=(n>t.listLen?e:s)-d+"px!important;"):(e=u,n=Math.floor(r.width()/e),s=Math.ceil(r.width()/n),a=(n>t.listLen?e:s)-d+"px!important;"),isNaN(s-d)&&c<20?(c++,o()):l&&l.length&&l.text(t.selector+" { width: "+a+"height: "+a+"}")}var a,l=e("<style></style>").appendTo("body"),c=0,u=i(t.minWidth),h=i(t.maxWidth);n.on("end",o),o(0),t.$watch("listLen",o),t.$on("$destroy",function(){clearTimeout(a),l&&l.remove(),a=null,l=null,n.off("end",o)})}]}}])}),define("text!general.components/media-library/update/media-update.ng.html",[],function(){return'<div id="media-library-upload">\n\t<div class="bouncy-wrap" ng-class="{\'empty\' : isEmpty}">\n\t\t<qv-bouncy-grid min-width="140" padding="15" selector=".preview-media-grid" list-len="previewCounter">\n\t\t\t<div class="media-library-preview-container" ng-hide="isEmpty"></div>\n\t\t</qv-bouncy-grid>\n\t</div>\n\t<div id="media-library-dropzone" class="dropzone" ng-class="{\'empty\' : isEmpty}">\n\t\t<div class="dz-message">\n\t\t\t<div class="upload-drop-text" q-translation="MediaLibrary.ClickOrDropHere"></div>\n\t\t\t<div class="upload-drop-icon-wrap">\n\t\t\t\t<i class="lui-icon lui-icon--upload"></i>\n\t\t\t</div>\n\t\t\t<div class="upload-drop-quota">{{quotaInfo}}</div>\n\t\t</div>\n\t</div>\n</div>\n'}),define("text!general.components/media-library/update/preview-item.ng.html",[],function(){return'<div tid="preview-item"\n\t class="q-media-grid preview-media-grid"\n\t ng-class="{\'selected-img\': selectedFile === file.qUrl}"\n\t ng-click="onSelectImage( $event, file )"\n\t qva-context-menu="onContextMenu( $event, file, file.name, file.qUrl )">\n\t<div class="q-media-wrap-img">\n\t\t<img class="q-media-img" width="100%" height="100%" data-dz-thumbnail />\n\t\t<div class="overlay"></div>\n\t\t<div class="preview-area">\n\t\t\t<div class="touch-area cancel-upload-area" q-title-translation="Common.Cancel" data-dz-remove ng-click="onCancelUpload( $event, file )">\n\t\t\t\t<button class="lui-overlay-button lui-overlay-button--small cancel-upload">\n\t\t\t\t\t<span class="lui-overlay-button__icon lui-icon lui-icon--small lui-icon--close"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<div ng-if="selectedFile === file.qUrl" class="preview-area-edit">\n\t\t\t\t<div class="touch-area delete-image-area" q-title-translation="Common.Delete" ng-click="onDelete( $event, file, file.name, file.qUrl )">\n\t\t\t\t\t<button class="lui-overlay-button lui-overlay-button--small delete-image">\n\t\t\t\t\t\t<span class="lui-overlay-button__icon lui-icon lui-icon--small lui-icon--bin"></span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<button\n\t\t\t\t\ttid="insert"\n\t\t\t\t\tclass="insert-button lui-overlay-button"\n\t\t\t\t\tdata-name="insert"\n\t\t\t\t\tq-title-translation="MediaLibrary.Insert"\n\t\t\t\t\tng-click="onInsert( $event )">\n\t\t\t\t\t<span class="lui-overlay-button__icon  lui-icon  lui-icon--add-section"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="error-wrapper" ng-if="showError">\n\t\t\t<div class="error-icon">\n\t\t\t\t<i class="lui-icon lui-icon--warning-triangle"></i>\n\t\t\t</div>\n\t\t\t<div class="error-text">{{errorMsg}}</div>\n\t\t</div>\n\t\t<div class="preview-progress">\n\t\t\t<div class="preview-progressbar-wrapper">\n\t\t\t\t<span class="preview-progressbar" data-dz-uploadprogress></span>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class="q-media-name" q-title-translation="{{file.name}}">{{file.name}}</div>\n</div>\n'}),function(){var e,t,n,i,r,o,s,a,l=[].slice,c={}.hasOwnProperty,u=function(e,t){function n(){this.constructor=e}for(var i in t)c.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};s=function(){},t=function(){function e(){}return e.prototype.addEventListener=e.prototype.on,e.prototype.on=function(e,t){return this._callbacks=this._callbacks||{},this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t),this},e.prototype.emit=function(){var e,t,n,i,r;if(n=arguments[0],e=2<=arguments.length?l.call(arguments,1):[],this._callbacks=this._callbacks||{},t=this._callbacks[n])for(i=0,r=t.length;i<r;i++)t[i].apply(this,e);return this},e.prototype.removeListener=e.prototype.off,e.prototype.removeAllListeners=e.prototype.off,e.prototype.removeEventListener=e.prototype.off,e.prototype.off=function(e,t){var n,i,r,o;if(!this._callbacks||0===arguments.length)return this._callbacks={},this;if(!(n=this._callbacks[e]))return this;if(1===arguments.length)return delete this._callbacks[e],this;for(i=r=0,o=n.length;r<o;i=++r)if(n[i]===t){n.splice(i,1);break}return this},e}(),(e=function(e){function n(e,t){var r,o,s;if(this.element=e,this.version=n.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");if(n.instances.push(this),this.element.dropzone=this,r=null!=(s=n.optionsForElement(this.element))?s:{},this.options=i({},this.defaultOptions,r,null!=t?t:{}),this.options.forceFallback||!n.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.method=this.options.method.toUpperCase(),(o=this.getExistingFallback())&&o.parentNode&&o.parentNode.removeChild(o),!1!==this.options.previewsContainer&&(this.options.previewsContainer?this.previewsContainer=n.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.clickable&&(!0===this.options.clickable?this.clickableElements=[this.element]:this.clickableElements=n.getElements(this.options.clickable,"clickable")),this.init()}var i,r;return u(n,t),n.prototype.Emitter=t,n.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],n.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,filesizeBase:1e3,maxFiles:null,filesizeBase:1e3,params:{},clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,capture:null,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",accept:function(e,t){return t()},init:function(){return s},forceFallback:!1,fallback:function(){var e,t,i,r,o,s;for(this.element.className=this.element.className+" dz-browser-not-supported",r=0,o=(s=this.element.getElementsByTagName("div")).length;r<o;r++)e=s[r],/(^| )dz-message($| )/.test(e.className)&&(t=e,e.className="dz-message");return t||(t=n.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(t)),(i=t.getElementsByTagName("span")[0])&&(i.textContent=this.options.dictFallbackMessage),this.element.appendChild(this.getFallbackForm())},resize:function(e){var t,n,i;return t={srcX:0,srcY:0,srcWidth:e.width,srcHeight:e.height},n=e.width/e.height,t.optWidth=this.options.thumbnailWidth,t.optHeight=this.options.thumbnailHeight,null==t.optWidth&&null==t.optHeight?(t.optWidth=t.srcWidth,t.optHeight=t.srcHeight):null==t.optWidth?t.optWidth=n*t.optHeight:null==t.optHeight&&(t.optHeight=1/n*t.optWidth),i=t.optWidth/t.optHeight,e.height<t.optHeight||e.width<t.optWidth?(t.trgHeight=t.srcHeight,t.trgWidth=t.srcWidth):n>i?(t.srcHeight=e.height,t.srcWidth=t.srcHeight*i):(t.srcWidth=e.width,t.srcHeight=t.srcWidth/i),t.srcX=(e.width-t.srcWidth)/2,t.srcY=(e.height-t.srcHeight)/2,t},drop:function(e){return this.element.classList.remove("dz-drag-hover")},dragstart:s,dragend:function(e){return this.element.classList.remove("dz-drag-hover")},dragenter:function(e){return this.element.classList.add("dz-drag-hover")},dragover:function(e){return this.element.classList.add("dz-drag-hover")},dragleave:function(e){return this.element.classList.remove("dz-drag-hover")},paste:s,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(e){var t,i,r,o,s,a,l,c,u,h,d,p;if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer){for(e.previewElement=n.createElement(this.options.previewTemplate.trim()),e.previewTemplate=e.previewElement,this.previewsContainer.appendChild(e.previewElement),r=0,a=(u=e.previewElement.querySelectorAll("[data-dz-name]")).length;r<a;r++)u[r].textContent=e.name;for(o=0,l=(h=e.previewElement.querySelectorAll("[data-dz-size]")).length;o<l;o++)h[o].innerHTML=this.filesize(e.size);for(this.options.addRemoveLinks&&(e._removeLink=n.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>"),e.previewElement.appendChild(e._removeLink)),t=function(t){return function(i){return i.preventDefault(),i.stopPropagation(),e.status===n.UPLOADING?n.confirm(t.options.dictCancelUploadConfirmation,function(){return t.removeFile(e)}):t.options.dictRemoveFileConfirmation?n.confirm(t.options.dictRemoveFileConfirmation,function(){return t.removeFile(e)}):t.removeFile(e)}}(this),p=[],s=0,c=(d=e.previewElement.querySelectorAll("[data-dz-remove]")).length;s<c;s++)i=d[s],p.push(i.addEventListener("click",t));return p}},removedfile:function(e){var t;return e.previewElement&&null!=(t=e.previewElement)&&t.parentNode.removeChild(e.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(e,t){var n,i,r,o;if(e.previewElement){for(e.previewElement.classList.remove("dz-file-preview"),i=0,r=(o=e.previewElement.querySelectorAll("[data-dz-thumbnail]")).length;i<r;i++)(n=o[i]).alt=e.name,n.src=t;return setTimeout(function(){return e.previewElement.classList.add("dz-image-preview")},1)}},error:function(e,t){var n,i,r,o,s;if(e.previewElement){for(e.previewElement.classList.add("dz-error"),"String"!=typeof t&&t.error&&(t=t.error),s=[],i=0,r=(o=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;i<r;i++)n=o[i],s.push(n.textContent=t);return s}},errormultiple:s,processing:function(e){if(e.previewElement&&(e.previewElement.classList.add("dz-processing"),e._removeLink))return e._removeLink.textContent=this.options.dictCancelUpload},processingmultiple:s,uploadprogress:function(e,t,n){var i,r,o,s,a;if(e.previewElement){for(a=[],r=0,o=(s=e.previewElement.querySelectorAll("[data-dz-uploadprogress]")).length;r<o;r++)"PROGRESS"===(i=s[r]).nodeName?a.push(i.value=t):a.push(i.style.width=t+"%");return a}},totaluploadprogress:s,sending:s,sendingmultiple:s,success:function(e){if(e.previewElement)return e.previewElement.classList.add("dz-success")},successmultiple:s,canceled:function(e){return this.emit("error",e,"Upload canceled.")},canceledmultiple:s,complete:function(e){if(e._removeLink&&(e._removeLink.textContent=this.options.dictRemoveFile),e.previewElement)return e.previewElement.classList.add("dz-complete")},completemultiple:s,maxfilesexceeded:s,maxfilesreached:s,queuecomplete:s,previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail /></div>\n  <div class="dz-details">\n    <div class="dz-size"><span data-dz-size></span></div>\n    <div class="dz-filename"><span data-dz-name></span></div>\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n  <div class="dz-success-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Check</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="dz-error-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Error</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <g id="Check-+-Oval-2" sketch:type="MSLayerGroup" stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475">\n          <path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" sketch:type="MSShapeGroup"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>'},i=function(){var e,t,n,i,r,o,s;for(i=arguments[0],o=0,s=(n=2<=arguments.length?l.call(arguments,1):[]).length;o<s;o++){t=n[o];for(e in t)r=t[e],i[e]=r}return i},n.prototype.getAcceptedFiles=function(){var e,t,n,i,r;for(r=[],t=0,n=(i=this.files).length;t<n;t++)(e=i[t]).accepted&&r.push(e);return r},n.prototype.getRejectedFiles=function(){var e,t,n,i,r;for(r=[],t=0,n=(i=this.files).length;t<n;t++)(e=i[t]).accepted||r.push(e);return r},n.prototype.getFilesWithStatus=function(e){var t,n,i,r,o;for(o=[],n=0,i=(r=this.files).length;n<i;n++)(t=r[n]).status===e&&o.push(t);return o},n.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(n.QUEUED)},n.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(n.UPLOADING)},n.prototype.getActiveFiles=function(){var e,t,i,r,o;for(o=[],t=0,i=(r=this.files).length;t<i;t++)(e=r[t]).status!==n.UPLOADING&&e.status!==n.QUEUED||o.push(e);return o},n.prototype.init=function(){var e,t,i,r,o,s,a;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(n.createElement('<div class="dz-default dz-message"><span>'+this.options.dictDefaultMessage+"</span></div>")),this.clickableElements.length&&(i=function(e){return function(){return e.hiddenFileInput&&document.body.removeChild(e.hiddenFileInput),e.hiddenFileInput=document.createElement("input"),e.hiddenFileInput.setAttribute("type","file"),(null==e.options.maxFiles||e.options.maxFiles>1)&&e.hiddenFileInput.setAttribute("multiple","multiple"),e.hiddenFileInput.className="dz-hidden-input",null!=e.options.acceptedFiles&&e.hiddenFileInput.setAttribute("accept",e.options.acceptedFiles),null!=e.options.capture&&e.hiddenFileInput.setAttribute("capture",e.options.capture),e.hiddenFileInput.style.visibility="hidden",e.hiddenFileInput.style.position="absolute",e.hiddenFileInput.style.top="0",e.hiddenFileInput.style.left="0",e.hiddenFileInput.style.height="0",e.hiddenFileInput.style.width="0",document.body.appendChild(e.hiddenFileInput),e.hiddenFileInput.addEventListener("change",function(){var t,n,r,o;if((n=e.hiddenFileInput.files).length)for(r=0,o=n.length;r<o;r++)t=n[r],e.addFile(t);return i()})}}(this))(),this.URL=null!=(s=window.URL)?s:window.webkitURL,r=0,o=(a=this.events).length;r<o;r++)e=a[r],this.on(e,this.options[e]);return this.on("uploadprogress",function(e){return function(){return e.updateTotalUploadProgress()}}(this)),this.on("removedfile",function(e){return function(){return e.updateTotalUploadProgress()}}(this)),this.on("canceled",function(e){return function(t){return e.emit("complete",t)}}(this)),this.on("complete",function(e){return function(t){if(0===e.getUploadingFiles().length&&0===e.getQueuedFiles().length)return setTimeout(function(){return e.emit("queuecomplete")},0)}}(this)),t=function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(e){return function(t){return e.emit("dragstart",t)}}(this),dragenter:function(e){return function(n){return t(n),e.emit("dragenter",n)}}(this),dragover:function(e){return function(n){var i;try{i=n.dataTransfer.effectAllowed}catch(e){}return n.dataTransfer.dropEffect="move"===i||"linkMove"===i?"move":"copy",t(n),e.emit("dragover",n)}}(this),dragleave:function(e){return function(t){return e.emit("dragleave",t)}}(this),drop:function(e){return function(n){return t(n),e.drop(n)}}(this),dragend:function(e){return function(t){return e.emit("dragend",t)}}(this)}}],this.clickableElements.forEach(function(e){return function(t){return e.listeners.push({element:t,events:{click:function(i){if(t!==e.element||i.target===e.element||n.elementInside(i.target,e.element.querySelector(".dz-message")))return e.hiddenFileInput.click()}}})}}(this)),this.enable(),this.options.init.call(this)},n.prototype.destroy=function(){var e;return this.disable(),this.removeAllFiles(!0),(null!=(e=this.hiddenFileInput)?e.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,n.instances.splice(n.instances.indexOf(this),1)},n.prototype.updateTotalUploadProgress=function(){var e,t,n,i,r,o,s;if(n=0,t=0,this.getActiveFiles().length){for(r=0,o=(s=this.getActiveFiles()).length;r<o;r++)n+=(e=s[r]).upload.bytesSent,t+=e.upload.total;i=100*n/t}else i=100;return this.emit("totaluploadprogress",i,t,n)},n.prototype._getParamName=function(e){return"function"==typeof this.options.paramName?this.options.paramName(e):this.options.paramName+(this.options.uploadMultiple?"["+e+"]":"")},n.prototype.getFallbackForm=function(){var e,t,i,r;return(e=this.getExistingFallback())?e:(i='<div class="dz-fallback">',this.options.dictFallbackText&&(i+="<p>"+this.options.dictFallbackText+"</p>"),i+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',t=n.createElement(i),"FORM"!==this.element.tagName?(r=n.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>')).appendChild(t):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=r?r:t)},n.prototype.getExistingFallback=function(){var e,t,n,i,r,o;for(t=function(e){var t,n,i;for(n=0,i=e.length;n<i;n++)if(t=e[n],/(^| )fallback($| )/.test(t.className))return t},i=0,r=(o=["div","form"]).length;i<r;i++)if(n=o[i],e=t(this.element.getElementsByTagName(n)))return e},n.prototype.setupEventListeners=function(){var e,t,n,i,r,o,s;for(s=[],i=0,r=(o=this.listeners).length;i<r;i++)e=o[i],s.push(function(){var i,r;i=e.events,r=[];for(t in i)n=i[t],r.push(e.element.addEventListener(t,n,!1));return r}());return s},n.prototype.removeEventListeners=function(){var e,t,n,i,r,o,s;for(s=[],i=0,r=(o=this.listeners).length;i<r;i++)e=o[i],s.push(function(){var i,r;i=e.events,r=[];for(t in i)n=i[t],r.push(e.element.removeEventListener(t,n,!1));return r}());return s},n.prototype.disable=function(){var e,t,n,i,r;for(this.clickableElements.forEach(function(e){return e.classList.remove("dz-clickable")}),this.removeEventListeners(),r=[],t=0,n=(i=this.files).length;t<n;t++)e=i[t],r.push(this.cancelUpload(e));return r},n.prototype.enable=function(){return this.clickableElements.forEach(function(e){return e.classList.add("dz-clickable")}),this.setupEventListeners()},n.prototype.filesize=function(e){var t,n,i,r,o,s,a,l;for(i=r=null,n=a=0,l=(s=["TB","GB","MB","KB","b"]).length;a<l;n=++a)if(o=s[n],t=Math.pow(this.options.filesizeBase,4-n)/10,e>=t){i=e/Math.pow(this.options.filesizeBase,4-n),r=o;break}return"<strong>"+(i=Math.round(10*i)/10)+"</strong> "+r},n.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")},n.prototype.drop=function(e){var t,n;e.dataTransfer&&(this.emit("drop",e),(t=e.dataTransfer.files).length&&((n=e.dataTransfer.items)&&n.length&&null!=n[0].webkitGetAsEntry?this._addFilesFromItems(n):this.handleFiles(t)))},n.prototype.paste=function(e){var t,n;if(null!=(null!=e&&null!=(n=e.clipboardData)?n.items:void 0))return this.emit("paste",e),(t=e.clipboardData.items).length?this._addFilesFromItems(t):void 0},n.prototype.handleFiles=function(e){var t,n,i,r;for(r=[],n=0,i=e.length;n<i;n++)t=e[n],r.push(this.addFile(t));return r},n.prototype._addFilesFromItems=function(e){var t,n,i,r,o;for(o=[],i=0,r=e.length;i<r;i++)null!=(n=e[i]).webkitGetAsEntry&&(t=n.webkitGetAsEntry())?t.isFile?o.push(this.addFile(n.getAsFile())):t.isDirectory?o.push(this._addFilesFromDirectory(t,t.name)):o.push(void 0):null!=n.getAsFile&&(null==n.kind||"file"===n.kind)?o.push(this.addFile(n.getAsFile())):o.push(void 0);return o},n.prototype._addFilesFromDirectory=function(e,t){var n,i;return n=e.createReader(),i=function(e){return function(n){var i,r,o;for(r=0,o=n.length;r<o;r++)(i=n[r]).isFile?i.file(function(n){if(!e.options.ignoreHiddenFiles||"."!==n.name.substring(0,1))return n.fullPath=t+"/"+n.name,e.addFile(n)}):i.isDirectory&&e._addFilesFromDirectory(i,t+"/"+i.name)}}(this),n.readEntries(i,function(e){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(e):void 0})},n.prototype.accept=function(e,t){return e.size>1024*this.options.maxFilesize*1024?t(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(e.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):n.isValidFile(e,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(t(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",e)):this.options.accept.call(this,e,t):t(this.options.dictInvalidFileType)},n.prototype.addFile=function(e){return e.upload={progress:0,total:e.size,bytesSent:0},this.files.push(e),e.status=n.ADDED,this.emit("addedfile",e),this._enqueueThumbnail(e),this.accept(e,function(t){return function(n){return n?(e.accepted=!1,t._errorProcessing([e],n)):(e.accepted=!0,t.options.autoQueue&&t.enqueueFile(e)),t._updateMaxFilesReachedClass()}}(this))},n.prototype.enqueueFiles=function(e){var t,n,i;for(n=0,i=e.length;n<i;n++)t=e[n],this.enqueueFile(t);return null},n.prototype.enqueueFile=function(e){if(e.status!==n.ADDED||!0!==e.accepted)throw new Error("This file can't be queued because it has already been processed or was rejected.");if(e.status=n.QUEUED,this.options.autoProcessQueue)return setTimeout(function(e){return function(){return e.processQueue()}}(this),0)},n.prototype._thumbnailQueue=[],n.prototype._processingThumbnail=!1,n.prototype._enqueueThumbnail=function(e){if(this.options.createImageThumbnails&&e.type.match(/image.*/)&&e.size<=1024*this.options.maxThumbnailFilesize*1024)return this._thumbnailQueue.push(e),setTimeout(function(e){return function(){return e._processThumbnailQueue()}}(this),0)},n.prototype._processThumbnailQueue=function(){if(!this._processingThumbnail&&0!==this._thumbnailQueue.length)return this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),function(e){return function(){return e._processingThumbnail=!1,e._processThumbnailQueue()}}(this))},n.prototype.removeFile=function(e){if(e.status===n.UPLOADING&&this.cancelUpload(e),this.files=a(this.files,e),this.emit("removedfile",e),0===this.files.length)return this.emit("reset")},n.prototype.removeAllFiles=function(e){var t,i,r,o;for(null==e&&(e=!1),i=0,r=(o=this.files.slice()).length;i<r;i++)((t=o[i]).status!==n.UPLOADING||e)&&this.removeFile(t);return null},n.prototype.createThumbnail=function(e,t){var n;return n=new FileReader,n.onload=function(i){return function(){return"image/svg+xml"===e.type?(i.emit("thumbnail",e,n.result),void(null!=t&&t())):i.createThumbnailFromUrl(e,n.result,t)}}(this),n.readAsDataURL(e)},n.prototype.createThumbnailFromUrl=function(e,t,n){var i;return i=document.createElement("img"),i.onload=function(t){return function(){var r,s,a,l,c,u,h,d;if(e.width=i.width,e.height=i.height,null==(a=t.options.resize.call(t,e)).trgWidth&&(a.trgWidth=a.optWidth),null==a.trgHeight&&(a.trgHeight=a.optHeight),r=document.createElement("canvas"),s=r.getContext("2d"),r.width=a.trgWidth,r.height=a.trgHeight,o(s,i,null!=(c=a.srcX)?c:0,null!=(u=a.srcY)?u:0,a.srcWidth,a.srcHeight,null!=(h=a.trgX)?h:0,null!=(d=a.trgY)?d:0,a.trgWidth,a.trgHeight),l=r.toDataURL("image/png"),t.emit("thumbnail",e,l),null!=n)return n()}}(this),null!=n&&(i.onerror=n),i.src=t},n.prototype.processQueue=function(){var e,t,n,i;if(t=this.options.parallelUploads,n=this.getUploadingFiles().length,e=n,!(n>=t)&&(i=this.getQueuedFiles()).length>0){if(this.options.uploadMultiple)return this.processFiles(i.slice(0,t-n));for(;e<t;){if(!i.length)return;this.processFile(i.shift()),e++}}},n.prototype.processFile=function(e){return this.processFiles([e])},n.prototype.processFiles=function(e){var t,i,r;for(i=0,r=e.length;i<r;i++)(t=e[i]).processing=!0,t.status=n.UPLOADING,this.emit("processing",t);return this.options.uploadMultiple&&this.emit("processingmultiple",e),this.uploadFiles(e)},n.prototype._getFilesWithXhr=function(e){var t;return function(){var n,i,r,o;for(o=[],n=0,i=(r=this.files).length;n<i;n++)(t=r[n]).xhr===e&&o.push(t);return o}.call(this)},n.prototype.cancelUpload=function(e){var t,i,r,o,s,a,l;if(e.status===n.UPLOADING){for(r=0,s=(i=this._getFilesWithXhr(e.xhr)).length;r<s;r++)(t=i[r]).status=n.CANCELED;for(e.xhr.abort(),o=0,a=i.length;o<a;o++)t=i[o],this.emit("canceled",t);this.options.uploadMultiple&&this.emit("canceledmultiple",i)}else(l=e.status)!==n.ADDED&&l!==n.QUEUED||(e.status=n.CANCELED,this.emit("canceled",e),this.options.uploadMultiple&&this.emit("canceledmultiple",[e]));if(this.options.autoProcessQueue)return this.processQueue()},r=function(){var e,t;return t=arguments[0],e=2<=arguments.length?l.call(arguments,1):[],"function"==typeof t?t.apply(this,e):t},n.prototype.uploadFile=function(e){return this.uploadFiles([e])},n.prototype.uploadFiles=function(e){var t,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,x,q,C,S,w,_,D,M,A,E,I,T,L,k,O,P,N;for(q=new XMLHttpRequest,C=0,D=e.length;C<D;C++)(t=e[C]).xhr=q;m=r(this.options.method,e),b=r(this.options.url,e),q.open(m,b,!0),q.withCredentials=!!this.options.withCredentials,v=null,s=function(n){return function(){var i,r,o;for(o=[],i=0,r=e.length;i<r;i++)t=e[i],o.push(n._errorProcessing(e,v||n.options.dictResponseError.replace("{{statusCode}}",q.status),q));return o}}(this),y=function(n){return function(i){var r,o,s,a,l,c,u,h,d;if(null!=i)for(o=100*i.loaded/i.total,s=0,c=e.length;s<c;s++)(t=e[s]).upload={progress:o,total:i.total,bytesSent:i.loaded};else{for(r=!0,o=100,a=0,u=e.length;a<u;a++)100===(t=e[a]).upload.progress&&t.upload.bytesSent===t.upload.total||(r=!1),t.upload.progress=o,t.upload.bytesSent=t.upload.total;if(r)return}for(d=[],l=0,h=e.length;l<h;l++)t=e[l],d.push(n.emit("uploadprogress",t,o,t.upload.bytesSent));return d}}(this),q.onload=function(t){return function(i){var r;if(e[0].status!==n.CANCELED&&4===q.readyState){if(v=q.responseText,q.getResponseHeader("content-type")&&~q.getResponseHeader("content-type").indexOf("application/json"))try{v=JSON.parse(v)}catch(e){i=e,v="Invalid JSON response from server."}return y(),200<=(r=q.status)&&r<300?t._finished(e,v,i):s()}}}(this),q.onerror=function(){if(e[0].status!==n.CANCELED)return s()},(null!=(T=q.upload)?T:q).onprogress=y,c={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&i(c,this.options.headers);for(a in c)l=c[a],q.setRequestHeader(a,l);if(o=new FormData,this.options.params){L=this.options.params;for(f in L)x=L[f],o.append(f,x)}for(S=0,M=e.length;S<M;S++)t=e[S],this.emit("sending",t,q,o);if(this.options.uploadMultiple&&this.emit("sendingmultiple",e,q,o),"FORM"===this.element.tagName)for(w=0,A=(k=this.element.querySelectorAll("input, textarea, select, button")).length;w<A;w++)if(h=k[w],d=h.getAttribute("name"),p=h.getAttribute("type"),"SELECT"===h.tagName&&h.hasAttribute("multiple"))for(_=0,E=(O=h.options).length;_<E;_++)(g=O[_]).selected&&o.append(d,g.value);else(!p||"checkbox"!==(P=p.toLowerCase())&&"radio"!==P||h.checked)&&o.append(d,h.value);for(u=I=0,N=e.length-1;0<=N?I<=N:I>=N;u=0<=N?++I:--I)o.append(this._getParamName(u),e[u],e[u].name);return q.send(o)},n.prototype._finished=function(e,t,i){var r,o,s;for(o=0,s=e.length;o<s;o++)(r=e[o]).status=n.SUCCESS,this.emit("success",r,t,i),this.emit("complete",r);if(this.options.uploadMultiple&&(this.emit("successmultiple",e,t,i),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()},n.prototype._errorProcessing=function(e,t,i){var r,o,s;for(o=0,s=e.length;o<s;o++)(r=e[o]).status=n.ERROR,this.emit("error",r,t,i),this.emit("complete",r);if(this.options.uploadMultiple&&(this.emit("errormultiple",e,t,i),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()},n}()).version="4.0.1",e.options={},e.optionsForElement=function(t){return t.getAttribute("id")?e.options[n(t.getAttribute("id"))]:void 0},e.instances=[],e.forElement=function(e){if("string"==typeof e&&(e=document.querySelector(e)),null==(null!=e?e.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return e.dropzone},e.autoDiscover=!0,e.discover=function(){var t,n,i,r,o,s;for(document.querySelectorAll?i=document.querySelectorAll(".dropzone"):(i=[],(t=function(e){var t,n,r,o;for(o=[],n=0,r=e.length;n<r;n++)t=e[n],/(^| )dropzone($| )/.test(t.className)?o.push(i.push(t)):o.push(void 0);return o})(document.getElementsByTagName("div")),t(document.getElementsByTagName("form"))),s=[],r=0,o=i.length;r<o;r++)n=i[r],!1!==e.optionsForElement(n)?s.push(new e(n)):s.push(void 0);return s},e.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],e.isBrowserSupported=function(){var t,n,i,r;if(t=!0,window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(n=0,i=(r=e.blacklistedBrowsers).length;n<i;n++)r[n].test(navigator.userAgent)&&(t=!1);else t=!1;else t=!1;return t},a=function(e,t){var n,i,r,o;for(o=[],i=0,r=e.length;i<r;i++)(n=e[i])!==t&&o.push(n);return o},n=function(e){return e.replace(/[\-_](\w)/g,function(e){return e.charAt(1).toUpperCase()})},e.createElement=function(e){var t;return t=document.createElement("div"),t.innerHTML=e,t.childNodes[0]},e.elementInside=function(e,t){if(e===t)return!0;for(;e=e.parentNode;)if(e===t)return!0;return!1},e.getElement=function(e,t){var n;if("string"==typeof e?n=document.querySelector(e):null!=e.nodeType&&(n=e),null==n)throw new Error("Invalid `"+t+"` option provided. Please provide a CSS selector or a plain HTML element.");return n},e.getElements=function(e,t){var n,i,r,o,s,a,l;if(e instanceof Array){i=[];try{for(r=0,s=e.length;r<s;r++)n=e[r],i.push(this.getElement(n,t))}catch(e){e,i=null}}else if("string"==typeof e)for(i=[],o=0,a=(l=document.querySelectorAll(e)).length;o<a;o++)n=l[o],i.push(n);else null!=e.nodeType&&(i=[e]);if(null==i||!i.length)throw new Error("Invalid `"+t+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return i},e.confirm=function(e,t,n){return window.confirm(e)?t():null!=n?n():void 0},e.isValidFile=function(e,t){var n,i,r,o,s;if(!t)return!0;for(t=t.split(","),n=(i=e.type).replace(/\/.*$/,""),o=0,s=t.length;o<s;o++)if(r=t[o],"."===(r=r.trim()).charAt(0)){if(-1!==e.name.toLowerCase().indexOf(r.toLowerCase(),e.name.length-r.length))return!0}else if(/\/\*$/.test(r)){if(n===r.replace(/\/.*$/,""))return!0}else if(i===r)return!0;return!1},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.dropzone=function(t){return this.each(function(){return new e(this,t)})}),"undefined"!=typeof module&&null!==module?module.exports=e:window.Dropzone=e,e.ADDED="added",e.QUEUED="queued",e.ACCEPTED=e.QUEUED,e.UPLOADING="uploading",e.PROCESSING=e.UPLOADING,e.CANCELED="canceled",e.ERROR="error",e.SUCCESS="success",r=function(e){var t,n,i,r,o,s,a,l;for(e.naturalWidth,o=e.naturalHeight,(t=document.createElement("canvas")).width=1,t.height=o,(n=t.getContext("2d")).drawImage(e,0,0),i=n.getImageData(0,0,1,o).data,l=0,r=o,s=o;s>l;)0===i[4*(s-1)+3]?r=s:l=s,s=r+l>>1;return 0===(a=s/o)?1:a},o=function(e,t,n,i,o,s,a,l,c,u){var h;return h=r(t),e.drawImage(t,n,i,o,s,a,l,c,u/h)},i=function(e,t){var n,i,r,o,s,a,l,c,u;if(r=!1,u=!0,i=e.document,c=i.documentElement,n=i.addEventListener?"addEventListener":"attachEvent",l=i.addEventListener?"removeEventListener":"detachEvent",a=i.addEventListener?"":"on",o=function(n){if("readystatechange"!==n.type||"complete"===i.readyState)return("load"===n.type?e:i)[l](a+n.type,o,!1),!r&&(r=!0)?t.call(e,n.type||n):void 0},s=function(){try{c.doScroll("left")}catch(e){return e,void setTimeout(s,50)}return o("poll")},"complete"!==i.readyState){if(i.createEventObject&&c.doScroll){try{u=!e.frameElement}catch(e){}u&&s()}return i[n](a+"DOMContentLoaded",o,!1),i[n](a+"readystatechange",o,!1),e[n](a+"load",o,!1)}},e._autoDiscoverFunction=function(){if(e.autoDiscover)return e.discover()},i(window,e._autoDiscoverFunction)}.call(this),define("dropzone",function(e){return function(){return e.Dropzone}}(this)),define("general.components/media-library/update/media-update",["jquery","qvangular","translator","text!general.components/media-library/update/media-update.ng.html","text!general.components/media-library/update/preview-item.ng.html","general.models/media-library","core.models/communication","xsrfplugin","general.utils/dom-util","general.controllers/error-handler-controller","dropzone","core.utils/deferred","util","general.components/context-menu/context-menu-service"],function(e,t,n,i,r,o,s,a,l,c,u,h,d){"use strict";function p(e,t){t.getContentLibraries().then(function(t){var i=o.getRemainingSpace(t)/1024/1024;i=i.toString().split("e"),i=+((i=(i=Math.floor(+(i[0]+"e"+(i[1]?+i[1]+1:1)))).toString().split("e"))[0]+"e"+(i[1]?+i[1]-1:-1)),e.quotaInfo=n.get("MediaLibrary.QuotaInfo",[i])})}function f(e,t,n){return s.getApp().then(function(i){var r={params:{externalpath:n,xrfkey:m},headers:{"X-Qlik-XrfKey":m}},o=d.basePath+"qrs/appcontent/"+i.id+"/deletecontent";return t.delete(o,r).success(function(){p(e,i)}).error(function(e,t){var n=t;0===t&&(n=500),c.showDialog({code:n})})})}var m=a.getRandomString(16);t.directive("qvMediaUpdate",function(){return{restrict:"E",replace:!0,scope:{updateExp:"=",selectedFile:"=",selectFile:"&",confirm:"&"},template:i,controller:["$scope","$compile","$timeout","$http","qvContextMenu",function(i,o,a,c,g){function v(t,n){var r=i.$new();r.file=n,o(e(t))(r)}function y(e,r,o,s){var a=new h,l=o.split("\\").splice(-1)[0];return i.updateExp.deleteDialogShown=!0,(x=t.getService("qvConfirmDialog").show({closeOnEscape:!0,title:n.get("MediaLibrary.Confirm.Delete.Title"),message:n.get("MediaLibrary.Confirm.Delete.Description",[l]),okLabel:n.get("Common.Delete"),cancelLabel:n.get("Common.Cancel")})).closed.then(function(t){t&&f(i,c,o).then(function(){i.selectedFile===s&&i.selectFile()(e,null,null),r&&b.removeFile(r),a.resolve()},function(){a.reject()}),i.updateExp.deleteDialogShown=!1}),a.promise}var b,x;i.isEmpty=!0,i.previewCounter=0,u.autoDiscover=!1,u.confirm=function(e,t,n){if(null!=n)return n()},i.updateExp.deleteFile=function(e,t,n){for(var i=b.getFilesWithStatus(u.SUCCESS),r=null,o=0;o<i.length;o++)if(t===i[o].name){r=i[o];break}return y(e,r,t,n)},i.onCancelUpload=function(e,t){e.preventDefault(),e.stopPropagation(),b.cancelUpload(t)},i.onDelete=function(e,t,n,i){e.preventDefault(),e.stopPropagation(),y(e,t,n,i)},i.onInsert=function(e){e.preventDefault(),e.stopPropagation(),i.confirm()()},i.onSelectImage=function(t,n){if(l.scrollElmentIntoView(e(n.previewElement),".media-library-preview-container",!1,!0),n.status!==u.SUCCESS)return t.preventDefault(),void t.stopPropagation();i.selectFile()(t,n.qUrl,n.qUrlDef)},i.onContextMenu=function(e,t,n,r){if(e.preventDefault(),e.stopPropagation(),t.status===u.SUCCESS){var o=g.menu();i.updateExp.isUploading||o.addItem({translation:"MediaLibrary.Insert",tid:"insert",select:function(){i.selectedFile!==t.qUrl&&i.selectFile()(e,t.qUrl,t.qUrlDef),i.onInsert(e)}}),o.addItem({translation:"Common.Delete",tid:"delete",select:function(){i.onDelete(e,t,n,r)}}),g.show(o,{position:{x:e.pageX,y:e.pageY},docking:"BottomRight"})}},s.getApp().then(function(t){var o=d.basePath+"qrs/appcontent/"+t.id+"/uploadfile?",s="/appcontent/"+t.id+"/";p(i,t),(b=new u("#media-library-dropzone",{url:o,headers:{"X-Qlik-XrfKey":m},acceptedFiles:".png,.gif,.jpg,.jpeg",maxFilesize:5,parallelUploads:4,filesizeBase:1024,thumbnailWidth:200,thumbnailHeight:200,previewTemplate:r,previewsContainer:".media-library-preview-container",dictInvalidFileType:n.get("ErrorCode.3004"),dictFileTooBig:n.get("MediaLibrary.Error.MaxFileSizeExceeded"),dictResponseError:n.get("ErrorCode.500")})).on("processing",function(e){this.options.url=o+"externalpath="+encodeURIComponent(e.name)+"&overwrite=false&xrfkey="+m}),b.on("addedfile",function(t){v(t.previewElement,t),a(function(){i.isEmpty=!1,i.previewCounter++,i.updateExp.isUploading=!0,l.scrollElmentIntoView(e(t.previewElement),".media-library-preview-container",!1,!0);try{encodeURIComponent(t.name)}catch(e){t.qErrorMsg="MediaLibrary.Error.IllegalCharsInFilename",b.cancelUpload(t)}})}),b.on("removedfile",function(){a(function(){i.previewCounter--,0===i.previewCounter&&(i.isEmpty=!0)})}),b.on("success",function(e){e.qUrl=s+encodeURIComponent(e.name).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}),e.qUrlDef=s+e.name,p(i,t)}),b.on("queuecomplete",function(){a(function(){i.updateExp.isUploading=!1})}),b.on("error",function(t,i,r){var o=e(t.previewElement).scope();o.showError=!0,r&&r.status?409===r.status?o.errorMsg=n.get("MediaLibrary.Error.FileAlreadyExists"):413===r.status?o.errorMsg=n.get("MediaLibrary.Error.MaxFileSizeExceeded"):o.errorMsg=n.get("ErrorCode."+r.status):o.errorMsg=n.get(t.qErrorMsg?t.qErrorMsg:i)})}),i.$on("$destroy",function(){b.destroy(),i.updateExp.deleteDialogShown&&x.close()})}]}})}),define("general.components/media-library/media-library",["jquery","qvangular","core.models/communication","general.models/media-library","general.utils/paths","text!./media-library.ng.html","text!./media-library-list.ng.html","text!general.services/loader/default-loader.ng.html","general.utils/dom-util","general.views/bouncy-grid/bouncy-grid","general.components/media-library/update/media-update","general.components/context-menu/context-menu-service"],function(e,t,n,i,r,o,s,a,l){var c={isShown:!1};t.directive("qveMediaList",function(){return{replace:!0,restrict:"E",template:s}});var u={template:o,controller:["$scope","qvLoader","qvContextMenu",function(t,o,s){function u(e){clearTimeout(m),o.close(e)}function h(e,n){e=e||null,n=n||null,t.selectedFile=e,t.selectedFileDef=n,setTimeout(function(){b.find(".q-media-insbtn").focus()})}function d(){t.disableNav=!0;var e=t.view;n.getApp().then(function(n){n.getLibraryContent(t.view).then(function(n){var r=i.createTree(n,t.input.filter,!0);t.rootEntry=r,e===t.view&&(o.isOpen()?o.close().then(function(){t.state=r.children.length>0?y.hasFiles:y.isEmpty}):(clearTimeout(m),t.state=r.children.length>0?y.hasFiles:y.isEmpty))}).finally(function(){t.disableNav=!1})})}function p(e){return e.split("/").slice(3).join("\\")}function f(e){d(),t.input.selectedFile&&e===t.input.selectedFile&&(v=!0)}var m,g=requirejs.toUrl("img/medialibrary/thumb.png"),v=!1,y={notReady:0,isLoading:1,isEmpty:2,hasFiles:3},b=e("#media-library-modal");t.inZoom=!1,t.firstTimeRenderCheck=!0,t.lists=[],t.selectedFile=null,t.contentState=y,t.state=y.notReady,t.view=null,g=r.stripBasePath(g),g=r.addBasePath(g),t.staticSrc=g,t.updateExp={},t.getSrc=function(e){return e=r.stripBasePath(e),e=r.addBasePath(e)},t.zoomImage=function(e,n){e.preventDefault(),e.stopPropagation(),t.zoomSrc=n.path,t.inZoom=!0},t.closeZoom=function(){t.inZoom=!1,t.zoomSrc=null},t.goTo=function(e,n){var i;t.view===e||t.disableNav||(h(null,null),u(!0),t.state=y.notReady,t.isUpload=n,t.view=e,t.isUpload||(m=setTimeout(function(){t.state=y.isLoading,o.show({template:a,messageObj:{task:"MediaLibrary.LoadingFiles"},appendTo:b.find(".medialib")[0],bigLoader:!0})},1e3),(i=b.find(".q-images-cont")).length&&(i[0].scrollTop=0),d(),t.firstTimeRenderCheck=!0,i=null))},t.isSelectedImg=function(e,n,i){return n&&t.firstTimeRenderCheck&&i&&setTimeout(function(){var e=b.find(i);t.firstTimeRenderCheck=!1,e.length&&l.scrollElmentIntoView(e,".q-images-cont",!0),e=null},250),t.selectedFile===e.path},t.selectFile=function(n,i,r){var o=e(n.target).closest(".q-media-grid, .media-list-cont-item");n.preventDefault(),n.stopPropagation(),l.scrollElmentIntoView(o,".q-images-cont",!1),t.selectedFile===i&&(i=null,r=null),o=null,h(i,r)},t.confirm=function(){t.selectedFile&&!t.updateExp.isUploading&&(t.input.onConfirm(t.selectedFile,t.selectedFileDef),t.destroyComponent())},t.inInAppView=function(){return t.view===t.lists[0].qName},t.canDeleteInView=function(){return t.inInAppView()&&t.canUpdate},t.onDelete=function(e){var n=t.selectedFile,i=p(t.selectedFileDef);e.preventDefault(),e.stopPropagation(),t.updateExp.deleteFile(e,i,t.selectedFile).then(function(){f(n)})},t.onContextMenu=function(n){n.preventDefault(),n.stopPropagation();var i=s.menu();t.updateExp.isUploading||i.addItem({translation:"MediaLibrary.Insert",tid:"insert",select:function(){var i=e(n.target).closest(".media-list-cont-item").scope().entry;h(i.path,i.pathDef),t.confirm()}}),t.canDeleteInView()&&i.addItem({translation:"Common.Delete",tid:"delete",select:function(){var i=e(n.target).closest(".media-list-cont-item").scope().entry,r=i.path,o=p(i.pathDef);t.updateExp.deleteFile(n,o,i.path).then(function(){f(r)})}}),s.show(i,{position:{x:n.pageX,y:n.pageY},docking:"BottomRight"})},t.cancel=function(e,n){if(e&&(e.preventDefault(),e.stopPropagation()),!n){if(t.inZoom)return void t.closeZoom();if(t.updateExp.deleteDialogShown)return void(t.updateExp.deleteDialogShown=!1)}!n&&t.updateExp.isUploading||(t.input.onCancel(v),t.destroyComponent())},n.getApp().then(function(e){e.getContentLibraries().then(function(e){t.lists=i.filterList(e),!t.view&&t.lists.length&&(t.view=t.lists[0].qName,d()),t.canUpdate=!t.$root.isPersonalMode&&!!i.canUpdate})}),t.$watch("updateExp.isUploading",function(e){!1===e&&t.inInAppView()&&d()}),t.$on("$destroy",function(){c.isShown=!1,t.closeZoom(),u(!0)})}]};return{show:function(e){var n={onCancel:e.onCancel,onConfirm:e.onConfirm,selectedFile:e.selectedFile,filter:["png","gif","jpg","jpeg"]};t.getService("luiDialog").show({template:o,controller:u.controller,input:n}),c.isShown=!0},hide:function(){if(c.isShown){var t=e("#media-library-modal");t.length&&t.scope().cancel(null,!0)}},isShown:function(){return c.isShown}}}),define("general.services/media-library/media-library",["general.components/media-library/media-library"],function(e){return{show:function(t){e.show(t)},hide:function(){e.hide()},isShown:function(){return e.isShown()}}}),define("text!client.services/media-tool/font-size-foldout.ng.html",[],function(){return'<lui-popover class="qv-toolbar-fontsize-foldout" ng-if="input.foldouts.fontSizes" qva-activate="openFontsizeFoldout" style="min-width: 40px; width: 44px;" qva-outside-ignore-for="media-toolbar">\n\t<lui-popover-body class="lui-nopad" collision="\'flipfit\'">\n\t\t<ul class="lui-list lui-list--inverse qv-media-tool-fontsize">\n\t\t\t<button class="lui-fade-button lui-fade-button--inverse lui-fade-button--large" style="border-bottom: 1px solid rgba(0, 0, 0, 0.3);" ng-repeat="size in input.fontSizes" qva-activate="input.setFontSize($event, size)" ng-class="{\'lui-active\':input.textTool.fontSize == size}">\n\t\t\t\t<span class="lui-list__text lui-list__action" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">{{input.shortFontSize(size)}}</span>\n\t\t\t</button>\n\t\t</ul>\n\t</lui-popover-body>\n</lui-popover>\n\n\n'}),define("text!client.services/media-tool/media-tool-buttons.ng.html",[],function(){return'<div>\n\t<div ng-if="textTool.showUsage" class="usage"><span q-translation="MediaTool.YouHaveUsed"></span> <span>{{textTool.usage}}%</span></div>\n\n\t<div class="lui-buttongroup" ng-show="buttons.color">\n\t\t<div id="qv-toolbar-colorpicker" tid="colorpicker" q-title-translation="MediaTool.Toolbar.FontColor">\n\t\t\t<button qv-color-picker-button style="width: 66px;" class="lui-fade-button lui-fade-button--large lui-fade-button--inverse no-border-radius" ng-click="onClick($event, \'inverse\')" x-variant="inverse" on-close="closecolorpickerfoldout" ng-model="color" ng-disabled="!haveSelection()"></button>\n\t\t</div>\n\t</div><div class="lui-buttongroup" ng-show="buttons.fontSize">\n\n\t\t<button id="qv-toolbar-fontsize" style="width: 66px" qva-activate="openFontsizeFoldout()" tid="fontSize" ng-disabled="!haveSelection()"\n\t\t\t\tng-class="{\'lui-active\':foldouts.fontSizes}" q-title-translation="MediaTool.Toolbar.FontSize" class="lui-fade-button lui-fade-button--large lui-fade-button--inverse">\n\t\t\t<span class="lui_button__text">{{shortFontSize(textTool.fontSize)}}</span><span class="lui-button__caret  lui-caret"></span>\n\t\t</button>\n\t</div><div class="lui-buttongroup" ng-show="buttonGroup1">\n\t\t<button ng-class="{\'lui-active\':textTool.states.bold}" style="border-right: 1px solid rgba(0, 0, 0, 0.3);" ng-show="buttons.bold" tid="bold" ng-disabled="!haveSelection()"\n\t\t\t q-title-translation="MediaTool.Toolbar.Bold" class="lui-fade-button lui-fade-button--large lui-fade-button--inverse no-border-radius" qva-press="exec($event,\'bold\')">\n\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--bold"></span>\n\t\t</button>\n\t\t<button ng-class="{\'lui-active\':textTool.states.italic}" style="border-right: 1px solid rgba(0, 0, 0, 0.3);"  ng-show="buttons.italic" tid="italic" ng-disabled="!haveSelection()"\n\t\t\t q-title-translation="MediaTool.Toolbar.Italic" class="lui-fade-button lui-fade-button--large lui-fade-button--inverse no-border-radius" qva-press="exec($event,\'italic\')">\n\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--italic"></span>\n\t\t</button>\n\t\t<button ng-class="{\'lui-active\':textTool.states.underline}" ng-show="buttons.underline" tid="underline" ng-disabled="!haveSelection()"\n\t\t\t q-title-translation="MediaTool.Toolbar.Underline" class="lui-fade-button lui-fade-button--large lui-fade-button--inverse no-border-radius" qva-press="exec($event,\'underline\')">\n\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--underline"></span>\n\t\t</button>\n\t</div><div class="lui-buttongroup" ng-show="buttonGroup2">\n\t\t<button ng-class="{\'lui-active\':textTool.states.justifyLeft}" ng-show="buttons.justifyLeft" tid="justifyLeft"\n\t\t\t\tclass="lui-fade-button lui-fade-button--large lui-fade-button--inverse no-border-radius" q-title-translation="Common.Text.AlignLeft" qva-activate="exec($event,\'justifyLeft\')">\n\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--align-left"></span>\n\t\t</button>\n\t\t<button ng-class="{\'lui-active\':textTool.states.justifyCenter}" ng-show="buttons.justifyCenter" tid="justifyCenter"\n\t\t\t\tclass="lui-fade-button lui-fade-button--large lui-fade-button--inverse no-border-radius" q-title-translation="Common.Text.AlignCenter" qva-activate="exec($event,\'justifyCenter\')">\n\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--align-center"></span>\n\t\t</button>\n\t\t<button ng-class="{\'lui-active\':textTool.states.justifyRight}" ng-show="buttons.justifyRight" tid="justifyRight"\n\t\t\t\tclass="lui-fade-button lui-fade-button--large lui-fade-button--inverse no-border-radius" q-title-translation="Common.Text.AlignRight" qva-activate="exec($event,\'justifyRight\')">\n\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--align-right"></span>\n\t\t</button>\n\t</div><div class="lui-buttongroup" ng-show="buttons.link">\n\t\t<button id="qv-toolbar-link" qva-activate="openLinkFoldout($event)" style="width: 66px;" tid="link"\n\t\t\t\tclass="lui-fade-button lui-fade-button--large lui-fade-button--inverse no-border-radius" ng-class="{\'lui-active\':foldouts.link}" q-title-translation="{{ textTool.states.link ? \'MediaTool.Toolbar.EditURLLink\' : \'MediaTool.Toolbar.CreateURLLink\' }}"\n\t\t\t\tng-disabled="linkDisabled()">\n\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--link" ng-class="{\'lui-active\':textTool.states.link}"></span><span class="lui-button__caret  lui-caret"></span>\n\t\t</button>\n\t</div><div class="lui-buttongroup" ng-show="buttons.image">\n\t\t<button id="qv-toolbar-image" qva-activate="openMediaLibrary($event)" ng-class="{\'lui-active\':foldouts.mediaLibrary}" tid="image"\n\t\t\t\tclass="lui-fade-button lui-fade-button--large lui-fade-button--inverse no-border-radius" q-title-translation="MediaTool.Toolbar.InsertImage">\n\t\t\t<span class="lui-fade-button__icon  lui-icon  lui-icon--image"></span>\n\t\t</button>\n\t</div>\n</div>\n'}),define("client.services/media-tool/media-tool-buttons",["qvangular","text!./media-tool-buttons.ng.html"],function(e,t){e.directive("qvMediaToolButtons",function(){return{restrict:"A",replace:!0,template:t}})}),define("client.services/media-tool/toolbar",["jquery","touche","text!./toolbar.ng.html","client.services/media-tool/theme","client.services/media-tool/text-selection","client.services/media-tool/link-foldout/link-foldout","general.services/media-library/media-library","general.services/show-service/show-service","text!./font-size-foldout.ng.html","client.services/media-tool/media-tool-buttons"],function(e,t,n,i,r,o,s,a,l){var c,u=i.palette,h=i.fontSizes,d={fontSizes:!1,link:!1,mediaLibrary:!1,colorpicker:!1},p={color:!0,fontSize:!0,bold:!0,italic:!0,underline:!0,justifyLeft:!0,justifyCenter:!0,justifyRight:!0,link:!0,image:!0};return{template:n,scope:{textTool:"=",options:"=",alignTo:"="},controller:["$scope","$timeout","luiPopover",function(n,f,m){n.palette=u,n.fontSizes=Object.keys(h),n.foldouts=d,"all"===n.options.buttons?(n.buttons=p,n.buttonGroup1=!0,n.buttonGroup2=!0):"object"==typeof n.options.buttons&&(n.buttons=n.options.buttons,n.buttonGroup1=n.buttons.bold||n.buttons.italic||n.buttons.underline,n.buttonGroup2=n.buttons.justifyLeft||n.buttons.justifyCenter||n.buttons.justifyRight),n.exec=function(e,i){e.preventDefault(),e.stopPropagation(),t.preventGestures(),0===i.indexOf("justify")?n.textTool.setJustify(i):n.haveSelection()&&n.textTool.setBIU(i)},n.setActiveFoldout=function(e){Object.keys(n.foldouts).forEach(function(t){t===e&&n.foldouts[t]?n.foldouts[t]=!1:n.foldouts[t]=t===e})},n.shortFontSize=function(e){return h[e]||e},n.openMediaLibrary=function(){n.textTool.saveRange(),n.setActiveFoldout("mediaLibrary"),s.show({onCancel:function(){n.setActiveFoldout(),n.textTool.restoreRange(),n.textTool.focus()},onConfirm:function(e,t){n.setActiveFoldout(),f(function(){t?n.textTool.insertImage(e,t):(n.textTool.restoreRange(),n.textTool.focus())},100)},selectedFile:null})},n.closeColorpickerFoldout=function(i){e(i.target).closest("#qv-toolbar-colorpicker").length&&t.preventGestures(),n.setActiveFoldout()},n.openFontsizeFoldout=function(){if(n.foldouts.fontSizes&&c)return c.close(),void(c=null);c=m.show({template:l,input:{foldouts:n.foldouts,fontSizes:n.fontSizes,textTool:n.textTool,shortFontSize:n.shortFontSize,setFontSize:n.setFontSize,closeFontsizeFoldout:n.closeFontsizeFoldout},alignTo:e("#qv-toolbar-fontsize")[0],variant:"inverse",closeOnEscape:!0,autoFocus:!1}),n.setActiveFoldout("fontSizes"),c.closing.then(function(i){i&&e(i.target).closest("#qv-toolbar-fontsize").length&&t.preventGestures(),n.setActiveFoldout()}),c.closed.then(function(){c=null})};var g=null;n.openLinkFoldout=function(){var t,i=n.textTool.currentRange,s={};i&&((t=e(i.commonAncestorContainer).closest("a")).length&&(s.url=t.attr("href"),s.bookmark=t.attr("data-bookmark-id"),s.$node=t),n.textTool.saveRange(),g=a.show(o,{options:{toolbarScope:n,alignTo:e("#qv-toolbar-link"),link:s,onSave:function(e,t,i,r){var o;i?((o=document.createRange()).setStartBefore(i[0]),o.setEndAfter(i[0]),n.textTool.insertLink(t,o,r)):f(function(){n.textTool.insertLink(t,null,r)}),n.closeLinkFoldout(e)},onCancel:function(e){n.closeLinkFoldout(e)},onRemove:function(e,t){if(t){var i=r.createRangeForElement(t[0]);n.textTool.removeLink(i)}n.closeLinkFoldout(e)}}}),n.setActiveFoldout("link"))},n.setFontSize=function(e,t){e.preventDefault(),n.setActiveFoldout(),n.textTool.setFontSize(t),c&&(c.close(),c=null)},n.closeLinkFoldout=function(i){i&&e(i.target).closest("#qv-toolbar-link").length&&t.preventGestures(),n.setActiveFoldout(),g&&(g.destroy(),g=null)},n.linkDisabled=function(){var e=n.textTool.currentRange;return!!!n.textTool.states.link&&(!e||e.collapsed)},n.haveSelection=function(){var e=n.textTool.currentRange;return!(!e||e.collapsed)},Object.defineProperty(n,"color",{get:function(){return n.haveSelection()?i.palette.indexOf(n.textTool.color):i.palette[10]},set:function(e){n.textTool.setColor(i.palette[e])}}),n.$on("$destroy",function(){n.setActiveFoldout(),g&&(g.destroy(),g=null)}),f(function(){n.textTool.refreshState()})}]}}),define("client.services/media-tool/command-queue",[],function(){var e=function(){this.queue=[]};return e.prototype.push=function(e){this.queue.push(e)},e.prototype.execAll=function(e){this.queue.forEach(e)},e.prototype.remove=function(e){var t,n=!1;for(t=this.queue.length-1;t>=0;t--)this.queue[t].cmd===e&&(n=!0,this.queue.splice(t,1));return n},e.prototype.clear=function(){this.queue=[]},e}),define("client.services/media-tool/feature-detection",["angular","client.services/media-tool/text-selection"],function(e,t){var n=e.element("<div contenteditable style='position:absolute;top: -999999px;'>")[0];return{usesAlign:function(e,i){var r=document.activeElement;return document.body.appendChild(n),n.innerHTML="Feature detection.",n.focus(),t.addRange(t.createRange(n),!0),document.execCommand(e,!1,i),document.activeElement=r,document.body.removeChild(n),n.innerHTML}("justifyCenter").indexOf(" align=")>-1}}),define("client.services/media-tool/markdown-html-parser",["util"],function(e){function t(){var t="("+s.formatters.map(function(t){return t.character?e.escapeRegExp(t.character):""}).join("|")+"){1}\\[",n="((?![\\s\\S]*?"+t+"[\\s\\S]*?)[\\s\\S]*?)";s.markdownRegex=new RegExp(t+n+"\\]\\(([^\\\\)]*(?:\\\\.[^\\\\)]*)*)\\)","mg")}function n(e,t,i){for(var r=e.exec(t),o=[];r&&!(o.indexOf(r.index)>-1);)o.push(r.index),t=i(t,r),r=e.exec(t);return o.length?n(e,t,i):t}function i(e){return e.split("").reverse().join("")}function r(){var e=s.formatters.filter(function(e){return!!e.toHTML});return e.sort(function(e,t){var n=e.toHTML.priority||0;return(t.toHTML.priority||0)-n}),e}function o(){var e=s.formatters.filter(function(e){return!!e.toMarkdown});return e.sort(function(e,t){var n=e.toMarkdown.priority||0;return(t.toMarkdown.priority||0)-n}),e}var s={};return s.register=function(e){s.formatters.push(e),t()},s.toHTML=function(e,t){var o=t||r(),a=!1;return e=e.replace(/\$\&amp;/g,"&#36;&amp;"),e=n(s.markdownRegex,e,function(e,t){return e.replace(t[0],function(){return s.getFormatter(t[1]).toHTML.callback(t[2],t[4])})}),o.forEach(function(t){t.toHTML&&t.toHTML.regex&&(t.toHTML.reverse&&(e=i(e)),e=n(t.toHTML.regex,e,function(e,n){var i=n.splice(0,1)[0];return a=!0,e.replace(i,t.toHTML.callback.apply(t.toHTML.callback,n))}),t.toHTML.reverse&&(e=i(e)))}),a?s.toHTML(e,t):e},s.toMarkdown=function(e,t){var n=t||o(),i=new Option;return i.innerHTML=e,n.forEach(function(e){e.toMarkdown.tags.forEach(function(t){Array.prototype.slice.call(i.getElementsByTagName(t.name)).reverse().forEach(function(n){var i=!t.attr.length||t.attr.some(function(e){return n.hasAttribute(e)}),r=t.dontMatchAttr&&t.dontMatchAttr.some(function(e){return n.hasAttribute(e)});if("img"===t.name&&n.hasAttribute("src")&&!n.hasAttribute("data\\-measure")){var o=n.getAttribute("src");n.setAttribute("src",o.replace(/\\/g,""))}var s;if(s=e.toMarkdown.regex?i&&!r&&e.toMarkdown.regex.exec(n.outerHTML.trim()):[n.outerHTML.trim()],!r&&i&&s){var a=document.createElement("span");a.innerHTML=e.toMarkdown.callback.apply(n,s.slice(1)),n.parentNode.replaceChild(a,n)}})})}),i.innerHTML.replace(/<(\/)?span>/g,"")},s.getFormatter=function(e){var t,n=s.formatters;for(t=0;t<n.length;t++)if(n[t].character===e)return n[t];return null},s.escapeMarkdown=function(e){return e.replace(/\*/g,"\\*").replace(/\[/g,"\\[").replace(/\]/g,"\\]").replace(/\_/g,"\\_").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\~/g,"\\~").replace(/\-/g,"\\-")},s.unescapeMarkdown=function(e){return e.replace(/\\\*/g,"*").replace(/\\\[/g,"[").replace(/\\\]/g,"]").replace(/\\\_/g,"_").replace(/\\\(/g,"(").replace(/\\\)/g,")").replace(/\\\~/g,"~").replace(/\\\-/g,"-")},s.reset=function(){s.formatters=[],s.markdownRegex=null},s.reset(),s}),define("client.services/media-tool/formatters/font-color",["sirtrevor","client.services/media-tool/theme","client.services/media-tool/markdown-html-parser"],function(e,t,n){var i=t.palette;return n.register({name:"font-color",character:"#",toHTML:{callback:function(e,t){return'<font color="'+i[t]+'">'+e+"</font>"}},toMarkdown:{priority:2,regex:/^<font(?: size="([0-7]|undefined)")? color="(#[a-f0-9]{3,6})"(?: size="([0-7]|undefined)")?.*?>([\s\S]+)<\/font>$/,callback:function(e,n,r,o){if(""===o)return"";var s=e||r;return null!==s&&void 0!==s&&(o="%["+o+"]("+(s=t.htmlSizeToMarkdownSize[s])+")"),-1===i.indexOf(n)?o:"#["+o+"]("+i.indexOf(n)+")"},tags:[{name:"font",attr:["color"]}]}}),e.Formatter.extend({title:"color",cmd:"foreColor",text:"color",onClick:function(e){document.execCommand(e.cmd,!1,e.param)}})}),define("client.services/media-tool/formatters/font-size",["sirtrevor","client.services/media-tool/theme","client.services/media-tool/markdown-html-parser"],function(e,t,n){return n.register({name:"font-size",character:"%",toHTML:{callback:function(e,n){return"<font size='"+t.markdownSizeToHtmlSize[n]+"'>"+e+"</font>"}},toMarkdown:{regex:/^<font size="([0-7])".*?>([\s\S]+)<\/font>$/,callback:function(e,n){return""===n?"":(e>7&&(e=t.fontSizesPx[e]),null!==e&&void 0!==e?(e=t.htmlSizeToMarkdownSize[e],"%["+n+"]("+e+")"):n)},tags:[{name:"font",attr:["size"]}]}}),e.Formatter.extend({title:"fontsize",cmd:"fontSize",text:"fontsize"})}),define("client.services/media-tool/formatters/justify",["sirtrevor","qvangular","encoder","client.services/media-tool/markdown-html-parser","client.services/media-tool/feature-detection","client.utils/rtl/rtl-util"],function(e,t,n,i,r,o){var s=r.usesAlign;i.register({name:"justify",character:"^",toHTML:{callback:function(e,t){var i=o.supportDirAuto()?"auto":o.detectTextDirection(e.replace(/<\/?[^>]+(>|$)/g,""));return e||(e="&nbsp;"),s?"<div dir="+i+' align="'+n.encodeForAttr2(t)+'">'+e+"</div>":"<div dir="+i+' style="text-align: '+n.encodeForAttr2(t)+';">'+e+"</div>"}},toMarkdown:{regex:/^<(?:div|p).*?(?:style="text(?:\\)?-)?align(?:="|: )(left|center|right|justified|inherit)(?:"|;).*?>([\s\S]+)<\/(?:div|p)>$/,callback:function(e,t){return"^["+t+"]("+e+")"},tags:[{name:"div",attr:["align","style"]},{name:"p",attr:["align"]}]}});var a=e.Formatter.extend({title:"align left",cmd:"justifyLeft",text:"left",isActive:function(e){var t=e.getParentParagraph(),n=window.getComputedStyle(t);return!!/left/.test(n.textAlign)||!(!n||"ltr"!==n.direction||/right/.test(n.textAlign)||/center/.test(n.textAlign))},onClick:function(){var e=t.getService("qvMediaTool").getParagraph().el.style,n=e.direction;"ltr"!==n&&n||(n="ltr",e.direction="rtl"),document.execCommand("justifyLeft",!1),"ltr"===n&&(e.direction="ltr")}}),l=e.Formatter.extend({title:"align center",cmd:"justifyCenter",text:"center",onClick:function(){document.execCommand("justifyCenter",!1)}});return{Left:a,Right:e.Formatter.extend({title:"align right",cmd:"justifyRight",text:"right",isActive:function(e){var t=e.getParentParagraph(),n=window.getComputedStyle(t);return!!/right/.test(n.textAlign)||!(!n||"rtl"!==n.direction||/left/.test(n.textAlign)||/center/.test(n.textAlign))},toMarkdown:function(e){return i.toMarkdown(e)},toHTML:function(e){return i.toHTML(e)},onClick:function(){var e=t.getService("qvMediaTool").getParagraph().el.style,n=e.direction;"rtl"===n&&(e.direction="ltr"),document.execCommand("justifyRight",!1),"rtl"===n&&(e.direction="rtl")}}),Center:l}}),define("client.services/media-tool/formatters/bold",["sirtrevor","client.services/media-tool/markdown-html-parser"],function(e,t){return t.register({name:"bold",character:"**",toHTML:{priority:5,regex:/\*\*(?!\\)([\s\S]+?(?!\*\\))\*\*/g,callback:function(e){return">b/<"+e+">b<"},reverse:!0},toMarkdown:{priority:-5,regex:/^<(?:b|strong)>([\s\S]+)<\/(?:b|strong)>$/,callback:function(e){return""===e?"":"**"+e+"**"},tags:[{name:"b",attr:[]},{name:"strong",attr:[]}]}}),e.Formatter.extend({title:"bold",cmd:"bold",text:"B",isActive:function(e){return e.rangeCollapsed?e.hasStartAncestorTag(["b","strong"])||e.hasEndAncestorTag(["b","strong"]):e.hasStartAncestorTag(["b","strong"])&&e.hasEndAncestorTag(["b","strong"])},toMarkdown:function(e){return e},toHTML:function(e){return e}})}),define("client.services/media-tool/formatters/italic",["sirtrevor","client.services/media-tool/markdown-html-parser"],function(e,t){return t.register({name:"italic",character:"_",toHTML:{priority:5,regex:/\_(?!\\)([\s\S]+?(?!\_\\))\_/g,callback:function(e){return">i/<"+e+">i<"},reverse:!0},toMarkdown:{priority:-5,regex:/^<(?:i|em)>([\s\S]+)<\/(?:i|em)>$/,callback:function(e){return""===e?"":"_"+e+"_"},tags:[{name:"i",attr:[]},{name:"em",attr:[]}]}}),e.Formatter.extend({title:"italic",cmd:"italic",text:"I",isActive:function(e){return e.rangeCollapsed?e.hasStartAncestorTag(["i","em"])||e.hasEndAncestorTag(["i","em"]):e.hasStartAncestorTag(["i","em"])&&e.hasEndAncestorTag(["i","em"])},toMarkdown:function(e){return e},toHTML:function(e){return e}})}),define("client.services/media-tool/formatters/underline",["sirtrevor","client.services/media-tool/markdown-html-parser"],function(e,t){return t.register({name:"underline",character:"~",toHTML:{priority:5,regex:/~(?!\\)([\s\S]+?(?!~\\))~/g,callback:function(e){return">u/<"+e+">u<"},reverse:!0},toMarkdown:{priority:-5,regex:/^<u>([\s\S]+)<\/u>$/,callback:function(e){return""===e?"":"~"+e+"~"},tags:[{name:"u",attr:[]}]}}),e.Formatter.extend({title:"underline",cmd:"underline",text:"U",isActive:function(e){return e.rangeCollapsed?e.hasStartAncestorTag("u")||e.hasEndAncestorTag("u"):e.hasStartAncestorTag("u")&&e.hasEndAncestorTag("u")},toMarkdown:function(e){return e},toHTML:function(e){return e}})}),define("client.services/media-tool/formatters/bookmark",["jquery","qvangular","sirtrevor","encoder","client.services/media-tool/markdown-html-parser"],function(e,t,n,i,r){function o(n,i){var r=t.getService("qvMediaTool").getRange().commonAncestorContainer,o=e(r).find("a[href="+i+"]");return"#text"===r.nodeName&&(o="A"!==n.nodeName?e(n).find("a[href="+i+"]"):e(n)),0===o.length&&(o=e(r).find("a:not([href])")),0===o.length&&(o=e(r)),o}return r.register({name:"bookmark",character:"$",toHTML:{callback:function(e,t){return'<a href="#" class="bookmark-link" data-bookmark-id="'+i.encodeForAttr2(t.replace(/\\/g,""))+'">'+e+"</a>"}},toMarkdown:{regex:/^<a (?=.*data\\-bookmark\\-id="([^"]+)").*?>([\s\S]+?)<\/a>$/,callback:function(e,t){return"$["+t+"]("+e+")"},tags:[{name:"a",attr:["data\\-bookmark\\-id"]}]}}),n.Formatter.extend({title:"bookmark",cmd:"createLink",text:"Bookmark",isActive:function(e){return e.rangeCollapsed?e.hasStartAncestorTag("a")||e.hasEndAncestorTag("a"):e.hasStartAncestorTag("a")&&e.hasEndAncestorTag("a")},onClick:function(t){var n=t.url;e(document).on("DOMNodeInserted.bookmark",function(t){var i=o(t.target,n);e.each(i,function(t,i){e(i).hasClass("bookmark-link")||setTimeout(function(){i.setAttribute("href","#"),i.removeAttribute("_moz_dirty"),i.className+="bookmark-link",i.setAttribute("data-bookmark-id",n)})}),setTimeout(function(){e(document).off("DOMNodeInserted.bookmark")},250)}),document.execCommand("unlink",!1,!1),document.execCommand(this.cmd,!1,n)}})}),define("client.services/media-tool/formatters/link",["sirtrevor","client.services/media-tool/markdown-html-parser"],function(e,t){return t.register({name:"link",character:"@",toHTML:{callback:function(e,t){return 0===t.indexOf("javascript:")&&(t=""),0!==t.search("[a-zA-Z0-9]+:")&&(t="http://"+t),t=t.replace(/\\(["'])/g,"%5C$1").replace(/'/g,"%27").replace(/"/g,"%22").replace(/\$/g,"%24"),"<a href='"+decodeURI(t)+"' target='\\_blank' title='"+decodeURI(t)+"'>"+e+"</a>"}},toMarkdown:{regex:/^<a.*?href="(?!#)([^"]+)".*?>([\s\S]+?)<\/a>$/,callback:function(e,t){return"@["+t+"]("+e+")"},tags:[{name:"a",attr:["href"]}]}}),e.Formatter.extend({title:"link",cmd:"createLink",text:"Link",isActive:function(e){return e.rangeCollapsed?e.hasStartAncestorTag("a")||e.hasEndAncestorTag("a"):e.hasStartAncestorTag("a")&&e.hasEndAncestorTag("a")},onClick:function(e){var t=e.url;document.execCommand(this.cmd,!1,t)}})}),define("client.services/media-tool/formatters/unlink",["sirtrevor"],function(e){return e.Formatter.extend({title:"unlink",cmd:"unlink",text:"Unlink",onClick:function(e){var t=e.url;document.execCommand(this.cmd,!1,t)}})}),define("client.services/media-tool/formatters/measure",["qvangular","sirtrevor","util","translator","lz-string","general.utils/array-util","objects.views/charts/utils/canvas-renderer","client.services/media-tool/markdown-html-parser","general.utils/string-limits"],function(e,t,n,i,r,o,s,a,l){function c(e,t){var n,i=e.qHyperCube.qMeasureInfo;for(n=0;n<i.length;++n)if(i[n].cId===t)return i[n];return null}function u(e,t){var n,i,r=e.qHyperCube.qMeasureInfo;for(n=0;n<r.length;++n)if(r[n].cId===t)return!(i=e.qHyperCube.qGrandTotalRow[n])||!i.qText||"NaN"===i.qNum&&"-"===i.qText?"":a.escapeMarkdown(i.qText);return""}function h(e){var t,n=s.getDevicePixelToBackingStoreRatio(),i=d.getContext("2d"),r=s.measureTextObject({shape:{text:e,width:112,font:"13px 'QlikView Sans'"}});t=Math.ceil(Math.min(r.width+50,150)),d.height=30*n,d.width=t*n,d.style.height="30px",d.style.width=t+"px",i.clearRect(0,0,d.width,d.height),i.save(),i.scale(n,n),i.font="15px 'LUI icons'",i.globalAlpha=.35,i.fillText("3",2,23),i.globalAlpha=1,i.font="13px 'QlikView Sans'",i.fillText(r.lines[0],32,20),i.restore();var o=d.toDataURL("image/png"),a=document.createElement("img");return a.setAttribute("src",o),a.setAttribute("class","tokenized-measure"),a.setAttribute("width",t+"px"),a.setAttribute("height","30px"),a}var d=document.createElement("canvas");return a.register({name:"measure",character:"=",toHTML:{callback:function(t,n){var o,s,a=e.getService("qvMediaTool");if(a.isActive()){var d=a.getOptions();if(!d.useMeasures)return"";var p,f=d.propertyHandler.getMeasure(n),m=!1;if(f){var g=c(d.layout,n);!g||g.qError?(m=!0,p=i.get("Object.ErrorMessage.MissingMeasure")):p=g.qFallbackTitle||""}else p=d.copiedMeasures[n];var v=JSON.stringify(f);(s=h(p)).setAttribute("data-measure-id",n),s.setAttribute("data-measure-name",r.compressToBase64(p)),s.setAttribute("data-measure",r.compressToBase64(v)),s.setAttribute("data-tid","ti-measure"),m&&s.classList.add("invalid-measure")}else{var y=u(o=a.getCurrentLayout(),n);if(null===y)return"";y.length>l.textImage&&(y=y.substr(0,l.textImage-1)+""),(s=document.createElement("span")).setAttribute("data-tid","ti-measure"),s.appendChild(document.createTextNode(y))}return s.outerHTML}},toMarkdown:{callback:function(){var t=this.getAttribute("data\\-measure\\-id"),i=e.getService("qvMediaTool").getOptions();if(!c(i.layout,t)&&!i.copiedMeasures[t]){var s=r.decompressFromBase64(this.getAttribute("data\\-measure")),a=JSON.parse(s);t=n.generateId(),a.qDef.cId=t;var l=i.properties;l.qHyperCubeDef.qMeasures.push(a),o.indexAdded(l.qHyperCubeDef.qInterColumnSortOrder,l.qHyperCubeDef.qDimensions.length+l.qHyperCubeDef.qMeasures.length-1);var u=r.decompressFromBase64(this.getAttribute("data\\-measure\\-name"));i.copiedMeasures[t]=u}return"=[]("+t+")"},tags:[{name:"img",attr:["data\\-measure\\-id"]}]}}),t.Formatter.extend({title:"measure",cmd:"",text:"measure",toMarkdown:function(e){return e},toHTML:function(e){return e}})}),define("client.services/media-tool/formatters/image",["qvangular","sirtrevor","client.services/media-tool/markdown-html-parser","general.utils/paths"],function(e,t,n,i){function r(e,t,n){for(var i=n?"qStaticContentUrl":"qStaticContentUrlDef",r=0;r<t.length;r++)if(t[r].id===e)return t[r].url[i].qUrl;return""}function o(e){return e.replace(/\\(["'])/g,"%5C$1").replace(/'/g,"%27").replace(/"/g,"%22").replace(/\$/g,"%24")}return n.register({name:"image",character:"!",toHTML:{callback:function(t,s){var a=e.getService("qvMediaTool");if(a.useImageArray()){var l=s;s=(s=r(t,(a.isActive()?a.getOptions().layout:a.getCurrentLayout()).images,!0))?n.escapeMarkdown(s):l}return s=i.stripBasePath(s),s=o(s),s=i.getUrl(s),t||(t="image"),t=o(t),"<img src='"+s+"' data-image-id='"+t+"'>"}},toMarkdown:{priority:1,regex:/^<img.*?src="([^"]+)".*?>$/,callback:function(e){var t=this.getAttribute("data\\-image\\-id")||"";return t||(t=""),e=n.unescapeMarkdown(e),e=i.stripBasePath(e),e=n.escapeMarkdown(e),"!["+t+"]("+e+")"},tags:[{name:"img",attr:["src"],dontMatchAttr:["data\\-measure\\-id"]}]}}),t.Formatter.extend({title:"image",cmd:"insertImage",text:"image",onClick:function(e){document.execCommand(e.cmd,!1,e.param)}})}),define("client.services/media-tool/formatters/paste",["client.services/media-tool/markdown-html-parser","util"],function(e,t){var n=/color: rgb\\\((\d{1,3}), (\d{1,3}), (\d{1,3})/i,i=/font\\\-size: (\d+)px/i,r=/text\\\-decoration: underline/i,o=/font\\\-weight: bold/i;e.register({name:"paste",character:"`",toMarkdown:{regex:/^<(span|font|i|b|u) style="(.+?)">(.+?)<\/(?:span|font|i|b|u)>$/,callback:function(s,a,l){var c;return n.test(a)&&(a=a.replace(/rgb\\\(/g,"rgb(").replace(/\\\);/g,");"),l=e.getFormatter("#").toMarkdown.callback(null,t.normalizeToHex(a),null,l)),(c=i.exec(a))&&(l=e.getFormatter("%").toMarkdown.callback(c[1],l)),(c=r.exec(a))&&(l=e.getFormatter("~").toMarkdown.callback(l)),(c=o.exec(a))&&(l=e.getFormatter("**").toMarkdown.callback(l)),this.innerHTML=l,this.removeAttribute("style"),e.toMarkdown(this.outerHTML.trim())},tags:[{name:"span",attr:["style"]},{name:"font",attr:["style"]},{name:"b",attr:["style"]},{name:"i",attr:["style"]},{name:"u",attr:["style"]}]}}),e.register({name:"word",character:"``",toMarkdown:{regex:/^.+$/i,callback:function(){return" "},tags:[{name:"style",attr:[]},{name:"w:WordDocument",attr:[]}]}})}),define("client.services/media-tool/sir-trevor-extensions",["sirtrevor","underscore","client.services/media-tool/text-selection","client.services/media-tool/formatters/font-color","client.services/media-tool/formatters/font-size","client.services/media-tool/formatters/justify","client.services/media-tool/formatters/bold","client.services/media-tool/formatters/italic","client.services/media-tool/formatters/underline","client.services/media-tool/formatters/bookmark","client.services/media-tool/formatters/link","client.services/media-tool/formatters/unlink","client.services/media-tool/formatters/measure","client.services/media-tool/formatters/image","general.utils/string-limits","client.services/media-tool/formatters/paste"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f){function m(e){for(var t=[],n=0;n<e.childNodes.length;n++)3===e.childNodes[n].nodeType?t.push(e.childNodes[n]):t.push.apply(t,m(e.childNodes[n]));return t}function g(){var e=this.textContent.length-f.textImage;if(e>0){var t=n.getRange(),i=t.commonAncestorContainer;if(3===i.nodeType){var r=m(document.activeElement),o=r.indexOf(i);(r=r.splice(0,o+1)).reverse().forEach(function(i){if(e<=0)return!1;i.nodeValue.length>e?(i.splitText(i.nodeValue.length-e),i.parentNode.removeChild(i.nextSibling),n.addRange(t,!0)):i.parentNode.removeChild(i),e-=i.nodeValue.length})}}}delete e.Formatters.Bold,delete e.Formatters.Italic,delete e.Formatters.Link,delete e.Formatters.Unlink,e.Formatters.bold=new s,e.Formatters.italic=new a,e.Formatters.underline=new l,e.Formatters.justifyLeft=new o.Left,e.Formatters.justifyCenter=new o.Center,e.Formatters.justifyRight=new o.Right,e.Formatters.fontSize=new r,e.Formatters.foreColor=new i,e.Formatters.bookmark=new c,e.Formatters.link=new u,e.Formatters.unlink=new h,e.Formatters.measure=new d,e.Formatters.insertImage=new p,e.Blocks.Paragraph=e.Block.extend({type:"paragraph",className:"st-block",icon_name:"paragraph",editorHTML:'<div class="st-required st-text-block" contenteditable="true" autocomplete="off" autocorrect="off"></div>',attributes:function(){return t.extend(e.SimpleBlock.fn.attributes.call(this),{})},title:function(){return"Paragraph"},loadData:function(t){this.getTextBlock().html(e.toHTML(t.text,this.type))},focus:function(){this.getTextBlock().focus()},_initTextBlocks:function(){this.getTextBlock().bind("input",g).bind("paste",this._handleContentPaste).bind("keyup",this.getSelectionForFormatter).bind("mouseup",this.getSelectionForFormatter)},_initUIComponents:function(){this.onFocus(),this.onBlur()},_blockPrepare:function(){this._initUI(),this._initMessages(),this.checkAndLoadData(),this.$el.addClass("st-item-ready")},toData:function(){e.log("toData for "+this.blockID);var t=this.getTextBlock().html();this.setData({text:e.toMarkdown(t,this.type)})}}),e.FloatingBlockControls=e.FloatingBlockControls.extend({className:"",bound:[],initialize:function(){},attributes:function(){}}),e.BlockControls=e.FloatingBlockControls.extend({className:"",bound:[],html:"",initialize:function(){},hide:function(){},show:function(){},handleControlButtonClick:function(){}}),e.FormatBar=e.FormatBar.extend({className:"",initialize:function(){}})}),define("client.services/media-tool/media-tool",["jquery","underscore","util","general.utils/dom-util","qvangular","sirtrevor","text!./media-tool.ng.html","client.services/media-tool/theme","client.services/media-tool/toolbar","client.services/media-tool/command-queue","client.services/media-tool/text-selection","general.utils/string-limits","general.utils/paths","general.utils/support","client.services/media-tool/feature-detection","client.utils/rtl/direction-service","client.utils/rtl/rtl-util","./sir-trevor-extensions"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g){var v={bold:!1,italic:!1,underline:!1,justifyLeft:!1,justifyCenter:!1,justifyRight:!1,link:!1,fontSize:!1};return{controller:["$scope","$element","$timeout","$sce","luiPopover",function(s,y,b,x,q){function C(){S(),"inline"===s.options.toolbar.style?M=s.options.target.showComponent(l,{textTool:s,options:s.options.toolbar||{}}):(M=q.show({template:l.template,controller:l.controller,input:{textTool:s,options:s.options.toolbar||{}},alignTo:s.options.target||y[0],dock:"top",variant:"inverse",closeOnOutside:!0,outsideIgnore:"media-toolbar",showArrow:!1,autoFocus:!1})).closed.then(function(){M=null})}function S(){M&&(s.editor.formatBar.$el.remove(),M=null)}function w(){function e(e){return s.getEditorElement()[0]===e}function t(e,n){return Array.isArray(e)?e.some(function(e){return t(e,n)}):n.some(function(t){return t.nodeName.toLowerCase()===e})}var n=i.getAncestorsUntil(s.currentRange.startContainer,e),r=i.getAncestorsUntil(s.currentRange.endContainer,e);return{rangeCollapsed:s.currentRange.collapsed,hasStartAncestorTag:function(e){return t(e,n)},hasEndAncestorTag:function(e){return t(e,r)},getParentParagraph:function(){for(var e=s.currentRange.startContainer;e.parentNode&&"DIV"!==e.tagName&&"P"!==e.tagName;)e=e.parentNode;return e}}}function _(t){function n(e){s.saveRange(),s.cmdQueue.clear(),e&&s.refreshState()}var r=!p.treatAsDesktop();e("body").on("mouseup.texttool",function(t){e(t.target).closest(".qv-texttool-toolbar, .qui-immidiateContextual, .qv-modal-container-centered, .lui-popover").length?i.isInput(document.activeElement)||(s.focus(),s.restoreRange()):r||document.activeElement===s.getEditorElement()[0]&&b(function(){n(!0),s.$apply()})}),r&&e(document).on("selectionchange.texttool",function(){if(document.activeElement===s.getEditorElement()[0]){var e=u.getRange();e&&!u.rangeEquals(e,s.currentRange)&&n(!0)}}),t.on("qv-activate","img",function(e){var t=u.createRangeForElement(e.target);s.focus(),u.addRange(t,!0),s.saveRange(),s.refreshState()}),t.on("scroll",function(){s.saveScroll()}),t.on("keydown input",function(e){13!==e.which&&(s.cmdQueue.execAll(function(e){s.execCustom(e)}),s.cmdQueue.clear()),b(function(){s.$apply()})}),r||t.on("keyup",function(){b(n.bind(this,!0),0)}),t.on("DOMNodeInserted.autoDirection",function(n){var i=e(n.target);"x-auto-direction-for-paragraphs"in t[0].attributes&&i.is("div,p")&&i[0]!==t[0]&&(g.supportDirAuto()&&i.attr("dir","auto"),i.is("[align],[style]")||(f.usesAlign?i.attr("align","inherit"):i.css("text-align","inherit"),""===i[0].textContent&&i.css("direction",m.direction)))})}var D=x.getTrustedHtml(o.toHTML(s.options.markdown));s.data={data:[{type:"paragraph",data:{text:o.toMarkdown(D)}}]},s.states=v,s.cmdQueue=new c;var M;this.scope=function(){return s},this.closing=function(){var e=this.scope().options;M&&("inline"===e.toolbar.style?e.target.empty():M.close())},s.getParagraph=function(){return s.editor.blocks[0]},s.getEditorElement=function(){return s.getParagraph().getTextBlock()},s.destroy=function(){S(),s.destroyComponent()},s.calculateUsage=function(){var e=s.getEditorElement()[0];s.usage=Math.min(100,(e.textContent.length/h.textImage*100).toFixed(0)),s.showUsage=s.usage>=90},s.refreshState=function(){s.currentRange&&r.$apply(s,function(){s.calculateUsage();var e=w();Object.keys(s.states).forEach(function(t){s.states[t]=o.Formatters[t].isActive(e)});var t;s.currentRange&&void 0!==(t=document.queryCommandValue("foreColor"))&&(t=n.normalizeToHex(t)),s.color=t||"#545352";var r,l;s.currentRange&&((l=i.getParentElementWithAttribute(s.currentRange.endContainer,"font","size"))&&(r=l.getAttribute("size"),r=a.htmlSizeToMarkdownSize[r],r=a.markdownSizeToHtmlSize[r]),"undefined"===r&&(r=null),l||r||"<br>"!==s.currentRange.endContainer.innerHTML&&!s.currentRange.endContainer.textContent||(s.fontSize=3)),r?s.fontSize=r:r||s.fontSize||(s.fontSize=3)})},s.saveRange=function(){var e=u.getRange();s.currentRange=e?e.cloneRange():null},s.restoreRange=function(){if(s.currentRange){var e=u.getRange();e?e&&(u.rangeEquals(e,s.currentRange)||u.addRange(s.currentRange,!0)):u.addRange(s.currentRange,!0)}},s.saveScroll=function(){s.currentScrollTop=s.getEditorElement()[0].scrollTop},s.restoreScroll=function(){s.currentScrollTop&&(s.getEditorElement()[0].scrollTop=s.currentScrollTop)},s.setJustify=function(e){s.focus(),s.restoreScroll(),s.restoreRange(),s.execCustom({cmd:e}),s.saveRange(),s.refreshState()},s.setBIU=function(e){s.focus(),s.restoreScroll(),s.restoreRange(),s.states[e]=!s.states[e],s.currentRange.collapsed?s.cmdQueue.remove(e)||s.cmdQueue.push({cmd:e}):s.execCustom({cmd:e}),s.saveRange()},s.setFontSize=function(e){s.focus(),s.restoreScroll(),s.restoreRange(),s.currentRange.collapsed?(s.cmdQueue.remove("fontSize"),s.cmdQueue.push({param:e,cmd:"fontSize"})):s.execCustom({param:e,cmd:"fontSize"}),s.saveRange(),s.fontSize=e},s.setColor=function(e){s.focus(),s.restoreScroll(),s.restoreRange(),s.currentRange.collapsed?(s.cmdQueue.remove("foreColor"),s.cmdQueue.push({param:e,cmd:"foreColor"})):s.execCustom({param:e,cmd:"foreColor"}),s.saveRange(),s.color=e},s.insertImage=function(e,t){e=d.addBasePath(e),t=d.addBasePath(t),s.focus(),s.restoreRange(),s.execCustom({param:e,cmd:"insertImage"}),s.options.insertedImages.push({url:e,urlDef:t}),s.saveRange(),s.focus()},s.insertLink=function(e,t,n){t?u.addRange(t,!0):s.restoreRange(),s.focus(),s.execCustom({url:e,cmd:n.cmd,formatter:n.formatter}),s.saveRange(),s.refreshState()},s.removeLink=function(e){u.addRange(e,!0),s.execCustom({cmd:"unlink",range:e}),s.saveRange(),s.refreshState(),s.focus()},s.execCustom=function(e){var n=o.Formatters[e.formatter||e.cmd];t.isUndefined(n)||(!t.isUndefined(n.onClick)&&t.isFunction(n.onClick)?n.onClick(e):document.execCommand(e.cmd,!1,e.param))},s.focus=function(){s.getEditorElement().focus()},b(function(){s.editor=new o.Editor({el:y.find("textarea"),defaultType:"paragraph",onEditorRender:function(){var e=y.find(".st-text-block");_(e),"function"==typeof s.options.onOpen&&s.options.onOpen(s),s.options.toolbar&&C(),b(function(){s.refreshState()})}})}),s.$on("$destroy",function(){S(),e(y.find(".st-text-block")).off("DOMNodeInserted.autoDirection"),e("body").off(".texttool"),e(document).off(".texttool")})}],template:s}}),define("client.services/media-tool/media-tool-service",["qvangular","sirtrevor","client.services/media-tool/media-tool"],function(e,t,n){return e.service("qvMediaTool",[function(){var i,r,o,s,a={};return a.show=function(e,t){s=t,i=e.showComponent(n,{options:t})},a.hide=function(){i&&(i.scope().destroy(),i=null,s=null)},a.closing=function(){i&&i.closing()},a.isActive=function(){return s&&"function"==typeof s.isActive?s.isActive():!!i},a.getCurrentLayout=function(){return r},a.useImageArray=function(){return o},a.getOptions=function(){return s||{}},a.getMarkdown=function(){var e,t=i.scope().getParagraph();return t&&(e=t.saveAndGetData())?e.text:null},a.hasContent=function(e){return e&&"^[\n](left)"!==e},a.getParagraph=function(){return i.scope().getParagraph()},a.getEditorElement=function(){return i.scope().getEditorElement()},a.getRange=function(){return i.scope().currentRange},a.toHTML=function(n,i,s){var a=e.getService("$sce");if(r=i,o=s,n){var l=t.toHTML(n);return n=t.toMarkdown(l),a.getTrustedHtml(t.toHTML(n))}return""},a.toMarkdown=function(e){return e?t.toMarkdown(e):""},a}])}),define("extensions.qliktech/map/map-properties",["client.utils/property-resolver","client.services/media-tool/media-tool-service","core.utils/help-url","client.property-panel/default-properties","client.utils/default-property-logic","core.utils/feature-flags"],function(e,t,n,i,r,o){function s(e){if(!e||e.qLibraryId)return!1;var t=e.qDef.qFieldDefs[0];return t&&t.length&&"="===t[0]}function a(t){var n=e.getValue(t,"color.auto"),i=e.getValue(t,"color.mode"),r=e.getValue(t,"color.expressionIsColor");return n||"primary"===i||"byExpression"===i&&(r||void 0===r)}function l(t){return"byExpression"===e.getValue(t,"color.mode")&&!1===e.getValue(t,"color.expressionIsColor")}function c(t){return"byExpression"===e.getValue(t,"color.mode")&&!0===e.getValue(t,"color.expressionIsColor")}var u=[{value:"primary",translation:"properties.colorMode.primary"},{value:"byDimension",translation:"properties.colorMode.byDimension"}],h=u.concat({value:"byMeasure",translation:"properties.colorMode.byMeasure"}).concat({value:"byExpression",translation:"properties.colorMode.byExpression"}),d={component:"text",translation:"Common.Dimension",style:"sHeader"},p={component:"text",translation:"Common.Measure",style:"sHeader"},f={ref:"qHyperCubeDef.qDimensions.0.qDef.qFieldDefs.0",type:"string",component:"expression",expressionType:"dimension",translation:"Common.Field",show:function(e){var t=e.qHyperCubeDef.qDimensions[0];return!t||!t.qLibraryId},readOnly:!0},m={type:"string",ref:"qHyperCubeDef.qDimensions.0.qLibraryId",component:"library-item",libraryItemType:"dimension",translation:"Common.Dimension",show:function(e){var t=e.qHyperCubeDef.qDimensions[0];return t&&t.qLibraryId}},g={type:"string",ref:"qHyperCubeDef.qMeasures.0.qLibraryId",component:"library-item",libraryItemType:"measure",translation:"Common.Measure",show:function(e){var t=e.qHyperCubeDef.qMeasures[0];return t&&t.qLibraryId}},v={ref:"qHyperCubeDef.qMeasures.0.qDef.qLabel",type:"string",translation:"Common.Label",show:function(e){var t=e.qHyperCubeDef.qMeasures[0];return!t||!t.qLibraryId}},y={type:"items",items:{firstMeasureScope:{ref:"qHyperCubeDef.qMeasures.0",component:"scope",item:i.data.items.measures.items.numberFormatting}},show:function(e){return!!e.qHyperCubeDef.qMeasures[0]}},b={type:"boolean",ref:"qHyperCubeDef.qSuppressZero",defaultValue:!1,translation:"properties.hyperCube.showZero",inverted:!0,show:function(e){return!!e.qHyperCubeDef.qMeasures[0]}},x={ref:"layers",type:"array",translation:"Common.Data",addTranslation:"properties.layers.add",component:"map-layers",allowMove:!0,max:1,items:{polygon3Layer:{type:"items",component:"expandable-items",sourceType:"polygon3Layer",grouped:!0,items:{dimensions:{type:"items",items:{text:d,field:f,libraryDimension:m,geodata:{ref:"geodata.qHyperCubeDef.qMeasures.0.qDef.qDef",type:"string",translation:"properties.layers.regionData",component:"expression",expressionType:"measure",show:function(e){return e&&e.qHyperCubeDef&&e.qHyperCubeDef.qDimensions&&s(e.qHyperCubeDef.qDimensions[0])}},nullSuppression:{type:"boolean",ref:"geodata.qHyperCubeDef.qDimensions.0.qNullSuppression",defaultValue:!1,translation:"properties.dimensions.showNull",inverted:!0,change:function(t){var n=e.getValue(t,"geodata.qHyperCubeDef.qDimensions.0.qNullSuppression");e.setValue(t,"qHyperCubeDef.qDimensions.0.qNullSuppression",n)}},showExcluded:{type:"boolean",ref:"showExcluded",defaultValue:!0,translation:"properties.dimensions.showExcluded",change:function(t){var n=t.showExcluded,i=e.getValue(t,"geodata.qHyperCubeDef.qMeasures.0.qDef.qDef");-1!==i.indexOf("GeoReduceGeometry(")&&(n&&-1===i.indexOf("{1}")?i=i.replace("GeoReduceGeometry(","GeoReduceGeometry({1}"):n||-1===i.indexOf("{1}")||(i=i.replace("GeoReduceGeometry({1}","GeoReduceGeometry(")),e.setValue(t,"geodata.qHyperCubeDef.qMeasures.0.qDef.qDef",i))}}}},appearance:{type:"items",items:{opacity:{ref:"opacity",type:"number",translation:"properties.opacity",component:"slider",min:0,max:1,step:.05,defaultValue:1},show:{type:"boolean",ref:"show",translation:"Common.Show",show:function(t,n,i){return e.getValue(i.properties,"background.show",!1)}}}}}},pointLayer:{type:"items",component:"expandable-items",grouped:!0,items:{dimensions:{type:"items",items:{text:d,field:f,libraryDimension:m,geodata:{ref:"qHyperCubeDef.qDimensions.1.qDef.qFieldDefs.0",type:"string",component:"expression",expressionType:"dimension",translation:"properties.layers.pointData",change:function(e){var t=e.qHyperCubeDef.qDimensions[1].qDef;t.qFieldLabels||(t.qFieldLabels=[]),t.qFieldLabels[0]=t.qFieldDefs[0]},show:function(e){return e&&e.qHyperCubeDef&&e.qHyperCubeDef.qDimensions&&s(e.qHyperCubeDef.qDimensions[0])}},nullSuppression:{type:"boolean",ref:"qHyperCubeDef.qDimensions.0.qNullSuppression",defaultValue:!1,translation:"properties.dimensions.showNull",inverted:!0}}},measure:{type:"items",items:{text:p,expression:{ref:"qHyperCubeDef.qMeasures.0.qDef.qDef",type:"string",translation:"Common.Expression",component:"expression",expressionType:"measure",change:function(e){var t=e.qHyperCubeDef.qMeasures[0];t&&""===t.qDef.qDef?(e.qHyperCubeDef.qMeasures.length=0,2===e.qHyperCubeDef.qInterColumnSortOrder[0]&&e.qHyperCubeDef.qInterColumnSortOrder.splice(0,1)):(t.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},2!==e.qHyperCubeDef.qInterColumnSortOrder[0]&&e.qHyperCubeDef.qInterColumnSortOrder.splice(0,0,2))},show:function(e){var t=e.qHyperCubeDef.qMeasures[0];return!t||!t.qLibraryId}},libraryMeasure:g,label:v,numberFormatting:y,suppressZero:b,bubbleSizes:{ref:"bubbleSizes",type:"integer",translation:"properties.dataPoints.bubbleSizes",component:"slider",min:1,max:32,step:1,defaultValue:8,show:function(e){return!e.qHyperCubeDef.qMeasures[0]}},rangeBubbleSizes:{ref:"rangeBubbleSizes",type:"array",translation:"properties.dataPoints.bubbleSizes",component:"slider",min:1,max:32,step:1,defaultValue:[1,32],show:function(e){return e.qHyperCubeDef.qMeasures[0]}},customRange:{type:"items",items:{autoMinMax:{ref:"autoMinMax",type:"boolean",translation:"properties.axis.range",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],defaultValue:!0,show:function(e){return e.qHyperCubeDef.qMeasures[0]}},customMin:{ref:"customMin",translation:"properties.axis.min",expression:"optional",type:"number",defaultValue:0,show:function(e){return e.qHyperCubeDef.qMeasures[0]&&!1===e.autoMinMax},invalid:function(t){return"minMax"===e.getValue(t,"minMax")&&e.getValue(t,"customMin")>=e.getValue(t,"customMax")}},customMax:{ref:"customMax",translation:"Common.Max",expression:"optional",type:"number",defaultValue:10,show:function(e){return e.qHyperCubeDef.qMeasures[0]&&!1===e.autoMinMax},invalid:function(t){return"minMax"===e.getValue(t,"minMax")&&e.getValue(t,"customMin")>=e.getValue(t,"customMax")}}}}}},appearance:{type:"items",items:{opacity:{ref:"opacity",type:"number",translation:"properties.opacity",component:"slider",min:0,max:1,step:.05,defaultValue:1},show:{ref:"show",type:"boolean",translation:"Common.Show",show:function(t,n,i){return e.getValue(i.properties,"background.show",!1)}}}}}}}};o.MAP_MEASURE_LABEL&&(x.items.polygon3Layer.items.measure={type:"items",items:{text:p,expression:{ref:"qHyperCubeDef.qMeasures.0.qDef.qDef",type:"string",translation:"Common.Expression",component:"expression",expressionType:"measure",change:function(t,n,i){var r=t.qHyperCubeDef.qMeasures[0],o=i.layers.indexOf(t);if(r&&""===r.qDef.qDef)"byMeasure"!==e.getValue(i,"color.mode")&&"byExpression"!==e.getValue(i,"color.mode")||(e.setValue(i,"color.mode","primary"),!1===e.getValue(i,"color.auto")&&e.setValue(i,"color.auto",!0));else{r.qSortBy={qSortByLoadOrder:1};var s=i.layers[o].measureDef;s=void 0!==s?s.trim():"",i.color.auto&&"primary"===i.color.mode&&""===s&&(i.color.auto=!1,i.color.mode="byMeasure")}i.layers[o].measureDef=t.qHyperCubeDef.qMeasures[0].qDef.qDef},show:function(e){var t=e.qHyperCubeDef.qMeasures[0];return!t||!t.qLibraryId}},libraryMeasure:g,label:v,numberFormatting:y,suppressZero:b}});var q={component:"items",type:"items",translation:"properties.background",grouped:!0,items:{show:{ref:"background.show",type:"boolean",translation:"properties.show",component:"switch",options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],defaultValue:!1,change:function(t){t.layers.length&&!t.background.show&&(t.layers[0].show=!0),t.background&&t.background.show&&void 0===t.background.defaultMapService&&e.setValue(t,"background.defaultMapService",!0)}},baseLayers:{type:"items",show:function(t){return e.getValue(t,"background.show")},items:{defaultMapService:{ref:"background.defaultMapService",type:"boolean",translation:"properties.mapService",component:"switch",defaultValue:!0,undefinedValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},customMapService:{type:"items",items:{type:{ref:"background.layers.0.type",type:"string",translation:"properties.type",component:"dropdown",options:[{translation:"properties.layers.type.slippy",value:"XYZ"}],defaultValue:"XYZ"},urls:{ref:"background.layers.0.urls.0",type:"string",translation:"Common.URL",minlength:1},attribution:{ref:"background.layers.0.attribution",type:"string",translation:"properties.attribution",component:"textarea",maxlength:1024,convertFunctions:{get:function(e,n){var i=e(n.type);return t.toHTML(i)},set:function(e,n,i){var r=t.toMarkdown(e);n(i.type,r)}}},helpLink:{component:"link",url:function(){return n.path+"map.htm"},translation:"properties.background.help"}},show:function(t){return!e.getValue(t,"background.defaultMapService")}}}}}},C=r.getLogicFor("hard","default");return{type:"items",component:"accordion",items:{data:x,background:q,addons:{type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{calcCond:{uses:"calcCond",ref:"",oldCondRef:"calcCond",condChange:function(e,t,n){t.rippleToHyperCubes("qCalcCond",n.calcCond),t.rippleToHyperCubes("qCalcCondition.qCond",n.qCalcCondition.qCond)},msgChange:function(e,t,n){t.rippleToHyperCubes("customErrorMessage.calcCond",n.customErrorMessage.calcCond),t.rippleToHyperCubes("qCalcCondition.qMsg",n.qCalcCondition.qMsg)}},suppressZero:null}}}},settings:{uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{showNavigation:{ref:"navigation",type:"boolean",translation:"Common.Navigation",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},autoZoomOnSelection:{ref:"autoZoomOnSelection",type:"boolean",defaultValue:!0,translation:"properties.autoZoomOnSelection",show:function(e){return e&&e.layers&&e.layers[0]&&"point"===e.layers[0].type}}}},colorsAndLegend:{uses:"colorsAndLegend",items:{colors:{items:{colorMode:{options:function(e,t){var n=t.getDimensions(),i=n?n.length:0;switch(t.getLayerTypeAndVersion()[0]){case"point":case"polygon":return i>0?h:u}return u},globalChange:function(e,t){C.color.colorBy.globalChange(e,t,"layers.0.qHyperCubeDef.")}},persistentColors:{show:function(t){return!(e.getValue(t,"color.auto")||"byDimension"!==e.getValue(t,"color.mode")||"point"===t.layers[0].type||"polygon"===t.layers[0].type&&"2"===t.layers[0].version)}},baseMeasureColors:{type:"items",show:!1,items:{useBaseColor:{ref:"color.useBaseColors",show:!1,defaultValue:"off"}}},attributeExpression:{ref:"layers.0.qHyperCubeDef.qDimensions.0.qAttributeExpressions.0.qExpression",change:function(t){var n=e.getValue(t,"layers.0.qHyperCubeDef.qDimensions.0.qAttributeExpressions.0"),i=e.getValue(t,"color");n&&(n.id="colorByExpression",i&&(i.colorExpression=n.qExpression))},globalChange:function(t){var n,i,r,o=e.getValue(t,"layers.0.qHyperCubeDef.qDimensions",[]),s=e.getValue(t,"layers.0.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions",[]),a=null,l=function(e,t){"colorByExpression"===e.id&&(i=t)};if(o.length+s.length>1){for(n=s.length-1;n>=0;--n)r=s[n].qAttributeExpressions||[],i=-1,r.every(l),i>=0&&(a=r.splice(i,1)[0]);for(n=o.length-1;n>=0;--n)r=o[n].qAttributeExpressions||[],i=-1,r.every(l),i>=0&&(a=r.splice(i,1)[0]);!o[0].qAttributeExpressions&&a&&(o[0].qAttributeExpressions=[]),a&&o[0].qAttributeExpressions.splice(0,0,a)}o.forEach(function(e){e.qAttributeExpressions&&e.qAttributeExpressions.length>1&&e.qAttributeExpressions.splice(0,e.qAttributeExpressions.length-1)});var c=e.getValue(t,"color.colorExpression");1!==o.length||o[0].qAttributeExpressions&&0!==o[0].qAttributeExpressions.length||!c||(o[0].qAttributeExpressions=[{qExpression:c,id:"colorByExpression"}])},show:function(t,n){var i=e.getValue(t,"layers.0.qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),r=e.getValue(t,"layers.0.qHyperCubeDef.qDimensions.0.qAttributeExpressions.0");return i&&!r&&e.setValue(t,"layers.0.qHyperCubeDef.qDimensions.0.qAttributeExpressions.0",i),!e.getValue(t,"color.auto")&&"byExpression"===e.getValue(t,"color.mode")&&n.getDimensions().length>0}},expressionIsColor:{show:function(t,n){return!e.getValue(t,"color.auto")&&"byExpression"===e.getValue(t,"color.mode")&&n.getDimensions().length>0}},expressionLabel:{change:function(t){var n=e.getValue(t,"layers.0.qHyperCubeDef.qMeasures.0.qAttributeExpressions.0"),i=e.getValue(t,"color");n&&(n.label=e.getValue(t,"color.expressionLabel"),i&&(i.colorExpression=n.qExpression))},show:function(t,n){return!e.getValue(t,"color.auto")&&l(t)&&n.getDimensions().length>0}}}},legend:{show:function(e){return!a(e)},items:{showTitle:{show:function(t){return e.getValue(t,"legend.show")&&!a(t)&&!c(t)}},dock:{show:function(t){return e.getValue(t,"legend.show")&&!a(t)}}}}}}}}}}}),define("extensions.qliktech/map/projection/mercator-projection",["core.utils/class","general.utils/shapes/point"],function(e,t){var n=Math.PI,i=n/2,r=n/4,o=n/180,s=Math.max,a=Math.min,l=85.0511287798059*o,c=180/n;return e.extend("MercatorProjection",{init:function(){},getProjectionType:function(){return"Mercator"},project:function(e){if(e){var n=e.x%360,i=e.y%180,u=s(a(i*o,l),-l),h=n*o-0,d=Math.log(Math.tan(r+u/2));return h*=c,d*=c,new t(h,d)}},invProject:function(e){if(e){var n=e.x*o,r=e.y*o,s=n+0,a=2*Math.atan(Math.pow(Math.E,r))-i;return s*=c,a*=c,new t(s,a)}}})}),define("extensions.qliktech/map/projection/viewport-projection-mercator",["objects.views/charts/utils/viewport-projection","general.utils/shapes/point","extensions.qliktech/map/projection/mercator-projection","general.utils/shapes/rect"],function(e,t,n,i){var r=new t(0,0);return e.extend("ViewportProjectionMercator",{init:function(){this._super(),this._boundingBox=new i(-180,-180,360,360),this.helpFunctions.updateProjectedDataBoundingBox.call(this),this._mercatorProjection=new n,this._mirrorYAxis=!0},getMercatorProjection:function(){return this._mercatorProjection},setMapCenterInLatLong:function(e){if(!e)return!1;var t,n;return t=this._mercatorProjection.project(e),n=this._projection.invProject(t),this.setDataCenter(n)},getMapCenterInLatLong:function(){var e;return e=this._projection.project(this._currentDataCenter),this._mercatorProjection.invProject(e)},fromLatLongToViewport:function(e){var t;return t=this._mercatorProjection.project(e),this.transform(t)},fromLatLongRectToViewportRect:function(e){var n,r;return n=this.fromLatLongToViewport(new t(e.x,e.y)),r=this.fromLatLongToViewport(new t(e.x+e.width,e.y+e.height)),new i(n.x,n.y,r.x-n.x,r.y-n.y)},fromViewportToLatLong:function(e){var t;return t=this.invTransform(e),this._mercatorProjection.invProject(t)},fromViewportRectToLatLongRect:function(e){var n,r;return n=this.fromViewportToLatLong(new t(e.x,e.y)),r=this.fromViewportToLatLong(new t(e.x+e.width,e.y+e.height)),new i(n.x,n.y,r.x-n.x,r.y-n.y)},fromLatLongToPixel:function(e,n){var i,r,o,s=Math.pow(2,n+7);return i=this._mercatorProjection.project(e),r=this.helpFunctions.translateProjectedDataCenterToZeroPoint.call(this,i),o=this.helpFunctions.scaleProjectedDataToZoomLevel.apply(this,[r,n]),new t(o.x+s,s-o.y)},fromPixelToLatLong:function(e,n){var i,r,o,s=Math.pow(2,n+7);return o=new t(e.x-s,s-e.y),r=this.helpFunctions.invScaleProjectedDataToZoomLevel.apply(this,[o,n]),i=this.helpFunctions.invTranslateProjectedDataCenterToZeroPoint.call(this,r),this._mercatorProjection.invProject(i)},getViewRectangleInLatLong:function(){var e,t;return e=this.fromViewportToLatLong(r),t=this.fromViewportToLatLong(this._viewportSize),new i(Math.min(e.x,t.x),Math.min(e.y,t.y),Math.abs(e.x-t.x),Math.abs(e.y-t.y))}})}),define("extensions.qliktech/map/map-layer",["objects.views/charts/components/chart-component","objects.views/charts/utils/canvas-renderer"],function(e,t){"use strict";function n(){this._viewportProjectionChanged=!0,this._shouldPaintOnDataChanged||this.invalidateDisplay("onViewportProjectionChanged")}function i(){this._viewportProjectionChanged=!0,this.paint()}function r(){void 0!==this._layerData.opacity&&(this.container.style.opacity=this._layerData.opacity,this.container.style.filter="alpha(opacity="+100*this._layerData.opacity+")")}function o(){this._toggledOnCacheItems.forEach(function(e){e.selected=!1}),this._toggledOnCacheItems=[],this._selectedRows=[]}function s(e){var t=this,n=this._toggledOnCacheItems.map(function(e){return e.row});this.updateBackendApi(),this.backendApi.select("selectHyperCubeCells",this._layerPath,n,e).then(function(e){t._selectionFailed=!e,t._selectionFailed&&o.call(t)})}return e.extend("MapLayer",{init:function(){this._super.apply(this,arguments),this._viewportProjectionChanged=!1,this._data=void 0,this._layerData=void 0,this._qData=void 0,this._qMatrix=void 0,this._qSelectionInfo=void 0,this._numItems=0,this._layoutMode=void 0,this._selectableShapes=[],this._shapes=[],this._cacheItems=[],this._colorMap=void 0,this._layerS2Bounds=void 0,this._cacheItems=null,this._renderer=new t(this.container),this._firstAutoZoomed=!1,this._numPoints=0,this._toggledOnCacheItems=[],this._selectedRows=[]},setData:function(e,t){this._skipInvalidateOnGlobalOpacityChange=!0,this._data=e,this._layerData=t,this._toggledOnCacheItems=[],this._selectedRows=[],!!this._layerData&&this._layerData.show?this.showComponent():this.hideComponent(),this._qSelectionInfo=this._data?this._data.qSelectionInfo:void 0,r.call(this)},getData:function(){return this._data},getLayerData:function(){return this._layerData},setLayerIndex:function(e){this._layerIndex=e},getLayerIndex:function(){return this._layerIndex},setLayerType:function(e){this._layerType=e},getLayerType:function(){return this._layerType},setVersion:function(e){this._version=e},getVersion:function(){return this._version},setFirstAutoZoomed:function(e){this._firstAutoZoomed=e},getFirstAutoZoomed:function(){return this._firstAutoZoomed},getLayerPath:function(){return this._layerPath},getNumPoints:function(){return this._numPoints},getLayerBounds:function(){return this._layerS2Bounds},setViewportProjection:function(e){this._viewportProjection!==e&&(this._viewportProjection&&(this._viewportProjection.stopListen("changed",n,this),this._viewportProjection.stopListen("changedByInteraction",i,this)),this._viewportProjection=e,this._viewportProjection&&(this._viewportProjection.listen("changed",n,this),this._viewportProjection.listen("changedByInteraction",i,this)))},setBackendApi:function(e){this.backendApi=e},setSelectionsApi:function(e){this.selectionsApi=e},setColorMap:function(e){this._colorMap=e},getColorMap:function(){return this._colorMap},getLayerOutputData:function(){return this._layerData?{color:this._data.color,legend:this._data.legend,qSelectionInfo:this._data.qSelectionInfo,qHyperCube:this._layerData.qHyperCube}:void 0},getMeasureInfo:function(){if(this._layerData)return this._layerData.qHyperCube.qMeasureInfo},getSelectedRows:function(){return this._toggleOnCacheItemsChanged&&(this._selectedRows=this._toggledOnCacheItems.map(function(e){return e.row}),this._toggleOnCacheItemsChanged=!1),this._selectedRows},setGlobalOpacity:function(e,t){var n=this;this._skipInvalidateOnGlobalOpacityChange=!1,this._globalAlpha=e,t||setTimeout(function(){n._skipInvalidateOnGlobalOpacityChange||(o.call(n),n.invalidateDisplay("MapLayer.setGlobalOpacity"),n._skipInvalidateOnGlobalOpacityChange=!0)},100)},setPreselectionMode:function(e){this._preselectionMode=e},toggleShapes:function(e){var t,n,i,r=e?e.length:0;if(this.isVisible()&&0!==r)for(this._skipInvalidateOnGlobalOpacityChange=!0,t=0;t<r;t++)(-3===(i=e[t]).id||i.id>=0)&&(i.selected&&this._toggledOnCacheItems.indexOf(i)<0?(this._toggledOnCacheItems[this._toggledOnCacheItems.length]=i,this._toggleOnCacheItemsChanged=!0):i.selected||(n=this._toggledOnCacheItems.indexOf(i))>=0&&(this._toggledOnCacheItems.splice(n,1),this._toggleOnCacheItemsChanged=!0))},selectOnLayer:function(e,t){this.isVisible()&&(this._toggledOnCacheItems.length?s.call(this,t):e&&e.length&&e.every(function(e){return!e.selected})&&this.clearSelections())},clearSelections:function(){this.updateBackendApi(),this.selectionsApi.clear()},updateBackendApi:function(){this.backendApi&&this.backendApi.path!==this._layerPath&&(this.backendApi.path=this._layerPath,this.backendApi.path&&(this.backendApi.dataPath=this.backendApi.path.slice(1,-3)))},afterPaint:function(){},clear:function(){this._renderer&&this._renderer.shapes&&this._renderer.shapes.length&&(this._renderer.shapes=[],this._renderer.render(),this.afterPaint())},updateSize:function(){this._super(),this.rect.x*=this.layoutToContainerRatios.x||1,this.rect.width*=this.layoutToContainerRatios.x||1,this.rect.y*=this.layoutToContainerRatios.y||1,this.rect.height*=this.layoutToContainerRatios.y||1,this.layoutToContainerRatios={x:1,y:1};for(var e in this.renderers)this.renderers[e].setDimensions(0,0,this.rect.width,this.rect.height),this.renderers[e].setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y);this._windowSizeMultiplier=Math.min(Math.min(this.rect.width,this.rect.height)/600,1)},release:function(){this._super(),this._viewportProjection&&(this._viewportProjection.stopListen("changed"),this._viewportProjection.stopListen("changedByInteraction")),this._viewportProjection=null,this.backendApi=null}})}),define("extensions.qliktech/map/geo-region",["general.utils/shapes/rect","general.utils/shapes/geometry-math"],function(e,t){"use strict";function n(e,t){var n=e?e.length:0,i=[];this._id=t,0!==n?this.setGeoPolygons(e):this.setGeoPolygons(i)}return n.prototype={setId:function(e){this._id=e},getId:function(){return this._id},setGeoPolygons:function(e){this.geopolygons!==e&&(this.geopolygons=e,this._numGeoPolygons=this.geopolygons?this.geopolygons.length:0,this._numPoints=0,this._centerPoint=null,this._boundsNeedToUpdate=!0,this._pointsNeedToUpdate=!0,this._numPointsNeedToUpdate=!0)},validateGeoPolygons:function(){var e;for(e=0;e<this._numGeoPolygons;e++)this.geopolygons[e].validatePolygons()},getGeoPolygons:function(){return this.geopolygons},getNumGeoPolygons:function(){return this._numGeoPolygons},getNumPoints:function(){if(this._numPointsNeedToUpdate){var e,t=0;for(e=0;e<this._numGeoPolygons;e++)t+=this.geopolygons[e].getNumPoints();this._numPoints=t,this._numPointsNeedToUpdate=!1}return this._numPoints},getPoints:function(){if(this._pointsNeedToUpdate){this.points=[];var e;for(e=0;e<this._numGeoPolygons;e++)this.geopolygons[e]&&(this.points=this.points.concat(this.geopolygons[e].getPoints()))}return this.points},pointInside:function(e,t){if(this.calculateBounds(),void 0===this._bounds||e<=this._bounds.x||e>=this._bounds.x+this._bounds.width||t<=this._bounds.y||t>=this._bounds.y+this._bounds.height)return!1;var n;for(n=0;n<this._numGeoPolygons;n++)if(this.geopolygons[n].pointInside(e,t))return!0;return!1},intersectsLine:function(e){if(!e)return!1;var t;for(t=0;t<this._numGeoPolygons;t++)if(this.geopolygons[t].intersectsLine(e))return!0;return!1},intersectsRect:function(e){if(!e)return!1;var t;for(t=0;t<this._numGeoPolygons;t++)if(this.geopolygons[t].intersectsRect(e))return!0;return!1},calculateBounds:function(){if(this._boundsNeedToUpdate||!this._bounds){if(this._boundsNeedToUpdate=!1,0===this._numGeoPolygons)return null;var n=t.calculateBounds(this.geopolygons);this._bounds=new e(n.x,n.y,n.width,n.height)}return this._bounds},getBoundingRect:function(){return this.calculateBounds()},toString:function(){var e,t="";for(e=0;e<this._numGeoPolygons-1;e++)t+=this.geopolygons[e].toString()+";";return t+=this.geopolygons[this._numGeoPolygons-1].toString()}},n}),define("extensions.qliktech/map/geo-regions-data",["core.utils/class","general.utils/shapes/point","general.utils/shapes/rect","general.utils/shapes/geometry-math","objects.views/charts/utils/unit-projection"],function(e,t,n,i,r){function o(){var e,t,n,i,r,o,s,a,l,c;for(this._projectedGeoRegions&&this._projectedGeoRegions.length===this._numGeoRegions||(this._projectedGeoRegions=new Array(this._numGeoRegions)),e=0;e<this._numGeoRegions;e++)for(o=(r=this._geoRegions[e].getGeoPolygons())?r.length:0,this._projectedGeoRegions[e]&&this._projectedGeoRegions[e].length===o||(this._projectedGeoRegions[e]=new Array(o)),t=0;t<o;t++)for(a=(s=r[t].getPolygons())?s.length:0,this._projectedGeoRegions[e][t]&&this._projectedGeoRegions[e][t].length===a||(this._projectedGeoRegions[e][t]=new Array(a)),n=0;n<a;n++)for(c=(l=s[n].points)?l.length:0,this._projectedGeoRegions[e][t][n]&&this._projectedGeoRegions[e][t][n].length===c||(this._projectedGeoRegions[e][t][n]=new Array(c)),i=0;i<c;i++)this._projectedGeoRegions[e][t][n][i]=this._projection.project(l[i])}function s(){var e;for(this._regionIdToRegionIndexMapping={},e=0;e<this._numGeoRegions;e++)this._regionIdToRegionIndexMapping[this._geoRegions[e].getId()]=e}return e.extend("GeoRegionsData",{init:function(){this._numGeoRegions=0,this._mapBoundsNeedToUpdate=!0,this._projectedMapBoundsNeedToUpdate=!0,this._regionIdToRegionIndexMappingNeedToUpdate=!0,this._projectedGeoRegionsNeedToUpdate=!1,this._projection=new r,this._numPointsNeedToUpdate=!0},getNumGeoRegions:function(){return this._numGeoRegions},getNumPoints:function(){if(this._numPointsNeedToUpdate){var e,t=0;for(e=0;e<this._numGeoRegions;e++)t+=this._geoRegions[e].getNumPoints();this._numPoints=t,this._numPointsNeedToUpdate=!1}return this._numPoints},setGeoRegions:function(e){this._geoRegions=e,this._numGeoRegions=this._geoRegions?this._geoRegions.length:0,this._projectedGeoRegionsNeedToUpdate=!0,this._mapBoundsNeedToUpdate=!0,this._projectedMapBoundsNeedToUpdate=!0,this._regionIdToRegionIndexMappingNeedToUpdate=!0},getGeoRegions:function(){return this._geoRegions},getGeoRegionById:function(e){this._regionIdToRegionIndexMappingNeedToUpdate&&(s.call(this),this._regionIdToRegionIndexMappingNeedToUpdate=!1);var t=this._regionIdToRegionIndexMapping[e];return this._geoRegions[t]},setProjection:function(e){this._projection&&e&&this._projection.getProjectionType()===e.getProjectionType()||(this._projection=e,this._projectedGeoRegionsNeedToUpdate=!0,this._projectedMapBoundsNeedToUpdate=!0)},getProjection:function(){return this._projection},getProjectedGeoRegions:function(){return this._projectedGeoRegionsNeedToUpdate&&this._projection&&(o.call(this),this._projectedGeoRegionsNeedToUpdate=!1),this._projectedGeoRegions},getProjectedGeoRegionById:function(e){this._regionIdToRegionIndexMappingNeedToUpdate&&(s.call(this),this._regionIdToRegionIndexMappingNeedToUpdate=!1),this._projectedGeoRegionsNeedToUpdate&&this._projection&&(o.call(this),this._projectedGeoRegionsNeedToUpdate=!1);var t=this._regionIdToRegionIndexMapping[e];return this._projectedGeoRegions[t]},calculateBounds:function(){if(this._mapBoundsNeedToUpdate){this._mapBoundsNeedToUpdate=!1;var e=i.calculateBounds(this._geoRegions);this._mapBounds=e?new n(e.x,e.y,e.width,e.height):null}return this._mapBounds},calculateProjectedBounds:function(){if(this._projectedMapBoundsNeedToUpdate){this._projectedMapBoundsNeedToUpdate=!1;var e,i,r=this.calculateBounds();r?(e=this._projection.project(new t(r.x,r.y)),i=this._projection.project(new t(r.x+r.width,r.y+r.height)),this._projectedMapBounds=new n(e.x,e.y,i.x-e.x,i.y-e.y)):this._projectedMapBounds=null}return this._projectedMapBounds},calculateBoundsOfRegionIds:function(e){var t,r,o=e?e.length:0,s=new Array(o);for(t=0;t<o;t++)s[t]=this.getGeoRegionById(e[t]);return r=i.calculateBounds(s),r?new n(r.x,r.y,r.width,r.height):null},calculateProjectedBoundsOfRegionIds:function(e){var i,r,o,s=this.calculateBoundsOfRegionIds(e);return s?(i=this._projection.project(new t(s.x,s.y)),r=this._projection.project(new t(s.x+s.width,s.y+s.height)),o=new n(i.x,i.y,r.x-i.x,r.y-i.y)):o=null,o}})}),define("extensions.qliktech/map/geo-polygon",["general.utils/shapes/polygon","general.utils/shapes/rect","general.utils/shapes/line","general.utils/shapes/point","general.utils/shapes/geometry-math"],function(e,t,n,i,r){"use strict";function o(e){var t,n=e?e.length:0,r=Math.floor(n/2),o=new Array(r);for(t=0;t<r;t++)o[t]=new i(e[2*t],e[2*t+1]);return o}function s(e,t){var n,i=t-1;if(0===t)return-1;for(n=0;n<i;)if(e[n].x+180<m){if(e[n+1].x+180<m)return n;n+=2}else n++;return-1}function a(e,t,n){var i,r;return i=e[n],r=e[n+1],180-Math.abs(i.x)<m&&180-Math.abs(r.x)<m}function l(e,t){return t<0?t+e:t>=e?t-e:t}function c(e,t,n){var i=t-1;if(a(e,t,l(i,n+2))){if(0===n){if(e[t-2].x>=0)return!0}else if(n===t-2){if(e[t-3].x>=0)return!0}else if(e[n-1].x>=0)return!0}else if(a(e,t,l(i,n-2))){if(0===n){if(e[2].x>=0)return!0}else if(n===t-2){if(e[1].x>=0)return!0}else if(e[n+2].x>=0)return!0}else if(0===n){if(e[t-2].x>=0&&e[2].x>=0)return!0}else if(n===t-2){if(e[t-3].x>=0&&e[1].x>=0)return!0}else if(e[n-1].x>=0&&e[n+2].x>=0)return!0;return!1}function u(e,t,n){0===n?(e[n].x=180,e[n+1].x=180,e[t-1].x=180):n===t-2?(e[n].x=180,e[n+1].x=180,e[0].x=180):(e[n].x=180,e[n+1].x=180)}function h(){var e,t=this.calculateBounds(),n=g.length;for(e=0;e<n;e++)if(g[e].rectInside(t))return!0}function d(e){var t,n=e?e.points:null,i=n?n.length:0;(t=s(n,i))<0||c(n,i,t)&&u(n,i,t)}function p(e){var t,n=e?e.length:0;for(t=0;t<n;t++)d(e[t])}function f(t){var n,i=t?t.length:0,r=[];if(0!==i)if(t[0].getPoints)this.setPolygons(t);else{for(n=0;n<i;n++)t[n]&&t[n].length&&r.push(new e(o(t[n])));this.setPolygons(r)}else this.setPolygons(r)}var m=1e-5,g=[new t(-177,-44.5,1,1),new t(-178.6,-30.5,1,1.5)];return f.prototype={setPolygons:function(e){this.polygons!==e&&(this.polygons=e,this._numPolygons=this.polygons?this.polygons.length:0,this._numPoints=0,this._centerPoint=null,this._boundsNeedToUpdate=!0,this._pointsNeedToUpdate=!0,this._numPointsNeedToUpdate=!0)},validatePolygons:function(){p(this.polygons),h.call(this)&&this.translate(360,0)},getPolygons:function(){return this.polygons},getNumPolygons:function(){return this._numPolygons},getPoints:function(){if(this._pointsNeedToUpdate){this.points=[];var e;for(e=0;e<this._numPolygons;e++)this.polygons[e]&&(this.points=this.points.concat(this.polygons[e].getPoints()))}return this.points},getNumPoints:function(){if(this._numPointsNeedToUpdate){var e,t=0;for(e=0;e<this._numPolygons;e++)t+=this.polygons[e].getNumPoints();this._numPoints=t,this._numPointsNeedToUpdate=!1}return this._numPoints},pointInside:function(e,t){if(this.calculateBounds(),void 0===this._bounds||e<=this._bounds.x||e>=this._bounds.x+this._bounds.width||t<=this._bounds.y||t>=this._bounds.y+this._bounds.height)return!1;var n,i,r;if(0===this._numPolygons)return!1;if(this.polygons[0].pointInside(e,t)){for(i=this._innerPolygons?this._innerPolygons.length:0,n=0;n<i;n++)if(this.polygons[this._innerPolygons[n]].pointInside(e,t))return!1;return!0}for(r=this._outerPolygons?this._outerPolygons.length:0,n=0;n<r;n++)if(this.polygons[this._outerPolygons[n]].pointInside(e,t))return!0;return!1},intersectsLine:function(e){if(!e)return!1;if(this.pointInside(e.x1,e.y1)||this.pointInside(e.x2,e.y2))return!0;var t;for(t=0;t<this._numPolygons;t++)if(this.polygons[t].intersectsLine(e))return!0;return!1},intersectsLines:function(e){var t,n=e?e.length:0;for(t=0;t<n;t++)if(this.intersectsLine(e[t]))return!0;return!1},intersectsRect:function(e){if(!e)return!1;if(this.calculateBounds(),!this._bounds)return!1;if(e.rectInside(this._bounds))return!0;if(!this._bounds.intersectsWith(e))return!1;var t,i,r,o,s;return t=e.x,i=e.getRight(),r=e.y,o=e.getBottom(),!!(this.pointInside(t,r)||this.pointInside(i,r)||this.pointInside(i,o)||this.pointInside(t,o))||(s=[new n(t,r,i,r),new n(t,o,i,o),new n(t,r,t,o),new n(i,r,i,o)],this.intersectsLines(s))},calculateBounds:function(){if(this._boundsNeedToUpdate||!this._bounds){if(this._boundsNeedToUpdate=!1,0===this._numPolygons)return null;var e,n,i,o=r.calculateBounds(this.polygons);for(this._bounds=new t(o.x,o.y,o.width,o.height),e=this.polygons[0].calculateBounds(),this._innerPolygons=[],this._outerPolygons=[],i=1;i<this._numPolygons;i++)n=this.polygons[i].calculateBounds(),e.rectInside(n)&&this.polygons[0].pointInside(this.polygons[i].points[0].x,this.polygons[i].points[0].y)?this._innerPolygons.push(i):this._outerPolygons.push(i)}return this._bounds},getBoundingRect:function(){return this.calculateBounds()},translate:function(e,t){if(e||t){for(var n=0;n<this._numPolygons;n++)this.polygons[n].translate(e,t);this._boundsNeedToUpdate=!0}},toString:function(){var e,t="";for(e=0;e<this._numPolygons-1;e++)t+=this.polygons[e].toString()+";";return t+=this.polygons[this._numPolygons-1].toString()}},f}),define("extensions.qliktech/map/map-polygon3-layer",["extensions.qliktech/map/map-layer","objects.views/selections/cache-item-base","general.utils/color","general.utils/shapes/point","general.utils/shapes/polygon","extensions.qliktech/map/geo-region","extensions.qliktech/map/geo-regions-data","extensions.qliktech/map/geo-polygon","core.utils/deferred","general.utils/shapes/geometry-math"],function(e,t,n,i,r,o,s,a,l,c){"use strict";function u(){return this._showExcluded?this._allItemsS2Bounds:h.call(this)}function h(){var e,t=new Array(this._numItems);for(e=0;e<this._numItems;e++)t[e]=this._qMatrix[e][0].qText;return"$mercator"!==this._geoData.qMeasureInfo[0].projection?this._geoRegionsData.calculateProjectedBoundsOfRegionIds(t):this._geoRegionsData.calculateBoundsOfRegionIds(t)}function d(){return this._qData&&this._qData.qDimensionInfo&&this._qData.qDimensionInfo[0]?this._dimensionTitle!==this._qData.qDimensionInfo[0].qFallbackTitle&&(this._dimensionTitle=this._qData.qDimensionInfo[0].qFallbackTitle,!0):void 0!==this._dimensionTitle&&(this._dimensionTitle=void 0,!0)}function p(){var e=this._geoData.qMeasureInfo.length;return JSON.stringify(this._geometryMeasureInfo)!==JSON.stringify(this._geoData.qMeasureInfo[e-1])?(this._geometryMeasureInfo=this._geoData.qMeasureInfo[e-1],!0):!this._rawGeoRegions&&!this._loadingGeometryData}function f(e,t){var n,o=e?e.length:0;if(t)for(n=0;n<o;n++)e[n]=new i((e[n][0]+t)%360,e[n][1]);else for(n=0;n<o;n++)e[n]=new i(e[n][0],e[n][1]);return new r(e)}function m(e,t){var n,i=e?e.length:0,r=new Array(i);for(n=0;n<i;n++)r[n]=f(e[n],t);return new a(r)}function g(e,t){var n,i="-"===t?[]:JSON.parse(t),r=i.length,s=c.getLongitudeAdjustmentForGeoArea(i,64,77,-169);if(s)for(n=0;n<r;n++)i[n]=m(i[n],s[n]);else for(n=0;n<r;n++)i[n]=m(i[n]);return new o(i,e)}function v(e){this._rawGeoRegions=e,this._geoRegionsData.setGeoRegions(e),"$mercator"!==this._geoData.qMeasureInfo[0].projection&&this._geoRegionsData.setProjection(this._viewportProjection.getMercatorProjection()),this._allItemsS2Bounds=this._geoRegionsData.calculateProjectedBounds(),this.fire("boundsChanged",[this]),this._regionsChanged=!0}function y(){var e=this,t=this._layerIndex,n=[{qTop:0,qLeft:0,qWidth:2,qHeight:Math.min(this._geoData.qSize.qcy||C,C)}];this._loadingGeometryData=!0;var i=l();return this.backendApi.getData(n,"/layers/"+t+"/geodata/qHyperCubeDef").then(function(t){if(e.backendApi&&e._viewportProjection){e._loadingGeometryData=!1,e._rawGeoRegions={};var n,r,o,s,a,c=0,u=t?t instanceof Array&&t[0]?t[0].qMatrix:t.qMatrix:void 0;for(a=u?u.length:0,e._geoDataCubeMatrix=u,e._numRegions=a,e._geometryDimensionIdx=1,o=new Array(a),n=0;n<a;n++)s=u[n][0].qText,r=u[n][e._geometryDimensionIdx].qText,o[n]=g(s,r),o[n].validateGeoPolygons(),c+=o[n].getNumPoints();v.call(e,o),e._dataChanged=!0,e.fire("dataChanged"),e._numPoints!==c&&(e._numPoints=c,e.fire("numPointsChanged",[e])),l.all([e.invalidateProperties("MapPolygonLayer.setGeoRegionsData"),e.invalidateDisplay("MapPolygonLayer.setGeoRegionsData")]).then(function(){i.resolve()})}else i.resolve()}),i.promise}function b(e,t){var n,i,o,s,l,c,u,h,d,p=e?e.length:0,f=new Array(p);for(c=0;c<p;c++){for(i=(n=e[c])?n.length:0,d=new Array(i),u=0;u<i;u++){for(l=(o=n[u])?o.length:0,s=new Array(l),h=0;h<l;h++)s[h]=this._viewportProjection.project(o[h]);d[u]=new r(s)}f[c]=new a(d)}t.setGeoPolygons(f)}function x(e){return void 0===e||null===e||""===e}function q(e,n,i,r,o){var s=new t([e],[],[],[],n,0,i);return s.selected=!1,s.layerIndex=o,s.addShape("dataArea",r,!0),s}var C=3333,S=new n("#ddd");return e.extend("MapPolygonLayer",{init:function(){this._super.apply(this,arguments),this._geoRegionsData=new s,this.renderers={polygonlayer:this._renderer},this._numRegions=0},setLayerIndex:function(e){this._layerIndex=e,this._layerPath="/layers/"+this._layerIndex+"/geodata/qHyperCubeDef"},getDataType:function(){return"hyperCube"},setData:function(e,t){return this._super(e,t),this._qData=this._layerData?this._layerData.qHyperCube:void 0,this._geoData=this._layerData?this._layerData.geodata.qHyperCube:void 0,this._qMatrix=this._qData&&this._qData.qDataPages[0]?this._qData.qDataPages[0].qMatrix:void 0,this._numItems=this._qMatrix?this._qMatrix.length:0,this._qMeasureInfo=this._qData?this._qData.qMeasureInfo:void 0,this._hasMeasure=this._qMeasureInfo&&this._qMeasureInfo.length>0,this._geoDataHeight=this._geoData&&this._geoData.qSize?this._geoData.qSize.qcy:0,this._showExcluded=void 0===t.showExcluded||t.showExcluded,this.show&&(this._geoDataHeight!==this._numRegions||d.call(this)||p.call(this))?y.call(this):(this._dataChanged=!0,this.fire("dataChanged"),this.invalidateProperties("MapPolygonLayer.setData"))},hasValidData:function(){return this._super()&&this._layerData},getNumSelectedItems:function(){return this._numSelectedItems},getSelectedCacheItem:function(){return this._selectedCacheItem},paint:function(){if(this._super(this._layoutMode,this._layerData),this._rawGeoRegions){if(!this.show||!this._viewportProjection||!this._geoData||!this._geoData.qMeasureInfo||0===this._geoData.qMeasureInfo.length||x(this._geoData.qMeasureInfo[0].qFallbackTitle))return this._regionsChanged=!1,this._viewportProjectionChanged=!1,void this.clear();if(void 0===this._nodes&&this._updateProperties(),0!==this._numRegions){var e,t,n,i,r,o,s,a,l,c,u,h,d,p=this._geoDataCubeMatrix,f=this._hasMeasure?0:-1,m=[],g=[],v=0,y=0;for(d=this._rowIndexList?this._rowIndexList.length:0,this._selectionByLayer=this._preselectionMode||this._qSelectionInfo&&this._qSelectionInfo.qInSelections||this._nodes.some(function(e){return e.cacheItem.selected}),e=0;e<d;e++)t=this._rowIndexList[e],isNaN(t)||null===t||(i=(n=p[t][0]).qText,s=(o=(r=this._nodeMap[i]).shapeWrapper).shape,a=this._geoRegionsData.getProjectedGeoRegionById(i),b.apply(this,[a,s]),l=r.cacheItem,c=-1!==r.index,h=r.color,!c&&l.selected&&(h=this._colorMap.getColor(n.qElemNumber,NaN,f,t)),o.fill=h.toRGBA(),this._selectionByLayer?(u=l.selected,o.stroke="#333",o.strokeWidth=u?2:1):(u=c,o.stroke="#333",o.strokeWidth=1),u?(o.opacity=1,g[y++]=o):(o.opacity=this._globalAlpha,m[v++]=o));this._rendererShapes=m.concat(g),this._renderer.shapes=this._rendererShapes,this._renderer.render(),this._regionsChanged=!1,this._viewportProjectionChanged=!1}}},getSnapshotLayerData:function(e){var t=Math.min(this._geoData.qSize.qcy||C,C);return this.backendApi.getData([{qTop:0,qLeft:0,qWidth:2,qHeight:t}],"/layers/"+this._layerIndex+"/geodata/qHyperCubeDef").then(function(t){e.geodata.qHyperCube.qDataPages=t})},_updateProperties:function(){if(this.show&&this._layerData&&this._dataChanged&&this._rawGeoRegions){var e,t,n,i,r,s,a,l,c,h,d,p,f,m,g=this._geoDataCubeMatrix,v=this._qData&&this._qData.qDimensionInfo&&this._qData.qDimensionInfo[0],y=this._hasMeasure?0:-1,b=this._hasMeasure?this._qMeasureInfo[0].qFallbackTitle:"";if(this._regionsChanged=!0,this._numSelectedItems=0,this._regionIdDictionary={},this._nodeMap={},this._showExcluded)for(this._nodes=new Array(this._numRegions),d=new Array,this._rowIndexList=new Array(this._numRegions),e=0;e<this._numRegions;e++)s=(i=(n=g[e])[0]).qText,a=i.qElemNumber||0,l=new o(void 0,s),h=q(s,e,a,l,this._layerIndex),d[e]=h,c={type:"multipolygon",shape:l},this._nodeMap[s]=this._nodes[e]={shapeWrapper:c,cacheItem:h,color:S,index:-1},this._rowIndexList[e]=e;else{for(g=this._qMatrix,e=0;e<this._numItems;e++)s=g[e][0].qText,this._regionIdDictionary[s]=!0;for(this._nodes=new Array(this._numItems),d=new Array,this._rowIndexList=new Array(this._numItems),t=0,g=this._geoDataCubeMatrix,e=0;e<this._numRegions;e++)s=(i=(n=g[e])[0]).qText,this._regionIdDictionary[s]&&(a=i.qElemNumber||0,l=new o(void 0,s),h=q(s,e,a,l,this._layerIndex),d[t]=h,c={type:"multipolygon",shape:l},this._nodeMap[s]=this._nodes[t]={shapeWrapper:c,cacheItem:h,color:S,index:-1},this._rowIndexList[t]=e,t++)}for(g=this._qMatrix,e=0;e<this._numItems;e++)i=(n=g[e])[0],r=n[1],s=i.qText,(f=this._nodeMap[s])&&((l=f.shapeWrapper.shape).rowIndex=e,h=f.cacheItem,p=this._hasMeasure?r.qNum:null,f.color=this._colorMap.getColor(i.qElemNumber,p,y,e),this._hasMeasure&&h.addMeasure(b,p,r.qText),i.qAttrDims&&v.qAttrDimInfo&&v.qAttrDimInfo.length&&i.qAttrDims.qValues.forEach(function(e,t){h.addAttributeDimension(e.qElemNo,e.qText,v.qAttrDimInfo[t].qFallbackTitle)}),i.qAttrExps&&v.qAttrExprInfo&&v.qAttrExprInfo.length&&i.qAttrExps.qValues.forEach(function(e,t){h.addMeasure(v.qAttrExprInfo[t].label,e.qNum)}),f.index=e,this._selectedCacheItem=h);this._numSelectedItems=this._numItems,this.setSelectableShapes(d),this.fire("selectableShapesChanged"),this._dataChanged=!1,(m=u.call(this))&&m.equal(this._layerS2Bounds)||(this._layerS2Bounds=m,!this._layerS2Bounds||0===this._layerS2Bounds.width&&0===this._layerS2Bounds.height||this.fire("boundsChanged",[this]))}}})}),define("extensions.qliktech/map/map-glyph-layer",["extensions.qliktech/map/map-layer","extensions.qliktech/scatterplot/scatter-helper","objects.views/selections/cache-item-combo","general.utils/shapes/rect"],function(e,t,n,i){"use strict";function r(){var e,t,n,r,o=Number.MAX_VALUE,s=Number.MAX_VALUE,a=-Number.MAX_VALUE,l=-Number.MAX_VALUE;for(e=0;e<this._numItems;e++)!(t=this._nodes[e].shapeWrapper.shape.position)||isNaN(t.x)||isNaN(t.y)||(o=Math.min(o,t.x),s=Math.min(s,t.y),a=Math.max(a,t.x),l=Math.max(l,t.y));return o===Number.MAX_VALUE||s===Number.MAX_VALUE||a===-Number.MAX_VALUE||l===-Number.MAX_VALUE?void 0:(n=a-o,r=l-s,0===n&&this._wholeBoundingBox&&this._totalNumPoints&&(o-=(n=Math.abs(this._wholeBoundingBox.qRight-this._wholeBoundingBox.qLeft)/this._totalNumPoints)/2),0===r&&this._wholeBoundingBox&&this._totalNumPoints&&(s-=(r=Math.abs(this._wholeBoundingBox.qTop-this._wholeBoundingBox.qBottom)/this._totalNumPoints)/2),new i(o,s,n,r))}function o(){var e,n,i,r,o;for(e=0;e<this._numItems;e++)if(i=this._nodes[e].shapeWrapper.shape)if(0===i.type)i.position?(r=this._viewportProjection.project(i.position),i.setPosition(r.x,r.y)):i.setPosition(NaN,NaN);else if(i.position){if(r=this._viewportProjection.project(i.position),!(o=i.points)||13!==o.length)for(o=new Array(13),n=0;n<13;n++)o[n]={};o=t.updateCross(o,r.x,r.y,3,1),i.set(o)}else i.set([])}function s(){this._hasMeasure?void 0===this._layerData.autoMinMax||!0===this._layerData.autoMinMax?(this._qMin=this._qMeasureInfo[0].qMin,this._qMax=this._qMeasureInfo[0].qMax):(this._qMin=void 0===this._layerData.customMin?0:this._layerData.customMin,this._qMax=void 0===this._layerData.customMax?10:this._layerData.customMax):(this._qMin=void 0,this._qMax=void 0)}function a(){return!isNaN(this._qMin)&&void 0!==this._qMin&&null!==this._qMin&&(!isNaN(this._qMax)&&void 0!==this._qMax&&null!==this._qMax&&!(this._qMax<this._qMin))}function l(){var e=this;if(this.backendApi&&this.backendApi.isSnapshot)e.fire("boundsChanged",[e]);else{var t=e._layerS2Bounds.x,n=e._layerS2Bounds.y,r=e._layerS2Bounds.width,o=e._layerS2Bounds.height;if(r>0||o>0)return r>0?n-=(o=r/2)/2:o>0&&(t-=(r=o/2)/2),e._layerS2Bounds=new i(t,n,r,o),void e.fire("boundsChanged",[e]);var s=this._qDimensionInfo[1].qFallbackTitle;"="===s.substr(0,1)&&(s=s.substr(1)),"geomakepoint"!==s.substr(0,12).toLowerCase()&&(s="["+s+"]"),this.backendApi.model.app.getOrCreateSessionObject({qInfo:{qId:s,qType:"PointStats"},pointsStatistic:{boundingBox:{qStringExpression:"GeoBoundingBox({1}"+s+")"},numPoints:{qValueExpression:"Count({1}"+s+")"}}}).then(function(t){return t.getLayout().then(function(t){var n=JSON.parse(t.pointsStatistic.boundingBox);if(!e._geoDataIsProjectedToS2){var r,o,s;o=(r=e._viewportProjection.getMercatorProjection()).project({x:n.qLeft,y:n.qBottom}),s=r.project({x:n.qRight,y:n.qTop}),n.qLeft=o.x,n.qRight=s.x,n.qBottom=o.y,n.qTop=s.y}if(e._wholeBoundingBox=n,e._totalNumPoints=t.pointsStatistic.numPoints,e._layerS2Bounds&&(0===e._layerS2Bounds.width||0===e._layerS2Bounds.height)){var a,l,c,u;c=Math.abs(e._wholeBoundingBox.qRight-e._wholeBoundingBox.qLeft)/e._totalNumPoints,a=e._layerS2Bounds.x-c/2,u=Math.abs(e._wholeBoundingBox.qTop-e._wholeBoundingBox.qBottom)/e._totalNumPoints,l=e._layerS2Bounds.y-u/2,e._layerS2Bounds=new i(a,l,c,u),e.fire("boundsChanged",[e])}})})}}return e.extend("MapPointLayer",{init:function(){this._super.apply(this,arguments),this.renderers={pointlayer:this._renderer},this._layerS2Bounds=void 0},setLayerIndex:function(e){this._layerIndex=e,this._layerPath="/layers/"+this._layerIndex+"/qHyperCubeDef"},getDataType:function(){return"hyperCube"},setData:function(e,t){return this._super(e,t),this._qData=this._layerData?this._layerData.qHyperCube:void 0,this._qMatrix=this._qData.qDataPages[0]?this._qData.qDataPages[0].qMatrix:void 0,this._qDimensionInfo=this._qData?this._qData.qDimensionInfo:void 0,this._qMeasureInfo=this._qData?this._qData.qMeasureInfo:void 0,this._numMeasures=this._qMeasureInfo?this._qMeasureInfo.length:0,this._hasMeasure=!!(this._numMeasures>0&&this._qMeasureInfo[0].qFallbackTitle),this._data&&this._data.color&&!this._data.color.persistent&&(this._data.color.persistent=!0),s.call(this),this._isValidMinMax=a.call(this),this._qRange=this._qMax-this._qMin,this._numItems=this._qMatrix?this._qMatrix.length:0,this._needUpdateProperties=!0,this._needPaint=!0,this._hasMeasure?this._maxDotSize=this._layerData.rangeBubbleSizes&&this._layerData.rangeBubbleSizes[1]?this._layerData.rangeBubbleSizes[1]:32:this._maxDotSize=this._layerData.bubbleSizes?this._layerData.bubbleSizes:8,this.fire("dataChanged"),this.invalidateProperties("MapPointLayer.setData")},hasValidData:function(){return this._super()&&this._qDimensionInfo&&this._qDimensionInfo[0]&&this._qDimensionInfo[0].qFallbackTitle&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qFallbackTitle},getNumSelectedItems:function(){return this._numItems},getLayerBounds:function(){var e,t,n,i,r;return e=this._viewportProjection.getSize(),this._layerS2Bounds&&0!==this._layerS2Bounds.width&&0!==this._layerS2Bounds.height?(this._layerS2Bounds2=this._layerS2Bounds.clone(),e&&(r=2*(this._maxDotSize+1),n=e.x-r,i=e.y-r,n=(t=Math.min(n/this._layerS2Bounds.width,i/this._layerS2Bounds.height))*this._layerS2Bounds.width,i=t*this._layerS2Bounds2.height,t=Math.min(e.x/n,e.y/i),this._layerS2Bounds2.scale(t)),this._layerS2Bounds2):this._layerS2Bounds},paint:function(){if(this._super(this._layoutMode,this._data),!(this.show&&this._qDimensionInfo&&this._qDimensionInfo[0]&&this._qDimensionInfo[0].qFallbackTitle&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qFallbackTitle&&this._viewportProjection&&0!==this._qMatrix.length&&void 0!==this._qMatrix[0][1]))return this._glyphsChanged=!1,this._viewportProjectionChanged=!1,this._needPaint=!1,this.clear();if(void 0===this._nodes&&this._updateProperties(),void 0!==this._nodes){var e,t,n,i,r,s,a,l,c=[],u=[],h=0,d=0;for((this._glyphsChanged||this._viewportProjectionChanged)&&o.call(this),e=0;e<this._numItems;e++)(l=(a=(t=this._nodes[e]).shapeWrapper).shape)&&l.position&&(n=t.color,t.cacheItem.selected?(i="#333",r=2,s=1,u[d++]=a):(i=n.createShiftedColor().toRGBA(),r=1,s=this._globalAlpha,c[h++]=a),a.stroke=i,a.strokeWidth=r,a.opacity=s);this._rendererShapes=0===this._numItems?[]:c.concat(u),this._renderer.shapes=this._rendererShapes,this._renderer.render(),this._glyphsChanged=!1,this._viewportProjectionChanged=!1,this._needPaint=!1,this.afterPaint()}},setRect:function(e,t,n,i){this._super(e,t,n,i),this.rect&&this.rect.x===e&&this.rect.y===t&&this.rect.width===n&&this.rect.height===i||!this._layerS2Bounds||0===this._layerS2Bounds.width&&0===this._layerS2Bounds.height||this.fire("boundsChanged",[this])},getSnapshotLayerData:function(e){var t=Math.min(this._qData.qSize.qcy||3333,3333);return this.backendApi.getData([{qTop:0,qLeft:0,qWidth:3,qHeight:t}],"/layers/"+this._layerIndex+"/qHyperCubeDef").then(function(t){e.qHyperCube.qDataPages=t})},_updateProperties:function(){if(this.show&&this._needUpdateProperties&&this._qDimensionInfo&&this._qDimensionInfo[0]&&this._qDimensionInfo[0].qFallbackTitle&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qFallbackTitle){var e,i,o,s,a,c,u,h,d,p,f,m,g,v,y,b,x,q,C,S,w=this._qMatrix,_=this._hasMeasure?0:-1,D=this._qDimensionInfo&&this._qDimensionInfo[1];for(q=this._layerData.rangeBubbleSizes&&this._layerData.rangeBubbleSizes[0]?this._layerData.rangeBubbleSizes[0]:2,C=this._layerData.rangeBubbleSizes&&this._layerData.rangeBubbleSizes[1]?this._layerData.rangeBubbleSizes[1]:32,x=this._layerData.bubbleSizes?this._layerData.bubbleSizes:8,this._glyphsChanged=!0,this._nodes=new Array(this._numItems),p=[],f={},m=0,this._geoDataIsProjectedToS2=this._qDimensionInfo&&this._qDimensionInfo[1]&&this._qDimensionInfo[1].qTags&&this._qDimensionInfo[1].qTags.indexOf("$mercator")>-1,y=this._viewportProjection.getMercatorProjection(),i=0;i<this._numItems;i++)s=w[i][0].qText,a=w[i][0].qElemNumber||0,c=w[i][2]?w[i][2].qNum:void 0,e=w[i][1],this._hasMeasure?this._isValidMinMax?(b=t.getDotRadius(c,this._qMin,this._qMax,q,C),isNaN(b)?((u=t.createShape("polygon")).type=1,h="polygon"):((u=t.createShape("circle",[0,0,b,0])).type=0,h="circle")):((u=t.createShape("polygon")).type=1,h="polygon"):((u=t.createShape("circle",[0,0,x,0])).type=0,h="circle"),"-"===w[i][1].qText?u.position=void 0:(o=w[i][1].qText.replace(/^\[|\]$/g,"").split(","),u.position=this._geoDataIsProjectedToS2?{x:o[0],y:o[1]}:y.project({x:Number(o[0]),y:Number(o[1])})),u.rowIdx=i,f[s]?d=f[s].cacheItem:((d=new n([s],[],[],[],i,0,a)).selected=!1,d.layerIndex=this._layerIndex,f[s]={cacheItem:d,numShapes:0},p[m++]=d),d.addShape("dataArea",u,!0,[f[s].numShapes]),f[s].numShapes++,this._hasMeasure&&d.addMeasure(this._qMeasureInfo[0].qFallbackTitle,w[i][2].qNum,w[i][2].qText),e.qAttrDims&&D.qAttrDimInfo&&D.qAttrDimInfo.length&&e.qAttrDims.qValues.forEach(function(e,t){d.addAttributeDimension(e.qElemNo,e.qText,D.qAttrDimInfo[t].qFallbackTitle)}),e.qAttrExps&&D.qAttrExprInfo&&D.qAttrExprInfo.length&&e.qAttrExps.qValues.forEach(function(e,t){d.addMeasure(D.qAttrExprInfo[t].label,e.qNum)}),g={type:h,fill:(v=this._colorMap.getColor([w[i][0].qElemNumber,e.qElemNumber],c,_,i)).toRGBA(),shape:u},this._nodes[i]={shapeWrapper:g,cacheItem:d,color:v};this.setSelectableShapes(p),this.fire("selectableShapesChanged"),this._geofieldName!==this._qDimensionInfo[1].qFallbackTitle&&(this._geofieldName=this._qDimensionInfo[1].qFallbackTitle,this._wholeBoundingBox=void 0,this._totalNumPoints=void 0),this._dimensionTitle=this._qDimensionInfo[0].qFallbackTitle,this._needUpdateProperties=!1,(S=r.call(this))&&S.equal(this._layerS2Bounds)||(this._layerS2Bounds=S,!this._layerS2Bounds||0!==this._layerS2Bounds.width&&0!==this._layerS2Bounds.height||this._wholeBoundingBox?this.fire("boundsChanged",[this]):l.call(this))}}})}),define("extensions.qliktech/map/wmts-provider",[],function(){"use strict";return{getTileUrl:function(e){return"https://cartobase-"+(e||"a")+".global.ssl.fastly.net/light_all/${z}/${x}/${y}.png?api_key=837eb4e1cc983921567462bd3557215b06cccaea"},getAttributionLink:function(){return"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors, &copy; <a href='http://cartodb.com/attributions'>CartoDB</a>"}}}),define("extensions.qliktech/map/base-map-layer",["jquery","angular","objects.views/charts/components/chart-component","general.utils/shapes/rect","general.utils/shapes/point","openlayers","client.services/media-tool/media-tool-service","./wmts-provider","core.utils/deferred"],function(e,t,n,i,r,o,s,a,l){"use strict";function c(){var e,t,n,i;(e=this._viewportProjection?this._viewportProjection.getViewRectangleInLatLong():void 0)&&((t=new o.Geometry.Point(e.x,e.y)).transform(w,S),(n=new o.Geometry.Point(e.x+e.width,e.y+e.height)).transform(w,S),(i=new o.Bounds).extend(t),i.extend(n),i.toBBOX(),this._openLayers.zoomToExtent(i))}function u(e){this._attribution=s.toHTML(e),this.fire("attributionChanged",[e])}function h(){var e,t;e=this._viewportProjection.getZoomLevel(),t=this._viewportProjection.getMapCenterInLatLong(),this.setMapCenter(t),this.setZoomLevel(e)}function d(){if(this._viewportProjection&&this.show){var e,t,n,i,r=!1;e=this.getZoomLevel(),t=this.getMapCenter(),n=this._viewportProjection.getZoomLevel(),i=this._viewportProjection.getMapCenterInLatLong(),t||(t=i),Math.abs(e-n)<.001&&(!i||i.closeTo(t,1e-6))||(this._viewportProjection.enabledChangeEvent=!1,r=(r=r||this._viewportProjection.setZoomLevel(e))||this._viewportProjection.setMapCenterInLatLong(t),this._viewportProjection.inResetZoomMode&&(this._viewportProjection.inResetZoomMode=!1,this._viewportProjection.fire("resetZoomFinished")),r&&this._viewportProjection.fire("changed"),this._viewportProjection.enabledChangeEvent=!0)}}function p(){this._dfd&&(this._dfd.resolve(),this._dfdResolved=!0),this._dfdPaint&&this._dfdPaint.resolve()}function f(){clearTimeout(this._safeGuardTimer)}function m(){if(this._openLayers&&this._openLayers.tileManager){var e=this._openLayers.tileManager.tileQueue[this._openLayers.id];if(e&&e.length)return}p.call(this)}function g(){clearTimeout(this._safeGuardTimer);var e=this;this._safeGuardTimer=setTimeout(function(){p.call(e)},500)}function v(){clearTimeout(this._safeGuardTimer);var e=this;this._safeGuardTimer=setTimeout(function(){p.call(e)},500)}function y(e){b.call(this),e.events.register("loadend",this,d),e.events.register("loadstart",this,f),e.events.register("loadend",this,m),e.events.register("moveend",this,g),this._openLayers.events.register("updatesize",this,v),this._openLayers.addLayer(e),this._openLayers.setBaseLayer(e),this._baseLayer=e}function b(){this._baseLayer&&(this._openLayers.removeLayer(this._baseLayer),this._baseLayer.events.unregister("loadend",this,d),this._baseLayer.events.unregister("loadstart",this,f),this._baseLayer.events.unregister("loadend",this,m),this._baseLayer.events.unregister("moveend",this,g),this._baseLayer.destroy()),this._openLayers.events.unregister("updatesize",this,v),this._baseLayer=void 0}function x(e,n){var i,r=e.urls,s=e.attribution||"";this._urls===r&&this._attribution===s||(t.equals(this._urls,r)||(this._urls=r,this._urls&&this._urls.some(function(e){return e&&e.trim()})?(i=new o.Layer.XYZ("XYZ",this._urls,{numZoomLevels:n,wrapDateLine:!0}),y.call(this,i)):b.call(this)),this._attribution!==s&&u.call(this,s))}function q(e){var n,i=e.urls,r=e.params||"";try{r=JSON.parse(r)}catch(e){return}this._urls===i&&this._params===r||(this._params=r,t.equals(this._urls,i)||(this._urls=i,this._urls?(n=new o.Layer.WMS("WMS",this._urls,this._params),y.call(this,n)):b.call(this)))}function C(e){var n,i=e.urls,r=e.params||"";try{r=JSON.parse(r)}catch(e){return}t.equals(this._urls,i)||(this._params=r,this._urls!==i&&(this._urls=i,this._urls?(n=new o.Layer.TMS("TMS",this._urls?this._urls:"blank",this._params),y.call(this,n)):b.call(this)))}var S,w,_,D=19,M=0;return function(){o.Map.prototype.adjustZoom=function(e){return e};var e=o.Element.hasClass;o.Element.hasClass=function(t,n){return t&&e(t,n)};var t=o.Event.observe;o.Event.observe=function(e,n,i,r){o.Util.getElement(e)&&t.apply(this,[e,n,i,r])},S=new o.Projection("EPSG:900913"),w=new o.Projection("EPSG:4326")}(),n.extend("BaseMapLayer",{init:function(){this._super.apply(this,arguments),this._attribution=null,this._mapCenter=null,this._zoomLevel=null,this._layerNames=["OSM","MQ-OSM","MQSatellite"],this._selectedLayerName="OSM",this._googleMapLayersAdded=!1,this._isBingMapUsed=!1,this._needToSetBackgroundMapType=!1;var t=this;e(this.container).css({width:"100%",height:"100%"}),_=new o.Control.TouchNavigation({dragPanOptions:{enableKinetic:!0}}),t._openLayers=new o.Map({div:t.container,transitionEffect:null,zoomMethod:null,controls:[_],projection:new o.Projection("EPSG:900913"),displayProjection:new o.Projection("EPSG:4326"),maxExtent:new o.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),displayOutsideMaxExtent:!0,numZoomLevels:D+1,wrapDateLine:!0}),!t._on&&t._openLayers.controls.length&&_.deactivate(),t._minZoomLevel=0,t._maxZoomLevel=D,c.call(t),t._zoomCenterInitialized=!1,t._viewportProjection&&(t.updateViewportToBaseMap(!1),t._zoomCenterInitialized=!0),t._ready=!0},getAttribution:function(){return void 0===this._attribution?"":this._attribution},setViewportProjection:function(e){this._viewportProjection!==e&&(this._viewportProjection&&(this._viewportProjection.stopListen("changed",h,this),this._viewportProjection.stopListen("changedByInteraction",h,this)),this._viewportProjection=e,this._viewportProjection&&(this._viewportProjection.listen("changed",h,this),this._viewportProjection.listen("changedByInteraction",h,this)),this.updateViewportToBaseMap(!0))},setRect:function(e,t,n,r){this._super(e,t,n,r),this._viewport=new i(e,t,n,r)},getViewport:function(){return this._viewport},setFirstAutoZoomed:function(e){this._firstAutoZoomed=e},getFirstAutoZoomed:function(){return this._firstAutoZoomed},hasValidSize:function(){if(!this._openLayers)return!1;var e=this._openLayers.getSize();return e&&e.w>0&&e.h>0},isReady:function(){return this._ready&&this._openLayers&&this._openLayers.layers&&this._openLayers.layers.length>0&&this._baseLayer},on:function(){this._on=!0},off:function(){this._on=!1,this._openLayers&&0!==this._openLayers.controls.length&&_.deactivate()},showComponent:function(){this._super(),this._openLayers&&this._openLayers.baseLayer&&this._openLayers.baseLayer.setVisibility(!0),this.updateViewportToBaseMap(!0)},hideComponent:function(){this._super(),this._openLayers&&this._openLayers.baseLayer&&this._openLayers.baseLayer.setVisibility(!1)},getMapCenter:function(){if(this.show&&this.isReady()&&this.hasValidSize()){var e=this._openLayers.getCenter();if(e)return e.transform(this._openLayers.getProjectionObject(),w),new r(e.lon,e.lat)}},setMapCenter:function(e){if(!(e&&this.show&&this.isReady()&&this.hasValidSize()))return!1;var t,n;return(!(t=this.getMapCenter())||!t.closeTo(e,1e-9))&&(this._mapCenter=e,(n=new o.LonLat(e.x,e.y)).transform(w,this._openLayers.getProjectionObject()),this._openLayers.setCenter(n),!0)},getZoomLevel:function(){return this.show&&this.isReady()&&this.hasValidSize()?this._openLayers.zoom:0},setZoomLevel:function(e){return!(!(this.show&&this._openLayers&&this.hasValidSize())||Math.abs(this.getZoomLevel()-e)<1e-4||!this.isReady())&&(this._zoomLevel=e,this._openLayers.zoomTo(e),!0)},panBy:function(e,t){return!!(this.show&&this.isReady()&&this.hasValidSize())&&(this._openLayers.moveByPx(e,t),!0)},fromLatLongToViewport:function(e){if(this.show&&this.isReady()&&this.hasValidSize()){var t,n;return(t=new o.LonLat(e.x,e.y)).transform(w,this._openLayers.getProjectionObject()),n=this._openLayers.getViewPortPxFromLonLat(t),new r(n.x,n.y)}},fromViewportToLatLong:function(e){if(this.show&&this.isReady()&&this.hasValidSize()){var t,n,i;return t=new o.Pixel(e.x,e.y),n=this._openLayers.getLonLatFromViewPortPx(t),i=this._openLayers.getProjectionObject(),n.transform(i,w),new r(n.lon,n.lat)}},updateViewportToBaseMap:function(e){var t,n,i,r,o=!1;return this._viewportProjection&&this.isReady()?(n=this._viewportProjection.getZoomLevel(),t=this._viewportProjection.getMapCenterInLatLong(),t=t||{x:0,y:0},n=Math.min(D,Math.max(M,n)),this.setMapCenter(t),this.setZoomLevel(n),e&&(i=this.getMapCenter(),r=this.getZoomLevel(),this._viewportProjection.enabledChangeEvent=!1,Math.abs(r-n)>1e-4&&(o=o||this._viewportProjection.setZoomLevel(r)),i&&t&&!i.closeTo(t)&&(o=o||this._viewportProjection.setMapCenterInLatLong(i)),o&&(this._viewportProjection.fire("changedByBaseMap"),this._viewportProjection.fire("changedByInteraction")),this._viewportProjection.enabledChangeEvent=!0),o):o},setData:function(e){this._super(e),this._dfdResolved||(clearTimeout(this._safeGuardTimer),p.call(this)),this._dfd=l(),this._dfdResolved=!1;var t,n,i;if((i=this._data.background.defaultMapService)?(t={urls:[a.getTileUrl("a"),a.getTileUrl("b"),a.getTileUrl("c"),a.getTileUrl("d")],type:"XYZ",attribution:a.getAttributionLink()},n="XYZ"):n=(t=this._data.background.layers?this._data.background.layers[0]:{}).type||"XYZ",t&&(this._urls||t.urls))switch(n){case"XYZ":x.call(this,t,i?23:D+1);break;case"WMS":q.call(this,t);break;case"TMS":C.call(this,t)}if(this._openLayers&&this._baseLayer&&(M=this._openLayers.getMinZoom(),D=this._openLayers.getNumZoomLevels()+M-1,this._minZoomLevel===M&&this._maxZoomLevel===D||(this._minZoomLevel=M,this._maxZoomLevel=D,this.fire("maxMinZoomLevelChanged",[D,M]))),this._data&&this._data.background&&this._data.background.show&&(i||this._data.background.layers&&this._data.background.layers.length>0&&this._data.background.layers[0].urls&&this._data.background.layers[0].urls.length>0&&this._data.background.layers[0].urls.some(function(e){return e&&e.trim()}))){this.showComponent();var r=this;clearTimeout(this._safeGuardTimer),this._safeGuardTimer=setTimeout(function(){p.call(r)},500)}else this.hideComponent(),p.call(this);return this.fire("baseLayerChanged"),this.invalidateProperties("BaseMapLayer.setData"),this._dfd.promise},hasValidData:function(){return!0},paint:function(){this._super(this._layoutMode);var e,t,n;return this._openLayers&&(e=this._openLayers.getSize(),t=e.w,n=e.h,t!==this.rect.width||n!==this.rect.height)?(this._dfdPaint=l(),this._openLayers.updateSize(),this._dfdPaint.promise):l.resolve()},afterPaint:function(){},release:function(){this._super(),clearTimeout(this._safeGuardTimer),b.call(this),_.destroy(),this._openLayers.destroy()}})}),define("extensions.qliktech/map/layer-dependency",["objects.views/charts/events/event-launcher"],function(e){"use strict";function t(){this._layer&&(this._colorMapData=this._layer.getLayerOutputData(),this.fire("changed"))}return e.extend("LayerDependency",{init:function(){this._super()},setLayer:function(e){this._layer!==e&&(this._layer&&this._layer.stopListen("dataChanged",t,this),this._layer=e,this._layer&&this._layer.listen("dataChanged",t,this))},getColorMapData:function(){return this._colorMapData},invalidateLayer:function(){this._layer._needUpdateProperties=!0,this._layer._dataChanged=!0,this._layer.invalidateProperties("LayerDependency.invalidateLayer"),this._layer.invalidateDisplay("LayerDependency.invalidateLayer")},release:function(){this._layer&&this._layer.stopListen("dataChanged",t,this),this._layer=null}})}),define("extensions.qliktech/map/map-area",["jquery","objects.views/charts/components/chart-component","general.utils/shapes/rect","core.utils/deferred","extensions.qliktech/map/map-polygon3-layer","extensions.qliktech/map/map-glyph-layer","extensions.qliktech/map/base-map-layer","extensions.qliktech/map/layer-dependency","objects.views/charts/utils/chart-formatting","touche"],function(e,t,n,i,r,o,s,a,l,c){"use strict";function u(e){switch(e.type){case"polygon":return r;case"point":return o}return null}function h(e){var t;e.setLayoutMode(this._layoutMode),t=this.rect,e.setRect(t.x,t.y,t.width,t.height),t=this.outerRect,e.setOuterRect(t.x,t.y,t.width,t.height),t=this.containerRect,e.setContainerRect(t.x,t.y,t.width,t.height),t=this.layoutToContainerRatios,e.setLayoutToContainerRatios(t.x,t.y),e.setViewportProjection(this._viewportProjection)}function d(e,t,n,i){var r="layer."+i+"."+t+(void 0===n?"":n),o=new e(this.layersContainer,{clazz:e},r);return o.setLayerType(t),o.setVersion(n),o}function p(){var e,t,n,i,r,o,a,l;for(i=(t=this._data?this._data.layers:null)?t.length:0,i=Math.min(i,this._maxNumLayers),!this.baseMapLayer&&this._data&&this._data.background&&this._data.background.show&&(this._data.background.defaultMapService||this._data.background.layers&&this._data.background.layers.length>0&&this._data.background.layers[0].urls&&this._data.background.layers[0].urls.length>0&&this._data.background.layers[0].urls.some(function(e){return e&&e.trim()}))&&(this.addBaseMapLayer(new s(this.layersContainer,{clazz:s},"BaseMapLayer")),this.addAttributionLayer(document.createElement("div"))),e=0;e<i;e++)o=(n=t[e]).type,a=n.version,(l=u(n))&&((r=this.layers[e])?r.getLayerType()===o&&r.getVersion()===a||this.removeLayer(r,!0):(r=d.apply(this,[l,o,a,e]),this.addLayer(r,e)));if(this._numLayers>i)for(e=i;e<this._numLayers;e++)(r=this._layers[e])&&this.removeLayer(r);this._numLayers=i,this.attributionLayer&&this.container.appendChild(this.attributionLayer)}function f(){for(var e=[],t=0;t<this._numLayers;t++)e.push(this.layers[t].setData(this._data,this._data.layers[t]));return this.baseMapLayer&&(e.push(this.baseMapLayer.setData(this._data)),q.call(this)),i.all(e)}function m(){this._numLayers<1||this.layers[this._numLayers-1].updateBackendApi()}function g(e,t){var n,i,r,o,s,a,l,c;e&&(n=e.x,i=e.x+e.width,r=e.y,o=e.y+e.height,s=t.x,a=t.x+t.width,l=t.y,c=t.y+t.height,n<s&&(n=s),i>a&&(i=a),r<l&&(r=l),o>c&&(o=c),e.set(n,r,i-n,o-r))}function v(){var e,t;for(e=0;e<this._numLayers;e++)(t=this.layers[e])&&!t.hasValidData()&&t.clear()}function y(){var e,t,n=Math.min(this._numLayers,this._maxNumLayers);for(e=0;e<n;e++)if((t=this._data.layers[e])&&t.qHyperCube&&t.qHyperCube.qDimensionInfo&&t.qHyperCube.qDimensionInfo.length>0)return this.layers[e]}function b(){this._colorMap.getLegendDataProvider().setLegendMarker("point"===this.coloredLayer.getLayerData().type?"circle":"rect")}function x(e,t){this._interactionController.setMaxZoomLevel(e),this._interactionController.setMinZoomLevel(t)}function q(){this.attributionLayer.innerHTML=this.baseMapLayer&&this.baseMapLayer.show&&this.baseMapLayer.isReady()?this.baseMapLayer.getAttribution():""}function C(){var e=this.baseMapLayer&&this.baseMapLayer.show&&this.baseMapLayer.isReady();this.map.setFractionalZoomMode(!e)}function S(){this.updateSelectableShapes()}function w(){var e,t,n,i,r,o,s=!1,a=!1,l=this._changedBoundsLayers?this._changedBoundsLayers.length:0;if(this.layersReady&&0!==l){for(t=0;t<this._numLayers;t++)this.layers[t].isVisible()&&(n=this.layers[t].getLayerBounds())&&(i=i?i.union(n):n.clone());if(this.map.isSnapshot()||this.map.options.viewState)try{r=(this.map.options.viewState||this.map.getSnapshotStoredChartData()).mapRect}catch(e){}if(o=r&&void 0!==r.width&&void 0!==r.height&&void 0!==r.x&&void 0!==r.y,i&&(0===i.width||0===i.height)&&o&&i.set(r.x,r.y,r.width,r.height),g.apply(this,[i,this._worldBounds]),void 0===i&&void 0===this._unionBounds?this._unionBounds=this._worldBounds:this._unionBounds=i,this._unionBounds&&this._unionBounds.hasNaN()&&(this._unionBounds=this._worldBounds),this._unionBounds&&void 0!==i){for(t=0;t<l;t++)(e=this._changedBoundsLayers[t])&&(s=!0,e.getFirstAutoZoomed()&&!this.map.getAutoZoomOnDataChange()||(this._unionBounds.width||this._unionBounds.height)&&(a=!0,e.setFirstAutoZoomed(!0)));s&&this.map.setMapBounds(this._unionBounds),a&&!o&&this.map.zoomOnMapBounds()}else 0===l&&this.baseMapLayer&&void 0===i&&!this.baseMapLayer.getFirstAutoZoomed()&&((void 0===this._unionBounds||this._unionBounds.hasNaN())&&(this._unionBounds=this._worldBounds),this.map.setMapBounds(this._unionBounds),!this._unionBounds.width||!this._unionBounds.height||this.map.isSnapshot()&&o||(this.map.zoomOnMapBounds(),this.baseMapLayer.setFirstAutoZoomed(!0)));this._changedBoundsLayers=[]}}function _(e){-1===this._changedBoundsLayers.indexOf(e)&&(this._changedBoundsLayers.push(e),w.call(this))}function D(){var e,t,n=0;for(e=0;e<this._numLayers;e++)n+=(t=this.layers[e])&&t.getNumPoints?t.getNumPoints():0;this.map.setZoomPanByWebkitTransform(n>I)}function M(){var e=this._layerDependency.getColorMapData(),t=this;this._colorMap.setData(e,"map").then(function(n){n.valid&&n.legendPath&&(n.legendPath="/layers/0"+n.legendPath),t._legend.setData(e),t._layerDependency.invalidateLayer(),t._chartContext.refresh(e),b.call(t),t.layersReady=!0,t.map.layersReadyDfd.resolve(),w.call(t)})}function A(){this.attributionLayer&&(this.yMirrorMode?(this.attributionLayer.style.left="0",this.attributionLayer.style.right=""):(this.attributionLayer.style.left="",this.attributionLayer.style.right="0"))}var E,I=3e4,T=0;return E=t.extend("MapArea",{init:function(e,t){this._super.apply(this,Array.prototype.slice.call(arguments)),this.id="MapArea"+T++,this.layers=[],this._maxNumLayers=1,this._numLayers=0,this.options=t,this._unionBounds=void 0,this._worldBounds=new n(-180,-180,360,360),this._changedBoundsLayers=[],this._layerDependency=new a,this._layerDependency.listen("changed",M,this)},setYMirrorMode:function(e){this.yMirrorMode=e,A.call(this)},setMaxNumLayers:function(e){isNaN(e)&&(e=0),this._maxNumLayers=e},getMaxNumLayers:function(){return this._maxNumLayers},setData:function(e){var t=[];return this.layersReady=!1,this._data=e,p.call(this),m.call(this),this.coloredLayer=y.call(this),this.coloredLayer&&this._layerDependency.setLayer(this.coloredLayer),t.push(f.call(this)),v.call(this),this.coloredLayer&&this.map.setFormatter(new l(this.backendApi.localeInfo,this.coloredLayer.getMeasureInfo())),i.all(t)},addLayer:function(e,t){e&&(e.setLayerIndex(t),e.setBackendApi(this.backendApi),e.setSelectionsApi(this.selectionsApi),e.listen("selectableShapesChanged",S,this),e.listen("boundsChanged",_,this),e.listen("numPointsChanged",D,this),e.setColorMap(this._colorMap),h.call(this,e),this.layers[t]=e)},removeLayer:function(e,t){if(e){var n,i=this.layers.indexOf(e);e.stopListen("selectableShapesChanged",S,this),e.stopListen("boundsChanged",_,this),e.stopListen("numPointsChanged",D,this),e.clear(),e.release(),e.off(),e.container&&e.container.parentElement&&(n=e.container).parentElement.removeChild(n),!t&&i>-1&&this.layers.splice(i,1)}},addBaseMapLayer:function(e){this.baseMapLayer||(this.baseMapLayer=e,this.layersContainer.insertBefore(e.container,this.layersContainer.firstChild),h.call(this,e),e.listen("maxMinZoomLevelChanged",x,this),e.listen("attributionChanged",q,this),e.listen("baseLayerChanged",C,this),this._on?e.on():e.off())},removeBaseMapLayer:function(){if(this.baseMapLayer){var e;this.baseMapLayer.stopListen("maxMinZoomLevelChanged",x,this),this.baseMapLayer.stopListen("attributionChanged",q,this),this.baseMapLayer.stopListen("baseLayerChanged",C,this),this.baseMapLayer.container&&this.baseMapLayer.container.parentElement&&(e=this.baseMapLayer.container).parentElement.removeChild(e)}},addAttributionLayer:function(e){this.attributionLayer||(this.attributionLayer=e,e.style.position="absolute",e.style.bottom="0",A.call(this),c(e).tap({id:".maparea",options:{preventDefault:!1},start:function(){c.preventGestures(this.gestureHandler)}}),this.container.appendChild(e))},removeAttributionLayer:function(){this.attributionLayer&&(c(this.attributionLayer).off(),this.container.removeChild(this.attributionLayer))},setBackendApi:function(e){this.backendApi=e;for(var t=0;t<this._numLayers;t++)this.layers[t].setBackendApi(e)},setSelectionsApi:function(e){this.selectionsApi=e;for(var t=0;t<this._numLayers;t++)this.layers[t].setSelectionsApi(e)},setMap:function(e){this.map=e},getMap:function(){return this.map},setViewportProjection:function(e){if(this._viewportProjection!==e){this._viewportProjection=e;for(var t=0;t<this._numLayers;t++)this.layers[t].setViewportProjection(this._viewportProjection);this.baseMapLayer&&this.baseMapLayer.setViewportProjection(this._viewportProjection)}},setColorMap:function(e){this._colorMap=e},getColorMap:function(){return this._colorMap},setLegend:function(e){this._legend=e},setChartContext:function(e){this._chartContext=e},setInteractionController:function(e){this._interactionController=e},setHasValidData:function(e){this._super(e);for(var t=0;t<this._numLayers;t++)this.layers[t].setHasValidData(e)},hasValidData:function(){return this._super()&&this._data},setLayoutMode:function(e){this._super(e);for(var t=0;t<this._numLayers;t++)this.layers[t].setLayoutMode(e);this.baseMapLayer&&this.baseMapLayer.setLayoutMode(e)},setRect:function(e,t,n,i){this._super(e,t,n,i);for(var r=0;r<this._numLayers;r++)this.layers[r].setRect(0,0,n,i);this.baseMapLayer&&this.baseMapLayer.setRect(0,0,n,i)},setOuterRect:function(e,t,n,i){this._super(e,t,n,i);for(var r=0;r<this._numLayers;r++)this.layers[r].setOuterRect(0,0,n,i);this.baseMapLayer&&this.baseMapLayer.setOuterRect(0,0,n,i)},setLayoutToContainerRatios:function(e,t){this._super(e,t);for(var n=0;n<this._numLayers;n++)this.layers[n].setLayoutToContainerRatios(e,t);this.baseMapLayer&&this.baseMapLayer.setLayoutToContainerRatios(e,t)},updateSize:function(){this._super(),this.rect.x*=this.layoutToContainerRatios.x||1,this.rect.width*=this.layoutToContainerRatios.x||1,this.rect.y*=this.layoutToContainerRatios.y||1,this.rect.height*=this.layoutToContainerRatios.y||1,this.layoutToContainerRatios={x:1,y:1};for(var e in this.renderers)this.renderers[e].setDimensions(0,0,this.rect.width,this.rect.height),this.renderers[e].setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y);this._windowSizeMultiplier=Math.min(Math.min(this.rect.width,this.rect.height)/600,1);for(var t=0;t<this._numLayers;t++)this.layers[t].updateSize();this.chartScale=1},setContainerRect:function(e,t,n,i){this._super(e,t,n,i);for(var r=0;r<this._numLayers;r++)this.layers[r].setContainerRect(0,0,n,i);this.baseMapLayer&&this.baseMapLayer.setContainerRect(0,0,n,i)},showComponent:function(){this._super();var e,t;for(e=0;e<this._numLayers;e++)for(t=0;t<this.layers[e].renderers.length;t++)this.layers[e].renderers[t].show();this.baseMapLayer&&(this.baseMapLayer.showComponent(),q.call(this))},hideComponent:function(){this._super();var e,t;for(e=0;e<this._numLayers;e++)for(t=0;t<this.layers[e].renderers.length;t++)this.layers[e].renderers[t].hide();this.baseMapLayer&&(this.baseMapLayer.hideComponent(),q.call(this))},hasVisibleLayer:function(){for(var e=0;e<this._numLayers;e++)if(this.layers[e].show)return!0;return!1},hasVisibleBaseLayer:function(){return this.baseMapLayer&&this.baseMapLayer.show},isVisible:function(e){return this._super(e)&&this.rect&&this.rect.width>0&&this.rect.height>0},clear:function(){for(var e=0;e<this._numLayers;e++)this.layers[e].clear()},release:function(){for(var e=0;e<this._numLayers;e++)this.layers[e].release();this.baseMapLayer&&(this.baseMapLayer.release(),this.baseMapLayer.stopListen("attributionChanged"),this.baseMapLayer.stopListen("baseLayerChanged")),this.attributionLayer&&c(this.attributionLayer).off(),this.map=null,this.baseMapLayer=null,this.backendApi=null},setGlobalOpacity:function(e,t){this._globalAlpha=e;for(var n=0;n<this._numLayers;n++)this.layers[n].setGlobalOpacity(e,t)},updateSelectableShapes:function(){if(0!==this._numLayers){var e,t,n;for(n=this.layers[0].getSelectableShapes(),e=1;e<this._numLayers;e++)(t=this.layers[e].getSelectableShapes())&&t.length>0&&(n=n.concat(t));this.setSelectableShapes(n)}},paint:function(e,t){var n=[];if(!this.layersReady||!t)return i.resolve();this._super(e,t);for(var r=0;r<this._numLayers;r++)this.layers[r].invalidateProperties("MapArea.paint"),n.push(this.layers[r].invalidateDisplay("MapArea.paint"));return this.baseMapLayer&&n.push(this.baseMapLayer.invalidateDisplay("MapArea.paint")),i.all(n)},isSelectionLocked:function(){return this._selectionLocked},setPreselectionMode:function(e){this._preselectionMode=e;for(var t=0;t<this._numLayers;t++)this.layers[t].setPreselectionMode(e)},_updateProperties:function(){this._data&&this.invalidateDisplay("MapArea._updateProperties")},_createRenderArea:function(){this.parentContainer&&(this.container=document.createElement("div"),this._$renderAreaWrap=e(this.container),this._$renderAreaWrap.attr("tid",this.testId),this._$renderAreaWrap.css({position:"absolute",overflow:"hidden"}).addClass("qv-chart-component"),this.parentContainer.appendChild(this.container),this.layersContainer=document.createElement("div"),this._$layersContainerWrap=e(this.layersContainer),this._$layersContainerWrap.css({position:"absolute",width:"100%",height:"100%"}),this.container.appendChild(this.layersContainer))}}),Object.defineProperty(E.prototype,"className",{value:"MapArea"}),E}),define("extensions.qliktech/map/map-handler",["objects.utils/data-properties/hypercube-handler","core.utils/deferred","general.utils/array-util","util","objects.error-handling/error-handler"],function(e,t,n,i,r){"use strict";function o(e){var t,n,i=e?e.length:0;for(t=0;t<i;t++){if((n=e[t]).qHyperCubeDef&&n.qHyperCubeDef.qDimensions&&1===n.qHyperCubeDef.qDimensions.length&&n.qHyperCubeDef.qDimensions[0].qDef&&(n.qHyperCubeDef.qDimensions[0].qLibraryId||n.qHyperCubeDef.qDimensions[0].qDef.qFieldDefs[0]))return n;if(n.qHyperCubeDef&&n.qHyperCubeDef.qDimensions&&2===n.qHyperCubeDef.qDimensions.length&&n.qHyperCubeDef.qDimensions[0].qDef&&(n.qHyperCubeDef.qDimensions[0].qLibraryId||n.qHyperCubeDef.qDimensions[0].qDef.qFieldDefs[0])&&n.qHyperCubeDef.qDimensions[1].qDef&&n.qHyperCubeDef.qDimensions[1].qDef.qFieldDefs[0])return n}}function s(){var e=this.properties.color;e.auto&&"primary"===e.mode&&(e.auto=!1,e.mode="byMeasure",this.updateGlobalChangeListeners())}function a(e){var t,n,i="";return t=void 0===e.tags?e.qTags:e.tags,n=void 0===e.name?e.qName:e.name,n=n.replace(/]/g,"]]"),n="["+n+"]",t&&t.indexOf("$mercator")>-1&&(i="$mercator"),{qExpr:"GeoReduceGeometry({1}"+n+")",geoType:"polygon",projection:i}}function l(e){var t=a(e),n=t.qExpr,i=this.createExpressionMeasure(n,n);return i.qDef.projection=t.projection,i.qDef.qAggrFunc="None",i.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},i}function c(e,t,n){var i,r;for(i=0;i<t.length&&(r=t[i],i!==t.length-1);++i)e&&(e[r]||(e[r]={}),e=e[r]);e&&(e[r]=n)}var u,h,d,p=3333;return d=[{qSortByState:1,qSortByAscii:1,qSortByNumeric:1,qSortByLoadOrder:1}],h={qDef:{qFieldDefs:[],qFieldLabels:[],qSortCriterias:[]}},u=e.extend({init:function(e){this._super(e),this.dimensionProperties=this.autoSortDimension(h)},rippleToHyperCubes:function(e,t){var n,i,r=e.split(".");for(n=0;n<this.properties.layers.length;++n)c((i=this.properties.layers[n]).qHyperCubeDef,r,t),i.geodata&&c(i.geodata.qHyperCubeDef,r,t)},setProperties:function(e){e&&e.layers&&e.layers[0]&&"point"===e.layers[0].type&&e.color&&!1===e.color.persistent&&(e.color.persistent=!0),this._super(e)},getDimensions:function(e){return e||(e=o(this.properties.layers)),e&&e.qHyperCubeDef?e.qHyperCubeDef.qDimensions.length>1?[e.qHyperCubeDef.qDimensions[0]]:e.qHyperCubeDef.qDimensions:[]},getMeasures:function(e){if(e||(e=o(this.properties.layers)),!e)return[];if(e.qHyperCubeDef){if("polygon"!==e.type)return e.qHyperCubeDef.qMeasures;var t=e.qHyperCubeDef.qMeasures;if(t&&t[0]&&(t[0].qLibraryId||t[0].qDef&&void 0!==t[0].qDef.qDef&&""!==t[0].qDef.qDef.trim()))return[t[0]]}return[]},getLayerType:function(e){return e||(e=o(this.properties.layers)),e?e.type:void 0},getLayerTypeAndVersion:function(e){return e||(e=o(this.properties.layers)),e?[e.type,e.version]:[void 0,void 0]},addPointLayer:function(){var e={type:"point",cId:i.generateId(),show:!0,opacity:1,qHyperCubeDef:{qDimensions:[],qMeasures:[],qInterColumnSortOrder:[],qInitialDataFetch:[{qLeft:0,qTop:0,qWidth:3,qHeight:p}],qReductionMode:"N",qMode:"S",qCalcCond:this.properties.calcCond,customErrorMessage:this.properties.customErrorMessage},useSize:!0,bubbleSizes:8,rangeBubbleSizes:[2,32],autoMinMax:!0,customMin:0,customMax:10};return this.properties.layers.push(e),void 0===this.properties.background&&(this.properties.background={}),this.properties.background.show=!0,void 0===this.properties.color&&(this.properties.color={}),this.properties.color.persistent=!0,e},canColorBy:function(){return this._super(this.properties&&this.properties.layers&&this.properties.layers.length?{qHyperCubeDef:this.properties.layers[0].qHyperCubeDef}:{qHyperCubeDef:{qDimensions:[],qMeasures:[]}})},addPolygonLayer:function(){var e={type:"polygon",version:"3",cId:i.generateId(),show:!0,qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qLeft:0,qTop:0,qWidth:2,qHeight:p}],qInterColumnSortOrder:[],qReductionMode:"N",qMode:"S",qCalcCond:this.properties.calcCond,customErrorMessage:this.properties.customErrorMessage},geodata:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInterColumnSortOrder:[],qReductionMode:"N",qMode:"S",qCalcCond:this.properties.calcCond,customErrorMessage:this.properties.customErrorMessage}},measureDef:""};return this.properties.layers.push(e),e},autoSortDimension:function(e){return t.resolve(u.autoSortDimension(e))},createFieldDimension:function(e){var t=i.extend(!0,{},h);return t.qDef.qFieldDefs[0]=e,t.qDef.qFieldLabels[0]="",t},getLayers:function(){return this.properties.layers},getLayersWithoutMeasure:function(){var e=this;return this.properties.layers.filter(function(t){switch(t.type){case"polygon":var n=e.getMeasures(t);return!(n&&n[0]&&(n[0].qDef&&n[0].qDef.qDef||n[0].qLibraryId));case"point":return!t.qHyperCubeDef.qMeasures.length}return!1})},addHypercubeDimension:function(e,r){var o=this.getDimensions(r);return e.qDef.cId||(e.qDef.cId=i.generateId()),o.length<2&&(o.push(e),n.indexAdded(r.qHyperCubeDef.qInterColumnSortOrder,o.length-1)),"polygon"===r.type&&(o=r.geodata.qHyperCubeDef.qDimensions,(e=i.extend(!0,{},e)).qDef.cId=i.generateId(),o.length<2&&o.push(e)),t.resolve(e)},addDimension:function(e){var n,i=this.properties.layers.length;return i>0&&(n=this.properties.layers[i-1]).qHyperCubeDef?this.addHypercubeDimension(e,n):t.resolve(e)},replaceDimension:function(e,n){var r,o,s,a=this.properties.layers.length;return a>0&&(r=this.properties.layers[a-1]).qHyperCubeDef&&(s=(o=this.getDimensions(r))[e],n.qDef.cId=i.generateId(),o[e]=n,"function"==typeof this.dimensionDefinition.replace&&this.dimensionDefinition.replace.call(null,n,s,e,this.properties,this)),t.resolve(n)},removeDimension:function(){return this.properties.layers=[],t.resolve()},getDimensionLayout:function(e){return this.getDimensionLayouts().filter(function(e){return!!e.qError&&!r.isCalcCondNotCalculatedErr(e.qError)})[0]||this._super(e)},addFieldAsGeoPolygonField:function(e){this.properties.layers[this.properties.layers.length-1].geodata.qHyperCubeDef.qMeasures[0]=l.call(this,e)},addMeasureToPolygonLayer:function(e,t){t.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},t.qDef.qAggrFunc="None",t.qDef.cId||(t.qDef.cId=i.generateId()),e.qHyperCubeDef.qMeasures[0]=t,e.measureDef=t.qDef.qDef,s.call(this)},addMeasureToPointLayer:function(e,t){t.qSortBy={qSortByLoadOrder:1,qSortByNumeric:-1},t.qDef.cId||(t.qDef.cId=i.generateId()),e.qHyperCubeDef.qMeasures.length?e.qHyperCubeDef.qMeasures[0]=t:(e.qHyperCubeDef.qMeasures.push(t),e.qHyperCubeDef.qInterColumnSortOrder.splice(0,0,2))}}),u.autoSortDimension=function(e){return e.qDef.qSortCriterias=i.extend(!0,[],d),e},u}),define("extensions.qliktech/map/map-util",["general.utils/array-util","core.utils/deferred"],function(e,t){function n(e){var t,n,i,r=[],o=[];if((t=e.split("[")).length>1){for(i=0;i<t.length;i++)(n=t[i].split("]")).length>1&&(r=r.concat(n.splice(0,1))),o=o.concat(n);o=o.join(" ")}else o=e;return{fields:r,rest:o}}function i(e,t){for(var n in t)(!e[n]||e[n].distance>t[n].distance)&&(e[n]=t[n])}var r={extract2FieldNamesOfGeoMakePoint:function(e){var t,i,r,o,s,a,l,c,u;for(i=(t=n(e)).fields,o=(r=t.rest.replace("("," ( ")).split(" "),s=0;s<o.length;)""===o[s]?o.splice(s,1):s++;for(s=0;s<o.length-1;)"("===o[s+1]?o.splice(s,1):s++;for(r=o.join(""),(a=[",","\\+","-","\\(","\\)","\\*","/","=","\\>","\\<"]).join("|"),o=r.split(new RegExp(a.join("|"),"g")),s=0;s<o.length;)""===o[s]?o.splice(s,1):s++;for(l=i.concat(o),s=0;s<l.length;s++)'"'!==(u=(c=l[s]).substring(0,1))&&"'"!==u||(c=c.substring(1)),'"'!==(u=c.substring(c.length-1))&&"'"!==u||(c=c.substring(0,c.length-1)),l[s]=c;return l},findFieldsInGeoMakePointFunction:function(e,t){var n,i=this.extract2FieldNamesOfGeoMakePoint(e),r=t?t.length:0,o=i?i.length:0,s=[],a={};for(n=0;n<r;n++)a[t[n].qName]=n;for(n=0;n<o;n++)void 0!==a[i[n]]&&(s[s.length]=t[a[i[n]]]);return s},isGeoMakePointField:function(e){return this.isGeoMakePointExpression(e.qName)},isGeoMakePointExpression:function(e){var t,n,i=e.split("(")[0],r=["="," "];for(r.join("|"),t=i.split(new RegExp(r.join("|"),"g")),n=0;n<t.length;)""===t[n]?t.splice(n,1):n++;return t&&1===t.length&&"geomakepoint"===t[0].toLowerCase()},isNormalGeoField:function(e){return r.isNormalGeoPointField(e)||r.isGeoPolygonField(e)},isNormalGeoPointField:function(e){return e.qTags.indexOf("$geopoint")>-1||e.qTags.indexOf("$geotag")>-1},isGeoField:function(e){return r.isGeoPointField(e)||r.isGeoPolygonField(e)},isGeoPointField:function(e){return this.isNormalGeoPointField(e)||this.isGeoMakePointField(e)},isGeoPolygonField:function(e){return e.qTags.indexOf("$geomultipolygon")>-1||e.qTags.indexOf("$geopolygon")>-1},getRelatedFieldName:function(e){var t,n=e.qTags,i=n?n.length:0;for(t=0;t<i;t++)if("$relates_"===n[t].substring(0,9))return n[t].substring(9,n[t].length);return null},getRelatedField:function(e,t){var n=this.getRelatedFieldName(e);if(n)for(var i=0;i<t.length;i++)if(t[i].qName===n)return t[i];return null},getFieldsInTable:function(t,n){var i,r,o=[];for(i=0;i<n.length;i++)r=n[i],e.contains(r.qSrcTables,t)&&o.push(r);return o},simplifyGeoMakePointExpression:function(e){var t,n,i,o,s,a,l,c;return t=r.extract2FieldNamesOfGeoMakePoint(e),n=t[0],i=t[1],o=e.indexOf(n),s=e.indexOf(i),a=e.substring(0,o),l=e.substring(o+n.length,s),c=e.substring(s+i.length),a.trim()+n+l.trim()+i+c.trim()},getFieldsInArchipelagoForGeoMakePointField:function(e,t){var n,r=this.findFieldsInGeoMakePointFunction(e.qName,t),o=r?r.length:0,s={};for(n=0;n<o;n++)i(s,this.getFieldsInArchipelago(r[n],t));return s},getFieldsInArchipelago:function(e,t){function n(e,s){var a,l,c,u,h;for(a=0;a<e.length;a++)if(c=e[a],!o[c])for(o[c]=!0,u=r.getFieldsInTable(c,t),l=0;l<u.length;l++)h=u[l],i[h.qName]||(i[h.qName]={field:h,distance:s},n(h.qSrcTables,++s))}var i={},o={},s=this.getRelatedField(e,t);return s?i[s.qName]={field:s,distance:0}:n(e.qSrcTables,0),i},filterFields:function(e,t){function n(e,t){return Array.isArray(t)?t.some(function(t){return n(e,t)}):e.qTags.indexOf(t)>-1}var i,r,o=e?e.length:0,s=[];for(i=0;i<o;i++)n(r=e[i],t)&&s.push(r);return s},findGeoAssociatedFields:function(e,t){var n,i,o,s,a,l,c,u={};for(n=0;n<t.length;n++)for(o=t[n],l=r.getFieldsInArchipelago(o,e),s=Object.keys(l),i=0;i<s.length;i++)c=l[a=s[i]].field,u[a]?u[a].geoFields.push(o):u[a]={field:c,geoFields:[o],distance:l[a]};return Object.keys(u).map(function(e){return u[e]})},addLayer:function(e,n,i){var o,s,a=e.geoField;return s="field"===e.type?i.createFieldDimension(e.value):i.createLibraryDimension(e.libraryId),r.isGeoPointField(a)?(o=i.addPointLayer(),i.addDimension(s),i.addDimension(i.createFieldDimension(a.qName))):(o=i.addPolygonLayer(),i.addDimension(s),i.addFieldAsGeoPolygonField(a)),t.resolve(o)}};return r}),define("extensions.qliktech/map/map-autocomplete",["extensions.qliktech/map/map-util","translator"],function(e,t){function n(e){return e.sort(function(e,t){var n;return n=e.distance<t.distance?-1e3:e.distance>t.distance?1e3:0,e.value<t.value?n-=10:e.value>t.value&&(n+=10),n})}return{getFieldSuggestions:function(i,r){var o=t.get("Common.Fields");return n(r.map(function(t){var n=t.field.qName,r={label:n,value:n,field:t.field,geoFields:t.geoFields,associatedFields:[],distance:t.distance,category:o,type:"field"};if(e.isGeoField(t.field)){var s=e.getFieldsInArchipelago(t.field,i),a=e.isGeoPointField(t.field),l=i.filter(function(n){var i=n.qName;return s[i]&&(!e.isGeoField(n)||a&&i===t.field.qName)});r.associatedFields=l,r.hasAlternatives=l.length>1}else r.hasAlternatives=t.geoFields.length>1;return r}))},getDimensionSuggestions:function(i,r,o){function s(t,n,i){var r,o,s;if((r=e.isGeoMakePointExpression(n))&&(n=e.simplifyGeoMakePointExpression(n)),t&&n)for(o=0;o<t.length;o++)if((s=t[o]).field.qName===n)return s;if(r&&i)return{geoFields:[i.qData.info[0]],field:i.qData.info[0],distance:{distance:Math.MAX_VALUE,field:i.qData.info[0]}}}var a=t.get("Common.Dimensions");return n(i.map(function(e){var t=e&&e.qData&&e.qData.info&&e.qData.info[0]?e.qData.info[0].qName:"",n=""===t?null:s(o,t,e);if(n)return{dimension:e,associatedField:n}}).filter(function(e){return!!e}).map(function(t){var n,i,o=t.dimension.qData.title,s=t.associatedField,l={label:o,value:o,field:s.field,libraryId:t.dimension.qInfo.qId,geoFields:s.geoFields,associatedFields:[],distance:t.distance,category:a,type:"dimension"};if(e.isGeoMakePointField(s.field))n=e.getFieldsInArchipelagoForGeoMakePointField(s.field,r),i=r.filter(function(t){var i=t.qName;return n[i]&&(!e.isGeoField(t)||i===s.field.qName)}),l.associatedFields=i,l.hasAlternatives=i.length>1;else{var c=e.isNormalGeoPointField(s.field),u=e.isGeoPolygonField(s.field);c||u?(n=e.getFieldsInArchipelago(s.field,r),i=r.filter(function(t){var i=t.qName;return n[i]&&(!e.isGeoField(t)||c&&i===s.field.qName)}),l.associatedFields=i,l.hasAlternatives=i.length>1):l.hasAlternatives=s.geoFields.length>1}return l}))}}}),define("text!extensions.qliktech/map/add-popover/add-layer-popover.ng.html",[],function(){return'<lui-popover style="min-width: 200px;width: 230px;" align-to="alignTo" position="position" collision="\'flipfit\'" on-close-view="closeAddPopover(event)" qva-outside-ignore-for="{{qvaOutsideIgnoreFor}}">\n\t<div class="object-add-popover" ng-show="!step2">\n\t\t<object-add-typeahead>\n\t\t\t<lui-popover-header>\n\t\t\t\t<div class="lui-input-group">\n\t\t\t\t\t<input class="lui-input" type="text" name="new-dimension" autocomplete="off" ng-model="search.term" tid="add-dimension-input" qva-focus="autoFocus"\n\t\t\t\t\t   object-add-typeahead-input on-escape="onEscape($event)" maxlength="255"/>\n\t\t\t\t</div>\n\t\t\t</lui-popover-header>\n\t\t\t<div class="object-add-popover-content" object-add-typeahead-menu>\n\t\t\t\t<div class="object-add-popover-list-header" ng-if="dimensions.length" q-translation="Common.Dimensions"></div>\n\t\t\t\t<ul class="lui-list">\n\t\t\t\t\t<li class="lui-list__item lui-list__action" ng-repeat="dimension in dimensions" tid="dimension-item"\n\t\t\t\t\t\tobject-add-typeahead-item="dimension" on-select="selectItem(dimension)">\n\t\t\t\t\t\t<span qve-highlight text="{{dimension.label}}" title="{{dimension.label}}" query="search.term" class="lui-list__text lui-list__text--ellipsis"></span>\n\t\t\t\t\t\t<i class="object-add-popover-toogle-step2-icon  lui-list__aside  lui-icon  lui-icon--triangle-right" ng-if="dimension.hasAlternatives"></i>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t\t<div class="object-add-popover-list-header" ng-if="fields.length" q-translation="Common.Fields"></div>\n\t\t\t\t<ul class="lui-list">\n\t\t\t\t\t<li class="lui-list__item lui-list__action" ng-repeat="field in fields" tid="field-item"\n\t\t\t\t\t\tobject-add-typeahead-item="field" on-select="selectItem(field)">\n\t\t\t\t\t\t<i ng-if="isDirectDiscoveryField( field )" class="lui-icon  lui-icon--direct-discovery  lui-list__aside" q-title-translation="{{ getDirectDiscoveryTypeTranslationKey( field.qTags ) }}"></i>\n\t\t\t\t\t\t<span qve-highlight text="{{field.label}}" title="{{field.label}}" query="search.term" class="lui-list__text lui-list__text--ellipsis"></span>\n\t\t\t\t\t\t<i class="object-add-popover-toogle-step2-icon  lui-list__aside  lui-icon  lui-icon--triangle-right" ng-if="field.hasAlternatives"></i>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t\t<div class="object-add-popover-nohits" ng-if="!dimensions.length && !fields.length" q-translation="Toolbox.Search.Nohits"></div>\n\t\t\t</div>\n\t\t</object-add-typeahead>\n\t</div>\n\t<div class="object-add-popover back" ng-show="step2">\n\t\t<div class="object-add-popover-header">\n\t\t\t<div qva-activate="goBack($event);">\n\t\t\t\t<i class="object-add-popover-back-icon  lui-icon  lui-icon--triangle-left"></i>\n\t\t\t\t<span q-translation="Visualization.Requirements.Back"></span>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="object-add-popover-content">\n\t\t\t<div class="object-add-popover-list-header">{{headerLabel}}</div>\n\t\t\t<ul class="lui-list">\n\t\t\t\t<li class="lui-list__item lui-list__action" ng-repeat="suggestedItem in suggestedItems"\n\t\t\t\t\tqva-activate="selectItem(suggestedItem)" tid="from-field-item">\n\t\t\t\t\t<span class="lui-list__text lui-list__text--ellipsis" title="{{getSuggestionLabel(suggestedItem)}}">{{getSuggestionLabel(suggestedItem)}}</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t</div>\n</lui-popover>\n\n'}),define("extensions.qliktech/map/add-popover/add-layer-popover",["core.utils/deferred","general.utils/string-normalization","translator","general.utils/array-util","general.utils/support","extensions.qliktech/map/map-util","extensions.qliktech/map/map-autocomplete","general.models/field","general.models/library/dimension","text!./add-layer-popover.ng.html","client.assets/tab-contents/fields/assets-directdiscovery-service","objects.add-popovers/object-add-typeahead"],function(e,t,n,i,r,o,s,a,l,c,u){"use strict";function h(e,n){return""===n?e:e.filter(function(e){return void 0!==e.value&&t.string(e.value.toLowerCase()).indexOf(t.string(n.toLowerCase()))>-1})}var d=100;return{template:c,controller:["$scope",function(t){t.search={term:""},t.isDirectDiscoveryField=u.isDirectDiscoveryField,t.getDirectDiscoveryTypeTranslationKey=u.getTypeTranslationKey,t.autoFocus=r.treatAsDesktop(),t.suggestedItems=[],t.position||(t.position="right"),t.getSuggestionLabel=function(e){return o.isGeoPointField(e.geoFields[0])?n.get("properties.layers.autocomplete.pointSuggestion",[e.label]):n.get("properties.layers.autocomplete.regionSuggestion",[e.label])},t.selectItem=function(e){1!==e.geoFields.length||e.field&&o.isGeoField(e.field)?o.isGeoField(e.field)?(t.headerLabel=o.isGeoPointField(e.field)?n.get("Visualization.Requirements.SelectFieldForPointLayer"):n.get("Visualization.Requirements.SelectFieldForAreaLayer"),t.suggestedItems=e.associatedFields.map(function(t){return{label:t.qName,value:t.qName,type:"field",geoFields:[e.field]}}),t.step2=!0):(t.headerLabel=n.get("Visualization.Requirements.SelectGeoFieldForLayer"),t.suggestedItems=e.geoFields.map(function(t){return{label:t.qName,value:e.value,libraryId:e.libraryId,type:e.type,geoFields:[t]}}),t.step2=!0):"dimension"===e.type?t.addLibraryDimension({libraryId:e.libraryId,type:e.type,geoField:e.geoFields[0]}):t.addFieldDimension({value:e.value,type:e.type,geoField:e.geoFields[0]})},t.onEscape=function(e){""!==t.search.term?(e.stopPropagation(),t.search.term=""):t.close()},t.goBack=function(e){e.preventDefault(),t.suggestedItems=[],t.step2=!1};var c=null;t.$watch("search.term",function(n){function r(){var e=h(c.fields,n),r=h(c.dimensions,n);r.length>d?(r=i.limit(r,d),e=[]):e.length+r.length>d&&(e=i.limit(e,d-r.length)),t.fields=e,t.dimensions=r}c?r():e.all({fields:a.getOnTheFlyWithHiddenList().then(function(e){return e.getLayout()}),dimensions:l.getListLayout()}).then(function(e){var t=o.filterFields(e.fields,["$geomultipolygon","$geopolygon","$geopoint"]),n=o.findGeoAssociatedFields(e.fields,t),i=(n=n.filter(function(e){return!(e.field.qTags&&e.field.qTags.indexOf("$hidden")>-1)})).filter(function(e){return!e.field.qIsDefinitionOnly});c={fields:s.getFieldSuggestions(e.fields,i),dimensions:s.getDimensionSuggestions(e.dimensions,e.fields,n)},r()})})}],scope:{alignTo:"=",addFieldDimension:"=",addLibraryDimension:"=",close:"=",position:"=",qvaOutsideIgnoreFor:"="}}}),define("extensions.qliktech/map/map-layer-creation",["translator","qvangular","core.models/app","extensions.qliktech/map/map-util","general.models/field","util"],function(e,t,n,i,r,o){"use strict";function s(e,t,n,i){n.addPolygonLayer(),n.addDimension(e),n.addFieldAsGeoPolygonField(t),i.setProperties(n.properties)}function a(e,t,n,i){n.addPointLayer(),n.addDimension(e),n.addDimension(t),i.setProperties(n.properties)}function l(e,n,i,r,o,a){n.addItem({translation:i,tid:"add-as-polygon-layer",select:function(){s(r,e,o,a),t.$rootScope.$broadcast("pp-open-path","data."+o.properties.layers[0].cId)}})}function c(e,n,i,r,o,s){n.addItem({translation:i,tid:"add-as-point-layer",select:function(){var n=o.createFieldDimension(e.qName);a(r,n,o,s),t.$rootScope.$broadcast("pp-open-path","data."+o.properties.layers[0].cId)}})}function u(e,t,n,i,r){var o;1===t.length?c(e,n.menu,"Object.Map.DropActions.AddAsPointLayer",t[0].dimension,i,r):t.length>1&&(o=n.menu.addItem({translation:"Object.Map.DropActions.AddAsPointLayer",tid:"add-as-point-layer"}),t.forEach(function(t){c(e,o,["properties.layers.autocomplete.pointSuggestion",t.name],t.dimension,i,r)}))}function h(e,t,n,i,r){var o;1===t.length?l(e,n.menu,"Object.Map.DropActions.AddAsRegionLayer",t[0].dimension,i,r):t.length>1&&(o=n.menu.addItem({translation:"Object.Map.DropActions.AddAsRegionLayer",tid:"add-as-polygon-layer"}),t.forEach(function(t){l(e,o,["properties.layers.autocomplete.regionSuggestion",t.name],t.dimension,i,r)}))}function d(e,t,n,r,o){i.isGeoPointField(e)?u(e,t,n,r,o):h(e,t,n,r,o)}function p(e,t,n,r,o){var s=[],a=[];t.forEach(function(e){i.isGeoPointField(e)?s.push(e):a.push(e)});var u;1===a.length?l(a[0],n.menu,"Object.Map.DropActions.AddAsRegionLayer",e,r,o):a.length>1&&(u=n.menu.addItem({translation:"Object.Map.DropActions.AddAsRegionLayer",tid:"add-as-polygon-layer"}),a.forEach(function(t){l(t,u,["properties.layers.autocomplete.regionSuggestion",t.qName],e,r,o)})),1===s.length?c(s[0],n.menu,"Object.Map.DropActions.AddAsPointLayer",e,r,o):s.length>1&&(u=n.menu.addItem({translation:"Object.Map.DropActions.AddAsPointLayer",tid:"add-as-point-layer"}),s.forEach(function(t){c(t,u,["properties.layers.autocomplete.pointSuggestion",t.qName],e,r,o)}))}function f(t,n,i,r){t.forEach(function(t){if("polygon"!==t.type){var s=n.properties.layers.indexOf(t),a=m>1?"Add as measure in layer "+(s+1):e.get("contextMenu.addFieldAsMeasure"),l=o.escapeField(i.item.name),c=i.menu.addItem({translation:a,tid:"add-as-measure"});["Sum","Count","Avg","Min","Max"].forEach(function(e){var i=e+"("+l+")";c.addItem({label:i,tid:e.toLowerCase(),select:function(){var e;switch(t.type){case"polygon":e=t.qHyperCubeDef?n.createExpressionMeasure(i,i):{qExpr:i,qLabel:i},n.addMeasureToPolygonLayer(t,e);break;case"point":e=n.createExpressionMeasure(i,i),n.addMeasureToPointLayer(t,e);break;default:return}r.setProperties(n.properties)}})})}})}var m=1;return{getDropFieldOptions:function(e,t,o,l,c){var u=e.item,h=t.getLayers(),g=t.getLayersWithoutMeasure();e.ColorBy(o,t,c);var v={qTags:u.tags,qSrcTables:u.srcTables,qName:u.name},y=i.isGeoPointField(v),b=i.isGeoPolygonField(v);y||b?g.length?(f(g,t,e,o),l()):h.length>=m?l():r.getList().then(function(e){return e.getLayout()}).then(function(n){var r=i.getFieldsInArchipelago(v,n),s=n.filter(function(e){var t=e.qName;return r[t]&&(!i.isGeoField(e)||y&&t===v.qName)}).map(function(e){var n=t.createFieldDimension(e.qName);return{name:e.qName,dimension:n}});d(v,s,e,t,o),l()}):n.current.findMatchingFields(e.item.name,["$geomultipolygon","$geopolygon","$geopoint"]).then(function(n){var r,c=n.qFieldNames;g.length?(f(g,t,e,o),l()):h.length>=m||0===c.length?l():1===c.length?(r=t.createFieldDimension(u.name),i.isGeoPointField(c[0])?a(r,t.createFieldDimension(c[0].qName),t,o):s(r,c[0],t,o)):(p(r=t.createFieldDimension(u.name),c,e,t,o),l())})},getDropDimensionOptions:function(e,t,o,l,c){if(t.getLayers().length>0)return e.ColorBy(o,t,c),void l();var h=e.item;i.isGeoMakePointField(h.info[0])?r.getList().then(function(e){return e.getLayout()}).then(function(n){var r=i.getFieldsInArchipelagoForGeoMakePointField(h.info[0],n);if(r){var s=n.filter(function(e){var t=e.qName;return r[t]&&!i.isGeoField(e)}).map(function(e){var n=t.createFieldDimension(e.qName);return{name:e.qName,dimension:n}});u(h.info[0],s,e,t,o)}l()}):i.isGeoField(h.info[0])?r.getList().then(function(e){return e.getLayout()}).then(function(n){for(var r,s=0;s<n.length;s++)if(n[s].qName===h.info[0].qName){r=n[s];break}if(r){var a=i.getFieldsInArchipelago(r,n),c=i.isGeoPointField(r),u=n.filter(function(e){var t=e.qName;return a[t]&&(!i.isGeoField(e)||c&&t===r.qName)}).map(function(e){var n=t.createFieldDimension(e.qName);return{name:e.qName,dimension:n}});d(r,u,e,t,o)}l()}):n.current.findMatchingFields(h.info[0].qName,["$geomultipolygon","$geopolygon","$geopoint"]).then(function(n){var r,c=e.item,u=n.qFieldNames;0===u.length?l():1===u.length?(r=t.createLibraryDimension(c.id),i.isGeoPointField(u[0])?a(r,t.createFieldDimension(u[0].qName),t,o):s(r,u[0],t,o)):(p(r=t.createLibraryDimension(c.id),u,e,t,o),l())})},getDropMeasureOptions:function(e,n,i,r,o){e.ColorBy(i,n,o);var s=e.item,a=n.getLayersWithoutMeasure();a.length&&a.forEach(function(r){"polygon"!==r.type&&e.menu.addItem({translation:["contextMenu.add",s.name],tid:"add",select:function(){var e;switch(r.type){case"polygon":e=r.qHyperCubeDef?n.createLibraryMeasure(s.id):{qLibraryId:s.id},n.addMeasureToPolygonLayer(r,e);break;case"point":e=n.createLibraryMeasure(s.id),n.addMeasureToPointLayer(r,e);break;default:return}i.setProperties(n.properties),t.$rootScope.$broadcast("pp-open-path","data."+r.cId)}})}),r()},addFieldDimension:function(e,n){return n.model.getProperties().then(function(r){if(!(r.layers.length>=m)){var o=n.getCreatePropertyHandler();return o.setProperties(r),i.addLayer(e,r,o).then(function(){t.$rootScope.$broadcast("pp-open-path","data."+r.layers[0].cId),n.model.setProperties(r)})}})},addLibraryDimension:function(e,n){return n.model.getProperties().then(function(r){if(!(r.layers.length>=m)){var o=n.getCreatePropertyHandler();return o.setProperties(r),i.addLayer(e,r,o).then(function(){t.$rootScope.$broadcast("pp-open-path","data."+r.layers[0].cId),n.model.setProperties(r)})}})}}}),define("extensions.qliktech/map/interaction-controller",["jquery","objects.views/charts/utils/pan-zoom-controller","general.utils/shapes/point","general.utils/shapes/rect"],function(e,t,n,i){"use strict";function r(){var e,t,n,i,r,o,s,a,l,c,u,h;e={x:this._dataBounds.x,y:this._dataBounds.y},t={x:this._dataBounds.x+this._dataBounds.width,y:this._dataBounds.y+this._dataBounds.height},n=this._viewportProjection.project(e),i=this._viewportProjection.project(t),r=Math.max(n.x,i.x),o=Math.min(n.x,i.x),s=this._viewportProjection.getSize(),(r<0||o>s.x)&&(a=this._viewportProjection.invProject({x:0,y:0}),l=this._viewportProjection.invProject({x:s.x,y:0}),c=Math.abs(l.x-a.x),h=this._viewportProjection.getMapCenterInLatLong(),c>=360?(u=Math.floor(c/360),h.x=h.x+360*u*(h.x<0?1:-1),this._viewportProjection.setMapCenterInLatLong(h)):Math.abs(h.x)>180&&(h.x=h.x%360,h.x>180?h.x-=360:h.x<-180&&(h.x+=360),this._viewportProjection.setMapCenterInLatLong(h)))}return t.extend("InteractionController",{init:function(t,n){var o=this,s=function(){this.getZoomPanByWebkitTransform()||this._viewportProjection.fire("changedByInteraction")};this._minZoomLevel=0,this.chart=t,this.dataArea=this.chart.components.dataArea,this._worldBounds=new i(-180,-180,360,360),this._super(e(this.dataArea.layersContainer),{update:function(){s.call(o)},end:function(){s.call(o)}},null,n),this.helpFunctions.onInteractionStart=function(){o._interactionStarted||(o._localMatrix.identity(),o._globalMatrix=o._viewportProjection.getTransformMatrix().clone(),o._interactionStarted=!0)},this.helpFunctions.onInteractionEnd=function(){if(!(o._zooming||o._panning||o._pinching)){var e=!1;o.helpFunctions.setTransform(o.dataArea.layersContainer,"matrix(1,0,0,1,0,0)"),o._viewportProjection.enabledChangeEvent=!1,o._viewportProjection.setTransformMatrix(o._globalMatrix),o.dataArea.hasVisibleBaseLayer()&&(r.call(o),e=o.dataArea.baseMapLayer.updateViewportToBaseMap(o)),e||o._viewportProjection.fire("changedByInteraction"),o._viewportProjection.enabledChangeEvent=!0,o._interactionStarted=!1}}},setMapCenter:function(e,t){this._viewportProjection&&(t?this._viewportProjection.setMapCenterInLatLong(e):this._viewportProjection.setDataCenter(e))},getMapCenter:function(){return this._viewportProjection?this._viewportProjection.getDataCenter():null},moveViewport:function(e,t){var i,r,o,s,a,l,c,u,h,d,p,f,m;i={x:this._dataBounds.x,y:this._dataBounds.y},r={x:this._dataBounds.x+this._dataBounds.width,y:this._dataBounds.y+this._dataBounds.height},a=this._viewportProjection.project(i),l=this._viewportProjection.project(r),c=Math.max(a.x,l.x),u=Math.min(a.x,l.x),h=this._viewportProjection.getSize(),e>0&&u+e<=h.x||e<0&&c+e>=0||!(this.dataArea.baseMapLayer&&this.dataArea.baseMapLayer.isReady()&&this.dataArea.baseMapLayer.show)?this.setMapCenter(this._viewportProjection.invProject(new n(h.x/2-e,h.y/2-t))):(o=this._viewportProjection.invProject({x:0,y:0}),s=this._viewportProjection.invProject({x:h.x,y:0}),(p=Math.abs(s.x-o.x))>=360?(f=h.x/p*360,m=Math.floor(p/360),e>0&&u+e>h.x?e-=f*m:e<0&&c+e<0&&(e=f*m-e),this.setMapCenter(this._viewportProjection.invProject(new n(h.x/2-e,h.y/2-t)))):(this.dataArea.baseMapLayer.panBy(-e,-t),d=this.dataArea.baseMapLayer.getMapCenter(),this.setMapCenter(d,!0)))},zoomOnPixel:function(e,t){var n,i,o=this.getZoomLevel();o<=this._minZoomLevel&&t<=1||o>=this._maxZoomLevel&&t>=1||(n=Math.pow(2,this._minZoomLevel-o),i=Math.pow(2,this._maxZoomLevel-o),t=Math.min(Math.max(t,n),i),this._viewportProjection.zoomOnPixel(e,t),this.dataArea.hasVisibleBaseLayer()&&r.call(this))},zoomOnDataRectangle:function(e,t){this._viewportProjection.zoomOnDataRectangle(e,t)},zoomOnMapBounds:function(){var e=this._dataBounds&&!this._dataBounds.hasNaN()?this._dataBounds:this._worldBounds;if(e)return this.zoomOnDataRectangle(e,!1),this.dataArea.hasVisibleBaseLayer()&&(this._viewportProjection.inResetZoomMode=!0),this._viewportProjection.fire("resetZoomFinished"),!0},release:function(){this._super(),this.chart=null,this.dataArea=null}})}),define("extensions.qliktech/map/map-impl",["jquery","objects.views/charts/chart","objects.views/charts/components/chart-component","objects.backend-api/map-api","objects.views/charts/representation/combo-color-map","objects.views/charts/utils/binding","text!./map.ng.html","extensions.qliktech/map/map-properties","extensions.qliktech/map/projection/viewport-projection-mercator","objects.views/charts/utils/unit-projection","extensions.qliktech/map/map-area","general.utils/shapes/rect","objects.utils/event-utils","client.utils/property-mapper","extensions.qliktech/map/map-handler","objects.views/charts/components/axis/axis","objects.views/charts/components/legend/color-legend","extensions.qliktech/map/add-popover/add-layer-popover","extensions.qliktech/map/map-layer-creation","extensions.qliktech/map/interaction-controller","core.utils/deferred","general.utils/support","touche","objects.views/charts/components/zoom-pan-navigation/zoom-pan-navigation"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,x,q,C){"use strict";function S(e){var t=e&&e.qDimensionInfo.length&&!e.qDimensionInfo.some(function(e){return!!e.qError});return e.qMeasureInfo&&e.qMeasureInfo.length&&(t=t&&!e.qMeasureInfo.some(function(e){return!!e.qError})),t}function w(e){if(!(e&&(e.layers&&0!==e.layers.length||e.background&&e.background.show)))return!1;var t,n,i=Math.min(e.layers.length,F);for(t=0;t<i;t++){if(!(n=e.layers[t]).qHyperCube)return!1;if(S(n.qHyperCube))return!0}return e.background&&e.background.show}function _(e){return e&&e.qDimensionInfo.every(function(e){return!0!==e.qLocked})}function D(e){this._projection&&e&&this._projection.getProjectionType()===e.getProjectionType()||(this._projection=e,this._projection||(this._projection=this._unitProjection),this._viewportProjection.setProjection(this._projection))}function M(e){this._inZoomOnMapBoundsMode&&(this._mapRectInZoomOnMapBoundsModeNeedToUpdate=!0),this._viewportProjection.setSize(e)}function A(){this._inZoomOnMapBoundsMode&&(this._mapRectInZoomOnMapBoundsMode=this._viewportProjection.getDataRectOfViewport(),this._mapRect=this._mapRectInZoomOnMapBoundsMode.clone())}function E(){this._mapRect=this._viewportProjection.getDataRectOfViewport(),this._mapRectInZoomOnMapBoundsModeNeedToUpdate&&(this._mapRectInZoomOnMapBoundsMode=this._mapRect.clone(),this._mapRectInZoomOnMapBoundsModeNeedToUpdate=!1),this.updateNavigation()}function I(){var e=this.selections&&this.selections.cache||this.tooltips&&this.tooltips.cache;if(e){var t=this.components.dataArea.getSelectableShapes(),n=this.components.dataArea.layers,i=!(!this.selections||!this.selections.getActiveType)&&this.selections.getActiveType(),r=!!i;e.clear(),t.forEach(function(t){e.add(t)}),r&&(/^item/.test(i.getActiveMode())?t.forEach(function(e){var t=n[e.layerIndex].getSelectedRows();e.selected=t&&t.indexOf(e.rowIdx)>=0}):(i.activeComponent instanceof m&&!i.activeComponent.isDiscrete()||i.activeComponent instanceof g&&"range"===i.getActiveMode())&&i.updateShapesState()),Object.keys(this.components).forEach(function(e){["colorLegend","xAxis","dimensionAxis"].contains(e)&&this.components[e].setSelectableShapes(t)},this)}}function T(e){var t,n,i,r=e?e.length:0,o=[];for(t=0;t<r;t++)void 0===o[i=(n=e[t]).layerIndex]&&(o[i]=[]),o[i][o[i].length]=n;return o}function L(e,t,n){var i,r,o,s;for(i=n;i>-1;i--)for(o=(r=t[i])?r.length:0,s=0;s<o;s++)r[s].selected=!1}function k(){this._mapRectInZoomOnMapBoundsMode=this._viewportProjection.getDataRectOfViewport(),this._mapRect=this._mapRectInZoomOnMapBoundsMode.clone(),this.updateNavigation()}function O(){if(!this._mapRectInZoomOnMapBoundsMode)return!1;var e=this._mapRectInZoomOnMapBoundsMode.x-this._mapRect.x,t=this._mapRectInZoomOnMapBoundsMode.y-this._mapRect.y,n=this._mapRect.width-this._mapRectInZoomOnMapBoundsMode.width,i=this._mapRect.height-this._mapRectInZoomOnMapBoundsMode.height;return Math.abs(e)<R&&Math.abs(n)<R&&Math.abs(t)<R&&Math.abs(i)<R}function P(e,t,n){var i=this;this.$scope.navigationVisible=e,this.$scope.navigationHomeOnly=t,this.$scope.navigationDefaultPosition=n,this.yMirrorMode?this.$scope.navigationStyle={top:this.components.dataArea.rect.y+13+"px",left:this.components.dataArea.rect.x+15+"px"}:this.$scope.navigationStyle={top:this.components.dataArea.rect.y+13+"px",right:this.rect.width-this.components.dataArea.rect.x-this.components.dataArea.rect.width+13+"px"},void 0===this._timeoutID&&(this._timeoutID=setTimeout(function(){i._timeoutID=void 0,i.$scope.$digest()}))}var N,R=1e-9,F=1;return N=t.extend("Map",{namespace:".map",init:function(t,i,s,a,d){var p=this;s=e.extend(!0,s||{},{providers:{colorMap:{clazz:r,multiDimScheme:"first",autoMode:"primary"}},components:{dataArea:{show:!0,dock:"center",clazz:u,showFlag:n.prototype.ShowFlags.SPARK},colorLegend:{show:!0,dock:"right",relevantSize:126,label:"colorLegend",showFlag:n.prototype.ShowFlags.MEDIUM}}}),this._super(t,i,s,a,d),this.backendApi=a,this.components.colorLegend.hideComponent(),this._autoZoomOnDataChange=!0,this._worldBounds=new h(-180,-180,360,360),this._unitProjection=new c,this.setViewportProjection(new l),D.call(this,this._unitProjection),this.interactionController=new b(this,this._viewportProjection),this.interactionController.setZoomPanByWebkitTransform(!q.treatAsDesktop()),this.components.dataArea.setMaxNumLayers(F),this.components.dataArea.setMap(this),this.components.dataArea.setBackendApi(this.backendApi),this.components.dataArea.setSelectionsApi(this.selectionsApi),this.components.dataArea.setLegend(this.components.colorLegend),this.components.dataArea.setChartContext(this._chartContext),this.components.dataArea.setInteractionController(this.interactionController),this._changeWatchers=this._changeWatchers||[],this._changeWatchers.push(o.bindProperty(this.components.dataArea,"dimensionTree",this._chartContext,"dimensionTree")),this._changeWatchers.push(o.bindProperty(this.providers.colorMap,"dimensionTree",this._chartContext,"dimensionTree")),this.onNavigationPressed=t.$on("navigationPressed",function(e,t){e.preventDefault(),p.interactionController.navigate(t)}),this.$scope.navigationDisabled=!0,this.$scope.dataAttributes={},this._scaleMapOnResize=!0},setFormatter:function(e){var t;if(this.chartFormatter=e,this.chartFormatter){for(t in this.components)this.components[t].chartFormatter=this.chartFormatter,this.components[t].measureFormatters=this.chartFormatter.getFormatters(),this.components[t].combinedMeasuresFormatter=this.chartFormatter.getCombinedMeasuresFormatter();this.providers.colorMap&&(this.providers.colorMap.setMeasureFormatters(this.chartFormatter.getFormatters()),this.providers.colorMap.setGenericFormatter(this.chartFormatter.createFormatter())),this.tooltips&&(this.tooltips.measureFormatters=this.chartFormatter.getFormatters())}},setViewportProjection:function(e){this._viewportProjection&&(this._viewportProjection.stopListen("resetZoomFinished",k,this),this._viewportProjection.stopListen("changedByBaseMap",A,this),this._viewportProjection.stopListen("changed",E,this),this._viewportProjection.stopListen("changedByInteraction",E,this)),this._viewportProjection=e,this.components.dataArea.setViewportProjection(this._viewportProjection),this._viewportProjection&&(this._viewportProjection.listen("resetZoomFinished",k,this),this._viewportProjection.listen("changedByBaseMap",A,this),this._viewportProjection.listen("changed",E,this),this._viewportProjection.listen("changedByInteraction",E,this))},getViewportProjection:function(){return this._viewportProjection},suppressOnPaint:function(e){var t;return this.$scope.object._forcePaint?(this.$scope.object._forcePaint=!1,t=!1):t=e.qSelectionInfo&&e.qSelectionInfo.qInSelections,t&&this.prePaint(e),t},prePaint:function(e){this._super(e);var t=this,n=!1;e.layers.forEach(function(e){var i=e.qHyperCube,r=i&&i.qDataPages&&i.qDataPages[0]&&i.qDataPages[0].qMatrix?i.qDataPages[0].qMatrix.length:0;t.$scope.dataAttributes.limitedData=r>0&&i.qSize.qcy>r,t.$scope.dataAttributes.limitedData&&(n=!0)}),this.$scope.options.showDisclaimerStar=n,this.$element.toggleClass("qv-viz-with-disclaimer",n)},_updateData:function(e,t){var n=[];this.layersReadyDfd=x(),this.layersReady=this.layersReadyDfd.promise,n.push(this.layersReady),this._data=e,this._readStoredData=e&&e.snapshotData&&e.snapshotData.content&&this.backendApi.isSnapshot,this.setAutoZoomOnDataChange(this._data.autoZoomOnSelection||void 0===this._data.autoZoomOnSelection),this.updateSelectableState(e),n.push(this.components.dataArea.setData(e)),this.tooltips&&(this.tooltips.enabled=this.components.dataArea.hasVisibleLayer(),this.tooltips.parentScope=this.$scope,this.tooltips.colorMap=this.providers.colorMap),this.updateLegend(e,t);var i=x.all(n);return this._dfdUpdatingData=i,this._dfdUpdatingData},updateLegend:function(e){if(this.components.colorLegend){this.components.colorLegend.attributeSelectionsCache=this.attributeSelectionsCache,this._updateLegendDock(this.components.colorLegend,e);var t=e&&e.legend&&e.legend.show;(t=t&&this.components.dataArea.hasVisibleLayer())?this.components.colorLegend.showComponent():this.components.colorLegend.hideComponent()}},isValid:function(e){return this.isDataValid(e)},isDataValid:function(e){var t,n=w(e);for(t in this.components)this.components[t].setHasValidData(n);return n},isDataSelectable:function(e){if(!this.isValid(e)||!this.inAnalysisState())return!1;var t,n=Math.min(e.layers.length,F);for(t=0;t<n;t++)if(e.layers[t].qHyperCube&&_(e.layers[t].qHyperCube))return!0;return!1},setAutoZoomOnDataChange:function(e){this._autoZoomOnDataChange=!!e},getAutoZoomOnDataChange:function(){return this._autoZoomOnDataChange},setScaleMapOnResize:function(e){this._scaleMapOnResize=e},getScaleMapOnResize:function(){return this._scaleMapOnResize},setMapCenter:function(e){this.interactionController.setMapCenter(e)},getMapCenter:function(){return this.interactionController.getMapCenter()},setZoomLevel:function(e){this.interactionController.setZoomLevel(e)},getZoomLevel:function(){return this.interactionController.getZoomLevel()},setMapBounds:function(e){this._mapBounds=e.clone(),this.interactionController.setBoundsRect(e),this._autoZoomOnDataChange||(this._mapRectInZoomOnMapBoundsMode=this._viewportProjection.getDataRectOfViewportIfZoomOnADataRect(this._mapBounds),this.updateNavigation())},zoomOnMapBounds:function(){this._inZoomOnMapBoundsMode=!0,this._mapRectInZoomOnMapBoundsModeNeedToUpdate=!0;var e=this.interactionController.zoomOnDataBounds();return this._mapRectInZoomOnMapBoundsModeNeedToUpdate=!1,e},setFractionalZoomMode:function(e){this.interactionController.setFractionalZoomMode(e)},getFractionalZoomMode:function(){return this.interactionController.getFractionalZoomMode()},setZoomPanByWebkitTransform:function(e){this.interactionController.setZoomPanByWebkitTransform(e||!q.treatAsDesktop())},getZoomPanByWebkitTransform:function(){return this.interactionController.getZoomPanByWebkitTransform()},on:function(){this._on?this._super():(this._navigation&&(this.interactionController.on(".map",this.components.dataArea.container),this.$scope.navigationDisabled=!1),this._super())},off:function(){this.$scope.navigationDisabled=!0,this._on&&(this._navigation&&(this.interactionController.off(),C(this.components.dataArea.container).off("*",".map"),C(this.container).off("*",".map"),e(this.components.dataArea.container).off(".map"),e(this.container).off(".map")),this._super())},initSelections:function(){this.selections._disableSelections=this.options._disableSelections,this.selections.types.dataArea.setComponent("dataArea",this.components.dataArea),this.selections.types.colorLegend.setComponent("colorLegend",this.components.colorLegend),this.options._disableSelections||(this.selections.Activated.bind(this.Activated.bind(this)),this.selections.Deactivated.bind(this.Deactivated.bind(this)),this.selections.Lasso.bind(this.onToggleLasso.bind(this)),this.selections.Select.bind(this.Select.bind(this)),this.selections.SelectRange.bind(this.onSelection.SelectRange.bind(this)),this.selections.SelectAttributeDim.bind(this.onSelection.SelectAttributeDim.bind(this)),this.selections.ToggleShapes.bind(this.ToggleShapes.bind(this)),this.selections.Confirm.bind(this.onSelection.Confirm.bind(this)),this.selections.Cancel.bind(this.Cancel.bind(this)),this.selections.Clear.bind(this.Clear.bind(this)),this.selections.SelectWhileLocked.bind(this.selectWhileLocked.bind(this)))},initTooltips:function(){this.tooltips.setComponent("dataArea",this.components.dataArea)},selectWhileLocked:function(e){var t,n=[];this._data.layers.forEach(function(e){t=e.qHyperCube.qDimensionInfo,n.push(t instanceof Array?t[0]:t)}),d.showLockedFeedback(e||n)},ToggleShapes:function(e,t){if(e&&0!==e.length){var n,i,r,o,s,a,l,c=this;for(this._haveToggledShapes=!1,this._renderOnToggleShapes=!0,setTimeout(function(){c._renderOnToggleShapes&&c.onSelection.scheduleInvalidation.call(c,!0),c._renderOnToggleShapes=!1},50),r=this._data&&this._data.layers?Math.min(this._data.layers.length,F):0,i=T(e),a=4==(4&t),this._layerIndexOfClick=-1,o=r-1;o>-1;o--)if(n=this.components.dataArea.layers[o],s=i[o],l=s?s.length:0,n.isVisible()&&0!==l&&(n.toggleShapes(s),a))return this._layerIndexOfClick=o,void L(0,i,o-1)}},Activated:function(){this.onSelection.Activated.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!0)},Deactivated:function(){this._renderOnToggleShapes=!1,this.onSelection.Deactivated.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!1)},Cancel:function(){this.onSelection.Cancel.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!1)},Clear:function(){this.onSelection.Clear.apply(this,[].slice.call(arguments)),this.setPreselectionMode(!1)},Select:function(e,t,n){var i,r=T(e),o=Array.isArray(n)?n:[n||0],s=this.components.dataArea.layers,a=s?s.length:0;if(-1===this._layerIndexOfClick){for(i=0;i<a;i++)"hyperCube"===s[i].getDataType()&&s[i].selectOnLayer(r[i],o);for(i=0;i<a;i++)"listObject"===s[i].getDataType()&&s[i].selectOnLayer(r[i],o)}else s[i=this._layerIndexOfClick].selectOnLayer(r[i],o)},_initiateBindings:function(){this._changeWatchers||(this._changeWatchers=[]);var e;for(e in this.components)this._changeWatchers.push(o.bindProperty(this.components[e],"layoutMode",this,"layoutMode"));this.components.dataArea&&this._changeWatchers.push(o.bindSetter(I.bind(this),this.components.dataArea,"selectableShapes"))},resize:function(){return this._resizing=!0,this._super().then(function(){this._resizing=!1}.bind(this))},layout:function(){this._super();var t=this.components.dataArea?this.components.dataArea.rect:this.rect;M.call(this,{x:t.width,y:t.height}),this.components.dataArea.setRect(t.x,t.y,t.width,t.height),this.components.dataArea.updateSize(),this.components.dataArea&&this.interactionController.setOffset(e(this.components.dataArea.container).offset())},setPreselectionMode:function(e){this._preselectionMode=e,this.components.dataArea.setPreselectionMode(e)},_paint:function(){var e=this._super.bind(this);return this.layersReady.then(function(){return e().then(function(e){if(!e||!e.invalid){var t,n=[];if(this.layout(),this.options.viewState||this.backendApi.isSnapshot&&this._readStoredData){var i=this.options.viewState||this.getSnapshotStoredChartData(),r=i.mapRect;i.inZoomOnMapBoundsMode||!r||void 0===r.width||void 0===r.height||void 0===r.x||void 0===r.y?this.zoomOnMapBounds():this._viewportProjection.zoomOnDataRectangle(r,!0)}else!this._inZoomOnMapBoundsMode||this._firstTimeZoomOnMapBound&&!this._autoZoomOnDataChange?this._scaleMapOnResize&&this._mapRect&&this._viewportProjection.zoomOnDataRectangle(this._mapRect,!0):this._firstTimeZoomOnMapBound=this.zoomOnMapBounds();for(t in this.components)n.push(this.components[t].invalidateDisplay("Map._paint"));return this._dfdUpdatingData&&n.push(this._dfdUpdatingData),this.updateNavigation(),this._dataChanged=!1,x.all(n)}}.bind(this))}.bind(this))},updateNavigation:function(e){if(this._data&&this.rect&&this._mapRect&&this._navigation){var t,n=this.rect.width>=400&&this.rect.height>=400,i=this._layoutMode>=3,r=this.inAnalysisState()||this.inEditState(),o=this._data.navigation?i&&!n:i;this._inZoomOnMapBoundsMode=O.call(this),t=void 0===e?!this._inZoomOnMapBoundsMode||r&&i&&!!this._data.navigation:!e,P.apply(this,[t,o,this._inZoomOnMapBoundsMode])}},getContextMenu:function(e,t){var n=e,i=n.model,r=this.inEditState(),o=i.layout;n.isReadonly&&r||t.addItem({translation:"Common.Navigation",tid:"navigation",icon:"home",select:function(){if(r)i.getProperties().then(function(e){e.navigation=!e.navigation,i.setProperties(e)});else{var e=[{qPath:"/navigation",qOp:void 0===o.navigation?"add":"replace",qValue:o.navigation?"false":"true"}];n.backendApi.applyPatches(e,!0)}}})},destroy:function(){this._super(),this._viewportProjection&&(this._viewportProjection.stopListen("resetZoomFinished"),this._viewportProjection.stopListen("changedByBaseMap"),this._viewportProjection.stopListen("changed"),this._viewportProjection.stopListen("changedByInteraction")),this.onNavigationPressed(),this.interactionController.release()},setSnapshotData:function(e){var t=[];if(this._super(e),this.isSnapshot())return x.resolve();for(var n=0;n<this._data.layers.length;n++)this.components.dataArea.layers[n]&&(t[n]=this.components.dataArea.layers[n].getSnapshotLayerData(e.layers[n]));return x.all(t)},getSnapshotChartData:function(){return e.extend(!0,this._super()||{},{inZoomOnMapBoundsMode:this._inZoomOnMapBoundsMode,mapRect:this._viewportProjection.getDataRectOfViewport()})},getViewState:function(){return{inZoomOnMapBoundsMode:this._inZoomOnMapBoundsMode,mapRect:this._viewportProjection.getDataRectOfViewport()}},isSnapshot:function(){return this.backendApi&&this.backendApi.isSnapshot},getPreferredSize:function(){return this._super()},setInteractionState:function(e){this._super(e),this.components.dataArea.baseMapLayer&&(this.updateNavigation(),this.inAnalysisState()?this.components.dataArea.baseMapLayer.on():this.components.dataArea.baseMapLayer.off())}}),{type:"map",BackendApi:i,template:s,View:N,definition:a,initialProperties:{layers:[]},exportProperties:null,importProperties:null,getDimensionInfo:function(){return[]},getMeasureInfo:function(){return[]},mapProperties:function(){this.mappedDefinition=p.mapDefinition(this.definition,this.type),this.globalChangeListeners=p.findGlobalListeners(this.mappedDefinition),this.dimensionDefinition={min:1,max:1,ppPath:"data"}},addFieldDimension:y.addFieldDimension,addLibraryDimension:y.addLibraryDimension,addDimensionPopoverComponent:v,getDropFieldOptions:y.getDropFieldOptions,getDropDimensionOptions:y.getDropDimensionOptions,getDropMeasureOptions:y.getDropMeasureOptions,getCreatePropertyHandler:function(e){return new f({app:e,dimensionDefinition:this.dimensionDefinition,globalChangeListeners:this.globalChangeListeners,path:"layers.0"})},hasError:function(e){var t,n,i=e.layout;for(t=0;t<i.layers.length;++t){if((n=i.layers[t]).qHyperCube&&n.qHyperCube.qError)return n.qHyperCube.qError;if(n.geodata&&n.geodata.qHyperCube&&n.geodata.qHyperCube.qError)return n.geodata.qHyperCube.qError}return!1},showRequirements:function(e){var t=e.layout.layers;return!t||!t.length||t[0].qHyperCube.qDimensionInfo.some(function(e){return e.qError&&e.qError.qErrorCode})},support:{cssScaling:!1,snapshot:!0,export:!0,exportData:!1,sharing:!0},options:{selections:{dataArea:{},colorLegend:{}},tooltips:{}}}}),define("extensions.qliktech/map/map",["client.utils/capability-flags","extensions.qliktech/mapchart/Map","extensions.qliktech/map/map-impl"],function(e,t,n){return e.getFlag("GEO_MIGRATE")?t:n}),define("extensions.qliktech/combochart/markerarea",["core.utils/deferred","objects.views/charts/components/chart-component","objects.views/charts/renderers/canvas-renderer","objects.views/charts/shapes/container","objects.views/charts/shapes/circle","objects.views/charts/shapes/polygon","objects.views/charts/shapes/rect","extensions.qliktech/linechart/layers/oob-layer"],function(e,t,n,i,r,o,s,a){function l(e){switch(e){case"diamond":case"triangle":return new o;case"circle":return new r;case"line":default:return new s}}function c(e,t,n,i,r,o){var s,a=r.type,l=r.rgb,c=r.shiftedRgb,u=r.isFilled;switch(a){case"circle":e.set(t,n,Math.max(2,Math.min(6,.125*i)));break;case"diamond":s=Math.max(4,Math.min(12,.25*i)),e.set([{x:t,y:n-s/2},{x:t-s/2,y:n},{x:t,y:n+s/2},{x:t+s/2,y:n}]);break;case"triangle":s=Math.max(4,Math.min(12,.25*i)),e.set([{x:t,y:n-s/2},{x:t-s/2,y:n+s/2},{x:t+s/2,y:n+s/2}]);break;case"line":(s=Math.max(4,.5*i))<24?e.set(t-s/2,Math.floor(n)-.5,s,Math.min(3,Math.max(2,Math.round(s/4)))):e.set(Math.floor(t-s/2)-.5,Math.floor(n)-.5,Math.ceil(s),Math.min(3,Math.max(2,Math.round(s/4)))),u=!0;break;default:s=Math.max(4,Math.min(12,.25*i)),e.set(t-s/2,n-s/2,s,s)}!1!==u?(e.fill=l,e.stroke=c):(e.stroke=l,delete e.fill),o&&(e.stroke="#000000")}function u(e){var t,n,i,r,o,s,a,l=this._shapes?this._shapes.length:0,u=this.rect.width,h=this._majorAxis;for(this._outOfRange={up:{},down:{},points:[]},t=0;t<l;t++){a=this._shapes[t],r=this._minorAxes[a.data.axisIdx],o=e[this._measureToAxisIndex[a.data.measureIdx]],s=this.isDimensionContinuous?2:h.getWidthOfId(a.data.axisId),n=this.isDimensionContinuous?this._activeDimAxis.getPositionOfValue(a.data.axisNum):h.getPositionOfId(a.data.axisId),i=r.getPositionOfValue(a.data.end),a.data.x=n,a.data.y=i,a.data.outOfRangeUp=i<o.topCutoff,a.data.outOfRangeDown=i>o.bottomCutoff,a.data.selected=a.data.cacheItem&&a.data.cacheItem.selected,a.opacity=a.data.outOfRangeUp||a.data.outOfRangeDown?0:a.data.selected?1:this._globalAlpha,i=a.data.outOfRangeUp?o.topCutoff+4:a.data.outOfRangeDown?o.bottomCutoff-4:Math.floor(i);var d=a.data.cacheItem&&a.data.cacheItem.selected;this.isDimensionContinuous&&this.selectedRanges&&!d&&(d=this.selectedRanges.some(function(e){return a.data.axisNum>=e.min&&(e.maxIncluded?a.data.axisNum<=e.max:a.data.axisNum<e.max)})),c(a,n,i,s,a.data,d),a.data.isVisible=n>=0&&n<=u,a.data.isVisible&&(a.data.outOfRangeUp||a.data.outOfRangeDown)&&(a.data.outOfRangeUp&&!this._outOfRange.up[n]?(this._outOfRange.points.push(a),this._outOfRange.up[n]=!0):a.data.outOfRangeDown&&!this._outOfRange.down[n]&&(this._outOfRange.points.push(a),this._outOfRange.down[n]=!0))}}return t.extend("MarkerArea",{init:function(){this._super.apply(this,arguments),this.renderers={markers:new n(this.container,{name:"marker-layer"})},this._edgeBleed=0,this._oobLayer=new a(this.container),this.layers=[this._oobLayer],this._markerRenderer=this.renderers.markers},setColorMap:function(e){this._colorMap=e},getColorMap:function(){return this._colorMap},getMeasureIndices:function(){return this._measureIndices},setMeasureIndices:function(e){this._measureIndices=e},setMajorAxis:function(e){this._majorAxis=e,this._majorAxis.listen("changed",function(){this.invalidateDisplay("MarkerArea.setMajorAxis")},this)},setMinorAxis:function(e){this._minorAxis=e,this._minorAxis.listen("changed",function(){this.invalidateDisplay("MarkerArea.setMinorAxis")},this)},setSecondaryMinorAxis:function(e){this._secondaryMinorAxis=e,this._secondaryMinorAxis.listen("changed",function(){this.invalidateDisplay("MarkerArea.setSecondaryMinorAxis")},this)},setTimeAxis:function(e){this.timeAxis=e,this.timeAxis.listen("changed",function(){this.invalidateDisplay()},this)},setContinuousAxis:function(e){this.continuousAxis=e,this.continuousAxis.listen("changed",function(){this.invalidateDisplay()},this)},setActiveDimensionAxis:function(e){this._activeDimAxis=e},setIsDimensionContinuous:function(e){this.isDimensionContinuous=e,this._edgeBleed=this.isDimensionContinuous?5:0},setDimensionTree:function(e){this._tree=e,this.invalidateProperties()},hasValidData:function(){return this._super()&&this._data},getMajorAxisData:function(){return this._majorAxisData},createAxisData:function(e,t,n,i){return i||(this._cacheIndex=0),e.children.map(function(e){var n;return"dimension"===t.types[i]&&(n={label:e.data.qText,group:!1,id:e.data.id,cacheIndex:[]},"measure"===t.types[i+1]&&n.cacheIndex.push(this._cacheIndex++)),n},this)},_createMeasureDisplayNode:function(e,t,n,i){var r=l(n),o=e.children[0].data,s=e.parent.cacheItem,a=this.measureFormatters[t],c=void 0!==o.qValue?o.qValue:o.qNum,u=e.ancestors.filter(function(e){return"qElemNo"in e.data}).map(function(e){return e.data.qElemNo}).reverse();return r.data={qText:e.data.qText,qNum:c,start:0,end:c,valueLabel:a&&"U"===a.type?a.formatValue(c):e.data.qText,cacheItem:s,type:n,isFilled:i,measureIdx:t,color:this._colorMap.getColor(u,c,t,e.data.rowIndex)},s.addShape("dataArea",r,!0),r.fill=r.data.color.toHex(),r.data.rgb=r.data.color.toRGBA(),r.data.shiftedRgb=r.data.color.createShiftedColor().toRGBA(),r},_createDimensionDisplayNode:function(e){var t=new i;return t.data={qText:e.data.qText},t},_applyIds:function(e,t,n,i){var r;e.children.forEach(function(o,s){r=e.data.id?e.data.id+";"||"":"","dimension"===n[i]?(o.data.id=r+t[i]+":"+o.data.qElemNo,this._applyIds(o,t,n,i+1)):"measure"===n[i]&&(o.data.id=r+t[i+s])},this)},getRenderTree:function(e,t,n,i){var r,o,s;return o=e.children,"measure"===t.types[i]&&this._measureIndices&&(o=o.filter(function(e,t){return this._measureIndices.indexOf(t)>=0},this)),o.map(function(e,o){var a;return"dimension"===t.types[i]?(a=this._createDimensionDisplayNode(e),(r=this.getRenderTree(e,t,n,i+1)).forEach(function(e){a.addChild(e)})):"measure"===t.types[i]&&(s=this._measureIndices?this._measureIndices[o]:o,(a=this._createMeasureDisplayNode(e,s,this._data.qHyperCube.qMeasureInfo[s].series.marker||"circle",this._data.qHyperCube.qMeasureInfo[s].series.markerFill)).data.axisId=e.parent.data.id,a.data.axisNum=e.parent.data.qNum,a.data.axisIdx=t.measureToAxisIndex[s],n.shapes.push(a)),a},this)},updateRangeSelection:function(e){this.isMini||(this.selectedRanges=e)},_updateProperties:function(){if(this._markerRenderer.stage.removeChildren(),this._data&&this._tree){var e,t,n=this._data.qHyperCube.qDimensionInfo.length,i=this._measureIndices?this._measureIndices.length:this._data.qHyperCube.qMeasureInfo.length,r=n+1,o=new Array(n).join(",").split(",").map(function(){return"dimension"}),s=this._data.qHyperCube.qDimensionInfo.concat(this._data.qHyperCube.qMeasureInfo).map(function(e){return e.cId}),a=this._data.qHyperCube.qDimensionInfo.map(function(e){return e.qApprMaxGlyphCount});a.push(this._data.qHyperCube.qMeasureInfo.reduce(function(e,t){return Math.max(e,t.qApprMaxGlyphCount)},0)),this._minorAxes=[this._minorAxis],this._secondaryMinorAxis&&this._minorAxes.push(this._secondaryMinorAxis);var l=this._minorAxes,c=[],u=[];if(this._measureIndices)u=this._measureIndices;else if(i>0&&i<20)for(;u.length<i;)u.push(u.slice(-1)[0]+1||0);u.forEach(function(e){c[e]=l.filter(function(t){return!t._dataIndices||t._dataIndices.indexOf(e)>=0})[0]}),this._measureToAxis=c,this._measureToAxisIndex=c.map(function(e){return l.indexOf(e)}),o.push("measure"),e={shapes:[],shapesToLabel:[],globalPositiveSum:0,globalNegativeSum:0},t={colIds:s,types:o,numLevels:r,numMeasures:i,measureToAxisIndex:this._measureToAxisIndex,axesSettings:this._minorAxes.map(this._getAxisDetails)},this._applyIds(this._tree,s,o,0);var h=this.getRenderTree(this._tree,t,e,0);this._objects=h,this._shapes=e.shapes,h.forEach(function(e){this._markerRenderer.stage.addChild(e)},this);var d=this.createAxisData(this._tree,t,e,0),p=o.map(function(e,t){return{qApprMaxGlyphCount:a[t],show:t<o.length-1}});this._majorAxisData={data:d,info:p},this.setSelectableShapes(e.shapes.map(function(e){return e.data.cacheItem}))}},paint:function(){this._super(this._layoutMode,this._data);var t=this._minorAxes.map(this._getAxisDetails),n=[];return u.call(this,t),this._oobLayer&&(this._oobLayer.update(this._outOfRange.points,{measureToAxisIndex:this._measureToAxisIndex,axesSettings:t,style:{outOfRange:"#999999"},globalAlpha:this._globalAlpha,markerSize:Math.min(8,this._majorAxis.getDiscreteSpacing()/2)}),this._oobLayer.renderer.edgeBleed={left:0,right:this._edgeBleed,top:0,bottom:0},n.push(this._oobLayer.render())),this._markerRenderer.edgeBleed={left:0,right:this._edgeBleed,top:0,bottom:0},n.push(this._markerRenderer.render()),e.all(n)},updateSize:function(){this._super(),this.renderers.markers.setDimensions(0,-1,this.rect.width,this.rect.height),this.layers.forEach(function(e){e.rect=this.rect,e.renderer.setDimensions(0,0,this.rect.width,this.rect.height),e.renderer.setDimensionsToContainerRatio(this.layoutToContainerRatios.x,this.layoutToContainerRatios.y)},this)},release:function(){this.layers.forEach(function(e){e.release()}),this._super(),this._majorAxis&&this._majorAxis.stopListen("changed",null,this),this._minorAxis&&this._minorAxis.stopListen("changed",null,this),this._secondaryMinorAxis&&this._secondaryMinorAxis.stopListen("changed",null,this),this.timeAxis&&this.timeAxis.stopListen("changed",null,this),this.continuousAxis&&this.continuousAxis.stopListen("changed",null,this)},clear:function(){this._super(),this.layers.forEach(function(e){e.clear()})},_getAxisDetails:function(e){var t=e.getPlotMin(),n=e.getPlotMax(),i=n-t,r=e.getPadding(),o=r.top-1,s=e.rect.height-r.bottom,a=0;return a=t>0?s:n<0?o:Math.floor(e.getPositionOfValue(0))-.5,{plotMin:t,plotMax:n,posMin:e.getPositionOfValue(t),posMax:e.getPositionOfValue(n),plotRange:i,topCutoff:o,bottomCutoff:s,areaStartBase:a,zeroPos:Math.floor(e.getPositionOfValue(0))-.5}}})}),define("extensions.qliktech/combochart/comboarea",["objects.views/charts/components/chart-component","extensions.qliktech/linechart/linearea","extensions.qliktech/barchart/bararea","extensions.qliktech/combochart/markerarea","core.utils/deferred"],function(e,t,n,i,r){"use strict";return e.extend("ComboArea",{init:function(){var e=new(Function.prototype.bind.apply(n,[null].concat([].slice.call(arguments)))),r=new(Function.prototype.bind.apply(t,[null].concat([].slice.call(arguments)))),o=new(Function.prototype.bind.apply(i,[null].concat([].slice.call(arguments))));this._super.apply(this,arguments),this._data=null,this._layoutMode=null,this._selectableShapes=[],this._shapes=[],this._cacheItems=[],this._colorMap=null,r.setShowDataPoints(!this.isMini),r.setShowDataPointLabels(!1),e.setShowDataPoints(!1),this.subComponents=[e,r,o],this.lineArea=r,this.barArea=e,this.markerArea=o},setYMirrorMode:function(e){this.yMirrorMode=e,this.subComponents.forEach(function(t){t.setYMirrorMode(e)})},setColorMap:function(e){this._colorMap=e,this.subComponents.forEach(function(t){t.setColorMap(e)})},getColorMap:function(){return this._colorMap},setShowDataPoints:function(){},setMajorAxis:function(e){this.subComponents.forEach(function(t){t.setMajorAxis(e)}),this._majorAxis=e},setMinorAxis:function(e){this._minorAxis=e,this.subComponents[0].setMinorAxis(this._minorAxis),this.subComponents[2].setMinorAxis(this._minorAxis)},setTimeAxis:function(e){this.timeAxis=e,this.subComponents.forEach(function(t){t.setTimeAxis(e)})},setContinuousAxis:function(e){this.continuousAxis=e,this.subComponents.forEach(function(t){t.setContinuousAxis(e)})},setActiveDimensionAxis:function(e){this._activeDimAxis=e,this.subComponents.forEach(function(t){t.setActiveDimensionAxis(e)})},setIsDimensionContinuous:function(e){this.isDimensionContinuous=e,this.subComponents.forEach(function(t){t.setIsDimensionContinuous(e)})},getMinorAxisData:function(){return this.barArea.getMinorAxisData()},setSecondaryMinorAxis:function(e){this._secondaryMinorAxis=e},setDimensionTree:function(e){this._tree=e,this.subComponents.forEach(function(t){t.setDimensionTree(e)})},setData:function(e){this._super(e);for(var t=[],n=[],i=[],r=0;r<e.qHyperCube.qMeasureInfo.length;r++)e.qHyperCube.qMeasureInfo[r].series&&"line"===e.qHyperCube.qMeasureInfo[r].series.type?t.push(r):e.qHyperCube.qMeasureInfo[r].series&&"marker"===e.qHyperCube.qMeasureInfo[r].series.type?i.push(r):n.push(r);this.subComponents[0].setHasValidData(n.length>0),this.subComponents[1].setHasValidData(t.length>0),this.subComponents[2].setHasValidData(i.length>0),this.lineArea.setMeasureIndices(t),this.barArea.setMeasureIndices(n),this.markerArea.setMeasureIndices(i),this.subComponents.forEach(function(t){t.setData(e)}),this.barArea.setMinorAxis(this._minorAxis),this.lineArea.setMinorAxis(this._secondaryMinorAxis),this.lineArea.setSecondaryMinorAxis(this._minorAxis),this.markerArea.setMinorAxis(this._minorAxis),this.markerArea.setSecondaryMinorAxis(this._secondaryMinorAxis),this.invalidateProperties()},setHasValidData:function(e){this.subComponents.forEach(function(t){t.setHasValidData(e)})},setLayoutMode:function(e){this._super(e),this.subComponents.forEach(function(t){t.setLayoutMode(e)})},setRect:function(e,t,n,i){this._super(e,t,n,i),this.subComponents.forEach(function(r){r.setRect(e,t,n,i)})},setOuterRect:function(e,t,n,i){this._super(e,t,n,i),this.subComponents.forEach(function(r){r.setOuterRect(e,t,n,i)})},setLayoutToContainerRatios:function(e,t){this._super(e,t),this.subComponents.forEach(function(n){n.setLayoutToContainerRatios(e,t)})},setContainerRect:function(e,t,n,i){this._super(e,t,n,i),this.subComponents.forEach(function(r){r.setContainerRect(e,t,n,i)})},insertAdjacentTo:function(){this._super.apply(this,[].slice.call(arguments)),this.subComponents.forEach(function(e){e.setRect(this.rect.x,this.rect.y,this.rect.width,this.rect.height)},this)},setGlobalOpacity:function(e,t){this._super(e,t),this.subComponents.forEach(function(n){n.setGlobalOpacity(e,t)},this)},setLineType:function(){},updateSize:function(){this._super(),this.subComponents.forEach(function(e){e.updateSize()},this)},_updateDisplay:function(){var e=[];return this.subComponents.forEach(function(t){e.push(t.invalidateDisplay())}),r.all(e)},_updateSize:function(){},updateRangeSelection:function(e){this.isMini?this.lineArea.updateRangeSelection(e):this.subComponents.forEach(function(t){t.updateRangeSelection(e)})},_updateProperties:function(){if(this._data&&this._tree){this.barArea.measureFormatters=this.measureFormatters,this.lineArea.measureFormatters=this.measureFormatters,this.markerArea.measureFormatters=this.measureFormatters,this.barArea.combinedMeasuresFormatter=this.combinedMeasuresFormatter,this.lineArea.combinedMeasuresFormatter=this.combinedMeasuresFormatter,this.markerArea.combinedMeasuresFormatter=this.combinedMeasuresFormatter,this.subComponents[0].updateNow(["properties"]),this.subComponents[1].updateNow(["properties"]),this.subComponents[2].updateNow(["properties"]);var e=this.subComponents[0].getSelectableShapes();e&&e.length||(e=this.subComponents[1].getSelectableShapes()),e&&e.length||(e=this.subComponents[2].getSelectableShapes()),this.setSelectableShapes(e)}},invalidateProperties:function(){this._super.apply(this,Array.prototype.slice.call(arguments)),this.subComponents.forEach(function(e){e.invalidateProperties("ComboArea.invalidateProperties")})},hasValidData:function(){return this._super()&&this._majorAxis&&this._minorAxis&&this._data},paint:function(){this._majorAxis.updateNow(),this._minorAxis.updateNow(),this._activeDimAxis&&this._activeDimAxis.updateNow()},clear:function(){this._super(),this.subComponents.forEach(function(e){e.clear()})},release:function(){this.subComponents.forEach(function(e){e.release()})}})}),define("extensions.qliktech/combochart/combochart-properties",["translator","client.utils/property-resolver","objects.utils/continuous-utils","client.property-panel/default-axis-properties-logic","core.utils/feature-flags"],function(e,t,n,i,r){function o(e,n,i){var r=i||0;return(n?n.getMeasureLayouts():t.getValue(e,"qHyperCubeDef.qMeasures",[]).map(function(e){return e.qDef})).filter(function(e){return t.getValue(e,"series.axis",0)===r||0===r&&"bar"===t.getValue(e,"series.type","bar")})}function s(e,t){return t?t.getDimensionLayouts():e.qHyperCubeDef.qDimensions.map(function(e){return e.qDef})}function a(e,t){return t.getMeasures().filter(function(e){return e.qDef.series&&"line"===e.qDef.series.type}).length>0}function l(e,t,n){return t.getMeasures().filter(function(e){return!e.qDef.series||"bar"===e.qDef.series.type}).length>n}var c,u,h,d;return c={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,show:function(e,t,i){return r.COMBO_VALUE_LABELS?a(0,t)||l(0,t,0):a(0,t)||l(0,t,0)&&!n.isContinuousChart(i.layout)},items:{grouping:{ref:"barGrouping.grouping",type:"string",component:"item-selection-list",defaultValue:"grouped",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.grouped",value:"grouped"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.stacked",value:"stacked"}],show:function(e,t,i){return l(0,t,1)&&!n.isContinuousChart(i.layout)}},orientation:{ref:"orientation",type:"string",component:"item-selection-list",defaultValue:"vertical",horizontal:!0,show:!1,items:[{component:"icon-item",icon:"",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}]},scrollStartPos:{ref:"scrollStartPos",type:"number",translation:"properties.ScrollAlignment",component:"dropdown",defaultValue:0,options:[{value:0,translation:"properties.ScrollAlignStart"},{value:1,translation:"properties.ScrollAlignEnd"}],show:function(e,t,i){return!n.isContinuousChart(i.layout)}},nullMode:{type:"string",component:"dropdown",ref:"nullMode",translation:"properties.nullMode",options:[{value:"gap",translation:"properties.nullMode.gap"},{value:"connect",translation:"properties.nullMode.connect"},{value:"zero",translation:"properties.nullMode.zero"}],defaultValue:"gap",show:function(e,t){return a(0,t)&&t.getMeasures().length>1}},dataPointSettings:{type:"items",grouped:!1,snapshot:{tid:"property-dataPoint"},show:function(e,t){return a(0,t)},items:{dataPoints:{ref:"dataPoint.show",translation:"properties.dataPoints.showDataPoints",type:"boolean",defaultValue:!1},showLineDataPointLabels:{ref:"dataPoint.showLineLabels",translation:"properties.dataPoints.linelabelmode",type:"boolean",component:"switch",defaultValue:!1,show:function(e){return e.dataPoint&&e.dataPoint.show&&r.COMBO_VALUE_LABELS},options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]}}},showBarLabels:{ref:"dataPoint.showBarLabels",type:"boolean",translation:"properties.dataPoints.barlabelmode",component:"switch",show:function(e,t){return l(0,t,0)&&r.COMBO_VALUE_LABELS},defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]}}},colorsAndLegend:{uses:"colorsAndLegend",items:{legend:{items:{show:{snapshot:{tid:"property-legend"}}}}}},dimensionAxis:{uses:"axis.dimensionAxis",label:function(t,n){var i=s(t,n).map(function(e){return e.qFallbackTitle||""}).join(", ");return i?e.get("properties.xAxisWithInfo",[i]):e.get("properties.xAxis")},items:{othersGroup:{items:{dock:{options:[{value:"near",translation:"Common.Bottom"},{value:"far",translation:"Common.Top"}]}}}}},measureAxis:{uses:"axis.measureAxis",label:function(t,n){var i=o(t,n,0).map(function(e){return e.qFallbackTitle});return i.length?e.get("properties.yAxisWithInfo",[i.join(",")]):e.get("properties.yAxis")},show:function(e){return o(e,null,0).length>0},items:{axis:{items:{show:{ref:"measureAxes.0.show",snapshot:{title:"properties.yAxis",tid:"property-yAxis"}},dock:{ref:"measureAxes.0.dock",show:function(e){return"none"!==e.measureAxes[0].show},options:[{value:"near",translation:"properties.dock.left"},{value:"far",translation:"properties.dock.right"}]},spacing:{ref:"measureAxes.0.spacing",show:function(e){return e.measureAxes[0]&&"none"!==e.measureAxes[0].show}}}},minMax:{items:{autoMinMax:{ref:"measureAxes.0.autoMinMax"},minMax:{ref:"measureAxes.0.minMax",defaultValue:"min",show:function(e){return!e.measureAxes[0].autoMinMax}},min:{ref:"measureAxes.0.min",show:function(e){return["min","minMax"].contains(e.measureAxes[0].minMax)&&!e.measureAxes[0].autoMinMax},invalid:function(e){return"minMax"===e.measureAxes[0].minMax&&e.measureAxes[0].min>=e.measureAxes[0].max}},max:{ref:"measureAxes.0.max",show:function(e){return["max","minMax"].contains(e.measureAxes[0].minMax)&&!e.measureAxes[0].autoMinMax},invalid:function(e){return"minMax"===e.measureAxes[0].minMax&&e.measureAxes[0].min>=e.measureAxes[0].max}}}}}},secondaryMeasureAxis:{uses:"axis.measureAxis",label:function(t,n){var i=o(t,n,1).map(function(e){return e.qFallbackTitle});return i.length?e.get("properties.yAxisWithInfo",[i.join(",")]):e.get("properties.yAxis")},show:function(e){return o(e,null,1).length>0},items:{axis:{items:{show:{ref:"measureAxes.1.show"},dock:{ref:"measureAxes.1.dock",defaultValue:"far",show:function(e){return"none"!==e.measureAxes[1].show},options:[{value:"near",translation:"properties.dock.left"},{value:"far",translation:"properties.dock.right"}]},spacing:{ref:"measureAxes.1.spacing",show:function(e){return e.measureAxes[1]&&"none"!==e.measureAxes[1].show}}}},minMax:{type:"items",items:{autoMinMax:{ref:"measureAxes.1.autoMinMax"},minMax:{ref:"measureAxes.1.minMax",defaultValue:"min",show:function(e){return!e.measureAxes[1].autoMinMax}},min:{ref:"measureAxes.1.min",show:function(e){return["min","minMax"].contains(e.measureAxes[1].minMax)&&!e.measureAxes[1].autoMinMax},invalid:function(e){return"minMax"===e.measureAxes[1].minMax&&e.measureAxes[1].min>=e.measureAxes[1].max}},max:{ref:"measureAxes.1.max",show:function(e){return["max","minMax"].contains(e.measureAxes[1].minMax)&&!e.measureAxes[1].autoMinMax},invalid:function(e){return"minMax"===e.measureAxes[1].minMax&&e.measureAxes[1].min>=e.measureAxes[1].max}}}}}}}},u={uses:"data",items:{dimensions:{items:{nullSuppression:{show:function(e,t,r){var o=i.isFirstDimension(e,t),s=n.isContinuousChart(r.layout);return!(o&&s)}}}},measures:{items:{series:{type:"items",items:{seriesType:{ref:"qDef.series.type",type:"string",component:"item-selection-list",defaultValue:"bar",horizontal:!0,items:[{icon:function(e){return"stacked"===e.barGrouping.grouping||n.isContinuousChart(e)?"":""},component:"icon-item",labelPlacement:"bottom",translation:"properties.style.bar",value:"bar"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.line",value:"line"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.style.marker",value:"marker"}],change:function(){}},seriesAxis:{ref:"qDef.series.axis",type:"integer",component:"dropdown",defaultValue:0,options:[{translation:"properties.axis.primary",value:0},{translation:"properties.axis.secondary",value:1}],show:function(e){return e.qDef&&e.qDef.series&&e.qDef.series.type&&"bar"!==e.qDef.series.type}},seriesMarker:{ref:"qDef.series.marker",type:"string",component:"dropdown",defaultValue:"circle",options:[{translation:"properties.marker.circle",value:"circle"},{translation:"properties.marker.rect",value:"rect"},{translation:"properties.marker.diamond",value:"diamond"},{translation:"properties.marker.triangle",value:"triangle"},{translation:"properties.marker.line",value:"line"}],show:function(e){return e.qDef&&e.qDef.series&&"marker"===e.qDef.series.type}},seriesMarkerFill:{ref:"qDef.series.markerFill",translation:"properties.series.fill",type:"boolean",defaultValue:!0,show:function(e){return e.qDef&&e.qDef.series&&"marker"===e.qDef.series.type&&!["line"].contains(e.qDef.series.marker)}}}}}}}},d={type:"items",translation:"properties.sorting",items:{noContinuousSortingMessage:{component:"text",translation:"properties.sorting.noContinuousSortingMessage",show:function(e,t,i){return n.isContinuousChart(i.layout)}},defaultSorting:{uses:"sorting",show:function(e,t,i){return!n.isContinuousChart(i.layout)}}}},h={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{calcCond:{uses:"calcCond"}}}}},{type:"items",component:"accordion",items:{data:u,sorting:d,addons:h,settings:c}}}),define("extensions.qliktech/combochart/combochart-explore-properties",["objects.utils/continuous-utils"],function(e){function t(e){return e.qHyperCubeDef.qMeasures.filter(function(e){return e.qDef.series&&"line"===e.qDef.series.type}).length>0}function n(e){return e.qHyperCubeDef.qMeasures.filter(function(e){return!e.qDef.series||"bar"===e.qDef.series.type}).length>1}return{type:"items",component:"accordion",items:{data:{uses:"data"},sort:{uses:"sort",show:function(t,n){return!e.isContinuousChart(n)}},presentation:{uses:"presentation",type:"items",translation:"properties.presentation",grouped:!0,show:function(i,r){return t(i)||n(i)&&!e.isContinuousChart(r)},items:{grouping:{ref:"barGrouping.grouping",type:"string",component:"item-selection-list",horizontal:!0,items:[{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.grouped",value:"grouped"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"properties.grouping.stacked",value:"stacked"}],show:function(e,t){return n(e)}},nullMode:{type:"string",component:"radio-list",ref:"nullMode",translation:"properties.nullMode",options:function(){return[{value:"gap",translation:"properties.nullMode.gap"},{value:"connect",translation:"properties.nullMode.connect"},{value:"zero",translation:"properties.nullMode.zero"}]},show:function(e){return t(e)&&e.qHyperCubeDef.qMeasures.length>1}},dataPoints:{ref:"dataPoint.show",translation:"properties.dataPoints.showDataPoints",type:"boolean",show:function(e){return t(e)}}}},color:{uses:"color"}}}}),define("extensions.qliktech/combochart/combochart-data",["client.utils/property-resolver"],function(e){function t(t,n){var i=n.getMeasures(),r=e.getValue(t,"color.mode");"byDimension"===r&&1===i.length&&"line"===e.getValue(i[0].qDef,"series.type")?e.setValue(t,"color.mode","primary"):"byDimension"===r&&i.length>1&&e.setValue(t,"color.mode","byMultiple")}return{dimensions:{min:1,max:1,description:function(e){for(var t,n=e.qHyperCube.qMeasureInfo,i=[0,0,0],r=["Markers","Lines","Lines and markers","Bars","Bars and markers","Bars and lines","Bars, lines and markers"],o=0;o<n.length;++o)"bar"===(t=n[o].series.type)?i[0]=1:"line"===t?i[1]=1:i[2]=1;return r[parseInt(i.join(""),2)-1]},add:function(e,n,i){t(n,i)},move:function(e,n,i){t(n,i)}},measures:{min:1,max:15,description:function(e,t,n,i){var r=i.qDef.series.type;return"line"===r?"Height of lines":"bar"===r?"Height of bars":"Height of markers"},add:function(e,n,i){t(n,i)},move:function(e,n,i){t(n,i)},replace:function(e,t){t.qDef.series&&(e.qDef.series.type=t.qDef.series.type||"bar")}}}}),define("text!extensions.qliktech/combochart/combochart.ng.html",[],function(){return'<div class="qv-viz"></div>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist" dir="ltr"></span>\n<div qva-chart-disclaimer attributes="dataAttributes" visible="!dataAttributes.noDataExist" direction="options.direction"></div>'}),define("extensions.qliktech/combochart/combochart",["jquery","util","qvangular","core.utils/deferred","core.utils/feature-flags","objects.views/charts/scrollable-chart","objects.views/charts/components/chart-component","objects.views/charts/components/axis/continuous-axis","objects.views/charts/components/data-title/data-title","extensions.qliktech/combochart/comboarea","extensions.qliktech/combochart/combochart-properties","extensions.qliktech/combochart/combochart-explore-properties","extensions.qliktech/combochart/combochart-data","objects.views/charts/disclaimers/chart-utils","objects.views/charts/components/axis/axis-utils","objects.backend-api/hypercube-api","objects.extension/default-extension","objects.extension/object-conversion","text!./combochart.ng.html","objects.utils/continuous-utils","client.utils/color-support"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,x){"use strict";function q(e){var t=[],n=[];return e.qHyperCube.qMeasureInfo.forEach(function(e){e.series&&"bar"!==e.series.type&&1===e.series.axis?n.push(e):t.push(e)}),{primaryMeasures:t,secondaryMeasures:n}}function C(e,n,i,r,o,s){if(n.length){var a,l,c;o?(a=o.min,l=o.max):(a=Math.min.apply(this,n.filter(function(e){return!isNaN(e.qMin)}).map(function(e){return e.qMin})),l=Math.max.apply(this,n.filter(function(e){return!isNaN(e.qMax)}).map(function(e){return e.qMax}))),t.isNumeric(a)||(a=-1),t.isNumeric(l)||(l=1),c=this.getAxisOptions(i),r&&(l=Math.max(0,l),a=Math.min(0,a)),s&&(s.min=a,s.max=l,s.minMeasure&&s.maxMeasure?(this._cutMode=this.getSpikeSettings(s,c),a=this._cutMode.min,l=this._cutMode.max):this._cutMode={positive:!1,negative:!1}),e.setRealDataRange(void 0,void 0),this.setAxisDataRange(e,l,a,c.max,c.min,1)}}function S(e,t){var i,r=this.item,o=["contextMenu.add",r.name];t.canAddMeasure()&&((i=this.menu.addItem({translation:o,tid:"add-as"})).addItem({translation:"contextMenu.asBar",tid:"as-bar",icon:"bar-chart",select:function(){t.addLibraryMeasure(r.id).then(function(i){i.qDef.series.type="bar",t.updateGlobalChangeListeners(),e.setProperties(t.properties),n.$rootScope.$broadcast("pp-open-path","data."+i.qDef.cId)})}}),i.addItem({translation:"contextMenu.asLine",tid:"as-line",icon:"line-chart",select:function(){t.addLibraryMeasure(r.id).then(function(i){i.qDef.series.type="line",i.qDef.series.axis=1,t.updateGlobalChangeListeners(),e.setProperties(t.properties),n.$rootScope.$broadcast("pp-open-path","data."+i.qDef.cId)})}}),i.addItem({translation:"contextMenu.asMarker",tid:"as-marker",icon:"shapes",select:function(){t.addLibraryMeasure(r.id).then(function(n){n.qDef.series.type="marker",n.qDef.series.axis=1,t.updateGlobalChangeListeners(),e.setProperties(t.properties)})}})),t.canColorBy().byMeasure&&this.menu.addItem({translation:["contextMenu.colorBy",r.name],tid:"colorby",select:function(){x.setColorByPropertyDef(t.properties,r),t.updateGlobalChangeListeners(),e.setProperties(t.properties)}})}var w,_={NONE:0,ONE_DIM:1,TWO_DIM:2};return w=o.extend("ComboChart",{namespace:".combochart",init:function(t,n,i,r,o){if(i=e.extend(!0,{components:{dataArea:{clazz:c},miniChart:{components:{dataArea:{clazz:c},secondaryMeasureAxis:{show:!1,dock:"right",clazz:a}}},axis:{show:!0,order:1.1,reductionOrder:2.1,dock:"right",relevantSize:90,showFlag:s.prototype.ShowFlags.XSMALL,clazz:a},secondaryMeasureAxisTitle:{show:!0,order:1.2,dock:"right",relevantSize:30,reductionOrder:1,showFlag:s.prototype.ShowFlags.SMALL,clazz:l}}},i||{}),this._super(t,n,i,r,o),this.components.scrollArea.setUseMiniChart(!1),this.components.axis.setShowStrategy("all"),this.components.dataArea.setSecondaryMinorAxis(this.components.axis),this.components.secondaryMeasureAxisTitle.setType("measure"),this.components.secondaryMeasureAxisTitle.setModel(t.ext.model),this.components.miniChart){var u=this.components.miniChart;this.components.miniChart.setBackendApi(this.backendApi),this.components.scrollArea.setMiniChart(u),u.setColorMap(this.providers.colorMap),u.components.measureAxis.setDock("left"),u.components.dimensionAxis.setDock("bottom"),u.components.dataArea.setMinorAxis(u.components.measureAxis),u.components.dataArea.setMajorAxis(u.components.dimensionAxis),u.components.dataArea.setSecondaryMinorAxis(u.components.secondaryMeasureAxis)}},getVerticalComponents:function(){var e,t=this._super();return this._data&&this.components&&(this.components.measureAxis&&this.components.measureAxis.isVertical()&&this._data.measureAxes&&(e=this._data.measureAxes[0].dock,t.push({comp:this.components.measureAxis,dock:e}),this.components.measureAxisTitle&&t.push({comp:this.components.measureAxisTitle,dock:e})),this.components.axis&&this.components.axis.isVertical()&&this._data.measureAxes&&this._data.measureAxes.length>1&&(e=this._data.measureAxes[1].dock,t.push({comp:this.components.axis,dock:e}),this.components.secondaryMeasureAxisTitle&&t.push({comp:this.components.secondaryMeasureAxisTitle,dock:e}))),t},partialUpdate:function(e){var t,n,r,o=[],s=this._dataOptions.primary.indexOf(this._dataOptions.barSeries[0])>=0;return this._enablePagingTransitions(),n=e.qHyperCube.qStackedDataPages.length>0?this._pagingInfo.y:e.qHyperCube.qDataPages[0].qArea.qTop,this.components.dimensionAxis.setInnerOffset(n*this.scrollMultiplicator),this.providers.colorMap.setData(e).then(function(){this._chartContext.refresh(e),this.components.colorLegend.updateNow(["properties"]),o.push(this.components.colorLegend.invalidateDisplay("ScrollableChart.partialUpdate"));for(t in this.components)"miniChart"!==t&&this.components[t].invalidateProperties("ScrollableChart.partialUpdate");this.components.dataArea.updateNow(["properties"]),r=this.components.dataArea.barArea.getMeasureIndices().length?this.components.dataArea.barArea.getMajorAxisData():this.components.dataArea.markerArea.getMeasureIndices().length?this.components.dataArea.markerArea.getMajorAxisData():this.components.dataArea.lineArea.getMajorAxisData(),this.components.dimensionAxis.setDataRange(r.data,r.info);var n=this.components.dataArea.barArea.getMinorAxisData();return n&&this._dataOptions.primary.forEach(function(e){this._dataOptions.barSeries.indexOf(e)<0&&!isNaN(e.qMin)&&(n.min=Math.min(e.qMin,n.min),n.max=Math.max(e.qMax,n.max))},this),C.apply(this,[this.components.measureAxis,this._dataOptions.primary,this._dataOptions.axes.measureAxis,s,n,n?this.getPrimaryMeasureSettings(e,this._dataOptions):null]),this.components.dimensionAxis.updateNow(["properties"]),this.components.dimensionAxis.updateLevels(),o.push(this.components.dimensionAxis.invalidateDisplay("ScrollableChart.partialUpdate")),o.push(this.components.dataArea.invalidateDisplay("ScrollableChart.partialUpdate")),i.all(o)}.bind(this))},isValid:function(e){return this._super(e)&&!this.supressChartRendering},_paint:function(){if(!this.isValid(this._data))return this.clear();this._super();var e,t=this.components.scrollArea,n=this.rect.height,r=this.getSnapshotStoredChartData(),o=0,s=[];(this._cutMode.positive||this._cutMode.negative)&&(this._layoutMode>=31&&(o=48),o=this._layoutMode>=15?32:this._layoutMode>=7?16:8),this.components.measureAxis.setPadding(this._cutMode.positive?o:0,0,this._cutMode.negative?o:0,0),this.components.axis.setPadding(this._cutMode.positive?o:0,0,this._cutMode.negative?o:0,0),this.components.dimensionAxis.setMaxDiscreteUnitSize(Math.max(1,Math.ceil(n/4))),this.components.dataArea.updateNow(["properties"]),this.components.dimensionAxis.updateNow(["properties"]),this.layout(),this._readStoredData?(this.components.dimensionAxis.setInnerOffset(r.axisInnerOffset),this.components.scrollArea.setOffset(r.scrollOffset),this.components.scrollArea.setViewRange(r.viewRange)):this.options.viewState&&(this.components.dimensionAxis.setInnerOffset(this.options.viewState.axisInnerOffset),this.components.scrollArea.setOffset(this.options.viewState.scrollOffset),this.components.scrollArea.setViewRange(this.options.viewState.viewRange));var a=this.checkPage();if(a)s.push(a);else{for(e in this.components)s.push(this.components[e].invalidateDisplay("ComboChart.paint"));t.viewState.min+t.viewState.range>t.fullState.max&&t.setOffset(t.fullState.max-t.viewState.range)}return i.all(s)},prePaint:function(e){this._super(e),p.applyDisclaimerAttributes({paging:!0},this.$scope.dataAttributes,this.$element,this.$scope,e),this.supressChartRendering=this.$scope.dataAttributes.noDataExist},updateData:function(e){return this.setIsDimensionContinuous(b.isContinuousChart(e)),this._setActiveDimensionAxis(e),this._super(e)},_updateData:function(t){var n=[];this._checkPage=!1;var r,o,a,l,c,u,h,d,p,f,m=this.getSnapshotStoredChartData();if(this.components.scrollArea.setUseMiniChart(this.isDimensionContinuous),r=t.qHyperCube.qMeasureInfo.filter(function(e){return e.series&&"line"===e.series.type}),o=t.qHyperCube.qMeasureInfo.filter(function(e){return!e.series||"bar"===e.series.type}),a=t.qHyperCube.qMeasureInfo.filter(function(e){return e.series&&"marker"===e.series.type}),l=q(t),c=l.primaryMeasures,u=l.secondaryMeasures,this.isStacked=!1,this.components.measureAxis.isStacked=("stacked"===t.barGrouping.grouping||this.isDimensionContinuous)&&o.length>1,this.components.axis.isStacked=!1,this._pagingMode=_.NONE,this.scrollMultiplicator="grouped"===t.barGrouping.grouping&&o.length>1?o.length+1:1,this.components.dataArea.setIsDimensionContinuous(this.isDimensionContinuous),this.isDimensionContinuous)this._pagingMode=_.NONE;else{if(t.qHyperCube.qSize.qcy>t.qHyperCube.qDataPages[0].qArea.qHeight){this._pagingMode=_.ONE_DIM;var g=t.qHyperCube.qSize.qcy;"grouped"===t.barGrouping.grouping&&o.length>1&&(this.scrollMultiplicator=o.length+1,g*=this.scrollMultiplicator),this.components.dimensionAxis.setNumDiscreteUnits(g)}else this.components.dimensionAxis.setNumDiscreteUnits(null);this.components.dimensionAxis.isDiscrete()||(this._pagingMode=_.NONE)}var v=e.extend(!0,{},t.measureAxes[0],{show:c.length?t.measureAxes[0].show:"none"}),y=e.extend(!0,{},t.measureAxes[1],{show:u.length?t.measureAxes[1].show:"none",dock_:["near","far"].contains(t.measureAxes[0].dock)?"near"===t.measureAxes[0].dock?"far":"near":s.prototype.getOppositeDock.call({options:{dock:t.measureAxes[0].dock}})});h={primary:c,secondary:u,lineSeries:r,markerSeries:a,barSeries:o,axes:{measureAxis:{component:this.components.measureAxis,data:v,dataIndices:c.map(function(e){return t.qHyperCube.qMeasureInfo.indexOf(e)})},secondaryMeasureAxis:{component:this.components.axis,data:y,dataIndices:u.map(function(e){return t.qHyperCube.qMeasureInfo.indexOf(e)})},dimensionAxis:{component:this.components.dimensionAxis,data:t.dimensionAxis,dataIndices:t.qHyperCube.qDimensionInfo.map(function(e,t){return t})},timeAxis:{component:this.components.timeAxis,data:t.dimensionAxis},continuousAxis:{component:this.components.continuousAxis,data:t.dimensionAxis}},axisTitles:{dimensionAxisTitle:{component:this.components.dimensionAxisTitle,data:t.dimensionAxis},measureAxisTitle:{component:this.components.measureAxisTitle,data:v},secondaryMeasureAxisTitle:{component:this.components.secondaryMeasureAxisTitle,data:y}}},d=this.components.dimensionAxisTitle,p=this.components.measureAxisTitle,f=this.components.secondaryMeasureAxisTitle,this._dataOptions=h;var b=[],x=[];return c.forEach(function(e){b.push({label:e.qFallbackTitle,index:t.qHyperCube.qMeasureInfo.indexOf(e)})}),u.forEach(function(e){x.push({label:e.qFallbackTitle,index:t.qHyperCube.qMeasureInfo.indexOf(e)})}),this._data=t,n.push(d.setData(t)),n.push(p.setData(b)),n.push(f.setData(x)),n.push(this.components.dataArea.setData(t)),n.push(this.components.colorLegend.setData(t)),this.providers.colorMap.getLegendDataProvider().setMeasureLegendTypes(t.qHyperCube.qMeasureInfo.map(function(e){return e.series&&e.series.type?"line"===e.series.type?t.dataPoint.show?["line","circle"]:["line"]:"marker"===e.series.type?[(!1===e.series.markerFill?"!":"")+(e.series.marker||"circle")]:["rect"]:["rect"]})),this._super(t,h),this._readStoredData?(this.components.dimensionAxis.setInnerOffset(m.axisInnerOffset),this.components.scrollArea.setOffset(m.scrollOffset),this.components.scrollArea.setViewRange(m.viewRange)):this.options.viewState?(this.components.dimensionAxis.setInnerOffset(this.options.viewState.axisInnerOffset),this.components.scrollArea.setOffset(this.options.viewState.scrollOffset),this.components.scrollArea.setViewRange(this.options.viewState.viewRange)):isNaN(t.scrollStartPos)?this.isDimensionContinuous||(this.components.dimensionAxis.setInnerOffset(0),this.components.scrollArea.setOffset(0)):this.components.scrollArea.setRelativeOffset(t.scrollStartPos),this.isDimensionContinuous||(this._checkPage=!0),i.all(n)},initSelections:function(){if(this._super(),!this.options._disableSelections){this.selections.types.range.addComponent("y",this.components.axis),this.selections.Select.bind(function(e,t){var n,i=this.selections.getActiveType().activeComponent;n=i.subComponents?this.components.dimensionAxis.getType().current:i.getSelectionIndices(),this.onSelection.Select.apply(this,[e,t,n])}.bind(this));var e=function(e){this.onSelection.scheduleInvalidation.call(this),this.components.timeAxis.setSelectedRanges(e),this.components.dataArea.updateRangeSelection(e),this.components.miniChart.components.dataArea.updateRangeSelection(e)};this.selections.UpdateRanges.bind(e.bind(this)),this.selections.Clear.bind(e.bind(this,[])),this.selections.Deactivated.bind(e.bind(this,[]))}},updateDataArea:function(e,t){this._super.apply(this,[].slice.call(arguments)),"byExpression"===e.color.mode?this.components.dataArea.lineArea.interpolateVaryingColors=!e.color.expressionIsColor&&-1!==["sg","dg"].indexOf(e.color.measureScheme):this.components.dataArea.lineArea.interpolateVaryingColors=!1;var n="area"===e.lineType&&e.stackedArea?"stackedArea":e.lineType;this.components.dataArea.lineArea.setShowDataPoints(e.dataPoint.show),this.components.dataArea.lineArea.setLineType(n),this.components.dataArea.lineArea.setNullMode(e.nullMode),r.COMBO_VALUE_LABELS&&(this.components.dataArea.lineArea.setShowDataPointLabels(e.dataPoint.showLineLabels),this.components.dataArea.barArea.setShowDataPoints(e.dataPoint.showBarLabels));var i=this.isDimensionContinuous?"stacked":e.barGrouping.grouping;if(this.components.dataArea.barArea.setGroupingMode(i),this.components.miniChart){this.components.miniChart.components.dataArea.lineArea.setLineType(n),this.components.miniChart.components.dataArea.lineArea.setNullMode(e.nullMode),this.components.miniChart.components.dataArea.barArea.setGroupingMode(i);var o,s;for(o in t.axes){var a=t.axes[o];(s=this.components.miniChart.components[o])&&(s.setDataIndices(a.dataIndices||[a.dataIndex||0]),s.setCurrentDataIndices(a.currentDataIndices||a.dataIndices||[a.dataIndex||0]))}}this.components.dataArea.updateNow(["properties"])},getMinDiscreteUnitSize:function(){return this._minDiscreteUnitSize},updateAxis:function(t,n){var i,r,o,a=n.primary.indexOf(n.barSeries[0])>=0,l=this.getSnapshotStoredChartData(),c=q(t),u=e.extend(!0,{},t.measureAxes[0],{show:c.primaryMeasures.length?t.measureAxes[0].show:"none"}),h=e.extend(!0,{},t.measureAxes[1],{show:c.secondaryMeasures.length?t.measureAxes[1].show:"none",dock_:["near","far"].contains(t.measureAxes[0].dock)?"near"===t.measureAxes[0].dock?"far":"near":s.prototype.getOppositeDock.call({options:{dock:t.measureAxes[0].dock}})});this._super(t,n),this.components.timeAxis.setData(t),this._cutMode={positive:!1,negative:!1};var d=this.components.dataArea.barArea.getMinorAxisData();d&&n.primary.forEach(function(e){n.barSeries.indexOf(e)<0&&!isNaN(e.qMin)&&(d.min=Math.min(e.qMin,d.min),d.max=Math.max(e.qMax,d.max))}),this._readStoredData&&l.dataRanges&&(d.min=l.dataRanges[0].min,d.max=l.dataRanges[0].max),C.apply(this,[this.components.measureAxis,n.primary,n.axes.measureAxis,a,d,a?this.getPrimaryMeasureSettings(t,n):null]),C.apply(this,[this.components.axis,n.secondary,n.axes.secondaryMeasureAxis,"zero"===t.nullMode,null]),r=this.chartFormatter.getFormattersForMeasures(t.qHyperCube.qMeasureInfo,n.primary.map(function(e){return t.qHyperCube.qMeasureInfo.indexOf(e)})),o=this.chartFormatter.getFormattersForMeasures(t.qHyperCube.qMeasureInfo,n.secondary.map(function(e){return t.qHyperCube.qMeasureInfo.indexOf(e)})),this.components.measureAxis.combinedMeasuresFormatter=this.chartFormatter.getFormatterFromFormatters(r),this.components.axis.combinedMeasuresFormatter=this.chartFormatter.getFormatterFromFormatters(o),n.barSeries.length?i=this.components.dataArea.barArea.getMajorAxisData():n.markerSeries.length?(i=this.components.dataArea.markerArea.getMajorAxisData(),n.lineSeries.length||i.data.forEach(function(e){for(var t=[],i=0;i<n.markerSeries.length;i++)t.push(e.cacheIndex[0]*n.markerSeries.length+i);e.cacheIndex=t})):i=n.lineSeries.length?this.components.dataArea.lineArea.getMajorAxisData():{data:[],info:[],groupSize:null},this.components.dimensionAxis.setDataRange(i.data,i.info),this._updateMinDiscreteUnitSize(this.components.dimensionAxis);var p=this.components.dimensionAxisTitle,m=this.components.measureAxisTitle,g=this.components.secondaryMeasureAxisTitle;if(p.setDock("far"===t.dimensionAxis.dock?"top":"bottom"),m.setDock("far"===u.dock?"right":"left"),g.setDock("far"===h.dock?"right":"left"),p.setSelectionsEnabled(!!this.selections),m.setSelectionsEnabled(!!this.selections),g.setSelectionsEnabled(!!this.selections),n.primary.length&&n.secondary.length||t.measureAxes.every(function(e){return"none"===e.show}))this.components.dimensionAxis.setUnitAlignment("center");else{var v=n.primary.length?t.measureAxes[0]:t.measureAxes[1];this.components.dimensionAxis.setUnitAlignment(f.getAxisUnitAlignment(v.dock,this.components.dimensionAxis.isHorizontal()))}this.updateTimeAxis()},updateGrid:function(e,t){this._super(e,t),!t.primary.length&&t.secondary.length||["all","labels"].indexOf(t.axes.measureAxis.data.show)<0&&t.secondary.length&&["all","labels"].indexOf(t.axes.secondaryMeasureAxis.data.show)>=0?this.components.grid.setAxes(this._activeDimAxis,this.components.axis):this.components.grid.setAxes(this._activeDimAxis,this.components.measureAxis)},_updateMinDiscreteUnitSize:function(e){this._super(e)},getPrimaryMeasureSettings:function(e,n){var i,r,o,s,a=n.primary.filter(function(e){return!isNaN(e.qMin)}).map(function(t){return{min:t.qMin,max:t.qMax,index:e.qHyperCube.qMeasureInfo.indexOf(t),isBarSeries:n.barSeries.indexOf(t)>=0}}),l=n.primary.filter(function(e){return!isNaN(e.qMin)&&n.barSeries.indexOf(e)<0});return a.length&&(i=a.reduce(function(e,t){return e.min<t.min?e:t},a[0]),(r=a.reduce(function(e,t){return e.max>t.max?e:t},a[0]))&&(s=i.max),i&&(o=i.min),t.isNumeric(o)||(o=0),t.isNumeric(s)||(s=1)),{minMeasure:i,maxMeasure:r,nonBarSeriesMax:Math.max.apply(null,l.map(function(e){return e.qMax})),nonBarSeriesMin:Math.min.apply(null,l.map(function(e){return e.qMin})),min:o,max:s,data:e,options:n}},getSpikeSettings:function(e,t){var n,i,r=e.data,o=e.minMeasure,s=e.maxMeasure,a=e.min,l=e.max,c=0,u=0,h=0,d=0,p=!1,f=!1,m=s.index+r.qHyperCube.qDimensionInfo.length,g=o.index+r.qHyperCube.qDimensionInfo.length,v=r.qHyperCube.qDataPages[0]?r.qHyperCube.qDataPages[0].qMatrix:[];if(!isNaN(e.nonBarSeriesMax)&&e.nonBarSeriesMax>0&&(c=e.nonBarSeriesMax),!isNaN(e.nonBarSeriesMin)&&e.nonBarSeriesMin<0&&(u=e.nonBarSeriesMin),!this.components.measureAxis.isStacked){for(var y=0;y<v.length;y++)(i=(n=v[y])[m].qNum)>0&&!isNaN(i)&&(n[0].qIsOtherCell||n[1].qIsOtherCell?h=Math.max(i,h):c=Math.max(i,c)),(i=n[g].qNum)<0&&!isNaN(i)&&(n[0].qIsOtherCell||n[1].qIsOtherCell?d=Math.min(i,d):u=Math.min(i,u));null!==t.max&&t.max<s.max?p=t.max>0:c>0&&h/c>5&&(p=(l=c)>=0),null!==t.min&&t.min>o.min?f=t.min<0:u<0&&d/u>5&&(f=(a=u)<0)}return{max:l,min:a,positive:p,negative:f}},getPreferredSize:function(){return this._super()}}),{type:"ComboChart",BackendApi:m,template:y,View:w,definition:u,softDefinition:h,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:17,qHeight:500}],qSuppressMissing:!0},measureAxes:[{autoMinMax:!0,dock:"near",max:10,min:0,minMax:"min",show:"all",spacing:1},{autoMinMax:!0,dock:"far",max:10,min:0,minMax:"min",show:"all",spacing:1}]},data:d,support:{cssScaling:!1,snapshot:!0,export:!0,exportData:!0,sharing:!0,viewData:!0},options:{selections:{dataArea:{},range:{},colorLegend:{}},tooltips:{}},getDropMeasureOptions:function(e,t,n,i,r){"measure"===e.item.type?(S.call(e,n,t,r),t.getMeasures().length>=t.minMeasures()&&e.ReplaceMeasures(n,t,r),i()):g.getDropMeasureOptions(e,t,n,i,r)},importProperties:function(e,n,i){var r,o=v.axisChart.importProperties.apply(v,[e,n,i]),s="linechart"===e.properties.visualization,a=[];return o.qProperty.qHyperCubeDef.qMeasures.forEach(function(e){e.qDef.series||(e.qDef.series={type:s?"line":"bar",axis:0,marker:"circle",markerFill:!0}),a.indexOf(e.qDef.series.axis)<0&&a.push(e.qDef.series.axis)}),r=a.sort().shift(),o.qProperty.measureAxes[r]&&e.properties.measureAxis&&void 0!==e.properties.measureAxis.autoMinMax&&t.extend(!0,o.qProperty.measureAxes[r],e.properties.measureAxis,{logarithmic:!1}),o},exportProperties:v.axisChart.exportProperties.bind(v)}}),define("objects.picasso/chart-view",["underscore","objects.extension/base-view","core.utils/deferred","objects.extension/default-selection-toolbar","util","assets/external/picasso/picasso","objects.picasso/picasso-setup","objects.picasso/chart-builder/chart-builder","objects.picasso/disclaimer/disclaimer","objects.utils/interaction-states","objects.utils/layout","objects.views/charts/representation/combo-color-map"],function(e,t,n,i,r,o,s,a,l,c,u,h){"use strict";function d(e,t,n){var i,r={qTop:0,qLeft:0,qWidth:t.qSize.qcx,qHeight:1e4/t.qSize.qcx};if(n){var o=n.width||t.qSize.qcx,s=Math.floor(1e4/o);r={qTop:n.top||0,qLeft:n.left||0,qWidth:o,qHeight:n.height?Math.min(n.height,s):s}}else r={qTop:0,qLeft:0,qWidth:t.qSize.qcx,qHeight:1e4/t.qSize.qcx};switch(t.qMode){case"K":i="qStackedDataPages";break;case"S":default:i="qDataPages"}return e.getData([r],null,t).then(function(e){t[i]=e})}return s(),t.extend({defaultOptions:{navigation:!1,selections:!1,tooltips:!1},init:function(t,n,i,s,c){this._super(t,n,r.extend({},this.defaultOptions,i),s),this._selectionsApi=c,this._on=!1,this._disclaimer=new l(i),this._updateDisclaimerDebounce=e.debounce(this.updateDisclaimer.bind(this),250),this._colorMap=new h({autoMode:"primary"},s.model.app),this._dataPaths=["qHyperCube"];var u=this;this.picassoElement=n.find(".picasso-chart")[0],this.chartInstance=o.chart({element:this.picassoElement,settings:{components:[a.createComponent("event-area",{mounted:function(e){u.dataAreaElem=e}})]}})},setDataPaths:function(e){this._dataPaths=e},setInteractionState:function(e){this._super(e);var t=e===c.ANALYSIS;t&&!this._on?this.on():!t&&this._on&&this.off()},hasOption:function(e){return!!this.options[e]},on:function(){this._on||(this._on=!0)},isOn:function(){return this._on},off:function(){this._on&&(this._on=!1)},getLayoutMode:function(e){return!this.options.freeResize&&e.snapshotData?u.getLayoutMode(e.snapshotData.content.size.w,e.snapshotData.content.size.h):this._layoutMode||this.options.layoutMode},getColor:function(e,t,n,i){return this._colorMap.getColor(e,t,n,i)},getColoringMap:function(){return this._colorMap},getColorMap:function(){return this._colorMap.getColorScale()},setColorMapData:function(e,t){return this._colorMap.setData(e,t)},getLegend:function(){return this._colorMap.getLegendDataProvider()},setFreeResize:function(e){this._super(e)},getData:function(e,t,n){return d(e,t,n)},hasValidData:function(){return!0},paint:function(e){if(this.hasValidData()){this.updateDisclaimer(this.layout);var t=this.createChartSettings(this.layout);a.validateComponentKeys(t.components).map(function(e){console.error(e)}),this.updateChart(this.layout,t),this._painted=!0}return this._super(e,this.layout)},resize:function(e){if(this.layout)return this._layoutMode=u.getLayoutMode(this.picassoElement.clientWidth,this.picassoElement.clientHeight),this.paint(e,this.layout)},createChartSettings:function(){throw new Error('Subclass must implement "createChartSettings" function')},addSnapshotChartSettings:function(e,t){!this.options.freeResize&&t.snapshotData&&(e.dockLayout.logicalSize={width:t.snapshotData.content.size.w,height:t.snapshotData.content.size.h},this.options.maximizeSnapshot&&(e.dockLayout.logicalSize.preserveAspectRatio=!0))},updateData:function(e){return this.layout=r.extend(!0,{},e),this.layout.permissions=e.permissions,n.resolve()},getLocaleInfo:function(){return this.backendApi.localeInfo},updateChart:function(e,t,n){var i=this;this._updateDisclaimerDebounce(this.layout);var o=this._dataPaths.map(function(t){return{type:"q",key:t,config:{localeInfo:i.backendApi?i.backendApi.localeInfo:{}},data:r.getValue(e,t.replace(/\//g,"."))}});this.chartInstance.update({data:o,settings:t,partialData:n})},updateDisclaimer:function(e){e&&(this._disclaimer.set(this.getDisclaimerAttributes(e)),this._disclaimer.display(this.picassoElement))},destroy:function(){this._super(),this.off(),this.chartInstance.destroy(),this._colorMap.release()},getSelectionToolbar:function(){var e=[];if(this.hasOption("selections")&&this._selectionHandler){var t=this;e.push({name:"Tooltip.ToggleOnLassoSelection",tid:"selection-toolbar.toggleLasso",isIcon:!0,buttonClass:"sel-toolbar-icon-toggle",iconClass:"lui-icon lui-icon--lasso",action:function(){t._selectionHandler.toggleLasso()},isActive:function(){return this.name=t._selectionHandler.lassoState()?"Tooltip.ToggleOffLassoSelection":"Tooltip.ToggleOnLassoSelection",t._selectionHandler.lassoState()},isDisabled:function(){return!(!t.isLassoDisabled||!t.isLassoDisabled())}})}return new i(this.backendApi,this._selectionsApi,!1,!1,e,[])},isLassoDisabled:function(){return!0},setSnapshotData:function(e){e.snapshotData.content={size:{w:this.$element.width(),h:this.$element.height()}}},getDisclaimerAttributes:function(e){return{data:e}},initialize:function(){},refreshSelections:function(){},suppressOnPaint:function(e){return this.$scope.object._forcePaint?(this.$scope.object._forcePaint=!1,!1):e.qSelectionInfo&&e.qSelectionInfo.qInSelections}})}),define("client.property-panel/definition-builder/sort-order/convert-functions",[],function(){function e(e){return e=e||function(){return!1},{get:function(t){var n=e()?-1:1;switch(t("integer")*n){case-1:return"descending";case 1:return"ascending";default:return"disabled"}},set:function(t,n){var i=e();switch(t){case"descending":n("integer",i?1:-1);break;case"ascending":n("integer",i?-1:1);break;case"disabled":n("integer",0);break;default:n("integer",void 0)}}}}return{booleanConvertFunctions:function(e,t){return e=e||function(){return!1},t=t||1,{get:function(e){return!!e("integer")},set:function(n,i){if(n){var r=e()?-1:1;i("integer",r*=t)}else i("integer",0)}}},enumConvertFunctions:e,invertedEnumConvertFunctions:function(t){return e(function(){return!t||!t()})}}}),define("client.property-panel/definition-builder/sort-order/sort-order",["client.property-panel/definition-builder/sort-order/convert-functions","util"],function(e,t){var n=[{value:"ascending",translation:"properties.sorting.ascending"},{value:"descending",translation:"properties.sorting.descending"}];return{ascii:function(i,r){return i=i||"qSortByAscii",{type:"items",items:{asciiToggled:{type:"boolean",ref:i,translation:"properties.sorting.sortByAlphabetic",convertFunctions:e.booleanConvertFunctions(r)},asciiOrder:{type:"string",component:"dropdown",ref:i,options:n,convertFunctions:e.enumConvertFunctions(r),show:function(e){return 0!==t.getValue(e,i,0)}}}}},numeric:function(i,r){return i=i||"qSortByNumeric",{type:"items",items:{numericToggled:{type:"boolean",ref:i,translation:"properties.sorting.sortByNumeric",convertFunctions:e.booleanConvertFunctions(r,-1)},numericOrder:{type:"string",component:"dropdown",ref:i,options:n,convertFunctions:e.enumConvertFunctions(r),show:function(e){return 0!==t.getValue(e,i,0)}}}}},expression:function(i,r){return i=i||"qSortByExpression",{type:"items",items:{expressionToggled:{type:"boolean",ref:i,translation:"properties.sorting.sortByExpression",convertFunctions:e.booleanConvertFunctions(r)},expression:{type:"number",component:"expression",expressionType:"ValueExpr",ref:"qExpression",translation:"Common.Expression",defaultValue:"",show:function(e){return 0!==t.getValue(e,i,0)}},expressionOrder:{type:"string",component:"dropdown",ref:i,options:n,convertFunctions:e.enumConvertFunctions(r),show:function(e){return 0!==t.getValue(e,i,0)}}}}},frequency:function(i,r){return i=i||"qSortByFrequency",{type:"items",items:{frequencyToggled:{type:"boolean",ref:i,translation:"properties.sorting.sortByFrequency",convertFunctions:e.booleanConvertFunctions(r)},frequencyOrder:{type:"string",component:"dropdown",ref:i,options:n,convertFunctions:e.invertedEnumConvertFunctions(r),show:function(e){return 0!==t.getValue(e,i,0)}}}}}}}),define("objects.picasso/sorting/base-derived/sorter-base-sorting-settings",[],function(){"use strict";var e={ASCII:{ELEMENT:void 0,SORT_BY_EXPRESSION:void 0,SORT_BY_ASCII:1,SORT_BY_NUMERIC:void 0,SORT_BY_LOAD_ORDER:1}};return Object.freeze(e.ASCII),Object.freeze(e),e}),define("extensions.qliktech/boxplot/sorting/boxplot-sorting-settings",["util","objects.picasso/sorting/base-derived/sorter-base-sorting-settings"],function(e,t){"use strict";return e.extend(!0,{BOX_MIDDLE:{ELEMENT:"boxMiddle",SORT_BY_EXPRESSION:1,SORT_BY_ASCII:void 0,SORT_BY_NUMERIC:void 0,SORT_BY_LOAD_ORDER:1}},t)}),define("extensions.qliktech/boxplot/sorting/boxplot-sorting-settings-retriever",["util","extensions.qliktech/boxplot/sorting/boxplot-sorting-settings"],function(e,t){"use strict";return{getSettings:function(n){return e.getValue(n,"boxplotDef.qHyperCube.qDimensionInfo.1.qCardinal",1)>10?t.BOX_MIDDLE:t.ASCII}}}),define("extensions.qliktech/boxplot/boxplot-utils",["translator"],function(e){function t(e){var t="Fractile",n="";return 0===e?t="Min":1===e?t="Max":n=","+e,t+"( "+l+n+" )"}function n(e){return"(("+t(.75)+" - "+t(.25)+") * "+e+")"}function i(e){return"Rangemin("+e+", "+t(1)+")"}function r(e){return"Rangemax("+e+", "+t(0)+")"}function o(t,n,i){return"firstWhisker"!==t&&"lastWhisker"!==t||(t=s(t,n)),{name:e.get("properties.boxplot.calculationMode."+i+".elements."+t,n),type:"string"}}function s(e,t){var n="",i="firstWhisker"===e;switch(t){case 0:n=i?".min":".max";break;case.01:n=i?".first":".ninetynineth";break;case.05:n=i?".fifth":".ninetyfifth";break;case.1:n=i?".tenth":".ninetieth"}return e+=n}function a(n,i,r){var o,s=e.get("properties.boxplot.calculationMode."+r+".elements."+n,i);switch(r){case f.BOXMODES.FRACTILES.value:o=f.BOXMODES.FRACTILES;break;case f.BOXMODES.STDDEV.value:o=f.BOXMODES.STDDEV;break;case f.BOXMODES.TUKEY.value:o=f.BOXMODES.TUKEY}var a=o.getBoxExpressions(i)._nonWrapped[n];if(!a)return{name:s,type:"string"};var l;if("firstWhisker"===n||"boxStart"===n){var c=e.get("properties.boxplot.calculationMode.fractiles.elements.firstWhisker.min");l="if("+a+" < "+t(0)+", '"+c+"', '"+s+"' )"}else{var u=e.get("properties.boxplot.calculationMode.fractiles.elements.lastWhisker.max");l="if("+a+" > "+t(1)+", '"+u+"', '"+s+"' )"}return{name:l,type:"expression"}}var l="total {{<OuterDim>}} Aggr( {{InnerMeasure}}, {{OuterDim,}} {{InnerDim}} ) ",c="Median( "+l+" )",u=t(.25),h=t(.75),d="Stdev( "+l+" ) ",p="Avg( "+l+" )",f={getFractileFunction:t,BOXELEMENTS:{firstWhisker:{translationKey:"boxplot.firstWhisker"},boxStart:{translationKey:"boxplot.boxStart"},boxMiddle:{translationKey:"boxplot.centerLine"},boxEnd:{translationKey:"boxplot.boxEnd"},lastWhisker:{translationKey:"boxplot.lastWhisker"}},BOXMODES:{TUKEY:{value:"tukey",translation:"properties.boxplot.calculationMode.tukey",calcParameters:[{value:1,label:e.get("properties.boxplot.calculationMode.tukey.short")},{value:1.5,label:e.get("properties.boxplot.calculationMode.tukey.medium")},{value:2,label:e.get("properties.boxplot.calculationMode.tukey.long")}],defaultCalcParam:1.5,getBoxExpressions:function(e){var t=n(e=e||this.defaultCalcParam),o=u+" - "+t,s=h+" + "+t;return{firstWhisker:r(o),boxStart:u,boxMiddle:c,boxEnd:h,lastWhisker:i(s),_nonWrapped:{firstWhisker:o,lastWhisker:s}}}},FRACTILES:{value:"fractiles",translation:"properties.boxplot.calculationMode.fractiles",calcParameters:[{value:0,label:e.get("properties.boxplot.calculationMode.fractiles.minmax")},{value:.01,label:e.get("properties.boxplot.calculationMode.fractiles.first")},{value:.05,label:e.get("properties.boxplot.calculationMode.fractiles.fifth")},{value:.1,label:e.get("properties.boxplot.calculationMode.fractiles.tenth")}],defaultCalcParam:.01,getBoxExpressions:function(e){return isNaN(e)&&(e=this.defaultCalcParam),{firstWhisker:t(e),boxStart:u,boxMiddle:c,boxEnd:h,lastWhisker:t(1-e)}}},STDDEV:{value:"stdDev",translation:"properties.boxplot.calculationMode.stdDev",calcParameters:[{value:2,label:e.get("properties.boxplot.calculationMode.stdDev.short")},{value:3,label:e.get("properties.boxplot.calculationMode.stdDev.medium")},{value:4,label:e.get("properties.boxplot.calculationMode.stdDev.long")}],defaultCalcParam:3,getBoxExpressions:function(e){e=e||this.defaultCalcParam;var t=p+" - "+e+" *("+d+")",n=p+" - "+d,o=p+" + "+d,s=p+" + "+e+" *("+d+")";return{firstWhisker:r(t),boxStart:r(n),boxMiddle:p,boxEnd:i(o),lastWhisker:i(s),_nonWrapped:{firstWhisker:t,boxStart:n,boxEnd:o,lastWhisker:s}}}}}};return f.getDefaultNameTemplate=function(e,t){var n=t.calculations.mode,i=t.calculations.parameters[n];return n===f.BOXMODES.FRACTILES.value?o(e,i,n):a(e,i,n)},f}),define("extensions.qliktech/boxplot/sorting/boxplot-sorting-elements-retriever",["translator","extensions.qliktech/boxplot/boxplot-utils"],function(e,t){"use strict";return{getElementIds:function(e){return e.qUndoExclude.box.qHyperCubeDef.qMeasures.map(function(e){return e.boxElement})},getElements:function(n,i){return n.qUndoExclude.box.qHyperCubeDef.qMeasures.map(function(n){var r=t.BOXELEMENTS[n.boxElement].translationKey;return{id:n.boxElement,label:e.get(r),exp:n.qDef.qDef,isDefault:n.boxElement===i.ELEMENT}})}}}),define("objects.picasso/sorting/base-derived/Sorter",["util"],function(e){"use strict";function t(e,t){this.getSettings=e,this.getElements=t}function n(t){var n=t.qDef.qSortCriterias[0],r=this.getSettings();e.setValue(n,"qSortByExpression",r.SORT_BY_EXPRESSION),e.setValue(n,"qSortByAscii",r.SORT_BY_ASCII),e.setValue(n,"qSortByNumeric",r.SORT_BY_NUMERIC),e.setValue(n,"qSortByLoadOrder",r.SORT_BY_LOAD_ORDER),n.qExpression||(n.qExpression={});var o=i(this.getElements());n.qExpression.qv=o.exp}function i(e){var t=e.filter(function(e){return e.isDefault});return 0===t.length?e[0]:t[0]}function r(e,t){var n=e.filter(function(e){return e.id===t});return 0===n.length&&o("Could not find any element matching the element '"+t+"'"),n[0]}function o(e){throw new Error("Sorter: "+e)}return t.prototype.applyAutoSorting=n,t.prototype.applyDefaultCustomSorting=function(t,r){n.call(this,t);var o=i(this.getElements()),s=t.qDef.qSortCriterias[0];r.elementId=o.id,r.sortCriteria={},e.setValue(r.sortCriteria,"sortByExpression",s.qSortByExpression),e.setValue(r.sortCriteria,"sortByAscii",s.qSortByAscii),e.setValue(r.sortCriteria,"sortByNumeric",s.qSortByNumeric),e.setValue(r.sortCriteria,"sortByLoadOrder",s.qSortByLoadOrder)},t.prototype.applyCustomSorting=function(t,n){var i=t.qDef.qSortCriterias[0];if(e.setValue(i,"qSortByExpression",n.sortCriteria.sortByExpression),e.setValue(i,"qSortByAscii",n.sortCriteria.sortByAscii),e.setValue(i,"qSortByNumeric",n.sortCriteria.sortByNumeric),e.setValue(i,"qSortByLoadOrder",n.sortCriteria.sortByLoadOrder),1===i.qSortByExpression||-1===i.qSortByExpression)if(i.qExpression||(i.qExpression={}),n.elementId){var o=r(this.getElements(),n.elementId);i.qExpression.qv=o.exp}else i.qExpression.qv=n.expression.qValueExpression.qExpr},t}),define("objects.picasso/sorting/base-derived/sorter-factory",["objects.picasso/sorting/base-derived/Sorter"],function(e){"use strict";return{create:function(t,n){return new e(t,n)}}}),define("objects.picasso/sorting/base-derived/sorter-facade",[],function(){"use strict";return{applySorting:function(e,t,n){var i=n.autoSort,r=!!n.sortCriteria;i?e.applyAutoSorting(t):r?e.applyCustomSorting(t,n):e.applyDefaultCustomSorting(t,n)}}}),define("extensions.qliktech/boxplot/sorting/boxplot-sorter",["extensions.qliktech/boxplot/sorting/boxplot-sorting-settings-retriever","extensions.qliktech/boxplot/sorting/boxplot-sorting-elements-retriever","objects.picasso/sorting/base-derived/sorter-factory","objects.picasso/sorting/base-derived/sorter-facade"],function(e,t,n,i){"use strict";return{applySorting:function(r,o){var s=function(){return e.getSettings(o)},a=n.create(s,function(){var e=s();return t.getElements(r,e)}),l=r.qUndoExclude.box.qHyperCubeDef.qDimensions[0],c=r.boxplotDef.sorting;i.applySorting(a,l,c)}}}),define("general.utils/object-utils/object-utils",[],function(){return{mapArrayToObject:function(e,t){if(!Array.isArray(e))throw TypeError("array parameter must be of type: array");var n={};return t=t||"id",e.map(function(e,i){var r=e[t];if("string"!=typeof r)return TypeError("object property value of property:"+t+" is not a string: "+r);n[r]={item:e,index:i}}),n}}}),define("extensions.qliktech/boxplot/boxplot-properties",["core.utils/deferred","client.utils/property-resolver","client.property-panel/definition-builder/sort-order/sort-order","extensions.qliktech/boxplot/sorting/boxplot-sorting-settings-retriever","extensions.qliktech/boxplot/sorting/boxplot-sorting-elements-retriever","extensions.qliktech/boxplot/boxplot-utils","objects.utils/chart-style-utils","extensions.qliktech/boxplot/sorting/boxplot-sorter","general.utils/object-utils/object-utils"],function(e,t,n,i,r,o,s,a,l){function c(e,t){var n=e.filter(function(e){return e.boxElement===t})[0];return n?n.qDef.qDef:""}function u(e,t){var n=e.filter(function(e){return e.boxElement===t})[0],i=l.mapArrayToObject(n.qAttributeExpressions,"id",!0);return n&&i.tooltip?n.qAttributeExpressions[i.tooltip.index].qExpression:""}function h(e){return{get:function(t,n,i){var r=i.layout.boxplotDef&&i.layout.boxplotDef.elements[e].expression;return!i.properties.qUndoExclude||null!==r&&"NaN"!==r&&""!==r?t(null)||"":c(i.properties.qUndoExclude.box.qHyperCubeDef.qMeasures,e)||""},set:function(e,t,n){t(n.type,e,null)}}}function d(e){return{get:function(t,n,i){return i.layout.boxplotDef&&!i.layout.boxplotDef.elements[e].name?u(i.properties.qUndoExclude.box.qHyperCubeDef.qMeasures,e):t(n.type)},set:function(e,n,i){var r=t.getDefaultValue(i.type,i);n(i.type,e,r)}}}function p(e,n){return t.getValue(n.properties,"boxplotDef.qHyperCubeDef.qDimensions",[])[0]!==e}function f(e){return!(e.boxplotDef&&e.boxplotDef.calculations.auto)}function m(e){return{type:"items",translation:o.BOXELEMENTS[e].translationKey,items:{name:{ref:"boxplotDef.elements."+e+".name",type:"string",expression:"optional",translation:"Common.Name",convertFunctions:d(e)},expression:{ref:"boxplotDef.elements."+e+".expression",component:"expression",expressionType:"ValueExpression",translation:"Common.Expression",convertFunctions:h(e)}}}}function g(e){var t=e.boxplotDef.qHyperCubeDef&&e.boxplotDef.qHyperCubeDef.qDimensions.length>1;return void 0===t&&(t=!1),t}var v={AUTO_SORT:"boxplotDef.sorting.autoSort",SORT_CRITERIA:"boxplotDef.sorting.sortCriteria",ELEMENT_ID:"boxplotDef.sorting.elementId",EXPRESSION:"boxplotDef.sorting.expression"},y={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",items:{orientation:{ref:"orientation",type:"string",component:"item-selection-list",defaultValue:"vertical",horizontal:!0,items:[{component:"icon-item",icon:"",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}]},showWhiskers:{ref:"boxplotDef.presentation.whiskers.show",translation:"properties.boxplot.showWhiskers",type:"boolean",defaultValue:!0},gridLines:{type:"items",snapshot:{tid:"property-gridLines"},items:{showGridLines:{ref:"gridlines.auto",type:"boolean",translation:"properties.gridLine.spacing",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},gridSpacing:{ref:"gridlines.spacing",type:"number",component:"dropdown",defaultValue:2,options:[{value:0,translation:"properties.gridLine.noLines"},{value:2,translation:"properties.gridLine.medium"},{value:3,translation:"properties.gridLine.narrow"}],show:function(e){return e.gridlines&&!e.gridlines.auto}}}}}},colors:{translation:"properties.colors",type:"items",items:{colors:{type:"items",items:{autoColor:{ref:"boxplotDef.color.auto",type:"boolean",translation:"properties.colors",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},colorMode:{ref:"boxplotDef.color.mode",type:"string",component:"dropdown",options:function(){return[{value:"primary",translation:"properties.colorMode.primary"},{value:"byExpression",translation:"properties.colorMode.byExpression"}]},defaultValue:"primary",show:function(e){return!t.getValue(e,"boxplotDef.color.auto",!0)}},boxColor:{ref:"boxplotDef.color.box.paletteColor",translation:"properties.boxplot.boxColor",type:"object",component:"color-picker",dualOutput:!0,show:function(e){return!t.getValue(e,"boxplotDef.color.auto",!0)&&"primary"===t.getValue(e,"boxplotDef.color.mode","primary")},defaultValue:function(){var e=s.getStyle("boxPlot","box.box","fill");return{index:s.Theme.currentPalette.indexOf(e),color:e}}},outlierColor:{ref:"boxplotDef.color.point.paletteColor",translation:"properties.boxplot.outlierColor",type:"object",component:"color-picker",dualOutput:!0,show:function(e){return!t.getValue(e,"boxplotDef.color.auto",!0)&&"primary"===t.getValue(e,"boxplotDef.color.mode","primary")},defaultValue:function(){var e=s.Theme.dataColors.primaryColor;return{index:s.Theme.currentPalette.indexOf(e),color:e}}},attributeExpression:{type:"string",component:"expression",expressionType:"measure",schemaIgnore:!0,ref:"boxplotDef.color.expression.qValueExpression.qExpr",translation:"Common.Expression",show:function(e){return!t.getValue(e,"boxplotDef.color.auto",!0)&&"byExpression"===t.getValue(e,"boxplotDef.color.mode")}},expressionIsColor:{ref:"boxplotDef.color.expressionIsColor",translation:"properties.expressionIsColor",type:"boolean",defaultValue:!0,show:!1}}}}},measureAxis:{uses:"axis.picasso.measureAxis"},dimensionAxis:{uses:"axis.picasso.dimensionAxis",show:function(e,n,i){return t.getValue(i.layout,"boxplotDef.qHyperCube.qDimensionInfo.length")>1}}}},b=n.expression(v.SORT_CRITERIA+".sortByExpression"),x={type:"items",items:{expressionToggled:b.items.expressionToggled,sortByElement:{component:"sort-by-element",expressionRef:v.EXPRESSION,elementRef:v.ELEMENT_ID,show:function(e){return 0!==t.getValue(e,v.SORT_CRITERIA+".sortByExpression",0)},elements:function(t){if(!t.properties.qUndoExclude||!t.properties.qUndoExclude.hashCode)return e.reject();var n=i.getSettings(t.layout),o=r.getElements(t.properties,n);return e.resolve(o)}},expressionOrder:b.items.expressionOrder}},q={type:"items",translation:"properties.sorting",sortIndexRef:"boxplotDef.qHyperCubeDef.qInterColumnSortOrder",allowMove:!0,schemaIgnore:!0,grouped:!1,items:{autoSort:{ref:v.AUTO_SORT,type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],show:g,change:function(e,t,n,i){a.applySorting(n,i.layout)}},sortingItems:{component:"items",grouped:!0,items:{expression:x,numeric:n.numeric(v.SORT_CRITERIA+".sortByNumeric"),ascii:n.ascii(v.SORT_CRITERIA+".sortByAscii"),defaultSortMessage:{component:"text",translation:"properties.sorting.defaultSortingMessage",show:function(e){return 0==t.getValue(e,v.SORT_CRITERIA+".sortByExpression",0)&&0==t.getValue(e,v.SORT_CRITERIA+".sortByNumeric",0)&&0==t.getValue(e,v.SORT_CRITERIA+".sortByAscii",0)}}},show:function(e){return g(e)&&!t.getValue(e,v.AUTO_SORT)}},noData:{component:"no-data",show:function(e){return!g(e)}}}},C={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{suppressZero:{ref:"boxplotDef.qHyperCubeDef.qSuppressZero",show:!1},calcCond:{uses:"calcCond",ref:"boxplotDef.qHyperCubeDef"}}},refLines:{uses:"reflines"}}};return{type:"items",component:"accordion",items:{data:{translation:"Common.Data",type:"items",items:{innerData:{uses:"data",items:{dimensions:{ref:"boxplotDef.qHyperCubeDef.qDimensions",disabledRef:"boxplotDef.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions",items:{nullSuppression:{show:p},dimensionLimits:{show:!1},others:{show:p,items:{suppressOther:{readOnly:!0,defaultValue:!0}}}}},measures:{uses:"measures",ref:"boxplotDef.qHyperCubeDef.qMeasures",disabledRef:"boxplotDef.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",items:{numberFormatting:{items:{numberFormattingType:{options:[{},{},{},{},{},{},null]}}}}}}}}},boxDataSettings:{type:"items",translation:"boxplot.boxElements",items:{auto:{ref:"boxplotDef.calculations.auto",translation:"properties.boxplot.usePreset",component:"switch",type:"boolean",defaultValue:!0,undefinedValue:!1,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}]},mode:{ref:"boxplotDef.calculations.mode",translation:"properties.boxplot.preset",type:"string",component:"dropdown",options:[{value:o.BOXMODES.TUKEY.value,translation:o.BOXMODES.TUKEY.translation},{value:o.BOXMODES.FRACTILES.value,translation:o.BOXMODES.FRACTILES.translation},{value:o.BOXMODES.STDDEV.value,translation:o.BOXMODES.STDDEV.translation}],defaultValue:o.BOXMODES.TUKEY.value,show:function(e){return!f(e)}},tukeyCalcParam:{ref:"boxplotDef.calculations.parameters.tukey",translation:"properties.boxplot.whiskerLength",type:"number",component:"dropdown",options:o.BOXMODES.TUKEY.calcParameters,defaultValue:o.BOXMODES.TUKEY.defaultCalcParam,show:function(e){return!f(e)&&e.boxplotDef.calculations.mode===o.BOXMODES.TUKEY.value}},fractilesCalcParam:{ref:"boxplotDef.calculations.parameters.fractiles",translation:"properties.boxplot.whiskerPosition",type:"number",component:"dropdown",options:o.BOXMODES.FRACTILES.calcParameters,defaultValue:o.BOXMODES.FRACTILES.defaultCalcParam,show:function(e){return!f(e)&&e.boxplotDef.calculations.mode===o.BOXMODES.FRACTILES.value}},stddevCalcParam:{ref:"boxplotDef.calculations.parameters.stdDev",translation:"properties.boxplot.whiskerLength",type:"number",component:"dropdown",options:o.BOXMODES.STDDEV.calcParameters,defaultValue:o.BOXMODES.STDDEV.defaultCalcParam,show:function(e){return!f(e)&&e.boxplotDef.calculations.mode===o.BOXMODES.STDDEV.value}},customGroups:{component:"expandable-items",show:f,items:{firstWhisker:m("firstWhisker"),boxStart:m("boxStart"),boxMiddle:m("boxMiddle"),boxEnd:m("boxEnd"),lastWhisker:m("lastWhisker")}},outliers:{ref:"boxplotDef.elements.outliers.include",translation:"properties.boxplot.includeOutliers",type:"boolean",defaultValue:!0,show:function(e){var t=e.boxplotDef.calculations.mode,n=e.boxplotDef.calculations.parameters[t];return!(!f(e)&&t===o.BOXMODES.FRACTILES.value&&0===n)}}}},sorting:q,addons:C,settings:y}}}),define("extensions.qliktech/boxplot/boxplot-data",[],function(){return{measures:{min:1,max:1,description:function(e){return"horizontal"===e.orientation?"X-axis":"Y-axis"},add:function(){},move:function(){},remove:function(){}},dimensions:{min:1,max:2,description:function(e,t,n){return n<3?"Box":2===t?"Boxes":"horizontal"===e.orientation?"Y-axis":"X-axis"},add:function(){},move:function(){},remove:function(){}}}}),define("objects.picasso/sorting/base-derived/explore-properties-sorting-definition-builder",["util"],function(e){"use strict";function t(t,n){var i={chart:"",dimension:""};return 0!==e.getValue(t,n+"qSortByExpression",0)?(i.chart="sortByExpression",i.dimension="qSortByExpression"):0!==e.getValue(t,n+"qSortByNumeric",0)?(i.chart="sortByNumeric",i.dimension="qSortByNumeric"):0!==e.getValue(t,n+"qSortByAscii",0)&&(i.chart="sortByAscii",i.dimension="qSortByAscii"),i}function n(e,t){var n=e.sortCriteria;"sortByNumeric"!==t&&"sortByAscii"!==t||(n.sortByExpression=0),"sortByAscii"===t&&(n.sortByNumeric=0)}return{buildDefinition:function(i,r,o,s,a){var l=o+".qDef.qSortCriterias.0.";return{type:"items",translation:"properties.sorting",icon:"ascending",show:function(t){return e.getValue(t,i+".qDimensions.length",0)>1},items:{sortingOptions:{component:"radio-list",type:"number",diffs:[l+"qSortByExpression",l+"qSortByNumeric",l+"qSortByAscii"],options:[{value:1,translation:"properties.sorting.ascending"},{value:-1,translation:"properties.sorting.descending"}],setPropertyValue:function(i,o,c){var u=c.layout,h=t(i,l).chart;h||(h="sortByAscii");var d=e.getValue(i,r);if(d.sortCriteria||(d.sortCriteria={}),d.autoSort){var p=s(u);if(p.ELEMENT)d.elementId=p.ELEMENT;else{var f=a(i,u);d.elementId=f[0]}}d.autoSort=!1,n(d,h),d.sortCriteria[h]=o},getValue:function(n){var i=t(n,l).dimension;return i?e.getValue(n,l+i):0}}}}}}}),define("extensions.qliktech/boxplot/boxplot-explore-properties",["objects.picasso/sorting/base-derived/explore-properties-sorting-definition-builder","extensions.qliktech/boxplot/sorting/boxplot-sorting-settings-retriever","extensions.qliktech/boxplot/sorting/boxplot-sorting-elements-retriever"],function(e,t,n){function i(e){return{uses:"data",hyperCubePath:e,items:{dimensions:{ref:"boxplotDef.qHyperCubeDef.qDimensions",alternativeRef:"boxplotDef.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qDimensions",type:"items"},measures:{ref:"boxplotDef.qHyperCubeDef.qMeasures",alternativeRef:"boxplotDef.qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",type:"items"}}}}var r={type:"items",items:{outliers:{ref:"boxplotDef.elements.outliers.include",translation:"properties.boxplot.includeOutliers",type:"boolean"}}},o={uses:"presentation",items:{orientation:{ref:"orientation",type:"string",component:"item-selection-list",horizontal:!0,items:[{component:"icon-item",icon:"",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}]}}},s=e.buildDefinition("boxplotDef.qHyperCubeDef","boxplotDef.sorting","qUndoExclude.box.qHyperCubeDef.qDimensions.0",t.getSettings,n.getElementIds);return{get:function(e){return{type:"items",component:"accordion",items:{data:{translation:"Common.Data",icon:"database",type:"items",items:{innerData:i(e),boxDataSettings:r}},sorting:s,presentation:o}}}}}),define("objects.picasso/selections/selection-utils",[],function(){function e(e,t){var n=t.key.indexOf("qHyperCube")+"qHyperCube".length,i=t.key.substr(0,n),r=t.key.substr(n+1);return e.dataset(i).field(r)}return{brushInterceptors:{DIM_VALUE_NULL:-2,DIM_VALUE_TOTAL:-3,brushOnlyOne:function(e,t){var n=e.brushes().filter(function(e){return"value"===e.type}),i=[];return n.length&&n.forEach(function(e){i=i.concat(e.brush.values().map(function(t){return{key:e.id,value:t}}))}),i.concat(t)},filterValues:function(t,n){var i,r,o=this,s=[],a=0,l=[];return n.forEach(function(n){n.value!==o.DIM_VALUE_NULL&&n.value!==o.DIM_VALUE_TOTAL&&(r=e(t,n),(i=r&&r.raw()).qLocked?(s.push(i),a++):l.push({key:n.key,value:n.value}))}),{items:l,itemsAreLocked:a>0&&a===n.length,lockedFields:s}}}}}),define("objects.picasso/selections/selection-actions",["./selection-utils","assets/external/picasso-plugin-q/picasso-q","objects.utils/event-utils"],function(e,t,n){"use strict";return function(i,r,o){function s(){}return s.update=function(e,n,r){var s=t.qBrushHelper(r);if(s.length){if("resetMadeSelections"===s[0].method)return void i[s[0].method].apply(i).catch(function(e){console.warn("err",e)});o.activate(),o.selectionsMade=!0}s.forEach(function(e){i[e.method].apply(i,e.params).then(function(e){e||i.resetMadeSelections()}).catch(function(e){console.warn("err",e)})})},s.toggleValues=function(t,i,s){var a=e.brushInterceptors.filterValues(r,t),l=a.items;return a.itemsAreLocked&&n.showLockedFeedback(a.lockedFields),o.active||a.itemsAreLocked||!(s||l.length>0)||(o.activate(),i.start(),i.emit("update",[],[])),l},s}}),define("objects.picasso/selections/selections-handler",["util","objects.picasso/selections/selection-actions","objects.views/selections/interaction-handler","objects.utils/event-utils","touche"],function(e,t,n,i,r){"use strict";function o(o){function u(e){v=e}function h(e){y=e,q.refreshToolbar()}function d(e){e===l?q.cancel():e===c&&q.confirm()}function p(){var e=C.map(function(e){return x.dataset(e).fields().filter(function(e){return"dimension"===e.type()})});return(e=[].concat.apply([],e)).length&&e.every(function(e){return e.raw().qLocked})}function f(){var e=[],t=C.map(function(e){return x.dataset(e).fields().filter(function(e){return"dimension"===e.type()})});t=[].concat.apply([],t);for(var n=0;n<t.length;n++)t[n].raw().qLocked&&e.push(t[n].raw());return{fields:e,areAllFieldsLocked:e.length&&e.length===t.length}}function m(){S.forEach(function(e){e.listeners.update=function(t,n){r.preventGestures(),!e.sleep&&D.update(t,n,e.brush)},e.brush.on("update",e.listeners.update),e.brush.on("start",e.listeners.start)})}function g(){S.forEach(function(e){e.brush.removeListener("update",e.listeners.update),e.brush.removeListener("start",e.listeners.start)})}if(!(o&&o.model&&o.chartInstance&&o.selectionsApi))throw Error("Selections-handler: Missing input");var v,y,b=o.model,x=o.chartInstance,q=o.selectionsApi,C=o.dataPaths||[""],S=[],w={propertiesToRestore:{}},_=!1,D=t(b,x,q),M={},A=q.clear.bind(q);q.clear=function(){S.forEach(function(e){e.brush.clear(),e.dependentComponents.forEach(function(e){var t=x.component(e.id);t&&t.emit(e.clear)})}),A()},M.setUp=function(e){M.tearDown();var t=this.setUpBrush(e);return _&&m(),t},M.setUpBrush=function(t){var n=e.extend(!0,{},a,t),r={on:"tap",action:function(){return v?"set":"toggle"},contexts:n.contexts,data:n.data,globalPropagation:"stop"},o={context:n.contexts[0],data:n.data,style:n.style},l=s(n,x);return l.listeners.toggle=function(e){if(!_)return[];var t=f();return n.startOnEmptySelection&&0===e.length&&t.areAllFieldsLocked?(i.showLockedFeedback(t.fields),[]):D.toggleValues(e,l.brush,n.startOnEmptySelection)},l.brush.intercept("toggle-values",l.listeners.toggle),l.brush.intercept("add-values",l.listeners.toggle),l.brush.intercept("remove-values",l.listeners.toggle),l.brush.intercept("set-values",l.listeners.toggle),l.listeners.start=function(){S.length>1&&(S.forEach(function(e){e!==l&&e.brush.end()}),q.selectionsMade&&b.resetMadeSelections())},S.push(l),{trigger:r,consume:o}},M.setUpStart=function(){M.tearDown()},M.setUpDone=function(){_&&m()},M.tearDown=function(){_&&g(),S.forEach(function(e){e.brush.removeInterceptor("toggle-values",e.listeners.toggle),e.brush.removeInterceptor("add-values",e.listeners.toggle),e.brush.removeInterceptor("remove-values",e.listeners.toggle),e.brush.removeInterceptor("set-values",e.listeners.toggle)}),S=[]},M.pauseEngineCalls=function(e){S.forEach(function(t){t.id===e&&(t.sleep=!0)})},M.resumeEngineCalls=function(e,t){S.forEach(function(n){n.id===e&&(n.sleep=!1,t&&n.listeners.update([],[]))})},M.addComponent=function(e,t){S.forEach(function(n){n.id===e&&n.dependentComponents.push(t)})},M.on=function(){_||(_=!0,m(),n.CtrlToggle.bind(u),n.ShiftToggle.bind(h),w.unbindDeactivated=q.watchDeactivated(function(){S.forEach(function(e){e.brush.end()}),n.KeyPressed.unbind(d),E=!1}),w.unbindActivated=q.watchActivated(function(){n.KeyPressed.bind(d)}))},M.off=function(){_&&(_=!1,g(),n.CtrlToggle.unbind(u),n.ShiftToggle.unbind(h),n.KeyPressed.unbind(d),w.unbindActivated(),w.unbindDeactivated())};var E=!1;return M.lassoState=function(){return y?!E:E},M.toggleLasso=function(){E=!E},M.allFieldsLocked=function(){return p()},M}function s(e,t){return{brush:t.brush(e.contexts[0]),listeners:{},dependentComponents:[],id:e.contexts[0]}}var a={data:["elemNo"],contexts:["select"],startOnEmptySelection:!0,style:{active:{strokeWidth:2,stroke:"#333"},inactive:{opacity:.3}}},l=27,c=13;return{create:function(e,t,n){return o(e)}}}),define("objects.picasso/selections/gestures/on-component-checker",[],function(){"use strict";return{isOnComponentForRange:function(e,t,n){return!!e&&!!n.chart.componentsFromPoint({x:e.center.x,y:e.center.y}).filter(function(e){return-1!==t.indexOf(e.settings.key)})[0]},isOnComponentForLasso:function(e,t,n){return e&&n.chart.componentsFromPoint({x:e.center.x,y:e.center.y}).filter(function(e){return e.settings.key===t.keys.componentKey})[0]},isOnComponentForNavBtn:function(e,t,n){return n.chart.componentsFromPoint(e.center).some(function(e){return e.settings.key===t})}}}),define("objects.picasso/selections/gestures/lasso-gesture",["objects.picasso/selections/gestures/on-component-checker"],function(e){"use strict";function t(e){return e.selectionHandler.lassoState()&&!e.selectionHandler.allFieldsLocked()}return{callLassoGesture:function(n,i,r){return{type:"Pan",options:{direction:Hammer.DIRECTION_ALL,threshold:1,enable:function(o,s){if(n.lassoing)return i.isEnabledFn();var a=e.isOnComponentForLasso(s,r,this);return i.isEnabledFn()&&s&&(t(r.handlers)||n.lassoing)&&a},event:"lasso"},recognizeWith:r.handlers.scrollHandler?"drag":null,events:{lassostart:function(t){e.isOnComponentForLasso(t,r,this)&&(i.switchTo("lasso",this.chart,t),n.lassoing=!0,r.handlers.selectionHandler.pauseEngineCalls(r.keys.lassoBrushKey),t.clientX=t.pointers[0].clientX,t.clientY=t.pointers[0].clientY,i.doEmit(this.chart,"lasso","lassoStart",t))},lassomove:function(e){n.lassoing&&(e.clientX=e.pointers[0].clientX,e.clientY=e.pointers[0].clientY,i.doEmit(this.chart,"lasso","lassoMove",e))},lassoend:function(e){n.lassoing&&(e.clientX=e.pointers[0].clientX,e.clientY=e.pointers[0].clientY,i.doEmit(this.chart,"lasso","lassoEnd",e),r.handlers.selectionHandler.resumeEngineCalls(r.keys.lassoBrushKey,!0),n.lassoing=!1)},lassocancel:function(e){n.lassoing=!1,i.doEmit(this.chart,"lasso","lassoCancel",e),r.handlers.selectionHandler.resumeEngineCalls(r.keys.lassoBrushKey,!1)}}}}}}),define("objects.picasso/selections/gestures/measure-range-gesture",["objects.picasso/selections/gestures/on-component-checker"],function(e){"use strict";return{callMeasureRangeGesture:function(t,n,i,r){var o=i.keys.dimRangeBrushKey?"majorrange":"arearange";return{type:"Pan",options:{direction:i.isHorizontal?Hammer.DIRECTION_HORIZONTAL:Hammer.DIRECTION_VERTICAL,event:"measurerange",enable:function(o,s){if(!i.rangeSelStatus.isOpenMea)return!1;if(t.measureSelecting)return n.isEnabledFn();var a="measurerange"===i.active.gesture?[r,i.keys.componentKey]:[r],l=e.isOnComponentForRange(s,a,this);return t.measureSelecting=n.isEnabledFn()&&!!s&&!!l,t.measureSelecting&&!!i.keys.measureRangeBrushKey}},requireFailure:"lasso "+o,recognizeWith:i.handlers.scrollHandler?"drag":null,events:{measurerangestart:function(o){var s="measurerange"===i.active.gesture?[r,i.keys.componentKey]:[r];e.isOnComponentForRange(o,s,this)&&(t.measureSelecting=!0,n.switchTo("measurerange",this.chart,o),n.doEmit(this.chart,"rangeMeasure","rangeStart",o),i.handlers.selectionHandler.pauseEngineCalls(i.keys.measureRangeBrushKey))},measurerangemove:function(e){t.measureSelecting&&n.doEmit(this.chart,"rangeMeasure","rangeMove",e)},measurerangeend:function(e){t.measureSelecting&&(i.handlers.selectionHandler.resumeEngineCalls(i.keys.measureRangeBrushKey,!0),n.doEmit(this.chart,"rangeMeasure","rangeEnd",e),t.measureSelecting=!1)},measurerangecancel:function(){i.handlers.selectionHandler.resumeEngineCalls(i.keys.measureRangeBrushKey,!1),t.measureSelecting=!1}}}}}}),define("objects.picasso/selections/gestures/area-range-gesture",["objects.picasso/selections/gestures/on-component-checker"],function(e){"use strict";function t(e,t){return"x-axis"===e?"horizontal"===t?Hammer.DIRECTION_VERTICAL:Hammer.DIRECTION_HORIZONTAL:"horizontal"===t?Hammer.DIRECTION_HORIZONTAL:Hammer.DIRECTION_VERTICAL}return{callAreaRangeGesture:function(n,i,r,o){var s=r.keys.dimRangeBrushKey?"majorrange":"measurerange";return{type:"Pan",options:{direction:t(o,r.isHorizontal),event:"arearange",enable:function(t,s){if(!r.rangeSelStatus.isOpenDim)return!1;if(n.minoring)return i.isEnabledFn();var a="arearange"===r.active.gesture?[o,r.keys.componentKey]:[o],l=e.isOnComponentForRange(s,a,this);return n.minoring=i.isEnabledFn()&&!!s&&!!l,n.minoring}},requireFailure:"lasso "+s,recognizeWith:r.handlers.scrollHandler?"drag":null,events:{arearangestart:function(t){var s="arearange"===r.active.gesture?[o,r.keys.componentKey]:[o];e.isOnComponentForRange(t,s,this)&&(n.minoring=!0,i.switchTo("arearange",this.chart,t),i.doEmit(this.chart,"rangeMinor","areaStart",t),r.handlers.selectionHandler.pauseEngineCalls(r.keys.areaBrushKey))},arearangemove:function(e){n.minoring&&(this.chart.brush(r.keys.areaBrushKey).clear(),i.doEmit(this.chart,"rangeMinor","areaMove",e))},arearangeend:function(e){n.minoring&&(r.handlers.selectionHandler.resumeEngineCalls(r.keys.areaBrushKey,!0),i.doEmit(this.chart,"rangeMinor","areaEnd",e),n.minoring=!1)},arearangecancel:function(){r.handlers.selectionHandler.resumeEngineCalls(r.keys.areaBrushKey,!1),n.minoring=!1}}}}}}),define("objects.picasso/selections/gestures/dimension-range-gesture",["objects.picasso/selections/gestures/on-component-checker"],function(e){"use strict";return{callDimensionRangeGesture:function(t,n,i,r){var o=i.keys.measureRangeBrushKey?"measurerange":"arearange";return{type:"Pan",options:{direction:i.isHorizontal?Hammer.DIRECTION_VERTICAL:Hammer.DIRECTION_HORIZONTAL,event:"majorrange",enable:function(o,s){if(!i.rangeSelStatus.isOpenDim)return!1;if(t.majoring)return n.isEnabledFn();var a="majorrange"===i.active.gesture?[r,i.keys.componentKey]:[r],l=e.isOnComponentForRange(s,a,this);return t.majoring=n.isEnabledFn()&&!!s&&!!l,t.majoring&&!!i.keys.dimRangeBrushKey}},requireFailure:"lasso "+o,recognizeWith:i.handlers.scrollHandler?"drag":null,events:{majorrangestart:function(o){var s="majorrange"===i.active.gesture?[r,i.keys.componentKey]:[r];e.isOnComponentForRange(o,s,this)&&(t.majoring=!0,n.switchTo("majorrange",this.chart,o),n.doEmit(this.chart,"rangeDim","rangeStart",o),i.handlers.selectionHandler.pauseEngineCalls(i.keys.dimRangeBrushKey))},majorrangemove:function(e){t.majoring&&n.doEmit(this.chart,"rangeDim","rangeMove",e)},majorrangeend:function(e){t.majoring&&(i.handlers.selectionHandler.resumeEngineCalls(i.keys.dimRangeBrushKey,!0),n.doEmit(this.chart,"rangeDim","rangeEnd",e),t.majoring=!1)},majorrangecancel:function(){i.handlers.selectionHandler.resumeEngineCalls(i.keys.dimRangeBrushKey,!1),t.majoring=!1}}}}}}),define("objects.picasso/selections/gestures/drag-gesture",[],function(){"use strict";return{callDragGesture:function(e,t,n,i,r){var o={};return{type:"Pan",options:{direction:n.isHorizontal?Hammer.DIRECTION_VERTICAL:Hammer.DIRECTION_HORIZONTAL,event:"drag",enable:function(i,r){return e.dragging?t.isEnabledFn():(e.dragging=t.isEnabledFn()&&!!r&&!!this.chart.componentsFromPoint({x:r.center.x,y:r.center.y}).filter(function(e){return e.settings.key===n.keys.componentKey})[0],e.dragging)}},requireFailure:i?"lasso "+t.getBrushConfig():"",events:{dragstart:function(e){o={x:e.deltaX,y:e.deltaY};var t=-(n.isHorizontal?e.deltaY:e.deltaX)/n.handlers.scrollHandler.getItemSize();!n.isHorizontal&&r&&(t=-t),n.handlers.scrollHandler.getScrollApi().move(t)},dragmove:function(t){if(e.dragging){var i=-(n.isHorizontal?t.deltaY-o.y:t.deltaX-o.x)/n.handlers.scrollHandler.getItemSize();!n.isHorizontal&&r&&(i=-i),n.handlers.scrollHandler.getScrollApi().move(i),o={x:t.deltaX,y:t.deltaY}}},dragend:function(){e.dragging&&(e.dragging=!1)},dragcancel:function(){e.dragging=!1}}}}}}),define("objects.picasso/selections/gestures/navigational-button-gesture",["objects.picasso/selections/gestures/on-component-checker"],function(e){"use strict";return{callNavBtnGesture:function(t,n){return{type:"Tap",options:{event:"navBtnTap",enable:function(i,r){return!(!r||!t())&&e.isOnComponentForNavBtn(r,n,this)}},events:{navBtnTap:function(e){this.chart.componentsFromPoint(e.center).forEach(function(t){return t.emit("tap",e,1)})}}}}}}),define("objects.picasso/selections/dependent-interactions",["objects.picasso/selections/gestures/lasso-gesture","objects.picasso/selections/gestures/measure-range-gesture","objects.picasso/selections/gestures/area-range-gesture","objects.picasso/selections/gestures/dimension-range-gesture","objects.picasso/selections/gestures/drag-gesture","objects.picasso/selections/gestures/navigational-button-gesture"],function(e,t,n,i,r,o){"use strict";return{create:function(s,a,l,c,u,h){function d(e,t,n){if(S.gesture!==e){var i=g,r=t||S.chart;switch(S.gesture){case"majorrange":p(r,"rangeDim","rangeClear",n),i=v;break;case"measurerange":p(r,"rangeMeasure","rangeClear",n),i=y;break;case"arearange":p(r,"rangeMinor","areaClear",n),i=b}S.gesture=e;var o="range"===e?"range":"item";S.type&&S.type!==o&&r.brush(i).clear(),S.chart=t,S.type=o}}function p(e,t,n,i){if(e){var r=e.component(t);r&&r.emit(n,i)}}function f(){d("none"),C.majoring=!1,C.measureSelecting=!1,C.minoring=!1}var m={};l=l||"vertical";var g=u.lassoBrushKey||"select",v=u.dimRangeBrushKey||null,y=u.measureRangeBrushKey||null,b=u.areaBrushKey||null,x=u.legendBrushKey||null,q=!!s.selectionHandler,C={dragging:!1,lassoing:!1,majoring:!1,minoring:!1,measureSelecting:!1},S={gesture:"",type:""},w="horizontal"===l,_=w?"y-axis":"x-axis",D=w?"x-axis":"y-axis",M=[],A={isEnabledFn:a,doEmit:p,switchTo:d,getBrushConfig:function(){return v?y?"majorrange measurerange":"majorrange arearange":"measurerange arearange"}},E={handlers:s,keys:u,isHorizontal:w,active:S,rangeSelStatus:h};return q&&((M=[{type:"Tap",options:{event:"rangeClearTap"},events:{rangeClearTap:function(e){d("none",this.chart,e),C.majoring=!1,C.measureSelecting=!1,C.minoring=!1}}}]).unshift(o.callNavBtnGesture(A.isEnabledFn,x)),M.push(e.callLassoGesture(C,A,E)),v?y?(M.push(i.callDimensionRangeGesture(C,A,E,_)),s.selectionHandler.addComponent(v,{id:"rangeDim",clear:"rangeClear"}),M.push(t.callMeasureRangeGesture(C,A,E,D)),s.selectionHandler.addComponent(y,{id:"rangeMeasure",clear:"rangeClear"})):(M.push(i.callDimensionRangeGesture(C,A,E,_)),s.selectionHandler.addComponent(v,{id:"rangeDim",clear:"rangeClear"}),M.push(n.callAreaRangeGesture(C,A,E,D)),s.selectionHandler.addComponent(b,{id:"rangeMinor",clear:"areaClear"})):(M.push(t.callMeasureRangeGesture(C,A,E,D)),s.selectionHandler.addComponent(y,{id:"rangeMeasure",clear:"rangeClear"}),M.push(n.callAreaRangeGesture(C,A,E,_)),s.selectionHandler.addComponent(b,{id:"rangeMinor",clear:"areaClear"}))),s.scrollHandler&&(M.push(r.callDragGesture(C,A,E,q,c)),s.scrollHandler.getScrollApi().on("update",f)),m.gestures=M,m.destroy=function(){s.scrollHandler&&s.scrollHandler.getScrollApi().removeListener("update",f)},m}}}),define("objects.picasso/tooltip/tooltip-actions",["translator","jquery","qvangular","encoder","general.utils/support","general.utils/shapes/rect","core.utils/feature-flags","objects.views/charts/tooltip/chart-tooltip-service"],function(e,t,n,i,r,o,s){"use strict";function a(e,i,o,a,c,u,p,m){function g(e,t,i,r){b=!0,n.getService("qvChartTooltipService").open({position:e,content:t,direction:["top","right","left","bottom"],dir:i,template:r,numberInExcess:t.numberInExcess},m,x)}function v(){b&&n.getService("qvChartTooltipService").close(),b=!1}function y(e){var t=[];return e.forEach(function(e){-1===t.indexOf(e)&&"container"!==e.type&&t.push(e)}),t}var b=!1,x=r.treatAsDesktop()?500:0;m=m||6e4,u=u||"tooltip",a=a||["self"];var q=i.brush(u),C={};return C.getElementOffset=function(e){var n=t(e).offset();return n.right=n.left+t(e).width(),n.bottom=n.top+t(e).height(),n},C.isOpen=function(){return b},C.closeTooltip=v,C.update=function(e,t,n){var r,m=q.brushes(),b=i.dataset(c),x=i.getAffectedShapes(u,"and",a,o),S=n.filterShapes?n.filterShapes(x):y(x);if(m.length>=1){r=[];for(var w=S.length-d,_=Math.min(d,S.length),D=0;D<_;D++){var M=S[D],A={rows:[]};if(n.labelData){for(var E=[],I=n.labelData,T=!1,L=0;L<I.length;L++){var k=M.data[I[L]].value;if(k.qElemNo===f||k.qElemNumber===f){T=!0;break}E.push(M.data[I[L]].value.qText)}if(T)return;if(A.header=n.headerResolver(E),A.rows=n.measureRows.map(function(e){var t=M.data;return n.rowResolver(b.field(t[e].source.field),t[e],t)}).filter(function(e){return!!e}),s.COLOR_BY_DIM&&n.chartView){var O=h(n,M);O&&A.rows.unshift(O)}r.push(A)}}w>0&&(r.numberInExcess=w),S[0]&&r.length?g(l(x,C.getElementOffset(S[0].element)),r,n.direction,p):v()}else v()},C.toggleInterceptor=function(e){if(a.length>1){var t={},n=[];return e.forEach(function(e){t[e.key]||(t[e.key]={}),t[e.key][e.value]||(t[e.key][e.value]=!0,n.push(e))}),n}return e},C}function l(e,t){var n=c(e),i=[];return i.push({x:n.x+n.width/2+t.left,y:n.y-2+t.top}),i.push({x:n.x+2+n.width+t.left,y:n.y+n.height/2+t.top}),i.push({x:n.x-2+t.left,y:n.y+n.height/2+t.top}),i.push({x:n.x+n.width/2+t.left,y:n.y+2+n.height+t.top}),i.forEach(function(e){e.x=Math.min(Math.max(e.x,t.left),t.right),e.y=Math.min(Math.max(e.y,t.top),t.bottom)}),i}function c(e){var t=e[0].bounds,n=new o(t.x,t.y,t.width,t.height);if(e.length>1)for(var i=1;i<e.length;i++)t=e[i].bounds,n=n.combineWith(new o(t.x,t.y,t.width,t.height));return n}function u(e){for(var t=-1,n=0;n<e.length;n++)e[n]===p&&(t=n);return t}function h(t,n){var r=n.data.colorByDim&&n.data.colorByDim.value;if(r){var o=r,s=[];t.data.forEach(function(e){var t=n.data[e];t&&s.push(t.value)});var a,l=u(s);if((a=l>-1?t.chartView.getColoringMap().getColor(s,void 0,0,n.data.row.value):t.chartView.getColoringMap().getColorFromPreScaledValue(r.qElemNo)).isInvalid())return;var c=l>-1?e.get("properties.dimensionLimits.others"):o.qElemNo===f?"-":o.qText,h=i.encodeForHTML(c);return{label:t.chartView.getColoringMap().getColorDataInfo().legendTitle,value:h,template:'<div class="color-template-wrapper"><div class="color-dot" style="background:'+a+'"></div><span dir="ltr">'+h+"</span></div>"}}}var d=5,p=-3,f=-2;return{create:function(e,t,n,i,r,o,s,l){return a(0,t,n,i,r,o,s,l)},_getColorByDimData:h}}),define("objects.picasso/formatting",[],function(){return{formatMeasureValue:function(e,t){if(e.raw().isCustomFormatted)return e.formatter()(t.value.qText);var n=void 0!==t.value.qNum?t.value.qNum:t.value.qValue;return e.formatter()(n)}}}),define("objects.picasso/tooltip/tooltips-handler",["util","general.utils/support","objects.picasso/tooltip/tooltip-actions","objects.picasso/formatting"],function(e,t,n,i){"use strict";function r(n,i,r){function a(){Object.keys(p).forEach(function(e){l(p[e])})}function l(e){e.listeners.update=function(t,n){var i={data:e.data,headerResolver:e.headerResolver,rowResolver:e.rowResolver,direction:e.direction,chartView:e.chartView,attrDimPath:e.attrDimPath,measureRows:e.measureRows,labelData:e.labelData,filterShapes:e.filterShapes};e.action.update(t,n,i)},e.listeners.end=function(){e.action.closeTooltip()},e.brush.on(t.treatAsDesktop()?"update":"set-values",e.listeners.update),e.brush.on("end",e.listeners.end),e.brush.intercept("set-values",e.action.toggleInterceptor)}function c(){Object.keys(p).forEach(function(e){u(p[e])})}function u(e){e.brush.removeListener(t.treatAsDesktop()?"update":"set-values",e.listeners.update),e.brush.removeListener("end",e.listeners.end),e.brush.removeInterceptor("set-values",e.action.toggleInterceptor)}function h(){Object.keys(p).forEach(function(e){p[e].action.closeTooltip()})}function d(){h();for(var e in p)p[e].brush.clear()}if(!n||!i)throw Error("Tooltips-handler: Missing input");var p={},f=!1;i&&(i.cancel=function(){h()});var m={};return m.setUp=function(i){var r=e.extend(!0,{},s,i);if(!r.componentKey)throw Error("Tooltips-handler.setUp: Missing required input");p[r.contexts[0]]&&f&&u(p[r.contexts[0]]);var a=o(r,n);return p[r.contexts[0]]=a,f&&l(a),{trigger:{on:t.treatAsDesktop()?"over":"tap",action:"set",contexts:r.contexts,data:r.data,globalPropagation:"stop"}}},m.tearDown=function(){f&&c(),p=[]},m.closeTooltip=h,m.on=function(){f||(f=!0,a(),t.treatAsDesktop()&&r&&r.on("mouseleave",d))},m.off=function(){f&&(f=!1,c(),t.treatAsDesktop()&&r&&r.off("mouseleave",d),h())},m}function o(e,t){return{brush:t.brush(e.contexts[0]),action:n.create(e.chartView,t,e.componentKey,e.data,e.dataPath,e.contexts[0],e.template,e.duration),data:e.data,headerResolver:e.headerResolver,rowResolver:e.rowResolver,listeners:{},direction:e.direction,chartView:e.chartView,attrDimPath:e.attrDimPath,measureRows:e.measureRows,labelData:e.labelData,filterShapes:e.filterShapes}}var s={data:[""],contexts:["tooltip"],headerResolver:function(e){return e.join(", ")},rowResolver:function(e,t){return{value:i.formatMeasureValue(e,t),label:e.title()}},direction:"ltr"};return{create:function(e,t,n){return r(e,t,n)}}}),define("objects.picasso/scroll/scroll-handler",["objects.utils/event-utils","objects.picasso/legend/legend-utils"],function(e,t){function n(e,t,n,i,r,o,s){if(!(e&&t&&n&&i))throw Error("Scroll-handler: Missing input");this._chartInstance=e,this._$chartElement=t,this._getSlicedDataFn=i,this._tooltipApi=r,this._on=!1,this._itemSize=30,this.options={direction:"vertical"},this._onScrollCallback=o,this._legendKey=s}function i(){var e=("horizontal"===this.options.direction?this._$chartElement.width():this._$chartElement.height())||0,t=Math.floor(e/this.getItemSize());this._scrollViewSizeInItem=Math.max(t,1)}function r(n){var i=e.getMouseWheelData(n.originalEvent);if(!t.onMouseWheel(i,this._chartInstance,this._legendKey)&&!this._disabled&&this.getScrollApi()&&(n.preventDefault(),i.delta)){var r=i.delta<0?3:-3;this._scrollApi.move(r)}}function o(){if(!this._disabled){this._tooltipApi&&this._tooltipApi.cancel();var e=this;this.getViewData().then(function(t){e._onScrollCallback&&e._onScrollCallback(t,void 0,!0)})}}var s=".scrollHandler";return n.prototype.getScrollApi=function(){return this._scrollApi||(this._scrollApi=this._chartInstance.scroll("dimension")),this._scrollApi},n.prototype.setDisabled=function(e){this._disabled=e},n.prototype.getDisabled=function(){return this._disabled},n.prototype.setItemSize=function(e){this._itemSize!==e&&(this._itemSize=e,i.call(this))},n.prototype.getItemSize=function(){return this._itemSize},n.prototype.getScrollViewSizeInItem=function(){return this._scrollViewSizeInItem||i.call(this),this._scrollViewSizeInItem},n.prototype.on=function(){this._on||(this.getScrollApi()&&(this._scrollApi.removeAllListeners(),this._scrollApi.on("update",o.bind(this))),this._$chartElement.on("mousewheel"+s+" DOMMouseScroll"+s,r.bind(this)),this._$chartElement.on("touchstart"+s,function(e){e.preventDefault()}),this._on=!0)},n.prototype.off=function(){this._on&&(this.getScrollApi()&&this._scrollApi.removeAllListeners(),this._$chartElement.off(s),this._on=!1)},n.prototype.onResize=function(){i.call(this),this.getScrollApi()&&this._scrollApi.update({viewSize:this._scrollViewSizeInItem})},n.prototype.isDataSizeChanged=function(e,t){return Math.min(this.getScrollViewSizeInItem(),t)!==e},n.prototype.resetScroll=function(){this.getScrollApi()&&this._scrollApi.moveTo(0)},n.prototype.getViewData=function(){var e=0,t=0;if(this.getScrollApi()){var n=this._scrollApi.getState();e=Math.round(n.start),t=n.viewSize}return this._getSlicedDataFn(e,t)},n.prototype.setOptions=function(e){this.options.direction!==e.direction&&(this._scrollViewSizeInItem=void 0),this.options=e},n.prototype.getScrollState=function(){return this.getScrollApi().getState().start},n.prototype.setScrollState=function(e){this.getScrollApi().moveTo(e)},n}),define("extensions.qliktech/boxplot/boxplot-data-scroller",["objects.backend-api/cache-cube","objects.backend-api/stacked-cube-slicer","core.utils/deferred"],function(e,t,n){function i(e,t,n){this._backendApi=e,this._getDataFn=t,this._scrollHandler=n}return i.prototype.getOutliersCache=function(){return this._outliersCacheCube},i.prototype.updateOutliersCache=function(n){this._outliersCacheCube||(this._outliersCacheCube=new e(this._backendApi.model,"qDataPages","/qUndoExclude/outliers/qHyperCubeDef",this._backendApi.cacheCube.options),this._outliersCacheCube.setMethodName("getHyperCubeStackData"),this._outliersCacheCube.cube=new t,this._scrollHandler.getScrollViewSizeInItem()&&this._outliersCacheCube.setOptions({height:3*this._scrollHandler.getScrollViewSizeInItem(),width:6}));var i=n.boxplotDef.qHyperCube.qDimensionInfo.length>1;this._outliersCacheCube.setCubeSize(i?n.qUndoExclude.box.qHyperCube.qSize:n.qUndoExclude.outliers.qHyperCube.qSize)},i.prototype.updateCacheSize=function(){var e={height:3*this._scrollHandler.getScrollViewSizeInItem(),width:6};this._backendApi.setCacheOptions(e),this._outliersCacheCube&&this._outliersCacheCube.setOptions(e)},i.prototype.getSlicedData=function(e,t,i){var r={top:t,height:i,left:0,width:e.qUndoExclude.box.qHyperCube.qSize.qcx},o=this._getDataFn(this._backendApi,e.qUndoExclude.box.qHyperCube,r);if(!e.boxplotDef.elements||!e.boxplotDef.elements.outliers.include)return o.then(function(){return e});var s={top:t,height:i,left:0,width:e.qUndoExclude.outliers.qHyperCube.qSize.qcx},a=this._getDataFn(this._outliersCacheCube,e.qUndoExclude.outliers.qHyperCube,s);return n.all([o,a]).then(function(){return e})},i.prototype.destroy=function(){this._outliersCacheCube&&this._outliersCacheCube.destroy()},i}),define("extensions.qliktech/boxplot/boxplot-api",["objects.backend-api/stacked-api"],function(e){"use strict";return e.extend("BoxPlotApi",{setPaths:function(e){this._paths=e},beginSelections:function(){return this.model.app.switchModalSelection(this.model,this._paths)}})}),define("text!extensions.qliktech/boxplot/boxplot.ng.html",[],function(){return'<div class="picasso-chart qv-viz"></div>'}),define("objects.picasso/expression-generator/expression-wrapper",[],function(){"use strict";return{wrapExpression:function(e){var t=e.replace(/\]/g,"]]");return t?"["+t+"]":""}}}),define("extensions.qliktech/boxplot/boxplot-expression-generator",["objects.picasso/expression-generator/expression-wrapper"],function(e){function t(e){return new RegExp(e,"g")}return{getOutliersStatement:function(t,n,i){return t=e.wrapExpression(t),i?"=aggr( "+n+", "+t+", "+(i=e.wrapExpression(i))+" )":"=aggr( "+n+", "+t+" )"},replaceDefaultExpression:function(n,i,r,o){return r=e.wrapExpression(r),o=e.wrapExpression(o||""),i=i.replace(new RegExp("^="),""),n.replace(t("{{<OuterDim>}}"),o?"<"+o+">":"").replace(t("{{InnerMeasure}}"),i).replace(t("{{OuterDim,}}"),o?o+",":"").replace(t("{{OuterDim&}}"),o?o+" &":"").replace(t("{{OuterDim}}"),o).replace(t("{{InnerDim}}"),r)},replaceDoubleCurlyReferences:function(e,n){for(var i in n)e=e.replace(t("{{"+i+"}}"),n[i]);return e}}}),define("extensions.qliktech/boxplot/boxplot-cubes-generator",["util","core.utils/deferred","extensions.qliktech/boxplot/boxplot-utils","extensions.qliktech/boxplot/sorting/boxplot-sorter","extensions.qliktech/boxplot/boxplot-expression-generator","general.utils/attribute-expression-util","client.utils/property-resolver","translator"],function(e,t,n,i,r,o,s,a){function l(e,t,i,o,s,a){if(a.calculations&&a.calculations.parameters){var l;switch(e){case n.BOXMODES.STDDEV.value:l=n.BOXMODES.STDDEV.getBoxExpressions(a.calculations.parameters.stdDev);break;case n.BOXMODES.FRACTILES.value:l=n.BOXMODES.FRACTILES.getBoxExpressions(a.calculations.parameters.fractiles);break;case n.BOXMODES.TUKEY.value:default:l=n.BOXMODES.TUKEY.getBoxExpressions(a.calculations.parameters.tukey)}return l?r.replaceDefaultExpression(l[t],i,o,s):""}}function c(e,n,i){var r=[];return e.qDimensions.forEach(function(t,o){t.qLibraryId?r.push(u(e,"dimension",o,i,n[o])):r.push(t.qDef.qFieldDefs[0])}),e.qMeasures.forEach(function(t,n){t.qLibraryId?r.push(u(e,"measure",n,i)):r.push(t.qDef.qDef)}),t.all(r)}function u(e,t,n,i,r){var o=e["dimension"===t?"qDimensions":"qMeasures"][n].qLibraryId;return i["dimension"===t?"getDimension":"getMeasure"](o).then(function(e){return e.getProperties().then(function(e){return"dimension"===t?e.qDim.qFieldDefs[r]:e.qMeasure.qDef})})}function h(e,t){var n={qExpression:e};return t&&(n.id=t),n}var d="If( {{InnerMeasure}} < {{FirstWhisker}} or {{InnerMeasure}} > {{LastWhisker}}, {{InnerMeasure}} )",p="If( {{InnerMeasure}} < {{FirstWhisker}} or {{InnerMeasure}} > {{LastWhisker}} or {{FirstInnerRow}}, {{OuterDim&}} {{InnerDim}} )",f="If( {{InnerMeasure}} < {{FirstWhisker}} or {{InnerMeasure}} > {{LastWhisker}}, {{OuterDim&}} {{InnerDim}} )",m="If( {{InnerMeasure}} < {{FirstWhisker}}, {{FirstWhisker}} - {{InnerMeasure}}, {{InnerMeasure}} - {{LastWhisker}} )",g="Alt( Aggr( RowNo(), {{OuterDim,}} {{InnerDim}} ), 1 ) = 1";return{generateHyperCubes:function(t,u,v,y){t.qUndoExclude=t.qUndoExclude||{},t.qUndoExclude.box=t.qUndoExclude.box||{qHyperCubeDef:{}};var b=t.qUndoExclude.box.qHyperCubeDef,x=t.boxplotDef,q=x.qHyperCubeDef;b.qDimensions=[],b.qMeasures=[],b.qCalcCond=q.qCalcCond;var C,S,w,_,D=x.calculations.mode,M=e.extend(!0,{},q.qDimensions[0]),A=q.qMeasures[0],E=q.qDimensions.length,I=x.elements,T=2===x.qHyperCubeDef.qDimensions.length,L=[],k=!t.boxplotDef.color.auto&&"byExpression"===t.boxplotDef.color.mode;return E>0&&k&&(L=[h(e.getValue(t,"boxplotDef.color.expression.qValueExpression.qExpr"),o.IDMAP.COLOR_BY_EXPRESSION)]),q.qDimensions[1]&&(C=e.extend(!0,{},q.qDimensions[1]),b.qDimensions.push(C)),c(x.qHyperCubeDef,u,y).then(function(c){var u=C?c[1]:"";if(Object.keys(n.BOXELEMENTS).forEach(function(t){var i=s.getValue(x,"elements."+t),d=!(!i||!i.expression||i.expression.qValueExpression&&(!i.expression.qValueExpression.qExpr||!i.expression.qValueExpression.qExpr.length));if(x.calculations&&x.calculations.auto||!I||!d)w=l(D,t,c[E],c[0],u,x);else{var p=I[t].expression;w="object"==typeof p?p.qValueExpression.qExpr:p}(_={qDef:{}}).qDef.qNumFormat=A.qDef.qNumFormat,_.qDef.isCustomFormatted=A.qDef.isCustomFormatted,_.qDef.qDef=w,_.qDef.cId=e.generateId(),_.boxElement=t;var f=!x.calculations.auto&&I&&I[t]&&I[t].name;_.qDef.qLabel=a.get(n.BOXELEMENTS[t].translationKey),_.qAttributeExpressions=[h(f&&f.qStringExpression?"="+f.qStringExpression.qExpr:function(e){var i;if(e)i="='"+e+"'";else{var o=n.getDefaultNameTemplate(t,x);i="expression"===o.type?"="+r.replaceDefaultExpression(o.name,c[E],c[0],u):"='"+o.name+"'"}return i}(f),o.IDMAP.TOOLTIP)],delete _.qLibraryId,b.qMeasures.push(_)}),b.qMeasures[0].qAttributeExpressions=L.concat(b.qMeasures[0].qAttributeExpressions),T&&i.applySorting(t,v),x.elements&&x.elements.outliers&&x.elements.outliers.include){t.qUndoExclude.outliers=t.qUndoExclude.outliers||{qHyperCubeDef:{}};var y=t.qUndoExclude.outliers.qHyperCubeDef;y.qMode="K",y.qDimensions=[],y.qMeasures=[],y.qCalcCond=q.qCalcCond;var k=b.qMeasures[0].qDef.qDef.replace(/^=/,""),O=b.qMeasures[4].qDef.qDef.replace(/^=/,""),P=r.replaceDefaultExpression(g,c[E],c[0],u);w=T?r.replaceDoubleCurlyReferences(r.replaceDefaultExpression(p,c[E],c[0],u),{FirstWhisker:k,LastWhisker:O,FirstInnerRow:P}):r.replaceDoubleCurlyReferences(r.replaceDefaultExpression(f,c[E],c[0],u),{FirstWhisker:k,LastWhisker:O});var N=r.replaceDoubleCurlyReferences(r.replaceDefaultExpression(d,c[E],c[0],u),{FirstWhisker:k,LastWhisker:O}),R=r.replaceDoubleCurlyReferences(r.replaceDefaultExpression(m,c[E],c[0],u),{FirstWhisker:k,LastWhisker:O}),F=r.getOutliersStatement(c[0],R,u);(_=e.extend(!0,{},A)).qDef.qDef=r.getOutliersStatement(c[0],N,u),delete _.qLibraryId,y.qMeasures.push(_),y.qDimensions.push(M),(S=e.extend(!0,{},C?q.qDimensions[1]:q.qDimensions[0])).qNullSuppression=!0,S.qDef.cId=e.generateId(),S.qDef.qFieldDefs=[r.getOutliersStatement(c[0],w,u)],S.qDef.qFieldLabels=[""],S.qDef.qSortCriterias[0].qSortByExpression=1,S.qDef.qSortCriterias[0].qExpression.qv=F,delete S.qLibraryId,y.qDimensions.splice(0,0,S),y.qAlwaysFullyExpanded=!0,C?(y.qDimensions.splice(1,0,C),y.qInterColumnSortOrder=[1,0,3,2]):y.qInterColumnSortOrder=[0,1,2]}})}}}),define("text!extensions.qliktech/boxplot/boxplot-tooltip/boxplot-tooltip-picture.ng.html",[],function(){return'<div qva-direction x-dir-setting="{{options.direction}}" class="qv-tooltip qvt-chart-tooltip" qva-press="hideTooltip($event)" tid="qv-chart-tooltip" ng-class="{\'above\':alwaysOnTop}" >\n\t<div class="immidiate-contextual-arrow"></div>\n\t<div class="qv-chart-tooltip-inner">\n\t\t<div ng-repeat="item in content" class="qv-chart-tooltip-item">\n\t\t\t<div class="qv-chart-tooltip-content">\n\t\t\t\t<div qva-direction x-dir-text="{{item.header}}" x-dir-setting="{{options.direction}}" class=\'qv-tp-header\' ng-if="item.header !== undefined">\n\t\t\t\t\t<strong>{{item.header}}</strong>\n\t\t\t\t</div>\n\t\t\t\t<table>\n\t\t\t\t\t<tr class="qv-tp-row" qv-set-init-height>\n\t\t\t\t\t\t<td ng-if="item.rows.length > 1" style="width: 13px; position: relative;">\n\t\t\t\t\t\t\t<div class="partial-box">\n\t\t\t\t\t\t\t\t<div class="whisker">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="line">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="filler">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="item.rows.length > 1" style="width: 25px; position: relative;">\n\t\t\t\t\t\t\t<div class="alignment-line align-box"></div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="item.rows.length > 1">\n\t\t\t\t\t\t\t<div class="circle"></div>\n\t\t\t\t\t\t</td>\n\n\t\t\t\t\t\t<td class=\'qv-tp-item\'>\n\t\t\t\t\t\t\t<span qva-direction x-dir-text="{{item.rows[4].label}}" class="qv-tp-rowPart" ng-class="{\'single\' : (content.length + item.rows.length) <= 3}">{{item.rows[4].label}}</span>\n\t\t\t\t\t\t\t<span>:&nbsp;</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="!item.rows[4].template" class=\'qv-tp-value\'>\n\t\t\t\t\t\t\t<div class="qv-tp-rowPart" dir="ltr">{{item.rows[4].value}}</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="item.rows[4].template" class=\'qv-tp-template qv-tp-value\' ng-bind-html="item.rows[4].template">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t\t<tr class="qv-tp-row" qv-set-init-height>\n\t\t\t\t\t\t<td ng-if="item.rows.length > 1" style="width: 13px; position: relative;">\n\t\t\t\t\t\t\t<div class="partial-box">\n\t\t\t\t\t\t\t\t<div class="box box-extension">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="end-line">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="item.rows.length > 1" style="width: 25px; position: relative;">\n\t\t\t\t\t\t\t<div class="alignment-line align-box"></div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="item.rows.length > 1">\n\t\t\t\t\t\t\t<div class="circle"></div>\n\t\t\t\t\t\t</td>\n\n\t\t\t\t\t\t<td class=\'qv-tp-item\'>\n\t\t\t\t\t\t\t<span qva-direction x-dir-text="{{item.rows[3].label}}" class="qv-tp-rowPart" ng-class="{\'single\' : (content.length + item.rows.length) <= 3}">{{item.rows[3].label}}</span>\n\t\t\t\t\t\t\t<span>:&nbsp;</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="!item.rows[3].template" class=\'qv-tp-value\'>\n\t\t\t\t\t\t\t<div class="qv-tp-rowPart" dir="ltr">{{item.rows[3].value}}</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="item.rows[3].template" class=\'qv-tp-template qv-tp-value\' ng-bind-html="item.rows[3].template">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t\t<tr class="qv-tp-row" qv-set-init-height>\n\t\t\t\t\t\t<td ng-if="item.rows.length > 1" style="width: 13px; position: relative;">\n\t\t\t\t\t\t\t<div class="partial-box">\n\t\t\t\t\t\t\t\t<div class="median-line"></div>\n\t\t\t\t\t\t\t\t<div class="box full-box">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="box full-box-reverse">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="item.rows.length > 1" style="width: 25px; position: relative;">\n\t\t\t\t\t\t\t<div class="alignment-line align-box"></div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="item.rows.length > 1">\n\t\t\t\t\t\t\t<div class="circle"></div>\n\t\t\t\t\t\t</td>\n\n\t\t\t\t\t\t<td class=\'qv-tp-item\'>\n\t\t\t\t\t\t\t<span qva-direction x-dir-text="{{item.rows[2].label}}" class="qv-tp-rowPart" ng-class="{\'single\' : (content.length + item.rows.length) <= 3}">{{item.rows[2].label}}</span>\n\t\t\t\t\t\t\t<span>:&nbsp;</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="!item.rows[2].template" class=\'qv-tp-value\'>\n\t\t\t\t\t\t\t<div class="qv-tp-rowPart" dir="ltr">{{item.rows[2].value}}</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="item.rows[2].template" class=\'qv-tp-template qv-tp-value\' ng-bind-html="item.rows[2].template">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t\t<tr class="qv-tp-row" qv-set-init-height>\n\t\t\t\t\t\t<td ng-if="item.rows.length > 1" style="width: 13px; position: relative;">\n\t\t\t\t\t\t\t<div class="partial-box">\n\t\t\t\t\t\t\t\t<div class="box invert-pos lower-box">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="line">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="item.rows.length > 1" style="width: 25px; position: relative;">\n\t\t\t\t\t\t\t<div class="alignment-line align-box"></div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="item.rows.length > 1">\n\t\t\t\t\t\t\t<div class="circle"></div>\n\t\t\t\t\t\t</td>\n\n\t\t\t\t\t\t<td class=\'qv-tp-item\'>\n\t\t\t\t\t\t\t<span qva-direction x-dir-text="{{item.rows[1].label}}" class="qv-tp-rowPart" ng-class="{\'single\' : (content.length + item.rows.length) <= 3}">{{item.rows[1].label}}</span>\n\t\t\t\t\t\t\t<span>:&nbsp;</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="!item.rows[1].template" class=\'qv-tp-value\'>\n\t\t\t\t\t\t\t<div class="qv-tp-rowPart" dir="ltr">{{item.rows[1].value}}</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="item.rows[1].template" class=\'qv-tp-template qv-tp-value\' ng-bind-html="item.rows[1].template">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\n\t\t\t\t\t<tr class="qv-tp-row" qv-set-init-height>\n\t\t\t\t\t\t<td ng-if="item.rows.length > 1" style="width: 13px; position: relative;">\n\t\t\t\t\t\t\t<div class="partial-box">\n\t\t\t\t\t\t\t\t<div class="whisker">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="end-line">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="filler">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="item.rows.length > 1" style="width: 25px; position: relative;">\n\t\t\t\t\t\t\t<div class="alignment-line align-box"></div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="item.rows.length > 1">\n\t\t\t\t\t\t\t<div class="circle"></div>\n\t\t\t\t\t\t</td>\n\n\t\t\t\t\t\t<td class=\'qv-tp-item\'>\n\t\t\t\t\t\t\t<span qva-direction x-dir-text="{{item.rows[0].label}}" class="qv-tp-rowPart" ng-class="{\'single\' : (content.length + item.rows.length) <= 3}">{{item.rows[0].label}}</span>\n\t\t\t\t\t\t\t<span>:&nbsp;</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="!item.rows[0].template" class=\'qv-tp-value\'>\n\t\t\t\t\t\t\t<div class="qv-tp-rowPart" dir="ltr">{{item.rows[0].value}}</div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="item.rows[0].template" class=\'qv-tp-template qv-tp-value\' ng-bind-html="item.rows[0].template">\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class="qv-chart-tooltip-excess" ng-if="numberInExcess > 0" q-translation="Object.ChartTooltip.NMore,{{numberInExcess}}">More</div>\n</div>'}),define("extensions.qliktech/boxplot/boxplot-tooltip/boxplot-tooltip-picture-directive",["qvangular"],function(e){e.directive("qvSetInitHeight",function(){return{link:function(e,t){var n=t.find("td.qv-tp-item"),i=e.$watch(function(){return n.height()},function(e){e&&(t.find("td:eq(0)").height(e),i())})}}})}),define("extensions.qliktech/boxplot/boxplot",["qvangular","core.utils/deferred","objects.picasso/chart-view","objects.picasso/chart-builder/chart-builder","objects.picasso/derived-properties/derived-properties","extensions.qliktech/boxplot/boxplot-properties","extensions.qliktech/boxplot/boxplot-data","extensions.qliktech/boxplot/boxplot-explore-properties","objects.utils/data-properties/hypercube-handler","objects.picasso/selections/selections-handler","objects.picasso/selections/dependent-interactions","objects.picasso/tooltip/tooltips-handler","objects.picasso/scroll/scroll-handler","objects.picasso/disclaimer/disclaimer-attributes-util","objects.picasso/formatting","./boxplot-data-scroller","./boxplot-api","text!./boxplot.ng.html","client.utils/property-mapper","./boxplot-cubes-generator","util","objects.extension/object-conversion","objects.utils/chart-style-utils","core.utils/feature-flags","general.utils/object-utils/object-utils","text!./boxplot-tooltip/boxplot-tooltip-picture.ng.html","general.utils/string-util","general.utils/color-cache","extensions.qliktech/boxplot/boxplot-tooltip/boxplot-tooltip-picture-directive"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,x,q,C,S,w,_,D,M){"use strict";function A(e){return e.qUndoExclude&&(e.qUndoExclude.box.qHyperCube.qSize.qcy<=1||j(e))&&!j(e,!0)}function E(e){return x.getValue(e,"boxplotDef.qHyperCube.qDimensionInfo",[])}function I(e){return E(e).length>1}function T(e){return!e||"horizontal"===e}function L(e){return Array.isArray(e)?e:e?[e]:[]}function k(e,t){return{viewSize:t,max:x.getValue(e,"qUndoExclude.box.qHyperCube.qSize.qcy",0)}}function O(e){var t=e.boxplotDef.qHyperCube.qDimensionInfo,n=I(e)?t[1].qApprMaxGlyphCount:0;return Math.min(G,n)}function P(e){return E(e).map(function(e){return e.qGroupPos})}function N(e){return{box:e.boxplotDef}}function R(e,t,n){var i=P(e);return b.generateHyperCubes(t,i,e,n)}function F(){this.layout&&I(this.layout)&&(this._scrollHandler.onResize(),this._dataScroller.updateCacheSize())}function j(e,t){var n;if(!(n=t?e.qUndoExclude&&e.qUndoExclude.outliers&&e.qUndoExclude.outliers.qHyperCube&&e.qUndoExclude.outliers.qHyperCube.qDimensionInfo&&e.qUndoExclude.outliers.qHyperCube.qDimensionInfo.length?e.qUndoExclude.outliers.qHyperCube.qDimensionInfo:void 0:e.qUndoExclude&&e.qUndoExclude.box&&e.qUndoExclude.box.qHyperCube&&e.qUndoExclude.box.qHyperCube.qDimensionInfo&&e.qUndoExclude.box.qHyperCube.qDimensionInfo.length?e.qUndoExclude.box.qHyperCube.qDimensionInfo:void 0))return!1;var i=t?2:0;return!!n[i]&&!!n[i].qLocked}function V(e){return e.boxplotDef.elements&&e.boxplotDef.elements.outliers&&e.boxplotDef.elements.outliers.include}function H(e,t){var n={};return!I(t)||e?(n.isOpenDim=!1,n.isOpenMea=!1):(n.isOpenDim=!0,n.isOpenMea=!0),n}function B(e){var t=M.retriveColor("NaN"===e.qNum?e.qText:e.qNum,"argb");return t.isInvalid()&&(t=M.retriveColor(C.Theme.dataColors.nullColor)),t.toRGBA()}var z,$="qUndoExclude/box/qHyperCube",U="qUndoExclude/outliers/qHyperCube",G=20;return z=n.extend("BoxPlot",{namespace:".boxplot",defaultOptions:{navigation:!0,selections:!0,tooltips:!0},init:function(t,n,i,o,s,a){this._super(t,n,i,o,s,a),this._derivedProperties=new r,n.find(".picasso-chart").data("findShapes",this.chartInstance.findShapes.bind(this.chartInstance)),this.hasOption("selections")&&(this._selectionHandler=c.create({model:o.model,chartInstance:this.chartInstance,selectionsApi:s,dataPaths:[$,U]})),this.hasOption("tooltips")&&(e.getService("$templateCache").put("boxplot-tooltip-picture.ng.html",_),this._tooltipHandler=h.create(this.chartInstance,a,n)),this._scrollHandler=new d(this.chartInstance,n,n[0],this.getSlicedData.bind(this),a,this.updateChart.bind(this)),this._dataScroller=new m(o,this.getData,this._scrollHandler),this.backendApi.setCacheOptions({maxStackedValues:3e3}),this._colorCache={},this.setDataPaths([$,U])},getSlicedData:function(e,t){return this._dataScroller.getSlicedData(this.layout,e,t)},updateScrollHandlerState:function(e){void 0!==e&&(this._disableScrolling=!!e),this._scrollHandler.setDisabled(!this.hasOption("navigation")||!I(this.layout)||this._disableScrolling)},on:function(){this._super(),this.hasOption("navigation")&&this._scrollHandler.on(),this.hasOption("tooltips")&&this._tooltipHandler.on(),this.hasOption("selections")&&this._selectionHandler.on()},off:function(){this._super(),this.hasOption("navigation")&&this._scrollHandler.off(),this.hasOption("tooltips")&&this._tooltipHandler.off(),this.hasOption("selections")&&this._selectionHandler.off()},_getBoxMarkerSettings:function(e,t,n){var i=e.boxplotDef.color.auto?C.getStyle("boxPlot","box.box","fill"):C.Theme.resolveColor(e.boxplotDef.color.box.paletteColor),r=C.getContrastingGrey(i).toHex(),o=A(e)?[]:L(t.trigger);this.hasOption("tooltips")&&o.push(n.box.trigger);var s=L(t.consume),a={displayOrder:1100,settings:{whisker:{width:.5,stroke:C.getStyle("boxPlot","box.whisker","stroke"),show:e.boxplotDef.presentation.whiskers.show},box:{width:.5,maxWidthPx:30,fill:i,stroke:C.getStyle("boxPlot","box.box","stroke"),strokeWidth:1},median:{strokeWidth:1,stroke:r},minor:{scale:"measure"},line:{strokeWidth:1,stroke:C.getStyle("boxPlot","box.line","stroke")},orientation:e.orientation},brush:{trigger:o,consume:s},data:{source:$,extract:{field:"qMeasureInfo/0",props:{min:{field:"qMeasureInfo/0"},start:{field:"qMeasureInfo/1"},med:{field:"qMeasureInfo/2"},end:{field:"qMeasureInfo/3"},max:{field:"qMeasureInfo/4"},minMeasure:{field:"qMeasureInfo/0",reduce:"first",value:function(e){return e}},startMeasure:{field:"qMeasureInfo/1",reduce:"first",value:function(e){return e}},medMeasure:{field:"qMeasureInfo/2",reduce:"first",value:function(e){return e}},endMeasure:{field:"qMeasureInfo/3",reduce:"first",value:function(e){return e}},maxMeasure:{field:"qMeasureInfo/4",reduce:"first",value:function(e){return e}},tooltip:""}}}};if(I(e)&&(a.data.extract.field="qDimensionInfo/0",a.data.extract.props.elemNo={},a.data.extract.props.tooltip={field:"qDimensionInfo/0",value:function(e){return e}}),!e.boxplotDef.color.auto&&"byExpression"===e.boxplotDef.color.mode)if(0===e.qUndoExclude.box.qHyperCube.qMeasureInfo[0].qAttrExprInfo.length)a.settings.box.fill=M.retriveColor(C.Theme.dataColors.nullColor).toRGBA();else{var l=w.mapArrayToObject(e.qUndoExclude.box.qHyperCube.qMeasureInfo[0].qAttrExprInfo,"id",!0),c=l.colorByExpression&&l.colorByExpression.index;if(c>-1){var u="qMeasureInfo/0/qAttrExprInfo/"+c;a.data.extract.props.color={field:u,value:function(e){if("string"==typeof e.qText){var t=M.retriveColor(e.qText);if(!t.isInvalid())return t.toRGBA()}return"number"==typeof e.qNum?M.retriveColor(e.qNum,"argb").toRGBA():M.retriveColor(C.Theme.dataColors.nullColor).toRGBA()}},a.settings.box.fill={ref:"color"}}}return a},_clearColorCache:function(){this._colorCache={}},_updateColorCache:function(e){var t=this._colorCache,n=e.qUndoExclude.box.qHyperCube.qDataPages[0].qMatrix,i=w.mapArrayToObject(e.qUndoExclude.box.qHyperCube.qMeasureInfo[0].qAttrExprInfo,"id",!0);n.forEach(function(e){t[e[0].qElemNumber]=B(e[1].qAttrExps.qValues[i.colorByExpression.index])})},_getColorFronElemnNo:function(e){return this._colorCache[e]},_useColorCache:function(e){return!!V(e)&&(!(e.boxplotDef.color.auto||"byExpression"!==e.boxplotDef.color.mode)&&(0!==e.qUndoExclude.box.qHyperCube.qMeasureInfo[0].qAttrExprInfo.length&&!!I(e)))},_getPointMarkerSettings:function(e,t,n){var i=e.boxplotDef.color.auto?C.Theme.dataColors.primaryColor:C.Theme.resolveColor(e.boxplotDef.color.point.paletteColor),r=C.getContrastingTransparent(i),o=L(t.trigger);this.hasOption("tooltips")&&o.push(n.point.trigger);var s={displayOrder:1e3,settings:{fill:i,stroke:r,size:.2,strokeWidth:1,sizeLimits:{maxRelExtent:10,maxPx:10}},brush:{trigger:o,consume:L(t.consume)},data:{source:U,extract:{field:"qDimensionInfo/1",props:{elemNo:{field:"qDimensionInfo/1"},inner:{field:"qDimensionInfo/1"},tooltip:{field:"qDimensionInfo/1",value:function(e){return e}},measure:{field:"qMeasureInfo/0",reduce:"first",value:function(e){return e}}}}}};if(I(e)&&(s.data.extract.field="qDimensionInfo/2",s.data.extract.props.inner.field="qDimensionInfo/2",s.data.extract.props.tooltip.field="qDimensionInfo/2",s.data.extract.props.outer={field:"qDimensionInfo/1",value:function(e){return e}},A(e)&&(s.data.extract.props.elemNo.field="qDimensionInfo/2")),!e.boxplotDef.color.auto&&"byExpression"===e.boxplotDef.color.mode)if(0===e.qUndoExclude.box.qHyperCube.qMeasureInfo[0].qAttrExprInfo.length)s.settings.fill=M.retriveColor(C.Theme.dataColors.nullColor).toRGBA();else{var a=e.qUndoExclude.box.qHyperCube.qDataPages[0].qMatrix,l=this;if(this._clearColorCache(),I(e))s.settings.fill=function(){return l._getColorFronElemnNo(this.data.elemNo.value)};else{var c=w.mapArrayToObject(e.qUndoExclude.box.qHyperCube.qMeasureInfo[0].qAttrExprInfo,"id",!0);s.settings.fill=B(a[0][0].qAttrExps.qValues[c.colorByExpression.index])}}return s},_getDimAxisSettings:function(e,t){var n=this;return{brush:{trigger:A(e)?[]:L(t.trigger),consume:L(t.consume)},settings:{labels:{mode:"vertical"===e.orientation?e.dimensionAxis.label:"auto",maxGlyphCount:Math.ceil(D.stringWidthOverMWidth(O(this.layout||e))),maxLengthPx:function(){return n.picassoElement.getBoundingClientRect().height/3}}}}},createChartSettings:function(e){var t=this.options&&"rtl"===this.options.direction,n=T(e.orientation),r=I(e),o=e.boxplotDef.qHyperCube.qDimensionInfo,s=n?"x":"y",a=n?"y":"x",l=i.create({chartID:"boxPlot",layoutMode:this.getLayoutMode(e)}),c={},h={},d={};if(this.hasOption("selections")){var p=this._selectionHandler.setUp({contexts:["select"],data:["elemNo"],datasets:[$,U]});r?this.chartInstance.brush("select").addKeyAlias(U+"/qDimensionInfo/1",$+"/qDimensionInfo/0"):this.chartInstance.brush("select").removeKeyAlias(U+"/qDimensionInfo/1"),c={trigger:x.extend(!0,{},p.trigger,{data:[""]}),consume:[x.extend(!0,{},p.consume,{data:[""]})]},h={trigger:p.trigger,consume:[p.consume]},d={trigger:p.trigger,consume:[p.consume]}}var m={point:{},box:{}};this.hasOption("tooltips")&&(m.point=this._tooltipHandler.setUp({dataPath:U,data:r?["inner",a]:["inner"],contexts:["pointTip"],componentKey:"point-marker",rowResolver:function(t,n){return{value:f.formatMeasureValue(t,n),label:e.boxplotDef.qHyperCube.qMeasureInfo[0].qFallbackTitle}},direction:this.options.direction,measureRows:["measure"],labelData:r?["tooltip","outer"]:["tooltip"]}),m.box=this._tooltipHandler.setUp({template:"boxplot-tooltip-picture.ng.html",dataPath:$,data:[""],contexts:["boxTip"],componentKey:"box-marker",headerResolver:function(t){return(r?t[0]+" - ":"")+e.boxplotDef.qHyperCube.qMeasureInfo[0].qFallbackTitle},rowResolver:function(t,n){var i,r=(n.source.key+"/"+n.source.field).replace(/\//g,"."),o=x.getValue(e,r),s=w.mapArrayToObject(o.qAttrExprInfo,"id",!0).tooltip;if(s){var a=n.value.qAttrExps.qValues;i=a[s.index]?a[s.index].qText:""}else i=o.qFallbackTitle;return{value:f.formatMeasureValue(t,n),label:i}},direction:this.options.direction,measureRows:["minMeasure","startMeasure","medMeasure","endMeasure","maxMeasure"],labelData:["tooltip"],filterShapes:function(e){var t=[];if(e.length>0)for(var n=0;n<e.length;n++)if("container"===e[n].type){t.push(e[n]);break}return t}}));var g=H(j(e),e),v={scrollHandler:this.hasOption("navigation")&&this._scrollHandler,selectionHandler:this.hasOption("selections")&&this._selectionHandler},y={componentKey:A(e)&&V(e)?"point-marker":"box-marker",lassoBrushKey:"select",dimRangeBrushKey:"select",measureRangeBrushKey:null,areaBrushKey:S.BOX_MEASURE_RANGE?"select":null};this._dependentActions&&this._dependentActions.destroy(),this._dependentActions=u.create(v,this.isOn.bind(this),e.orientation,t,y,g),l.addPreset("dimension-measure-chart",{isRtl:t,includeDimensionAxis:r,orientation:e.orientation,selectionsEnabled:this.hasOption("selections"),measureSource:["qMeasureInfo/0","qMeasureInfo/1","qMeasureInfo/2","qMeasureInfo/3","qMeasureInfo/4"],dimensionSource:"qDimensionInfo/0",measureAxisProperties:e.measureAxis,measureTitleText:e.boxplotDef.qHyperCube.qMeasureInfo[0].qFallbackTitle,dimensionAxisProperties:e.dimensionAxis,dimensionAxisSettings:this._getDimAxisSettings(e,c,m),dimensionTitleText:o&&o[o.length-1]&&o[o.length-1].qFallbackTitle||"",gridlines:e.gridlines,hasNavigation:this.hasOption("navigation"),isNavigationEnabledFn:this.isOn.bind(this),scrollSettings:this.hasOption("navigation")&&k(e,this._scrollHandler.getScrollViewSizeInItem()),enableLasso:!0,lasso:{brushKey:"select",brushComponents:A(e)?["point-marker"]:["box-marker","point-marker"]},enableDimRange:!0,dimRange:{brushKey:"select",brushAxis:n?"y-axis":"x-axis",brushArea:"box-marker",brushScale:"dimension"},enableAreaRange:!!S.BOX_MEASURE_RANGE,areaRange:{brushKey:"select",brushAxis:n?"x-axis":"y-axis",brushData:["elemNo"],brushArea:"box-marker",brushScale:"measure",brushComponents:["box-marker"]},brushActions:this._dependentActions.gestures,refLines:e.refLine&&e.refLine.refLines});var b=l.getSettings(),q=this._getBoxMarkerSettings(e,h,m);if(r&&(q.settings.major={scale:"dimension"}),l.addComponent("box-marker",q),V(e)){var C=this._getPointMarkerSettings(e,d,m);b.scales.measure.data.fields.push({source:U,field:"qMeasureInfo/0"}),C.data.extract.props[s]={field:"qMeasureInfo/0"},C.settings[s]={scale:"measure"},r&&(C.data.extract.props[a]={field:"qDimensionInfo/1"},C.settings[a]={scale:"dimension"}),l.addComponent("point-marker",C)}return this.addSnapshotChartSettings(b,e),b},resize:function(e,t){this.layout&&(F.call(this),this._super(e,t))},paint:function(e){this.backendApi.isSnapshot||this.options.viewState||this.updateScrollHandlerState(!1),this._orientation||(this._orientation=this.layout.orientation),this._orientation!==this.layout.orientation&&(F.call(this),this._orientation=this.layout.orientation);var n=this.layout,i=this,r=n.qUndoExclude;if(!r)return t.resolve();this.hasOption("tooltips")&&this._tooltipHandler.closeTooltip();var o=r.box&&r.box.qHyperCube.qDataPages.length,s=!n.boxplotDef.elements.outliers.include||r.outliers&&r.outliers.qHyperCube.qStackedDataPages.length;if(o&&s){var a;if(!this.backendApi.isSnapshot&&I(n)&&this._scrollHandler.isDataSizeChanged(n.qUndoExclude.box.qHyperCube.qDataPages[0].qMatrix.length,n.qUndoExclude.box.qHyperCube.qSize.qcy)){var l=this._super;a=this._scrollHandler.getViewData().finally(function(){return l.call(i,e)})}else a=this._super(e);return a}return t.resolve()},destroy:function(){this._super(),this._dataScroller.destroy()},setSnapshotData:function(e){this._super(e);var n=t();return e.qUndoExclude.box.qHyperCube.qDataPages=this.layout.qUndoExclude.box.qHyperCube.qDataPages,e.qUndoExclude.outliers.qHyperCube.qStackedDataPages=this.layout.qUndoExclude.outliers.qHyperCube.qStackedDataPages,n.resolve(e),n.promise},getViewState:function(){return{scroll:this._scrollHandler.getScrollState()}},getDisclaimerAttributes:function(e){var t,n=this.hasOption("navigation")&&k(e,this._scrollHandler.getScrollViewSizeInItem());return t=!!(!I(e)&&e.boxplotDef.elements.outliers.include&&e.qUndoExclude.outliers.qHyperCube.qSize.qcy>1e4)||p.getLimitedDataAttribute(e&&e.qUndoExclude&&e.qUndoExclude.outliers&&e.qUndoExclude.outliers.qHyperCube,{maxNbrOfDimensions:3}),{data:e.qUndoExclude&&e.qUndoExclude.box,supportedDisclaimers:{LimitedData:!0},options:{bottom:!0,paddingBottom:n&&n.viewSize<n.max,supportNegative:!0,explicitLimitedData:t}}},updateChart:function(e,t,n){this._useColorCache(e)&&this._updateColorCache(e),this._super(e,t,n)},updateDerivedProperties:function(e,t){var n=this,i=n.backendApi.model;return n._derivedProperties.addDefaultHyperCubeHash(e.boxplotDef.qHyperCubeDef,t.boxplotDef.qHyperCube,i.app,N(e)).then(function(r){var o={layout:t,properties:e,model:i,hashData:r,generateDerivedProperties:function(e,t){return R(e,t,i.app)}};return n._derivedProperties.updateDerivedProperties(o)})},updateData:function(e){var n=this;return n._super(e).then(function(){if(e=n.layout,n._scrollHandler.setOptions({direction:"horizontal"===e.orientation?"vertical":"horizontal"}),n.backendApi.isSnapshot)return t.resolve();n.updateScrollHandlerState(),n.updateScrollHandlerState(!0),n.options.viewState?n._scrollHandler.setScrollState(n.options.viewState.scroll):n._scrollHandler.resetScroll();var i=e.qUndoExclude;if(n.backendApi.setPath("/qUndoExclude/box/qHyperCubeDef"),I(e)?n.backendApi.setPaths(["/qUndoExclude/box/qHyperCubeDef","/qUndoExclude/outliers/qHyperCubeDef"]):n.backendApi.setPaths(["/qUndoExclude/outliers/qHyperCubeDef"]),n.backendApi.updateCache(i.box),n._dataScroller.updateOutliersCache(e),I(e)){var r=n.options.viewState?n.options.viewState.scroll:n._scrollHandler.getScrollState();return n.getSlicedData(r,n._scrollHandler.getScrollViewSizeInItem())}var o=[n.getData(n.backendApi,i.box.qHyperCube,{height:1})];return e.boxplotDef.elements.outliers.include&&o.push(n.getData(n._dataScroller.getOutliersCache(),i.outliers.qHyperCube,{height:i.outliers.qHyperCube.qSize.qcy})),t.all(o)})},isLassoDisabled:function(){return!1}}),{type:"boxplot",BackendApi:g,template:v,View:z,definition:o,softDefinition:a.get("boxplotDef"),initialProperties:{boxplotDef:{sorting:{autoSort:!0},qHyperCubeDef:{qDimensions:[],qMeasures:[],qMode:"S",qAlwaysFullyExpanded:!0,qSuppressZero:!1,qSuppressMissing:!0}}},support:{cssScaling:!1,snapshot:!0,export:!0,exportData:!0,sharing:!0},options:{hyperCubePath:"boxplotDef",usingDerivedProperties:!0},data:s,importProperties:function(){var e=q.hypercube.importProperties.apply(q.hypercube.importProperties,arguments);return e.qProperty.boxplotDef.qHyperCubeDef.qDimensions.forEach(function(e){e.qOtherTotalSpec.qOtherMode="OTHER_OFF"}),e},exportProperties:q.hypercube.exportProperties,getCreatePropertyHandler:function(e){var t,n,i=this.mappedDefinition,r=this.globalChangeListeners;this.dimensionDefinition&&(t=y.mapProperties(i.items.data.items.innerData.items.dimensions)),this.measureDefinition&&(n=y.mapProperties(i.items.data.items.innerData.items.measures));var o=new l({app:e,dimensionDefinition:this.dimensionDefinition,measureDefinition:this.measureDefinition,dimensionProperties:t,measureProperties:n,globalChangeListeners:r,path:"boxplotDef"});return o.getLabels=function(){return[]},o}}}),define("extensions.qliktech/distributionplot/distributionplot-constants",[],function(){"use strict";var e={DATA_PATH:"qUndoExclude",HYPERCUBE_DEF_PATH:"qHyperCubeDef",HYPERCUBE_PATH:"qHyperCube",CHART_ID:"distributionPlot",AUTO_SORT:"sorting.autoSort",SORT_CRITERIA:"sorting.sortCriteria",SORTING_ELEMENT_ID:"sorting.elementId",SORTING_ELEMENT_MIN_ID:"distplot-exp-min",SORTING_ELEMENT_MAX_ID:"distplot-exp-max",SORTING_EXPRESSION:"sorting.expression",MAX_GLYPH_COUNT:20,MAX_STACKED_VALUES:3e3,HORIZONTAL:"horizontal",BOX_PADDING:2,POINT_BANDWIDTH_BASE_RATIO:.35,MAX_POINT_BASE_SIZE_PX:34,MIN_POINT_PIXELS:5,JITTER_PARAMETER:3};return Object.freeze(e),e}),define("extensions.qliktech/distributionplot/distributionplot-utils",["client.utils/property-resolver","extensions.qliktech/distributionplot/distributionplot-constants"],function(e,t){"use strict";function n(e){return e.qHyperCubeDef&&e.qHyperCubeDef.qDimensions.length>1||e.qHyperCube&&e.qHyperCube.qDimensionInfo&&e.qHyperCube.qDimensionInfo.length>1}return{hasMultipleDimensions:n,getOuterDimensionCardinality:function(i){var r=e.getValue(i,t.HYPERCUBE_PATH);return n(i)?r&&r.qDimensionInfo[1].qCardinal:1},isAutoSort:function(n){return e.getValue(n,t.AUTO_SORT,!1)},isSortByExpression:function(n){return 0!==e.getValue(n,t.SORT_CRITERIA+".sortByExpression",0)},isSortByNumeric:function(n){return 0!==e.getValue(n,t.SORT_CRITERIA+".sortByNumeric",0)},isSortByAscii:function(n){return 0!==e.getValue(n,t.SORT_CRITERIA+".sortByAscii",0)}}}),define("extensions.qliktech/distributionplot/distributionplot-properties-logic",["client.utils/property-resolver","objects.picasso/advanced-colorer"],function(e,t){function n(e){return!!e&&(e.coloring&&e.coloring.baseColor&&e.coloring.baseColor.color?e.coloring.baseColor:!(!e.baseColor||!e.baseColor.color)&&e.baseColor)}function i(t){return"libraryItem"===e.getValue(t,"color.point.byDimDef.type")}function r(t){return"libraryItem"===e.getValue(t,"color.point.byMeasureDef.type")}function o(t){return!0===e.getValue(t,"color.point.auto")}function s(t){return!o(t)&&"byDimension"===e.getValue(t,"color.point.mode")}function a(t){return!o(t)&&"byMeasure"===e.getValue(t,"color.point.mode")}return{measuresHasBaseColors:function(t){return e.getValue(t,"layout.qHyperCube.qMeasureInfo",[]).filter(function(e){return!!n(e)}).length>0},dimensionsHasBaseColors:function(t){return e.getValue(t,"layout.qHyperCube.qDimensionInfo",[]).filter(function(e){return!!n(e)}).length>0},onGlobalChangeColors:function(e){t.updateColorDef(e,"qHyperCubeDef.",e.color.point)},isColorByDimension:s,isColorByMeasure:a,isColorAuto:o,isColorByExpression:function(t){return!o(t)&&"byExpression"===e.getValue(t,"color.point.mode")},isColorBySingle:function(t){return!o(t)&&"primary"===e.getValue(t,"color.point.mode","primary")},isDimensionLibraryItem:i,isMeasureLibraryItem:r,showLegend:function(t){var n=e.getValue(t,"color.point.mode","primary");return"primary"!==n&&"byExpression"!==n&&!1===o(t)},showColorByLabel:function(t){var n=s(t)&&!1===i(t),o=a(t)&&!1===r(t),l=e.getValue(t,"color.point.byDimDef.activeDimensionIndex")>-1;return n&&!l||o}}}),define("extensions.qliktech/distributionplot/sorting/distributionplot-sorting-settings",["util","objects.picasso/sorting/base-derived/sorter-base-sorting-settings"],function(e,t){"use strict";return e.extend(!0,{DIST_MAX:{ELEMENT:"distplot-exp-max",SORT_BY_EXPRESSION:-1,SORT_BY_ASCII:void 0,SORT_BY_NUMERIC:void 0,SORT_BY_LOAD_ORDER:1}},t)}),define("extensions.qliktech/distributionplot/sorting/distributionplot-sorting-settings-retriever",["util","extensions.qliktech/distributionplot/sorting/distributionplot-sorting-settings"],function(e,t){"use strict";return{getSettings:function(n){return e.getValue(n,"qHyperCube.qDimensionInfo.1.qCardinal",1)>10?t.DIST_MAX:t.ASCII}}}),define("extensions.qliktech/distributionplot/sorting/distributionplot-sorting-elements-retriever",["translator","extensions.qliktech/distributionplot/distributionplot-constants","objects.picasso/expression-generator/expression-wrapper"],function(e,t,n){"use strict";function i(e,t,i,r){var o="Fractile";0===e?o="Min":1===e&&(o="Max");var s=t?n.wrapExpression(t):"",a=i?n.wrapExpression(i):"";return(o+"( total {{<outerDimString>}} Aggr( {{innerMeasureString}}, {{outerDimString,}} {{innerDimString}} ), "+e+" )").replace(/{{innerDimString}}/g,s).replace(/{{outerDimString}}/g,a).replace(/{{<outerDimString>}}/g,i?"<"+a+">":"").replace(/{{outerDimString,}}/g,i?a+",":"").replace(/{{innerMeasureString}}/g,(r||"").replace(/^=/,""))}return{getElementIds:function(){return[t.SORTING_ELEMENT_MIN_ID,t.SORTING_ELEMENT_MAX_ID]},getElements:function(n,r,o){var s=r[0],a=r[1],l=n[0],c=i(0,s,a,l),u=i(1,s,a,l);return[{id:t.SORTING_ELEMENT_MIN_ID,label:e.get("properties.distributionPlot.min"),exp:c,isDefault:t.SORTING_ELEMENT_MIN_ID===o.ELEMENT},{id:t.SORTING_ELEMENT_MAX_ID,label:e.get("properties.distributionPlot.max"),exp:u,isDefault:t.SORTING_ELEMENT_MAX_ID===o.ELEMENT}]}}}),define("objects.picasso/expression-generator/expression-replacer",[],function(){"use strict";function e(e,n,i){var r=t(e),o=i?"("+r+")":r;return n?new RegExp(o,"g"):new RegExp(o)}function t(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}return{replaceExpressionTokens:function(t,n,i){var r,o,s={start:i&&i.start||"{{",end:i&&i.end||"}}"},a=t;for(var l in n)r=n[l],o=s.start+l+s.end,a=a.replace(e(o,!0),r);return a},createRegExp:e}}),define("objects.picasso/expression-generator/expression-generator",["objects.picasso/expression-generator/expression-wrapper","objects.picasso/expression-generator/expression-replacer"],function(e,t){"use strict";function n(e,n,i){if(""===n)return"";var r=t.createRegExp(i,!0,!0),o="";return e.split(r).forEach(function(e){o+=e!==i?e:n}),o}return{generateExpression:function(i,r){var o,s,a={};if(r)for(var l in r){var c=r[l];o=c.wrap?e.wrapExpression(c.value):c.value,a[l]=o,(c.variations||[]).forEach(function(e){s=n(e,o,l),a[e]=s})}return t.replaceExpressionTokens(i,a)}}}),define("objects.picasso/hypercube-def-generator/hypercube-def-generator",["util","objects.picasso/expression-generator/expression-generator","core.utils/deferred"],function(e,t,n){"use strict";function i(e,t,i,r){if(e.qLibraryId)return o(e.qLibraryId,"dimension",t,i,r);var s=r.qDimensionInfo[i].qGroupPos;return n.resolve(e.qDef.qFieldDefs[s])}function r(e,t){return e.qLibraryId?o(e.qLibraryId,"measure",t):n.resolve(e.qDef.qDef)}function o(e,t,n,i,r){return n?n["dimension"===t?"getDimension":"getMeasure"](e).then(function(e){return e.getProperties().then(function(e){return"dimension"===t?e.qDim.qFieldDefs[r.qDimensionInfo[i].qGroupPos]:e.qMeasure.qDef})}):(console.warn("No app provided, returning library id"),e)}function s(e,t,o,s){var c,u,h={},d=[];e.forEach(function(e){(c=l(e.match(a("Dim")))).forEach(function(e){d.push(i(t.qDimensions[e],s,e,o).then(function(t){h["Dim["+e+"]"]={value:t,wrap:!0}}))}),(u=l(e.match(a("Mea")))).forEach(function(e){d.push(r(t.qMeasures[e],s).then(function(t){h["Mea["+e+"]"]={value:t}}))})});return d.length?n.all(d).then(function(){return n.resolve(h)}):n.resolve(h)}function a(e){return new RegExp("\\{\\{"+e+"\\[\\d\\]\\}\\}","g")}function l(e){return e?e.map(function(e){return e.substr(6,1)}):[]}return{generateHyperCubeDef:function(n,i,r,o,a){return s(n.dimensions.concat(n.measures),i,r,o).then(function(r){var o=e.extend({},r,a),s=e.extend(!0,{},i);return s.qDimensions=[],s.qMeasures=[],n.dimensions.forEach(function(e){s.qDimensions.push({qDef:{qFieldDefs:["="+t.generateExpression(e,o)]}})}),n.measures.forEach(function(e){s.qMeasures.push({qDef:{qDef:t.generateExpression(e,o)}})}),s})},getAllHyperCubeExpressions:function(e,t,o){var s=e.qDimensions.map(function(e,n){return i(e,o,n,t)}),a=e.qMeasures.map(function(e){return r(e,o)});return n.all({dimensions:n.all(s),measures:n.all(a)})}}}),define("extensions.qliktech/distributionplot/sorting/distributionplot-sorter",["extensions.qliktech/distributionplot/sorting/distributionplot-sorting-settings-retriever","extensions.qliktech/distributionplot/sorting/distributionplot-sorting-elements-retriever","objects.picasso/sorting/base-derived/sorter-factory","objects.picasso/sorting/base-derived/sorter-facade","objects.picasso/hypercube-def-generator/hypercube-def-generator"],function(e,t,n,i,r){"use strict";function o(e){var t=e.qHyperCubeDef;t?t.qDimensions?t.qMeasures?!t.qDimensions.length||t.qDimensions.length<2?s("'qHyperCubeDef.qDimensions' has no outer dimension"):e.sorting&&e.sorting instanceof Object||s("'properties.sorting' is not an object"):s("no 'qHyperCubeDef.qMeasures' in properties arg"):s("no 'qHyperCubeDef.qDimensions' in properties arg"):s("no 'qHyperCubeDef' in properties arg")}function s(e){throw new Error("distributionplot-sorter.applySorting: "+e)}return{applySorting:function(s,a,l){return o(s),r.getAllHyperCubeExpressions(s.qHyperCubeDef,a.qHyperCube,l).then(function(r){if(s.qUndoExclude){var o=s.qUndoExclude.qHyperCubeDef.qDimensions;o.length>=2?s.qUndoExclude.qHyperCubeDef.qInterColumnSortOrder=[0,2,1]:s.qUndoExclude.qHyperCubeDef.qInterColumnSortOrder=[1,0];var l=function(){return e.getSettings(a)},c=n.create(l,function(){var e=l();return t.getElements(r.measures,r.dimensions,e)}),u=o[0],h=s.sorting;i.applySorting(c,u,h)}})}}}),define("extensions.qliktech/distributionplot/sorting/distributionplot-expression-sort-orderer",["client.utils/property-resolver","extensions.qliktech/distributionplot/distributionplot-constants"],function(e,t){"use strict";var n=t.SORT_CRITERIA+".sortByExpression";return{updateSortOrder:function(i,r){if(r){var o=e.getValue(i,n);if(-1===o||1===o){var s=e.getValue(i,t.SORTING_ELEMENT_ID),a=e.getValue(r,t.SORTING_ELEMENT_ID),l=!!a,c=s===t.SORTING_ELEMENT_MIN_ID,u=s===t.SORTING_ELEMENT_MAX_ID,h=a===t.SORTING_ELEMENT_MIN_ID,d=a===t.SORTING_ELEMENT_MAX_ID,p=c&&d,f=u&&(!l||h),m=e.getValue(r,n),g=-1===m||1===m,v=1===o,y=u&&!g&&v;p?e.setValue(i,n,1):(f||y)&&e.setValue(i,n,-1)}}}}}),define("extensions.qliktech/distributionplot/distributionplot-properties",["core.utils/feature-flags","objects.utils/chart-style-utils","client.utils/property-resolver","client.property-panel/definition-builder/sort-order/sort-order","extensions.qliktech/distributionplot/distributionplot-utils","extensions.qliktech/distributionplot/distributionplot-properties-logic","client.utils/default-property-logic","extensions.qliktech/distributionplot/sorting/distributionplot-sorter","extensions.qliktech/distributionplot/sorting/distributionplot-sorting-settings-retriever","extensions.qliktech/distributionplot/sorting/distributionplot-sorting-elements-retriever","extensions.qliktech/distributionplot/sorting/distributionplot-expression-sort-orderer","extensions.qliktech/distributionplot/distributionplot-constants","objects.picasso/hypercube-def-generator/hypercube-def-generator","client.utils/property-hypercube-helper"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p){"use strict";function f(e){return!n.getValue(e,"color.point.auto")&&"byDimension"===n.getValue(e,"color.point.mode")&&p.getNumMeasures(e)<=1}var m=s.getLogicFor("hard","distributionplot"),g={translation:"properties.colors",type:"items",items:{colors:{type:"items",items:{pointColor:{type:"items",translation:"properties.colorsAndLegend",grouped:!0,items:{colors:{type:"items",items:{autoColor:{ref:"color.point.auto",type:"boolean",translation:"properties.colors",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},colorMode:{ref:"color.point.mode",type:"string",component:"dropdown",options:function(){return[{value:"primary",translation:"properties.colorMode.primary"},{value:"byExpression",translation:"properties.colorMode.byExpression"}]},defaultValue:"primary",show:function(e){return!n.getValue(e,"color.point.auto",!0)}},boxColor:{ref:"color.box.paletteColor",translation:"properties.distributionPlot.boxColor",type:"object",component:"color-picker",dualOutput:!0,defaultValue:function(){var e=t.getStyle(h.CHART_ID,"box","fill");return{index:t.Theme.currentPalette.indexOf(e),color:e}}},paletteColor:{ref:"color.point.paletteColor",translation:"properties.distributionPlot.pointColor",type:"object",component:"color-picker",dualOutput:!0,show:function(e){return!n.getValue(e,"color.point.auto",!0)&&"primary"===n.getValue(e,"color.point.mode","primary")},defaultValue:function(){var e=t.Theme.dataColors.primaryColor;return{index:t.Theme.currentPalette.indexOf(e),color:e}}},attributeExpression:{type:"string",component:"expression",expressionType:"measure",schemaIgnore:!0,ref:"color.point.expression.qValueExpression.qExpr",translation:"Common.Expression",show:function(e){return!n.getValue(e,"color.point.auto")&&"byExpression"===n.getValue(e,"color.point.mode")}},expressionIsColor:{ref:"color.point.expressionIsColor",translation:"properties.expressionIsColor",type:"boolean",defaultValue:!0,show:!1}}}}}}}}},v={type:"items",translation:"properties.presentation",items:{orientation:{ref:"orientation",type:"string",component:"item-selection-list",defaultValue:"horizontal",horizontal:!0,items:[{component:"icon-item",icon:"",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}]},showDistBackground:{ref:"presentation.visibleComponents",translation:"properties.show",type:"string",component:"dropdown",defaultValue:"points_box",options:[{value:"points_box",translation:"properties.distributionPlot.pointsAndBox"},{value:"points",translation:"properties.distributionPlot.pointsOnly"},{value:"box",translation:"properties.distributionPlot.boxOnly"}]},gridLines:{type:"items",snapshot:{tid:"property-gridLines"},items:{showGridLines:{ref:"gridlines.auto",type:"boolean",translation:"properties.gridLine.spacing",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},gridSpacing:{ref:"gridlines.spacing",type:"number",component:"dropdown",defaultValue:2,options:[{value:0,translation:"properties.gridLine.noLines"},{value:2,translation:"properties.gridLine.medium"},{value:3,translation:"properties.gridLine.narrow"}],show:function(e){return e.gridlines&&!e.gridlines.auto}}}}}};e.BUBBLE_DIST&&(v.items.bubbleScaleItems={type:"items",items:{bubbleScales:{type:"integer",component:"slider",ref:"dataPoint.bubbleScales",translation:"properties.dataPoints.bubbleSizes",min:20,max:100,step:5,defaultValue:100,show:function(e){return e.qHyperCubeDef.qMeasures.length<2&&"box"!==e.presentation.visibleComponents}}}}),e.DIST_JITTER&&(v.items.jitter={type:"string",component:"switch",ref:"dataPoint.displacement",translation:"properties.distributionPlot.jitter",defaultValue:"none",options:[{value:"none",translation:"properties.off"},{value:"jitter",translation:"properties.on"}],show:function(e){return"box"!==e.presentation.visibleComponents}});var y,b={uses:"axis.picasso.measureAxis"},x={uses:"axis.picasso.dimensionAxis",show:function(e,t,i){return n.getValue(i.layout,h.HYPERCUBE_PATH+".qDimensionInfo.length")>1}};(e.COLOR_BY_DIM||e.COLOR_BY_MEA)&&(y={uses:"colorsAndLegend",items:{colors:{globalChange:o.onGlobalChangeColors,items:{autoColor:{ref:"color.point.auto",undefinedValue:!1},colorMode:{ref:"color.point.mode",options:m.color.colorMode.options,show:function(e){return!o.isColorAuto(e)},globalChange:function(){}},colorByDimension:{ref:"color.point.byDimDef",show:function(e){return o.isColorByDimension(e)},change:function(e){e.color.point.altLabel=n.getValue(e,"color.point.byDimDef.label","")}},colorByMeasure:{ref:"color.point.byMeasureDef",show:function(e){return o.isColorByMeasure(e)},change:function(e){e.color.point.altLabel=n.getValue(e,"color.point.byMeasureDef.label","")}},colorByLabel:{ref:"color.point.altLabel",show:o.showColorByLabel,change:function(e){var t=n.getValue(e,"color.point.mode"),i=n.getValue(e,"color.point.altLabel","");switch(t){case"byMeasure":e.color.point.byMeasureDef.label=i;break;case"byDimension":e.color.point.byDimDef.label=i}}},baseColors:{type:"items",items:{useBaseColor:{ref:"color.point.useBaseColors",show:function(e,t){var i=n.getValue(e,"color.point.mode","primary");return!o.isColorAuto(e)&&"primary"===i&&(o.measuresHasBaseColors(t)||o.dimensionsHasBaseColors(t))},options:function(e,t){var n=[{value:"off",translation:"Common.None"}];return m.color.baseColor.hasMeasureColor(t)&&n.push({value:"measure",translation:"Common.Measure"}),m.color.baseColor.hasDimensionColor(t)&&"byMultiple"!==e.color.mode&&n.push({value:"dimension",translation:"Common.Dimension"}),n}},measureColor:{translation:"properties.libraryColors",component:"measure-color",show:function(e,t){return!n.getValue(e,"color.point.auto")&&"byMultiple"===n.getValue(e,"color.point.mode")&&"measure"===n.getValue(e,"color.point.useBaseColors")&&t.layout.qHyperCube.qMeasureInfo.length>1&&o.measuresHasBaseColors(t)}}}},paletteColor:{ref:"color.point.paletteColor",translation:"properties.distributionPlot.pointColor",show:function(e,t){var i="measure"===n.getValue(e,"color.point.useBaseColors")&&o.measuresHasBaseColors(t),r="dimension"===n.getValue(e,"color.point.useBaseColors")&&o.dimensionsHasBaseColors(t);return o.isColorBySingle(e)&&!i&&!r}},useDimColVal:{ref:"color.point.useDimColVal",show:function(e){return o.isColorByDimension(e)&&o.isDimensionLibraryItem(e)}},useMeasureGradient:{ref:"color.point.useMeasureGradient",translation:"properties.libraryColors",type:"boolean",component:"switch",schemaIgnore:!0,defaultValue:!1,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],show:function(t){var i=n.getValue(t,"color.point.auto"),r=n.getValue(t,"color.point.mode");return e.MES_COL&&!i&&"byMeasure"===r&&"libraryItem"===n.getValue(t,"color.point.byMeasureDef.type")}},persistentColors:{ref:"color.point.persistent",show:function(e){return n.getValue(e,"color.point.auto")||"byDimension"!==n.getValue(e,"color.point.mode")||"libraryItem"!==n.getValue(e,"color.point.byDimDef.type")?f(e):f(e)&&!n.getValue(e,"color.point.useDimColVal")}},colorSchemeMeasure:{ref:"color.point.measureScheme",show:function(e){return!o.isColorAuto(e)&&o.isColorByMeasure(e)}},reverseScheme:{ref:"color.point.reverseScheme",change:function(e){e.color.reverseScheme=e.color.point.reverseScheme},show:function(e){return!o.isColorAuto(e)&&o.isColorByMeasure(e)}},colorSchemeDimension:{ref:"color.point.dimensionScheme",show:function(e){return o.isColorByDimension(e)&&(!o.isDimensionLibraryItem(e)||!n.getValue(e,"color.point.useDimColVal"))}},customRange:{show:function(e){return!o.isColorAuto(e)},items:{autoMinMax:{ref:"color.point.autoMinMax",show:function(e){return o.isColorByMeasure(e)}},min:{ref:"color.point.measureMin",show:function(e){return o.isColorByMeasure(e)&&!1===n.getValue(e,"color.point.autoMinMax")},invalid:function(e){return"minMax"===n.getValue(e,"color.point.minMax")&&n.getValue(e,"color.point.measureMin")>=n.getValue(e,"color.point.measureMax")}},max:{ref:"color.point.measureMax",show:function(e){return o.isColorByMeasure(e)&&!1===n.getValue(e,"color.point.autoMinMax")},invalid:function(e){return"minMax"===n.getValue(e,"color.point.minMax")&&n.getValue(e,"color.point.measureMin")>=n.getValue(e,"color.point.measureMax")}}}},attributeExpression:{ref:"color.point.expression.qValueExpression.qExpr",show:function(e){return o.isColorByExpression(e)}},expressionIsColor:{ref:"color.point.expressionIsColor",show:!1},boxColor:{ref:"color.box.paletteColor",translation:"properties.distributionPlot.boxColor",type:"object",component:"color-picker",dualOutput:!0,defaultValue:function(){var e=t.getStyle(h.CHART_ID,"box","fill");return{index:t.Theme.currentPalette.indexOf(e),color:e}},show:function(e){return!n.getValue(e,"color.point.auto",!0)}}}},legend:{show:o.showLegend,type:"items",items:{show:{snapshot:{tid:"property-legend"}},dock:{show:function(e){return o.showLegend(e)&&n.getValue(e,"legend.show",!0)}},showTitle:{show:function(e){return o.showLegend(e)&&n.getValue(e,"legend.show",!0)}}}}}});var q={uses:"settings",items:{presentation:v,colors:y||g,measureAxis:b,dimensionAxis:x}},C={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{calcCond:{uses:"calcCond"}}},refLines:{uses:"reflines"}}},S=i.expression(h.SORT_CRITERIA+".sortByExpression"),w={type:"items",items:{expressionToggled:S.items.expressionToggled,sortByElement:{component:"sort-by-element",expressionRef:h.SORTING_EXPRESSION,elementRef:h.SORTING_ELEMENT_ID,show:r.isSortByExpression,elements:function(e){return d.getAllHyperCubeExpressions(e.properties.qHyperCubeDef,e.layout.qHyperCube,e.model.app).then(function(t){var n=l.getSettings(e.layout);return c.getElements(t.measures,t.dimensions,n)})}},expressionOrder:S.items.expressionOrder}},_={type:"items",translation:"properties.sorting",schemaIgnore:!0,grouped:!1,globalChange:function(e,t,n){n&&u.updateSortOrder(e,n.prevProperties)},items:{autoSort:{ref:h.AUTO_SORT,type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],show:r.hasMultipleDimensions,change:function(e,t,n,i){if(n&&r.hasMultipleDimensions(n)&&i.layout)return a.applySorting(n,i.layout,i.model.app)}},sortingItems:{type:"items",grouped:!0,show:function(e){return r.hasMultipleDimensions(e)&&!r.isAutoSort(e)},items:{expression:w,numeric:i.numeric(h.SORT_CRITERIA+".sortByNumeric"),ascii:i.ascii(h.SORT_CRITERIA+".sortByAscii"),defaultSortMessage:{component:"text",translation:"properties.sorting.defaultSortingMessage",show:function(e){return!r.isSortByExpression(e)&&!r.isSortByNumeric(e)&&!r.isSortByAscii(e)}}}},noData:{component:"no-data",show:function(e){return!r.hasMultipleDimensions(e)}}}},D={uses:D,translation:"Common.Data",type:"items",items:{innerData:{uses:"data",grouped:!0,items:{dimensions:{uses:"dimensions"},measures:{uses:"measures"}}}}};return{type:"items",component:"accordion",items:{data:D,sorting:_,addons:C,settings:q}}}),define("extensions.qliktech/distributionplot/distributionplot-data",[],function(){function e(e,t){2===t.qHyperCubeDef.qInterColumnSortOrder.length?t.qHyperCubeDef.qInterColumnSortOrder=[1,0]:3===t.qHyperCubeDef.qInterColumnSortOrder.length&&(t.qHyperCubeDef.qInterColumnSortOrder=[1,2,0])}function t(e,t){t.getDimensions().length>1&&e.color&&(e.color.point.persistent=!0)}return{measures:{min:1,max:1,description:function(e){return"horizontal"===e.orientation?"X-axis":"Y-axis"},add:function(){},move:function(){},remove:function(){}},dimensions:{min:1,max:2,description:function(e,t){return 0===t?"Points":"horizontal"===e.orientation?"Y-axis":"X-axis"},add:function(n,i,r){e(0,i),t(i,r)},move:function(n,i,r){e(0,i),t(i,r)},remove:function(n,i,r){e(0,i),t(i,r)}}}}),define("extensions.qliktech/distributionplot/distributionplot-explore-properties",["objects.picasso/sorting/base-derived/explore-properties-sorting-definition-builder","extensions.qliktech/distributionplot/sorting/distributionplot-sorting-settings-retriever","extensions.qliktech/distributionplot/sorting/distributionplot-sorting-elements-retriever","core.utils/feature-flags","client.utils/default-property-logic","util","extensions.qliktech/distributionplot/distributionplot-properties-logic"],function(e,t,n,i,r,o,s){var a=r.getLogicFor("explore","distributionplot"),l={type:"items",component:"accordion",items:{data:{uses:"data"},sorting:e.buildDefinition("qHyperCubeDef","sorting","qUndoExclude.qHyperCubeDef.qDimensions.0",t.getSettings,n.getElementIds),presentation:{uses:"presentation",items:{orientation:{ref:"orientation",type:"string",component:"item-selection-list",horizontal:!0,items:[{component:"icon-item",icon:"",labelPlacement:"bottom",translation:"properties.orientation.vertical",value:"vertical"},{icon:"",component:"icon-item",labelPlacement:"bottom",translation:"Common.Horizontal",value:"horizontal"}]},bubbleScales:{type:"integer",component:"slider",ref:"dataPoint.bubbleScales",translation:"properties.dataPoints.bubbleSizes",min:20,max:100,step:5,defaultValue:100,show:function(e){return e.qHyperCubeDef.qMeasures.length<2&&"box"!==e.presentation.visibleComponents&&i.BUBBLE_DIST}},jitter:{type:"string",component:"switch",ref:"dataPoint.displacement",translation:"properties.distributionPlot.jitter",defaultValue:"none",options:[{value:"none",translation:"properties.off"},{value:"jitter",translation:"properties.on"}],show:function(e){return"box"!==e.presentation.visibleComponents&&i.DIST_JITTER}}}}}};if(i.COLOR_BY_DIM||i.COLOR_BY_MEA){var c={items:{color:{uses:"color",items:{mode:{options:a.color.colorMode.options,diffs:["color.point.mode","color.point.auto"],setPropertyValue:function(e,t){"auto"===t?e.color.point.auto=!0:(e.color.point.auto=!1,e.color.point.mode=t)},getValue:function(e){return s.isColorAuto(e)?"auto":e.color.point.mode}},dimension:{show:function(e){return s.isColorByDimension(e)},items:{colorScheme:{ref:"color.point.dimensionScheme"},persistentColors:{ref:"color.point.persistent"}}},measure:{show:function(e){return s.isColorByMeasure(e)},items:{sequential:{ref:"color.point.measureScheme"}}},legend:{show:s.showLegend}}}}};o.extend(!0,l,c)}return l}),define("extensions.qliktech/distributionplot/distributionplot-color-by",["util"],function(e){function t(e,t,n){for(var i=0;i<n.length;++i){var r=n[i];void 0!==e[r]&&(t[r]=e[r],delete e[r])}}var n=["altLabel","auto","autoMinMax","byDimDef","byMeasureDef","dimensionScheme","expressionIsColor","expressionLabel","measureMax","measureMin","measureScheme","mode","paletteColor","persistent","reverseScheme","useBaseColors","useDimColVal"];return{importColors:function(e){e.color.point=e.color.point||{},t(e.color,e.color.point,n),e.color.colorExpression&&(e.color.point.expression={qValueExpression:{qExpr:e.color.colorExpression}},delete e.color.colorExpression),e.color.point.expressionIsColor=!0},exportColors:function(i){t(i.color.point,i.color,n),i.color.colorExpression=e.getValue(i,"color.point.expression.qValueExpression.qExpr",""),delete i.color.point.expression}}}),define("extensions.qliktech/distributionplot/distributionplot-column-order-adapter",[],function(){return{toBefore:function(e){var t=e.qUndoExclude.qHyperCube;2===t.qEffectiveInterColumnSortOrder.length&&0===t.qEffectiveInterColumnSortOrder[0]&&(t.qEffectiveInterColumnSortOrder=[1,0],t.qDimensionInfo.reverse())},toAfter:function(e){var t=e.qUndoExclude.qHyperCube;2===t.qEffectiveInterColumnSortOrder.length&&1===t.qEffectiveInterColumnSortOrder[0]&&(t.qEffectiveInterColumnSortOrder=[0,1],t.qDimensionInfo.reverse())}}}),define("extensions.qliktech/distributionplot/distributionplot-cube-generator",["core.utils/deferred","extensions.qliktech/distributionplot/distributionplot-utils","extensions.qliktech/distributionplot/sorting/distributionplot-sorter","util","general.utils/attribute-expression-util","objects.picasso/advanced-colorer"],function(e,t,n,i,r,o){"use strict";return{generateHyperCube:function(s,a,l){a.qUndoExclude||(a.qUndoExclude={}),a.qUndoExclude.qHyperCubeDef=i.extend(!0,{},a.qHyperCubeDef),a.qUndoExclude.qHyperCubeDef.qDimensions.reverse(),o.updateHypercubeAttributes(a,"qUndoExclude.qHyperCubeDef.",a.color.point);var c=[],u=a.qUndoExclude.qHyperCubeDef.qDimensions.length,h=a.color.point&&!a.color.point.auto&&"byExpression"===a.color.point.mode;return u>0&&h&&(c=[{qExpression:i.getValue(a,"color.point.expression.qValueExpression.qExpr"),id:r.IDMAP.COLOR_BY_EXPRESSION}]),a.qUndoExclude.qHyperCubeDef.qMeasures[0].qAttributeExpressions=c,t.hasMultipleDimensions(a)?n.applySorting(a,s,l):(a.qUndoExclude.qHyperCubeDef.qInterColumnSortOrder=[1,0],e.resolve())}}}),define("objects.backend-api/cached-stacked-api",["./stacked-api","objects.utils/hypercube-util"],function(e,t){"use strict";return e.extend("CachedStackedApi",{init:function(e){this._super(e,{mode:"K"}),this.cacheCube.setMethodName("getHyperCubeStackData")},updateCache:function(e){var n;if("qHyperCube"===this.dataPath)n=e&&e.qHyperCube;else{var i=this.dataPath.slice(0,this.dataPath.indexOf("qHyperCube")-1);n=e&&e[i]&&e[i].qHyperCube}n&&"K"===n.qMode?(e.qSelectionInfo.qInSelections||this.cacheCube.setCubeSize({qcx:n.qSize.qcx,qcy:t.getStackedCubeSizeOfMax2Dims(e,i)}),this.backendStackThrottle.clear()):this._super(e)},getData:function(e,t,n){var i=n||this.model.layout.qHyperCube,r=this.cacheCube;return"K"===i.qMode?t?this.model.getHyperCubeData(t,e):this.cacheCube.getData(e).then(function(e){return e[0]&&e[0].qData[0]&&e[0].qData[0].qSubNodes.some(function(e){return e.qDown>0})&&r.cube.clear(),e}):this._super(e,t,n)}})}),define("text!extensions.qliktech/distributionplot/distributionplot.ng.html",[],function(){return'<div class="picasso-chart qv-viz"></div>'}),define("objects.utils/jitter",["util"],function(e){var t=function(){this._maxJitter=1};return t.prototype.calcMaxJitter=function(e,t,n){this._maxJitter=Math.min(e*t,n-e)},t.prototype.getJitterValue=function(t){var n=Math.abs(e.hashFromString(t+"")%10)/9;return this._maxJitter/2-n*this._maxJitter},t}),define("extensions.qliktech/distributionplot/distributionplot",["core.utils/deferred","core.utils/feature-flags","objects.picasso/chart-view","objects.picasso/chart-builder/chart-builder","objects.picasso/derived-properties/derived-properties","extensions.qliktech/distributionplot/distributionplot-properties","extensions.qliktech/distributionplot/distributionplot-properties-logic","extensions.qliktech/distributionplot/distributionplot-data","extensions.qliktech/distributionplot/distributionplot-explore-properties","extensions.qliktech/distributionplot/distributionplot-color-by","extensions.qliktech/distributionplot/distributionplot-column-order-adapter","extensions.qliktech/distributionplot/distributionplot-constants","extensions.qliktech/distributionplot/distributionplot-cube-generator","objects.utils/data-properties/hypercube-handler","objects.backend-api/cached-stacked-api","objects.picasso/selections/selections-handler","objects.picasso/selections/dependent-interactions","objects.picasso/tooltip/tooltips-handler","objects.picasso/scroll/scroll-handler","objects.picasso/legend/legend-utils","util","objects.utils/hypercube-util","text!./distributionplot.ng.html","client.utils/property-mapper","objects.extension/object-conversion","objects.utils/chart-style-utils","general.utils/string-util","general.utils/color-cache","objects.views/charts/representation/dimension-color-util","objects.views/charts/chart-data-helper","objects.utils/jitter"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,x,q,C,S,w,_,D,M,A,E,I){"use strict";function T(e){return{cube:e[z],sorting:e.sorting,color:{point:e.color.point}}}function L(e){return Array.isArray(e)?e:e?[e]:[]}function k(e,t){return{viewSize:t,max:Math.min(q.getOuterDimensionSizeOfMax2Dims(e,H),h.MAX_STACKED_VALUES)}}function O(e){var t=e[H][B].qDimensionInfo,n=q.hasSecondDimension(e,H)?t[0].qApprMaxGlyphCount:0;return Math.min(h.MAX_GLYPH_COUNT,n)}function P(){this.backendApi.setCacheOptions({height:3*this._scrollHandler.getScrollViewSizeInItem(),width:3})}function N(){this.layout&&q.hasSecondDimension(this.layout,H)&&(this._scrollHandler.onResize(),this.backendApi&&!this.backendApi.isSnapshot&&P.call(this))}function R(e){var t=[],n=e.qUndoExclude&&e.qUndoExclude.qHyperCube&&e.qUndoExclude.qHyperCube.qDimensionInfo?e.qUndoExclude.qHyperCube.qDimensionInfo:void 0;if(!n)return!1;for(var i=0;i<n.length;i++)n[i].qLocked?t.push(n[i].qLocked):t.push(!1);return t}function F(e){var t={};return 1===e.length?(t.isOpenDim=!1,e[0]?t.isOpenMea=!1:t.isOpenMea=!0):e[0]&&!e[1]?(t.isOpenDim=!1,t.isOpenMea=!0):!e[0]&&e[1]?(t.isOpenDim=!0,t.isOpenMea=!1):e[0]&&e[1]?(t.isOpenDim=!1,t.isOpenMea=!1):(t.isOpenDim=!0,t.isOpenMea=!0),t}function j(e){return e.dataPoint&&e.dataPoint.bubbleScales&&t.BUBBLE_DIST}function V(){var e=this.chartInstance.component("legend");e&&e.emit&&e.emit("resetindex")}var H=h.DATA_PATH,B=h.HYPERCUBE_PATH,z=h.HYPERCUBE_DEF_PATH;return{type:"distributionPlot",BackendApi:f,template:C,View:n.extend("DistributionPlot",{namespace:".distributionPlot",defaultOptions:{navigation:!0,selections:!0,tooltips:!0},init:function(e,n,i,s,a,l){this._super(e,n,i,s,a),n.find(".picasso-chart").data("findShapes",this.chartInstance.findShapes.bind(this.chartInstance)),this._derivedProperties=new r,this.hasOption("selections")&&(this._selectionHandler=m.create({model:s.model,chartInstance:this.chartInstance,selectionsApi:a})),this.hasOption("tooltips")&&(this._tooltipHandler=v.create(this.chartInstance,l,n)),this._scrollHandler=new y(this.chartInstance,n,n[0],this.getSlicedData.bind(this),l,this.onScrollCallback.bind(this),"legend"),this.backendApi.setPath("/"+H+"/"+z),this.backendApi.setCacheOptions({maxStackedValues:h.MAX_STACKED_VALUES}),t.BUBBLE_DIST&&(this._maxBubbleScale=o.items.settings.items.presentation.items.bubbleScaleItems.items.bubbleScales.max),this._jitterTool=new I,this.setDataPaths([H+"/"+B])},onScrollCallback:function(e,t,n){var i=this;this._updateColorMapData(e).then(function(){i.updateChart(e,t,n)})},getSlicedData:function(e,t){var n=this;return this.getData(this.backendApi,this.layout[H][B],{top:e,height:t}).then(function(){return n.layout})},updateScrollHandlerState:function(e){void 0!==e&&(this._disableScrolling=!!e),this._scrollHandler.setDisabled(!this.hasOption("navigation")||!q.hasSecondDimension(this.layout,H)||this._disableScrolling)},on:function(){this._super(),this.hasOption("tooltips")&&this._tooltipHandler.on(),this.hasOption("selections")&&this._selectionHandler.on(),this.hasOption("navigation")&&this._scrollHandler.on()},off:function(){this._super(),this.hasOption("tooltips")&&this._tooltipHandler.off(),this.hasOption("selections")&&this._selectionHandler.off(),this.hasOption("navigation")&&this._scrollHandler.off()},_getPointScale:function(){return j(this.layout)?this.layout.dataPoint.bubbleScales/this._maxBubbleScale:1},_calcBandwidth:function(e,t){var n=t.scales().dimension;this._bandwidthRatio=n?n.pxScale(e).bandwidth():1,this._bandwidthPx=e*this._bandwidthRatio},_calcPointMaxSize:function(e,t){var n=Math.min(h.MAX_POINT_BASE_SIZE_PX,t*h.POINT_BANDWIDTH_BASE_RATIO)*e;this._pointMaxSizePx=Math.max(h.MIN_POINT_PIXELS,n)},_calcPointSize:function(e,t){this._pointSize=e/t},_getDimAxisSettings:function(e,t){var n=this;return{brush:{trigger:L(t.trigger),consume:L(t.consume)},settings:{labels:{mode:"vertical"===e.orientation?e.dimensionAxis.label:"auto",maxGlyphCount:Math.ceil(D.stringWidthOverMWidth(O(this.layout||e))),maxLengthPx:function(){return n.picassoElement.getBoundingClientRect().height/3}}}}},_getBoxMarkerSettings:function(e,t){var n=e.color.point.auto?_.getStyle(h.CHART_ID,"box","fill"):_.Theme.resolveColor(e.color.box.paletteColor),i=L(t.trigger),r=L(t.consume),o=this,s={require:["chart"],displayOrder:1e3,settings:{chart:this,box:{fill:n,stroke:_.getStyle(h.CHART_ID,"box","stroke"),strokeWidth:0,width:h.POINT_BANDWIDTH_BASE_RATIO,maxWidthPx:h.MAX_POINT_BASE_SIZE_PX,minWidthPx:h.MIN_POINT_PIXELS+2*h.BOX_PADDING},minor:{scale:"measure"},orientation:e.orientation},beforeRender:function(){var e=o.layout.presentation&&o.layout.presentation.visibleComponents&&-1!==o.layout.presentation.visibleComponents.indexOf("point"),t="horizontal"===o.layout.orientation?this.rect.height:this.rect.width;o._calcBandwidth(t,this.chart),o._calcPointMaxSize(e?o._getPointScale():1,o._bandwidthPx);var n=0;o._jitter&&(o._calcPointSize(o._pointMaxSizePx,o._bandwidthPx),n=o._pointSize*o._bandwidthPx*h.JITTER_PARAMETER);var i=o._pointMaxSizePx+n+2*h.BOX_PADDING,r=i/o._bandwidthPx;this.settings.settings.box.maxWidthPx=Math.min(o._bandwidthPx-2,i),this.settings.settings.box.width=r},brush:{trigger:i,consume:r},data:{extract:{field:"qDimensionInfo/0",trackBy:function(){return-1},props:{start:{field:"qMeasureInfo/0",reduce:"min"},end:{field:"qMeasureInfo/0",reduce:"max"},elemNo:{field:"qDimensionInfo/0"}}}}};return q.hasSecondDimension(e,H)&&(s.data.extract.field="qDimensionInfo/0",s.data.extract.trackBy=function(e){return e.qElemNo},s.settings.major={scale:"dimension"}),s},_getPointMarkerSettings:function(e,n,i){var r=_.Theme.resolveColor(e.color.point.paletteColor),o=_.getContrastingTransparent(r),s=1;e.dataPoint&&!1===e.dataPoint.border&&(s=0);var a=L(n.trigger);this.hasOption("tooltips")&&a.push(i.point.trigger);var l=L(n.consume),c=this,u={require:["chart"],displayOrder:1100,settings:{chart:this,fill:function(){return-3===this.data.innerElemNo.value||-3===this.data.elemNo.value?_.Theme.dataColors.othersColor:r},stroke:o,size:.3,strokeWidth:s,sizeLimits:{maxRelExtent:10,maxPx:h.MAX_POINT_BASE_SIZE_PX,minPx:h.MIN_POINT_PIXELS},orientation:e.orientation},beforeRender:function(){var e="horizontal"===c.layout.orientation?this.rect.height:this.rect.width;if(c._calcBandwidth(e,this.chart),c._calcPointMaxSize(c._getPointScale(),c._bandwidthPx),c._calcPointSize(c._pointMaxSizePx,c._bandwidthPx),c._jitter){var t=2*h.BOX_PADDING/e;c._jitterTool.calcMaxJitter(c._pointSize*c._bandwidthRatio,h.JITTER_PARAMETER,c._bandwidthRatio-t)}this.settings.settings.sizeLimits.maxPx=c._pointMaxSizePx,this.settings.settings.size=c._pointSize},brush:{trigger:a,consume:l},data:{extract:{field:"qDimensionInfo/0",props:{innerElemNo:{field:"qDimensionInfo/0"},elemNo:{field:"qDimensionInfo/0"},inner:{field:"qDimensionInfo/0",value:function(e){return e}},row:{field:"qDimensionInfo/0",value:function(e){return e.qRow}},measure:{field:"qMeasureInfo/0",reduce:"first",value:function(e){return e}}}}}};if(q.hasSecondDimension(e,H)&&(u.data.extract.props.inner.field="qDimensionInfo/1",u.data.extract.props.innerElemNo.field="qDimensionInfo/1",u.data.extract.props.row.field="qDimensionInfo/1",u.data.extract.field="qDimensionInfo/1",u.data.extract.props.outer={field:"qDimensionInfo/0",value:function(e){return e}}),!e.color.point.auto&&"byExpression"===e.color.point.mode){u.data.extract.props.pointColorNumeric={field:"qMeasureInfo/0/qAttrExprInfo/0",reduce:"first",value:function(e){return"number"==typeof e.qNum?M.retriveColor(e.qNum,"argb").toRGBA():M.retriveColor(_.Theme.dataColors.nullColor).toRGBA()}},u.data.extract.props.pointColorString={field:"qMeasureInfo/0/qAttrExprInfo/0",reduce:"first",value:function(e){return e&&e.qText}},u.settings.fill=function(){if("string"==typeof this.data.pointColorString.value){var e=M.retriveColor(this.data.pointColorString.value);if(!e.isInvalid())return e.toRGBA()}return this.data.pointColorNumeric.value}}if(this.setDataPaths([H+"/"+B]),t.COLOR_BY_DIM&&!e.color.point.auto&&"byDimension"===e.color.point.mode){var d;if(e[H].legendData){var p=q.hasSecondDimension(e,H)?1:0;e[H][B].qDimensionInfo[p].qAttrDimInfo[0].qError||(d="qDimensionInfo/"+p+"/qAttrDimInfo/0",u.data.extract.props.colorElemNo={field:d},u.data.extract.props.colorByDim={field:d,value:function(e){return e}},this.chartInstance.brush("select-color").addKeyAlias(H+"/legendData/qDimensionInfo/0",H+"/"+B+"/"+d),this.setDataPaths([H+"/"+B,H+"/legendData"]))}else{var f=this.getColoringMap().getColorDataInfo();f.valid&&!f.altMode&&(d="qDimensionInfo/"+f.dimIndex,u.data.extract.props.colorElemNo={field:d},u.data.extract.props.colorByDim={field:d,value:function(e){return e}})}}if(t.COLOR_BY_DIM||t.COLOR_BY_MEA){var m="horizontal"!==e.orientation?"y":"x",g=function(e){var t=[e.elemNo.value,e.innerElemNo.value],n=e[m].value,i=e.row.value;return c.getColoringMap().getColor(t,n,0,i)};u.settings.fill=function(){return g(this.data).toRGBA()},u.settings.stroke=function(){var e=g(this.data);return _.getContrastingTransparent(e)}}return u},_getLegendData:function(e){var t,n,i=this.getColoringMap(),r=i.getColorDataInfo();return r.altMode?(t=H+"/legendData",n=0):(t=H+"/"+B,n=r.dimIndex),b.getLegendData({colorMap:i,legendData:this.layout[H].legendData&&this.layout[H].legendData.qDataPages[0].qMatrix,selectionSettings:e,dimIndex:n,source:t})},createChartSettings:function(e){var n="rtl"===this.options.direction,r=e.presentation&&e.presentation.visibleComponents,o=r&&-1!==e.presentation.visibleComponents.indexOf("point"),s=r&&-1!==e.presentation.visibleComponents.indexOf("box");this._jitter=t.DIST_JITTER&&o&&e.dataPoint&&"jitter"===e.dataPoint.displacement;var a=e[H][B],l=a.qDimensionInfo,c="horizontal"!==e.orientation?"y":"x",u="horizontal"!==e.orientation?"x":"y",d=i.create({chartID:h.CHART_ID,layoutMode:this.getLayoutMode(e),isRtl:n}),p={},f={},m={},v={};if(this.hasOption("selections")){var y=!o&&q.hasSecondDimension(e,H);this._selectionHandler.setUpStart();var b=this._selectionHandler.setUpBrush({contexts:["select-inner"],data:["innerElemNo"]},!0),C=this._selectionHandler.setUpBrush({contexts:["select-outer"],data:["elemNo"]},!0),S=this._selectionHandler.setUpBrush({dataPath:H,contexts:["select-color"],data:["colorElemNo"],startOnEmptySelection:!1},!0),w=this._selectionHandler.setUpBrush({contexts:["select-measure"],data:[c]},!0);this._selectionHandler.setUpDone(),p={trigger:x.extend(!0,{},C.trigger,{data:[""]}),consume:[x.extend(!0,{},C.consume,{data:[""]})]},f={trigger:y?C.trigger:null,consume:[b.consume,C.consume,w.consume]},m={trigger:b.trigger,consume:[b.consume,C.consume,w.consume,S.consume]},v={trigger:[x.extend(!0,{},S.trigger,{data:[""]})],consume:[x.extend(!0,{},S.consume,{data:[""]}),b.consume,C.consume]}}var _={point:{},box:{}},D=this;this.hasOption("tooltips")&&(_.point=this._tooltipHandler.setUp({data:q.hasSecondDimension(e,H)?["innerElemNo","elemNo"]:["innerElemNo"],contexts:["pointTip"],componentKey:"point-marker",direction:this.options.direction,chartView:D,attrDimPath:"/"+B+"/qDimensionInfo/"+(q.hasSecondDimension(e,H)?1:0)+"/qAttrDimInfo/0",measureRows:["measure"],labelData:q.hasSecondDimension(e,H)?["inner","outer"]:["inner"]}));var M=F(R(e)),A={scrollHandler:this.hasOption("navigation")&&this._scrollHandler,selectionHandler:this.hasOption("selections")&&this._selectionHandler},E={componentKey:o?"point-marker":"box-marker",lassoBrushKey:"select-inner",dimRangeBrushKey:"select-outer",measureRangeBrushKey:"select-measure",areaBrushKey:null,legendBrushKey:"legend"};if(this._dependentActions&&this._dependentActions.destroy(),this._dependentActions=g.create(A,this.isOn.bind(this),e.orientation,n,E,M),d.addPreset("dimension-measure-chart",{isRtl:n,includeDimensionAxis:q.hasSecondDimension(e,H),orientation:e.orientation,selectionsEnabled:this.hasOption("selections"),measureSource:["qMeasureInfo/0"],dimensionSource:"qDimensionInfo/0",measureAxisProperties:e.measureAxis,measureTitleText:a.qMeasureInfo[0].qFallbackTitle,dimensionAxisProperties:e.dimensionAxis,dimensionAxisSettings:this._getDimAxisSettings(e,p),dimensionTitleText:l&&l[0]&&l[0].qFallbackTitle||"",gridlines:e.gridlines,hasNavigation:this.hasOption("navigation"),isNavigationEnabledFn:this.isOn.bind(this),scrollSettings:this.hasOption("navigation")&&k(e,this._scrollHandler.getScrollViewSizeInItem()),enableLasso:!0,lasso:{brushKey:o?"select-inner":"select-outer",brushComponents:o?["point-marker"]:["box-marker"],brushData:o?["innerElemNo"]:["elemNo"]},enableDimRange:!0,dimRange:{brushKey:"select-outer",brushAxis:"horizontal"===e.orientation?"y-axis":"x-axis",brushArea:s?"box-marker":"point-marker",brushScale:"dimension"},enableMeasureRange:o,measureRange:{brushKey:"select-measure",brushAxis:"horizontal"===e.orientation?"x-axis":"y-axis",brushArea:o?"point-marker":"box-marker",brushScale:"measure",multiple:!0},brushActions:this._dependentActions.gestures,refLines:e.refLine&&e.refLine.refLines}),s){var I=this._getBoxMarkerSettings(e,f);d.addComponent("box-marker",I)}if(o){var T=this._getPointMarkerSettings(e,m,_);if(T.data.extract.props[c]={field:"qMeasureInfo/0"},T.settings[c]={scale:"measure"},q.hasSecondDimension(e,H)&&(T.data.extract.props[u]={field:"qDimensionInfo/0",type:"qual"},T.settings[u]={scale:"dimension",ref:u}),this._jitter){T.settings[u]=T.settings[u]||{};var L=this._jitterTool;T.settings[u].fn=function(e){return("function"==typeof this.scale?this.scale(e.value)+.5*this.scale.bandwidth():.5)+L.getJitterValue(this.data.value,h.JITTER_PARAMETER)}}d.addComponent("point-marker",T),(t.COLOR_BY_DIM||t.COLOR_BY_MEA)&&(e.legend?!1!==e.legend.show:!e.color.point.auto&&"byDimension"===e.color.point.mode)&&this.addLegend(d,e.legend,n,v)}var O=d.getSettings();return this.addSnapshotChartSettings(O,e),O},addLegend:function(e,t,n,i){var r=this._getLegendData(i);if(r){var o={dock:t?t.dock:"auto",chartWidth:this.picassoElement.clientWidth,chartHeight:this.picassoElement.clientHeight,show:!t||!1!==t.show,showTitle:!t||!1!==t.showTitle,type:"circle",tableMode:!0},s=e.addComponent(r.type,r.settings,o).dock;if(this.hasOption("navigation")&&this.isOn()){var a="top"===s||"bottom"===s,l=b.getCategoricalLegendPanGesture("legend",a,n),c=e.getSettings();c.interactions&&c.interactions.length&&c.interactions[0].gestures?c.interactions[0].gestures=c.interactions[0].gestures.concat(l):e.addInteraction({},{gestures:l})}}},resize:function(e,t){this.layout&&(N.call(this),this._super(e,t))},hasValidData:function(){var e=this.layout;return e[H]&&e[H][B]&&e[H][B].qStackedDataPages.length&&e[H][B].qStackedDataPages[0].qData.length},paint:function(t){this.backendApi.isSnapshot||this.options.viewState||this.updateScrollHandlerState(!1),this._orientation||(this._orientation=this.layout.orientation),this._orientation!==this.layout.orientation&&(N.call(this),this._orientation=this.layout.orientation);var n=this.layout;if(!this.hasValidData())return e.resolve();var i=this,r=this._super;return!this.backendApi.isSnapshot&&q.hasSecondDimension(n,H)&&this._scrollHandler.isDataSizeChanged(x.getValue(n,H+"."+B+".qStackedDataPages.0.qData.0.qSubNodes.length"),q.getOuterDimensionSizeOfMax2Dims(n,H))?this._scrollHandler.getViewData().finally(function(){return i._updateColorMapData(n).then(function(){return r.call(i,t)})}):this._updateColorMapData(n).then(function(){return r.call(i,t)})},setSnapshotData:function(t){this._super(t);var n=e(),i=t.snapshotData.content;return this.getColoringMap().getSnapshotChartData().forEach(function(e){i[e.key]=e.data}),t[H][B].qStackedDataPages=this.layout[H][B].qStackedDataPages,t[H].legendData=this.layout[H].legendData,u.toBefore(t),n.resolve(t),n.promise},getViewState:function(){return{scroll:this._scrollHandler.getScrollState()}},getDisclaimerAttributes:function(e){var t=this.hasOption("navigation")&&k(e,this._scrollHandler.getScrollViewSizeInItem()),n=void 0;return!q.hasSecondDimension(e,H)&&e.qHyperCube.qSize.qcy>1e4&&(n=!0),{data:e&&e.qUndoExclude,supportedDisclaimers:{LimitedData:!0},options:{paddingBottom:t&&t.viewSize<t.max,supportNegative:!0,explicitLimitedData:n}}},_updateColorMapData:function(e){var t=x.extend({mode:"primary",auto:!1},e.color.point),n={color:x.extend(!0,{},t),visualization:e.visualization,qHyperCube:e.qUndoExclude.qHyperCube};q.hasSecondDimension(this.layout,H)&&A.isByNthDimension(n.color)&&(n.color.byDimDef.activeDimensionIndex=1-n.color.byDimDef.activeDimensionIndex);var i=e.qUndoExclude.qHyperCube,r=E.prepareData(i.qStackedDataPages[0].qData,i.qMeasureInfo,i.qDimensionInfo).dimensionTree;return this.getColoringMap().setDimensionTree(r),this.setColorMapData(n,e.visualization)},_createColorLegendCube:function(e){var t=q.hasSecondDimension(this.layout,H)?1:0;return{qDimensionInfo:[this.layout[H][B].qDimensionInfo[t].qAttrDimInfo[0]],qMeasureInfo:[],qDataPages:e,qMode:"S",qSize:{qcx:1,qcy:e[0].qMatrix.length}}},_updateColorData:function(){var e=this;if(t.COLOR_BY_DIM)return e._updateColorMapData(this.layout).then(function(){var t=e.getColoringMap().getColorDataInfo();if(t&&t.legendPath){var n="/"+H+t.legendPath;return e.backendApi.getData(t.legendPages,n).then(function(t){e.layout[H].legendData=e._createColorLegendCube(t)})}e.layout[H].legendData=null})},updateDerivedProperties:function(e,t){var n=this,i=n.backendApi.model;return n._derivedProperties.addDefaultHyperCubeHash(e.qHyperCubeDef,t.qHyperCube,i.app,T(e)).then(function(r){var o={layout:t,properties:e,model:i,hashData:r,generateDerivedProperties:function(e,t){return d.generateHyperCube(e,t,i.app)}};return n._derivedProperties.updateDerivedProperties(o)})},updateData:function(e){var t=this;return t._super(e).then(function(){if(e=t.layout,t._scrollHandler.setOptions({direction:"horizontal"===e.orientation?"vertical":"horizontal"}),t.backendApi.isSnapshot)return u.toAfter(e),t.getColoringMap().setSnapshotChartData(e.snapshotData.content.chartData),t._updateColorMapData(e);t.updateScrollHandlerState(!0),t.updateScrollHandlerState(!0),t.options.viewState?t._scrollHandler.setScrollState(t.options.viewState.scroll):(t._scrollHandler.resetScroll(),V.call(t)),t._scrollHandler.getScrollViewSizeInItem()&&!t._cacheSizeInitialized&&(P.call(t),t._cacheSizeInitialized=!0);return(q.hasSecondDimension(e,H)?t.getSlicedData(t._scrollHandler.getScrollState(),t._scrollHandler.getScrollViewSizeInItem()):t.getData(t.backendApi,e[H][B],{height:e[H][B].qSize.qcy})).then(function(){return t._updateColorData()})})},isLassoDisabled:function(){return!1}}),definition:o,softDefinition:l,initialProperties:{sorting:{autoSort:!0},qHyperCubeDef:{qDimensions:[],qMeasures:[],qMode:"K",qAlwaysFullyExpanded:!0,qSuppressZero:!1,qSuppressMissing:!0},dataPoint:{bubbleScales:100}},options:{usingDerivedProperties:!0,colorByPath:"color.point"},support:{cssScaling:!1,snapshot:!0,export:!0,exportData:!0,sharing:!0,viewData:!0},data:a,importProperties:function(e,t,n){var i=w.axisChart.importProperties.call(w,e,t,n),r=i.qProperty;return 3===r[z].qInterColumnSortOrder.length&&(r[z].qIntercolumnSortOrder=[1,2,0]),c.importColors(r),i},exportProperties:function(e){return c.exportColors(e.qProperty),w.axisChart.exportProperties.call(w,e)},onSoftPropertyChange:function(e,t){s.onGlobalChangeColors(t)},getCreatePropertyHandler:function(e){var t,n,i=this.mappedDefinition,r=this.globalChangeListeners;return this.dimensionDefinition&&(t=S.mapProperties(i.items.data.items.innerData.items.dimensions)),this.measureDefinition&&(n=S.mapProperties(i.items.data.items.innerData.items.measures)),new p({app:e,dimensionDefinition:this.dimensionDefinition,measureDefinition:this.measureDefinition,dimensionProperties:t,measureProperties:n,globalChangeListeners:r})}}}),define("extensions.qliktech/histogram/binning-defaults",[],function(){"use strict";var e={AUTO:!0,BIN_COUNT:10,BIN_SIZE:10,LABEL:"x",OFFSET:0,COUNT_DISTINCT:!1,BIN_MODE:"maxCount"};return Object.freeze(e),e}),define("extensions.qliktech/histogram/histogram-utils",["util","extensions.qliktech/histogram/binning-defaults"],function(e,t){"use strict";return{getBinSize:function(n){return e.getValue(n,"bins.binSize",t.BIN_SIZE)},getDerivedBinSize:function(n){return e.getValue(n,"qUndoExclude.bins.binSize",t.BIN_SIZE)},getDerivedBinOffset:function(n){return e.getValue(n,"qUndoExclude.bins.offset",t.OFFSET)},getDerivedBinCount:function(n){var i=e.getValue(n,"qUndoExclude.bins.binCount",t.BIN_COUNT);return e.isNumeric(i)?i<1?1:e.isInteger(i)?i:Math.ceil(i):t.BIN_COUNT},getBinCount:function(t){return e.getValue(t,"bins.binCount",void 0)},getBinOffset:function(n){return e.getValue(n,"bins.offset",t.OFFSET)},isAutoBin:function(n){return e.getValue(n,"bins.auto",t.AUTO)},isCountDistinct:function(n){return e.getValue(n,"bins.countDistinct",t.COUNT_DISTINCT)},getBinMode:function(n){return e.getValue(n,"bins.binMode",t.BIN_MODE)},isEmpty:function(e){return void 0===e||null===e||""===e}}}),define("extensions.qliktech/histogram/derived-properties/bin-size-calculator",["util"],function(e){"use strict";function t(e,t){var n,i,r;if(0===e)return 0;n=Math.floor(Math.log(Math.abs(e))/s),i=e/Math.pow(10,n);for(var o=0;o<t.length;o++)if(i<=t[o]){r=t[o];break}return(n>=0?r*Math.pow(10,n):r/Math.pow(10,-n))*(e<0?-1:1)}function n(e,t,n,i,r,o){return Math.floor(Math.abs(e-r)/i)+Math.floor(Math.abs(o-t)/i)}function i(e,i,r){var o,h,d,p,f,m,g,v,y,b,x,q,C=-1,S=l;if(r=Math.max(1,r),i===e)if(0===i){if(p=1,1===r)return{min:e,max:i,nbrOfBins:r,rawBinSize:d/r,offset:-.5,newMax:.5,binSize:1,numEmptyBins:0}}else 1===r?(p=i+a,S=c):p=Math.abs(i/r);else p=(d=(i+=a)-e)/r;do{if(v=1,x=0,C>=0)for(y=1/u[C],b=1,S=[];b<=10;)S.push(Math.round(1e3*b)/1e3),b+=y;f=p;do{f=t(f*v,S),m=Math.floor(Math.log(f)/s),g=Math.pow(10,m),o=(h=i===e?(Math.ceil(i/f)+Math.floor(r/2))*f:Math.ceil(i/f)*f)-r*f;var w=0;for(q=g;(o>e||h<i)&&w<u.length;)h=(o=Math.floor(e/q)*q)+r*f,q=g/u[w++];m<1&&(g=Math.pow(10,Math.abs(m)+1),h=Math.round(h*g)/g,o=Math.round(o*g)/g),v=1.1,x++}while((o>e||h<i)&&x<10);C++}while(n(e,i,r,p,o,h)>0&&C<u.length);return{binCount:r,offset:o,binSize:f}}function r(t,n,i){if(!e.isNumeric(t)||!e.isNumeric(n)||!e.isNumeric(i))throw Error("binSizeCalculator: One of the inputs is NOT numeric");if(t>n)throw Error("binSizeCalculator: The 'min' parameter is bigger than the 'max' parameter")}function o(t){return t<1?1:e.isInteger(t)?t:Math.ceil(t)}var s=Math.log(10),a=1e-9,l=[1,1.5,2,3,4,5,6,10],c=[1,2,4,5,6,8,10],u=[2,4,5,10];return{calculateBinSize:function(e,t,n){return r(e,t,n),n=o(n),i(e,t,n)}}}),define("extensions.qliktech/histogram/derived-properties/histogram-mappings",["util","extensions.qliktech/histogram/histogram-utils","extensions.qliktech/histogram/derived-properties/bin-size-calculator"],function(e,t,n){"use strict";function i(i){var r,o=e.getValue(i,"qHyperCube.qDimensionInfo.0",{}),s=o.qMin,a=o.qMax;return s=e.isNumeric(s)?s:1,a=e.isNumeric(a)?a:1,r=t.getDerivedBinCount(i),n.calculateBinSize(s,a,r)}return{getMappingValues:function(e){var n,r,o,s,a=t.isAutoBin(e),l=t.getBinMode(e),c=t.isCountDistinct(e);return a||"maxCount"===l?(n=(s=i(e)).binSize,r=s.offset,o=s.binCount):(n=t.getBinSize(e),r=t.getBinOffset(e)),{binSize:n,binOffset:r,binCount:o,distinct:c}},getMappings:function(e){var t={};return t.BinSize={value:","+e.binSize},t.Label={value:0===e.binOffset?"":",'x'"},t.Offset={value:0===e.binOffset?"":","+e.binOffset},t.Distinct={value:e.distinct?"Distinct ":""},t}}}),define("extensions.qliktech/histogram/derived-properties/histogram-cubes-generator",["core.utils/deferred","util","objects.picasso/hypercube-def-generator/hypercube-def-generator","extensions.qliktech/histogram/derived-properties/histogram-mappings","objects.picasso/expression-generator/expression-generator","extensions.qliktech/histogram/histogram-utils"],function(e,t,n,i,r,o){"use strict";return{generateHyperCubes:function(s,a,l){var c,u=i.getMappingValues(s),h=i.getMappings(u);return c={dimensions:["Class({{Dim[0]}}{{BinSize}}{{Label}}{{Offset}})"],measures:["Count({{Distinct}}{{Dim[0]}})"]},e.all({expressions:n.getAllHyperCubeExpressions(a.qHyperCubeDef,s.qHyperCube,l),boxCubeDef:n.generateHyperCubeDef(c,a.qHyperCubeDef,s.qHyperCube,l,h)}).then(function(e){var n,i=e.expressions,l=e.boxCubeDef;n=o.isAutoBin(s)?{qValueExpression:{qExpr:r.generateExpression("=Ceil(Log10(Count({{Dim[0]}})) / Log10(2)) + 1",{"Dim[0]":{value:i.dimensions[0],wrap:!0}})}}:"maxCount"===o.getBinMode(s)&&o.isEmpty(a.bins.binCount)?o.getDerivedBinCount(s):a.bins.binCount,t.setValue(l,"qDimensions.0.qDef.qSortCriterias",[{qSortByNumeric:1}]),t.setValue(a,"qUndoExclude.box.qHyperCubeDef",l),t.setValue(a,"qUndoExclude.bins.binSize",u.binSize),t.setValue(a,"qUndoExclude.bins.offset",u.binOffset),t.setValue(a,"qUndoExclude.bins.binCount",n)})}}}),define("extensions.qliktech/histogram/chart-settings/dimension-axis",["util"],function(e){function t(t){var i=e.getValue(t,"qUndoExclude.box.qHyperCube.qDimensionInfo.0.qApprMaxGlyphCount",0);return Math.min(n,i)}var n=20;return{createSettings:function(e){return{settings:{labels:{maxGlyphCount:t(e)}}}}}}),define("extensions.qliktech/histogram/chart-settings/dimension-scale",["util","extensions.qliktech/histogram/histogram-utils"],function(e,t){return{createSettings:function(n){var i,r,o=t.isAutoBin(n),s=t.getBinMode(n),a=t.getDerivedBinSize(n);if(o||"maxCount"===s){var l=t.getDerivedBinOffset(n);i=l,r=l+t.getDerivedBinCount(n)*a}else{var c=e.getValue(n,"qUndoExclude.box.qHyperCube.qDimensionInfo.0",{});i=c.qMin||0,r=(c.qMax||0)+a}return{component:{type:"linear",min:i,max:r}}}}}),define("extensions.qliktech/histogram/chart-settings/box-marker",["objects.utils/chart-style-utils","extensions.qliktech/histogram/histogram-utils"],function(e,t){return{createSettings:function(n,i,r,o,s,a){var l=e.Theme.resolveColor(i.color.bar.paletteColor),c=t.getDerivedBinSize(i),u=[];return n.hasOption("tooltips")&&u.push(a.box.trigger),u.push(r.trigger),{key:"box-marker",settings:{box:{fill:l,stroke:e.getContrastingGrey(l).toHex(),strokeWidth:1,maxWidthPx:1/0,minWidth:0},major:{scale:"dimension",ref:{start:"binStart",end:"binEnd"}},minor:{scale:"measure"},whiskers:!1,orientation:"vertical"},brush:{trigger:u,consume:[r.consume,o.consume,s.consume]},data:{extract:{field:"qDimensionInfo/0",props:{start:0,end:{field:"qMeasureInfo/0"},measure:{field:"qMeasureInfo/0",reduce:"first",value:function(e){return e}},binStart:{field:"qDimensionInfo/0",value:function(e){return e.qNum}},binEnd:{field:"qDimensionInfo/0",value:function(e){return e.qNum+c}},elemNo:{field:"qDimensionInfo/0"},bin:{field:"qDimensionInfo/0",value:function(e){return e}}}}}}}}}),define("extensions.qliktech/histogram/chart-settings/label",["objects.utils/chart-style-utils"],function(e){return{createSettings:function(t){var n=e.Theme.resolveColor(t.color.bar.paletteColor);return{settings:{sources:[{strategy:{settings:{labels:[{placements:[{},{fill:e.getInverse(n)}]}]}}}]}}}}}),define("extensions.qliktech/histogram/chart-settings/chart-settings",["util","translator","objects.picasso/chart-builder/chart-builder","objects.picasso/selections/dependent-interactions","extensions.qliktech/histogram/chart-settings/dimension-axis","extensions.qliktech/histogram/chart-settings/dimension-scale","extensions.qliktech/histogram/chart-settings/box-marker","extensions.qliktech/histogram/chart-settings/label"],function(e,t,n,i,r,o,s,a){function l(e){var t=e.qUndoExclude&&e.qUndoExclude.box&&e.qUndoExclude.box.qHyperCube&&e.qUndoExclude.box.qHyperCube.qDimensionInfo?e.qUndoExclude.box.qHyperCube.qDimensionInfo:void 0;return!!t&&!!t[0].qLocked}function c(e){var t={};return e?(t.isOpenDim=!1,t.isOpenMea=!1):(t.isOpenDim=!0,t.isOpenMea=!0),t}var u="histogram";return{createChartSettings:function(h,d){var p=h.options&&"rtl"===h.options.direction,f=e.getValue(d,"qHyperCube.qDimensionInfo.0",{}).qFallbackTitle||"",m=n.create({chartID:u,layoutMode:h.getLayoutMode(d)}),g={},v={},y={};h.hasOption("selections")&&(h._selectionHandler.setUpStart(),g=h._selectionHandler.setUpBrush({contexts:["select"],data:["elemNo"],dataPath:"qUndoExclude/box"}),v=h._selectionHandler.setUpBrush({contexts:["select-dimension"],data:["elemNo"],dataPath:"qUndoExclude/box"}),y=h._selectionHandler.setUpBrush({dataPath:"qUndoExclude/box",contexts:["select-measure"],data:["end"]}),h._selectionHandler.setUpDone());var b={box:{}};h.hasOption("tooltips")&&(b.box=h._tooltipHandler.setUp({data:[""],contexts:["boxTip"],componentKey:"box-marker",direction:h.options.direction,measureRows:["measure"],labelData:["bin"]}));var x=c(l(d)),q={scrollHandler:null,selectionHandler:h._selectionHandler},C={componentKey:"box-marker",lassoBrushKey:"select",dimRangeBrushKey:null,measureRangeBrushKey:"select-measure",areaBrushKey:"select-dimension"};this._dependentActions&&this._dependentActions.destroy(),this._dependentActions=i.create(q,h.isOn.bind(h),"vertical",p,C,x),m.addPreset("dimension-measure-chart",{isRtl:p,includeDimensionAxis:!0,orientation:"vertical",selectionsEnabled:h.hasOption("selections"),measureSource:"qMeasureInfo/0",measureScaleSettings:{component:{expand:0,include:[0]}},enableLasso:!0,lasso:{brushKey:"select",brushComponents:["box-marker"]},enableMeasureRange:!0,measureRange:{brushKey:"select-measure",brushAxis:"y-axis",brushArea:"box-marker",brushScale:"measure"},enableAreaRange:!0,areaRange:{brushKey:"select-dimension",brushAxis:"x-axis",brushData:["elemNo"],brushArea:"box-marker",brushScale:"rangeSelSettings",brushComponents:["box-marker"],multiple:!0,chartInstance:h.chartInstance},brushActions:this._dependentActions.gestures,dimensionSource:"qDimensionInfo/0",dimensionScaleSettings:o.createSettings(d),measureAxisProperties:d.measureAxis,measureTitleText:d.measureAxis.label||t.get("Visualization.Histogram.MeasureAxisLabel"),dimensionAxisProperties:d.dimensionAxis,dimensionAxisSettings:r.createSettings(d),dimensionTitleText:f,gridlines:d.gridlines,hasNavigation:h.hasOption("navigation"),isNavigationEnabledFn:h.isOn.bind(this),refLines:d.refLine&&d.refLine.refLines});var S=m.getSettings(),w=s.createSettings(h,d,g,v,y,b);if(m.addComponent("box-marker",w),d.dataPoint.showLabels){var _=a.createSettings(d);m.addComponent("labels",_)}return h.addSnapshotChartSettings(S,d),S.scales.rangeSelSettings={type:"linear",min:S.scales.dimension.min,max:S.scales.dimension.max,source:"qDimensionInfo/0"},S}}}),define("extensions.qliktech/histogram/histogram-view",["util","core.utils/deferred","objects.picasso/chart-view","objects.picasso/selections/selections-handler","objects.picasso/tooltip/tooltips-handler","objects.picasso/derived-properties/derived-properties","extensions.qliktech/histogram/derived-properties/histogram-cubes-generator","extensions.qliktech/histogram/derived-properties/histogram-mappings","extensions.qliktech/histogram/chart-settings/chart-settings"],function(e,t,n,i,r,o,s,a,l){function c(e,t){return{box:t.qHyperCubeDef,binMappings:a.getMappingValues(e),binProperties:t.bins}}return n.extend("Histogram",{namespace:".histogram",defaultOptions:{navigation:!1,selections:!0,tooltips:!0},init:function(e,t,n,s,a,l){this._super(e,t,n,s,a,l),t.find(".picasso-chart").data("findShapes",this.chartInstance.findShapes.bind(this.chartInstance)),this._derivedProperties=new o,t.on("touchstart",function(e){e.preventDefault()}),this.hasOption("selections")&&(this._selectionHandler=i.create({model:s.model,chartInstance:this.chartInstance,selectionsApi:a})),this.hasOption("tooltips")&&(this._tooltipHandler=r.create(this.chartInstance,l,t)),this.setDataPaths(["qUndoExclude/box/qHyperCube"])},on:function(){this._super(),this.hasOption("tooltips")&&this._tooltipHandler.on(),this.hasOption("selections")&&this._selectionHandler.on()},off:function(){this._super(),this.hasOption("tooltips")&&this._tooltipHandler.off(),this.hasOption("selections")&&this._selectionHandler.off()},createChartSettings:function(e){return l.createChartSettings(this,e)},setSnapshotData:function(e){return this._super(e),e.qUndoExclude.box.qHyperCube.qDataPages=this.layout.qUndoExclude.box.qHyperCube.qDataPages,t().resolve(e)},getDisclaimerAttributes:function(t){var n=function(){var n=e.getValue(t,"qUndoExclude.box.qHyperCube.qDataPages.0.qMatrix",[]);return 1===n.length&&n[0][0]&&n[0][0].qIsNull}();return{data:t.qUndoExclude&&t.qUndoExclude.box,supportedDisclaimers:{LimitedData:!0,OnlyNanData:!0,OnlyNegativeOrZeroValues:!n},options:{bottom:!0,supportNegative:!1,explicitOnlyNanData:n}}},updateChart:function(e,n){if(!e.qUndoExclude)return t.resolve();this._super(e,n)},updateData:function(e){var n=this;return n._super(e).then(function(){e=n.layout;var i={height:Math.min(e.qHyperCube.qSize.qcy,1e3),width:2},r=n.backendApi.model;return n.backendApi.isSnapshot?t.resolve():r.getEffectiveProperties().then(function(o){return n._derivedProperties.addDefaultHyperCubeHash(o.qHyperCubeDef,e.qHyperCube,r.app,c(e,o)).then(function(a){var l={layout:e,properties:o,model:r,hashData:a,generateDerivedProperties:function(e,t){return s.generateHyperCubes(e,t,r.app)}};return n._derivedProperties.isDerivedUpToDate(l)?e.qUndoExclude?(n.backendApi.setPath("/qUndoExclude/box/qHyperCubeDef"),n.backendApi.updateCache(e.qUndoExclude.box),n.getData(n.backendApi,e.qUndoExclude.box.qHyperCube,i)):t.resolve():n._derivedProperties.updateDerivedProperties(l)})})})},paint:function(e){var n=this.layout.qUndoExclude;return n&&n.box&&n.box.qHyperCube.qDataPages.length?this._super(e):t.resolve()},isLassoDisabled:function(){return!1}})}),define("extensions.qliktech/histogram/histogram-properties",["util","client.utils/property-resolver","client.utils/default-property-logic","translator","extensions.qliktech/histogram/histogram-utils"],function(e,t,n,i,r){function o(e){return!(e.bins&&e.bins.auto)}function s(e){return o(e)&&e.bins.binMode===a}var a="maxCount",l={uses:"axis.picasso.measureAxis",items:{label:{type:"string",expression:"optional",expressionType:"StringExpression",ref:"measureAxis.label",defaultValue:"",translation:"Common.Label",placeholderTranslation:"Visualization.Histogram.MeasureAxisLabel"}}},c={uses:"axis.picasso.dimensionAxis",items:{othersGroup:{items:{label:{show:!1}}}}},u={translation:"properties.colors",type:"items",items:{colors:{type:"items",items:{barColor:{ref:"color.bar.paletteColor",translation:"properties.histogram.barColor",type:"object",component:"color-picker",dualOutput:!0,defaultValue:n.getLogicFor("hard","default").color.paletteColor.defaultValue}}}}};return{type:"items",component:"accordion",items:{data:{translation:"Common.Data",type:"items",items:{innerData:{uses:"data",items:{dimensions:{uses:"dimensions",translation:"Common.Fields",alternativeTranslation:"properties.alternative.fields",items:{dimensionLimits:{show:!1,items:{otherMode:{readOnly:!1},otherSortMode:{show:function(e){return"OTHER_COUNTED"===t.getValue(e,"qOtherTotalSpec.qOtherMode")}},otherCounted:{show:function(e){return"OTHER_COUNTED"===t.getValue(e,"qOtherTotalSpec.qOtherMode")}},otherLimitMode:{show:function(e){var n=t.getValue(e,"qOtherTotalSpec.qOtherMode");return"OTHER_ABS_LIMITED"===n||"OTHER_REL_LIMITED"===n}},otherLimit:{show:function(e){var n=t.getValue(e,"qOtherTotalSpec.qOtherMode");return"OTHER_ABS_LIMITED"===n||"OTHER_REL_LIMITED"===n}},calculatedAgainstMessage:{show:!0,label:function(){var e=i.get("properties.histogram.staticMeasureName");return i.get("Properties.DimensionLimits.CalculatedAgainst",e)}}}},others:{show:!1,items:{suppressOther:{defaultValue:!0}}}}},measures:{uses:"measures"}}}}},bins:{translation:"Visualization.Histogram.Bins",type:"items",component:"items",items:{auto:{ref:"bins.auto",translation:"Visualization.Histogram.Binning",component:"switch",type:"boolean",defaultValue:!0,undefinedValue:!1,options:[{value:!0,translation:"Visualization.Histogram.Binning.Auto"},{value:!1,translation:"Visualization.Histogram.Binning.Custom"}]},autoMessage:{component:"text",translation:"Visualization.Histogram.Binning.AutoDescription",show:function(e){return!o(e)}},mode:{ref:"bins.binMode",type:"string",component:"dropdown",options:[{value:a,translation:"Visualization.Histogram.Binning.NumberOfBinsOption"},{value:"size",translation:"Visualization.Histogram.Binning.BarWidthOption"}],defaultValue:a,show:function(e){return o(e)}},binCount:{ref:"bins.binCount",type:"number",expression:"optional",expressionType:"ValueExpression",translation:"Visualization.Histogram.Binning.BinCount",defaultValue:"",convertFunctions:{get:function(e,t,n){var i=n.properties.bins.binCount;return r.isEmpty(i)?r.getDerivedBinCount(n.layout):e(null)||""},set:function(e,t,n){t(n.type,e,void 0)}},show:s},binMessage:{component:"text",translation:"Visualization.Histogram.Binning.BinCountRounding",show:function(n){var i=t.getValue(n,"bins.binCount"),o="object"==typeof i;return s(n)&&!r.isEmpty(i)&&!o&&!e.isInteger(i)&&i>0}},minBinMessage:{component:"text",translation:"Visualization.Histogram.Binning.BinCountMin",show:function(e){var n=t.getValue(e,"bins.binCount");return!!(s(e)&&!r.isEmpty(n)&&n<=0)}},binSize:{ref:"bins.binSize",type:"number",expression:"optional",expressionType:"ValueExpression",defaultValue:10,show:function(e){return o(e)&&"size"===e.bins.binMode},translation:"Visualization.Histogram.Binning.BinSize"},offset:{ref:"bins.offset",type:"number",expression:"optional",expressionType:"ValueExpression",show:function(e){return o(e)&&"size"===e.bins.binMode},translation:"Visualization.Histogram.Binning.Offset"},distinct:{ref:"bins.countDistinct",type:"boolean",defaultValue:!1,component:"checkbox",translation:"Visualization.Histogram.CountDistinct"}}},addons:{type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{calcCond:{uses:"calcCond"}}},refLines:{uses:"reflines"}}},settings:{uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",items:{gridLines:{type:"items",snapshot:{tid:"property-gridLines"},items:{showGridLines:{ref:"gridlines.auto",type:"boolean",translation:"properties.gridLine.spacing",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},gridSpacing:{ref:"gridlines.spacing",type:"number",component:"dropdown",defaultValue:2,options:[{value:0,translation:"properties.gridLine.noLines"},{value:2,translation:"properties.gridLine.medium"},{value:3,translation:"properties.gridLine.narrow"}],show:function(e){return e.gridlines&&!e.gridlines.auto}}}},showLabels:{ref:"dataPoint.showLabels",type:"boolean",translation:"properties.dataPoints.labelmode",component:"switch",defaultValue:!1,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],snapshot:{tid:"property-dataPoints"}}}},colors:u,measureAxis:l,dimensionAxis:c}}}}}),define("extensions.qliktech/histogram/histogram-data",[],function(){return{dimensions:{min:1,max:1,description:function(){return"Field"},add:function(){},move:function(){},remove:function(){}}}}),define("extensions.qliktech/histogram/histogram-explore-properties",[],function(){return{type:"items",component:"accordion",items:{data:{uses:"data",items:{dimensions:{translation:"Common.Fields"}}}}}}),define("text!assets/client/dialogs/notification-dialog/notification-dialog.ng.html",[],function(){return'<qv-modal-dialog qv-id="notification-dialog" qv-cancel="close()" qv-confirm="close()">\n    <main class="dm-main">\n        <div class="qv-mvc-dialog-content">\n            <div class="qv-mvc-dialog-icon icon-{{icon}}" ng-show="icon"></div>\n            <p><span q-translation="{{text}}"></span></p>\n        </div>\n    </main>\n    <footer class="dm-footer">\n        <lui-button x-variant="inverse" qva-activate="$event.preventDefault(); close()" name="confirm" autofocus q-translation="{{confirmLabel}}"></lui-button>\n    </footer>\n</qv-modal-dialog>\n'}),define("general.utils/tabbable-elements",["jquery","jqueryui"],function(e){"use strict";var t=[];return{preventTabbing:function(n){var i={id:t.length,elements:n.find(":tabbable")};t.push(i),i.elements.each(function(){var t=e(this);t.data("tabbable-elements-tabindex",t.attr("tabindex"))}),i.elements.attr("tabindex","-1")},restoreTabbing:function(){t.pop().elements.each(function(){var t=e(this),n=t.data("tabbable-elements-tabindex");n?t.attr("tabindex",n):t.removeAttr("tabindex")})}}}),define("assets/client/dialogs/directives/tabbable-container",["qvangular","general.utils/tabbable-elements","jquery"],function(e,t,n){e.directive("qvTabbableContainer",function(){return{restrict:"A",controller:["$scope","$element",function(e,i){var r=i[0].nextSibling,o=i[0].parentNode;o.removeChild(i[0]),t.preventTabbing(n(document.body)),document.activeElement&&document.activeElement.blur&&document.activeElement.blur(),o.insertBefore(i[0],r),e.$on("$destroy",function(){t.restoreTabbing()})}]}})}),define("general.utils/keyboard-event-dispatcher",["jquery"],function(e){function t(e){Object.keys(o).forEach(function(t){o[t]=o[t].filter(function(t){return t.jackId!==e})})}function n(e){var t=Array.prototype.slice.call(arguments,1);o[e].forEach(function(e){e.jackId===s[s.length-1]&&e.handler.apply(null,t)})}function i(e,t,i){o[t]||(r.on(t,n.bind(null,t)),o[t]=[]),o[t].push({jackId:e.id,handler:i})}var r,o={},s=[],a={on:function(e,t){i(this,e,t)},release:function(){var e=this.id;t(e),s.splice(s.indexOf(e),1)}};return{hijack:function(){r||(r=e(document));var t=Object.create(a,{id:{value:s.length}});return s.push(t.id),t}}}),define("assets/client/dialogs/directives/escape",["qvangular","general.utils/keyboard-event-dispatcher"],function(e,t){e.directive("qvDialogEscape",["$parse",function(e){return{restrict:"A",controller:["$scope",function(e){var n=this.hijack=t.hijack();e.$on("$destroy",function(){n.release()})}],link:function(t,n,i,r){var o=e(i.qvDialogEscape);r.hijack.on("keydown",function(e){27===e.keyCode&&(e.preventDefault(),setTimeout(function(){t.$apply(function(){o(t,{$event:e})})}))})}}}])}),define("text!general.components/modal-dialog/modal-dialog.ng.html",[],function(){return'<div class="modal-container qui-modalbackground-centered" qv-tabbable-container>\n\t<div id="{{id}}"\n\t\t class="modal-frame qui-delayedModal"\n\t\t ng-transclude></div>\n</div>\n'}),define("general.components/modal-dialog/modal-dialog",["qvangular","text!general.components/modal-dialog/modal-dialog.ng.html","general.utils/keyboard-event-dispatcher"],function(e,t,n){e.directive("qvModalDialog",function(){return{scope:{id:"@qvId",confirm:"&qvConfirm",cancel:"&qvCancel"},restrict:"E",transclude:!0,replace:!0,template:t,link:function(e){var t=n.hijack();e.$on("$destroy",function(){t.release()}),t.on("keydown",function(t){if(27===t.keyCode&&(t.preventDefault(),setTimeout(function(){e.$apply(function(){e.cancel()})})),13===t.keyCode){if("TEXTAREA"===t.target.tagName)return;if("BUTTON"===t.target.tagName)return;setTimeout(function(){e.$apply(function(){e.confirm()})})}})}}})}),define("text!assets/client/dialogs/directives/confirm-cancel-footer.ng.html",[],function(){return'<footer class="dm-footer">\n    <lui-button x-variant="inverse" qva-activate="$event.preventDefault(); cancel()" name="cancel" q-translation="Common.Cancel" tid="2f2a4f" ng-disabled="cancelDisabled"></lui-button>\n    <lui-button x-variant="inverse" qva-activate="$event.preventDefault(); confirm()" name="confirm" autofocus q-translation="{{confirmLabel}}" tid="2f2a56" ng-disabled="confirmDisabled" qva-focus="true"></lui-button>\n</footer>\n'}),define("text!assets/client/dialogs/directives/confirm-cancel-footer-light.ng.html",[],function(){return'<footer class="dm-footer">\n    <lui-button qva-activate="$event.preventDefault(); cancel()" name="cancel" q-translation="Common.Cancel" tid="2f2a4f" ng-disabled="cancelDisabled"></lui-button>\n    <lui-button qva-activate="$event.preventDefault(); confirm()" name="confirm" autofocus q-translation="{{confirmLabel}}" tid="2f2a56" ng-disabled="confirmDisabled" qva-focus="true"></lui-button>\n</footer>\n'}),define("assets/client/dialogs/directives/confirm-cancel-footer",["qvangular","text!assets/client/dialogs/directives/confirm-cancel-footer.ng.html","text!assets/client/dialogs/directives/confirm-cancel-footer-light.ng.html"],function(e,t,n){e.directive("qvConfirmCancelFooter",function(){return{scope:{confirmLabel:"@qvConfirmLabel",confirm:"&qvConfirm",confirmDisabled:"=qvConfirmDisabled",cancel:"&qvCancel",cancelDisabled:"=qvCancelDisabled"},restrict:"E",replace:!0,template:function(e,i){return i.hasOwnProperty("light")?n:t}}})}),define("assets/client/dialogs/directives/dialog-directives",["assets/client/dialogs/directives/tabbable-container","assets/client/dialogs/directives/escape","general.components/modal-dialog/modal-dialog","assets/client/dialogs/directives/confirm-cancel-footer"],function(){}),define("assets/client/dialogs/notification-dialog/notification-dialog",["general.services/show-service/show-service","text!assets/client/dialogs/notification-dialog/notification-dialog.ng.html","assets/client/dialogs/directives/dialog-directives"],function(e,t){var n={template:t,scope:{text:"=",icon:"=",confirmLabel:"="},controller:["$scope",function(e){e.close=function(){e.destroyComponent(),e.deferredResult.resolve()}}]};return{show:function(t){var i={text:t.text,icon:void 0!==t.icon?t.icon:"cogwheel",confirmLabel:t.confirm||"Common.OK"};return e.show(n,i).resultPromise}}}),define("extensions.qliktech/histogram/histogram-numeric-values-handler",["general.utils/string-normalization","general.utils/array-util","general.utils/support","objects.add-popovers/add-dimension-popover","objects.utils/data-properties/library-utils","client.assets/tab-contents/fields/derived-field-formatter-service","assets/client/dialogs/notification-dialog/notification-dialog"],function(e,t,n,i,r,o,s){function a(t,n){return""===n||void 0===n?t:t.filter(function(t){return void 0!==t.value&&e.string(t.value.toLowerCase()).indexOf(e.string(n.toLowerCase()))>-1})}function l(e,t){return-1!==e.indexOf(t)}function c(e,t){return"field"===e.type&&l(e.tags,t)}function u(e,t,n,i){c(e.item,"$numeric")?(t.canAddDimension()?e.Add(n,t):e.Replace(n,t),i()):s.show({text:"Visualization.Histogram.NonNumericalMessage"})}function h(e,t){return e.filter(function(e){return l(e.qTags,t)})}var d=100;return{getDropFieldOptions:function(e,t,n,i){u(e,t,n,i)},getDropDimensionOptions:function(){s.show({text:"Visualization.Histogram.NoDimensionsMessage"})},addDimensionPopoverComponent:{name:"histogram-data",template:i.template,controller:["$scope",function(e){e.search={term:""},e.autoFocus=n.treatAsDesktop(),e.getFieldDisplayName=function(t){return""===e.search.term?t.label:o.trimAutoCalendarName(t.value)};var i=null;e.$watch("search.term",function(n){function o(){var r=a(i.fields,n);r.length>d&&(r=t.limit(r,d)),e.fields=r,e.dimensions=[]}i?o():r.getSortedFields(e.app).then(function(e){var t=h(e,"$numeric").map(function(e){var t=e.isDerived&&""===n?e.qName.substring(e.qName.lastIndexOf(".")+1,e.qName.length):e.qName;return{toolTip:e.qName,label:t,value:e.qName,trimmedValue:e.displayName,qTags:e.qTags,isDerived:e.isDerived,isDateField:e.isDateField,isGeoField:e.isGeoField}});i={fields:t},o()})})}],scope:{alignTo:"=",app:"=",addFieldDimension:"=",addLibraryDimension:"=",qvaOutsideIgnoreFor:"=",close:"=",position:"=",allowExpressionEditor:"@"}}}}),define("extensions.qliktech/histogram/histogram-export",["qvangular"],function(e){"use strict";return{getExportRawDataOptions:function(t,n,i){t.addItem({translation:"contextMenu.export",tid:"export",select:function(){e.getService("$exportDialog").show(n.model,"/qUndoExclude/box/qHyperCubeDef")}}),i.resolve()}}}),define("text!extensions.qliktech/histogram/histogram.ng.html",[],function(){return'<div class="picasso-chart qv-viz"></div>'}),define("extensions.qliktech/histogram/histogram",["translator","extensions.qliktech/histogram/histogram-view","extensions.qliktech/histogram/histogram-properties","extensions.qliktech/histogram/histogram-data","extensions.qliktech/histogram/histogram-explore-properties","extensions.qliktech/histogram/histogram-numeric-values-handler","extensions.qliktech/histogram/histogram-export","objects.utils/data-properties/hypercube-handler","objects.backend-api/hypercube-api","text!./histogram.ng.html","client.utils/property-mapper","objects.extension/object-conversion","extensions.qliktech/histogram/binning-defaults"],function(e,t,n,i,r,o,s,a,l,c,u,h,d){"use strict";return{type:"histogram",BackendApi:l,template:c,View:t,definition:n,softDefinition:r,initialProperties:{sorting:{autoSort:!0},qHyperCubeDef:{qDimensions:[],qMeasures:[],qMode:"S",qAlwaysFullyExpanded:!0,qSuppressZero:!1,qSuppressMissing:!0},bins:{auto:d.AUTO,binCount:void 0,binSize:d.BIN_SIZE,offset:d.OFFSET,countDistinct:d.COUNT_DISTINCT,binMode:d.BIN_MODE}},support:{cssScaling:!1,snapshot:!0,export:!0,exportData:!0,sharing:!0,viewData:!0},data:i,importProperties:null,exportProperties:null,exportTableProperties:function(e){var t=e.qProperty;return t.qHyperCubeDef=e.qProperty.qUndoExclude.box.qHyperCubeDef,h.hypercube.exportProperties({qProperty:t})},getDropFieldOptions:o.getDropFieldOptions,getDropDimensionOptions:o.getDropDimensionOptions,addDimensionPopoverComponent:o.addDimensionPopoverComponent,getExportRawDataOptions:s.getExportRawDataOptions,getCreatePropertyHandler:function(t){var n,i,r=this.mappedDefinition,o=this.globalChangeListeners;return this.dimensionDefinition&&(n=u.mapProperties(r.items.data.items.innerData.items.dimensions)),this.measureDefinition&&(i=u.mapProperties(r.items.data.items.innerData.items.measures)),new a({app:t,dimensionDefinition:this.dimensionDefinition,measureDefinition:this.measureDefinition,dimensionProperties:n,measureProperties:i,globalChangeListeners:o,addDimensionLabel:e.get("Visualization.Requirements.AddField")})}}}),define("text!extensions.qliktech/waterfallchart/waterfallchart.ng.html",[],function(){return'<div class="picasso-chart" style="width:100%; height:100%; position:absolute;"></div>\n<span class="qv-viz-center-disclaimer" ng-if="dataAttributes.noDataExist  && dataAttributes.layoutMode > 2" q-translation="Object.Disclaimer.NoDataExist" q-title-translation="Object.Disclaimer.NoDataExist" dir="ltr"></span>\n<div qva-chart-disclaimer attributes="dataAttributes" visible="!dataAttributes.noDataExist" direction="options.direction"></div>'}),define("extensions.qliktech/waterfallchart/waterfallchart-utils",["objects.utils/chart-style-utils"],function(e){function t(t,i){if(t.color&&t.color.auto){var r=e.getStyle(n.chartID,"shape."+i,"fill");return{index:e.Theme.currentPalette.indexOf(r),color:r}}return t.color[i].paletteColor}var n={valueTypes:{NORMAL:"NORMAL",INVERSE:"INVERSE",SUBTOTAL:"SUBTOTAL"},chartID:"waterfallChart",getColorForPositiveValue:function(n){return e.Theme.resolveColor(t(n,"positiveValue"))},getColorForNegativeValue:function(n){return e.Theme.resolveColor(t(n,"negativeValue"))},getColorForSubtotal:function(n){return e.Theme.resolveColor(t(n,"subtotal"))}};return Object.freeze(n.valueTypes),Object.freeze(n),n}),define("extensions.qliktech/waterfallchart/waterfallchart-cube-generator-by-measures",["./waterfallchart-utils","objects.utils/number-formatter"],function(e,t){function n(e){return e.qHyperCube.qMeasureInfo[0].qNumFormat}return{generateHyperCube:function(i){var r=i.qHyperCube.qMeasureInfo,o=i.qHyperCube.qDataPages[0].qMatrix,s=r.length;if(s){var a=e.getColorForPositiveValue(i),l=e.getColorForNegativeValue(i),c=e.getColorForSubtotal(i),u=new t;u.prepare("#.#A");for(var h,d,p=[],f=0,m=0,g=-Number.MAX_VALUE,v=Number.MAX_VALUE,y=-Number.MAX_VALUE,b=Number.MAX_VALUE,x=0,q=0;q<s;q++)d=isNaN(o[0][q].qNum)?0:o[0][q].qNum,r[q].valueType!==e.valueTypes.SUBTOTAL?(h=(f=m)<(m+=d*(r[q].valueType===e.valueTypes.INVERSE?-1:1))?a:l,p.push([{qText:r[q].qFallbackTitle,qElemNumber:x++},{qText:h},{qNum:f},{qNum:m},{qNum:m-f,qText:o[0][q].qText}]),r[q].subtotal&&r[q].subtotal.enable&&p.push([{qText:r[q].subtotal.label||"",qElemNumber:x++},{qText:c},{qNum:0},{qNum:m},{qNum:m,qText:u.formatValue(m)}])):(f=0,m=d,p.push([{qText:r[q].qFallbackTitle,qElemNumber:x++},{qText:c},{qNum:f},{qNum:m},{qNum:m-f,qText:o[0][q].qText}])),g=Math.max(g,f),v=Math.min(v,f),y=Math.max(y,m),b=Math.min(b,m);var C=n(i),S=i.qHyperCube.qMeasureInfo[0].qIsAutoFormat,w=i.qDef.isCustomFormatted,_={qHyperCube:{qMode:"S",qDataPages:[{qArea:{qTop:0,qLeft:0,qWidth:5,qHeight:p.length},qMatrix:p}],qDimensionInfo:[{qStateCounts:{}},{qStateCounts:{}}],qMeasureInfo:[{qMin:v,qMax:g,qNumFormat:C,qIsAutoFormat:S,isCustomFormatted:w},{qMin:b,qMax:y,qNumFormat:C,qIsAutoFormat:S,isCustomFormatted:w},{qMin:b,qMax:y,qNumFormat:C,qIsAutoFormat:S,isCustomFormatted:w}]}};i.generatedMatrix=p,i.generated=_}},generateSlicedHyperCube:function(e,t,n){e.generated.qHyperCube.qDataPages=[{qArea:{qTop:t,qLeft:0,qWidth:5,qHeight:n},qMatrix:e.generatedMatrix.slice(t,t+n)}]},getGeneratedDimensionPath:function(e){return"qDimensionInfo/"+e},getGeneratedMeasurePath:function(e){return"qMeasureInfo/"+e}}}),define("extensions.qliktech/waterfallchart/waterfallchart-view",["objects.picasso/chart-view","./waterfallchart-cube-generator-by-measures","objects.picasso/chart-builder/chart-builder","./waterfallchart-utils","core.utils/deferred","translator","objects.utils/chart-style-utils","objects.picasso/scroll/scroll-handler","objects.picasso/selections/dependent-interactions","objects.picasso/tooltip/tooltips-handler","objects.picasso/formatting","general.utils/string-util"],function(e,t,n,i,r,o,s,a,l,c,u,h){function d(e){var t=-Number.MAX_VALUE;return e.qHyperCube.qMeasureInfo.forEach(function(e){t=Math.max(t,e.qFallbackTitle.length),e.valueType!==i.valueTypes.SUBTOTAL&&e.subtotal&&e.subtotal.enable&&(t=Math.max(t,e.subtotal.label?e.subtotal.label.length:0))}),Math.min(S,Math.max(0,t))}function p(e){var t=this;return{settings:{labels:{mode:e.dimensionAxis.label,maxGlyphCount:Math.ceil(h.stringWidthOverMWidth(d(e))),maxLengthPx:function(){return t.picassoElement.getBoundingClientRect().height/3}}}}}function f(e,n){var i=e?[e.box.trigger]:[];return{data:{extract:{key:"qHyperCube",field:t.getGeneratedDimensionPath(0),props:{start:{field:t.getGeneratedMeasurePath(0)},end:{field:t.getGeneratedMeasurePath(1)},measure:{field:t.getGeneratedMeasurePath(2),reduce:"first",value:function(e){return e}},boxColor:{field:t.getGeneratedDimensionPath(1),value:function(e){return e.qText}},isCustomFormatted:!!n.qDef.isCustomFormatted,tooltip:{value:function(e){return e}}}}},settings:{major:{scale:"dimension"},minor:{scale:"measure"},orientation:"vertical",box:{width:w,maxWidthPx:4e3,fill:{fn:function(){return this.data.boxColor.value}},strokeWidth:0}},brush:{trigger:i}}}function m(e,t,n){return s.getBestContrast(e,t,n)}function g(e){var t=e.data.measure,n=e.dataset(t.source.key).field(t.source.field);return u.formatMeasureValue(n,t)}function v(){var e=s.getStyle(C,"value.color","default"),t=s.getStyle(C,"value.color","dark"),n=s.getStyle(C,"value.color","light");return{settings:{sources:[{strategy:{settings:{direction:function(e){return e.data&&e.data.end.value>e.data.start.value?"up":"down"},labels:[{placements:[{fill:e},{fill:function(e){return m(e.data.boxColor.value,t,n)}},{position:"opposite",fill:e,justify:0}],label:g}]}}}]}}}function y(e,t){return{viewSize:t,max:e.generatedMatrix.length}}function b(e){var n=s.getStyle(C,"shape.bridge","stroke");return{data:{extract:{key:"qHyperCube",field:t.getGeneratedDimensionPath(0),props:{x:{},y:{field:t.getGeneratedMeasurePath(1)}}}},settings:{x:{scale:"dimension",ref:"x",fn:function(t){return e?this.scale(t.value):this.scale(t.value)+this.scale.bandwidth()}},y:{scale:"measure"},sizeLimits:{maxPx:2e4,maxRelExtent:1e4,minRelDiscrete:0,maxRelDiscrete:1},shape:"line",stroke:n,size:1-w,strokeDasharray:"4 4",fill:"none",strokeWidth:function(e,t,n){return t===n.length-1?0:2}}}}function x(e){var t=i.getColorForPositiveValue(e),n=i.getColorForNegativeValue(e),r=i.getColorForSubtotal(e);return{displayOrder:200,minimumLayoutMode:"MEDIUM",prioOrder:0,scale:{type:"categorical-color",domain:[o.get("waterfall.legend.positiveValue.label"),o.get("waterfall.legend.negativeValue.label"),o.get("waterfall.legend.subtotal.label")],range:[t,n,r]},settings:{title:{show:!1},buttons:{show:!1}}}}function q(e){e._scrollHandler.onResize()}var C=i.chartID,S=20,w=.7;return e.extend("WaterfallChart",{namespace:".waterfallchart",chartID:C,defaultOptions:{navigation:!1,selections:!1,tooltips:!0},init:function(e,t,n,i,r,o){this._super(e,t,n,i,r,o),this.hasOption("tooltips")&&(this._tooltipHandler=c.create(this.chartInstance,o,t)),this._scrollHandler=new a(this.chartInstance,t,t[0],this.getSlicedData.bind(this),o,this.updateChart.bind(this)),this._scrollHandler.setOptions({direction:"horizontal"}),this.setDataPaths(["generated/qHyperCube"])},on:function(){this._super(),this.hasOption("tooltips")&&this._tooltipHandler.on(),this.hasOption("navigation")&&this._scrollHandler.on()},off:function(){this._super(),this.hasOption("tooltips")&&this._tooltipHandler.off(),this.hasOption("navigation")&&this._scrollHandler.off()},createChartSettings:function(e){var i,r=this.options&&"rtl"===this.options.direction,o=n.create({chartID:C,layoutMode:this.getLayoutMode(e)}),s=this.picassoElement.clientWidth,a=this.picassoElement.clientHeight;this.hasOption("tooltips")&&((i={box:{}}).box=this._tooltipHandler.setUp({data:[""],contexts:["boxTip"],componentKey:"box-marker",direction:this.options.direction,headerResolver:function(){},rowResolver:function(e,t,n){var i=n.boxColor.value,r=u.formatMeasureValue(e,t);return{value:r,label:n.tooltip.value.qText,template:'<div class="color-template-wrapper"><div class="color-dot" style="background:'+i+'"></div><span dir="ltr">'+r+"</span></div>"}},labelData:["tooltip"],measureRows:["measure"]}));var c={scrollHandler:this.hasOption("navigation")&&this._scrollHandler,selectionHandler:null},h={componentKey:"box-marker"};this._dependentActions&&this._dependentActions.destroy(),this._dependentActions=l.create(c,this.isOn.bind(this),"vertical",r,h),o.addPreset("dimension-measure-chart",{isRtl:r,orientation:"vertical",gridlines:e.gridlines,includeDimensionAxis:!0,dimensionAxisProperties:e.dimensionAxis,dimensionAxisSettings:p.call(this,e),dimensionSource:t.getGeneratedDimensionPath(0),dimensionScaleSettings:{component:{maxPxStep:function(){return a/4}}},includeMeasureAxis:!0,measureAxisProperties:e.measureAxis,measureSource:[t.getGeneratedMeasurePath(0),t.getGeneratedMeasurePath(1)],measureScaleSettings:{component:{expand:0,include:[0]}},hasNavigation:this.hasOption("navigation"),isNavigationEnabledFn:this.isOn.bind(this),scrollSettings:this.hasOption("navigation")&&y(e,this._scrollHandler.getScrollViewSizeInItem()),refLines:e.refLine&&e.refLine.refLines,brushActions:this._dependentActions.gestures}),o.addComponent("box-marker",f(i,e)),o.addComponent("point-marker",b(r)),e.legend&&!e.legend.show||o.addComponent("categorical-legend",x(e),{dock:e.legend?e.legend.dock:"auto",isRtl:r,chartWidth:s,chartHeight:a}),e.dataPoint.showLabels&&o.addComponent("labels",v());var d=o.getSettings();return this.addSnapshotChartSettings(d,e),d},updateData:function(e){var n=this;return this._super(e).then(function(){n.backendApi.isSnapshot||(t.generateHyperCube(n.layout),n.options.viewState?n._scrollHandler.setScrollState(n.options.viewState.scroll):n._scrollHandler.resetScroll(),t.generateSlicedHyperCube(n.layout,0,n._scrollHandler.getScrollViewSizeInItem()))})},resize:function(e,t){q(this),this._super(e,t)},paint:function(e){this.hasOption("tooltips")&&this._tooltipHandler.closeTooltip();var t=this.layout.generated.qHyperCube.qDataPages[0].qMatrix.length,n=this.layout.generatedMatrix.length;if(!this.backendApi.isSnapshot&&this._scrollHandler.isDataSizeChanged(t,n)){var i=this._super,r=this;return this._scrollHandler.getViewData().finally(function(){return i.call(r,e)})}return this._super(e)},getSlicedData:function(e,n){return t.generateSlicedHyperCube(this.layout,e,n),r.resolve(this.layout)},setSnapshotData:function(e){this._super(e),e.generated=this.layout.generated,e.generatedMatrix=this.layout.generatedMatrix},getViewState:function(){return{scroll:this._scrollHandler.getScrollState()}}})}),define("extensions.qliktech/waterfallchart/waterfallchart-properties",["translator","./waterfallchart-utils","client.property-panel/default-properties","client.utils/property-resolver","util"],function(e,t,n,i,r){function o(e){return!e.color.auto}var s={uses:"data",addTranslation:"Properties.AddData",items:{measures:{disabledRef:"",items:{numberFormatting:{show:!1},valueType:{type:"string",component:"dropdown",ref:"qDef.valueType",translation:"properties.waterfall.measureOperation",options:[{value:t.valueTypes.NORMAL,translation:"properties.waterfall.measureOperation.add"},{value:t.valueTypes.INVERSE,translation:"properties.waterfall.measureOperation.subtract"},{value:t.valueTypes.SUBTOTAL,translation:"properties.waterfall.measureOperation.subtotal"}],defaultValue:t.valueTypes.NORMAL},subTotal:{ref:"qDef.subtotal.enable",type:"boolean",defaultValue:!1,translation:"properties.waterfall.measureOperation.subtotal",show:function(e){return e.qDef.valueType!==t.valueTypes.SUBTOTAL}},subTotalLabel:{translation:"properties.waterfall.subtotalLabel",component:"string",expression:"optional",ref:"qDef.subtotal.label",defaultValue:function(){return e.get("properties.waterfall.measureOperation.subtotal")},show:function(e){return e.qDef.valueType!==t.valueTypes.SUBTOTAL&&e.qDef.subtotal&&e.qDef.subtotal.enable}}}}}},a={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",grouped:!0,items:{gridLines:{type:"items",snapshot:{tid:"property-gridLines"},items:{showGridLines:{ref:"gridlines.auto",type:"boolean",translation:"properties.gridLine.spacing",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},gridSpacing:{ref:"gridlines.spacing",type:"number",component:"dropdown",defaultValue:2,options:[{value:0,translation:"properties.gridLine.noLines"},{value:2,translation:"properties.gridLine.medium"},{value:3,translation:"properties.gridLine.narrow"}],show:function(e){return e.gridlines&&!e.gridlines.auto}}}},showLabels:{ref:"dataPoint.showLabels",type:"boolean",translation:"properties.dataPoints.labelmode",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}],snapshot:{tid:"property-dataPoints"}}}},colors:{translation:"properties.colorsAndLegend",type:"items",grouped:!0,items:{colors:{type:"items",items:{autoColor:{ref:"color.auto",type:"boolean",translation:"properties.colors",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}]},positiveValueColor:{ref:"color.positiveValue.paletteColor",translation:"properties.waterfall.color.positiveValueColor",type:"object",component:"color-picker",dualOutput:!0,defaultValue:{index:6,color:null},show:o},negativeValueColor:{ref:"color.negativeValue.paletteColor",translation:"properties.waterfall.color.negativeValueColor",type:"object",component:"color-picker",dualOutput:!0,defaultValue:{index:-1,color:"#cc6677"},show:o},subtotalColor:{ref:"color.subtotal.paletteColor",translation:"properties.waterfall.color.subtotalColor",type:"object",component:"color-picker",dualOutput:!0,defaultValue:{index:-1,color:"#c3c3c3"},show:o}}},legend:{type:"items",items:{show:{ref:"legend.show",type:"boolean",translation:"properties.legend.show",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"properties.off"}]},dock:{type:"string",component:"dropdown",ref:"legend.dock",translation:"properties.legend.position",options:[{value:"auto",translation:"Common.Auto"},{value:"right",translation:"properties.dock.right"},{value:"bottom",translation:"Common.Bottom"},{value:"left",translation:"properties.dock.left"},{value:"top",translation:"Common.Top"}],defaultValue:"auto",show:function(e){return i.getValue(e,"legend.show",!0)}}}}}},measureAxis:{uses:"axis.picasso.measureAxis",label:e.get("properties.yAxis"),items:{axis:{items:{show:{translation:"properties.labels",defaultValue:"labels",options:[{value:"labels",translation:"properties.labels"},{value:"none",translation:"Common.None"},null,null]}}}}},dimensionAxis:{uses:"axis.picasso.dimensionAxis",items:{othersGroup:{items:{show:{translation:"properties.labels",defaultValue:"labels",options:[{value:"labels",translation:"properties.labels"},{value:"none",translation:"Common.None"},null,null]}}}}}}},l={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{suppressZero:null,calcCond:{uses:"calcCond"}}},refLines:{uses:"reflines"}}};return{type:"items",component:"accordion",items:{data:s,numberFormatting:{translation:"properties.numberFormatting",type:"items",globalChange:function(e){e.qHyperCubeDef.qMeasures.forEach(function(t){t.qDef.numFormatFromTemplate=e.qDef.numFormatFromTemplate,t.qDef.qNumFormat=r.extend(!0,{},e.qDef.qNumFormat)})},items:{numberFormatting:r.extend(!0,{},n.measures.items.numberFormatting,{items:{numberFormattingType:{schemaIgnore:!1}}})}},addons:l,settings:a}}}),define("extensions.qliktech/waterfallchart/waterfallchart-data-definition",[],function(){return{measures:{min:1,max:15,description:function(){return"Bar"},add:function(){},move:function(){},remove:function(){}}}}),define("extensions.qliktech/waterfallchart/waterfallchart",["util","objects.backend-api/hypercube-api","text!./waterfallchart.ng.html","extensions.qliktech/waterfallchart/waterfallchart-view","extensions.qliktech/waterfallchart/waterfallchart-properties","extensions.qliktech/waterfallchart/waterfallchart-data-definition","objects.extension/object-conversion"],function(e,t,n,i,r,o,s){"use strict";return{type:"waterfallchart",BackendApi:t,template:n,View:i,definition:r,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:15,qHeight:100}],qSuppressMissing:!0}},support:{cssScaling:!1,snapshot:!0,export:!0,exportData:!0,sharing:!0},data:o,importProperties:function(t,n,i){var r=s.hypercube.importProperties.apply(s,[t,n,i]),o=r.qProperty;return"all"===o.dimensionAxis.show?o.dimensionAxis.show="labels":"title"===o.dimensionAxis.show&&(o.dimensionAxis.show="none"),"all"===o.measureAxis.show?o.measureAxis.show="labels":"title"===o.measureAxis.show&&(o.measureAxis.show="none"),o.qHyperCubeDef.qMeasures.length>0&&(o.qDef.numFormatFromTemplate=o.qHyperCubeDef.qMeasures[0].qDef.numFormatFromTemplate,o.qDef.qNumFormat=o.qHyperCubeDef.qMeasures[0].qDef.qNumFormat,o.qHyperCubeDef.qMeasures.forEach(function(t){t.qDef.numFormatFromTemplate=o.qDef.numFormatFromTemplate,t.qDef.qNumFormat=e.extend(!0,{},o.qDef.qNumFormat)})),r},exportProperties:s.hypercube.exportProperties}}),define("extensions.qliktech/straight-table/straight-table-properties",["client.property-panel/default-properties","util","client.utils/property-resolver","translator","general.utils/attribute-expression-util","core.utils/feature-flags","general.utils/support"],function(e,t,n,i,r,o,s){var a={textAlignAuto:{ref:"qDef.textAlign.auto",type:"boolean",component:"switch",translation:"Common.Text.TextAlignment",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],defaultValue:!0},textAlign:{ref:"qDef.textAlign.align",type:"string",component:"dropdown",options:[{value:"left",translation:"Common.Text.AlignLeft"},{value:"right",translation:"Common.Text.AlignRight"}],defaultValue:"left",show:function(e){return void 0!==e.qDef.textAlign&&!e.qDef.textAlign.auto}}},l={representationType:{ref:"qDef.representation.type",type:"string",component:"dropdown",translation:"Object.Table.Representation",options:[{value:"text",translation:"Object.Table.Representation.Text"},{value:"url",translation:"Object.Table.Representation.Url"}],defaultValue:"text",show:function(e){if("object"!=typeof e.qDef.representation){var t=e.qDef.representation||"text";e.qDef.representation={type:t}}return!0}},representationUrl:{ref:"qDef.representation.urlLabel",type:"string",expression:"optional",translation:"Object.Table.Representation.Url.Label",defaultValue:"",change:function(e){var t=r.getIndexById(e.qAttributeExpressions,r.IDMAP.CELL_URL_LABEL);if(e.qDef.representation.urlLabel.qStringExpression){var n=e.qDef.representation.urlLabel.qStringExpression.qExpr;-1===t?e.qAttributeExpressions.push({id:r.IDMAP.CELL_URL_LABEL,qExpression:n}):e.qAttributeExpressions[t].qExpression=n}else e.qAttributeExpressions&&t>-1&&e.qAttributeExpressions.splice(t,1)},show:function(e){var t=e.qDef.representation;return t&&"url"===t.type}}},c={tableCellColoring:{component:"attribute-expression-reference",defaultValue:[],ref:"qAttributeExpressions",items:[{component:"expression",ref:"qExpression",expressionType:"measure",translation:"Object.Table.Measure.BackgroundExpression",defaultValue:"",id:r.IDMAP.CELL_BACKGROUND_COLOR,tid:"tableColorBgByExpression"},{component:"expression",ref:"qExpression",expressionType:"measure",translation:"Object.Table.Measure.ForegroundExpression",defaultValue:"",id:r.IDMAP.CELL_FOREGROUND_COLOR,tid:"tableColorByExpression"}]},totalsAggr:{type:"items",items:{totalsAggrFunc:{type:"string",component:"dropdown",ref:"qDef.qAggrFunc",translation:"Object.Table.AggrFunc",options:[{value:"Expr",translation:"Common.Auto"},{value:"Avg",translation:"Object.Table.AggrFunc.Avg"},{value:"Count",translation:"Object.Table.AggrFunc.Count"},{value:"Max",translation:"Object.Table.AggrFunc.Max"},{value:"Min",translation:"Object.Table.AggrFunc.Min"},{value:"Sum",translation:"Object.Table.AggrFunc.Sum"},{value:"None",translation:"Object.Table.AggrFunc.None"}],defaultValue:"Expr"},totalsAggrFuncMessage:{component:"text",translation:"Object.Table.AggrFuncMessage",show:function(e,t){return t&&!n.getValue(t,"properties.totals.show")&&"noTotals"===n.getValue(t,"properties.totals.position")}}}}},u={tableCellColoring:{component:"attribute-expression-reference",defaultValue:[],ref:"qAttributeExpressions",items:[{component:"expression",ref:"qExpression",expressionType:"measure",translation:"Object.Table.Measure.BackgroundExpression",defaultValue:"",id:r.IDMAP.CELL_BACKGROUND_COLOR,tid:"tableColorBgByExpression"},{component:"expression",ref:"qExpression",expressionType:"measure",translation:"Object.Table.Measure.ForegroundExpression",defaultValue:"",id:r.IDMAP.CELL_FOREGROUND_COLOR,tid:"tableColorByExpression"},{component:"expression",ref:"qExpression",expressionType:"measure",defaultValue:"",id:r.IDMAP.CELL_URL_LABEL,tid:"URLLabelByExpression",show:!1}]}},h={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",items:[{ref:"totals.show",type:"boolean",translation:"properties.totals",component:"switch",options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],defaultValue:!0},{ref:"totals.position",translation:"Common.Position",type:"string",component:"dropdown",options:[{value:"noTotals",translation:"Common.None"},{value:"top",translation:"Common.Top"},{value:"bottom",translation:"Common.Bottom"}],defaultValue:"noTotals",show:function(e){return!e.totals.show}},{ref:"totals.label",translation:"properties.totals.label",type:"string",expression:"optional",defaultValue:function(){return i.get("Object.Table.Totals")}}]}}};o.ST_HSCROLL&&(h.items.presentation.grouped=!0,h.items.presentation.items=[{type:"items",items:h.items.presentation.items},{type:"items",translation:"Object.Table.Scrolling",items:[{component:"text",translation:"Object.Table.Scrolling"},{ref:"scrolling.keepFirstColumnInView",type:"boolean",translation:"Object.Table.Scrolling.KeepFirstColumnInView",component:"checkbox",defaultValue:!1}],show:function(){return s.treatAsDesktop()}},{type:"items",translation:"Object.Table.WrapText",items:[{component:"text",translation:"Object.Table.Multiline"},{ref:"multiline.wrapTextInHeaders",type:"boolean",translation:"Object.Table.Multiline.WrapTextInHeaders",component:"checkbox",defaultValue:!0},{ref:"multiline.wrapTextInCells",type:"boolean",translation:"Object.Table.Multiline.WrapTextInCells",component:"checkbox",defaultValue:!0}]}]);var d={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{calcCond:{uses:"calcCond"}}}}};return{type:"items",component:"accordion",items:{data:{type:"items",component:"columns",translation:"Common.Data",sortIndexRef:"qHyperCubeDef.qColumnOrder",allowMove:!0,allowAdd:!0,addTranslation:"Common.Columns",items:{dimensions:{type:"array",component:"expandable-items",ref:"qHyperCubeDef.qDimensions",grouped:!0,items:t.extend(!0,{},e.dimensions.items,u,a,l)},measures:{type:"array",component:"expandable-items",ref:"qHyperCubeDef.qMeasures",grouped:!0,items:t.extend(!0,{},e.measures.items,c,a)}}},sorting:{uses:"sorting"},addons:d,settings:h}}}),define("text!extensions.qliktech/straight-table/straight-table.ng.html",[],function(){return'<div class="qv-st" ng-class="{ \'qv-st-interactive\': interactive,\n\t\t\'qv-st-links-interactive\': linksInteractive,\n\t\t\'align-column-picker\': scrollApi.settings.columnPicker.show,\n\t\t\'qv-st-selections-active\': selections.active,\n\t\t\'qv-st-virtual-scroll-enabled\': scrollApi.virtualScrollEnabled,\n\t\t\'qv-st-navigatable\': navigatable,\n\t\t\'qv-rtl-layout\': rtl,\n\t\t\'qv-st-nowrap-in-headers\': !multiline.wrapTextInHeaders,\n\t\t\'qv-st-nowrap-in-cells\': !multiline.wrapTextInCells,\n\t\t\'qv-st-reordering-active\': reorderingColumn\n\t}">\n\t<div class="qv-st-header-wrapper" dir="{{direction}}">\n\t\t<qv-table-column-width-adjuster\n\t\t\t\tmin-col-width="scrollApi.settings.column.minColWidth"\n\t\t\t\tng-if="navigatable && !selections.active"\n\t\t\t\tcolumns="columns"\n\t\t\t\texplicit-column-widths="visibleExplicitColumnWidths"\n\t\t\t\tx-rtl="rtl"\n\t\t\t\tdir="{{direction}}">\n\t\t</qv-table-column-width-adjuster>\n\t\t<qv-straight-table-top-header></qv-straight-table-top-header>\n\t</div>\n\t<qv-scroll-area class="qv-grid-object-scroll-area qv-animate" dir="{{direction}}"\n\t\t\t\t\tx-direction="direction">\n\t\t<qv-straight-table-data qv-selections-select-while-locked="selectWhileLocked()"\n\t\t\t\t\t\t\t\tqv-selections-toggle-dimension-value="{ selector: \'.qv-st-data-cell\'}"\n\t\t\t\t\t\t\t\tqv-selections-on-toggle-dimension-value="interactive && selectDimensionValue(cell, $event)"\n\t\t\t\t\t\t\t\tqv-selections-multiselect="{ selector: \'.qv-st-data-cell:not(.qv-st-data-cell-null-value)\' }"\n\t\t\t\t\t\t\t\tqv-selections-start-multiselect="interactive && activateSelections(cell)"\n\t\t\t\t\t\t\t\tqv-selections-update-multiselect="interactive && multiselectDimensionValues(start, current, dataColIx)"\n\t\t\t\t\t\t\t\tqv-selections-end-multiselect="interactive && multiselect()"></qv-straight-table-data>\n\t</qv-scroll-area>\n\t<qv-straight-table-bottom-header></qv-straight-table-bottom-header>\n\t<qv-scroll-loader></qv-scroll-loader>\n\t<qv-straight-table-column-picker-activator ng-if="scrollApi.settings.columnPicker.show"></qv-straight-table-column-picker-activator>\n</div>\n'}),define("extensions.qliktech/straight-table/snapshot/snapshot-helper",["jquery"],function(e){return{getIndexHeightAndWidth:function(t,n,i,r){for(var o,s,a=i.top+i.height,l=0;l<t.length;){if(e(t[l]).offset().top+e(t[l]).height()>i.top){o=t[l];break}l++}for(l=t.length-1;l>=0;){if(e(t[l]).offset().top<a){s=t[l];break}l--}if(!o||!s||n<=0)return{index:1,height:r?2:1,width:n||1};var c=e(o).scope().row.getIndex();return{index:c,height:e(s).scope().row.getIndex()-c+1,width:n}}}}),define("extensions.qliktech/straight-table/straight-table-dom-api",["jquery","general.scroll/api/dom-api"],function(e,t){"use strict";var n=t.extend({init:function(e,t,n,i,r,o,s,a){this.snapshotObject=s,this.options=a,this._super.apply(this,arguments)},getBoundingBox:function(){return this.options.freeResize?this.$element[0].getBoundingClientRect():{height:this.snapshotObject.size.h,width:this.snapshotObject.size.w}},bindNativeHorizontalScroll:function(){}}),i=t.extend({getScrollAreaClientHeight:function(){var e=this.getScrollAreaBoundingBox();return this.getBoundingBox().bottom-e.top},getScrollAreaBoundingBox:function(){return e.extend(!0,{},this._super.call(this))}}),r=i.extend({init:function(e,t,n,i,r,o,s){this._super.apply(this,arguments),this.columnPicker=s},getBoundingBox:function(){var t=e.extend(!0,{},this._super.call(this));return this.$element.find(".qv-st-column-picker").length>0&&(t.width+=this.columnPicker.width),t}}),o=i.extend({init:function(e){var t=Array.prototype.slice.call(arguments);t[0]=e.closest(".qv-object-content-container"),this._super.apply(this,t),this.$element.css("-webkit-overflow-scrolling","touch"),this.$element.find(".qv-object-content").first().css({overflow:"hidden",width:"inherit"})},destroy:function(){this._super(),this.unbindNativeHorizontalScroll()},unbindNativeHorizontalScroll:function(){this.$element.off("scroll"+this.namespace)},bindNativeHorizontalScroll:function(e){this.$element.on("scroll"+this.namespace,e)},getScrollAreaBoundingBox:function(){var e=this._super.call(this);return e.width=this.$element[0].clientWidth+this.$element[0].scrollLeft,e.right=e.left+e.width,e},getScrollAreaClientWidth:function(){return this.$element[0].clientWidth},updateHorizontalScroll:function(e){e.locked?this.$element.css({overflow:"hidden"}):this.$element.css({overflow:e.tableWidth>e.viewportWidth+1?"auto":"",direction:e.direction})},getHorizontalScroll:function(){return this.$element.scrollLeft()},setHorizontalScroll:function(e){this.$element.scrollLeft(e)}}),s=i.extend({});return{create:function(e,t,i,a){return e.backendApi.isSnapshot?new n(t,i,".qv-st-data-row","","",null,e.layout.snapshotData.object,e.options):a.horizontalScroll.enabled?a.horizontalScroll.useNativeScroll?new o(t,i,".qv-st-data-row",".qv-grid-object-data-first-row",".qv-grid-object-data-last-row"):new s(t,i,".qv-st-data-row",".qv-grid-object-data-first-row",".qv-grid-object-data-last-row"):new r(t,i,".qv-st-data-row",".qv-grid-object-data-first-row",".qv-grid-object-data-last-row",null,a.columnPicker)},SnapshotScrollDOMApi:n,ColumnPickerTableScrollDOMApi:r,NativeHorizontalTableScrollDOMApi:o,VirtualHorizontalTableScrollDOMApi:s}}),define("objects.grid/data-grid",["core.utils/class","client.utils/rtl/rtl-util"],function(e,t){var n,i,r,o,s,a,l;return i=e.extend("ClassList",{init:function(){this.classList=[]},addClass:function(e){if(e)return-1===this.classList.indexOf(e)&&this.classList.push(e),this},removeClass:function(e){if(e){var t=this.classList.indexOf(e);return-1!==t&&this.classList.splice(t,1),this}},hasClass:function(e){return-1!==this.classList.indexOf(e)}}),r=i.extend("Cell",{init:function(){this._super.apply(this,arguments),this.setDefaults()},setDefaults:function(){this.classList.length=0,this.style={},this.color={},this.colspan=1,this.rowspan=1,this.text="",this.displayText="",this.dataValue=-1,this.dataColIx=-10,this.dataRowIx=-1,this.isDimensionValue=!1,this.type=void 0,this.locked=!1,this.isNullValue=!1,this.value="",this.tid="",this.dir="auto",this.isRtl=!1,this.isTotal=!1,this.fieldName=""},setText:function(e){var n=t.detectTextDirection(e);this.text=e,this.dir=t.supportDirAuto()?"auto":n,this.isRtl="rtl"===n},setData:function(e,t,n,i,r){this.setText(e),this.rowspan=t||1,this.colspan=n||1,this.dataRowIx=i||-1,this.dataColIx=r||-1},setHeader:function(e,t,n,i,r,o,s,a){this.setText(e),this.dataValue=t,this.rowspan=n||1,this.colspan=i||1,this.dataRowIx=r,this.dataColIx=o,this.isTotal=a,this.templateSrc="pt-header-cell-item.ng.html",this.addClass("header"),this.setNullClass(s)},setTopHeader:function(){this.setHeader.apply(this,arguments),this.addClass("top")},setLeftHeader:function(){this.setHeader.apply(this,arguments),this.addClass("left")},setFromMetaHeader:function(e){Object.keys(e).forEach(function(t){this[t]=e[t]},this),this.setText(e.text),this.setTextAlign(e.autoAlignText,e.explicitTextAlign)},setNullClass:function(e){e&&(this.isNullValue=e,this.addClass("null-value"))}}),Object.defineProperties(r.prototype,{REPRESENTATION_URL:{value:"url"},REPRESENTATION_TEXT:{value:"text"}}),s=r.extend("StraightCell",{setDefaults:function(){this._super.apply(this,arguments),this.isNumeric=!1,this.textAlign="left",this.color.bgByExpression=!1,this.color.bgIsDark=!1,this.selected=!1,this.selectedHighlighted=!1,this.qvaOutsideIgnoreFor="",this.isSearchIcon=!1,this.open=!1,this.sortable=!1,this.isMeasure=!1,this.isSorted=!1,this.reversed=!1,this.isSelectLocked=!1,this.columnHighlighted=this.columnHighlighted||!1,this.hidden=!1},getAutoTextAlign:function(){return this.isNumeric?"right":this.isRtl?"right":"left"},setTextAlign:function(e,t){this.textAlign=e?this.getAutoTextAlign():t||"left"}}),a=r.extend("PivotCell",{setDefaults:function(){this._super.apply(this,arguments),this.templateSrc="pt-cell-item.ng.html",this.collapseExpandClass="",this.isMeta=!1},setCollapseExpandClass:function(e){this.addClass("parent"),e.qCanExpand?this.collapseExpandClass="lui-icon--plus":e.qCanCollapse&&(this.collapseExpandClass="lui-icon--minus")},setEmpty:function(e,t,n){this.setHeader("",-4,e,t),this.addClass("empty"),this.addClass(n)}}),o=i.extend("Row",{init:function(e){this._super.apply(this,arguments),this.cells=[],this.style={},this.isBold=!1,this.classList=[],this.gridType=e,this.reset()},getIndex:function(){var e,t;for(t=0;t<this.cells.length;++t)if((e=this.cells[t]).dataRowIx>=0)return e.dataRowIx;return-1},setNextCellIx:function(e){this.nextCellIx=e},reset:function(e){var t;for(this.nextCellIx=0,this.isBold=!1,e||(this.classList=[]),t=0;t<this.cells.length;++t)this.cells[t].setDefaults()},removeUnused:function(){this.cells.splice(this.nextCellIx,this.cells.length-this.nextCellIx)},_createCell:function(){switch(this.gridType){case"pivot":return new a;default:return new s}},getCell:function(e){return this.cells[e]||(this.cells[e]=this._createCell()),this.cells[e]},getColIx:function(e){return this.cells.indexOf(e)},getPreviousCell:function(e){var t=this.getColIx(e);if(t>0)return this.getCell(t-1)},getNextCell:function(){var e;return this.cells[this.nextCellIx]?(e=this.cells[this.nextCellIx]).setDefaults():e=this.cells[this.nextCellIx]=this._createCell(),this.nextCellIx++,e},getCellSize:function(){return this.nextCellIx},addEmptyHeaderCell:function(e,t,n,i,r,o){var s=this.getNextCell();return s.setEmpty(n,i,r),s.setData("",n,i,e,t),s.setNullClass(o),s},addEmptyMetaCell:function(e,t,n){var i=this.addEmptyHeaderCell(-1,-1,e,t,n);return i.isMeta=!0,i},addEmptyDataCell:function(e,t){var n=this.getNextCell();return n.setData("",-4,e,t),n.addClass("empty"),n},addTotalCell:function(e,t,n){var i=this.getNextCell();return i.setHeader(e,-1,t,n),i.addClass("bold"),this.addClass("bold"),i},addLeftCollapseExpandCell:function(e,t,n,i,r){var o=this.getNextCell();return o.setLeftHeader("",-1,1,1,e,t,i,r),o.setCollapseExpandClass(n),o}}),l=e.extend("RowList",{init:function(e){this.rows=[],this.gridType=e},reset:function(e){this.rows.forEach(function(t){t.reset(e)}),this.nextRowIx=0},get:function(e){return this.rows[e]||(this.rows[e]=new o(this.gridType)),this.rows[e]},getNext:function(){var e=this.get(this.nextRowIx);return this.nextRowIx++,e},removeUnused:function(){this.rows.splice(this.nextRowIx,this.rows.length-this.nextRowIx),this.rows.forEach(function(e){e.removeUnused()})},setNextRowIx:function(e){this.nextRowIx=e}}),n=e.extend("DataGrid",{init:function(e){this.headerList=new l(e),this.rowList=new l(e),this.footerList=new l(e),this.gridType=e,this.reset()},setTopTreeDepth:function(e){this.topTreeDepth=e},setLeftTreeDepth:function(e){this.leftTreeDepth=e},reset:function(e,t){this.rowList.reset(),e||(this.headerList.reset(t),this.footerList.reset(t)),this.topTreeDepth=-1,this.leftTreeDepth=-1},getRowsByCellType:function(e){return e===this.CELL_TYPE_DATA||e===this.CELL_TYPE_LEFT?this.rows:this.headerRows},getRow:function(e){return this.rowList.get(e)},getHeaderRow:function(e){return this.headerList.get(e)},getFooterRow:function(e){return this.footerList.get(e)},getNextRow:function(){return this.rowList.getNext()},getNextHeaderRow:function(){return this.headerList.getNext()},getNextFooterRow:function(){return this.footerList.getNext()},getCell:function(e,t){return this.getRow(e).getCell(t)},getHeaderCell:function(e,t){return this.getHeaderRow(e).getCell(t)},getFooterCell:function(e,t){return this.getFooterRow(e).getCell(t)},removeUnused:function(){this.rowList.removeUnused(),this.headerList.removeUnused(),this.footerList.removeUnused()},getNextRowIx:function(){return this.rowList.nextRowIx},setNextRowIx:function(e){this.rowList.setNextRowIx(e)},setNextHeaderIx:function(e){this.headerList.setNextRowIx(e)}}),Object.defineProperties(n.prototype,{headerRows:{get:function(){return this.headerList.rows}},footerRows:{get:function(){return this.footerList.rows}},rows:{get:function(){return this.rowList.rows}},GRID_TYPE_STRAIGHT:{value:"straight"},GRID_TYPE_PIVOT:{value:"pivot"},CELL_TYPE_TOP:{value:"top"},CELL_TYPE_LEFT:{value:"left"},CELL_TYPE_DATA:{value:"data"}}),n}),define("extensions.qliktech/straight-table/straight-table-scroll-api",["general.scroll/api/vertical-scroll-api"],function(e){"use strict";return e.extend({interactive:!1,init:function(e,t){this._super(e,t),this.virtualScrollEnabled||(this.settings.horizontalScroll.useVirtualScroll=!1,this.settings.horizontalScroll.enabled=this.settings.horizontalScroll.useVirtualScroll||this.settings.horizontalScroll.useNativeScroll),this.direction="ltr"},initialize:function(e,t,n,i){var r;return this.settings.horizontalScroll.enabled&&this.settings.horizontalScroll.useNativeScroll&&e.bindNativeHorizontalScroll(function(){n.fadeScrollbarsWithoutDelay(),this.$timeout.cancel(r),r=this.$timeout(function(){n.fadeInScrollbars(),this.setVirtualSize(!0)}.bind(this),100)}.bind(this)),this._super(e,t,n,i)},activate:function(){this._super(),this.interactive=!0},deactivate:function(){this._super(),this.interactive=!1},setDirection:function(e){this.direction=e},updateHorizontalScroll:function(){this.settings.horizontalScroll.enabled&&this.interactive&&this.settings.horizontalScroll.useNativeScroll&&this.domApi.updateHorizontalScroll({locked:this.horizontalPositionLocked,viewportWidth:this.settings.width-(this.settings.columnPicker.show?this.settings.columnPicker.width:0),tableWidth:this.getAllColumnsWidth()})},columnWidths:null,columnsInViewport:0,updateMetaHeaders:function(e,t){if(this.columnWidths=e.reduce(function(e,t){return t.isFillColumn||(t.isSearchIcon?e.length>0&&(e[e.length-1]+=t.calculatedWidth):e.push(t.calculatedWidth)),e},[]),this.columnsInViewport=this.columnWidths.length,this.settings.horizontalScroll.enabled&&this.settings.horizontalScroll.useVirtualScroll){var n,i=this.domApi.getScrollAreaClientWidth()-this.getLockedColumnsWidth(),r=Math.floor(this.virtualScrollApi.getVirtualPosition().vPosX/this.settings.minColumnWidth),o=this.settings.horizontalScroll.keepFirstColumnInView?1:0,s=0;for(this.columnsInViewport=o,n=r+o;n<this.columnWidths.length&&(((s+=this.columnWidths[n])<=i||n==r+o)&&this.columnsInViewport++,!(s>i));++n);if((!t||!t.lockScrollPosition)&&r>0&&s<i)for(n=r-1;n>=0&&(s+=this.columnWidths[n+o])<=i;--n)this.columnsInViewport++,r--;if(r>0){var a=-1;e.forEach(function(e){e.isFillColumn||(e.isSearchIcon||(a+=1),e.shouldBeRemoved=a>=o&&a<r+o)});var l=0;for(n=e.length-1;n>=0;--n)e[n].shouldBeRemoved&&(l+=e[n].calculatedWidth,e.splice(n,1));for(n=0;n<e.length;++n)if(e[n].isFillColumn){e[n].style.width=Math.max(0,l)+"px";break}}}},scrollColumnInView:function(e,t){function n(e){return e?e.reduce(function(e,t){return e+t},0):0}if(this.settings.horizontalScroll.enabled){var i=t.filter(function(e){return!e.isSearchIcon&&!e.isFillColumn}).filter(function(t){return t.dataColIx===e})[0];if(i){var r=i.qLeft,o=n(this.columnWidths.slice(0,r)),s=this.columnWidths[r],a=this.domApi.getScrollAreaClientWidth();if(this.settings.horizontalScroll.useNativeScroll){var l=this.domApi.getHorizontalScroll();l>o?l=Math.max(0,o-5):l+a<o+s&&(l=o+s-a+5),l!==this.domApi.getHorizontalScroll()&&this.domApi.setHorizontalScroll(l)}else{var c=this.virtualScrollApi.getVirtualPosition(),u=Math.floor(c.vPosX/this.settings.minColumnWidth),h=this.columnWidths.slice();if(this.settings.horizontalScroll.keepFirstColumnInView){var d=h.shift();o-=d,a-=d,r--}if(u>0&&(o-=n(h.slice(0,u))),o+s>a){for(var p=s,f=r,m=r-1;m>=0&&!((p+=h[m])>a);--m)f=m;this.virtualScrollApi.setVirtualViewport({width:(r-f+1)*this.settings.minColumnWidth,height:this.domApi.getVisibleRowCount(this.settings.maxRowHeight)*this.settings.minRowHeight}),this.virtualScrollApi.scroll(f*this.settings.minColumnWidth-c.vPosX,0)}}}}},horizontalPositionLocked:!1,lockHorizontalScrollPosition:function(e){this.settings.horizontalScroll.enabled&&(this.horizontalPositionLocked=e,this.settings.horizontalScroll.useNativeScroll?this.updateHorizontalScroll():this.virtualScrollApi.setHorizontalScrollInteractive(!e))},getVirtualScrollAmount:function(e,t,n){return this.horizontalPositionLocked&&(e=0),this.settings.horizontalScroll.enabled&&(0!==e&&0!==t&&(Math.abs(e)>Math.abs(t)?t=0:e=0),1===n&&0!==e)?{deltaX:e*this.settings.minColumnWidth,deltaY:0}:this._super(e,t,n)},getLockedColumnsWidth:function(){var e=0;return this.settings.horizontalScroll.enabled&&this.settings.horizontalScroll.keepFirstColumnInView&&this.columnWidths&&this.columnWidths.length>0&&(e=this.columnWidths[0]),e},getAllColumnsWidth:function(){return this.columnWidths?this.columnWidths.reduce(function(e,t){return e+t},0):0},getScrollableColumnsWidth:function(){if(!this.columnWidths||0===this.columnWidths.length)return 0;var e=0;return this.settings.horizontalScroll.enabled&&this.settings.horizontalScroll.keepFirstColumnInView&&(e=1),this.columnWidths.slice(e).reduce(function(e,t){return e+t},0)},getScrollableColumnsCount:function(){if(!this.columnWidths)return 0;var e=this.columnWidths.length;return this.settings.horizontalScroll.enabled&&this.settings.horizontalScroll.keepFirstColumnInView&&(e-=1),e},getScrollableColumnsInViewport:function(){var e=this.columnsInViewport;return e>0&&this.settings.horizontalScroll.enabled&&this.settings.horizontalScroll.keepFirstColumnInView&&(e-=1),e},onSetVirtualSize:function(e){var t,n,i,r,o=this.domApi.getScrollAreaBoundingBox(),s=this.domApi.getScrollContentBoundingBox(),a=this.virtualScrollApi.getVirtualPosition(),l=this.settings.minRowHeight*this.totalRows,c=this.getScrollableColumnsInViewport();"reduce"===this.settings.alignToBottom?(t=this.domApi.getVisibleRowCount(this.settings.maxRowHeight),s.height>=o.height&&this.settings.viewportRowCount>=this.totalRows&&t<this.settings.viewportRowCount&&(this.settings.viewportRowCount=t),i={width:c*this.settings.minColumnWidth,height:t*this.settings.minRowHeight}):i={width:c*this.settings.minColumnWidth,height:o.height};var u=this.getLockedColumnsWidth(),h=this.getScrollableColumnsCount();n={width:this.settings.minColumnWidth*h,height:l},r={top:0,left:"rtl"!==this.direction?u:0,width:o.width-u,height:o.height},this.virtualScrollApi.setVirtualSize(n,i,r),e?this.virtualScrollApi.scroll(a.vPosX,a.vPosY,!0):this.virtualScrollApi.scroll(Math.min(a.vPosX,(h-c)*this.settings.minColumnWidth),0,!0)},updateVirtualViewport:function(){var e=this.domApi.getVisibleRowCount(this.settings.maxRowHeight),t=this.domApi.getScrollAreaBoundingBox(),n=this.getLockedColumnsWidth();this.virtualScrollApi.setViewport({top:0,left:"rtl"!==this.direction?n:0,width:t.width-n,height:t.height}),this.virtualScrollApi.setVirtualViewport({width:this.getScrollableColumnsInViewport()*this.settings.minColumnWidth,height:e*this.settings.minRowHeight})},onVirtualScroll:function(e,t){this.Scroll.emit();var n=this.virtualScrollApi.getVirtualPosition(),i=this.domApi.getVisibleRowCount(this.settings.maxRowHeight),r=this.getPage(n);return r.top>0&&r.top+i>this.totalRows&&(r.top=Math.max(0,this.totalRows-i),r.height=Math.min(this.totalRows,r.height)),r.left>0&&r.left+r.width>this.totalColumns&&(r.left=Math.max(0,this.totalColumns-r.width),r.width=Math.min(this.totalColumns,r.width)),this.axisDelta.xAxis=e,this.axisDelta.yAxis=t,this.dataApi.onVirtualScroll(r.top,r.height,r.left,r.width,e,t).then(function(){this.updateVirtualViewport()}.bind(this))}})}),define("extensions.qliktech/straight-table/migration/column-order-adapter",["client.utils/hard-properties-checker","client.utils/state"],function(e,t){function n(e,t){return(void 0!==t||0!==e.length)&&(e.every(function(e,n){return e===t[n]})&&e.length===t.length)}function i(n,i){return e.canModifyHardProperties(t,n,i)}function r(e,t){return e&&e.length>0&&t&&0===t.length}function o(e,t){return t&&t.length>0&&e&&0===e.length||!n(t,e)}function s(e){return e&&e.qHyperCube&&e.qHyperCube.qColumnOrder&&e.qHyperCube.qColumnOrder.length>0}function a(e,t){return l(e)||s(t)}function l(e){return e&&e.qColumnOrder&&e.qColumnOrder.length>0}function c(e,t){var n,i=e&&e.qHyperCube,r=i&&i.qDataPages,o=i&&i.columnOrder,s=i&&i.qColumnOrder;return r&&r.length&&r.forEach(function(i){i&&i.qArea&&i.qArea.qLeft===e.qHyperCube.qColumnOrder[t]&&(n=o.indexOf(e.qHyperCube.qColumnOrder[t]))}),r&&r.length&&r.length===s.length&&void 0===n&&(n=r[t].qArea.qLeft),n}return{migrateProperties:function(e){var t=e&&e.qHyperCubeDef;return t&&r(t.columnOrder,t.qColumnOrder)?t.qColumnOrder=t.columnOrder:t&&o(t.columnOrder,t.qColumnOrder)&&(t.columnOrder=t.qColumnOrder),e},migrateSnapshot:function(e){var t=e.qHyperCube;if(!t.columnOrder||t.qColumnOrder&&t.columnOrder===t.qColumnOrder){t.columnOrder=new Array(t.qColumnOrder.length);for(var n=0;n<t.columnOrder.length;n++)t.columnOrder[n]=n}else{var i=new Array(t.qDataPages.length);t.columnOrder.forEach(function(e,n){i[n]=t.qDataPages[e]}),t.qDataPages=i}return e},getColumnOrder:function(e){var t=e.qColumnOrder,n=e.columnOrder;return t&&t.length>0?t:n},getColumnDataIndex:function(e,t){var n=e.qHyperCube.columnOrder,i=e.qHyperCube.qColumnOrder;return n&&n.length>i.length?n[t]:e.qHyperCube.qColumnOrder.length>0?e.qHyperCube.qColumnOrder[t]:t},getLeftOfDataArea:function(e,t,n,i){var r=c(n,t);return r||(a(n.qHyperCube,i)?n.qHyperCube.qColumnOrder.indexOf(e.qLeft):e&&e.qLeft)},useNewColumnOrderIdx:a,updatePropertiesOnRefresh:function(e,t){r(t.columnOrder,t.qColumnOrder)&&e&&e.model&&e.model.getEffectiveProperties&&e.model.getEffectiveProperties().then(function(t){if(i(e.model,t))t.qHyperCubeDef.qColumnOrder=t.qHyperCubeDef.columnOrder,e.model.setProperties(t),e.model.app.clearUndoBuffer();else{var n=[{qPath:"/qHyperCubeDef/qColumnOrder",qOp:"add",qValue:JSON.stringify(t.qHyperCubeDef.columnOrder)}];e.applyPatches(n,!0)}})},findLeftForSnapshots:c}}),define("objects.grid/services/data-service",["qvangular","translator","general.utils/color","encoder","general.utils/attribute-expression-util","extensions.qliktech/straight-table/migration/column-order-adapter"],function(e,t,n,i,r,o){"use strict";function s(e,t,n,i){return!!Array.isArray(e)&&(!i||e.length===t.length+n.length)}function a(e){var t=e.qHyperCube.qColumnOrder,n=e.qHyperCube.qDimensionInfo,i=e.qHyperCube.qMeasureInfo;return s(t,n,i,!1)?t:l(n,i)}function l(e,t){var n,i=[],r=e.length,o=t.length;for(n=0;n<r;++n)i.push(n);for(n=0;n<o;++n)i.push(r+n);return i}function c(e,t){var n,i,r,o=[];for(i=e.rows.length,n=0;n<i;++n)t<(r=e.rows[n]).cells.length&&t>=0&&o.push(r.cells[t]);return o}function u(e,t,n,i){var r,o,s=h(e,t,n),a=s.length,l=[];for(o=0;o<a;++o)(r=s[o]).dataValue===i&&l.push(r);return l}function h(e,t,n){var i,r,o,s,a=e.getRowsByCellType(t),l=a.length,c=null,u=[];for(i=0;i<l;++i)for(s=(o=a[i]).cells.length,r=0;r<s;++r)(c=o.cells[r]).type===t&&c.dataColIx===n&&u.push(c);return u}function d(e,t,n){var i,r,o,s,a,l=e.getRowsByCellType(t),c=l.length,u=[];for(i=0;i<c;++i)for(a=(o=l[i]).cells.length,r=0;r<a;++r)(s=o.cells[r]).type===t&&s.dataRowIx===n&&u.push(s);return u}function p(e,t,n,i){var r,o,s,a,l=e.getRowsByCellType(t),c=l.length,u=null;for(r=0;r<c;++r)for(a=(s=l[r]).cells.length,o=0;o<a;++o)if((u=s.cells[o]).dataColIx===n&&u.dataRowIx===i)return u;return null}function f(e,t,n){var i=n.isIndentMode?1:e.leftTreeDepth;return e.getHeaderCell(e.topTreeDepth,t+i)}function m(e,t){return t.type===e.CELL_TYPE_LEFT||t.type===e.CELL_TYPE_DATA?h(e,t.type,t.dataColIx):d(e,t.type,t.dataRowIx)}function g(e,t,n){var i,r,o=m(e,t),s=o.length,a=[];for(r=0;r<s;++r)(i=o[r]).dataValue===n&&a.push(i);return a}function v(e,t){var n=t.qHyperCube.qDimensionInfo.length,i=o.getColumnDataIndex(t,e);return i<n?t.qHyperCube.qDimensionInfo[i]:t.qHyperCube.qMeasureInfo[i-n]}function y(e,t){var n=t.qGrandTotalRow[e-t.qDimensionInfo.length];return n&&n.qText||(n={qText:""}),n}function b(e){if(e)return"qDimensionType"in e}function x(e){return void 0===e.textAlign||e.textAlign.auto}function q(e){return e.textAlign&&e.textAlign.align}function C(e){var t=e&&e.representation;return t?"object"!=typeof t?{type:t}:t:{}}function S(e,t,n,i,r,o,s,a,l){var c,u,h,d,p,f,m,g,v;for(c=0;c<o.length;++c)v=M(u=o[c])||!!l,g=a.getDimInfo(a.leftDimCnt+i),(d=(h=r.getHeaderRow(e)).getNextCell()).type=r.CELL_TYPE_TOP,d.locked=!I(u)&&g.qLocked,d.isDimensionValue=!(I(u)||_(u)||v||A(u)),p=u.qText,_(u)&&((f=a.leftCellCnt+t)>=a.pseudoDimIndex&&f--,p=a.layout.qHyperCube.qDimensionInfo[f].othersLabel),d.setTopHeader(p,u.qElemNo,1,1,t,s+n,D(u),v),(v||u.qCanCollapse||u.qCanExpand)&&(d.addClass("bold"),d.setCollapseExpandClass(u),h.addClass("bold")),u.qSubNodes.length?(m=S(e+1,t+1,n,i+1,r,u.qSubNodes,s,a,v),d.colspan=m-n,n=m):n++;return n}function w(e,t,n,i){i.dataColumnsInfo.cnt<=0||(S(1,0,0,0,e,t,n,i),e.setNextHeaderIx(e.topTreeDepth+1),e.headerRows[e.topTreeDepth].addClass("last-top-row"))}function _(e){return-3===e.qElemNo}function D(e){return-2===e.qElemNo}function M(e){return-1===e.qElemNo}function A(e){return-4===e.qElemNo}function E(e){return M(e)||A(e)}function I(e){return"P"===e.qType}function T(e){return e.qCanCollapse||e.qCanExpand||e.qSubNodes.length&&!I(e.qSubNodes[0])}function L(e,t){return 0===e&&(M(t)||I(t))||!E(t)&&!I(t)}function k(e,t,n,i,r,o,s,a){var l,c=0,u=r.getRow(e),h=s.getDimInfo(n),d=!(I(i)||_(i)||M(i)||D(i)),p=!!h&&h.qLocked,f=M(i);return n>0&&((l=u.addEmptyHeaderCell(o+e,t,1,n,"left",D(i))).type=r.CELL_TYPE_LEFT,l.isDimensionValue=d,l.locked=p,l.dataValue=i.qElemNo),(i.qCanCollapse||i.qCanExpand)&&((l=u.addLeftCollapseExpandCell(o+e,t,i,D(i),f)).type=r.CELL_TYPE_LEFT,l.isDimensionValue=d,l.locked=p,l.dataValue=i.qElemNo,c=-1),l=u.getNextCell(),l.type=r.CELL_TYPE_LEFT,l.isDimensionValue=d,l.locked=p,a=a||i.qText,_(i)&&(a=h.othersLabel),l.setLeftHeader(a,i.qElemNo,1,s.leftCellCnt-n+c,o+e,t,D(i),f),(f||T(i))&&(l.addClass("bold"),u.addClass("bold")),l}function O(e,t,n,i,r,o,s,a,l,c,u){var h,d,p;for(h=0;h<r.length;++h)L(t,d=r[h])&&(o=d,s=t,a=n),t>0&&I(d)&&(l=d),d.qSubNodes.length?e=O(e,t+1,n+(t>0&&I(d)?0:1),i,d.qSubNodes,o,s,a,l,c,u):(p=o.qText,l&&(p+=D(o)?" ":" - "+l.qText,l=null),k(e,s,a,o,i,c,u,p),++e);return e}function P(e,t,n,i,r,o,s){var a,l,c,u,h,d,p,f,m,g,v,y=0;for(a=0;a<i.length;++a)if(l=i[a],v=M(l)||!!s,f=o.getDimInfo(t),m=!I(l)&&!_(l)&&!v,g=!!f&&f.qLocked,c=n.getRow(e),A(l)?((u=c.getNextCell()).type=n.CELL_TYPE_LEFT,u.dataValue=l.qElemNo,u.isDimensionValue=m,u.locked=g,u.setLeftHeader("",-4,1,2)):((u=c.getNextCell()).type=n.CELL_TYPE_LEFT,u.isDimensionValue=m,u.locked=g,(l.qCanCollapse||l.qCanExpand)&&((h=u).setLeftHeader("",l.qElemNo,1,1,r+e,t,D(l),v),h.setCollapseExpandClass(l),(u=c.getNextCell()).type=n.CELL_TYPE_LEFT,u.isDimensionValue=m,u.locked=g,y=1),p=l.qText,_(l)&&(p=f.othersLabel),u.setLeftHeader(p,l.qElemNo,1,2-y,r+e,t,D(l),v),v&&(u.addClass("bold"),c.addClass("bold"))),l.qSubNodes.length)d=P(e,t+1,n,l.qSubNodes,r,o,v),u.rowspan=d-e,h&&(h.rowspan=u.rowspan),e=d;else{var b=o.leftCellCnt-2*(t+1);b>0&&((u=c.getNextCell()).type=n.CELL_TYPE_LEFT,u.dataValue=l.qElemNo,u.isDimensionValue=m,u.locked=g,u.setLeftHeader("",-4,1,b)),++e}return e}function N(e,t,n,i){i.isIndentMode?O(0,0,0,e,t,null,-1,-1,null,n,i):P(0,0,e,t,n,i)}function R(e,t){var i,r;e.style.backgroundColor="",e.color.bgByExpression=!1,e.color.bgIsDark=!1,"U"!==t.qType&&t.qAttrExps&&t.qAttrExps.qValues&&t.qAttrExps.qValues.length&&(e.color.bgByExpression=!0,r="NaN"!==t.qAttrExps.qValues[0].qNum?t.qAttrExps.qValues[0].qNum:t.qAttrExps.qValues[0].qText,(i=new n(r,"argb")).isInvalid()||(1!==i.getAlpha()&&(i=n.getBlend(re,new n(i._r,i._g,i._b,1),i.getAlpha())),e.style.backgroundColor=i.toHex(),e.color.bgIsDark=i.isDark()&&i.getAlpha()>.5,e.addClass(e.color.bgIsDark?"color-light":"color-dark"))),e.style.color="",t.qAttrExps&&t.qAttrExps.qValues&&t.qAttrExps.qValues.length>1&&(r="NaN"!==t.qAttrExps.qValues[1].qNum?t.qAttrExps.qValues[1].qNum:t.qAttrExps.qValues[1].qText,(i=new n(r,"argb")).isInvalid()||(e.style.color=i.toRGBA()))}function F(e,t,n,i,r){var o,s,a,l,c,u,h;for(o=0,a=t.length;o<a;++o)for(u=e.getNextRow(),0===e.leftTreeDepth&&u.addEmptyHeaderCell(n+o,i,1,1),0===(l=Math.min(r.dataColumnsInfo.cnt,t[o].length))&&0===o&&u.cells[0].addClass("first-data-cell"),s=0;s<l;++s)(h=u.getNextCell()).type=e.CELL_TYPE_DATA,c=t[o][s],h.setData(c.qText,1,1,n+o,i+s),h.addClass("data"),0===o&&0===s&&h.addClass("first-data-cell"),"U"===c.qType&&h.setNullClass(!0),isNaN(c.qNum)||h.addClass("numeric"),(u.hasClass("bold")||f(e,s,r).isTotal)&&h.addClass("bold"),R(h,c)}function j(e,t,n,i,r,o,s,a){var l,c,u,h,d,p;for(l=0;l<s;++l){for(u=t.getRow(n+l),d=o&&o[l]?o[l].length:1,c=0;c<d;++c)(h=u.getCell(i+c)).rowspan=1,h.colspan=1,h.style.backgroundColor="",h.style.color="",h.color.bgByExpression=!1,h.color.bgIsDark=!1,(p=o&&o[l]&&o[l][c])?B(t,h,p,e,r,l,c,a):h.setDefaults();u.setNextCellIx(i+c)}t.setNextRowIx(n+l)}function V(e,t,i,o){var s=r.getIndexById(t.qAttrExprInfo,i);if(-1!==s){var a="NaN"!==e.qAttrExps.qValues[s].qNum?e.qAttrExps.qValues[s].qNum:e.qAttrExps.qValues[s].qText,l=new n(a,"argb");return o&&1!==l.getAlpha()?n.getBlend(re,new n(l._r,l._g,l._b,1),l.getAlpha()):l}return!1}function H(e){return e&&e.length>2048?e.substring(0,2048)+"":e}function B(e,t,n,s,a,l,c,u){var h,d,p=a?a.qLeft+c:null,f=v(p,s),m=C(f);if(t.colspan=b(f)?2:1,t.type=e.CELL_TYPE_DATA,t.isOtherCell=n.qIsOtherCell,t.isTotalCell=n.qIsTotalCell,t.representation=t.REPRESENTATION_TEXT,t.isNumeric=!isNaN(n.qNum),"url"===m.type){var g,y=r.getIndexById(f.qAttrExprInfo,r.IDMAP.CELL_URL_LABEL);if(d=y>-1&&n.qAttrExps.qValues?"NaN"!==(g=n.qAttrExps.qValues)[y].qNum||g[y].qText?g[y].qText||g[y].qNum:" ":""===m.urlLabel?n.qText:m.urlLabel,n.qText&&!n.qIsNull)try{t.url=i.encodeForHref(n.qText),t.representation=t.REPRESENTATION_URL}catch(e){t.url=""}}else d=n.qText;var S=H(d);t.setText(S),t.setTextAlign(x(f),q(f)),t.isOtherCell&&(t.setText(f.othersLabel),t.setTextAlign(x(f),q(f))),t.locked=f.qLocked,t.dataValue=n.qElemNumber,t.dataColIx=o.getColumnDataIndex(s,p),t.dataRowIx=u?a.qTop+a.qHeight-l-1:a.qTop+l,t.isNumeric=!isNaN(n.qNum),t.isNullValue=t.isDimensionValue?-2===t.dataValue:n.qIsNull,t.isDimensionValue=!t.isNullValue&&b(f),t.selected=!1,t.selectedHighlighted=!1,t.isNullValue||(h=V(n,f,r.IDMAP.CELL_BACKGROUND_COLOR,!0))&&!h.isInvalid()&&(t.color.bgByExpression=!0,t.style.backgroundColor=h.toHex(),t.color.bgIsDark=h.isDark()&&h.getAlpha()>.5,1===e.headerRows.length&&(e.getHeaderRow(0).cells.filter(function(e){return e.dataColIx===t.dataColIx})[0].color.bgIsDark=h.isDark())),(h=V(n,f,r.IDMAP.CELL_FOREGROUND_COLOR))&&!h.isInvalid()&&(t.style.color=h.toRGBA())}function z(e,t){var n,i,r,o;n=e.getHeaderRow(0),i=e.getHeaderRow(e.topTreeDepth),t.dataColumnsInfo.cnt>0&&t.leftCellCnt>0&&((r=n.addEmptyMetaCell(e.topTreeDepth,t.leftCellCnt,"left-meta")).templateSrc="pt-meta-left.ng.html",r.addClass("meta")),t.dataColumnsInfo.cnt>0&&((o=n.addEmptyMetaCell(1,t.dataColumnsInfo.cnt)).addClass("top-meta").addClass("meta"),o.templateSrc="pt-meta-top.ng.html");for(var s=0;s<t.leftColumns.length;s++)(r=i.addEmptyMetaCell(1,t.leftColumns[s].length,"left-meta")).addClass("bottom-meta")}function $(e,t){return t.length?$(e+1,t[0].qSubNodes):e}function U(e,n){function i(){return n.qHyperCube.qMeasureInfo.length>0&&n.qHyperCube.qGrandTotalRow.length>0}function r(){return i()&&n.totals&&(n.totals.show||"noTotals"!==n.totals.position)}function o(){return!(r()&&n.totals&&!n.totals.show&&"bottom"===n.totals.position)}var s,a,l,c,u,h=e.headerRows[0].getCellSize();if(r()&&o())a=e.getNextHeaderRow();else{if(!r())return;a=e.getNextFooterRow()}for(s=0;s<h;++s)(c=e.getHeaderCell(0,s)).isSearchIcon||((l=a.getNextCell()).type=e.CELL_TYPE_TOP,l.tid=c.isSearchIcon?"st.total.search":"st.total",l.colIx=s,l.style={},l.colspan=c.isDimension?2:1,l.isDimension=!o()&&c.isDimension,l.isMeasure=c.isMeasure,c.isMeasure?(u=y(c.dataColIx,n.qHyperCube).qText,l.isNumeric=!0):(u=0===s?void 0!==n.totals.label?n.totals.label:t.get("Object.Table.Totals"):"",l.isNumeric=!1),l.setText(u),c.info&&l.setTextAlign(x(c.info),q(c.info)),l.isTotal=!0)}function G(e,t){var n,i,r,o=t.length;for(i=e.getNextHeaderRow(),n=0;n<o;++n)(r=i.getNextCell()).type=e.CELL_TYPE_TOP,r.setFromMetaHeader(t[n])}function W(e,t,n){e.tid="st.header",e.qvaOutsideIgnoreFor="",e.isSearchIcon=!1,e.open=!1,e.canCollapse=!1,e.canExpand=!1,e.rowspan=1,e.colspan=1,e.color={},t?(e.isFillColumn=!0,e.text="",e.sortable=!1,e.isDimension=!1,e.isSorted=!1,e.reversed=!1,e.style={width:"auto"}):(e.isNumeric="N"===e.info.qDimensionType||void 0===e.info.qDimensionType,e.locked=e.info.qLocked,e.text=e.info.qFallbackTitle,e.sortable=!0,e.dataColIx=e.qLeft,e.isDimension=!!e.info.qDimensionType,e.fieldName=e.isDimension?e.info.qGroupFieldDefs[e.info.qGroupPos]:"",e.isMeasure=!e.isDimension,e.isSorted=e.dataColIx===n[0],e.reversed=!!e.info.qReverseSort,e.sortIndicator=e.info.qSortIndicator,e.autoAlignText=x(e.info),e.explicitTextAlign=q(e.info),e.color={})}function X(){var e={glyphCntRange:{min:0,ok:0,max:1e5}};return W(e,!0,[]),e}function Y(e,t,n,i,r,o,s){var a,l,c,u=s.column.glyphWidth,h=Math.ceil(s.column.minColWidth/u),d=Math.ceil(s.column.maxColWidth/u),p=[],f=[],m=[],g=Math.ceil(s.column.paddingWidth/u),v=Math.floor(e/u),b=t>0?Math.round(t/u*10)/10:NaN,x=Math.max(3,i.qApprMaxGlyphCount),q=Math.max(3,i.qFallbackTitle.length),S=0;if(p.push(3),n){var w=y(r,o);f.push(w.qText.length)}else{var _=C(i);"url"===_.type&&_.urlLabel&&(x=_.urlLabel.length),f.push(x),S=Math.ceil(s.column.minSearchWidth/u)}return p.push(d),p.push(v-g-S),f.push(q+S),m.push(q+S),a=Math.min.apply(null,p),f.push(a),l=Math.max.apply(null,f),m.push(l),c=Math.max.apply(null,m),{min:Math.max(h+S,a)+g,ok:Math.min(d,l)+g,optimal:c+g+5,explicit:b,search:S}}function K(e,t,n,i,r,o,s){var a=s.column.glyphWidth,l=Math.floor(e/a),c=Math.max(4,Math.ceil(s.column.minColWidth/a)),u=Math.min(Math.ceil(s.column.maxColWidth/a),.8*l),h=Math.ceil(s.column.paddingWidth/a),d=t>0?Math.min(Math.round(t/a*10)/10,.8*l):NaN,p=Math.max(4,i.qApprMaxGlyphCount),f=Math.max(4,i.qFallbackTitle.length),m=Math.ceil(s.column.minSearchWidth/a),g=c,v=c,b=c;if(n){var x=y(r,o);b=Math.min(u,Math.max(b,x.qText.length))}else{var q=C(i);"url"===q.type&&q.urlLabel&&(p=q.urlLabel.length),b=Math.min(u,Math.max(b,p)),g+=m,f+=m}var S=.4+.6/(1+Math.exp((b-48)/12));return{min:Math.max(g,v,b*S)+h,ok:Math.min(u,Math.max(f,b))+h,optimal:Math.min(u,Math.max(f,b))+h+5,explicit:d,search:n?0:m}}function Q(e,t,n,i,r,o){var s,a,l,c=e.qDimensionInfo,u=e.qMeasureInfo,h=Math.floor(i/r.column.glyphWidth);for(o||(o=[]),o=n.map(function(e){var t,n;for(t=0;t<o.length;++t)if(o[t].dataColIx===e){n=o[t];break}return n||{style:{}}}),a=0;a<n.length;++a)if(l=n[a],s=o[a],s.info=function(e){return e<c.length?c[e]:u[e-c.length]}(l),s.isDimension=l<c.length,s.isMeasure=l>=c.length,s.grandTotal=y(l,e),s.qLeft=l,W(s,!1,e.qEffectiveInterColumnSortOrder),r.horizontalScroll.enabled)s.glyphCntRange=K(i,t[l],s.isMeasure,s.info,l,e,r);else if(s.glyphCntRange=Y(i,t[l],s.isMeasure,s.info,l,e,r),(h-=s.glyphCntRange.min)<0){o.splice(Math.max(1,a));break}return o}function Z(e,t){var n,i;for(n=(e=e.slice()).length-1;~n;--n)(i=e[n]).isDimension||i.isMeasure||e.splice(n,1);for(;e.length>t;)e.pop();return e}function J(e,t,n,i,r,s){var a,l,c,u,h=n.horizontalScroll.enabled?n.width:n.width-n.columnPicker.width,d=o.getColumnOrder(e.qHyperCube),p=n.column.glyphWidth,f=p/h,m=1;for(r&&(r=Z(r,d.length)),n.columnPicker.show=!1,r=Q(e.qHyperCube,t,d,h,n,r),n.columnCount=r.length,n.columnPicker.show=r.length<d.length,l=r.length,a=0;a<l;a++)(c=r[a]).widthFactor=c.glyphCntRange.min*p/h,m-=c.widthFactor;if(m>0){var g;if(u=m,n.useAllSpace){var v=(u-.015)/l;r.forEach(function(e){e.widthFactor+=v,m=0})}else g=r.reduce(function(e,t){return e+Math.max(0,t.glyphCntRange.ok-t.glyphCntRange.min)},0),r.forEach(function(e){var t=Math.max(0,e.glyphCntRange.ok-e.glyphCntRange.min),n=t/g,i=Math.min(t*p/h,n*u);t>0&&(i>m?(e.widthFactor+=m,m=0):(e.widthFactor+=i,m-=i))})}if(m>0){r.concat().sort(function(e,t){return e.glyphCntRange.optimal-e.glyphCntRange.ok-(t.glyphCntRange.optimal-t.glyphCntRange.ok)}).forEach(function(e){var t=e.glyphCntRange.optimal-e.glyphCntRange.ok,n=Math.min(m,t*f);t>0&&(n>m?(e.widthFactor+=m,m=0):(e.widthFactor+=n,m-=n))})}return m=ie(r,n),te(r,h,n.column.minSearchWidth/h,i),ee(r,h,s,n),r}function ee(e,t,n,i){var r,o;for(o=0;o<e.length;++o)(r=e[o]).isFillColumn||(r.calculatedWidth=Math.round(t*r.widthFactor),i.horizontalScroll.enabled&&r.calculatedWidth<i.column.minColWidth&&(r.calculatedWidth=i.column.minColWidth),n&&r.isSearchIcon&&(r.calculatedWidth=1),r.style.width=r.calculatedWidth+"px")}function te(e,t,n,i){var r,o,s,a=0,l=Math.round(t*n);for(r=0,o=e.length;r<a+o;++r)(s=e[r]).isDimension&&(e.splice(r+1,0,ne(s,l,n,i)),s.widthFactor=Math.max(0,s.widthFactor-n),++a)}function ne(e,t,n,i){return{isSearchIcon:!0,qvaOutsideIgnoreFor:"qv-st-header-cell-search-"+i,tid:"st.header.search",widthFactor:e.shouldBeRemoved?0:n,calculatedWidth:e.shouldBeRemoved?0:t,style:{width:t+"px"},fieldName:e.fieldName,dataColIx:e.dataColIx,colspan:1}}function ie(e,t){var n,i,r=1,o=t.width,s=t.column.glyphWidth,a=t.column.minSearchWidth/o,l=!1;e.forEach(function(e){if(e.shouldBeRemoved=!1,l)return e.widthFactor=0,void(e.shouldBeRemoved=!0);e.glyphCntRange.explicit?(n=e.glyphCntRange.explicit*s/o,e.isDimension&&(n+=a),r-n>=0||t.horizontalScroll.enabled?(e.widthFactor=n,r-=e.widthFactor):(i=e.glyphCntRange.min*s/o,r-i>-.01?(e.widthFactor=r,r-=e.widthFactor):(e.widthFactor=r,e.shouldBeRemoved=!0,l=!0))):(i=e.glyphCntRange.min*s/o,r>=e.widthFactor||t.horizontalScroll.enabled?r-=e.widthFactor:r-i>-.01?(e.widthFactor=r,r-=e.widthFactor):(e.widthFactor=r,e.shouldBeRemoved=!0,l=!0))});var c=t.columnCount;if(e.forEach(function(t,n){t.shouldBeRemoved&&(c--,n>0&&(e[n-1].widthFactor+=t.widthFactor),t.widthFactor=0)}),t.columnPicker.show||c===t.columnCount||(t.columnPicker.show=!0),!t.horizontalScroll.enabled&&!t.columnPicker.show){var u=e.reduceRight(function(e,t){return e||t.widthFactor>0&&!t.glyphCntRange.explicit&&t},!1);u&&(u.widthFactor+=t.columnPicker.width/o)}return t.columnCount=c,e.push(X()),r}var re=new n(255,255,255,1);e.service("qvGridObjectDataService",function(){return{getTopTreeDepth:function(e){return $(0,e.qTop)},getLeftTreeDepth:function(e){return $(0,e.qLeft)},updatePivotItems:function(e,t,n,i){var r=e.layout,o=e.grid,s=t[0].qTop,a=t[0].qLeft,l=t[0].qData,c=$(0,s),u=$(0,a),h=n[0],d=e.metaGhostHeaders,p=r.qHyperCube.qIndentMode,f=this.getPseudoDimIndex(r);o.reset(!1,i,f,p),o.setTopTreeDepth(c),o.setLeftTreeDepth(u),z(o,d),w(o,s,h.qLeft,d),N(o,a,h.qTop,d),F(o,l,h.qTop,h.qLeft,d),o.removeUnused()},updateStraightItems:function(e,t,n,i,r,o){var s,a,l,c,u,h=e.layout,d=e.grid,p=t.length+1;for(i||d.reset(o),o||(G(d,n),U(d,h)),s=d.getNextRowIx(),u=0;u<p;++u)t[u]?(l=t[u].qMatrix,c=t[u].qArea,a=l.length):(l=null,c=null),j(h,d,s,u,c,l,a,r);i&&d.setNextRowIx(d.rows.length),d.removeUnused()},getPseudoDimIndex:function(e){var t=e.qHyperCube.qEffectiveInterColumnSortOrder.indexOf(-1);return~t?t:e.qHyperCube.qEffectiveInterColumnSortOrder.length},getColumnInfo:v,getColumnCells:c,getCellsInColumnWithValue:u,getCellsInColumn:h,getCellsInRow:d,getSiblingCells:m,getSiblingCellsWithValue:g,getCellInColumnWithRowIndex:p,columnOrder:{get:a,create:l,isValid:s},getStraightMetaHeaders:J}})}),define("objects.grid/services/selections",["qvangular","util","objects.grid/services/data-service","objects.grid/directives/selections"],function(e,t){"use strict";e.service("qvGridObjectSelectionService",["$timeout","$document","qvGridObjectDataService",function(e,n,i){var r;return r={$new:function(){var e={active:!1,currentDataColIx:-1,currentDataRowIx:-1,currentCell:void 0,activationCell:void 0,dataValues:{},unbindKeyboard:null};return Object.defineProperties(e,{dataValuesArray:{get:function(){var e,t=[],n=Object.keys(this.dataValues),i=n.length;for(e=0;e<i;++e)t.push(parseInt(n[e]));return t}},selectedIndices:{get:function(){var e,t=[],n=this.dataValuesArray,i=n.length;for(e=0;e<i;++e)t.push(this.dataValues[n[e]]);return t}}}),e},init:function(e,t,n,i,o,s){e.confirm=function(){t.endSelections(!0),e.deactivated(),r.reset(n),r.hide(n),i()},e.cancel=function(){t.endSelections(!1),e.deactivated(),r.reset(n),r.hide(n),o()},e.clear=function(){n.dataValues={},s(),r.reset(n),t.clearSelections(),e.selectionsMade=!1}},reset:function(e){e.dataValues={},e.currentDataColIx=-1,e.currentDataRowIx=-1,e.currentCell=void 0},show:function(e,n){e.active||(e.currentDataColIx=n.dataColIx,e.currentDataRowIx=n.dataRowIx,e.activationCell=t.extend(!0,{},n),e.active=!0)},hide:function(e){e.active=!1},bindKeyboard:function(e,t){var i=".selections-keyboard-"+t;return n.on("keyup"+i,function(t){27===t.which?e.cancel():13===t.which&&e.confirm()}),function(){n.off(i)}},isColumnar:function(e,t){return t.type===e.CELL_TYPE_LEFT||t.type===e.CELL_TYPE_DATA},selectValue:function(e,t,n){n.dataValues[t.dataValue]=r.isColumnar(e,t)?t.dataRowIx:t.dataColIx,n.currentDataColIx=t.dataColIx,n.currentDataRowIx=t.dataRowIx},selectCell:function(e,t,n){e.gridType===e.GRID_TYPE_PIVOT?(t[n?"addClass":"removeClass"]("selected-highlighted"),t[n?"removeClass":"addClass"]("selected")):(t.selectedHighlighted=!!n,t.selected=!n)},lockCell:function(e,t){e.gridType===e.GRID_TYPE_PIVOT?t.addClass("locked"):t.isSelectLocked=!0},deselectValue:function(e,t,n){delete n.dataValues[t.dataValue]},deselectCell:function(e,t){e.gridType===e.GRID_TYPE_PIVOT?(t.removeClass("selected-highlighted"),t.removeClass("selected")):(t.selectedHighlighted=!1,t.selected=!1)},unlockCell:function(e,t){e.gridType===e.GRID_TYPE_PIVOT?t.removeClass("locked"):t.isSelectLocked=!1},removeCellStyle:function(e){(e.color.bgByExpression||e.style.color)&&(e.styleCache={style:e.style,bgByExpression:e.color.bgByExpression},e.style="",e.color.bgByExpression=!1)},restoreCellStyle:function(e){e.styleCache&&(e.style=e.styleCache.style,e.color.bgByExpression=e.styleCache.bgByExpression,delete e.styleCache)},getSelectionType:function(e,t){var n={};return n[e.CELL_TYPE_TOP]="T",n[e.CELL_TYPE_LEFT]="L",n[e.CELL_TYPE_DATA]="D",n[t]},sendSelection:function(e,t,n,i,o){var s,a,l;0!==n.selectedIndices.length&&(r.isColumnar(i,n.currentCell)?(s=[n.currentDataColIx],a=n.selectedIndices):(s=n.selectedIndices,a=[n.currentDataRowIx]),l=r.getSelectionType(i,o.type),t.selectionsMade=!0,e.select(a,s,l).then(function(e){e||t.clear()}))},getCellCountWithDataValue:function(e,t,n){var i,o,s,a=[],l=0,c=t.length;if(0===c)return 0;for(s=0;s<c;++s)o=t[s],i=r.isColumnar(e,o)?o.dataColIx:o.dataRowIx,o.dataValue===n&&-1===a.indexOf(i)&&(a.push(i),l++);return l},getSiblingCell:function(e,t){return e.gridType===e.GRID_TYPE_PIVOT?t.currentCell:t.activationCell},selectDimensionCells:function(e,n,o,s,a,l){var c,u,h=a.dataValue,d=h in o.dataValues,p=i.getSiblingCells(s,r.getSiblingCell(s,o)||a);if(-1!==p.indexOf(a)&&(u=a.type===s.CELL_TYPE_TOP?e.getSize().qcx:e.getSize().qcy,c=r.getCellCountWithDataValue(s,p,h),u!==c||!l||!d))return p.forEach(function(e){e.dataValue in o.dataValues&&r.selectCell(s,e)}),l&&d?(r.deselectValue(s,a,o),p.forEach(function(e){e.dataValue===h&&r.deselectCell(s,e)})):d?l||(p.forEach(function(e){e.dataValue===h&&r.selectCell(s,e)}),r.selectCell(s,a,!0)):(r.selectValue(s,a,o),p.forEach(function(e){e.dataValue===h&&r.selectCell(s,e)}),r.selectCell(s,a,!0)),o.currentCell=t.extend(!0,{},a),function(){0===o.dataValuesArray.length?n.clear():r.sendSelection(e,n,o,s,a)}},selectDimensionValue:function(e,t,n,i,o,s,a){var l,c=r.activateSelections(e,t,n,i,o);return o.locked||o.isNullValue||(l=r.selectDimensionCells(t,n,i,s,o,a))&&l(),c},activateSelections:function(t,n,i,o,s){return o.active||s.locked||(n.beginSelections(),r.show(o,s),o.unbindKeyboard=r.bindKeyboard(i,t),e(function(){i.activated(!0)})),function(){o.unbindKeyboard()}},updateStraight:function(e,t,n){var o,s,a,l;if(t.dataValuesArray.length)for(a=(l=i.getSiblingCells(e,n)).length,o=0;o<a;++o)(s=l[o]).dataValue in t.dataValues&&(r.selectCell(e,s),t.currentDataRowIx===s.dataRowIx&&r.selectCell(e,s,!0))},updatePivot:function(e,t,n){var o,s,a,l;if(t.dataValuesArray.length)for(a=(l=i.getSiblingCells(e,n)).length,o=0;o<a;++o)(s=l[o]).dataValue in t.dataValues&&r.selectCell(e,s)}}}])}),define("text!extensions.qliktech/straight-table/layout/top/straight-table-top-header.ng.html",[],function(){return'<div class="qv-st-header" tid="qv-st-header-top" ng-style="scrollApi.topBottomStyle">\n\t<table\tdir="{{direction}}"\n\t\t\tng-style="tableStyles.header"\n\t\t\tqva-delegated-activate=".qv-st-header-sortable:not(.qv-st-custom-header)#navigatable && !selections.active && sortHeader($event);\n\t\t   .qv-st-header-cell-search:not(.qv-st-total-cell)#interactive && !selections.active && searchHeader($event)">\n\t\t<colgroup class="qv-st-columns">\n\t\t\t<col ng-repeat="header in grid.headerRows[0].cells"\n\t\t\t\t ng-style="header.style"\n\t\t\t\t ng-class="header.classList"/>\n\t\t</colgroup>\n\t\t<tbody>\n\t\t<tr ng-repeat="row in grid.headerRows">\n\t\t\t<th ng-repeat="header in row.cells"\n\t\t\t\ttid="{{header.tid}}"\n\t\t\t\tclass="qv-st-header-cell"\n\t\t\t\tqva-outside-ignore-for="{{header.qvaOutsideIgnoreFor}}"\n\t\t\t\tng-class="{ \'qv-st-header-cell-numeric\': header.isNumeric,\n\t\t\t\t\t\'qv-st-custom-header\': !!options.customHeader,\n\t\t\t\t\t\'qv-st-header-sortable\': header.sortable,\n\t\t\t\t\t\'qv-st-total-cell\': header.isTotal,\n\t\t\t\t\t\'qv-st-header-cell-hidden\': header.shouldBeRemoved,\n\t\t\t\t\t\'qv-st-header-cell-dimension\': header.isDimension,\n\t\t\t\t\t\'qv-st-header-cell-search\': header.isSearchIcon,\n\t\t\t\t\t\'qv-st-header-cell-search-open\': header.isSearchIcon && header.open,\n\t\t\t\t\t\'qv-st-reordering-column\': header.dataColIx === reorderingColumn.dataColIx\n\t\t\t\t }"\n\n\t\t\t\tcolspan="{{header.colspan}}"\n\t\t\t\tqv-st-column-reorder-handle="navigatable && !selections.active && !header.isSearchIcon && !header.isTotal">\n\t\t\t\t<qv-straight-table-header-cell ng-if="!header.isSearchIcon || !options.customHeader"></qv-straight-table-header-cell>\n\t\t\t\t<qv-straight-table-header-cell-search ng-if="!header.isTotal && header.isSearchIcon"></qv-straight-table-header-cell-search>\n\t\t\t</th>\n\t\t</tr>\n\t\t</tbody>\n\t</table>\n</div>\n'}),define("extensions.qliktech/straight-table/layout/top/straight-table-top-header",["qvangular","jquery","text!./straight-table-top-header.ng.html"],function(e,t,n){"use strict";e.directive("qvStraightTableTopHeader",function(){return{restrict:"E",replace:!0,template:n,link:function(e){e.sortHeader=function(n){var i=t(n.target).scope().header;e.sort(i)},e.searchHeader=function(n){var i=t(n.target).closest(".qv-st-header-cell"),r=i.scope().header;n.preventDefault(),e.search(i,r)}}}})}),define("text!extensions.qliktech/straight-table/layout/header-cell/straight-table-header-cell.ng.html",[],function(){return'<div class="qv-st-header-cell-wrapper" ng-style="{height: customHeaderHeight}">\n\t<div class="qv-st-value" ng-if="!hasCustomHeader"\n\t\t ng-class="{ \'qv-st-header-selections-active\': header.selectionsActive }"\n\t\t ng-style="{ \'textAlign\': header.textAlign }">\n\t\t<div class="qv-st-value-overflow"\n\t\t\t dir="{{header.dir}}"\n\t\t\t ng-class="{ \'qv-rtl-text\': header.isRtl }">\n\t\t\t<i ng-class="{\'lui-icon\': header.locked, \'lui-icon--lock\': header.locked }"></i><span ng-attr-title="{{header.text}}" ng-bind="header.text"></span>\n\t\t</div>\n\t</div>\n\n\t<i ng-if="header.isSorted && header.sortIndicator !== \'N\' && !hasCustomHeader"\n\t   class="qv-st-sorting-indicator"\n\t   ng-class="{ \'lui-icon lui-icon--triangle-top\': header.sortIndicator === \'A\', \'lui-icon lui-icon--triangle-bottom\': header.sortIndicator === \'D\', \'icon-triangle-light\': header.color.bgIsDark && header.reversed }"\n\t   ng-style="header.sortStyle"></i>\n</div>\n'}),define("extensions.qliktech/straight-table/layout/header-cell/straight-table-header-cell",["qvangular","text!./straight-table-header-cell.ng.html","general.utils/responsive-state","jquery","jqueryui"],function(e,t,n,i){"use strict";e.directive("qvStraightTableHeaderCell",[function(){return{restrict:"E",replace:!0,template:t,link:function(t,i){t.hasCustomHeader=!!t.options.customHeader;var r=i.closest(".qv-st-header-cell");if(t.options.customHeader){t.customHeaderHeight=t.options.customHeader.height;var o=e.getService("$compile");t.dmmodel=t.options.customHeader.model,i.append(o(t.options.customHeader.template)(t))}t.$watch("!header.isSearchIcon && !header.isTotal && selections.currentDataColIx === header.dataColIx",function(e){var o;e?(o=t.row.getPreviousCell(t.header),t.header.addClass("qv-st-active-col"),o&&o.addClass("qv-st-pre-active-col"),t.selectionsApi.getDockToElement=function(){var e=t.rtl?r.next():r;return n.isSmallDevice?i.closest(".qv-object").parent():e}):-1!==t.selections.currentDataColIx&&(o=t.row.getPreviousCell(t.header),t.header.removeClass("qv-st-active-col"),o&&o.removeClass("qv-st-pre-active-col"))})}}}]),e.directive("qvStColumnReorderHandle",[function(){return{restrict:"A",link:function(e,t,n){t.draggable({delay:100,appendTo:t.closest(".qv-st"),axis:"x",zIndex:100,opacity:1,helper:function(){var e=t.width(),n=i("<div class='qv-st-column-drag-helper'><table><tbody></tbody></table></div"),r=i(document.createElement("tr"));return t.clone().css("box-sizing","border-box").css("width",t.width()).css("height",t.height()+"px").appendTo(r),t.next().is(".qv-st-header-cell-search")&&(t.next().clone().css("box-sizing","border-box").css("width",t.next().width()).css("height",t.next().height()+"px").appendTo(r),e+=t.next().width()),n.find("table > tbody").append(r),n.css("box-sizing","border-box").css("width",e+4+"px"),n},start:function(){e.$emit("onStartReorderingColumns",{dataColIx:e.header.dataColIx})},drag:function(n,i){e.$emit("onReorderingColumns",{dataColIx:e.header.dataColIx,offset:e.rtl?t.closest(".qv-st").innerWidth()-i.position.left-i.helper.width():i.position.left})},stop:function(n,i){e.$emit("onStopReorderingColumns",{dataColIx:e.header.dataColIx,offset:e.rtl?t.closest(".qv-st").innerWidth()-i.position.left-i.helper.width():i.position.left})}}),n.qvStColumnReorderHandle&&e.$watch(n.qvStColumnReorderHandle,function(e){t.draggable("option","disabled",!e)})}}}]),e.directive("qvStraightTableHeaderCellSearch",[function(){return{restrict:"E",replace:!0,template:'<i class="lui-icon  lui-icon--search" q-title-translation="Common.Search"></i>',link:function(e,t){var i=t.closest(".qv-st-header-cell");e.$watch("!header.isTotal && selections.currentDataColIx === header.dataColIx",function(t){t?(e.header.addClass("qv-st-active-col"),e.selectionsApi.getSelectionToolbarWidthOffset=function(){var t=e.rtl?i.prev():i;return n.isSmallDevice?0:t[0].getBoundingClientRect().width+1}):-1!==e.selections.currentDataColIx&&e.header.removeClass("qv-st-active-col")})}}}])}),define("text!extensions.qliktech/straight-table/layout/data/straight-table-data.ng.html",[],function(){return'<div class="qv-st-data" tid="qv-st-data">\n\t<qv-scroll-load-button\n\t\t\tclass="qv-st-load-prev"\n\t\t\tdisabled="!navigatable"\n\t\t\tng-show="scrollApi.loadPrevious && scrollApi.settings.columnCount > 0 && ( navigatable || !isLoadPrevVisible )"\n\t\t\ton-load="scrollApi.gotoPreviousBlock()"\n\t\t\ttext="Object.Listbox.LoadPrevious"\n\t\t\tscroll-api="scrollApi"\n\t\t\tshow-button="scrollApi.loadPrevious"\n\t\t\twatch-resize="watchResize"\n\t\t\tprevious="true">\n\t</qv-scroll-load-button>\n\t<table ng-style="tableStyles.content"\n\t\t   dir="{{direction}}">\n\t\t<colgroup class="qv-st-columns">\n\t\t\t<col ng-repeat="header in grid.headerRows[0].cells"\n\t\t\t\t ng-style="header.style"\n\t\t\t\t ng-class="header.classList"/>\n\t\t</colgroup>\n\t\t<tbody>\n\t\t\t<tr ng-repeat="row in grid.rows" class="qv-st-data-row" ng-class="{ \'qv-grid-object-data-first-row\': $first, \'qv-grid-object-data-last-row\': $last }">\n\t\t\t\t<td ng-repeat="cell in row.cells" class="qv-st-data-cell"\n\t\t\t\t\trowspan="{{ cell.rowspan }}"\n\t\t\t\t\tcolspan="{{ cell.colspan }}"\n\t\t\t\t\tng-style="!cell.selected && !cell.selectedHighlighted && cell.style"\n\t\t\t\t\tng-class="{ \'qv-st-data-cell-dimension-value\' : cell.isDimensionValue,\n\t\t\t\t\t\t\'qv-st-data-cell-hidden\': cell.hidden,\n\t\t\t\t\t\t\'qv-st-data-cell-numeric\': cell.isNumeric,\n\t\t\t\t\t\t\'qv-st-data-cell-selected\': cell.selected,\n\t\t\t\t\t\t\'qv-st-data-cell-selected-highlighted\': cell.selectedHighlighted,\n\t\t\t\t\t\t\'qv-st-data-cell-null-value\': cell.isNullValue,\n\t\t\t\t\t\t\'qv-st-data-cell-locked\': cell.isSelectLocked,\n\t\t\t\t\t\t\'qv-st-data-cell-color-dark\': cell.color.bgByExpression && !cell.color.bgIsDark,\n\t\t\t\t\t\t\'qv-st-data-cell-color-light\': cell.color.bgByExpression && cell.color.bgIsDark,\n\t\t\t\t\t\t\'qv-st-data-cell-column-highlighted\': cell.columnHighlighted,\n\t\t\t\t\t\t\'qv-st-reordering-column\': cell.dataColIx === reorderingColumn.dataColIx\n\t\t\t\t\t}">\n\t\t\t\t<qv-straight-table-data-cell></qv-straight-table-data-cell>\n\t\t\t</td>\n\t\t</tr>\n\t\t</tbody>\n\t</table>\n\t<qv-scroll-loader class="qv-scroll-row-loader"></qv-scroll-loader>\n\t<qv-scroll-load-button\n\t\t\tclass="qv-st-load-next"\n\t\t\tng-show="scrollApi.loadNext && scrollApi.settings.columnCount > 0 && navigatable"\n\t\t\ton-load="scrollApi.gotoNextBlock()"\n\t\t\ttext="Object.Listbox.LoadMore"\n\t\t\tscroll-api="scrollApi"\n\t\t\tshow-button="scrollApi.loadNext"\n\t\t\twatch-resize="watchResize">\n\t</qv-scroll-load-button>\n</div>\n'}),define("extensions.qliktech/straight-table/layout/data/straight-table-data",["qvangular","text!./straight-table-data.ng.html"],function(e,t){"use strict";e.directive("qvStraightTableData",[function(){return{restrict:"E",replace:!0,template:t}}])}),define("text!extensions.qliktech/straight-table/layout/data-cell/straight-table-data-cell.ng.html",[],function(){return'<div class="qv-st-value"\n\t ng-attr-title="{{cell.text}}"\n\t ng-style="{ \'textAlign\': cell.textAlign }"\n\t dir="{{cell.dir}}">\n\t<div class="qv-st-value-overflow"\n\t\t ng-class="{ \'qv-rtl-text\': cell.isRtl }">\n\t\t<a ng-if="cell.representation === \'url\' && !selections.active" ng-style="{\'color\': cell.style.color}" qva-activate="openUrl(cell.url)" ng-attr-title="{{cell.url}}" ng-bind="cell.text"></a>\n\t\t<span ng-if="cell.representation === \'text\' || cell.representation === \'url\' && selections.active" ng-bind="cell.text"></span>\n\t</div>\n</div>\n'}),define("extensions.qliktech/straight-table/layout/data-cell/straight-table-data-cell",["qvangular","text!./straight-table-data-cell.ng.html"],function(e,t){"use strict";e.directive("qvStraightTableDataCell",[function(){return{restrict:"E",replace:!0,template:t,link:function(){}}}])}),define("text!extensions.qliktech/straight-table/layout/bottom/straight-table-bottom-header.ng.html",[],function(){return'<div class="qv-st-bottom-header" tid="qv-st-bottom-header" ng-style="tableStyles.header">\n\t<table dir="{{direction}}">\n\t\t<colgroup class="qv-st-columns">\n\t\t\t<col ng-repeat="header in grid.headerRows[0].cells"\n\t\t\t\t ng-style="header.style"\n\t\t\t\t ng-class="header.classList" />\n\t\t</colgroup>\n\t\t<tbody>\n\t\t\t<tr ng-repeat="row in grid.footerRows">\n\t\t\t\t<th ng-repeat="header in row.cells"\n\t\t\t\t\ttid="{{header.tid}}"\n\t\t\t\t\tclass="qv-st-header-cell"\n\t\t\t\t\tng-class="{ \'qv-st-header-cell-numeric\': header.isNumeric,\n\t\t\t\t\t\t\'qv-st-total-cell\': header.isTotal,\n\t\t\t\t\t\t\'qv-st-header-cell-hidden\': header.shouldBeRemoved,\n\t\t\t\t\t\t\'qv-st-header-cell-dimension\': header.isDimension,\n\t\t\t\t\t\t\'qv-st-header-cell-measure\': header.isMeasure,\n\t\t\t\t\t\t\'qv-st-header-cell-search\': header.isSearchIcon }"\n\t\t\t\t\tcolspan="{{header.colspan}}">\n\t\t\t\t\t<qv-straight-table-header-cell></qv-straight-table-header-cell>\n\t\t\t\t</th>\n\t\t\t</tr>\n\t\t</tbody>\n\t</table>\n</div>\n'}),define("extensions.qliktech/straight-table/layout/bottom/straight-table-bottom-header",["qvangular","text!./straight-table-bottom-header.ng.html"],function(e,t){"use strict";e.directive("qvStraightTableBottomHeader",function(){return{restrict:"E",replace:!0,template:t,link:function(){}}})}),define("text!client.property-panel/popovers/type-popover.ng.html",[],function(){return'<lui-popover style="min-width: 100px;width: 150px;" align-to="alignTo" position="\'bottom\'" on-close-view="closeTypeFoldout(event)" qva-outside-ignore-for="{{qvaOutsideIgnoreFor}}" class="pp-type-popover" tid="pp-type-popover">\n\t<ul class="qui-icontextlist">\n\t\t<li ng-repeat="item in items" tid="{{item.tid}}" ng-class="{ \'lui-disabled\': item.disabled() }" qva-activate="itemClicked($event,item);">\n\t\t\t<span class="qui-textlist-text" q-translation="{{item.translation}}"></span>\n\t\t</li>\n\t</ul>\n</lui-popover>\n'}),define("client.property-panel/popovers/type-popover",["text!./type-popover.ng.html"],function(e){return{template:e,controller:["$scope",function(e){e.itemClicked=function(e,t){e.preventDefault(),t.disabled()||t.select()}}],scope:{items:"=",alignTo:"=",closeTypeFoldout:"=",qvaOutsideIgnoreFor:"="}}}),define("extensions.qliktech/straight-table/properties/columns/columns-sorting-util",["general.utils/array-util"],function(e){function t(e){function t(){for(var e=[],t=0;t<i.length+r.length;t++)e.push(t);return e}var i=e.qDimensions,r=e.qMeasures;n(i,r,e.qColumnOrder)&&(e.qColumnOrder=t()),n(i,r,e.qInterColumnSortOrder)&&(e.qInterColumnSortOrder=t())}function n(e,t,n){var i={},r=[],o=!1;n.forEach(function(e){i[e]?o=!0:i[e]=!0}),o=o||e.length+t.length!==Object.keys(i).length,Object.keys(i).forEach(function(e){r.push(parseInt(e,10))}),r=r.sort(function(e,t){return e-t});for(var s=0;s<r.length;++s)o=o||r[s]!==s;return o}return{validateTableHyperCube:t,fixTableHypercubeOrders:function(n){t(n);for(var i,r=n.qDimensions,o=n.qMeasures,s=n.qColumnOrder,a=n.qInterColumnSortOrder,l=[],c=[],u=0;u<s.length;u++)(i=s[u])<r.length?l.push(i):c.push(i);!function(){for(var t=0;t<l.length;t++)if(l[t]!==t){var n=l[t],i=l.indexOf(t),o=l[i];e.swap(l,t,i),e.swap(r,n,o),e.swap(s,s.indexOf(n),s.indexOf(o)),e.swap(a,a.indexOf(n),a.indexOf(o))}}(),function(){for(var t=0;t<c.length;t++)if(c[t]!==t+r.length){var n=c[t],i=c.indexOf(t+r.length),l=c[i];e.swap(c,t,i),e.swap(o,n-r.length,l-r.length),e.swap(s,s.indexOf(n),s.indexOf(l)),e.swap(a,a.indexOf(n),a.indexOf(l))}}()},isInvalidOrderArray:n,updateColumnInfoOrders:function(t,n,i){var r;if(n<i)for(r=n;r<i;r++)e.swap(t.columnWidths,r,r+1);else for(r=n;r>i;r--)e.swap(t.columnWidths,r,r-1)}}}),define("text!client.property-panel/components/common/data.ng.html",[],function(){return'<div class="pp-component pp-list-component pp-toplist" tcl="data">\n\t<button class="lui-button  lui-button--block  pp-toplist-add-button" ng-class="{\'lui-active\': adding === true}" qva-activate="addClicked($event)" qv-enter="addClicked($event)" qva-outside-ignore-for="{{\'addButton-\' + $id}}"\n\t\t\tng-disabled="addDisabled()" tid="add-data">\n\t\t<span class="lui-button__text">{{getAddLabel()}}</span>\n\t\t<i class="toggle-expand  lui-button__caret  lui-caret" ng-if="hasMultipleAddOptions()"></i>\n\t</button>\n\n\t<div class="pp-toplist-content pp-data-container" qv-sortable-list="sortableItemLists">\n\t\t<div class="pp-data" ng-repeat="list in sortableItemLists.lists" tid="{{list.tid}}" ng-class="{ \'disabled\': list.disabled }" ng-if="list.show() != false">\n\t\t\t<div class="pp-data-header ">\n\t\t\t\t<span class="pp-data-header-text">{{list.title}}</span>\n\t\t\t</div>\n\n\t\t\t<ul class="pp-expandable-list pp-data-list">\n\t\t\t\t<li ng-repeat="item in list.items track by item.id" ng-include src="item.templateSrc" ng-class="item.classList"></li>\n\t\t\t</ul>\n\t\t</div>\n\t</div>\n</div>\n'}),define("objects.picasso/title/caching-title-retriever",["objects.picasso/title/title-retriever-factory"],function(e){"use strict";function t(){this.titleRetriever=e.create(),this.cache={}}function n(e,t){return e[t]||""}function i(e,t,n){e[t]=n}return t.prototype.getDimensionTitle=function(e,t,n){return this.titleRetriever.getDimensionTitle(e,t,n)},t.prototype.getMeasureTitle=function(e,t,n,r){var o=this;return this.titleRetriever.getMeasureTitle(e,t,n,r).then(function(t){return e&&i(o.cache,e.cId,t),t})},t.prototype.getCachedMeasureTitle=function(e){return e?n(this.cache,e.cId):""},t.prototype.resetTitles=function(){this.titleRetriever.resetTitles()},t}),define("objects.picasso/title/caching-title-retriever-factory",["objects.picasso/title/caching-title-retriever"],function(e){"use strict";return{create:function(){return new e}}}),define("extensions.qliktech/straight-table/properties/columns/columns",["qvangular","touche","client.property-panel/components/components","general.utils/support","objects.error-handling/error-translation","objects.error-handling/error-handler","translator","objects.add-popovers/add-dimension-popover","objects.add-popovers/add-measure-popover","client.property-panel/popovers/type-popover","client.utils/property-resolver","general.sortable/sortable-item-lists","extensions.qliktech/straight-table/properties/columns/columns-sorting-util","text!client.property-panel/components/common/data.ng.html","core.utils/feature-flags","objects.picasso/title/caching-title-retriever-factory","general.components/context-menu/context-menu-service"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m){return{name:"columns",template:p,controller:["$scope","$element","$timeout","qvGridObjectDataService","luiPopover",function(p,g,v,y,b){function x(e){if(p.adding)return q(),void(p.adding=!1);var t=e.currentTarget;(N=b.show({template:c.template,controller:c.controller,input:{items:[{tid:"dimension",select:function(){A("dimension",t)},disabled:function(){return p.args.handler.getDimensions().length>=p.args.handler.maxDimensions()},translation:"Common.Dimension"},{tid:"measure",select:function(){A("measure",t)},disabled:function(){return p.args.handler.getMeasures().length>=p.args.handler.maxMeasures()},translation:"Common.Measure"}],closeTypeFoldout:q},alignTo:t})).closing.then(function(e){e&&!e.target.classList.contains("lui-button__text")&&(p.adding=!1)}),N.closed.then(function(){N=null}),p.adding=!0}function q(e){N&&(N.close(),N=null),e&&e.target.classList.contains("pp-toplist-add-button")&&t.preventGestures(),p.addType=null}function C(){var e=u.getValue(p.data,p.definition.sortIndexRef);void 0===e?(e=y.columnOrder.create(p.args.handler.getDimensionLayouts(),p.args.handler.getMeasureLayouts()),u.setValue(p.data,p.definition.sortIndexRef,e),p.$emit("saveProperties")):e.length&&"number"!=typeof e[0]&&(u.setValue(p.data,p.definition.sortIndexRef,e.map(function(e){return e.dataColIx})),p.$emit("saveProperties"))}function S(){C();var e=u.getValue(p.data,p.definition.sortIndexRef),t=p.data.qHyperCubeDef.qDimensions.length;if(p.sortableItemLists.reset(),P.resetTitles(),e.forEach(function(e,n){var i,s,a,l,c,u;if(e<t?(s=e,a=p.data.qHyperCubeDef.qDimensions[s],l="dimension",c=a.qDef.cId,i=p.definition.items.dimensions):(s=e-t,a=p.data.qHyperCubeDef.qMeasures[s],c=a.qDef.cId,l="measure",i=p.definition.items.measures),f.LABEL_EXPR)if("dimension"===l){var h=p.args.handler.getDimensionLayout(c);u=P.getDimensionTitle(h,a,!0)}else{var d=p.args.handler.getMeasureLayout(a.qDef.cId);d&&(u=P.getCachedMeasureTitle(d),P.getMeasureTitle(d,a,!0,p.args.app).then(function(e){u=e}))}var m={title:function(){if(f.LABEL_EXPR)return u;var e;if("dimension"===l){var t=p.args.handler.getDimensionLayout(c);e=t&&t.qError&&!o.isCalcCondNotCalculatedErr(t.qError)?r.getDimensionError(t.qError.qErrorCode):a.qLibraryId?t&&t.title||"":t&&t.qFallbackTitle||""}else{var n=p.args.handler.getMeasureLayout(a.qDef.cId);e=n&&n.qError?r.getMeasureError(n.qError.qErrorCode):n&&n.qFallbackTitle||""}return e},isInvalid:function(){if("dimension"===l){var e=p.args.handler.getDimensionLayout(c);return e&&!!e.qError&&!o.isCalcCondNotCalculatedErr(e.qError)}var t=p.args.handler.getMeasureLayout(c);return t&&!!t.qError},component:O,definition:{type:"items",items:i.items},data:a,args:p.args,id:c,expanded:L.get(k+c)||!1,index:n,type:l,sourceIndex:s,dataColIx:e,templateSrc:"pp-data-item.ng.html",markerClass:"dimension"===l?"pp-dimension":"pp-measure",sortable:!1!==p.definition.allowMove};j.addSortableItem(m)}),j.isEmpty()){var n={id:"empty-item",templateSrc:"pp-empty-data-item.ng.html",index:-1};j.addSortableItem(n)}}function w(e){p.args.handler.addFieldDimension(e.value,"").then(function(e){L.put(k+e.qDef.cId,!0),p.$emit("saveProperties",p.data),E(),I()})}function _(e){p.args.handler.addLibraryDimension(e.libraryId).then(function(e){L.put(k+e.qDef.cId,!0),p.$emit("saveProperties",p.data),E(),I()})}function D(e){p.args.handler.addLibraryMeasure(e.libraryId).then(function(e){L.put(k+e.qDef.cId,!0),p.$emit("saveProperties",p.data),E(),I()})}function M(e){p.args.handler.addExpressionMeasure(e.value,"").then(function(e){L.put(k+e.qDef.cId,!0),p.$emit("saveProperties",p.data),E(),I()})}function A(e,t){p.addType=e,q(),T();var n,i={app:p.args.app,closeAddPopover:E};"dimension"===e?(n=a,i.addFieldDimension=w,i.addLibraryDimension=_):(n=l,i.addLibraryMeasure=D,i.addExpressionMeasure=M),R=b.show({template:n.template,controller:n.controller,input:i,alignTo:t,dock:"bottom"})}function E(e){R&&(R.close(),R=null),e&&e.target.classList.contains("pp-toplist-add-button")&&t.preventGestures(),p.adding=!1}function I(){v(function(){var e=g.find(".pp-toplist-content"),t=e.find(".pp-data-list").children().last();e[0].scrollTop=t[0].offsetTop-1},100)}function T(){j.items.forEach(function(e){e.expanded=!1,L.put(k+e.id,!1)})}var L=p.args.cache,k="columns_",O=n.getComponent("items"),P=m.create();p.expandClicked=function(e,t){t.disabled||e.target.classList.contains("pp-move-item")||(t.expanded=!t.expanded,L.put(k+t.id,t.expanded))};var N=null,R=null,F=null;p.addClicked=function(e){x(e)},p.hasMultipleAddOptions=function(){return!0},p.getAddLabel=function(){return s.get("properties.columns.add")},p.removeItem=function(e){"dimension"===e.type?p.args.handler.removeDimension(e.sourceIndex).then(function(){p.$emit("saveProperties")}):p.args.handler.removeMeasure(e.sourceIndex).then(function(){p.$emit("saveProperties")})},p.openContextMenu=function(t,n){var i=e.getService("qvContextMenu").menu();i.addItem({translation:"Common.Delete",tid:"delete",select:function(){p.removeItem(n)}}),F=e.getService("qvContextMenu").show(i,{position:{x:t.pageX,y:t.pageY},docking:"Top"})},p.$on("pp-open-path",function(e,t){var n=t.split("."),i=n[0],r=n[1];"columns"===i&&r&&(L.put(k+r,!0),I())}),p.add=function(e){e&&e.trim().length&&("measure"===p.addType?M({value:e,label:e}):"dimension"===p.addType&&w({value:e,label:e}))},p.sortableItemLists=h.create({options:{direction:"vertical",listKey:"list",listSelector:".pp-expandable-list",itemKey:"item",itemSelector:".qv-pp-sortable",itemDragSelector:".qv-pp-sortable-handle",gesture:{name:"swipe",options:{radiusThreshold:i.treatAsDesktop()?4:0,preventDefault:!1}}},addPlaceholder:function(){this._super.apply(this,arguments).classList=["qv-pp-sortable"]},onBegin:function(){this._super.apply(this,arguments),T()},onMove:function(){var e,t=this.getIndexOfItem(arguments[0]);this._super.apply(this,arguments),(e=this.getIndexOfItem(arguments[0]))<t&&t--,p.data.qHyperCubeDef.qColumnOrder=j.get().filter(function(e){return"empty-item"!==e.id}).map(function(e){return e.dataColIx}),d.fixTableHypercubeOrders(p.data.qHyperCubeDef),d.updateColumnInfoOrders(p.data.qHyperCubeDef,t,e),p.$emit("saveProperties")}});var j=p.sortableItemLists.createList(1,{title:s.get("Common.Columns"),tid:"columns"});p.$watchCollection("data.qHyperCubeDef.qColumnOrder",S),p.$watchCollection("data.qHyperCubeDef.qDimensions",S),p.$watchCollection("data.qHyperCubeDef.qMeasures",S),p.$on("$destroy",function(){q(),E(),F&&F.close()})}]}}),define("text!extensions.qliktech/straight-table/column-picker/column-picker.ng.html",[],function(){return'<div class="qv-st-column-picker"\n\t tid="qv-st-column-picker"\n\t ng-click="navigatable && !selections.active && toggleColumnPickerPopover();"\n\t qva-outside-ignore-for="{{columnPicker.qvaOutsideIgnoreFor}}"\n\t ng-class="{ \'qv-st-column-picker-open\': columnPicker.showPopover }">\n\t<table>\n\t\t<tr>\n\t\t\t<td q-title-translation="{{columnPicker.showPopover ? \'Tooltip.CloseColumnPicker\' : \'Tooltip.ColumnPicker\'}}">\n\t\t\t\t<div class="qv-st-column-picker-more"></div>\n\t\t\t</td>\n\t\t</tr>\n\t</table>\n</div>\n'}),define("text!extensions.qliktech/straight-table/column-picker/column-picker-popover.ng.html",[],function(){return'<lui-popover class="qv-st-column-picker-popover" qva-direction x-dir-setting="{{input.options.direction}}">\n\t<lui-popover-header>\n\t\t<lui-popover-title q-translation="Common.Columns"/>\n\t</lui-popover-header>\n\t<lui-popover-body class="lui-nopad">\n\t\t<ul class="qv-st-cp-popover-list"\n\t\t\tqv-sortable-list="input.sortableItemLists">\n\t\t\t<li class="qv-st-cp-popover-list-item"\n\t\t\t\tdraggable="false"\n\t\t\t\tng-repeat="col in input.columnPicker.columns.items track by col.id"\n\t\t\t\tng-class="col.classList"\n\t\t\t\tng-style="col.style">\n\t\t\t\t<table class="qv-st-cp-popover-table" ng-if="col.id !== -2">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td ng-class="{ \'disabled\': col.disabled }">\n\t\t\t\t\t\t\t<div class="qv-st-cp-overflow" ng-bind="col.title" qva-direction x-dir-setting="{{options.direction}}" x-dir-text="{{col.title}}"></div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td ng-if="col.id !== -2" class="qv-st-cp-handle">\n\t\t\t\t\t\t\t<div class="lui-icon lui-icon--handle"></div>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t</li>\n\t\t</ul>\n\t</lui-popover-body>\n</lui-popover>\n'}),define("extensions.qliktech/straight-table/column-picker/column-picker",["jquery","qvangular","text!./column-picker.ng.html","text!./column-picker-popover.ng.html","core.utils/resize","general.sortable/sortable-item-lists","general.sortable/sortable-list","objects.grid/services/data-service"],function(e,t,n,i,r,o){"use strict";return t.service("qvStraighTableColumnPickerService",["luiPopover",function(t){return{show:function(n){var r=t.show({template:i,input:n,alignTo:e(n.$alignColumnPickerTo)[0],dock:"right",closeOnEscape:!0,closeOnOutside:!0,outsideIgnore:n.qvaOutsideIgnoreFor});return r.closing.then(function(){n.toggleColumnPickerPopover()}),r.closed.then(function(){r=null}),function(){r&&r.close()}}}}]),t.directive("qvStraightTableColumnPicker",function(){return{restrict:"A",require:"qvSortableList",link:function(e,t,n,i){e.columnPicker.cancel=function(){i.cancel()}}}}),t.directive("qvStraightTableColumnPickerActivator",["qvStraighTableColumnPickerService","qvGridObjectDataService",function(e,t){return{restrict:"E",replace:!0,template:n,require:"^qvObjectContent",link:function(n,i,s,a){function l(){n.columnPicker.columns.get().forEach(function(e,t){n.scrollApi.settings.columnCount<t?e.disabled=!0:e.disabled=!1})}function c(){var e,i,r=n.layout.qHyperCube.qDimensionInfo,o=n.layout.qHyperCube.qMeasureInfo,s=r.length,a={};n.columnPicker.cancel(),n.columnPicker.columns.reset(),t.columnOrder.get(n.layout).forEach(function(e){var t={id:e,classList:["qv-st-cp-sortable"]};t.title=e<s?r[e].qFallbackTitle:o[e-s].qFallbackTitle,n.columnPicker.columns.addSortableItem(t)}),a.title="",a.id=-2,a.classList=["qv-st-cp-divider"],a.isDivider=!0,n.columnPicker.columns.addSortableItem(a,32),e=n.columnPicker.columns.getIndexByItem(a),i=n.scrollApi.settings.columnCount,n.columnPicker.columns.moveItem(e,i),l()}function u(){r.off("start."+n.$id,u),n.columnPicker.showPopover&&(h(),n.columnPicker.showPopover=!1,n.$digest())}var h;n.sortableItemLists=o.create({options:{direction:"vertical",itemKey:"col",itemSelector:".qv-st-cp-sortable",itemDragSelector:".qv-st-cp-handle"},addPlaceholder:function(e,t){var n=this._super.apply(this,arguments);n.style.height=t.height,n.id=-1},onMove:function(){this._super.apply(this,arguments),l();var e=!Array.isArray(n.layout.qHyperCube.qColumnOrder);n.applyColumnOrderSoftPatch(e,n.columnPicker.columns.get(function(e){return e.id>=0}).map(function(e){return e.id}))}}),n.columnPicker={showPopover:!1,columns:n.sortableItemLists.createList(),qvaOutsideIgnoreFor:"qv-st-column-picker-"+n.$id,cancel:function(){}},a.watchPaint(c),n.toggleColumnPickerPopover=function(){n.$alignColumnPickerTo=i,n.columnPicker.showPopover=!n.columnPicker.showPopover,n.columnPicker.showPopover?(c(),h=e.show({$alignColumnPickerTo:n.$alignColumnPickerTo,columnPicker:n.columnPicker,onMoveBegin:n.onMoveBegin,onMoveEnter:n.onMoveEnter,onMoveCancel:n.onMoveCancel,onMove:n.onMove,toggleColumnPickerPopover:n.toggleColumnPickerPopover,qvaOutsideIgnoreFor:n.columnPicker.qvaOutsideIgnoreFor,sortableItemLists:n.sortableItemLists,hc:n.layout.qHyperCube,options:n.options}),r.on("start."+n.$id,u)):h&&h()}}}}])}),define("text!objects.grid/column-width-adjuster/column-adjuster.ng.html",[],function(){return'<div class="column-width-adjuster">\n\t<qv-column-width-adjust-column ng-repeat="column in columns" column="column" explicit-column-width="explicitColumnWidths[$index]" x-rtl="rtl" min-col-width="minColWidth"></qv-column-width-adjust-column>\n</div>\n'}),define("text!objects.grid/column-width-adjuster/column-adjuster-column.ng.html",[],function(){return'<div class="column-width-adjust-column" ng-style="columnStyle" >\n\t<div class="column-width-adjust-line" ng-class="{active : isActive}"></div>\n</div>\n'}),define("objects.grid/column-width-adjuster/column-adjuster",["qvangular","text!./column-adjuster.ng.html","text!./column-adjuster-column.ng.html","touche"],function(e,t,n,i){"use strict";e.directive("qvTableColumnWidthAdjuster",function(){return{restrict:"E",replace:!0,template:t,scope:{columns:"=",explicitColumnWidths:"=",rtl:"=",minColWidth:"="}}}),e.directive("qvColumnWidthAdjustColumn",function(){return{restrict:"E",scope:{column:"=",explicitColumnWidth:"=",rtl:"=",minColWidth:"="},template:n,replace:!0,link:function(e,t){var n,r=e.minColWidth||40;e.columnStyle={},e.$watch("column.left",function(){e.columnStyle.left=e.column.left+"px"}),e.$watch("column.hidden",function(){e.columnStyle.display=e.column.hidden?"none":"block"}),e.$watch("column.height",function(){e.columnStyle.height=e.column.height+"px"}),e.$watch("column.top",function(){e.columnStyle.top=e.column.top+"px"}),e.$on("$destroy",function(){i(t[0]).off("*","columnAdjuster")}),i(t[0]).swipe({id:"columnAdjuster",options:{radiusThreshold:5,preventDefault:!1},start:function(){e.explicitColumnWidth=e.column.width,n=e.explicitColumnWidth,e.$emit("onExplicitColumnStarted")},update:function(t,i){var o=(e.rtl?-1:1)*i.swipe.deltaX,s=Math.max(n+o,r);e.isActive||(e.isActive=!0),e.explicitColumnWidth=s,e.$apply(),e.$emit("onExplicitColumnChanging")},end:function(){e.isActive=!1,e.$emit("onExplicitColumnChanged")}}).doubletap({id:"columnAdjuster",end:function(){e.isActive=!1,e.explicitColumnWidth=-1,e.$apply(),e.$emit("onExplicitColumnChanged")}})}}})}),define("extensions.qliktech/straight-table/straight-table",["jquery","qvangular","core.utils/deferred","objects.backend-api/hypercube-api","extensions.qliktech/straight-table/straight-table-properties","text!./straight-table.ng.html","objects.extension/base-controller","objects.extension/object-conversion","general.utils/array-util","extensions.qliktech/straight-table/snapshot/snapshot-helper","extensions.qliktech/straight-table/straight-table-dom-api","general.scroll/api/data-api","objects.utils/event-utils","objects.grid/data-grid","general.utils/shapes/rect","client.utils/theme/theme-module","core.utils/feature-flags","objects.utils/selection-util","general.utils/responsive-state","client.utils/property-resolver","extensions.qliktech/straight-table/straight-table-scroll-api","general.utils/support","extensions.qliktech/straight-table/migration/column-order-adapter","objects.grid/services/data-service","objects.grid/services/selections","extensions.qliktech/straight-table/layout/top/straight-table-top-header","extensions.qliktech/straight-table/layout/header-cell/straight-table-header-cell","extensions.qliktech/straight-table/layout/data/straight-table-data","extensions.qliktech/straight-table/layout/data-cell/straight-table-data-cell","extensions.qliktech/straight-table/layout/bottom/straight-table-bottom-header","extensions.qliktech/straight-table/properties/columns/columns","extensions.qliktech/straight-table/column-picker/column-picker","objects.grid/column-width-adjuster/column-adjuster","objects/listbox-popover/listbox-popover-service","objects/listbox-popover/listbox-popover-service-mobile"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,x,q,C){"use strict";function S(e,t){e.tableStyles={header:{"font-size":t.getStyle("header","fontSize"),color:t.getStyle("header","color")},content:{"font-size":t.getStyle("content","fontSize"),color:t.getStyle("content","color")}},e.scrollApi&&(e.scrollApi.settings.minRowHeight=w(e),e.scrollApi.settings.maxRowHeight=3*w(e))}function w(e){var t;if(g.THEMING){var n=parseInt(e.tableStyles.content["font-size"]);t=n?T*(n/L):T}return t||T}function _(e,t,n,i){return e.showField(t,n.backendApi.model.app,{$alignToElement:i,qvaOutsideIgnoreFor:"qv-st-header-cell-search-"+n.$id,collision:"flipfit",direction:n.options.direction},null,function(){n.currentHeaderSearch&&(n.currentHeaderSearch.open=!1),n.currentHeaderSearch=null})}function D(e,t,n){return e<t.length?t[e]:n[e-t.length]}function M(e,t,n,i){e.getCellsInColumn(t,"data",n).forEach(function(e){e.hidden=i})}function A(e){var t=q.treatAsDesktop(),n={enabled:e.options.useHorizontalScroll||g.ST_HSCROLL,useNativeScroll:e.options.useHorizontalScroll&&!e.options.virtualHorizontalScroll,useVirtualScroll:e.options.virtualHorizontalScroll||g.ST_HSCROLL&&!e.options.useHorizontalScroll,keepFirstColumnInView:e.options.keepFirstColumnInView||e.layout.scrolling&&e.layout.scrolling.keepFirstColumnInView};return!t&&n.enabled&&(n.useNativeScroll=!0,n.useVirtualScroll=!1),n}var E,I,T=23,L=13,k=m.get();return I=h.extend({init:function(e){this.visualizationCtrl=e},getRows:function(){return this.visualizationCtrl.getRows()},getRowCount:function(){return this.visualizationCtrl.getRowCount()},getFirstElementIndex:function(){return this.visualizationCtrl.getFirstElementIndex()},getLastElementIndex:function(){return this.visualizationCtrl.getLastElementIndex()},onVirtualScroll:function(e,t,n,i,r,o){return this.visualizationCtrl.onVirtualScroll(e,t,n,i,r,o)},onInitialNativeScroll:function(e,t){return this.visualizationCtrl.onInitialNativeScroll(e,t)},onGotoNextBlock:function(e,t){return this.visualizationCtrl.onGotoNextBlock(e,t)},onGotoPreviousBlock:function(e,t){return this.visualizationCtrl.onGotoPreviousBlock(e,t)}}),E=s.extend({init:function(e,t,n,i,r){if(this.appliedSoftPatch=!1,this._paintWatches=[],this._resizeWatches=[],this.$element=t,this.dataService=i,this.selectionService=r,this.$timeout=n,this.metaHeaders=[],this._super.apply(this,arguments),this._pendingUpdate=null,e.backendApi.setCacheOptions({width:1}),e.options.navigation=!1!==e.options.navigation,e.interactive=!1,e.linksInteractive=!1,e.isLoadPrevVisible=!1,e.direction=e.options.direction,e.rtl="rtl"===e.options.direction,e.watchResize=this.watchResize.bind(this),g.THEMING){this.styleService=k.initializeService("object.straightTable");var o=this;S(this.$scope,this.styleService),e.themeChangedCallback=function(){S(o.$scope,o.styleService)},k.ThemeChanged.bind(e.themeChangedCallback)}var s=e.layout.qHyperCube;C.updatePropertiesOnRefresh(e.backendApi,s),this.attachColumnResizeEvents(e),this.attachColumnReorderEvents(e)},attachColumnResizeEvents:function(e){var t=null;e.$on("onExplicitColumnChanged",function(){t=null,this.metaHeaders.filter(function(e){return!e.isSearchIcon&&!e.isFillColumn}).forEach(function(t,n){e.explicitColumnWidths[t.dataColIx]=e.visibleExplicitColumnWidths[n]}),e.applyColumnWidthSoftPatch(!1,e.explicitColumnWidths)}.bind(this)),e.$on("onExplicitColumnChanging",function(){t||(t={initialTableWidth:this.$scope.appliedTableWidth}),this.metaHeaders.filter(function(e){return!e.isSearchIcon&&!e.isFillColumn}).forEach(function(t,n){e.explicitColumnWidths[t.dataColIx]=e.visibleExplicitColumnWidths[n]}),this.metaHeaders=this.dataService.getStraightMetaHeaders(e.layout,e.explicitColumnWidths,e.scrollApi.settings,e.$id,this.metaHeaders,this.$scope.options.customHeader),this.$scope.scrollApi.updateMetaHeaders(this.metaHeaders,{lockScrollPosition:!0}),this.$scope.scrollApi.updateVirtualViewport(),this.metaHeaders.filter(function(e){return e.isFillColumn}).forEach(function(e){e.style.width="auto"}),this.updateColumnInfo(this.metaHeaders),this.applyTableWidth(Math.max(t.initialTableWidth+10,this.getTableWidth()))}.bind(this))},attachColumnReorderEvents:function(e){var t=null,n=null;e.$on("onStopReorderingColumns",function(){t=null,n=null,e.reorderingColumn=void 0,e.$digest()}),e.$on("onStartReorderingColumns",function(i,r){t=this.$scope.layout.qHyperCube.qColumnOrder,n=this.metaHeaders.reduce(function(e,t){return t.isFillColumn||(t.isSearchIcon?e.length>0&&(e[e.length-1].width+=t.calculatedWidth):e.push({dataColIx:t.dataColIx,width:t.calculatedWidth})),e},[]),e.reorderingColumn=n.filter(function(e){return e.dataColIx===r.dataColIx})[0],e.$digest()}.bind(this)),e.$on("onReorderingColumns",function(i,r){if(t&&e.reorderingColumn){var o,s,a,l=e.reorderingColumn,c=0,u=0,h=l.width/2,d=r.offset+h;for(o=0;o<n.length;++o)if(n[o].dataColIx!==l.dataColIx){if(s=u+h,a=u+n[o].width+h,Math.abs(s-d)<Math.abs(a-d))break;c+=1,u+=n[o].width}var p,f,m,g=n.indexOf(l);g!==c&&((f=(p=n.map(function(e){return t.indexOf(e.dataColIx)})).slice()).splice(c,0,f.splice(g,1)[0]),n.splice(c,0,n.splice(g,1)[0]),m=t.slice(),f.forEach(function(e,n){m[p[n]]=t[e]}),t=m,e.applyColumnOrderSoftPatch("replace",t))}})},setDirection:function(e){this._super(e),this.$scope.direction=this.$scope.options.direction,this.$scope.rtl="rtl"===this.$scope.options.direction,this.$scope.scrollApi.setDirection(this.$scope.direction),this.processResize()},watchPaint:function(e){var t=this;return t._paintWatches.push(e),function(){var n=t._paintWatches.indexOf(e);t._paintWatches.splice(n,1)}},watchResize:function(e){var t=this;return t._resizeWatches.push(e),function(){var n=t._resizeWatches.indexOf(e);t._resizeWatches.splice(n,1)}},suppressOnPaint:function(e){return this.$scope.object._forcePaint?(this.$scope.object._forcePaint=!1,!1):v.isInSelection(e)},update:function(e,t,n,i,r){if(!r){var o=this.$scope.explicitColumnWidths=this.$scope.layout.qHyperCube.columnWidths.map(function(e){return"number"==typeof e?e:-1});this.metaHeaders=this.dataService.getStraightMetaHeaders(this.$scope.layout,this.$scope.explicitColumnWidths,this.$scope.scrollApi.settings,this.$scope.$id,this.metaHeaders,this.$scope.options.customHeader),this.$scope.scrollApi.updateMetaHeaders(this.metaHeaders),this.$scope.visibleExplicitColumnWidths=this.metaHeaders.filter(function(e){return!e.isSearchIcon&&!e.isFillColumn}).map(function(e){return o[e.dataColIx]})}var s=this.getDataInfo(e,t,this.metaHeaders,this.$scope.layout),a=this;return this._pendingUpdate=this.$scope.backendApi.getData(s.rects).then(function(e){return a.onUpdateData({dataPages:e,dataInfo:s},n,i,r).then(function(){return a._pendingUpdate=null,e}).catch(function(){a._pendingUpdate=null})}),this._pendingUpdate},whenUpdated:function(){return this._pendingUpdate?this._pendingUpdate:n.resolve()},updateLocked:function(e){var t,n,i,r,o,s,a,l=this.dataService,c=this.selectionService,u=this.$scope.selections,h=u.activationCell,d=[];if(h){for(t=e.getRowsByCellType(e.CELL_TYPE_DATA),o=l.getSiblingCells(e,h),n=t.length,a=0;a<n;++a)d=d.concat(t[a].cells);for(r=d.length,a=0;a<r;++a)i=d[a],(s=-1!==o.indexOf(i))&&!i.isDimensionValue||!s&&!i.isMeta?c[h&&u.active?"lockCell":"unlockCell"](e,i):c[h&&u.active?"removeCellStyle":"restoreCellStyle"](i)}},getDataInfo:function(e,t,n,i,r){var o,s,a=0,l=n.length,c=[];for(o=0;o<l;++o)(s=n[o]).isSearchIcon||s.isFillColumn||(c.push({qLeft:C.getLeftOfDataArea(s,a,i,r),qTop:e||0,qWidth:1,qHeight:t}),C.useNewColumnOrderIdx(i.qHyperCube,r)&&a++);return c.length||c.push({qTop:0,qLeft:0,qWidth:0,qHeight:0}),{rects:c,metaHeaders:n}},updateColumnInfo:function(e){var t=this.$scope;t.columns||(t.columns=[]);var n,i,r,o=0,s=0;for(r=0,i=e.length;r<i;r++)n=e[r],M(this.dataService,t.grid,n.dataColIx,n.shouldBeRemoved),n.isFillColumn||(n.isDimension?(this.$scope.options.customHeader?o+=r>0?n.calculatedWidth+1:n.calculatedWidth:o+=n.calculatedWidth+e[r+1].calculatedWidth,r++):o+=n.calculatedWidth,t.columns[s]||(t.columns[s]={}),t.columns[s].width=n.calculatedWidth,t.columns[s].left=t.rtl?-o:o,t.columns[s].hidden=n.shouldBeRemoved,s++)},getTableWidth:function(){var e=this.$scope.scrollApi.settings,t=e.horizontalScroll.enabled?e.width:e.width-e.columnPicker.width;return Math.max(t,this.$scope.columns.map(function(e){return e.width}).reduce(function(e,t){return e+t},0))},applyTableWidth:function(e){this.$scope.tableStyles=this.$scope.tableStyles||{header:{},content:{}},this.$scope.tableStyles.header.width=this.$scope.tableStyles.content.width=e+"px",this.$scope.appliedTableWidth=e},onUpdateData:function(e,t,n,i){return n&&e.dataPages.forEach(function(e){e.qMatrix.reverse()}),this.dataService.updateStraightItems(this.$scope,e.dataPages,e.dataInfo.metaHeaders,t,n,i),this.$scope.columns=[],this.updateColumnInfo(e.dataInfo.metaHeaders),this.applyTableWidth(this.getTableWidth()),this.$scope.scrollApi.updateHorizontalScroll(),n&&this.$scope.grid.rows.reverse(),this.$scope.selections.active&&(this.selectionService.updateStraight(this.$scope.grid,this.$scope.selections,this.$scope.selections.activationCell),this.updateLocked(this.$scope.grid)),this.$timeout(function(){},0,!1)},setSnapshotData:function(e){var t,n,i=!!e.sourceObjectId,r=this.$scope,o=r.scrollApi.domApi,s=o.getScrollAreaBoundingBox(),a=e.qHyperCube;if(e.qHyperCube.columnOrder=e.qHyperCube.qColumnOrder,!i){var l=this.metaHeaders.filter(function(e){return!e.isFillColumn&&!e.isSearchIcon});a.qColumnOrder=l.map(function(e){return e.dataColIx})}var u=o.$scrollArea.find(".qv-st-data-row");return t=c.getIndexHeightAndWidth(u,a.qColumnOrder.length,s,e.totals&&e.totals.show),this.metaHeaders=this.dataService.getStraightMetaHeaders(this.$scope.layout,this.$scope.explicitColumnWidths,this.$scope.scrollApi.settings,this.$scope.$id,this.metaHeaders,this.$scope.options.customHeader),n=this.getDataInfo(t.index,t.height,this.metaHeaders,this.$scope.layout,e),r.backendApi.getData(n.rects).then(function(t){return e.qHyperCube.qDataPages=t,e})},getViewState:function(){return{virtualScrollPosition:this.$scope.scrollApi.virtualScrollApi.getVirtualPosition()}},process:function(e,t,n){return this.update(e,t,!1,!1,!1).then(function(){this.$scope.layout.qHyperCube&&(this.$scope.scrollApi.setTotalRows(this.$scope.layout.qHyperCube.qSize.qcy),this.$scope.scrollApi.setVirtualSize(n))}.bind(this))},processPaint:function(){this.$scope.scrollApi.updateViewport();var e,t=this.$scope.scrollApi.settings.viewportRowCount;return e=this.$scope.scrollApi.resetNativeScroll(),this.process(0,t,!1).then(function(){e()})},processResize:function(){var e=this.$scope.grid.rows.length,t=e?this.$scope.grid.rows[0].getIndex():0,n=this.$scope.scrollApi.settings.viewportRowCount;return this.$scope.scrollApi.totalRows&&t+n>this.$scope.scrollApi.totalRows&&(t-=Math.min(t,t+n-this.$scope.scrollApi.totalRows)),n<e&&(n=e),this.process(t,n,!0)},onVirtualScroll:function(e,t,n,i,r){return this.update(e,t,!1,!1,0===r)},gotoBlock:function(e,t,n){var i=this.$scope.scrollApi.getSpliceArgs(),r=this.$scope.grid.rows,o=this.$scope.grid.getNextRowIx();return n&&r.reverse(),r.splice.apply(r,i),o-=i[1],this.$scope.grid.setNextRowIx(o),this.update(e,t,!0,n,!0)},onGotoNextBlock:function(e,t){return this.gotoBlock(e,t,!1)},onGotoPreviousBlock:function(e,t){return this.gotoBlock(e,t,!0)},getRows:function(){return this.$scope.grid.rows},getRowCount:function(){return this.$scope.grid.rows.length},getFirstElementIndex:function(){return this.$scope.grid.rows[0].getIndex()},getLastElementIndex:function(){return this.$scope.grid.rows[this.$scope.grid.rows.length-1].getIndex()},getPreferredSize:function(){var e=n(),t=function(){return this.$element.find(".qv-st-data")[0].offsetHeight}.bind(this),i=this.$scope.$watch(t,function(t){if(t&&t>0){var n=this.$element.find(".qv-st-header")[0].offsetHeight,r=this.$element.find(".qv-st-bottom-header")[0].offsetHeight;e.resolve({w:this.$element.width(),h:t+n+r}),i()}}.bind(this));return e.promise}}),E.$inject=["$scope","$element","$timeout","qvGridObjectDataService","qvGridObjectSelectionService"],t.directive("qvStraightTable",["$timeout","qvGridObjectDataService","qvGridObjectSelectionService","qvListboxPopoverService","qvListboxPopoverServiceMobile","$window",function(t,i,r,s,a,c){return{restrict:"E",replace:!0,template:o,require:"qvObjectContent",link:function(o,h,m,b){function q(e){V.lockHorizontalScrollPosition(e)}function C(e,t){return b[e]().then(function(){t.forEach(function(e){e()})})}function S(e,t){var n,i,r=h.find(e);return!!r.length&&(n=r[0].getBoundingClientRect(),i=new f(t.left,t.top,t.width,t.height),new f(n.left,n.top,n.width,n.height).intersectsWith(i))}function M(){o.selections.active&&o.selections.activationCell&&(i.getSiblingCells(o.grid,o.selections.activationCell).forEach(function(e){r.deselectCell(o.grid,e)}),b.updateLocked(o.grid))}function E(){o.object.selectionsClass="",b.updateLocked(o.grid),q(!0)}function T(e,t){var n,i,r=e.length;for(n=0;n<r;++n)if((i=e[n]).dataRowIx===t)return i}var L,O=h.find(".qv-grid-object-scroll-area"),P=O.controller("qvScrollArea"),N=h.find(".qv-scroll-loader:not(.qv-scroll-row-loader)").controller("qvScrollLoader"),R=O.find(".qv-scroll-row-loader").controller("qvScrollLoader"),F="."+o.id+"-straight-table",j={alignToBottom:"reduce",minRowHeight:w(o),maxRowHeight:3*w(o),columnCount:0,horizontalScroll:A(o),useAllSpace:o.options.useAllSpace,column:{glyphWidth:8,paddingWidth:14,minSearchWidth:o.options.customHeader?1:35,minColWidth:o.options.minColumnWidth||34,maxColWidth:384},columnPicker:{show:!1,width:21},blockSize:50},V=o.scrollApi=new x(t,j),H=new I(b),B=u.create(o,h,O,V.settings);o.grid=new p("straight"),o.selections=r.$new(),g.ST_HSCROLL?o.multiline={wrapTextInHeaders:!o.layout.multiline||o.layout.multiline.wrapTextInHeaders,wrapTextInCells:!o.layout.multiline||o.layout.multiline.wrapTextInCells}:o.multiline={wrapTextInHeaders:!0,wrapTextInCells:!0},o.$on("$destroy",function(){V.destroy(),h.off(F),o.themeChangedCallback&&k.ThemeChanged.unbind(o.themeChangedCallback)}),h.on("contextmenu"+F,function(e){o.selections.active&&e.preventDefault()});var z=V.initialize(B,H,P,N,b).then(function(){V.setDirection(o.direction),b.setInteractionState=function(){var e=o.object.inAnalysisState(),t=e&&!1!==o.options.navigation,n=e&&!1!==o.options.selections;o.interactive=n,o.linksInteractive=e&&(o.options.navigation||o.options.limitedInteraction),t&&!o.navigatable?(o.navigatable=!0,o.scrollApi.activate()):!t&&o.navigatable&&(o.navigatable=!1,o.scrollApi.deactivate()),e||(o.isLoadPrevVisible=S(".qv-st-load-prev",V.domApi.getScrollAreaBoundingBox()))},b.onPaint=function(){return this.suppressOnPaint(o.layout)?n.resolve():(v.isModalSelectionModel(o.object.model)&&o.selectionsApi.confirm(),g.ST_HSCROLL&&(o.layout.scrolling&&o.layout.scrolling.keepFirstColumnInView!==V.settings.horizontalScroll.keepFirstColumnInView&&(V.settings.horizontalScroll.keepFirstColumnInView=o.layout.scrolling.keepFirstColumnInView,o.scrollApi.updateViewport()),!o.layout.multiline||o.layout.multiline.wrapTextInHeaders===o.multiline.wrapTextInHeaders&&o.layout.multiline.wrapTextInCells===o.multiline.wrapTextInCells||(o.multiline.wrapTextInHeaders=o.layout.multiline.wrapTextInHeaders,o.multiline.wrapTextInCells=o.layout.multiline.wrapTextInCells,o.scrollApi.updateViewport())),C("processPaint",b._paintWatches))},b.onResize=function(){return o.scrollApi.updateViewport(),C("processResize",b._resizeWatches)},b.onInitialNativeScroll=function(e,t){return R.fadeIn(0,0,{width:"100%",height:"30px"}).then(function(){return b.update(e,t,!0,!1,!0).then(function(){return R.fadeOut()})})},b.setInteractionState(o.options.interactionState)});b.onInit=function(){return z},o.applyColumnOrderSoftPatch=function(e,t){var n=[{qPath:"/qHyperCubeDef/qColumnOrder",qOp:(e?"add":"replace").toString(),qValue:JSON.stringify(t)}];o.backendApi.applyPatches(n,!0)},o.options.externalInterface&&(o.options.externalInterface.forceRedraw=function(){b.onPaint()}),o.applyColumnWidthSoftPatch=function(e,t){var n=e?"add":"replace",i=t.map(function(e){return void 0===e||null===e?-1:e}),r=[{qPath:"/qHyperCubeDef/columnWidths",qOp:n.toString(),qValue:JSON.stringify(i)}];o.backendApi.applyPatches(r,!0),o._columnWidthsExistsInLayout=!0},r.init(o.selectionsApi,o.backendApi,o.selections,function(){b.updateLocked(o.grid),L&&L(),q(!1)},function(){i.getSiblingCells(o.grid,o.selections.activationCell).forEach(function(e){r.deselectCell(o.grid,e)}),b.updateLocked(o.grid),L&&L(),q(!1)},M);var $=o.selectionsApi.ignoreOnOutside;o.selectionsApi.ignoreOnOutside=function(e){return!!e.closest(".qv-st-dim-columns").length||(!(!$(e)&&!e.closest(".qv-st-selections-active").length)||void 0)},o.selectionsApi.getMenuMaxHeight=function(){return h.outerHeight()},o.selectWhileLocked=function(){d.showLockedFeedback(o.layout.qHyperCube.qDimensionInfo)},o.selectDimensionValue=function(t,n){if(o.scrollApi.updateViewport(),o.scrollApi.scrollColumnInView(t.dataColIx,b.metaHeaders),t.representation!==t.REPRESENTATION_URL||!e(n.target).is("a")){o.selectionsApi.getKeyAsToggleSelected(n)||(M(),r.reset(o.selections));var s=t.type,a=t.dataRowIx,l=t.dataColIx;b.whenUpdated().then(function(){var e=i.getCellsInRow(o.grid,s,a).filter(function(e){return e.dataColIx===l})[0];if(e){L=r.selectDimensionValue(o.$id,o.backendApi,o.selectionsApi,o.selections,e,o.grid,!0);var t=o.selectionsApi.watchActivated(function(){E(),t()})}})}},o.activateSelections=function(e){o.scrollApi.updateViewport(),L=r.activateSelections(o.$id,o.backendApi,o.selectionsApi,o.selections,e);var t=o.selectionsApi.watchActivated(function(){E(),t()})},o.multiselectDimensionValues=function(e,t){function n(e){var t=T(a,e);t&&t.isDimensionValue&&r.selectDimensionCells(o.backendApi,o.selectionsApi,o.selections,o.grid,t,!1)}var s,a=i.getSiblingCells(o.grid,e),l=e.dataRowIx,c=t.dataRowIx;if(l<=c)for(s=l;s<=c;++s)n(s);else if(l>c)for(s=l;s>=c;--s)n(s)},o.multiselect=function(){o.selections.active&&r.sendSelection(o.backendApi,o.selectionsApi,o.selections,o.grid,o.selections.currentCell)},o.sort=function(e){if(e){o.scrollApi.updateViewport();var t,n,i=e.dataColIx,r=[].concat(o.layout.qHyperCube.qEffectiveInterColumnSortOrder),s=r[0],a="",c=o.layout.qHyperCube;i!==s&&(n=r.indexOf(i),l.move(r,n,0));var u=[{qPath:"/qHyperCubeDef/qInterColumnSortOrder",qOp:"replace",qValue:"["+r.join(",")+"]"}];i===s&&(a=e.isDimension?"/qHyperCubeDef/qDimensions/":"/qHyperCubeDef/qMeasures/",t=D(i,c.qDimensionInfo,c.qMeasureInfo),e.reversed=!t.qReverseSort,a+=(e.isDimension?i:i-o.layout.qHyperCube.qDimensionInfo.length)+"/qDef/qReverseSort",u.push({qPath:a,qOp:"replace",qValue:e.reversed.toString()})),o.backendApi.applyPatches(u,!0)}},o.currentHeaderSearch=null,o.search=function(t,n){if(o.currentHeaderSearch===n)return n.open=!1,o.currentHeaderSearch=null,void(y.isSmallDevice?a.close():s.close());o.currentHeaderSearch&&(o.currentHeaderSearch.open=!1,o.currentHeaderSearch=null),y.isSmallDevice?_(a,n.fieldName,o,t):_(s,n.fieldName,o,t).then(function(t){var i;q(!0),t.closing.then(function(t){t&&!e(t.target).closest(".qv-st-header-cell-search").length>0&&(o.currentHeaderSearch=null,n.open=!1),i=t}),t.closed.then(function(){t=null,n.open=!1,i||(o.currentHeaderSearch=null),q(!1)}),o.currentHeaderSearch&&o.currentHeaderSearch===n&&(t=null)}),n.open=!0,o.currentHeaderSearch=n},o.openUrl=function(e){o.linksInteractive&&c.open(e,"_blank")},o.options.externalInterface&&o.options.externalInterface.straightTableId&&o.$emit("straight-table-initialized",{id:o.options.externalInterface.straightTableId,grid:o.grid,headers:b.metaHeaders})}}}]),{initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qSuppressMissing:!0,qMode:"S",columnOrder:[],columnWidths:[],qColumnOrder:[]}},data:{dimensions:{min:1,max:1e3,description:function(){return"Column"},add:function(e,t,n){var i=n.hcProperties.qColumnOrder,r=n.hcProperties.columnOrder,o=n.hcProperties.columnWidths,s=n.getDimensions().length-1;return l.indexAdded(i,s),l.indexAdded(r,s),o.splice(s,0,-1),e},remove:function(e,t,n,i){var r=n.hcProperties.qColumnOrder,o=n.hcProperties.columnOrder,s=n.hcProperties.columnWidths;l.indexRemoved(r,i),l.indexRemoved(o,i),s.splice(r[i],1)}},measures:{min:0,max:1e3,description:function(){return"Column"},add:function(e,t,n){var i=n.hcProperties.qColumnOrder,r=n.hcProperties.columnOrder,o=n.hcProperties.columnWidths,s=n.getDimensions().length+n.getMeasures().length-1;l.indexAdded(i,s),l.indexAdded(r,s),o.splice(i[s],0,-1)},remove:function(e,t,n,i){var r=n.hcProperties.qColumnOrder,o=n.hcProperties.columnOrder,s=n.hcProperties.columnWidths,a=(n.hcProperties.qDimensions?n.hcProperties.qDimensions.length:0)+i;l.indexRemoved(r,a),l.indexRemoved(o,a),s.splice(a,1)}}},support:{cssScaling:!0,snapshot:!0,export:!0,exportData:!0,sharing:!1},type:"table",template:"<qv-straight-table></qv-straight-table>",BackendApi:i,definition:r,migrate:{properties:function(e){return C.migrateProperties(e)},snapshot:function(e){return C.migrateSnapshot(e)}},importProperties:function(e,n,i){var r=a.hypercube.importProperties(e,n,i),o=r.qProperty.qHyperCubeDef.qColumnOrder,s=r.qProperty.qHyperCubeDef.qDimensions,l=r.qProperty.qHyperCubeDef.qMeasures,c=t.getService("qvGridObjectDataService");a.unquarantineObject(r.qProperty,"straightTableColumnWidths")||b.setValue(r,"qProperty.qHyperCubeDef.columnWidths",n.qHyperCubeDef.columnWidths.concat()),l.forEach(function(e){""===e.qDef.qAggrFunc&&e.qDef.qExpressions&&0===e.qDef.qExpressions.length&&(e.qDef.qAggrFunc="Expr")});for(var u=0;u<s.length;u++){var h=s[u].qDef.representation;if(h&&h.urlLabel&&h.urlLabel.qStringExpression){var d=[];d.push({qExpression:h.urlLabel.qStringExpression.qExpr,id:"urlLabel"}),b.setValue(r,"qProperty.qHyperCubeDef.qDimensions."+u+".qAttributeExpressions",d)}}return c.columnOrder.isValid(o,s,l,!0)||(r.qProperty.qHyperCubeDef.qColumnOrder=c.columnOrder.create(s,l)),r.qProperty.qHyperCubeDef.qDimensions.forEach(function(e){e.qOtherTotalSpec&&e.qOtherTotalSpec.qTotalMode&&(e.qOtherTotalSpec.qTotalMode="TOTAL_OFF")}),r},exportProperties:function(e){var t=a.hypercube.exportProperties(e);return a.quarantineProperty("qHyperCubeDef.columnWidths",t,"straightTableColumnWidths"),t},controller:E}}),define("extensions.qliktech/listbox/listbox-properties",[],function(){var e,t,n;return e={uses:"settings",items:{}},t={type:"items",translation:"Common.Dimension",ref:"qListObjectDef",min:1,max:1,items:{label:{type:"string",ref:"qListObjectDef.qDef.qFieldLabels.0",translation:"Common.Label",show:!1},libraryId:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qListObjectDef.qLibraryId",translation:"Common.Dimension",show:function(e){return e.qListObjectDef&&e.qListObjectDef.qLibraryId}},field:{type:"string",expressionType:"dimension",ref:"qListObjectDef.qDef.qFieldDefs.0",translation:"Common.Field",change:function(e){var t=e.qListObjectDef.qDef;t.qFieldLabels||(t.qFieldLabels=[]),t.qFieldLabels[0]=t.qFieldDefs[0]},show:function(e){return e.qListObjectDef&&!e.qListObjectDef.qLibraryId}},autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qListObjectDef.qDef.cId",type:"string",show:!1}}},n={type:"items",translation:"properties.sorting",schemaIgnore:!0,items:{autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(e,t){if(e.qListObjectDef.qDef.autoSort)return t.autoSortDimension(e.qListObjectDef)}},dimension:{component:"sorting-dimension",ref:"qListObjectDef",show:function(e){return!e.qListObjectDef.qDef.autoSort},sortingItems:{expression:!0,frequency:!0,numeric:!0,ascii:!0}}}},{type:"items",component:"accordion",items:{dimension:t,sorting:n,settings:e}}}),define("text!extensions.qliktech/listbox/listbox.ng.html",[],function(){return'<div class="qv-listbox-container" ng-class="{ \'qv-listbox-interactive\': navigatable }" tid="qv-listbox-container">\n\t<div qva-direction x-dir-setting="{{options.direction}}" qv-listbox-search ng-show="options.search.show" class="qv-listbox-search">\n\t\t<lui-search query="query" is-focused="focused" on-escape="onEscape($event);" auto-focus="autoFocus" placeholder="Common.Search" />\n\t</div>\n\t<div class="qv-listbox-wrapper" ng-class="{ \'searchActive\': options.search.show }">\n\t\t<qv-scroll-area class="qv-listbox-scroll-area qv-animate"\n\t\t\t\t\t\tng-class="{ \'qv-listbox-virtual-scroll-enabled\': scrollApi.virtualScrollEnabled }"\n\t\t\t\t\t\tx-direction="options.direction">\n\t\t\t<ul class="qv-listbox"\n\t\t\t\tng-class="{ \'align-bottom\': scrollApi.alignBottomAbsolute }"\n\t\t\t\tng-style="listStyle"\n\t\t\t\tqva-direction x-dir-setting="{{options.direction}}"\n\t\t\t\tqv-selections-select-while-locked="selectWhileLocked()"\n\t\t\t\tqv-selections-toggle-dimension-value="{ selector: \'li\', itemKey: \'item\' }"\n\t\t\t\tqv-selections-on-toggle-dimension-value="interactive && select($event, item)"\n\t\t\t\tqv-selections-multiselect="{ selector: \'li\', itemKey: \'item\' }"\n\t\t\t\tqv-selections-start-multiselect="interactive && multiselectStart($event)"\n\t\t\t\tqv-selections-update-multiselect="interactive && multiselectUpdate(start, current)"\n\t\t\t\tqv-selections-end-multiselect="interactive && multiselectEnd($event)">\n\t\t\t\t<qv-scroll-load-button tag="li" class="qv-listbox-load-buttons" ng-show="navigatable && scrollApi.loadPrevious" on-load="scrollApi.gotoPreviousBlock()" text="Object.Listbox.LoadPrevious" previous="true">\n\t\t\t\t</qv-scroll-load-button>\n\t\t\t\t<li ng-repeat="item in items" ng-class="item.classNames" tid="listbox.item">\n\t\t\t\t\t<div class="qv-listbox-tick"><i class="lui-icon tick-icon" ng-class="{\'lui-icon--tick\': !item.locked, \'lui-icon--lock\': item.locked, }"></i></div>\n\t\t\t\t\t<div class="qv-listbox-text" ng-style="item.style" dir="{{item.dir}}">\n\t\t\t\t\t\t<span ng-attr-title="{{item.tipText}}">\n\t\t\t\t\t\t\t<span ng-repeat="textItem in item.textItems" ng-class="{ highlighted: textItem.isHighlighted }" ng-bind="textItem.text"></span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t</li>\n\t\t\t\t<qv-scroll-loader tag="li" class="qv-scroll-row-loader"></qv-scroll-loader>\n\t\t\t\t<qv-scroll-load-button tag="li" class="qv-listbox-load-buttons" ng-show="navigatable && scrollApi.loadNext" on-load="scrollApi.gotoNextBlock()" text="Object.Listbox.LoadMore"></qv-scroll-load-button>\n\t\t\t</ul>\n\t\t</qv-scroll-area>\n\t\t<qv-scroll-loader></qv-scroll-loader>\n\t</div>\n</div>\n'}),define("text!client.services/export-dialog/export-dialog.ng.html",[],function(){return'<lui-dialog id="export-dialog">\n\t<div ng-if="state === states.PENDING">\n\t\t<lui-dialog-header q-translation="Export.Exporting"></lui-dialog-header>\n\t\t<lui-dialog-body class="export-dialog-body">\n\t\t\t<div class="qv-loader pb-10"></div>\n\t\t</lui-dialog-body>\n\t\t<lui-dialog-footer>\n\t\t\t<lui-button ng-click="cancel()" q-translation="Common.Cancel"></lui-button>\n\t\t</lui-dialog-footer>\n\t</div>\n\t<div ng-if="state === states.COMPLETED">\n\t\t<lui-dialog-header q-translation="Export.Completed"></lui-dialog-header>\n\t\t<lui-dialog-body class="export-dialog-body">\n\t\t\t<p class="pb-10">\n\t\t\t\t<span q-translation="Export.CompletedDescription"></span>\n\t\t\t\t<span q-translation="Export.WarningDataTruncated" ng-if="dataIsTruncated"></span>\n\t\t\t</p>\n\t\t\t<p class="pb-10">\n\t\t\t\t<a class="export-url" ng-href="{{exportUrl}}" target="_blank" q-translation="Export.CompletedLink"></a>\n\t\t\t</p>\n\t\t</lui-dialog-body>\n\t\t<lui-dialog-footer>\n\t\t\t<lui-button ng-click="close()" q-translation="Common.Close"></lui-button>\n\t\t</lui-dialog-footer>\n\t</div>\n\t<div ng-if="state === states.FAILED">\n\t\t<lui-dialog-header q-translation="Export.Failed"></lui-dialog-header>\n\t\t<lui-dialog-body class="export-dialog-body">\n\t\t\t<p class="pb-10" q-translation="{{errorTranslation}}"></p>\n\t\t</lui-dialog-body>\n\t\t<lui-dialog-footer>\n\t\t\t<lui-button ng-click="close()" q-translation="Common.Close"></lui-button>\n\t\t</lui-dialog-footer>\n\t</div>\n</lui-dialog>\n'}),define("client.services/export-dialog/export-dialog",["qvangular","text!./export-dialog.ng.html","assets/client/dialogs/directives/dialog-directives"],function(e,t){e.service("$exportDialog",["luiDialog",function(e){return{show:function(n,i){return e.show({controller:["$scope",function(e){e.states={FAILED:-1,IDLE:0,PENDING:1,COMPLETED:2},e.state=e.states.PENDING,n.getLayout().then(function(t){var r=n.exportData(null,i,t.title||null);e.rpcId=r.requestId,r.then(function(t){e.exportUrl=requirejs.toUrl(".."+t.qUrl),e.state=e.states.COMPLETED,t.qWarnings&&1e3===t.qWarnings[0]&&(e.dataIsTruncated=!0)},function(t){e.state=e.states.FAILED,e.errorTranslation="ErrorCode."+t.code,t.isHandled=!0})}),e.openExportWindow=function(){window.open(e.exportUrl)},e.cancel=function(){e.rpcId?n.app.global.cancelRequest(e.rpcId).finally(e.close):e.close()},e.close=function(){e.destroyComponent()}}],template:t})}}}])}),define("extensions.qliktech/listbox/listbox-search",["qvangular","util","general.utils/support"],function(e,t,n){"use strict";var i=document.createElement("input");i.type="text",e.directive("qvListboxSearch",["$document","$timeout",function(r,o){return{link:function(s,a){function l(e){s.backendApi.search(e)}function c(){return r.on("keypress.watchKeyChars"+s.$id,function(e){27===e.keyCode||13===e.keyCode||s.options.search.show||(i.value=String.fromCharCode(e.which),i.value.length&&s.$apply(function(){s.options.search.toggle(!0,i.value)}))}),function(){r.off(".watchKeyChars"+s.$id)}}function u(){function e(){return s.$watch("query",function(e,t){void 0!==e&&e!==t&&(e.length>0?l(e):s.backendApi.abortSearch())})}function t(){i&&i(),s.query="",i=e()}function n(e){return e.split(" ").some(function(e){var t=e.trim()[0];return"<"===t||">"===t})}var i,a;return t(),a=s.$watch("focused",function(e){void 0!==e&&s.selectionsApi.toggleKeyboardAccelerators(!e)}),r.on("keydown.listboxSearch"+s.$id,function(e){!0===s.focused&&o(function(){switch(s.clearItemStates(!1),e.which){case 13:var i,r=s.backendApi.getSize();s.backendApi.isLocked()||!1===s.options.selections?s.selectWhileLocked():r.qcy>0&&s.query.length>0&&(i=s.selectionsApi.getKeyAsToggleSelected(e),i=n(s.query)?!i:i,s.backendApi.confirmSearch(i),s.confirmedSearch=!0,s.selectionsApi.selectionsMade=!0,t());break;case 27:s.backendApi.abortSearch(),t()}})}),function(){i(),a(),r.off(".listboxSearch"+s.$id)}}var h,d;s.autoFocus=!1,s.selectionsApi.deactivateSearch=function(){h&&h(),d&&d(),e.$apply(s,function(){s.options.search&&s.options.search.toggle(!1)})},s.onEscape=function(e){s.query&&s.query.length?s.query="":(s.backendApi.abortSearch(),s.selectionsApi.cancel()),e.preventDefault()},s.options.search=t.extend(!0,{show:s.options.isPopover,toggle:function(e,t){s.options.search.show=void 0!==e?e:!s.options.search.show,s.options.search.show?(h=u(),t&&t.length>0&&(s.query=t,l(t))):(h&&h(),s.backendApi.abortSearch(),s.query="")}},s.options.search),s.options.showSearch=!0,s.$watch("options.search.show",function(e){s.autoFocus=e&&n.treatAsDesktop(),e||a.find("input").blur()}),s.$watch("selectionsApi.active && !focused",function(e){e?d=c():void 0!==e&&d&&d()}),s.$on("$destroy",function(){r.off(".listboxSearch"+s.$id),r.off(".watchKeyChars"+s.$id),delete s.options.search}),s.options.isPopover&&s.options.search.toggle(!0,s.options.search.defaultStr)}}}])}),define("extensions.qliktech/listbox/listbox",["qvangular","objects.backend-api/listbox-api","extensions.qliktech/listbox/listbox-properties","client.utils/property-mapper","text!./listbox.ng.html","objects.utils/data-properties/listobject-handler","objects.extension/object-conversion","general.scroll/api/vertical-scroll-api","general.scroll/api/dom-api","general.scroll/api/data-api","objects.extension/base-controller","general.utils/support","objects.extension/default-selection-toolbar","objects.utils/event-utils","client.utils/rtl/rtl-util","general.utils/qv-keyboard-shortcuts","core.utils/feature-flags","client.utils/theme/theme-module","client.services/export-dialog/export-dialog","general.scroll/scroll-area","objects.grid/directives/selections","./listbox-search"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,v){"use strict";function y(e,t,n){function i(e){return(e.metaKey||e.ctrlKey)&&65===e.which}function r(e){!l.query&&i(e)&&(o(),e.preventDefault())}function o(){l.clearItemStates(!1),l.selectionsApi.selectionsMade=!0,l.backendApi.selectAll()}var s=".selections-keyboard-"+n;e.on("keyup"+s,function(e){t.focused&&t.query||t.confirmedSearch?t.confirmedSearch=!1:27===e.which?t.selectionsApi.cancel():13===e.which&&t.selectionsApi.confirm()}),e.on("keypress"+s,r),e.on("keydown"+s,r);var a=m.createGroup("listbox",0),l=t;return a.registerKeys("ctrl+a",function(){o()}),a.on(),function(){e.off(s),a.delete()}}function b(e,t){e.listStyle={color:t.getStyle("content","color"),"font-size":t.getStyle("content","fontSize")}}var x,q,C;return C=l.extend({getBoundingBox:function(){return this.$scrollArea[0].getBoundingClientRect()}}),q=c.extend({init:function(e){this.visualizationCtrl=e},getRows:function(){return this.visualizationCtrl.getRows()},getRowCount:function(){return this.visualizationCtrl.getRowCount()},getFirstElementIndex:function(){return this.visualizationCtrl.getFirstElementIndex()},getLastElementIndex:function(){return this.visualizationCtrl.getLastElementIndex()},onVirtualScroll:function(e,t){return this.visualizationCtrl.onVirtualScroll(e,t)},onInitialNativeScroll:function(e,t){return this.visualizationCtrl.onInitialNativeScroll(e,t)},onGotoNextBlock:function(e,t){return this.visualizationCtrl.onGotoNextBlock(e,t)},onGotoPreviousBlock:function(e,t){return this.visualizationCtrl.onGotoPreviousBlock(e,t)}}),x=u.extend({init:function(e,t,n){function i(t,n){var i=s.isSelected(t);i&&!n?(e.itemStates[t.dataValue]=!1,t.classNames="serverAlternative"):i||(e.selectedValues.push(t.dataValue),e.itemStates[t.dataValue]=!0,t.classNames="selected")}this._super.apply(this,arguments),this.$timeout=n;var r=v.get();g.THEMING&&(this.styleService=r.initializeService("object.listBox"));var o,s=this;e.itemStates={},e.selectedValues=[],e.ignoreSelectionState=!1,e.selectionsApi.watchDeactivated(function(){e.$emit("childSelectionActive",!1),e.clearItemStates(!1),e.options.search&&(e.options.search.show=!1),o&&o()}),e.selectionsApi.watchActivated(function(){e.$emit("childSelectionActive",!0),o&&o(),o=y(t,e,e.$id)}),e.selectionsApi.clear=function(){this.selectionsMade=!0,e.backendApi.clearSelections(),e.removeAllSelections()},e.activateSelections=function(){e.selectionsApi.active||e.clearItemStates(!1),e.selectionsApi.activate()},e.clearItemStates=function(t){e.itemStates={},e.ignoreSelectionState=t},e.removeAllSelections=function(t){e.clearItemStates(!0),e.items.forEach(function(e){e!==t&&(e.classNames="serverOptional")})},e.selectValues=function(t,n){e.selectionsApi.selectionsMade=!0,e.backendApi.select(0,t,n).then(function(t){t||e.selectionsApi.clear()})},e.select=function(t,n){var r=e.selectionsApi.getKeyAsToggleSelected(t);e.activateSelections(),r||e.removeAllSelections(n),i(n,!1),e.selectValues([n.dataValue],r)},e.multiselectStart=function(t){var n=e.selectionsApi.getKeyAsToggleSelected(t);e.activateSelections(),e.selectedValues=[],n||e.removeAllSelections()},e.multiselectUpdate=function(t,n){var r,o,s;if(-1!==e.items.indexOf(n))if(o=e.items.indexOf(t),s=e.items.indexOf(n),o<=s)for(r=o;r<=s;++r)i(e.items[r],!0);else if(o>s)for(r=o;r>=s;--r)i(e.items[r],!0)},e.multiselectEnd=function(t){e.selectedValues.length&&e.selectValues(e.selectedValues,e.selectionsApi.getKeyAsToggleSelected(t))},e.selectWhileLocked=function(){p.showLockedFeedback([e.layout.qListObject.qDimensionInfo])},e.$on("$destroy",function(){o&&o()}),Object.defineProperties(e,{isDesktop:{get:function(){return h.treatAsDesktop()}}})},update:function(e,t,n,i){g.THEMING&&b(this.$scope,this.styleService);var r=this.getDataInfo(e,t);return this.$scope.backendApi.getData(r.rects).then(function(e){return this.onUpdateData(e,n,i)}.bind(this))},getDataInfo:function(e,t){return e=e||0,{rects:[{qTop:e,qLeft:0,qWidth:1,qHeight:t}]}},stateMap:{S:"Selected",A:"Alternative",O:"Optional",XS:"SelectedExcluded",L:"Locked",X:"Excluded",XL:"ExcludedLock"},getState:function(e){return this.stateMap[e]},getItemClassNames:function(e,t){var n=this.getState(t);return this.useClientItemState(e)?this.$scope.itemStates[e]?"XS"===t?"server"+n:"selected server"+n:"Selected"===n?"serverOptional":"server"+n:"server"+n},useClientItemState:function(e){return this.$scope.ignoreSelectionState||e in this.$scope.itemStates},isSelected:function(e){return this.useClientItemState(e.dataValue)?!!this.$scope.itemStates[e.dataValue]:"S"===e.state||"XS"===e.state},updateTextItem:function(e,t){var n,i,r,o,s=t.qHighlightRanges&&t.qHighlightRanges.qRanges.length||0,a=t.qText&&t.qText.split("")||[],l=0;if(e.textItems=[],a.length||e.textItems.push({isHighlighted:!1,text:""}),s){for(r=t.qHighlightRanges.qRanges.sort(function(e,t){return e.qCharPos-t.qCharPos}),n=0;n<s;++n)(o=(i=r[n]).qCharPos)!==l&&e.textItems.push({isHighlighted:!1,text:a.splice(0,o-l).join("")}),e.textItems.push({isHighlighted:!0,text:a.splice(0,i.qCharCount).join("")}),l=i.qCharPos+i.qCharCount;a.length&&1024-l>0&&e.textItems.push({isHighlighted:!1,text:a.splice(0,1024-l).join("")})}else e.textItems.push({isHighlighted:!1,text:(t.qText||"").substring(0,1024)})},updateItems:function(e,t,n){var i,r,o,s,a,l,c,u=0,h=e[0].qArea.qTop,d=e[0].qArea.qHeight,p=this.$scope.items,m=e[0].qMatrix,g=f.supportDirAuto(),v={rtl:"right",ltr:"left"};for(n&&m.reverse(),t&&(u=p.length),a=this.$scope.backendApi.isLocked(),i=0,r=m.length;i<r;++i)p[u+i]||(p[u+i]={style:{}}),s=p[u+i],l="NaN"!==(o=m[i][0]).qNum,c=f.detectTextDirection(o.qText),s.locked=a,s.dataValue=o.qElemNumber,s.dataColIx=0,s.dataRowIx=n?h+d-i-1:h+i,s.state=o.qState,s.classNames=this.getItemClassNames(o.qElemNumber,o.qState),s.isDimensionValue=!0,s.text=o.qText,s.tipText=(o.qText||"").substring(0,1024),s.dir=g?"auto":c,s.style.textAlign=l?"right":v[c],this.updateTextItem(s,o);t||p.splice(i),n&&p.reverse()},onUpdateData:function(e,t,n){return this.updateItems(e,t,n),this.$timeout(function(){},0,!1)},process:function(e,t,n){return this.update(e,t,!1,!1).then(function(){return this.$scope.scrollApi.setTotalRows(this.$scope.layout.qListObject.qSize.qcy),this.$scope.scrollApi.setVirtualSize(n)}.bind(this))},processPaint:function(){var e,t;return e=this.$scope.scrollApi.settings.viewportRowCount,t=this.$scope.scrollApi.resetNativeScroll(),this.process(0,e,!1).then(function(){t()})},processResize:function(){var e=this.$scope.items.length,t=e?this.$scope.items[0].dataRowIx:0,n=this.$scope.scrollApi.settings.viewportRowCount;return n<e&&(n=e),this.process(t,n,!0)},onVirtualScroll:function(e,t){var n=this.update(e,t,!1,!1);return this.$scope.$digest(),n},gotoBlock:function(e,t,n){var i=this.$scope.scrollApi.getSpliceArgs(),r=this.$scope.items;return n&&r.reverse(),r.splice.apply(r,i),this.update(e,t,!0,n)},onGotoNextBlock:function(e,t){return this.gotoBlock(e,t,!1)},onGotoPreviousBlock:function(e,t){return this.gotoBlock(e,t,!0)},getRows:function(){return this.$scope.items},getRowCount:function(){return this.$scope.items.length},getFirstElementIndex:function(){return this.$scope.items[0].dataRowIx},getLastElementIndex:function(){return this.$scope.items[this.$scope.items.length-1].dataRowIx},getSelectionToolbar:function(){var e=this.$scope,t=new d(e.backendApi,e.selectionsApi,!1,!1,[],[{name:"Selections.All",tid:"selection-toolbar-menu.selectAll",iconClass:"icon-selection-toolbar-selectAll",buttonClass:"",action:function(){e.clearItemStates(!1),this.selectionsApi.selectionsMade=!0,this.backendApi.selectAll()},isDisabled:function(){return!this.hasState(["qOption","qAlternative","qExcluded","qDeselected"])}},{name:"Selections.Possible",tid:"selection-toolbar-menu.selectPossible",iconClass:"icon-selection-toolbar-selectPossible",buttonClass:"",action:function(){e.clearItemStates(!1),this.selectionsApi.selectionsMade=!0,this.backendApi.selectPossible()},isDisabled:function(){return!this.hasState(["qOption"])}},{name:"Selections.Alternative",tid:"selection-toolbar-menu.selectAlternative",iconClass:"icon-selection-toolbar-selectAlternative",buttonClass:"",action:function(){e.clearItemStates(!1),this.selectionsApi.selectionsMade=!0,this.backendApi.selectAlternative()},isDisabled:function(){return!this.hasState(["qAlternative"])}},{name:"Selections.Excluded",tid:"selection-toolbar-menu.selectExcluded",iconClass:"icon-selection-toolbar-selectExcluded",buttonClass:"",action:function(){e.clearItemStates(!1),this.selectionsApi.selectionsMade=!0,this.backendApi.selectExcluded()},isDisabled:function(){return!this.hasState(["qExcluded","qAlternative"])}}]);return t.buttons[0].isDisabled=function(){return!e.backendApi.hasSelections()},t}}),x.$inject=["$scope","$document","$timeout"],e.directive("qvListbox",["$timeout",function(e){return{restrict:"E",replace:!0,template:r,require:"^qvObjectContent",link:function(t,n,i,r){var o=n.find(".qv-listbox-scroll-area"),s=o.controller("qvScrollArea"),l=n.find(".qv-scroll-loader:not(.qv-scroll-row-loader)").controller("qvScrollLoader"),c=o.find(".qv-scroll-row-loader").controller("qvScrollLoader"),u="."+t.id+"-listbox",h={blockSize:200,minRowHeight:30,maxRowHeight:30},d=t.scrollApi=new a(e,h),p=new q(r),f=new C(n,o,"li:not(.qv-listbox-load-buttons)","li:not(.qv-listbox-load-buttons):first","li:not(.qv-listbox-load-buttons):not(.qv-scroll-row-loader):last");t.items=[],t.$on("$destroy",function(){d.destroy(),n.off(u)}),n.on("contextmenu"+u,function(e){t.object.selectionsApi.active&&e.preventDefault()});var m=d.initialize(f,p,s,l).then(function(){t.options.isPopover&&t.activateSelections(),t.$watch("options.search.show",function(e,n){var i=e===n;t.options.isPopover||i||t.scrollApi.setVirtualSize(!0)}),r.setInteractionState=function(){var e=this.$scope.object&&this.$scope.object.inAnalysisState(),n=e&&!1!==t.options.navigation,i=e&&!1!==t.options.selections;t.interactive=i,n&&!t.navigatable?(t.navigatable=!0,t.scrollApi.activate()):!n&&t.navigatable&&(t.navigatable=!1,t.scrollApi.deactivate())},r.setDirection=function(e){t.options.direction=e},r.onPaint=function(){var e=t.scrollApi.totalRows===this.$scope.layout.qListObject.qSize.qcy,n=t.selectionsApi.active;return n&&e?r.processResize():n||e?r.processPaint():(t.scrollApi.updateViewport(),r.processResize())},r.onResize=function(){return t.scrollApi.updateViewport(),r.processResize()},r.onInitialNativeScroll=function(e,t){return c.fadeIn(0,0,{width:"100%",height:"30px"}).then(function(){return r.update(e,t,!0,!1).then(function(){return c.fadeOut()})})}});r.onInit=function(){return m}}}}]),{type:"listbox",template:"<qv-listbox></qv-listbox>",controller:x,initialProperties:{qListObjectDef:{qShowAlternatives:!0,qInitialDataFetch:[{qTop:0,qLeft:0,qWidth:0,qHeight:0}],qDef:{qSortCriterias:[{qSortByState:1,qSortByAscii:1,qSortByNumeric:1,qSortByLoadOrder:1}]}}},data:{dimensions:{min:1,max:1}},mapProperties:function(){this.mappedDefinition=i.mapDefinition(this.definition,this.type),this.dimensionDefinition=i.findDefinition(this.mappedDefinition,"qListObjectDef",!0)},getCreatePropertyHandler:function(e){return new o({app:e,dimensionDefinition:this.dimensionDefinition})},showRequirements:function(e){var t=e.layout;return!t.qListObject||!t.qListObject.qDimensionInfo||!!t.qListObject.qDimensionInfo.qError},BackendApi:t,definition:n,options:{search:{},selections:{}},getDropFieldOptions:function(e,t,n,i){e.Add(n,t),e.ReplaceDimensions(n,t),i()},getDropMeasureOptions:function(e,t,n,i){i()},importProperties:s.listbox.importProperties,exportProperties:s.listbox.exportProperties}}),define("objects.backend-api/field-api",["./backend-api"],function(e){"use strict";return e.extend("FieldApi",{init:function(e){this._super(e,"/dimensions"),this.cacheCube.setMethodName("getListObjectData")},updateCache:function(){},getProperties:function(){return this.model.getProperties()},getData:function(e){return this.cacheCube.getData(e)},getSize:function(){return this.model.layout.qListObject.qSize},isLocked:function(){return this.model.layout.qListObject.qDimensionInfo.qLocked}})}),define("extensions.qliktech/filterpane/filterpane-properties",[],function(){var e,t,n,i;return i={qSortByState:1,qSortByAscii:1,qSortByNumeric:1,qSortByLoadOrder:1},e={uses:"settings",items:{general:{items:{showTitles:{defaultValue:!1}}}}},t={type:"array",component:"filterpane-data",translation:"Common.Data",allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"properties.dimensions.add",grouped:!1,ref:"qChildListDef",items:{libraryId:{type:"string",component:"library-item",libraryItemType:"dimension",ref:"qListObjectDef.qLibraryId",translation:"Common.Dimension",show:function(e){return e.qListObjectDef.qLibraryId}},field:{type:"string",component:"expression",expressionType:"dimension",ref:"qListObjectDef.qDef.qFieldDefs.0",translation:"Common.Field",show:function(e){return!e.qListObjectDef.qLibraryId},change:function(e){var t=e.qListObjectDef.qDef;t.qFieldLabels||(t.qFieldLabels=[]),t.qFieldLabels[0]=t.qFieldDefs[0]}},title:{ref:"title",type:"string",expression:"optional",translation:"Common.Title"},autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",defaultValue:!0,show:!1},cId:{ref:"qListObjectDef.qDef.cId",type:"string",show:!1}}},n={type:"items",component:"filterpane-sorting",translation:"properties.sorting",allowMove:!0,schemaIgnore:!0,items:{autoSort:{ref:"qListObjectDef.qDef.autoSort",type:"boolean",translation:"properties.sorting",component:"switch",defaultValue:!0,options:[{value:!0,translation:"Common.Auto"},{value:!1,translation:"Common.Custom"}],change:function(e){if(e.qListObjectDef.qDef.autoSort)for(var t=e.qListObjectDef,n=0;n<t.qDef.qSortCriterias.length;n++)t.qDef.qSortCriterias[n]=i}},dimension:{component:"sorting-dimension",ref:"qListObjectDef",show:function(e){return!e.qListObjectDef.qDef.autoSort},sortingItems:{expression:!0,frequency:!0,numeric:!0,ascii:!0}}}},{type:"items",component:"accordion",items:{data:t,sorting:n,settings:e}}}),define("extensions.qliktech/filterpane/filterpane-handler",["objects.utils/data-properties/data-property-handler","objects.utils/data-properties/listobject-util","objects.utils/data-properties/library-utils","util","general.utils/visualizations"],function(e,t,n,i,r){"use strict";return e.extend({init:function(e){this._super(e),this.dimensionLayout=[],this.dimensions=[]},autoSortDimension:function(e){return e.qLibraryId?this.app.getDimensionList().then(function(i){var r=n.findLibraryDimension(e.qLibraryId,i),o=r?r.qData.info:void 0;return t.autoSortDimension(e,o),e}):this.app.getFieldList().then(function(i){var r=n.findField(e.qDef.qFieldDefs[0],i),o=r?[r]:void 0;return t.autoSortDimension(e,o),e})},getDimensions:function(){return this.dimensions||[]},minDimensions:function(){return 1},maxDimensions:function(){return 1e3},setModel:function(e){this.model=e},addDimension:function(e){var t,n=this;if(e.qDef.cId=i.generateId(),e.qShowAlternatives=!0,this.getDimensions().length<1e3)return t=r.getType("listbox"),t.getInitialProperties({}).then(function(t){return n.autoSortDimension(e).then(function(){return t.qListObjectDef=e,e.qLibraryId?n.app.getDimension(e.qLibraryId).then(function(e){return e.getProperties().then(function(e){return e.qDim.qLabelExpression?t.title={qStringExpression:{qExpr:e.qDim.qLabelExpression}}:t.title=e.qDim.title,n.model.createChild(t,n.properties).then(function(){return t.qListObjectDef})})}):(t.title=e.qDef.title||e.qDef.qFieldLabels[0]||e.qDef.qFieldDefs[0],n.model.createChild(t,n.properties).then(function(){return t.qListObjectDef}))})})},removeDimension:function(e){var t=this.layout.qChildList.qItems[e];return this.model.destroyChild(t.qInfo.qId,this.properties).then(function(){return t})},getDimensionLayouts:function(){return this.dimensionLayout||[]},getDimensionLayout:function(e){var t=this.getDimensionLayouts();return t[e]?t[e].qListObject.qDimensionInfo:""}})}),define("text!extensions.qliktech/filterpane/filterpane.ng.html",[],function(){return'<qv-filterpane\n\t\tclass="qv-filterpane"\n\t\tqv-collapsed-listbox-delegated-open\n\t\toutside-ignore-name="outsideIgnoreName"\n\t\tinteractive="interactive"\n\t\tqva-direction x-dir-setting="{{options.direction}}"\n\t\tng-class="{\'qv-filterpane-scrollable\': !hasExpanded && !options.zoomEnabled}">\n\t<div ng-repeat="column in columns" class="qv-filterpane-column" ng-class="{ \'qv-fullscreen-hidden\': $last && column.showAll && !object.expanded }">\n\t\t<div ng-repeat="item in column.items"\n\t\t\t ng-class="{\'qv-filterpane-collapsed\': !item.expand, \'qv-filterpane-expanded\': item.expand}"\n\t\t\t ng-style="{height: item.height}"\n\t\t\t tid="qv-object-filterpane.dimension">\n\t\t\t<qv-object ng-if="item.expand" model="item.model" options="item.options" object="item.object"></qv-object>\n\t\t\t<qv-collapsed-listbox ng-if="!item.expand" model="item.model" read-direction="options.direction" outside-ignore-name="outsideIgnoreName" responsive-mode="item.responsiveMode" interactive="interactive"></qv-collapsed-listbox>\n\t\t</div>\n\n\t\t<div ng-if="column.showAll && object.expanded" class="qv-filterpane-collapsed qv-filterpane-showall">\n\t\t\t<div class="presentation" q-title-translation="Tooltip.Filterpane.NotAllItemsShow"></div>\n\t\t</div>\n\t\t<div ng-if="column.showAll && !object.expanded" class="qv-filterpane-collapsed qv-filterpane-fullscreen">\n\t\t\t<button class="add-button lui-button"\n\t\t\t\t\tng-class="{ \'lui-disabled\': !object.inAnalysisState() }"\n\t\t\t\t\tqva-activate="triggerFullScreen()"\n\t\t\t\t\tq-title-translation="Tooltip.Filterpane.ClickForFullScreen"></button>\n\t\t</div>\n\t</div>\n</qv-filterpane>\n'}),define("extensions.qliktech/filterpane/filterpane-layout",["angular","qvangular","general.utils/responsive-state","client.utils/property-resolver"],function(e,t,n,i){"use strict";t.service("qvFilterpaneLayout",function(){return{getMaxColumns:function(e){return n.isSmallDevice?1:Math.floor((e.width+20)/180)||1},getMaxItemsPerColumn:function(e){return Math.max(1,Math.floor((e.height+10)/44))},getDimensionCount:function(e){return e.qChildList.qItems.length},getColumnItemsCount:function(e){var t=0;return e.forEach(function(e){t+=e.itemCount}),t},getHeightOf:function(e){var t=44*e-10;return Math.max(t,0)},getDimensionCardinal:function(e){var t=i.getValue(e,"model.layout.qListObject.qDimensionInfo.qStateCounts",void 0);if(t)return Object.keys(t).reduce(function(e,n){return e+t[n]},0)},getHeightOfExpanded:function(e){return 30*e+47+3},doesAllFit:function(e,t,n){return n<=e*t},haveRoomToExpandOne:function(e,t){var i=t.itemCount>1?10:0;return!n.isSmallDevice&&e.height>this.getHeightOf(t.itemCount-1)+89+i},getSize:function(e,t){return{width:e.innerWidth()-1,height:e.innerHeight(),dimensionCount:this.getDimensionCount(t)}},sizeChanged:function(t,n){return!e.equals(t,n)},calculateColumns:function(e,t,i){var r=!n.isSmallDevice&&e.height>89,o=this.getMaxColumns(e),s=this.getMaxItemsPerColumn(e),a=this.getColumnItemsCount(t);if(r&&this.doesAllFit(s,o-t.length-1,e.dimensionCount-a-1))t.push({expand:!0,itemCount:1}),a+1<e.dimensionCount&&this.calculateColumns(e,t,i);else{var l;l=Math.min(e.dimensionCount-a,s),n.isSmallDevice?l=e.dimensionCount-a:i||(l=Math.ceil((e.dimensionCount-a)/(o-t.length)),l=Math.max(s,l),l=Math.min(e.dimensionCount-a,l)),t.push({expand:!1,itemCount:l}),t.length>=o&&s>0&&this.getColumnItemsCount(t)<e.dimensionCount&&(t[t.length-1].showAll=!0,38>e.height-this.getHeightOf(s)&&(t[t.length-1].itemCount=Math.max(t[t.length-1].itemCount-1,0))),this.getColumnItemsCount(t)<e.dimensionCount&&t.length<o&&this.calculateColumns(e,t,i)}},balanceColumns:function(e,t){var n,i,r;return n=t.filter(function(e){return e.expand}),(i=t.filter(function(e){return!1===e.expand})).length>0&&!i[i.length-1].showAll&&this.haveRoomToExpandOne(e,i[i.length-1])?i[i.length-1].expand=!0:(r=this.getColumnItemsCount(i),i.forEach(function(e,t){var n,o;n=t<r%i.length?1:0,o=Math.floor(r/i.length)+n,e.itemCount=o},this)),i.concat(n)},getDimensions:function(e){return e.qChildList.qItems.map(function(e){return{id:e.qInfo.qId,expand:!1,height:void 0,responsiveMode:"full"}})},sortDimensions:function(e,t){return e.qChildList.qItems.map(function(e){return e.qInfo.qId}).map(function(e){return t.filter(function(t){return t.id===e})[0]})},isValid:function(e){return!!e&&!!e.qChildList&&!!e.qChildList.qItems&&this.getDimensionCount(e)>0},mergeColumnsAndDimensions:function(e,t){return e.forEach(function(e){e.items=t.slice(0,e.itemCount),t=t.slice(e.itemCount)},this),e},reSizeArray:function(e,t,n,i){for(;e.length>t;)e.pop();for(;e.length<t;)e.push(n.extend(!0,{},i))},dimensionsEqual:function(e,t){return e.id===t.id&&e.expand===t.expand&&e.height===t.height},shouldDimensionBeUpdated:function(e,t){return!this.dimensionsEqual(e,t)},patchScope:function(e,t,n){this.resizeScopeArrays(e,t,n),e.columns.forEach(function(n,i,r){var o=t[i];r[i].showAll=o.showAll,r[i].expand=o.expand,r[i].itemCount=o.itemCount,n.items.forEach(function(t,n){var i=o.items[n];this.shouldDimensionBeUpdated(t,i)&&(i.expand||delete t.options,i.expand&&!t.options&&(t.options={isPopover:!1,isReadonly:e.object.isReadonly,interactionState:e.options.interactionState,card:e.options.card,selections:e.options.selections,navigation:e.options.navigation,direction:e.options.direction}),this.copyDimensionValues(i,t))},this)},this)},expandOne:function(e,t){var n,i,r;for(n=0;n<e.length;n++)if((i=e[n]).cardinal&&!i.expand&&(r=this.getHeightOfExpanded(i.cardinal))<t)return i.expand=!0,i.height=r+"px",r+10;return!1},calculateExpandPriority:function(e,t){e.forEach(function(e){if(e.expand){var n,i,r=0,o=t.height-this.getHeightOf(e.itemCount-1)-10,s=0;if(e.items.forEach(function(e){e.cardinal=this.getDimensionCardinal(e)}.bind(this)),(n=e.items.concat().sort(function(e,t){return e.cardinal-t.cardinal})).length>1){for(;o>89;){var a=this.expandOne(n,o);if(!a)break;r++,s+=a,o=t.height-this.getHeightOf(e.itemCount-r)-s}var l=n.filter(function(e){return e.expand});s=0,l.forEach(function(e){s+=this.getHeightOfExpanded(e.cardinal)+10},this),o=t.height-this.getHeightOf(e.itemCount-l.length)-s}if(i=n.filter(function(e){return!e.expand}),o>89&&i.length){var c=i[0],u=i.length>1?10:0;c.expand||(n.length>1&&(c.height=t.height-this.getHeightOf(i.length-1)-s-u+"px"),c.expand=!0)}}1===e.items.length&&t.height<30&&(e.items[0].responsiveMode=t.height<17?"spark":"small",e.items[0].height=t.height+"px")},this)},resolveAllModels:function(e,t,n,i){var r=[];return t.forEach(function(t,i){var o=e.columns[i]||{items:[]};t.items.forEach(function(e,t){var i=o.items[t]||{};this.shouldDimensionBeUpdated(e,i)||!i.model?r.push(n(e)):e.model=i.model},this)},this),i.all(r)},resizeScopeArrays:function(e,t,n){e.columns.length!==t.length&&this.reSizeArray(e.columns,t.length,n,{items:[]}),e.columns.forEach(function(i,r){i.items.length!==t[r].items.length&&this.reSizeArray(e.columns[r].items,t[r].items.length,n,{})},this)},copyDimensionValues:function(e,t){Object.keys(e).forEach(function(n){t[n]=e[n]})},getResolveModelFunction:function(e){return function(t){return this.resolveModel(t,e)}.bind(this)},resolveModel:function(e,t){return t.getObject(e.id).then(function(t){return e.model=t,t.getLayout()})}}})}),define("text!extensions.qliktech/filterpane/directives/collapsed-listbox/collapsed.ng.html",[],function(){return'<div class="qv-collapsed-listbox"\n\t ng-class="{locked: isLocked, error: hasError, spark: responsiveMode == \'spark\', small: responsiveMode == \'small\', interactive: interactive}"\n\t qva-outside-ignore-for="{{outsideIgnoreName}}"\n\t qva-direction x-dir-setting="{{readDirection}}">\n\t<div class="error-layer"></div>\n\t<div class="title-wrapper">\n\t\t<span ng-if="isLocked" class="lui-icon lui-icon--lock" qva-direction x-dir-setting="{{readDirection}}"></span>\n\t\t<span ng-if="isDrillDown" class="lui-icon lui-icon--select-alternative" q-title-translation="Tooltip.dimensions.drilldown" x-dir-setting="{{readDirection}}"></span>\n\t\t<span class="title" ng-attr-title="{{title}}" qva-direction x-dir-setting="{{readDirection}}" x-dir-text="{{title}}">{{title}}</span>\n\t</div>\n\t<qv-state-count-bar ng-if="!hasError" state-counts="stateCounts" options="options"></qv-state-count-bar>\n</div>\n'}),define("extensions.qliktech/filterpane/directives/collapsed-listbox/collapsed",["angular","qvangular","jquery","core.utils/bind-layout","text!./collapsed.ng.html","general.utils/responsive-state","client.views/state-count-bar/state-count-bar","objects/listbox-popover/listbox-popover-service","objects/listbox-popover/listbox-popover-service-mobile"],function(e,t,n,i,r,o){"use strict";t.directive("qvCollapsedListbox",function(){return{restrict:"E",replace:!0,template:r,scope:{model:"=",outsideIgnoreName:"=",responsiveMode:"=",interactive:"=",readDirection:"="},require:"^qv-collapsed-listbox-delegated-open",link:function(e){e.title="",e.hasError=!1,e.isLocked=!1,e.options={direction:e.readDirection},i(e,"model",function(n){t.$apply(e,function(){var t=n.qListObject.qDimensionInfo;e.hasError=!(!n.qListObject.qError&&!n.qListObject.qDimensionInfo.qError),e.stateCounts=t.qStateCounts,e.isLocked=t.qStateCounts.qLocked>0,e.isDrillDown="H"===t.qGrouping,e.title=n.title,e.id=n.qInfo.qId})})}}}),t.directive("qvCollapsedListboxDelegatedOpen",function(){return{restrict:"A",scope:{outsideIgnoreName:"=",interactive:"=?"},controller:["$scope","$element","qvListboxPopoverService","qvListboxPopoverServiceMobile",function(t,i,r,s){function a(e,t){return{left:e.position().left-t.position().left,top:e.position().top-t.position().top,right:t.width()-e.position().left-e.width(),bottom:t.height()-e.position().top-e.height()}}function l(e,t){var n=a(e,t);return Math.max(n.left,n.right)>Math.max(n.top,n.bottom)?n.left>n.right?"left":"right":n.top>n.bottom?"top":"bottom"}var c;i.on("qv-activate",".qv-collapsed-listbox:not(.error)",function(a){var u=e.element(a.target).closest(".qv-collapsed-listbox"),h=u.isolateScope().model,d=u.isolateScope().id,p=u.isolateScope().options.direction,f={qvaOutsideIgnoreFor:t.outsideIgnoreName,$alignToElement:u,position:l(u,i),collision:"flipfit",direction:p};if(a.preventDefault(),t.interactive){if(d===c)return o.isSmallDevice?s.close():r.close(),void(c=void 0);c=d;var m,g=o.isSmallDevice?s.show(h,f):r.show(h,f);o.isSmallDevice||(g.closing.then(function(e){e&&!n(e.target).closest(".qv-collapsed-listbox").length>0&&(c=void 0),m=e}),g.closed.then(function(){g=null,m||(c=void 0)}))}})}]}})}),define("extensions.qliktech/filterpane/filterpane",["jquery","qvangular","util","core.utils/deferred","objects.backend-api/field-api","extensions.qliktech/filterpane/filterpane-properties","extensions.qliktech/filterpane/filterpane-handler","objects.utils/data-properties/listobject-util","client.utils/property-mapper","text!./filterpane.ng.html","objects.extension/base-controller","objects.extension/export-format","objects.extension/object-conversion","extensions.qliktech/filterpane/filterpane-layout","extensions.qliktech/filterpane/directives/collapsed-listbox/collapsed"],function(e,t,n,i,r,o,s,a,l,c,u,h,d){"use strict";function p(){return"filterpane-"+ ++m}function f(e){return e.columns.some(function(e){return e.items.some(function(e){return e.expand&&(!e.object||1!==e.object.renderState)})})}var m=0,g=u.extend({size:{},columns:[],expandable:!1,init:function(t,n,i,r){this.$scope=t,this.$element=n,this.$timeout=i,this.filterpaneLayout=r,this.updateDeferred,t.object.throbberApi.off(),this.showThrobberTimeout=i(function(){t.object.throbberApi.show()},1e3),t.outsideIgnoreName=p(),t.columns=[],t.ext.expandable=function(){return this.expandable}.bind(this),t.options||(t.options={}),t.triggerFullScreen=function(){t.object.inAnalysisState()&&(e(".embedded-sheet-toolbar").length>0&&e(".embedded-sheet-toolbar").css("display","none"),t.$emit("zoomOnCell"))},t.$on("objectRenderStateChange",function(e,n){e.stopPropagation(),n&&!f(t)&&this.renderStateDfd.resolve()}.bind(this))},onPaint:function(){return this.renderStateDfd=i(),this.update(this.$scope.layout).then(function(){f(this.$scope)||this.renderStateDfd.resolve()}.bind(this)),this.renderStateDfd.promise},onResize:function(){return this.renderStateDfd=i(),this.update(this.$scope.layout).then(function(){f(this.$scope)||this.renderStateDfd.resolve()}.bind(this)),this.renderStateDfd.promise},update:function(e){this.updateDeferred&&this.updateDeferred.reject(),this.updateDeferred=new i;var t,r=this.size,o=this.$scope,s=this.columns,a=this.$element,l=o.object.model.app,c=this.filterpaneLayout,u=c.getSize(a,e),h=c.getResolveModelFunction(l);return c.sizeChanged(r,u)&&(this.size=r=u,this.columns=s=this.getColumns(r)),c.isValid(e)?(t=c.getDimensions(e),t=c.sortDimensions(e,t),this.dimensions=t,this.preferredSizeDeferred&&this.preferredSizeDeferred.resolve(),s=c.mergeColumnsAndDimensions(s,t),c.resolveAllModels(o,s,h,i).then(function(){this.updateDeferred.resolve()}.bind(this)),this.updateDeferred.promise.then(function(){c.calculateExpandPriority(s,r),c.patchScope(o,s,n),this.$timeout.cancel(this.showThrobberTimeout),o.object.throbberApi.hide(),this.expandable=!o.columns.some(function(e){return e.items.some(function(e){var t=e.model;return t&&t.layout&&t.layout.qSelectionInfo&&t.layout.qSelectionInfo.qInSelections})}),o.hasExpanded=o.columns.some(function(e){return e.expand})}.bind(this)),this.updateDeferred.promise):(o.columns=s=[],i.resolve())},getColumns:function(e){var t=[];return this.filterpaneLayout.calculateColumns(e,t,this.$scope.options.zoomEnabled),this.filterpaneLayout.balanceColumns(e,t)},setInteractionState:function(e){this.$scope.interactive=this.$scope.object&&this.$scope.object.inAnalysisState()&&!1!==this.$scope.options.navigation&&!1!==this.$scope.options.selections,this.$scope.columns.forEach(function(t){t.items.forEach(function(t){t.expand&&t.object.setInteractionState(e)})})},setDirection:function(e){this.$scope.options&&(this.$scope.options.direction=e),this.$scope.columns.forEach(function(t){t.items.forEach(function(t){t.expand&&t.object.setDirection(e)})})},getPreferredSize:function(){var e=i();this.preferredSizeDeferred&&this.preferredSizeDeferred.reject(),this.preferredSizeDeferred=i();var t=this;return this.preferredSizeDeferred.promise.then(function(){t.preferredSizeDeferred=null,e.resolve({w:t.$element.width(),h:t.filterpaneLayout.getHeightOf(t.dimensions.length)})}),this.dimensions&&this.preferredSizeDeferred.resolve(),e.promise}});return g.$inject=["$scope","$element","$timeout","qvFilterpaneLayout"],{type:"filterpane",template:c,BackendApi:r,controller:g,definition:o,initialProperties:{qChildListDef:{qData:{info:"/qInfo"}}},data:{dimensions:{min:1,max:1e3}},expandable:function(){return!1},mapProperties:function(){this.mappedDefinition=l.mapDefinition(this.definition,this.type),this.dimensionDefinition={min:1}},getCreatePropertyHandler:function(e){return new s({app:e,dimensionDefinition:this.dimensionDefinition})},addFieldDimension:function(e,n){return n.model.getProperties().then(function(i){var r=n.getCreatePropertyHandler();return r.setProperties(i),r.setModel(n.model),r.addFieldDimension(e.value,e.displayName).then(function(e){t.$rootScope.$broadcast("pp-open-path","data."+e.qDef.cId)})})},addLibraryDimension:function(e,n){return n.model.getProperties().then(function(i){var r=n.getCreatePropertyHandler();return r.setProperties(i),r.setModel(n.model),r.addLibraryDimension(e.libraryId).then(function(e){t.$rootScope.$broadcast("pp-open-path","data."+e.qDef.cId)})})},getDropFieldOptions:function(e,n,i){n.getDimensions().length<n.maxDimensions()&&(n.setModel(i),n.addFieldDimension(e.item.name,e.item.displayName).then(function(e){i.setProperties(n.properties),t.$rootScope.$broadcast("pp-open-path","data."+e.qDef.cId)}))},getDropDimensionOptions:function(e,n,i){n.getDimensions().length<n.maxDimensions()&&(n.setModel(i),n.addLibraryDimension(e.item.id).then(function(e){i.setProperties(n.properties),t.$rootScope.$broadcast("pp-open-path","data."+e.qDef.cId)}))},getDropMeasureOptions:function(e,t,n,i){i()},getExportRawDataOptions:function(e,n,r){n.model.getLayout().then(function(o){if(1===o.qChildList.qItems.length)return e.addItem({translation:"contextMenu.export",tid:"export",select:function(){n.model.app.getObject(o.qChildList.qItems[0].qInfo.qId).then(function(e){t.getService("$exportDialog").show(e)})}}),void r.resolve();var s=[];e.addItem({translation:"Export.AllDimensions",tid:"export-all-dimensions",select:function(){t.getService("$exportDialog").show(n.model)}}),o.qChildList.qItems.forEach(function(i){s.push(n.model.app.getObject(i.qInfo.qId).then(function(n){return n.getLayout().then(function(i){e.addItem({translation:i.title,tid:"export",select:function(){t.getService("$exportDialog").show(n)}})})}))}),i.all(s).then(r.resolve)})},exportProperties:function(e){var t,n,i,r,o,s=new h,a=e.qProperty,l=s.data[0];for(n=0;n<e.qChildren.length;++n)t=e.qChildren[n].qProperty,l.dimensions.push({qDef:t.qListObjectDef.qDef,qLibraryId:t.qListObjectDef.qLibraryId,qOtherTotalSpec:t.qListObjectDef.qOtherTotalSpec||{qOtherMode:"OTHER_OFF",qOtherCounted:{qv:"10"}},title:t.title});if(a.qLayoutExclude&&a.qLayoutExclude.qHyperCubeDef){if(a.qLayoutExclude.qHyperCubeDef.qDimensions)for(n=0;n<a.qLayoutExclude.qHyperCubeDef.qDimensions.length;++n)l.excludedDimensions.push(a.qLayoutExclude.qHyperCubeDef.qDimensions[n]);if(a.qLayoutExclude.qHyperCubeDef.qMeasures)for(n=0;n<a.qLayoutExclude.qHyperCubeDef.qMeasures.length;++n)l.excludedMeasures.push(a.qLayoutExclude.qHyperCubeDef.qMeasures[n]);if(a.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder)for(n=0;n<a.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder.length;++n)l.interColumnSortOrder.push(a.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder[n])}for(r in a)"qChildListDef"!==r&&(s.properties[r]=a[r]);if(a.qLayoutExclude||(a.qLayoutExclude={}),a.qLayoutExclude.disabled){for(r in a.qLayoutExclude.disabled)o=r,s.properties.hasOwnProperty(o)||(s.properties[o]=a.qLayoutExclude.disabled[r]);a.qLayoutExclude.disabled.previousShowTitles&&(s.properties.showTitles=!0)}for(delete a.qLayoutExclude,n=0;n<l.dimensions.length;++n)for(i=0;i<l.dimensions[n].qDef.qSortCriterias.length;++i)l.dimensions[0].qDef.qSortCriterias[i].qSortByFrequency=0,l.dimensions[0].qDef.qSortCriterias[i].qSortByState=0;return s},importProperties:function(e,t){var i,r,o={qChildren:[]},s={},l=e.data[0];s.qLayoutExclude||(s.qLayoutExclude={}),s.qLayoutExclude.disabled={};for(i in e.properties)"qLayoutExclude"===i?e.properties[i].quarantine&&(s.qLayoutExclude.quarantine=n.extend(!0,{},e.properties[i].quarantine)):t.hasOwnProperty(i)||d.isMasterItemProp(i)?s[i]=e.properties[i]:s.qLayoutExclude.disabled[i]=e.properties[i];for(s=n.extend(!0,{},t,s),r=0;r<l.dimensions.length;++r)o.qChildren.length<1e3?o.qChildren.push({qProperty:a.createDefaultListBox(l.dimensions[r],l.dimensions[r].title),qChildren:[]}):(s.qLayoutExclude||(s.qLayoutExclude={}),s.qLayoutExclude.qHyperCubeDef||(s.qLayoutExclude.qHyperCubeDef={}),s.qLayoutExclude.qHyperCubeDef.qDimensions||(s.qLayoutExclude.qHyperCubeDef.qDimensions=[]),s.qLayoutExclude.qHyperCubeDef.qDimensions.push(l.dimensions[r]));if(l.measures.length)for(s.qLayoutExclude.qHyperCubeDef||(s.qLayoutExclude.qHyperCubeDef={}),s.qLayoutExclude.qHyperCubeDef.qMeasures||(s.qLayoutExclude.qHyperCubeDef.qMeasures=[]),r=0;r<l.measures.length;++r)s.qLayoutExclude.qHyperCubeDef.qMeasures.push(l.measures[r]);for(r=0;r<l.excludedDimensions.length;++r)o.qChildren.length<1?o.qChildren.push({qProperty:a.createDefaultListBox(l.excludedDimensions[r],l.excludedDimensions[r].title),qChildren:[]}):(s.qLayoutExclude.qHyperCubeDef||(s.qLayoutExclude.qHyperCubeDef={}),s.qLayoutExclude.qHyperCubeDef.qDimensions||(s.qLayoutExclude.qHyperCubeDef.qDimensions=[]),s.qLayoutExclude.qHyperCubeDef.qDimensions.push(l.excludedDimensions[r]));for(r=0;r<l.excludedMeasures.length;++r)s.qLayoutExclude.qHyperCubeDef||(s.qLayoutExclude.qHyperCubeDef={}),s.qLayoutExclude.qHyperCubeDef.qMeasures||(s.qLayoutExclude.qHyperCubeDef.qMeasures=[]),s.qLayoutExclude.qHyperCubeDef.qMeasures.push(l.excludedMeasures[r]);for(r=0;r<l.interColumnSortOrder.length;++r)s.qLayoutExclude.qHyperCubeDef&&(s.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder||(s.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder=[]),s.qLayoutExclude.qHyperCubeDef.qInterColumnSortOrder.push(l.interColumnSortOrder[r]));return d.importCommonProperties(s,e,t),s.showTitles&&(s.qLayoutExclude.disabled.previousShowTitles=!0,s.showTitles=!1),o.qProperty=s,o}}}),define("text!extensions.qliktech/text-image/text-image.ng.html",[],function(){return'<div class="qv-ti" style=\'width: 100%; height: 100%;\' qva-activate="edit()">\n\t<div class="media-tool-scrollbar" ng-if="!editing && !initializing && !saving && !empty" dir="{{ direction }}">\n\t\t<div class="qv-media-tool-html" ng-class="[sizeClass, visibilityClass, responsiveClass, {\'qv-interactive\': navigation}]" ng-click="clickHtml($event)" ng-bind-html="html" dir="{{ textDirection }}"></div>\n\t</div>\n\t<div class="text-image-hint" ng-if="empty && !editing" ng-class="{ \'selected\': isSelected() }">\n\t\t<div class="hint-content" ng-show="!isSelected() || !editmode || object.isLink">\n\t\t\t<i class="hint-icon lui-icon lui-icon--text"></i>\n\t\t\t<div class="text" q-translation="Object.TextImage.EmptyHint"></div>\n\t\t</div>\n\t\t<div class="hint-content" ng-show="isSelected() && editmode && !object.isLink">\n\t\t\t<i class="hint-icon lui-icon lui-icon--plus"></i>\n\t\t\t<div class="text" q-translation="Object.TextImage.EmptySelectedHint"></div>\n\t\t</div>\n\t</div>\n\t<div class="qv-media-tool-editor" ng-class="[sizeClass, visibilityClass, responsiveClass]" ng-if="initializing || editing || saving" qv-text-image-editor x-editor-options="editorOptions" x-save="save" dir="{{ direction }}" qva-outside-ignore-for="media-toolbar"></div>\n</div>'}),define("extensions.qliktech/text-image/text-image-properties",["client.utils/property-resolver"],function(e){return{type:"items",component:"accordion",items:{data:{uses:"data",items:{measures:{disabledRef:""},dimensions:{disabledRef:""}}},settings:{uses:"settings",items:{general:{items:{showTitles:{defaultValue:!1}}},presentation:{type:"items",translation:"properties.presentation",items:{responsive:{type:"string",component:"dropdown",ref:"responsive",translation:"properties.textImage.responsive",defaultValue:"all",undefinedValue:"none",snapshot:{tid:"property-responsive"},options:[{value:"all",translation:"properties.textImage.responsive.textImages"},{value:"text",translation:"properties.textImage.responsive.text"},{value:"images",translation:"properties.textImage.responsive.images"},{value:"none",translation:"properties.textImage.responsive.none"}]}}},markdown:{type:"string",ref:"markdown",show:!1,defaultValue:""},images:{type:"array",ref:"images",show:!1,defaultValue:[]},backgroundImage:{type:"items",translation:"properties.backgroundImage",grouped:!0,items:{useBackgroundImage:{ref:"background.isUsed",type:"boolean",translation:"properties.backgroundImage.use",component:"switch",defaultValue:!1,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}]},backgroundUrl:{ref:"background.url.qStaticContentUrlDef.qUrl",layoutRef:"background.url.qStaticContentUrl.qUrl",schemaIgnore:!0,translation:"Common.Image",tooltip:{select:"properties.media.select",remove:"properties.media.removeBackground"},type:"string",component:"media",defaultValue:"",show:function(t){return e.getValue(t,"background.isUsed")}},backgroundSize:{ref:"background.size",translation:"properties.backgroundImage.size",type:"string",component:"dropdown",defaultValue:"auto",options:[{value:"auto",translation:"properties.backgroundImage.originalSize"},{value:"alwaysFit",translation:"properties.backgroundImage.sizeAlwaysFit"},{value:"fitWidth",translation:"properties.backgroundImage.sizeFitWidth"},{value:"fitHeight",translation:"properties.backgroundImage.sizeFitHeight"},{value:"fill",translation:"properties.backgroundImage.sizeStretch"}],show:function(t){return e.getValue(t,"background.isUsed")&&e.getValue(t,"background.url.qStaticContentUrlDef.qUrl")}},backgroundPosition:{ref:"background.position",translation:"Common.Position",type:"string",component:"align-matrix",defaultValue:"topLeft",show:function(t){return e.getValue(t,"background.isUsed")&&e.getValue(t,"background.url.qStaticContentUrlDef.qUrl")&&"fill"!==e.getValue(t,"background.size")},currentSize:function(t){return e.getValue(t,"background.size")}}}}}}}}}),define("extensions.qliktech/text-image/measure-utils",["general.utils/array-util","util"],function(e,t){function n(e,t){var n,i,r,o=[],s=[];for(n=e.map(function(e){return e.qDef.cId}),r=(i=t.map(function(e){return e.qDef.cId})).length-1;r>=0;--r)n.contains(i[r])||o.push({index:r,id:i[r],measure:t[r]});for(r=0;r<n.length;++r)i.contains(n[r])?n.lastIndexOf(n[r])!==r&&s.push({index:r,id:n[r],measure:e[r]}):s.push({index:r,id:n[r],measure:e[r]});return{removed:o,added:s}}function i(e,t,n,i){var r=-1;return n.replace(/=\[(\w*?)]\((\w*?)\)/g,function(n,o,s){if(s===e){++r;var a=void 0!==i;if(!a||a&&r===i)return"=["+o+"]("+t+")"}return n})}return{removeMeasure:function(e,t){return t.replace(/=\[(\w*?)]\((\w*?)\)/g,function(t,n,i){return e===i?"":t})},replaceMeasure:i,syncMeasures:function(r,o){var s=o.qHyperCubeDef.qMeasures,a=n(r,s);a.removed.forEach(function(t){var n=t.index;s.splice(n,1),e.indexRemoved(o.qHyperCubeDef.qInterColumnSortOrder,o.qHyperCubeDef.qDimensions.length+n)}),a.added.forEach(function(n){var r=n.measure.qDef.cId,a=t.generateId();n.measure.qDef.cId=a,s.push(n.measure),e.indexAdded(o.qHyperCubeDef.qInterColumnSortOrder,o.qHyperCubeDef.qDimensions.length+s.length-1),o.markdown=i(r,a,o.markdown,1)})}}}),define("extensions.qliktech/text-image/image-utils",["client.services/media-tool/markdown-html-parser","general.utils/paths","util"],function(e,t,n){function i(e,t){var n,i=[],r=[],o=e.map(function(e){return e.id||""}),s=t.map(function(e){return e.id});for(n=s.length-1;n>=0;--n)o.contains(s[n])||i.push({index:n,id:s[n],url:t[n].url});for(n=0;n<o.length;++n)s.contains(o[n])?o.lastIndexOf(o[n])!==n&&r.push({index:n,id:o[n],url:function(e){for(var n=0;n<t.length;n++)if(t[n].id===e)return t[n].url.qStaticContentUrlDef.qUrl;return null}(o[n])}):r.push({index:n,id:o[n],url:e[n].url});return{removed:i,added:r}}function r(e,t,n,i){var r=-1;return n.replace(/!\[(\w*?)]\((.*?)\)/g,function(n,o,s){if(o===e){++r;var a=void 0!==i;if(!a||a&&r===i)return"!["+t+"]("+s+")"}return n})}return{syncImages:function(o,s){s.images||(s.images=[]);var a=s.images,l=i(o,a);l.removed.forEach(function(e){var t=e.index;a.splice(t,1)}),l.added.forEach(function(i){var o=i.id,l=n.generateId(),c=e.unescapeMarkdown(i.url);c=t.stripBasePath(c),a.push({id:l,url:{qStaticContentUrlDef:{qUrl:c}}}),s.markdown=o?r(o,l,s.markdown,1):r(o,l,s.markdown,0)})}}}),define("client.utils/rtl/bidirectional-input-service",["jquery","client.utils/rtl/rtl-util","client.utils/rtl/direction-service"],function(e,t,n){"use strict";function i(e){return e.is("textarea,input")&&0===e.val().length||""===e[0].textContent&&0===e.has("img").length}function r(e,t){i(e)?e.css("direction",t):"rtl"!==e.css("direction")&&"ltr"!==e.css("direction")||e.css("direction","")}function o(n,i,o){n.find("div,p").each(function(n,s){i?"auto"!==s.getAttribute("dir")&&s.setAttribute("dir","auto"):s.setAttribute("dir",t.detectTextDirection(s.innerText)),r(e(s),o)})}var s={},a=t.supportDirAuto();return s.enable=function(i,s){var l=e(i);r(l,n.direction),l.attr("dir",t.getAutoOrAlternativeDirection(l[0].innerText)),s&&(l.attr("x-auto-direction-for-paragraphs",""),o(l,a,n.direction)),l.on("keyup",function(){a||l.attr("dir",t.detectTextDirection(l[0].innerText)),s&&o(l,a,n.direction),r(l,n.direction)})},s}),define("extensions.qliktech/text-image/text-image",["jquery","qvangular","core.utils/deferred","lz-string","text!./text-image.ng.html","./text-image-properties","objects.backend-api/hypercube-api","client.services/media-tool/media-tool-service","general.utils/string-limits","./measure-utils","./image-utils","client.utils/rtl/rtl-util","general.utils/paths","core.utils/resize","client.utils/rtl/bidirectional-input-service"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f){function m(e){return e.background&&e.background.isUsed&&e.background.url&&e.background.url.qStaticContentUrl&&e.background.url.qStaticContentUrl.qUrl||""}function g(i,r){var o=t.getService("$timeout"),s=r.find(".qv-media-tool-html")[0];return"none"===i.responsive||void 0===i.responsive?o(function(){i.sizeClass="",i.sizeStyle={maxWidth:"",maxHeight:""},e(s).find("img").css(i.sizeStyle),i.visibilityClass="",i.responsiveClass=""},0):(i.sizeClass="",i.visibilityClass="hidden","images"===i.responsive?i.responsiveClass="responsive-images":"text"===i.responsive?i.responsiveClass="responsive-text":i.responsiveClass="responsive-images responsive-text",s?o(function(){i.sizeClass="",i.sizeStyle={maxWidth:"100%",maxHeight:"100%"},e(s).find("img").css(i.sizeStyle),e(s).addClass("default-font-size");var t=s.offsetWidth-s.clientWidth,n=(s.scrollHeight+t*s.offsetHeight/48)/s.clientHeight;e(s).width("auto"),e(s).removeClass("default-font-size"),n>1&&(i.sizeStyle={maxWidth:Math.floor(1/n*100)+"%",maxHeight:Math.floor(1/n*100)+"%"},e(s).find("img").css(i.sizeStyle)),i.sizeClass=n>3?"bp-4":n>2?"bp-3":n>1.5?"bp-2":n>1?"bp-1":"",i.visibilityClass=""},10):(i.visibilityClass="",n.resolve()))}function v(e){return!a.hasContent(e)||""===e.trim()}function y(e){var t=0;if(document.createRange){var n=document.createRange();if(n.selectNodeContents(e),n.getBoundingClientRect){var i=n.getBoundingClientRect();i&&(t=i.bottom-i.top)}}return t}function b(e){return!v(e.markdown)||m(e)}var x,q;return x={auto:"auto auto",alwaysFit:"contain",fitWidth:"100% auto",fitHeight:"auto 100%",fill:"100% 100%"},q={topLeft:"0% 0%",centerLeft:"50% 0%",bottomLeft:"100% 0%",topCenter:"0% 50%",centerCenter:"50% 50%",bottomCenter:"100% 50%",topRight:"0% 100%",centerRight:"50% 100%",bottomRight:"100% 100%"},t.directive("qvTextImageEditor",[function(){return{restrict:"A",scope:{editorOptions:"=",save:"="},link:function(t,n){a.show(n,t.editorOptions),n.on("qv-outside",function(n){e(n.target).closest(".qv-texttool-toolbar, .modal-container, .qui-immidiateContextual, .lui-popover, .lui-dialog").length||t.save()}),t.$on("$destroy",function(){t.save(),a.hide()})}}}]),{type:"text-image",BackendApi:s,definition:o,initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[]},images:[],markdown:"",background:{url:{},size:"auto"}},data:{measures:{min:0,max:1e3,description:function(){return"Measure"},add:function(e,t){t.markdown+="=[]("+e.qDef.cId+")"},remove:function(e,t){t.markdown=c.removeMeasure(e.qDef.cId,t.markdown)},replace:function(e,t,n,i){i.markdown=c.replaceMeasure(t.qDef.cId,e.qDef.cId,i.markdown)}}},support:{cssScaling:!0,snapshot:b,export:b,exportData:!0,sharing:!1},exportProperties:null,importProperties:null,template:r,showRequirements:function(){return!1},getDropMeasureOptions:function(e,t,n,i){t.getMeasures().length<t.maxMeasures()?"expression"===e.item.type?t.addExpressionMeasure(e.item.name,"").then(function(){n.setProperties(t.properties)}):t.addLibraryMeasure(e.item.id).then(function(){n.setProperties(t.properties)}):(e.ReplaceMeasures(n,t),i())},controller:["$scope","$element","$sce",function(r,o,s){function b(){var e=a.getEditorElement();f.enable(e,!0)}function C(e){var t=[];return e.find(".tokenized-measure").each(function(e,n){var r=n.getAttribute("data-measure");r=i.decompressFromBase64(r),t.push(JSON.parse(r))}),t}function S(e){function t(e){for(var t=a.getOptions().insertedImages,n=0;n<t.length;n++)if(t[n].url===e)return t[n].urlDef;return null}var n=[];return e.find("img:not(.tokenized-measure)").map(function(e,i){var r=i.getAttribute("data-image-id"),o=t(i.getAttribute("src"));o||(o=i.getAttribute("src")),n.push({id:r,url:o})}),n}function w(){t.$apply(r,function(){r.editing=!1})}var _=o.find(".qv-ti");r.isSelected=function(){return r.options.isActive||r.options.isZoomed},r.$watch("editing",function(e){r.object.preventDrag=e}),r.edit=function(){!r.object.inEditState()||r.editing||r.object.isLink||r.isSelected()&&(r.saving=!1,r.saved=!1,r.backendApi.getProperties().then(function(e){var t=r.object.getCreatePropertyHandler();t.setProperties(e),r.editorOptions={markdown:e.markdown,maxlength:l.textImage,toolbar:{style:"popover",buttons:"all",width:561},useMeasures:!0,layout:r.backendApi.model.layout,properties:e,propertyHandler:t,copiedMeasures:[],insertedImages:[],onOpen:function(e){e.saveRange(),r.$apply(function(){r.editing=!0,r.initializing=!1}),setTimeout(function(){b()},0)},isActive:function(){return r.editing||r.initializing}},r.initializing=!0}))},r.save=function(){if(!r.saving&&!r.saved){a.closing();var e=a.getMarkdown(),t=a.getEditorElement();if(null!==e&&e!==r.markdown){r.saving=!0;var n=a.getOptions().properties;n.markdown=e,c.syncMeasures(C(t),n),u.syncImages(S(t),n),r.backendApi.model.setProperties(n),r.saved=!0}else r.editing=!1}},r.clickHtml=function(t){!r.navigation&&e(t.target).closest("a").length&&t.preventDefault()},this.onPaint=function(e){var i="",o="",l="",c="",u=[];if(r.finishRender=!1,r.saving&&(r.editing=!1,r.saving=!1),i=m(e)){d.stripBasePath(i),i=(i=i.replace(/"/g,'\\"')).replace(/'/g,"\\'"),o=d.getUrl(i),l=x[e.background.size]||x.auto,c=q[e.background.position]||q.topLeft;var p=new Image,f=n();u.push(f.promise),p.onload=function(){f.resolve()},p.onerror=function(){f.resolve()},p.src=o,p.complete&&(p.onload=null,p.onerror=null,f.resolve())}_.css({backgroundImage:"url('"+o+"')",backgroundSize:l,backgroundPosition:c,backgroundRepeat:"no-repeat"}),r.empty=v(e.markdown)&&!i,r.html=s.trustAsHtml(a.toHTML(e.markdown,e,!0)),r.direction=this.view.options.direction,r.textDirection=h.getAutoOrAlternativeDirection(e.markdown),r.markdown=e.markdown,r.responsive=e.responsive;var y=t.getService("$timeout");return g(r,_).then(function(){return y(function(){if(_.find("img").each(function(e,t){t.complete||function(e){var t=n();u.push(t.promise),e.onload=function(){t.resolve()},e.onerror=function(){t.resolve()}}(t)}),u.length)return n.all(u).then(function(e){return g(r,_).then(function(){return r.finishRender=!0,e})});r.finishRender=!0},0,!1)}).then(function(){return r.backendApi.isSnapshot&&(e.snapshotData.scrollTopPercent&&_.closest(".qv-object-content").css("top",-e.snapshotData.scrollTopPercent+"%"),e.snapshotData.verticalScrollWidth&&_.find(".qv-media-tool-html").css("padding-right",e.snapshotData.verticalScrollWidth+"px")),y(function(){},500)})},this.onResize=function(){return this.onPaint.apply(this,arguments)},this.setInteractionState=function(e){this._super(e),r.navigation=(r.options.navigation||r.options.limitedInteraction)&&r.object.inAnalysisState(),r.editmode=r.object.inEditState(),r.editmode||(r.editing=!1)},this.getPreferredSize=function(){var e=n(),t=r.$watch("finishRender",function(n){if(!0===n){var i=0;_.find(".qv-media-tool-html").contents().each(function(){i+=3===this.nodeType?y(this):this.offsetHeight,"BR"===this.nodeName&&(i+=8)}),e.resolve({w:_.width(),h:i}),t()}});return e.promise},this.setSnapshotData=function(t){if(r.backendApi.isSnapshot)r.object.layout.snapshotData.scrollTopPercent&&(t.snapshotData.scrollTopPercent=r.object.layout.snapshotData.scrollTopPercent);else{var n=_.find(".qv-media-tool-html")[0];t.snapshotData.scrollTopPercent=n.scrollTop/n.clientHeight*100,t.snapshotData.verticalScrollWidth=e(n).innerWidth()-n.clientWidth}},p.on("start",w),r.$on("$destroy",function(){p.off("start",w)})}],getDropFieldOptions:function(e,t,n,i,r){e.AddFieldAsMeasure(n,t,r),i()},getDropDimensionOptions:function(e,t,n,i){i()}}}),define("objects.backend-api/pivot-api",["./backend-api"],function(e){"use strict";function t(e,t,n){var i,r,o,s=[];for(r=0;r<t.length;r++)for(i=0;i<e.length;i++)o={qType:n,qCol:t[r],qRow:e[i]},s.push(o);return s}return e.extend("PivotApi",{init:function(e){this._super(e,"/qHyperCubeDef",{mode:"P"}),this.cacheCube.setMethodName("getHyperCubePivotData")},updateCache:function(e){e&&e.qHyperCube&&"P"===e.qHyperCube.qMode?(this.cacheCube.set(e.qHyperCube.qPivotDataPages),this.cacheCube.setCubeSize(e.qHyperCube.qSize)):this.cacheCube.clear(),this.backendStackThrottle.clear()},getData:function(e){switch(this.model.layout.qHyperCube.qMode){case"P":return this.cacheCube.getData(e);default:throw"you are using a non-supported backend-api"}},getReducedData:function(e,t,n){return n=void 0!==n?n:"D1",this.model.getHyperCubeReducedData(this.path,e,t,n)},select:function(e,n,i){switch(this.model.layout.qHyperCube.qMode){case"P":return this.model.selectPivotCells(this.path,t(e,n,i));default:throw"you are using a non-supported backend-api"}},expandTop:function(e,t,n){return this.model.expandTop(this.path,e,t,n)},expandLeft:function(e,t,n){return this.model.expandLeft(this.path,e,t,n)},collapseTop:function(e,t,n){return this.model.collapseTop(this.path,e,t,n)},collapseLeft:function(e,t,n){return this.model.collapseLeft(this.path,e,t,n)},clearSelections:function(){return this.model.resetMadeSelections()},hasSelections:function(){return this.model.layout.qSelectionInfo.qMadeSelections},getSize:function(){return this.model.layout.qHyperCube.qSize}})}),define("extensions.qliktech/pivot-table/pivot-table-properties",["client.property-panel/default-properties","client.utils/property-resolver","util","translator"],function(e,t,n,i){function r(e,t,n){if(!n.properties.qHyperCubeDef.qIndentMode)return!0;var i,r=n.properties.qHyperCubeDef.qInterColumnSortOrder.indexOf(-1),o=n.properties.qHyperCubeDef.qNoOfLeftDims;return r>-1&&r<o&&o--,0===(i=n.properties.qHyperCubeDef.qDimensions.indexOf(e))||i>=o}var o,s,a;return o={uses:"settings",items:{presentation:{type:"items",translation:"properties.presentation",items:{alwaysFullyExpanded:{ref:"qHyperCubeDef.qAlwaysFullyExpanded",type:"boolean",translation:"properties.pivot.fullyExpanded",defaultValue:!1},indentMode:{ref:"qHyperCubeDef.qIndentMode",type:"boolean",translation:"properties.pivot.indentMode"}}}}},s={type:"items",translation:"properties.sorting",items:{defaultSorting:{uses:"sorting",items:{dimensions:{showPriority:!1,allowMove:!1},measures:{included:!1}}}}},a={type:"items",component:"expandable-items",translation:"properties.addons",items:{dataHandling:{uses:"dataHandling",items:{calcCond:{uses:"calcCond"}}}}},{type:"items",component:"accordion",items:{data:{type:"items",component:"pivot-data",translation:"properties.data",addTranslation:"Properties.AddData",items:{dimensions:n.extend(!0,{},e.dimensions,{items:{globalGrouping:{type:"boolean",translation:"properties.dimensionLimits.globalGrouping",ref:"qOtherTotalSpec.qGlobalOtherGrouping",defaultValue:!1,show:function(e){return"OTHER_OFF"!==t.getValue(e,"qOtherTotalSpec.qOtherMode")}},totalMode:{type:"string",component:"switch",translation:"properties.showTotals",ref:"qOtherTotalSpec.qTotalMode",defaultValue:"TOTAL_OFF",trueOption:{value:"TOTAL_EXPR",translation:"properties.on"},falseOption:{value:"TOTAL_OFF",translation:"properties.off"},show:r},totalsLabel:{type:"string",component:"expression",expressionType:"StringExpr",ref:"qTotalLabel",translation:"properties.totals.label",defaultValue:function(){return i.get("Object.Table.Totals")},show:function(e,n,i){return"TOTAL_OFF"!==t.getValue(e,"qOtherTotalSpec.qTotalMode")&&r(e,0,i)}}}}),measures:n.extend(!0,{},e.measures,{items:{tableColorBgByExpression:{component:"expression",expressionType:"measure",ref:"qAttributeExpressions.0.qExpression",translation:"Object.Table.Measure.BackgroundExpression",defaultValue:""},tableColorByExpression:{component:"expression",expressionType:"measure",ref:"qAttributeExpressions.1.qExpression",translation:"Object.Table.Measure.ForegroundExpression",defaultValue:"",change:function(e){void 0===e.qAttributeExpressions[0]&&(e.qAttributeExpressions[0]={})}}}})}},sorting:s,addons:a,settings:o}}}),define("extensions.qliktech/pivot-table/pivot-sorting-util",["general.utils/array-util"],function(e){function t(e){var t=e.qDimensions;n(t,e.qInterColumnSortOrder)&&(e.qInterColumnSortOrder=function(){for(var n=[],i=0;i<t.length;i++)n.push(i);return e.qMeasures.length>=2&&n.push(-1),n}())}function n(e,t){var n={},i=[],r=!1,o=-1!==t.indexOf(-1);t.forEach(function(e){n[e]?r=!0:n[e]=!0}),r=o?r||e.length+1!==Object.keys(n).length:r||e.length!==Object.keys(n).length,Object.keys(n).forEach(function(e){"-1"!==e&&i.push(parseInt(e,10))}),i=i.sort(function(e,t){return e-t});for(var s=0;s<i.length;++s)r=r||i[s]!==s;return r}function i(e,t){if(e.columnWidths&&!(e.columnWidths.length<2)){var n=e.columnWidths[1],i=[];t.forEach(function(e){-1!==e&&i.push(n[e])}),i.forEach(function(e,t){n[t]=e})}}return{validatePivotHyperCube:t,fixPivotHypercubeOrders:function(n){t(n);var i,r=n.qDimensions,o=n.qInterColumnSortOrder;i=o.filter(function(e){return-1!==e}),function(){for(var t=0;t<i.length;t++)if(-1!==i[t]&&i[t]!==t){var n=i[t],s=i.indexOf(t),a=i[s];e.swap(i,t,s),e.swap(r,t,s),e.swap(o,o.indexOf(n),o.indexOf(a))}}()},reorderPivotDimensions:function(e,t){var n=e.qDimensions,r=e.qInterColumnSortOrder,o=[],s=t.indexOf(-1);t.forEach(function(e){-1!==e&&o.push(n[e])}),o.forEach(function(e,t){n[t]=e}),r.splice(0,r.length);for(var a=0;a<o.length;a++)r.push(a);s>-1&&r.splice(s,0,-1),i(e,t)},reorderMeasures:function(e,t){var n=e.qMeasures,i=[];t.forEach(function(e){i.push(n[e])}),n.splice(0,n.length),i.forEach(function(e){n.push(e)})},isInvalidOrderArray:n}}),define("extensions.qliktech/pivot-table/pivot-hypercube-handler",["objects.utils/data-properties/hypercube-handler","core.utils/deferred","general.utils/array-util","extensions.qliktech/pivot-table/pivot-sorting-util","util"],function(e,t,n,i,r){"use strict";return e.extend({addDimension:function(e,n){var o=this.getDimensions(),s=void 0!==n&&n,a=this;if(e.qDef.cId||(e.qDef.cId=r.generateId()),o.length<this.maxDimensions())return this.autoSortDimension(e).then(function(){var n,r,l=a.hcProperties.qNoOfLeftDims,c=o.length;return i.fixPivotHypercubeOrders(a.hcProperties),n=a.hcProperties.qInterColumnSortOrder,r=n.indexOf(-1),s||-1!==l&&!isNaN(l)?!s&&l>=0?(r>=l?(n.splice(r,1),n.push(c),n.splice(r+1,0,-1)):(-1!==r&&--l,n.push(c)),o.splice(l,0,e),a.hcProperties.qNoOfLeftDims++):(0===c&&(a.hcProperties.qNoOfLeftDims=0),n.push(c),o.push(e)):(a.hcProperties.qNoOfLeftDims=1,n.unshift(c),o.splice(0,0,e)),t.resolve(e)})},removeDimension:function(e){var r,o,s,a=this.getDimensions(),l=this.properties.qHyperCubeDef.qNoOfLeftDims,c=this.hcProperties.qInterColumnSortOrder;for(s=0;s<c.length;s++)if(c[s]===e){o=s;break}o+1<=l&&this.properties.qHyperCubeDef.qNoOfLeftDims--;var u=this.properties.qHyperCubeDef.columnWidths?this.properties.qHyperCubeDef.columnWidths[1]:void 0;return Array.isArray(u)&&u.length>e&&u.splice(e,1),r=a.splice(e,1)[0],n.indexRemoved(this.hcProperties.qInterColumnSortOrder,e),i.fixPivotHypercubeOrders(this.hcProperties),t.resolve(r)},addMeasure:function(e){var n=this.getMeasures(),i=this;if(e.qDef.cId||(e.qDef.cId=r.generateId()),delete e.qDef.qNumFormat,n.length<this.maxMeasures()){var o=1===n.length;return n.push(e),this.autoSortMeasure(e).then(function(){return o&&i.hcProperties.qInterColumnSortOrder.push(-1),e})}if(n.length<1e3)return this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.push(e),t.resolve(e)},removeMeasure:function(e){var n,i,r,o=this.getMeasures();if(e<o.length){if(n=2===o.length,i=this.hcProperties.qMeasures.splice(e,1)[0],n){var s=this.hcProperties.qInterColumnSortOrder;r=s.indexOf(-1),s.splice(r,1),r+1<=this.hcProperties.qNoOfLeftDims&&this.hcProperties.qNoOfLeftDims--}}else i=this.hcProperties.qLayoutExclude.qHyperCubeDef.qMeasures.splice(e-o.length,1)[0];return t.resolve(i)},getSorting:function(){throw"don't call this"},changeSorting:function(){throw"don't call this"},setSorting:function(){throw"don't call this"}})}),define("text!extensions.qliktech/pivot-table/pivot-table.ng.html",[],function(){return'<div class="qv-pt" ng-class="{ \'qv-pt-interactive\': interactive, \'sortable-active\': pivoting.dragPlaceholder, \'qv-rtl-layout\': options.direction === \'rtl\', \'touch-on\': !treatAsDesktop }">\n\t<qv-table-column-width-adjuster\n\t\t\tmin-col-width="scrollApi.settings.column.minColWidth"\n\t\t\tng-if="navigatable && !selectionsApi.active && layout.qHyperCube.qNoOfLeftDims"\n\t\t\tcolumns="columns"\n\t\t\texplicit-column-widths="explicitColumnWidths"\n\t\t\tx-rtl="rtl"\n\t\t\tdir="{{direction}}">\n\t</qv-table-column-width-adjuster>\n\t<qv-scroll-area x-non-mouse-viewport-scrolling="nonMouseViewportScrolling"\n\t\t\t\t\tclass="qv-grid-object-scroll-area"\n\t\t\t\t\tqva-delegated-activate=".qv-pt-expandable#interactive && !selectionsApi.active && collapseExpand($event);"\n\t\t\t\t\tqv-sortable-list="pivoting"\n\t\t\t\t\tx-direction="viewport.direction">\n\t\t<table\tdir="{{viewport.direction}}"\n\t\t\t\tqv-selections-select-while-locked="selectWhileLocked()"\n\t\t\t\tqv-selections-toggle-dimension-value="{ selector: \'.cell\' }"\n\t\t\t\tqv-selections-on-toggle-dimension-value="interactive && selectDimensionValue(cell, $event)"\n\t\t\t\tqv-selections-exclude-toggle-dimension-value="excludeDimensionToggle($event)"\n\t\t\t\tqv-selections-multiselect="{ selector: \'.cell:not(.null-value)\' }"\n\t\t\t\tqv-selections-start-multiselect="interactive && activateSelections(cell)"\n\t\t\t\tqv-selections-update-multiselect="interactive && multiselectDimensionValues(start, current, dataColIx)"\n\t\t\t\tqv-selections-end-multiselect="interactive && multiselect()">\n\t\t\t<colgroup>\n\t\t\t\t<col ng-repeat="cell in metaGhostHeaders.headers" ng-style="cell.style" />\n\t\t\t</colgroup>\n\t\t\t<tbody ng-style="themeStyle.header">\n\t\t\t\t<tr ng-repeat="row in grid.headerRows" tid="header.row"\n\t\t\t\t\tng-class="row.classList" on-finish-render>\n\t\t\t\t\t<th ng-repeat="cell in row.cells"\n\t\t\t\t\t\tng-class="cell.classList"\n\t\t\t\t\t\tclass="cell"\n\t\t\t\t\t\tcolspan="{{cell.colspan}}"\n\t\t\t\t\t\trowspan="{{cell.rowspan}}"\n\t\t\t\t\t\tng-style="cell.style"\n\t\t\t\t\t\tqv-pivot-table-include="cell.templateSrc"\n\t\t\t\t\t\ttitle="{{cell.text}}"\n\t\t\t\t\t\ttid="header.row.cell"></th>\n\t\t\t\t</tr>\n\t\t\t\t<tr ng-repeat="row in grid.rows" tid="data.row" ng-style="themeStyle.content" on-finish-render>\n\t\t\t\t\t<td ng-repeat="cell in row.cells"\n\t\t\t\t\t\tng-class="cell.classList"\n\t\t\t\t\t\tclass="cell"\n\t\t\t\t\t\tcolspan="{{cell.colspan}}"\n\t\t\t\t\t\trowspan="{{cell.rowspan}}"\n\t\t\t\t\t\tng-style="cell.style"\n\t\t\t\t\t\tqv-pivot-table-include="cell.templateSrc"\n\t\t\t\t\t\ttitle="{{cell.text}}"\n\t\t\t\t\t\ttid="data.row.cell"></td>\n\t\t\t\t</tr>\n\t\t\t</tbody>\n\t\t</table>\n\t</qv-scroll-area>\n</div>\n'}),define("text!extensions.qliktech/pivot-table/cell-item.ng.html",[],function(){return'<div class="value" ng-class="{ \'qv-rtl-text\': cell.isRtl }" ng-bind="cell.text" dir="{{cell.dir}}"></div>\n'}),define("text!extensions.qliktech/pivot-table/header-cell-item.ng.html",[],function(){return'<div class="value" dir="{{cell.dir}}" ng-class="{ \'qv-rtl-text\': cell.isRtl }">\n\t<i class="qv-pt-expandable lui-icon" ng-if="cell.collapseExpandClass" ng-class="cell.collapseExpandClass"></i>\n\t<span ng-bind="cell.text"></span>\n</div>\n'}),define("text!extensions.qliktech/pivot-table/meta/meta-left.ng.html",[],function(){return'<div class="left-meta-headers list"\n\t tid="meta.rows"\n\t ng-repeat="list in [pivoting.rows]"\n\t qv-pivot-table-include="list.templateSrc">\n</div>'}),define("text!extensions.qliktech/pivot-table/meta/meta-top.ng.html",[],function(){return'<div class="top-meta-headers list"\n\t tid="meta.columns"\n\t ng-repeat="list in [pivoting.columns]"\n\t qv-pivot-table-include="list.templateSrc">\n</div>'}),define("text!extensions.qliktech/pivot-table/meta/meta-list.ng.html",[],function(){return'<div class="button-wrapper"\n\t ng-repeat="header in list.items track by header.id"\n\t qv-pivot-table-include="header.templateSrc">\n</div>'}),define("text!extensions.qliktech/pivot-table/meta/meta-item.ng.html",[],function(){return'<div class="lui-button qv-pt-meta-button"\n\t\ttid="meta.button"\n\t\tng-style="header.style"\n\t\tng-class="{ \'lui-active\': header.open, \'pseudo\': header.isPseudoDim, \'dragging\': header.dragging, \'lui-disabled\': !interactive || selectionsApi.active }"\n\t\tqva-outside-ignore-for="{{header.qvaOutsideIgnoreFor}}"\n\t\tqva-activate="!header.isPseudoDim && !selectionsApi.active && interactive && showDimension($event, header)">\n\t<span ng-if="header.locked" class="lui-icon lui-icon--lock"></span>\n\t<div class="meta-text" dir="{{header.dir}}" title="{{header.title}}">{{header.title}}</div>\n\t<span ng-if="!header.isPseudoDim" class="lui-icon lui-icon--search"></span>\n</div>\n'}),define("objects.grid/data-grid-provider",["qvangular","./data-grid"],function(e,t){"use strict";e.provider("qvDataGrid",function(){this.$get=[function(){return function(e){return new t(e)}}]})}),define("extensions.qliktech/pivot-table/meta/ghost-headers-provider",["qvangular","util","translator","general.utils/support"],function(e,t,n,i){"use strict";function r(e,t,n){this.calcApprMaxGlyphCnt=e,this.maxGlyphCnt=n,this.isWidthFlexible=t,this.style={}}function o(e,n,r){var o={glyphWidth:l,collapseExpandIconGlyphCnt:i.treatAsDesktop()?3:4,columnPaddingGlyphCnt:3,metaHeaderMaxGlyphCnt:160/l,cellPaddingGlyphCnt:Math.ceil(12/l),buttonPaddingGlyphCnt:Math.ceil(20/l),buttonArrowGlyphCnt:Math.ceil(13/l),buttonMarginOfSafetyGlyphCnt:2,leftTree:{minNonEmptyGlyphCnt:12,emptyGlyphCnt:3,widthFactor:.35},topTree:{wideWidthFactor:.3,growFactor:1.2,minGlyphCnt:8}};this.opts=t.extend(!0,o,e),this.layout=n,this.viewportRect=r,this.headers=[],this.maxGlyphs=0,this.availableGlyphs=0,this.leftCellCnt=0,this.dataColumnsInfo={cnt:0,width:0}}function s(e){var t=!!this.layout.qHyperCube.qAlwaysFullyExpanded;return this.sortOrder.filter(function(t,n){return e?n>=this.leftDimCnt:n<this.leftDimCnt},this).map(function(e,n){var i=0;if(-1===e)return 0;var r=this.layout.qHyperCube.qDimensionInfo[e];return n+1<this.leftDimCnt?(i=r.qApprMaxGlyphCount,t||(i+=this.opts.collapseExpandIconGlyphCnt),i=Math.max(r.othersLabel?r.othersLabel.length:0,i)):(i=r.qApprMaxGlyphCount,i+=this.opts.columnPaddingGlyphCnt),i},this).sort(function(e,t){return t-e})[0]||0}function a(e){return this.sortOrder.filter(function(t,n){return e?n>=this.leftDimCnt:n<this.leftDimCnt},this).map(function(e){var t=0;return-1===e?t=n.get("Common.Measures").length:(t=this.layout.qHyperCube.qDimensionInfo[e].qFallbackTitle.length+this.opts.buttonArrowGlyphCnt,this.layout.qHyperCube.qDimensionInfo[e].othersLabel&&(t=Math.max(this.layout.qHyperCube.qDimensionInfo[e].othersLabel.length,t))),t+this.opts.buttonPaddingGlyphCnt+this.opts.buttonMarginOfSafetyGlyphCnt},this).sort(function(e,t){return t-e})[0]||0}var l=8;o.prototype={_reset:function(){this.headers.length=0,this.maxGlyphs=0,this.availableGlyphs=0,this.leftCellCnt=0,this.dataColumnsInfo.cnt=0,this.dataColumnsInfo.width=0},_addCollapseExpandHeader:function(e){var t=new r(this.opts.collapseExpandIconGlyphCnt,!1);t.isCollapseExpandIcon=!0,e.push(t),this.availableGlyphs-=this.opts.collapseExpandIconGlyphCnt},_addCollapseExpandHeaders:function(e){for(var t=0;t<this.leftDimCnt-1&&this.leftDimCnt>1&&this.leftDimCnt<=this.sortOrderCnt;++t)this._addCollapseExpandHeader(e)},_getLeftCollapseExpandCnt:function(e){return this.isIndentMode?this.leftDimCnt-1:e},_addLeftTreeMetaGhostHeader:function(e,t,n){var i=new r(t,n>t,n);e.push(i),this.availableGlyphs-=t},_addEmptyLeftTreeMetaGhostHeader:function(e,t){var n=new r(t||this.opts.leftTree.emptyGlyphCnt,!1);e.push(n),this.availableGlyphs-=n.calcApprMaxGlyphCnt},_getDataGhostHeaders:function(){var e,t,n=[];for(e=0;this.availableGlyphs>0&&this.totDataColCnt>0&&e<this.totDataColCnt;++e){if(t=this.longestMeasureGlyphCnt,(t+=this.opts.columnPaddingGlyphCnt)/this.longestTopDimGlyphCnt<this.opts.topTree.wideWidthFactor&&(t+=t*this.opts.topTree.growFactor),0===e&&t>this.availableGlyphs&&(t=this.availableGlyphs),this.availableGlyphs-t<0){this.availableGlyphs=0;break}this.availableGlyphs-=t;var i=new r(t,!0);n.push(i)}return n},_getLeftGhostHeaders:function(e,t,n){var i=[],r=this.opts.collapseExpandIconGlyphCnt*this._getLeftCollapseExpandCnt(t),o=this.longestLeftDimGlyphCnt,s=Math.min(this.longestLeftDimTitleGlyphCnt,this.opts.metaHeaderMaxGlyphCnt);return t>0?this.isIndentMode?this._getLeftGhostHeadersIndent(i,o,s,r,t,n):this._getLeftGhostHeadersNonIndent(i,t,s,r):this._addEmptyLeftTreeMetaGhostHeader(i,e),i},_isSpaceForDataColumn:function(e,t){return this.maxGlyphs-e>=t.calcApprMaxGlyphCnt},_getLeftGhostHeadersIndent:function(e,t,n,i,r,o){var s,a,l=t;if(this.pseudoInLeftTree&&(l+=this.longestMeasureTitleGlyphCnt),r>0&&l<this.opts.leftTree.minNonEmptyGlyphCnt&&(l=this.opts.leftTree.minNonEmptyGlyphCnt),l<n-i&&(0===o.length||o.length>0&&this._isSpaceForDataColumn(n-i,o[0]))&&(l=n-i),l+i>this.availableGlyphs&&o.length>0&&!this._isSpaceForDataColumn(l+i,o[0])){var c=[],u=[];c.push(Math.ceil(l/3)),c.push(Math.ceil(this.opts.leftTree.widthFactor*this.maxGlyphs)),c.push(this.opts.metaHeaderMaxGlyphCnt),u.push(Math.min.apply(null,c)),r>0&&u.push(this.opts.leftTree.minNonEmptyGlyphCnt),u.push(this.availableGlyphs),a=l,s=Math.max.apply(null,u)}else s=l;this._addCollapseExpandHeaders(e),this._addLeftTreeMetaGhostHeader(e,s,a)},_getLeftGhostHeadersNonIndent:function(e,t,n,i){this._getLeftDimsWidths(t,n,i).forEach(function(t){this._addCollapseExpandHeader(e),this._addLeftTreeMetaGhostHeader(e,t)},this)},_getLeftDimsWidths:function(e,t,n){for(var i,r,o,s=[],a=0,l=0,c=0;c<e;++c)a+=i=this._getDimGlyphCnt(c)+this.opts.cellPaddingGlyphCnt,s.push({target:i,adjusted:i});if(a<t-n){var u=t-n-a,h=s[s.length-1];h.adjusted=h.target+=Math.min(u,this.maxGlyphs-a),a=s.reduce(function(e,t){return e+t.target},0)}if(a+n>this.availableGlyphs&&a+n>this.maxGlyphs*this.opts.leftTree.widthFactor)for(a=0,c=0;c<e;++c)i=Math.min(this.opts.metaHeaderMaxGlyphCnt-this.opts.collapseExpandIconGlyphCnt,s[c].target>8?s[c].target/2:s[c].target),s[c].adjusted=i,a+=i;if(a+n>this.availableGlyphs&&a+n>this.maxGlyphs)for(l=(a+n-this.maxGlyphs)/a,c=0;c<e;++c)i=s[c].adjusted,s[c].adjusted=Math.floor(i-i*l);else if(a+n<this.availableGlyphs)for(o=this.availableGlyphs-a-n,r=s.reduce(function(e,t){return e+(t.adjusted<t.target?t.target:0)},0),c=0;c<e;++c)(i=s[c]).adjusted<i.target&&(s[c].adjusted+=Math.floor(i.target/r*o));return s.map(function(e){return e.adjusted})},_calculateGhostMetaHeadersWidth:function(e,t){var n,i,r,o=1;(t=t||this.headers).forEach(function(t){t.minWidth=t.calcApprMaxGlyphCnt*this.opts.glyphWidth,t.widthFactor=t.calcApprMaxGlyphCnt*this.opts.glyphWidth/e,o-=t.widthFactor},this),o>0&&(n=o,r=t.filter(function(e){return e.isWidthFlexible&&e.maxGlyphCnt>e.calcApprMaxGlyphCnt}),i=r.reduce(function(e,t){return t.maxGlyphCnt-t.calcApprMaxGlyphCnt},0),r.forEach(function(t){var r=t.maxGlyphCnt-t.calcApprMaxGlyphCnt,s=r/i,a=Math.min(r*this.opts.glyphWidth/e,s*n);t.widthFactor+=a,o-=a},this)),o>0&&(r=t.filter(function(e){return!0===e.isWidthFlexible})).forEach(function(e){e.widthFactor+=o/r.length}),t.forEach(function(t){t.width=Math.floor(t.widthFactor*e),t.style.width=t.width+"px"})},calculateColumns:function(e){var t=0,n=[],i=!0;return e.forEach(function(e){e.column=t,i&&(n[t]=[],i=!1),n[t][n[t].length]=e,e.isCollapseExpandIcon||(t++,i=!0)}),n},calculateNumColumns:function(e){return e.reduce(function(e,t){return e+(t.isCollapseExpandIcon?0:1)},0)},_updateLeftHeadersGlyphCnt:function(e,t){var n,i,r,o,s,a,l,c,u,h,d;for(n=e.filter(function(e){return!e.isCollapseExpandIcon}),i=e.filter(function(e){return e.isCollapseExpandIcon}),r=n.reduce(function(e,t){return e+t.calcApprMaxGlyphCnt},0),o=i.reduce(function(e,t){return e+t.calcApprMaxGlyphCnt},0),s=r*this.opts.glyphWidth,a=o*this.opts.glyphWidth,c=(l=t-a)/s,u=0,n.forEach(function(e){e.oldCalcApprMaxGlyphCnt=e.calcApprMaxGlyphCnt,e.calcApprMaxGlyphCnt=Math.floor(e.calcApprMaxGlyphCnt*c),u+=e.calcApprMaxGlyphCnt}),h=Math.floor(l/this.opts.glyphWidth)-u,n.sort(function(e,t){return t.calcApprMaxGlyphCnt-e.calcApprMaxGlyphCnt}),d=0;d<h;d++)n[d].calcApprMaxGlyphCnt+=1},update:function(e,t,n){var i,r,o,s,a,l,c=[],u=[],h=[],d=0;for(n=n||this.explicitColumnWidths,this._reset(),this.maxGlyphs=Math.floor(this.viewportRect.width/this.opts.glyphWidth),this.availableGlyphs=this.maxGlyphs,this.availableGlyphs>0&&(c=this._getDataGhostHeaders()),i=this._getLeftGhostHeaders(e,t,c),a=this.calculateColumns(i),l=0;l<a.length;l++)n[l]>0?(this._updateLeftHeadersGlyphCnt(a[l],n[l]),u=u.concat(a[l])):h=h.concat(a[l]);for(s=c.reduce(function(e,t){return e+t.calcApprMaxGlyphCnt},0),o=i.reduce(function(e,t){return e+t.calcApprMaxGlyphCnt},0);c.length>0&&s+o>this.maxGlyphs;){if(r=c.pop(),0===c.length&&this.maxGlyphs-o>=this.opts.topTree.minGlyphCnt){r.calcApprMaxGlyphCnt=this.maxGlyphs-o,c.push(r),s=r.calcApprMaxGlyphCnt;break}s-=r.calcApprMaxGlyphCnt}if(this.leftHeaders=i,this.dataHeaders=c,this.leftColumns=a,this.headers=i.concat(c),this.dataColumnsInfo.cnt=c.length,this.leftCellCnt=i.length,i.length&&n&&n.length){for(l=0;l<a.length;l++)n[l]>0&&(this._calculateGhostMetaHeadersWidth(n[l],a[l],this.viewportRect.width),d+=n[l]);this._calculateGhostMetaHeadersWidth(this.viewportRect.width-d,h.concat(c),this.viewportRect.width),i.forEach(function(e){e.oldCalcApprMaxGlyphCnt&&(e.calcApprMaxGlyphCnt=e.oldCalcApprMaxGlyphCnt)})}else this._calculateGhostMetaHeadersWidth(this.viewportRect.width);this.dataColumnsInfo.width=c[0]?c[0].widthFactor*this.viewportRect.width:0},_getDimGlyphCnt:function(e){return e===this.pseudoDimIndex?this.longestMeasureTitleGlyphCnt:this.layout.qHyperCube.qDimensionInfo[this.sortOrder[e]].qApprMaxGlyphCount},getDimInfo:function(e){if(e!==this.pseudoDimIndex)return this.layout.qHyperCube.qDimensionInfo[this.sortOrder[e]]}},Object.defineProperties(o.prototype,{isIndentMode:{get:function(){return this.layout.qHyperCube.qIndentMode}},pseudoDimIndex:{get:function(){var e=this.sortOrder.indexOf(-1);return~e?e:this.sortOrderCnt}},longestMeasureGlyphCnt:{get:function(){return this.layout.qHyperCube.qMeasureInfo.map(function(e){return Math.max(e.qApprMaxGlyphCount,2)}).sort(function(e,t){return t-e})[0]||0}},longestMeasureTitleGlyphCnt:{get:function(){return this.layout.qHyperCube.qMeasureInfo.map(function(e){return e.qFallbackTitle.length}).sort(function(e,t){return t-e})[0]||0}},longestLeftDimTitleGlyphCnt:{get:function(){return a.call(this)}},longestLeftDimGlyphCnt:{get:function(){return s.call(this)}},longestTopDimGlyphCnt:{get:function(){return s.call(this,!0)}},sortOrder:{get:function(){return this.layout.qHyperCube.qEffectiveInterColumnSortOrder}},sortOrderCnt:{get:function(){return this.sortOrder.length}},leftDimCnt:{get:function(){return this.layout.qHyperCube.qNoOfLeftDims>=0?this.layout.qHyperCube.qNoOfLeftDims:this.sortOrderCnt}},topDimCnt:{get:function(){return this.sortOrderCnt-this.leftDimCnt}},totDataColCnt:{get:function(){return this.layout.qHyperCube.qSize.qcx}},pseudoInLeftTree:{get:function(){return this.pseudoDimIndex<this.leftDimCnt}},pseudoInTopTree:{get:function(){return-1!==this.sortOrder.slice(this.leftDimCnt).indexOf(-1)}},columnWidths:{get:function(){var e=this.layout.qHyperCube.columnWidths;return e?2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1])?[e[0].slice(),e[1].slice()]:e.slice():[[],[]]}},explicitColumnWidths:{get:function(){var e,t,n,i,r=this.columnWidths;if(!r||!r.length||1===r.length&&!Array.isArray(r[0])&&r[0]<=0)return[];if(r.length&&!Array.isArray(r[0])&&r[0]>0)e=r;else{if(this.isIndentMode)return r&&Array.isArray(r[0])?r[0]:[];e=r&&Array.isArray(r[1])?r[1]:[]}for(t=e?e.length:0,n=[],i=0;i<t;i++)n[i]=e[this.sortOrder[i]];return n}}}),e.provider("qvPivotTableMetaGhostHeadersProvider",function(){this.$get=[function(){return function(e,t,n){return new o(e,t,n)}}]})}),define("extensions.qliktech/pivot-table/meta/pivoting",["general.sortable/sortable-item-lists","translator","client.utils/rtl/rtl-util"],function(e,t,n){"use strict";var i;return i=e.extend("SortableMetaLists",{init:function(e,t,n,i,r,o,s){this._super.apply(this,[e]),this.layout=r,this.backendApi=t,this.grid=n,this.metaGhostHeaders=i,this.$id=o,this.currentPopover=s,this.rows=this.createList(),this.rows.templateSrc="pt-meta-list.ng.html",this.columns=this.createList(),this.columns.templateSrc="pt-meta-list.ng.html"},reset:function(){this._super.apply(this,arguments)},update:function(e){var i,r,o,s,a,l;for(this.reset(),i=0;i<this.sortOrderCnt;++i){if(r=this.sortOrder[i],i<this.leftDimCnt)o=this.rows;else{if(e<=0)continue;o=this.columns}-1!==r?(l=this.layout.qHyperCube.qDimensionInfo[r].qGroupFieldDefs[this.layout.qHyperCube.qDimensionInfo[r].qGroupPos],s={title:a=this.layout.qHyperCube.qDimensionInfo[r].qFallbackTitle,id:this.layout.qHyperCube.qDimensionInfo[r].cId,fieldName:l,style:{},qvaOutsideIgnoreFor:"qv-pt-meta-header-"+this.$id,open:this.currentPopover.header&&l===this.currentPopover.header.fieldName,dimIx:r,locked:!!this.layout.qHyperCube.qDimensionInfo[r].qLocked,dir:n.getAutoOrAlternativeDirection(a)}):(a=t.get("Common.Measures"),s={title:t.get("Common.Measures"),dimIx:-1,isPseudoDim:!0,style:{},locked:!1,dir:n.getAutoOrAlternativeDirection(a)}),s.templateSrc="pt-meta-item.ng.html",o.addSortableItem(s)}}}),Object.defineProperties(i.prototype,{sortOrder:{get:function(){return this.layout.qHyperCube.qEffectiveInterColumnSortOrder}},sortOrderCnt:{get:function(){return this.sortOrder.length}},leftDimCnt:{get:function(){return this.layout.qHyperCube.qNoOfLeftDims>=0?this.layout.qHyperCube.qNoOfLeftDims:this.sortOrderCnt}}}),i}),define("extensions.qliktech/pivot-table/meta/pivoting-provider",["qvangular","./pivoting","extensions.qliktech/pivot-table/pivot-sorting-util"],function(e,t,n){"use strict";e.provider("qvPivotTablePivoting",function(){this.$get=[function(){return function(e,i,r,o,s,a,l,c){return new(t.extend("PivotTableSortableMetaLists",{addPlaceholder:function(e,t){this._super.apply(this,arguments).style.width=t.width,e.dragging=!0},allowAutoScroll:function(){return!1},onBegin:function(){this._super.apply(this,arguments),l.off(),c.off(),this.toggleCellsWhenSorting(this.grid.headerRows,this.grid.rows,!0)},enable:function(){this._super.apply(this,arguments),l.on(),c.on(),this.toggleCellsWhenSorting(this.grid.headerRows,this.grid.rows,!1)},allowDrag:function(){return this._super.apply(this,arguments)&&!(o&&o.qSelectionInfo&&o.qSelectionInfo.qMadeSelections)},onMove:function(){this._super.apply(this,arguments),this.patchPivotingProperties()},onMoveToList:function(){this._super.apply(this,arguments),this.patchPivotingProperties()},onEnterList:function(e){e===this.rows&&e.isEmpty()&&this.metaGhostHeaders.update(2*this.metaGhostHeaders.opts.leftTree.emptyGlyphCnt),this._super.apply(this,arguments),e===this.columns&&this.rows.isEmpty()&&this.metaGhostHeaders.update(this.metaGhostHeaders.opts.leftTree.emptyGlyphCnt)},patchPivotingProperties:function(){var e,t=[];this.rows.items.forEach(function(e){t.push(e.dimIx)}),e=t.length,this.columns.items.forEach(function(e){t.push(e.dimIx)});var i=this;this.backendApi.model.getEffectiveProperties().then(function(r){n.validatePivotHyperCube(r.qHyperCubeDef),n.reorderPivotDimensions(r.qHyperCubeDef,t);var o=[{qPath:"/qHyperCubeDef/qInterColumnSortOrder",qOp:"replace",qValue:JSON.stringify(r.qHyperCubeDef.qInterColumnSortOrder)},{qPath:"/qHyperCubeDef/qNoOfLeftDims",qOp:"replace",qValue:JSON.stringify(e)},{qPath:"/qHyperCubeDef/qDimensions",qOp:"replace",qValue:JSON.stringify(r.qHyperCubeDef.qDimensions)}];i.backendApi.applyPatches(o,!0)})},toggleCellsWhenSorting:function(){var e,t;for(e=arguments.length-1;e>=0;--e)if(Array.isArray(arguments[e])){var n,i,r,o,s=arguments[e];for(n=0;n<s.length;++n)for(r=s[n].cells.length,i=0;i<r;++i)(o=s[n].cells[i]).isMeta?o[t?"addClass":"removeClass"]("drop"):o[t?"addClass":"removeClass"]("locked")}else t=arguments[e]}}))({listSelector:".meta",listKey:function(e){return e.find(".list").scope().list},itemSelector:".button-wrapper",itemDragSelector:".button-wrapper",itemKey:"header"},e,i,r,o,s,a)}}]})}),define("extensions.qliktech/pivot-table/snapshot/snapshot-helper",[],function(){return{getSnapshotScrollAreaBBox:function(e,t){var n=e[0].getBoundingClientRect();return{height:t.size.h,width:t.size.w,top:n.top,left:n.left}}}}),define("extensions.qliktech/pivot-table/viewport-provider",["qvangular","extensions.qliktech/pivot-table/snapshot/snapshot-helper"],function(e,t){"use strict";function n(e,n,i,r,o,s,a,l,c,u){var h,d,p,f=n.find(r),m=f.find(o),g=m.find(s);return h={minRowHeight:i,rect:{left:0,top:0,width:0,height:0},scrollRect:{left:0,top:0,width:0,height:0},rowCount:0,direction:u.direction,getVirtualScrollController:function(){return f.controller("qvScrollArea")},getSortableListController:function(){return f.controller("qvSortableList")},getMultiSelectController:function(){return g.controller("qvSelectionsMultiselect")},getEmptyMetaCellsOfLastHeaderRow:function(){return f.find(".last-top-row .header.empty.left-meta.bottom-meta")},getFirstDataCell:function(){var e,t=f.find(a);if(e={top:0,left:0,width:0},t.length){var n=t[0].getBoundingClientRect(),i=t.position();e.top=i.top,e.left=i.left,e.width=n.width}return e},getTopHeaders:function(){return f.find(l)},getScrollAreaBBox:function(){return c&&c.object&&!u.freeResize?t.getSnapshotScrollAreaBBox(f,c.object):f[0].getBoundingClientRect()},getScrollAreaPosition:function(){return f.position()},getScrollContentBBox:function(){return m[0].getBoundingClientRect()},updateRowCount:function(e){h.rowCount=Math.ceil(e)},getMaxRowCount:function(){return Math.ceil(h.scrollRect.height/h.minRowHeight)},getVisibleRowCount:function(){function e(e,t){return e.offsetTop+e.getBoundingClientRect().height<=t.top+t.height}function t(e,t){var n=t-e;return 1===n?t:Math.floor(e+n/2)}function i(n,r,o){var s=o-r,a=t(r,o),l=e(n[a],h.scrollRect);return 0===s?l?a:-1:1===s?l?a:i(n,r,r):l?i(n,a,o):i(n,r,a)}var r,o,s=n[0].querySelector(a);if(!s)return 0;if(r=s.parentNode,o=Array.prototype.slice.call(r.parentNode.childNodes),o=o.filter(function(e){return e.nodeType===Node.ELEMENT_NODE}),0===(o=o.splice(o.indexOf(r))).length)return 0;var l=i(o,0,o.length-1)+1;if(l===o.length){var c=o[o.length-1],u=h.scrollRect.top+h.scrollRect.height-(c.offsetTop+c.getBoundingClientRect().height);l+=Math.floor(u/(3*h.minRowHeight))}return l},updateRect:function(){return e.cancel(d),d=e(function(){var e=h.getScrollAreaBBox();h.rect.top=e.top,h.rect.left=e.left,h.rect.width=e.width,h.rect.height=e.height,h.updateRowCount(h.rect.height/h.minRowHeight)},!1)},updateScrollRect:function(t){return e.cancel(p),p=e(function(){var e=h.getScrollAreaPosition(),n=h.getFirstDataCell();h.scrollRect.top=e.top+n.top,h.scrollRect.height=h.rect.height-n.top,"rtl"===h.direction?(h.scrollRect.left=0,h.scrollRect.width=n.left+n.width):(h.scrollRect.left=n.left,h.scrollRect.width=h.rect.width-n.left),t&&(h.updateRowCount(h.collapsedRowCount||h.scrollRect.height/h.minRowHeight),delete h.collapsedRowCount)},!1)},getScrollRect:function(){return{top:h.scrollRect.top,left:h.scrollRect.left,width:h.scrollRect.width,height:h.scrollRect.height}}}}function i(e){return n.bind(null,e)}e.provider("qvPivotTableViewportProvider",function(){this.$get=["$timeout",i]})}),define("extensions.qliktech/pivot-table/virtual-scroll-provider",["qvangular"],function(e){"use strict";function t(e,t,n){function i(t){var i=e.getMaxRowCount();c.activeFromStart||(t.qHeight=Math.min(n.qcy-t.qTop,i),e.updateRowCount(Math.min(t.qHeight,e.rowCount)))}function r(n){return{qLeft:t.cnt>0?Math.round(n.vPosX/t.width):0,qTop:Math.round(n.vPosY/e.minRowHeight),qWidth:Math.max(1,t.cnt),qHeight:Math.max(1,e.rowCount)}}function o(e){e.qTop>0&&e.qTop+e.qHeight>n.qcy&&(e.qTop=Math.max(0,n.qcy-e.qHeight),e.qHeight=Math.min(n.qcy,e.qHeight)),e.qLeft>0&&e.qLeft+e.qWidth>n.qcx&&(e.qLeft=Math.max(0,n.qcx-e.qWidth),e.qWidth=Math.min(n.qcx,e.qWidth))}var s,a,l=e.getVirtualScrollController(),c={active:!1,activeFromStart:!1},u={xAxis:0,yAxis:0};return a={page:{qLeft:0,qTop:0,qWidth:0,qHeight:0},equalsPage:function(e){return this.page.qLeft===e.qLeft&&this.page.qTop===e.qTop&&this.page.qWidth===e.qWidth&&this.page.qHeight===e.qHeight},setPage:function(e){this.page.qLeft=e.qLeft,this.page.qTop=e.qTop,this.page.qWidth=e.qWidth,this.page.qHeight=e.qHeight},onGetData:function(e){s=e},setScrollViewport:function(){e.updateScrollRect(!1).then(function(){l.setViewport(e.getScrollRect())})},setVirtualSize:function(){var i=this;e.updateScrollRect(!0).then(function(){var r,o,s,u;c.active=!1,c.activeFromStart=!1,e.scrollRect.top+e.scrollRect.height>=e.rect.height&&a.page.qHeight>=n.qcy&&(r=e.getVisibleRowCount())<a.page.qHeight&&(c.active=!0,c.activeFromStart=!0,e.updateRowCount(r)),o={vPosY:i.page.qTop*e.minRowHeight,vPosX:i.page.qLeft*t.width},s={width:a.page.qWidth===n.qcx?e.scrollRect.width:n.qcx*t.width,height:n.qcy*e.minRowHeight},u={width:e.scrollRect.width,height:e.rowCount*e.minRowHeight},l.setVirtualSize(s,u,e.getScrollRect()),(o.vPosY>0||o.vPosX>0)&&l.scroll(o.vPosX,o.vPosY)})},alignToBottom:function(){var t=!1;if(c.active){if(u.yAxis>0){var n=e.getVisibleRowCount();n<e.rowCount&&e.updateRowCount(n)}else{var i=e.getMaxRowCount();e.rowCount>=i&&(c.active=!1),t=!0}l.setVirtualViewport({width:e.scrollRect.width,height:e.rowCount*e.minRowHeight}),t&&l.setVirtualScrollPos(0,-1)}}},l.onScroll(function(e,t){var n=l.getVirtualPosition(),h=l.getMaxPosition(),d=r(n);c.active&&t<0&&(i(d),h=l.getMaxPosition()),h.vPosY>0&&n.vPosY===h.vPosY&&(c.active=!0),o(d),c.lastTop=d.qTop,u.xAxis=e,u.yAxis=t,a.equalsPage(d)&&!c.active||(a.setPage(d),s(a.page).then(function(){a.alignToBottom()}))}),l.getScrollAmount=function(n,i,r){var o=l.getVirtualPosition(),s=l.getMaxPosition();switch(r){case 1:return{deltaX:t.width*n,deltaY:e.minRowHeight*i};case 2:return{deltaX:t.cnt*t.width*n,deltaY:e.minRowHeight*e.rowCount*i};case 10:return{deltaX:0,deltaY:i>0?o.vPosY*i:o.vPosY-s.vPosY};default:return{deltaX:n,deltaY:i}}},a}function n(){return t}e.provider("qvPivotTableVirtualScrollProvider",function(){this.$get=[n]})}),define("extensions.qliktech/pivot-table/selections-provider",["qvangular","jquery","objects.utils/event-utils"],function(e,t,n){"use strict";function i(e,i,r,o,s,a,l,c){function u(t,n){var r,o,s,a,l,c,u,h=[],d=p.dataValuesArray.length;for(r=t.getRowsByCellType(t.CELL_TYPE_TOP).concat(t.getRowsByCellType(t.CELL_TYPE_LEFT)),l=d>0?i.getSiblingCells(t,n):[],o=r.length,u=0;u<o;++u)h=h.concat(r[u].cells);for(a=h.length,u=0;u<a;++u)s=h[u],((c=-1!==l.indexOf(s))&&!s.isDimensionValue||!c&&!s.isMeta)&&e[d?"lockCell":"unlockCell"](t,s)}function h(){p.active&&p.currentCell&&(i.getSiblingCells(a,p.currentCell).forEach(function(t){e.deselectCell(a,t)}),u(a,p.currentCell))}var d,p=e.$new();return r.excludeDimensionToggle=function(e){return!o.active&&t(e.target).is(".qv-pt-expandable")},r.selectDimensionValue=function(t,n){var i=o.getKeyAsToggleSelected(n);i||(h(),e.reset(p)),d=e.selectDimensionValue(r.$id,s,o,p,t,a,i),u(a,p.currentCell)},r.activateSelections=function(t){d=e.activateSelections(r.$id,s,o,p,t)},r.multiselectDimensionValues=function(t,n){var l,c,h,d=i.getSiblingCells(a,t),f=d.length,m=e.isColumnar(a,t),g=m?t.dataRowIx:t.dataColIx,v=m?n.dataRowIx:n.dataColIx;if(-1!==d.indexOf(n)&&n.isDimensionValue){for(l=0;l<f;++l)h=d[l],c=m?h.dataRowIx:h.dataColIx,(g<=v?c>=g&&c<=v:c>=v&&c<=g)&&h.isDimensionValue&&h!==n&&e.selectDimensionCells(s,o,p,r.grid,h,!1);e.selectDimensionCells(s,o,p,r.grid,n,!1),u(a,p.currentCell)}},r.multiselect=function(){p.active&&e.sendSelection(s,o,p,a,p.currentCell)},r.selectWhileLocked=function(){p.dataValuesArray.length>0||n.showLockedFeedback(l.qHyperCube.qDimensionInfo)},o.watchActivated(function(){c.off()}),e.init(o,s,p,function(){c.on(),d&&d()},function(){c.on(),d&&d()},h),{updateSelections:function(){p.active&&(e.updatePivot(a,p,p.currentCell),u(a,p.currentCell))}}}function r(e,t){return i.bind(null,e,t)}e.provider("qvPivotTableSelectionsProvider",function(){this.$get=["qvGridObjectSelectionService","qvGridObjectDataService",r]})}),define("text!extensions.qliktech/pivot-table/pivot-panel/pivot-panel.ng.html",[],function(){return'<div class="qv-pivot-panel"\n\t qv-sortable-list="sortableItemLists">\n\t<div class="qv-pivot-panel-row" ng-repeat="row in grid.rows">\n\t\t<div class="qv-pivot-panel-column" ng-if="$first"></div>\n\t\t<div ng-repeat="list in row.lists" class="qv-pivot-panel-column" ng-class="{\'qv-pivot-panel-disabled\': list.disabled}">\n\t\t\t<h2>{{list.title}}</h2>\n\t\t\t<div class="qv-pivot-panel-list">\n\t\t\t\t<ul>\n\t\t\t\t\t<li ng-repeat="item in list.items track by item.id" class="qv-pivot-panel-item" ng-class="item.classList" ng-include src="itemTemplateSrc"></li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n'}),define("text!extensions.qliktech/pivot-table/pivot-panel/pivot-panel-item.ng.html",[],function(){return'<div class="field-wrapper field-token" ng-style="item.style">\n\t<div ng-if="list.showMoveHandle" class="icon-handle"></div>\n\t<div class="field-text">{{item.title}}</div>\n</div>\n'}),define("extensions.qliktech/pivot-table/pivot-panel/pivot-panel",["jquery","qvangular","text!./pivot-panel.ng.html","text!./pivot-panel-item.ng.html","general.sortable/sortable-item-lists","translator","general.sortable/sortable-list"],function(e,t,n,i,r,o){var s={Dimension:"dimension",Measure:"measure",Pseudo:"pseudo"};t.getService("$templateCache").put("pivot-panel-item.ng.html",i),t.directive("qvPivotPanel2",function(){return{restrict:"E",template:n,replace:!0,scope:{layout:"=layout",backendApi:"=backendApi"},controller:["$scope","$element",function(t,n){function i(e){return e.qLibraryId?e.title||"":e.qFallbackTitle||""}function a(){var e,n=t.layout.qHyperCube.qNoOfLeftDims;t.sortableItemLists.reset(),e=t.layout.qHyperCube.qEffectiveInterColumnSortOrder.map(function(e){var n;return t.$broadcast("pivotPanelUpdated"),-1===e?{title:"Measures",cId:"pseudo-dimension",type:s.Pseudo,dimIndex:e,cssClass:["sortable","is-pseudo"]}:(n=t.layout.qHyperCube.qDimensionInfo[e],{title:i(n),cId:n.cId,type:s.Dimension,dimIndex:e,cssClass:["sortable"]})}),n=n<0?e.length:n,e.splice(0,n).forEach(function(e){t.rows.add(e.title,e.cId,e.cssClass,1).dimIndex=e.dimIndex}),e.forEach(function(e){t.columns.add(e.title,e.cId,e.cssClass,1).dimIndex=e.dimIndex}),t.layout.qHyperCube.qMeasureInfo.forEach(function(e){t.measures.add(e.qFallbackTitle||"",e.cId,[],2)})}var l=this;t.itemTemplateSrc="pivot-panel-item.ng.html",t.sortableItemLists=r.create({options:{listKey:"list",listSelector:".qv-pivot-panel-column",itemSelector:".sortable",itemDragSelector:".icon-handle",itemKey:"item"},addPlaceholder:function(){this._super.apply(this,arguments).addClass("sortable")},bindAutoScroll:function(){n.find(".qv-pivot-panel-list ul").each(function(){var t=e(this);t.scope().list.scrollInfo={elem:t[0],clientRect:t[0].getBoundingClientRect(),scrollWidth:t[0].scrollWidth,scrollHeight:t[0].scrollHeight}})},onBegin:function(){this._super.apply(this,arguments),this.bindAutoScroll()},onEnterList:function(){this.bindAutoScroll()},onMove:function(){this._super.apply(this,arguments),l.sortOrderUpdated()},onMoveToList:function(e,t){this._super.apply(this,arguments),t.disabled||l.sortOrderUpdated()},onAutoScroll:function(e,t,n,i){if(this._super.apply(this,arguments),!t&&n&&(t=this.getList(n)),t){var r=t.scrollInfo;i(r.elem,r.clientRect,r.scrollWidth,r.scrollHeight)}}}),t.columns=t.sortableItemLists.createList(1,{title:o.get("Common.Columns"),showMoveHandle:!0}),t.rows=t.sortableItemLists.createList(1,{title:o.get("Common.Rows"),showMoveHandle:!0}),t.measures=t.sortableItemLists.createList(2,{title:o.get("Common.Measures")}),t.grid={rows:[]},t.grid.rows.push({lists:[t.columns]}),t.grid.rows.push({lists:[t.rows,t.measures]}),l.sortOrderUpdated=function(){var e,n=[];t.rows.items.forEach(function(e){n.push(e.dimIndex)}),e=n.length,t.columns.items.forEach(function(e){n.push(e.dimIndex)});var i=[{qPath:"/qHyperCubeDef/qInterColumnSortOrder",qOp:"replace",qValue:JSON.stringify(n)},{qPath:"/qHyperCubeDef/qNoOfLeftDims",qOp:"replace",qValue:JSON.stringify(e)}];t.backendApi.applyPatches(i,!0)},t.$watchCollection("layout.qHyperCube.qDimensionInfo",a),t.$watchCollection("layout.qHyperCube.qEffectiveInterColumnSortOrder",a),t.$watchCollection("layout.qHyperCube.qMeasureInfo",a),t.$watchCollection("layout.qHyperCube.qNoOfLeftDims",a)}]}})}),define("extensions.qliktech/pivot-table/pivot-table",["qvangular","jquery","objects.backend-api/pivot-api","extensions.qliktech/pivot-table/pivot-table-properties","extensions.qliktech/pivot-table/pivot-hypercube-handler","objects.extension/object-conversion","client.utils/property-mapper","text!./pivot-table.ng.html","text!./cell-item.ng.html","text!./header-cell-item.ng.html","text!./meta/meta-left.ng.html","text!./meta/meta-top.ng.html","text!./meta/meta-list.ng.html","text!./meta/meta-item.ng.html","general.utils/support","core.utils/deferred","objects.extension/default-selection-toolbar","core.utils/feature-flags","client.utils/theme/theme-module","objects.utils/selection-util","general.utils/responsive-state","client.utils/property-resolver","objects/listbox-popover/listbox-popover-service","objects.grid/data-grid-provider","./meta/ghost-headers-provider","./meta/pivoting-provider","./viewport-provider","./virtual-scroll-provider","./selections-provider","general.scroll/scroll-area","objects.grid/services/data-service","objects.grid/services/selections","extensions.qliktech/pivot-table/pivot-panel/pivot-panel","objects.grid/column-width-adjuster/column-adjuster","objects/listbox-popover/listbox-popover-service-mobile"],function(e,t,n,i,r,o,s,a,l,c,u,h,d,p,f,m,g,v,y,b,x,q){"use strict";function C(e,t){e.themeStyle={header:{"font-size":t.getStyle("header","fontSize"),color:t.getStyle("header","color")},content:{"font-size":t.getStyle("content","fontSize"),color:t.getStyle("content","color")}}}function S(e){return!0===e.capturedOnDesktop||f.treatAsDesktop()&&!1!==e.capturedOnDesktop}function w(e){var t,n=e.treatAsDesktop;if(v.THEMING){var i=parseInt(e.themeStyle.content["font-size"]);t=n?i?i/13*21-1.23076923:21:i?i/13*31-1.23076923:31}return t||(n?21:31)}function _(e,t){e.currentPopover.header===t?t.open=!1:e.currentPopover.header&&(e.currentPopover.header.open=!1),e.currentPopover.header=void 0,e.pivoting.update(e.metaGhostHeaders.dataColumnsInfo.cnt)}function D(e,t,n,i,r){return e.showField(t,n.backendApi.model.app,{$alignToElement:i,qvaOutsideIgnoreFor:"qv-pt-meta-header-"+n.$id,collision:"flipfit",direction:n.options.direction},null,function(){n.currentPopover.header=void 0,r.on(),n.processPaint()})}function M(e,t){t.on(),e.processPaint()}var A=y.get();return e.directive("qvPivotTableInclude",["$compile","$animate",function(t,n){return{link:function(i,r,o){n.enabled(r,!1),i.$watch(o.qvPivotTableInclude,function(){var n=i.$eval(o.qvPivotTableInclude),s=e.getService("$templateCache").get(n);r.html(s),t(r.contents())(i)})}}}]),e.directive("onFinishRender",["$timeout",function(e){return{restrict:"A",link:function(t){!0===t.$last&&e(function(){t.$emit("ngRepeatFinished")})}}}]),e.directive("qvPivotTable",["qvDataGrid","qvGridObjectDataService","qvListboxPopoverService","qvPivotTablePivoting","qvPivotTableMetaGhostHeadersProvider","qvPivotTableViewportProvider","qvPivotTableVirtualScrollProvider","qvPivotTableSelectionsProvider","$timeout","qvListboxPopoverServiceMobile",function(n,i,r,o,s,y,q,E,I,T){var L=e.getService("$templateCache");return L.put("pt-cell-item.ng.html",l),L.put("pt-header-cell-item.ng.html",c),L.put("pt-meta-left.ng.html",u),L.put("pt-meta-top.ng.html",h),L.put("pt-meta-list.ng.html",d),L.put("pt-meta-item.ng.html",p),{restrict:"E",replace:!0,template:a,require:"qvObjectContent",link:function(e,a,l,c){function u(t,n,i){e.interactive=t&&n,e.navigatable=t&&i,t?i&&(h.on(),d.on()):t||(h.off(),d.off())}var h,d,p,L,k,O,P,N,R,F=[];if(v.THEMING){var j=A.initializeService("object.pivotTable");R=function(){C(e,j),e.viewport&&(e.viewport.minRowHeight=w(e))},A.ThemeChanged.bind(R),C(e,j)}e.currentPopover={header:void 0},e.nonMouseViewportScrolling={scrollbarSize:36,className:"show-non-mouse-scrollbars"},e.grid=n("pivot"),e.treatAsDesktop=S(e.layout.snapshotData||{}),e.viewport=y(a,w(e),".qv-grid-object-scroll-area",".scroll-content","table",".first-data-cell","th.top:nth-child(2)",e.layout.snapshotData,e.options),h=e.viewport.getVirtualScrollController(),d=e.viewport.getSortableListController(),p=e.viewport.getMultiSelectController(),e.metaGhostHeaders=s({},e.layout,e.viewport.rect),e.pivoting=o(e.backendApi,e.grid,e.metaGhostHeaders,e.layout,e.$id,e.currentPopover,h,p);var V=function(e,t){return"%"===e.substring(e.length-1,e.length)?parseFloat(e)*t/100:parseFloat(e)},H=function(e){var t=N[e].getBoundingClientRect(),n=N.position();F[e]||(F[e]={}),F[e].top=n.top,F[e].left=n.left,F[e].width=t.width,F[e].height=t.height},B=function(e,t,n){return n?F[t].width:e.metaGhostHeaders.leftColumns[t].reduce(function(t,n){return t+Math.max(0,V(n.style.width,e.viewport.rect.width))},0)},z=function(e,t){e.columns[t].definedTopHeight||(Object.defineProperties(e.columns[t],{top:{get:function(){return this._top||0}},height:{get:function(){return this._height||40}}}),e.columns[t].definedTopHeight=!0)},$=function(e,t){e.explicitColumnWidths||(e.explicitColumnWidths=e.metaGhostHeaders.explicitColumnWidths),e.columns||(e.columns=[]),e.columns.length>t&&e.columns.splice(t,e.columns.length-t),e.explicitColumnWidths.length>t&&e.explicitColumnWidths.splice(t,e.explicitColumnWidths.length-t)},U=function(e,t,n,i){e.explicitColumnWidths[n]>0&&(e.explicitColumnWidths[n]=t),e.columns[n]||(e.columns[n]={}),e.columns[n].index=n,e.columns[n].width=t,e.columns[n].isLastColumn=i,F[n]?(e.columns[n]._top=i?0:F[n].top,e.columns[n]._height=i?F[n].top+F[n].height:F[n].height):(e.columns[n]._top=0,e.columns[n]._height=40),z(e,n)},G=function(e,t){var n,i,r=[],o=e.metaGhostHeaders.leftColumns.length;if(t){if(!(N=e.viewport.getEmptyMetaCellsOfLastHeaderRow())||N.length!==o)return;for(n=0;n<o;n++)H(n)}else e.changingColumnIndex>=0&&H(e.changingColumnIndex);for($(e,o),n=0;n<o;n++)i=B(e,n,t&&N),U(e,i,n,n===o-1),r[n]=0===n?i:r[n-1]+i;for(n=0;n<o;n++)e.columns[n].left=e.rtl?e.viewport.rect.width-r[n]:r[n];t&&(e.changingColumnIndex=-1)};e.$on("onExplicitColumnStarted",function(t){var n,i,r=t.targetScope.column.index,o=0,s=e.metaGhostHeaders.opts.topTree.minGlyphCnt*e.metaGhostHeaders.opts.glyphWidth;for(P=e.explicitColumnWidths[r]?e.explicitColumnWidths[r]:e.columns[r].width,n=e.metaGhostHeaders.dataHeaders,i=0;i<n.length;i++)n[i].oldWidth=n[i].width,o+=n[i].width;O=P+o-s}),e.$on("onExplicitColumnChanging",function(t){if(0!==e.layout.qHyperCube.qNoOfLeftDims){var n,i,r,o=t.targetScope.column.index,s=e.metaGhostHeaders.leftColumns[o],a=0;for(e.changingColumnIndex=o,t.targetScope.explicitColumnWidth>O&&(e.explicitColumnWidths[o]=t.targetScope.explicitColumnWidth=O),1===e.metaGhostHeaders.leftColumns.length&&t.targetScope.explicitColumnWidth<70&&(e.explicitColumnWidths[o]=t.targetScope.explicitColumnWidth=70),e.metaGhostHeaders.leftColumns.length>1&&t.targetScope.explicitColumnWidth<40&&(e.explicitColumnWidths[o]=t.targetScope.explicitColumnWidth=40),r=0;r<s.length;r++)s[r].isCollapseExpandIcon&&(a+=s[r].width);for(s[s.length-1].width=e.explicitColumnWidths[o]-a,s[s.length-1].style.width=s[s.length-1].width+"px",n=e.metaGhostHeaders.dataHeaders,i=(e.explicitColumnWidths[o]-P)/n.length,r=0;r<n.length;r++)n[r].width=Math.max(n[r].oldWidth-i,n[r].minWidth),n[r].style.width=n[r].width+"px";G(e)}}),e.$on("onExplicitColumnChanged",function(){e.metaGhostHeaders.update(0,i.getLeftTreeDepth(e.layout.qHyperCube.qPivotDataPages[0]),e.explicitColumnWidths),G(e),e.applyColumnWidthSoftPatch(e.explicitColumnWidths)}),e.$on("$destroy",function(){R&&A.ThemeChanged.unbind(R),I.cancel(L),I.cancel(k)}),e.applyColumnWidthSoftPatch=function(t){var n,i,r=e.layout.qHyperCube,o=r.columnWidths?"replace":"add",s=r.qIndentMode?1:0,a=r.columnWidths,l=e.metaGhostHeaders.leftColumns?e.metaGhostHeaders.leftColumns.length:0;if(a&&Array.isArray(a[0])||(a=[[],[]]),s)a[0]=t;else for(n=r.qEffectiveInterColumnSortOrder,i=0;i<l;i++)a[1][n[i]]=t[i];var c=[{qPath:"/qHyperCubeDef/columnWidths",qOp:o.toString(),qValue:JSON.stringify(a)}];e.backendApi.applyPatches(c,!0)},e.selections=E(e,e.selectionsApi,e.backendApi,e.grid,e.layout,d),e.virtualScroll=q(e.viewport,e.metaGhostHeaders.dataColumnsInfo,e.layout.qHyperCube.qSize),e.virtualScroll.onGetData(function(t){return e.getData(t,!0).then(function(){I.cancel(L),L=I(function(){e.virtualScroll.setScrollViewport()},100)})}),e.getData=function(t,n){var i=m();return e.backendApi.getData([t]).then(function(r){e.onUpdateData(r,t,n).then(function(){i.resolve()})}),i.promise},e.onUpdateData=function(t,n,r){return i.updatePivotItems(e,t,[n],r),e.selections.updateSelections(),I(function(){},0,!1)},e.process=function(t){return t&&e.virtualScroll.setPage(t),e.getData(e.virtualScroll.page).then(function(){e.virtualScroll.setVirtualSize(),I.cancel(k),k=I(function(){G(e,!0)},100)})},e.processPaint=function(){return e.updateMetaInfo().then(function(t){var n=e.layout.qHyperCube.qLastExpandedPos,i=n&&void 0!==e.expandedPosDiffX&&void 0!==e.expandedPosDiffY,r=e.viewport.getVisibleRowCount(),o={qLeft:Math.max(0,i?n.qx-e.expandedPosDiffX:0),qTop:Math.max(0,i?n.qy-e.expandedPosDiffY:0),qWidth:t.qWidth,qHeight:t.qHeight};return n&&o.qLeft+o.qWidth>e.layout.qHyperCube.qSize.qcx&&(o.qLeft=Math.max(0,e.layout.qHyperCube.qSize.qcx-t.qWidth)),n&&e.collapsed&&o.qTop+r>e.layout.qHyperCube.qSize.qcy&&(e.viewport.collapsedRowCount=r,o.qTop=Math.max(0,e.layout.qHyperCube.qSize.qcy-r),o.qHeight=r),delete e.expandedPosDiffX,delete e.expandedPosDiffY,delete e.collapsed,e.process(o)})},e.processResize=function(){return e.updateMetaInfo().then(function(t){var n=e.layout.qHyperCube.qSize,i={qLeft:e.virtualScroll.page.qLeft,qTop:e.virtualScroll.page.qTop,qWidth:t.qWidth,qHeight:t.qHeight};return i.qTop+i.qHeight>n.qcy&&(i.qTop=Math.max(0,n.qcy-i.qHeight)),i.qLeft+i.qWidth>n.qcx&&(i.qLeft=Math.max(0,n.qcx-i.qWidth)),e.$emit("ngRepeatFinished"),e.process(i)})},c.setDirection=function(){e.viewport.direction=e.options.direction,e.rtl="rtl"===e.options.direction,e.processPaint()},c.getSelectionToolbar=function(){return new g(c.$scope.backendApi,c.$scope.selectionsApi,!1,!1)},e.updateMetaInfo=function(){return e.viewport.updateRect().then(function(){var t=e.metaGhostHeaders.explicitColumnWidths;return e.metaGhostHeaders.update(0,i.getLeftTreeDepth(e.layout.qHyperCube.qPivotDataPages[0]),t),e.pivoting.update(e.metaGhostHeaders.dataColumnsInfo.cnt),G(e),{qWidth:Math.max(1,e.metaGhostHeaders.dataColumnsInfo.cnt),qHeight:Math.max(1,e.viewport.rowCount)}})},e.collapseExpand=function(n){var i;(i=t(n.target).scope().cell)&&(e.expandedPosDiffX=i.dataColIx-e.virtualScroll.page.qLeft,e.expandedPosDiffY=i.dataRowIx-e.virtualScroll.page.qTop,"lui-icon--plus"===i.collapseExpandClass?i.hasClass("top")?e.backendApi.expandTop(i.dataRowIx,i.dataColIx,!1):i.hasClass("left")&&e.backendApi.expandLeft(i.dataRowIx,i.dataColIx,!1):"lui-icon--minus"===i.collapseExpandClass&&(e.collapsed=!0,i.hasClass("top")?e.backendApi.collapseTop(i.dataRowIx,i.dataColIx,!1):i.hasClass("left")&&e.backendApi.collapseLeft(i.dataRowIx,i.dataColIx,!1)))},e.showDimension=function(n,i){var o=t(n.target).closest(".qv-pt-meta-button");if(d.off(),e.currentPopover.header===i)return i.open=!1,e.currentPopover.header=void 0,r.close(),void M(e,d);e.currentPopover.header&&(e.currentPopover.header.open=!1,e.currentPopover.header=void 0),x.isSmallDevice?D(T,i.fieldName,e,o,d):D(r,i.fieldName,e,o,d).then(function(n){var r;n.closing.then(function(n){n&&!t(n.target).closest(".qv-pt-meta-button").length>0&&(_(e,i),M(e,d)),r=n}),n.closed.then(function(){r||(_(e,i),e.processPaint()),n=null})}),i.open=!0,e.currentPopover.header=i},c.setInteractionState=function(){var t=e.object.inAnalysisState(),n=!1!==e.options.navigation;u(t,!1!==e.options.selections,n)},c.getContextMenu=function(t,n){var i=this.$scope.metaGhostHeaders,r=i.leftDimCnt-(i.pseudoInLeftTree?1:0),o=i.topDimCnt-(i.pseudoInTopTree?1:0);if(r>1||o>1)return t.model.getEffectiveProperties().then(function(t){if(!t.qHyperCubeDef.qAlwaysFullyExpanded){var i=n.addItem({translation:"Object.PivotTable.ContextMenu.ExpandCollapse",tid:"expand-collapse-group"});i.addItem({icon:"lui-icon lui-icon--plus",translation:"Object.PivotTable.ContextMenu.ExpandAll",tid:"expand-all",select:function(){e.backendApi.expandTop(0,0,!0),e.backendApi.expandLeft(0,0,!0)}}),i.addItem({icon:"lui-icon lui-icon--minus",translation:"Object.PivotTable.ContextMenu.CollapseAll",tid:"collapse-all",select:function(){e.backendApi.collapseTop(0,0,!0),e.backendApi.collapseLeft(0,0,!0)}})}})},c.suppressOnPaint=function(e){return this.$scope.object._forcePaint?(this.$scope.object._forcePaint=!1,!1):b.isInSelection(e)},c.onPaint=function(){return this.setInteractionState(e.options.interactionState),this.suppressOnPaint(this.$scope.layout)||void 0!==this.$scope.currentPopover.header?(this.$scope.currentPopover.header&&e.pivoting.update(e.metaGhostHeaders.dataColumnsInfo.cnt),m.resolve()):(d.cancel(),b.isModalSelectionModel(this.$scope.object.model)&&this.$scope.selectionsApi.confirm(),e.processPaint())},c.onResize=function(){return e.processResize()},c.setSnapshotData=function(t){var n=e.virtualScroll.page;return e.backendApi.getData([n]).then(function(n){return e.backendApi.isSnapshot||(n[0].qArea.qTop=0,n[0].qArea.qLeft=0),t.qHyperCube.qPivotDataPages=n,t.qHyperCube.qSize.qcx=n[0].qArea.qWidth,t.snapshotData.capturedOnDesktop=f.treatAsDesktop(),t})},c.getPreferredSize=function(){var e=m(),t=this.$scope.$on("ngRepeatFinished",function(){e.resolve({w:a.width(),h:a.find("table").height()+5}),t()});return e.promise}}}}]),{initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qSuppressMissing:!0,qMode:"P",qShowTotalsAbove:!0,qInitialDataFetch:[{qTop:0,qLeft:0,qWidth:50,qHeight:50}],qIndentMode:!0,columnWidths:[]}},data:{dimensions:{min:1,max:1e3,description:function(){return"Row"}},measures:{min:1,max:1e3,description:function(){return"Column"}}},getCreatePropertyHandler:function(e){var t=s.mapProperties(this.mappedDefinition.items.data.items.dimensions),n=s.mapProperties(this.mappedDefinition.items.data.items.measures);return new r({app:e,dimensionDefinition:this.dimensionDefinition,measureDefinition:this.measureDefinition,dimensionProperties:t,measureProperties:n})},support:{cssScaling:!0,snapshot:!0,export:!0,exportData:!0,sharing:!1,viewData:!0},type:"pivot-table",template:"<qv-pivot-table></qv-pivot-table>",BackendApi:n,definition:i,importProperties:function(e,t,n){var i=o.pivotChart.importProperties.apply(o,[e,t,n]);return o.unquarantineObject(i.qProperty,"pivotTableColumnWidths")||q.setValue(i,"qProperty.qHyperCubeDef.columnWidths",t.qHyperCubeDef.columnWidths.concat()),i},exportProperties:function(e){var t=o.pivotChart.exportProperties.apply(o,[e]);return o.quarantineProperty("qHyperCubeDef.columnWidths",t,"pivotTableColumnWidths"),t}}}),define("dev-hub.lib/utils-conversions",[],function(){"use strict";return{directiveToFile:function(e){var t=!1;if(e&&e.length>3){t="",e=(e=e.replace("qw",""))[0].toLowerCase()+e.substr(1);for(var n in e){var i=e[n];"string"==typeof i&&(i===i.toUpperCase()&&(i="-"+i.toLocaleLowerCase()),t+=i)}}return t},capitalizeString:function(e,t){var n=!1;return e&&(n=e,t&&(n=e.toLowerCase()),n=n[0].toUpperCase()+n.substr(1)),n}}}),define("dev-hub.lib/utils",["util","angular","jquery","dev-hub.lib/utils-conversions","qvangular"],function(e,t,n,i){"use strict";function r(e,t){return e.filter(function(e){return e.id.toLowerCase()===t.toLowerCase()}).length>0}function o(e){return!!(e&&e.length&&e.length>0)&&(/^[\.0-9a-zA-Z_-]+$/.test(e)&&!/^\./.test(e))}var s,a,l=["js","css","html","json"],c=["break","do","instanceof","typeof","case","else","new","var","catch","finally","return","void","continue","for","switch","while","debugger","function","this","with","default","if","throw","delete","in","try","class","enum","extends","super","const","export","import","implements","let","private","public","yield","interface","package","protected","static","null","true","false"];return{getURLParameter:function(e,t){return(new RegExp(t+"=(.+?)(&|$)").exec(e)||[null,null])[1]},getURLParameters:function(e,t){for(var n,i=new RegExp(t+"=(.+?)(&|$)","g"),r=[];n=i.exec(e);)r.push(decodeURIComponent(n[1]));return r},setBrowserTitle:function(e){document.title=e+" | Dev Hub"},getHashParameter:function(e){if(location.hash){var t=new RegExp(e+"{(.*)}",""),n=location.hash.match(t);return!!(n&&n.length>1)&&decodeURIComponent(n[1])}return!1},getPrefix:function(){return window.location.pathname.substr(0,window.location.pathname.toLowerCase().lastIndexOf("/dev-hub")+1)},reload:function(e){e&&window.location.href.indexOf("#")>0&&(window.location.hash=""),window.location.reload()},isInteger:function(t){return e.isInteger(t)},extend:function(){return t.extend.apply(null,arguments)},deepCopy:function(){return t.copy.apply(null,arguments)},isValidExtensionName:function(e){return o(e)&&e.indexOf(".")<0},isExistingExtensionName:function(e,t,n){var i=r(t,e);return i||(i=n.some(function(t){return r(t.items,e)})),i},isValidName:o,isValidFunctionName:function(e){return/^[$A-Z_][0-9A-Z_$]*$/i.test(e)&&-1===c.indexOf(e)},isJsReservedWord:function(e){return-1!==c.indexOf(e)},isValidSyntax:function(e){return/^[$A-Z_][0-9A-Z_$]*$/i.test(e)},isValidInterval:function(t,n,i){return i?e.isInteger(t)&&e.isInteger(n)&&t>=0&&n>=0&&n>=t:e.isInteger(t)&&e.isInteger(n)&&n>=t},isValidCamelCase:function(e){return/^[a-z]+[a-zA-Z0-9]*\b/g.test(e)},hasInvalidCharacters:function(e){return/[^A-Z0-9]/i.test(e)},sanitizeFileName:function(e){return e.replace(/[^a-z0-9]/gi,"-").toLowerCase()},hasValidFileExtension:function(e){return!!e&&!(e.lastIndexOf(".")<0)&&l.indexOf(e.substr(e.lastIndexOf(".")+1).toLowerCase())>-1},getFileExtension:function(e){return e.substr(e.lastIndexOf(".")+1).toLowerCase()},getFileName:function(e){return e.substr(0,e.lastIndexOf("."))},fileExtensionArrayToString:function(e){for(var t="",n=0;n<e.length-1;n++)t+="."+e[n]+", ";return t+="."+e[e.length-1]},objectToArray:function(e){var n=[];return t.forEach(e,function(e,i){t.isObject(e)&&(e.key=i),n.push(e)}),n},addMutationObserver:function(){a||(a=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,n.fn.mutation=function(e,t,n){if(a)return t=t||{subtree:!1,attributes:!0},s=new a(function(t){t.forEach(function(t){n?n(t,e):e(t.target,t.attributeName,t)})}),this.each(function(){s.observe(this,t)})})},toggleElementSubtreeInteraction:function(e,t){t?(e.find("span[q-title-translation='Devhub.EditItem']").css({"pointer-events":"all"}),e.find("*").not("span[q-title-translation='Devhub.EditItem']").css({"pointer-events":"none"})):e.find("*").css({"pointer-events":"auto"})},generateId:function(){var e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return("x"===t?n:3&n|8).toString(16)})},debounce:function(e,t,n){function i(e){e.debounceTimer&&clearTimeout(e.debounceTimer),e.debounceTimer=null}return function(){var r,o=this,s=arguments;i(n),r=setTimeout(function(){e.apply(o,s)},t),n.debounceTimer=r}},conversions:i,__onlytest__:{_isIdInList:r}}}),define("dev-hub.services/message-service",["core.utils/environment"],function(e){function t(e,t,n){this.message=e,this.source=t,this.type=n}function n(t){var n;switch(t.type){case i.ERROR:n=console.error;break;case i.WARNING:n=console.warn;break;case i.INFO:n=console.info}r||e.inClient()||n(t.type.name," ",t.message)}var i={ERROR:{value:0,name:"Error"},WARNING:{value:1,name:"Warning"},INFO:{value:2,name:"Information"}},r=!1;return{error:function(e,r){n(new t(e,r,i.ERROR))},warn:function(e,r){n(new t(e,r,i.WARNING))},info:function(e,r){n(new t(e,r,i.INFO))},suppress:function(e){r=e}}}),define("apis/custom-component/custom-component-wrapper",["qvangular","dev-hub.services/message-service"],function(e,t){function n(e,n){for(var i in n)if(i===e.data.name)return n[i];var r="Component "+e.data.name+" not found in the dependency.";t.warn(r,"custom component wrapper")}function i(e){for(var t=e;e.length>1&&/[A-Z]/.test(t);)t=t.replace(/([a-z\d])([A-Z])/g,function(e,t,n){return t+"-"+n.toLowerCase()});return t}return{getComponentWrapper:function(t,r){return{restrict:"E",scope:{},priority:1001,compile:function(o){var s=o[0].outerHTML;return{pre:function(o,a){for(var l,c=o;c.$parent;){if(c.layout){l=c.layout.dependencies;break}c=c.$parent}var u=l?n(r,l):r.data.version,h=i(t),d=s.replace(h,h+"."+u),p=e.getService("$compile")(d)(o.$parent);a.replaceWith(p)}}}}},__onlytest__:{_getAppropriateVersion:n,_camelCaseToDash:i}}}),define("apis/custom-component/custom-component-loader",["qvangular","core.utils/deferred","dev-hub.lib/utils","apis/custom-component/custom-component-wrapper","dev-hub.services/message-service","core.utils/feature-flags"],function(e,t,n,i,r,o){function s(){return!!o.CUSTOM_COMPONENTS&&o.CUSTOM_COMPONENTS}function a(n,o){var a=new t,l=e.getService("$injector");if(o)Array.isArray(o)||(o=[o]),o.forEach(function(t){var r=t;if(s()){var o=t.componentName;l.has(o+"Directive")||e.directive(o,function(){return i.getComponentWrapper(t.componentName,n)});var a=t.componentName+"."+n.data.version;l.has(a+"Directive")||(e.directive(a,function(){return r}),c[t.path]=t)}else l.has(t.componentName+"Directive")||(e.directive(t.componentName,function(){return r}),c[t.path]=t)}),a.resolve(o);else{var u="Plugin is invalid or missing, '"+JSON.stringify(o)+"'";r.warning(u,"custom component loader"),a.resolve({success:!1,error:"plugin is invalid or missing"})}return a.promise}function l(e){var i=new t,r={success:!1,error:"Validation for the custom component failed"};return e&&e.componentName?n.hasInvalidCharacters(e.componentName)?r.reason="The name must not contain white-spaces or special characters: "+e.componentName:n.isValidCamelCase(e.componentName)?r={success:!0,error:void 0}:r.reason="Invalid component name:"+e.componentName+". Only lower camel case is allowed.":r.reason="The property componentName is undefined.",i.resolve(r),i.promise}var c={};return{load:function(e){var n=new t,i=this,r=[];return e.forEach(function(e){r.push(i._requireComponent(e))}),t.all(r,function(){n.resolve(c)}).catch(function(){n.resolve()}).finally(function(){n.resolve(c)}),n.promise},validateComponent:l,loadedCustomComponents:c,_requireComponent:function(e){var n=new t;return c[e.path]?n.resolve(c[e.path]):require([e.path],function(t){l(t).then(function(i){if(i.success)t.path=e.path,n.resolve(a(e,t));else{var o=i.error+": '"+e.data.name+"' - "+i.reason;r.error(o,"Custom component loader"),n.resolve(i)}})},function(){n.resolve({success:!1,error:"Require failed while loading the custom component: '"+e.data.name+"'."})}),n.promise},_registerComponent:a}}),define("dev-hub.custom-components/qw-sys-info/qw-sys-info-service",["angular","qvangular","_qlik","apis/qutil"],function(e, t, n, i){"use strict";t.service("qwSysInfoService",function(){function t(e){var t="";switch(e){case"app":t=n.currApp();break;case"qUtil":t=i;break;case"qlik":t=n}return t}function r(e, n, i){if(n){var r=o(n=n.toLowerCase());if(r)if(r.api=t(r.api),e[n]=e[n]||[],r.types){var a=r.types.split(">");a.length>0&&(e[n]=[]);var l=a[0];if(-1!==a[0].indexOf("[")){var c=a[0].indexOf("[")+1,u=a[0].indexOf("]");l=a[0].substr(0,c-1),a[0].substr(c,u-c)}r.api&&r.api[r.func]&&r.api[r.func](l,function(t){s(e,t,n,i||r.resultKeys,r.types.split(">"),r.properties)})}else r.api[r.func](function(t){s(e,t,n,r.resultKeys)})}}function o(t){var n=void 0;return u[t]&&(n=e.copy(u[t])),n}function s(e,t,n,i,r,o){i.forEach(function(e){t=t[e]}),r&&r.length>1?a(e,t,n,r,o):Object.keys(t).length>0&&(e[n]=t)}function a(n,i,r,o,s,u,h){var d=!h,p=o[0].substr(0,2),f="",m="",g={},v="";switch(p){case"o_":f=o[0].substr(2),o=e.copy(o).splice(1),g=l(f,s,m=i,i),v=g.props,m=g.newData,h=c(v,m,h),o.length>0?a(n,m,r,o,s,u,h):n[r].push(m);break;case"f_":var y=(f=o[0].substr(2)).indexOf("_"),b=f.substr(0,y).split("."),x=f.substr(y+1);if(v="",-1!==x.indexOf("[")){var q=x.indexOf("[")+1,C=x.indexOf("]");v=s[x.substr(q,C-q)],x=x.substr(0,x.indexOf("["))}var S=e.copy(h||{});t(b[0])[b[1]](i[x]).then(function(t){v&&v.values&&(v.as&&(S[v.as]=S[v.as]||{}),S=c(v,t,S));var i=e.copy(o).splice(1);0===i.length?Object.keys(S).length>0&&n[r].push(S):a(n,t,r,i,s,u,S)});break;default:m=i,g=l(f="a_"===p?o[0].substr(2):o[0],s,m,i),v=g.props,(m=g.newData).forEach(function(t){h=h||{},v&&v.values&&(v.as&&(h[v.as]=h[v.as]||{}),h=c(v,t,h));var i=e.copy(o).splice(1);0===i.length?Object.keys(h).length>0&&n[r].push(h):a(n,t,r,i,s,u,d?e.copy(h):h)})}}function l(e,t,n,i){if(-1!==e.indexOf("[")){var r=e.indexOf("[")+1,o=e.indexOf("]"),s=t[e.substr(r,o-r)];n=i[e.substr(0,e.indexOf("["))]||i}else n=i[e]||i;return{props:s,newData:n}}function c(t,n,i){return t?(t.values.forEach(function(r){if(-1===r.indexOf(".")&&-1===r.indexOf("["))(n[r]||n.layout&&n.layout[r])&&(t.as?i[t.as][r]=e.copy(n[r]||n.layout[r]):i[r]=e.copy(n[r]||n.layout[r]));else if(-1!==r.indexOf("[")){var o=void 0,s=r.indexOf("[")+1,a=r.indexOf("]"),l=r.substr(s,a-s).split(":"),c=r.substr(0,r.indexOf("["));if(l.length>1){var u=l[1].split("."),d=e.copy(n);u.forEach(function(e){d&&(d=d[e]||d.layout[e])}),d&&(o=h[l[0]][d]||h[l[0]].other),t.as?i[t.as][c]=o:i[c]=o}else"self"===l[0]&&(t.as?i[t.as][c]=n:i[c]=n)}else{var p=r.split("."),f=e.copy(n),m=1,g=i[t.as||i];g&&p.forEach(function(e){f=f&&(f[e]||f.layout&&f.layout[e])?f[e]||f.layout[e]:void 0,p.length>m?(g[e]=g[e]||{},g=g[e],m+=1):g[e]=f})}}),i):i}var u={apps:{scopeName:"apps",api:"qlik",func:"getAppList",resultKeys:[]},sheets:{scopeName:"sheets",api:"app",func:"getList",types:"sheet",resultKeys:["qAppObjectList","qItems"]},fields:{scopeName:"fields",api:"app",func:"getList",types:"FieldList",resultKeys:["qFieldList","qItems"]},masterobjects:{scopeName:"masterobjects",api:"app",func:"getList",types:"masterobject",resultKeys:["qAppObjectList","qItems"]},measures:{scopeName:"measures",api:"app",func:"getList",types:"MeasureList",resultKeys:["qMeasureList","qItems"]},dimensions:{scopeName:"dimensions",api:"app",func:"getList",types:"DimensionList",resultKeys:["qDimensionList","qItems"]},extensions:{scopeName:"extensions:",api:"qUtil",func:"getExtensionList",resultKeys:[]},bookmarks:{scopeName:"bookmarks",api:"app",func:"getList",types:"BookmarkList",resultKeys:["qBookmarkList","qItems"]},currentselections:{scopeName:"currentselections",api:"app",func:"getList",types:"CurrentSelections",resultKeys:["qSelectionObject","qSelections"]},visualizations:{scopeName:"visualizations",api:"app",func:"getList",types:"sheet[sheets]>o_qData>a_cells>f_app.getObject_name[viz]",resultKeys:["qAppObjectList","qItems"],properties:{sheets:{as:"usedOnSheet",values:["qData.title","qData.labelExpression","qInfo","qMeta"]},viz:{values:["footnote","metadata","showTitles","qInfo","subtitle","title","version","visualization","visualizationType","qExtendsId","visualizationTypeIcon[icons:qInfo.qType]"]}}},variables:{scopeName:"variables",api:"app",func:"getList",types:"VariableList",resultKeys:["qVariableList","qItems"]}};u.sheet=u.sheets,u.field=u.fields,u.masterobject=u.masterobjects,u.measure=u.measures,u.dimension=u.dimensions,u.extension=u.extensions,u.bookmark=u.bookmarks,u.currentselection=u.currentselections,u.visualization=u.visualizations,u.variable=u.variables;var h={icons:{chart:"icon-line-chart",table:"icon-table",kpi:"icon-kpi",navigation:"icon-navigation",other:"icon-widget",barchart:"icon-bar-chart","bar-chart-vertical":"icon-bar-chart",linechart:"icon-line-chart",pivottable:"icon-table",components:"icon-components","pie-chart":"icon-pie-chart",filterpane:"icon-filterpane",list:"icon-list","gauge-chart":"icon-gauge-chart","scatter-chart":"icon-scatter-chart","text-image":"icon-text",text:"icon-titletext",map:"icon-map","combo-chart":"icon-combo-chart",extension:"icon-puzzle"}};return{loadSysInfos:function(e,t){t&&(t=Array.isArray(t)?t:t.split(",")).forEach(function(t){r(e,t.trim())})}}})}),define("dev-hub.custom-components/qw-sys-info/qw-sys-info",["qvangular","./qw-sys-info-service"],function(e){"use strict";var t=e.getService("qwSysInfoService"),n={restrict:"E",replace:!0,componentName:"qwSysInfo",controller:["$scope",function(e){this.sysinfo=function(n){t.loadSysInfos(e,n.content)}}],link:function(e,t,n,i){i.sysinfo(n)}};e.directive("qwSysInfo",function(){return n})}),define("apis/custom-component/custom-components",["core.utils/deferred","apis/custom-component/custom-component-loader","general.models/library/extension-list","dev-hub.services/message-service","dev-hub.custom-components/qw-sys-info/qw-sys-info"],function(e,t,n,i){"use strict";return{init:function(e){var n=this;return this.getList().then(function(i){return n._filterListByDependencies(i,e).then(function(e){return t.load(e)})})},getList:function(){var e=[];return this._getExternalComponents().then(function(t){return e=e.concat(t)})},validateComponent:t.validateComponent,_getExternalComponents:function(){var e=[];return n.getList().then(function(t){return t.forEach(function(t){t.data&&"component"===t.data.type&&(t.path="extensions/"+t.id+"/"+t.id,e.push(t))}),e})},_filterListByDependencies:function(t,n){var r=new e,o=[];for(var s in n){var a=n[s],l=!1,c=s.toLowerCase();if(t.forEach(function(e){if(e.data.name.toLowerCase()===c&&e.data.version===a)return o.push(e),void(l=!0)}),!l){var u="No matching component found for "+s+" (version: "+a+")";i.error(u,"custom components")}}return r.resolve(o),r.promise}}}),define("dev-hub.lib/assets-files-utils",["qvangular","underscore","core.utils/deferred","translator","dev-hub.lib/utils","general.services/content-api/content-api"],function(e,t,n,i,r){"use strict";function o(e,t){var n=r.getFileExtension(e),i=v(n);return t instanceof ArrayBuffer&&(t=new Blob([t])),{fileName:e,extension:n,content:t||i.defaultContent,contentType:null,mode:i.editorMode,lastModified:null,isDirty:!0}}function s(e){return["gif","png","jpeg","jpg"].indexOf(e)>-1}function a(e){return["eot","woff","woff2","ttf","otf"].indexOf(e)>-1}function l(e,t){var r=new n,o=[];return e.isDirty()&&e.files.forEach(function(n){if(n.isDirty){if(!s(n.extension)){var i=t?t(n.fileName):void 0;n.content=n.newContent?n.newContent:i?i.getValue():n.content}o.push(w(e.extensionUniqueName,n))}}),n.all(o).then(function(){r.resolve(e)},function(e){r.reject({errName:"ExtensionUploadToQRSErr",errMessage:i.get(e.errMessage),errObject:e})}),r.promise}function c(e,t){return t.files.filter(function(t){return t.fileName.toLowerCase()===e.toLowerCase()}).length>0}function u(e,t){var i=new n;return i.resolve(t.files.splice(t.files.indexOf(e),1)),i.promise}function h(e,t){var n={method:"GET",url:"/extensions/"+e+"/"+t,cache:!1};return s(r.getFileExtension(t))||a(r.getFileExtension(t))?n.responseType="blob":n.transformResponse=function(e){return e},D.request(n)}function d(e,t){var i=new n;return D.request({method:"GET",url:"/extensions/"+e+"/"+t}).success(function(){i.resolve(!0)}).error(function(){i.resolve(!1)}),i.promise}function p(e){var t=new n;return D.request({method:"POST",url:"/qrs/extension/name/"+e.name,data:JSON.stringify(e,null,"\t")}).success(function(){t.resolve(e)}).error(function(e){t.reject({errName:"errCreateExtension",errMessage:i.get("Devhub.ErrorCreateExtension"),errObject:e})}),t.promise}function f(e,t){var i=r.getFileExtension(t),o=v(i),s=new n;return h(e,t).success(function(e,n,r){s.resolve({success:!0,file:{fileName:t,extension:i,content:e,contentType:r()["content-type"],mode:o.editorMode,lastModified:r()["last-modified"],isDirty:!1}})}).error(function(e){s.resolve({success:!1,errObject:e,file:{fileName:t,extension:i,content:o.defaultContent,contentType:null,mode:o.editorMode,lastModified:null,isDirty:!0,loadingErr:e}})}),s.promise}function m(e){var t=new n,r=new FileReader;return r.onload=function(n){t.resolve(o(e.name,n.target.result))},r.onerror=function(e){t.reject({errName:"errFileReader",errMessage:i.get("Devhub.ErrorReadingLocalFile"),errObject:e})},(!e.type.match("image.*")&&!e.type.match("font")||e.type.match("svg")&&e.type.match("xml"))&&""!==e.type?r.readAsText(e):r.readAsArrayBuffer(e),t.promise}function g(e){var t=[],r=new n;return h(e,"wbfolder.wbl").success(function(o){o.length>0?(q(o).forEach(function(n){t.push(f(e,n))}),n.all(t).then(function(e){var t=e.map(function(e){return e.file});r.resolve(t)}).catch(function(t){r.reject({errName:"loadFilesFromRepo",errMessage:i.get("Devhub.ErrorLoadingFilesFromRepo",e),errObject:t})})):r.reject({errName:"wbFolderEmpty",errMessage:i.get("Devhub.wbFolderEmpty",e)})}).error(function(){r.reject({errName:"ErrorIncompleteWbFolder",errMessage:i.get("Devhub.ErrorIncompleteWbFolder",e)})}),r.promise}function v(e){switch(e.toLowerCase()){case"html":return{defaultContent:"<div></div>",editorMode:"htmlmixed"};case"js":return{defaultContent:"// JavaScript\r\n",editorMode:"javascript"};case"qext":case"json":return{defaultContent:"{\r\n\r\n}",editorMode:"javascript"};case"css":return{defaultContent:"/* CSS */\r\n",editorMode:"css"};case"gif":case"png":case"jpg":case"jpeg":return{defaultContent:void 0,editorMode:void 0};default:return{defaultContent:"",editorMode:"javascript"}}}function y(e,t,n){return e.forEach(function(e){if(e.fileName=e.fileName.replace(t,n),e.content&&e.content.length>0&&(e.content.indexOf("${name}")>-1&&(e.content=e.content.replace(/\${name}/g,n)),["js","css","html","htm","json"].indexOf(e.extension)>-1&&(e.content=e.content.replace(new RegExp(t,"g"),n)),"qext"===e.extension)){var i=JSON.parse(e.content);i.name=n,i.type=i.type.replace("-template",""),e.content=JSON.stringify(i,null,"\t")}}),e}function b(e,t,n){var i=[];return e.forEach(function(e){var r=e.fileName,o=!1;if(new RegExp("^("+t+"\\.)","i").test(e.fileName)&&(e.fileName=o=e.fileName.replace(t,n),i[r]=o),e.content&&e.content.length>0&&"qext"===e.extension){var s=JSON.parse(e.content);s.name=n,e.fileName=n+"."+e.extension,e.content=JSON.stringify(s,null,"\t")}}),e.forEach(function(e){if(["js","css","html","htm","json"].indexOf(e.extension)>-1){var t;for(var n in i)t=new RegExp(n,"g"),e.content=e.content.replace(t,i[n]);["css"].indexOf(e.extension)>-1&&(t=new RegExp(n.split(".")[0],"g"),e.content=e.content.replace(t,i[n].split(".")[0]))}}),e}function x(e){var n=t.findWhere(e,{extension:"qext"});if(n&&n.content)return JSON.parse(n.content).type}function q(e){return e.replace(/[\r\n]/g,"").split(";").filter(function(e){return""!==e.trim()})}function C(e,t){return w(e,o("wbfolder.wbl",S(t)))}function S(e){return e.map(function(e){return e.fileName}).join(";\r\n")}function w(e,t){var r=new n;if("qext"===t.extension)try{JSON.parse(t.content)}catch(e){return r.reject({errName:"InvalidJsonFormat",errMessage:i.get("Devhub.InvalidJsonFormat",t.fileName),errObject:e}),r.promise}return D.request({method:"POST",url:"/qrs/extension/"+e+"/uploadfile?externalpath="+encodeURIComponent(t.fileName)+"&overwrite=true",data:t.content}).success(function(){h(e,t.fileName).success(function(e,n,i){t.lastModified=i("last-modified"),t.isDirty=!1,r.resolve(t)}).error(function(e){r.reject({errName:"LoadFileFromQRSErr",errMessage:i.get("Devhub.ErrorReadingLocalFile",t.fileName),errObject:e})})}).error(function(e){r.reject({errName:"ExtensionUploadToQRSErr",errMessage:i.get("Devhub.ErrorCreatingFile",t.fileName),errObject:e})}),r.promise}function _(e){var t=new n;return D.getExtensions().then(function(n){!0===e?t.resolve(I(n)):t.resolve(n)}),t.promise}var D=e.getService("$contentApi"),M="/api/wes/v1/extensions",A=function(e,t){var i=new n;return d(e,t).then(function(n){n?D.request({method:"DELETE",url:"/qrs/extension/"+e+"/deletecontent?externalpath="+t}).success(function(){i.resolve()}).error(function(e){i.reject(e)}):i.resolve()}),i.promise},E=function(e,t){if(t)return/^[\.0-9a-zA-Z_-]+\..{2,4}$/.test(e)&&r.hasValidFileExtension(e)?{success:!0}:{success:!1,errorMsg:i.get("Devhub.InvalidFileName")};var n=e&&r.isValidExtensionName(e);return{success:n,errorMsg:n?void 0:i.get("Devhub.InvalidExtensionName")}},I=function(e){var t={extensionList:[],templateList:[]};for(var n in e){var i=/^(.*)\-template$/.exec(e[n].type);if(i){var o=i[1],s=t.templateList.filter(function(e){return e.type===o});if(s.length>0)s[0].items.push({id:n,name:e[n].name||n,title:e[n].name||n});else{var a={type:o,items:[{id:n,name:e[n].name||n,title:e[n].name||n}]};t.templateList.push(a)}}else t.extensionList.push({id:n,title:e[n].name||n,qext:e[n],src:e[n].preview&&-1!==e[n].preview.indexOf(".")?r.getPrefix()+"extensions/"+n+"/"+e[n].preview:""})}return t};return{isValidFileName:E,isFileInAssets:c,isImage:s,getWbFolder:function(e){var t=new n;return h(e,"wbfolder.wbl").success(function(e){t.resolve(e)}).error(function(){t.reject()}),t.promise},createFileObject:o,getExtensionFileObjectsFromRepo:g,getExtensionFileListFromRepo:function(e){var t=new n;return h(e,"wbfolder.wbl").success(function(e){if(e.length>0){var n=q(e);1===n.filter(function(e){return"qext"===r.getFileExtension(e)}).length?t.resolve(n):t.reject({errName:"moreThanOneQEXT",errMessage:i.get("Devhub.ErrorMoreThanOneQEXT")})}}).error(function(){t.reject({errName:"ErrorIncompleteWbFolder",errMessage:i.get("Devhub.ErrorIncompleteWbFolder",e)})}),t.promise},saveFileInRepo:w,saveFilesToRepo:l,removeFileFromAssets:u,addNewFile:function(e,t){var r=new n;if(c(e,t))r.reject({errorMsg:i.get("Devhub.FileAlreadyExists",e)});else{var s=E(e,!0);!0===s.success?d(t.extensionUniqueName,e).then(function(n){!0===n?r.reject({errorMsg:i.get("Devhub.FileAlreadyExists",e)}):w(t.extensionUniqueName,o(e,null)).then(function(e){e.isDirty=!0,t.files.push(e),C(t.extensionUniqueName,t.files).then(function(){r.resolve(t)}).catch(function(e){r.reject(e)})}).catch(function(e){r.reject(e)})}):r.reject({errorMsg:s.errorMsg})}return r.promise},getExtensionsFromRepo:_,getExtensionsByType:function(e){return _(!0).then(function(n){return t.filter(n.extensionList,function(t){return t.qext.type===e})})},deleteExtensionFromRepo:function(e){var t=new n;return D.request({method:"DELETE",url:M+"/"+e}).success(function(){t.resolve()}).error(function(n){var r="404"===n.errors[0].status?"Devhub.ErrorExtensionNotFound":"Devhub.ErrorExtensionDelete";t.reject({errMsg:i.get(r,e),errObject:n})}),t.promise},deleteFileFromRepo:A,deleteFile:function(e,i){var r=new n,o=t.extend({},i);return o.files=i.files.slice(),u(e,o),n.all({deleteFileFromRepo:A(i.extensionUniqueName,e.fileName),saveFilesToWbFolder:C(i.extensionUniqueName,o.files)}).then(function(){u(e,i),r.resolve(i)}).catch(function(e){r.reject(e)}),r.promise},importFromLocal:function(e,r){var o=new n;return m(e).then(function(e){if(c(e.fileName,r))o.reject({errMessage:i.get("Devhub.ErrorImportDuplicateFile",e.fileName)});else{var s=t.extend({},r);s.files=r.files.slice(),s.files.push(e),n.all({saveFileInRepo:w(r.extensionUniqueName,e),saveFilesToWbFolder:C(r.extensionUniqueName,s.files)}).then(function(e){e.saveFileInRepo.selected=!0,o.resolve(s)}).catch(function(e){o.reject(e)})}}).catch(function(e){o.reject({errName:"errorReadLocalFile",errMessage:i.get("Devhub.ErrorReadingLocalFile"),errObject:e})}),o.promise},duplicateExtension:function(e,t){var r=new n;return g(e).then(function(n){var s=x(n),a=s.replace("-template",""),c=/-template/.test(s)?y(n,e,t):b(n,e,t);if(c.push(o("wbfolder.wbl",S(c))),a){c.forEach(function(e){e.isDirty=!0});var u={extensionUniqueName:t,files:c,type:a,isDirty:function(){return!0}};p({name:t,type:a}).then(function(){l(u).then(function(e){r.resolve(e)}).catch(function(e){r.reject({errName:"errDuplicateExtensionTasks",errMessage:i.get("Devhub.ErrorCopyingExtension"),errObject:e})})}).catch(function(e){r.reject({errName:"errDuplicateExtensionTasks",errMessage:i.get("Devhub.ErrorCopyingExtension"),errObject:e})})}}).catch(function(e){r.reject(e)}),r.promise},saveFilesToWbFolder:C,readLocalFile:m,createExtensionInRepo:p,_loadFileFromRepo:h,__onlytest__:{_getFileDefaults:v,_getFilesFromWbFolderContent:q,_isFileInRepo:d}}}),define("dev-hub.models/widget-file",["core.utils/deferred","qvangular","general.models/library/extension-list","dev-hub.lib/assets-files-utils","general.services/content-api/content-api"],function(e,t,n,i){function r(e){return(e.libid?e.libid:e.id)+"/"+e.id}function o(e,n){return t.getService("$contentApi").request({method:"GET",url:"/extensions/"+e+(n?"?"+(new Date).getTime():""),cache:!1,transformResponse:function(e){return e}})}function s(n,i,r){var a=new e;if(r)return o(n).success(function(e,t,o){o("last-modified")!==r?a.reject("File modified by another user"):s(n,i).then(function(){a.resolve()}).catch(function(e){a.reject(e)})}),a.promise;var l=n.split("/");return t.getService("$contentApi").request({method:"POST",url:"/qrs/extension/"+l[0]+"/uploadfile?externalpath="+l[1]+"&overwrite=true",data:i}).success(function(){a.resolve()}).error(function(e){a.reject(e)}),a.promise}function a(n){var i=new e,r=n.split("/");return t.getService("$contentApi").request({method:"DELETE",url:"/qrs/extension/"+r[0]+"/deletecontent?externalpath="+r[1]}).success(function(){i.resolve()}).error(function(e){i.reject(e)}),i.promise}function l(t){var n=new e;return s(r(t)+".qext",JSON.stringify(t.data,null,2)).then(function(){n.resolve()},function(e){n.reject(e)}),n.promise}function c(t){var n=new e;return o(t+"/"+t+".qext",!0).success(function(e){var t=JSON.parse(e);n.resolve(t)}).error(function(e){n.reject(e)}),n.promise}function u(t,n){var i=new e;return c(t).then(function(e){e.widgets||(e.widgets=[]),e.widgets.push(n),l({id:t,data:e}).then(function(){i.resolve()},function(e){i.reject(e)})}),i.promise}function h(t,n){var i=new e;return c(t).then(function(e){e.widgets?(e.widgets=e.widgets.filter(function(e){return e!==n}),l({id:t,data:e}).then(function(){i.resolve()},function(e){i.reject(e)})):i.reject()}),i.promise}function d(t){var n=new e;return o(t+".json",!0).success(function(e,t,i){try{var r=JSON.parse(e);r.lastModified=i("last-modified"),n.resolve(r)}catch(e){n.reject(e)}}).error(function(){n.reject()}),n.promise}var p,f={},m=[];return{saveTemplate:function(t){var n=new e,i=r(t);return s(i+".json",JSON.stringify({name:t.name,description:t.description,author:t.author,library:t.libid,meta:t.meta,properties:t.properties,dependencies:t.dependencies},null,2),t.lastModified).then(function(){var e="<style>"+t.css+"</style>\n<div>"+t.html+"</div>";s(i+".html",e).then(function(){t.lastModified?o(i+".json",!0).success(function(e,n,i){t.lastModified=i("last-modified")}).then(function(){n.resolve()}):u(t.libid,t.id).then(function(){o(i+".json",!0).success(function(e,n,i){t.lastModified=i("last-modified")}).then(function(){n.resolve()})})},function(e){n.reject(e)})},function(e){n.reject(e)}),n.promise},getTemplate:function(e,t){var n=e+"/"+t;return f[n]||(f[n]=d(n)),f[n]},deleteTemplate:function(t){var n=new e,i=r(t);return a(i+".json").then(function(){h(t.libid,t.id).then(function(){a(i+".html").then(function(){delete f[i],n.resolve()},function(e){n.reject(e)})},function(e){n.reject(e)})},function(){n.reject()}),n.promise},addTemplate:function(t){var n=r(t);if(!f[n]){var i=new e;f[n]=i.promise,i.resolve(t)}},getWidgetList:function(t){if(!p||t){p=new e;var i=[];n.getList(t).then(function(e){m.length=0,e.forEach(function(e){"widget-library"===e.data.type&&(m.push(e),e.data.widgets&&e.data.widgets.forEach(function(t){i.push({libid:e.id,id:t})}))}),p.resolve(i)})}return p.promise},getWidgetListFromLibrary:function(t){var i=[],r=new e;return n.getList(!1).then(function(e){m.length=0,e.forEach(function(e){"widget-library"===e.data.type&&e.id===t&&(m.push(e),e.data.widgets&&e.data.widgets.forEach(function(t){i.push({libid:e.id,id:t})}))}),r.resolve(i)}),r.promise},loadWidget:function(t){var n=new e;return o(r(t)+".html",!0).success(function(e){var i=document.createElement("div");i.innerHTML=e;for(var r=i.getElementsByTagName("script"),o=r.length;o--;)r[o].parentNode.removeChild(r[o]);var s=i.getElementsByTagName("style");if(1===s.length){t.css=s[0].innerHTML;var a=i.getElementsByTagName("div");t.html=a[0].innerHTML,n.resolve()}else n.reject("Widget.InvalidTemplate")}).error(function(){n.reject()}),n.promise},getLibForId:function(e){var t=m.filter(function(t){return t.data.widgets&&t.data.widgets.indexOf(e)>-1});return t.length>1&&console.log("Duplicate libraries for widget:"+e,t),t[0]},loadFile:o,getLibrary:c,saveLibrary:l,deleteLibrary:function(e){return a(r(e)+".qext")},createLibrary:function(e,t){return i.createExtensionInRepo({name:e,description:t,type:"widget-library"})},reloadCachedLibraries:function(){var t=new e;return n.getList(!0).then(function(e){m.length=0,e.forEach(function(e){"widget-library"===e.data.type&&m.push(e)}),t.resolve()}).catch(function(e){t.reject(e)}),t.promise}}}),define("dev-hub.models/widget-template",["core.utils/deferred","translator","./widget-file","core.utils/notification"],function(e,t,n,i){function r(e){var t=null;o.forEach(function(n,i){e.id===n.id&&(t=i)}),null===t?o.push(e):o[t]=e,s[e.id]=e}var o=[],s={},a="",l=[{id:"chart",name:"Widget.Type.chart",icon:"line-chart"},{id:"table",name:"Widget.Type.table",icon:"table"},{id:"kpi",name:"Widget.Type.kpi",icon:"kpi"},{id:"navigation",name:"Widget.Type.navigation",icon:"compass"},{id:"other",name:"Widget.Type.other"}],c=function(e,t,n,i,r,o,s,a,l){this._version=0,o||(o={}),Object.defineProperties(this,{libid:{value:e},id:{value:t},name:{value:n,writable:!0},description:{value:i,writable:!0},author:{value:r,writable:!0},meta:{value:o,writable:!0},dummy:{value:!0===l?"true":null},html:{get:function(){return this._html},set:function(e){this._html=e,this._version++}},css:{get:function(){return this._css},set:function(e){this._css=e,this._version++}},properties:{value:s,writable:!0},dependencies:{value:a,writable:!0},version:{get:function(){return this._version}},isLoaded:{get:function(){return void 0!==this._html}}})};return c.getIcon=function(e){var t;return l.forEach(function(n){n.id===e&&n.icon&&(t=n.icon)}),t||"widget"},c.prototype.load=function(e){return this.loadDfd&&!e||(this.loadDfd=n.loadWidget(this)),this.loadDfd},c.prototype.save=function(){var e=this;return n.saveTemplate(this).then(function(){return c.Updated.emit(o),e})},c.prototype.copy=function(e){return c.add({libid:e.libid||this.libid,id:e.id||this.id,name:e.name||this.name,description:e.description||""===e.description?e.description:this.description,author:e.author||this.author,meta:e.meta||this.meta,html:e.html||this.html,css:e.css||this.css,properties:e.properties||this.properties})},c.prototype.delete=function(){var e=n.deleteTemplate(this),t=this;return o.forEach(function(e,n){e.id===t.id&&o.splice(n,1)}),s&&s[t.id]&&delete s[t.id],e.then(function(){c.Updated.emit(o)}),e},c.prototype.move=function(e){var t=this,i=this.copy({libid:e});return i.save().then(function(){return t.delete().then(function(){return n.reloadCachedLibraries().then(function(){return i})})})},c.getTemplateListFromLibrary=function(t){var i=[],r=new e;return o.length=0,n.getWidgetListFromLibrary(t).then(function(t){t.forEach(function(e){i.push(c.get(e.id,!0,e.libid))}),e.all(i).then(function(){r.resolve(o)})}),r.promise},c.getTemplateList=function(t){var i=[];return a&&!t||(a=new e,n.getWidgetList(t).then(function(t){t.forEach(function(e){i.push(c.get(e.id,!0,e.libid))}),e.all(i).then(function(){a.resolve(o)})})),a.promise},c.getLoaded=function(e){return s[e]},c.resetWidgetsProperties=function(e){s[e].propertiesObj&&s[e].propertiesObj.lastSavedProperties&&(s[e].properties=s[e].propertiesObj.lastSavedProperties)},c.get=function(i,o,a){if(i.indexOf("/")>-1){var l=i.split("/");a=l[0],i=l[1]}var u=new e;if(s[i]){var h=s[i];h.isLoaded||o?u.resolve(h):h.load().then(function(){u.resolve(h)},function(e){u.reject(e)})}else{if(!a){var d=n.getLibForId(i);a=d?d.id:void 0}a?n.getTemplate(a,i).then(function(e){e.properties||(e.properties={});var n=new c(a,i,e.name||t.get("Widget.NoName"),e.description||"",e.author||"",e.meta||{},e.properties,e.dependencies||{});n.lastModified=e.lastModified,r(n),n.isLoaded||o?u.resolve(n):n.load().then(function(){u.resolve(n)},function(e){n.err=e,u.resolve(n)})},function(){var e=new c(a,i);u.resolve(e)}):u.reject(t.get("Error.NoLibraryForWidget",i))}return u.promise},c.add=function(e){if(!e.id||!e.libid)return!1;var t=new c(e.libid,e.id,e.name||"",e.description||"",e.author||"",e.meta,e.properties,e.dependencies||{},e.dummy);return t.html=e.html||"",t.css=e.css||"",r(t),n.addTemplate(t),c.Updated.emit(o),t},i.create(c,"Updated"),c.types=l,c}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("assets/external/less/less",[],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).less=e()}}(function(){return function e(t,n,i){function r(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return r(n||e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){var i=e("./utils").addDataAttr,r=e("./browser");t.exports=function(e,t){i(t,r.currentScript(e)),void 0===t.isFileProtocol&&(t.isFileProtocol=/^(file|(chrome|safari)(-extension)?|resource|qrc|app):/.test(e.location.protocol)),t.async=t.async||!1,t.fileAsync=t.fileAsync||!1,t.poll=t.poll||(t.isFileProtocol?1e3:1500),t.env=t.env||("127.0.0.1"==e.location.hostname||"0.0.0.0"==e.location.hostname||"localhost"==e.location.hostname||e.location.port&&e.location.port.length>0||t.isFileProtocol?"development":"production");var n=/!dumpLineNumbers:(comments|mediaquery|all)/.exec(e.location.hash);n&&(t.dumpLineNumbers=n[1]),void 0===t.useFileCache&&(t.useFileCache=!0),void 0===t.onReady&&(t.onReady=!0)}},{"./browser":3,"./utils":9}],2:[function(e,t,n){e("promise/polyfill.js");var i=window.less||{};e("./add-default-options")(window,i);var r=t.exports=e("./index")(window,i);window.less=r,i.onReady&&(/!watch/.test(window.location.hash)&&r.watch(),r.registerStylesheetsImmediately(),r.pageLoadFinished=r.refresh("development"===r.env))},{"./add-default-options":1,"./index":7,"promise/polyfill.js":95}],3:[function(e,t,n){var i=e("./utils");t.exports={createCSS:function(e,t,n){var r=n.href||"",o="less:"+(n.title||i.extractId(r)),s=e.getElementById(o),a=!1,l=e.createElement("style");l.setAttribute("type","text/css"),n.media&&l.setAttribute("media",n.media),l.id=o,l.styleSheet||(l.appendChild(e.createTextNode(t)),a=null!==s&&s.childNodes.length>0&&l.childNodes.length>0&&s.firstChild.nodeValue===l.firstChild.nodeValue);var c=e.getElementsByTagName("head")[0];if(null===s||!1===a){var u=n&&n.nextSibling||null;u?u.parentNode.insertBefore(l,u):c.appendChild(l)}if(s&&!1===a&&s.parentNode.removeChild(s),l.styleSheet)try{l.styleSheet.cssText=t}catch(e){throw new Error("Couldn't reassign styleSheet.cssText.")}},currentScript:function(e){var t=e.document;return t.currentScript||function(){var e=t.getElementsByTagName("script");return e[e.length-1]}()}}},{"./utils":9}],4:[function(e,t,n){t.exports=function(e,t,n){var i=null;if("development"!==t.env)try{i=void 0===e.localStorage?null:e.localStorage}catch(e){}return{setCSS:function(e,t,r){if(i){n.info("saving "+e+" to cache.");try{i.setItem(e,r),i.setItem(e+":timestamp",t)}catch(t){n.error('failed to save "'+e+'" to local storage for caching.')}}},getCSS:function(e,t){var n=i&&i.getItem(e),r=i&&i.getItem(e+":timestamp");if(r&&t.lastModified&&new Date(t.lastModified).valueOf()===new Date(r).valueOf())return n}}}},{}],5:[function(e,t,n){var i=e("./utils"),r=e("./browser");t.exports=function(e,t,n){function o(t,o){var s,a,l="less-error-message:"+i.extractId(o||""),c=e.document.createElement("div"),u=[],h=t.filename||o,d=h.match(/([^\/]+(\?.*)?)$/)[1];c.id=l,c.className="less-error-message",a="<h3>"+(t.type||"Syntax")+"Error: "+(t.message||"There is an error in your .less file")+'</h3><p>in <a href="'+h+'">'+d+"</a> ";var p=function(e,t,n){void 0!==e.extract[t]&&u.push('<li><label>{line}</label><pre class="{class}">{content}</pre></li>'.replace(/\{line\}/,(parseInt(e.line,10)||0)+(t-1)).replace(/\{class\}/,n).replace(/\{content\}/,e.extract[t]))};t.extract&&(p(t,0,""),p(t,1,"line"),p(t,2,""),a+="on line "+t.line+", column "+(t.column+1)+":</p><ul>"+u.join("")+"</ul>"),t.stack&&(t.extract||n.logLevel>=4)&&(a+="<br/>Stack Trace</br />"+t.stack.split("\n").slice(1).join("<br/>")),c.innerHTML=a,r.createCSS(e.document,[".less-error-message ul, .less-error-message li {","list-style-type: none;","margin-right: 15px;","padding: 4px 0;","margin: 0;","}",".less-error-message label {","font-size: 12px;","margin-right: 15px;","padding: 4px 0;","color: #cc7777;","}",".less-error-message pre {","color: #dd6666;","padding: 4px 0;","margin: 0;","display: inline-block;","}",".less-error-message pre.line {","color: #ff0000;","}",".less-error-message h3 {","font-size: 20px;","font-weight: bold;","padding: 15px 0 5px 0;","margin: 0;","}",".less-error-message a {","color: #10a","}",".less-error-message .error {","color: red;","font-weight: bold;","padding-bottom: 2px;","border-bottom: 1px dashed red;","}"].join("\n"),{title:"error-message"}),c.style.cssText=["font-family: Arial, sans-serif","border: 1px solid #e00","background-color: #eee","border-radius: 5px","-webkit-border-radius: 5px","-moz-border-radius: 5px","color: #e00","padding: 15px","margin-bottom: 15px"].join(";"),"development"===n.env&&(s=setInterval(function(){var t=e.document,n=t.body;n&&(t.getElementById(l)?n.replaceChild(c,t.getElementById(l)):n.insertBefore(c,n.firstChild),clearInterval(s))},10))}function s(t){var n=e.document.getElementById("less-error-message:"+i.extractId(t));n&&n.parentNode.removeChild(n)}function a(e){}function l(e,i){var r=e.filename||i,o=[],s=(e.type||"Syntax")+"Error: "+(e.message||"There is an error in your .less file")+" in "+r+" ",a=function(e,t,n){void 0!==e.extract[t]&&o.push("{line} {content}".replace(/\{line\}/,(parseInt(e.line,10)||0)+(t-1)).replace(/\{class\}/,n).replace(/\{content\}/,e.extract[t]))};e.extract&&(a(e,0,""),a(e,1,"line"),a(e,2,""),s+="on line "+e.line+", column "+(e.column+1)+":\n"+o.join("\n")),e.stack&&(e.extract||n.logLevel>=4)&&(s+="\nStack Trace\n"+e.stack),t.logger.error(s)}return{add:function(e,t){n.errorReporting&&"html"!==n.errorReporting?"console"===n.errorReporting?l(e,t):"function"==typeof n.errorReporting&&n.errorReporting("add",e,t):o(e,t)},remove:function(e){n.errorReporting&&"html"!==n.errorReporting?"console"===n.errorReporting?a(e):"function"==typeof n.errorReporting&&n.errorReporting("remove",e):s(e)}}}},{"./browser":3,"./utils":9}],6:[function(e,t,n){t.exports=function(t,n){function i(){if(window.XMLHttpRequest&&!("file:"===window.location.protocol&&"ActiveXObject"in window))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return n.error("browser doesn't support AJAX."),null}}var r=e("../less/environment/abstract-file-manager.js"),o={},s=function(){};return s.prototype=new r,s.prototype.alwaysMakePathsAbsolute=function(){return!0},s.prototype.join=function(e,t){return e?this.extractUrlParts(t,e).path:t},s.prototype.doXHR=function(e,r,o,s){function a(t,n,i){t.status>=200&&t.status<300?n(t.responseText,t.getResponseHeader("Last-Modified")):"function"==typeof i&&i(t.status,e)}var l=i(),c=t.isFileProtocol?t.fileAsync:t.async;"function"==typeof l.overrideMimeType&&l.overrideMimeType("text/css"),n.debug("XHR: Getting '"+e+"'"),l.open("GET",e,c),l.setRequestHeader("Accept",r||"text/x-less, text/css; q=0.9, */*; q=0.5"),l.send(null),t.isFileProtocol&&!t.fileAsync?0===l.status||l.status>=200&&l.status<300?o(l.responseText):s(l.status,e):c?l.onreadystatechange=function(){4==l.readyState&&a(l,o,s)}:a(l,o,s)},s.prototype.supports=function(e,t,n,i){return!0},s.prototype.clearFileCache=function(){o={}},s.prototype.loadFile=function(e,t,n,i,r){t&&!this.isPathAbsolute(e)&&(e=t+e),n=n||{};var s=this.extractUrlParts(e,window.location.href).url;if(n.useFileCache&&o[s])try{var a=o[s];r(null,{contents:a,filename:s,webInfo:{lastModified:new Date}})}catch(e){r({filename:s,message:"Error loading file "+s+" error was "+e.message})}else this.doXHR(s,n.mime,function(e,t){o[s]=e,r(null,{contents:e,filename:s,webInfo:{lastModified:t}})},function(e,t){r({type:"File",message:"'"+t+"' wasn't found ("+e+")",href:s})})},s}},{"../less/environment/abstract-file-manager.js":14}],7:[function(e,t,n){var i=e("./utils").addDataAttr,r=e("./browser");t.exports=function(t,n){function o(e){return n.postProcessor&&"function"==typeof n.postProcessor&&(e=n.postProcessor.call(e,e)||e),e}function s(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function a(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){var i=n.concat(Array.prototype.slice.call(arguments,0));return e.apply(t,i)}}function l(e){for(var t,i=d.getElementsByTagName("style"),r=0;r<i.length;r++)if((t=i[r]).type.match(b)){var o=s(n);o.modifyVars=e;var l=t.innerHTML||"";o.filename=d.location.href.replace(/#.*$/,""),p.render(l,o,a(function(e,t,n){t?v.add(t,"inline"):(e.type="text/css",e.styleSheet?e.styleSheet.cssText=n.css:e.innerHTML=n.css)},null,t))}}function c(e,t,r,a,l){function c(n){var i=n.contents,s=n.filename,l=n.webInfo,c={currentDirectory:g.getPath(s),filename:s,rootFilename:s,relativeUrls:u.relativeUrls};if(c.entryPath=c.currentDirectory,c.rootpath=u.rootpath||c.currentDirectory,l&&(l.remaining=a,!u.modifyVars)){var h=y.getCSS(s,l);if(!r&&h)return l.local=!0,void t(null,h,i,e,l,s)}v.remove(s),u.rootFileInfo=c,p.render(i,u,function(n,r){n?(n.href=s,t(n)):(r.css=o(r.css),u.modifyVars||y.setCSS(e.href,l.lastModified,r.css),t(null,r.css,i,e,l,s))})}var u=s(n);i(u,e),u.mime=e.type,l&&(u.modifyVars=l),g.loadFile(e.href,null,u,f,function(e,n){e?t(e):c(n)})}function u(e,t,n){for(var i=0;i<p.sheets.length;i++)c(p.sheets[i],e,t,p.sheets.length-(i+1),n)}function h(){"development"===p.env&&(p.watchTimer=setInterval(function(){p.watchMode&&(g.clearFileCache(),u(function(e,n,i,o,s){e?v.add(e,e.href||o.href):n&&r.createCSS(t.document,n,o)}))},n.poll))}var d=t.document,p=e("../less")();p.options=n;var f=p.environment,m=e("./file-manager")(n,p.logger),g=new m;f.addFileManager(g),p.FileManager=m,e("./log-listener")(p,n);var v=e("./error-reporting")(t,p,n),y=p.cache=n.cache||e("./cache")(t,n,p.logger);n.functions&&p.functions.functionRegistry.addMultiple(n.functions);var b=/^text\/(x-)?less$/;return p.watch=function(){return p.watchMode||(p.env="development",h()),this.watchMode=!0,!0},p.unwatch=function(){return clearInterval(p.watchTimer),this.watchMode=!1,!1},p.registerStylesheetsImmediately=function(){var e=d.getElementsByTagName("link");p.sheets=[];for(var t=0;t<e.length;t++)("stylesheet/less"===e[t].rel||e[t].rel.match(/stylesheet/)&&e[t].type.match(b))&&p.sheets.push(e[t])},p.registerStylesheets=function(){return new Promise(function(e,t){p.registerStylesheetsImmediately(),e()})},p.modifyVars=function(e){return p.refresh(!0,e,!1)},p.refresh=function(e,n,i){return(e||i)&&!1!==i&&g.clearFileCache(),new Promise(function(i,o){var s,a,c;s=a=new Date,u(function(e,n,l,u,h){if(e)return v.add(e,e.href||u.href),void o(e);h.local?p.logger.info("loading "+u.href+" from cache."):p.logger.info("rendered "+u.href+" successfully."),r.createCSS(t.document,n,u),p.logger.info("css for "+u.href+" generated in "+(new Date-a)+"ms"),0===h.remaining&&(c=new Date-s,p.logger.info("less has finished. css generated in "+c+"ms"),i({startTime:s,endTime:a,totalMilliseconds:c,sheets:p.sheets.length})),a=new Date},e,n),l(n)})},p.refreshStyles=l,p}},{"../less":30,"./browser":3,"./cache":4,"./error-reporting":5,"./file-manager":6,"./log-listener":8,"./utils":9}],8:[function(e,t,n){t.exports=function(e,t){t.logLevel=void 0!==t.logLevel?t.logLevel:"development"===t.env?3:1,t.loggers||(t.loggers=[{debug:function(e){t.logLevel>=4&&console.log(e)},info:function(e){t.logLevel>=3&&console.log(e)},warn:function(e){t.logLevel>=2&&console.warn(e)},error:function(e){t.logLevel>=1&&console.error(e)}}]);for(var n=0;n<t.loggers.length;n++)e.logger.addListener(t.loggers[n])}},{}],9:[function(e,t,n){t.exports={extractId:function(e){return e.replace(/^[a-z-]+:\/+?[^\/]+/,"").replace(/[\?\&]livereload=\w+/,"").replace(/^\//,"").replace(/\.[a-zA-Z]+$/,"").replace(/[^\.\w-]+/g,"-").replace(/\./g,":")},addDataAttr:function(e,t){for(var n in t.dataset)if(t.dataset.hasOwnProperty(n))if("env"===n||"dumpLineNumbers"===n||"rootpath"===n||"errorReporting"===n)e[n]=t.dataset[n];else try{e[n]=JSON.parse(t.dataset[n])}catch(e){}}}},{}],10:[function(e,t,n){var i={};t.exports=i;var r=function(e,t,n){if(e)for(var i=0;i<n.length;i++)e.hasOwnProperty(n[i])&&(t[n[i]]=e[n[i]])},o=["paths","relativeUrls","rootpath","strictImports","insecure","dumpLineNumbers","compress","syncImport","chunkInput","mime","useFileCache","processImports","reference","pluginManager"];i.Parse=function(e){r(e,this,o),"string"==typeof this.paths&&(this.paths=[this.paths])};var s=["paths","compress","ieCompat","strictMath","strictUnits","sourceMap","importMultiple","urlArgs","javascriptEnabled","pluginManager","importantScope"];i.Eval=function(e,t){r(e,this,s),"string"==typeof this.paths&&(this.paths=[this.paths]),this.frames=t||[],this.importantScope=this.importantScope||[]},i.Eval.prototype.inParenthesis=function(){this.parensStack||(this.parensStack=[]),this.parensStack.push(!0)},i.Eval.prototype.outOfParenthesis=function(){this.parensStack.pop()},i.Eval.prototype.isMathOn=function(){return!this.strictMath||this.parensStack&&this.parensStack.length},i.Eval.prototype.isPathRelative=function(e){return!/^(?:[a-z-]+:|\/|#)/i.test(e)},i.Eval.prototype.normalizePath=function(e){var t,n=e.split("/").reverse();for(e=[];0!==n.length;)switch(t=n.pop()){case".":break;case"..":0===e.length||".."===e[e.length-1]?e.push(t):e.pop();break;default:e.push(t)}return e.join("/")}},{}],11:[function(e,t,n){t.exports={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}},{}],12:[function(e,t,n){t.exports={colors:e("./colors"),unitConversions:e("./unit-conversions")}},{"./colors":11,"./unit-conversions":13}],13:[function(e,t,n){t.exports={length:{m:1,cm:.01,mm:.001,in:.0254,px:.0254/96,pt:.0254/72,pc:.0254/72*12},duration:{s:1,ms:.001},angle:{rad:1/(2*Math.PI),deg:1/360,grad:.0025,turn:1}}},{}],14:[function(e,t,n){var i=function(){};i.prototype.getPath=function(e){var t=e.lastIndexOf("?");return t>0&&(e=e.slice(0,t)),(t=e.lastIndexOf("/"))<0&&(t=e.lastIndexOf("\\")),t<0?"":e.slice(0,t+1)},i.prototype.tryAppendExtension=function(e,t){return/(\.[a-z]*$)|([\?;].*)$/.test(e)?e:e+t},i.prototype.tryAppendLessExtension=function(e){return this.tryAppendExtension(e,".less")},i.prototype.supportsSync=function(){return!1},i.prototype.alwaysMakePathsAbsolute=function(){return!1},i.prototype.isPathAbsolute=function(e){return/^(?:[a-z-]+:|\/|\\|#)/i.test(e)},i.prototype.join=function(e,t){return e?e+t:t},i.prototype.pathDiff=function(e,t){var n,i,r,o,s=this.extractUrlParts(e),a=this.extractUrlParts(t),l="";if(s.hostPart!==a.hostPart)return"";for(i=Math.max(a.directories.length,s.directories.length),n=0;n<i&&a.directories[n]===s.directories[n];n++);for(o=a.directories.slice(n),r=s.directories.slice(n),n=0;n<o.length-1;n++)l+="../";for(n=0;n<r.length-1;n++)l+=r[n]+"/";return l},i.prototype.extractUrlParts=function(e,t){var n,i,r=/^((?:[a-z-]+:)?\/+?(?:[^\/\?#]*\/)|([\/\\]))?((?:[^\/\\\?#]*[\/\\])*)([^\/\\\?#]*)([#\?].*)?$/i,o=e.match(r),s={},a=[];if(!o)throw new Error("Could not parse sheet href - '"+e+"'");if(t&&(!o[1]||o[2])){if(!(i=t.match(r)))throw new Error("Could not parse page url - '"+t+"'");o[1]=o[1]||i[1]||"",o[2]||(o[3]=i[3]+o[3])}if(o[3]){for(a=o[3].replace(/\\/g,"/").split("/"),n=0;n<a.length;n++)"."===a[n]&&(a.splice(n,1),n-=1);for(n=0;n<a.length;n++)".."===a[n]&&n>0&&(a.splice(n-1,2),n-=2)}return s.hostPart=o[1],s.directories=a,s.path=(o[1]||"")+a.join("/"),s.fileUrl=s.path+(o[4]||""),s.url=s.fileUrl+(o[5]||""),s},t.exports=i},{}],15:[function(e,t,n){var i=e("../logger"),r=function(e,t){this.fileManagers=t||[],e=e||{};for(var n=["encodeBase64","mimeLookup","charsetLookup","getSourceMapGenerator"],i=[],r=i.concat(n),o=0;o<r.length;o++){var s=r[o],a=e[s];a?this[s]=a.bind(e):o<i.length&&this.warn("missing required function in environment - "+s)}};r.prototype.getFileManager=function(e,t,n,r,o){e||i.warn("getFileManager called with no filename.. Please report this issue. continuing."),null==t&&i.warn("getFileManager called with null directory.. Please report this issue. continuing.");var s=this.fileManagers;n.pluginManager&&(s=[].concat(s).concat(n.pluginManager.getFileManagers()));for(var a=s.length-1;a>=0;a--){var l=s[a];if(l[o?"supportsSync":"supports"](e,t,n,r))return l}return null},r.prototype.addFileManager=function(e){this.fileManagers.push(e)},r.prototype.clearFileManagers=function(){this.fileManagers=[]},t.exports=r},{"../logger":32}],16:[function(e,t,n){function i(e,t,n){var i,o,s,a,l=t.alpha,c=n.alpha,u=[];s=c+l*(1-c);for(var h=0;h<3;h++)a=e(i=t.rgb[h]/255,o=n.rgb[h]/255),s&&(a=(c*o+l*(i-c*(i+o-a)))/s),u[h]=255*a;return new r(u,s)}var r=e("../tree/color"),o=e("./function-registry"),s={multiply:function(e,t){return e*t},screen:function(e,t){return e+t-e*t},overlay:function(e,t){return(e*=2)<=1?s.multiply(e,t):s.screen(e-1,t)},softlight:function(e,t){var n=1,i=e;return t>.5&&(i=1,n=e>.25?Math.sqrt(e):((16*e-12)*e+4)*e),e-(1-2*t)*i*(n-e)},hardlight:function(e,t){return s.overlay(t,e)},difference:function(e,t){return Math.abs(e-t)},exclusion:function(e,t){return e+t-2*e*t},average:function(e,t){return(e+t)/2},negation:function(e,t){return 1-Math.abs(e+t-1)}};for(var a in s)s.hasOwnProperty(a)&&(i[a]=i.bind(null,s[a]));o.addMultiple(i)},{"../tree/color":49,"./function-registry":21}],17:[function(e,t,n){function i(e){return Math.min(1,Math.max(0,e))}function r(e){return a.hsla(e.h,e.s,e.l,e.a)}function o(e){if(e instanceof l)return parseFloat(e.unit.is("%")?e.value/100:e.value);if("number"==typeof e)return e;throw{type:"Argument",message:"color functions take numbers as parameters"}}function s(e,t){return e instanceof l&&e.unit.is("%")?parseFloat(e.value*t/100):o(e)}var a,l=e("../tree/dimension"),c=e("../tree/color"),u=e("../tree/quoted"),h=e("../tree/anonymous"),d=e("./function-registry");a={rgb:function(e,t,n){return a.rgba(e,t,n,1)},rgba:function(e,t,n,i){var r=[e,t,n].map(function(e){return s(e,255)});return i=o(i),new c(r,i)},hsl:function(e,t,n){return a.hsla(e,t,n,1)},hsla:function(e,t,n,r){function s(e){return 6*(e=e<0?e+1:e>1?e-1:e)<1?c+(l-c)*e*6:2*e<1?l:3*e<2?c+(l-c)*(2/3-e)*6:c}e=o(e)%360/360,t=i(o(t)),n=i(o(n)),r=i(o(r));var l=n<=.5?n*(t+1):n+t-n*t,c=2*n-l;return a.rgba(255*s(e+1/3),255*s(e),255*s(e-1/3),r)},hsv:function(e,t,n){return a.hsva(e,t,n,1)},hsva:function(e,t,n,i){e=o(e)%360/360*360,t=o(t),n=o(n),i=o(i);var r,s,l=[n,n*(1-t),n*(1-(s=e/60-(r=Math.floor(e/60%6)))*t),n*(1-(1-s)*t)],c=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]];return a.rgba(255*l[c[r][0]],255*l[c[r][1]],255*l[c[r][2]],i)},hue:function(e){return new l(e.toHSL().h)},saturation:function(e){return new l(100*e.toHSL().s,"%")},lightness:function(e){return new l(100*e.toHSL().l,"%")},hsvhue:function(e){return new l(e.toHSV().h)},hsvsaturation:function(e){return new l(100*e.toHSV().s,"%")},hsvvalue:function(e){return new l(100*e.toHSV().v,"%")},red:function(e){return new l(e.rgb[0])},green:function(e){return new l(e.rgb[1])},blue:function(e){return new l(e.rgb[2])},alpha:function(e){return new l(e.toHSL().a)},luma:function(e){return new l(e.luma()*e.alpha*100,"%")},luminance:function(e){var t=.2126*e.rgb[0]/255+.7152*e.rgb[1]/255+.0722*e.rgb[2]/255;return new l(t*e.alpha*100,"%")},saturate:function(e,t,n){if(!e.rgb)return null;var o=e.toHSL();return void 0!==n&&"relative"===n.value?o.s+=o.s*t.value/100:o.s+=t.value/100,o.s=i(o.s),r(o)},desaturate:function(e,t,n){var o=e.toHSL();return void 0!==n&&"relative"===n.value?o.s-=o.s*t.value/100:o.s-=t.value/100,o.s=i(o.s),r(o)},lighten:function(e,t,n){var o=e.toHSL();return void 0!==n&&"relative"===n.value?o.l+=o.l*t.value/100:o.l+=t.value/100,o.l=i(o.l),r(o)},darken:function(e,t,n){var o=e.toHSL();return void 0!==n&&"relative"===n.value?o.l-=o.l*t.value/100:o.l-=t.value/100,o.l=i(o.l),r(o)},fadein:function(e,t,n){var o=e.toHSL();return void 0!==n&&"relative"===n.value?o.a+=o.a*t.value/100:o.a+=t.value/100,o.a=i(o.a),r(o)},fadeout:function(e,t,n){var o=e.toHSL();return void 0!==n&&"relative"===n.value?o.a-=o.a*t.value/100:o.a-=t.value/100,o.a=i(o.a),r(o)},fade:function(e,t){var n=e.toHSL();return n.a=t.value/100,n.a=i(n.a),r(n)},spin:function(e,t){var n=e.toHSL(),i=(n.h+t.value)%360;return n.h=i<0?360+i:i,r(n)},mix:function(e,t,n){e.toHSL&&t.toHSL||(console.log(t.type),console.dir(t)),n||(n=new l(50));var i=n.value/100,r=2*i-1,o=e.toHSL().a-t.toHSL().a,s=((r*o==-1?r:(r+o)/(1+r*o))+1)/2,a=1-s,u=[e.rgb[0]*s+t.rgb[0]*a,e.rgb[1]*s+t.rgb[1]*a,e.rgb[2]*s+t.rgb[2]*a],h=e.alpha*i+t.alpha*(1-i);return new c(u,h)},greyscale:function(e){return a.desaturate(e,new l(100))},contrast:function(e,t,n,i){if(!e.rgb)return null;if(void 0===n&&(n=a.rgba(255,255,255,1)),void 0===t&&(t=a.rgba(0,0,0,1)),t.luma()>n.luma()){var r=n;n=t,t=r}return i=void 0===i?.43:o(i),e.luma()<i?n:t},argb:function(e){return new h(e.toARGB())},color:function(e){if(e instanceof u&&/^#([a-f0-9]{6}|[a-f0-9]{3})$/i.test(e.value))return new c(e.value.slice(1));if(e instanceof c||(e=c.fromKeyword(e.value)))return e.value=void 0,e;throw{type:"Argument",message:"argument must be a color keyword or 3/6 digit hex e.g. #FFF"}},tint:function(e,t){return a.mix(a.rgb(255,255,255),e,t)},shade:function(e,t){return a.mix(a.rgb(0,0,0),e,t)}},d.addMultiple(a)},{"../tree/anonymous":45,"../tree/color":49,"../tree/dimension":55,"../tree/quoted":72,"./function-registry":21}],18:[function(e,t,n){t.exports=function(t){var n=e("../tree/quoted"),i=e("../tree/url"),r=e("./function-registry"),o=function(e,t){return new i(t,e.index,e.currentFileInfo).eval(e.context)},s=e("../logger");r.add("data-uri",function(e,r){r||(r=e,e=null);var a=e&&e.value,l=r.value,c=this.currentFileInfo,u=c.relativeUrls?c.currentDirectory:c.entryPath,h=l.indexOf("#"),d="";-1!==h&&(d=l.slice(h),l=l.slice(0,h));var p=t.getFileManager(l,u,this.context,t,!0);if(!p)return o(this,r);var f=!1;if(e)f=/;base64$/.test(a);else{if("image/svg+xml"===(a=t.mimeLookup(l)))f=!1;else{var m=t.charsetLookup(a);f=["US-ASCII","UTF-8"].indexOf(m)<0}f&&(a+=";base64")}var g=p.loadFileSync(l,u,this.context,t);if(!g.contents)return s.warn("Skipped data-uri embedding of "+l+" because file not found"),o(this,r||e);var v=g.contents;if(f&&!t.encodeBase64)return o(this,r);var y="data:"+a+","+(v=f?t.encodeBase64(v):encodeURIComponent(v))+d;return y.length>=32768&&!1!==this.context.ieCompat?(s.warn("Skipped data-uri embedding of "+l+" because its size ("+y.length+" characters) exceeds IE8-safe 32768 characters!"),o(this,r||e)):new i(new n('"'+y+'"',y,!1,this.index,this.currentFileInfo),this.index,this.currentFileInfo)})}},{"../logger":32,"../tree/quoted":72,"../tree/url":79,"./function-registry":21}],19:[function(e,t,n){var i=e("../tree/keyword"),r={eval:function(){var e=this.value_,t=this.error_;if(t)throw t;if(null!=e)return e?i.True:i.False},value:function(e){this.value_=e},error:function(e){this.error_=e},reset:function(){this.value_=this.error_=null}};e("./function-registry").add("default",r.eval.bind(r)),t.exports=r},{"../tree/keyword":64,"./function-registry":21}],20:[function(e,t,n){var i=e("../tree/expression"),r=function(e,t,n,i){this.name=e.toLowerCase(),this.index=n,this.context=t,this.currentFileInfo=i,this.func=t.frames[0].functionRegistry.get(this.name)};r.prototype.isValid=function(){return Boolean(this.func)},r.prototype.call=function(e){return Array.isArray(e)&&(e=e.filter(function(e){return"Comment"!==e.type}).map(function(e){if("Expression"===e.type){var t=e.value.filter(function(e){return"Comment"!==e.type});return 1===t.length?t[0]:new i(t)}return e})),this.func.apply(this,e)},t.exports=r},{"../tree/expression":58}],21:[function(e,t,n){function i(e){return{_data:{},add:function(e,t){e=e.toLowerCase(),this._data.hasOwnProperty(e),this._data[e]=t},addMultiple:function(e){Object.keys(e).forEach(function(t){this.add(t,e[t])}.bind(this))},get:function(t){return this._data[t]||e&&e.get(t)},inherit:function(){return i(this)}}}t.exports=i(null)},{}],22:[function(e,t,n){t.exports=function(t){var n={functionRegistry:e("./function-registry"),functionCaller:e("./function-caller")};return e("./default"),e("./color"),e("./color-blending"),e("./data-uri")(t),e("./math"),e("./number"),e("./string"),e("./svg")(t),e("./types"),n}},{"./color":17,"./color-blending":16,"./data-uri":18,"./default":19,"./function-caller":20,"./function-registry":21,"./math":24,"./number":25,"./string":26,"./svg":27,"./types":28}],23:[function(e,t,n){var i=e("../tree/dimension"),r=function(){};r._math=function(e,t,n){if(!(n instanceof i))throw{type:"Argument",message:"argument must be a number"};return null==t?t=n.unit:n=n.unify(),new i(e(parseFloat(n.value)),t)},t.exports=r},{"../tree/dimension":55}],24:[function(e,t,n){var i=e("./function-registry"),r=e("./math-helper.js"),o={ceil:null,floor:null,sqrt:null,abs:null,tan:"",sin:"",cos:"",atan:"rad",asin:"rad",acos:"rad"};for(var s in o)o.hasOwnProperty(s)&&(o[s]=r._math.bind(null,Math[s],o[s]));o.round=function(e,t){var n=void 0===t?0:t.value;return r._math(function(e){return e.toFixed(n)},null,e)},i.addMultiple(o)},{"./function-registry":21,"./math-helper.js":23}],25:[function(e,t,n){var i=e("../tree/dimension"),r=e("../tree/anonymous"),o=e("./function-registry"),s=e("./math-helper.js"),a=function(e,t){switch((t=Array.prototype.slice.call(t)).length){case 0:throw{type:"Argument",message:"one or more arguments required"}}var n,o,s,a,l,c,u,h,d=[],p={};for(n=0;n<t.length;n++)if((s=t[n])instanceof i)if(a=""===s.unit.toString()&&void 0!==h?new i(s.value,h).unify():s.unify(),c=""===a.unit.toString()&&void 0!==u?u:a.unit.toString(),u=""!==c&&void 0===u||""!==c&&""===d[0].unify().unit.toString()?c:u,h=""!==c&&void 0===h?s.unit.toString():h,void 0!==(o=void 0!==p[""]&&""!==c&&c===u?p[""]:p[c]))l=""===d[o].unit.toString()&&void 0!==h?new i(d[o].value,h).unify():d[o].unify(),(e&&a.value<l.value||!e&&a.value>l.value)&&(d[o]=s);else{if(void 0!==u&&c!==u)throw{type:"Argument",message:"incompatible types"};p[c]=d.length,d.push(s)}else Array.isArray(t[n].value)&&Array.prototype.push.apply(t,Array.prototype.slice.call(t[n].value));return 1==d.length?d[0]:(t=d.map(function(e){return e.toCSS(this.context)}).join(this.context.compress?",":", "),new r((e?"min":"max")+"("+t+")"))};o.addMultiple({min:function(){return a(!0,arguments)},max:function(){return a(!1,arguments)},convert:function(e,t){return e.convertTo(t.value)},pi:function(){return new i(Math.PI)},mod:function(e,t){return new i(e.value%t.value,e.unit)},pow:function(e,t){if("number"==typeof e&&"number"==typeof t)e=new i(e),t=new i(t);else if(!(e instanceof i&&t instanceof i))throw{type:"Argument",message:"arguments must be numbers"};return new i(Math.pow(e.value,t.value),e.unit)},percentage:function(e){return s._math(function(e){return 100*e},"%",e)}})},{"../tree/anonymous":45,"../tree/dimension":55,"./function-registry":21,"./math-helper.js":23}],26:[function(e,t,n){var i=e("../tree/quoted"),r=e("../tree/anonymous"),o=e("../tree/javascript");e("./function-registry").addMultiple({e:function(e){return new r(e instanceof o?e.evaluated:e.value)},escape:function(e){return new r(encodeURI(e.value).replace(/=/g,"%3D").replace(/:/g,"%3A").replace(/#/g,"%23").replace(/;/g,"%3B").replace(/\(/g,"%28").replace(/\)/g,"%29"))},replace:function(e,t,n,r){var o=e.value;return n="Quoted"===n.type?n.value:n.toCSS(),o=o.replace(new RegExp(t.value,r?r.value:""),n),new i(e.quote||"",o,e.escaped)},"%":function(e){for(var t=Array.prototype.slice.call(arguments,1),n=e.value,r=0;r<t.length;r++)n=n.replace(/%[sda]/i,function(e){var n="Quoted"===t[r].type&&e.match(/s/i)?t[r].value:t[r].toCSS();return e.match(/[A-Z]$/)?encodeURIComponent(n):n});return n=n.replace(/%%/g,"%"),new i(e.quote||"",n,e.escaped)}})},{"../tree/anonymous":45,"../tree/javascript":62,"../tree/quoted":72,"./function-registry":21}],27:[function(e,t,n){t.exports=function(t){var n=e("../tree/dimension"),i=e("../tree/color"),r=e("../tree/expression"),o=e("../tree/quoted"),s=e("../tree/url");e("./function-registry").add("svg-gradient",function(e){function t(){throw{type:"Argument",message:"svg-gradient expects direction, start_color [start_position], [color position,]..., end_color [end_position] or direction, color list"}}var a,l,c,u,h,d,p,f,m="linear",g='x="0" y="0" width="1" height="1"',v={compress:!1},y=e.toCSS(v);switch(2==arguments.length?(arguments[1].value.length<2&&t(),a=arguments[1].value):arguments.length<3?t():a=Array.prototype.slice.call(arguments,1),y){case"to bottom":l='x1="0%" y1="0%" x2="0%" y2="100%"';break;case"to right":l='x1="0%" y1="0%" x2="100%" y2="0%"';break;case"to bottom right":l='x1="0%" y1="0%" x2="100%" y2="100%"';break;case"to top right":l='x1="0%" y1="100%" x2="100%" y2="0%"';break;case"ellipse":case"ellipse at center":m="radial",l='cx="50%" cy="50%" r="75%"',g='x="-50" y="-50" width="101" height="101"';break;default:throw{type:"Argument",message:"svg-gradient direction must be 'to bottom', 'to right', 'to bottom right', 'to top right' or 'ellipse at center'"}}for(c='<?xml version="1.0" ?><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="100%" height="100%" viewBox="0 0 1 1" preserveAspectRatio="none"><'+m+'Gradient id="gradient" gradientUnits="userSpaceOnUse" '+l+">",u=0;u<a.length;u+=1)a[u]instanceof r?(h=a[u].value[0],d=a[u].value[1]):(h=a[u],d=void 0),h instanceof i&&((0===u||u+1===a.length)&&void 0===d||d instanceof n)||t(),p=d?d.toCSS(v):0===u?"0%":"100%",f=h.alpha,c+='<stop offset="'+p+'" stop-color="'+h.toRGB()+'"'+(f<1?' stop-opacity="'+f+'"':"")+"/>";return c+="</"+m+"Gradient><rect "+g+' fill="url(#gradient)" /></svg>',c=encodeURIComponent(c),c="data:image/svg+xml,"+c,new s(new o("'"+c+"'",c,!1,this.index,this.currentFileInfo),this.index,this.currentFileInfo)})}},{"../tree/color":49,"../tree/dimension":55,"../tree/expression":58,"../tree/quoted":72,"../tree/url":79,"./function-registry":21}],28:[function(e,t,n){var i=e("../tree/keyword"),r=e("../tree/detached-ruleset"),o=e("../tree/dimension"),s=e("../tree/color"),a=e("../tree/quoted"),l=e("../tree/anonymous"),c=e("../tree/url"),u=e("../tree/operation"),h=function(e,t){return e instanceof t?i.True:i.False},d=function(e,t){if(void 0===t)throw{type:"Argument",message:"missing the required second argument to isunit."};if("string"!=typeof(t="string"==typeof t.value?t.value:t))throw{type:"Argument",message:"Second argument to isunit should be a unit or a string."};return e instanceof o&&e.unit.is(t)?i.True:i.False},p=function(e){return Array.isArray(e.value)?e.value:Array(e)};e("./function-registry").addMultiple({isruleset:function(e){return h(e,r)},iscolor:function(e){return h(e,s)},isnumber:function(e){return h(e,o)},isstring:function(e){return h(e,a)},iskeyword:function(e){return h(e,i)},isurl:function(e){return h(e,c)},ispixel:function(e){return d(e,"px")},ispercentage:function(e){return d(e,"%")},isem:function(e){return d(e,"em")},isunit:d,unit:function(e,t){if(!(e instanceof o))throw{type:"Argument",message:"the first argument to unit must be a number"+(e instanceof u?". Have you forgotten parenthesis?":"")};return t=t?t instanceof i?t.value:t.toCSS():"",new o(e.value,t)},"get-unit":function(e){return new l(e.unit)},extract:function(e,t){return t=t.value-1,p(e)[t]},length:function(e){return new o(p(e).length)}})},{"../tree/anonymous":45,"../tree/color":49,"../tree/detached-ruleset":54,"../tree/dimension":55,"../tree/keyword":64,"../tree/operation":70,"../tree/quoted":72,"../tree/url":79,"./function-registry":21}],29:[function(e,t,n){var i=e("./contexts"),r=e("./parser/parser"),o=e("./plugins/function-importer");t.exports=function(e){var t=function(e,t){this.rootFilename=t.filename,this.paths=e.paths||[],this.contents={},this.contentsIgnoredChars={},this.mime=e.mime,this.error=null,this.context=e,this.queue=[],this.files={}};return t.prototype.push=function(t,n,s,a,l){var c=this;this.queue.push(t);var u=function(e,n,i){c.queue.splice(c.queue.indexOf(t),1);var r=i===c.rootFilename;a.optional&&e?l(null,{rules:[]},!1,null):(c.files[i]=n,e&&!c.error&&(c.error=e),l(e,n,r,i))},h={relativeUrls:this.context.relativeUrls,entryPath:s.entryPath,rootpath:s.rootpath,rootFilename:s.rootFilename},d=e.getFileManager(t,s.currentDirectory,this.context,e);if(d){n&&(t=d.tryAppendExtension(t,a.plugin?".js":".less"));var p=function(e){var t=e.filename,n=e.contents.replace(/^\uFEFF/,"");h.currentDirectory=d.getPath(t),h.relativeUrls&&(h.rootpath=d.join(c.context.rootpath||"",d.pathDiff(h.currentDirectory,h.entryPath)),!d.isPathAbsolute(h.rootpath)&&d.alwaysMakePathsAbsolute()&&(h.rootpath=d.join(h.entryPath,h.rootpath))),h.filename=t;var l=new i.Parse(c.context);l.processImports=!1,c.contents[t]=n,(s.reference||a.reference)&&(h.reference=!0),a.plugin?new o(l,h).eval(n,function(e,n){u(e,n,t)}):a.inline?u(null,n,t):new r(l,c,h).parse(n,function(e,n){u(e,n,t)})},f=d.loadFile(t,s.currentDirectory,this.context,e,function(e,t){e?u(e):p(t)});f&&f.then(p,u)}else u({message:"Could not find a file-manager for "+t})},t}},{"./contexts":10,"./parser/parser":37,"./plugins/function-importer":39}],30:[function(e,t,n){t.exports=function(t,n){var i,r,o,s,a;return{version:[2,5,3],data:e("./data"),tree:e("./tree"),Environment:a=e("./environment/environment"),AbstractFileManager:e("./environment/abstract-file-manager"),environment:t=new a(t,n),visitors:e("./visitors"),Parser:e("./parser/parser"),functions:e("./functions")(t),contexts:e("./contexts"),SourceMapOutput:i=e("./source-map-output")(t),SourceMapBuilder:r=e("./source-map-builder")(i,t),ParseTree:o=e("./parse-tree")(r),ImportManager:s=e("./import-manager")(t),render:e("./render")(t,o,s),parse:e("./parse")(t,o,s),LessError:e("./less-error"),transformTree:e("./transform-tree"),utils:e("./utils"),PluginManager:e("./plugin-manager"),logger:e("./logger")}}},{"./contexts":10,"./data":12,"./environment/abstract-file-manager":14,"./environment/environment":15,"./functions":22,"./import-manager":29,"./less-error":31,"./logger":32,"./parse":34,"./parse-tree":33,"./parser/parser":37,"./plugin-manager":38,"./render":40,"./source-map-builder":41,"./source-map-output":42,"./transform-tree":43,"./tree":61,"./utils":82,"./visitors":86}],31:[function(e,t,n){var i=e("./utils"),r=t.exports=function(e,t,n){Error.call(this);var r=e.filename||n;if(t&&r){var o=t.contents[r],s=i.getLocation(e.index,o),a=s.line,l=s.column,c=e.call&&i.getLocation(e.call,o).line,u=o.split("\n");this.type=e.type||"Syntax",this.filename=r,this.index=e.index,this.line="number"==typeof a?a+1:null,this.callLine=c+1,this.callExtract=u[c],this.column=l,this.extract=[u[a-1],u[a],u[a+1]]}this.message=e.message,this.stack=e.stack};if(void 0===Object.create){var o=function(){};o.prototype=Error.prototype,r.prototype=new o}else r.prototype=Object.create(Error.prototype);r.prototype.constructor=r},{"./utils":82}],32:[function(e,t,n){t.exports={error:function(e){this._fireEvent("error",e)},warn:function(e){this._fireEvent("warn",e)},info:function(e){this._fireEvent("info",e)},debug:function(e){this._fireEvent("debug",e)},addListener:function(e){this._listeners.push(e)},removeListener:function(e){for(var t=0;t<this._listeners.length;t++)if(this._listeners[t]===e)return void this._listeners.splice(t,1)},_fireEvent:function(e,t){for(var n=0;n<this._listeners.length;n++){var i=this._listeners[n][e];i&&i(t)}},_listeners:[]}},{}],33:[function(e,t,n){var i=e("./less-error"),r=e("./transform-tree"),o=e("./logger");t.exports=function(e){var t=function(e,t){this.root=e,this.imports=t};return t.prototype.toCSS=function(t){var n,s,a={};try{n=r(this.root,t)}catch(e){throw new i(e,this.imports)}try{var l=Boolean(t.compress);l&&o.warn("The compress option has been deprecated. We recommend you use a dedicated css minifier, for instance see less-plugin-clean-css.");var c={compress:l,dumpLineNumbers:t.dumpLineNumbers,strictUnits:Boolean(t.strictUnits),numPrecision:8};t.sourceMap?(s=new e(t.sourceMap),a.css=s.toCSS(n,c,this.imports)):a.css=n.toCSS(c)}catch(e){throw new i(e,this.imports)}if(t.pluginManager)for(var u=t.pluginManager.getPostProcessors(),h=0;h<u.length;h++)a.css=u[h].process(a.css,{sourceMap:s,options:t,imports:this.imports});t.sourceMap&&(a.map=s.getExternalSourceMap()),a.imports=[];for(var d in this.imports.files)this.imports.files.hasOwnProperty(d)&&d!==this.imports.rootFilename&&a.imports.push(d);return a},t}},{"./less-error":31,"./logger":32,"./transform-tree":43}],34:[function(e,t,n){var i,r=e("./contexts"),o=e("./parser/parser"),s=e("./plugin-manager");t.exports=function(t,n,a){var l=function(t,n,c){if("function"==typeof(n=n||{})&&(c=n,n={}),!c){i||(i="undefined"==typeof Promise?e("promise"):Promise);var u=this;return new i(function(e,i){l.call(u,t,n,function(t,n){t?i(t):e(n)})})}var h,d,p=new s(this);if(p.addPlugins(n.plugins),n.pluginManager=p,h=new r.Parse(n),n.rootFileInfo)d=n.rootFileInfo;else{var f=n.filename||"input",m=f.replace(/[^\/\\]*$/,"");(d={filename:f,relativeUrls:h.relativeUrls,rootpath:h.rootpath||"",currentDirectory:m,entryPath:m,rootFilename:f}).rootpath&&"/"!==d.rootpath.slice(-1)&&(d.rootpath+="/")}var g=new a(h,d);new o(h,g,d).parse(t,function(e,t){if(e)return c(e);c(null,t,g,n)},n)};return l}},{"./contexts":10,"./parser/parser":37,"./plugin-manager":38,promise:void 0}],35:[function(e,t,n){t.exports=function(e,t){function n(t){var n=a-g;n<512&&!t||!n||(m.push(e.slice(g,a+1)),g=a+1)}var i,r,o,s,a,l,c,u,h,d=e.length,p=0,f=0,m=[],g=0;for(a=0;a<d;a++)if(!((c=e.charCodeAt(a))>=97&&c<=122||c<34))switch(c){case 40:f++,r=a;continue;case 41:if(--f<0)return t("missing opening `(`",a);continue;case 59:f||n();continue;case 123:p++,i=a;continue;case 125:if(--p<0)return t("missing opening `{`",a);p||f||n();continue;case 92:if(a<d-1){a++;continue}return t("unescaped `\\`",a);case 34:case 39:case 96:for(h=0,l=a,a+=1;a<d;a++)if(!((u=e.charCodeAt(a))>96)){if(u==c){h=1;break}if(92==u){if(a==d-1)return t("unescaped `\\`",a);a++}}if(h)continue;return t("unmatched `"+String.fromCharCode(c)+"`",l);case 47:if(f||a==d-1)continue;if(47==(u=e.charCodeAt(a+1)))for(a+=2;a<d&&(!((u=e.charCodeAt(a))<=13)||10!=u&&13!=u);a++);else if(42==u){for(o=l=a,a+=2;a<d-1&&(125==(u=e.charCodeAt(a))&&(s=a),42!=u||47!=e.charCodeAt(a+1));a++);if(a==d-1)return t("missing closing `*/`",l);a++}continue;case 42:if(a<d-1&&47==e.charCodeAt(a+1))return t("unmatched `/*`",a);continue}return 0!==p?o>i&&s>o?t("missing closing `}` or `*/`",i):t("missing closing `}`",i):0!==f?t("missing closing `)`",r):(n(!0),m)}},{}],36:[function(e,t,n){var i=e("./chunker");t.exports=function(){var e,t,n,r,o,s,a,l=[],c={};c.save=function(){a=c.i,l.push({current:s,i:c.i,j:t})},c.restore=function(e){(c.i>n||c.i===n&&e&&!r)&&(n=c.i,r=e);var i=l.pop();s=i.current,a=c.i=i.i,t=i.j},c.forget=function(){l.pop()},c.isWhitespace=function(t){var n=c.i+(t||0),i=e.charCodeAt(n);return i===u||i===p||i===h||i===d},c.$re=function(e){c.i>a&&(s=s.slice(c.i-a),a=c.i);var t=e.exec(s);return t?(f(t[0].length),"string"==typeof t?t:1===t.length?t[0]:t):null},c.$char=function(t){return e.charAt(c.i)!==t?null:(f(1),t)},c.$str=function(t){for(var n=t.length,i=0;i<n;i++)if(e.charAt(c.i+i)!==t.charAt(i))return null;return f(n),t},c.$quoted=function(){var t=e.charAt(c.i);if("'"===t||'"'===t){for(var n=e.length,i=c.i,r=1;r+i<n;r++)switch(e.charAt(r+i)){case"\\":r++;continue;case"\r":case"\n":break;case t:var o=e.substr(i,r+1);return f(r+1),o}return null}};var u=32,h=9,d=10,p=13;c.autoCommentAbsorb=!0,c.commentStore=[],c.finished=!1;var f=function(n){for(var i,r,l,m=c.i,g=t,v=c.i-a,y=c.i+s.length-v,b=c.i+=n,x=e;c.i<y;c.i++){if(i=x.charCodeAt(c.i),c.autoCommentAbsorb&&47===i){if("/"===(r=x.charAt(c.i+1))){l={index:c.i,isLineComment:!0};var q=x.indexOf("\n",c.i+2);q<0&&(q=y),c.i=q,l.text=x.substr(l.i,c.i-l.i),c.commentStore.push(l);continue}if("*"===r){var C=x.indexOf("*/",c.i+2);if(C>=0){l={index:c.i,text:x.substr(c.i,C+2-c.i),isLineComment:!1},c.i+=l.text.length-1,c.commentStore.push(l);continue}}break}if(i!==u&&i!==d&&i!==h&&i!==p)break}if(s=s.slice(n+c.i-b+v),a=c.i,!s.length){if(t<o.length-1)return s=o[++t],f(0),!0;c.finished=!0}return m!==c.i||g!==t};return c.peek=function(t){if("string"==typeof t){for(var n=0;n<t.length;n++)if(e.charAt(c.i+n)!==t.charAt(n))return!1;return!0}return t.test(s)},c.peekChar=function(t){return e.charAt(c.i)===t},c.currentChar=function(){return e.charAt(c.i)},c.getInput=function(){return e},c.peekNotNumeric=function(){var t=e.charCodeAt(c.i);return t>57||t<43||47===t||44===t},c.start=function(r,l,u){e=r,c.i=t=a=n=0,o=l?i(r,u):[r],s=o[0],f(0)},c.end=function(){var t,i=c.i>=e.length;return c.i<n&&(t=r,c.i=n),{isFinished:i,furthest:c.i,furthestPossibleErrorMessage:t,furthestReachedEnd:c.i>=e.length-1,furthestChar:e[c.i]}},c}},{"./chunker":35}],37:[function(e,t,n){var i=e("../less-error"),r=e("../tree"),o=e("../visitors"),s=e("./parser-input"),a=e("../utils"),l=function e(t,n,l){function c(e,t,n){var i="[object Function]"===Object.prototype.toString.call(e)?e.call(p):f.$re(e);if(i)return i;h(t||("string"==typeof e?"expected '"+e+"' got '"+f.currentChar()+"'":"unexpected token"))}function u(e,t){if(f.$char(e))return e;h(t||"expected '"+e+"' got '"+f.currentChar()+"'")}function h(e,t){throw new i({index:f.i,filename:l.filename,type:t||"Syntax",message:e},n)}function d(e){var t=l.filename;return{lineNumber:a.getLocation(e,f.getInput()).line+1,fileName:t}}var p,f=s();return{parse:function(s,a,c){var u,h,d,p,m=null,g="";if(h=c&&c.globalVars?e.serializeVars(c.globalVars)+"\n":"",d=c&&c.modifyVars?"\n"+e.serializeVars(c.modifyVars):"",t.pluginManager)for(var v=t.pluginManager.getPreProcessors(),y=0;y<v.length;y++)s=v[y].process(s,{context:t,imports:n,fileInfo:l});(h||c&&c.banner)&&(g=(c&&c.banner?c.banner:"")+h,(p=n.contentsIgnoredChars)[l.filename]=p[l.filename]||0,p[l.filename]+=g.length),s=g+(s=s.replace(/\r\n?/g,"\n")).replace(/^\uFEFF/,"")+d,n.contents[l.filename]=s;try{f.start(s,t.chunkInput,function(e,t){throw new i({index:t,type:"Parse",message:e,filename:l.filename},n)}),(u=new r.Ruleset(null,this.parsers.primary())).root=!0,u.firstRoot=!0}catch(e){return a(new i(e,n,l.filename))}var b=f.end();if(!b.isFinished){var x=b.furthestPossibleErrorMessage;x||(x="Unrecognised input","}"===b.furthestChar?x+=". Possibly missing opening '{'":")"===b.furthestChar?x+=". Possibly missing opening '('":b.furthestReachedEnd&&(x+=". Possibly missing something")),m=new i({type:"Parse",message:x,index:b.furthest,filename:l.filename},n)}var q=function(e){return(e=m||e||n.error)?(e instanceof i||(e=new i(e,n,l.filename)),a(e)):a(null,u)};if(!1===t.processImports)return q();new o.ImportVisitor(n,q).run(u)},parsers:p={primary:function(){for(var e,t=this.mixin,n=[];;){for(;;){if(!(e=this.comment()))break;n.push(e)}if(f.finished)break;if(f.peek("}"))break;if(e=this.extendRule())n=n.concat(e);else if(e=t.definition()||this.rule()||this.ruleset()||t.call()||this.rulesetCall()||this.directive())n.push(e);else{for(var i=!1;f.$char(";");)i=!0;if(!i)break}}return n},comment:function(){if(f.commentStore.length){var e=f.commentStore.shift();return new r.Comment(e.text,e.isLineComment,e.index,l)}},entities:{quoted:function(){var e,t=f.i,n=!1;if(f.save(),f.$char("~")&&(n=!0),e=f.$quoted())return f.forget(),new r.Quoted(e.charAt(0),e.substr(1,e.length-2),n,t,l);f.restore()},keyword:function(){var e=f.$char("%")||f.$re(/^[_A-Za-z-][_A-Za-z0-9-]*/);if(e)return r.Color.fromKeyword(e)||new r.Keyword(e)},call:function(){var e,t,n,i=f.i;if(!f.peek(/^url\(/i))if(f.save(),e=f.$re(/^([\w-]+|%|progid:[\w\.]+)\(/)){if(e=e[1],"alpha"===e.toLowerCase()&&(n=p.alpha()))return f.forget(),n;if(t=this.arguments(),f.$char(")"))return f.forget(),new r.Call(e,t,i,l);f.restore("Could not parse call arguments or missing ')'")}else f.forget()},arguments:function(){for(var e,t=[];;){if(!(e=this.assignment()||p.expression()))break;if(t.push(e),!f.$char(","))break}return t},literal:function(){return this.dimension()||this.color()||this.quoted()||this.unicodeDescriptor()},assignment:function(){var e,t;if(f.save(),e=f.$re(/^\w+(?=\s?=)/i))if(f.$char("=")){if(t=p.entity())return f.forget(),new r.Assignment(e,t);f.restore()}else f.restore();else f.restore()},url:function(){var e,t=f.i;f.autoCommentAbsorb=!1;{if(f.$str("url("))return e=this.quoted()||this.variable()||f.$re(/^(?:(?:\\[\(\)'"])|[^\(\)'"])+/)||"",f.autoCommentAbsorb=!0,u(")"),new r.URL(null!=e.value||e instanceof r.Variable?e:new r.Anonymous(e),t,l);f.autoCommentAbsorb=!0}},variable:function(){var e,t=f.i;if("@"===f.currentChar()&&(e=f.$re(/^@@?[\w-]+/)))return new r.Variable(e,t,l)},variableCurly:function(){var e,t=f.i;if("@"===f.currentChar()&&(e=f.$re(/^@\{([\w-]+)\}/)))return new r.Variable("@"+e[1],t,l)},color:function(){var e;if("#"===f.currentChar()&&(e=f.$re(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})/))){var t=e.input.match(/^#([\w]+).*/);return(t=t[1]).match(/^[A-Fa-f0-9]+$/)||h("Invalid HEX color code"),new r.Color(e[1],void 0,"#"+t)}},dimension:function(){if(!f.peekNotNumeric()){var e=f.$re(/^([+-]?\d*\.?\d+)(%|[a-z]+)?/i);return e?new r.Dimension(e[1],e[2]):void 0}},unicodeDescriptor:function(){var e;if(e=f.$re(/^U\+[0-9a-fA-F?]+(\-[0-9a-fA-F?]+)?/))return new r.UnicodeDescriptor(e[0])},javascript:function(){var e,t=f.i;f.save();var n=f.$char("~");if(f.$char("`")){if(e=f.$re(/^[^`]*`/))return f.forget(),new r.JavaScript(e.substr(0,e.length-1),Boolean(n),t,l);f.restore("invalid javascript definition")}else f.restore()}},variable:function(){var e;if("@"===f.currentChar()&&(e=f.$re(/^(@[\w-]+)\s*:/)))return e[1]},rulesetCall:function(){var e;if("@"===f.currentChar()&&(e=f.$re(/^(@[\w-]+)\s*\(\s*\)\s*;/)))return new r.RulesetCall(e[1])},extend:function(e){var t,n,i,o,s,a=f.i;if(f.$str(e?"&:extend(":":extend(")){do{for(i=null,t=null;!(i=f.$re(/^(all)(?=\s*(\)|,))/))&&(n=this.element());)t?t.push(n):t=[n];i=i&&i[1],t||h("Missing target selector for :extend()."),s=new r.Extend(new r.Selector(t),i,a),o?o.push(s):o=[s]}while(f.$char(","));return c(/^\)/),e&&c(/^;/),o}},extendRule:function(){return this.extend(!0)},mixin:{call:function(){var e,t,n,i,o,s,a=f.currentChar(),c=!1,h=f.i;if("."===a||"#"===a){for(f.save();;){if(e=f.i,!(i=f.$re(/^[#.](?:[\w-]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+/)))break;n=new r.Element(o,i,e,l),t?t.push(n):t=[n],o=f.$char(">")}if(t&&(f.$char("(")&&(s=this.args(!0).args,u(")")),p.important()&&(c=!0),p.end()))return f.forget(),new r.mixin.Call(t,s,h,l,c);f.restore()}},args:function(e){var t,n,i,o,s,a,l,c=p.entities,u={args:null,variadic:!1},d=[],m=[],g=[];for(f.save();;){if(e)a=p.detachedRuleset()||p.expression();else{if(f.commentStore.length=0,f.$str("...")){u.variadic=!0,f.$char(";")&&!t&&(t=!0),(t?m:g).push({variadic:!0});break}a=c.variable()||c.literal()||c.keyword()}if(!a)break;o=null,a.throwAwayComments&&a.throwAwayComments(),s=a;var v=null;if(e?a.value&&1==a.value.length&&(v=a.value[0]):v=a,v&&v instanceof r.Variable)if(f.$char(":")){if(d.length>0&&(t&&h("Cannot mix ; and , as delimiter types"),n=!0),!(s=p.detachedRuleset()||p.expression())){if(!e)return f.restore(),u.args=[],u;h("could not understand value for named argument")}o=i=v.name}else if(f.$str("...")){if(!e){u.variadic=!0,f.$char(";")&&!t&&(t=!0),(t?m:g).push({name:a.name,variadic:!0});break}l=!0}else e||(i=o=v.name,s=null);s&&d.push(s),g.push({name:o,value:s,expand:l}),f.$char(",")||(f.$char(";")||t)&&(n&&h("Cannot mix ; and , as delimiter types"),t=!0,d.length>1&&(s=new r.Value(d)),m.push({name:i,value:s,expand:l}),i=null,d=[],n=!1)}return f.forget(),u.args=t?m:g,u},definition:function(){var e,t,n,i,o=[],s=!1;if(!("."!==f.currentChar()&&"#"!==f.currentChar()||f.peek(/^[^{]*\}/)))if(f.save(),t=f.$re(/^([#.](?:[\w-]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+)\s*\(/)){e=t[1];var a=this.args(!1);if(o=a.args,s=a.variadic,!f.$char(")"))return void f.restore("Missing closing ')'");if(f.commentStore.length=0,f.$str("when")&&(i=c(p.conditions,"expected condition")),n=p.block())return f.forget(),new r.mixin.Definition(e,o,n,i,s);f.restore()}else f.forget()}},entity:function(){var e=this.entities;return this.comment()||e.literal()||e.variable()||e.url()||e.call()||e.keyword()||e.javascript()},end:function(){return f.$char(";")||f.peek("}")},alpha:function(){var e;if(f.$re(/^opacity=/i))return(e=f.$re(/^\d+/))||(e=c(this.entities.variable,"Could not parse alpha")),u(")"),new r.Alpha(e)},element:function(){var e,t,n,i=f.i;if(t=this.combinator(),(e=f.$re(/^(?:\d+\.\d+|\d+)%/)||f.$re(/^(?:[.#]?|:*)(?:[\w-]|[^\x00-\x9f]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+/)||f.$char("*")||f.$char("&")||this.attribute()||f.$re(/^\([^&()@]+\)/)||f.$re(/^[\.#:](?=@)/)||this.entities.variableCurly())||(f.save(),f.$char("(")?(n=this.selector())&&f.$char(")")?(e=new r.Paren(n),f.forget()):f.restore("Missing closing ')'"):f.forget()),e)return new r.Element(t,e,i,l)},combinator:function(){var e=f.currentChar();if("/"===e){f.save();var t=f.$re(/^\/[a-z]+\//i);if(t)return f.forget(),new r.Combinator(t);f.restore()}if(">"===e||"+"===e||"~"===e||"|"===e||"^"===e){for(f.i++,"^"===e&&"^"===f.currentChar()&&(e="^^",f.i++);f.isWhitespace();)f.i++;return new r.Combinator(e)}return f.isWhitespace(-1)?new r.Combinator(" "):new r.Combinator(null)},lessSelector:function(){return this.selector(!0)},selector:function(e){for(var t,n,i,o,s,a,u,d=f.i;(e&&(n=this.extend())||e&&(a=f.$str("when"))||(o=this.element()))&&(a?u=c(this.conditions,"expected condition"):u?h("CSS guard can only be used at the end of selector"):n?s=s?s.concat(n):n:(s&&h("Extend can only be used at the end of selector"),i=f.currentChar(),t?t.push(o):t=[o],o=null),"{"!==i&&"}"!==i&&";"!==i&&","!==i&&")"!==i););if(t)return new r.Selector(t,s,u,d,l);s&&h("Extend must be used to extend a selector, it cannot be used on its own")},attribute:function(){if(f.$char("[")){var e,t,n,i=this.entities;return(e=i.variableCurly())||(e=c(/^(?:[_A-Za-z0-9-\*]*\|)?(?:[_A-Za-z0-9-]|\\.)+/)),(n=f.$re(/^[|~*$^]?=/))&&(t=i.quoted()||f.$re(/^[0-9]+%/)||f.$re(/^[\w-]+/)||i.variableCurly()),u("]"),new r.Attribute(e,n,t)}},block:function(){var e;if(f.$char("{")&&(e=this.primary())&&f.$char("}"))return e},blockRuleset:function(){var e=this.block();return e&&(e=new r.Ruleset(null,e)),e},detachedRuleset:function(){var e=this.blockRuleset();if(e)return new r.DetachedRuleset(e)},ruleset:function(){var e,n,i,o;for(f.save(),t.dumpLineNumbers&&(o=d(f.i));;){if(!(n=this.lessSelector()))break;if(e?e.push(n):e=[n],f.commentStore.length=0,n.condition&&e.length>1&&h("Guards are only currently allowed on a single selector."),!f.$char(","))break;n.condition&&h("Guards are only currently allowed on a single selector."),f.commentStore.length=0}if(e&&(i=this.block())){f.forget();var s=new r.Ruleset(e,i,t.strictImports);return t.dumpLineNumbers&&(s.debugInfo=o),s}f.restore()},rule:function(e){var n,i,o,s,a,c=f.i,u=f.currentChar();if("."!==u&&"#"!==u&&"&"!==u&&":"!==u)if(f.save(),n=this.variable()||this.ruleProperty()){if((a="string"==typeof n)&&(i=this.detachedRuleset()),f.commentStore.length=0,!i){s=!a&&n.length>1&&n.pop().value;var h=!e&&(t.compress||a);if(h&&(i=this.value()),!i&&(i=this.anonymousValue()))return f.forget(),new r.Rule(n,i,!1,s,c,l);h||i||(i=this.value()),o=this.important()}if(i&&this.end())return f.forget(),new r.Rule(n,i,o,s,c,l);if(f.restore(),i&&!e)return this.rule(!0)}else f.forget()},anonymousValue:function(){var e=f.$re(/^([^@+\/'"*`(;{}-]*);/);if(e)return new r.Anonymous(e[1])},import:function(){var e,t,n=f.i,i=f.$re(/^@import?\s+/);if(i){var o=(i?this.importOptions():null)||{};if(e=this.entities.quoted()||this.entities.url())return t=this.mediaFeatures(),f.$char(";")||(f.i=n,h("missing semi-colon or unrecognised media features on import")),t=t&&new r.Value(t),new r.Import(e,t,o,n,l);f.i=n,h("malformed import statement")}},importOptions:function(){var e,t,n,i={};if(!f.$char("("))return null;do{if(e=this.importOption()){switch(t=e,n=!0,t){case"css":t="less",n=!1;break;case"once":t="multiple",n=!1}if(i[t]=n,!f.$char(","))break}}while(e);return u(")"),i},importOption:function(){var e=f.$re(/^(less|css|multiple|once|inline|reference|optional)/);if(e)return e[1]},mediaFeature:function(){var e,t,n=this.entities,i=[];f.save();do{if(e=n.keyword()||n.variable())i.push(e);else if(f.$char("(")){if(t=this.property(),e=this.value(),!f.$char(")"))return f.restore("Missing closing ')'"),null;if(t&&e)i.push(new r.Paren(new r.Rule(t,e,null,null,f.i,l,!0)));else{if(!e)return f.restore("badly formed media feature definition"),null;i.push(new r.Paren(e))}}}while(e);if(f.forget(),i.length>0)return new r.Expression(i)},mediaFeatures:function(){var e,t=this.entities,n=[];do{if(e=this.mediaFeature()){if(n.push(e),!f.$char(","))break}else if((e=t.variable())&&(n.push(e),!f.$char(",")))break}while(e);return n.length>0?n:null},media:function(){var e,n,i,o;if(t.dumpLineNumbers&&(o=d(f.i)),f.save(),f.$str("@media"))return e=this.mediaFeatures(),(n=this.block())?(f.forget(),i=new r.Media(n,e,f.i,l),t.dumpLineNumbers&&(i.debugInfo=o),i):void f.restore("media definitions require block statements after any features");f.restore()},plugin:function(){var e,t=f.i;if(f.$re(/^@plugin?\s+/)){var n={plugin:!0};if(e=this.entities.quoted()||this.entities.url())return f.$char(";")||(f.i=t,h("missing semi-colon on plugin")),new r.Import(e,null,n,t,l);f.i=t,h("malformed plugin statement")}},directive:function(){var e,n,i,o,s,a,c,u=f.i,p=!0,m=!0;if("@"===f.currentChar()){if(n=this.import()||this.plugin()||this.media())return n;if(f.save(),e=f.$re(/^@[a-z-]+/)){switch(o=e,"-"==e.charAt(1)&&e.indexOf("-",2)>0&&(o="@"+e.slice(e.indexOf("-",2)+1)),o){case"@counter-style":s=!0,p=!0;break;case"@charset":s=!0,p=!1;break;case"@namespace":a=!0,p=!1;break;case"@keyframes":s=!0;break;case"@host":case"@page":c=!0;break;case"@document":case"@supports":c=!0,m=!1}if(f.commentStore.length=0,s?(n=this.entity())||h("expected "+e+" identifier"):a?(n=this.expression())||h("expected "+e+" expression"):c&&(n=(f.$re(/^[^{;]+/)||"").trim())&&(n=new r.Anonymous(n)),p&&(i=this.blockRuleset()),i||!p&&n&&f.$char(";"))return f.forget(),new r.Directive(e,n,i,u,l,t.dumpLineNumbers?d(u):null,!1,m);f.restore("directive options not recognised")}}},value:function(){var e,t=[];do{if((e=this.expression())&&(t.push(e),!f.$char(",")))break}while(e);if(t.length>0)return new r.Value(t)},important:function(){if("!"===f.currentChar())return f.$re(/^! *important/)},sub:function(){var e,t;if(f.save(),f.$char("("))return(e=this.addition())&&f.$char(")")?(f.forget(),t=new r.Expression([e]),t.parens=!0,t):void f.restore("Expected ')'");f.restore()},multiplication:function(){var e,t,n,i,o;if(e=this.operand()){for(o=f.isWhitespace(-1);;){if(f.peek(/^\/[*\/]/))break;if(f.save(),!(n=f.$char("/")||f.$char("*"))){f.forget();break}if(!(t=this.operand())){f.restore();break}f.forget(),e.parensInOp=!0,t.parensInOp=!0,i=new r.Operation(n,[i||e,t],o),o=f.isWhitespace(-1)}return i||e}},addition:function(){var e,t,n,i,o;if(e=this.multiplication()){for(o=f.isWhitespace(-1);;){if(!(n=f.$re(/^[-+]\s+/)||!o&&(f.$char("+")||f.$char("-"))))break;if(!(t=this.multiplication()))break;e.parensInOp=!0,t.parensInOp=!0,i=new r.Operation(n,[i||e,t],o),o=f.isWhitespace(-1)}return i||e}},conditions:function(){var e,t,n,i=f.i;if(e=this.condition()){for(;;){if(!f.peek(/^,\s*(not\s*)?\(/)||!f.$char(","))break;if(!(t=this.condition()))break;n=new r.Condition("or",n||e,t,i)}return n||e}},condition:function(){var e,t,n,i,o=this.entities,s=f.i,a=!1;if(f.$str("not")&&(a=!0),u("("),e=this.addition()||o.keyword()||o.quoted())return f.$char(">")?i=f.$char("=")?">=":">":f.$char("<")?i=f.$char("=")?"<=":"<":f.$char("=")&&(i=f.$char(">")?"=>":f.$char("<")?"=<":"="),i?(t=this.addition()||o.keyword()||o.quoted())?n=new r.Condition(i,e,t,s,a):h("expected expression"):n=new r.Condition("=",e,new r.Keyword("true"),s,a),u(")"),f.$str("and")?new r.Condition("and",n,this.condition()):n},operand:function(){var e,t=this.entities;f.peek(/^-[@\(]/)&&(e=f.$char("-"));var n=this.sub()||t.dimension()||t.color()||t.variable()||t.call();return e&&(n.parensInOp=!0,n=new r.Negative(n)),n},expression:function(){var e,t,n=[];do{(e=this.comment())?n.push(e):(e=this.addition()||this.entity())&&(n.push(e),f.peek(/^\/[\/*]/)||(t=f.$char("/"))&&n.push(new r.Anonymous(t)))}while(e);if(n.length>0)return new r.Expression(n)},property:function(){var e=f.$re(/^(\*?-?[_a-zA-Z0-9-]+)\s*:/);if(e)return e[1]},ruleProperty:function(){function e(e){var t=f.i,n=f.$re(e);if(n)return o.push(t),i.push(n[1])}var t,n,i=[],o=[];f.save();var s=f.$re(/^([_a-zA-Z0-9-]+)\s*:/);if(s)return i=[new r.Keyword(s[1])],f.forget(),i;for(e(/^(\*?)/);;)if(!e(/^((?:[\w-]+)|(?:@\{[\w-]+\}))/))break;if(i.length>1&&e(/^((?:\+_|\+)?)\s*:/)){for(f.forget(),""===i[0]&&(i.shift(),o.shift()),n=0;n<i.length;n++)t=i[n],i[n]="@"!==t.charAt(0)?new r.Keyword(t):new r.Variable("@"+t.slice(2,-1),o[n],l);return i}f.restore()}}}};l.serializeVars=function(e){var t="";for(var n in e)if(Object.hasOwnProperty.call(e,n)){var i=e[n];t+=("@"===n[0]?"":"@")+n+": "+i+(";"===String(i).slice(-1)?"":";")}return t},t.exports=l},{"../less-error":31,"../tree":61,"../utils":82,"../visitors":86,"./parser-input":36}],38:[function(e,t,n){var i=function(e){this.less=e,this.visitors=[],this.preProcessors=[],this.postProcessors=[],this.installedPlugins=[],this.fileManagers=[]};i.prototype.addPlugins=function(e){if(e)for(var t=0;t<e.length;t++)this.addPlugin(e[t])},i.prototype.addPlugin=function(e){this.installedPlugins.push(e),e.install(this.less,this)},i.prototype.addVisitor=function(e){this.visitors.push(e)},i.prototype.addPreProcessor=function(e,t){var n;for(n=0;n<this.preProcessors.length&&!(this.preProcessors[n].priority>=t);n++);this.preProcessors.splice(n,0,{preProcessor:e,priority:t})},i.prototype.addPostProcessor=function(e,t){var n;for(n=0;n<this.postProcessors.length&&!(this.postProcessors[n].priority>=t);n++);this.postProcessors.splice(n,0,{postProcessor:e,priority:t})},i.prototype.addFileManager=function(e){this.fileManagers.push(e)},i.prototype.getPreProcessors=function(){for(var e=[],t=0;t<this.preProcessors.length;t++)e.push(this.preProcessors[t].preProcessor);return e},i.prototype.getPostProcessors=function(){for(var e=[],t=0;t<this.postProcessors.length;t++)e.push(this.postProcessors[t].postProcessor);return e},i.prototype.getVisitors=function(){return this.visitors},i.prototype.getFileManagers=function(){return this.fileManagers},t.exports=i},{}],39:[function(e,t,n){var i=e("../less-error"),r=e("../tree");(t.exports=function(e,t){this.fileInfo=t}).prototype.eval=function(e,t){var n,o={};n={add:function(e,t){o[e]=t},addMultiple:function(e){Object.keys(e).forEach(function(t){o[t]=e[t]})}};try{new Function("functions","tree","fileInfo",e)(n,r,this.fileInfo)}catch(e){t(new i({message:"Plugin evaluation error: '"+e.name+": "+e.message.replace(/["]/g,"'")+"'",filename:this.fileInfo.filename}),null)}t(null,{functions:o})}},{"../less-error":31,"../tree":61}],40:[function(e,t,n){var i;t.exports=function(t,n,r){var o=function(t,r,s){if("function"==typeof r&&(s=r,r={}),!s){i||(i="undefined"==typeof Promise?e("promise"):Promise);var a=this;return new i(function(e,n){o.call(a,t,r,function(t,i){t?n(t):e(i)})})}this.parse(t,r,function(e,t,i,r){if(e)return s(e);var o;try{o=new n(t,i).toCSS(r)}catch(e){return s(e)}s(null,o)})};return o}},{promise:void 0}],41:[function(e,t,n){t.exports=function(e,t){var n=function(e){this.options=e};return n.prototype.toCSS=function(t,n,i){var r=new e({contentsIgnoredCharsMap:i.contentsIgnoredChars,rootNode:t,contentsMap:i.contents,sourceMapFilename:this.options.sourceMapFilename,sourceMapURL:this.options.sourceMapURL,outputFilename:this.options.sourceMapOutputFilename,sourceMapBasepath:this.options.sourceMapBasepath,sourceMapRootpath:this.options.sourceMapRootpath,outputSourceFiles:this.options.outputSourceFiles,sourceMapGenerator:this.options.sourceMapGenerator,sourceMapFileInline:this.options.sourceMapFileInline}),o=r.toCSS(n);return this.sourceMap=r.sourceMap,this.sourceMapURL=r.sourceMapURL,this.options.sourceMapInputFilename&&(this.sourceMapInputFilename=r.normalizeFilename(this.options.sourceMapInputFilename)),o+this.getCSSAppendage()},n.prototype.getCSSAppendage=function(){var e=this.sourceMapURL;if(this.options.sourceMapFileInline){if(void 0===this.sourceMap)return"";e="data:application/json;base64,"+t.encodeBase64(this.sourceMap)}return e?"/*# sourceMappingURL="+e+" */":""},n.prototype.getExternalSourceMap=function(){return this.sourceMap},n.prototype.setExternalSourceMap=function(e){this.sourceMap=e},n.prototype.isInline=function(){return this.options.sourceMapFileInline},n.prototype.getSourceMapURL=function(){return this.sourceMapURL},n.prototype.getOutputFilename=function(){return this.options.sourceMapOutputFilename},n.prototype.getInputFilename=function(){return this.sourceMapInputFilename},n}},{}],42:[function(e,t,n){t.exports=function(e){var t=function(t){this._css=[],this._rootNode=t.rootNode,this._contentsMap=t.contentsMap,this._contentsIgnoredCharsMap=t.contentsIgnoredCharsMap,t.sourceMapFilename&&(this._sourceMapFilename=t.sourceMapFilename.replace(/\\/g,"/")),this._outputFilename=t.outputFilename,this.sourceMapURL=t.sourceMapURL,t.sourceMapBasepath&&(this._sourceMapBasepath=t.sourceMapBasepath.replace(/\\/g,"/")),t.sourceMapRootpath?(this._sourceMapRootpath=t.sourceMapRootpath.replace(/\\/g,"/"),"/"!==this._sourceMapRootpath.charAt(this._sourceMapRootpath.length-1)&&(this._sourceMapRootpath+="/")):this._sourceMapRootpath="",this._outputSourceFiles=t.outputSourceFiles,this._sourceMapGeneratorConstructor=e.getSourceMapGenerator(),this._lineNumber=0,this._column=0};return t.prototype.normalizeFilename=function(e){return e=e.replace(/\\/g,"/"),this._sourceMapBasepath&&0===e.indexOf(this._sourceMapBasepath)&&("\\"!==(e=e.substring(this._sourceMapBasepath.length)).charAt(0)&&"/"!==e.charAt(0)||(e=e.substring(1))),(this._sourceMapRootpath||"")+e},t.prototype.add=function(e,t,n,i){if(e){var r,o,s,a,l;if(t){var c=this._contentsMap[t.filename];this._contentsIgnoredCharsMap[t.filename]&&((n-=this._contentsIgnoredCharsMap[t.filename])<0&&(n=0),c=c.slice(this._contentsIgnoredCharsMap[t.filename])),a=(o=(c=c.substring(0,n)).split("\n"))[o.length-1]}if(r=e.split("\n"),s=r[r.length-1],t)if(i)for(l=0;l<r.length;l++)this._sourceMapGenerator.addMapping({generated:{line:this._lineNumber+l+1,column:0===l?this._column:0},original:{line:o.length+l,column:0===l?a.length:0},source:this.normalizeFilename(t.filename)});else this._sourceMapGenerator.addMapping({generated:{line:this._lineNumber+1,column:this._column},original:{line:o.length,column:a.length},source:this.normalizeFilename(t.filename)});1===r.length?this._column+=s.length:(this._lineNumber+=r.length-1,this._column=s.length),this._css.push(e)}},t.prototype.isEmpty=function(){return 0===this._css.length},t.prototype.toCSS=function(e){if(this._sourceMapGenerator=new this._sourceMapGeneratorConstructor({file:this._outputFilename,sourceRoot:null}),this._outputSourceFiles)for(var t in this._contentsMap)if(this._contentsMap.hasOwnProperty(t)){var n=this._contentsMap[t];this._contentsIgnoredCharsMap[t]&&(n=n.slice(this._contentsIgnoredCharsMap[t])),this._sourceMapGenerator.setSourceContent(this.normalizeFilename(t),n)}if(this._rootNode.genCSS(e,this),this._css.length>0){var i,r=JSON.stringify(this._sourceMapGenerator.toJSON());this.sourceMapURL?i=this.sourceMapURL:this._sourceMapFilename&&(i=this._sourceMapFilename),this.sourceMapURL=i,this.sourceMap=r}return this._css.join("")},t}},{}],43:[function(e,t,n){var i=e("./contexts"),r=e("./visitors"),o=e("./tree");t.exports=function(e,t){var n,s=(t=t||{}).variables,a=new i.Eval(t);"object"!=typeof s||Array.isArray(s)||(s=Object.keys(s).map(function(e){var t=s[e];return t instanceof o.Value||(t instanceof o.Expression||(t=new o.Expression([t])),t=new o.Value([t])),new o.Rule("@"+e,t,!1,null,0)}),a.frames=[new o.Ruleset(null,s)]);var l,c=[],u=[new r.JoinSelectorVisitor,new r.ExtendVisitor,new r.ToCSSVisitor({compress:Boolean(t.compress)})];if(t.pluginManager){var h=t.pluginManager.getVisitors();for(l=0;l<h.length;l++){var d=h[l];d.isPreEvalVisitor?c.push(d):d.isPreVisitor?u.splice(0,0,d):u.push(d)}}for(l=0;l<c.length;l++)c[l].run(e);for(n=e.eval(a),l=0;l<u.length;l++)u[l].run(n);return n}},{"./contexts":10,"./tree":61,"./visitors":86}],44:[function(e,t,n){var i=e("./node"),r=function(e){this.value=e};(r.prototype=new i).type="Alpha",r.prototype.accept=function(e){this.value=e.visit(this.value)},r.prototype.eval=function(e){return this.value.eval?new r(this.value.eval(e)):this},r.prototype.genCSS=function(e,t){t.add("alpha(opacity="),this.value.genCSS?this.value.genCSS(e,t):t.add(this.value),t.add(")")},t.exports=r},{"./node":69}],45:[function(e,t,n){var i=e("./node"),r=function(e,t,n,i,r,o){this.value=e,this.index=t,this.mapLines=i,this.currentFileInfo=n,this.rulesetLike=void 0!==r&&r,this.isReferenced=o||!1};(r.prototype=new i).type="Anonymous",r.prototype.eval=function(){return new r(this.value,this.index,this.currentFileInfo,this.mapLines,this.rulesetLike,this.isReferenced)},r.prototype.compare=function(e){return e.toCSS&&this.toCSS()===e.toCSS()?0:void 0},r.prototype.isRulesetLike=function(){return this.rulesetLike},r.prototype.genCSS=function(e,t){t.add(this.value,this.currentFileInfo,this.index,this.mapLines)},r.prototype.markReferenced=function(){this.isReferenced=!0},r.prototype.getIsReferenced=function(){return!this.currentFileInfo||!this.currentFileInfo.reference||this.isReferenced},t.exports=r},{"./node":69}],46:[function(e,t,n){var i=e("./node"),r=function(e,t){this.key=e,this.value=t};(r.prototype=new i).type="Assignment",r.prototype.accept=function(e){this.value=e.visit(this.value)},r.prototype.eval=function(e){return this.value.eval?new r(this.key,this.value.eval(e)):this},r.prototype.genCSS=function(e,t){t.add(this.key+"="),this.value.genCSS?this.value.genCSS(e,t):t.add(this.value)},t.exports=r},{"./node":69}],47:[function(e,t,n){var i=e("./node"),r=function(e,t,n){this.key=e,this.op=t,this.value=n};(r.prototype=new i).type="Attribute",r.prototype.eval=function(e){return new r(this.key.eval?this.key.eval(e):this.key,this.op,this.value&&this.value.eval?this.value.eval(e):this.value)},r.prototype.genCSS=function(e,t){t.add(this.toCSS(e))},r.prototype.toCSS=function(e){var t=this.key.toCSS?this.key.toCSS(e):this.key;return this.op&&(t+=this.op,t+=this.value.toCSS?this.value.toCSS(e):this.value),"["+t+"]"},t.exports=r},{"./node":69}],48:[function(e,t,n){var i=e("./node"),r=e("../functions/function-caller"),o=function(e,t,n,i){this.name=e,this.args=t,this.index=n,this.currentFileInfo=i};(o.prototype=new i).type="Call",o.prototype.accept=function(e){this.args&&(this.args=e.visitArray(this.args))},o.prototype.eval=function(e){var t,n=this.args.map(function(t){return t.eval(e)}),i=new r(this.name,e,this.index,this.currentFileInfo);if(i.isValid())try{if(null!=(t=i.call(n)))return t}catch(e){throw{type:e.type||"Runtime",message:"error evaluating function `"+this.name+"`"+(e.message?": "+e.message:""),index:this.index,filename:this.currentFileInfo.filename}}return new o(this.name,n,this.index,this.currentFileInfo)},o.prototype.genCSS=function(e,t){t.add(this.name+"(",this.currentFileInfo,this.index);for(var n=0;n<this.args.length;n++)this.args[n].genCSS(e,t),n+1<this.args.length&&t.add(", ");t.add(")")},t.exports=o},{"../functions/function-caller":20,"./node":69}],49:[function(e,t,n){function i(e,t){return Math.min(Math.max(e,0),t)}function r(e){return"#"+e.map(function(e){return((e=i(Math.round(e),255))<16?"0":"")+e.toString(16)}).join("")}var o=e("./node"),s=e("../data/colors"),a=function(e,t,n){Array.isArray(e)?this.rgb=e:6==e.length?this.rgb=e.match(/.{2}/g).map(function(e){return parseInt(e,16)}):this.rgb=e.split("").map(function(e){return parseInt(e+e,16)}),this.alpha="number"==typeof t?t:1,void 0!==n&&(this.value=n)};(a.prototype=new o).type="Color",a.prototype.luma=function(){var e=this.rgb[0]/255,t=this.rgb[1]/255,n=this.rgb[2]/255;return e=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4),t=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4),n=n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4),.2126*e+.7152*t+.0722*n},a.prototype.genCSS=function(e,t){t.add(this.toCSS(e))},a.prototype.toCSS=function(e,t){var n,r,o=e&&e.compress&&!t;if(this.value)return this.value;if((r=this.fround(e,this.alpha))<1)return"rgba("+this.rgb.map(function(e){return i(Math.round(e),255)}).concat(i(r,1)).join(","+(o?"":" "))+")";if(n=this.toRGB(),o){var s=n.split("");s[1]===s[2]&&s[3]===s[4]&&s[5]===s[6]&&(n="#"+s[1]+s[3]+s[5])}return n},a.prototype.operate=function(e,t,n){for(var i=[],r=this.alpha*(1-n.alpha)+n.alpha,o=0;o<3;o++)i[o]=this._operate(e,t,this.rgb[o],n.rgb[o]);return new a(i,r)},a.prototype.toRGB=function(){return r(this.rgb)},a.prototype.toHSL=function(){var e,t,n=this.rgb[0]/255,i=this.rgb[1]/255,r=this.rgb[2]/255,o=this.alpha,s=Math.max(n,i,r),a=Math.min(n,i,r),l=(s+a)/2,c=s-a;if(s===a)e=t=0;else{switch(t=l>.5?c/(2-s-a):c/(s+a),s){case n:e=(i-r)/c+(i<r?6:0);break;case i:e=(r-n)/c+2;break;case r:e=(n-i)/c+4}e/=6}return{h:360*e,s:t,l:l,a:o}},a.prototype.toHSV=function(){var e,t,n=this.rgb[0]/255,i=this.rgb[1]/255,r=this.rgb[2]/255,o=this.alpha,s=Math.max(n,i,r),a=Math.min(n,i,r),l=s,c=s-a;if(t=0===s?0:c/s,s===a)e=0;else{switch(s){case n:e=(i-r)/c+(i<r?6:0);break;case i:e=(r-n)/c+2;break;case r:e=(n-i)/c+4}e/=6}return{h:360*e,s:t,v:l,a:o}},a.prototype.toARGB=function(){return r([255*this.alpha].concat(this.rgb))},a.prototype.compare=function(e){return e.rgb&&e.rgb[0]===this.rgb[0]&&e.rgb[1]===this.rgb[1]&&e.rgb[2]===this.rgb[2]&&e.alpha===this.alpha?0:void 0},a.fromKeyword=function(e){var t,n=e.toLowerCase();if(s.hasOwnProperty(n)?t=new a(s[n].slice(1)):"transparent"===n&&(t=new a([0,0,0],0)),t)return t.value=e,t},t.exports=a},{"../data/colors":11,"./node":69}],50:[function(e,t,n){var i=e("./node"),r=function(e){" "===e?(this.value=" ",this.emptyOrWhitespace=!0):(this.value=e?e.trim():"",this.emptyOrWhitespace=""===this.value)};(r.prototype=new i).type="Combinator";var o={"":!0," ":!0,"|":!0};r.prototype.genCSS=function(e,t){var n=e.compress||o[this.value]?"":" ";t.add(n+this.value+n)},t.exports=r},{"./node":69}],51:[function(e,t,n){var i=e("./node"),r=e("./debug-info"),o=function(e,t,n,i){this.value=e,this.isLineComment=t,this.currentFileInfo=i};(o.prototype=new i).type="Comment",o.prototype.genCSS=function(e,t){this.debugInfo&&t.add(r(e,this),this.currentFileInfo,this.index),t.add(this.value)},o.prototype.isSilent=function(e){var t=this.currentFileInfo&&this.currentFileInfo.reference&&!this.isReferenced,n=e.compress&&"!"!==this.value[2];return this.isLineComment||t||n},o.prototype.markReferenced=function(){this.isReferenced=!0},t.exports=o},{"./debug-info":53,"./node":69}],52:[function(e,t,n){var i=e("./node"),r=function(e,t,n,i,r){this.op=e.trim(),this.lvalue=t,this.rvalue=n,this.index=i,this.negate=r};(r.prototype=new i).type="Condition",r.prototype.accept=function(e){this.lvalue=e.visit(this.lvalue),this.rvalue=e.visit(this.rvalue)},r.prototype.eval=function(e){var t=function(e,t,n){switch(e){case"and":return t&&n;case"or":return t||n;default:switch(i.compare(t,n)){case-1:return"<"===e||"=<"===e||"<="===e;case 0:return"="===e||">="===e||"=<"===e||"<="===e;case 1:return">"===e||">="===e;default:return!1}}}(this.op,this.lvalue.eval(e),this.rvalue.eval(e));return this.negate?!t:t},t.exports=r},{"./node":69}],53:[function(e,t,n){var i=function(e,t,n){var r="";if(e.dumpLineNumbers&&!e.compress)switch(e.dumpLineNumbers){case"comments":r=i.asComment(t);break;case"mediaquery":r=i.asMediaQuery(t);break;case"all":r=i.asComment(t)+(n||"")+i.asMediaQuery(t)}return r};i.asComment=function(e){return"/* line "+e.debugInfo.lineNumber+", "+e.debugInfo.fileName+" */\n"},i.asMediaQuery=function(e){var t=e.debugInfo.fileName;return/^[a-z]+:\/\//i.test(t)||(t="file://"+t),"@media -sass-debug-info{filename{font-family:"+t.replace(/([.:\/\\])/g,function(e){return"\\"==e&&(e="/"),"\\"+e})+"}line{font-family:\\00003"+e.debugInfo.lineNumber+"}}\n"},t.exports=i},{}],54:[function(e,t,n){var i=e("./node"),r=e("../contexts"),o=function(e,t){this.ruleset=e,this.frames=t};(o.prototype=new i).type="DetachedRuleset",o.prototype.evalFirst=!0,o.prototype.accept=function(e){this.ruleset=e.visit(this.ruleset)},o.prototype.eval=function(e){var t=this.frames||e.frames.slice(0);return new o(this.ruleset,t)},o.prototype.callEval=function(e){return this.ruleset.eval(this.frames?new r.Eval(e,this.frames.concat(e.frames)):e)},t.exports=o},{"../contexts":10,"./node":69}],55:[function(e,t,n){var i=e("./node"),r=e("../data/unit-conversions"),o=e("./unit"),s=e("./color"),a=function(e,t){this.value=parseFloat(e),this.unit=t&&t instanceof o?t:new o(t?[t]:void 0)};(a.prototype=new i).type="Dimension",a.prototype.accept=function(e){this.unit=e.visit(this.unit)},a.prototype.eval=function(e){return this},a.prototype.toColor=function(){return new s([this.value,this.value,this.value])},a.prototype.genCSS=function(e,t){if(e&&e.strictUnits&&!this.unit.isSingular())throw new Error("Multiple units in dimension. Correct the units or use the unit function. Bad unit: "+this.unit.toString());var n=this.fround(e,this.value),i=String(n);if(0!==n&&n<1e-6&&n>-1e-6&&(i=n.toFixed(20).replace(/0+$/,"")),e&&e.compress){if(0===n&&this.unit.isLength())return void t.add(i);n>0&&n<1&&(i=i.substr(1))}t.add(i),this.unit.genCSS(e,t)},a.prototype.operate=function(e,t,n){var i=this._operate(e,t,this.value,n.value),r=this.unit.clone();if("+"===t||"-"===t)if(0===r.numerator.length&&0===r.denominator.length)r=n.unit.clone(),this.unit.backupUnit&&(r.backupUnit=this.unit.backupUnit);else if(0===n.unit.numerator.length&&0===r.denominator.length);else{if(n=n.convertTo(this.unit.usedUnits()),e.strictUnits&&n.unit.toString()!==r.toString())throw new Error("Incompatible units. Change the units or use the unit function. Bad units: '"+r.toString()+"' and '"+n.unit.toString()+"'.");i=this._operate(e,t,this.value,n.value)}else"*"===t?(r.numerator=r.numerator.concat(n.unit.numerator).sort(),r.denominator=r.denominator.concat(n.unit.denominator).sort(),r.cancel()):"/"===t&&(r.numerator=r.numerator.concat(n.unit.denominator).sort(),r.denominator=r.denominator.concat(n.unit.numerator).sort(),r.cancel());return new a(i,r)},a.prototype.compare=function(e){var t,n;if(e instanceof a){if(this.unit.isEmpty()||e.unit.isEmpty())t=this,n=e;else if(t=this.unify(),n=e.unify(),0!==t.unit.compare(n.unit))return;return i.numericCompare(t.value,n.value)}},a.prototype.unify=function(){return this.convertTo({length:"px",duration:"s",angle:"rad"})},a.prototype.convertTo=function(e){var t,n,i,o,s,l=this.value,c=this.unit.clone(),u={};if("string"==typeof e){for(t in r)r[t].hasOwnProperty(e)&&((u={})[t]=e);e=u}s=function(e,t){return i.hasOwnProperty(e)?(t?l/=i[e]/i[o]:l*=i[e]/i[o],o):e};for(n in e)e.hasOwnProperty(n)&&(o=e[n],i=r[n],c.map(s));return c.cancel(),new a(l,c)},t.exports=a},{"../data/unit-conversions":13,"./color":49,"./node":69,"./unit":78}],56:[function(e,t,n){var i=e("./node"),r=e("./selector"),o=e("./ruleset"),s=function(e,t,n,i,o,s,a,l){var c;if(this.name=e,this.value=t,n)for(Array.isArray(n)?this.rules=n:(this.rules=[n],this.rules[0].selectors=new r([],null,null,this.index,o).createEmptySelectors()),c=0;c<this.rules.length;c++)this.rules[c].allowImports=!0;this.index=i,this.currentFileInfo=o,this.debugInfo=s,this.isReferenced=a,this.isRooted=l||!1};(s.prototype=new i).type="Directive",s.prototype.accept=function(e){var t=this.value,n=this.rules;n&&(this.rules=e.visitArray(n)),t&&(this.value=e.visit(t))},s.prototype.isRulesetLike=function(){return this.rules||!this.isCharset()},s.prototype.isCharset=function(){return"@charset"===this.name},s.prototype.genCSS=function(e,t){var n=this.value,i=this.rules;t.add(this.name,this.currentFileInfo,this.index),n&&(t.add(" "),n.genCSS(e,t)),i?this.outputRuleset(e,t,i):t.add(";")},s.prototype.eval=function(e){var t,n,i=this.value,r=this.rules;return t=e.mediaPath,n=e.mediaBlocks,e.mediaPath=[],e.mediaBlocks=[],i&&(i=i.eval(e)),r&&((r=[r[0].eval(e)])[0].root=!0),e.mediaPath=t,e.mediaBlocks=n,new s(this.name,i,r,this.index,this.currentFileInfo,this.debugInfo,this.isReferenced,this.isRooted)},s.prototype.variable=function(e){if(this.rules)return o.prototype.variable.call(this.rules[0],e)},s.prototype.find=function(){if(this.rules)return o.prototype.find.apply(this.rules[0],arguments)},s.prototype.rulesets=function(){if(this.rules)return o.prototype.rulesets.apply(this.rules[0])},s.prototype.markReferenced=function(){var e,t;if(this.isReferenced=!0,this.rules)for(t=this.rules,e=0;e<t.length;e++)t[e].markReferenced&&t[e].markReferenced()},s.prototype.getIsReferenced=function(){return!this.currentFileInfo||!this.currentFileInfo.reference||this.isReferenced},s.prototype.outputRuleset=function(e,t,n){var i,r=n.length;if(e.tabLevel=1+(0|e.tabLevel),e.compress){for(t.add("{"),i=0;i<r;i++)n[i].genCSS(e,t);return t.add("}"),void e.tabLevel--}var o="\n"+Array(e.tabLevel).join("  "),s=o+"  ";if(r){for(t.add(" {"+s),n[0].genCSS(e,t),i=1;i<r;i++)t.add(s),n[i].genCSS(e,t);t.add(o+"}")}else t.add(" {"+o+"}");e.tabLevel--},t.exports=s},{"./node":69,"./ruleset":75,"./selector":76}],57:[function(e,t,n){var i=e("./node"),r=e("./paren"),o=e("./combinator"),s=function(e,t,n,i){this.combinator=e instanceof o?e:new o(e),this.value="string"==typeof t?t.trim():t||"",this.index=n,this.currentFileInfo=i};(s.prototype=new i).type="Element",s.prototype.accept=function(e){var t=this.value;this.combinator=e.visit(this.combinator),"object"==typeof t&&(this.value=e.visit(t))},s.prototype.eval=function(e){return new s(this.combinator,this.value.eval?this.value.eval(e):this.value,this.index,this.currentFileInfo)},s.prototype.genCSS=function(e,t){t.add(this.toCSS(e),this.currentFileInfo,this.index)},s.prototype.toCSS=function(e){e=e||{};var t=this.value,n=e.firstSelector;return t instanceof r&&(e.firstSelector=!0),t=t.toCSS?t.toCSS(e):t,e.firstSelector=n,""===t&&"&"===this.combinator.value.charAt(0)?"":this.combinator.toCSS(e)+t},t.exports=s},{"./combinator":50,"./node":69,"./paren":71}],58:[function(e,t,n){var i=e("./node"),r=e("./paren"),o=e("./comment"),s=function(e){if(this.value=e,!e)throw new Error("Expression requires an array parameter")};(s.prototype=new i).type="Expression",s.prototype.accept=function(e){this.value=e.visitArray(this.value)},s.prototype.eval=function(e){var t,n=this.parens&&!this.parensInOp,i=!1;return n&&e.inParenthesis(),this.value.length>1?t=new s(this.value.map(function(t){return t.eval(e)})):1===this.value.length?(this.value[0].parens&&!this.value[0].parensInOp&&(i=!0),t=this.value[0].eval(e)):t=this,n&&e.outOfParenthesis(),this.parens&&this.parensInOp&&!e.isMathOn()&&!i&&(t=new r(t)),t},s.prototype.genCSS=function(e,t){for(var n=0;n<this.value.length;n++)this.value[n].genCSS(e,t),n+1<this.value.length&&t.add(" ")},s.prototype.throwAwayComments=function(){this.value=this.value.filter(function(e){return!(e instanceof o)})},s.prototype.markReferenced=function(){this.value.forEach(function(e){e.markReferenced&&e.markReferenced()})},t.exports=s},{"./comment":51,"./node":69,"./paren":71}],59:[function(e,t,n){var i=e("./node"),r=function e(t,n,i){switch(this.selector=t,this.option=n,this.index=i,this.object_id=e.next_id++,this.parent_ids=[this.object_id],n){case"all":this.allowBefore=!0,this.allowAfter=!0;break;default:this.allowBefore=!1,this.allowAfter=!1}};r.next_id=0,(r.prototype=new i).type="Extend",r.prototype.accept=function(e){this.selector=e.visit(this.selector)},r.prototype.eval=function(e){return new r(this.selector.eval(e),this.option,this.index)},r.prototype.clone=function(e){return new r(this.selector,this.option,this.index)},r.prototype.findSelfSelectors=function(e){var t,n,i=[];for(t=0;t<e.length;t++)n=e[t].elements,t>0&&n.length&&""===n[0].combinator.value&&(n[0].combinator.value=" "),i=i.concat(e[t].elements);this.selfSelectors=[{elements:i}]},t.exports=r},{"./node":69}],60:[function(e,t,n){var i=e("./node"),r=e("./media"),o=e("./url"),s=e("./quoted"),a=e("./ruleset"),l=e("./anonymous"),c=function(e,t,n,i,r){if(this.options=n,this.index=i,this.path=e,this.features=t,this.currentFileInfo=r,void 0!==this.options.less||this.options.inline)this.css=!this.options.less||this.options.inline;else{var o=this.getPath();o&&/[#\.\&\?\/]css([\?;].*)?$/.test(o)&&(this.css=!0)}};(c.prototype=new i).type="Import",c.prototype.accept=function(e){this.features&&(this.features=e.visit(this.features)),this.path=e.visit(this.path),this.options.plugin||this.options.inline||!this.root||(this.root=e.visit(this.root))},c.prototype.genCSS=function(e,t){this.css&&void 0===this.path.currentFileInfo.reference&&(t.add("@import ",this.currentFileInfo,this.index),this.path.genCSS(e,t),this.features&&(t.add(" "),this.features.genCSS(e,t)),t.add(";"))},c.prototype.getPath=function(){return this.path instanceof o?this.path.value.value:this.path.value},c.prototype.isVariableImport=function(){var e=this.path;return e instanceof o&&(e=e.value),!(e instanceof s)||e.containsVariables()},c.prototype.evalForImport=function(e){var t=this.path;return t instanceof o&&(t=t.value),new c(t.eval(e),this.features,this.options,this.index,this.currentFileInfo)},c.prototype.evalPath=function(e){var t=this.path.eval(e),n=this.currentFileInfo&&this.currentFileInfo.rootpath;if(!(t instanceof o)){if(n){var i=t.value;i&&e.isPathRelative(i)&&(t.value=n+i)}t.value=e.normalizePath(t.value)}return t},c.prototype.eval=function(e){var t,n,i=this.features&&this.features.eval(e);if(this.options.plugin)return(n=e.frames[0]&&e.frames[0].functionRegistry)&&this.root&&this.root.functions&&n.addMultiple(this.root.functions),[];if(this.skip&&("function"==typeof this.skip&&(this.skip=this.skip()),this.skip))return[];if(this.options.inline){var o=new l(this.root,0,{filename:this.importedFilename,reference:this.path.currentFileInfo&&this.path.currentFileInfo.reference},!0,!0,!1);return this.features?new r([o],this.features.value):[o]}if(this.css){var s=new c(this.evalPath(e),i,this.options,this.index);if(!s.css&&this.error)throw this.error;return s}return(t=new a(null,this.root.rules.slice(0))).evalImports(e),this.features?new r(t.rules,this.features.value):t.rules},t.exports=c},{"./anonymous":45,"./media":65,"./node":69,"./quoted":72,"./ruleset":75,"./url":79}],61:[function(e,t,n){var i={};i.Node=e("./node"),i.Alpha=e("./alpha"),i.Color=e("./color"),i.Directive=e("./directive"),i.DetachedRuleset=e("./detached-ruleset"),i.Operation=e("./operation"),i.Dimension=e("./dimension"),i.Unit=e("./unit"),i.Keyword=e("./keyword"),i.Variable=e("./variable"),i.Ruleset=e("./ruleset"),i.Element=e("./element"),i.Attribute=e("./attribute"),i.Combinator=e("./combinator"),i.Selector=e("./selector"),i.Quoted=e("./quoted"),i.Expression=e("./expression"),i.Rule=e("./rule"),i.Call=e("./call"),i.URL=e("./url"),i.Import=e("./import"),i.mixin={Call:e("./mixin-call"),Definition:e("./mixin-definition")},i.Comment=e("./comment"),i.Anonymous=e("./anonymous"),i.Value=e("./value"),i.JavaScript=e("./javascript"),i.Assignment=e("./assignment"),i.Condition=e("./condition"),i.Paren=e("./paren"),i.Media=e("./media"),i.UnicodeDescriptor=e("./unicode-descriptor"),i.Negative=e("./negative"),i.Extend=e("./extend"),i.RulesetCall=e("./ruleset-call"),t.exports=i},{"./alpha":44,"./anonymous":45,"./assignment":46,"./attribute":47,"./call":48,"./color":49,"./combinator":50,"./comment":51,"./condition":52,"./detached-ruleset":54,"./dimension":55,"./directive":56,"./element":57,"./expression":58,"./extend":59,"./import":60,"./javascript":62,"./keyword":64,"./media":65,"./mixin-call":66,"./mixin-definition":67,"./negative":68,"./node":69,"./operation":70,"./paren":71,"./quoted":72,"./rule":73,"./ruleset":75,"./ruleset-call":74,"./selector":76,"./unicode-descriptor":77,"./unit":78,"./url":79,"./value":80,"./variable":81}],62:[function(e,t,n){var i=e("./js-eval-node"),r=e("./dimension"),o=e("./quoted"),s=e("./anonymous"),a=function(e,t,n,i){this.escaped=t,this.expression=e,this.index=n,this.currentFileInfo=i};(a.prototype=new i).type="JavaScript",a.prototype.eval=function(e){var t=this.evaluateJavaScript(this.expression,e);return"number"==typeof t?new r(t):"string"==typeof t?new o('"'+t+'"',t,this.escaped,this.index):new s(Array.isArray(t)?t.join(", "):t)},t.exports=a},{"./anonymous":45,"./dimension":55,"./js-eval-node":63,"./quoted":72}],63:[function(e,t,n){var i=e("./node"),r=e("./variable"),o=function(){};(o.prototype=new i).evaluateJavaScript=function(e,t){var n,i=this,o={};if(void 0!==t.javascriptEnabled&&!t.javascriptEnabled)throw{message:"You are using JavaScript, which has been disabled.",filename:this.currentFileInfo.filename,index:this.index};e=e.replace(/@\{([\w-]+)\}/g,function(e,n){return i.jsify(new r("@"+n,i.index,i.currentFileInfo).eval(t))});try{e=new Function("return ("+e+")")}catch(t){throw{message:"JavaScript evaluation error: "+t.message+" from `"+e+"`",filename:this.currentFileInfo.filename,index:this.index}}var s=t.frames[0].variables();for(var a in s)s.hasOwnProperty(a)&&(o[a.slice(1)]={value:s[a].value,toJS:function(){return this.value.eval(t).toCSS()}});try{n=e.call(o)}catch(e){throw{message:"JavaScript evaluation error: '"+e.name+": "+e.message.replace(/["]/g,"'")+"'",filename:this.currentFileInfo.filename,index:this.index}}return n},o.prototype.jsify=function(e){return Array.isArray(e.value)&&e.value.length>1?"["+e.value.map(function(e){return e.toCSS()}).join(", ")+"]":e.toCSS()},t.exports=o},{"./node":69,"./variable":81}],64:[function(e,t,n){var i=e("./node"),r=function(e){this.value=e};(r.prototype=new i).type="Keyword",r.prototype.genCSS=function(e,t){if("%"===this.value)throw{type:"Syntax",message:"Invalid % without number"};t.add(this.value)},r.True=new r("true"),r.False=new r("false"),t.exports=r},{"./node":69}],65:[function(e,t,n){var i=e("./ruleset"),r=e("./value"),o=e("./selector"),s=e("./anonymous"),a=e("./expression"),l=e("./directive"),c=function(e,t,n,s){this.index=n,this.currentFileInfo=s;var a=new o([],null,null,this.index,this.currentFileInfo).createEmptySelectors();this.features=new r(t),this.rules=[new i(a,e)],this.rules[0].allowImports=!0};(c.prototype=new l).type="Media",c.prototype.isRulesetLike=!0,c.prototype.accept=function(e){this.features&&(this.features=e.visit(this.features)),this.rules&&(this.rules=e.visitArray(this.rules))},c.prototype.genCSS=function(e,t){t.add("@media ",this.currentFileInfo,this.index),this.features.genCSS(e,t),this.outputRuleset(e,t,this.rules)},c.prototype.eval=function(e){e.mediaBlocks||(e.mediaBlocks=[],e.mediaPath=[]);var t=new c(null,[],this.index,this.currentFileInfo);this.debugInfo&&(this.rules[0].debugInfo=this.debugInfo,t.debugInfo=this.debugInfo);var n=!1;e.strictMath||(n=!0,e.strictMath=!0);try{t.features=this.features.eval(e)}finally{n&&(e.strictMath=!1)}return e.mediaPath.push(t),e.mediaBlocks.push(t),this.rules[0].functionRegistry=e.frames[0].functionRegistry.inherit(),e.frames.unshift(this.rules[0]),t.rules=[this.rules[0].eval(e)],e.frames.shift(),e.mediaPath.pop(),0===e.mediaPath.length?t.evalTop(e):t.evalNested(e)},c.prototype.evalTop=function(e){var t=this;if(e.mediaBlocks.length>1){var n=new o([],null,null,this.index,this.currentFileInfo).createEmptySelectors();(t=new i(n,e.mediaBlocks)).multiMedia=!0}return delete e.mediaBlocks,delete e.mediaPath,t},c.prototype.evalNested=function(e){var t,n,o=e.mediaPath.concat([this]);for(t=0;t<o.length;t++)n=o[t].features instanceof r?o[t].features.value:o[t].features,o[t]=Array.isArray(n)?n:[n];return this.features=new r(this.permute(o).map(function(e){for(e=e.map(function(e){return e.toCSS?e:new s(e)}),t=e.length-1;t>0;t--)e.splice(t,0,new s("and"));return new a(e)})),new i([],[])},c.prototype.permute=function(e){if(0===e.length)return[];if(1===e.length)return e[0];for(var t=[],n=this.permute(e.slice(1)),i=0;i<n.length;i++)for(var r=0;r<e[0].length;r++)t.push([e[0][r]].concat(n[i]));return t},c.prototype.bubbleSelectors=function(e){e&&(this.rules=[new i(e.slice(0),[this.rules[0]])])},t.exports=c},{"./anonymous":45,"./directive":56,"./expression":58,"./ruleset":75,"./selector":76,"./value":80}],66:[function(e,t,n){var i=e("./node"),r=e("./selector"),o=e("./mixin-definition"),s=e("../functions/default"),a=function(e,t,n,i,o){this.selector=new r(e),this.arguments=t||[],this.index=n,this.currentFileInfo=i,this.important=o};(a.prototype=new i).type="MixinCall",a.prototype.accept=function(e){this.selector&&(this.selector=e.visit(this.selector)),this.arguments.length&&(this.arguments=e.visitArray(this.arguments))},a.prototype.eval=function(e){var t,n,i,r,a,l,c,u,h,d,p,f,m,g,v,y,b=[],x=[],q=!1,C=[],S=[],w=-1,_=0,D=1,M=2;for(c=0;c<this.arguments.length;c++)if(r=this.arguments[c],a=r.value.eval(e),r.expand&&Array.isArray(a.value))for(a=a.value,u=0;u<a.length;u++)b.push({value:a[u]});else b.push({name:r.name,value:a});for(y=function(t){return t.matchArgs(null,e)},c=0;c<e.frames.length;c++)if((t=e.frames[c].find(this.selector,null,y)).length>0){for(p=!0,u=0;u<t.length;u++){for(n=t[u].rule,i=t[u].path,d=!1,h=0;h<e.frames.length;h++)if(!(n instanceof o)&&n===(e.frames[h].originalRuleset||e.frames[h])){d=!0;break}d||n.matchArgs(b,e)&&((f={mixin:n,group:function(t,n){var i,r,o;for(i=0;i<2;i++){for(S[i]=!0,s.value(i),r=0;r<n.length&&S[i];r++)(o=n[r]).matchCondition&&(S[i]=S[i]&&o.matchCondition(null,e));t.matchCondition&&(S[i]=S[i]&&t.matchCondition(b,e))}return S[0]||S[1]?S[0]!=S[1]?S[1]?D:M:_:w}(n,i)}).group!==w&&C.push(f),q=!0)}for(s.reset(),g=[0,0,0],u=0;u<C.length;u++)g[C[u].group]++;if(g[_]>0)m=M;else if(m=D,g[D]+g[M]>1)throw{type:"Runtime",message:"Ambiguous use of `default()` found when matching for `"+this.format(b)+"`",index:this.index,filename:this.currentFileInfo.filename};for(u=0;u<C.length;u++)if((f=C[u].group)===_||f===m)try{(n=C[u].mixin)instanceof o||(v=n.originalRuleset||n,(n=new o("",[],n.rules,null,!1)).originalRuleset=v),Array.prototype.push.apply(x,n.evalCall(e,b,this.important).rules)}catch(e){throw{message:e.message,index:this.index,filename:this.currentFileInfo.filename,stack:e.stack}}if(q){if(!this.currentFileInfo||!this.currentFileInfo.reference)for(c=0;c<x.length;c++)(l=x[c]).markReferenced&&l.markReferenced();return x}}throw p?{type:"Runtime",message:"No matching definition was found for `"+this.format(b)+"`",index:this.index,filename:this.currentFileInfo.filename}:{type:"Name",message:this.selector.toCSS().trim()+" is undefined",index:this.index,filename:this.currentFileInfo.filename}},a.prototype.format=function(e){return this.selector.toCSS().trim()+"("+(e?e.map(function(e){var t="";return e.name&&(t+=e.name+":"),e.value.toCSS?t+=e.value.toCSS():t+="???",t}).join(", "):"")+")"},t.exports=a},{"../functions/default":19,"./mixin-definition":67,"./node":69,"./selector":76}],67:[function(e,t,n){var i=e("./selector"),r=e("./element"),o=e("./ruleset"),s=e("./rule"),a=e("./expression"),l=e("../contexts"),c=function(e,t,n,o,s,a){this.name=e,this.selectors=[new i([new r(null,e,this.index,this.currentFileInfo)])],this.params=t,this.condition=o,this.variadic=s,this.arity=t.length,this.rules=n,this._lookups={};var l=[];this.required=t.reduce(function(e,t){return!t.name||t.name&&!t.value?e+1:(l.push(t.name),e)},0),this.optionalParameters=l,this.frames=a};(c.prototype=new o).type="MixinDefinition",c.prototype.evalFirst=!0,c.prototype.accept=function(e){this.params&&this.params.length&&(this.params=e.visitArray(this.params)),this.rules=e.visitArray(this.rules),this.condition&&(this.condition=e.visit(this.condition))},c.prototype.evalParams=function(e,t,n,i){var r,c,u,h,d,p,f,m,g=new o(null,null),v=this.params.slice(0),y=0;if(t.frames&&t.frames[0]&&t.frames[0].functionRegistry&&(g.functionRegistry=t.frames[0].functionRegistry.inherit()),t=new l.Eval(t,[g].concat(t.frames)),n)for(y=(n=n.slice(0)).length,u=0;u<y;u++)if(c=n[u],p=c&&c.name){for(f=!1,h=0;h<v.length;h++)if(!i[h]&&p===v[h].name){i[h]=c.value.eval(e),g.prependRule(new s(p,c.value.eval(e))),f=!0;break}if(f){n.splice(u,1),u--;continue}throw{type:"Runtime",message:"Named argument for "+this.name+" "+n[u].name+" not found"}}for(m=0,u=0;u<v.length;u++)if(!i[u]){if(c=n&&n[m],p=v[u].name)if(v[u].variadic){for(r=[],h=m;h<y;h++)r.push(n[h].value.eval(e));g.prependRule(new s(p,new a(r).eval(e)))}else{if(d=c&&c.value)d=d.eval(e);else{if(!v[u].value)throw{type:"Runtime",message:"wrong number of arguments for "+this.name+" ("+y+" for "+this.arity+")"};d=v[u].value.eval(t),g.resetCache()}g.prependRule(new s(p,d)),i[u]=d}if(v[u].variadic&&n)for(h=m;h<y;h++)i[h]=n[h].value.eval(e);m++}return g},c.prototype.makeImportant=function(){var e=this.rules?this.rules.map(function(e){return e.makeImportant?e.makeImportant(!0):e}):this.rules;return new c(this.name,this.params,e,this.condition,this.variadic,this.frames)},c.prototype.eval=function(e){return new c(this.name,this.params,this.rules,this.condition,this.variadic,this.frames||e.frames.slice(0))},c.prototype.evalCall=function(e,t,n){var i,r,c=[],u=this.frames?this.frames.concat(e.frames):e.frames,h=this.evalParams(e,new l.Eval(e,u),t,c);return h.prependRule(new s("@arguments",new a(c).eval(e))),i=this.rules.slice(0),r=new o(null,i),r.originalRuleset=this,r=r.eval(new l.Eval(e,[this,h].concat(u))),n&&(r=r.makeImportant()),r},c.prototype.matchCondition=function(e,t){return!(this.condition&&!this.condition.eval(new l.Eval(t,[this.evalParams(t,new l.Eval(t,this.frames?this.frames.concat(t.frames):t.frames),e,[])].concat(this.frames||[]).concat(t.frames))))},c.prototype.matchArgs=function(e,t){var n,i=e&&e.length||0,r=this.optionalParameters,o=e?e.reduce(function(e,t){return r.indexOf(t.name)<0?e+1:e},0):0;if(this.variadic){if(o<this.required-1)return!1}else{if(o<this.required)return!1;if(i>this.params.length)return!1}n=Math.min(o,this.arity);for(var s=0;s<n;s++)if(!this.params[s].name&&!this.params[s].variadic&&e[s].value.eval(t).toCSS()!=this.params[s].value.eval(t).toCSS())return!1;return!0},t.exports=c},{"../contexts":10,"./element":57,"./expression":58,"./rule":73,"./ruleset":75,"./selector":76}],68:[function(e,t,n){var i=e("./node"),r=e("./operation"),o=e("./dimension"),s=function(e){this.value=e};(s.prototype=new i).type="Negative",s.prototype.genCSS=function(e,t){t.add("-"),this.value.genCSS(e,t)},s.prototype.eval=function(e){return e.isMathOn()?new r("*",[new o(-1),this.value]).eval(e):new s(this.value.eval(e))},t.exports=s},{"./dimension":55,"./node":69,"./operation":70}],69:[function(e,t,n){var i=function(){};i.prototype.toCSS=function(e){var t=[];return this.genCSS(e,{add:function(e,n,i){t.push(e)},isEmpty:function(){return 0===t.length}}),t.join("")},i.prototype.genCSS=function(e,t){t.add(this.value)},i.prototype.accept=function(e){this.value=e.visit(this.value)},i.prototype.eval=function(){return this},i.prototype._operate=function(e,t,n,i){switch(t){case"+":return n+i;case"-":return n-i;case"*":return n*i;case"/":return n/i}},i.prototype.fround=function(e,t){var n=e&&e.numPrecision;return null==n?t:Number((t+2e-16).toFixed(n))},i.compare=function(e,t){if(e.compare&&"Quoted"!==t.type&&"Anonymous"!==t.type)return e.compare(t);if(t.compare)return-t.compare(e);if(e.type===t.type){if(e=e.value,t=t.value,!Array.isArray(e))return e===t?0:void 0;if(e.length===t.length){for(var n=0;n<e.length;n++)if(0!==i.compare(e[n],t[n]))return;return 0}}},i.numericCompare=function(e,t){return e<t?-1:e===t?0:e>t?1:void 0},t.exports=i},{}],70:[function(e,t,n){var i=e("./node"),r=e("./color"),o=e("./dimension"),s=function(e,t,n){this.op=e.trim(),this.operands=t,this.isSpaced=n};(s.prototype=new i).type="Operation",s.prototype.accept=function(e){this.operands=e.visit(this.operands)},s.prototype.eval=function(e){var t=this.operands[0].eval(e),n=this.operands[1].eval(e);if(e.isMathOn()){if(t instanceof o&&n instanceof r&&(t=t.toColor()),n instanceof o&&t instanceof r&&(n=n.toColor()),!t.operate)throw{type:"Operation",message:"Operation on an invalid type"};return t.operate(e,this.op,n)}return new s(this.op,[t,n],this.isSpaced)},s.prototype.genCSS=function(e,t){this.operands[0].genCSS(e,t),this.isSpaced&&t.add(" "),t.add(this.op),this.isSpaced&&t.add(" "),this.operands[1].genCSS(e,t)},t.exports=s},{"./color":49,"./dimension":55,"./node":69}],71:[function(e,t,n){var i=e("./node"),r=function(e){this.value=e};(r.prototype=new i).type="Paren",r.prototype.genCSS=function(e,t){t.add("("),this.value.genCSS(e,t),t.add(")")},r.prototype.eval=function(e){return new r(this.value.eval(e))},t.exports=r},{"./node":69}],72:[function(e,t,n){var i=e("./node"),r=e("./js-eval-node"),o=e("./variable"),s=function(e,t,n,i,r){this.escaped=null==n||n,this.value=t||"",this.quote=e.charAt(0),this.index=i,this.currentFileInfo=r};(s.prototype=new r).type="Quoted",s.prototype.genCSS=function(e,t){this.escaped||t.add(this.quote,this.currentFileInfo,this.index),t.add(this.value),this.escaped||t.add(this.quote)},s.prototype.containsVariables=function(){return this.value.match(/(`([^`]+)`)|@\{([\w-]+)\}/)},s.prototype.eval=function(e){function t(e,t,n){var i=e;do{i=(e=i).replace(t,n)}while(e!==i);return i}var n=this,i=this.value;return i=t(i,/`([^`]+)`/g,function(t,i){return String(n.evaluateJavaScript(i,e))}),i=t(i,/@\{([\w-]+)\}/g,function(t,i){var r=new o("@"+i,n.index,n.currentFileInfo).eval(e,!0);return r instanceof s?r.value:r.toCSS()}),new s(this.quote+i+this.quote,i,this.escaped,this.index,this.currentFileInfo)},s.prototype.compare=function(e){return"Quoted"!==e.type||this.escaped||e.escaped?e.toCSS&&this.toCSS()===e.toCSS()?0:void 0:i.numericCompare(this.value,e.value)},t.exports=s},{"./js-eval-node":63,"./node":69,"./variable":81}],73:[function(e,t,n){function i(e,t){var n,i="",r=t.length,o={add:function(e){i+=e}};for(n=0;n<r;n++)t[n].eval(e).genCSS(e,o);return i}var r=e("./node"),o=e("./value"),s=e("./keyword"),a=function(e,t,n,i,s,a,l,c){this.name=e,this.value=t instanceof r?t:new o([t]),this.important=n?" "+n.trim():"",this.merge=i,this.index=s,this.currentFileInfo=a,this.inline=l||!1,this.variable=void 0!==c?c:e.charAt&&"@"===e.charAt(0)};(a.prototype=new r).type="Rule",a.prototype.genCSS=function(e,t){t.add(this.name+(e.compress?":":": "),this.currentFileInfo,this.index);try{this.value.genCSS(e,t)}catch(e){throw e.index=this.index,e.filename=this.currentFileInfo.filename,e}t.add(this.important+(this.inline||e.lastRule&&e.compress?"":";"),this.currentFileInfo,this.index)},a.prototype.eval=function(e){var t,n=!1,r=this.name,o=this.variable;"string"!=typeof r&&(r=1===r.length&&r[0]instanceof s?r[0].value:i(e,r),o=!1),"font"!==r||e.strictMath||(n=!0,e.strictMath=!0);try{if(e.importantScope.push({}),t=this.value.eval(e),!this.variable&&"DetachedRuleset"===t.type)throw{message:"Rulesets cannot be evaluated on a property.",index:this.index,filename:this.currentFileInfo.filename};var l=this.important,c=e.importantScope.pop();return!l&&c.important&&(l=c.important),new a(r,t,l,this.merge,this.index,this.currentFileInfo,this.inline,o)}catch(e){throw"number"!=typeof e.index&&(e.index=this.index,e.filename=this.currentFileInfo.filename),e}finally{n&&(e.strictMath=!1)}},a.prototype.makeImportant=function(){return new a(this.name,this.value,"!important",this.merge,this.index,this.currentFileInfo,this.inline)};var l=function(e){Array.isArray(e)?e.forEach(function(e){l(e)}):e.markReferenced&&e.markReferenced()};a.prototype.markReferenced=function(){this.value&&l(this.value)},t.exports=a},{"./keyword":64,"./node":69,"./value":80}],74:[function(e,t,n){var i=e("./node"),r=e("./variable"),o=function(e){this.variable=e};(o.prototype=new i).type="RulesetCall",o.prototype.eval=function(e){return new r(this.variable).eval(e).callEval(e)},t.exports=o},{"./node":69,"./variable":81}],75:[function(e,t,n){var i=e("./node"),r=e("./rule"),o=e("./selector"),s=e("./element"),a=e("./paren"),l=e("../contexts"),c=e("../functions/function-registry"),u=e("../functions/default"),h=e("./debug-info"),d=function(e,t,n){this.selectors=e,this.rules=t,this._lookups={},this.strictImports=n};(d.prototype=new i).type="Ruleset",d.prototype.isRuleset=!0,d.prototype.isRulesetLike=!0,d.prototype.accept=function(e){this.paths?e.visitArray(this.paths,!0):this.selectors&&(this.selectors=e.visitArray(this.selectors)),this.rules&&this.rules.length&&(this.rules=e.visitArray(this.rules))},d.prototype.eval=function(e){var t,n,i,o,s=this.selectors,a=!1;if(s&&(n=s.length)){for(t=[],u.error({type:"Syntax",message:"it is currently only allowed in parametric mixin guards,"}),o=0;o<n;o++)i=s[o].eval(e),t.push(i),i.evaldCondition&&(a=!0);u.reset()}else a=!0;var l,h,p=this.rules?this.rules.slice(0):null,f=new d(t,p,this.strictImports);f.originalRuleset=this,f.root=this.root,f.firstRoot=this.firstRoot,f.allowImports=this.allowImports,this.debugInfo&&(f.debugInfo=this.debugInfo),a||(p.length=0),f.functionRegistry=function(e){for(var t,n=0,i=e.length;n!==i;++n)if(t=e[n].functionRegistry)return t;return c}(e.frames).inherit();var m=e.frames;m.unshift(f);var g=e.selectors;g||(e.selectors=g=[]),g.unshift(this.selectors),(f.root||f.allowImports||!f.strictImports)&&f.evalImports(e);var v=f.rules,y=v?v.length:0;for(o=0;o<y;o++)v[o].evalFirst&&(v[o]=v[o].eval(e));var b=e.mediaBlocks&&e.mediaBlocks.length||0;for(o=0;o<y;o++)"MixinCall"===v[o].type?(p=v[o].eval(e).filter(function(e){return!(e instanceof r&&e.variable)||!f.variable(e.name)}),v.splice.apply(v,[o,1].concat(p)),y+=p.length-1,o+=p.length-1,f.resetCache()):"RulesetCall"===v[o].type&&(p=v[o].eval(e).rules.filter(function(e){return!(e instanceof r&&e.variable)}),v.splice.apply(v,[o,1].concat(p)),y+=p.length-1,o+=p.length-1,f.resetCache());for(o=0;o<v.length;o++)(l=v[o]).evalFirst||(v[o]=l=l.eval?l.eval(e):l);for(o=0;o<v.length;o++)if((l=v[o])instanceof d&&l.selectors&&1===l.selectors.length&&l.selectors[0].isJustParentSelector()){v.splice(o--,1);for(var x=0;x<l.rules.length;x++)(h=l.rules[x])instanceof r&&h.variable||v.splice(++o,0,h)}if(m.shift(),g.shift(),e.mediaBlocks)for(o=b;o<e.mediaBlocks.length;o++)e.mediaBlocks[o].bubbleSelectors(t);return f},d.prototype.evalImports=function(e){var t,n,i=this.rules;if(i)for(t=0;t<i.length;t++)"Import"===i[t].type&&((n=i[t].eval(e))&&n.length?(i.splice.apply(i,[t,1].concat(n)),t+=n.length-1):i.splice(t,1,n),this.resetCache())},d.prototype.makeImportant=function(){return new d(this.selectors,this.rules.map(function(e){return e.makeImportant?e.makeImportant():e}),this.strictImports)},d.prototype.matchArgs=function(e){return!e||0===e.length},d.prototype.matchCondition=function(e,t){var n=this.selectors[this.selectors.length-1];return!!n.evaldCondition&&!(n.condition&&!n.condition.eval(new l.Eval(t,t.frames)))},d.prototype.resetCache=function(){this._rulesets=null,this._variables=null,this._lookups={}},d.prototype.variables=function(){return this._variables||(this._variables=this.rules?this.rules.reduce(function(e,t){if(t instanceof r&&!0===t.variable&&(e[t.name]=t),"Import"===t.type&&t.root&&t.root.variables){var n=t.root.variables();for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}return e},{}):{}),this._variables},d.prototype.variable=function(e){return this.variables()[e]},d.prototype.rulesets=function(){if(!this.rules)return[];var e,t,n=[],i=this.rules,r=i.length;for(e=0;e<r;e++)(t=i[e]).isRuleset&&n.push(t);return n},d.prototype.prependRule=function(e){var t=this.rules;t?t.unshift(e):this.rules=[e]},d.prototype.find=function(e,t,n){t=t||this;var i,r,s=[],a=e.toCSS();return a in this._lookups?this._lookups[a]:(this.rulesets().forEach(function(a){if(a!==t)for(var l=0;l<a.selectors.length;l++)if(i=e.match(a.selectors[l])){if(e.elements.length>i){if(!n||n(a)){r=a.find(new o(e.elements.slice(i)),t,n);for(var c=0;c<r.length;++c)r[c].path.push(a);Array.prototype.push.apply(s,r)}}else s.push({rule:a,path:[]});break}}),this._lookups[a]=s,s)},d.prototype.genCSS=function(e,t){var n,i,r,o,s,a=[],l=[];e.tabLevel=e.tabLevel||0,this.root||e.tabLevel++;var c,u=e.compress?"":Array(e.tabLevel+1).join("  "),d=e.compress?"":Array(e.tabLevel).join("  "),p=0,f=0;for(n=0;n<this.rules.length;n++)"Comment"===(o=this.rules[n]).type?(f===n&&f++,l.push(o)):o.isCharset&&o.isCharset()?(l.splice(p,0,o),p++,f++):"Import"===o.type?(l.splice(f,0,o),f++):l.push(o);if(l=a.concat(l),!this.root){(r=h(e,this,d))&&(t.add(r),t.add(d));var m,g=this.paths,v=g.length;for(c=e.compress?",":",\n"+d,n=0;n<v;n++)if(s=g[n],m=s.length)for(n>0&&t.add(c),e.firstSelector=!0,s[0].genCSS(e,t),e.firstSelector=!1,i=1;i<m;i++)s[i].genCSS(e,t);t.add((e.compress?"{":" {\n")+u)}for(n=0;n<l.length;n++){o=l[n],n+1===l.length&&(e.lastRule=!0);var y=e.lastRule;(function(e){return"boolean"==typeof e.isRulesetLike?e.isRulesetLike:"function"==typeof e.isRulesetLike&&e.isRulesetLike()})(o)&&(e.lastRule=!1),o.genCSS?o.genCSS(e,t):o.value&&t.add(o.value.toString()),e.lastRule=y,e.lastRule?e.lastRule=!1:t.add(e.compress?"":"\n"+u)}this.root||(t.add(e.compress?"}":"\n"+d+"}"),e.tabLevel--),t.isEmpty()||e.compress||!this.firstRoot||t.add("\n")},d.prototype.markReferenced=function(){var e;if(this.selectors)for(e=0;e<this.selectors.length;e++)this.selectors[e].markReferenced();if(this.rules)for(e=0;e<this.rules.length;e++)this.rules[e].markReferenced&&this.rules[e].markReferenced()},d.prototype.getIsReferenced=function(){var e,t,n,i;if(this.paths)for(e=0;e<this.paths.length;e++)for(n=this.paths[e],t=0;t<n.length;t++)if(n[t].getIsReferenced&&n[t].getIsReferenced())return!0;if(this.selectors)for(e=0;e<this.selectors.length;e++)if((i=this.selectors[e]).getIsReferenced&&i.getIsReferenced())return!0;return!1},d.prototype.joinSelectors=function(e,t,n){for(var i=0;i<n.length;i++)this.joinSelector(e,t,n[i])},d.prototype.joinSelector=function(e,t,n){function i(e,t){var n,i;if(0===e.length)n=new a(e[0]);else{var r=[];for(i=0;i<e.length;i++)r.push(new s(null,e[i],t.index,t.currentFileInfo));n=new a(new o(r))}return n}function r(e,t){var n;return n=new s(null,e,t.index,t.currentFileInfo),new o([n])}function l(e,t,n){var o,a,d,p,f,m,g,v,y,b,x=!1;for(p=[],f=[[]],o=0;o<n.elements.length;o++)if("&"!==(v=n.elements[o]).value){var q=function(e){var t;return"Paren"!==e.value.type?null:"Selector"!==(t=e.value.value).type?null:t}(v);if(null!=q){h(p,f);var C,S=[],w=[];for(C=l(S,t,q),x=x||C,d=0;d<S.length;d++)u(f,[r(i(S[d],v),v)],v,n,w);f=w,p=[]}else p.push(v)}else{for(x=!0,m=[],h(p,f),a=0;a<f.length;a++)if(g=f[a],0===t.length)g.length>0&&g[0].elements.push(new s(v.combinator,"",v.index,v.currentFileInfo)),m.push(g);else for(d=0;d<t.length;d++){var _=c(g,t[d],v,n);m.push(_)}f=m,p=[]}for(h(p,f),o=0;o<f.length;o++)(y=f[o].length)>0&&(e.push(f[o]),b=f[o][y-1],f[o][y-1]=b.createDerived(b.elements,n.extendList));return x}function c(e,t,n,i){var r,o,a;if(r=[],e.length>0?(o=(r=e.slice(0)).pop(),a=i.createDerived(o.elements.slice(0))):a=i.createDerived([]),t.length>0){var l=n.combinator,c=t[0].elements[0];l.emptyOrWhitespace&&!c.combinator.emptyOrWhitespace&&(l=c.combinator),a.elements.push(new s(l,c.value,n.index,n.currentFileInfo)),a.elements=a.elements.concat(t[0].elements.slice(1))}return 0!==a.elements.length&&r.push(a),t.length>1&&(r=r.concat(t.slice(1))),r}function u(e,t,n,i,r){var o;for(o=0;o<e.length;o++){var s=c(e[o],t,n,i);r.push(s)}return r}function h(e,t){var n,i;if(0!==e.length)if(0!==t.length)for(n=0;n<t.length;n++)(i=t[n]).length>0?i[i.length-1]=i[i.length-1].createDerived(i[i.length-1].elements.concat(e)):i.push(new o(e));else t.push([new o(e)])}var d,p;if(p=[],!l(p,t,n))if(t.length>0)for(p=[],d=0;d<t.length;d++)p.push(t[d].concat(n));else p=[[n]];for(d=0;d<p.length;d++)e.push(p[d])},t.exports=d},{"../contexts":10,"../functions/default":19,"../functions/function-registry":21,"./debug-info":53,"./element":57,"./node":69,"./paren":71,"./rule":73,"./selector":76}],76:[function(e,t,n){var i=e("./node"),r=e("./element"),o=function(e,t,n,i,r,o){this.elements=e,this.extendList=t,this.condition=n,this.currentFileInfo=r||{},this.isReferenced=o,n||(this.evaldCondition=!0)};(o.prototype=new i).type="Selector",o.prototype.accept=function(e){this.elements&&(this.elements=e.visitArray(this.elements)),this.extendList&&(this.extendList=e.visitArray(this.extendList)),this.condition&&(this.condition=e.visit(this.condition))},o.prototype.createDerived=function(e,t,n){n=null!=n?n:this.evaldCondition;var i=new o(e,t||this.extendList,null,this.index,this.currentFileInfo,this.isReferenced);return i.evaldCondition=n,i.mediaEmpty=this.mediaEmpty,i},o.prototype.createEmptySelectors=function(){var e=new r("","&",this.index,this.currentFileInfo),t=[new o([e],null,null,this.index,this.currentFileInfo)];return t[0].mediaEmpty=!0,t},o.prototype.match=function(e){var t,n,i=this.elements,r=i.length;if(e.CacheElements(),0===(t=e._elements.length)||r<t)return 0;for(n=0;n<t;n++)if(i[n].value!==e._elements[n])return 0;return t},o.prototype.CacheElements=function(){if(!this._elements){var e=this.elements.map(function(e){return e.combinator.value+(e.value.value||e.value)}).join("").match(/[,&#\*\.\w-]([\w-]|(\\.))*/g);e?"&"===e[0]&&e.shift():e=[],this._elements=e}},o.prototype.isJustParentSelector=function(){return!this.mediaEmpty&&1===this.elements.length&&"&"===this.elements[0].value&&(" "===this.elements[0].combinator.value||""===this.elements[0].combinator.value)},o.prototype.eval=function(e){var t=this.condition&&this.condition.eval(e),n=this.elements,i=this.extendList;return n=n&&n.map(function(t){return t.eval(e)}),i=i&&i.map(function(t){return t.eval(e)}),this.createDerived(n,i,t)},o.prototype.genCSS=function(e,t){var n;if(e&&e.firstSelector||""!==this.elements[0].combinator.value||t.add(" ",this.currentFileInfo,this.index),!this._css)for(n=0;n<this.elements.length;n++)this.elements[n].genCSS(e,t)},o.prototype.markReferenced=function(){this.isReferenced=!0},o.prototype.getIsReferenced=function(){return!this.currentFileInfo.reference||this.isReferenced},o.prototype.getIsOutput=function(){return this.evaldCondition},t.exports=o},{"./element":57,"./node":69}],77:[function(e,t,n){var i=e("./node"),r=function(e){this.value=e};(r.prototype=new i).type="UnicodeDescriptor",t.exports=r},{"./node":69}],78:[function(e,t,n){var i=e("./node"),r=e("../data/unit-conversions"),o=function(e,t,n){this.numerator=e?e.slice(0).sort():[],this.denominator=t?t.slice(0).sort():[],n?this.backupUnit=n:e&&e.length&&(this.backupUnit=e[0])};(o.prototype=new i).type="Unit",o.prototype.clone=function(){return new o(this.numerator.slice(0),this.denominator.slice(0),this.backupUnit)},o.prototype.genCSS=function(e,t){var n=e&&e.strictUnits;1===this.numerator.length?t.add(this.numerator[0]):!n&&this.backupUnit?t.add(this.backupUnit):!n&&this.denominator.length&&t.add(this.denominator[0])},o.prototype.toString=function(){var e,t=this.numerator.join("*");for(e=0;e<this.denominator.length;e++)t+="/"+this.denominator[e];return t},o.prototype.compare=function(e){return this.is(e.toString())?0:void 0},o.prototype.is=function(e){return this.toString().toUpperCase()===e.toUpperCase()},o.prototype.isLength=function(){return Boolean(this.toCSS().match(/px|em|%|in|cm|mm|pc|pt|ex/))},o.prototype.isEmpty=function(){return 0===this.numerator.length&&0===this.denominator.length},o.prototype.isSingular=function(){return this.numerator.length<=1&&0===this.denominator.length},o.prototype.map=function(e){var t;for(t=0;t<this.numerator.length;t++)this.numerator[t]=e(this.numerator[t],!1);for(t=0;t<this.denominator.length;t++)this.denominator[t]=e(this.denominator[t],!0)},o.prototype.usedUnits=function(){var e,t,n={};t=function(t){return e.hasOwnProperty(t)&&!n[i]&&(n[i]=t),t};for(var i in r)r.hasOwnProperty(i)&&(e=r[i],this.map(t));return n},o.prototype.cancel=function(){var e,t,n={};for(t=0;t<this.numerator.length;t++)n[e=this.numerator[t]]=(n[e]||0)+1;for(t=0;t<this.denominator.length;t++)n[e=this.denominator[t]]=(n[e]||0)-1;this.numerator=[],this.denominator=[];for(e in n)if(n.hasOwnProperty(e)){var i=n[e];if(i>0)for(t=0;t<i;t++)this.numerator.push(e);else if(i<0)for(t=0;t<-i;t++)this.denominator.push(e)}this.numerator.sort(),this.denominator.sort()},t.exports=o},{"../data/unit-conversions":13,"./node":69}],79:[function(e,t,n){var i=e("./node"),r=function(e,t,n,i){this.value=e,this.currentFileInfo=n,this.index=t,this.isEvald=i};(r.prototype=new i).type="Url",r.prototype.accept=function(e){this.value=e.visit(this.value)},r.prototype.genCSS=function(e,t){t.add("url("),this.value.genCSS(e,t),t.add(")")},r.prototype.eval=function(e){var t,n=this.value.eval(e);if(!this.isEvald&&((t=this.currentFileInfo&&this.currentFileInfo.rootpath)&&"string"==typeof n.value&&e.isPathRelative(n.value)&&(n.quote||(t=t.replace(/[\(\)'"\s]/g,function(e){return"\\"+e})),n.value=t+n.value),n.value=e.normalizePath(n.value),e.urlArgs&&!n.value.match(/^\s*data:/))){var i=(-1===n.value.indexOf("?")?"?":"&")+e.urlArgs;-1!==n.value.indexOf("#")?n.value=n.value.replace("#",i+"#"):n.value+=i}return new r(n,this.index,this.currentFileInfo,!0)},t.exports=r},{"./node":69}],80:[function(e,t,n){var i=e("./node"),r=function(e){if(this.value=e,!e)throw new Error("Value requires an array argument")};(r.prototype=new i).type="Value",r.prototype.accept=function(e){this.value&&(this.value=e.visitArray(this.value))},r.prototype.eval=function(e){return 1===this.value.length?this.value[0].eval(e):new r(this.value.map(function(t){return t.eval(e)}))},r.prototype.genCSS=function(e,t){var n;for(n=0;n<this.value.length;n++)this.value[n].genCSS(e,t),n+1<this.value.length&&t.add(e&&e.compress?",":", ")},t.exports=r},{"./node":69}],81:[function(e,t,n){var i=e("./node"),r=function(e,t,n){this.name=e,this.index=t,this.currentFileInfo=n||{}};(r.prototype=new i).type="Variable",r.prototype.eval=function(e){var t,n=this.name;if(0===n.indexOf("@@")&&(n="@"+new r(n.slice(1),this.index,this.currentFileInfo).eval(e).value),this.evaluating)throw{type:"Name",message:"Recursive variable definition for "+n,filename:this.currentFileInfo.filename,index:this.index};if(this.evaluating=!0,t=this.find(e.frames,function(t){var i=t.variable(n);if(i)return i.important&&(e.importantScope[e.importantScope.length-1].important=i.important),i.value.eval(e)}))return this.evaluating=!1,t;throw{type:"Name",message:"variable "+n+" is undefined",filename:this.currentFileInfo.filename,index:this.index}},r.prototype.find=function(e,t){for(var n,i=0;i<e.length;i++)if(n=t.call(e,e[i]))return n;return null},t.exports=r},{"./node":69}],82:[function(e,t,n){t.exports={getLocation:function(e,t){for(var n=e+1,i=null,r=-1;--n>=0&&"\n"!==t.charAt(n);)r++;return"number"==typeof e&&(i=(t.slice(0,e).match(/\n/g)||"").length),{line:i,column:r}}}},{}],83:[function(e,t,n){var i=e("../tree"),r=e("./visitor"),o=e("../logger"),s=function(){this._visitor=new r(this),this.contexts=[],this.allExtendsStack=[[]]};s.prototype={run:function(e){return e=this._visitor.visit(e),e.allExtends=this.allExtendsStack[0],e},visitRule:function(e,t){t.visitDeeper=!1},visitMixinDefinition:function(e,t){t.visitDeeper=!1},visitRuleset:function(e,t){if(!e.root){var n,r,o,s,a=[],l=e.rules,c=l?l.length:0;for(n=0;n<c;n++)e.rules[n]instanceof i.Extend&&(a.push(l[n]),e.extendOnEveryPath=!0);var u=e.paths;for(n=0;n<u.length;n++){var h=u[n],d=h[h.length-1].extendList;for((s=d?d.slice(0).concat(a):a)&&(s=s.map(function(e){return e.clone()})),r=0;r<s.length;r++)this.foundExtends=!0,(o=s[r]).findSelfSelectors(h),o.ruleset=e,0===r&&(o.firstExtendOnThisSelectorPath=!0),this.allExtendsStack[this.allExtendsStack.length-1].push(o)}this.contexts.push(e.selectors)}},visitRulesetOut:function(e){e.root||(this.contexts.length=this.contexts.length-1)},visitMedia:function(e,t){e.allExtends=[],this.allExtendsStack.push(e.allExtends)},visitMediaOut:function(e){this.allExtendsStack.length=this.allExtendsStack.length-1},visitDirective:function(e,t){e.allExtends=[],this.allExtendsStack.push(e.allExtends)},visitDirectiveOut:function(e){this.allExtendsStack.length=this.allExtendsStack.length-1}};var a=function(){this._visitor=new r(this)};a.prototype={run:function(e){var t=new s;if(this.extendIndicies={},t.run(e),!t.foundExtends)return e;e.allExtends=e.allExtends.concat(this.doExtendChaining(e.allExtends,e.allExtends)),this.allExtendsStack=[e.allExtends];var n=this._visitor.visit(e);return this.checkExtendsForNonMatched(e.allExtends),n},checkExtendsForNonMatched:function(e){var t=this.extendIndicies;e.filter(function(e){return!e.hasFoundMatches&&1==e.parent_ids.length}).forEach(function(e){var n="_unknown_";try{n=e.selector.toCSS({})}catch(e){}t[e.index+" "+n]||(t[e.index+" "+n]=!0,o.warn("extend '"+n+"' has no matches"))})},doExtendChaining:function(e,t,n){var r,o,s,a,l,c,u,h,d=[],p=this;for(n=n||0,r=0;r<e.length;r++)for(o=0;o<t.length;o++)c=e[r],u=t[o],c.parent_ids.indexOf(u.object_id)>=0||(l=[u.selfSelectors[0]],(s=p.findMatch(c,l)).length&&(c.hasFoundMatches=!0,c.selfSelectors.forEach(function(e){a=p.extendSelector(s,l,e),(h=new i.Extend(u.selector,u.option,0)).selfSelectors=a,a[a.length-1].extendList=[h],d.push(h),h.ruleset=u.ruleset,h.parent_ids=h.parent_ids.concat(u.parent_ids,c.parent_ids),u.firstExtendOnThisSelectorPath&&(h.firstExtendOnThisSelectorPath=!0,u.ruleset.paths.push(a))})));if(d.length){if(this.extendChainCount++,n>100){var f="{unable to calculate}",m="{unable to calculate}";try{f=d[0].selfSelectors[0].toCSS(),m=d[0].selector.toCSS()}catch(e){}throw{message:"extend circular reference detected. One of the circular extends is currently:"+f+":extend("+m+")"}}return d.concat(p.doExtendChaining(d,t,n+1))}return d},visitRule:function(e,t){t.visitDeeper=!1},visitMixinDefinition:function(e,t){t.visitDeeper=!1},visitSelector:function(e,t){t.visitDeeper=!1},visitRuleset:function(e,t){if(!e.root){var n,i,r,o,s=this.allExtendsStack[this.allExtendsStack.length-1],a=[],l=this;for(r=0;r<s.length;r++)for(i=0;i<e.paths.length;i++)if(o=e.paths[i],!e.extendOnEveryPath){var c=o[o.length-1].extendList;c&&c.length||(n=this.findMatch(s[r],o)).length&&(s[r].hasFoundMatches=!0,s[r].selfSelectors.forEach(function(e){a.push(l.extendSelector(n,o,e))}))}e.paths=e.paths.concat(a)}},findMatch:function(e,t){var n,i,r,o,s,a,l,c=this,u=e.selector.elements,h=[],d=[];for(n=0;n<t.length;n++)for(i=t[n],r=0;r<i.elements.length;r++)for(o=i.elements[r],(e.allowBefore||0===n&&0===r)&&h.push({pathIndex:n,index:r,matched:0,initialCombinator:o.combinator}),a=0;a<h.length;a++)l=h[a],""===(s=o.combinator.value)&&0===r&&(s=" "),!c.isElementValuesEqual(u[l.matched].value,o.value)||l.matched>0&&u[l.matched].combinator.value!==s?l=null:l.matched++,l&&(l.finished=l.matched===u.length,l.finished&&!e.allowAfter&&(r+1<i.elements.length||n+1<t.length)&&(l=null)),l?l.finished&&(l.length=u.length,l.endPathIndex=n,l.endPathElementIndex=r+1,h.length=0,d.push(l)):(h.splice(a,1),a--);return d},isElementValuesEqual:function(e,t){if("string"==typeof e||"string"==typeof t)return e===t;if(e instanceof i.Attribute)return e.op===t.op&&e.key===t.key&&(e.value&&t.value?(e=e.value.value||e.value,t=t.value.value||t.value,e===t):!e.value&&!t.value);if(e=e.value,t=t.value,e instanceof i.Selector){if(!(t instanceof i.Selector)||e.elements.length!==t.elements.length)return!1;for(var n=0;n<e.elements.length;n++){if(e.elements[n].combinator.value!==t.elements[n].combinator.value&&(0!==n||(e.elements[n].combinator.value||" ")!==(t.elements[n].combinator.value||" ")))return!1;if(!this.isElementValuesEqual(e.elements[n].value,t.elements[n].value))return!1}return!0}return!1},extendSelector:function(e,t,n){var r,o,s,a,l,c=0,u=0,h=[];for(r=0;r<e.length;r++)o=t[(a=e[r]).pathIndex],s=new i.Element(a.initialCombinator,n.elements[0].value,n.elements[0].index,n.elements[0].currentFileInfo),a.pathIndex>c&&u>0&&(h[h.length-1].elements=h[h.length-1].elements.concat(t[c].elements.slice(u)),u=0,c++),l=o.elements.slice(u,a.index).concat([s]).concat(n.elements.slice(1)),c===a.pathIndex&&r>0?h[h.length-1].elements=h[h.length-1].elements.concat(l):(h=h.concat(t.slice(c,a.pathIndex))).push(new i.Selector(l)),c=a.endPathIndex,(u=a.endPathElementIndex)>=t[c].elements.length&&(u=0,c++);return c<t.length&&u>0&&(h[h.length-1].elements=h[h.length-1].elements.concat(t[c].elements.slice(u)),c++),h=h.concat(t.slice(c,t.length))},visitRulesetOut:function(e){},visitMedia:function(e,t){var n=e.allExtends.concat(this.allExtendsStack[this.allExtendsStack.length-1]);n=n.concat(this.doExtendChaining(n,e.allExtends)),this.allExtendsStack.push(n)},visitMediaOut:function(e){var t=this.allExtendsStack.length-1;this.allExtendsStack.length=t},visitDirective:function(e,t){var n=e.allExtends.concat(this.allExtendsStack[this.allExtendsStack.length-1]);n=n.concat(this.doExtendChaining(n,e.allExtends)),this.allExtendsStack.push(n)},visitDirectiveOut:function(e){var t=this.allExtendsStack.length-1;this.allExtendsStack.length=t}},t.exports=a},{"../logger":32,"../tree":61,"./visitor":89}],84:[function(e,t,n){function i(e){this.imports=[],this.variableImports=[],this._onSequencerEmpty=e,this._currentDepth=0}i.prototype.addImport=function(e){var t=this,n={callback:e,args:null,isReady:!1};return this.imports.push(n),function(){n.args=Array.prototype.slice.call(arguments,0),n.isReady=!0,t.tryRun()}},i.prototype.addVariableImport=function(e){this.variableImports.push(e)},i.prototype.tryRun=function(){this._currentDepth++;try{for(;;){for(;this.imports.length>0;){var e=this.imports[0];if(!e.isReady)return;this.imports=this.imports.slice(1),e.callback.apply(null,e.args)}if(0===this.variableImports.length)break;var t=this.variableImports[0];this.variableImports=this.variableImports.slice(1),t()}}finally{this._currentDepth--}0===this._currentDepth&&this._onSequencerEmpty&&this._onSequencerEmpty()},t.exports=i},{}],85:[function(e,t,n){var i=e("../contexts"),r=e("./visitor"),o=e("./import-sequencer"),s=function(e,t){this._visitor=new r(this),this._importer=e,this._finish=t,this.context=new i.Eval,this.importCount=0,this.onceFileDetectionMap={},this.recursionDetector={},this._sequencer=new o(this._onSequencerEmpty.bind(this))};s.prototype={isReplacing:!1,run:function(e){try{this._visitor.visit(e)}catch(e){this.error=e}this.isFinished=!0,this._sequencer.tryRun()},_onSequencerEmpty:function(){this.isFinished&&this._finish(this.error)},visitImport:function(e,t){var n=e.options.inline;if(!e.css||n){var r=new i.Eval(this.context,this.context.frames.slice(0)),o=r.frames[0];this.importCount++,e.isVariableImport()?this._sequencer.addVariableImport(this.processImportNode.bind(this,e,r,o)):this.processImportNode(e,r,o)}t.visitDeeper=!1},processImportNode:function(e,t,n){var i,r=e.options.inline;try{i=e.evalForImport(t)}catch(t){t.filename||(t.index=e.index,t.filename=e.currentFileInfo.filename),e.css=!0,e.error=t}if(!i||i.css&&!r)this.importCount--,this.isFinished&&this._sequencer.tryRun();else{i.options.multiple&&(t.importMultiple=!0);for(var o=void 0===i.css,s=0;s<n.rules.length;s++)if(n.rules[s]===e){n.rules[s]=i;break}var a=this.onImported.bind(this,i,t),l=this._sequencer.addImport(a);this._importer.push(i.getPath(),o,i.currentFileInfo,i.options,l)}},onImported:function(e,t,n,i,r,o){n&&(n.filename||(n.index=e.index,n.filename=e.currentFileInfo.filename),this.error=n);var s=this,a=e.options.inline,l=e.options.plugin,c=e.options.optional,u=r||o in s.recursionDetector;if(t.importMultiple||(e.skip=!!u||function(){return o in s.onceFileDetectionMap||(s.onceFileDetectionMap[o]=!0,!1)}),!o&&c&&(e.skip=!0),i&&(e.root=i,e.importedFilename=o,!a&&!l&&(t.importMultiple||!u))){s.recursionDetector[o]=!0;var h=this.context;this.context=t;try{this._visitor.visit(i)}catch(n){this.error=n}this.context=h}s.importCount--,s.isFinished&&s._sequencer.tryRun()},visitRule:function(e,t){"DetachedRuleset"===e.value.type?this.context.frames.unshift(e):t.visitDeeper=!1},visitRuleOut:function(e){"DetachedRuleset"===e.value.type&&this.context.frames.shift()},visitDirective:function(e,t){this.context.frames.unshift(e)},visitDirectiveOut:function(e){this.context.frames.shift()},visitMixinDefinition:function(e,t){this.context.frames.unshift(e)},visitMixinDefinitionOut:function(e){this.context.frames.shift()},visitRuleset:function(e,t){this.context.frames.unshift(e)},visitRulesetOut:function(e){this.context.frames.shift()},visitMedia:function(e,t){this.context.frames.unshift(e.rules[0])},visitMediaOut:function(e){this.context.frames.shift()}},t.exports=s},{"../contexts":10,"./import-sequencer":84,"./visitor":89}],86:[function(e,t,n){var i={Visitor:e("./visitor"),ImportVisitor:e("./import-visitor"),ExtendVisitor:e("./extend-visitor"),JoinSelectorVisitor:e("./join-selector-visitor"),ToCSSVisitor:e("./to-css-visitor")};t.exports=i},{"./extend-visitor":83,"./import-visitor":85,"./join-selector-visitor":87,"./to-css-visitor":88,"./visitor":89}],87:[function(e,t,n){var i=e("./visitor"),r=function(){this.contexts=[[]],this._visitor=new i(this)};r.prototype={run:function(e){return this._visitor.visit(e)},visitRule:function(e,t){t.visitDeeper=!1},visitMixinDefinition:function(e,t){t.visitDeeper=!1},visitRuleset:function(e,t){var n,i=this.contexts[this.contexts.length-1],r=[];this.contexts.push(r),e.root||((n=e.selectors)&&(n=n.filter(function(e){return e.getIsOutput()}),e.selectors=n.length?n:n=null,n&&e.joinSelectors(r,i,n)),n||(e.rules=null),e.paths=r)},visitRulesetOut:function(e){this.contexts.length=this.contexts.length-1},visitMedia:function(e,t){var n=this.contexts[this.contexts.length-1];e.rules[0].root=0===n.length||n[0].multiMedia},visitDirective:function(e,t){var n=this.contexts[this.contexts.length-1];e.rules&&e.rules.length&&(e.rules[0].root=e.isRooted||0===n.length||null)}},t.exports=r},{"./visitor":89}],88:[function(e,t,n){var i=e("../tree"),r=e("./visitor"),o=function(e){this._visitor=new r(this),this._context=e};o.prototype={isReplacing:!0,run:function(e){return this._visitor.visit(e)},visitRule:function(e,t){if(!e.variable)return e},visitMixinDefinition:function(e,t){e.frames=[]},visitExtend:function(e,t){},visitComment:function(e,t){if(!e.isSilent(this._context))return e},visitMedia:function(e,t){if(e.accept(this._visitor),t.visitDeeper=!1,e.rules.length)return e},visitImport:function(e,t){if(void 0===e.path.currentFileInfo.reference||!e.css)return e},visitDirective:function(e,t){if("@charset"===e.name){if(!e.getIsReferenced())return;if(this.charset){if(e.debugInfo){var n=new i.Comment("/* "+e.toCSS(this._context).replace(/\n/g,"")+" */\n");return n.debugInfo=e.debugInfo,this._visitor.visit(n)}return}this.charset=!0}if(e.rules&&e.rules.length){if(this._mergeRules(e.rules[0].rules),e.accept(this._visitor),t.visitDeeper=!1,e.getIsReferenced())return e;if(!e.rules||!e.rules.length)return;if(function(e){var t,n=e.rules;1!==n.length||n[0].paths&&0!==n[0].paths.length||(n=n[0].rules);for(var i=0;i<n.length;i++)if((t=n[i]).getIsReferenced&&t.getIsReferenced())return!0;return!1}(e))return e.markReferenced(),e}else if(e.getIsReferenced())return e},checkPropertiesInRoot:function(e){for(var t,n=0;n<e.length;n++)if((t=e[n])instanceof i.Rule&&!t.variable)throw{message:"properties must be inside selector blocks, they cannot be in the root.",index:t.index,filename:t.currentFileInfo?t.currentFileInfo.filename:null}},visitRuleset:function(e,t){var n,r=[];if(e.firstRoot&&this.checkPropertiesInRoot(e.rules),e.root)e.accept(this._visitor),t.visitDeeper=!1,(e.firstRoot||e.rules&&e.rules.length>0)&&r.splice(0,0,e);else{e.paths&&(e.paths=e.paths.filter(function(e){var t;for(" "===e[0].elements[0].combinator.value&&(e[0].elements[0].combinator=new i.Combinator("")),t=0;t<e.length;t++)if(e[t].getIsReferenced()&&e[t].getIsOutput())return!0;return!1}));for(var o=e.rules,s=o?o.length:0,a=0;a<s;)(n=o[a])&&n.rules?(r.push(this._visitor.visit(n)),o.splice(a,1),s--):a++;s>0?e.accept(this._visitor):e.rules=null,t.visitDeeper=!1,(o=e.rules)&&(this._mergeRules(o),o=e.rules),o&&(this._removeDuplicateRules(o),o=e.rules),o&&o.length>0&&e.paths.length>0&&r.splice(0,0,e)}return 1===r.length?r[0]:r},_removeDuplicateRules:function(e){if(e){var t,n,r,o={};for(r=e.length-1;r>=0;r--)if((n=e[r])instanceof i.Rule)if(o[n.name]){(t=o[n.name])instanceof i.Rule&&(t=o[n.name]=[o[n.name].toCSS(this._context)]);var s=n.toCSS(this._context);-1!==t.indexOf(s)?e.splice(r,1):t.push(s)}else o[n.name]=n}},_mergeRules:function(e){if(e){for(var t,n,r,o={},s=0;s<e.length;s++)(n=e[s])instanceof i.Rule&&n.merge&&(r=[n.name,n.important?"!":""].join(","),o[r]?e.splice(s--,1):o[r]=[],o[r].push(n));Object.keys(o).map(function(e){function r(e){return new i.Expression(e.map(function(e){return e.value}))}if((t=o[e]).length>1){n=t[0];var s=[],a=[];t.map(function(e){"+"===e.merge&&(a.length>0&&s.push(r(a)),a=[]),a.push(e)}),s.push(r(a)),n.value=function(e){return new i.Value(e.map(function(e){return e}))}(s)}})}},visitAnonymous:function(e,t){if(e.getIsReferenced())return e.accept(this._visitor),e}},t.exports=o},{"../tree":61,"./visitor":89}],89:[function(e,t,n){function i(e){return e}function r(e,t){var n,i;for(n in e)if(e.hasOwnProperty(n))switch(typeof(i=e[n])){case"function":i.prototype&&i.prototype.type&&(i.prototype.typeIndex=t++);break;case"object":t=r(i,t)}return t}var o=e("../tree"),s={visitDeeper:!0},a=!1,l=function(e){this._implementation=e,this._visitFnCache=[],a||(r(o,1),a=!0)};l.prototype={visit:function(e){if(!e)return e;var t=e.typeIndex;if(!t)return e;var n,r=this._visitFnCache,o=this._implementation,a=t<<1,l=1|a,c=r[a],u=r[l],h=s;if(h.visitDeeper=!0,c||(c=o[n="visit"+e.type]||i,u=o[n+"Out"]||i,r[a]=c,r[l]=u),c!==i){var d=c.call(o,e,h);o.isReplacing&&(e=d)}return h.visitDeeper&&e&&e.accept&&e.accept(this),u!=i&&u.call(o,e),e},visitArray:function(e,t){if(!e)return e;var n,i=e.length;if(t||!this._implementation.isReplacing){for(n=0;n<i;n++)this.visit(e[n]);return e}var r=[];for(n=0;n<i;n++){var o=this.visit(e[n]);void 0!==o&&(o.splice?o.length&&this.flatten(o,r):r.push(o))}return r},flatten:function(e,t){t||(t=[]);var n,i,r,o,s,a;for(i=0,n=e.length;i<n;i++)if(void 0!==(r=e[i]))if(r.splice)for(s=0,o=r.length;s<o;s++)void 0!==(a=r[s])&&(a.splice?a.length&&this.flatten(a,t):t.push(a));else t.push(r);return t}},t.exports=l},{"../tree":61}],90:[function(e,t,n){function i(){if(!a){a=!0;for(var e,t=s.length;t;){e=s,s=[];for(var n=-1;++n<t;)e[n]();t=s.length}a=!1}}function r(){}var o=t.exports={},s=[],a=!1;o.nextTick=function(e){s.push(e),a||setTimeout(i,0)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=r,o.addListener=r,o.once=r,o.off=r,o.removeListener=r,o.removeAllListeners=r,o.emit=r,o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],91:[function(e,t,n){"use strict";function i(e,t,n,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=i}function r(e,t,n){var i=!1;try{e(function(e){i||(i=!0,t(e))},function(e){i||(i=!0,n(e))})}catch(e){if(i)return;i=!0,n(e)}}var o=e("asap");t.exports=function(e){function t(e){null!==l?o(function(){var t=l?e.onFulfilled:e.onRejected;if(null!==t){var n;try{n=t(c)}catch(t){return void e.reject(t)}e.resolve(n)}else(l?e.resolve:e.reject)(c)}):u.push(e)}function n(e){try{if(e===h)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var t=e.then;if("function"==typeof t)return void r(t.bind(e),n,s)}l=!0,c=e,a()}catch(e){s(e)}}function s(e){l=!1,c=e,a()}function a(){for(var e=0,n=u.length;e<n;e++)t(u[e]);u=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");var l=null,c=null,u=[],h=this;this.then=function(e,n){return new h.constructor(function(r,o){t(new i(e,n,r,o))})},r(e,n,s)}},{asap:93}],92:[function(e,t,n){"use strict";function i(e){this.then=function(t){return"function"!=typeof t?this:new r(function(n,i){o(function(){try{n(t(e))}catch(e){i(e)}})})}}var r=e("./core.js"),o=e("asap");t.exports=r,i.prototype=r.prototype;var s=new i(!0),a=new i(!1),l=new i(null),c=new i(void 0),u=new i(0),h=new i("");r.resolve=function(e){if(e instanceof r)return e;if(null===e)return l;if(void 0===e)return c;if(!0===e)return s;if(!1===e)return a;if(0===e)return u;if(""===e)return h;if("object"==typeof e||"function"==typeof e)try{var t=e.then;if("function"==typeof t)return new r(t.bind(e))}catch(e){return new r(function(t,n){n(e)})}return new i(e)},r.all=function(e){var t=Array.prototype.slice.call(e);return new r(function(e,n){function i(o,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,function(e){i(o,e)},n)}t[o]=s,0==--r&&e(t)}catch(e){n(e)}}if(0===t.length)return e([]);for(var r=t.length,o=0;o<t.length;o++)i(o,t[o])})},r.reject=function(e){return new r(function(t,n){n(e)})},r.race=function(e){return new r(function(t,n){e.forEach(function(e){r.resolve(e).then(t,n)})})},r.prototype.catch=function(e){return this.then(null,e)}},{"./core.js":91,asap:93}],93:[function(e,t,n){(function(e){function n(){for(;i.next;){var e=(i=i.next).task;i.task=void 0;var t=i.domain;t&&(i.domain=void 0,t.enter());try{e()}catch(e){if(a)throw t&&t.exit(),setTimeout(n,0),t&&t.enter(),e;setTimeout(function(){throw e},0)}t&&t.exit()}o=!1}var i={task:void 0,next:null},r=i,o=!1,s=void 0,a=!1;if(void 0!==e&&e.nextTick)a=!0,s=function(){e.nextTick(n)};else if("function"==typeof setImmediate)s="undefined"!=typeof window?setImmediate.bind(window,n):function(){setImmediate(n)};else if("undefined"!=typeof MessageChannel){var l=new MessageChannel;l.port1.onmessage=n,s=function(){l.port2.postMessage(0)}}else s=function(){setTimeout(n,0)};t.exports=function(t){r=r.next={task:t,domain:a&&e.domain,next:null},o||(o=!0,s())}}).call(this,e("_process"))},{_process:90}],94:[function(e,t,n){"function"!=typeof Promise.prototype.done&&(Promise.prototype.done=function(e,t){(arguments.length?this.then.apply(this,arguments):this).then(null,function(e){setTimeout(function(){throw e},0)})})},{}],95:[function(e,t,n){e("asap");"undefined"==typeof Promise&&(Promise=e("./lib/core.js"),e("./lib/es6-extensions.js")),e("./polyfill-done.js")},{"./lib/core.js":91,"./lib/es6-extensions.js":92,"./polyfill-done.js":94,asap:93}]},{},[2])(2)}),function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return window.setTimeout(e,20)},t=function(n,i){function r(){this.q=[],this.add=function(e){this.q.push(e)};var e,t;this.call=function(){for(e=0,t=this.q.length;e<t;e++)this.q[e].call()}}function o(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):e.style[t]}function s(t,n){if(t.resizedAttached){if(t.resizedAttached)return void t.resizedAttached.add(n)}else t.resizedAttached=new r,t.resizedAttached.add(n);t.resizeSensor=document.createElement("div"),t.resizeSensor.className="resize-sensor";var i="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;",s="position: absolute; left: 0; top: 0; transition: 0s;";t.resizeSensor.style.cssText=i,t.resizeSensor.innerHTML='<div class="resize-sensor-expand" style="'+i+'"><div style="'+s+'"></div></div><div class="resize-sensor-shrink" style="'+i+'"><div style="'+s+' width: 200%; height: 200%"></div></div>',t.appendChild(t.resizeSensor),"static"==o(t,"position")&&(t.style.position="relative");var a=t.resizeSensor.childNodes[0],l=a.childNodes[0],c=t.resizeSensor.childNodes[1],u=function(){l.style.width=1e5+"px",l.style.height=1e5+"px",a.scrollLeft=1e5,a.scrollTop=1e5,c.scrollLeft=1e5,c.scrollTop=1e5};u();var h=!1,d=function(){t.resizedAttached&&(h&&(t.resizedAttached.call(),h=!1),e(d))};e(d);var p,f,m,g,v=function(){(m=t.offsetWidth)==p&&(g=t.offsetHeight)==f||(h=!0,p=m,f=g),u()},y=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n)};y(a,"scroll",v),y(c,"scroll",v)}var a=Object.prototype.toString.call(n),l="[object Array]"===a||"[object NodeList]"===a||"[object HTMLCollection]"===a||"undefined"!=typeof jQuery&&n instanceof jQuery||"undefined"!=typeof Elements&&n instanceof Elements;if(l)for(var c=0,u=n.length;c<u;c++)s(n[c],i);else s(n,i);this.detach=function(){if(l)for(var e=0,i=n.length;e<i;e++)t.detach(n[e]);else t.detach(n)}};t.detach=function(e){e.resizeSensor&&(e.removeChild(e.resizeSensor),delete e.resizeSensor,delete e.resizedAttached)},"undefined"!=typeof module&&void 0!==module.exports?module.exports=t:window.ResizeSensor=t}(),define("resize-sensor",function(){}),function(){var e=window.ResizeSensor;"undefined"!=typeof module&&void 0!==module.exports&&(e=require("./ResizeSensor"));var t=this.ElementQueries=function(){function n(e){e||(e=document.documentElement);var t=getComputedStyle(e,"fontSize");return parseFloat(t)||16}function i(e,t){var i=t.replace(/[0-9]*/,"");switch(t=parseFloat(t),i){case"px":return t;case"em":return t*n(e);case"rem":return t*n();case"vw":return t*document.documentElement.clientWidth/100;case"vh":return t*document.documentElement.clientHeight/100;case"vmin":case"vmax":var r=document.documentElement.clientWidth/100,o=document.documentElement.clientHeight/100;return t*(0,Math["vmin"===i?"min":"max"])(r,o);default:return t}}function r(e){this.element=e,this.options={};var t,n,r,o,s,a,l,c=0,u=0;this.addOption=function(e){var t=[e.mode,e.property,e.value].join(",");this.options[t]=e};var h=["min-width","min-height","max-width","max-height"];this.call=function(){c=this.element.offsetWidth,u=this.element.offsetHeight,s={};for(t in this.options)this.options.hasOwnProperty(t)&&(n=this.options[t],r=i(this.element,n.value),o="width"==n.property?c:u,l=n.mode+"-"+n.property,a="","min"==n.mode&&o>=r&&(a+=n.value),"max"==n.mode&&o<=r&&(a+=n.value),s[l]||(s[l]=""),a&&-1===(" "+s[l]+" ").indexOf(" "+a+" ")&&(s[l]+=" "+a));for(var e in h)h.hasOwnProperty(e)&&(s[h[e]]?this.element.setAttribute(h[e],s[h[e]].substr(1)):this.element.removeAttribute(h[e]))}}function o(t,n){t.elementQueriesSetupInformation?t.elementQueriesSetupInformation.addOption(n):(t.elementQueriesSetupInformation=new r(t),t.elementQueriesSetupInformation.addOption(n),t.elementQueriesSensor=new e(t,function(){t.elementQueriesSetupInformation.call()})),t.elementQueriesSetupInformation.call(),p&&f.indexOf(t)<0&&f.push(t)}function s(e,t,n,i){void 0===m[t]&&(m[t]={}),void 0===m[t][n]&&(m[t][n]={}),void 0===m[t][n][i]?m[t][n][i]=e:m[t][n][i]+=","+e}function a(){var e;if(document.querySelectorAll&&(e=document.querySelectorAll.bind(document)),e||"undefined"==typeof $$||(e=$$),e||"undefined"==typeof jQuery||(e=jQuery),!e)throw"No document.querySelectorAll, jQuery or Mootools's $$ found.";return e}function l(){var e=a();for(var t in m)if(m.hasOwnProperty(t))for(var n in m[t])if(m[t].hasOwnProperty(n))for(var i in m[t][n])if(m[t][n].hasOwnProperty(i))for(var r=e(m[t][n][i]),s=0,l=r.length;s<l;s++)o(r[s],{mode:t,property:n,value:i})}function c(t){function n(){var e,n=!1;for(e in i)i.hasOwnProperty(e)&&r[e].minWidth&&t.offsetWidth>r[e].minWidth&&(n=e);if(n||(n=s),a!=n)if(l[n])i[a].style.display="none",i[n].style.display="block",a=n;else{var c=new Image;c.onload=function(){i[n].src=o[n],i[a].style.display="none",i[n].style.display="block",l[n]=!0,a=n},c.src=o[n]}else i[n].src=o[n]}var i=[],r=[],o=[],s=0,a=-1,l=[];for(var c in t.children)if(t.children.hasOwnProperty(c)&&t.children[c].tagName&&"img"===t.children[c].tagName.toLowerCase()){i.push(t.children[c]);var u=t.children[c].getAttribute("min-width")||t.children[c].getAttribute("data-min-width"),h=t.children[c].getAttribute("data-src")||t.children[c].getAttribute("url");o.push(h);var d={minWidth:u};r.push(d),u?t.children[c].style.display="none":(s=i.length-1,t.children[c].style.display="block")}a=s,t.resizeSensor=new e(t,n),n(),p&&f.push(t)}function u(){for(var e=a()("[data-responsive-image],[responsive-image]"),t=0,n=e.length;t<n;t++)c(e[t])}function h(e){var t,n;for(e=e.replace(/'/g,'"');null!==(t=g.exec(e));)for(n=t[1]+t[3],attrs=t[2];null!==(attrMatch=v.exec(attrs));)s(n,attrMatch[1],attrMatch[2],attrMatch[3])}function d(e){var t="";if(e)if("string"==typeof e)-1===(e=e.toLowerCase()).indexOf("min-width")&&-1===e.indexOf("max-width")||h(e);else for(var n=0,i=e.length;n<i;n++)1===e[n].type?-1!==(t=e[n].selectorText||e[n].cssText).indexOf("min-height")||-1!==t.indexOf("max-height")?h(t):-1===t.indexOf("min-width")&&-1===t.indexOf("max-width")||h(t):4===e[n].type&&d(e[n].cssRules||e[n].rules)}var p=!1,f=[],m={},g=/,?[\s\t]*([^,\n]*?)((?:\[[\s\t]*?(?:min|max)-(?:width|height)[\s\t]*?[~$\^]?=[\s\t]*?"[^"]*?"[\s\t]*?])+)([^,\n\s\{]*)/gim,v=/\[[\s\t]*?(min|max)-(width|height)[\s\t]*?[~$\^]?=[\s\t]*?"([^"]*?)"[\s\t]*?]/gim,y=!1;this.init=function(e){p=void 0!==e&&e;for(var t=0,n=document.styleSheets.length;t<n;t++)try{d(document.styleSheets[t].cssRules||document.styleSheets[t].rules||document.styleSheets[t].cssText)}catch(e){if("SecurityError"!==e.name)throw e}if(!y){var i=document.createElement("style");i.type="text/css",i.innerHTML="[responsive-image] > img, [data-responsive-image] {overflow: hidden; padding: 0; } [responsive-image] > img, [data-responsive-image] > img { width: 100%;}",document.getElementsByTagName("head")[0].appendChild(i),y=!0}l(),u()},this.update=function(e){this.init(e)},this.detach=function(){if(!this.withTracking)throw"withTracking is not enabled. We can not detach elements since we don not store it.Use ElementQueries.withTracking = true; before domready or call ElementQueryes.update(true).";for(var e;e=f.pop();)t.detach(e);f=[]}};t.update=function(e){t.instance.update(e)},t.detach=function(e){e.elementQueriesSetupInformation?(e.elementQueriesSensor.detach(),delete e.elementQueriesSetupInformation,delete e.elementQueriesSensor):e.resizeSensor&&(e.resizeSensor.detach(),delete e.resizeSensor)},t.withTracking=!1,t.init=function(){t.instance||(t.instance=new t),t.instance.init(t.withTracking)};var n=function(e){if(document.addEventListener)document.addEventListener("DOMContentLoaded",e,!1);else if(/KHTML|WebKit|iCab/i.test(navigator.userAgent))var t=setInterval(function(){/loaded|complete/i.test(document.readyState)&&(e(),clearInterval(t))},10);else window.onload=e};t.listen=function(){n(t.init)},"undefined"!=typeof module&&void 0!==module.exports?module.exports=t:(window.ElementQueries=t,t.listen())}(),define("element-queries",["resize-sensor"],function(e){return function(){return e.ElementQueries}}(this)),define("extensions.qliktech/widget/widget-styling",["assets/external/less/less","element-queries","core.utils/deferred"],function(e,t,n){function i(e){return l.test(e)}function r(e){t.detach(e);for(var n=0;n<e.children.length;++n)r(e.children[n])}function o(e){(-1===a.indexOf(e.htmlElement.id)||e.template.isDirty&&e.template.isDirty())&&(t.init(),-1===a.indexOf(e.htmlElement.id)&&a.push(e.htmlElement.id)),e.$scope.$on("$destroy",function(){a=a.splice(a.indexOf(e.htmlElement.id),1),r(e.$element[0])})}function s(t,n){var i="#widget"+n+" {"+t+"}";return e.render(i)}var a=[],l=new RegExp("(?:min|max)-(?:width|height)");return{hasAngularBindings:function(e){return/\{{[^}]*}}/im.test(e)},updateLess:function(e,t,r){return t?s(t,r).then(function(t){e.styleElement.innerHTML=t.css,i(t.css)&&o(e)}):(e.styleElement.innerHTML="",n.resolve())},processLess:s,hasElementQuery:i,enableElementQueries:o}}),define("extensions.qliktech/widget/widget-properties",["util"],function(e){function t(e){return e&&0===e.indexOf(q)?e.substring(9):e}function n(e){return e&&0!==e.indexOf(q)?q+e:e}function i(e,t){var n=t.length,i=0,r=!1;return e?(e.forEach(function(e){if(e.ref&&0===e.ref.indexOf(t)){var o=parseInt(e.ref.substring(n));o>i&&(i=o),C[t]&&o===C[t]+1&&(r=!0)}}),C[t]&&!r||(C[t]=i)):C[t]=0,C[t]+=1,t+C[t]}function r(e,t){e&&e.forEach(function(n,i){n.ref===t&&e.splice(i,1)})}function o(e,t){var n=-1;return e&&e.some(function(e,i){if(e.ref===t)return n=i,!0}),n}function s(e,t){return e.settings?e.settings.filter(function(e){return(e.parent||x)===t}).sort(function(e,t){return e.order===t.order?0:!e.order||e.order<t.order?-1:1}):[]}function a(t){var i=e.extend(!0,{},t);return i.type=i.type||"string",i.label=i.label||i.ref,i.defaultValue=i.defaultValue||"boolean"!==i.type&&"","string"!==i.type||i.component||(i.expression=i.expression||"optional"),"text"===t.component?delete i.ref:i.ref=n(i.ref),i}function l(e,t){var n={};return s(e,t).forEach(function(e){n[e.ref]=a(e)}),n}function c(e){d(e,v,{ref:x})}function u(e){return void 0!==e.measures&&(e.measures.max>0||void 0===e.measures.max)}function h(e){return void 0!==e.dimensions&&(e.dimensions.max>0||void 0===e.dimensions.max)}function d(e,t,n){switch(t){case y:e.measures={min:1,max:1};break;case v:e.sections=e.sections||[];var r=n||{};r.type=t,r.ref=r.ref||i(e.sections,t),r.label=r.label||"Settings",e.sections.push(r);break;case b:e.sorting=!0}}function p(e,t,n){t=t.item||t,e.settings||(e.settings=[]),e.sections||c(e),t.parent&&"general"!==t.parent||(t.parent=x),t.ref=t.ref||i(e.settings,"property"),t.label=t.label||t.ref.substr(0,1).toUpperCase()+t.ref.substring(1),n||m(e,t),e.settings.push(t)}function f(e,n,i,o){n=n.item||n,r(e.settings,t(n.ref)),i||m(e,n,!0,null,o)}function m(e,t,n,i,r){var o=s(e,r||t.parent);isNaN(t.order)||t.order>o.length||t.order<0?t.order=o.length:n||void 0===i?n?o.forEach(function(e){e.order>t.order&&e.order--}):o.forEach(function(e){e.order>=t.order&&e.order++}):i<t.order?o.forEach(function(e){e.order>i&&e.order<=t.order&&e.order--}):o.forEach(function(e){e.order>=t.order&&e.order<i&&e.order++})}var g=["showtitles","title","subtitle","footnote"],v="header",y="data",b="sorting",x="settings",q="settings.",C={};return{addScope:n,stripScope:t,canAddSection:function(e,t){return t===v||(t===y?!u(e)&&!h(e):t===b&&(u(e)||h(e))&&!0!==e.sorting)},addSection:d,removeSection:function(e,t,n){if(t===y)return delete e.measures,delete e.dimensions,void delete e.sorting;t!==b?("section-header"===t&&s(e,n).forEach(function(t){f(e,t)}),r(e.sections,n)):delete e.sorting},addItem:p,removeItem:f,moveItem:function(e,n,i,r,s){(n=n.item||n).ref=t(n.ref);var a=n.parent===i;void 0===n.order&&(n.order=o(e.settings,n.ref));var l=n.order;n.parent=i,f(e,n,a,s),n.order=r-(n.order<r&&a?1:0),a&&m(e,n,!1,l),p(e,n,a)},getData:function(e){var t={};return e&&e.properties&&(h(e.properties)&&(t.dimensions=e.properties.dimensions),u(e.properties)&&(t.measures=e.properties.measures)),t},getDefinition:function(e){var t={type:"items",component:"accordion",items:{}};if(e&&e.properties){var n=e.properties;(u(n)||h(n))&&(t.items.data={uses:y,items:{measures:{disabledRef:""},dimensions:{disabledRef:""}}},n.sorting&&(t.items.sorting={uses:b})),t.items.settings={uses:"settings",items:{}},(!n.sections||n.sections.length<1)&&n.settings&&n.settings.length>0&&c(n),n.sections&&n.sections.length>0&&n.sections.forEach(function(e){t.items.settings.items[e.ref]={ref:e.ref,type:"items",label:e.label,items:l(n,e.ref)}})}return t},isValidRef:function(e, t){if(!t||"q"===t.substr(0,1).toLowerCase())return!1;if(g.indexOf(t.toLowerCase())>-1)return!1;var n=!0;return e.settings&&e.settings.forEach(function(e){e.ref===t&&(n=!1)}),n},getSectionItemsArr:s,getSectionsItemsArr:function(e){return e.settings?e.settings.sort(function(e, t){return e.order===t.order?0:!e.order||e.order<t.order?-1:1}):[]}}}),define("extensions.qliktech/widget/widget",["qvangular","core.utils/deferred","translator","_qlik","apis/custom-component/custom-components","objects.extension/default-extension","objects.extension/object-conversion","dev-hub.models/widget-template","./widget-styling","./widget-properties"],function(e, t, n, i, r, o, s, a, l, c){function u(t, n, i, r){r=r&&"hard"===r?" hard-error":" soft-error",t.$scope.error={title:n,message:i},t.htmlElement.innerHTML='<div qv-errorhandler class="object-error'+r+'" ng-class="hard-error" tid="widget.Error"><div class="object-error-content"><div class="object-error-title"><span>{{error.title}}</span>\t</div>\t<div ng-if="error.message" class="object-error-message">{{error.message}}</div></div></div>',e.getService("$compile")(t.htmlElement)(t.$scope)}function h(i,r,o){var s=o.templateId,c=new t;return i.htmlElement||(i.styleElement=document.createElement("style"),r.appendChild(i.styleElement),i.htmlElement=document.createElement("div"),i.htmlElement.id="widget"+o.qInfo.qId,i.htmlElement.style.height="100%",i.htmlElement.style.overflow="auto",r.appendChild(i.htmlElement)),s?(a.get(s).then(function(t){function r(){function r(e){return l.updateLess(i,e,o.qInfo.qId).then(c.resolve).catch(function(e){u(i,n.get("Widget.InvalidCss"," "),e.message),c.resolve()})}l.hasAngularBindings(t.css)?e.getService("$compile")("<style>"+t.css+"</style>")(i.$scope,function(t){e.getService("$timeout")(function(){r(t[0].innerHTML)})}):r(t.css)}i.template=t,s!==i.templateId||i.version!==t.version?(i.templateId=s,i.version=t.version,i.htmlElement.innerHTML=t.html,o.dependencies=t.dependencies,e.getService("$compile")(i.htmlElement)(i.$scope),r()):r()},function(e){u(i,n.get(e||"Widget.TemplateNotFound",[s]),n.get(e||"Widget.TemplateNotFound",[s])),c.resolve()}),c.promise):(u(i,n.get("Widget.NoTemplate"),s),c.resolve(),c.promise())}return{initialProperties:{qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qWidth:10,qHeight:100}]},templateId:""},init:function(e,i){var o=function(){return a.get(i.templateId).then(function(e){return r.init(e.dependencies)},function(){return t.reject(n.get("Widget.TemplateNotFound",[i.widgetMeta&&i.widgetMeta.name||i.templateId,i.widgetMeta&&i.widgetMeta.libid]))})};return i.widgetMeta&&i.widgetMeta.libid?a.getTemplateListFromLibrary(i.widgetMeta.libid).then(function(){return o()}):o()},mapProperties:function(e){var n=this,i=new t,r=a.getLoaded(e.layout.templateId),s={};return r&&r.properties&&(r.properties.measures&&(s.measures=JSON.parse(JSON.stringify(r.properties.measures))),r.properties.dimensions&&(s.dimensions=JSON.parse(JSON.stringify(r.properties.dimensions)))),n.data=c.getData(r),n.definition=c.getDefinition(r),o.mapProperties.apply(n),i.resolve(s),i.promise},support:{cssScaling:!1,snapshot:!0,export:!0,exportData:function(e){return!!e.qHyperCube&&(e.qHyperCube.qDimensionInfo.length>0||e.qHyperCube.qMeasureInfo.length>0)},sharing:!1},importProperties:function(e,t,n){var i=a.getLoaded(t.templateId);n.data=c.getData(i),n.definition=c.getDefinition(i);var r=s.hypercube.importProperties(e,t,n);return t.templateId&&(r.qProperty.templateId=t.templateId,r.qProperty.widgetMeta={libid:i.libid,name:i.name}),n.overrideHasNewType(n),r},paint:function(e,t){return this.$scope.ext.overrideHasNewType(this.$scope.ext),this.$scope.ext.templateId=t.templateId,this.$scope.app||(this.$scope.app=i.currApp(this)),this.$scope.data||(this.$scope.data=i.table(this)),this.$scope.navigation||(this.$scope.navigation=i.navigation),this.$scope.layout=t,this.$scope.settings=t.settings||{},this.$scope.settings.title=t.title,this.$scope.settings.subtitle=t.subtitle,this.$scope.settings.footnote=t.footnote,h(this,e[0],t)},overrideHasNewType:function(e){e.hasNewType=function(e,t,n){return e.ext.templateId!==n.templateId}},controller:[function(){}]}});